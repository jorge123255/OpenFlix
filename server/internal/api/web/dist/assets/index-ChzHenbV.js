(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();function Q_(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var tm={exports:{}},Kl={};var yv;function iT(){if(yv)return Kl;yv=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,r,o){var c=null;if(o!==void 0&&(c=""+o),r.key!==void 0&&(c=""+r.key),"key"in r){o={};for(var d in r)d!=="key"&&(o[d]=r[d])}else o=r;return r=o.ref,{$$typeof:i,type:n,key:c,ref:r!==void 0?r:null,props:o}}return Kl.Fragment=e,Kl.jsx=t,Kl.jsxs=t,Kl}var vv;function aT(){return vv||(vv=1,tm.exports=iT()),tm.exports}var s=aT(),sm={exports:{}},bt={};var bv;function rT(){if(bv)return bt;bv=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),c=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),x=Symbol.iterator;function y(H){return H===null||typeof H!="object"?null:(H=x&&H[x]||H["@@iterator"],typeof H=="function"?H:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,N={};function A(H,Q,oe){this.props=H,this.context=Q,this.refs=N,this.updater=oe||v}A.prototype.isReactComponent={},A.prototype.setState=function(H,Q){if(typeof H!="object"&&typeof H!="function"&&H!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,H,Q,"setState")},A.prototype.forceUpdate=function(H){this.updater.enqueueForceUpdate(this,H,"forceUpdate")};function R(){}R.prototype=A.prototype;function C(H,Q,oe){this.props=H,this.context=Q,this.refs=N,this.updater=oe||v}var D=C.prototype=new R;D.constructor=C,S(D,A.prototype),D.isPureReactComponent=!0;var V=Array.isArray;function z(){}var B={H:null,A:null,T:null,S:null},I=Object.prototype.hasOwnProperty;function M(H,Q,oe){var ye=oe.ref;return{$$typeof:i,type:H,key:Q,ref:ye!==void 0?ye:null,props:oe}}function L(H,Q){return M(H.type,Q,H.props)}function O(H){return typeof H=="object"&&H!==null&&H.$$typeof===i}function J(H){var Q={"=":"=0",":":"=2"};return"$"+H.replace(/[=:]/g,function(oe){return Q[oe]})}var ie=/\/+/g;function ne(H,Q){return typeof H=="object"&&H!==null&&H.key!=null?J(""+H.key):Q.toString(36)}function se(H){switch(H.status){case"fulfilled":return H.value;case"rejected":throw H.reason;default:switch(typeof H.status=="string"?H.then(z,z):(H.status="pending",H.then(function(Q){H.status==="pending"&&(H.status="fulfilled",H.value=Q)},function(Q){H.status==="pending"&&(H.status="rejected",H.reason=Q)})),H.status){case"fulfilled":return H.value;case"rejected":throw H.reason}}throw H}function X(H,Q,oe,ye,xe){var pe=typeof H;(pe==="undefined"||pe==="boolean")&&(H=null);var ee=!1;if(H===null)ee=!0;else switch(pe){case"bigint":case"string":case"number":ee=!0;break;case"object":switch(H.$$typeof){case i:case e:ee=!0;break;case m:return ee=H._init,X(ee(H._payload),Q,oe,ye,xe)}}if(ee)return xe=xe(H),ee=ye===""?"."+ne(H,0):ye,V(xe)?(oe="",ee!=null&&(oe=ee.replace(ie,"$&/")+"/"),X(xe,Q,oe,"",function(Fe){return Fe})):xe!=null&&(O(xe)&&(xe=L(xe,oe+(xe.key==null||H&&H.key===xe.key?"":(""+xe.key).replace(ie,"$&/")+"/")+ee)),Q.push(xe)),1;ee=0;var re=ye===""?".":ye+":";if(V(H))for(var je=0;je<H.length;je++)ye=H[je],pe=re+ne(ye,je),ee+=X(ye,Q,oe,pe,xe);else if(je=y(H),typeof je=="function")for(H=je.call(H),je=0;!(ye=H.next()).done;)ye=ye.value,pe=re+ne(ye,je++),ee+=X(ye,Q,oe,pe,xe);else if(pe==="object"){if(typeof H.then=="function")return X(se(H),Q,oe,ye,xe);throw Q=String(H),Error("Objects are not valid as a React child (found: "+(Q==="[object Object]"?"object with keys {"+Object.keys(H).join(", ")+"}":Q)+"). If you meant to render a collection of children, use an array instead.")}return ee}function ce(H,Q,oe){if(H==null)return H;var ye=[],xe=0;return X(H,ye,"","",function(pe){return Q.call(oe,pe,xe++)}),ye}function le(H){if(H._status===-1){var Q=H._result;Q=Q(),Q.then(function(oe){(H._status===0||H._status===-1)&&(H._status=1,H._result=oe)},function(oe){(H._status===0||H._status===-1)&&(H._status=2,H._result=oe)}),H._status===-1&&(H._status=0,H._result=Q)}if(H._status===1)return H._result.default;throw H._result}var Y=typeof reportError=="function"?reportError:function(H){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof H=="object"&&H!==null&&typeof H.message=="string"?String(H.message):String(H),error:H});if(!window.dispatchEvent(Q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",H);return}console.error(H)},K={map:ce,forEach:function(H,Q,oe){ce(H,function(){Q.apply(this,arguments)},oe)},count:function(H){var Q=0;return ce(H,function(){Q++}),Q},toArray:function(H){return ce(H,function(Q){return Q})||[]},only:function(H){if(!O(H))throw Error("React.Children.only expected to receive a single React element child.");return H}};return bt.Activity=g,bt.Children=K,bt.Component=A,bt.Fragment=t,bt.Profiler=r,bt.PureComponent=C,bt.StrictMode=n,bt.Suspense=h,bt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=B,bt.__COMPILER_RUNTIME={__proto__:null,c:function(H){return B.H.useMemoCache(H)}},bt.cache=function(H){return function(){return H.apply(null,arguments)}},bt.cacheSignal=function(){return null},bt.cloneElement=function(H,Q,oe){if(H==null)throw Error("The argument must be a React element, but you passed "+H+".");var ye=S({},H.props),xe=H.key;if(Q!=null)for(pe in Q.key!==void 0&&(xe=""+Q.key),Q)!I.call(Q,pe)||pe==="key"||pe==="__self"||pe==="__source"||pe==="ref"&&Q.ref===void 0||(ye[pe]=Q[pe]);var pe=arguments.length-2;if(pe===1)ye.children=oe;else if(1<pe){for(var ee=Array(pe),re=0;re<pe;re++)ee[re]=arguments[re+2];ye.children=ee}return M(H.type,xe,ye)},bt.createContext=function(H){return H={$$typeof:c,_currentValue:H,_currentValue2:H,_threadCount:0,Provider:null,Consumer:null},H.Provider=H,H.Consumer={$$typeof:o,_context:H},H},bt.createElement=function(H,Q,oe){var ye,xe={},pe=null;if(Q!=null)for(ye in Q.key!==void 0&&(pe=""+Q.key),Q)I.call(Q,ye)&&ye!=="key"&&ye!=="__self"&&ye!=="__source"&&(xe[ye]=Q[ye]);var ee=arguments.length-2;if(ee===1)xe.children=oe;else if(1<ee){for(var re=Array(ee),je=0;je<ee;je++)re[je]=arguments[je+2];xe.children=re}if(H&&H.defaultProps)for(ye in ee=H.defaultProps,ee)xe[ye]===void 0&&(xe[ye]=ee[ye]);return M(H,pe,xe)},bt.createRef=function(){return{current:null}},bt.forwardRef=function(H){return{$$typeof:d,render:H}},bt.isValidElement=O,bt.lazy=function(H){return{$$typeof:m,_payload:{_status:-1,_result:H},_init:le}},bt.memo=function(H,Q){return{$$typeof:u,type:H,compare:Q===void 0?null:Q}},bt.startTransition=function(H){var Q=B.T,oe={};B.T=oe;try{var ye=H(),xe=B.S;xe!==null&&xe(oe,ye),typeof ye=="object"&&ye!==null&&typeof ye.then=="function"&&ye.then(z,Y)}catch(pe){Y(pe)}finally{Q!==null&&oe.types!==null&&(Q.types=oe.types),B.T=Q}},bt.unstable_useCacheRefresh=function(){return B.H.useCacheRefresh()},bt.use=function(H){return B.H.use(H)},bt.useActionState=function(H,Q,oe){return B.H.useActionState(H,Q,oe)},bt.useCallback=function(H,Q){return B.H.useCallback(H,Q)},bt.useContext=function(H){return B.H.useContext(H)},bt.useDebugValue=function(){},bt.useDeferredValue=function(H,Q){return B.H.useDeferredValue(H,Q)},bt.useEffect=function(H,Q){return B.H.useEffect(H,Q)},bt.useEffectEvent=function(H){return B.H.useEffectEvent(H)},bt.useId=function(){return B.H.useId()},bt.useImperativeHandle=function(H,Q,oe){return B.H.useImperativeHandle(H,Q,oe)},bt.useInsertionEffect=function(H,Q){return B.H.useInsertionEffect(H,Q)},bt.useLayoutEffect=function(H,Q){return B.H.useLayoutEffect(H,Q)},bt.useMemo=function(H,Q){return B.H.useMemo(H,Q)},bt.useOptimistic=function(H,Q){return B.H.useOptimistic(H,Q)},bt.useReducer=function(H,Q,oe){return B.H.useReducer(H,Q,oe)},bt.useRef=function(H){return B.H.useRef(H)},bt.useState=function(H){return B.H.useState(H)},bt.useSyncExternalStore=function(H,Q,oe){return B.H.useSyncExternalStore(H,Q,oe)},bt.useTransition=function(){return B.H.useTransition()},bt.version="19.2.3",bt}var _v;function Mg(){return _v||(_v=1,sm.exports=rT()),sm.exports}var P=Mg();const Us=Q_(P);var nm={exports:{}},ql={},im={exports:{}},am={};var Sv;function oT(){return Sv||(Sv=1,(function(i){function e(X,ce){var le=X.length;X.push(ce);e:for(;0<le;){var Y=le-1>>>1,K=X[Y];if(0<r(K,ce))X[Y]=ce,X[le]=K,le=Y;else break e}}function t(X){return X.length===0?null:X[0]}function n(X){if(X.length===0)return null;var ce=X[0],le=X.pop();if(le!==ce){X[0]=le;e:for(var Y=0,K=X.length,H=K>>>1;Y<H;){var Q=2*(Y+1)-1,oe=X[Q],ye=Q+1,xe=X[ye];if(0>r(oe,le))ye<K&&0>r(xe,oe)?(X[Y]=xe,X[ye]=le,Y=ye):(X[Y]=oe,X[Q]=le,Y=Q);else if(ye<K&&0>r(xe,le))X[Y]=xe,X[ye]=le,Y=ye;else break e}}return ce}function r(X,ce){var le=X.sortIndex-ce.sortIndex;return le!==0?le:X.id-ce.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;i.unstable_now=function(){return o.now()}}else{var c=Date,d=c.now();i.unstable_now=function(){return c.now()-d}}var h=[],u=[],m=1,g=null,x=3,y=!1,v=!1,S=!1,N=!1,A=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;function D(X){for(var ce=t(u);ce!==null;){if(ce.callback===null)n(u);else if(ce.startTime<=X)n(u),ce.sortIndex=ce.expirationTime,e(h,ce);else break;ce=t(u)}}function V(X){if(S=!1,D(X),!v)if(t(h)!==null)v=!0,z||(z=!0,J());else{var ce=t(u);ce!==null&&se(V,ce.startTime-X)}}var z=!1,B=-1,I=5,M=-1;function L(){return N?!0:!(i.unstable_now()-M<I)}function O(){if(N=!1,z){var X=i.unstable_now();M=X;var ce=!0;try{e:{v=!1,S&&(S=!1,R(B),B=-1),y=!0;var le=x;try{t:{for(D(X),g=t(h);g!==null&&!(g.expirationTime>X&&L());){var Y=g.callback;if(typeof Y=="function"){g.callback=null,x=g.priorityLevel;var K=Y(g.expirationTime<=X);if(X=i.unstable_now(),typeof K=="function"){g.callback=K,D(X),ce=!0;break t}g===t(h)&&n(h),D(X)}else n(h);g=t(h)}if(g!==null)ce=!0;else{var H=t(u);H!==null&&se(V,H.startTime-X),ce=!1}}break e}finally{g=null,x=le,y=!1}ce=void 0}}finally{ce?J():z=!1}}}var J;if(typeof C=="function")J=function(){C(O)};else if(typeof MessageChannel<"u"){var ie=new MessageChannel,ne=ie.port2;ie.port1.onmessage=O,J=function(){ne.postMessage(null)}}else J=function(){A(O,0)};function se(X,ce){B=A(function(){X(i.unstable_now())},ce)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(X){X.callback=null},i.unstable_forceFrameRate=function(X){0>X||125<X?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<X?Math.floor(1e3/X):5},i.unstable_getCurrentPriorityLevel=function(){return x},i.unstable_next=function(X){switch(x){case 1:case 2:case 3:var ce=3;break;default:ce=x}var le=x;x=ce;try{return X()}finally{x=le}},i.unstable_requestPaint=function(){N=!0},i.unstable_runWithPriority=function(X,ce){switch(X){case 1:case 2:case 3:case 4:case 5:break;default:X=3}var le=x;x=X;try{return ce()}finally{x=le}},i.unstable_scheduleCallback=function(X,ce,le){var Y=i.unstable_now();switch(typeof le=="object"&&le!==null?(le=le.delay,le=typeof le=="number"&&0<le?Y+le:Y):le=Y,X){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=le+K,X={id:m++,callback:ce,priorityLevel:X,startTime:le,expirationTime:K,sortIndex:-1},le>Y?(X.sortIndex=le,e(u,X),t(h)===null&&X===t(u)&&(S?(R(B),B=-1):S=!0,se(V,le-Y))):(X.sortIndex=K,e(h,X),v||y||(v=!0,z||(z=!0,J()))),X},i.unstable_shouldYield=L,i.unstable_wrapCallback=function(X){var ce=x;return function(){var le=x;x=ce;try{return X.apply(this,arguments)}finally{x=le}}}})(am)),am}var Ev;function lT(){return Ev||(Ev=1,im.exports=oT()),im.exports}var rm={exports:{}},an={};var Nv;function cT(){if(Nv)return an;Nv=1;var i=Mg();function e(h){var u="https://react.dev/errors/"+h;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)u+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+h+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function o(h,u,m){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:g==null?null:""+g,children:h,containerInfo:u,implementation:m}}var c=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(h,u){if(h==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return an.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,an.createPortal=function(h,u){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(e(299));return o(h,u,null,m)},an.flushSync=function(h){var u=c.T,m=n.p;try{if(c.T=null,n.p=2,h)return h()}finally{c.T=u,n.p=m,n.d.f()}},an.preconnect=function(h,u){typeof h=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,n.d.C(h,u))},an.prefetchDNS=function(h){typeof h=="string"&&n.d.D(h)},an.preinit=function(h,u){if(typeof h=="string"&&u&&typeof u.as=="string"){var m=u.as,g=d(m,u.crossOrigin),x=typeof u.integrity=="string"?u.integrity:void 0,y=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;m==="style"?n.d.S(h,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:g,integrity:x,fetchPriority:y}):m==="script"&&n.d.X(h,{crossOrigin:g,integrity:x,fetchPriority:y,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},an.preinitModule=function(h,u){if(typeof h=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var m=d(u.as,u.crossOrigin);n.d.M(h,{crossOrigin:m,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&n.d.M(h)},an.preload=function(h,u){if(typeof h=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var m=u.as,g=d(m,u.crossOrigin);n.d.L(h,m,{crossOrigin:g,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},an.preloadModule=function(h,u){if(typeof h=="string")if(u){var m=d(u.as,u.crossOrigin);n.d.m(h,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:m,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else n.d.m(h)},an.requestFormReset=function(h){n.d.r(h)},an.unstable_batchedUpdates=function(h,u){return h(u)},an.useFormState=function(h,u,m){return c.H.useFormState(h,u,m)},an.useFormStatus=function(){return c.H.useHostTransitionStatus()},an.version="19.2.3",an}var wv;function dT(){if(wv)return rm.exports;wv=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),rm.exports=cT(),rm.exports}var Tv;function uT(){if(Tv)return ql;Tv=1;var i=lT(),e=Mg(),t=dT();function n(a){var l="https://react.dev/errors/"+a;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)l+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+a+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function o(a){var l=a,f=a;if(a.alternate)for(;l.return;)l=l.return;else{a=l;do l=a,(l.flags&4098)!==0&&(f=l.return),a=l.return;while(a)}return l.tag===3?f:null}function c(a){if(a.tag===13){var l=a.memoizedState;if(l===null&&(a=a.alternate,a!==null&&(l=a.memoizedState)),l!==null)return l.dehydrated}return null}function d(a){if(a.tag===31){var l=a.memoizedState;if(l===null&&(a=a.alternate,a!==null&&(l=a.memoizedState)),l!==null)return l.dehydrated}return null}function h(a){if(o(a)!==a)throw Error(n(188))}function u(a){var l=a.alternate;if(!l){if(l=o(a),l===null)throw Error(n(188));return l!==a?null:a}for(var f=a,p=l;;){var _=f.return;if(_===null)break;var w=_.alternate;if(w===null){if(p=_.return,p!==null){f=p;continue}break}if(_.child===w.child){for(w=_.child;w;){if(w===f)return h(_),a;if(w===p)return h(_),l;w=w.sibling}throw Error(n(188))}if(f.return!==p.return)f=_,p=w;else{for(var U=!1,W=_.child;W;){if(W===f){U=!0,f=_,p=w;break}if(W===p){U=!0,p=_,f=w;break}W=W.sibling}if(!U){for(W=w.child;W;){if(W===f){U=!0,f=w,p=_;break}if(W===p){U=!0,p=w,f=_;break}W=W.sibling}if(!U)throw Error(n(189))}}if(f.alternate!==p)throw Error(n(190))}if(f.tag!==3)throw Error(n(188));return f.stateNode.current===f?a:l}function m(a){var l=a.tag;if(l===5||l===26||l===27||l===6)return a;for(a=a.child;a!==null;){if(l=m(a),l!==null)return l;a=a.sibling}return null}var g=Object.assign,x=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),A=Symbol.for("react.profiler"),R=Symbol.for("react.consumer"),C=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),z=Symbol.for("react.suspense_list"),B=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),M=Symbol.for("react.activity"),L=Symbol.for("react.memo_cache_sentinel"),O=Symbol.iterator;function J(a){return a===null||typeof a!="object"?null:(a=O&&a[O]||a["@@iterator"],typeof a=="function"?a:null)}var ie=Symbol.for("react.client.reference");function ne(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===ie?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case S:return"Fragment";case A:return"Profiler";case N:return"StrictMode";case V:return"Suspense";case z:return"SuspenseList";case M:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case v:return"Portal";case C:return a.displayName||"Context";case R:return(a._context.displayName||"Context")+".Consumer";case D:var l=a.render;return a=a.displayName,a||(a=l.displayName||l.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case B:return l=a.displayName||null,l!==null?l:ne(a.type)||"Memo";case I:l=a._payload,a=a._init;try{return ne(a(l))}catch{}}return null}var se=Array.isArray,X=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ce=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,le={pending:!1,data:null,method:null,action:null},Y=[],K=-1;function H(a){return{current:a}}function Q(a){0>K||(a.current=Y[K],Y[K]=null,K--)}function oe(a,l){K++,Y[K]=a.current,a.current=l}var ye=H(null),xe=H(null),pe=H(null),ee=H(null);function re(a,l){switch(oe(pe,l),oe(xe,a),oe(ye,null),l.nodeType){case 9:case 11:a=(a=l.documentElement)&&(a=a.namespaceURI)?$y(a):0;break;default:if(a=l.tagName,l=l.namespaceURI)l=$y(l),a=Gy(l,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}Q(ye),oe(ye,a)}function je(){Q(ye),Q(xe),Q(pe)}function Fe(a){a.memoizedState!==null&&oe(ee,a);var l=ye.current,f=Gy(l,a.type);l!==f&&(oe(xe,a),oe(ye,f))}function We(a){xe.current===a&&(Q(ye),Q(xe)),ee.current===a&&(Q(ee),$l._currentValue=le)}var he,Ue;function Ge(a){if(he===void 0)try{throw Error()}catch(f){var l=f.stack.trim().match(/\n( *(at )?)/);he=l&&l[1]||"",Ue=-1<f.stack.indexOf(`
    at`)?" (<anonymous>)":-1<f.stack.indexOf("@")?"@unknown:0:0":""}return`
`+he+a+Ue}var vt=!1;function Ke(a,l){if(!a||vt)return"";vt=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(l){var Be=function(){throw Error()};if(Object.defineProperty(Be.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Be,[])}catch(Le){var Ae=Le}Reflect.construct(a,[],Be)}else{try{Be.call()}catch(Le){Ae=Le}a.call(Be.prototype)}}else{try{throw Error()}catch(Le){Ae=Le}(Be=a())&&typeof Be.catch=="function"&&Be.catch(function(){})}}catch(Le){if(Le&&Ae&&typeof Le.stack=="string")return[Le.stack,Ae.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var _=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");_&&_.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var w=p.DetermineComponentFrameRoot(),U=w[0],W=w[1];if(U&&W){var ue=U.split(`
`),Ne=W.split(`
`);for(_=p=0;p<ue.length&&!ue[p].includes("DetermineComponentFrameRoot");)p++;for(;_<Ne.length&&!Ne[_].includes("DetermineComponentFrameRoot");)_++;if(p===ue.length||_===Ne.length)for(p=ue.length-1,_=Ne.length-1;1<=p&&0<=_&&ue[p]!==Ne[_];)_--;for(;1<=p&&0<=_;p--,_--)if(ue[p]!==Ne[_]){if(p!==1||_!==1)do if(p--,_--,0>_||ue[p]!==Ne[_]){var Ie=`
`+ue[p].replace(" at new "," at ");return a.displayName&&Ie.includes("<anonymous>")&&(Ie=Ie.replace("<anonymous>",a.displayName)),Ie}while(1<=p&&0<=_);break}}}finally{vt=!1,Error.prepareStackTrace=f}return(f=a?a.displayName||a.name:"")?Ge(f):""}function ht(a,l){switch(a.tag){case 26:case 27:case 5:return Ge(a.type);case 16:return Ge("Lazy");case 13:return a.child!==l&&l!==null?Ge("Suspense Fallback"):Ge("Suspense");case 19:return Ge("SuspenseList");case 0:case 15:return Ke(a.type,!1);case 11:return Ke(a.type.render,!1);case 1:return Ke(a.type,!0);case 31:return Ge("Activity");default:return""}}function Ft(a){try{var l="",f=null;do l+=ht(a,f),f=a,a=a.return;while(a);return l}catch(p){return`
Error generating stack: `+p.message+`
`+p.stack}}var hs=Object.prototype.hasOwnProperty,gs=i.unstable_scheduleCallback,Se=i.unstable_cancelCallback,Ye=i.unstable_shouldYield,lt=i.unstable_requestPaint,_t=i.unstable_now,ln=i.unstable_getCurrentPriorityLevel,Gs=i.unstable_ImmediatePriority,Vn=i.unstable_UserBlockingPriority,Tn=i.unstable_NormalPriority,ri=i.unstable_LowPriority,oi=i.unstable_IdlePriority,cn=i.log,Pr=i.unstable_setDisableYieldValue,we=null,dt=null;function It(a){if(typeof cn=="function"&&Pr(a),dt&&typeof dt.setStrictMode=="function")try{dt.setStrictMode(we,a)}catch{}}var bs=Math.clz32?Math.clz32:th,Zu=Math.log,eh=Math.LN2;function th(a){return a>>>=0,a===0?32:31-(Zu(a)/eh|0)|0}var Br=256,Ur=262144,Fr=4194304;function Ii(a){var l=a&42;if(l!==0)return l;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function $r(a,l,f){var p=a.pendingLanes;if(p===0)return 0;var _=0,w=a.suspendedLanes,U=a.pingedLanes;a=a.warmLanes;var W=p&134217727;return W!==0?(p=W&~w,p!==0?_=Ii(p):(U&=W,U!==0?_=Ii(U):f||(f=W&~a,f!==0&&(_=Ii(f))))):(W=p&~w,W!==0?_=Ii(W):U!==0?_=Ii(U):f||(f=p&~a,f!==0&&(_=Ii(f)))),_===0?0:l!==0&&l!==_&&(l&w)===0&&(w=_&-_,f=l&-l,w>=f||w===32&&(f&4194048)!==0)?l:_}function Ya(a,l){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&l)===0}function Mi(a,l){switch(a){case 1:case 2:case 4:case 8:case 64:return l+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Zo(){var a=Fr;return Fr<<=1,(Fr&62914560)===0&&(Fr=4194304),a}function Gr(a){for(var l=[],f=0;31>f;f++)l.push(a);return l}function da(a,l){a.pendingLanes|=l,l!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function ua(a,l,f,p,_,w){var U=a.pendingLanes;a.pendingLanes=f,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=f,a.entangledLanes&=f,a.errorRecoveryDisabledLanes&=f,a.shellSuspendCounter=0;var W=a.entanglements,ue=a.expirationTimes,Ne=a.hiddenUpdates;for(f=U&~f;0<f;){var Ie=31-bs(f),Be=1<<Ie;W[Ie]=0,ue[Ie]=-1;var Ae=Ne[Ie];if(Ae!==null)for(Ne[Ie]=null,Ie=0;Ie<Ae.length;Ie++){var Le=Ae[Ie];Le!==null&&(Le.lane&=-536870913)}f&=~Be}p!==0&&el(a,p,0),w!==0&&_===0&&a.tag!==0&&(a.suspendedLanes|=w&~(U&~l))}function el(a,l,f){a.pendingLanes|=l,a.suspendedLanes&=~l;var p=31-bs(l);a.entangledLanes|=l,a.entanglements[p]=a.entanglements[p]|1073741824|f&261930}function Hn(a,l){var f=a.entangledLanes|=l;for(a=a.entanglements;f;){var p=31-bs(f),_=1<<p;_&l|a[p]&l&&(a[p]|=l),f&=~_}}function tl(a,l){var f=l&-l;return f=(f&42)!==0?1:sl(f),(f&(a.suspendedLanes|l))!==0?0:f}function sl(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function ps(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function Sc(){var a=ce.p;return a!==0?a:(a=window.event,a===void 0?32:uv(a.type))}function j(a,l){var f=ce.p;try{return ce.p=a,l()}finally{ce.p=f}}var T=Math.random().toString(36).slice(2),E="__reactFiber$"+T,b="__reactProps$"+T,k="__reactContainer$"+T,$="__reactEvents$"+T,G="__reactListeners$"+T,q="__reactHandles$"+T,te="__reactResources$"+T,Z="__reactMarker$"+T;function ae(a){delete a[E],delete a[b],delete a[$],delete a[G],delete a[q]}function fe(a){var l=a[E];if(l)return l;for(var f=a.parentNode;f;){if(l=f[k]||f[E]){if(f=l.alternate,l.child!==null||f!==null&&f.child!==null)for(a=Wy(a);a!==null;){if(f=a[E])return f;a=Wy(a)}return l}a=f,f=a.parentNode}return null}function de(a){if(a=a[E]||a[k]){var l=a.tag;if(l===5||l===6||l===13||l===31||l===26||l===27||l===3)return a}return null}function me(a){var l=a.tag;if(l===5||l===26||l===27||l===6)return a.stateNode;throw Error(n(33))}function Te(a){var l=a[te];return l||(l=a[te]={hoistableStyles:new Map,hoistableScripts:new Map}),l}function De(a){a[Z]=!0}var ke=new Set,Qe={};function He(a,l){$e(a,l),$e(a+"Capture",l)}function $e(a,l){for(Qe[a]=l,a=0;a<l.length;a++)ke.add(l[a])}var rt=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),xt={},ze={};function st(a){return hs.call(ze,a)?!0:hs.call(xt,a)?!1:rt.test(a)?ze[a]=!0:(xt[a]=!0,!1)}function mt(a,l,f){if(st(l))if(f===null)a.removeAttribute(l);else{switch(typeof f){case"undefined":case"function":case"symbol":a.removeAttribute(l);return;case"boolean":var p=l.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){a.removeAttribute(l);return}}a.setAttribute(l,""+f)}}function at(a,l,f){if(f===null)a.removeAttribute(l);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(l);return}a.setAttribute(l,""+f)}}function it(a,l,f,p){if(p===null)a.removeAttribute(f);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(f);return}a.setAttributeNS(l,f,""+p)}}function gt(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function $t(a){var l=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function ut(a,l,f){var p=Object.getOwnPropertyDescriptor(a.constructor.prototype,l);if(!a.hasOwnProperty(l)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var _=p.get,w=p.set;return Object.defineProperty(a,l,{configurable:!0,get:function(){return _.call(this)},set:function(U){f=""+U,w.call(this,U)}}),Object.defineProperty(a,l,{enumerable:p.enumerable}),{getValue:function(){return f},setValue:function(U){f=""+U},stopTracking:function(){a._valueTracker=null,delete a[l]}}}}function St(a){if(!a._valueTracker){var l=$t(a)?"checked":"value";a._valueTracker=ut(a,l,""+a[l])}}function Ht(a){if(!a)return!1;var l=a._valueTracker;if(!l)return!0;var f=l.getValue(),p="";return a&&(p=$t(a)?a.checked?"true":"false":a.value),a=p,a!==f?(l.setValue(a),!0):!1}function ls(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var An=/[\n"\\]/g;function zt(a){return a.replace(An,function(l){return"\\"+l.charCodeAt(0).toString(16)+" "})}function zs(a,l,f,p,_,w,U,W){a.name="",U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"?a.type=U:a.removeAttribute("type"),l!=null?U==="number"?(l===0&&a.value===""||a.value!=l)&&(a.value=""+gt(l)):a.value!==""+gt(l)&&(a.value=""+gt(l)):U!=="submit"&&U!=="reset"||a.removeAttribute("value"),l!=null?Ls(a,U,gt(l)):f!=null?Ls(a,U,gt(f)):p!=null&&a.removeAttribute("value"),_==null&&w!=null&&(a.defaultChecked=!!w),_!=null&&(a.checked=_&&typeof _!="function"&&typeof _!="symbol"),W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?a.name=""+gt(W):a.removeAttribute("name")}function Vs(a,l,f,p,_,w,U,W){if(w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(a.type=w),l!=null||f!=null){if(!(w!=="submit"&&w!=="reset"||l!=null)){St(a);return}f=f!=null?""+gt(f):"",l=l!=null?""+gt(l):f,W||l===a.value||(a.value=l),a.defaultValue=l}p=p??_,p=typeof p!="function"&&typeof p!="symbol"&&!!p,a.checked=W?a.checked:!!p,a.defaultChecked=!!p,U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"&&(a.name=U),St(a)}function Ls(a,l,f){l==="number"&&ls(a.ownerDocument)===a||a.defaultValue===""+f||(a.defaultValue=""+f)}function _s(a,l,f,p){if(a=a.options,l){l={};for(var _=0;_<f.length;_++)l["$"+f[_]]=!0;for(f=0;f<a.length;f++)_=l.hasOwnProperty("$"+a[f].value),a[f].selected!==_&&(a[f].selected=_),_&&p&&(a[f].defaultSelected=!0)}else{for(f=""+gt(f),l=null,_=0;_<a.length;_++){if(a[_].value===f){a[_].selected=!0,p&&(a[_].defaultSelected=!0);return}l!==null||a[_].disabled||(l=a[_])}l!==null&&(l.selected=!0)}}function Bt(a,l,f){if(l!=null&&(l=""+gt(l),l!==a.value&&(a.value=l),f==null)){a.defaultValue!==l&&(a.defaultValue=l);return}a.defaultValue=f!=null?""+gt(f):""}function Kn(a,l,f,p){if(l==null){if(p!=null){if(f!=null)throw Error(n(92));if(se(p)){if(1<p.length)throw Error(n(93));p=p[0]}f=p}f==null&&(f=""),l=f}f=gt(l),a.defaultValue=f,p=a.textContent,p===f&&p!==""&&p!==null&&(a.value=p),St(a)}function nn(a,l){if(l){var f=a.firstChild;if(f&&f===a.lastChild&&f.nodeType===3){f.nodeValue=l;return}}a.textContent=l}var Vr=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function nl(a,l,f){var p=l.indexOf("--")===0;f==null||typeof f=="boolean"||f===""?p?a.setProperty(l,""):l==="float"?a.cssFloat="":a[l]="":p?a.setProperty(l,f):typeof f!="number"||f===0||Vr.has(l)?l==="float"?a.cssFloat=f:a[l]=(""+f).trim():a[l]=f+"px"}function Ec(a,l,f){if(l!=null&&typeof l!="object")throw Error(n(62));if(a=a.style,f!=null){for(var p in f)!f.hasOwnProperty(p)||l!=null&&l.hasOwnProperty(p)||(p.indexOf("--")===0?a.setProperty(p,""):p==="float"?a.cssFloat="":a[p]="");for(var _ in l)p=l[_],l.hasOwnProperty(_)&&f[_]!==p&&nl(a,_,p)}else for(var w in l)l.hasOwnProperty(w)&&nl(a,w,l[w])}function Hr(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Wa=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Qa=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Xa(a){return Qa.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function jn(){}var Ja=null;function Oi(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var pi=null,xi=null;function Za(a){var l=de(a);if(l&&(a=l.stateNode)){var f=a[b]||null;e:switch(a=l.stateNode,l.type){case"input":if(zs(a,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name),l=f.name,f.type==="radio"&&l!=null){for(f=a;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll('input[name="'+zt(""+l)+'"][type="radio"]'),l=0;l<f.length;l++){var p=f[l];if(p!==a&&p.form===a.form){var _=p[b]||null;if(!_)throw Error(n(90));zs(p,_.value,_.defaultValue,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name)}}for(l=0;l<f.length;l++)p=f[l],p.form===a.form&&Ht(p)}break e;case"textarea":Bt(a,f.value,f.defaultValue);break e;case"select":l=f.value,l!=null&&_s(a,!!f.multiple,l,!1)}}}var Kr=!1;function il(a,l,f){if(Kr)return a(l,f);Kr=!0;try{var p=a(l);return p}finally{if(Kr=!1,(pi!==null||xi!==null)&&(dd(),pi&&(l=pi,a=xi,xi=pi=null,Za(l),a)))for(l=0;l<a.length;l++)Za(a[l])}}function Pi(a,l){var f=a.stateNode;if(f===null)return null;var p=f[b]||null;if(p===null)return null;f=p[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(a=a.type,p=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!p;break e;default:a=!1}if(a)return null;if(f&&typeof f!="function")throw Error(n(231,l,typeof f));return f}var qn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),al=!1;if(qn)try{var ha={};Object.defineProperty(ha,"passive",{get:function(){al=!0}}),window.addEventListener("test",ha,ha),window.removeEventListener("test",ha,ha)}catch{al=!1}var li=null,qr=null,Nc=null;function G0(){if(Nc)return Nc;var a,l=qr,f=l.length,p,_="value"in li?li.value:li.textContent,w=_.length;for(a=0;a<f&&l[a]===_[a];a++);var U=f-a;for(p=1;p<=U&&l[f-p]===_[w-p];p++);return Nc=_.slice(a,1<p?1-p:void 0)}function wc(a){var l=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&l===13&&(a=13)):a=l,a===10&&(a=13),32<=a||a===13?a:0}function Tc(){return!0}function V0(){return!1}function gn(a){function l(f,p,_,w,U){this._reactName=f,this._targetInst=_,this.type=p,this.nativeEvent=w,this.target=U,this.currentTarget=null;for(var W in a)a.hasOwnProperty(W)&&(f=a[W],this[W]=f?f(w):w[W]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?Tc:V0,this.isPropagationStopped=V0,this}return g(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=Tc)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=Tc)},persist:function(){},isPersistent:Tc}),l}var er={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ac=gn(er),rl=g({},er,{view:0,detail:0}),sN=gn(rl),sh,nh,ol,jc=g({},rl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ah,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==ol&&(ol&&a.type==="mousemove"?(sh=a.screenX-ol.screenX,nh=a.screenY-ol.screenY):nh=sh=0,ol=a),sh)},movementY:function(a){return"movementY"in a?a.movementY:nh}}),H0=gn(jc),nN=g({},jc,{dataTransfer:0}),iN=gn(nN),aN=g({},rl,{relatedTarget:0}),ih=gn(aN),rN=g({},er,{animationName:0,elapsedTime:0,pseudoElement:0}),oN=gn(rN),lN=g({},er,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),cN=gn(lN),dN=g({},er,{data:0}),K0=gn(dN),uN={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hN={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fN={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mN(a){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(a):(a=fN[a])?!!l[a]:!1}function ah(){return mN}var gN=g({},rl,{key:function(a){if(a.key){var l=uN[a.key]||a.key;if(l!=="Unidentified")return l}return a.type==="keypress"?(a=wc(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?hN[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ah,charCode:function(a){return a.type==="keypress"?wc(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?wc(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),pN=gn(gN),xN=g({},jc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),q0=gn(xN),yN=g({},rl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ah}),vN=gn(yN),bN=g({},er,{propertyName:0,elapsedTime:0,pseudoElement:0}),_N=gn(bN),SN=g({},jc,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),EN=gn(SN),NN=g({},er,{newState:0,oldState:0}),wN=gn(NN),TN=[9,13,27,32],rh=qn&&"CompositionEvent"in window,ll=null;qn&&"documentMode"in document&&(ll=document.documentMode);var AN=qn&&"TextEvent"in window&&!ll,z0=qn&&(!rh||ll&&8<ll&&11>=ll),Y0=" ",W0=!1;function Q0(a,l){switch(a){case"keyup":return TN.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function X0(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var zr=!1;function jN(a,l){switch(a){case"compositionend":return X0(l);case"keypress":return l.which!==32?null:(W0=!0,Y0);case"textInput":return a=l.data,a===Y0&&W0?null:a;default:return null}}function CN(a,l){if(zr)return a==="compositionend"||!rh&&Q0(a,l)?(a=G0(),Nc=qr=li=null,zr=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return z0&&l.locale!=="ko"?null:l.data;default:return null}}var RN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function J0(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l==="input"?!!RN[a.type]:l==="textarea"}function Z0(a,l,f,p){pi?xi?xi.push(p):xi=[p]:pi=p,l=xd(l,"onChange"),0<l.length&&(f=new Ac("onChange","change",null,f,p),a.push({event:f,listeners:l}))}var cl=null,dl=null;function LN(a){My(a,0)}function Cc(a){var l=me(a);if(Ht(l))return a}function ep(a,l){if(a==="change")return l}var tp=!1;if(qn){var oh;if(qn){var lh="oninput"in document;if(!lh){var sp=document.createElement("div");sp.setAttribute("oninput","return;"),lh=typeof sp.oninput=="function"}oh=lh}else oh=!1;tp=oh&&(!document.documentMode||9<document.documentMode)}function np(){cl&&(cl.detachEvent("onpropertychange",ip),dl=cl=null)}function ip(a){if(a.propertyName==="value"&&Cc(dl)){var l=[];Z0(l,dl,a,Oi(a)),il(LN,l)}}function kN(a,l,f){a==="focusin"?(np(),cl=l,dl=f,cl.attachEvent("onpropertychange",ip)):a==="focusout"&&np()}function DN(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Cc(dl)}function IN(a,l){if(a==="click")return Cc(l)}function MN(a,l){if(a==="input"||a==="change")return Cc(l)}function ON(a,l){return a===l&&(a!==0||1/a===1/l)||a!==a&&l!==l}var Cn=typeof Object.is=="function"?Object.is:ON;function ul(a,l){if(Cn(a,l))return!0;if(typeof a!="object"||a===null||typeof l!="object"||l===null)return!1;var f=Object.keys(a),p=Object.keys(l);if(f.length!==p.length)return!1;for(p=0;p<f.length;p++){var _=f[p];if(!hs.call(l,_)||!Cn(a[_],l[_]))return!1}return!0}function ap(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function rp(a,l){var f=ap(a);a=0;for(var p;f;){if(f.nodeType===3){if(p=a+f.textContent.length,a<=l&&p>=l)return{node:f,offset:l-a};a=p}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=ap(f)}}function op(a,l){return a&&l?a===l?!0:a&&a.nodeType===3?!1:l&&l.nodeType===3?op(a,l.parentNode):"contains"in a?a.contains(l):a.compareDocumentPosition?!!(a.compareDocumentPosition(l)&16):!1:!1}function lp(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var l=ls(a.document);l instanceof a.HTMLIFrameElement;){try{var f=typeof l.contentWindow.location.href=="string"}catch{f=!1}if(f)a=l.contentWindow;else break;l=ls(a.document)}return l}function ch(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l&&(l==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||l==="textarea"||a.contentEditable==="true")}var PN=qn&&"documentMode"in document&&11>=document.documentMode,Yr=null,dh=null,hl=null,uh=!1;function cp(a,l,f){var p=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;uh||Yr==null||Yr!==ls(p)||(p=Yr,"selectionStart"in p&&ch(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),hl&&ul(hl,p)||(hl=p,p=xd(dh,"onSelect"),0<p.length&&(l=new Ac("onSelect","select",null,l,f),a.push({event:l,listeners:p}),l.target=Yr)))}function tr(a,l){var f={};return f[a.toLowerCase()]=l.toLowerCase(),f["Webkit"+a]="webkit"+l,f["Moz"+a]="moz"+l,f}var Wr={animationend:tr("Animation","AnimationEnd"),animationiteration:tr("Animation","AnimationIteration"),animationstart:tr("Animation","AnimationStart"),transitionrun:tr("Transition","TransitionRun"),transitionstart:tr("Transition","TransitionStart"),transitioncancel:tr("Transition","TransitionCancel"),transitionend:tr("Transition","TransitionEnd")},hh={},dp={};qn&&(dp=document.createElement("div").style,"AnimationEvent"in window||(delete Wr.animationend.animation,delete Wr.animationiteration.animation,delete Wr.animationstart.animation),"TransitionEvent"in window||delete Wr.transitionend.transition);function sr(a){if(hh[a])return hh[a];if(!Wr[a])return a;var l=Wr[a],f;for(f in l)if(l.hasOwnProperty(f)&&f in dp)return hh[a]=l[f];return a}var up=sr("animationend"),hp=sr("animationiteration"),fp=sr("animationstart"),BN=sr("transitionrun"),UN=sr("transitionstart"),FN=sr("transitioncancel"),mp=sr("transitionend"),gp=new Map,fh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");fh.push("scrollEnd");function ci(a,l){gp.set(a,l),He(l,[a])}var Rc=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var l=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(l))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},zn=[],Qr=0,mh=0;function Lc(){for(var a=Qr,l=mh=Qr=0;l<a;){var f=zn[l];zn[l++]=null;var p=zn[l];zn[l++]=null;var _=zn[l];zn[l++]=null;var w=zn[l];if(zn[l++]=null,p!==null&&_!==null){var U=p.pending;U===null?_.next=_:(_.next=U.next,U.next=_),p.pending=_}w!==0&&pp(f,_,w)}}function kc(a,l,f,p){zn[Qr++]=a,zn[Qr++]=l,zn[Qr++]=f,zn[Qr++]=p,mh|=p,a.lanes|=p,a=a.alternate,a!==null&&(a.lanes|=p)}function gh(a,l,f,p){return kc(a,l,f,p),Dc(a)}function nr(a,l){return kc(a,null,null,l),Dc(a)}function pp(a,l,f){a.lanes|=f;var p=a.alternate;p!==null&&(p.lanes|=f);for(var _=!1,w=a.return;w!==null;)w.childLanes|=f,p=w.alternate,p!==null&&(p.childLanes|=f),w.tag===22&&(a=w.stateNode,a===null||a._visibility&1||(_=!0)),a=w,w=w.return;return a.tag===3?(w=a.stateNode,_&&l!==null&&(_=31-bs(f),a=w.hiddenUpdates,p=a[_],p===null?a[_]=[l]:p.push(l),l.lane=f|536870912),w):null}function Dc(a){if(50<Il)throw Il=0,wf=null,Error(n(185));for(var l=a.return;l!==null;)a=l,l=a.return;return a.tag===3?a.stateNode:null}var Xr={};function $N(a,l,f,p){this.tag=a,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rn(a,l,f,p){return new $N(a,l,f,p)}function ph(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Bi(a,l){var f=a.alternate;return f===null?(f=Rn(a.tag,l,a.key,a.mode),f.elementType=a.elementType,f.type=a.type,f.stateNode=a.stateNode,f.alternate=a,a.alternate=f):(f.pendingProps=l,f.type=a.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=a.flags&65011712,f.childLanes=a.childLanes,f.lanes=a.lanes,f.child=a.child,f.memoizedProps=a.memoizedProps,f.memoizedState=a.memoizedState,f.updateQueue=a.updateQueue,l=a.dependencies,f.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},f.sibling=a.sibling,f.index=a.index,f.ref=a.ref,f.refCleanup=a.refCleanup,f}function xp(a,l){a.flags&=65011714;var f=a.alternate;return f===null?(a.childLanes=0,a.lanes=l,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=f.childLanes,a.lanes=f.lanes,a.child=f.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=f.memoizedProps,a.memoizedState=f.memoizedState,a.updateQueue=f.updateQueue,a.type=f.type,l=f.dependencies,a.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),a}function Ic(a,l,f,p,_,w){var U=0;if(p=a,typeof a=="function")ph(a)&&(U=1);else if(typeof a=="string")U=qw(a,f,ye.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case M:return a=Rn(31,f,l,_),a.elementType=M,a.lanes=w,a;case S:return ir(f.children,_,w,l);case N:U=8,_|=24;break;case A:return a=Rn(12,f,l,_|2),a.elementType=A,a.lanes=w,a;case V:return a=Rn(13,f,l,_),a.elementType=V,a.lanes=w,a;case z:return a=Rn(19,f,l,_),a.elementType=z,a.lanes=w,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case C:U=10;break e;case R:U=9;break e;case D:U=11;break e;case B:U=14;break e;case I:U=16,p=null;break e}U=29,f=Error(n(130,a===null?"null":typeof a,"")),p=null}return l=Rn(U,f,l,_),l.elementType=a,l.type=p,l.lanes=w,l}function ir(a,l,f,p){return a=Rn(7,a,p,l),a.lanes=f,a}function xh(a,l,f){return a=Rn(6,a,null,l),a.lanes=f,a}function yp(a){var l=Rn(18,null,null,0);return l.stateNode=a,l}function yh(a,l,f){return l=Rn(4,a.children!==null?a.children:[],a.key,l),l.lanes=f,l.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},l}var vp=new WeakMap;function Yn(a,l){if(typeof a=="object"&&a!==null){var f=vp.get(a);return f!==void 0?f:(l={value:a,source:l,stack:Ft(l)},vp.set(a,l),l)}return{value:a,source:l,stack:Ft(l)}}var Jr=[],Zr=0,Mc=null,fl=0,Wn=[],Qn=0,fa=null,yi=1,vi="";function Ui(a,l){Jr[Zr++]=fl,Jr[Zr++]=Mc,Mc=a,fl=l}function bp(a,l,f){Wn[Qn++]=yi,Wn[Qn++]=vi,Wn[Qn++]=fa,fa=a;var p=yi;a=vi;var _=32-bs(p)-1;p&=~(1<<_),f+=1;var w=32-bs(l)+_;if(30<w){var U=_-_%5;w=(p&(1<<U)-1).toString(32),p>>=U,_-=U,yi=1<<32-bs(l)+_|f<<_|p,vi=w+a}else yi=1<<w|f<<_|p,vi=a}function vh(a){a.return!==null&&(Ui(a,1),bp(a,1,0))}function bh(a){for(;a===Mc;)Mc=Jr[--Zr],Jr[Zr]=null,fl=Jr[--Zr],Jr[Zr]=null;for(;a===fa;)fa=Wn[--Qn],Wn[Qn]=null,vi=Wn[--Qn],Wn[Qn]=null,yi=Wn[--Qn],Wn[Qn]=null}function _p(a,l){Wn[Qn++]=yi,Wn[Qn++]=vi,Wn[Qn++]=fa,yi=l.id,vi=l.overflow,fa=a}var Ys=null,cs=null,Ut=!1,ma=null,Xn=!1,_h=Error(n(519));function ga(a){var l=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw ml(Yn(l,a)),_h}function Sp(a){var l=a.stateNode,f=a.type,p=a.memoizedProps;switch(l[E]=a,l[b]=p,f){case"dialog":kt("cancel",l),kt("close",l);break;case"iframe":case"object":case"embed":kt("load",l);break;case"video":case"audio":for(f=0;f<Ol.length;f++)kt(Ol[f],l);break;case"source":kt("error",l);break;case"img":case"image":case"link":kt("error",l),kt("load",l);break;case"details":kt("toggle",l);break;case"input":kt("invalid",l),Vs(l,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0);break;case"select":kt("invalid",l);break;case"textarea":kt("invalid",l),Kn(l,p.value,p.defaultValue,p.children)}f=p.children,typeof f!="string"&&typeof f!="number"&&typeof f!="bigint"||l.textContent===""+f||p.suppressHydrationWarning===!0||Uy(l.textContent,f)?(p.popover!=null&&(kt("beforetoggle",l),kt("toggle",l)),p.onScroll!=null&&kt("scroll",l),p.onScrollEnd!=null&&kt("scrollend",l),p.onClick!=null&&(l.onclick=jn),l=!0):l=!1,l||ga(a,!0)}function Ep(a){for(Ys=a.return;Ys;)switch(Ys.tag){case 5:case 31:case 13:Xn=!1;return;case 27:case 3:Xn=!0;return;default:Ys=Ys.return}}function eo(a){if(a!==Ys)return!1;if(!Ut)return Ep(a),Ut=!0,!1;var l=a.tag,f;if((f=l!==3&&l!==27)&&((f=l===5)&&(f=a.type,f=!(f!=="form"&&f!=="button")||Ff(a.type,a.memoizedProps)),f=!f),f&&cs&&ga(a),Ep(a),l===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(317));cs=Yy(a)}else if(l===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(317));cs=Yy(a)}else l===27?(l=cs,Ca(a.type)?(a=Kf,Kf=null,cs=a):cs=l):cs=Ys?Zn(a.stateNode.nextSibling):null;return!0}function ar(){cs=Ys=null,Ut=!1}function Sh(){var a=ma;return a!==null&&(vn===null?vn=a:vn.push.apply(vn,a),ma=null),a}function ml(a){ma===null?ma=[a]:ma.push(a)}var Eh=H(null),rr=null,Fi=null;function pa(a,l,f){oe(Eh,l._currentValue),l._currentValue=f}function $i(a){a._currentValue=Eh.current,Q(Eh)}function Nh(a,l,f){for(;a!==null;){var p=a.alternate;if((a.childLanes&l)!==l?(a.childLanes|=l,p!==null&&(p.childLanes|=l)):p!==null&&(p.childLanes&l)!==l&&(p.childLanes|=l),a===f)break;a=a.return}}function wh(a,l,f,p){var _=a.child;for(_!==null&&(_.return=a);_!==null;){var w=_.dependencies;if(w!==null){var U=_.child;w=w.firstContext;e:for(;w!==null;){var W=w;w=_;for(var ue=0;ue<l.length;ue++)if(W.context===l[ue]){w.lanes|=f,W=w.alternate,W!==null&&(W.lanes|=f),Nh(w.return,f,a),p||(U=null);break e}w=W.next}}else if(_.tag===18){if(U=_.return,U===null)throw Error(n(341));U.lanes|=f,w=U.alternate,w!==null&&(w.lanes|=f),Nh(U,f,a),U=null}else U=_.child;if(U!==null)U.return=_;else for(U=_;U!==null;){if(U===a){U=null;break}if(_=U.sibling,_!==null){_.return=U.return,U=_;break}U=U.return}_=U}}function to(a,l,f,p){a=null;for(var _=l,w=!1;_!==null;){if(!w){if((_.flags&524288)!==0)w=!0;else if((_.flags&262144)!==0)break}if(_.tag===10){var U=_.alternate;if(U===null)throw Error(n(387));if(U=U.memoizedProps,U!==null){var W=_.type;Cn(_.pendingProps.value,U.value)||(a!==null?a.push(W):a=[W])}}else if(_===ee.current){if(U=_.alternate,U===null)throw Error(n(387));U.memoizedState.memoizedState!==_.memoizedState.memoizedState&&(a!==null?a.push($l):a=[$l])}_=_.return}a!==null&&wh(l,a,f,p),l.flags|=262144}function Oc(a){for(a=a.firstContext;a!==null;){if(!Cn(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function or(a){rr=a,Fi=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Ws(a){return Np(rr,a)}function Pc(a,l){return rr===null&&or(a),Np(a,l)}function Np(a,l){var f=l._currentValue;if(l={context:l,memoizedValue:f,next:null},Fi===null){if(a===null)throw Error(n(308));Fi=l,a.dependencies={lanes:0,firstContext:l},a.flags|=524288}else Fi=Fi.next=l;return f}var GN=typeof AbortController<"u"?AbortController:function(){var a=[],l=this.signal={aborted:!1,addEventListener:function(f,p){a.push(p)}};this.abort=function(){l.aborted=!0,a.forEach(function(f){return f()})}},VN=i.unstable_scheduleCallback,HN=i.unstable_NormalPriority,ks={$$typeof:C,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Th(){return{controller:new GN,data:new Map,refCount:0}}function gl(a){a.refCount--,a.refCount===0&&VN(HN,function(){a.controller.abort()})}var pl=null,Ah=0,so=0,no=null;function KN(a,l){if(pl===null){var f=pl=[];Ah=0,so=Lf(),no={status:"pending",value:void 0,then:function(p){f.push(p)}}}return Ah++,l.then(wp,wp),l}function wp(){if(--Ah===0&&pl!==null){no!==null&&(no.status="fulfilled");var a=pl;pl=null,so=0,no=null;for(var l=0;l<a.length;l++)(0,a[l])()}}function qN(a,l){var f=[],p={status:"pending",value:null,reason:null,then:function(_){f.push(_)}};return a.then(function(){p.status="fulfilled",p.value=l;for(var _=0;_<f.length;_++)(0,f[_])(l)},function(_){for(p.status="rejected",p.reason=_,_=0;_<f.length;_++)(0,f[_])(void 0)}),p}var Tp=X.S;X.S=function(a,l){cy=_t(),typeof l=="object"&&l!==null&&typeof l.then=="function"&&KN(a,l),Tp!==null&&Tp(a,l)};var lr=H(null);function jh(){var a=lr.current;return a!==null?a:is.pooledCache}function Bc(a,l){l===null?oe(lr,lr.current):oe(lr,l.pool)}function Ap(){var a=jh();return a===null?null:{parent:ks._currentValue,pool:a}}var io=Error(n(460)),Ch=Error(n(474)),Uc=Error(n(542)),Fc={then:function(){}};function jp(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Cp(a,l,f){switch(f=a[f],f===void 0?a.push(l):f!==l&&(l.then(jn,jn),l=f),l.status){case"fulfilled":return l.value;case"rejected":throw a=l.reason,Lp(a),a;default:if(typeof l.status=="string")l.then(jn,jn);else{if(a=is,a!==null&&100<a.shellSuspendCounter)throw Error(n(482));a=l,a.status="pending",a.then(function(p){if(l.status==="pending"){var _=l;_.status="fulfilled",_.value=p}},function(p){if(l.status==="pending"){var _=l;_.status="rejected",_.reason=p}})}switch(l.status){case"fulfilled":return l.value;case"rejected":throw a=l.reason,Lp(a),a}throw dr=l,io}}function cr(a){try{var l=a._init;return l(a._payload)}catch(f){throw f!==null&&typeof f=="object"&&typeof f.then=="function"?(dr=f,io):f}}var dr=null;function Rp(){if(dr===null)throw Error(n(459));var a=dr;return dr=null,a}function Lp(a){if(a===io||a===Uc)throw Error(n(483))}var ao=null,xl=0;function $c(a){var l=xl;return xl+=1,ao===null&&(ao=[]),Cp(ao,a,l)}function yl(a,l){l=l.props.ref,a.ref=l!==void 0?l:null}function Gc(a,l){throw l.$$typeof===x?Error(n(525)):(a=Object.prototype.toString.call(l),Error(n(31,a==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":a)))}function kp(a){function l(ve,ge){if(a){var Ee=ve.deletions;Ee===null?(ve.deletions=[ge],ve.flags|=16):Ee.push(ge)}}function f(ve,ge){if(!a)return null;for(;ge!==null;)l(ve,ge),ge=ge.sibling;return null}function p(ve){for(var ge=new Map;ve!==null;)ve.key!==null?ge.set(ve.key,ve):ge.set(ve.index,ve),ve=ve.sibling;return ge}function _(ve,ge){return ve=Bi(ve,ge),ve.index=0,ve.sibling=null,ve}function w(ve,ge,Ee){return ve.index=Ee,a?(Ee=ve.alternate,Ee!==null?(Ee=Ee.index,Ee<ge?(ve.flags|=67108866,ge):Ee):(ve.flags|=67108866,ge)):(ve.flags|=1048576,ge)}function U(ve){return a&&ve.alternate===null&&(ve.flags|=67108866),ve}function W(ve,ge,Ee,Pe){return ge===null||ge.tag!==6?(ge=xh(Ee,ve.mode,Pe),ge.return=ve,ge):(ge=_(ge,Ee),ge.return=ve,ge)}function ue(ve,ge,Ee,Pe){var ot=Ee.type;return ot===S?Ie(ve,ge,Ee.props.children,Pe,Ee.key):ge!==null&&(ge.elementType===ot||typeof ot=="object"&&ot!==null&&ot.$$typeof===I&&cr(ot)===ge.type)?(ge=_(ge,Ee.props),yl(ge,Ee),ge.return=ve,ge):(ge=Ic(Ee.type,Ee.key,Ee.props,null,ve.mode,Pe),yl(ge,Ee),ge.return=ve,ge)}function Ne(ve,ge,Ee,Pe){return ge===null||ge.tag!==4||ge.stateNode.containerInfo!==Ee.containerInfo||ge.stateNode.implementation!==Ee.implementation?(ge=yh(Ee,ve.mode,Pe),ge.return=ve,ge):(ge=_(ge,Ee.children||[]),ge.return=ve,ge)}function Ie(ve,ge,Ee,Pe,ot){return ge===null||ge.tag!==7?(ge=ir(Ee,ve.mode,Pe,ot),ge.return=ve,ge):(ge=_(ge,Ee),ge.return=ve,ge)}function Be(ve,ge,Ee){if(typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint")return ge=xh(""+ge,ve.mode,Ee),ge.return=ve,ge;if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case y:return Ee=Ic(ge.type,ge.key,ge.props,null,ve.mode,Ee),yl(Ee,ge),Ee.return=ve,Ee;case v:return ge=yh(ge,ve.mode,Ee),ge.return=ve,ge;case I:return ge=cr(ge),Be(ve,ge,Ee)}if(se(ge)||J(ge))return ge=ir(ge,ve.mode,Ee,null),ge.return=ve,ge;if(typeof ge.then=="function")return Be(ve,$c(ge),Ee);if(ge.$$typeof===C)return Be(ve,Pc(ve,ge),Ee);Gc(ve,ge)}return null}function Ae(ve,ge,Ee,Pe){var ot=ge!==null?ge.key:null;if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number"||typeof Ee=="bigint")return ot!==null?null:W(ve,ge,""+Ee,Pe);if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case y:return Ee.key===ot?ue(ve,ge,Ee,Pe):null;case v:return Ee.key===ot?Ne(ve,ge,Ee,Pe):null;case I:return Ee=cr(Ee),Ae(ve,ge,Ee,Pe)}if(se(Ee)||J(Ee))return ot!==null?null:Ie(ve,ge,Ee,Pe,null);if(typeof Ee.then=="function")return Ae(ve,ge,$c(Ee),Pe);if(Ee.$$typeof===C)return Ae(ve,ge,Pc(ve,Ee),Pe);Gc(ve,Ee)}return null}function Le(ve,ge,Ee,Pe,ot){if(typeof Pe=="string"&&Pe!==""||typeof Pe=="number"||typeof Pe=="bigint")return ve=ve.get(Ee)||null,W(ge,ve,""+Pe,ot);if(typeof Pe=="object"&&Pe!==null){switch(Pe.$$typeof){case y:return ve=ve.get(Pe.key===null?Ee:Pe.key)||null,ue(ge,ve,Pe,ot);case v:return ve=ve.get(Pe.key===null?Ee:Pe.key)||null,Ne(ge,ve,Pe,ot);case I:return Pe=cr(Pe),Le(ve,ge,Ee,Pe,ot)}if(se(Pe)||J(Pe))return ve=ve.get(Ee)||null,Ie(ge,ve,Pe,ot,null);if(typeof Pe.then=="function")return Le(ve,ge,Ee,$c(Pe),ot);if(Pe.$$typeof===C)return Le(ve,ge,Ee,Pc(ge,Pe),ot);Gc(ge,Pe)}return null}function Ze(ve,ge,Ee,Pe){for(var ot=null,Gt=null,et=ge,Tt=ge=0,Ot=null;et!==null&&Tt<Ee.length;Tt++){et.index>Tt?(Ot=et,et=null):Ot=et.sibling;var Vt=Ae(ve,et,Ee[Tt],Pe);if(Vt===null){et===null&&(et=Ot);break}a&&et&&Vt.alternate===null&&l(ve,et),ge=w(Vt,ge,Tt),Gt===null?ot=Vt:Gt.sibling=Vt,Gt=Vt,et=Ot}if(Tt===Ee.length)return f(ve,et),Ut&&Ui(ve,Tt),ot;if(et===null){for(;Tt<Ee.length;Tt++)et=Be(ve,Ee[Tt],Pe),et!==null&&(ge=w(et,ge,Tt),Gt===null?ot=et:Gt.sibling=et,Gt=et);return Ut&&Ui(ve,Tt),ot}for(et=p(et);Tt<Ee.length;Tt++)Ot=Le(et,ve,Tt,Ee[Tt],Pe),Ot!==null&&(a&&Ot.alternate!==null&&et.delete(Ot.key===null?Tt:Ot.key),ge=w(Ot,ge,Tt),Gt===null?ot=Ot:Gt.sibling=Ot,Gt=Ot);return a&&et.forEach(function(Ia){return l(ve,Ia)}),Ut&&Ui(ve,Tt),ot}function ct(ve,ge,Ee,Pe){if(Ee==null)throw Error(n(151));for(var ot=null,Gt=null,et=ge,Tt=ge=0,Ot=null,Vt=Ee.next();et!==null&&!Vt.done;Tt++,Vt=Ee.next()){et.index>Tt?(Ot=et,et=null):Ot=et.sibling;var Ia=Ae(ve,et,Vt.value,Pe);if(Ia===null){et===null&&(et=Ot);break}a&&et&&Ia.alternate===null&&l(ve,et),ge=w(Ia,ge,Tt),Gt===null?ot=Ia:Gt.sibling=Ia,Gt=Ia,et=Ot}if(Vt.done)return f(ve,et),Ut&&Ui(ve,Tt),ot;if(et===null){for(;!Vt.done;Tt++,Vt=Ee.next())Vt=Be(ve,Vt.value,Pe),Vt!==null&&(ge=w(Vt,ge,Tt),Gt===null?ot=Vt:Gt.sibling=Vt,Gt=Vt);return Ut&&Ui(ve,Tt),ot}for(et=p(et);!Vt.done;Tt++,Vt=Ee.next())Vt=Le(et,ve,Tt,Vt.value,Pe),Vt!==null&&(a&&Vt.alternate!==null&&et.delete(Vt.key===null?Tt:Vt.key),ge=w(Vt,ge,Tt),Gt===null?ot=Vt:Gt.sibling=Vt,Gt=Vt);return a&&et.forEach(function(nT){return l(ve,nT)}),Ut&&Ui(ve,Tt),ot}function es(ve,ge,Ee,Pe){if(typeof Ee=="object"&&Ee!==null&&Ee.type===S&&Ee.key===null&&(Ee=Ee.props.children),typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case y:e:{for(var ot=Ee.key;ge!==null;){if(ge.key===ot){if(ot=Ee.type,ot===S){if(ge.tag===7){f(ve,ge.sibling),Pe=_(ge,Ee.props.children),Pe.return=ve,ve=Pe;break e}}else if(ge.elementType===ot||typeof ot=="object"&&ot!==null&&ot.$$typeof===I&&cr(ot)===ge.type){f(ve,ge.sibling),Pe=_(ge,Ee.props),yl(Pe,Ee),Pe.return=ve,ve=Pe;break e}f(ve,ge);break}else l(ve,ge);ge=ge.sibling}Ee.type===S?(Pe=ir(Ee.props.children,ve.mode,Pe,Ee.key),Pe.return=ve,ve=Pe):(Pe=Ic(Ee.type,Ee.key,Ee.props,null,ve.mode,Pe),yl(Pe,Ee),Pe.return=ve,ve=Pe)}return U(ve);case v:e:{for(ot=Ee.key;ge!==null;){if(ge.key===ot)if(ge.tag===4&&ge.stateNode.containerInfo===Ee.containerInfo&&ge.stateNode.implementation===Ee.implementation){f(ve,ge.sibling),Pe=_(ge,Ee.children||[]),Pe.return=ve,ve=Pe;break e}else{f(ve,ge);break}else l(ve,ge);ge=ge.sibling}Pe=yh(Ee,ve.mode,Pe),Pe.return=ve,ve=Pe}return U(ve);case I:return Ee=cr(Ee),es(ve,ge,Ee,Pe)}if(se(Ee))return Ze(ve,ge,Ee,Pe);if(J(Ee)){if(ot=J(Ee),typeof ot!="function")throw Error(n(150));return Ee=ot.call(Ee),ct(ve,ge,Ee,Pe)}if(typeof Ee.then=="function")return es(ve,ge,$c(Ee),Pe);if(Ee.$$typeof===C)return es(ve,ge,Pc(ve,Ee),Pe);Gc(ve,Ee)}return typeof Ee=="string"&&Ee!==""||typeof Ee=="number"||typeof Ee=="bigint"?(Ee=""+Ee,ge!==null&&ge.tag===6?(f(ve,ge.sibling),Pe=_(ge,Ee),Pe.return=ve,ve=Pe):(f(ve,ge),Pe=xh(Ee,ve.mode,Pe),Pe.return=ve,ve=Pe),U(ve)):f(ve,ge)}return function(ve,ge,Ee,Pe){try{xl=0;var ot=es(ve,ge,Ee,Pe);return ao=null,ot}catch(et){if(et===io||et===Uc)throw et;var Gt=Rn(29,et,null,ve.mode);return Gt.lanes=Pe,Gt.return=ve,Gt}finally{}}}var ur=kp(!0),Dp=kp(!1),xa=!1;function Rh(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Lh(a,l){a=a.updateQueue,l.updateQueue===a&&(l.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function ya(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function va(a,l,f){var p=a.updateQueue;if(p===null)return null;if(p=p.shared,(Kt&2)!==0){var _=p.pending;return _===null?l.next=l:(l.next=_.next,_.next=l),p.pending=l,l=Dc(a),pp(a,null,f),l}return kc(a,p,l,f),Dc(a)}function vl(a,l,f){if(l=l.updateQueue,l!==null&&(l=l.shared,(f&4194048)!==0)){var p=l.lanes;p&=a.pendingLanes,f|=p,l.lanes=f,Hn(a,f)}}function kh(a,l){var f=a.updateQueue,p=a.alternate;if(p!==null&&(p=p.updateQueue,f===p)){var _=null,w=null;if(f=f.firstBaseUpdate,f!==null){do{var U={lane:f.lane,tag:f.tag,payload:f.payload,callback:null,next:null};w===null?_=w=U:w=w.next=U,f=f.next}while(f!==null);w===null?_=w=l:w=w.next=l}else _=w=l;f={baseState:p.baseState,firstBaseUpdate:_,lastBaseUpdate:w,shared:p.shared,callbacks:p.callbacks},a.updateQueue=f;return}a=f.lastBaseUpdate,a===null?f.firstBaseUpdate=l:a.next=l,f.lastBaseUpdate=l}var Dh=!1;function bl(){if(Dh){var a=no;if(a!==null)throw a}}function _l(a,l,f,p){Dh=!1;var _=a.updateQueue;xa=!1;var w=_.firstBaseUpdate,U=_.lastBaseUpdate,W=_.shared.pending;if(W!==null){_.shared.pending=null;var ue=W,Ne=ue.next;ue.next=null,U===null?w=Ne:U.next=Ne,U=ue;var Ie=a.alternate;Ie!==null&&(Ie=Ie.updateQueue,W=Ie.lastBaseUpdate,W!==U&&(W===null?Ie.firstBaseUpdate=Ne:W.next=Ne,Ie.lastBaseUpdate=ue))}if(w!==null){var Be=_.baseState;U=0,Ie=Ne=ue=null,W=w;do{var Ae=W.lane&-536870913,Le=Ae!==W.lane;if(Le?(Mt&Ae)===Ae:(p&Ae)===Ae){Ae!==0&&Ae===so&&(Dh=!0),Ie!==null&&(Ie=Ie.next={lane:0,tag:W.tag,payload:W.payload,callback:null,next:null});e:{var Ze=a,ct=W;Ae=l;var es=f;switch(ct.tag){case 1:if(Ze=ct.payload,typeof Ze=="function"){Be=Ze.call(es,Be,Ae);break e}Be=Ze;break e;case 3:Ze.flags=Ze.flags&-65537|128;case 0:if(Ze=ct.payload,Ae=typeof Ze=="function"?Ze.call(es,Be,Ae):Ze,Ae==null)break e;Be=g({},Be,Ae);break e;case 2:xa=!0}}Ae=W.callback,Ae!==null&&(a.flags|=64,Le&&(a.flags|=8192),Le=_.callbacks,Le===null?_.callbacks=[Ae]:Le.push(Ae))}else Le={lane:Ae,tag:W.tag,payload:W.payload,callback:W.callback,next:null},Ie===null?(Ne=Ie=Le,ue=Be):Ie=Ie.next=Le,U|=Ae;if(W=W.next,W===null){if(W=_.shared.pending,W===null)break;Le=W,W=Le.next,Le.next=null,_.lastBaseUpdate=Le,_.shared.pending=null}}while(!0);Ie===null&&(ue=Be),_.baseState=ue,_.firstBaseUpdate=Ne,_.lastBaseUpdate=Ie,w===null&&(_.shared.lanes=0),Na|=U,a.lanes=U,a.memoizedState=Be}}function Ip(a,l){if(typeof a!="function")throw Error(n(191,a));a.call(l)}function Mp(a,l){var f=a.callbacks;if(f!==null)for(a.callbacks=null,a=0;a<f.length;a++)Ip(f[a],l)}var ro=H(null),Vc=H(0);function Op(a,l){a=Qi,oe(Vc,a),oe(ro,l),Qi=a|l.baseLanes}function Ih(){oe(Vc,Qi),oe(ro,ro.current)}function Mh(){Qi=Vc.current,Q(ro),Q(Vc)}var Ln=H(null),Jn=null;function ba(a){var l=a.alternate;oe(As,As.current&1),oe(Ln,a),Jn===null&&(l===null||ro.current!==null||l.memoizedState!==null)&&(Jn=a)}function Oh(a){oe(As,As.current),oe(Ln,a),Jn===null&&(Jn=a)}function Pp(a){a.tag===22?(oe(As,As.current),oe(Ln,a),Jn===null&&(Jn=a)):_a()}function _a(){oe(As,As.current),oe(Ln,Ln.current)}function kn(a){Q(Ln),Jn===a&&(Jn=null),Q(As)}var As=H(0);function Hc(a){for(var l=a;l!==null;){if(l.tag===13){var f=l.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||Vf(f)||Hf(f)))return l}else if(l.tag===19&&(l.memoizedProps.revealOrder==="forwards"||l.memoizedProps.revealOrder==="backwards"||l.memoizedProps.revealOrder==="unstable_legacy-backwards"||l.memoizedProps.revealOrder==="together")){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var Gi=0,Nt=null,Jt=null,Ds=null,Kc=!1,oo=!1,hr=!1,qc=0,Sl=0,lo=null,zN=0;function Ss(){throw Error(n(321))}function Ph(a,l){if(l===null)return!1;for(var f=0;f<l.length&&f<a.length;f++)if(!Cn(a[f],l[f]))return!1;return!0}function Bh(a,l,f,p,_,w){return Gi=w,Nt=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,X.H=a===null||a.memoizedState===null?bx:Zh,hr=!1,w=f(p,_),hr=!1,oo&&(w=Up(l,f,p,_)),Bp(a),w}function Bp(a){X.H=wl;var l=Jt!==null&&Jt.next!==null;if(Gi=0,Ds=Jt=Nt=null,Kc=!1,Sl=0,lo=null,l)throw Error(n(300));a===null||Is||(a=a.dependencies,a!==null&&Oc(a)&&(Is=!0))}function Up(a,l,f,p){Nt=a;var _=0;do{if(oo&&(lo=null),Sl=0,oo=!1,25<=_)throw Error(n(301));if(_+=1,Ds=Jt=null,a.updateQueue!=null){var w=a.updateQueue;w.lastEffect=null,w.events=null,w.stores=null,w.memoCache!=null&&(w.memoCache.index=0)}X.H=_x,w=l(f,p)}while(oo);return w}function YN(){var a=X.H,l=a.useState()[0];return l=typeof l.then=="function"?El(l):l,a=a.useState()[0],(Jt!==null?Jt.memoizedState:null)!==a&&(Nt.flags|=1024),l}function Uh(){var a=qc!==0;return qc=0,a}function Fh(a,l,f){l.updateQueue=a.updateQueue,l.flags&=-2053,a.lanes&=~f}function $h(a){if(Kc){for(a=a.memoizedState;a!==null;){var l=a.queue;l!==null&&(l.pending=null),a=a.next}Kc=!1}Gi=0,Ds=Jt=Nt=null,oo=!1,Sl=qc=0,lo=null}function dn(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ds===null?Nt.memoizedState=Ds=a:Ds=Ds.next=a,Ds}function js(){if(Jt===null){var a=Nt.alternate;a=a!==null?a.memoizedState:null}else a=Jt.next;var l=Ds===null?Nt.memoizedState:Ds.next;if(l!==null)Ds=l,Jt=a;else{if(a===null)throw Nt.alternate===null?Error(n(467)):Error(n(310));Jt=a,a={memoizedState:Jt.memoizedState,baseState:Jt.baseState,baseQueue:Jt.baseQueue,queue:Jt.queue,next:null},Ds===null?Nt.memoizedState=Ds=a:Ds=Ds.next=a}return Ds}function zc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function El(a){var l=Sl;return Sl+=1,lo===null&&(lo=[]),a=Cp(lo,a,l),l=Nt,(Ds===null?l.memoizedState:Ds.next)===null&&(l=l.alternate,X.H=l===null||l.memoizedState===null?bx:Zh),a}function Yc(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return El(a);if(a.$$typeof===C)return Ws(a)}throw Error(n(438,String(a)))}function Gh(a){var l=null,f=Nt.updateQueue;if(f!==null&&(l=f.memoCache),l==null){var p=Nt.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(l={data:p.data.map(function(_){return _.slice()}),index:0})))}if(l==null&&(l={data:[],index:0}),f===null&&(f=zc(),Nt.updateQueue=f),f.memoCache=l,f=l.data[l.index],f===void 0)for(f=l.data[l.index]=Array(a),p=0;p<a;p++)f[p]=L;return l.index++,f}function Vi(a,l){return typeof l=="function"?l(a):l}function Wc(a){var l=js();return Vh(l,Jt,a)}function Vh(a,l,f){var p=a.queue;if(p===null)throw Error(n(311));p.lastRenderedReducer=f;var _=a.baseQueue,w=p.pending;if(w!==null){if(_!==null){var U=_.next;_.next=w.next,w.next=U}l.baseQueue=_=w,p.pending=null}if(w=a.baseState,_===null)a.memoizedState=w;else{l=_.next;var W=U=null,ue=null,Ne=l,Ie=!1;do{var Be=Ne.lane&-536870913;if(Be!==Ne.lane?(Mt&Be)===Be:(Gi&Be)===Be){var Ae=Ne.revertLane;if(Ae===0)ue!==null&&(ue=ue.next={lane:0,revertLane:0,gesture:null,action:Ne.action,hasEagerState:Ne.hasEagerState,eagerState:Ne.eagerState,next:null}),Be===so&&(Ie=!0);else if((Gi&Ae)===Ae){Ne=Ne.next,Ae===so&&(Ie=!0);continue}else Be={lane:0,revertLane:Ne.revertLane,gesture:null,action:Ne.action,hasEagerState:Ne.hasEagerState,eagerState:Ne.eagerState,next:null},ue===null?(W=ue=Be,U=w):ue=ue.next=Be,Nt.lanes|=Ae,Na|=Ae;Be=Ne.action,hr&&f(w,Be),w=Ne.hasEagerState?Ne.eagerState:f(w,Be)}else Ae={lane:Be,revertLane:Ne.revertLane,gesture:Ne.gesture,action:Ne.action,hasEagerState:Ne.hasEagerState,eagerState:Ne.eagerState,next:null},ue===null?(W=ue=Ae,U=w):ue=ue.next=Ae,Nt.lanes|=Be,Na|=Be;Ne=Ne.next}while(Ne!==null&&Ne!==l);if(ue===null?U=w:ue.next=W,!Cn(w,a.memoizedState)&&(Is=!0,Ie&&(f=no,f!==null)))throw f;a.memoizedState=w,a.baseState=U,a.baseQueue=ue,p.lastRenderedState=w}return _===null&&(p.lanes=0),[a.memoizedState,p.dispatch]}function Hh(a){var l=js(),f=l.queue;if(f===null)throw Error(n(311));f.lastRenderedReducer=a;var p=f.dispatch,_=f.pending,w=l.memoizedState;if(_!==null){f.pending=null;var U=_=_.next;do w=a(w,U.action),U=U.next;while(U!==_);Cn(w,l.memoizedState)||(Is=!0),l.memoizedState=w,l.baseQueue===null&&(l.baseState=w),f.lastRenderedState=w}return[w,p]}function Fp(a,l,f){var p=Nt,_=js(),w=Ut;if(w){if(f===void 0)throw Error(n(407));f=f()}else f=l();var U=!Cn((Jt||_).memoizedState,f);if(U&&(_.memoizedState=f,Is=!0),_=_.queue,zh(Vp.bind(null,p,_,a),[a]),_.getSnapshot!==l||U||Ds!==null&&Ds.memoizedState.tag&1){if(p.flags|=2048,co(9,{destroy:void 0},Gp.bind(null,p,_,f,l),null),is===null)throw Error(n(349));w||(Gi&127)!==0||$p(p,l,f)}return f}function $p(a,l,f){a.flags|=16384,a={getSnapshot:l,value:f},l=Nt.updateQueue,l===null?(l=zc(),Nt.updateQueue=l,l.stores=[a]):(f=l.stores,f===null?l.stores=[a]:f.push(a))}function Gp(a,l,f,p){l.value=f,l.getSnapshot=p,Hp(l)&&Kp(a)}function Vp(a,l,f){return f(function(){Hp(l)&&Kp(a)})}function Hp(a){var l=a.getSnapshot;a=a.value;try{var f=l();return!Cn(a,f)}catch{return!0}}function Kp(a){var l=nr(a,2);l!==null&&bn(l,a,2)}function Kh(a){var l=dn();if(typeof a=="function"){var f=a;if(a=f(),hr){It(!0);try{f()}finally{It(!1)}}}return l.memoizedState=l.baseState=a,l.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vi,lastRenderedState:a},l}function qp(a,l,f,p){return a.baseState=f,Vh(a,Jt,typeof p=="function"?p:Vi)}function WN(a,l,f,p,_){if(Jc(a))throw Error(n(485));if(a=l.action,a!==null){var w={payload:_,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(U){w.listeners.push(U)}};X.T!==null?f(!0):w.isTransition=!1,p(w),f=l.pending,f===null?(w.next=l.pending=w,zp(l,w)):(w.next=f.next,l.pending=f.next=w)}}function zp(a,l){var f=l.action,p=l.payload,_=a.state;if(l.isTransition){var w=X.T,U={};X.T=U;try{var W=f(_,p),ue=X.S;ue!==null&&ue(U,W),Yp(a,l,W)}catch(Ne){qh(a,l,Ne)}finally{w!==null&&U.types!==null&&(w.types=U.types),X.T=w}}else try{w=f(_,p),Yp(a,l,w)}catch(Ne){qh(a,l,Ne)}}function Yp(a,l,f){f!==null&&typeof f=="object"&&typeof f.then=="function"?f.then(function(p){Wp(a,l,p)},function(p){return qh(a,l,p)}):Wp(a,l,f)}function Wp(a,l,f){l.status="fulfilled",l.value=f,Qp(l),a.state=f,l=a.pending,l!==null&&(f=l.next,f===l?a.pending=null:(f=f.next,l.next=f,zp(a,f)))}function qh(a,l,f){var p=a.pending;if(a.pending=null,p!==null){p=p.next;do l.status="rejected",l.reason=f,Qp(l),l=l.next;while(l!==p)}a.action=null}function Qp(a){a=a.listeners;for(var l=0;l<a.length;l++)(0,a[l])()}function Xp(a,l){return l}function Jp(a,l){if(Ut){var f=is.formState;if(f!==null){e:{var p=Nt;if(Ut){if(cs){t:{for(var _=cs,w=Xn;_.nodeType!==8;){if(!w){_=null;break t}if(_=Zn(_.nextSibling),_===null){_=null;break t}}w=_.data,_=w==="F!"||w==="F"?_:null}if(_){cs=Zn(_.nextSibling),p=_.data==="F!";break e}}ga(p)}p=!1}p&&(l=f[0])}}return f=dn(),f.memoizedState=f.baseState=l,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Xp,lastRenderedState:l},f.queue=p,f=xx.bind(null,Nt,p),p.dispatch=f,p=Kh(!1),w=Jh.bind(null,Nt,!1,p.queue),p=dn(),_={state:l,dispatch:null,action:a,pending:null},p.queue=_,f=WN.bind(null,Nt,_,w,f),_.dispatch=f,p.memoizedState=a,[l,f,!1]}function Zp(a){var l=js();return ex(l,Jt,a)}function ex(a,l,f){if(l=Vh(a,l,Xp)[0],a=Wc(Vi)[0],typeof l=="object"&&l!==null&&typeof l.then=="function")try{var p=El(l)}catch(U){throw U===io?Uc:U}else p=l;l=js();var _=l.queue,w=_.dispatch;return f!==l.memoizedState&&(Nt.flags|=2048,co(9,{destroy:void 0},QN.bind(null,_,f),null)),[p,w,a]}function QN(a,l){a.action=l}function tx(a){var l=js(),f=Jt;if(f!==null)return ex(l,f,a);js(),l=l.memoizedState,f=js();var p=f.queue.dispatch;return f.memoizedState=a,[l,p,!1]}function co(a,l,f,p){return a={tag:a,create:f,deps:p,inst:l,next:null},l=Nt.updateQueue,l===null&&(l=zc(),Nt.updateQueue=l),f=l.lastEffect,f===null?l.lastEffect=a.next=a:(p=f.next,f.next=a,a.next=p,l.lastEffect=a),a}function sx(){return js().memoizedState}function Qc(a,l,f,p){var _=dn();Nt.flags|=a,_.memoizedState=co(1|l,{destroy:void 0},f,p===void 0?null:p)}function Xc(a,l,f,p){var _=js();p=p===void 0?null:p;var w=_.memoizedState.inst;Jt!==null&&p!==null&&Ph(p,Jt.memoizedState.deps)?_.memoizedState=co(l,w,f,p):(Nt.flags|=a,_.memoizedState=co(1|l,w,f,p))}function nx(a,l){Qc(8390656,8,a,l)}function zh(a,l){Xc(2048,8,a,l)}function XN(a){Nt.flags|=4;var l=Nt.updateQueue;if(l===null)l=zc(),Nt.updateQueue=l,l.events=[a];else{var f=l.events;f===null?l.events=[a]:f.push(a)}}function ix(a){var l=js().memoizedState;return XN({ref:l,nextImpl:a}),function(){if((Kt&2)!==0)throw Error(n(440));return l.impl.apply(void 0,arguments)}}function ax(a,l){return Xc(4,2,a,l)}function rx(a,l){return Xc(4,4,a,l)}function ox(a,l){if(typeof l=="function"){a=a();var f=l(a);return function(){typeof f=="function"?f():l(null)}}if(l!=null)return a=a(),l.current=a,function(){l.current=null}}function lx(a,l,f){f=f!=null?f.concat([a]):null,Xc(4,4,ox.bind(null,l,a),f)}function Yh(){}function cx(a,l){var f=js();l=l===void 0?null:l;var p=f.memoizedState;return l!==null&&Ph(l,p[1])?p[0]:(f.memoizedState=[a,l],a)}function dx(a,l){var f=js();l=l===void 0?null:l;var p=f.memoizedState;if(l!==null&&Ph(l,p[1]))return p[0];if(p=a(),hr){It(!0);try{a()}finally{It(!1)}}return f.memoizedState=[p,l],p}function Wh(a,l,f){return f===void 0||(Gi&1073741824)!==0&&(Mt&261930)===0?a.memoizedState=l:(a.memoizedState=f,a=uy(),Nt.lanes|=a,Na|=a,f)}function ux(a,l,f,p){return Cn(f,l)?f:ro.current!==null?(a=Wh(a,f,p),Cn(a,l)||(Is=!0),a):(Gi&42)===0||(Gi&1073741824)!==0&&(Mt&261930)===0?(Is=!0,a.memoizedState=f):(a=uy(),Nt.lanes|=a,Na|=a,l)}function hx(a,l,f,p,_){var w=ce.p;ce.p=w!==0&&8>w?w:8;var U=X.T,W={};X.T=W,Jh(a,!1,l,f);try{var ue=_(),Ne=X.S;if(Ne!==null&&Ne(W,ue),ue!==null&&typeof ue=="object"&&typeof ue.then=="function"){var Ie=qN(ue,p);Nl(a,l,Ie,Mn(a))}else Nl(a,l,p,Mn(a))}catch(Be){Nl(a,l,{then:function(){},status:"rejected",reason:Be},Mn())}finally{ce.p=w,U!==null&&W.types!==null&&(U.types=W.types),X.T=U}}function JN(){}function Qh(a,l,f,p){if(a.tag!==5)throw Error(n(476));var _=fx(a).queue;hx(a,_,l,le,f===null?JN:function(){return mx(a),f(p)})}function fx(a){var l=a.memoizedState;if(l!==null)return l;l={memoizedState:le,baseState:le,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vi,lastRenderedState:le},next:null};var f={};return l.next={memoizedState:f,baseState:f,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vi,lastRenderedState:f},next:null},a.memoizedState=l,a=a.alternate,a!==null&&(a.memoizedState=l),l}function mx(a){var l=fx(a);l.next===null&&(l=a.alternate.memoizedState),Nl(a,l.next.queue,{},Mn())}function Xh(){return Ws($l)}function gx(){return js().memoizedState}function px(){return js().memoizedState}function ZN(a){for(var l=a.return;l!==null;){switch(l.tag){case 24:case 3:var f=Mn();a=ya(f);var p=va(l,a,f);p!==null&&(bn(p,l,f),vl(p,l,f)),l={cache:Th()},a.payload=l;return}l=l.return}}function ew(a,l,f){var p=Mn();f={lane:p,revertLane:0,gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},Jc(a)?yx(l,f):(f=gh(a,l,f,p),f!==null&&(bn(f,a,p),vx(f,l,p)))}function xx(a,l,f){var p=Mn();Nl(a,l,f,p)}function Nl(a,l,f,p){var _={lane:p,revertLane:0,gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null};if(Jc(a))yx(l,_);else{var w=a.alternate;if(a.lanes===0&&(w===null||w.lanes===0)&&(w=l.lastRenderedReducer,w!==null))try{var U=l.lastRenderedState,W=w(U,f);if(_.hasEagerState=!0,_.eagerState=W,Cn(W,U))return kc(a,l,_,0),is===null&&Lc(),!1}catch{}finally{}if(f=gh(a,l,_,p),f!==null)return bn(f,a,p),vx(f,l,p),!0}return!1}function Jh(a,l,f,p){if(p={lane:2,revertLane:Lf(),gesture:null,action:p,hasEagerState:!1,eagerState:null,next:null},Jc(a)){if(l)throw Error(n(479))}else l=gh(a,f,p,2),l!==null&&bn(l,a,2)}function Jc(a){var l=a.alternate;return a===Nt||l!==null&&l===Nt}function yx(a,l){oo=Kc=!0;var f=a.pending;f===null?l.next=l:(l.next=f.next,f.next=l),a.pending=l}function vx(a,l,f){if((f&4194048)!==0){var p=l.lanes;p&=a.pendingLanes,f|=p,l.lanes=f,Hn(a,f)}}var wl={readContext:Ws,use:Yc,useCallback:Ss,useContext:Ss,useEffect:Ss,useImperativeHandle:Ss,useLayoutEffect:Ss,useInsertionEffect:Ss,useMemo:Ss,useReducer:Ss,useRef:Ss,useState:Ss,useDebugValue:Ss,useDeferredValue:Ss,useTransition:Ss,useSyncExternalStore:Ss,useId:Ss,useHostTransitionStatus:Ss,useFormState:Ss,useActionState:Ss,useOptimistic:Ss,useMemoCache:Ss,useCacheRefresh:Ss};wl.useEffectEvent=Ss;var bx={readContext:Ws,use:Yc,useCallback:function(a,l){return dn().memoizedState=[a,l===void 0?null:l],a},useContext:Ws,useEffect:nx,useImperativeHandle:function(a,l,f){f=f!=null?f.concat([a]):null,Qc(4194308,4,ox.bind(null,l,a),f)},useLayoutEffect:function(a,l){return Qc(4194308,4,a,l)},useInsertionEffect:function(a,l){Qc(4,2,a,l)},useMemo:function(a,l){var f=dn();l=l===void 0?null:l;var p=a();if(hr){It(!0);try{a()}finally{It(!1)}}return f.memoizedState=[p,l],p},useReducer:function(a,l,f){var p=dn();if(f!==void 0){var _=f(l);if(hr){It(!0);try{f(l)}finally{It(!1)}}}else _=l;return p.memoizedState=p.baseState=_,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:_},p.queue=a,a=a.dispatch=ew.bind(null,Nt,a),[p.memoizedState,a]},useRef:function(a){var l=dn();return a={current:a},l.memoizedState=a},useState:function(a){a=Kh(a);var l=a.queue,f=xx.bind(null,Nt,l);return l.dispatch=f,[a.memoizedState,f]},useDebugValue:Yh,useDeferredValue:function(a,l){var f=dn();return Wh(f,a,l)},useTransition:function(){var a=Kh(!1);return a=hx.bind(null,Nt,a.queue,!0,!1),dn().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,l,f){var p=Nt,_=dn();if(Ut){if(f===void 0)throw Error(n(407));f=f()}else{if(f=l(),is===null)throw Error(n(349));(Mt&127)!==0||$p(p,l,f)}_.memoizedState=f;var w={value:f,getSnapshot:l};return _.queue=w,nx(Vp.bind(null,p,w,a),[a]),p.flags|=2048,co(9,{destroy:void 0},Gp.bind(null,p,w,f,l),null),f},useId:function(){var a=dn(),l=is.identifierPrefix;if(Ut){var f=vi,p=yi;f=(p&~(1<<32-bs(p)-1)).toString(32)+f,l="_"+l+"R_"+f,f=qc++,0<f&&(l+="H"+f.toString(32)),l+="_"}else f=zN++,l="_"+l+"r_"+f.toString(32)+"_";return a.memoizedState=l},useHostTransitionStatus:Xh,useFormState:Jp,useActionState:Jp,useOptimistic:function(a){var l=dn();l.memoizedState=l.baseState=a;var f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return l.queue=f,l=Jh.bind(null,Nt,!0,f),f.dispatch=l,[a,l]},useMemoCache:Gh,useCacheRefresh:function(){return dn().memoizedState=ZN.bind(null,Nt)},useEffectEvent:function(a){var l=dn(),f={impl:a};return l.memoizedState=f,function(){if((Kt&2)!==0)throw Error(n(440));return f.impl.apply(void 0,arguments)}}},Zh={readContext:Ws,use:Yc,useCallback:cx,useContext:Ws,useEffect:zh,useImperativeHandle:lx,useInsertionEffect:ax,useLayoutEffect:rx,useMemo:dx,useReducer:Wc,useRef:sx,useState:function(){return Wc(Vi)},useDebugValue:Yh,useDeferredValue:function(a,l){var f=js();return ux(f,Jt.memoizedState,a,l)},useTransition:function(){var a=Wc(Vi)[0],l=js().memoizedState;return[typeof a=="boolean"?a:El(a),l]},useSyncExternalStore:Fp,useId:gx,useHostTransitionStatus:Xh,useFormState:Zp,useActionState:Zp,useOptimistic:function(a,l){var f=js();return qp(f,Jt,a,l)},useMemoCache:Gh,useCacheRefresh:px};Zh.useEffectEvent=ix;var _x={readContext:Ws,use:Yc,useCallback:cx,useContext:Ws,useEffect:zh,useImperativeHandle:lx,useInsertionEffect:ax,useLayoutEffect:rx,useMemo:dx,useReducer:Hh,useRef:sx,useState:function(){return Hh(Vi)},useDebugValue:Yh,useDeferredValue:function(a,l){var f=js();return Jt===null?Wh(f,a,l):ux(f,Jt.memoizedState,a,l)},useTransition:function(){var a=Hh(Vi)[0],l=js().memoizedState;return[typeof a=="boolean"?a:El(a),l]},useSyncExternalStore:Fp,useId:gx,useHostTransitionStatus:Xh,useFormState:tx,useActionState:tx,useOptimistic:function(a,l){var f=js();return Jt!==null?qp(f,Jt,a,l):(f.baseState=a,[a,f.queue.dispatch])},useMemoCache:Gh,useCacheRefresh:px};_x.useEffectEvent=ix;function ef(a,l,f,p){l=a.memoizedState,f=f(p,l),f=f==null?l:g({},l,f),a.memoizedState=f,a.lanes===0&&(a.updateQueue.baseState=f)}var tf={enqueueSetState:function(a,l,f){a=a._reactInternals;var p=Mn(),_=ya(p);_.payload=l,f!=null&&(_.callback=f),l=va(a,_,p),l!==null&&(bn(l,a,p),vl(l,a,p))},enqueueReplaceState:function(a,l,f){a=a._reactInternals;var p=Mn(),_=ya(p);_.tag=1,_.payload=l,f!=null&&(_.callback=f),l=va(a,_,p),l!==null&&(bn(l,a,p),vl(l,a,p))},enqueueForceUpdate:function(a,l){a=a._reactInternals;var f=Mn(),p=ya(f);p.tag=2,l!=null&&(p.callback=l),l=va(a,p,f),l!==null&&(bn(l,a,f),vl(l,a,f))}};function Sx(a,l,f,p,_,w,U){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(p,w,U):l.prototype&&l.prototype.isPureReactComponent?!ul(f,p)||!ul(_,w):!0}function Ex(a,l,f,p){a=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(f,p),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(f,p),l.state!==a&&tf.enqueueReplaceState(l,l.state,null)}function fr(a,l){var f=l;if("ref"in l){f={};for(var p in l)p!=="ref"&&(f[p]=l[p])}if(a=a.defaultProps){f===l&&(f=g({},f));for(var _ in a)f[_]===void 0&&(f[_]=a[_])}return f}function Nx(a){Rc(a)}function wx(a){console.error(a)}function Tx(a){Rc(a)}function Zc(a,l){try{var f=a.onUncaughtError;f(l.value,{componentStack:l.stack})}catch(p){setTimeout(function(){throw p})}}function Ax(a,l,f){try{var p=a.onCaughtError;p(f.value,{componentStack:f.stack,errorBoundary:l.tag===1?l.stateNode:null})}catch(_){setTimeout(function(){throw _})}}function sf(a,l,f){return f=ya(f),f.tag=3,f.payload={element:null},f.callback=function(){Zc(a,l)},f}function jx(a){return a=ya(a),a.tag=3,a}function Cx(a,l,f,p){var _=f.type.getDerivedStateFromError;if(typeof _=="function"){var w=p.value;a.payload=function(){return _(w)},a.callback=function(){Ax(l,f,p)}}var U=f.stateNode;U!==null&&typeof U.componentDidCatch=="function"&&(a.callback=function(){Ax(l,f,p),typeof _!="function"&&(wa===null?wa=new Set([this]):wa.add(this));var W=p.stack;this.componentDidCatch(p.value,{componentStack:W!==null?W:""})})}function tw(a,l,f,p,_){if(f.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(l=f.alternate,l!==null&&to(l,f,_,!0),f=Ln.current,f!==null){switch(f.tag){case 31:case 13:return Jn===null?ud():f.alternate===null&&Es===0&&(Es=3),f.flags&=-257,f.flags|=65536,f.lanes=_,p===Fc?f.flags|=16384:(l=f.updateQueue,l===null?f.updateQueue=new Set([p]):l.add(p),jf(a,p,_)),!1;case 22:return f.flags|=65536,p===Fc?f.flags|=16384:(l=f.updateQueue,l===null?(l={transitions:null,markerInstances:null,retryQueue:new Set([p])},f.updateQueue=l):(f=l.retryQueue,f===null?l.retryQueue=new Set([p]):f.add(p)),jf(a,p,_)),!1}throw Error(n(435,f.tag))}return jf(a,p,_),ud(),!1}if(Ut)return l=Ln.current,l!==null?((l.flags&65536)===0&&(l.flags|=256),l.flags|=65536,l.lanes=_,p!==_h&&(a=Error(n(422),{cause:p}),ml(Yn(a,f)))):(p!==_h&&(l=Error(n(423),{cause:p}),ml(Yn(l,f))),a=a.current.alternate,a.flags|=65536,_&=-_,a.lanes|=_,p=Yn(p,f),_=sf(a.stateNode,p,_),kh(a,_),Es!==4&&(Es=2)),!1;var w=Error(n(520),{cause:p});if(w=Yn(w,f),Dl===null?Dl=[w]:Dl.push(w),Es!==4&&(Es=2),l===null)return!0;p=Yn(p,f),f=l;do{switch(f.tag){case 3:return f.flags|=65536,a=_&-_,f.lanes|=a,a=sf(f.stateNode,p,a),kh(f,a),!1;case 1:if(l=f.type,w=f.stateNode,(f.flags&128)===0&&(typeof l.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(wa===null||!wa.has(w))))return f.flags|=65536,_&=-_,f.lanes|=_,_=jx(_),Cx(_,a,f,p),kh(f,_),!1}f=f.return}while(f!==null);return!1}var nf=Error(n(461)),Is=!1;function Qs(a,l,f,p){l.child=a===null?Dp(l,null,f,p):ur(l,a.child,f,p)}function Rx(a,l,f,p,_){f=f.render;var w=l.ref;if("ref"in p){var U={};for(var W in p)W!=="ref"&&(U[W]=p[W])}else U=p;return or(l),p=Bh(a,l,f,U,w,_),W=Uh(),a!==null&&!Is?(Fh(a,l,_),Hi(a,l,_)):(Ut&&W&&vh(l),l.flags|=1,Qs(a,l,p,_),l.child)}function Lx(a,l,f,p,_){if(a===null){var w=f.type;return typeof w=="function"&&!ph(w)&&w.defaultProps===void 0&&f.compare===null?(l.tag=15,l.type=w,kx(a,l,w,p,_)):(a=Ic(f.type,null,p,l,l.mode,_),a.ref=l.ref,a.return=l,l.child=a)}if(w=a.child,!hf(a,_)){var U=w.memoizedProps;if(f=f.compare,f=f!==null?f:ul,f(U,p)&&a.ref===l.ref)return Hi(a,l,_)}return l.flags|=1,a=Bi(w,p),a.ref=l.ref,a.return=l,l.child=a}function kx(a,l,f,p,_){if(a!==null){var w=a.memoizedProps;if(ul(w,p)&&a.ref===l.ref)if(Is=!1,l.pendingProps=p=w,hf(a,_))(a.flags&131072)!==0&&(Is=!0);else return l.lanes=a.lanes,Hi(a,l,_)}return af(a,l,f,p,_)}function Dx(a,l,f,p){var _=p.children,w=a!==null?a.memoizedState:null;if(a===null&&l.stateNode===null&&(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),p.mode==="hidden"){if((l.flags&128)!==0){if(w=w!==null?w.baseLanes|f:f,a!==null){for(p=l.child=a.child,_=0;p!==null;)_=_|p.lanes|p.childLanes,p=p.sibling;p=_&~w}else p=0,l.child=null;return Ix(a,l,w,f,p)}if((f&536870912)!==0)l.memoizedState={baseLanes:0,cachePool:null},a!==null&&Bc(l,w!==null?w.cachePool:null),w!==null?Op(l,w):Ih(),Pp(l);else return p=l.lanes=536870912,Ix(a,l,w!==null?w.baseLanes|f:f,f,p)}else w!==null?(Bc(l,w.cachePool),Op(l,w),_a(),l.memoizedState=null):(a!==null&&Bc(l,null),Ih(),_a());return Qs(a,l,_,f),l.child}function Tl(a,l){return a!==null&&a.tag===22||l.stateNode!==null||(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),l.sibling}function Ix(a,l,f,p,_){var w=jh();return w=w===null?null:{parent:ks._currentValue,pool:w},l.memoizedState={baseLanes:f,cachePool:w},a!==null&&Bc(l,null),Ih(),Pp(l),a!==null&&to(a,l,p,!0),l.childLanes=_,null}function ed(a,l){return l=sd({mode:l.mode,children:l.children},a.mode),l.ref=a.ref,a.child=l,l.return=a,l}function Mx(a,l,f){return ur(l,a.child,null,f),a=ed(l,l.pendingProps),a.flags|=2,kn(l),l.memoizedState=null,a}function sw(a,l,f){var p=l.pendingProps,_=(l.flags&128)!==0;if(l.flags&=-129,a===null){if(Ut){if(p.mode==="hidden")return a=ed(l,p),l.lanes=536870912,Tl(null,a);if(Oh(l),(a=cs)?(a=zy(a,Xn),a=a!==null&&a.data==="&"?a:null,a!==null&&(l.memoizedState={dehydrated:a,treeContext:fa!==null?{id:yi,overflow:vi}:null,retryLane:536870912,hydrationErrors:null},f=yp(a),f.return=l,l.child=f,Ys=l,cs=null)):a=null,a===null)throw ga(l);return l.lanes=536870912,null}return ed(l,p)}var w=a.memoizedState;if(w!==null){var U=w.dehydrated;if(Oh(l),_)if(l.flags&256)l.flags&=-257,l=Mx(a,l,f);else if(l.memoizedState!==null)l.child=a.child,l.flags|=128,l=null;else throw Error(n(558));else if(Is||to(a,l,f,!1),_=(f&a.childLanes)!==0,Is||_){if(p=is,p!==null&&(U=tl(p,f),U!==0&&U!==w.retryLane))throw w.retryLane=U,nr(a,U),bn(p,a,U),nf;ud(),l=Mx(a,l,f)}else a=w.treeContext,cs=Zn(U.nextSibling),Ys=l,Ut=!0,ma=null,Xn=!1,a!==null&&_p(l,a),l=ed(l,p),l.flags|=4096;return l}return a=Bi(a.child,{mode:p.mode,children:p.children}),a.ref=l.ref,l.child=a,a.return=l,a}function td(a,l){var f=l.ref;if(f===null)a!==null&&a.ref!==null&&(l.flags|=4194816);else{if(typeof f!="function"&&typeof f!="object")throw Error(n(284));(a===null||a.ref!==f)&&(l.flags|=4194816)}}function af(a,l,f,p,_){return or(l),f=Bh(a,l,f,p,void 0,_),p=Uh(),a!==null&&!Is?(Fh(a,l,_),Hi(a,l,_)):(Ut&&p&&vh(l),l.flags|=1,Qs(a,l,f,_),l.child)}function Ox(a,l,f,p,_,w){return or(l),l.updateQueue=null,f=Up(l,p,f,_),Bp(a),p=Uh(),a!==null&&!Is?(Fh(a,l,w),Hi(a,l,w)):(Ut&&p&&vh(l),l.flags|=1,Qs(a,l,f,w),l.child)}function Px(a,l,f,p,_){if(or(l),l.stateNode===null){var w=Xr,U=f.contextType;typeof U=="object"&&U!==null&&(w=Ws(U)),w=new f(p,w),l.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=tf,l.stateNode=w,w._reactInternals=l,w=l.stateNode,w.props=p,w.state=l.memoizedState,w.refs={},Rh(l),U=f.contextType,w.context=typeof U=="object"&&U!==null?Ws(U):Xr,w.state=l.memoizedState,U=f.getDerivedStateFromProps,typeof U=="function"&&(ef(l,f,U,p),w.state=l.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(U=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),U!==w.state&&tf.enqueueReplaceState(w,w.state,null),_l(l,p,w,_),bl(),w.state=l.memoizedState),typeof w.componentDidMount=="function"&&(l.flags|=4194308),p=!0}else if(a===null){w=l.stateNode;var W=l.memoizedProps,ue=fr(f,W);w.props=ue;var Ne=w.context,Ie=f.contextType;U=Xr,typeof Ie=="object"&&Ie!==null&&(U=Ws(Ie));var Be=f.getDerivedStateFromProps;Ie=typeof Be=="function"||typeof w.getSnapshotBeforeUpdate=="function",W=l.pendingProps!==W,Ie||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(W||Ne!==U)&&Ex(l,w,p,U),xa=!1;var Ae=l.memoizedState;w.state=Ae,_l(l,p,w,_),bl(),Ne=l.memoizedState,W||Ae!==Ne||xa?(typeof Be=="function"&&(ef(l,f,Be,p),Ne=l.memoizedState),(ue=xa||Sx(l,f,ue,p,Ae,Ne,U))?(Ie||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(l.flags|=4194308)):(typeof w.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=p,l.memoizedState=Ne),w.props=p,w.state=Ne,w.context=U,p=ue):(typeof w.componentDidMount=="function"&&(l.flags|=4194308),p=!1)}else{w=l.stateNode,Lh(a,l),U=l.memoizedProps,Ie=fr(f,U),w.props=Ie,Be=l.pendingProps,Ae=w.context,Ne=f.contextType,ue=Xr,typeof Ne=="object"&&Ne!==null&&(ue=Ws(Ne)),W=f.getDerivedStateFromProps,(Ne=typeof W=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(U!==Be||Ae!==ue)&&Ex(l,w,p,ue),xa=!1,Ae=l.memoizedState,w.state=Ae,_l(l,p,w,_),bl();var Le=l.memoizedState;U!==Be||Ae!==Le||xa||a!==null&&a.dependencies!==null&&Oc(a.dependencies)?(typeof W=="function"&&(ef(l,f,W,p),Le=l.memoizedState),(Ie=xa||Sx(l,f,Ie,p,Ae,Le,ue)||a!==null&&a.dependencies!==null&&Oc(a.dependencies))?(Ne||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(p,Le,ue),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(p,Le,ue)),typeof w.componentDidUpdate=="function"&&(l.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof w.componentDidUpdate!="function"||U===a.memoizedProps&&Ae===a.memoizedState||(l.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||U===a.memoizedProps&&Ae===a.memoizedState||(l.flags|=1024),l.memoizedProps=p,l.memoizedState=Le),w.props=p,w.state=Le,w.context=ue,p=Ie):(typeof w.componentDidUpdate!="function"||U===a.memoizedProps&&Ae===a.memoizedState||(l.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||U===a.memoizedProps&&Ae===a.memoizedState||(l.flags|=1024),p=!1)}return w=p,td(a,l),p=(l.flags&128)!==0,w||p?(w=l.stateNode,f=p&&typeof f.getDerivedStateFromError!="function"?null:w.render(),l.flags|=1,a!==null&&p?(l.child=ur(l,a.child,null,_),l.child=ur(l,null,f,_)):Qs(a,l,f,_),l.memoizedState=w.state,a=l.child):a=Hi(a,l,_),a}function Bx(a,l,f,p){return ar(),l.flags|=256,Qs(a,l,f,p),l.child}var rf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function of(a){return{baseLanes:a,cachePool:Ap()}}function lf(a,l,f){return a=a!==null?a.childLanes&~f:0,l&&(a|=In),a}function Ux(a,l,f){var p=l.pendingProps,_=!1,w=(l.flags&128)!==0,U;if((U=w)||(U=a!==null&&a.memoizedState===null?!1:(As.current&2)!==0),U&&(_=!0,l.flags&=-129),U=(l.flags&32)!==0,l.flags&=-33,a===null){if(Ut){if(_?ba(l):_a(),(a=cs)?(a=zy(a,Xn),a=a!==null&&a.data!=="&"?a:null,a!==null&&(l.memoizedState={dehydrated:a,treeContext:fa!==null?{id:yi,overflow:vi}:null,retryLane:536870912,hydrationErrors:null},f=yp(a),f.return=l,l.child=f,Ys=l,cs=null)):a=null,a===null)throw ga(l);return Hf(a)?l.lanes=32:l.lanes=536870912,null}var W=p.children;return p=p.fallback,_?(_a(),_=l.mode,W=sd({mode:"hidden",children:W},_),p=ir(p,_,f,null),W.return=l,p.return=l,W.sibling=p,l.child=W,p=l.child,p.memoizedState=of(f),p.childLanes=lf(a,U,f),l.memoizedState=rf,Tl(null,p)):(ba(l),cf(l,W))}var ue=a.memoizedState;if(ue!==null&&(W=ue.dehydrated,W!==null)){if(w)l.flags&256?(ba(l),l.flags&=-257,l=df(a,l,f)):l.memoizedState!==null?(_a(),l.child=a.child,l.flags|=128,l=null):(_a(),W=p.fallback,_=l.mode,p=sd({mode:"visible",children:p.children},_),W=ir(W,_,f,null),W.flags|=2,p.return=l,W.return=l,p.sibling=W,l.child=p,ur(l,a.child,null,f),p=l.child,p.memoizedState=of(f),p.childLanes=lf(a,U,f),l.memoizedState=rf,l=Tl(null,p));else if(ba(l),Hf(W)){if(U=W.nextSibling&&W.nextSibling.dataset,U)var Ne=U.dgst;U=Ne,p=Error(n(419)),p.stack="",p.digest=U,ml({value:p,source:null,stack:null}),l=df(a,l,f)}else if(Is||to(a,l,f,!1),U=(f&a.childLanes)!==0,Is||U){if(U=is,U!==null&&(p=tl(U,f),p!==0&&p!==ue.retryLane))throw ue.retryLane=p,nr(a,p),bn(U,a,p),nf;Vf(W)||ud(),l=df(a,l,f)}else Vf(W)?(l.flags|=192,l.child=a.child,l=null):(a=ue.treeContext,cs=Zn(W.nextSibling),Ys=l,Ut=!0,ma=null,Xn=!1,a!==null&&_p(l,a),l=cf(l,p.children),l.flags|=4096);return l}return _?(_a(),W=p.fallback,_=l.mode,ue=a.child,Ne=ue.sibling,p=Bi(ue,{mode:"hidden",children:p.children}),p.subtreeFlags=ue.subtreeFlags&65011712,Ne!==null?W=Bi(Ne,W):(W=ir(W,_,f,null),W.flags|=2),W.return=l,p.return=l,p.sibling=W,l.child=p,Tl(null,p),p=l.child,W=a.child.memoizedState,W===null?W=of(f):(_=W.cachePool,_!==null?(ue=ks._currentValue,_=_.parent!==ue?{parent:ue,pool:ue}:_):_=Ap(),W={baseLanes:W.baseLanes|f,cachePool:_}),p.memoizedState=W,p.childLanes=lf(a,U,f),l.memoizedState=rf,Tl(a.child,p)):(ba(l),f=a.child,a=f.sibling,f=Bi(f,{mode:"visible",children:p.children}),f.return=l,f.sibling=null,a!==null&&(U=l.deletions,U===null?(l.deletions=[a],l.flags|=16):U.push(a)),l.child=f,l.memoizedState=null,f)}function cf(a,l){return l=sd({mode:"visible",children:l},a.mode),l.return=a,a.child=l}function sd(a,l){return a=Rn(22,a,null,l),a.lanes=0,a}function df(a,l,f){return ur(l,a.child,null,f),a=cf(l,l.pendingProps.children),a.flags|=2,l.memoizedState=null,a}function Fx(a,l,f){a.lanes|=l;var p=a.alternate;p!==null&&(p.lanes|=l),Nh(a.return,l,f)}function uf(a,l,f,p,_,w){var U=a.memoizedState;U===null?a.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:p,tail:f,tailMode:_,treeForkCount:w}:(U.isBackwards=l,U.rendering=null,U.renderingStartTime=0,U.last=p,U.tail=f,U.tailMode=_,U.treeForkCount=w)}function $x(a,l,f){var p=l.pendingProps,_=p.revealOrder,w=p.tail;p=p.children;var U=As.current,W=(U&2)!==0;if(W?(U=U&1|2,l.flags|=128):U&=1,oe(As,U),Qs(a,l,p,f),p=Ut?fl:0,!W&&a!==null&&(a.flags&128)!==0)e:for(a=l.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Fx(a,f,l);else if(a.tag===19)Fx(a,f,l);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===l)break e;for(;a.sibling===null;){if(a.return===null||a.return===l)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(_){case"forwards":for(f=l.child,_=null;f!==null;)a=f.alternate,a!==null&&Hc(a)===null&&(_=f),f=f.sibling;f=_,f===null?(_=l.child,l.child=null):(_=f.sibling,f.sibling=null),uf(l,!1,_,f,w,p);break;case"backwards":case"unstable_legacy-backwards":for(f=null,_=l.child,l.child=null;_!==null;){if(a=_.alternate,a!==null&&Hc(a)===null){l.child=_;break}a=_.sibling,_.sibling=f,f=_,_=a}uf(l,!0,f,null,w,p);break;case"together":uf(l,!1,null,null,void 0,p);break;default:l.memoizedState=null}return l.child}function Hi(a,l,f){if(a!==null&&(l.dependencies=a.dependencies),Na|=l.lanes,(f&l.childLanes)===0)if(a!==null){if(to(a,l,f,!1),(f&l.childLanes)===0)return null}else return null;if(a!==null&&l.child!==a.child)throw Error(n(153));if(l.child!==null){for(a=l.child,f=Bi(a,a.pendingProps),l.child=f,f.return=l;a.sibling!==null;)a=a.sibling,f=f.sibling=Bi(a,a.pendingProps),f.return=l;f.sibling=null}return l.child}function hf(a,l){return(a.lanes&l)!==0?!0:(a=a.dependencies,!!(a!==null&&Oc(a)))}function nw(a,l,f){switch(l.tag){case 3:re(l,l.stateNode.containerInfo),pa(l,ks,a.memoizedState.cache),ar();break;case 27:case 5:Fe(l);break;case 4:re(l,l.stateNode.containerInfo);break;case 10:pa(l,l.type,l.memoizedProps.value);break;case 31:if(l.memoizedState!==null)return l.flags|=128,Oh(l),null;break;case 13:var p=l.memoizedState;if(p!==null)return p.dehydrated!==null?(ba(l),l.flags|=128,null):(f&l.child.childLanes)!==0?Ux(a,l,f):(ba(l),a=Hi(a,l,f),a!==null?a.sibling:null);ba(l);break;case 19:var _=(a.flags&128)!==0;if(p=(f&l.childLanes)!==0,p||(to(a,l,f,!1),p=(f&l.childLanes)!==0),_){if(p)return $x(a,l,f);l.flags|=128}if(_=l.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),oe(As,As.current),p)break;return null;case 22:return l.lanes=0,Dx(a,l,f,l.pendingProps);case 24:pa(l,ks,a.memoizedState.cache)}return Hi(a,l,f)}function Gx(a,l,f){if(a!==null)if(a.memoizedProps!==l.pendingProps)Is=!0;else{if(!hf(a,f)&&(l.flags&128)===0)return Is=!1,nw(a,l,f);Is=(a.flags&131072)!==0}else Is=!1,Ut&&(l.flags&1048576)!==0&&bp(l,fl,l.index);switch(l.lanes=0,l.tag){case 16:e:{var p=l.pendingProps;if(a=cr(l.elementType),l.type=a,typeof a=="function")ph(a)?(p=fr(a,p),l.tag=1,l=Px(null,l,a,p,f)):(l.tag=0,l=af(null,l,a,p,f));else{if(a!=null){var _=a.$$typeof;if(_===D){l.tag=11,l=Rx(null,l,a,p,f);break e}else if(_===B){l.tag=14,l=Lx(null,l,a,p,f);break e}}throw l=ne(a)||a,Error(n(306,l,""))}}return l;case 0:return af(a,l,l.type,l.pendingProps,f);case 1:return p=l.type,_=fr(p,l.pendingProps),Px(a,l,p,_,f);case 3:e:{if(re(l,l.stateNode.containerInfo),a===null)throw Error(n(387));p=l.pendingProps;var w=l.memoizedState;_=w.element,Lh(a,l),_l(l,p,null,f);var U=l.memoizedState;if(p=U.cache,pa(l,ks,p),p!==w.cache&&wh(l,[ks],f,!0),bl(),p=U.element,w.isDehydrated)if(w={element:p,isDehydrated:!1,cache:U.cache},l.updateQueue.baseState=w,l.memoizedState=w,l.flags&256){l=Bx(a,l,p,f);break e}else if(p!==_){_=Yn(Error(n(424)),l),ml(_),l=Bx(a,l,p,f);break e}else{switch(a=l.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(cs=Zn(a.firstChild),Ys=l,Ut=!0,ma=null,Xn=!0,f=Dp(l,null,p,f),l.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling}else{if(ar(),p===_){l=Hi(a,l,f);break e}Qs(a,l,p,f)}l=l.child}return l;case 26:return td(a,l),a===null?(f=Zy(l.type,null,l.pendingProps,null))?l.memoizedState=f:Ut||(f=l.type,a=l.pendingProps,p=yd(pe.current).createElement(f),p[E]=l,p[b]=a,Xs(p,f,a),De(p),l.stateNode=p):l.memoizedState=Zy(l.type,a.memoizedProps,l.pendingProps,a.memoizedState),null;case 27:return Fe(l),a===null&&Ut&&(p=l.stateNode=Qy(l.type,l.pendingProps,pe.current),Ys=l,Xn=!0,_=cs,Ca(l.type)?(Kf=_,cs=Zn(p.firstChild)):cs=_),Qs(a,l,l.pendingProps.children,f),td(a,l),a===null&&(l.flags|=4194304),l.child;case 5:return a===null&&Ut&&((_=p=cs)&&(p=Dw(p,l.type,l.pendingProps,Xn),p!==null?(l.stateNode=p,Ys=l,cs=Zn(p.firstChild),Xn=!1,_=!0):_=!1),_||ga(l)),Fe(l),_=l.type,w=l.pendingProps,U=a!==null?a.memoizedProps:null,p=w.children,Ff(_,w)?p=null:U!==null&&Ff(_,U)&&(l.flags|=32),l.memoizedState!==null&&(_=Bh(a,l,YN,null,null,f),$l._currentValue=_),td(a,l),Qs(a,l,p,f),l.child;case 6:return a===null&&Ut&&((a=f=cs)&&(f=Iw(f,l.pendingProps,Xn),f!==null?(l.stateNode=f,Ys=l,cs=null,a=!0):a=!1),a||ga(l)),null;case 13:return Ux(a,l,f);case 4:return re(l,l.stateNode.containerInfo),p=l.pendingProps,a===null?l.child=ur(l,null,p,f):Qs(a,l,p,f),l.child;case 11:return Rx(a,l,l.type,l.pendingProps,f);case 7:return Qs(a,l,l.pendingProps,f),l.child;case 8:return Qs(a,l,l.pendingProps.children,f),l.child;case 12:return Qs(a,l,l.pendingProps.children,f),l.child;case 10:return p=l.pendingProps,pa(l,l.type,p.value),Qs(a,l,p.children,f),l.child;case 9:return _=l.type._context,p=l.pendingProps.children,or(l),_=Ws(_),p=p(_),l.flags|=1,Qs(a,l,p,f),l.child;case 14:return Lx(a,l,l.type,l.pendingProps,f);case 15:return kx(a,l,l.type,l.pendingProps,f);case 19:return $x(a,l,f);case 31:return sw(a,l,f);case 22:return Dx(a,l,f,l.pendingProps);case 24:return or(l),p=Ws(ks),a===null?(_=jh(),_===null&&(_=is,w=Th(),_.pooledCache=w,w.refCount++,w!==null&&(_.pooledCacheLanes|=f),_=w),l.memoizedState={parent:p,cache:_},Rh(l),pa(l,ks,_)):((a.lanes&f)!==0&&(Lh(a,l),_l(l,null,null,f),bl()),_=a.memoizedState,w=l.memoizedState,_.parent!==p?(_={parent:p,cache:p},l.memoizedState=_,l.lanes===0&&(l.memoizedState=l.updateQueue.baseState=_),pa(l,ks,p)):(p=w.cache,pa(l,ks,p),p!==_.cache&&wh(l,[ks],f,!0))),Qs(a,l,l.pendingProps.children,f),l.child;case 29:throw l.pendingProps}throw Error(n(156,l.tag))}function Ki(a){a.flags|=4}function ff(a,l,f,p,_){if((l=(a.mode&32)!==0)&&(l=!1),l){if(a.flags|=16777216,(_&335544128)===_)if(a.stateNode.complete)a.flags|=8192;else if(gy())a.flags|=8192;else throw dr=Fc,Ch}else a.flags&=-16777217}function Vx(a,l){if(l.type!=="stylesheet"||(l.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!iv(l))if(gy())a.flags|=8192;else throw dr=Fc,Ch}function nd(a,l){l!==null&&(a.flags|=4),a.flags&16384&&(l=a.tag!==22?Zo():536870912,a.lanes|=l,mo|=l)}function Al(a,l){if(!Ut)switch(a.tailMode){case"hidden":l=a.tail;for(var f=null;l!==null;)l.alternate!==null&&(f=l),l=l.sibling;f===null?a.tail=null:f.sibling=null;break;case"collapsed":f=a.tail;for(var p=null;f!==null;)f.alternate!==null&&(p=f),f=f.sibling;p===null?l||a.tail===null?a.tail=null:a.tail.sibling=null:p.sibling=null}}function ds(a){var l=a.alternate!==null&&a.alternate.child===a.child,f=0,p=0;if(l)for(var _=a.child;_!==null;)f|=_.lanes|_.childLanes,p|=_.subtreeFlags&65011712,p|=_.flags&65011712,_.return=a,_=_.sibling;else for(_=a.child;_!==null;)f|=_.lanes|_.childLanes,p|=_.subtreeFlags,p|=_.flags,_.return=a,_=_.sibling;return a.subtreeFlags|=p,a.childLanes=f,l}function iw(a,l,f){var p=l.pendingProps;switch(bh(l),l.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ds(l),null;case 1:return ds(l),null;case 3:return f=l.stateNode,p=null,a!==null&&(p=a.memoizedState.cache),l.memoizedState.cache!==p&&(l.flags|=2048),$i(ks),je(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(a===null||a.child===null)&&(eo(l)?Ki(l):a===null||a.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,Sh())),ds(l),null;case 26:var _=l.type,w=l.memoizedState;return a===null?(Ki(l),w!==null?(ds(l),Vx(l,w)):(ds(l),ff(l,_,null,p,f))):w?w!==a.memoizedState?(Ki(l),ds(l),Vx(l,w)):(ds(l),l.flags&=-16777217):(a=a.memoizedProps,a!==p&&Ki(l),ds(l),ff(l,_,a,p,f)),null;case 27:if(We(l),f=pe.current,_=l.type,a!==null&&l.stateNode!=null)a.memoizedProps!==p&&Ki(l);else{if(!p){if(l.stateNode===null)throw Error(n(166));return ds(l),null}a=ye.current,eo(l)?Sp(l):(a=Qy(_,p,f),l.stateNode=a,Ki(l))}return ds(l),null;case 5:if(We(l),_=l.type,a!==null&&l.stateNode!=null)a.memoizedProps!==p&&Ki(l);else{if(!p){if(l.stateNode===null)throw Error(n(166));return ds(l),null}if(w=ye.current,eo(l))Sp(l);else{var U=yd(pe.current);switch(w){case 1:w=U.createElementNS("http://www.w3.org/2000/svg",_);break;case 2:w=U.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;default:switch(_){case"svg":w=U.createElementNS("http://www.w3.org/2000/svg",_);break;case"math":w=U.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;case"script":w=U.createElement("div"),w.innerHTML="<script><\/script>",w=w.removeChild(w.firstChild);break;case"select":w=typeof p.is=="string"?U.createElement("select",{is:p.is}):U.createElement("select"),p.multiple?w.multiple=!0:p.size&&(w.size=p.size);break;default:w=typeof p.is=="string"?U.createElement(_,{is:p.is}):U.createElement(_)}}w[E]=l,w[b]=p;e:for(U=l.child;U!==null;){if(U.tag===5||U.tag===6)w.appendChild(U.stateNode);else if(U.tag!==4&&U.tag!==27&&U.child!==null){U.child.return=U,U=U.child;continue}if(U===l)break e;for(;U.sibling===null;){if(U.return===null||U.return===l)break e;U=U.return}U.sibling.return=U.return,U=U.sibling}l.stateNode=w;e:switch(Xs(w,_,p),_){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}p&&Ki(l)}}return ds(l),ff(l,l.type,a===null?null:a.memoizedProps,l.pendingProps,f),null;case 6:if(a&&l.stateNode!=null)a.memoizedProps!==p&&Ki(l);else{if(typeof p!="string"&&l.stateNode===null)throw Error(n(166));if(a=pe.current,eo(l)){if(a=l.stateNode,f=l.memoizedProps,p=null,_=Ys,_!==null)switch(_.tag){case 27:case 5:p=_.memoizedProps}a[E]=l,a=!!(a.nodeValue===f||p!==null&&p.suppressHydrationWarning===!0||Uy(a.nodeValue,f)),a||ga(l,!0)}else a=yd(a).createTextNode(p),a[E]=l,l.stateNode=a}return ds(l),null;case 31:if(f=l.memoizedState,a===null||a.memoizedState!==null){if(p=eo(l),f!==null){if(a===null){if(!p)throw Error(n(318));if(a=l.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(557));a[E]=l}else ar(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;ds(l),a=!1}else f=Sh(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=f),a=!0;if(!a)return l.flags&256?(kn(l),l):(kn(l),null);if((l.flags&128)!==0)throw Error(n(558))}return ds(l),null;case 13:if(p=l.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(_=eo(l),p!==null&&p.dehydrated!==null){if(a===null){if(!_)throw Error(n(318));if(_=l.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(n(317));_[E]=l}else ar(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;ds(l),_=!1}else _=Sh(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=_),_=!0;if(!_)return l.flags&256?(kn(l),l):(kn(l),null)}return kn(l),(l.flags&128)!==0?(l.lanes=f,l):(f=p!==null,a=a!==null&&a.memoizedState!==null,f&&(p=l.child,_=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(_=p.alternate.memoizedState.cachePool.pool),w=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(w=p.memoizedState.cachePool.pool),w!==_&&(p.flags|=2048)),f!==a&&f&&(l.child.flags|=8192),nd(l,l.updateQueue),ds(l),null);case 4:return je(),a===null&&Mf(l.stateNode.containerInfo),ds(l),null;case 10:return $i(l.type),ds(l),null;case 19:if(Q(As),p=l.memoizedState,p===null)return ds(l),null;if(_=(l.flags&128)!==0,w=p.rendering,w===null)if(_)Al(p,!1);else{if(Es!==0||a!==null&&(a.flags&128)!==0)for(a=l.child;a!==null;){if(w=Hc(a),w!==null){for(l.flags|=128,Al(p,!1),a=w.updateQueue,l.updateQueue=a,nd(l,a),l.subtreeFlags=0,a=f,f=l.child;f!==null;)xp(f,a),f=f.sibling;return oe(As,As.current&1|2),Ut&&Ui(l,p.treeForkCount),l.child}a=a.sibling}p.tail!==null&&_t()>ld&&(l.flags|=128,_=!0,Al(p,!1),l.lanes=4194304)}else{if(!_)if(a=Hc(w),a!==null){if(l.flags|=128,_=!0,a=a.updateQueue,l.updateQueue=a,nd(l,a),Al(p,!0),p.tail===null&&p.tailMode==="hidden"&&!w.alternate&&!Ut)return ds(l),null}else 2*_t()-p.renderingStartTime>ld&&f!==536870912&&(l.flags|=128,_=!0,Al(p,!1),l.lanes=4194304);p.isBackwards?(w.sibling=l.child,l.child=w):(a=p.last,a!==null?a.sibling=w:l.child=w,p.last=w)}return p.tail!==null?(a=p.tail,p.rendering=a,p.tail=a.sibling,p.renderingStartTime=_t(),a.sibling=null,f=As.current,oe(As,_?f&1|2:f&1),Ut&&Ui(l,p.treeForkCount),a):(ds(l),null);case 22:case 23:return kn(l),Mh(),p=l.memoizedState!==null,a!==null?a.memoizedState!==null!==p&&(l.flags|=8192):p&&(l.flags|=8192),p?(f&536870912)!==0&&(l.flags&128)===0&&(ds(l),l.subtreeFlags&6&&(l.flags|=8192)):ds(l),f=l.updateQueue,f!==null&&nd(l,f.retryQueue),f=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),p=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(p=l.memoizedState.cachePool.pool),p!==f&&(l.flags|=2048),a!==null&&Q(lr),null;case 24:return f=null,a!==null&&(f=a.memoizedState.cache),l.memoizedState.cache!==f&&(l.flags|=2048),$i(ks),ds(l),null;case 25:return null;case 30:return null}throw Error(n(156,l.tag))}function aw(a,l){switch(bh(l),l.tag){case 1:return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 3:return $i(ks),je(),a=l.flags,(a&65536)!==0&&(a&128)===0?(l.flags=a&-65537|128,l):null;case 26:case 27:case 5:return We(l),null;case 31:if(l.memoizedState!==null){if(kn(l),l.alternate===null)throw Error(n(340));ar()}return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 13:if(kn(l),a=l.memoizedState,a!==null&&a.dehydrated!==null){if(l.alternate===null)throw Error(n(340));ar()}return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 19:return Q(As),null;case 4:return je(),null;case 10:return $i(l.type),null;case 22:case 23:return kn(l),Mh(),a!==null&&Q(lr),a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 24:return $i(ks),null;case 25:return null;default:return null}}function Hx(a,l){switch(bh(l),l.tag){case 3:$i(ks),je();break;case 26:case 27:case 5:We(l);break;case 4:je();break;case 31:l.memoizedState!==null&&kn(l);break;case 13:kn(l);break;case 19:Q(As);break;case 10:$i(l.type);break;case 22:case 23:kn(l),Mh(),a!==null&&Q(lr);break;case 24:$i(ks)}}function jl(a,l){try{var f=l.updateQueue,p=f!==null?f.lastEffect:null;if(p!==null){var _=p.next;f=_;do{if((f.tag&a)===a){p=void 0;var w=f.create,U=f.inst;p=w(),U.destroy=p}f=f.next}while(f!==_)}}catch(W){Wt(l,l.return,W)}}function Sa(a,l,f){try{var p=l.updateQueue,_=p!==null?p.lastEffect:null;if(_!==null){var w=_.next;p=w;do{if((p.tag&a)===a){var U=p.inst,W=U.destroy;if(W!==void 0){U.destroy=void 0,_=l;var ue=f,Ne=W;try{Ne()}catch(Ie){Wt(_,ue,Ie)}}}p=p.next}while(p!==w)}}catch(Ie){Wt(l,l.return,Ie)}}function Kx(a){var l=a.updateQueue;if(l!==null){var f=a.stateNode;try{Mp(l,f)}catch(p){Wt(a,a.return,p)}}}function qx(a,l,f){f.props=fr(a.type,a.memoizedProps),f.state=a.memoizedState;try{f.componentWillUnmount()}catch(p){Wt(a,l,p)}}function Cl(a,l){try{var f=a.ref;if(f!==null){switch(a.tag){case 26:case 27:case 5:var p=a.stateNode;break;case 30:p=a.stateNode;break;default:p=a.stateNode}typeof f=="function"?a.refCleanup=f(p):f.current=p}}catch(_){Wt(a,l,_)}}function bi(a,l){var f=a.ref,p=a.refCleanup;if(f!==null)if(typeof p=="function")try{p()}catch(_){Wt(a,l,_)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof f=="function")try{f(null)}catch(_){Wt(a,l,_)}else f.current=null}function zx(a){var l=a.type,f=a.memoizedProps,p=a.stateNode;try{e:switch(l){case"button":case"input":case"select":case"textarea":f.autoFocus&&p.focus();break e;case"img":f.src?p.src=f.src:f.srcSet&&(p.srcset=f.srcSet)}}catch(_){Wt(a,a.return,_)}}function mf(a,l,f){try{var p=a.stateNode;Aw(p,a.type,f,l),p[b]=l}catch(_){Wt(a,a.return,_)}}function Yx(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Ca(a.type)||a.tag===4}function gf(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||Yx(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Ca(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function pf(a,l,f){var p=a.tag;if(p===5||p===6)a=a.stateNode,l?(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f).insertBefore(a,l):(l=f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,l.appendChild(a),f=f._reactRootContainer,f!=null||l.onclick!==null||(l.onclick=jn));else if(p!==4&&(p===27&&Ca(a.type)&&(f=a.stateNode,l=null),a=a.child,a!==null))for(pf(a,l,f),a=a.sibling;a!==null;)pf(a,l,f),a=a.sibling}function id(a,l,f){var p=a.tag;if(p===5||p===6)a=a.stateNode,l?f.insertBefore(a,l):f.appendChild(a);else if(p!==4&&(p===27&&Ca(a.type)&&(f=a.stateNode),a=a.child,a!==null))for(id(a,l,f),a=a.sibling;a!==null;)id(a,l,f),a=a.sibling}function Wx(a){var l=a.stateNode,f=a.memoizedProps;try{for(var p=a.type,_=l.attributes;_.length;)l.removeAttributeNode(_[0]);Xs(l,p,f),l[E]=a,l[b]=f}catch(w){Wt(a,a.return,w)}}var qi=!1,Ms=!1,xf=!1,Qx=typeof WeakSet=="function"?WeakSet:Set,Hs=null;function rw(a,l){if(a=a.containerInfo,Bf=wd,a=lp(a),ch(a)){if("selectionStart"in a)var f={start:a.selectionStart,end:a.selectionEnd};else e:{f=(f=a.ownerDocument)&&f.defaultView||window;var p=f.getSelection&&f.getSelection();if(p&&p.rangeCount!==0){f=p.anchorNode;var _=p.anchorOffset,w=p.focusNode;p=p.focusOffset;try{f.nodeType,w.nodeType}catch{f=null;break e}var U=0,W=-1,ue=-1,Ne=0,Ie=0,Be=a,Ae=null;t:for(;;){for(var Le;Be!==f||_!==0&&Be.nodeType!==3||(W=U+_),Be!==w||p!==0&&Be.nodeType!==3||(ue=U+p),Be.nodeType===3&&(U+=Be.nodeValue.length),(Le=Be.firstChild)!==null;)Ae=Be,Be=Le;for(;;){if(Be===a)break t;if(Ae===f&&++Ne===_&&(W=U),Ae===w&&++Ie===p&&(ue=U),(Le=Be.nextSibling)!==null)break;Be=Ae,Ae=Be.parentNode}Be=Le}f=W===-1||ue===-1?null:{start:W,end:ue}}else f=null}f=f||{start:0,end:0}}else f=null;for(Uf={focusedElem:a,selectionRange:f},wd=!1,Hs=l;Hs!==null;)if(l=Hs,a=l.child,(l.subtreeFlags&1028)!==0&&a!==null)a.return=l,Hs=a;else for(;Hs!==null;){switch(l=Hs,w=l.alternate,a=l.flags,l.tag){case 0:if((a&4)!==0&&(a=l.updateQueue,a=a!==null?a.events:null,a!==null))for(f=0;f<a.length;f++)_=a[f],_.ref.impl=_.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&w!==null){a=void 0,f=l,_=w.memoizedProps,w=w.memoizedState,p=f.stateNode;try{var Ze=fr(f.type,_);a=p.getSnapshotBeforeUpdate(Ze,w),p.__reactInternalSnapshotBeforeUpdate=a}catch(ct){Wt(f,f.return,ct)}}break;case 3:if((a&1024)!==0){if(a=l.stateNode.containerInfo,f=a.nodeType,f===9)Gf(a);else if(f===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":Gf(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(n(163))}if(a=l.sibling,a!==null){a.return=l.return,Hs=a;break}Hs=l.return}}function Xx(a,l,f){var p=f.flags;switch(f.tag){case 0:case 11:case 15:Yi(a,f),p&4&&jl(5,f);break;case 1:if(Yi(a,f),p&4)if(a=f.stateNode,l===null)try{a.componentDidMount()}catch(U){Wt(f,f.return,U)}else{var _=fr(f.type,l.memoizedProps);l=l.memoizedState;try{a.componentDidUpdate(_,l,a.__reactInternalSnapshotBeforeUpdate)}catch(U){Wt(f,f.return,U)}}p&64&&Kx(f),p&512&&Cl(f,f.return);break;case 3:if(Yi(a,f),p&64&&(a=f.updateQueue,a!==null)){if(l=null,f.child!==null)switch(f.child.tag){case 27:case 5:l=f.child.stateNode;break;case 1:l=f.child.stateNode}try{Mp(a,l)}catch(U){Wt(f,f.return,U)}}break;case 27:l===null&&p&4&&Wx(f);case 26:case 5:Yi(a,f),l===null&&p&4&&zx(f),p&512&&Cl(f,f.return);break;case 12:Yi(a,f);break;case 31:Yi(a,f),p&4&&ey(a,f);break;case 13:Yi(a,f),p&4&&ty(a,f),p&64&&(a=f.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(f=gw.bind(null,f),Mw(a,f))));break;case 22:if(p=f.memoizedState!==null||qi,!p){l=l!==null&&l.memoizedState!==null||Ms,_=qi;var w=Ms;qi=p,(Ms=l)&&!w?Wi(a,f,(f.subtreeFlags&8772)!==0):Yi(a,f),qi=_,Ms=w}break;case 30:break;default:Yi(a,f)}}function Jx(a){var l=a.alternate;l!==null&&(a.alternate=null,Jx(l)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(l=a.stateNode,l!==null&&ae(l)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var fs=null,pn=!1;function zi(a,l,f){for(f=f.child;f!==null;)Zx(a,l,f),f=f.sibling}function Zx(a,l,f){if(dt&&typeof dt.onCommitFiberUnmount=="function")try{dt.onCommitFiberUnmount(we,f)}catch{}switch(f.tag){case 26:Ms||bi(f,l),zi(a,l,f),f.memoizedState?f.memoizedState.count--:f.stateNode&&(f=f.stateNode,f.parentNode.removeChild(f));break;case 27:Ms||bi(f,l);var p=fs,_=pn;Ca(f.type)&&(fs=f.stateNode,pn=!1),zi(a,l,f),Bl(f.stateNode),fs=p,pn=_;break;case 5:Ms||bi(f,l);case 6:if(p=fs,_=pn,fs=null,zi(a,l,f),fs=p,pn=_,fs!==null)if(pn)try{(fs.nodeType===9?fs.body:fs.nodeName==="HTML"?fs.ownerDocument.body:fs).removeChild(f.stateNode)}catch(w){Wt(f,l,w)}else try{fs.removeChild(f.stateNode)}catch(w){Wt(f,l,w)}break;case 18:fs!==null&&(pn?(a=fs,Ky(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,f.stateNode),So(a)):Ky(fs,f.stateNode));break;case 4:p=fs,_=pn,fs=f.stateNode.containerInfo,pn=!0,zi(a,l,f),fs=p,pn=_;break;case 0:case 11:case 14:case 15:Sa(2,f,l),Ms||Sa(4,f,l),zi(a,l,f);break;case 1:Ms||(bi(f,l),p=f.stateNode,typeof p.componentWillUnmount=="function"&&qx(f,l,p)),zi(a,l,f);break;case 21:zi(a,l,f);break;case 22:Ms=(p=Ms)||f.memoizedState!==null,zi(a,l,f),Ms=p;break;default:zi(a,l,f)}}function ey(a,l){if(l.memoizedState===null&&(a=l.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{So(a)}catch(f){Wt(l,l.return,f)}}}function ty(a,l){if(l.memoizedState===null&&(a=l.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{So(a)}catch(f){Wt(l,l.return,f)}}function ow(a){switch(a.tag){case 31:case 13:case 19:var l=a.stateNode;return l===null&&(l=a.stateNode=new Qx),l;case 22:return a=a.stateNode,l=a._retryCache,l===null&&(l=a._retryCache=new Qx),l;default:throw Error(n(435,a.tag))}}function ad(a,l){var f=ow(a);l.forEach(function(p){if(!f.has(p)){f.add(p);var _=pw.bind(null,a,p);p.then(_,_)}})}function xn(a,l){var f=l.deletions;if(f!==null)for(var p=0;p<f.length;p++){var _=f[p],w=a,U=l,W=U;e:for(;W!==null;){switch(W.tag){case 27:if(Ca(W.type)){fs=W.stateNode,pn=!1;break e}break;case 5:fs=W.stateNode,pn=!1;break e;case 3:case 4:fs=W.stateNode.containerInfo,pn=!0;break e}W=W.return}if(fs===null)throw Error(n(160));Zx(w,U,_),fs=null,pn=!1,w=_.alternate,w!==null&&(w.return=null),_.return=null}if(l.subtreeFlags&13886)for(l=l.child;l!==null;)sy(l,a),l=l.sibling}var di=null;function sy(a,l){var f=a.alternate,p=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:xn(l,a),yn(a),p&4&&(Sa(3,a,a.return),jl(3,a),Sa(5,a,a.return));break;case 1:xn(l,a),yn(a),p&512&&(Ms||f===null||bi(f,f.return)),p&64&&qi&&(a=a.updateQueue,a!==null&&(p=a.callbacks,p!==null&&(f=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=f===null?p:f.concat(p))));break;case 26:var _=di;if(xn(l,a),yn(a),p&512&&(Ms||f===null||bi(f,f.return)),p&4){var w=f!==null?f.memoizedState:null;if(p=a.memoizedState,f===null)if(p===null)if(a.stateNode===null){e:{p=a.type,f=a.memoizedProps,_=_.ownerDocument||_;t:switch(p){case"title":w=_.getElementsByTagName("title")[0],(!w||w[Z]||w[E]||w.namespaceURI==="http://www.w3.org/2000/svg"||w.hasAttribute("itemprop"))&&(w=_.createElement(p),_.head.insertBefore(w,_.querySelector("head > title"))),Xs(w,p,f),w[E]=a,De(w),p=w;break e;case"link":var U=sv("link","href",_).get(p+(f.href||""));if(U){for(var W=0;W<U.length;W++)if(w=U[W],w.getAttribute("href")===(f.href==null||f.href===""?null:f.href)&&w.getAttribute("rel")===(f.rel==null?null:f.rel)&&w.getAttribute("title")===(f.title==null?null:f.title)&&w.getAttribute("crossorigin")===(f.crossOrigin==null?null:f.crossOrigin)){U.splice(W,1);break t}}w=_.createElement(p),Xs(w,p,f),_.head.appendChild(w);break;case"meta":if(U=sv("meta","content",_).get(p+(f.content||""))){for(W=0;W<U.length;W++)if(w=U[W],w.getAttribute("content")===(f.content==null?null:""+f.content)&&w.getAttribute("name")===(f.name==null?null:f.name)&&w.getAttribute("property")===(f.property==null?null:f.property)&&w.getAttribute("http-equiv")===(f.httpEquiv==null?null:f.httpEquiv)&&w.getAttribute("charset")===(f.charSet==null?null:f.charSet)){U.splice(W,1);break t}}w=_.createElement(p),Xs(w,p,f),_.head.appendChild(w);break;default:throw Error(n(468,p))}w[E]=a,De(w),p=w}a.stateNode=p}else nv(_,a.type,a.stateNode);else a.stateNode=tv(_,p,a.memoizedProps);else w!==p?(w===null?f.stateNode!==null&&(f=f.stateNode,f.parentNode.removeChild(f)):w.count--,p===null?nv(_,a.type,a.stateNode):tv(_,p,a.memoizedProps)):p===null&&a.stateNode!==null&&mf(a,a.memoizedProps,f.memoizedProps)}break;case 27:xn(l,a),yn(a),p&512&&(Ms||f===null||bi(f,f.return)),f!==null&&p&4&&mf(a,a.memoizedProps,f.memoizedProps);break;case 5:if(xn(l,a),yn(a),p&512&&(Ms||f===null||bi(f,f.return)),a.flags&32){_=a.stateNode;try{nn(_,"")}catch(Ze){Wt(a,a.return,Ze)}}p&4&&a.stateNode!=null&&(_=a.memoizedProps,mf(a,_,f!==null?f.memoizedProps:_)),p&1024&&(xf=!0);break;case 6:if(xn(l,a),yn(a),p&4){if(a.stateNode===null)throw Error(n(162));p=a.memoizedProps,f=a.stateNode;try{f.nodeValue=p}catch(Ze){Wt(a,a.return,Ze)}}break;case 3:if(_d=null,_=di,di=vd(l.containerInfo),xn(l,a),di=_,yn(a),p&4&&f!==null&&f.memoizedState.isDehydrated)try{So(l.containerInfo)}catch(Ze){Wt(a,a.return,Ze)}xf&&(xf=!1,ny(a));break;case 4:p=di,di=vd(a.stateNode.containerInfo),xn(l,a),yn(a),di=p;break;case 12:xn(l,a),yn(a);break;case 31:xn(l,a),yn(a),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,ad(a,p)));break;case 13:xn(l,a),yn(a),a.child.flags&8192&&a.memoizedState!==null!=(f!==null&&f.memoizedState!==null)&&(od=_t()),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,ad(a,p)));break;case 22:_=a.memoizedState!==null;var ue=f!==null&&f.memoizedState!==null,Ne=qi,Ie=Ms;if(qi=Ne||_,Ms=Ie||ue,xn(l,a),Ms=Ie,qi=Ne,yn(a),p&8192)e:for(l=a.stateNode,l._visibility=_?l._visibility&-2:l._visibility|1,_&&(f===null||ue||qi||Ms||mr(a)),f=null,l=a;;){if(l.tag===5||l.tag===26){if(f===null){ue=f=l;try{if(w=ue.stateNode,_)U=w.style,typeof U.setProperty=="function"?U.setProperty("display","none","important"):U.display="none";else{W=ue.stateNode;var Be=ue.memoizedProps.style,Ae=Be!=null&&Be.hasOwnProperty("display")?Be.display:null;W.style.display=Ae==null||typeof Ae=="boolean"?"":(""+Ae).trim()}}catch(Ze){Wt(ue,ue.return,Ze)}}}else if(l.tag===6){if(f===null){ue=l;try{ue.stateNode.nodeValue=_?"":ue.memoizedProps}catch(Ze){Wt(ue,ue.return,Ze)}}}else if(l.tag===18){if(f===null){ue=l;try{var Le=ue.stateNode;_?qy(Le,!0):qy(ue.stateNode,!1)}catch(Ze){Wt(ue,ue.return,Ze)}}}else if((l.tag!==22&&l.tag!==23||l.memoizedState===null||l===a)&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===a)break e;for(;l.sibling===null;){if(l.return===null||l.return===a)break e;f===l&&(f=null),l=l.return}f===l&&(f=null),l.sibling.return=l.return,l=l.sibling}p&4&&(p=a.updateQueue,p!==null&&(f=p.retryQueue,f!==null&&(p.retryQueue=null,ad(a,f))));break;case 19:xn(l,a),yn(a),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,ad(a,p)));break;case 30:break;case 21:break;default:xn(l,a),yn(a)}}function yn(a){var l=a.flags;if(l&2){try{for(var f,p=a.return;p!==null;){if(Yx(p)){f=p;break}p=p.return}if(f==null)throw Error(n(160));switch(f.tag){case 27:var _=f.stateNode,w=gf(a);id(a,w,_);break;case 5:var U=f.stateNode;f.flags&32&&(nn(U,""),f.flags&=-33);var W=gf(a);id(a,W,U);break;case 3:case 4:var ue=f.stateNode.containerInfo,Ne=gf(a);pf(a,Ne,ue);break;default:throw Error(n(161))}}catch(Ie){Wt(a,a.return,Ie)}a.flags&=-3}l&4096&&(a.flags&=-4097)}function ny(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var l=a;ny(l),l.tag===5&&l.flags&1024&&l.stateNode.reset(),a=a.sibling}}function Yi(a,l){if(l.subtreeFlags&8772)for(l=l.child;l!==null;)Xx(a,l.alternate,l),l=l.sibling}function mr(a){for(a=a.child;a!==null;){var l=a;switch(l.tag){case 0:case 11:case 14:case 15:Sa(4,l,l.return),mr(l);break;case 1:bi(l,l.return);var f=l.stateNode;typeof f.componentWillUnmount=="function"&&qx(l,l.return,f),mr(l);break;case 27:Bl(l.stateNode);case 26:case 5:bi(l,l.return),mr(l);break;case 22:l.memoizedState===null&&mr(l);break;case 30:mr(l);break;default:mr(l)}a=a.sibling}}function Wi(a,l,f){for(f=f&&(l.subtreeFlags&8772)!==0,l=l.child;l!==null;){var p=l.alternate,_=a,w=l,U=w.flags;switch(w.tag){case 0:case 11:case 15:Wi(_,w,f),jl(4,w);break;case 1:if(Wi(_,w,f),p=w,_=p.stateNode,typeof _.componentDidMount=="function")try{_.componentDidMount()}catch(Ne){Wt(p,p.return,Ne)}if(p=w,_=p.updateQueue,_!==null){var W=p.stateNode;try{var ue=_.shared.hiddenCallbacks;if(ue!==null)for(_.shared.hiddenCallbacks=null,_=0;_<ue.length;_++)Ip(ue[_],W)}catch(Ne){Wt(p,p.return,Ne)}}f&&U&64&&Kx(w),Cl(w,w.return);break;case 27:Wx(w);case 26:case 5:Wi(_,w,f),f&&p===null&&U&4&&zx(w),Cl(w,w.return);break;case 12:Wi(_,w,f);break;case 31:Wi(_,w,f),f&&U&4&&ey(_,w);break;case 13:Wi(_,w,f),f&&U&4&&ty(_,w);break;case 22:w.memoizedState===null&&Wi(_,w,f),Cl(w,w.return);break;case 30:break;default:Wi(_,w,f)}l=l.sibling}}function yf(a,l){var f=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),a=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(a=l.memoizedState.cachePool.pool),a!==f&&(a!=null&&a.refCount++,f!=null&&gl(f))}function vf(a,l){a=null,l.alternate!==null&&(a=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==a&&(l.refCount++,a!=null&&gl(a))}function ui(a,l,f,p){if(l.subtreeFlags&10256)for(l=l.child;l!==null;)iy(a,l,f,p),l=l.sibling}function iy(a,l,f,p){var _=l.flags;switch(l.tag){case 0:case 11:case 15:ui(a,l,f,p),_&2048&&jl(9,l);break;case 1:ui(a,l,f,p);break;case 3:ui(a,l,f,p),_&2048&&(a=null,l.alternate!==null&&(a=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==a&&(l.refCount++,a!=null&&gl(a)));break;case 12:if(_&2048){ui(a,l,f,p),a=l.stateNode;try{var w=l.memoizedProps,U=w.id,W=w.onPostCommit;typeof W=="function"&&W(U,l.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(ue){Wt(l,l.return,ue)}}else ui(a,l,f,p);break;case 31:ui(a,l,f,p);break;case 13:ui(a,l,f,p);break;case 23:break;case 22:w=l.stateNode,U=l.alternate,l.memoizedState!==null?w._visibility&2?ui(a,l,f,p):Rl(a,l):w._visibility&2?ui(a,l,f,p):(w._visibility|=2,uo(a,l,f,p,(l.subtreeFlags&10256)!==0||!1)),_&2048&&yf(U,l);break;case 24:ui(a,l,f,p),_&2048&&vf(l.alternate,l);break;default:ui(a,l,f,p)}}function uo(a,l,f,p,_){for(_=_&&((l.subtreeFlags&10256)!==0||!1),l=l.child;l!==null;){var w=a,U=l,W=f,ue=p,Ne=U.flags;switch(U.tag){case 0:case 11:case 15:uo(w,U,W,ue,_),jl(8,U);break;case 23:break;case 22:var Ie=U.stateNode;U.memoizedState!==null?Ie._visibility&2?uo(w,U,W,ue,_):Rl(w,U):(Ie._visibility|=2,uo(w,U,W,ue,_)),_&&Ne&2048&&yf(U.alternate,U);break;case 24:uo(w,U,W,ue,_),_&&Ne&2048&&vf(U.alternate,U);break;default:uo(w,U,W,ue,_)}l=l.sibling}}function Rl(a,l){if(l.subtreeFlags&10256)for(l=l.child;l!==null;){var f=a,p=l,_=p.flags;switch(p.tag){case 22:Rl(f,p),_&2048&&yf(p.alternate,p);break;case 24:Rl(f,p),_&2048&&vf(p.alternate,p);break;default:Rl(f,p)}l=l.sibling}}var Ll=8192;function ho(a,l,f){if(a.subtreeFlags&Ll)for(a=a.child;a!==null;)ay(a,l,f),a=a.sibling}function ay(a,l,f){switch(a.tag){case 26:ho(a,l,f),a.flags&Ll&&a.memoizedState!==null&&zw(f,di,a.memoizedState,a.memoizedProps);break;case 5:ho(a,l,f);break;case 3:case 4:var p=di;di=vd(a.stateNode.containerInfo),ho(a,l,f),di=p;break;case 22:a.memoizedState===null&&(p=a.alternate,p!==null&&p.memoizedState!==null?(p=Ll,Ll=16777216,ho(a,l,f),Ll=p):ho(a,l,f));break;default:ho(a,l,f)}}function ry(a){var l=a.alternate;if(l!==null&&(a=l.child,a!==null)){l.child=null;do l=a.sibling,a.sibling=null,a=l;while(a!==null)}}function kl(a){var l=a.deletions;if((a.flags&16)!==0){if(l!==null)for(var f=0;f<l.length;f++){var p=l[f];Hs=p,ly(p,a)}ry(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)oy(a),a=a.sibling}function oy(a){switch(a.tag){case 0:case 11:case 15:kl(a),a.flags&2048&&Sa(9,a,a.return);break;case 3:kl(a);break;case 12:kl(a);break;case 22:var l=a.stateNode;a.memoizedState!==null&&l._visibility&2&&(a.return===null||a.return.tag!==13)?(l._visibility&=-3,rd(a)):kl(a);break;default:kl(a)}}function rd(a){var l=a.deletions;if((a.flags&16)!==0){if(l!==null)for(var f=0;f<l.length;f++){var p=l[f];Hs=p,ly(p,a)}ry(a)}for(a=a.child;a!==null;){switch(l=a,l.tag){case 0:case 11:case 15:Sa(8,l,l.return),rd(l);break;case 22:f=l.stateNode,f._visibility&2&&(f._visibility&=-3,rd(l));break;default:rd(l)}a=a.sibling}}function ly(a,l){for(;Hs!==null;){var f=Hs;switch(f.tag){case 0:case 11:case 15:Sa(8,f,l);break;case 23:case 22:if(f.memoizedState!==null&&f.memoizedState.cachePool!==null){var p=f.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:gl(f.memoizedState.cache)}if(p=f.child,p!==null)p.return=f,Hs=p;else e:for(f=a;Hs!==null;){p=Hs;var _=p.sibling,w=p.return;if(Jx(p),p===f){Hs=null;break e}if(_!==null){_.return=w,Hs=_;break e}Hs=w}}}var lw={getCacheForType:function(a){var l=Ws(ks),f=l.data.get(a);return f===void 0&&(f=a(),l.data.set(a,f)),f},cacheSignal:function(){return Ws(ks).controller.signal}},cw=typeof WeakMap=="function"?WeakMap:Map,Kt=0,is=null,Lt=null,Mt=0,Yt=0,Dn=null,Ea=!1,fo=!1,bf=!1,Qi=0,Es=0,Na=0,gr=0,_f=0,In=0,mo=0,Dl=null,vn=null,Sf=!1,od=0,cy=0,ld=1/0,cd=null,wa=null,Ps=0,Ta=null,go=null,Xi=0,Ef=0,Nf=null,dy=null,Il=0,wf=null;function Mn(){return(Kt&2)!==0&&Mt!==0?Mt&-Mt:X.T!==null?Lf():Sc()}function uy(){if(In===0)if((Mt&536870912)===0||Ut){var a=Ur;Ur<<=1,(Ur&3932160)===0&&(Ur=262144),In=a}else In=536870912;return a=Ln.current,a!==null&&(a.flags|=32),In}function bn(a,l,f){(a===is&&(Yt===2||Yt===9)||a.cancelPendingCommit!==null)&&(po(a,0),Aa(a,Mt,In,!1)),da(a,f),((Kt&2)===0||a!==is)&&(a===is&&((Kt&2)===0&&(gr|=f),Es===4&&Aa(a,Mt,In,!1)),_i(a))}function hy(a,l,f){if((Kt&6)!==0)throw Error(n(327));var p=!f&&(l&127)===0&&(l&a.expiredLanes)===0||Ya(a,l),_=p?hw(a,l):Af(a,l,!0),w=p;do{if(_===0){fo&&!p&&Aa(a,l,0,!1);break}else{if(f=a.current.alternate,w&&!dw(f)){_=Af(a,l,!1),w=!1;continue}if(_===2){if(w=l,a.errorRecoveryDisabledLanes&w)var U=0;else U=a.pendingLanes&-536870913,U=U!==0?U:U&536870912?536870912:0;if(U!==0){l=U;e:{var W=a;_=Dl;var ue=W.current.memoizedState.isDehydrated;if(ue&&(po(W,U).flags|=256),U=Af(W,U,!1),U!==2){if(bf&&!ue){W.errorRecoveryDisabledLanes|=w,gr|=w,_=4;break e}w=vn,vn=_,w!==null&&(vn===null?vn=w:vn.push.apply(vn,w))}_=U}if(w=!1,_!==2)continue}}if(_===1){po(a,0),Aa(a,l,0,!0);break}e:{switch(p=a,w=_,w){case 0:case 1:throw Error(n(345));case 4:if((l&4194048)!==l)break;case 6:Aa(p,l,In,!Ea);break e;case 2:vn=null;break;case 3:case 5:break;default:throw Error(n(329))}if((l&62914560)===l&&(_=od+300-_t(),10<_)){if(Aa(p,l,In,!Ea),$r(p,0,!0)!==0)break e;Xi=l,p.timeoutHandle=Vy(fy.bind(null,p,f,vn,cd,Sf,l,In,gr,mo,Ea,w,"Throttled",-0,0),_);break e}fy(p,f,vn,cd,Sf,l,In,gr,mo,Ea,w,null,-0,0)}}break}while(!0);_i(a)}function fy(a,l,f,p,_,w,U,W,ue,Ne,Ie,Be,Ae,Le){if(a.timeoutHandle=-1,Be=l.subtreeFlags,Be&8192||(Be&16785408)===16785408){Be={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:jn},ay(l,w,Be);var Ze=(w&62914560)===w?od-_t():(w&4194048)===w?cy-_t():0;if(Ze=Yw(Be,Ze),Ze!==null){Xi=w,a.cancelPendingCommit=Ze(_y.bind(null,a,l,w,f,p,_,U,W,ue,Ie,Be,null,Ae,Le)),Aa(a,w,U,!Ne);return}}_y(a,l,w,f,p,_,U,W,ue)}function dw(a){for(var l=a;;){var f=l.tag;if((f===0||f===11||f===15)&&l.flags&16384&&(f=l.updateQueue,f!==null&&(f=f.stores,f!==null)))for(var p=0;p<f.length;p++){var _=f[p],w=_.getSnapshot;_=_.value;try{if(!Cn(w(),_))return!1}catch{return!1}}if(f=l.child,l.subtreeFlags&16384&&f!==null)f.return=l,l=f;else{if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function Aa(a,l,f,p){l&=~_f,l&=~gr,a.suspendedLanes|=l,a.pingedLanes&=~l,p&&(a.warmLanes|=l),p=a.expirationTimes;for(var _=l;0<_;){var w=31-bs(_),U=1<<w;p[w]=-1,_&=~U}f!==0&&el(a,f,l)}function dd(){return(Kt&6)===0?(Ml(0),!1):!0}function Tf(){if(Lt!==null){if(Yt===0)var a=Lt.return;else a=Lt,Fi=rr=null,$h(a),ao=null,xl=0,a=Lt;for(;a!==null;)Hx(a.alternate,a),a=a.return;Lt=null}}function po(a,l){var f=a.timeoutHandle;f!==-1&&(a.timeoutHandle=-1,Rw(f)),f=a.cancelPendingCommit,f!==null&&(a.cancelPendingCommit=null,f()),Xi=0,Tf(),is=a,Lt=f=Bi(a.current,null),Mt=l,Yt=0,Dn=null,Ea=!1,fo=Ya(a,l),bf=!1,mo=In=_f=gr=Na=Es=0,vn=Dl=null,Sf=!1,(l&8)!==0&&(l|=l&32);var p=a.entangledLanes;if(p!==0)for(a=a.entanglements,p&=l;0<p;){var _=31-bs(p),w=1<<_;l|=a[_],p&=~w}return Qi=l,Lc(),f}function my(a,l){Nt=null,X.H=wl,l===io||l===Uc?(l=Rp(),Yt=3):l===Ch?(l=Rp(),Yt=4):Yt=l===nf?8:l!==null&&typeof l=="object"&&typeof l.then=="function"?6:1,Dn=l,Lt===null&&(Es=1,Zc(a,Yn(l,a.current)))}function gy(){var a=Ln.current;return a===null?!0:(Mt&4194048)===Mt?Jn===null:(Mt&62914560)===Mt||(Mt&536870912)!==0?a===Jn:!1}function py(){var a=X.H;return X.H=wl,a===null?wl:a}function xy(){var a=X.A;return X.A=lw,a}function ud(){Es=4,Ea||(Mt&4194048)!==Mt&&Ln.current!==null||(fo=!0),(Na&134217727)===0&&(gr&134217727)===0||is===null||Aa(is,Mt,In,!1)}function Af(a,l,f){var p=Kt;Kt|=2;var _=py(),w=xy();(is!==a||Mt!==l)&&(cd=null,po(a,l)),l=!1;var U=Es;e:do try{if(Yt!==0&&Lt!==null){var W=Lt,ue=Dn;switch(Yt){case 8:Tf(),U=6;break e;case 3:case 2:case 9:case 6:Ln.current===null&&(l=!0);var Ne=Yt;if(Yt=0,Dn=null,xo(a,W,ue,Ne),f&&fo){U=0;break e}break;default:Ne=Yt,Yt=0,Dn=null,xo(a,W,ue,Ne)}}uw(),U=Es;break}catch(Ie){my(a,Ie)}while(!0);return l&&a.shellSuspendCounter++,Fi=rr=null,Kt=p,X.H=_,X.A=w,Lt===null&&(is=null,Mt=0,Lc()),U}function uw(){for(;Lt!==null;)yy(Lt)}function hw(a,l){var f=Kt;Kt|=2;var p=py(),_=xy();is!==a||Mt!==l?(cd=null,ld=_t()+500,po(a,l)):fo=Ya(a,l);e:do try{if(Yt!==0&&Lt!==null){l=Lt;var w=Dn;t:switch(Yt){case 1:Yt=0,Dn=null,xo(a,l,w,1);break;case 2:case 9:if(jp(w)){Yt=0,Dn=null,vy(l);break}l=function(){Yt!==2&&Yt!==9||is!==a||(Yt=7),_i(a)},w.then(l,l);break e;case 3:Yt=7;break e;case 4:Yt=5;break e;case 7:jp(w)?(Yt=0,Dn=null,vy(l)):(Yt=0,Dn=null,xo(a,l,w,7));break;case 5:var U=null;switch(Lt.tag){case 26:U=Lt.memoizedState;case 5:case 27:var W=Lt;if(U?iv(U):W.stateNode.complete){Yt=0,Dn=null;var ue=W.sibling;if(ue!==null)Lt=ue;else{var Ne=W.return;Ne!==null?(Lt=Ne,hd(Ne)):Lt=null}break t}}Yt=0,Dn=null,xo(a,l,w,5);break;case 6:Yt=0,Dn=null,xo(a,l,w,6);break;case 8:Tf(),Es=6;break e;default:throw Error(n(462))}}fw();break}catch(Ie){my(a,Ie)}while(!0);return Fi=rr=null,X.H=p,X.A=_,Kt=f,Lt!==null?0:(is=null,Mt=0,Lc(),Es)}function fw(){for(;Lt!==null&&!Ye();)yy(Lt)}function yy(a){var l=Gx(a.alternate,a,Qi);a.memoizedProps=a.pendingProps,l===null?hd(a):Lt=l}function vy(a){var l=a,f=l.alternate;switch(l.tag){case 15:case 0:l=Ox(f,l,l.pendingProps,l.type,void 0,Mt);break;case 11:l=Ox(f,l,l.pendingProps,l.type.render,l.ref,Mt);break;case 5:$h(l);default:Hx(f,l),l=Lt=xp(l,Qi),l=Gx(f,l,Qi)}a.memoizedProps=a.pendingProps,l===null?hd(a):Lt=l}function xo(a,l,f,p){Fi=rr=null,$h(l),ao=null,xl=0;var _=l.return;try{if(tw(a,_,l,f,Mt)){Es=1,Zc(a,Yn(f,a.current)),Lt=null;return}}catch(w){if(_!==null)throw Lt=_,w;Es=1,Zc(a,Yn(f,a.current)),Lt=null;return}l.flags&32768?(Ut||p===1?a=!0:fo||(Mt&536870912)!==0?a=!1:(Ea=a=!0,(p===2||p===9||p===3||p===6)&&(p=Ln.current,p!==null&&p.tag===13&&(p.flags|=16384))),by(l,a)):hd(l)}function hd(a){var l=a;do{if((l.flags&32768)!==0){by(l,Ea);return}a=l.return;var f=iw(l.alternate,l,Qi);if(f!==null){Lt=f;return}if(l=l.sibling,l!==null){Lt=l;return}Lt=l=a}while(l!==null);Es===0&&(Es=5)}function by(a,l){do{var f=aw(a.alternate,a);if(f!==null){f.flags&=32767,Lt=f;return}if(f=a.return,f!==null&&(f.flags|=32768,f.subtreeFlags=0,f.deletions=null),!l&&(a=a.sibling,a!==null)){Lt=a;return}Lt=a=f}while(a!==null);Es=6,Lt=null}function _y(a,l,f,p,_,w,U,W,ue){a.cancelPendingCommit=null;do fd();while(Ps!==0);if((Kt&6)!==0)throw Error(n(327));if(l!==null){if(l===a.current)throw Error(n(177));if(w=l.lanes|l.childLanes,w|=mh,ua(a,f,w,U,W,ue),a===is&&(Lt=is=null,Mt=0),go=l,Ta=a,Xi=f,Ef=w,Nf=_,dy=p,(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,xw(Tn,function(){return Ty(),null})):(a.callbackNode=null,a.callbackPriority=0),p=(l.flags&13878)!==0,(l.subtreeFlags&13878)!==0||p){p=X.T,X.T=null,_=ce.p,ce.p=2,U=Kt,Kt|=4;try{rw(a,l,f)}finally{Kt=U,ce.p=_,X.T=p}}Ps=1,Sy(),Ey(),Ny()}}function Sy(){if(Ps===1){Ps=0;var a=Ta,l=go,f=(l.flags&13878)!==0;if((l.subtreeFlags&13878)!==0||f){f=X.T,X.T=null;var p=ce.p;ce.p=2;var _=Kt;Kt|=4;try{sy(l,a);var w=Uf,U=lp(a.containerInfo),W=w.focusedElem,ue=w.selectionRange;if(U!==W&&W&&W.ownerDocument&&op(W.ownerDocument.documentElement,W)){if(ue!==null&&ch(W)){var Ne=ue.start,Ie=ue.end;if(Ie===void 0&&(Ie=Ne),"selectionStart"in W)W.selectionStart=Ne,W.selectionEnd=Math.min(Ie,W.value.length);else{var Be=W.ownerDocument||document,Ae=Be&&Be.defaultView||window;if(Ae.getSelection){var Le=Ae.getSelection(),Ze=W.textContent.length,ct=Math.min(ue.start,Ze),es=ue.end===void 0?ct:Math.min(ue.end,Ze);!Le.extend&&ct>es&&(U=es,es=ct,ct=U);var ve=rp(W,ct),ge=rp(W,es);if(ve&&ge&&(Le.rangeCount!==1||Le.anchorNode!==ve.node||Le.anchorOffset!==ve.offset||Le.focusNode!==ge.node||Le.focusOffset!==ge.offset)){var Ee=Be.createRange();Ee.setStart(ve.node,ve.offset),Le.removeAllRanges(),ct>es?(Le.addRange(Ee),Le.extend(ge.node,ge.offset)):(Ee.setEnd(ge.node,ge.offset),Le.addRange(Ee))}}}}for(Be=[],Le=W;Le=Le.parentNode;)Le.nodeType===1&&Be.push({element:Le,left:Le.scrollLeft,top:Le.scrollTop});for(typeof W.focus=="function"&&W.focus(),W=0;W<Be.length;W++){var Pe=Be[W];Pe.element.scrollLeft=Pe.left,Pe.element.scrollTop=Pe.top}}wd=!!Bf,Uf=Bf=null}finally{Kt=_,ce.p=p,X.T=f}}a.current=l,Ps=2}}function Ey(){if(Ps===2){Ps=0;var a=Ta,l=go,f=(l.flags&8772)!==0;if((l.subtreeFlags&8772)!==0||f){f=X.T,X.T=null;var p=ce.p;ce.p=2;var _=Kt;Kt|=4;try{Xx(a,l.alternate,l)}finally{Kt=_,ce.p=p,X.T=f}}Ps=3}}function Ny(){if(Ps===4||Ps===3){Ps=0,lt();var a=Ta,l=go,f=Xi,p=dy;(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?Ps=5:(Ps=0,go=Ta=null,wy(a,a.pendingLanes));var _=a.pendingLanes;if(_===0&&(wa=null),ps(f),l=l.stateNode,dt&&typeof dt.onCommitFiberRoot=="function")try{dt.onCommitFiberRoot(we,l,void 0,(l.current.flags&128)===128)}catch{}if(p!==null){l=X.T,_=ce.p,ce.p=2,X.T=null;try{for(var w=a.onRecoverableError,U=0;U<p.length;U++){var W=p[U];w(W.value,{componentStack:W.stack})}}finally{X.T=l,ce.p=_}}(Xi&3)!==0&&fd(),_i(a),_=a.pendingLanes,(f&261930)!==0&&(_&42)!==0?a===wf?Il++:(Il=0,wf=a):Il=0,Ml(0)}}function wy(a,l){(a.pooledCacheLanes&=l)===0&&(l=a.pooledCache,l!=null&&(a.pooledCache=null,gl(l)))}function fd(){return Sy(),Ey(),Ny(),Ty()}function Ty(){if(Ps!==5)return!1;var a=Ta,l=Ef;Ef=0;var f=ps(Xi),p=X.T,_=ce.p;try{ce.p=32>f?32:f,X.T=null,f=Nf,Nf=null;var w=Ta,U=Xi;if(Ps=0,go=Ta=null,Xi=0,(Kt&6)!==0)throw Error(n(331));var W=Kt;if(Kt|=4,oy(w.current),iy(w,w.current,U,f),Kt=W,Ml(0,!1),dt&&typeof dt.onPostCommitFiberRoot=="function")try{dt.onPostCommitFiberRoot(we,w)}catch{}return!0}finally{ce.p=_,X.T=p,wy(a,l)}}function Ay(a,l,f){l=Yn(f,l),l=sf(a.stateNode,l,2),a=va(a,l,2),a!==null&&(da(a,2),_i(a))}function Wt(a,l,f){if(a.tag===3)Ay(a,a,f);else for(;l!==null;){if(l.tag===3){Ay(l,a,f);break}else if(l.tag===1){var p=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(wa===null||!wa.has(p))){a=Yn(f,a),f=jx(2),p=va(l,f,2),p!==null&&(Cx(f,p,l,a),da(p,2),_i(p));break}}l=l.return}}function jf(a,l,f){var p=a.pingCache;if(p===null){p=a.pingCache=new cw;var _=new Set;p.set(l,_)}else _=p.get(l),_===void 0&&(_=new Set,p.set(l,_));_.has(f)||(bf=!0,_.add(f),a=mw.bind(null,a,l,f),l.then(a,a))}function mw(a,l,f){var p=a.pingCache;p!==null&&p.delete(l),a.pingedLanes|=a.suspendedLanes&f,a.warmLanes&=~f,is===a&&(Mt&f)===f&&(Es===4||Es===3&&(Mt&62914560)===Mt&&300>_t()-od?(Kt&2)===0&&po(a,0):_f|=f,mo===Mt&&(mo=0)),_i(a)}function jy(a,l){l===0&&(l=Zo()),a=nr(a,l),a!==null&&(da(a,l),_i(a))}function gw(a){var l=a.memoizedState,f=0;l!==null&&(f=l.retryLane),jy(a,f)}function pw(a,l){var f=0;switch(a.tag){case 31:case 13:var p=a.stateNode,_=a.memoizedState;_!==null&&(f=_.retryLane);break;case 19:p=a.stateNode;break;case 22:p=a.stateNode._retryCache;break;default:throw Error(n(314))}p!==null&&p.delete(l),jy(a,f)}function xw(a,l){return gs(a,l)}var md=null,yo=null,Cf=!1,gd=!1,Rf=!1,ja=0;function _i(a){a!==yo&&a.next===null&&(yo===null?md=yo=a:yo=yo.next=a),gd=!0,Cf||(Cf=!0,vw())}function Ml(a,l){if(!Rf&&gd){Rf=!0;do for(var f=!1,p=md;p!==null;){if(a!==0){var _=p.pendingLanes;if(_===0)var w=0;else{var U=p.suspendedLanes,W=p.pingedLanes;w=(1<<31-bs(42|a)+1)-1,w&=_&~(U&~W),w=w&201326741?w&201326741|1:w?w|2:0}w!==0&&(f=!0,ky(p,w))}else w=Mt,w=$r(p,p===is?w:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(w&3)===0||Ya(p,w)||(f=!0,ky(p,w));p=p.next}while(f);Rf=!1}}function yw(){Cy()}function Cy(){gd=Cf=!1;var a=0;ja!==0&&Cw()&&(a=ja);for(var l=_t(),f=null,p=md;p!==null;){var _=p.next,w=Ry(p,l);w===0?(p.next=null,f===null?md=_:f.next=_,_===null&&(yo=f)):(f=p,(a!==0||(w&3)!==0)&&(gd=!0)),p=_}Ps!==0&&Ps!==5||Ml(a),ja!==0&&(ja=0)}function Ry(a,l){for(var f=a.suspendedLanes,p=a.pingedLanes,_=a.expirationTimes,w=a.pendingLanes&-62914561;0<w;){var U=31-bs(w),W=1<<U,ue=_[U];ue===-1?((W&f)===0||(W&p)!==0)&&(_[U]=Mi(W,l)):ue<=l&&(a.expiredLanes|=W),w&=~W}if(l=is,f=Mt,f=$r(a,a===l?f:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p=a.callbackNode,f===0||a===l&&(Yt===2||Yt===9)||a.cancelPendingCommit!==null)return p!==null&&p!==null&&Se(p),a.callbackNode=null,a.callbackPriority=0;if((f&3)===0||Ya(a,f)){if(l=f&-f,l===a.callbackPriority)return l;switch(p!==null&&Se(p),ps(f)){case 2:case 8:f=Vn;break;case 32:f=Tn;break;case 268435456:f=oi;break;default:f=Tn}return p=Ly.bind(null,a),f=gs(f,p),a.callbackPriority=l,a.callbackNode=f,l}return p!==null&&p!==null&&Se(p),a.callbackPriority=2,a.callbackNode=null,2}function Ly(a,l){if(Ps!==0&&Ps!==5)return a.callbackNode=null,a.callbackPriority=0,null;var f=a.callbackNode;if(fd()&&a.callbackNode!==f)return null;var p=Mt;return p=$r(a,a===is?p:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p===0?null:(hy(a,p,l),Ry(a,_t()),a.callbackNode!=null&&a.callbackNode===f?Ly.bind(null,a):null)}function ky(a,l){if(fd())return null;hy(a,l,!0)}function vw(){Lw(function(){(Kt&6)!==0?gs(Gs,yw):Cy()})}function Lf(){if(ja===0){var a=so;a===0&&(a=Br,Br<<=1,(Br&261888)===0&&(Br=256)),ja=a}return ja}function Dy(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Xa(""+a)}function Iy(a,l){var f=l.ownerDocument.createElement("input");return f.name=l.name,f.value=l.value,a.id&&f.setAttribute("form",a.id),l.parentNode.insertBefore(f,l),a=new FormData(a),f.parentNode.removeChild(f),a}function bw(a,l,f,p,_){if(l==="submit"&&f&&f.stateNode===_){var w=Dy((_[b]||null).action),U=p.submitter;U&&(l=(l=U[b]||null)?Dy(l.formAction):U.getAttribute("formAction"),l!==null&&(w=l,U=null));var W=new Ac("action","action",null,p,_);a.push({event:W,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(ja!==0){var ue=U?Iy(_,U):new FormData(_);Qh(f,{pending:!0,data:ue,method:_.method,action:w},null,ue)}}else typeof w=="function"&&(W.preventDefault(),ue=U?Iy(_,U):new FormData(_),Qh(f,{pending:!0,data:ue,method:_.method,action:w},w,ue))},currentTarget:_}]})}}for(var kf=0;kf<fh.length;kf++){var Df=fh[kf],_w=Df.toLowerCase(),Sw=Df[0].toUpperCase()+Df.slice(1);ci(_w,"on"+Sw)}ci(up,"onAnimationEnd"),ci(hp,"onAnimationIteration"),ci(fp,"onAnimationStart"),ci("dblclick","onDoubleClick"),ci("focusin","onFocus"),ci("focusout","onBlur"),ci(BN,"onTransitionRun"),ci(UN,"onTransitionStart"),ci(FN,"onTransitionCancel"),ci(mp,"onTransitionEnd"),$e("onMouseEnter",["mouseout","mouseover"]),$e("onMouseLeave",["mouseout","mouseover"]),$e("onPointerEnter",["pointerout","pointerover"]),$e("onPointerLeave",["pointerout","pointerover"]),He("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),He("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),He("onBeforeInput",["compositionend","keypress","textInput","paste"]),He("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),He("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),He("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ol="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ew=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ol));function My(a,l){l=(l&4)!==0;for(var f=0;f<a.length;f++){var p=a[f],_=p.event;p=p.listeners;e:{var w=void 0;if(l)for(var U=p.length-1;0<=U;U--){var W=p[U],ue=W.instance,Ne=W.currentTarget;if(W=W.listener,ue!==w&&_.isPropagationStopped())break e;w=W,_.currentTarget=Ne;try{w(_)}catch(Ie){Rc(Ie)}_.currentTarget=null,w=ue}else for(U=0;U<p.length;U++){if(W=p[U],ue=W.instance,Ne=W.currentTarget,W=W.listener,ue!==w&&_.isPropagationStopped())break e;w=W,_.currentTarget=Ne;try{w(_)}catch(Ie){Rc(Ie)}_.currentTarget=null,w=ue}}}}function kt(a,l){var f=l[$];f===void 0&&(f=l[$]=new Set);var p=a+"__bubble";f.has(p)||(Oy(l,a,2,!1),f.add(p))}function If(a,l,f){var p=0;l&&(p|=4),Oy(f,a,p,l)}var pd="_reactListening"+Math.random().toString(36).slice(2);function Mf(a){if(!a[pd]){a[pd]=!0,ke.forEach(function(f){f!=="selectionchange"&&(Ew.has(f)||If(f,!1,a),If(f,!0,a))});var l=a.nodeType===9?a:a.ownerDocument;l===null||l[pd]||(l[pd]=!0,If("selectionchange",!1,l))}}function Oy(a,l,f,p){switch(uv(l)){case 2:var _=Xw;break;case 8:_=Jw;break;default:_=Qf}f=_.bind(null,l,f,a),_=void 0,!al||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(_=!0),p?_!==void 0?a.addEventListener(l,f,{capture:!0,passive:_}):a.addEventListener(l,f,!0):_!==void 0?a.addEventListener(l,f,{passive:_}):a.addEventListener(l,f,!1)}function Of(a,l,f,p,_){var w=p;if((l&1)===0&&(l&2)===0&&p!==null)e:for(;;){if(p===null)return;var U=p.tag;if(U===3||U===4){var W=p.stateNode.containerInfo;if(W===_)break;if(U===4)for(U=p.return;U!==null;){var ue=U.tag;if((ue===3||ue===4)&&U.stateNode.containerInfo===_)return;U=U.return}for(;W!==null;){if(U=fe(W),U===null)return;if(ue=U.tag,ue===5||ue===6||ue===26||ue===27){p=w=U;continue e}W=W.parentNode}}p=p.return}il(function(){var Ne=w,Ie=Oi(f),Be=[];e:{var Ae=gp.get(a);if(Ae!==void 0){var Le=Ac,Ze=a;switch(a){case"keypress":if(wc(f)===0)break e;case"keydown":case"keyup":Le=pN;break;case"focusin":Ze="focus",Le=ih;break;case"focusout":Ze="blur",Le=ih;break;case"beforeblur":case"afterblur":Le=ih;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Le=H0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Le=iN;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Le=vN;break;case up:case hp:case fp:Le=oN;break;case mp:Le=_N;break;case"scroll":case"scrollend":Le=sN;break;case"wheel":Le=EN;break;case"copy":case"cut":case"paste":Le=cN;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Le=q0;break;case"toggle":case"beforetoggle":Le=wN}var ct=(l&4)!==0,es=!ct&&(a==="scroll"||a==="scrollend"),ve=ct?Ae!==null?Ae+"Capture":null:Ae;ct=[];for(var ge=Ne,Ee;ge!==null;){var Pe=ge;if(Ee=Pe.stateNode,Pe=Pe.tag,Pe!==5&&Pe!==26&&Pe!==27||Ee===null||ve===null||(Pe=Pi(ge,ve),Pe!=null&&ct.push(Pl(ge,Pe,Ee))),es)break;ge=ge.return}0<ct.length&&(Ae=new Le(Ae,Ze,null,f,Ie),Be.push({event:Ae,listeners:ct}))}}if((l&7)===0){e:{if(Ae=a==="mouseover"||a==="pointerover",Le=a==="mouseout"||a==="pointerout",Ae&&f!==Ja&&(Ze=f.relatedTarget||f.fromElement)&&(fe(Ze)||Ze[k]))break e;if((Le||Ae)&&(Ae=Ie.window===Ie?Ie:(Ae=Ie.ownerDocument)?Ae.defaultView||Ae.parentWindow:window,Le?(Ze=f.relatedTarget||f.toElement,Le=Ne,Ze=Ze?fe(Ze):null,Ze!==null&&(es=o(Ze),ct=Ze.tag,Ze!==es||ct!==5&&ct!==27&&ct!==6)&&(Ze=null)):(Le=null,Ze=Ne),Le!==Ze)){if(ct=H0,Pe="onMouseLeave",ve="onMouseEnter",ge="mouse",(a==="pointerout"||a==="pointerover")&&(ct=q0,Pe="onPointerLeave",ve="onPointerEnter",ge="pointer"),es=Le==null?Ae:me(Le),Ee=Ze==null?Ae:me(Ze),Ae=new ct(Pe,ge+"leave",Le,f,Ie),Ae.target=es,Ae.relatedTarget=Ee,Pe=null,fe(Ie)===Ne&&(ct=new ct(ve,ge+"enter",Ze,f,Ie),ct.target=Ee,ct.relatedTarget=es,Pe=ct),es=Pe,Le&&Ze)t:{for(ct=Nw,ve=Le,ge=Ze,Ee=0,Pe=ve;Pe;Pe=ct(Pe))Ee++;Pe=0;for(var ot=ge;ot;ot=ct(ot))Pe++;for(;0<Ee-Pe;)ve=ct(ve),Ee--;for(;0<Pe-Ee;)ge=ct(ge),Pe--;for(;Ee--;){if(ve===ge||ge!==null&&ve===ge.alternate){ct=ve;break t}ve=ct(ve),ge=ct(ge)}ct=null}else ct=null;Le!==null&&Py(Be,Ae,Le,ct,!1),Ze!==null&&es!==null&&Py(Be,es,Ze,ct,!0)}}e:{if(Ae=Ne?me(Ne):window,Le=Ae.nodeName&&Ae.nodeName.toLowerCase(),Le==="select"||Le==="input"&&Ae.type==="file")var Gt=ep;else if(J0(Ae))if(tp)Gt=MN;else{Gt=DN;var et=kN}else Le=Ae.nodeName,!Le||Le.toLowerCase()!=="input"||Ae.type!=="checkbox"&&Ae.type!=="radio"?Ne&&Hr(Ne.elementType)&&(Gt=ep):Gt=IN;if(Gt&&(Gt=Gt(a,Ne))){Z0(Be,Gt,f,Ie);break e}et&&et(a,Ae,Ne),a==="focusout"&&Ne&&Ae.type==="number"&&Ne.memoizedProps.value!=null&&Ls(Ae,"number",Ae.value)}switch(et=Ne?me(Ne):window,a){case"focusin":(J0(et)||et.contentEditable==="true")&&(Yr=et,dh=Ne,hl=null);break;case"focusout":hl=dh=Yr=null;break;case"mousedown":uh=!0;break;case"contextmenu":case"mouseup":case"dragend":uh=!1,cp(Be,f,Ie);break;case"selectionchange":if(PN)break;case"keydown":case"keyup":cp(Be,f,Ie)}var Tt;if(rh)e:{switch(a){case"compositionstart":var Ot="onCompositionStart";break e;case"compositionend":Ot="onCompositionEnd";break e;case"compositionupdate":Ot="onCompositionUpdate";break e}Ot=void 0}else zr?Q0(a,f)&&(Ot="onCompositionEnd"):a==="keydown"&&f.keyCode===229&&(Ot="onCompositionStart");Ot&&(z0&&f.locale!=="ko"&&(zr||Ot!=="onCompositionStart"?Ot==="onCompositionEnd"&&zr&&(Tt=G0()):(li=Ie,qr="value"in li?li.value:li.textContent,zr=!0)),et=xd(Ne,Ot),0<et.length&&(Ot=new K0(Ot,a,null,f,Ie),Be.push({event:Ot,listeners:et}),Tt?Ot.data=Tt:(Tt=X0(f),Tt!==null&&(Ot.data=Tt)))),(Tt=AN?jN(a,f):CN(a,f))&&(Ot=xd(Ne,"onBeforeInput"),0<Ot.length&&(et=new K0("onBeforeInput","beforeinput",null,f,Ie),Be.push({event:et,listeners:Ot}),et.data=Tt)),bw(Be,a,Ne,f,Ie)}My(Be,l)})}function Pl(a,l,f){return{instance:a,listener:l,currentTarget:f}}function xd(a,l){for(var f=l+"Capture",p=[];a!==null;){var _=a,w=_.stateNode;if(_=_.tag,_!==5&&_!==26&&_!==27||w===null||(_=Pi(a,f),_!=null&&p.unshift(Pl(a,_,w)),_=Pi(a,l),_!=null&&p.push(Pl(a,_,w))),a.tag===3)return p;a=a.return}return[]}function Nw(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function Py(a,l,f,p,_){for(var w=l._reactName,U=[];f!==null&&f!==p;){var W=f,ue=W.alternate,Ne=W.stateNode;if(W=W.tag,ue!==null&&ue===p)break;W!==5&&W!==26&&W!==27||Ne===null||(ue=Ne,_?(Ne=Pi(f,w),Ne!=null&&U.unshift(Pl(f,Ne,ue))):_||(Ne=Pi(f,w),Ne!=null&&U.push(Pl(f,Ne,ue)))),f=f.return}U.length!==0&&a.push({event:l,listeners:U})}var ww=/\r\n?/g,Tw=/\u0000|\uFFFD/g;function By(a){return(typeof a=="string"?a:""+a).replace(ww,`
`).replace(Tw,"")}function Uy(a,l){return l=By(l),By(a)===l}function Zt(a,l,f,p,_,w){switch(f){case"children":typeof p=="string"?l==="body"||l==="textarea"&&p===""||nn(a,p):(typeof p=="number"||typeof p=="bigint")&&l!=="body"&&nn(a,""+p);break;case"className":at(a,"class",p);break;case"tabIndex":at(a,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":at(a,f,p);break;case"style":Ec(a,p,w);break;case"data":if(l!=="object"){at(a,"data",p);break}case"src":case"href":if(p===""&&(l!=="a"||f!=="href")){a.removeAttribute(f);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(f);break}p=Xa(""+p),a.setAttribute(f,p);break;case"action":case"formAction":if(typeof p=="function"){a.setAttribute(f,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof w=="function"&&(f==="formAction"?(l!=="input"&&Zt(a,l,"name",_.name,_,null),Zt(a,l,"formEncType",_.formEncType,_,null),Zt(a,l,"formMethod",_.formMethod,_,null),Zt(a,l,"formTarget",_.formTarget,_,null)):(Zt(a,l,"encType",_.encType,_,null),Zt(a,l,"method",_.method,_,null),Zt(a,l,"target",_.target,_,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(f);break}p=Xa(""+p),a.setAttribute(f,p);break;case"onClick":p!=null&&(a.onclick=jn);break;case"onScroll":p!=null&&kt("scroll",a);break;case"onScrollEnd":p!=null&&kt("scrollend",a);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(n(61));if(f=p.__html,f!=null){if(_.children!=null)throw Error(n(60));a.innerHTML=f}}break;case"multiple":a.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":a.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){a.removeAttribute("xlink:href");break}f=Xa(""+p),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(f,""+p):a.removeAttribute(f);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(f,""):a.removeAttribute(f);break;case"capture":case"download":p===!0?a.setAttribute(f,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(f,p):a.removeAttribute(f);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?a.setAttribute(f,p):a.removeAttribute(f);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?a.removeAttribute(f):a.setAttribute(f,p);break;case"popover":kt("beforetoggle",a),kt("toggle",a),mt(a,"popover",p);break;case"xlinkActuate":it(a,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":it(a,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":it(a,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":it(a,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":it(a,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":it(a,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":it(a,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":it(a,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":it(a,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":mt(a,"is",p);break;case"innerText":case"textContent":break;default:(!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(f=Wa.get(f)||f,mt(a,f,p))}}function Pf(a,l,f,p,_,w){switch(f){case"style":Ec(a,p,w);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(n(61));if(f=p.__html,f!=null){if(_.children!=null)throw Error(n(60));a.innerHTML=f}}break;case"children":typeof p=="string"?nn(a,p):(typeof p=="number"||typeof p=="bigint")&&nn(a,""+p);break;case"onScroll":p!=null&&kt("scroll",a);break;case"onScrollEnd":p!=null&&kt("scrollend",a);break;case"onClick":p!=null&&(a.onclick=jn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Qe.hasOwnProperty(f))e:{if(f[0]==="o"&&f[1]==="n"&&(_=f.endsWith("Capture"),l=f.slice(2,_?f.length-7:void 0),w=a[b]||null,w=w!=null?w[f]:null,typeof w=="function"&&a.removeEventListener(l,w,_),typeof p=="function")){typeof w!="function"&&w!==null&&(f in a?a[f]=null:a.hasAttribute(f)&&a.removeAttribute(f)),a.addEventListener(l,p,_);break e}f in a?a[f]=p:p===!0?a.setAttribute(f,""):mt(a,f,p)}}}function Xs(a,l,f){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":kt("error",a),kt("load",a);var p=!1,_=!1,w;for(w in f)if(f.hasOwnProperty(w)){var U=f[w];if(U!=null)switch(w){case"src":p=!0;break;case"srcSet":_=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:Zt(a,l,w,U,f,null)}}_&&Zt(a,l,"srcSet",f.srcSet,f,null),p&&Zt(a,l,"src",f.src,f,null);return;case"input":kt("invalid",a);var W=w=U=_=null,ue=null,Ne=null;for(p in f)if(f.hasOwnProperty(p)){var Ie=f[p];if(Ie!=null)switch(p){case"name":_=Ie;break;case"type":U=Ie;break;case"checked":ue=Ie;break;case"defaultChecked":Ne=Ie;break;case"value":w=Ie;break;case"defaultValue":W=Ie;break;case"children":case"dangerouslySetInnerHTML":if(Ie!=null)throw Error(n(137,l));break;default:Zt(a,l,p,Ie,f,null)}}Vs(a,w,W,ue,Ne,U,_,!1);return;case"select":kt("invalid",a),p=U=w=null;for(_ in f)if(f.hasOwnProperty(_)&&(W=f[_],W!=null))switch(_){case"value":w=W;break;case"defaultValue":U=W;break;case"multiple":p=W;default:Zt(a,l,_,W,f,null)}l=w,f=U,a.multiple=!!p,l!=null?_s(a,!!p,l,!1):f!=null&&_s(a,!!p,f,!0);return;case"textarea":kt("invalid",a),w=_=p=null;for(U in f)if(f.hasOwnProperty(U)&&(W=f[U],W!=null))switch(U){case"value":p=W;break;case"defaultValue":_=W;break;case"children":w=W;break;case"dangerouslySetInnerHTML":if(W!=null)throw Error(n(91));break;default:Zt(a,l,U,W,f,null)}Kn(a,p,_,w);return;case"option":for(ue in f)if(f.hasOwnProperty(ue)&&(p=f[ue],p!=null))switch(ue){case"selected":a.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:Zt(a,l,ue,p,f,null)}return;case"dialog":kt("beforetoggle",a),kt("toggle",a),kt("cancel",a),kt("close",a);break;case"iframe":case"object":kt("load",a);break;case"video":case"audio":for(p=0;p<Ol.length;p++)kt(Ol[p],a);break;case"image":kt("error",a),kt("load",a);break;case"details":kt("toggle",a);break;case"embed":case"source":case"link":kt("error",a),kt("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ne in f)if(f.hasOwnProperty(Ne)&&(p=f[Ne],p!=null))switch(Ne){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:Zt(a,l,Ne,p,f,null)}return;default:if(Hr(l)){for(Ie in f)f.hasOwnProperty(Ie)&&(p=f[Ie],p!==void 0&&Pf(a,l,Ie,p,f,void 0));return}}for(W in f)f.hasOwnProperty(W)&&(p=f[W],p!=null&&Zt(a,l,W,p,f,null))}function Aw(a,l,f,p){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var _=null,w=null,U=null,W=null,ue=null,Ne=null,Ie=null;for(Le in f){var Be=f[Le];if(f.hasOwnProperty(Le)&&Be!=null)switch(Le){case"checked":break;case"value":break;case"defaultValue":ue=Be;default:p.hasOwnProperty(Le)||Zt(a,l,Le,null,p,Be)}}for(var Ae in p){var Le=p[Ae];if(Be=f[Ae],p.hasOwnProperty(Ae)&&(Le!=null||Be!=null))switch(Ae){case"type":w=Le;break;case"name":_=Le;break;case"checked":Ne=Le;break;case"defaultChecked":Ie=Le;break;case"value":U=Le;break;case"defaultValue":W=Le;break;case"children":case"dangerouslySetInnerHTML":if(Le!=null)throw Error(n(137,l));break;default:Le!==Be&&Zt(a,l,Ae,Le,p,Be)}}zs(a,U,W,ue,Ne,Ie,w,_);return;case"select":Le=U=W=Ae=null;for(w in f)if(ue=f[w],f.hasOwnProperty(w)&&ue!=null)switch(w){case"value":break;case"multiple":Le=ue;default:p.hasOwnProperty(w)||Zt(a,l,w,null,p,ue)}for(_ in p)if(w=p[_],ue=f[_],p.hasOwnProperty(_)&&(w!=null||ue!=null))switch(_){case"value":Ae=w;break;case"defaultValue":W=w;break;case"multiple":U=w;default:w!==ue&&Zt(a,l,_,w,p,ue)}l=W,f=U,p=Le,Ae!=null?_s(a,!!f,Ae,!1):!!p!=!!f&&(l!=null?_s(a,!!f,l,!0):_s(a,!!f,f?[]:"",!1));return;case"textarea":Le=Ae=null;for(W in f)if(_=f[W],f.hasOwnProperty(W)&&_!=null&&!p.hasOwnProperty(W))switch(W){case"value":break;case"children":break;default:Zt(a,l,W,null,p,_)}for(U in p)if(_=p[U],w=f[U],p.hasOwnProperty(U)&&(_!=null||w!=null))switch(U){case"value":Ae=_;break;case"defaultValue":Le=_;break;case"children":break;case"dangerouslySetInnerHTML":if(_!=null)throw Error(n(91));break;default:_!==w&&Zt(a,l,U,_,p,w)}Bt(a,Ae,Le);return;case"option":for(var Ze in f)if(Ae=f[Ze],f.hasOwnProperty(Ze)&&Ae!=null&&!p.hasOwnProperty(Ze))switch(Ze){case"selected":a.selected=!1;break;default:Zt(a,l,Ze,null,p,Ae)}for(ue in p)if(Ae=p[ue],Le=f[ue],p.hasOwnProperty(ue)&&Ae!==Le&&(Ae!=null||Le!=null))switch(ue){case"selected":a.selected=Ae&&typeof Ae!="function"&&typeof Ae!="symbol";break;default:Zt(a,l,ue,Ae,p,Le)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ct in f)Ae=f[ct],f.hasOwnProperty(ct)&&Ae!=null&&!p.hasOwnProperty(ct)&&Zt(a,l,ct,null,p,Ae);for(Ne in p)if(Ae=p[Ne],Le=f[Ne],p.hasOwnProperty(Ne)&&Ae!==Le&&(Ae!=null||Le!=null))switch(Ne){case"children":case"dangerouslySetInnerHTML":if(Ae!=null)throw Error(n(137,l));break;default:Zt(a,l,Ne,Ae,p,Le)}return;default:if(Hr(l)){for(var es in f)Ae=f[es],f.hasOwnProperty(es)&&Ae!==void 0&&!p.hasOwnProperty(es)&&Pf(a,l,es,void 0,p,Ae);for(Ie in p)Ae=p[Ie],Le=f[Ie],!p.hasOwnProperty(Ie)||Ae===Le||Ae===void 0&&Le===void 0||Pf(a,l,Ie,Ae,p,Le);return}}for(var ve in f)Ae=f[ve],f.hasOwnProperty(ve)&&Ae!=null&&!p.hasOwnProperty(ve)&&Zt(a,l,ve,null,p,Ae);for(Be in p)Ae=p[Be],Le=f[Be],!p.hasOwnProperty(Be)||Ae===Le||Ae==null&&Le==null||Zt(a,l,Be,Ae,p,Le)}function Fy(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function jw(){if(typeof performance.getEntriesByType=="function"){for(var a=0,l=0,f=performance.getEntriesByType("resource"),p=0;p<f.length;p++){var _=f[p],w=_.transferSize,U=_.initiatorType,W=_.duration;if(w&&W&&Fy(U)){for(U=0,W=_.responseEnd,p+=1;p<f.length;p++){var ue=f[p],Ne=ue.startTime;if(Ne>W)break;var Ie=ue.transferSize,Be=ue.initiatorType;Ie&&Fy(Be)&&(ue=ue.responseEnd,U+=Ie*(ue<W?1:(W-Ne)/(ue-Ne)))}if(--p,l+=8*(w+U)/(_.duration/1e3),a++,10<a)break}}if(0<a)return l/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var Bf=null,Uf=null;function yd(a){return a.nodeType===9?a:a.ownerDocument}function $y(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Gy(a,l){if(a===0)switch(l){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&l==="foreignObject"?0:a}function Ff(a,l){return a==="textarea"||a==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.children=="bigint"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var $f=null;function Cw(){var a=window.event;return a&&a.type==="popstate"?a===$f?!1:($f=a,!0):($f=null,!1)}var Vy=typeof setTimeout=="function"?setTimeout:void 0,Rw=typeof clearTimeout=="function"?clearTimeout:void 0,Hy=typeof Promise=="function"?Promise:void 0,Lw=typeof queueMicrotask=="function"?queueMicrotask:typeof Hy<"u"?function(a){return Hy.resolve(null).then(a).catch(kw)}:Vy;function kw(a){setTimeout(function(){throw a})}function Ca(a){return a==="head"}function Ky(a,l){var f=l,p=0;do{var _=f.nextSibling;if(a.removeChild(f),_&&_.nodeType===8)if(f=_.data,f==="/$"||f==="/&"){if(p===0){a.removeChild(_),So(l);return}p--}else if(f==="$"||f==="$?"||f==="$~"||f==="$!"||f==="&")p++;else if(f==="html")Bl(a.ownerDocument.documentElement);else if(f==="head"){f=a.ownerDocument.head,Bl(f);for(var w=f.firstChild;w;){var U=w.nextSibling,W=w.nodeName;w[Z]||W==="SCRIPT"||W==="STYLE"||W==="LINK"&&w.rel.toLowerCase()==="stylesheet"||f.removeChild(w),w=U}}else f==="body"&&Bl(a.ownerDocument.body);f=_}while(f);So(l)}function qy(a,l){var f=a;a=0;do{var p=f.nextSibling;if(f.nodeType===1?l?(f._stashedDisplay=f.style.display,f.style.display="none"):(f.style.display=f._stashedDisplay||"",f.getAttribute("style")===""&&f.removeAttribute("style")):f.nodeType===3&&(l?(f._stashedText=f.nodeValue,f.nodeValue=""):f.nodeValue=f._stashedText||""),p&&p.nodeType===8)if(f=p.data,f==="/$"){if(a===0)break;a--}else f!=="$"&&f!=="$?"&&f!=="$~"&&f!=="$!"||a++;f=p}while(f)}function Gf(a){var l=a.firstChild;for(l&&l.nodeType===10&&(l=l.nextSibling);l;){var f=l;switch(l=l.nextSibling,f.nodeName){case"HTML":case"HEAD":case"BODY":Gf(f),ae(f);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(f.rel.toLowerCase()==="stylesheet")continue}a.removeChild(f)}}function Dw(a,l,f,p){for(;a.nodeType===1;){var _=f;if(a.nodeName.toLowerCase()!==l.toLowerCase()){if(!p&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(p){if(!a[Z])switch(l){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(w=a.getAttribute("rel"),w==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(w!==_.rel||a.getAttribute("href")!==(_.href==null||_.href===""?null:_.href)||a.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin)||a.getAttribute("title")!==(_.title==null?null:_.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(w=a.getAttribute("src"),(w!==(_.src==null?null:_.src)||a.getAttribute("type")!==(_.type==null?null:_.type)||a.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin))&&w&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(l==="input"&&a.type==="hidden"){var w=_.name==null?null:""+_.name;if(_.type==="hidden"&&a.getAttribute("name")===w)return a}else return a;if(a=Zn(a.nextSibling),a===null)break}return null}function Iw(a,l,f){if(l==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!f||(a=Zn(a.nextSibling),a===null))return null;return a}function zy(a,l){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!l||(a=Zn(a.nextSibling),a===null))return null;return a}function Vf(a){return a.data==="$?"||a.data==="$~"}function Hf(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function Mw(a,l){var f=a.ownerDocument;if(a.data==="$~")a._reactRetry=l;else if(a.data!=="$?"||f.readyState!=="loading")l();else{var p=function(){l(),f.removeEventListener("DOMContentLoaded",p)};f.addEventListener("DOMContentLoaded",p),a._reactRetry=p}}function Zn(a){for(;a!=null;a=a.nextSibling){var l=a.nodeType;if(l===1||l===3)break;if(l===8){if(l=a.data,l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"||l==="F!"||l==="F")break;if(l==="/$"||l==="/&")return null}}return a}var Kf=null;function Yy(a){a=a.nextSibling;for(var l=0;a;){if(a.nodeType===8){var f=a.data;if(f==="/$"||f==="/&"){if(l===0)return Zn(a.nextSibling);l--}else f!=="$"&&f!=="$!"&&f!=="$?"&&f!=="$~"&&f!=="&"||l++}a=a.nextSibling}return null}function Wy(a){a=a.previousSibling;for(var l=0;a;){if(a.nodeType===8){var f=a.data;if(f==="$"||f==="$!"||f==="$?"||f==="$~"||f==="&"){if(l===0)return a;l--}else f!=="/$"&&f!=="/&"||l++}a=a.previousSibling}return null}function Qy(a,l,f){switch(l=yd(f),a){case"html":if(a=l.documentElement,!a)throw Error(n(452));return a;case"head":if(a=l.head,!a)throw Error(n(453));return a;case"body":if(a=l.body,!a)throw Error(n(454));return a;default:throw Error(n(451))}}function Bl(a){for(var l=a.attributes;l.length;)a.removeAttributeNode(l[0]);ae(a)}var ei=new Map,Xy=new Set;function vd(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Ji=ce.d;ce.d={f:Ow,r:Pw,D:Bw,C:Uw,L:Fw,m:$w,X:Vw,S:Gw,M:Hw};function Ow(){var a=Ji.f(),l=dd();return a||l}function Pw(a){var l=de(a);l!==null&&l.tag===5&&l.type==="form"?mx(l):Ji.r(a)}var vo=typeof document>"u"?null:document;function Jy(a,l,f){var p=vo;if(p&&typeof l=="string"&&l){var _=zt(l);_='link[rel="'+a+'"][href="'+_+'"]',typeof f=="string"&&(_+='[crossorigin="'+f+'"]'),Xy.has(_)||(Xy.add(_),a={rel:a,crossOrigin:f,href:l},p.querySelector(_)===null&&(l=p.createElement("link"),Xs(l,"link",a),De(l),p.head.appendChild(l)))}}function Bw(a){Ji.D(a),Jy("dns-prefetch",a,null)}function Uw(a,l){Ji.C(a,l),Jy("preconnect",a,l)}function Fw(a,l,f){Ji.L(a,l,f);var p=vo;if(p&&a&&l){var _='link[rel="preload"][as="'+zt(l)+'"]';l==="image"&&f&&f.imageSrcSet?(_+='[imagesrcset="'+zt(f.imageSrcSet)+'"]',typeof f.imageSizes=="string"&&(_+='[imagesizes="'+zt(f.imageSizes)+'"]')):_+='[href="'+zt(a)+'"]';var w=_;switch(l){case"style":w=bo(a);break;case"script":w=_o(a)}ei.has(w)||(a=g({rel:"preload",href:l==="image"&&f&&f.imageSrcSet?void 0:a,as:l},f),ei.set(w,a),p.querySelector(_)!==null||l==="style"&&p.querySelector(Ul(w))||l==="script"&&p.querySelector(Fl(w))||(l=p.createElement("link"),Xs(l,"link",a),De(l),p.head.appendChild(l)))}}function $w(a,l){Ji.m(a,l);var f=vo;if(f&&a){var p=l&&typeof l.as=="string"?l.as:"script",_='link[rel="modulepreload"][as="'+zt(p)+'"][href="'+zt(a)+'"]',w=_;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":w=_o(a)}if(!ei.has(w)&&(a=g({rel:"modulepreload",href:a},l),ei.set(w,a),f.querySelector(_)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(f.querySelector(Fl(w)))return}p=f.createElement("link"),Xs(p,"link",a),De(p),f.head.appendChild(p)}}}function Gw(a,l,f){Ji.S(a,l,f);var p=vo;if(p&&a){var _=Te(p).hoistableStyles,w=bo(a);l=l||"default";var U=_.get(w);if(!U){var W={loading:0,preload:null};if(U=p.querySelector(Ul(w)))W.loading=5;else{a=g({rel:"stylesheet",href:a,"data-precedence":l},f),(f=ei.get(w))&&qf(a,f);var ue=U=p.createElement("link");De(ue),Xs(ue,"link",a),ue._p=new Promise(function(Ne,Ie){ue.onload=Ne,ue.onerror=Ie}),ue.addEventListener("load",function(){W.loading|=1}),ue.addEventListener("error",function(){W.loading|=2}),W.loading|=4,bd(U,l,p)}U={type:"stylesheet",instance:U,count:1,state:W},_.set(w,U)}}}function Vw(a,l){Ji.X(a,l);var f=vo;if(f&&a){var p=Te(f).hoistableScripts,_=_o(a),w=p.get(_);w||(w=f.querySelector(Fl(_)),w||(a=g({src:a,async:!0},l),(l=ei.get(_))&&zf(a,l),w=f.createElement("script"),De(w),Xs(w,"link",a),f.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},p.set(_,w))}}function Hw(a,l){Ji.M(a,l);var f=vo;if(f&&a){var p=Te(f).hoistableScripts,_=_o(a),w=p.get(_);w||(w=f.querySelector(Fl(_)),w||(a=g({src:a,async:!0,type:"module"},l),(l=ei.get(_))&&zf(a,l),w=f.createElement("script"),De(w),Xs(w,"link",a),f.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},p.set(_,w))}}function Zy(a,l,f,p){var _=(_=pe.current)?vd(_):null;if(!_)throw Error(n(446));switch(a){case"meta":case"title":return null;case"style":return typeof f.precedence=="string"&&typeof f.href=="string"?(l=bo(f.href),f=Te(_).hoistableStyles,p=f.get(l),p||(p={type:"style",instance:null,count:0,state:null},f.set(l,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(f.rel==="stylesheet"&&typeof f.href=="string"&&typeof f.precedence=="string"){a=bo(f.href);var w=Te(_).hoistableStyles,U=w.get(a);if(U||(_=_.ownerDocument||_,U={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},w.set(a,U),(w=_.querySelector(Ul(a)))&&!w._p&&(U.instance=w,U.state.loading=5),ei.has(a)||(f={rel:"preload",as:"style",href:f.href,crossOrigin:f.crossOrigin,integrity:f.integrity,media:f.media,hrefLang:f.hrefLang,referrerPolicy:f.referrerPolicy},ei.set(a,f),w||Kw(_,a,f,U.state))),l&&p===null)throw Error(n(528,""));return U}if(l&&p!==null)throw Error(n(529,""));return null;case"script":return l=f.async,f=f.src,typeof f=="string"&&l&&typeof l!="function"&&typeof l!="symbol"?(l=_o(f),f=Te(_).hoistableScripts,p=f.get(l),p||(p={type:"script",instance:null,count:0,state:null},f.set(l,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,a))}}function bo(a){return'href="'+zt(a)+'"'}function Ul(a){return'link[rel="stylesheet"]['+a+"]"}function ev(a){return g({},a,{"data-precedence":a.precedence,precedence:null})}function Kw(a,l,f,p){a.querySelector('link[rel="preload"][as="style"]['+l+"]")?p.loading=1:(l=a.createElement("link"),p.preload=l,l.addEventListener("load",function(){return p.loading|=1}),l.addEventListener("error",function(){return p.loading|=2}),Xs(l,"link",f),De(l),a.head.appendChild(l))}function _o(a){return'[src="'+zt(a)+'"]'}function Fl(a){return"script[async]"+a}function tv(a,l,f){if(l.count++,l.instance===null)switch(l.type){case"style":var p=a.querySelector('style[data-href~="'+zt(f.href)+'"]');if(p)return l.instance=p,De(p),p;var _=g({},f,{"data-href":f.href,"data-precedence":f.precedence,href:null,precedence:null});return p=(a.ownerDocument||a).createElement("style"),De(p),Xs(p,"style",_),bd(p,f.precedence,a),l.instance=p;case"stylesheet":_=bo(f.href);var w=a.querySelector(Ul(_));if(w)return l.state.loading|=4,l.instance=w,De(w),w;p=ev(f),(_=ei.get(_))&&qf(p,_),w=(a.ownerDocument||a).createElement("link"),De(w);var U=w;return U._p=new Promise(function(W,ue){U.onload=W,U.onerror=ue}),Xs(w,"link",p),l.state.loading|=4,bd(w,f.precedence,a),l.instance=w;case"script":return w=_o(f.src),(_=a.querySelector(Fl(w)))?(l.instance=_,De(_),_):(p=f,(_=ei.get(w))&&(p=g({},f),zf(p,_)),a=a.ownerDocument||a,_=a.createElement("script"),De(_),Xs(_,"link",p),a.head.appendChild(_),l.instance=_);case"void":return null;default:throw Error(n(443,l.type))}else l.type==="stylesheet"&&(l.state.loading&4)===0&&(p=l.instance,l.state.loading|=4,bd(p,f.precedence,a));return l.instance}function bd(a,l,f){for(var p=f.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),_=p.length?p[p.length-1]:null,w=_,U=0;U<p.length;U++){var W=p[U];if(W.dataset.precedence===l)w=W;else if(w!==_)break}w?w.parentNode.insertBefore(a,w.nextSibling):(l=f.nodeType===9?f.head:f,l.insertBefore(a,l.firstChild))}function qf(a,l){a.crossOrigin==null&&(a.crossOrigin=l.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=l.referrerPolicy),a.title==null&&(a.title=l.title)}function zf(a,l){a.crossOrigin==null&&(a.crossOrigin=l.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=l.referrerPolicy),a.integrity==null&&(a.integrity=l.integrity)}var _d=null;function sv(a,l,f){if(_d===null){var p=new Map,_=_d=new Map;_.set(f,p)}else _=_d,p=_.get(f),p||(p=new Map,_.set(f,p));if(p.has(a))return p;for(p.set(a,null),f=f.getElementsByTagName(a),_=0;_<f.length;_++){var w=f[_];if(!(w[Z]||w[E]||a==="link"&&w.getAttribute("rel")==="stylesheet")&&w.namespaceURI!=="http://www.w3.org/2000/svg"){var U=w.getAttribute(l)||"";U=a+U;var W=p.get(U);W?W.push(w):p.set(U,[w])}}return p}function nv(a,l,f){a=a.ownerDocument||a,a.head.insertBefore(f,l==="title"?a.querySelector("head > title"):null)}function qw(a,l,f){if(f===1||l.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof l.precedence!="string"||typeof l.href!="string"||l.href==="")break;return!0;case"link":if(typeof l.rel!="string"||typeof l.href!="string"||l.href===""||l.onLoad||l.onError)break;switch(l.rel){case"stylesheet":return a=l.disabled,typeof l.precedence=="string"&&a==null;default:return!0}case"script":if(l.async&&typeof l.async!="function"&&typeof l.async!="symbol"&&!l.onLoad&&!l.onError&&l.src&&typeof l.src=="string")return!0}return!1}function iv(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function zw(a,l,f,p){if(f.type==="stylesheet"&&(typeof p.media!="string"||matchMedia(p.media).matches!==!1)&&(f.state.loading&4)===0){if(f.instance===null){var _=bo(p.href),w=l.querySelector(Ul(_));if(w){l=w._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(a.count++,a=Sd.bind(a),l.then(a,a)),f.state.loading|=4,f.instance=w,De(w);return}w=l.ownerDocument||l,p=ev(p),(_=ei.get(_))&&qf(p,_),w=w.createElement("link"),De(w);var U=w;U._p=new Promise(function(W,ue){U.onload=W,U.onerror=ue}),Xs(w,"link",p),f.instance=w}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(f,l),(l=f.state.preload)&&(f.state.loading&3)===0&&(a.count++,f=Sd.bind(a),l.addEventListener("load",f),l.addEventListener("error",f))}}var Yf=0;function Yw(a,l){return a.stylesheets&&a.count===0&&Nd(a,a.stylesheets),0<a.count||0<a.imgCount?function(f){var p=setTimeout(function(){if(a.stylesheets&&Nd(a,a.stylesheets),a.unsuspend){var w=a.unsuspend;a.unsuspend=null,w()}},6e4+l);0<a.imgBytes&&Yf===0&&(Yf=62500*jw());var _=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&Nd(a,a.stylesheets),a.unsuspend)){var w=a.unsuspend;a.unsuspend=null,w()}},(a.imgBytes>Yf?50:800)+l);return a.unsuspend=f,function(){a.unsuspend=null,clearTimeout(p),clearTimeout(_)}}:null}function Sd(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Nd(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Ed=null;function Nd(a,l){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Ed=new Map,l.forEach(Ww,a),Ed=null,Sd.call(a))}function Ww(a,l){if(!(l.state.loading&4)){var f=Ed.get(a);if(f)var p=f.get(null);else{f=new Map,Ed.set(a,f);for(var _=a.querySelectorAll("link[data-precedence],style[data-precedence]"),w=0;w<_.length;w++){var U=_[w];(U.nodeName==="LINK"||U.getAttribute("media")!=="not all")&&(f.set(U.dataset.precedence,U),p=U)}p&&f.set(null,p)}_=l.instance,U=_.getAttribute("data-precedence"),w=f.get(U)||p,w===p&&f.set(null,_),f.set(U,_),this.count++,p=Sd.bind(this),_.addEventListener("load",p),_.addEventListener("error",p),w?w.parentNode.insertBefore(_,w.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(_,a.firstChild)),l.state.loading|=4}}var $l={$$typeof:C,Provider:null,Consumer:null,_currentValue:le,_currentValue2:le,_threadCount:0};function Qw(a,l,f,p,_,w,U,W,ue){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Gr(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Gr(0),this.hiddenUpdates=Gr(null),this.identifierPrefix=p,this.onUncaughtError=_,this.onCaughtError=w,this.onRecoverableError=U,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ue,this.incompleteTransitions=new Map}function av(a,l,f,p,_,w,U,W,ue,Ne,Ie,Be){return a=new Qw(a,l,f,U,ue,Ne,Ie,Be,W),l=1,w===!0&&(l|=24),w=Rn(3,null,null,l),a.current=w,w.stateNode=a,l=Th(),l.refCount++,a.pooledCache=l,l.refCount++,w.memoizedState={element:p,isDehydrated:f,cache:l},Rh(w),a}function rv(a){return a?(a=Xr,a):Xr}function ov(a,l,f,p,_,w){_=rv(_),p.context===null?p.context=_:p.pendingContext=_,p=ya(l),p.payload={element:f},w=w===void 0?null:w,w!==null&&(p.callback=w),f=va(a,p,l),f!==null&&(bn(f,a,l),vl(f,a,l))}function lv(a,l){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var f=a.retryLane;a.retryLane=f!==0&&f<l?f:l}}function Wf(a,l){lv(a,l),(a=a.alternate)&&lv(a,l)}function cv(a){if(a.tag===13||a.tag===31){var l=nr(a,67108864);l!==null&&bn(l,a,67108864),Wf(a,67108864)}}function dv(a){if(a.tag===13||a.tag===31){var l=Mn();l=sl(l);var f=nr(a,l);f!==null&&bn(f,a,l),Wf(a,l)}}var wd=!0;function Xw(a,l,f,p){var _=X.T;X.T=null;var w=ce.p;try{ce.p=2,Qf(a,l,f,p)}finally{ce.p=w,X.T=_}}function Jw(a,l,f,p){var _=X.T;X.T=null;var w=ce.p;try{ce.p=8,Qf(a,l,f,p)}finally{ce.p=w,X.T=_}}function Qf(a,l,f,p){if(wd){var _=Xf(p);if(_===null)Of(a,l,p,Td,f),hv(a,p);else if(eT(_,a,l,f,p))p.stopPropagation();else if(hv(a,p),l&4&&-1<Zw.indexOf(a)){for(;_!==null;){var w=de(_);if(w!==null)switch(w.tag){case 3:if(w=w.stateNode,w.current.memoizedState.isDehydrated){var U=Ii(w.pendingLanes);if(U!==0){var W=w;for(W.pendingLanes|=2,W.entangledLanes|=2;U;){var ue=1<<31-bs(U);W.entanglements[1]|=ue,U&=~ue}_i(w),(Kt&6)===0&&(ld=_t()+500,Ml(0))}}break;case 31:case 13:W=nr(w,2),W!==null&&bn(W,w,2),dd(),Wf(w,2)}if(w=Xf(p),w===null&&Of(a,l,p,Td,f),w===_)break;_=w}_!==null&&p.stopPropagation()}else Of(a,l,p,null,f)}}function Xf(a){return a=Oi(a),Jf(a)}var Td=null;function Jf(a){if(Td=null,a=fe(a),a!==null){var l=o(a);if(l===null)a=null;else{var f=l.tag;if(f===13){if(a=c(l),a!==null)return a;a=null}else if(f===31){if(a=d(l),a!==null)return a;a=null}else if(f===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;a=null}else l!==a&&(a=null)}}return Td=a,null}function uv(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ln()){case Gs:return 2;case Vn:return 8;case Tn:case ri:return 32;case oi:return 268435456;default:return 32}default:return 32}}var Zf=!1,Ra=null,La=null,ka=null,Gl=new Map,Vl=new Map,Da=[],Zw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function hv(a,l){switch(a){case"focusin":case"focusout":Ra=null;break;case"dragenter":case"dragleave":La=null;break;case"mouseover":case"mouseout":ka=null;break;case"pointerover":case"pointerout":Gl.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":Vl.delete(l.pointerId)}}function Hl(a,l,f,p,_,w){return a===null||a.nativeEvent!==w?(a={blockedOn:l,domEventName:f,eventSystemFlags:p,nativeEvent:w,targetContainers:[_]},l!==null&&(l=de(l),l!==null&&cv(l)),a):(a.eventSystemFlags|=p,l=a.targetContainers,_!==null&&l.indexOf(_)===-1&&l.push(_),a)}function eT(a,l,f,p,_){switch(l){case"focusin":return Ra=Hl(Ra,a,l,f,p,_),!0;case"dragenter":return La=Hl(La,a,l,f,p,_),!0;case"mouseover":return ka=Hl(ka,a,l,f,p,_),!0;case"pointerover":var w=_.pointerId;return Gl.set(w,Hl(Gl.get(w)||null,a,l,f,p,_)),!0;case"gotpointercapture":return w=_.pointerId,Vl.set(w,Hl(Vl.get(w)||null,a,l,f,p,_)),!0}return!1}function fv(a){var l=fe(a.target);if(l!==null){var f=o(l);if(f!==null){if(l=f.tag,l===13){if(l=c(f),l!==null){a.blockedOn=l,j(a.priority,function(){dv(f)});return}}else if(l===31){if(l=d(f),l!==null){a.blockedOn=l,j(a.priority,function(){dv(f)});return}}else if(l===3&&f.stateNode.current.memoizedState.isDehydrated){a.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Ad(a){if(a.blockedOn!==null)return!1;for(var l=a.targetContainers;0<l.length;){var f=Xf(a.nativeEvent);if(f===null){f=a.nativeEvent;var p=new f.constructor(f.type,f);Ja=p,f.target.dispatchEvent(p),Ja=null}else return l=de(f),l!==null&&cv(l),a.blockedOn=f,!1;l.shift()}return!0}function mv(a,l,f){Ad(a)&&f.delete(l)}function tT(){Zf=!1,Ra!==null&&Ad(Ra)&&(Ra=null),La!==null&&Ad(La)&&(La=null),ka!==null&&Ad(ka)&&(ka=null),Gl.forEach(mv),Vl.forEach(mv)}function jd(a,l){a.blockedOn===l&&(a.blockedOn=null,Zf||(Zf=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,tT)))}var Cd=null;function gv(a){Cd!==a&&(Cd=a,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){Cd===a&&(Cd=null);for(var l=0;l<a.length;l+=3){var f=a[l],p=a[l+1],_=a[l+2];if(typeof p!="function"){if(Jf(p||f)===null)continue;break}var w=de(f);w!==null&&(a.splice(l,3),l-=3,Qh(w,{pending:!0,data:_,method:f.method,action:p},p,_))}}))}function So(a){function l(ue){return jd(ue,a)}Ra!==null&&jd(Ra,a),La!==null&&jd(La,a),ka!==null&&jd(ka,a),Gl.forEach(l),Vl.forEach(l);for(var f=0;f<Da.length;f++){var p=Da[f];p.blockedOn===a&&(p.blockedOn=null)}for(;0<Da.length&&(f=Da[0],f.blockedOn===null);)fv(f),f.blockedOn===null&&Da.shift();if(f=(a.ownerDocument||a).$$reactFormReplay,f!=null)for(p=0;p<f.length;p+=3){var _=f[p],w=f[p+1],U=_[b]||null;if(typeof w=="function")U||gv(f);else if(U){var W=null;if(w&&w.hasAttribute("formAction")){if(_=w,U=w[b]||null)W=U.formAction;else if(Jf(_)!==null)continue}else W=U.action;typeof W=="function"?f[p+1]=W:(f.splice(p,3),p-=3),gv(f)}}}function pv(){function a(w){w.canIntercept&&w.info==="react-transition"&&w.intercept({handler:function(){return new Promise(function(U){return _=U})},focusReset:"manual",scroll:"manual"})}function l(){_!==null&&(_(),_=null),p||setTimeout(f,20)}function f(){if(!p&&!navigation.transition){var w=navigation.currentEntry;w&&w.url!=null&&navigation.navigate(w.url,{state:w.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var p=!1,_=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",l),navigation.addEventListener("navigateerror",l),setTimeout(f,100),function(){p=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",l),navigation.removeEventListener("navigateerror",l),_!==null&&(_(),_=null)}}}function em(a){this._internalRoot=a}Rd.prototype.render=em.prototype.render=function(a){var l=this._internalRoot;if(l===null)throw Error(n(409));var f=l.current,p=Mn();ov(f,p,a,l,null,null)},Rd.prototype.unmount=em.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var l=a.containerInfo;ov(a.current,2,null,a,null,null),dd(),l[k]=null}};function Rd(a){this._internalRoot=a}Rd.prototype.unstable_scheduleHydration=function(a){if(a){var l=Sc();a={blockedOn:null,target:a,priority:l};for(var f=0;f<Da.length&&l!==0&&l<Da[f].priority;f++);Da.splice(f,0,a),f===0&&fv(a)}};var xv=e.version;if(xv!=="19.2.3")throw Error(n(527,xv,"19.2.3"));ce.findDOMNode=function(a){var l=a._reactInternals;if(l===void 0)throw typeof a.render=="function"?Error(n(188)):(a=Object.keys(a).join(","),Error(n(268,a)));return a=u(l),a=a!==null?m(a):null,a=a===null?null:a.stateNode,a};var sT={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:X,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ld=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ld.isDisabled&&Ld.supportsFiber)try{we=Ld.inject(sT),dt=Ld}catch{}}return ql.createRoot=function(a,l){if(!r(a))throw Error(n(299));var f=!1,p="",_=Nx,w=wx,U=Tx;return l!=null&&(l.unstable_strictMode===!0&&(f=!0),l.identifierPrefix!==void 0&&(p=l.identifierPrefix),l.onUncaughtError!==void 0&&(_=l.onUncaughtError),l.onCaughtError!==void 0&&(w=l.onCaughtError),l.onRecoverableError!==void 0&&(U=l.onRecoverableError)),l=av(a,1,!1,null,null,f,p,null,_,w,U,pv),a[k]=l.current,Mf(a),new em(l)},ql.hydrateRoot=function(a,l,f){if(!r(a))throw Error(n(299));var p=!1,_="",w=Nx,U=wx,W=Tx,ue=null;return f!=null&&(f.unstable_strictMode===!0&&(p=!0),f.identifierPrefix!==void 0&&(_=f.identifierPrefix),f.onUncaughtError!==void 0&&(w=f.onUncaughtError),f.onCaughtError!==void 0&&(U=f.onCaughtError),f.onRecoverableError!==void 0&&(W=f.onRecoverableError),f.formState!==void 0&&(ue=f.formState)),l=av(a,1,!0,l,f??null,p,_,ue,w,U,W,pv),l.context=rv(null),f=l.current,p=Mn(),p=sl(p),_=ya(p),_.callback=null,va(f,_,p),f=p,l.current.lanes=f,da(l,f),_i(l),a[k]=l.current,Mf(a),new Rd(l)},ql.version="19.2.3",ql}var Av;function hT(){if(Av)return nm.exports;Av=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),nm.exports=uT(),nm.exports}var fT=hT();var jv="popstate";function mT(i={}){function e(n,r){let{pathname:o,search:c,hash:d}=n.location;return Vm("",{pathname:o,search:c,hash:d},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(n,r){return typeof r=="string"?r:nc(r)}return pT(e,t,null,i)}function ms(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function si(i,e){if(!i){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function gT(){return Math.random().toString(36).substring(2,10)}function Cv(i,e){return{usr:i.state,key:i.key,idx:e}}function Vm(i,e,t=null,n){return{pathname:typeof i=="string"?i:i.pathname,search:"",hash:"",...typeof e=="string"?Ho(e):e,state:t,key:e&&e.key||n||gT()}}function nc({pathname:i="/",search:e="",hash:t=""}){return e&&e!=="?"&&(i+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(i+=t.charAt(0)==="#"?t:"#"+t),i}function Ho(i){let e={};if(i){let t=i.indexOf("#");t>=0&&(e.hash=i.substring(t),i=i.substring(0,t));let n=i.indexOf("?");n>=0&&(e.search=i.substring(n),i=i.substring(0,n)),i&&(e.pathname=i)}return e}function pT(i,e,t,n={}){let{window:r=document.defaultView,v5Compat:o=!1}=n,c=r.history,d="POP",h=null,u=m();u==null&&(u=0,c.replaceState({...c.state,idx:u},""));function m(){return(c.state||{idx:null}).idx}function g(){d="POP";let N=m(),A=N==null?null:N-u;u=N,h&&h({action:d,location:S.location,delta:A})}function x(N,A){d="PUSH";let R=Vm(S.location,N,A);u=m()+1;let C=Cv(R,u),D=S.createHref(R);try{c.pushState(C,"",D)}catch(V){if(V instanceof DOMException&&V.name==="DataCloneError")throw V;r.location.assign(D)}o&&h&&h({action:d,location:S.location,delta:1})}function y(N,A){d="REPLACE";let R=Vm(S.location,N,A);u=m();let C=Cv(R,u),D=S.createHref(R);c.replaceState(C,"",D),o&&h&&h({action:d,location:S.location,delta:0})}function v(N){return xT(N)}let S={get action(){return d},get location(){return i(r,c)},listen(N){if(h)throw new Error("A history only accepts one active listener");return r.addEventListener(jv,g),h=N,()=>{r.removeEventListener(jv,g),h=null}},createHref(N){return e(r,N)},createURL:v,encodeLocation(N){let A=v(N);return{pathname:A.pathname,search:A.search,hash:A.hash}},push:x,replace:y,go(N){return c.go(N)}};return S}function xT(i,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),ms(t,"No window.location.(origin|href) available to create URL");let n=typeof i=="string"?i:nc(i);return n=n.replace(/ $/,"%20"),!e&&n.startsWith("//")&&(n=t+n),new URL(n,t)}function X_(i,e,t="/"){return yT(i,e,t,!1)}function yT(i,e,t,n){let r=typeof e=="string"?Ho(e):e,o=oa(r.pathname||"/",t);if(o==null)return null;let c=J_(i);vT(c);let d=null;for(let h=0;d==null&&h<c.length;++h){let u=RT(o);d=jT(c[h],u,n)}return d}function J_(i,e=[],t=[],n="",r=!1){let o=(c,d,h=r,u)=>{let m={relativePath:u===void 0?c.path||"":u,caseSensitive:c.caseSensitive===!0,childrenIndex:d,route:c};if(m.relativePath.startsWith("/")){if(!m.relativePath.startsWith(n)&&h)return;ms(m.relativePath.startsWith(n),`Absolute route path "${m.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),m.relativePath=m.relativePath.slice(n.length)}let g=aa([n,m.relativePath]),x=t.concat(m);c.children&&c.children.length>0&&(ms(c.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),J_(c.children,e,x,g,h)),!(c.path==null&&!c.index)&&e.push({path:g,score:TT(g,c.index),routesMeta:x})};return i.forEach((c,d)=>{if(c.path===""||!c.path?.includes("?"))o(c,d);else for(let h of Z_(c.path))o(c,d,!0,h)}),e}function Z_(i){let e=i.split("/");if(e.length===0)return[];let[t,...n]=e,r=t.endsWith("?"),o=t.replace(/\?$/,"");if(n.length===0)return r?[o,""]:[o];let c=Z_(n.join("/")),d=[];return d.push(...c.map(h=>h===""?o:[o,h].join("/"))),r&&d.push(...c),d.map(h=>i.startsWith("/")&&h===""?"/":h)}function vT(i){i.sort((e,t)=>e.score!==t.score?t.score-e.score:AT(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}var bT=/^:[\w-]+$/,_T=3,ST=2,ET=1,NT=10,wT=-2,Rv=i=>i==="*";function TT(i,e){let t=i.split("/"),n=t.length;return t.some(Rv)&&(n+=wT),e&&(n+=ST),t.filter(r=>!Rv(r)).reduce((r,o)=>r+(bT.test(o)?_T:o===""?ET:NT),n)}function AT(i,e){return i.length===e.length&&i.slice(0,-1).every((n,r)=>n===e[r])?i[i.length-1]-e[e.length-1]:0}function jT(i,e,t=!1){let{routesMeta:n}=i,r={},o="/",c=[];for(let d=0;d<n.length;++d){let h=n[d],u=d===n.length-1,m=o==="/"?e:e.slice(o.length)||"/",g=xu({path:h.relativePath,caseSensitive:h.caseSensitive,end:u},m),x=h.route;if(!g&&u&&t&&!n[n.length-1].route.index&&(g=xu({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},m)),!g)return null;Object.assign(r,g.params),c.push({params:r,pathname:aa([o,g.pathname]),pathnameBase:MT(aa([o,g.pathnameBase])),route:x}),g.pathnameBase!=="/"&&(o=aa([o,g.pathnameBase]))}return c}function xu(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[t,n]=CT(i.path,i.caseSensitive,i.end),r=e.match(t);if(!r)return null;let o=r[0],c=o.replace(/(.)\/+$/,"$1"),d=r.slice(1);return{params:n.reduce((u,{paramName:m,isOptional:g},x)=>{if(m==="*"){let v=d[x]||"";c=o.slice(0,o.length-v.length).replace(/(.)\/+$/,"$1")}const y=d[x];return g&&!y?u[m]=void 0:u[m]=(y||"").replace(/%2F/g,"/"),u},{}),pathname:o,pathnameBase:c,pattern:i}}function CT(i,e=!1,t=!0){si(i==="*"||!i.endsWith("*")||i.endsWith("/*"),`Route path "${i}" will be treated as if it were "${i.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${i.replace(/\*$/,"/*")}".`);let n=[],r="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(c,d,h)=>(n.push({paramName:d,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return i.endsWith("*")?(n.push({paramName:"*"}),r+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":i!==""&&i!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),n]}function RT(i){try{return i.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return si(!1,`The URL path "${i}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),i}}function oa(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=i.charAt(t);return n&&n!=="/"?null:i.slice(t)||"/"}var LT=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,kT=i=>LT.test(i);function DT(i,e="/"){let{pathname:t,search:n="",hash:r=""}=typeof i=="string"?Ho(i):i,o;if(t)if(kT(t))o=t;else{if(t.includes("//")){let c=t;t=t.replace(/\/\/+/g,"/"),si(!1,`Pathnames cannot have embedded double slashes - normalizing ${c} -> ${t}`)}t.startsWith("/")?o=Lv(t.substring(1),"/"):o=Lv(t,e)}else o=e;return{pathname:o,search:OT(n),hash:PT(r)}}function Lv(i,e){let t=e.replace(/\/+$/,"").split("/");return i.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function om(i,e,t,n){return`Cannot include a '${i}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function IT(i){return i.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Og(i){let e=IT(i);return e.map((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)}function Pg(i,e,t,n=!1){let r;typeof i=="string"?r=Ho(i):(r={...i},ms(!r.pathname||!r.pathname.includes("?"),om("?","pathname","search",r)),ms(!r.pathname||!r.pathname.includes("#"),om("#","pathname","hash",r)),ms(!r.search||!r.search.includes("#"),om("#","search","hash",r)));let o=i===""||r.pathname==="",c=o?"/":r.pathname,d;if(c==null)d=t;else{let g=e.length-1;if(!n&&c.startsWith("..")){let x=c.split("/");for(;x[0]==="..";)x.shift(),g-=1;r.pathname=x.join("/")}d=g>=0?e[g]:"/"}let h=DT(r,d),u=c&&c!=="/"&&c.endsWith("/"),m=(o||c===".")&&t.endsWith("/");return!h.pathname.endsWith("/")&&(u||m)&&(h.pathname+="/"),h}var aa=i=>i.join("/").replace(/\/\/+/g,"/"),MT=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),OT=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,PT=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;function BT(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}function UT(i){return i.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var eS=["POST","PUT","PATCH","DELETE"];new Set(eS);var FT=["GET",...eS];new Set(FT);var Ko=P.createContext(null);Ko.displayName="DataRouter";var Ou=P.createContext(null);Ou.displayName="DataRouterState";P.createContext(!1);var tS=P.createContext({isTransitioning:!1});tS.displayName="ViewTransition";var $T=P.createContext(new Map);$T.displayName="Fetchers";var GT=P.createContext(null);GT.displayName="Await";var ii=P.createContext(null);ii.displayName="Navigation";var hc=P.createContext(null);hc.displayName="Location";var mi=P.createContext({outlet:null,matches:[],isDataRoute:!1});mi.displayName="Route";var Bg=P.createContext(null);Bg.displayName="RouteError";function VT(i,{relative:e}={}){ms(qo(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:n}=P.useContext(ii),{hash:r,pathname:o,search:c}=mc(i,{relative:e}),d=o;return t!=="/"&&(d=o==="/"?t:aa([t,o])),n.createHref({pathname:d,search:c,hash:r})}function qo(){return P.useContext(hc)!=null}function ca(){return ms(qo(),"useLocation() may be used only in the context of a <Router> component."),P.useContext(hc).location}var sS="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function nS(i){P.useContext(ii).static||P.useLayoutEffect(i)}function fc(){let{isDataRoute:i}=P.useContext(mi);return i?i2():HT()}function HT(){ms(qo(),"useNavigate() may be used only in the context of a <Router> component.");let i=P.useContext(Ko),{basename:e,navigator:t}=P.useContext(ii),{matches:n}=P.useContext(mi),{pathname:r}=ca(),o=JSON.stringify(Og(n)),c=P.useRef(!1);return nS(()=>{c.current=!0}),P.useCallback((h,u={})=>{if(si(c.current,sS),!c.current)return;if(typeof h=="number"){t.go(h);return}let m=Pg(h,JSON.parse(o),r,u.relative==="path");i==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:aa([e,m.pathname])),(u.replace?t.replace:t.push)(m,u.state,u)},[e,t,o,r,i])}var KT=P.createContext(null);function qT(i){let e=P.useContext(mi).outlet;return P.useMemo(()=>e&&P.createElement(KT.Provider,{value:i},e),[e,i])}function mc(i,{relative:e}={}){let{matches:t}=P.useContext(mi),{pathname:n}=ca(),r=JSON.stringify(Og(t));return P.useMemo(()=>Pg(i,JSON.parse(r),n,e==="path"),[i,r,n,e])}function zT(i,e){return iS(i,e)}function iS(i,e,t,n,r){ms(qo(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=P.useContext(ii),{matches:c}=P.useContext(mi),d=c[c.length-1],h=d?d.params:{},u=d?d.pathname:"/",m=d?d.pathnameBase:"/",g=d&&d.route;{let R=g&&g.path||"";aS(u,!g||R.endsWith("*")||R.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${R}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${R}"> to <Route path="${R==="/"?"*":`${R}/*`}">.`)}let x=ca(),y;if(e){let R=typeof e=="string"?Ho(e):e;ms(m==="/"||R.pathname?.startsWith(m),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${m}" but pathname "${R.pathname}" was given in the \`location\` prop.`),y=R}else y=x;let v=y.pathname||"/",S=v;if(m!=="/"){let R=m.replace(/^\//,"").split("/");S="/"+v.replace(/^\//,"").split("/").slice(R.length).join("/")}let N=X_(i,{pathname:S});si(g||N!=null,`No routes matched location "${y.pathname}${y.search}${y.hash}" `),si(N==null||N[N.length-1].route.element!==void 0||N[N.length-1].route.Component!==void 0||N[N.length-1].route.lazy!==void 0,`Matched leaf route at location "${y.pathname}${y.search}${y.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let A=JT(N&&N.map(R=>Object.assign({},R,{params:Object.assign({},h,R.params),pathname:aa([m,o.encodeLocation?o.encodeLocation(R.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:R.pathname]),pathnameBase:R.pathnameBase==="/"?m:aa([m,o.encodeLocation?o.encodeLocation(R.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:R.pathnameBase])})),c,t,n,r);return e&&A?P.createElement(hc.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...y},navigationType:"POP"}},A):A}function YT(){let i=n2(),e=BT(i)?`${i.status} ${i.statusText}`:i instanceof Error?i.message:JSON.stringify(i),t=i instanceof Error?i.stack:null,n="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:n},o={padding:"2px 4px",backgroundColor:n},c=null;return console.error("Error handled by React Router default ErrorBoundary:",i),c=P.createElement(P.Fragment,null,P.createElement("p",null," Hey developer "),P.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",P.createElement("code",{style:o},"ErrorBoundary")," or"," ",P.createElement("code",{style:o},"errorElement")," prop on your route.")),P.createElement(P.Fragment,null,P.createElement("h2",null,"Unexpected Application Error!"),P.createElement("h3",{style:{fontStyle:"italic"}},e),t?P.createElement("pre",{style:r},t):null,c)}var WT=P.createElement(YT,null),QT=class extends P.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,e){return e.location!==i.location||e.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:e.error,location:e.location,revalidation:i.revalidation||e.revalidation}}componentDidCatch(i,e){this.props.onError?this.props.onError(i,e):console.error("React Router caught the following error during render",i)}render(){return this.state.error!==void 0?P.createElement(mi.Provider,{value:this.props.routeContext},P.createElement(Bg.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function XT({routeContext:i,match:e,children:t}){let n=P.useContext(Ko);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),P.createElement(mi.Provider,{value:i},t)}function JT(i,e=[],t=null,n=null,r=null){if(i==null){if(!t)return null;if(t.errors)i=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)i=t.matches;else return null}let o=i,c=t?.errors;if(c!=null){let m=o.findIndex(g=>g.route.id&&c?.[g.route.id]!==void 0);ms(m>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(c).join(",")}`),o=o.slice(0,Math.min(o.length,m+1))}let d=!1,h=-1;if(t)for(let m=0;m<o.length;m++){let g=o[m];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(h=m),g.route.id){let{loaderData:x,errors:y}=t,v=g.route.loader&&!x.hasOwnProperty(g.route.id)&&(!y||y[g.route.id]===void 0);if(g.route.lazy||v){d=!0,h>=0?o=o.slice(0,h+1):o=[o[0]];break}}}let u=t&&n?(m,g)=>{n(m,{location:t.location,params:t.matches?.[0]?.params??{},unstable_pattern:UT(t.matches),errorInfo:g})}:void 0;return o.reduceRight((m,g,x)=>{let y,v=!1,S=null,N=null;t&&(y=c&&g.route.id?c[g.route.id]:void 0,S=g.route.errorElement||WT,d&&(h<0&&x===0?(aS("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),v=!0,N=null):h===x&&(v=!0,N=g.route.hydrateFallbackElement||null)));let A=e.concat(o.slice(0,x+1)),R=()=>{let C;return y?C=S:v?C=N:g.route.Component?C=P.createElement(g.route.Component,null):g.route.element?C=g.route.element:C=m,P.createElement(XT,{match:g,routeContext:{outlet:m,matches:A,isDataRoute:t!=null},children:C})};return t&&(g.route.ErrorBoundary||g.route.errorElement||x===0)?P.createElement(QT,{location:t.location,revalidation:t.revalidation,component:S,error:y,children:R(),routeContext:{outlet:null,matches:A,isDataRoute:!0},onError:u}):R()},null)}function Ug(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function ZT(i){let e=P.useContext(Ko);return ms(e,Ug(i)),e}function e2(i){let e=P.useContext(Ou);return ms(e,Ug(i)),e}function t2(i){let e=P.useContext(mi);return ms(e,Ug(i)),e}function Fg(i){let e=t2(i),t=e.matches[e.matches.length-1];return ms(t.route.id,`${i} can only be used on routes that contain a unique "id"`),t.route.id}function s2(){return Fg("useRouteId")}function n2(){let i=P.useContext(Bg),e=e2("useRouteError"),t=Fg("useRouteError");return i!==void 0?i:e.errors?.[t]}function i2(){let{router:i}=ZT("useNavigate"),e=Fg("useNavigate"),t=P.useRef(!1);return nS(()=>{t.current=!0}),P.useCallback(async(r,o={})=>{si(t.current,sS),t.current&&(typeof r=="number"?await i.navigate(r):await i.navigate(r,{fromRouteId:e,...o}))},[i,e])}var kv={};function aS(i,e,t){!e&&!kv[i]&&(kv[i]=!0,si(!1,t))}P.memo(a2);function a2({routes:i,future:e,state:t,unstable_onError:n}){return iS(i,void 0,t,n,e)}function rS({to:i,replace:e,state:t,relative:n}){ms(qo(),"<Navigate> may be used only in the context of a <Router> component.");let{static:r}=P.useContext(ii);si(!r,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=P.useContext(mi),{pathname:c}=ca(),d=fc(),h=Pg(i,Og(o),c,n==="path"),u=JSON.stringify(h);return P.useEffect(()=>{d(JSON.parse(u),{replace:e,state:t,relative:n})},[d,u,n,e,t]),null}function r2(i){return qT(i.context)}function Pt(i){ms(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function o2({basename:i="/",children:e=null,location:t,navigationType:n="POP",navigator:r,static:o=!1,unstable_useTransitions:c}){ms(!qo(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let d=i.replace(/^\/*/,"/"),h=P.useMemo(()=>({basename:d,navigator:r,static:o,unstable_useTransitions:c,future:{}}),[d,r,o,c]);typeof t=="string"&&(t=Ho(t));let{pathname:u="/",search:m="",hash:g="",state:x=null,key:y="default"}=t,v=P.useMemo(()=>{let S=oa(u,d);return S==null?null:{location:{pathname:S,search:m,hash:g,state:x,key:y},navigationType:n}},[d,u,m,g,x,y,n]);return si(v!=null,`<Router basename="${d}"> is not able to match the URL "${u}${m}${g}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:P.createElement(ii.Provider,{value:h},P.createElement(hc.Provider,{children:e,value:v}))}function l2({children:i,location:e}){return zT(Hm(i),e)}function Hm(i,e=[]){let t=[];return P.Children.forEach(i,(n,r)=>{if(!P.isValidElement(n))return;let o=[...e,r];if(n.type===P.Fragment){t.push.apply(t,Hm(n.props.children,o));return}ms(n.type===Pt,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ms(!n.props.index||!n.props.children,"An index route cannot have child routes.");let c={id:n.props.id||o.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,middleware:n.props.middleware,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(c.children=Hm(n.props.children,o)),t.push(c)}),t}var tu="get",su="application/x-www-form-urlencoded";function Pu(i){return typeof HTMLElement<"u"&&i instanceof HTMLElement}function c2(i){return Pu(i)&&i.tagName.toLowerCase()==="button"}function d2(i){return Pu(i)&&i.tagName.toLowerCase()==="form"}function u2(i){return Pu(i)&&i.tagName.toLowerCase()==="input"}function h2(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function f2(i,e){return i.button===0&&(!e||e==="_self")&&!h2(i)}var kd=null;function m2(){if(kd===null)try{new FormData(document.createElement("form"),0),kd=!1}catch{kd=!0}return kd}var g2=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function lm(i){return i!=null&&!g2.has(i)?(si(!1,`"${i}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${su}"`),null):i}function p2(i,e){let t,n,r,o,c;if(d2(i)){let d=i.getAttribute("action");n=d?oa(d,e):null,t=i.getAttribute("method")||tu,r=lm(i.getAttribute("enctype"))||su,o=new FormData(i)}else if(c2(i)||u2(i)&&(i.type==="submit"||i.type==="image")){let d=i.form;if(d==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=i.getAttribute("formaction")||d.getAttribute("action");if(n=h?oa(h,e):null,t=i.getAttribute("formmethod")||d.getAttribute("method")||tu,r=lm(i.getAttribute("formenctype"))||lm(d.getAttribute("enctype"))||su,o=new FormData(d,i),!m2()){let{name:u,type:m,value:g}=i;if(m==="image"){let x=u?`${u}.`:"";o.append(`${x}x`,"0"),o.append(`${x}y`,"0")}else u&&o.append(u,g)}}else{if(Pu(i))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=tu,n=null,r=su,c=i}return o&&r==="text/plain"&&(c=o,o=void 0),{action:n,method:t.toLowerCase(),encType:r,formData:o,body:c}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function $g(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function x2(i,e,t){let n=typeof i=="string"?new URL(i,typeof window>"u"?"server://singlefetch/":window.location.origin):i;return n.pathname==="/"?n.pathname=`_root.${t}`:e&&oa(n.pathname,e)==="/"?n.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:n.pathname=`${n.pathname.replace(/\/$/,"")}.${t}`,n}async function y2(i,e){if(i.id in e)return e[i.id];try{let t=await import(i.module);return e[i.id]=t,t}catch(t){return console.error(`Error loading route module \`${i.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function v2(i){return i==null?!1:i.href==null?i.rel==="preload"&&typeof i.imageSrcSet=="string"&&typeof i.imageSizes=="string":typeof i.rel=="string"&&typeof i.href=="string"}async function b2(i,e,t){let n=await Promise.all(i.map(async r=>{let o=e.routes[r.route.id];if(o){let c=await y2(o,t);return c.links?c.links():[]}return[]}));return N2(n.flat(1).filter(v2).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function Dv(i,e,t,n,r,o){let c=(h,u)=>t[u]?h.route.id!==t[u].route.id:!0,d=(h,u)=>t[u].pathname!==h.pathname||t[u].route.path?.endsWith("*")&&t[u].params["*"]!==h.params["*"];return o==="assets"?e.filter((h,u)=>c(h,u)||d(h,u)):o==="data"?e.filter((h,u)=>{let m=n.routes[h.route.id];if(!m||!m.hasLoader)return!1;if(c(h,u)||d(h,u))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(i,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function _2(i,e,{includeHydrateFallback:t}={}){return S2(i.map(n=>{let r=e.routes[n.route.id];if(!r)return[];let o=[r.module];return r.clientActionModule&&(o=o.concat(r.clientActionModule)),r.clientLoaderModule&&(o=o.concat(r.clientLoaderModule)),t&&r.hydrateFallbackModule&&(o=o.concat(r.hydrateFallbackModule)),r.imports&&(o=o.concat(r.imports)),o}).flat(1))}function S2(i){return[...new Set(i)]}function E2(i){let e={},t=Object.keys(i).sort();for(let n of t)e[n]=i[n];return e}function N2(i,e){let t=new Set;return new Set(e),i.reduce((n,r)=>{let o=JSON.stringify(E2(r));return t.has(o)||(t.add(o),n.push({key:o,link:r})),n},[])}function oS(){let i=P.useContext(Ko);return $g(i,"You must render this element inside a <DataRouterContext.Provider> element"),i}function w2(){let i=P.useContext(Ou);return $g(i,"You must render this element inside a <DataRouterStateContext.Provider> element"),i}var Gg=P.createContext(void 0);Gg.displayName="FrameworkContext";function lS(){let i=P.useContext(Gg);return $g(i,"You must render this element inside a <HydratedRouter> element"),i}function T2(i,e){let t=P.useContext(Gg),[n,r]=P.useState(!1),[o,c]=P.useState(!1),{onFocus:d,onBlur:h,onMouseEnter:u,onMouseLeave:m,onTouchStart:g}=e,x=P.useRef(null);P.useEffect(()=>{if(i==="render"&&c(!0),i==="viewport"){let S=A=>{A.forEach(R=>{c(R.isIntersecting)})},N=new IntersectionObserver(S,{threshold:.5});return x.current&&N.observe(x.current),()=>{N.disconnect()}}},[i]),P.useEffect(()=>{if(n){let S=setTimeout(()=>{c(!0)},100);return()=>{clearTimeout(S)}}},[n]);let y=()=>{r(!0)},v=()=>{r(!1),c(!1)};return t?i!=="intent"?[o,x,{}]:[o,x,{onFocus:zl(d,y),onBlur:zl(h,v),onMouseEnter:zl(u,y),onMouseLeave:zl(m,v),onTouchStart:zl(g,y)}]:[!1,x,{}]}function zl(i,e){return t=>{i&&i(t),t.defaultPrevented||e(t)}}function A2({page:i,...e}){let{router:t}=oS(),n=P.useMemo(()=>X_(t.routes,i,t.basename),[t.routes,i,t.basename]);return n?P.createElement(C2,{page:i,matches:n,...e}):null}function j2(i){let{manifest:e,routeModules:t}=lS(),[n,r]=P.useState([]);return P.useEffect(()=>{let o=!1;return b2(i,e,t).then(c=>{o||r(c)}),()=>{o=!0}},[i,e,t]),n}function C2({page:i,matches:e,...t}){let n=ca(),{manifest:r,routeModules:o}=lS(),{basename:c}=oS(),{loaderData:d,matches:h}=w2(),u=P.useMemo(()=>Dv(i,e,h,r,n,"data"),[i,e,h,r,n]),m=P.useMemo(()=>Dv(i,e,h,r,n,"assets"),[i,e,h,r,n]),g=P.useMemo(()=>{if(i===n.pathname+n.search+n.hash)return[];let v=new Set,S=!1;if(e.forEach(A=>{let R=r.routes[A.route.id];!R||!R.hasLoader||(!u.some(C=>C.route.id===A.route.id)&&A.route.id in d&&o[A.route.id]?.shouldRevalidate||R.hasClientLoader?S=!0:v.add(A.route.id))}),v.size===0)return[];let N=x2(i,c,"data");return S&&v.size>0&&N.searchParams.set("_routes",e.filter(A=>v.has(A.route.id)).map(A=>A.route.id).join(",")),[N.pathname+N.search]},[c,d,n,r,u,e,i,o]),x=P.useMemo(()=>_2(m,r),[m,r]),y=j2(m);return P.createElement(P.Fragment,null,g.map(v=>P.createElement("link",{key:v,rel:"prefetch",as:"fetch",href:v,...t})),x.map(v=>P.createElement("link",{key:v,rel:"modulepreload",href:v,...t})),y.map(({key:v,link:S})=>P.createElement("link",{key:v,nonce:t.nonce,...S})))}function R2(...i){return e=>{i.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var cS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{cS&&(window.__reactRouterVersion="7.10.1")}catch{}function L2({basename:i,children:e,unstable_useTransitions:t,window:n}){let r=P.useRef();r.current==null&&(r.current=mT({window:n,v5Compat:!0}));let o=r.current,[c,d]=P.useState({action:o.action,location:o.location}),h=P.useCallback(u=>{t===!1?d(u):P.startTransition(()=>d(u))},[t]);return P.useLayoutEffect(()=>o.listen(h),[o,h]),P.createElement(o2,{basename:i,children:e,location:c.location,navigationType:c.action,navigator:o,unstable_useTransitions:t===!0})}var dS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Vg=P.forwardRef(function({onClick:e,discover:t="render",prefetch:n="none",relative:r,reloadDocument:o,replace:c,state:d,target:h,to:u,preventScrollReset:m,viewTransition:g,...x},y){let{basename:v,unstable_useTransitions:S}=P.useContext(ii),N=typeof u=="string"&&dS.test(u),A,R=!1;if(typeof u=="string"&&N&&(A=u,cS))try{let L=new URL(window.location.href),O=u.startsWith("//")?new URL(L.protocol+u):new URL(u),J=oa(O.pathname,v);O.origin===L.origin&&J!=null?u=J+O.search+O.hash:R=!0}catch{si(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let C=VT(u,{relative:r}),[D,V,z]=T2(n,x),B=M2(u,{replace:c,state:d,target:h,preventScrollReset:m,relative:r,viewTransition:g,unstable_useTransitions:S});function I(L){e&&e(L),L.defaultPrevented||B(L)}let M=P.createElement("a",{...x,...z,href:A||C,onClick:R||o?e:I,ref:R2(y,V),target:h,"data-discover":!N&&t==="render"?"true":void 0});return D&&!N?P.createElement(P.Fragment,null,M,P.createElement(A2,{page:C})):M});Vg.displayName="Link";var k2=P.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:n="",end:r=!1,style:o,to:c,viewTransition:d,children:h,...u},m){let g=mc(c,{relative:u.relative}),x=ca(),y=P.useContext(Ou),{navigator:v,basename:S}=P.useContext(ii),N=y!=null&&F2(g)&&d===!0,A=v.encodeLocation?v.encodeLocation(g).pathname:g.pathname,R=x.pathname,C=y&&y.navigation&&y.navigation.location?y.navigation.location.pathname:null;t||(R=R.toLowerCase(),C=C?C.toLowerCase():null,A=A.toLowerCase()),C&&S&&(C=oa(C,S)||C);const D=A!=="/"&&A.endsWith("/")?A.length-1:A.length;let V=R===A||!r&&R.startsWith(A)&&R.charAt(D)==="/",z=C!=null&&(C===A||!r&&C.startsWith(A)&&C.charAt(A.length)==="/"),B={isActive:V,isPending:z,isTransitioning:N},I=V?e:void 0,M;typeof n=="function"?M=n(B):M=[n,V?"active":null,z?"pending":null,N?"transitioning":null].filter(Boolean).join(" ");let L=typeof o=="function"?o(B):o;return P.createElement(Vg,{...u,"aria-current":I,className:M,ref:m,style:L,to:c,viewTransition:d},typeof h=="function"?h(B):h)});k2.displayName="NavLink";var D2=P.forwardRef(({discover:i="render",fetcherKey:e,navigate:t,reloadDocument:n,replace:r,state:o,method:c=tu,action:d,onSubmit:h,relative:u,preventScrollReset:m,viewTransition:g,...x},y)=>{let{unstable_useTransitions:v}=P.useContext(ii),S=B2(),N=U2(d,{relative:u}),A=c.toLowerCase()==="get"?"get":"post",R=typeof d=="string"&&dS.test(d),C=D=>{if(h&&h(D),D.defaultPrevented)return;D.preventDefault();let V=D.nativeEvent.submitter,z=V?.getAttribute("formmethod")||c,B=()=>S(V||D.currentTarget,{fetcherKey:e,method:z,navigate:t,replace:r,state:o,relative:u,preventScrollReset:m,viewTransition:g});v&&t!==!1?P.startTransition(()=>B()):B()};return P.createElement("form",{ref:y,method:A,action:N,onSubmit:n?h:C,...x,"data-discover":!R&&i==="render"?"true":void 0})});D2.displayName="Form";function I2(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function uS(i){let e=P.useContext(Ko);return ms(e,I2(i)),e}function M2(i,{target:e,replace:t,state:n,preventScrollReset:r,relative:o,viewTransition:c,unstable_useTransitions:d}={}){let h=fc(),u=ca(),m=mc(i,{relative:o});return P.useCallback(g=>{if(f2(g,e)){g.preventDefault();let x=t!==void 0?t:nc(u)===nc(m),y=()=>h(i,{replace:x,state:n,preventScrollReset:r,relative:o,viewTransition:c});d?P.startTransition(()=>y()):y()}},[u,h,m,t,n,e,i,r,o,c,d])}var O2=0,P2=()=>`__${String(++O2)}__`;function B2(){let{router:i}=uS("useSubmit"),{basename:e}=P.useContext(ii),t=s2(),n=i.fetch,r=i.navigate;return P.useCallback(async(o,c={})=>{let{action:d,method:h,encType:u,formData:m,body:g}=p2(o,e);if(c.navigate===!1){let x=c.fetcherKey||P2();await n(x,t,c.action||d,{preventScrollReset:c.preventScrollReset,formData:m,body:g,formMethod:c.method||h,formEncType:c.encType||u,flushSync:c.flushSync})}else await r(c.action||d,{preventScrollReset:c.preventScrollReset,formData:m,body:g,formMethod:c.method||h,formEncType:c.encType||u,replace:c.replace,state:c.state,fromRouteId:t,flushSync:c.flushSync,viewTransition:c.viewTransition})},[n,r,e,t])}function U2(i,{relative:e}={}){let{basename:t}=P.useContext(ii),n=P.useContext(mi);ms(n,"useFormAction must be used inside a RouteContext");let[r]=n.matches.slice(-1),o={...mc(i||".",{relative:e})},c=ca();if(i==null){o.search=c.search;let d=new URLSearchParams(o.search),h=d.getAll("index");if(h.some(m=>m==="")){d.delete("index"),h.filter(g=>g).forEach(g=>d.append("index",g));let m=d.toString();o.search=m?`?${m}`:""}}return(!i||i===".")&&r.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(o.pathname=o.pathname==="/"?t:aa([t,o.pathname])),nc(o)}function F2(i,{relative:e}={}){let t=P.useContext(tS);ms(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=uS("useViewTransitionState"),r=mc(i,{relative:e});if(!t.isTransitioning)return!1;let o=oa(t.currentLocation.pathname,n)||t.currentLocation.pathname,c=oa(t.nextLocation.pathname,n)||t.nextLocation.pathname;return xu(r.pathname,c)!=null||xu(r.pathname,o)!=null}var zo=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(i){return this.listeners.add(i),this.onSubscribe(),()=>{this.listeners.delete(i),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},$2={setTimeout:(i,e)=>setTimeout(i,e),clearTimeout:i=>clearTimeout(i),setInterval:(i,e)=>setInterval(i,e),clearInterval:i=>clearInterval(i)},G2=class{#e=$2;#t=!1;setTimeoutProvider(i){this.#e=i}setTimeout(i,e){return this.#e.setTimeout(i,e)}clearTimeout(i){this.#e.clearTimeout(i)}setInterval(i,e){return this.#e.setInterval(i,e)}clearInterval(i){this.#e.clearInterval(i)}},Nr=new G2;function V2(i){setTimeout(i,0)}var Rr=typeof window>"u"||"Deno"in globalThis;function un(){}function H2(i,e){return typeof i=="function"?i(e):i}function Km(i){return typeof i=="number"&&i>=0&&i!==1/0}function hS(i,e){return Math.max(i+(e||0)-Date.now(),0)}function Fa(i,e){return typeof i=="function"?i(e):i}function ti(i,e){return typeof i=="function"?i(e):i}function Iv(i,e){const{type:t="all",exact:n,fetchStatus:r,predicate:o,queryKey:c,stale:d}=i;if(c){if(n){if(e.queryHash!==Hg(c,e.options))return!1}else if(!ic(e.queryKey,c))return!1}if(t!=="all"){const h=e.isActive();if(t==="active"&&!h||t==="inactive"&&h)return!1}return!(typeof d=="boolean"&&e.isStale()!==d||r&&r!==e.state.fetchStatus||o&&!o(e))}function Mv(i,e){const{exact:t,status:n,predicate:r,mutationKey:o}=i;if(o){if(!e.options.mutationKey)return!1;if(t){if(Lr(e.options.mutationKey)!==Lr(o))return!1}else if(!ic(e.options.mutationKey,o))return!1}return!(n&&e.state.status!==n||r&&!r(e))}function Hg(i,e){return(e?.queryKeyHashFn||Lr)(i)}function Lr(i){return JSON.stringify(i,(e,t)=>qm(t)?Object.keys(t).sort().reduce((n,r)=>(n[r]=t[r],n),{}):t)}function ic(i,e){return i===e?!0:typeof i!=typeof e?!1:i&&e&&typeof i=="object"&&typeof e=="object"?Object.keys(e).every(t=>ic(i[t],e[t])):!1}var K2=Object.prototype.hasOwnProperty;function fS(i,e){if(i===e)return i;const t=Ov(i)&&Ov(e);if(!t&&!(qm(i)&&qm(e)))return e;const r=(t?i:Object.keys(i)).length,o=t?e:Object.keys(e),c=o.length,d=t?new Array(c):{};let h=0;for(let u=0;u<c;u++){const m=t?u:o[u],g=i[m],x=e[m];if(g===x){d[m]=g,(t?u<r:K2.call(i,m))&&h++;continue}if(g===null||x===null||typeof g!="object"||typeof x!="object"){d[m]=x;continue}const y=fS(g,x);d[m]=y,y===g&&h++}return r===c&&h===r?i:d}function yu(i,e){if(!e||Object.keys(i).length!==Object.keys(e).length)return!1;for(const t in i)if(i[t]!==e[t])return!1;return!0}function Ov(i){return Array.isArray(i)&&i.length===Object.keys(i).length}function qm(i){if(!Pv(i))return!1;const e=i.constructor;if(e===void 0)return!0;const t=e.prototype;return!(!Pv(t)||!t.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(i)!==Object.prototype)}function Pv(i){return Object.prototype.toString.call(i)==="[object Object]"}function q2(i){return new Promise(e=>{Nr.setTimeout(e,i)})}function zm(i,e,t){return typeof t.structuralSharing=="function"?t.structuralSharing(i,e):t.structuralSharing!==!1?fS(i,e):e}function z2(i,e,t=0){const n=[...i,e];return t&&n.length>t?n.slice(1):n}function Y2(i,e,t=0){const n=[e,...i];return t&&n.length>t?n.slice(0,-1):n}var Kg=Symbol();function mS(i,e){return!i.queryFn&&e?.initialPromise?()=>e.initialPromise:!i.queryFn||i.queryFn===Kg?()=>Promise.reject(new Error(`Missing queryFn: '${i.queryHash}'`)):i.queryFn}function gS(i,e){return typeof i=="function"?i(...e):!!i}var W2=class extends zo{#e;#t;#s;constructor(){super(),this.#s=i=>{if(!Rr&&window.addEventListener){const e=()=>i();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(i){this.#s=i,this.#t?.(),this.#t=i(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(i){this.#e!==i&&(this.#e=i,this.onFocus())}onFocus(){const i=this.isFocused();this.listeners.forEach(e=>{e(i)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},qg=new W2;function Ym(){let i,e;const t=new Promise((r,o)=>{i=r,e=o});t.status="pending",t.catch(()=>{});function n(r){Object.assign(t,r),delete t.resolve,delete t.reject}return t.resolve=r=>{n({status:"fulfilled",value:r}),i(r)},t.reject=r=>{n({status:"rejected",reason:r}),e(r)},t}var Q2=V2;function X2(){let i=[],e=0,t=d=>{d()},n=d=>{d()},r=Q2;const o=d=>{e?i.push(d):r(()=>{t(d)})},c=()=>{const d=i;i=[],d.length&&r(()=>{n(()=>{d.forEach(h=>{t(h)})})})};return{batch:d=>{let h;e++;try{h=d()}finally{e--,e||c()}return h},batchCalls:d=>(...h)=>{o(()=>{d(...h)})},schedule:o,setNotifyFunction:d=>{t=d},setBatchNotifyFunction:d=>{n=d},setScheduler:d=>{r=d}}}var $s=X2(),J2=class extends zo{#e=!0;#t;#s;constructor(){super(),this.#s=i=>{if(!Rr&&window.addEventListener){const e=()=>i(!0),t=()=>i(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",t,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}}}}onSubscribe(){this.#t||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(i){this.#s=i,this.#t?.(),this.#t=i(this.setOnline.bind(this))}setOnline(i){this.#e!==i&&(this.#e=i,this.listeners.forEach(t=>{t(i)}))}isOnline(){return this.#e}},vu=new J2;function Z2(i){return Math.min(1e3*2**i,3e4)}function pS(i){return(i??"online")==="online"?vu.isOnline():!0}var Wm=class extends Error{constructor(i){super("CancelledError"),this.revert=i?.revert,this.silent=i?.silent}};function xS(i){let e=!1,t=0,n;const r=Ym(),o=()=>r.status!=="pending",c=S=>{if(!o()){const N=new Wm(S);x(N),i.onCancel?.(N)}},d=()=>{e=!0},h=()=>{e=!1},u=()=>qg.isFocused()&&(i.networkMode==="always"||vu.isOnline())&&i.canRun(),m=()=>pS(i.networkMode)&&i.canRun(),g=S=>{o()||(n?.(),r.resolve(S))},x=S=>{o()||(n?.(),r.reject(S))},y=()=>new Promise(S=>{n=N=>{(o()||u())&&S(N)},i.onPause?.()}).then(()=>{n=void 0,o()||i.onContinue?.()}),v=()=>{if(o())return;let S;const N=t===0?i.initialPromise:void 0;try{S=N??i.fn()}catch(A){S=Promise.reject(A)}Promise.resolve(S).then(g).catch(A=>{if(o())return;const R=i.retry??(Rr?0:3),C=i.retryDelay??Z2,D=typeof C=="function"?C(t,A):C,V=R===!0||typeof R=="number"&&t<R||typeof R=="function"&&R(t,A);if(e||!V){x(A);return}t++,i.onFail?.(t,A),q2(D).then(()=>u()?void 0:y()).then(()=>{e?x(A):v()})})};return{promise:r,status:()=>r.status,cancel:c,continue:()=>(n?.(),r),cancelRetry:d,continueRetry:h,canStart:m,start:()=>(m()?v():y().then(v),r)}}var yS=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Km(this.gcTime)&&(this.#e=Nr.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(i){this.gcTime=Math.max(this.gcTime||0,i??(Rr?1/0:300*1e3))}clearGcTimeout(){this.#e&&(Nr.clearTimeout(this.#e),this.#e=void 0)}},eA=class extends yS{#e;#t;#s;#i;#n;#r;#o;constructor(i){super(),this.#o=!1,this.#r=i.defaultOptions,this.setOptions(i.options),this.observers=[],this.#i=i.client,this.#s=this.#i.getQueryCache(),this.queryKey=i.queryKey,this.queryHash=i.queryHash,this.#e=Uv(this.options),this.state=i.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#n?.promise}setOptions(i){if(this.options={...this.#r,...i},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const e=Uv(this.options);e.data!==void 0&&(this.setState(Bv(e.data,e.dataUpdatedAt)),this.#e=e)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#s.remove(this)}setData(i,e){const t=zm(this.state.data,i,this.options);return this.#a({data:t,type:"success",dataUpdatedAt:e?.updatedAt,manual:e?.manual}),t}setState(i,e){this.#a({type:"setState",state:i,setStateOptions:e})}cancel(i){const e=this.#n?.promise;return this.#n?.cancel(i),e?e.then(un).catch(un):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(i=>ti(i.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Kg||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(i=>Fa(i.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(i=>i.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(i=0){return this.state.data===void 0?!0:i==="static"?!1:this.state.isInvalidated?!0:!hS(this.state.dataUpdatedAt,i)}onFocus(){this.observers.find(e=>e.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#n?.continue()}onOnline(){this.observers.find(e=>e.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#n?.continue()}addObserver(i){this.observers.includes(i)||(this.observers.push(i),this.clearGcTimeout(),this.#s.notify({type:"observerAdded",query:this,observer:i}))}removeObserver(i){this.observers.includes(i)&&(this.observers=this.observers.filter(e=>e!==i),this.observers.length||(this.#n&&(this.#o?this.#n.cancel({revert:!0}):this.#n.cancelRetry()),this.scheduleGc()),this.#s.notify({type:"observerRemoved",query:this,observer:i}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#a({type:"invalidate"})}async fetch(i,e){if(this.state.fetchStatus!=="idle"&&this.#n?.status()!=="rejected"){if(this.state.data!==void 0&&e?.cancelRefetch)this.cancel({silent:!0});else if(this.#n)return this.#n.continueRetry(),this.#n.promise}if(i&&this.setOptions(i),!this.options.queryFn){const d=this.observers.find(h=>h.options.queryFn);d&&this.setOptions(d.options)}const t=new AbortController,n=d=>{Object.defineProperty(d,"signal",{enumerable:!0,get:()=>(this.#o=!0,t.signal)})},r=()=>{const d=mS(this.options,e),u=(()=>{const m={client:this.#i,queryKey:this.queryKey,meta:this.meta};return n(m),m})();return this.#o=!1,this.options.persister?this.options.persister(d,u,this):d(u)},c=(()=>{const d={fetchOptions:e,options:this.options,queryKey:this.queryKey,client:this.#i,state:this.state,fetchFn:r};return n(d),d})();this.options.behavior?.onFetch(c,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==c.fetchOptions?.meta)&&this.#a({type:"fetch",meta:c.fetchOptions?.meta}),this.#n=xS({initialPromise:e?.initialPromise,fn:c.fetchFn,onCancel:d=>{d instanceof Wm&&d.revert&&this.setState({...this.#t,fetchStatus:"idle"}),t.abort()},onFail:(d,h)=>{this.#a({type:"failed",failureCount:d,error:h})},onPause:()=>{this.#a({type:"pause"})},onContinue:()=>{this.#a({type:"continue"})},retry:c.options.retry,retryDelay:c.options.retryDelay,networkMode:c.options.networkMode,canRun:()=>!0});try{const d=await this.#n.start();if(d===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(d),this.#s.config.onSuccess?.(d,this),this.#s.config.onSettled?.(d,this.state.error,this),d}catch(d){if(d instanceof Wm){if(d.silent)return this.#n.promise;if(d.revert){if(this.state.data===void 0)throw d;return this.state.data}}throw this.#a({type:"error",error:d}),this.#s.config.onError?.(d,this),this.#s.config.onSettled?.(this.state.data,d,this),d}finally{this.scheduleGc()}}#a(i){const e=t=>{switch(i.type){case"failed":return{...t,fetchFailureCount:i.failureCount,fetchFailureReason:i.error};case"pause":return{...t,fetchStatus:"paused"};case"continue":return{...t,fetchStatus:"fetching"};case"fetch":return{...t,...vS(t.data,this.options),fetchMeta:i.meta??null};case"success":const n={...t,...Bv(i.data,i.dataUpdatedAt),dataUpdateCount:t.dataUpdateCount+1,...!i.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=i.manual?n:void 0,n;case"error":const r=i.error;return{...t,error:r,errorUpdateCount:t.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:t.fetchFailureCount+1,fetchFailureReason:r,fetchStatus:"idle",status:"error"};case"invalidate":return{...t,isInvalidated:!0};case"setState":return{...t,...i.state}}};this.state=e(this.state),$s.batch(()=>{this.observers.forEach(t=>{t.onQueryUpdate()}),this.#s.notify({query:this,type:"updated",action:i})})}};function vS(i,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:pS(e.networkMode)?"fetching":"paused",...i===void 0&&{error:null,status:"pending"}}}function Bv(i,e){return{data:i,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function Uv(i){const e=typeof i.initialData=="function"?i.initialData():i.initialData,t=e!==void 0,n=t?typeof i.initialDataUpdatedAt=="function"?i.initialDataUpdatedAt():i.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:t?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}var tA=class extends zo{constructor(i,e){super(),this.options=e,this.#e=i,this.#a=null,this.#o=Ym(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#s=void 0;#i=void 0;#n;#r;#o;#a;#g;#h;#f;#c;#d;#l;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),Fv(this.#t,this.options)?this.#u():this.updateResult(),this.#v())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Qm(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Qm(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#b(),this.#_(),this.#t.removeObserver(this)}setOptions(i){const e=this.options,t=this.#t;if(this.options=this.#e.defaultQueryOptions(i),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof ti(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#S(),this.#t.setOptions(this.options),e._defaulted&&!yu(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const n=this.hasListeners();n&&$v(this.#t,t,this.options,e)&&this.#u(),this.updateResult(),n&&(this.#t!==t||ti(this.options.enabled,this.#t)!==ti(e.enabled,this.#t)||Fa(this.options.staleTime,this.#t)!==Fa(e.staleTime,this.#t))&&this.#p();const r=this.#x();n&&(this.#t!==t||ti(this.options.enabled,this.#t)!==ti(e.enabled,this.#t)||r!==this.#l)&&this.#y(r)}getOptimisticResult(i){const e=this.#e.getQueryCache().build(this.#e,i),t=this.createResult(e,i);return nA(this,t)&&(this.#i=t,this.#r=this.options,this.#n=this.#t.state),t}getCurrentResult(){return this.#i}trackResult(i,e){return new Proxy(i,{get:(t,n)=>(this.trackProp(n),e?.(n),n==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(t,n))})}trackProp(i){this.#m.add(i)}getCurrentQuery(){return this.#t}refetch({...i}={}){return this.fetch({...i})}fetchOptimistic(i){const e=this.#e.defaultQueryOptions(i),t=this.#e.getQueryCache().build(this.#e,e);return t.fetch().then(()=>this.createResult(t,e))}fetch(i){return this.#u({...i,cancelRefetch:i.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#i))}#u(i){this.#S();let e=this.#t.fetch(this.options,i);return i?.throwOnError||(e=e.catch(un)),e}#p(){this.#b();const i=Fa(this.options.staleTime,this.#t);if(Rr||this.#i.isStale||!Km(i))return;const t=hS(this.#i.dataUpdatedAt,i)+1;this.#c=Nr.setTimeout(()=>{this.#i.isStale||this.updateResult()},t)}#x(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#y(i){this.#_(),this.#l=i,!(Rr||ti(this.options.enabled,this.#t)===!1||!Km(this.#l)||this.#l===0)&&(this.#d=Nr.setInterval(()=>{(this.options.refetchIntervalInBackground||qg.isFocused())&&this.#u()},this.#l))}#v(){this.#p(),this.#y(this.#x())}#b(){this.#c&&(Nr.clearTimeout(this.#c),this.#c=void 0)}#_(){this.#d&&(Nr.clearInterval(this.#d),this.#d=void 0)}createResult(i,e){const t=this.#t,n=this.options,r=this.#i,o=this.#n,c=this.#r,h=i!==t?i.state:this.#s,{state:u}=i;let m={...u},g=!1,x;if(e._optimisticResults){const I=this.hasListeners(),M=!I&&Fv(i,e),L=I&&$v(i,t,e,n);(M||L)&&(m={...m,...vS(u.data,i.options)}),e._optimisticResults==="isRestoring"&&(m.fetchStatus="idle")}let{error:y,errorUpdatedAt:v,status:S}=m;x=m.data;let N=!1;if(e.placeholderData!==void 0&&x===void 0&&S==="pending"){let I;r?.isPlaceholderData&&e.placeholderData===c?.placeholderData?(I=r.data,N=!0):I=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,I!==void 0&&(S="success",x=zm(r?.data,I,e),g=!0)}if(e.select&&x!==void 0&&!N)if(r&&x===o?.data&&e.select===this.#g)x=this.#h;else try{this.#g=e.select,x=e.select(x),x=zm(r?.data,x,e),this.#h=x,this.#a=null}catch(I){this.#a=I}this.#a&&(y=this.#a,x=this.#h,v=Date.now(),S="error");const A=m.fetchStatus==="fetching",R=S==="pending",C=S==="error",D=R&&A,V=x!==void 0,B={status:S,fetchStatus:m.fetchStatus,isPending:R,isSuccess:S==="success",isError:C,isInitialLoading:D,isLoading:D,data:x,dataUpdatedAt:m.dataUpdatedAt,error:y,errorUpdatedAt:v,failureCount:m.fetchFailureCount,failureReason:m.fetchFailureReason,errorUpdateCount:m.errorUpdateCount,isFetched:m.dataUpdateCount>0||m.errorUpdateCount>0,isFetchedAfterMount:m.dataUpdateCount>h.dataUpdateCount||m.errorUpdateCount>h.errorUpdateCount,isFetching:A,isRefetching:A&&!R,isLoadingError:C&&!V,isPaused:m.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:C&&V,isStale:zg(i,e),refetch:this.refetch,promise:this.#o,isEnabled:ti(e.enabled,i)!==!1};if(this.options.experimental_prefetchInRender){const I=O=>{B.status==="error"?O.reject(B.error):B.data!==void 0&&O.resolve(B.data)},M=()=>{const O=this.#o=B.promise=Ym();I(O)},L=this.#o;switch(L.status){case"pending":i.queryHash===t.queryHash&&I(L);break;case"fulfilled":(B.status==="error"||B.data!==L.value)&&M();break;case"rejected":(B.status!=="error"||B.error!==L.reason)&&M();break}}return B}updateResult(){const i=this.#i,e=this.createResult(this.#t,this.options);if(this.#n=this.#t.state,this.#r=this.options,this.#n.data!==void 0&&(this.#f=this.#t),yu(e,i))return;this.#i=e;const t=()=>{if(!i)return!0;const{notifyOnChangeProps:n}=this.options,r=typeof n=="function"?n():n;if(r==="all"||!r&&!this.#m.size)return!0;const o=new Set(r??this.#m);return this.options.throwOnError&&o.add("error"),Object.keys(this.#i).some(c=>{const d=c;return this.#i[d]!==i[d]&&o.has(d)})};this.#E({listeners:t()})}#S(){const i=this.#e.getQueryCache().build(this.#e,this.options);if(i===this.#t)return;const e=this.#t;this.#t=i,this.#s=i.state,this.hasListeners()&&(e?.removeObserver(this),i.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#v()}#E(i){$s.batch(()=>{i.listeners&&this.listeners.forEach(e=>{e(this.#i)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function sA(i,e){return ti(e.enabled,i)!==!1&&i.state.data===void 0&&!(i.state.status==="error"&&e.retryOnMount===!1)}function Fv(i,e){return sA(i,e)||i.state.data!==void 0&&Qm(i,e,e.refetchOnMount)}function Qm(i,e,t){if(ti(e.enabled,i)!==!1&&Fa(e.staleTime,i)!=="static"){const n=typeof t=="function"?t(i):t;return n==="always"||n!==!1&&zg(i,e)}return!1}function $v(i,e,t,n){return(i!==e||ti(n.enabled,i)===!1)&&(!t.suspense||i.state.status!=="error")&&zg(i,t)}function zg(i,e){return ti(e.enabled,i)!==!1&&i.isStaleByTime(Fa(e.staleTime,i))}function nA(i,e){return!yu(i.getCurrentResult(),e)}function Gv(i){return{onFetch:(e,t)=>{const n=e.options,r=e.fetchOptions?.meta?.fetchMore?.direction,o=e.state.data?.pages||[],c=e.state.data?.pageParams||[];let d={pages:[],pageParams:[]},h=0;const u=async()=>{let m=!1;const g=v=>{Object.defineProperty(v,"signal",{enumerable:!0,get:()=>(e.signal.aborted?m=!0:e.signal.addEventListener("abort",()=>{m=!0}),e.signal)})},x=mS(e.options,e.fetchOptions),y=async(v,S,N)=>{if(m)return Promise.reject();if(S==null&&v.pages.length)return Promise.resolve(v);const R=(()=>{const z={client:e.client,queryKey:e.queryKey,pageParam:S,direction:N?"backward":"forward",meta:e.options.meta};return g(z),z})(),C=await x(R),{maxPages:D}=e.options,V=N?Y2:z2;return{pages:V(v.pages,C,D),pageParams:V(v.pageParams,S,D)}};if(r&&o.length){const v=r==="backward",S=v?iA:Vv,N={pages:o,pageParams:c},A=S(n,N);d=await y(N,A,v)}else{const v=i??o.length;do{const S=h===0?c[0]??n.initialPageParam:Vv(n,d);if(h>0&&S==null)break;d=await y(d,S),h++}while(h<v)}return d};e.options.persister?e.fetchFn=()=>e.options.persister?.(u,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t):e.fetchFn=u}}}function Vv(i,{pages:e,pageParams:t}){const n=e.length-1;return e.length>0?i.getNextPageParam(e[n],e,t[n],t):void 0}function iA(i,{pages:e,pageParams:t}){return e.length>0?i.getPreviousPageParam?.(e[0],e,t[0],t):void 0}var aA=class extends yS{#e;#t;#s;#i;constructor(i){super(),this.#e=i.client,this.mutationId=i.mutationId,this.#s=i.mutationCache,this.#t=[],this.state=i.state||bS(),this.setOptions(i.options),this.scheduleGc()}setOptions(i){this.options=i,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(i){this.#t.includes(i)||(this.#t.push(i),this.clearGcTimeout(),this.#s.notify({type:"observerAdded",mutation:this,observer:i}))}removeObserver(i){this.#t=this.#t.filter(e=>e!==i),this.scheduleGc(),this.#s.notify({type:"observerRemoved",mutation:this,observer:i})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#s.remove(this))}continue(){return this.#i?.continue()??this.execute(this.state.variables)}async execute(i){const e=()=>{this.#n({type:"continue"})},t={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#i=xS({fn:()=>this.options.mutationFn?this.options.mutationFn(i,t):Promise.reject(new Error("No mutationFn found")),onFail:(o,c)=>{this.#n({type:"failed",failureCount:o,error:c})},onPause:()=>{this.#n({type:"pause"})},onContinue:e,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#s.canRun(this)});const n=this.state.status==="pending",r=!this.#i.canStart();try{if(n)e();else{this.#n({type:"pending",variables:i,isPaused:r}),await this.#s.config.onMutate?.(i,this,t);const c=await this.options.onMutate?.(i,t);c!==this.state.context&&this.#n({type:"pending",context:c,variables:i,isPaused:r})}const o=await this.#i.start();return await this.#s.config.onSuccess?.(o,i,this.state.context,this,t),await this.options.onSuccess?.(o,i,this.state.context,t),await this.#s.config.onSettled?.(o,null,this.state.variables,this.state.context,this,t),await this.options.onSettled?.(o,null,i,this.state.context,t),this.#n({type:"success",data:o}),o}catch(o){try{throw await this.#s.config.onError?.(o,i,this.state.context,this,t),await this.options.onError?.(o,i,this.state.context,t),await this.#s.config.onSettled?.(void 0,o,this.state.variables,this.state.context,this,t),await this.options.onSettled?.(void 0,o,i,this.state.context,t),o}finally{this.#n({type:"error",error:o})}}finally{this.#s.runNext(this)}}#n(i){const e=t=>{switch(i.type){case"failed":return{...t,failureCount:i.failureCount,failureReason:i.error};case"pause":return{...t,isPaused:!0};case"continue":return{...t,isPaused:!1};case"pending":return{...t,context:i.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:i.isPaused,status:"pending",variables:i.variables,submittedAt:Date.now()};case"success":return{...t,data:i.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...t,data:void 0,error:i.error,failureCount:t.failureCount+1,failureReason:i.error,isPaused:!1,status:"error"}}};this.state=e(this.state),$s.batch(()=>{this.#t.forEach(t=>{t.onMutationUpdate(i)}),this.#s.notify({mutation:this,type:"updated",action:i})})}};function bS(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var rA=class extends zo{constructor(i={}){super(),this.config=i,this.#e=new Set,this.#t=new Map,this.#s=0}#e;#t;#s;build(i,e,t){const n=new aA({client:i,mutationCache:this,mutationId:++this.#s,options:i.defaultMutationOptions(e),state:t});return this.add(n),n}add(i){this.#e.add(i);const e=Dd(i);if(typeof e=="string"){const t=this.#t.get(e);t?t.push(i):this.#t.set(e,[i])}this.notify({type:"added",mutation:i})}remove(i){if(this.#e.delete(i)){const e=Dd(i);if(typeof e=="string"){const t=this.#t.get(e);if(t)if(t.length>1){const n=t.indexOf(i);n!==-1&&t.splice(n,1)}else t[0]===i&&this.#t.delete(e)}}this.notify({type:"removed",mutation:i})}canRun(i){const e=Dd(i);if(typeof e=="string"){const n=this.#t.get(e)?.find(r=>r.state.status==="pending");return!n||n===i}else return!0}runNext(i){const e=Dd(i);return typeof e=="string"?this.#t.get(e)?.find(n=>n!==i&&n.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){$s.batch(()=>{this.#e.forEach(i=>{this.notify({type:"removed",mutation:i})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(i){const e={exact:!0,...i};return this.getAll().find(t=>Mv(e,t))}findAll(i={}){return this.getAll().filter(e=>Mv(i,e))}notify(i){$s.batch(()=>{this.listeners.forEach(e=>{e(i)})})}resumePausedMutations(){const i=this.getAll().filter(e=>e.state.isPaused);return $s.batch(()=>Promise.all(i.map(e=>e.continue().catch(un))))}};function Dd(i){return i.options.scope?.id}var oA=class extends zo{#e;#t=void 0;#s;#i;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#n()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const t=this.options;this.options=this.#e.defaultMutationOptions(e),yu(this.options,t)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#s,observer:this}),t?.mutationKey&&this.options.mutationKey&&Lr(t.mutationKey)!==Lr(this.options.mutationKey)?this.reset():this.#s?.state.status==="pending"&&this.#s.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#s?.removeObserver(this)}onMutationUpdate(e){this.#n(),this.#r(e)}getCurrentResult(){return this.#t}reset(){this.#s?.removeObserver(this),this.#s=void 0,this.#n(),this.#r()}mutate(e,t){return this.#i=t,this.#s?.removeObserver(this),this.#s=this.#e.getMutationCache().build(this.#e,this.options),this.#s.addObserver(this),this.#s.execute(e)}#n(){const e=this.#s?.state??bS();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#r(e){$s.batch(()=>{if(this.#i&&this.hasListeners()){const t=this.#t.variables,n=this.#t.context,r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#i.onSuccess?.(e.data,t,n,r),this.#i.onSettled?.(e.data,null,t,n,r)):e?.type==="error"&&(this.#i.onError?.(e.error,t,n,r),this.#i.onSettled?.(void 0,e.error,t,n,r))}this.listeners.forEach(t=>{t(this.#t)})})}},lA=class extends zo{constructor(i={}){super(),this.config=i,this.#e=new Map}#e;build(i,e,t){const n=e.queryKey,r=e.queryHash??Hg(n,e);let o=this.get(r);return o||(o=new eA({client:i,queryKey:n,queryHash:r,options:i.defaultQueryOptions(e),state:t,defaultOptions:i.getQueryDefaults(n)}),this.add(o)),o}add(i){this.#e.has(i.queryHash)||(this.#e.set(i.queryHash,i),this.notify({type:"added",query:i}))}remove(i){const e=this.#e.get(i.queryHash);e&&(i.destroy(),e===i&&this.#e.delete(i.queryHash),this.notify({type:"removed",query:i}))}clear(){$s.batch(()=>{this.getAll().forEach(i=>{this.remove(i)})})}get(i){return this.#e.get(i)}getAll(){return[...this.#e.values()]}find(i){const e={exact:!0,...i};return this.getAll().find(t=>Iv(e,t))}findAll(i={}){const e=this.getAll();return Object.keys(i).length>0?e.filter(t=>Iv(i,t)):e}notify(i){$s.batch(()=>{this.listeners.forEach(e=>{e(i)})})}onFocus(){$s.batch(()=>{this.getAll().forEach(i=>{i.onFocus()})})}onOnline(){$s.batch(()=>{this.getAll().forEach(i=>{i.onOnline()})})}},cA=class{#e;#t;#s;#i;#n;#r;#o;#a;constructor(i={}){this.#e=i.queryCache||new lA,this.#t=i.mutationCache||new rA,this.#s=i.defaultOptions||{},this.#i=new Map,this.#n=new Map,this.#r=0}mount(){this.#r++,this.#r===1&&(this.#o=qg.subscribe(async i=>{i&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#a=vu.subscribe(async i=>{i&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#r--,this.#r===0&&(this.#o?.(),this.#o=void 0,this.#a?.(),this.#a=void 0)}isFetching(i){return this.#e.findAll({...i,fetchStatus:"fetching"}).length}isMutating(i){return this.#t.findAll({...i,status:"pending"}).length}getQueryData(i){const e=this.defaultQueryOptions({queryKey:i});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(i){const e=this.defaultQueryOptions(i),t=this.#e.build(this,e),n=t.state.data;return n===void 0?this.fetchQuery(i):(i.revalidateIfStale&&t.isStaleByTime(Fa(e.staleTime,t))&&this.prefetchQuery(e),Promise.resolve(n))}getQueriesData(i){return this.#e.findAll(i).map(({queryKey:e,state:t})=>{const n=t.data;return[e,n]})}setQueryData(i,e,t){const n=this.defaultQueryOptions({queryKey:i}),o=this.#e.get(n.queryHash)?.state.data,c=H2(e,o);if(c!==void 0)return this.#e.build(this,n).setData(c,{...t,manual:!0})}setQueriesData(i,e,t){return $s.batch(()=>this.#e.findAll(i).map(({queryKey:n})=>[n,this.setQueryData(n,e,t)]))}getQueryState(i){const e=this.defaultQueryOptions({queryKey:i});return this.#e.get(e.queryHash)?.state}removeQueries(i){const e=this.#e;$s.batch(()=>{e.findAll(i).forEach(t=>{e.remove(t)})})}resetQueries(i,e){const t=this.#e;return $s.batch(()=>(t.findAll(i).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...i},e)))}cancelQueries(i,e={}){const t={revert:!0,...e},n=$s.batch(()=>this.#e.findAll(i).map(r=>r.cancel(t)));return Promise.all(n).then(un).catch(un)}invalidateQueries(i,e={}){return $s.batch(()=>(this.#e.findAll(i).forEach(t=>{t.invalidate()}),i?.refetchType==="none"?Promise.resolve():this.refetchQueries({...i,type:i?.refetchType??i?.type??"active"},e)))}refetchQueries(i,e={}){const t={...e,cancelRefetch:e.cancelRefetch??!0},n=$s.batch(()=>this.#e.findAll(i).filter(r=>!r.isDisabled()&&!r.isStatic()).map(r=>{let o=r.fetch(void 0,t);return t.throwOnError||(o=o.catch(un)),r.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(n).then(un)}fetchQuery(i){const e=this.defaultQueryOptions(i);e.retry===void 0&&(e.retry=!1);const t=this.#e.build(this,e);return t.isStaleByTime(Fa(e.staleTime,t))?t.fetch(e):Promise.resolve(t.state.data)}prefetchQuery(i){return this.fetchQuery(i).then(un).catch(un)}fetchInfiniteQuery(i){return i.behavior=Gv(i.pages),this.fetchQuery(i)}prefetchInfiniteQuery(i){return this.fetchInfiniteQuery(i).then(un).catch(un)}ensureInfiniteQueryData(i){return i.behavior=Gv(i.pages),this.ensureQueryData(i)}resumePausedMutations(){return vu.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#s}setDefaultOptions(i){this.#s=i}setQueryDefaults(i,e){this.#i.set(Lr(i),{queryKey:i,defaultOptions:e})}getQueryDefaults(i){const e=[...this.#i.values()],t={};return e.forEach(n=>{ic(i,n.queryKey)&&Object.assign(t,n.defaultOptions)}),t}setMutationDefaults(i,e){this.#n.set(Lr(i),{mutationKey:i,defaultOptions:e})}getMutationDefaults(i){const e=[...this.#n.values()],t={};return e.forEach(n=>{ic(i,n.mutationKey)&&Object.assign(t,n.defaultOptions)}),t}defaultQueryOptions(i){if(i._defaulted)return i;const e={...this.#s.queries,...this.getQueryDefaults(i.queryKey),...i,_defaulted:!0};return e.queryHash||(e.queryHash=Hg(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===Kg&&(e.enabled=!1),e}defaultMutationOptions(i){return i?._defaulted?i:{...this.#s.mutations,...i?.mutationKey&&this.getMutationDefaults(i.mutationKey),...i,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},_S=P.createContext(void 0),ft=i=>{const e=P.useContext(_S);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},dA=({client:i,children:e})=>(P.useEffect(()=>(i.mount(),()=>{i.unmount()}),[i]),s.jsx(_S.Provider,{value:i,children:e})),SS=P.createContext(!1),uA=()=>P.useContext(SS);SS.Provider;function hA(){let i=!1;return{clearReset:()=>{i=!1},reset:()=>{i=!0},isReset:()=>i}}var fA=P.createContext(hA()),mA=()=>P.useContext(fA),gA=(i,e)=>{(i.suspense||i.throwOnError||i.experimental_prefetchInRender)&&(e.isReset()||(i.retryOnMount=!1))},pA=i=>{P.useEffect(()=>{i.clearReset()},[i])},xA=({result:i,errorResetBoundary:e,throwOnError:t,query:n,suspense:r})=>i.isError&&!e.isReset()&&!i.isFetching&&n&&(r&&i.data===void 0||gS(t,[i.error,n])),yA=i=>{if(i.suspense){const t=r=>r==="static"?r:Math.max(r??1e3,1e3),n=i.staleTime;i.staleTime=typeof n=="function"?(...r)=>t(n(...r)):t(n),typeof i.gcTime=="number"&&(i.gcTime=Math.max(i.gcTime,1e3))}},vA=(i,e)=>i.isLoading&&i.isFetching&&!e,bA=(i,e)=>i?.suspense&&e.isPending,Hv=(i,e,t)=>e.fetchOptimistic(i).catch(()=>{t.clearReset()});function _A(i,e,t){const n=uA(),r=mA(),o=ft(),c=o.defaultQueryOptions(i);o.getDefaultOptions().queries?._experimental_beforeQuery?.(c),c._optimisticResults=n?"isRestoring":"optimistic",yA(c),gA(c,r),pA(r);const d=!o.getQueryCache().get(c.queryHash),[h]=P.useState(()=>new e(o,c)),u=h.getOptimisticResult(c),m=!n&&i.subscribed!==!1;if(P.useSyncExternalStore(P.useCallback(g=>{const x=m?h.subscribe($s.batchCalls(g)):un;return h.updateResult(),x},[h,m]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),P.useEffect(()=>{h.setOptions(c)},[c,h]),bA(c,u))throw Hv(c,h,r);if(xA({result:u,errorResetBoundary:r,throwOnError:c.throwOnError,query:o.getQueryCache().get(c.queryHash),suspense:c.suspense}))throw u.error;return o.getDefaultOptions().queries?._experimental_afterQuery?.(c,u),c.experimental_prefetchInRender&&!Rr&&vA(u,n)&&(d?Hv(c,h,r):o.getQueryCache().get(c.queryHash)?.promise)?.catch(un).finally(()=>{h.updateResult()}),c.notifyOnChangeProps?u:h.trackResult(u)}function qe(i,e){return _A(i,tA)}function Ve(i,e){const t=ft(),[n]=P.useState(()=>new oA(t,i));P.useEffect(()=>{n.setOptions(i)},[n,i]);const r=P.useSyncExternalStore(P.useCallback(c=>n.subscribe($s.batchCalls(c)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),o=P.useCallback((c,d)=>{n.mutate(c,d).catch(un)},[n]);if(r.error&&gS(n.options.throwOnError,[r.error]))throw r.error;return{...r,mutate:o,mutateAsync:r.mutate}}const SA=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),EA=i=>i.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),Kv=i=>{const e=EA(i);return e.charAt(0).toUpperCase()+e.slice(1)},ES=(...i)=>i.filter((e,t,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===t).join(" ").trim(),NA=i=>{for(const e in i)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};var wA={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const TA=P.forwardRef(({color:i="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:r="",children:o,iconNode:c,...d},h)=>P.createElement("svg",{ref:h,...wA,width:e,height:e,stroke:i,strokeWidth:n?Number(t)*24/Number(e):t,className:ES("lucide",r),...!o&&!NA(d)&&{"aria-hidden":"true"},...d},[...c.map(([u,m])=>P.createElement(u,m)),...Array.isArray(o)?o:[o]]));const Oe=(i,e)=>{const t=P.forwardRef(({className:n,...r},o)=>P.createElement(TA,{ref:o,iconNode:e,className:ES(`lucide-${SA(Kv(i))}`,`lucide-${i}`,n),...r}));return t.displayName=Kv(i),t};const AA=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Do=Oe("activity",AA);const jA=[["path",{d:"M12 6.528V3a1 1 0 0 1 1-1h0",key:"11qiee"}],["path",{d:"M18.237 21A15 15 0 0 0 22 11a6 6 0 0 0-10-4.472A6 6 0 0 0 2 11a15.1 15.1 0 0 0 3.763 10 3 3 0 0 0 3.648.648 5.5 5.5 0 0 1 5.178 0A3 3 0 0 0 18.237 21",key:"110c12"}]],Xm=Oe("apple",jA);const CA=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],RA=Oe("archive",CA);const LA=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],Bu=Oe("arrow-down",LA);const kA=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Yg=Oe("arrow-left",kA);const DA=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Jm=Oe("arrow-right",DA);const IA=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],Wg=Oe("arrow-up",IA);const MA=[["path",{d:"M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5",key:"1u7htd"}],["path",{d:"M15 12h.01",key:"1k8ypt"}],["path",{d:"M19.38 6.813A9 9 0 0 1 20.8 10.2a2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1",key:"11xh7x"}],["path",{d:"M9 12h.01",key:"157uk2"}]],NS=Oe("baby",MA);const OA=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],PA=Oe("calendar-days",OA);const BA=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Ci=Oe("calendar",BA);const UA=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],qs=Oe("check",UA);const FA=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Uu=Oe("chevron-down",FA);const $A=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Qg=Oe("chevron-left",$A);const GA=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Va=Oe("chevron-right",GA);const VA=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Xg=Oe("chevron-up",VA);const HA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Ct=Oe("circle-alert",HA);const KA=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],vs=Oe("circle-check-big",KA);const qA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Ua=Oe("circle-check",qA);const zA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]],kr=Oe("circle-dot",zA);const YA=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],WA=Oe("circle-play",YA);const QA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],gc=Oe("circle-x",QA);const XA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Io=Oe("circle",XA);const JA=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ts=Oe("clock",JA);const ZA=[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]],ej=Oe("cloud-download",ZA);const tj=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],sj=Oe("copy",tj);const nj=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],Ar=Oe("cpu",nj);const ij=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 12a9 3 0 0 0 5 2.69",key:"1ui2ym"}],["path",{d:"M21 9.3V5",key:"6k6cib"}],["path",{d:"M3 5v14a9 3 0 0 0 6.47 2.88",key:"i62tjy"}],["path",{d:"M12 12v4h4",key:"1bxaet"}],["path",{d:"M13 20a5 5 0 0 0 9-3 4.5 4.5 0 0 0-4.5-4.5c-1.33 0-2.54.54-3.41 1.41L12 16",key:"1f4ei9"}]],aj=Oe("database-backup",ij);const rj=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],qv=Oe("database",rj);const oj=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Os=Oe("download",oj);const lj=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],wS=Oe("eye",lj);const cj=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M15.033 13.44a.647.647 0 0 1 0 1.12l-4.065 2.352a.645.645 0 0 1-.968-.56v-4.704a.645.645 0 0 1 .967-.56z",key:"1tzo1f"}]],dj=Oe("file-play",cj);const uj=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Fn=Oe("file-text",uj);const hj=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]],TS=Oe("file",hj);const fj=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]],fn=Oe("film",fj);const mj=[["path",{d:"M10.638 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v3.417",key:"10r6g4"}],["path",{d:"M14.62 18.8A2.25 2.25 0 1 1 18 15.836a2.25 2.25 0 1 1 3.38 2.966l-2.626 2.856a.998.998 0 0 1-1.507 0z",key:"15cy7q"}]],gj=Oe("folder-heart",mj);const pj=[["path",{d:"M2 9V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-1",key:"fm4g5t"}],["path",{d:"M2 13h10",key:"pgb2dq"}],["path",{d:"m9 16 3-3-3-3",key:"6m91ic"}]],Co=Oe("folder-input",pj);const xj=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],mn=Oe("folder-open",xj);const yj=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],AS=Oe("folder-plus",yj);const vj=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],bj=Oe("folder",vj);const _j=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Sj=Oe("funnel",_j);const Ej=[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]],Zm=Oe("gauge",Ej);const Nj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],wj=Oe("globe",Nj);const Tj=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],Aj=Oe("grip-vertical",Tj);const jj=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],Li=Oe("hard-drive",jj);const Cj=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Jg=Oe("hash",Cj);const Rj=[["path",{d:"M10.5 4.893a5.5 5.5 0 0 1 1.091.931.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 1.872-1.002 3.356-2.187 4.655",key:"1inpfl"}],["path",{d:"m16.967 16.967-3.459 3.346a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5a5.5 5.5 0 0 1 2.747-4.761",key:"vbc6x7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Lj=Oe("heart-off",Rj);const kj=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Dj=Oe("heart",kj);const Ij=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],Mj=Oe("house",Ij);const Oj=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Dr=Oe("image",Oj);const Pj=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Ha=Oe("layers",Pj);const Bj=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],Uj=Oe("layout-dashboard",Bj);const Fj=[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]],$j=Oe("library",Fj);const Gj=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Id=Oe("link-2",Gj);const Vj=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],Hj=Oe("link",Vj);const Kj=[["path",{d:"M11 5h10",key:"1cz7ny"}],["path",{d:"M11 12h10",key:"1438ji"}],["path",{d:"M11 19h10",key:"11t30w"}],["path",{d:"M4 4h1v5",key:"10yrso"}],["path",{d:"M4 9h2",key:"r1h2o0"}],["path",{d:"M6.5 20H3.4c0-1 2.6-1.925 2.6-3.5a1.5 1.5 0 0 0-2.6-1.02",key:"xtkcd5"}]],Zg=Oe("list-ordered",Kj);const qj=[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["rect",{x:"3",y:"4",width:"6",height:"6",rx:"1",key:"cif1o7"}]],eg=Oe("list-todo",qj);const zj=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],ia=Oe("loader-circle",zj);const Yj=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],nt=Oe("loader",Yj);const Wj=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Qj=Oe("log-out",Wj);const Xj=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Jj=Oe("map-pin",Xj);const Zj=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],e0=Oe("maximize",Zj);const eC=[["path",{d:"M12 12v-2",key:"fwoke6"}],["path",{d:"M12 18v-2",key:"qj6yno"}],["path",{d:"M16 12v-2",key:"heuere"}],["path",{d:"M16 18v-2",key:"s1ct0w"}],["path",{d:"M2 11h1.5",key:"15p63e"}],["path",{d:"M20 18v-2",key:"12ehxp"}],["path",{d:"M20.5 11H22",key:"khsy7a"}],["path",{d:"M4 18v-2",key:"1c3oqr"}],["path",{d:"M8 12v-2",key:"1mwtfd"}],["path",{d:"M8 18v-2",key:"qcmpov"}],["rect",{x:"2",y:"6",width:"20",height:"10",rx:"2",key:"1qcswk"}]],tC=Oe("memory-stick",eC);const sC=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],nC=Oe("menu",sC);const iC=[["path",{d:"M18 8V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h8",key:"10dyio"}],["path",{d:"M10 19v-3.96 3.15",key:"1irgej"}],["path",{d:"M7 19h5",key:"qswx4l"}],["rect",{width:"6",height:"10",x:"16",y:"12",rx:"2",key:"1egngj"}]],jS=Oe("monitor-smartphone",iC);const aC=[["path",{d:"M15.033 9.44a.647.647 0 0 1 0 1.12l-4.065 2.352a.645.645 0 0 1-.968-.56V7.648a.645.645 0 0 1 .967-.56z",key:"vbtd3f"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"M8 21h8",key:"1ev6f3"}],["rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",key:"x3v2xh"}]],tg=Oe("monitor-play",aC);const rC=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],Mo=Oe("monitor",rC);const oC=[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]],lC=Oe("music",oC);const cC=[["path",{d:"M15 18h-5",key:"95g1m2"}],["path",{d:"M18 14h-8",key:"sponae"}],["path",{d:"M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-4 0v-9a2 2 0 0 1 2-2h2",key:"39pd36"}],["rect",{width:"8",height:"4",x:"10",y:"6",rx:"1",key:"aywv1n"}]],CS=Oe("newspaper",cC);const dC=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],bu=Oe("palette",dC);const uC=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],Yo=Oe("pause",uC);const hC=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],fC=Oe("pen",hC);const mC=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],gC=Oe("pencil",mC);const pC=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],wn=Oe("play",pC);const xC=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],rs=Oe("plus",xC);const yC=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],sg=Oe("power",yC);const vC=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],bC=Oe("qr-code",vC);const _C=[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],sn=Oe("radio",_C);const SC=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Et=Oe("refresh-cw",SC);const EC=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],t0=Oe("repeat",EC);const NC=[["path",{d:"M12 6a2 2 0 0 0-3.414-1.414l-6 6a2 2 0 0 0 0 2.828l6 6A2 2 0 0 0 12 18z",key:"2a1g8i"}],["path",{d:"M22 6a2 2 0 0 0-3.414-1.414l-6 6a2 2 0 0 0 0 2.828l6 6A2 2 0 0 0 22 18z",key:"rg3s36"}]],RS=Oe("rewind",NC);const wC=[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]],LS=Oe("rocket",wC);const TC=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],ng=Oe("rotate-ccw",TC);const AC=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],s0=Oe("save",AC);const jC=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]],Jl=Oe("scan-line",jC);const CC=[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]],ig=Oe("scissors",CC);const RC=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],qt=Oe("search",RC);const LC=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],Fu=Oe("server",LC);const kC=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],DC=Oe("settings-2",kC);const IC=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],$u=Oe("settings",IC);const MC=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]],OC=Oe("shield-off",MC);const PC=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],BC=Oe("shield",PC);const UC=[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]],kS=Oe("shuffle",UC);const FC=[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}],["path",{d:"M17 20V8",key:"1tkaf5"}],["path",{d:"M22 4v16",key:"sih9yq"}]],$C=Oe("signal",FC);const GC=[["path",{d:"M17.971 4.285A2 2 0 0 1 21 6v12a2 2 0 0 1-3.029 1.715l-9.997-5.998a2 2 0 0 1-.003-3.432z",key:"15892j"}],["path",{d:"M3 20V4",key:"1ptbpl"}]],DS=Oe("skip-back",GC);const VC=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],n0=Oe("skip-forward",VC);const HC=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],KC=Oe("sliders-horizontal",HC);const qC=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],nu=Oe("smartphone",qC);const zC=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],YC=Oe("sparkles",zC);const WC=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],QC=Oe("square-check-big",WC);const XC=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Ri=Oe("square-pen",XC);const JC=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],ZC=Oe("square",JC);const eR=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],IS=Oe("star",eR);const tR=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],MS=Oe("tag",tR);const sR=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],zv=Oe("timer",sR);const nR=[["circle",{cx:"9",cy:"12",r:"3",key:"u3jwor"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],i0=Oe("toggle-left",nR);const iR=[["circle",{cx:"15",cy:"12",r:"3",key:"1afu0r"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],a0=Oe("toggle-right",iR);const aR=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ts=Oe("trash-2",aR);const rR=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],tn=Oe("triangle-alert",rR);const oR=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],$a=Oe("trophy",oR);const lR=[["path",{d:"M7 21h10",key:"1b0cd5"}],["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}]],ag=Oe("tv-minimal",lR);const cR=[["path",{d:"m17 2-5 5-5-5",key:"16satq"}],["rect",{width:"20",height:"15",x:"2",y:"7",rx:"2",key:"1e6viu"}]],ss=Oe("tv",cR);const dR=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ra=Oe("upload",dR);const uR=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],hR=Oe("user",uR);const fR=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Gu=Oe("users",fR);const mR=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],la=Oe("video",mR);const gR=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],r0=Oe("volume-2",gR);const pR=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],o0=Oe("volume-x",pR);const xR=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],_u=Oe("wand-sparkles",xR);const yR=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],vR=Oe("wifi-off",yR);const bR=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],Vu=Oe("wifi",bR);const _R=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],At=Oe("x",_R);const SR=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],$n=Oe("zap",SR);function OS(i,e){return function(){return i.apply(e,arguments)}}const{toString:ER}=Object.prototype,{getPrototypeOf:l0}=Object,{iterator:Hu,toStringTag:PS}=Symbol,Ku=(i=>e=>{const t=ER.call(e);return i[t]||(i[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),gi=i=>(i=i.toLowerCase(),e=>Ku(e)===i),qu=i=>e=>typeof e===i,{isArray:Wo}=Array,$o=qu("undefined");function pc(i){return i!==null&&!$o(i)&&i.constructor!==null&&!$o(i.constructor)&&En(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const BS=gi("ArrayBuffer");function NR(i){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(i):e=i&&i.buffer&&BS(i.buffer),e}const wR=qu("string"),En=qu("function"),US=qu("number"),xc=i=>i!==null&&typeof i=="object",TR=i=>i===!0||i===!1,iu=i=>{if(Ku(i)!=="object")return!1;const e=l0(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(PS in i)&&!(Hu in i)},AR=i=>{if(!xc(i)||pc(i))return!1;try{return Object.keys(i).length===0&&Object.getPrototypeOf(i)===Object.prototype}catch{return!1}},jR=gi("Date"),CR=gi("File"),RR=gi("Blob"),LR=gi("FileList"),kR=i=>xc(i)&&En(i.pipe),DR=i=>{let e;return i&&(typeof FormData=="function"&&i instanceof FormData||En(i.append)&&((e=Ku(i))==="formdata"||e==="object"&&En(i.toString)&&i.toString()==="[object FormData]"))},IR=gi("URLSearchParams"),[MR,OR,PR,BR]=["ReadableStream","Request","Response","Headers"].map(gi),UR=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function yc(i,e,{allOwnKeys:t=!1}={}){if(i===null||typeof i>"u")return;let n,r;if(typeof i!="object"&&(i=[i]),Wo(i))for(n=0,r=i.length;n<r;n++)e.call(null,i[n],n,i);else{if(pc(i))return;const o=t?Object.getOwnPropertyNames(i):Object.keys(i),c=o.length;let d;for(n=0;n<c;n++)d=o[n],e.call(null,i[d],d,i)}}function FS(i,e){if(pc(i))return null;e=e.toLowerCase();const t=Object.keys(i);let n=t.length,r;for(;n-- >0;)if(r=t[n],e===r.toLowerCase())return r;return null}const wr=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,$S=i=>!$o(i)&&i!==wr;function rg(){const{caseless:i,skipUndefined:e}=$S(this)&&this||{},t={},n=(r,o)=>{const c=i&&FS(t,o)||o;iu(t[c])&&iu(r)?t[c]=rg(t[c],r):iu(r)?t[c]=rg({},r):Wo(r)?t[c]=r.slice():(!e||!$o(r))&&(t[c]=r)};for(let r=0,o=arguments.length;r<o;r++)arguments[r]&&yc(arguments[r],n);return t}const FR=(i,e,t,{allOwnKeys:n}={})=>(yc(e,(r,o)=>{t&&En(r)?i[o]=OS(r,t):i[o]=r},{allOwnKeys:n}),i),$R=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),GR=(i,e,t,n)=>{i.prototype=Object.create(e.prototype,n),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:e.prototype}),t&&Object.assign(i.prototype,t)},VR=(i,e,t,n)=>{let r,o,c;const d={};if(e=e||{},i==null)return e;do{for(r=Object.getOwnPropertyNames(i),o=r.length;o-- >0;)c=r[o],(!n||n(c,i,e))&&!d[c]&&(e[c]=i[c],d[c]=!0);i=t!==!1&&l0(i)}while(i&&(!t||t(i,e))&&i!==Object.prototype);return e},HR=(i,e,t)=>{i=String(i),(t===void 0||t>i.length)&&(t=i.length),t-=e.length;const n=i.indexOf(e,t);return n!==-1&&n===t},KR=i=>{if(!i)return null;if(Wo(i))return i;let e=i.length;if(!US(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=i[e];return t},qR=(i=>e=>i&&e instanceof i)(typeof Uint8Array<"u"&&l0(Uint8Array)),zR=(i,e)=>{const n=(i&&i[Hu]).call(i);let r;for(;(r=n.next())&&!r.done;){const o=r.value;e.call(i,o[0],o[1])}},YR=(i,e)=>{let t;const n=[];for(;(t=i.exec(e))!==null;)n.push(t);return n},WR=gi("HTMLFormElement"),QR=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,r){return n.toUpperCase()+r}),Yv=(({hasOwnProperty:i})=>(e,t)=>i.call(e,t))(Object.prototype),XR=gi("RegExp"),GS=(i,e)=>{const t=Object.getOwnPropertyDescriptors(i),n={};yc(t,(r,o)=>{let c;(c=e(r,o,i))!==!1&&(n[o]=c||r)}),Object.defineProperties(i,n)},JR=i=>{GS(i,(e,t)=>{if(En(i)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const n=i[t];if(En(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},ZR=(i,e)=>{const t={},n=r=>{r.forEach(o=>{t[o]=!0})};return Wo(i)?n(i):n(String(i).split(e)),t},eL=()=>{},tL=(i,e)=>i!=null&&Number.isFinite(i=+i)?i:e;function sL(i){return!!(i&&En(i.append)&&i[PS]==="FormData"&&i[Hu])}const nL=i=>{const e=new Array(10),t=(n,r)=>{if(xc(n)){if(e.indexOf(n)>=0)return;if(pc(n))return n;if(!("toJSON"in n)){e[r]=n;const o=Wo(n)?[]:{};return yc(n,(c,d)=>{const h=t(c,r+1);!$o(h)&&(o[d]=h)}),e[r]=void 0,o}}return n};return t(i,0)},iL=gi("AsyncFunction"),aL=i=>i&&(xc(i)||En(i))&&En(i.then)&&En(i.catch),VS=((i,e)=>i?setImmediate:e?((t,n)=>(wr.addEventListener("message",({source:r,data:o})=>{r===wr&&o===t&&n.length&&n.shift()()},!1),r=>{n.push(r),wr.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",En(wr.postMessage)),rL=typeof queueMicrotask<"u"?queueMicrotask.bind(wr):typeof process<"u"&&process.nextTick||VS,oL=i=>i!=null&&En(i[Hu]),Ce={isArray:Wo,isArrayBuffer:BS,isBuffer:pc,isFormData:DR,isArrayBufferView:NR,isString:wR,isNumber:US,isBoolean:TR,isObject:xc,isPlainObject:iu,isEmptyObject:AR,isReadableStream:MR,isRequest:OR,isResponse:PR,isHeaders:BR,isUndefined:$o,isDate:jR,isFile:CR,isBlob:RR,isRegExp:XR,isFunction:En,isStream:kR,isURLSearchParams:IR,isTypedArray:qR,isFileList:LR,forEach:yc,merge:rg,extend:FR,trim:UR,stripBOM:$R,inherits:GR,toFlatObject:VR,kindOf:Ku,kindOfTest:gi,endsWith:HR,toArray:KR,forEachEntry:zR,matchAll:YR,isHTMLForm:WR,hasOwnProperty:Yv,hasOwnProp:Yv,reduceDescriptors:GS,freezeMethods:JR,toObjectSet:ZR,toCamelCase:QR,noop:eL,toFiniteNumber:tL,findKey:FS,global:wr,isContextDefined:$S,isSpecCompliantForm:sL,toJSONObject:nL,isAsyncFn:iL,isThenable:aL,setImmediate:VS,asap:rL,isIterable:oL};function wt(i,e,t,n,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),r&&(this.response=r,this.status=r.status?r.status:null)}Ce.inherits(wt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ce.toJSONObject(this.config),code:this.code,status:this.status}}});const HS=wt.prototype,KS={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{KS[i]={value:i}});Object.defineProperties(wt,KS);Object.defineProperty(HS,"isAxiosError",{value:!0});wt.from=(i,e,t,n,r,o)=>{const c=Object.create(HS);Ce.toFlatObject(i,c,function(m){return m!==Error.prototype},u=>u!=="isAxiosError");const d=i&&i.message?i.message:"Error",h=e==null&&i?i.code:e;return wt.call(c,d,h,t,n,r),i&&c.cause==null&&Object.defineProperty(c,"cause",{value:i,configurable:!0}),c.name=i&&i.name||"Error",o&&Object.assign(c,o),c};const lL=null;function og(i){return Ce.isPlainObject(i)||Ce.isArray(i)}function qS(i){return Ce.endsWith(i,"[]")?i.slice(0,-2):i}function Wv(i,e,t){return i?i.concat(e).map(function(r,o){return r=qS(r),!t&&o?"["+r+"]":r}).join(t?".":""):e}function cL(i){return Ce.isArray(i)&&!i.some(og)}const dL=Ce.toFlatObject(Ce,{},null,function(e){return/^is[A-Z]/.test(e)});function zu(i,e,t){if(!Ce.isObject(i))throw new TypeError("target must be an object");e=e||new FormData,t=Ce.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,N){return!Ce.isUndefined(N[S])});const n=t.metaTokens,r=t.visitor||m,o=t.dots,c=t.indexes,h=(t.Blob||typeof Blob<"u"&&Blob)&&Ce.isSpecCompliantForm(e);if(!Ce.isFunction(r))throw new TypeError("visitor must be a function");function u(v){if(v===null)return"";if(Ce.isDate(v))return v.toISOString();if(Ce.isBoolean(v))return v.toString();if(!h&&Ce.isBlob(v))throw new wt("Blob is not supported. Use a Buffer instead.");return Ce.isArrayBuffer(v)||Ce.isTypedArray(v)?h&&typeof Blob=="function"?new Blob([v]):Buffer.from(v):v}function m(v,S,N){let A=v;if(v&&!N&&typeof v=="object"){if(Ce.endsWith(S,"{}"))S=n?S:S.slice(0,-2),v=JSON.stringify(v);else if(Ce.isArray(v)&&cL(v)||(Ce.isFileList(v)||Ce.endsWith(S,"[]"))&&(A=Ce.toArray(v)))return S=qS(S),A.forEach(function(C,D){!(Ce.isUndefined(C)||C===null)&&e.append(c===!0?Wv([S],D,o):c===null?S:S+"[]",u(C))}),!1}return og(v)?!0:(e.append(Wv(N,S,o),u(v)),!1)}const g=[],x=Object.assign(dL,{defaultVisitor:m,convertValue:u,isVisitable:og});function y(v,S){if(!Ce.isUndefined(v)){if(g.indexOf(v)!==-1)throw Error("Circular reference detected in "+S.join("."));g.push(v),Ce.forEach(v,function(A,R){(!(Ce.isUndefined(A)||A===null)&&r.call(e,A,Ce.isString(R)?R.trim():R,S,x))===!0&&y(A,S?S.concat(R):[R])}),g.pop()}}if(!Ce.isObject(i))throw new TypeError("data must be an object");return y(i),e}function Qv(i){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function c0(i,e){this._pairs=[],i&&zu(i,this,e)}const zS=c0.prototype;zS.append=function(e,t){this._pairs.push([e,t])};zS.toString=function(e){const t=e?function(n){return e.call(this,n,Qv)}:Qv;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};function uL(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function YS(i,e,t){if(!e)return i;const n=t&&t.encode||uL;Ce.isFunction(t)&&(t={serialize:t});const r=t&&t.serialize;let o;if(r?o=r(e,t):o=Ce.isURLSearchParams(e)?e.toString():new c0(e,t).toString(n),o){const c=i.indexOf("#");c!==-1&&(i=i.slice(0,c)),i+=(i.indexOf("?")===-1?"?":"&")+o}return i}class Xv{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ce.forEach(this.handlers,function(n){n!==null&&e(n)})}}const WS={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},hL=typeof URLSearchParams<"u"?URLSearchParams:c0,fL=typeof FormData<"u"?FormData:null,mL=typeof Blob<"u"?Blob:null,gL={isBrowser:!0,classes:{URLSearchParams:hL,FormData:fL,Blob:mL},protocols:["http","https","file","blob","url","data"]},d0=typeof window<"u"&&typeof document<"u",lg=typeof navigator=="object"&&navigator||void 0,pL=d0&&(!lg||["ReactNative","NativeScript","NS"].indexOf(lg.product)<0),xL=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",yL=d0&&window.location.href||"http://localhost",vL=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:d0,hasStandardBrowserEnv:pL,hasStandardBrowserWebWorkerEnv:xL,navigator:lg,origin:yL},Symbol.toStringTag,{value:"Module"})),on={...vL,...gL};function bL(i,e){return zu(i,new on.classes.URLSearchParams,{visitor:function(t,n,r,o){return on.isNode&&Ce.isBuffer(t)?(this.append(n,t.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)},...e})}function _L(i){return Ce.matchAll(/\w+|\[(\w*)]/g,i).map(e=>e[0]==="[]"?"":e[1]||e[0])}function SL(i){const e={},t=Object.keys(i);let n;const r=t.length;let o;for(n=0;n<r;n++)o=t[n],e[o]=i[o];return e}function QS(i){function e(t,n,r,o){let c=t[o++];if(c==="__proto__")return!0;const d=Number.isFinite(+c),h=o>=t.length;return c=!c&&Ce.isArray(r)?r.length:c,h?(Ce.hasOwnProp(r,c)?r[c]=[r[c],n]:r[c]=n,!d):((!r[c]||!Ce.isObject(r[c]))&&(r[c]=[]),e(t,n,r[c],o)&&Ce.isArray(r[c])&&(r[c]=SL(r[c])),!d)}if(Ce.isFormData(i)&&Ce.isFunction(i.entries)){const t={};return Ce.forEachEntry(i,(n,r)=>{e(_L(n),r,t,0)}),t}return null}function EL(i,e,t){if(Ce.isString(i))try{return(e||JSON.parse)(i),Ce.trim(i)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(i)}const vc={transitional:WS,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,o=Ce.isObject(e);if(o&&Ce.isHTMLForm(e)&&(e=new FormData(e)),Ce.isFormData(e))return r?JSON.stringify(QS(e)):e;if(Ce.isArrayBuffer(e)||Ce.isBuffer(e)||Ce.isStream(e)||Ce.isFile(e)||Ce.isBlob(e)||Ce.isReadableStream(e))return e;if(Ce.isArrayBufferView(e))return e.buffer;if(Ce.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let d;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return bL(e,this.formSerializer).toString();if((d=Ce.isFileList(e))||n.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return zu(d?{"files[]":e}:e,h&&new h,this.formSerializer)}}return o||r?(t.setContentType("application/json",!1),EL(e)):e}],transformResponse:[function(e){const t=this.transitional||vc.transitional,n=t&&t.forcedJSONParsing,r=this.responseType==="json";if(Ce.isResponse(e)||Ce.isReadableStream(e))return e;if(e&&Ce.isString(e)&&(n&&!this.responseType||r)){const c=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e,this.parseReviver)}catch(d){if(c)throw d.name==="SyntaxError"?wt.from(d,wt.ERR_BAD_RESPONSE,this,null,this.response):d}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:on.classes.FormData,Blob:on.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ce.forEach(["delete","get","head","post","put","patch"],i=>{vc.headers[i]={}});const NL=Ce.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),wL=i=>{const e={};let t,n,r;return i&&i.split(`
`).forEach(function(c){r=c.indexOf(":"),t=c.substring(0,r).trim().toLowerCase(),n=c.substring(r+1).trim(),!(!t||e[t]&&NL[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e},Jv=Symbol("internals");function Yl(i){return i&&String(i).trim().toLowerCase()}function au(i){return i===!1||i==null?i:Ce.isArray(i)?i.map(au):String(i)}function TL(i){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=t.exec(i);)e[n[1]]=n[2];return e}const AL=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function cm(i,e,t,n,r){if(Ce.isFunction(n))return n.call(this,e,t);if(r&&(e=t),!!Ce.isString(e)){if(Ce.isString(n))return e.indexOf(n)!==-1;if(Ce.isRegExp(n))return n.test(e)}}function jL(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function CL(i,e){const t=Ce.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(i,n+t,{value:function(r,o,c){return this[n].call(this,e,r,o,c)},configurable:!0})})}let Nn=class{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function o(d,h,u){const m=Yl(h);if(!m)throw new Error("header name must be a non-empty string");const g=Ce.findKey(r,m);(!g||r[g]===void 0||u===!0||u===void 0&&r[g]!==!1)&&(r[g||h]=au(d))}const c=(d,h)=>Ce.forEach(d,(u,m)=>o(u,m,h));if(Ce.isPlainObject(e)||e instanceof this.constructor)c(e,t);else if(Ce.isString(e)&&(e=e.trim())&&!AL(e))c(wL(e),t);else if(Ce.isObject(e)&&Ce.isIterable(e)){let d={},h,u;for(const m of e){if(!Ce.isArray(m))throw TypeError("Object iterator must return a key-value pair");d[u=m[0]]=(h=d[u])?Ce.isArray(h)?[...h,m[1]]:[h,m[1]]:m[1]}c(d,t)}else e!=null&&o(t,e,n);return this}get(e,t){if(e=Yl(e),e){const n=Ce.findKey(this,e);if(n){const r=this[n];if(!t)return r;if(t===!0)return TL(r);if(Ce.isFunction(t))return t.call(this,r,n);if(Ce.isRegExp(t))return t.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Yl(e),e){const n=Ce.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||cm(this,this[n],n,t)))}return!1}delete(e,t){const n=this;let r=!1;function o(c){if(c=Yl(c),c){const d=Ce.findKey(n,c);d&&(!t||cm(n,n[d],d,t))&&(delete n[d],r=!0)}}return Ce.isArray(e)?e.forEach(o):o(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const o=t[n];(!e||cm(this,this[o],o,e,!0))&&(delete this[o],r=!0)}return r}normalize(e){const t=this,n={};return Ce.forEach(this,(r,o)=>{const c=Ce.findKey(n,o);if(c){t[c]=au(r),delete t[o];return}const d=e?jL(o):String(o).trim();d!==o&&delete t[o],t[d]=au(r),n[d]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Ce.forEach(this,(n,r)=>{n!=null&&n!==!1&&(t[r]=e&&Ce.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach(r=>n.set(r)),n}static accessor(e){const n=(this[Jv]=this[Jv]={accessors:{}}).accessors,r=this.prototype;function o(c){const d=Yl(c);n[d]||(CL(r,c),n[d]=!0)}return Ce.isArray(e)?e.forEach(o):o(e),this}};Nn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ce.reduceDescriptors(Nn.prototype,({value:i},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>i,set(n){this[t]=n}}});Ce.freezeMethods(Nn);function dm(i,e){const t=this||vc,n=e||t,r=Nn.from(n.headers);let o=n.data;return Ce.forEach(i,function(d){o=d.call(t,o,r.normalize(),e?e.status:void 0)}),r.normalize(),o}function XS(i){return!!(i&&i.__CANCEL__)}function Qo(i,e,t){wt.call(this,i??"canceled",wt.ERR_CANCELED,e,t),this.name="CanceledError"}Ce.inherits(Qo,wt,{__CANCEL__:!0});function JS(i,e,t){const n=t.config.validateStatus;!t.status||!n||n(t.status)?i(t):e(new wt("Request failed with status code "+t.status,[wt.ERR_BAD_REQUEST,wt.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function RL(i){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return e&&e[1]||""}function LL(i,e){i=i||10;const t=new Array(i),n=new Array(i);let r=0,o=0,c;return e=e!==void 0?e:1e3,function(h){const u=Date.now(),m=n[o];c||(c=u),t[r]=h,n[r]=u;let g=o,x=0;for(;g!==r;)x+=t[g++],g=g%i;if(r=(r+1)%i,r===o&&(o=(o+1)%i),u-c<e)return;const y=m&&u-m;return y?Math.round(x*1e3/y):void 0}}function kL(i,e){let t=0,n=1e3/e,r,o;const c=(u,m=Date.now())=>{t=m,r=null,o&&(clearTimeout(o),o=null),i(...u)};return[(...u)=>{const m=Date.now(),g=m-t;g>=n?c(u,m):(r=u,o||(o=setTimeout(()=>{o=null,c(r)},n-g)))},()=>r&&c(r)]}const Su=(i,e,t=3)=>{let n=0;const r=LL(50,250);return kL(o=>{const c=o.loaded,d=o.lengthComputable?o.total:void 0,h=c-n,u=r(h),m=c<=d;n=c;const g={loaded:c,total:d,progress:d?c/d:void 0,bytes:h,rate:u||void 0,estimated:u&&d&&m?(d-c)/u:void 0,event:o,lengthComputable:d!=null,[e?"download":"upload"]:!0};i(g)},t)},Zv=(i,e)=>{const t=i!=null;return[n=>e[0]({lengthComputable:t,total:i,loaded:n}),e[1]]},eb=i=>(...e)=>Ce.asap(()=>i(...e)),DL=on.hasStandardBrowserEnv?((i,e)=>t=>(t=new URL(t,on.origin),i.protocol===t.protocol&&i.host===t.host&&(e||i.port===t.port)))(new URL(on.origin),on.navigator&&/(msie|trident)/i.test(on.navigator.userAgent)):()=>!0,IL=on.hasStandardBrowserEnv?{write(i,e,t,n,r,o,c){if(typeof document>"u")return;const d=[`${i}=${encodeURIComponent(e)}`];Ce.isNumber(t)&&d.push(`expires=${new Date(t).toUTCString()}`),Ce.isString(n)&&d.push(`path=${n}`),Ce.isString(r)&&d.push(`domain=${r}`),o===!0&&d.push("secure"),Ce.isString(c)&&d.push(`SameSite=${c}`),document.cookie=d.join("; ")},read(i){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+i+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(i){this.write(i,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function ML(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function OL(i,e){return e?i.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):i}function ZS(i,e,t){let n=!ML(e);return i&&(n||t==!1)?OL(i,e):e}const tb=i=>i instanceof Nn?{...i}:i;function Ir(i,e){e=e||{};const t={};function n(u,m,g,x){return Ce.isPlainObject(u)&&Ce.isPlainObject(m)?Ce.merge.call({caseless:x},u,m):Ce.isPlainObject(m)?Ce.merge({},m):Ce.isArray(m)?m.slice():m}function r(u,m,g,x){if(Ce.isUndefined(m)){if(!Ce.isUndefined(u))return n(void 0,u,g,x)}else return n(u,m,g,x)}function o(u,m){if(!Ce.isUndefined(m))return n(void 0,m)}function c(u,m){if(Ce.isUndefined(m)){if(!Ce.isUndefined(u))return n(void 0,u)}else return n(void 0,m)}function d(u,m,g){if(g in e)return n(u,m);if(g in i)return n(void 0,u)}const h={url:o,method:o,data:o,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:d,headers:(u,m,g)=>r(tb(u),tb(m),g,!0)};return Ce.forEach(Object.keys({...i,...e}),function(m){const g=h[m]||r,x=g(i[m],e[m],m);Ce.isUndefined(x)&&g!==d||(t[m]=x)}),t}const e1=i=>{const e=Ir({},i);let{data:t,withXSRFToken:n,xsrfHeaderName:r,xsrfCookieName:o,headers:c,auth:d}=e;if(e.headers=c=Nn.from(c),e.url=YS(ZS(e.baseURL,e.url,e.allowAbsoluteUrls),i.params,i.paramsSerializer),d&&c.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):""))),Ce.isFormData(t)){if(on.hasStandardBrowserEnv||on.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if(Ce.isFunction(t.getHeaders)){const h=t.getHeaders(),u=["content-type","content-length"];Object.entries(h).forEach(([m,g])=>{u.includes(m.toLowerCase())&&c.set(m,g)})}}if(on.hasStandardBrowserEnv&&(n&&Ce.isFunction(n)&&(n=n(e)),n||n!==!1&&DL(e.url))){const h=r&&o&&IL.read(o);h&&c.set(r,h)}return e},PL=typeof XMLHttpRequest<"u",BL=PL&&function(i){return new Promise(function(t,n){const r=e1(i);let o=r.data;const c=Nn.from(r.headers).normalize();let{responseType:d,onUploadProgress:h,onDownloadProgress:u}=r,m,g,x,y,v;function S(){y&&y(),v&&v(),r.cancelToken&&r.cancelToken.unsubscribe(m),r.signal&&r.signal.removeEventListener("abort",m)}let N=new XMLHttpRequest;N.open(r.method.toUpperCase(),r.url,!0),N.timeout=r.timeout;function A(){if(!N)return;const C=Nn.from("getAllResponseHeaders"in N&&N.getAllResponseHeaders()),V={data:!d||d==="text"||d==="json"?N.responseText:N.response,status:N.status,statusText:N.statusText,headers:C,config:i,request:N};JS(function(B){t(B),S()},function(B){n(B),S()},V),N=null}"onloadend"in N?N.onloadend=A:N.onreadystatechange=function(){!N||N.readyState!==4||N.status===0&&!(N.responseURL&&N.responseURL.indexOf("file:")===0)||setTimeout(A)},N.onabort=function(){N&&(n(new wt("Request aborted",wt.ECONNABORTED,i,N)),N=null)},N.onerror=function(D){const V=D&&D.message?D.message:"Network Error",z=new wt(V,wt.ERR_NETWORK,i,N);z.event=D||null,n(z),N=null},N.ontimeout=function(){let D=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const V=r.transitional||WS;r.timeoutErrorMessage&&(D=r.timeoutErrorMessage),n(new wt(D,V.clarifyTimeoutError?wt.ETIMEDOUT:wt.ECONNABORTED,i,N)),N=null},o===void 0&&c.setContentType(null),"setRequestHeader"in N&&Ce.forEach(c.toJSON(),function(D,V){N.setRequestHeader(V,D)}),Ce.isUndefined(r.withCredentials)||(N.withCredentials=!!r.withCredentials),d&&d!=="json"&&(N.responseType=r.responseType),u&&([x,v]=Su(u,!0),N.addEventListener("progress",x)),h&&N.upload&&([g,y]=Su(h),N.upload.addEventListener("progress",g),N.upload.addEventListener("loadend",y)),(r.cancelToken||r.signal)&&(m=C=>{N&&(n(!C||C.type?new Qo(null,i,N):C),N.abort(),N=null)},r.cancelToken&&r.cancelToken.subscribe(m),r.signal&&(r.signal.aborted?m():r.signal.addEventListener("abort",m)));const R=RL(r.url);if(R&&on.protocols.indexOf(R)===-1){n(new wt("Unsupported protocol "+R+":",wt.ERR_BAD_REQUEST,i));return}N.send(o||null)})},UL=(i,e)=>{const{length:t}=i=i?i.filter(Boolean):[];if(e||t){let n=new AbortController,r;const o=function(u){if(!r){r=!0,d();const m=u instanceof Error?u:this.reason;n.abort(m instanceof wt?m:new Qo(m instanceof Error?m.message:m))}};let c=e&&setTimeout(()=>{c=null,o(new wt(`timeout ${e} of ms exceeded`,wt.ETIMEDOUT))},e);const d=()=>{i&&(c&&clearTimeout(c),c=null,i.forEach(u=>{u.unsubscribe?u.unsubscribe(o):u.removeEventListener("abort",o)}),i=null)};i.forEach(u=>u.addEventListener("abort",o));const{signal:h}=n;return h.unsubscribe=()=>Ce.asap(d),h}},FL=function*(i,e){let t=i.byteLength;if(t<e){yield i;return}let n=0,r;for(;n<t;)r=n+e,yield i.slice(n,r),n=r},$L=async function*(i,e){for await(const t of GL(i))yield*FL(t,e)},GL=async function*(i){if(i[Symbol.asyncIterator]){yield*i;return}const e=i.getReader();try{for(;;){const{done:t,value:n}=await e.read();if(t)break;yield n}}finally{await e.cancel()}},sb=(i,e,t,n)=>{const r=$L(i,e);let o=0,c,d=h=>{c||(c=!0,n&&n(h))};return new ReadableStream({async pull(h){try{const{done:u,value:m}=await r.next();if(u){d(),h.close();return}let g=m.byteLength;if(t){let x=o+=g;t(x)}h.enqueue(new Uint8Array(m))}catch(u){throw d(u),u}},cancel(h){return d(h),r.return()}},{highWaterMark:2})},nb=64*1024,{isFunction:Md}=Ce,VL=(({Request:i,Response:e})=>({Request:i,Response:e}))(Ce.global),{ReadableStream:ib,TextEncoder:ab}=Ce.global,rb=(i,...e)=>{try{return!!i(...e)}catch{return!1}},HL=i=>{i=Ce.merge.call({skipUndefined:!0},VL,i);const{fetch:e,Request:t,Response:n}=i,r=e?Md(e):typeof fetch=="function",o=Md(t),c=Md(n);if(!r)return!1;const d=r&&Md(ib),h=r&&(typeof ab=="function"?(v=>S=>v.encode(S))(new ab):async v=>new Uint8Array(await new t(v).arrayBuffer())),u=o&&d&&rb(()=>{let v=!1;const S=new t(on.origin,{body:new ib,method:"POST",get duplex(){return v=!0,"half"}}).headers.has("Content-Type");return v&&!S}),m=c&&d&&rb(()=>Ce.isReadableStream(new n("").body)),g={stream:m&&(v=>v.body)};r&&["text","arrayBuffer","blob","formData","stream"].forEach(v=>{!g[v]&&(g[v]=(S,N)=>{let A=S&&S[v];if(A)return A.call(S);throw new wt(`Response type '${v}' is not supported`,wt.ERR_NOT_SUPPORT,N)})});const x=async v=>{if(v==null)return 0;if(Ce.isBlob(v))return v.size;if(Ce.isSpecCompliantForm(v))return(await new t(on.origin,{method:"POST",body:v}).arrayBuffer()).byteLength;if(Ce.isArrayBufferView(v)||Ce.isArrayBuffer(v))return v.byteLength;if(Ce.isURLSearchParams(v)&&(v=v+""),Ce.isString(v))return(await h(v)).byteLength},y=async(v,S)=>{const N=Ce.toFiniteNumber(v.getContentLength());return N??x(S)};return async v=>{let{url:S,method:N,data:A,signal:R,cancelToken:C,timeout:D,onDownloadProgress:V,onUploadProgress:z,responseType:B,headers:I,withCredentials:M="same-origin",fetchOptions:L}=e1(v),O=e||fetch;B=B?(B+"").toLowerCase():"text";let J=UL([R,C&&C.toAbortSignal()],D),ie=null;const ne=J&&J.unsubscribe&&(()=>{J.unsubscribe()});let se;try{if(z&&u&&N!=="get"&&N!=="head"&&(se=await y(I,A))!==0){let H=new t(S,{method:"POST",body:A,duplex:"half"}),Q;if(Ce.isFormData(A)&&(Q=H.headers.get("content-type"))&&I.setContentType(Q),H.body){const[oe,ye]=Zv(se,Su(eb(z)));A=sb(H.body,nb,oe,ye)}}Ce.isString(M)||(M=M?"include":"omit");const X=o&&"credentials"in t.prototype,ce={...L,signal:J,method:N.toUpperCase(),headers:I.normalize().toJSON(),body:A,duplex:"half",credentials:X?M:void 0};ie=o&&new t(S,ce);let le=await(o?O(ie,L):O(S,ce));const Y=m&&(B==="stream"||B==="response");if(m&&(V||Y&&ne)){const H={};["status","statusText","headers"].forEach(xe=>{H[xe]=le[xe]});const Q=Ce.toFiniteNumber(le.headers.get("content-length")),[oe,ye]=V&&Zv(Q,Su(eb(V),!0))||[];le=new n(sb(le.body,nb,oe,()=>{ye&&ye(),ne&&ne()}),H)}B=B||"text";let K=await g[Ce.findKey(g,B)||"text"](le,v);return!Y&&ne&&ne(),await new Promise((H,Q)=>{JS(H,Q,{data:K,headers:Nn.from(le.headers),status:le.status,statusText:le.statusText,config:v,request:ie})})}catch(X){throw ne&&ne(),X&&X.name==="TypeError"&&/Load failed|fetch/i.test(X.message)?Object.assign(new wt("Network Error",wt.ERR_NETWORK,v,ie),{cause:X.cause||X}):wt.from(X,X&&X.code,v,ie)}}},KL=new Map,t1=i=>{let e=i&&i.env||{};const{fetch:t,Request:n,Response:r}=e,o=[n,r,t];let c=o.length,d=c,h,u,m=KL;for(;d--;)h=o[d],u=m.get(h),u===void 0&&m.set(h,u=d?new Map:HL(e)),m=u;return u};t1();const u0={http:lL,xhr:BL,fetch:{get:t1}};Ce.forEach(u0,(i,e)=>{if(i){try{Object.defineProperty(i,"name",{value:e})}catch{}Object.defineProperty(i,"adapterName",{value:e})}});const ob=i=>`- ${i}`,qL=i=>Ce.isFunction(i)||i===null||i===!1;function zL(i,e){i=Ce.isArray(i)?i:[i];const{length:t}=i;let n,r;const o={};for(let c=0;c<t;c++){n=i[c];let d;if(r=n,!qL(n)&&(r=u0[(d=String(n)).toLowerCase()],r===void 0))throw new wt(`Unknown adapter '${d}'`);if(r&&(Ce.isFunction(r)||(r=r.get(e))))break;o[d||"#"+c]=r}if(!r){const c=Object.entries(o).map(([h,u])=>`adapter ${h} `+(u===!1?"is not supported by the environment":"is not available in the build"));let d=t?c.length>1?`since :
`+c.map(ob).join(`
`):" "+ob(c[0]):"as no adapter specified";throw new wt("There is no suitable adapter to dispatch the request "+d,"ERR_NOT_SUPPORT")}return r}const s1={getAdapter:zL,adapters:u0};function um(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new Qo(null,i)}function lb(i){return um(i),i.headers=Nn.from(i.headers),i.data=dm.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),s1.getAdapter(i.adapter||vc.adapter,i)(i).then(function(n){return um(i),n.data=dm.call(i,i.transformResponse,n),n.headers=Nn.from(n.headers),n},function(n){return XS(n)||(um(i),n&&n.response&&(n.response.data=dm.call(i,i.transformResponse,n.response),n.response.headers=Nn.from(n.response.headers))),Promise.reject(n)})}const n1="1.13.2",Yu={};["object","boolean","number","function","string","symbol"].forEach((i,e)=>{Yu[i]=function(n){return typeof n===i||"a"+(e<1?"n ":" ")+i}});const cb={};Yu.transitional=function(e,t,n){function r(o,c){return"[Axios v"+n1+"] Transitional option '"+o+"'"+c+(n?". "+n:"")}return(o,c,d)=>{if(e===!1)throw new wt(r(c," has been removed"+(t?" in "+t:"")),wt.ERR_DEPRECATED);return t&&!cb[c]&&(cb[c]=!0,console.warn(r(c," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(o,c,d):!0}};Yu.spelling=function(e){return(t,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function YL(i,e,t){if(typeof i!="object")throw new wt("options must be an object",wt.ERR_BAD_OPTION_VALUE);const n=Object.keys(i);let r=n.length;for(;r-- >0;){const o=n[r],c=e[o];if(c){const d=i[o],h=d===void 0||c(d,o,i);if(h!==!0)throw new wt("option "+o+" must be "+h,wt.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new wt("Unknown option "+o,wt.ERR_BAD_OPTION)}}const ru={assertOptions:YL,validators:Yu},Si=ru.validators;let jr=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Xv,response:new Xv}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const o=r.stack?r.stack.replace(/^.+\n/,""):"";try{n.stack?o&&!String(n.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+o):n.stack=o}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Ir(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:o}=t;n!==void 0&&ru.assertOptions(n,{silentJSONParsing:Si.transitional(Si.boolean),forcedJSONParsing:Si.transitional(Si.boolean),clarifyTimeoutError:Si.transitional(Si.boolean)},!1),r!=null&&(Ce.isFunction(r)?t.paramsSerializer={serialize:r}:ru.assertOptions(r,{encode:Si.function,serialize:Si.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),ru.assertOptions(t,{baseUrl:Si.spelling("baseURL"),withXsrfToken:Si.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let c=o&&Ce.merge(o.common,o[t.method]);o&&Ce.forEach(["delete","get","head","post","put","patch","common"],v=>{delete o[v]}),t.headers=Nn.concat(c,o);const d=[];let h=!0;this.interceptors.request.forEach(function(S){typeof S.runWhen=="function"&&S.runWhen(t)===!1||(h=h&&S.synchronous,d.unshift(S.fulfilled,S.rejected))});const u=[];this.interceptors.response.forEach(function(S){u.push(S.fulfilled,S.rejected)});let m,g=0,x;if(!h){const v=[lb.bind(this),void 0];for(v.unshift(...d),v.push(...u),x=v.length,m=Promise.resolve(t);g<x;)m=m.then(v[g++],v[g++]);return m}x=d.length;let y=t;for(;g<x;){const v=d[g++],S=d[g++];try{y=v(y)}catch(N){S.call(this,N);break}}try{m=lb.call(this,y)}catch(v){return Promise.reject(v)}for(g=0,x=u.length;g<x;)m=m.then(u[g++],u[g++]);return m}getUri(e){e=Ir(this.defaults,e);const t=ZS(e.baseURL,e.url,e.allowAbsoluteUrls);return YS(t,e.params,e.paramsSerializer)}};Ce.forEach(["delete","get","head","options"],function(e){jr.prototype[e]=function(t,n){return this.request(Ir(n||{},{method:e,url:t,data:(n||{}).data}))}});Ce.forEach(["post","put","patch"],function(e){function t(n){return function(o,c,d){return this.request(Ir(d||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}jr.prototype[e]=t(),jr.prototype[e+"Form"]=t(!0)});let WL=class i1{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(o){t=o});const n=this;this.promise.then(r=>{if(!n._listeners)return;let o=n._listeners.length;for(;o-- >0;)n._listeners[o](r);n._listeners=null}),this.promise.then=r=>{let o;const c=new Promise(d=>{n.subscribe(d),o=d}).then(r);return c.cancel=function(){n.unsubscribe(o)},c},e(function(o,c,d){n.reason||(n.reason=new Qo(o,c,d),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=n=>{e.abort(n)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new i1(function(r){e=r}),cancel:e}}};function QL(i){return function(t){return i.apply(null,t)}}function XL(i){return Ce.isObject(i)&&i.isAxiosError===!0}const cg={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(cg).forEach(([i,e])=>{cg[e]=i});function a1(i){const e=new jr(i),t=OS(jr.prototype.request,e);return Ce.extend(t,jr.prototype,e,{allOwnKeys:!0}),Ce.extend(t,e,null,{allOwnKeys:!0}),t.create=function(r){return a1(Ir(i,r))},t}const Rs=a1(vc);Rs.Axios=jr;Rs.CanceledError=Qo;Rs.CancelToken=WL;Rs.isCancel=XS;Rs.VERSION=n1;Rs.toFormData=zu;Rs.AxiosError=wt;Rs.Cancel=Rs.CanceledError;Rs.all=function(e){return Promise.all(e)};Rs.spread=QL;Rs.isAxiosError=XL;Rs.mergeConfig=Ir;Rs.AxiosHeaders=Nn;Rs.formToJSON=i=>QS(Ce.isHTMLForm(i)?new FormData(i):i);Rs.getAdapter=s1.getAdapter;Rs.HttpStatusCode=cg;Rs.default=Rs;const{Axios:SB,AxiosError:EB,CanceledError:NB,isCancel:wB,CancelToken:TB,VERSION:AB,all:jB,Cancel:CB,isAxiosError:RB,spread:LB,toFormData:kB,AxiosHeaders:DB,HttpStatusCode:IB,formToJSON:MB,getAdapter:OB,mergeConfig:PB}=Rs,hm="openflix_token";class JL{client;constructor(){this.client=Rs.create({baseURL:"",headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{const t=this.getToken();return t&&(e.headers["X-Plex-Token"]=t),e}),this.client.interceptors.response.use(e=>e,e=>(e.response?.status===401&&(this.clearToken(),window.location.href="/ui/login"),Promise.reject(e)))}getToken(){return localStorage.getItem(hm)}setToken(e){localStorage.setItem(hm,e)}clearToken(){localStorage.removeItem(hm)}isAuthenticated(){return!!this.getToken()}async login(e){const t=await this.client.post("/auth/login",e);return this.setToken(t.data.authToken),t.data}async register(e){return(await this.client.post("/auth/register",e)).data}async logout(){try{await this.client.post("/auth/logout")}finally{this.clearToken()}}async getCurrentUser(){return(await this.client.get("/auth/user")).data}async getUsers(){return(await this.client.get("/admin/users")).data.users||[]}async createUser(e){return(await this.client.post("/auth/register",e)).data}async updateUser(e,t){return(await this.client.put(`/admin/users/${e}`,t)).data}async deleteUser(e){await this.client.delete(`/admin/users/${e}`)}async getLibraries(){return(await this.client.get("/admin/libraries")).data.libraries||[]}async createLibrary(e){return(await this.client.post("/admin/libraries",e)).data}async updateLibrary(e,t){return(await this.client.put(`/admin/libraries/${e}`,t)).data}async deleteLibrary(e){await this.client.delete(`/admin/libraries/${e}`)}async scanLibrary(e){await this.client.post(`/admin/libraries/${e}/scan`)}async addLibraryPath(e,t){await this.client.post(`/admin/libraries/${e}/paths`,{path:t})}async removeLibraryPath(e,t){await this.client.delete(`/admin/libraries/${e}/paths/${t}`)}async getLibraryStats(e){return(await this.client.get(`/admin/libraries/${e}/stats`)).data}async browseFilesystem(e){return(await this.client.get("/admin/filesystem/browse",{params:e?{path:e}:void 0})).data}async getM3USources(){return(await this.client.get("/livetv/sources")).data.sources||[]}async createM3USource(e){return(await this.client.post("/livetv/sources",e)).data}async updateM3USource(e,t){return(await this.client.put(`/livetv/sources/${e}`,t)).data}async deleteM3USource(e){await this.client.delete(`/livetv/sources/${e}`)}async refreshM3USource(e){await this.client.post(`/livetv/sources/${e}/refresh`)}async importM3UVOD(e){return(await this.client.post(`/livetv/sources/${e}/import-vod`)).data}async importM3USeries(e){return(await this.client.post(`/livetv/sources/${e}/import-series`)).data}async mapChannelNumbers(e){return(await this.client.post("/livetv/channels/map-numbers",e)).data}async exportConfig(){return(await this.client.get("/config/export",{responseType:"blob"})).data}async getConfigStats(){return(await this.client.get("/config/stats")).data}async importConfig(e,t=!1){const n=t?"/config/import?preview=true":"/config/import";return(await this.client.post(n,e)).data}async getChannelGroups(){return(await this.client.get("/livetv/channel-groups")).data.groups||[]}async createChannelGroup(e){return(await this.client.post("/livetv/channel-groups",e)).data}async updateChannelGroup(e,t){return(await this.client.put(`/livetv/channel-groups/${e}`,t)).data}async deleteChannelGroup(e){await this.client.delete(`/livetv/channel-groups/${e}`)}async addChannelToGroup(e,t,n){return(await this.client.post(`/livetv/channel-groups/${e}/members`,{channelId:t,priority:n??0})).data}async updateGroupMemberPriority(e,t,n){return(await this.client.put(`/livetv/channel-groups/${e}/members/${t}`,{priority:n})).data}async removeChannelFromGroup(e,t){await this.client.delete(`/livetv/channel-groups/${e}/members/${t}`)}async autoDetectDuplicates(){return(await this.client.post("/livetv/channel-groups/auto-detect")).data}async getEPGSources(){return(await this.client.get("/livetv/epg/sources")).data.sources||[]}async previewEPGSource(e){return(await this.client.post("/livetv/epg/sources/preview",e)).data}async createEPGSource(e){return(await this.client.post("/livetv/epg/sources",e)).data}async deleteEPGSource(e){await this.client.delete(`/livetv/epg/sources/${e}`)}async updateEPGSource(e,t){return(await this.client.put(`/livetv/epg/sources/${e}`,t)).data}async refreshEPG(){await this.client.post("/livetv/epg/refresh")}async getGuide(){return(await this.client.get("/livetv/guide")).data}async getEPGPrograms(e){return(await this.client.get("/livetv/epg/programs",{params:e})).data}async getEPGChannels(e){return(await this.client.get("/livetv/epg/channels",{params:e?{epgSourceId:e}:void 0})).data.channels||[]}async discoverProviders(e){return(await this.client.get("/livetv/gracenote/providers",{params:{postalCode:e}})).data}async getXtreamSources(){return(await this.client.get("/livetv/xtream/sources")).data.sources||[]}async createXtreamSource(e){return(await this.client.post("/livetv/xtream/sources",e)).data}async updateXtreamSource(e,t){return(await this.client.put(`/livetv/xtream/sources/${e}`,t)).data}async deleteXtreamSource(e){await this.client.delete(`/livetv/xtream/sources/${e}`)}async testXtreamSource(e){return(await this.client.post(`/livetv/xtream/sources/${e}/test`)).data}async refreshXtreamSource(e){return(await this.client.post(`/livetv/xtream/sources/${e}/refresh`)).data}async parseXtreamFromM3U(e){return(await this.client.post("/livetv/xtream/parse-m3u",{url:e})).data}async importXtreamVOD(e){return(await this.client.post(`/livetv/xtream/sources/${e}/import-vod`)).data}async importXtreamSeries(e){return(await this.client.post(`/livetv/xtream/sources/${e}/import-series`)).data}async importAllXtreamContent(e){return(await this.client.post(`/livetv/xtream/sources/${e}/import-all`)).data}async getRecordings(){return(await this.client.get("/dvr/recordings")).data.recordings||[]}async deleteRecording(e){await this.client.delete(`/dvr/recordings/${e}`)}async getSeriesRules(){return(await this.client.get("/dvr/rules")).data.rules||[]}async createSeriesRule(e){return(await this.client.post("/dvr/rules",e)).data}async updateSeriesRule(e,t){return(await this.client.put(`/dvr/rules/${e}`,t)).data}async deleteSeriesRule(e){await this.client.delete(`/dvr/rules/${e}`)}async getRecordingConflicts(){return(await this.client.get("/dvr/conflicts")).data}async resolveConflict(e,t){await this.client.post("/dvr/conflicts/resolve",{keepRecordingId:e,cancelRecordingId:t})}async getRecordingStats(){return(await this.client.get("/dvr/recordings/stats")).data}async getRecordingCommercials(e){return(await this.client.get(`/dvr/recordings/${e}/commercials`)).data}async getCommercialDetectionStatus(){return(await this.client.get("/dvr/commercials/status")).data}async runCommercialDetection(e){await this.client.post(`/dvr/recordings/${e}/commercials/detect`)}async getRecordingStreamUrl(e){return(await this.client.get(`/dvr/recordings/${e}/stream`)).data.url}async updateRecordingProgress(e,t){await this.client.put(`/dvr/recordings/${e}/progress`,{viewOffset:t})}async getDVRSettings(){return(await this.client.get("/dvr/settings")).data.settings}async updateDVRSettings(e){return(await this.client.put("/dvr/settings",e)).data.settings}async getServerStatus(){return(await this.client.get("/api/status")).data}async getServerConfig(){return(await this.client.get("/admin/settings")).data.settings}async updateServerConfig(e){return(await this.client.put("/admin/settings",e)).data.settings}async getAdminMedia(e){return(await this.client.get("/admin/media",{params:e})).data}async refreshMediaMetadata(e){await this.client.post(`/admin/media/${e}/refresh`)}async updateMediaMetadata(e,t){return(await this.client.put(`/admin/media/${e}`,t)).data}async searchTMDB(e,t){return(await this.client.get("/admin/media/search-tmdb",{params:{query:e,media_type:t}})).data.results||[]}async applyMediaMatch(e,t,n){await this.client.post(`/admin/media/${e}/match`,{tmdb_id:t,media_type:n})}vod={testConnection:async e=>{const t=e?{url:e}:{};return(await this.client.get("/api/vod/test-connection",{params:t})).data},getProviders:async()=>(await this.client.get("/api/vod/providers")).data,getMovies:async e=>(await this.client.get(`/api/vod/${e}/movies`)).data,getShows:async e=>(await this.client.get(`/api/vod/${e}/shows`)).data,getGenres:async e=>(await this.client.get(`/api/vod/${e}/genres`)).data,getMovie:async(e,t)=>(await this.client.get(`/api/vod/${e}/movie/${t}`)).data,getShow:async(e,t)=>(await this.client.get(`/api/vod/${e}/show/${t}`)).data,startDownload:async(e,t,n)=>{await this.client.post(`/api/vod/${e}/download`,{contentId:t,type:n})},getQueue:async()=>(await this.client.get("/api/vod/queue")).data,cancelDownload:async e=>{await this.client.delete(`/api/vod/queue/${e}`)}}}const Re=new JL;function ZL(){return qe({queryKey:["currentUser"],queryFn:()=>Re.getCurrentUser(),enabled:Re.isAuthenticated(),retry:!1})}function ek(){const i=ft();return Ve({mutationFn:e=>Re.login(e),onSuccess:()=>{i.invalidateQueries({queryKey:["currentUser"]})}})}function tk(){return Ve({mutationFn:i=>Re.register(i)})}function sk(){const i=ft();return Ve({mutationFn:()=>Re.logout(),onSuccess:()=>{i.clear()}})}const nk=[{name:"Dashboard",href:"/ui",icon:Uj},{name:"Users",href:"/ui/users",icon:Gu},{name:"Libraries",href:"/ui/libraries",icon:mn},{name:"Media",href:"/ui/media",icon:fn},{name:"Live TV",href:"/ui/livetv",icon:ss},{name:"TV Guide",href:"/ui/tvguide",icon:PA},{name:"On Later",href:"/ui/onlater",icon:Ts},{name:"Team Pass",href:"/ui/teampass",icon:$a},{name:"DVR",href:"/ui/dvr",icon:la},{name:"VOD",href:"/ui/vod",icon:ej},{name:"Transcode",href:"/ui/transcode",icon:Ar},{name:"Logs",href:"/ui/logs",icon:Fn},{name:"Downloads",href:"/ui/downloads",icon:Os},{name:"Settings",href:"/ui/settings",icon:$u},{name:"Tuners",href:"/ui/tuners",icon:sn},{name:"Channel Collections",href:"/ui/channel-collections",icon:Ha},{name:"Virtual Channels",href:"/ui/virtual-channels",icon:ag},{name:"Collections",href:"/ui/collections",icon:gj},{name:"Artwork",href:"/ui/artwork",icon:Dr},{name:"Search",href:"/ui/search",icon:qt},{name:"Comskip",href:"/ui/comskip",icon:KC},{name:"Segments",href:"/ui/segments",icon:ig},{name:"Jobs",href:"/ui/jobs",icon:eg},{name:"Speed Test",href:"/ui/speedtest",icon:Zm},{name:"Connections",href:"/ui/connections",icon:jS},{name:"Diagnostics",href:"/ui/diagnostics",icon:Do},{name:"Backups",href:"/ui/backups",icon:aj},{name:"Trash",href:"/ui/trash",icon:ts},{name:"Updater",href:"/ui/updater",icon:Et},{name:"Upload",href:"/ui/upload",icon:ra}];function ik(){const i=ca(),e=fc(),{data:t}=ZL(),n=sk(),[r,o]=P.useState(!1),c=async()=>{await n.mutateAsync(),e("/ui/login")};return s.jsxs("div",{className:"min-h-screen bg-gray-900",children:[r&&s.jsx("div",{className:"fixed inset-0 z-40 bg-black/50 lg:hidden",onClick:()=>o(!1)}),s.jsxs("aside",{className:`fixed inset-y-0 left-0 z-50 w-64 transform bg-gray-800 transition-transform duration-200 ease-in-out lg:translate-x-0 ${r?"translate-x-0":"-translate-x-full"}`,children:[s.jsxs("div",{className:"flex h-16 items-center justify-between px-6 border-b border-gray-700",children:[s.jsx("span",{className:"text-xl font-bold text-white",children:"OpenFlix"}),s.jsx("button",{className:"lg:hidden text-gray-400 hover:text-white",onClick:()=>o(!1),children:s.jsx(At,{className:"h-6 w-6"})})]}),s.jsx("nav",{className:"mt-6 px-3",children:nk.map(d=>{const h=i.pathname===d.href;return s.jsxs(Vg,{to:d.href,onClick:()=>o(!1),className:`flex items-center gap-3 px-3 py-2 mb-1 rounded-lg text-sm font-medium transition-colors ${h?"bg-indigo-600 text-white":"text-gray-300 hover:bg-gray-700 hover:text-white"}`,children:[s.jsx(d.icon,{className:"h-5 w-5"}),d.name]},d.name)})}),s.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4 border-t border-gray-700",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[s.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-600 flex items-center justify-center text-white font-medium",children:t?.username?.charAt(0).toUpperCase()||"U"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-white truncate",children:t?.title||t?.username}),s.jsx("p",{className:"text-xs text-gray-400",children:t?.admin?"Administrator":"User"})]})]}),s.jsxs("button",{onClick:c,className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors",children:[s.jsx(Qj,{className:"h-4 w-4"}),"Sign out"]})]})]}),s.jsxs("div",{className:"lg:pl-64",children:[s.jsxs("header",{className:"sticky top-0 z-30 flex h-16 items-center gap-4 border-b border-gray-700 bg-gray-800 px-4 lg:hidden",children:[s.jsx("button",{className:"text-gray-400 hover:text-white",onClick:()=>o(!0),children:s.jsx(nC,{className:"h-6 w-6"})}),s.jsx("span",{className:"text-lg font-semibold text-white",children:"OpenFlix"})]}),s.jsx("main",{className:"p-6",children:s.jsx(r2,{})})]})]})}function ak(){const i=fc(),e=ek(),t=tk(),[n,r]=P.useState(!1),[o,c]=P.useState(""),[d,h]=P.useState(""),[u,m]=P.useState(""),[g,x]=P.useState(""),[y,v]=P.useState(""),[S,N]=P.useState(""),A=async C=>{if(C.preventDefault(),v(""),N(""),n){if(u!==g){v("Passwords do not match");return}if(u.length<6){v("Password must be at least 6 characters");return}try{await t.mutateAsync({username:o,email:d,password:u}),N("Account created! You can now sign in."),r(!1),m(""),x(""),h("")}catch(D){v(D.response?.data?.error||"Failed to create account")}}else try{if(!(await e.mutateAsync({username:o,password:u})).user.admin){v("Admin access required");return}i("/ui")}catch{v("Invalid username or password")}},R=()=>{r(!n),v(""),N(""),m(""),x("")};return s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 px-4",children:s.jsxs("div",{className:"w-full max-w-md",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-indigo-600 mb-4",children:s.jsx(ss,{className:"h-8 w-8 text-white"})}),s.jsx("h1",{className:"text-2xl font-bold text-white",children:"OpenFlix Admin"}),s.jsx("p",{className:"text-gray-400 mt-2",children:n?"Create your admin account":"Sign in to manage your server"})]}),s.jsxs("form",{onSubmit:A,className:"bg-gray-800 rounded-xl p-6 shadow-xl",children:[y&&s.jsx("div",{className:"mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20 text-red-400 text-sm",children:y}),S&&s.jsx("div",{className:"mb-4 p-3 rounded-lg bg-green-500/10 border border-green-500/20 text-green-400 text-sm",children:S}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-300 mb-2",children:"Username"}),s.jsx("input",{id:"username",type:"text",value:o,onChange:C=>c(C.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Enter your username",required:!0})]}),n&&s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300 mb-2",children:"Email"}),s.jsx("input",{id:"email",type:"email",value:d,onChange:C=>h(C.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Enter your email",required:!0})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300 mb-2",children:"Password"}),s.jsx("input",{id:"password",type:"password",value:u,onChange:C=>m(C.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Enter your password",required:!0})]}),n&&s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-300 mb-2",children:"Confirm Password"}),s.jsx("input",{id:"confirmPassword",type:"password",value:g,onChange:C=>x(C.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Confirm your password",required:!0})]}),s.jsx("button",{type:"submit",disabled:e.isPending||t.isPending,className:"w-full py-2 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors mb-4",children:e.isPending||t.isPending?n?"Creating account...":"Signing in...":n?"Create Account":"Sign in"}),s.jsx("div",{className:"text-center",children:s.jsx("button",{type:"button",onClick:R,className:"text-indigo-400 hover:text-indigo-300 text-sm transition-colors",children:n?"Already have an account? Sign in":"Don't have an account? Sign up"})})]})]})})}function r1(){return qe({queryKey:["libraries"],queryFn:()=>Re.getLibraries()})}function rk(i){return qe({queryKey:["library-stats",i],queryFn:()=>Re.getLibraryStats(i)})}function ok(){const i=ft();return Ve({mutationFn:e=>Re.createLibrary(e),onSuccess:()=>{i.invalidateQueries({queryKey:["libraries"]})}})}function lk(){const i=ft();return Ve({mutationFn:({id:e,data:t})=>Re.updateLibrary(e,t),onSuccess:()=>{i.invalidateQueries({queryKey:["libraries"]})}})}function ck(){const i=ft();return Ve({mutationFn:e=>Re.deleteLibrary(e),onSuccess:()=>{i.invalidateQueries({queryKey:["libraries"]})}})}function dk(){const i=ft();return Ve({mutationFn:e=>Re.scanLibrary(e),onSuccess:()=>{i.invalidateQueries({queryKey:["library-stats"]})}})}function uk(){const i=ft();return Ve({mutationFn:({libraryId:e,path:t})=>Re.addLibraryPath(e,t),onSuccess:()=>{i.invalidateQueries({queryKey:["libraries"]})}})}function hk(){const i=ft();return Ve({mutationFn:({libraryId:e,pathId:t})=>Re.removeLibraryPath(e,t),onSuccess:()=>{i.invalidateQueries({queryKey:["libraries"]})}})}function o1(){return qe({queryKey:["m3uSources"],queryFn:()=>Re.getM3USources()})}function fk(){const i=ft();return Ve({mutationFn:e=>Re.createM3USource(e),onSuccess:()=>{i.invalidateQueries({queryKey:["m3uSources"]})}})}function mk(){const i=ft();return Ve({mutationFn:e=>Re.deleteM3USource(e),onSuccess:()=>{i.invalidateQueries({queryKey:["m3uSources"]})}})}function gk(){const i=ft();return Ve({mutationFn:e=>Re.refreshM3USource(e),onSuccess:()=>{i.invalidateQueries({queryKey:["m3uSources"]})}})}function pk(){return qe({queryKey:["epgSources"],queryFn:()=>Re.getEPGSources()})}function xk(){const i=ft();return Ve({mutationFn:e=>Re.createEPGSource(e),onSuccess:()=>{i.invalidateQueries({queryKey:["epgSources"]})}})}function yk(){const i=ft();return Ve({mutationFn:e=>Re.deleteEPGSource(e),onSuccess:()=>{i.invalidateQueries({queryKey:["epgSources"]})}})}function vk(){return Ve({mutationFn:()=>Re.refreshEPG()})}function l1(){return qe({queryKey:["recordings"],queryFn:()=>Re.getRecordings()})}function bk(){const i=ft();return Ve({mutationFn:e=>Re.deleteRecording(e),onSuccess:()=>{i.invalidateQueries({queryKey:["recordings"]})}})}function _k(){return qe({queryKey:["seriesRules"],queryFn:()=>Re.getSeriesRules()})}function Sk(){const i=ft();return Ve({mutationFn:e=>Re.createSeriesRule(e),onSuccess:()=>{i.invalidateQueries({queryKey:["seriesRules"]})}})}function Ek(){const i=ft();return Ve({mutationFn:e=>Re.deleteSeriesRule(e),onSuccess:()=>{i.invalidateQueries({queryKey:["seriesRules"]})}})}function Nk(){return qe({queryKey:["recordingConflicts"],queryFn:()=>Re.getRecordingConflicts(),refetchInterval:6e4})}function wk(){const i=ft();return Ve({mutationFn:({keepId:e,cancelId:t})=>Re.resolveConflict(e,t),onSuccess:()=>{i.invalidateQueries({queryKey:["recordings"]}),i.invalidateQueries({queryKey:["recordingConflicts"]})}})}function Tk(){return qe({queryKey:["recordingStats"],queryFn:()=>Re.getRecordingStats(),refetchInterval:5e3})}function Ak(){return qe({queryKey:["serverStatus"],queryFn:()=>Re.getServerStatus(),refetchInterval:1e4})}function Od({title:i,value:e,icon:t,color:n,subtitle:r}){return s.jsx("div",{className:"bg-gray-800 rounded-xl p-6",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:`p-3 rounded-lg ${n}`,children:s.jsx(t,{className:"h-6 w-6 text-white"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-400",children:i}),s.jsx("p",{className:"text-2xl font-bold text-white",children:e}),r&&s.jsx("p",{className:"text-xs text-gray-500",children:r})]})]})})}function jk(){const{data:i}=Ak(),{data:e}=r1(),{data:t}=o1(),{data:n}=l1(),r=t?.reduce((d,h)=>d+(h.channelCount||0),0)||0,o=n?.filter(d=>d.status==="scheduled").length||0,c=n?.filter(d=>d.status==="completed").length||0;return s.jsxs("div",{children:[s.jsxs("div",{className:"mb-8",children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Dashboard"}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Overview of your OpenFlix server"})]}),i&&s.jsxs("div",{className:"bg-gray-800 rounded-xl p-4 mb-6 flex flex-wrap items-center gap-6 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Fu,{className:"h-4 w-4 text-green-400"}),s.jsxs("span",{className:"text-gray-300",children:[i.server.name," v",i.server.version]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ts,{className:"h-4 w-4 text-blue-400"}),s.jsxs("span",{className:"text-gray-300",children:["Uptime: ",i.server.uptime]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Gu,{className:"h-4 w-4 text-purple-400"}),s.jsxs("span",{className:"text-gray-300",children:[i.sessions.active," active session",i.sessions.active!==1?"s":""]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ar,{className:"h-4 w-4 text-orange-400"}),s.jsxs("span",{className:"text-gray-300",children:[i.system.memAllocMB," MB"]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Fn,{className:"h-4 w-4 text-yellow-400"}),s.jsxs("span",{className:"text-gray-300",children:["Log: ",i.logging.level]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[s.jsx(Od,{title:"Libraries",value:i?.libraries.count||e?.length||0,icon:mn,color:"bg-blue-600",subtitle:i?`${i.libraries.movies} movies, ${i.libraries.shows} shows`:void 0}),s.jsx(Od,{title:"Live TV Channels",value:i?.livetv.channels||r,icon:ss,color:"bg-green-600",subtitle:i?.livetv.timeshiftEnabled?`${i.livetv.timeshiftChannels} buffering`:void 0}),s.jsx(Od,{title:"Scheduled Recordings",value:i?.dvr.scheduled||o,icon:la,color:"bg-orange-600",subtitle:i?.dvr.recording?`${i.dvr.recording} recording now`:void 0}),s.jsx(Od,{title:"Completed Recordings",value:i?.dvr.completed||c,icon:Li,color:"bg-purple-600",subtitle:i?.dvr.commercialDetect?"Commercial detect enabled":void 0})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[s.jsx(mn,{className:"h-5 w-5"}),"Libraries"]}),e?.length?s.jsx("div",{className:"space-y-3",children:e.map(d=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-700/50 rounded-lg",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-white",children:d.title}),s.jsx("p",{className:"text-sm text-gray-400 capitalize",children:d.type})]}),s.jsxs("span",{className:"text-xs text-gray-500",children:[d.paths?.length||0," paths"]})]},d.id))}):s.jsx("p",{className:"text-gray-400 text-sm",children:"No libraries configured"})]}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[s.jsx(ss,{className:"h-5 w-5"}),"Live TV Sources"]}),t?.length?s.jsx("div",{className:"space-y-3",children:t.map(d=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-700/50 rounded-lg",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-white",children:d.name}),s.jsxs("p",{className:"text-sm text-gray-400",children:[d.channelCount," channels"]})]}),s.jsx("span",{className:"text-xs text-gray-500",children:d.lastRefresh?new Date(d.lastRefresh).toLocaleDateString():"Never refreshed"})]},d.id))}):s.jsx("p",{className:"text-gray-400 text-sm",children:"No M3U sources configured"})]}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 lg:col-span-2",children:[s.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[s.jsx(Do,{className:"h-5 w-5"}),"Upcoming Recordings"]}),n?.filter(d=>d.status==="scheduled").length?s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"text-left text-sm text-gray-400 border-b border-gray-700",children:[s.jsx("th",{className:"pb-3 font-medium",children:"Title"}),s.jsx("th",{className:"pb-3 font-medium",children:"Channel"}),s.jsx("th",{className:"pb-3 font-medium",children:"Start Time"}),s.jsx("th",{className:"pb-3 font-medium",children:"Duration"})]})}),s.jsx("tbody",{className:"text-sm",children:n.filter(d=>d.status==="scheduled").slice(0,5).map(d=>s.jsxs("tr",{className:"border-b border-gray-700/50",children:[s.jsx("td",{className:"py-3 text-white",children:d.title}),s.jsx("td",{className:"py-3 text-gray-300",children:d.channelName}),s.jsx("td",{className:"py-3 text-gray-300",children:new Date(d.startTime).toLocaleString()}),s.jsxs("td",{className:"py-3 text-gray-300",children:[d.duration," min"]})]},d.id))})]})}):s.jsx("p",{className:"text-gray-400 text-sm",children:"No upcoming recordings"})]})]})]})}function Ck(){return qe({queryKey:["users"],queryFn:()=>Re.getUsers()})}function Rk({onClose:i}){const e=ft(),[t,n]=P.useState(""),[r,o]=P.useState(""),[c,d]=P.useState(""),[h,u]=P.useState(!1),[m,g]=P.useState(""),x=Ve({mutationFn:v=>Re.createUser(v),onSuccess:()=>{e.invalidateQueries({queryKey:["users"]}),i()},onError:v=>{g(v.response?.data?.error||"Failed to create user")}}),y=async v=>{v.preventDefault(),g(""),x.mutate({username:t,email:r,password:c,isAdmin:h})};return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[s.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Create User"}),s.jsxs("form",{onSubmit:y,children:[m&&s.jsx("div",{className:"mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20 text-red-400 text-sm",children:m}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Username"}),s.jsx("input",{type:"text",value:t,onChange:v=>n(v.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email"}),s.jsx("input",{type:"email",value:r,onChange:v=>o(v.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Password"}),s.jsx("input",{type:"password",value:c,onChange:v=>d(v.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0,minLength:6})]}),s.jsx("div",{className:"mb-6",children:s.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300",children:[s.jsx("input",{type:"checkbox",checked:h,onChange:v=>u(v.target.checked),className:"rounded bg-gray-700 border-gray-600"}),"Administrator"]})}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{type:"button",onClick:i,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:x.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:x.isPending?"Creating...":"Create"})]})]})]})})}function Lk(){const{data:i,isLoading:e}=Ck(),t=ft(),[n,r]=P.useState(!1),o=Ve({mutationFn:d=>Re.deleteUser(d),onSuccess:()=>{t.invalidateQueries({queryKey:["users"]})}}),c=async d=>{confirm(`Are you sure you want to delete ${d.username}?`)&&o.mutate(d.id)};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-8",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Users"}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Manage server users"})]}),s.jsxs("button",{onClick:()=>r(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[s.jsx(rs,{className:"h-4 w-4"}),"Add User"]})]}),e?s.jsx("div",{className:"text-gray-400",children:"Loading..."}):i?.length?s.jsx("div",{className:"bg-gray-800 rounded-xl divide-y divide-gray-700",children:i.map(d=>s.jsxs("div",{className:"p-4 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"h-10 w-10 rounded-full bg-indigo-600 flex items-center justify-center text-white font-medium",children:d.username.charAt(0).toUpperCase()}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h3",{className:"font-medium text-white",children:d.title||d.username}),d.admin&&s.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-indigo-500/20 text-indigo-400 text-xs rounded-full",children:[s.jsx(BC,{className:"h-3 w-3"}),"Admin"]}),d.restricted&&s.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-orange-500/20 text-orange-400 text-xs rounded-full",children:[s.jsx(OC,{className:"h-3 w-3"}),"Restricted"]})]}),s.jsx("p",{className:"text-sm text-gray-400",children:d.email})]})]}),s.jsx("button",{onClick:()=>c(d),disabled:d.admin,className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",title:d.admin?"Can't delete admin":"Delete user",children:s.jsx(ts,{className:"h-4 w-4"})})]},d.id))}):s.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[s.jsx(Gu,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No users"}),s.jsx("p",{className:"text-gray-400 mb-4",children:"Add users to allow access to your server"}),s.jsxs("button",{onClick:()=>r(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[s.jsx(rs,{className:"h-4 w-4"}),"Add User"]})]}),n&&s.jsx(Rk,{onClose:()=>r(!1)})]})}function c1({onSelect:i,onCancel:e,initialPath:t}){const[n,r]=P.useState(t||""),[o,c]=P.useState(),[d,h]=P.useState([]),[u,m]=P.useState(!0),[g,x]=P.useState(null),[y,v]=P.useState(t||"");P.useEffect(()=>{S(n||void 0)},[n]);const S=async V=>{m(!0),x(null);try{const z=await Re.browseFilesystem(V);h(z.entries),c(z.parentPath),v(z.path)}catch(z){x("Failed to load directory"),console.error(z)}finally{m(!1)}},N=V=>{r(V)},A=()=>{o!==void 0&&r(o)},R=()=>{i(y||n)},C=V=>{V.preventDefault(),r(y)},D=V=>{if(!V)return"";const z=["B","KB","MB","GB","TB"];let B=0,I=V;for(;I>=1024&&B<z.length-1;)I/=1024,B++;return`${I.toFixed(1)} ${z[B]}`};return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[s.jsxs("div",{className:"p-4 border-b border-gray-700",children:[s.jsx("h2",{className:"text-lg font-semibold text-white mb-3",children:"Select Directory"}),s.jsxs("form",{onSubmit:C,className:"flex gap-2",children:[s.jsx("input",{type:"text",value:y,onChange:V=>v(V.target.value),className:"flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm font-mono",placeholder:"/path/to/media"}),s.jsx("button",{type:"submit",className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:"Go"})]})]}),s.jsxs("div",{className:"px-4 py-2 border-b border-gray-700 flex items-center gap-2",children:[s.jsx("button",{onClick:A,disabled:!o&&o!=="",className:"p-1.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Go up",children:s.jsx(Xg,{className:"h-4 w-4"})}),s.jsx("span",{className:"text-sm text-gray-400 truncate",children:n||"Select a location"})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:u?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx(ia,{className:"h-6 w-6 text-indigo-400 animate-spin"})}):g?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("p",{className:"text-red-400",children:g}),s.jsx("button",{onClick:()=>S(n||void 0),className:"mt-2 text-sm text-indigo-400 hover:text-indigo-300",children:"Retry"})]}):d.length===0?s.jsx("div",{className:"text-center py-12 text-gray-500",children:"Empty directory"}):s.jsx("div",{className:"space-y-0.5",children:d.map(V=>s.jsxs("button",{onClick:()=>V.isDir&&N(V.path),disabled:!V.isDir,className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-colors ${V.isDir?"hover:bg-gray-700 cursor-pointer":"opacity-50 cursor-not-allowed"}`,children:[V.isDir?V.name==="Home"?s.jsx(Mj,{className:"h-4 w-4 text-blue-400 flex-shrink-0"}):V.name==="Root"||V.path.match(/^[A-Z]:[\\/]?$/)?s.jsx(Li,{className:"h-4 w-4 text-gray-400 flex-shrink-0"}):s.jsx(bj,{className:"h-4 w-4 text-yellow-400 flex-shrink-0"}):s.jsx(TS,{className:"h-4 w-4 text-gray-500 flex-shrink-0"}),s.jsx("span",{className:"flex-1 text-sm text-white truncate",children:V.name}),!V.isDir&&V.size&&s.jsx("span",{className:"text-xs text-gray-500",children:D(V.size)}),V.isDir&&s.jsx(Va,{className:"h-4 w-4 text-gray-600 flex-shrink-0"})]},V.path))})}),s.jsxs("div",{className:"p-4 border-t border-gray-700 flex gap-3",children:[s.jsx("button",{onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),s.jsx("button",{onClick:R,disabled:!y,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg",children:"Select This Directory"})]})]})})}const kk={movie:fn,show:ss,music:lC,photo:Dr};function Dk(i){if(i===0)return"0 B";const e=1024,t=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(i)/Math.log(e));return`${parseFloat((i/Math.pow(e,n)).toFixed(1))} ${t[n]}`}function Ik(i){const e=Math.floor(i/36e5),t=Math.floor(i%36e5/6e4);return e>0?`${e}h ${t}m`:`${t}m`}function Mk({libraryId:i,type:e}){const{data:t,isLoading:n}=rk(i);if(n||!t)return s.jsx("div",{className:"mt-4 pt-4 border-t border-gray-700",children:s.jsx("div",{className:"text-sm text-gray-500",children:"Loading stats..."})});const r=e==="movie"?t.movieCount:e==="show"?t.showCount:t.movieCount+t.showCount,o=t.fileCount===0,c=r>0&&o;return s.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[c&&s.jsxs("div",{className:"mb-4 flex items-start gap-2 px-4 py-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg",children:[s.jsx(Ct,{className:"h-5 w-5 text-yellow-500 flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-yellow-500",children:"Library needs scanning"}),s.jsx("p",{className:"text-xs text-yellow-500/80 mt-1",children:'Media items exist but no files are indexed. Click "Scan" to index media files.'})]})]}),o&&r===0&&s.jsxs("div",{className:"mb-4 flex items-start gap-2 px-4 py-3 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:[s.jsx(Ct,{className:"h-5 w-5 text-blue-500 flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-blue-500",children:"Library is empty"}),s.jsx("p",{className:"text-xs text-blue-500/80 mt-1",children:'Add media files to your library paths and click "Scan" to index them.'})]})]}),s.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(dj,{className:"h-4 w-4 text-gray-500"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-white",children:e==="movie"?t.movieCount:e==="show"?t.showCount:r}),s.jsx("div",{className:"text-xs text-gray-500",children:e==="movie"?"Movies":e==="show"?"Shows":"Items"})]})]}),e==="show"&&t.episodeCount>0&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(fn,{className:"h-4 w-4 text-gray-500"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-white",children:t.episodeCount}),s.jsx("div",{className:"text-xs text-gray-500",children:"Episodes"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Li,{className:"h-4 w-4 text-gray-500"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-white",children:Dk(t.totalSize)}),s.jsx("div",{className:"text-xs text-gray-500",children:"Total Size"})]})]}),t.totalDuration>0&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ts,{className:"h-4 w-4 text-gray-500"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-white",children:Ik(t.totalDuration)}),s.jsx("div",{className:"text-xs text-gray-500",children:"Duration"})]})]})]})]})}function Ok({onClose:i}){const e=ok(),[t,n]=P.useState(""),[r,o]=P.useState("movie"),[c,d]=P.useState([]),[h,u]=P.useState(!1),m=async y=>{y.preventDefault(),c.length!==0&&(await e.mutateAsync({title:t,type:r,paths:c}),i())},g=y=>{c.includes(y)||d([...c,y]),u(!1)},x=y=>{d(c.filter(v=>v!==y))};return h?s.jsx(c1,{onSelect:g,onCancel:()=>u(!1)}):s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[s.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Create Library"}),s.jsxs("form",{onSubmit:m,children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),s.jsx("input",{type:"text",value:t,onChange:y=>n(y.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"My Movies",required:!0})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Type"}),s.jsxs("select",{value:r,onChange:y=>o(y.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:[s.jsx("option",{value:"movie",children:"Movies"}),s.jsx("option",{value:"show",children:"TV Shows"}),s.jsx("option",{value:"music",children:"Music"}),s.jsx("option",{value:"photo",children:"Photos"})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Paths"}),s.jsx("div",{className:"space-y-2 mb-2",children:c.map(y=>s.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-700/50 rounded-lg",children:[s.jsx(mn,{className:"h-4 w-4 text-yellow-400 flex-shrink-0"}),s.jsx("code",{className:"flex-1 text-sm text-gray-300 truncate",children:y}),s.jsx("button",{type:"button",onClick:()=>x(y),className:"p-1 text-gray-400 hover:text-red-400",children:s.jsx(At,{className:"h-4 w-4"})})]},y))}),s.jsxs("button",{type:"button",onClick:()=>u(!0),className:"w-full flex items-center justify-center gap-2 px-4 py-2 border-2 border-dashed border-gray-600 hover:border-gray-500 rounded-lg text-gray-400 hover:text-gray-300",children:[s.jsx(AS,{className:"h-4 w-4"}),"Browse for folder"]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{type:"button",onClick:i,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:e.isPending||c.length===0,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg",children:e.isPending?"Creating...":"Create"})]})]})]})})}function Pk({library:i,onClose:e}){const t=lk(),n=uk(),r=hk(),[o,c]=P.useState(i.title),[d,h]=P.useState(!1),u=async x=>{x.preventDefault(),o!==i.title&&await t.mutateAsync({id:i.id,data:{title:o}}),e()},m=async x=>{await n.mutateAsync({libraryId:i.id,path:x}),h(!1)},g=async x=>{if(i.paths.length<=1){alert("Library must have at least one path");return}await r.mutateAsync({libraryId:i.id,pathId:x})};return d?s.jsx(c1,{onSelect:m,onCancel:()=>h(!1)}):s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[s.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Edit Library"}),s.jsxs("form",{onSubmit:u,children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),s.jsx("input",{type:"text",value:o,onChange:x=>c(x.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Type"}),s.jsxs("div",{className:"px-4 py-2 bg-gray-700/50 border border-gray-600 rounded-lg text-gray-400 capitalize",children:[i.type,s.jsx("span",{className:"text-xs ml-2",children:"(cannot be changed)"})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Paths"}),s.jsx("div",{className:"space-y-2 mb-2",children:i.paths.map(x=>s.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-700/50 rounded-lg",children:[s.jsx(mn,{className:"h-4 w-4 text-yellow-400 flex-shrink-0"}),s.jsx("code",{className:"flex-1 text-sm text-gray-300 truncate",children:x.path}),s.jsx("button",{type:"button",onClick:()=>g(x.id),disabled:r.isPending||i.paths.length<=1,className:"p-1 text-gray-400 hover:text-red-400 disabled:opacity-50",children:s.jsx(At,{className:"h-4 w-4"})})]},x.id))}),s.jsxs("button",{type:"button",onClick:()=>h(!0),className:"w-full flex items-center justify-center gap-2 px-4 py-2 border-2 border-dashed border-gray-600 hover:border-gray-500 rounded-lg text-gray-400 hover:text-gray-300",children:[s.jsx(AS,{className:"h-4 w-4"}),"Add another folder"]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:t.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:t.isPending?"Saving...":"Save"})]})]})]})})}function Bk({library:i}){const e=ck(),t=dk(),[n,r]=P.useState(!1),[o,c]=P.useState(!1),d=kk[i.type]||mn,h=async()=>{confirm("Are you sure you want to delete this library? This will remove all associated metadata.")&&await e.mutateAsync(i.id)},u=async()=>{await t.mutateAsync(i.id)};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"p-3 bg-gray-700 rounded-lg",children:s.jsx(d,{className:"h-6 w-6 text-indigo-400"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-white",children:i.title}),s.jsx("p",{className:"text-sm text-gray-400 capitalize",children:i.type})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>c(!0),className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:"Edit Library",children:s.jsx(fC,{className:"h-4 w-4"})}),s.jsx("button",{onClick:u,disabled:t.isPending,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:"Scan Library",children:s.jsx(Et,{className:`h-4 w-4 ${t.isPending?"animate-spin":""}`})}),s.jsx("button",{onClick:h,disabled:e.isPending,className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg",title:"Delete Library",children:s.jsx(ts,{className:"h-4 w-4"})}),s.jsx("button",{onClick:()=>r(!n),className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:n?"Collapse":"Expand",children:n?s.jsx(Xg,{className:"h-4 w-4"}):s.jsx(Uu,{className:"h-4 w-4"})})]})]}),s.jsx(Mk,{libraryId:i.id,type:i.type}),n&&s.jsxs(s.Fragment,{children:[i.paths?.length>0&&s.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[s.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Paths:"}),s.jsx("div",{className:"space-y-1",children:i.paths.map(m=>s.jsx("code",{className:"block text-sm text-gray-300 bg-gray-700/50 px-3 py-1 rounded",children:m.path},m.id))})]}),i.scannedAt&&s.jsxs("p",{className:"mt-4 text-xs text-gray-500",children:["Last scanned: ",new Date(i.scannedAt).toLocaleString()]})]})]}),o&&s.jsx(Pk,{library:i,onClose:()=>c(!1)})]})}function Uk(){const{data:i,isLoading:e}=r1(),[t,n]=P.useState(!1);return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-8",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Libraries"}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Manage your media libraries"})]}),s.jsxs("button",{onClick:()=>n(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[s.jsx(rs,{className:"h-4 w-4"}),"Add Library"]})]}),e?s.jsx("div",{className:"text-gray-400",children:"Loading..."}):i?.length?s.jsx("div",{className:"grid gap-4",children:i.map(r=>s.jsx(Bk,{library:r},r.id))}):s.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[s.jsx(mn,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No libraries"}),s.jsx("p",{className:"text-gray-400 mb-4",children:"Get started by adding a media library"}),s.jsxs("button",{onClick:()=>n(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[s.jsx(rs,{className:"h-4 w-4"}),"Add Library"]})]}),t&&s.jsx(Ok,{onClose:()=>n(!1)})]})}function Fk(){const i=ft(),[e,t]=P.useState(""),[n,r]=P.useState(""),[o,c]=P.useState(""),[d,h]=P.useState(1),[u,m]=P.useState(null),[g,x]=P.useState(null),[y,v]=P.useState(null),[S,N]=P.useState(""),{data:A}=qe({queryKey:["admin-libraries"],queryFn:()=>Re.getLibraries()}),{data:R,isLoading:C}=qe({queryKey:["admin-media",e,n,o,d],queryFn:()=>Re.getAdminMedia({search:e,type:n,libraryId:o||void 0,page:d})}),{data:D,isLoading:V}=qe({queryKey:["tmdb-search",y?.id,S],queryFn:()=>Re.searchTMDB(S,y?.type==="show"?"tv":"movie"),enabled:!!y&&S.length>2}),z=Ve({mutationFn:O=>Re.refreshMediaMetadata(O),onSuccess:()=>{i.invalidateQueries({queryKey:["admin-media"]})}}),B=Ve({mutationFn:({id:O,data:J})=>Re.updateMediaMetadata(O,J),onSuccess:()=>{i.invalidateQueries({queryKey:["admin-media"]}),x(null)}}),I=Ve({mutationFn:({id:O,tmdbId:J,mediaType:ie})=>Re.applyMediaMatch(O,J,ie),onSuccess:()=>{i.invalidateQueries({queryKey:["admin-media"]}),v(null),N("")}}),M=()=>{g&&B.mutate({id:g.id,data:{title:g.title,sort_title:g.sort_title,year:g.year,summary:g.summary,studio:g.studio,content_rating:g.content_rating}})},L=O=>{switch(O.toLowerCase()){case"movie":return s.jsx(fn,{className:"h-4 w-4"});case"show":return s.jsx(ss,{className:"h-4 w-4"});default:return s.jsx(fn,{className:"h-4 w-4"})}};return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Media"}),s.jsx("p",{className:"text-gray-400",children:"Manage your media library metadata"})]})}),s.jsxs("div",{className:"flex flex-wrap gap-4",children:[s.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[s.jsx(qt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search media...",value:e,onChange:O=>{t(O.target.value),h(1)},className:"w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),s.jsxs("select",{value:n,onChange:O=>{r(O.target.value),h(1)},className:"px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[s.jsx("option",{value:"",children:"All Types"}),s.jsx("option",{value:"movie",children:"Movies"}),s.jsx("option",{value:"show",children:"TV Shows"})]}),s.jsxs("select",{value:o,onChange:O=>{c(O.target.value?Number(O.target.value):""),h(1)},className:"px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[s.jsx("option",{value:"",children:"All Libraries"}),A?.map(O=>s.jsx("option",{value:O.id,children:O.title},O.id))]})]}),s.jsxs("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:[C?s.jsx("div",{className:"p-8 text-center text-gray-400",children:"Loading..."}):R?.items?.length?s.jsx("div",{className:"divide-y divide-gray-700",children:R.items.map(O=>s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-4 cursor-pointer",onClick:()=>m(u===O.id?null:O.id),children:[s.jsx("div",{className:"w-16 h-24 bg-gray-700 rounded overflow-hidden flex-shrink-0",children:O.thumb?s.jsx("img",{src:O.thumb,alt:O.title,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center",children:L(O.type)})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[L(O.type),s.jsx("h3",{className:"text-white font-medium truncate",children:O.title}),O.year&&s.jsxs("span",{className:"text-gray-400",children:["(",O.year,")"]})]}),s.jsxs("p",{className:"text-sm text-gray-400 truncate",children:[O.library_name,"  Added ",new Date(O.added_at).toLocaleDateString()]}),!O.thumb&&s.jsxs("p",{className:"text-sm text-yellow-500 flex items-center gap-1 mt-1",children:[s.jsx(Ct,{className:"h-3 w-3"}),"Missing metadata"]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:J=>{J.stopPropagation(),v(O),N(O.title)},className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded",title:"Fix Match",children:s.jsx(qt,{className:"h-4 w-4"})}),s.jsx("button",{onClick:J=>{J.stopPropagation(),x({...O})},className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded",title:"Edit",children:s.jsx(Ri,{className:"h-4 w-4"})}),s.jsx("button",{onClick:J=>{J.stopPropagation(),z.mutate(O.id)},disabled:z.isPending,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded disabled:opacity-50",title:"Refresh Metadata",children:s.jsx(Et,{className:`h-4 w-4 ${z.isPending?"animate-spin":""}`})}),u===O.id?s.jsx(Xg,{className:"h-5 w-5 text-gray-400"}):s.jsx(Uu,{className:"h-5 w-5 text-gray-400"})]})]}),u===O.id&&s.jsxs("div",{className:"mt-4 pl-20 grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-400",children:"Original Title:"}),s.jsx("span",{className:"ml-2 text-white",children:O.original_title||"-"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-400",children:"Sort Title:"}),s.jsx("span",{className:"ml-2 text-white",children:O.sort_title})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-400",children:"Studio:"}),s.jsx("span",{className:"ml-2 text-white",children:O.studio||"-"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-400",children:"Rating:"}),s.jsx("span",{className:"ml-2 text-white",children:O.content_rating||"-"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-400",children:"TMDB ID:"}),s.jsx("span",{className:"ml-2 text-white",children:O.tmdb_id||"Not matched"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-400",children:"Score:"}),s.jsx("span",{className:"ml-2 text-white",children:O.rating?.toFixed(1)||"-"})]}),O.summary&&s.jsxs("div",{className:"col-span-2",children:[s.jsx("span",{className:"text-gray-400",children:"Summary:"}),s.jsx("p",{className:"mt-1 text-white text-sm",children:O.summary})]})]})]},O.id))}):s.jsx("div",{className:"p-8 text-center text-gray-400",children:"No media found"}),R&&R.total>R.page_size&&s.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-700",children:[s.jsxs("p",{className:"text-sm text-gray-400",children:["Showing ",(d-1)*R.page_size+1," to"," ",Math.min(d*R.page_size,R.total)," of ",R.total]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>h(d-1),disabled:d===1,className:"px-3 py-1 bg-gray-700 text-white rounded disabled:opacity-50",children:"Previous"}),s.jsx("button",{onClick:()=>h(d+1),disabled:d*R.page_size>=R.total,className:"px-3 py-1 bg-gray-700 text-white rounded disabled:opacity-50",children:"Next"})]})]})]}),g&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:s.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-xl font-bold text-white",children:"Edit Metadata"}),s.jsx("button",{onClick:()=>x(null),className:"text-gray-400 hover:text-white",children:s.jsx(At,{className:"h-5 w-5"})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Title"}),s.jsx("input",{type:"text",value:g.title,onChange:O=>x({...g,title:O.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Sort Title"}),s.jsx("input",{type:"text",value:g.sort_title,onChange:O=>x({...g,sort_title:O.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Year"}),s.jsx("input",{type:"number",value:g.year||"",onChange:O=>x({...g,year:Number(O.target.value)||void 0}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Studio"}),s.jsx("input",{type:"text",value:g.studio||"",onChange:O=>x({...g,studio:O.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Content Rating"}),s.jsx("input",{type:"text",value:g.content_rating||"",onChange:O=>x({...g,content_rating:O.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Summary"}),s.jsx("textarea",{value:g.summary||"",onChange:O=>x({...g,summary:O.target.value}),rows:4,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]})]}),s.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[s.jsx("button",{onClick:()=>x(null),className:"px-4 py-2 text-gray-400 hover:text-white",children:"Cancel"}),s.jsx("button",{onClick:M,disabled:B.isPending,className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50",children:B.isPending?"Saving...":"Save"})]})]})}),y&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:s.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-2xl max-h-[80vh] overflow-hidden flex flex-col",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h2",{className:"text-xl font-bold text-white",children:["Fix Match: ",y.title]}),s.jsx("button",{onClick:()=>{v(null),N("")},className:"text-gray-400 hover:text-white",children:s.jsx(At,{className:"h-5 w-5"})})]}),s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"relative",children:[s.jsx(qt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search TMDB...",value:S,onChange:O=>N(O.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto",children:V?s.jsx("div",{className:"p-8 text-center text-gray-400",children:"Searching..."}):D?.length?s.jsx("div",{className:"space-y-2",children:D.map(O=>s.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-700 rounded hover:bg-gray-600 cursor-pointer",onClick:()=>I.mutate({id:y.id,tmdbId:O.id,mediaType:O.media_type}),children:[s.jsx("div",{className:"w-12 h-18 bg-gray-600 rounded overflow-hidden flex-shrink-0",children:O.poster_path?s.jsx("img",{src:`https://image.tmdb.org/t/p/w92${O.poster_path}`,alt:O.title,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center",children:s.jsx(fn,{className:"h-4 w-4 text-gray-400"})})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h4",{className:"text-white font-medium truncate",children:O.title}),s.jsxs("span",{className:"text-gray-400 text-sm",children:["(",(O.release_date||O.first_air_date||"").substring(0,4),")"]})]}),s.jsx("p",{className:"text-sm text-gray-400 line-clamp-2",children:O.overview}),s.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["TMDB ID: ",O.id,"  Rating: ",O.vote_average?.toFixed(1)]})]}),s.jsx(qs,{className:"h-5 w-5 text-green-500 flex-shrink-0"})]},O.id))}):s.jsx("div",{className:"p-8 text-center text-gray-400",children:S.length>2?"No results found":"Type to search"})})]})})]})}const Pd=43200,db=1440,ub=Symbol.for("constructDateFrom");function h0(i,e){return typeof i=="function"?i(e):i&&typeof i=="object"&&ub in i?i[ub](e):i instanceof Date?new i.constructor(e):new Date(e)}function Ka(i,e){return h0(i,i)}let $k={};function Gk(){return $k}function hb(i){const e=Ka(i),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+i-+t}function f0(i,...e){const t=h0.bind(null,i||e.find(n=>typeof n=="object"));return e.map(t)}function ou(i,e){const t=+Ka(i)-+Ka(e);return t<0?-1:t>0?1:t}function Vk(i){return h0(i,Date.now())}function Hk(i,e,t){const[n,r]=f0(t?.in,i,e),o=n.getFullYear()-r.getFullYear(),c=n.getMonth()-r.getMonth();return o*12+c}function Kk(i){return e=>{const n=(i?Math[i]:Math.trunc)(e);return n===0?0:n}}function qk(i,e){return+Ka(i)-+Ka(e)}function zk(i,e){const t=Ka(i);return t.setHours(23,59,59,999),t}function Yk(i,e){const t=Ka(i),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}function Wk(i,e){const t=Ka(i);return+zk(t)==+Yk(t)}function Qk(i,e,t){const[n,r,o]=f0(t?.in,i,i,e),c=ou(r,o),d=Math.abs(Hk(r,o));if(d<1)return 0;r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-c*d);let h=ou(r,o)===-c;Wk(n)&&d===1&&ou(n,o)===1&&(h=!1);const u=c*(d-+h);return u===0?0:u}function Xk(i,e,t){const n=qk(i,e)/1e3;return Kk(t?.roundingMethod)(n)}const Jk={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Zk=(i,e,t)=>{let n;const r=Jk[i];return typeof r=="string"?n=r:e===1?n=r.one:n=r.other.replace("{{count}}",e.toString()),t?.addSuffix?t.comparison&&t.comparison>0?"in "+n:n+" ago":n};function fm(i){return(e={})=>{const t=e.width?String(e.width):i.defaultWidth;return i.formats[t]||i.formats[i.defaultWidth]}}const e4={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},t4={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},s4={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},n4={date:fm({formats:e4,defaultWidth:"full"}),time:fm({formats:t4,defaultWidth:"full"}),dateTime:fm({formats:s4,defaultWidth:"full"})},i4={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},a4=(i,e,t,n)=>i4[i];function Wl(i){return(e,t)=>{const n=t?.context?String(t.context):"standalone";let r;if(n==="formatting"&&i.formattingValues){const c=i.defaultFormattingWidth||i.defaultWidth,d=t?.width?String(t.width):c;r=i.formattingValues[d]||i.formattingValues[c]}else{const c=i.defaultWidth,d=t?.width?String(t.width):i.defaultWidth;r=i.values[d]||i.values[c]}const o=i.argumentCallback?i.argumentCallback(e):e;return r[o]}}const r4={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},o4={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},l4={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},c4={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},d4={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},u4={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},h4=(i,e)=>{const t=Number(i),n=t%100;if(n>20||n<10)switch(n%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},f4={ordinalNumber:h4,era:Wl({values:r4,defaultWidth:"wide"}),quarter:Wl({values:o4,defaultWidth:"wide",argumentCallback:i=>i-1}),month:Wl({values:l4,defaultWidth:"wide"}),day:Wl({values:c4,defaultWidth:"wide"}),dayPeriod:Wl({values:d4,defaultWidth:"wide",formattingValues:u4,defaultFormattingWidth:"wide"})};function Ql(i){return(e,t={})=>{const n=t.width,r=n&&i.matchPatterns[n]||i.matchPatterns[i.defaultMatchWidth],o=e.match(r);if(!o)return null;const c=o[0],d=n&&i.parsePatterns[n]||i.parsePatterns[i.defaultParseWidth],h=Array.isArray(d)?g4(d,g=>g.test(c)):m4(d,g=>g.test(c));let u;u=i.valueCallback?i.valueCallback(h):h,u=t.valueCallback?t.valueCallback(u):u;const m=e.slice(c.length);return{value:u,rest:m}}}function m4(i,e){for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)&&e(i[t]))return t}function g4(i,e){for(let t=0;t<i.length;t++)if(e(i[t]))return t}function p4(i){return(e,t={})=>{const n=e.match(i.matchPattern);if(!n)return null;const r=n[0],o=e.match(i.parsePattern);if(!o)return null;let c=i.valueCallback?i.valueCallback(o[0]):o[0];c=t.valueCallback?t.valueCallback(c):c;const d=e.slice(r.length);return{value:c,rest:d}}}const x4=/^(\d+)(th|st|nd|rd)?/i,y4=/\d+/i,v4={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},b4={any:[/^b/i,/^(a|c)/i]},_4={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},S4={any:[/1/i,/2/i,/3/i,/4/i]},E4={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},N4={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},w4={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},T4={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},A4={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},j4={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},C4={ordinalNumber:p4({matchPattern:x4,parsePattern:y4,valueCallback:i=>parseInt(i,10)}),era:Ql({matchPatterns:v4,defaultMatchWidth:"wide",parsePatterns:b4,defaultParseWidth:"any"}),quarter:Ql({matchPatterns:_4,defaultMatchWidth:"wide",parsePatterns:S4,defaultParseWidth:"any",valueCallback:i=>i+1}),month:Ql({matchPatterns:E4,defaultMatchWidth:"wide",parsePatterns:N4,defaultParseWidth:"any"}),day:Ql({matchPatterns:w4,defaultMatchWidth:"wide",parsePatterns:T4,defaultParseWidth:"any"}),dayPeriod:Ql({matchPatterns:A4,defaultMatchWidth:"any",parsePatterns:j4,defaultParseWidth:"any"})},R4={code:"en-US",formatDistance:Zk,formatLong:n4,formatRelative:a4,localize:f4,match:C4,options:{weekStartsOn:0,firstWeekContainsDate:1}};function L4(i,e,t){const n=Gk(),r=t?.locale??n.locale??R4,o=2520,c=ou(i,e);if(isNaN(c))throw new RangeError("Invalid time value");const d=Object.assign({},t,{addSuffix:t?.addSuffix,comparison:c}),[h,u]=f0(t?.in,...c>0?[e,i]:[i,e]),m=Xk(u,h),g=(hb(u)-hb(h))/1e3,x=Math.round((m-g)/60);let y;if(x<2)return t?.includeSeconds?m<5?r.formatDistance("lessThanXSeconds",5,d):m<10?r.formatDistance("lessThanXSeconds",10,d):m<20?r.formatDistance("lessThanXSeconds",20,d):m<40?r.formatDistance("halfAMinute",0,d):m<60?r.formatDistance("lessThanXMinutes",1,d):r.formatDistance("xMinutes",1,d):x===0?r.formatDistance("lessThanXMinutes",1,d):r.formatDistance("xMinutes",x,d);if(x<45)return r.formatDistance("xMinutes",x,d);if(x<90)return r.formatDistance("aboutXHours",1,d);if(x<db){const v=Math.round(x/60);return r.formatDistance("aboutXHours",v,d)}else{if(x<o)return r.formatDistance("xDays",1,d);if(x<Pd){const v=Math.round(x/db);return r.formatDistance("xDays",v,d)}else if(x<Pd*2)return y=Math.round(x/Pd),r.formatDistance("aboutXMonths",y,d)}if(y=Qk(u,h),y<12){const v=Math.round(x/Pd);return r.formatDistance("xMonths",v,d)}else{const v=y%12,S=Math.trunc(y/12);return v<3?r.formatDistance("aboutXYears",S,d):v<9?r.formatDistance("overXYears",S,d):r.formatDistance("almostXYears",S+1,d)}}function k4(i,e){return L4(i,Vk(i),e)}function D4({source:i,onRefresh:e,onDelete:t,onEdit:n,isRefreshing:r}){const o=()=>r?"border-blue-500 bg-blue-500/10":i.lastError?"border-red-500 bg-red-500/5":i.lastFetched?"border-green-500 bg-green-500/5":"border-gray-600 bg-gray-800",c=()=>r?s.jsx(Et,{className:"h-5 w-5 text-blue-400 animate-spin"}):i.lastError?s.jsx(Ct,{className:"h-5 w-5 text-red-400"}):i.lastFetched?s.jsx(vs,{className:"h-5 w-5 text-green-400"}):s.jsx(Ts,{className:"h-5 w-5 text-gray-400"}),d=()=>r?"Refreshing...":i.lastError?"Error":i.lastFetched?"Active":"Never fetched",h=()=>{if(!i.lastFetched)return"Never";try{return k4(new Date(i.lastFetched),{addSuffix:!0})}catch{return"Unknown"}};return s.jsxs("div",{className:`rounded-lg border-2 ${o()} p-4 transition-colors`,children:[s.jsxs("div",{className:"flex items-start justify-between mb-3",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("h3",{className:"font-semibold text-white text-lg",children:i.name}),s.jsx("span",{className:"px-2 py-0.5 bg-indigo-600 text-white text-xs rounded uppercase font-medium",children:i.providerType})]}),s.jsx("p",{className:"text-sm text-gray-400",children:i.providerType==="gracenote"?`${i.gracenoteAffiliate}  ${i.gracenotePostalCode}`:i.url})]}),s.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[c(),s.jsx("span",{className:`text-sm font-medium ${r?"text-blue-400":i.lastError?"text-red-400":i.lastFetched?"text-green-400":"text-gray-400"}`,children:d()})]})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[s.jsxs("div",{className:"bg-gray-700/50 rounded p-2",children:[s.jsxs("div",{className:"flex items-center gap-1.5 text-gray-400 mb-1",children:[s.jsx(ss,{className:"h-3.5 w-3.5"}),s.jsx("span",{className:"text-xs",children:"Channels"})]}),s.jsx("p",{className:"text-lg font-semibold text-white",children:(i.channelCount||0).toLocaleString()})]}),s.jsxs("div",{className:"bg-gray-700/50 rounded p-2",children:[s.jsxs("div",{className:"flex items-center gap-1.5 text-gray-400 mb-1",children:[s.jsx(Fn,{className:"h-3.5 w-3.5"}),s.jsx("span",{className:"text-xs",children:"Programs"})]}),s.jsx("p",{className:"text-lg font-semibold text-white",children:(i.programCount||0).toLocaleString()})]}),s.jsxs("div",{className:"bg-gray-700/50 rounded p-2",children:[s.jsxs("div",{className:"flex items-center gap-1.5 text-gray-400 mb-1",children:[s.jsx(Ts,{className:"h-3.5 w-3.5"}),s.jsx("span",{className:"text-xs",children:"Updated"})]}),s.jsx("p",{className:"text-xs font-medium text-white truncate",children:h()})]})]}),i.lastError&&s.jsx("div",{className:"mb-3 p-2 bg-red-900/20 border border-red-800 rounded",children:s.jsx("p",{className:"text-xs text-red-300",children:i.lastError})}),s.jsxs("div",{className:"flex gap-2",children:[n&&s.jsx("button",{onClick:()=>n(i),disabled:r,className:"px-3 py-1.5 bg-gray-600 hover:bg-gray-500 disabled:bg-gray-700 disabled:cursor-not-allowed text-white text-sm rounded flex items-center justify-center gap-1.5",title:"Edit",children:s.jsx(Ri,{className:"h-4 w-4"})}),s.jsxs("button",{onClick:()=>e(i.id),disabled:r,className:"flex-1 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white text-sm rounded flex items-center justify-center gap-1.5",children:[s.jsx(Et,{className:`h-4 w-4 ${r?"animate-spin":""}`}),r?"Refreshing...":"Refresh"]}),s.jsx("button",{onClick:()=>t(i.id),disabled:r,className:"px-3 py-1.5 bg-red-600 hover:bg-red-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white text-sm rounded",children:"Delete"})]})]})}function fb({type:i,onClose:e}){const t=fk(),n=xk(),[r,o]=P.useState(""),[c,d]=P.useState(""),[h,u]=P.useState("xmltv"),[m,g]=P.useState(""),[x,y]=P.useState(""),[v,S]=P.useState(6),[N,A]=P.useState(null),[R,C]=P.useState(!1),[D,V]=P.useState(""),[z,B]=P.useState(!1),[I,M]=P.useState(!1),[L,O]=P.useState(null),[J,ie]=P.useState(null),{data:ne}=qe({queryKey:["libraries"],queryFn:()=>Re.getLibraries(),enabled:i==="m3u"}),se=ne?.filter(re=>re.type==="movie")||[],X=ne?.filter(re=>re.type==="show")||[],[ce,le]=P.useState([]),[Y,K]=P.useState(null),[H,Q]=P.useState(!1),oe=async()=>{if(!x||x.length<5){V("Please enter a valid 5-digit ZIP code");return}Q(!0),V(""),le([]),K(null),A(null);try{const re=await Re.discoverProviders(x);le(re.grouped);const je=re.grouped.find(Fe=>Fe.type==="Cable");if(je&&je.providers.length>0){const Fe=je.providers[0];K(Fe),g(Fe.headendId),o(Fe.name+" - "+Fe.location)}}catch(re){V(re.response?.data?.error||re.message||"Failed to discover providers")}finally{Q(!1)}},ye=re=>{K(re),g(re.headendId),o(re.name+" - "+re.location),A(null)},xe=async()=>{if(!m){V("Please select a provider first");return}C(!0),V("");try{const re=await Re.previewEPGSource({postalCode:x,affiliate:m,hours:v});A(re)}catch(re){V(re.message||"Failed to preview EPG data"),A(null)}finally{C(!1)}},pe=async re=>{if(re.preventDefault(),i==="m3u")await t.mutateAsync({name:r,url:c,importVod:z,importSeries:I,vodLibraryId:L??void 0,seriesLibraryId:J??void 0});else if(h==="xmltv")await n.mutateAsync({name:r,providerType:"xmltv",url:c});else{if(!m){V("Please select a TV provider");return}await n.mutateAsync({name:r,providerType:"gracenote",gracenoteAffiliate:m,gracenotePostalCode:x,gracenoteHours:v})}e()},ee=t.isPending||n.isPending;return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[s.jsxs("h2",{className:"text-lg font-semibold text-white mb-4",children:["Add ",i==="m3u"?"M3U Playlist":"EPG Source"]}),s.jsxs("form",{onSubmit:pe,children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),s.jsx("input",{type:"text",value:r,onChange:re=>o(re.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:i==="m3u"?"My IPTV":"TV Guide",required:!0})]}),i==="epg"&&s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Provider"}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{type:"button",onClick:()=>u("xmltv"),className:`flex-1 py-2 px-4 rounded-lg border transition-colors ${h==="xmltv"?"bg-indigo-600 border-indigo-600 text-white":"bg-gray-700 border-gray-600 text-gray-300 hover:border-gray-500"}`,children:"XMLTV"}),s.jsx("button",{type:"button",onClick:()=>u("gracenote"),className:`flex-1 py-2 px-4 rounded-lg border transition-colors ${h==="gracenote"?"bg-indigo-600 border-indigo-600 text-white":"bg-gray-700 border-gray-600 text-gray-300 hover:border-gray-500"}`,children:"Gracenote"})]})]}),i==="m3u"&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"URL"}),s.jsx("input",{type:"url",value:c,onChange:re=>d(re.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://example.com/playlist.m3u",required:!0})]}),s.jsxs("div",{className:"mb-6 p-4 bg-gray-700/50 rounded-lg border border-gray-600",children:[s.jsx("h3",{className:"text-sm font-semibold text-white mb-3",children:"Content Import"}),s.jsx("p",{className:"text-xs text-gray-400 mb-3",children:"Choose what to import from this M3U. Live channels are always imported."}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:z,onChange:re=>B(re.target.checked),className:"rounded bg-gray-600 border-gray-500"}),"Import VOD Movies"]}),z&&s.jsx("div",{className:"mt-2 ml-6",children:s.jsxs("select",{value:L||"",onChange:re=>O(re.target.value?parseInt(re.target.value):null),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",children:[s.jsx("option",{value:"",children:"Select Movie Library..."}),se.map(re=>s.jsx("option",{value:re.id,children:re.title},re.id))]})})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:I,onChange:re=>M(re.target.checked),className:"rounded bg-gray-600 border-gray-500"}),"Import TV Series"]}),I&&s.jsx("div",{className:"mt-2 ml-6",children:s.jsxs("select",{value:J||"",onChange:re=>ie(re.target.value?parseInt(re.target.value):null),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",children:[s.jsx("option",{value:"",children:"Select TV Library..."}),X.map(re=>s.jsx("option",{value:re.id,children:re.title},re.id))]})})]})]})]}),i==="epg"&&h==="xmltv"&&s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"XMLTV URL"}),s.jsx("input",{type:"url",value:c,onChange:re=>d(re.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://example.com/guide.xml",required:!0})]}),i==="epg"&&h==="gracenote"&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-4",children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["ZIP Code ",s.jsx("span",{className:"text-red-400",children:"*"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:x,onChange:re=>y(re.target.value.replace(/\D/g,"").slice(0,5)),className:"flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"10001",maxLength:5}),s.jsxs("button",{type:"button",onClick:oe,disabled:H||x.length<5,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg flex items-center gap-2",children:[H?s.jsx(Et,{className:"h-4 w-4 animate-spin"}):s.jsx(Jj,{className:"h-4 w-4"}),"Find"]})]}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter your ZIP code to find available TV providers"})]}),D&&s.jsx("p",{className:"text-sm text-red-400 mb-4",children:D}),ce.length>0&&s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Select Your TV Provider"}),s.jsx("div",{className:"space-y-3",children:ce.map(re=>s.jsxs("div",{children:[s.jsxs("p",{className:"text-xs text-gray-500 mb-2 uppercase tracking-wide",children:[re.type==="Cable"&&" Cable",re.type==="Satellite"&&" Satellite",re.type==="Antenna"&&" Over-the-Air"]}),s.jsx("div",{className:"space-y-1",children:re.providers.map(je=>s.jsx("button",{type:"button",onClick:()=>ye(je),className:`w-full text-left px-4 py-3 rounded-lg border transition-colors ${Y?.headendId===je.headendId?"bg-indigo-600/20 border-indigo-500 text-white":"bg-gray-700/50 border-gray-600 text-gray-300 hover:border-gray-500 hover:bg-gray-700"}`,children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:je.name}),je.location&&s.jsxs("span",{className:"text-gray-400 ml-2 text-sm",children:[" ",je.location]})]}),Y?.headendId===je.headendId&&s.jsx(qs,{className:"h-4 w-4 text-indigo-400"})]})},je.headendId))})]},re.type))})]}),Y&&s.jsx("div",{className:"mb-4",children:s.jsx("button",{type:"button",onClick:xe,disabled:R,className:"w-full py-2 px-4 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg flex items-center justify-center gap-2",children:R?s.jsxs(s.Fragment,{children:[s.jsx(Et,{className:"h-4 w-4 animate-spin"}),"Loading Preview..."]}):s.jsxs(s.Fragment,{children:[s.jsx(qt,{className:"h-4 w-4"}),"Preview Channels (Optional)"]})})}),N&&s.jsxs("div",{className:"mb-4 p-4 bg-gray-700/50 rounded-lg border border-green-500/50",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx(qs,{className:"h-5 w-5 text-green-400"}),s.jsxs("h3",{className:"text-sm font-semibold text-white",children:["Found ",N.totalChannels," channels"]})]}),s.jsx("div",{className:"text-xs text-gray-400 mb-3",children:s.jsxs("p",{children:["Programs: ",N.totalPrograms]})}),s.jsxs("div",{className:"max-h-32 overflow-y-auto space-y-1",children:[s.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Sample channels:"}),N.previewChannels?.slice(0,5).map((re,je)=>s.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-300 py-1",children:[s.jsx("span",{className:"font-medium text-white",children:re.callSign||re.channelId}),re.channelNo&&s.jsxs("span",{className:"text-gray-500",children:["Ch ",re.channelNo]})]},je)),N.totalChannels>5&&s.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["... and ",N.totalChannels-5," more channels"]})]})]}),Y&&s.jsx("div",{className:"mb-4 pt-4 border-t border-gray-700",children:s.jsxs("details",{className:"group",children:[s.jsxs("summary",{className:"text-sm font-medium text-gray-400 cursor-pointer hover:text-white flex items-center gap-2",children:[s.jsx($u,{className:"h-4 w-4"}),"Advanced Settings"]}),s.jsxs("div",{className:"mt-3 space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Provider ID"}),s.jsx("input",{type:"text",value:m,onChange:re=>g(re.target.value),className:"w-full px-3 py-1.5 bg-gray-700 border border-gray-600 rounded text-white text-sm font-mono",readOnly:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Hours of Guide Data"}),s.jsx("input",{type:"number",value:v,onChange:re=>S(parseInt(re.target.value)||6),min:"1",max:"12",className:"w-full px-3 py-1.5 bg-gray-700 border border-gray-600 rounded text-white text-sm"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"1-12 hours (default: 6). API limits longer requests."})]})]})]})})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:ee,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:ee?"Adding...":"Add"})]})]})]})})}function I4({channel:i,onClose:e,epgSources:t}){const n=ft(),[r,o]=P.useState(i.name),[c,d]=P.useState(i.number),[h,u]=P.useState(i.logo||""),[m,g]=P.useState(i.group||""),[x,y]=P.useState(i.epgSourceId||null),[v,S]=P.useState(i.channelId||""),{data:N}=qe({queryKey:["epgChannels",x],queryFn:()=>Re.getEPGChannels(x||void 0),enabled:!!x}),A=Ve({mutationFn:async C=>{const D=await fetch(`/livetv/channels/${i.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Plex-Token":Re.getToken()||""},body:JSON.stringify(C)});if(!D.ok)throw new Error("Failed to update channel");return D.json()},onSuccess:()=>{n.invalidateQueries({queryKey:["channels"]}),e()}}),R=C=>{C.preventDefault(),A.mutate({name:r,number:c,logo:h,group:m,epgSourceId:x??void 0,channelId:v||void 0})};return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-lg font-semibold text-white",children:"Edit Channel"}),s.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white",children:s.jsx(At,{className:"h-5 w-5"})})]}),s.jsxs("form",{onSubmit:R,children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),s.jsx("input",{type:"text",value:r,onChange:C=>o(C.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Number"}),s.jsx("input",{type:"number",value:c,onChange:C=>d(parseInt(C.target.value)||0),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Logo URL"}),s.jsx("input",{type:"text",value:h,onChange:C=>u(C.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"https://..."})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Group"}),s.jsx("input",{type:"text",value:m,onChange:C=>g(C.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"Sports, News, etc."})]}),s.jsxs("div",{className:"mb-4 pt-4 border-t border-gray-700",children:[s.jsx("h3",{className:"text-sm font-semibold text-white mb-3",children:"EPG Mapping"}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"EPG Source"}),s.jsxs("select",{value:x||"",onChange:C=>{const D=C.target.value?parseInt(C.target.value):null;y(D),S("")},className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:[s.jsx("option",{value:"",children:"None"}),t.map(C=>s.jsx("option",{value:C.id,children:C.name},C.id))]}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select an EPG source to match program guide data"})]}),x&&s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"EPG Channel"}),s.jsxs("select",{value:v,onChange:C=>S(C.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:[s.jsx("option",{value:"",children:"Select EPG Channel..."}),N?.map(C=>s.jsxs("option",{value:C.channelId,children:[C.callSign||C.channelId,C.channelNo?` (${C.channelNo})`:""," - ",C.sampleTitle]},C.channelId))]}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Match this channel to an EPG channel ID"})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:A.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:A.isPending?"Saving...":"Save"})]})]})]})})}function M4({onClose:i}){const e=ft(),[t,n]=P.useState(""),[r,o]=P.useState(""),[c,d]=P.useState("file"),[h,u]=P.useState(""),[m,g]=P.useState(null),[x,y]=P.useState(!1),[v,S]=P.useState(!1),[N,A]=P.useState(""),R=P.useRef(null),[C,D]=P.useState({}),[V,z]=P.useState({}),{data:B}=qe({queryKey:["channels"],queryFn:async()=>(await(await fetch("/livetv/channels",{headers:{"X-Plex-Token":Re.getToken()||""}})).json()).channels||[]}),I=ie=>{const ne=ie.target.files?.[0];if(ne){u(ne.name);const se=new FileReader;se.onload=X=>{const ce=X.target?.result;o(ce)},se.onerror=()=>{A("Failed to read file")},se.readAsText(ne)}},M=async()=>{y(!0),A(""),g(null);try{const ie=c==="url"?{url:t,preview:!0}:{content:r,preview:!0},ne=await Re.mapChannelNumbers(ie);g(ne)}catch(ie){A(ie.response?.data?.error||ie.message||"Failed to parse M3U")}finally{y(!1)}},L=async()=>{S(!0),A("");try{const ie=Object.entries(C).map(([X,ce])=>{const le=J.find(Y=>Y.m3uName===X);return{m3uName:X,m3uNumber:le?.m3uNumber||0,channelId:ce}}),ne=c==="url"?{url:t,preview:!1,manualMappings:ie}:{content:r,preview:!1,manualMappings:ie},se=await Re.mapChannelNumbers(ne);g(se),D({}),e.invalidateQueries({queryKey:["channels"]})}catch(ie){A(ie.response?.data?.error||ie.message||"Failed to apply mappings")}finally{S(!1)}},O=m?.results?.filter(ie=>ie.matchType!=="none")||[],J=m?.results?.filter(ie=>ie.matchType==="none")||[];return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-lg font-semibold text-white",children:"Import Channel Numbers from M3U"}),s.jsx("button",{onClick:i,className:"text-gray-400 hover:text-white",children:s.jsx(At,{className:"h-5 w-5"})})]}),s.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Import channel numbers from an M3U file to apply to your existing channels. Only channel numbers will be updated - stream URLs will not be modified."}),s.jsxs("div",{className:"flex gap-2 mb-4",children:[s.jsx("button",{onClick:()=>d("file"),className:`px-4 py-2 rounded-lg text-sm ${c==="file"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Upload File"}),s.jsx("button",{onClick:()=>d("url"),className:`px-4 py-2 rounded-lg text-sm ${c==="url"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"URL"}),s.jsx("button",{onClick:()=>d("paste"),className:`px-4 py-2 rounded-lg text-sm ${c==="paste"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Paste Content"})]}),c==="file"?s.jsxs("div",{className:"mb-4",children:[s.jsx("input",{ref:R,type:"file",accept:".m3u,.m3u8,text/plain",onChange:I,className:"hidden"}),s.jsx("div",{onClick:()=>R.current?.click(),className:"w-full p-6 bg-gray-700 border-2 border-dashed border-gray-600 rounded-lg text-center cursor-pointer hover:border-indigo-500 hover:bg-gray-700/70 transition-colors",children:h?s.jsxs("div",{children:[s.jsx(Fn,{className:"h-8 w-8 text-indigo-400 mx-auto mb-2"}),s.jsx("p",{className:"text-white font-medium",children:h}),s.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Click to choose a different file"})]}):s.jsxs("div",{children:[s.jsx(ra,{className:"h-8 w-8 text-gray-500 mx-auto mb-2"}),s.jsx("p",{className:"text-gray-300",children:"Click to select an M3U file"}),s.jsx("p",{className:"text-gray-500 text-sm mt-1",children:".m3u or .m3u8"})]})})]}):c==="url"?s.jsx("div",{className:"mb-4",children:s.jsx("input",{type:"url",value:t,onChange:ie=>n(ie.target.value),placeholder:"https://example.com/channels.m3u",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"})}):s.jsx("div",{className:"mb-4",children:s.jsx("textarea",{value:r,onChange:ie=>o(ie.target.value),placeholder:`#EXTM3U
#EXTINF:-1 tvg-chno="5",Channel Name
http://...`,className:"w-full h-32 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white font-mono text-sm"})}),N&&s.jsx("div",{className:"mb-4 p-3 bg-red-900/50 border border-red-500 rounded-lg text-red-300 text-sm",children:N}),!m&&s.jsx("button",{onClick:M,disabled:x||!t&&!r,className:"w-full mb-4 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg flex items-center justify-center gap-2",children:x?s.jsxs(s.Fragment,{children:[s.jsx(Et,{className:"h-4 w-4 animate-spin"}),"Parsing..."]}):s.jsxs(s.Fragment,{children:[s.jsx(qt,{className:"h-4 w-4"}),"Preview Matches"]})}),m&&s.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[s.jsxs("div",{className:"flex gap-4 mb-4",children:[s.jsxs("div",{className:"flex-1 p-3 bg-green-900/30 border border-green-500/50 rounded-lg",children:[s.jsx("div",{className:"text-green-400 text-lg font-semibold",children:m.matched}),s.jsx("div",{className:"text-green-300 text-xs",children:"Matched"})]}),s.jsxs("div",{className:"flex-1 p-3 bg-yellow-900/30 border border-yellow-500/50 rounded-lg",children:[s.jsx("div",{className:"text-yellow-400 text-lg font-semibold",children:m.unmatched}),s.jsx("div",{className:"text-yellow-300 text-xs",children:"Unmatched"})]})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto mb-4",children:[O.length>0&&s.jsxs("div",{className:"mb-4",children:[s.jsx("h3",{className:"text-sm font-medium text-white mb-2",children:"Matched Channels"}),s.jsxs("div",{className:"space-y-1",children:[O.slice(0,50).map((ie,ne)=>s.jsxs("div",{className:"flex items-center justify-between text-sm bg-gray-700/50 p-2 rounded",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-indigo-400 font-mono w-12",children:ie.m3uNumber}),s.jsx("span",{className:"text-white",children:ie.m3uName})]}),s.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[s.jsx("span",{className:"text-xs bg-gray-600 px-1.5 py-0.5 rounded",children:ie.matchType}),s.jsxs("span",{children:[" ",ie.matchedName]}),ie.applied&&s.jsx(qs,{className:"h-3 w-3 text-green-400"})]})]},ne)),O.length>50&&s.jsxs("div",{className:"text-xs text-gray-500 text-center py-2",children:["... and ",O.length-50," more"]})]})]}),J.length>0&&s.jsxs("div",{children:[s.jsxs("h3",{className:"text-sm font-medium text-yellow-400 mb-2",children:["Unmatched (",J.length,")",Object.keys(C).length>0&&s.jsxs("span",{className:"text-green-400 ml-2",children:["- ",Object.keys(C).length," manually matched"]})]}),s.jsx("div",{className:"space-y-1",children:J.map((ie,ne)=>{const se=V[ie.m3uName]||"",X=C[ie.m3uName]?B?.find(le=>le.id===C[ie.m3uName]):null,ce=B?.filter(le=>{if(!se)return!0;const Y=se.toLowerCase();return le.name.toLowerCase().includes(Y)||le.number.toString().includes(Y)})||[];return s.jsxs("div",{className:"flex items-center gap-2 text-sm p-2 bg-gray-700/30 rounded",children:[s.jsx("span",{className:"text-indigo-400 font-mono w-12 flex-shrink-0",children:ie.m3uNumber}),s.jsx("span",{className:"text-white flex-shrink-0 min-w-[120px]",children:ie.m3uName}),s.jsx("span",{className:"text-gray-500 mx-2",children:""}),s.jsxs("div",{className:"flex-1 relative",children:[s.jsx("input",{type:"text",value:X?`${X.number} - ${X.name}`:se,onChange:le=>{C[ie.m3uName]&&D(Y=>{const{[ie.m3uName]:K,...H}=Y;return H}),z(Y=>({...Y,[ie.m3uName]:le.target.value}))},onFocus:()=>{X&&(z(le=>({...le,[ie.m3uName]:""})),D(le=>{const{[ie.m3uName]:Y,...K}=le;return K}))},placeholder:"Type to search channels...",className:`w-full px-2 py-1 bg-gray-700 border rounded text-sm ${X?"border-green-500 text-green-300":"border-gray-600 text-white"}`}),se&&!X&&ce.length>0&&s.jsxs("div",{className:"absolute z-10 w-full mt-1 max-h-48 overflow-y-auto bg-gray-800 border border-gray-600 rounded shadow-lg",children:[ce.slice(0,20).map(le=>s.jsxs("div",{onClick:()=>{D(Y=>({...Y,[ie.m3uName]:le.id})),z(Y=>{const{[ie.m3uName]:K,...H}=Y;return H})},className:"px-2 py-1 hover:bg-gray-700 cursor-pointer text-gray-200",children:[le.number," - ",le.name]},le.id)),ce.length>20&&s.jsxs("div",{className:"px-2 py-1 text-gray-500 text-xs",children:["+",ce.length-20," more results..."]})]})]}),X&&s.jsx("button",{onClick:()=>{D(le=>{const{[ie.m3uName]:Y,...K}=le;return K})},className:"text-gray-400 hover:text-red-400",children:s.jsx(At,{className:"h-4 w-4"})}),X&&s.jsx(qs,{className:"h-4 w-4 text-green-400 flex-shrink-0"})]},ne)})})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>g(null),className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Back"}),s.jsx("button",{onClick:L,disabled:v||m.matched===0&&Object.keys(C).length===0,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg flex items-center justify-center gap-2",children:v?s.jsxs(s.Fragment,{children:[s.jsx(Et,{className:"h-4 w-4 animate-spin"}),"Applying..."]}):s.jsxs(s.Fragment,{children:[s.jsx(qs,{className:"h-4 w-4"}),"Apply ",m.matched+Object.keys(C).length," Mappings"]})})]})]})]})})}function O4({source:i,onClose:e}){const t=ft(),[n,r]=P.useState(i.name),[o,c]=P.useState(i.url),[d,h]=P.useState(i.importVod||!1),[u,m]=P.useState(i.importSeries||!1),[g,x]=P.useState(i.vodLibraryId||null),[y,v]=P.useState(i.seriesLibraryId||null),[S,N]=P.useState(""),[A,R]=P.useState(null),{data:C}=qe({queryKey:["libraries"],queryFn:()=>Re.getLibraries()}),D=C?.filter(L=>L.type==="movie")||[],V=C?.filter(L=>L.type==="show")||[],z=Ve({mutationFn:async L=>Re.updateM3USource(i.id,L),onSuccess:()=>{t.invalidateQueries({queryKey:["m3uSources"]}),t.invalidateQueries({queryKey:["channels"]}),e()},onError:L=>{N(L.response?.data?.error||L.message||"Failed to update source")}}),B=Ve({mutationFn:async()=>Re.importM3UVOD(i.id),onSuccess:L=>{R(`VOD import complete: ${L.added} added, ${L.updated} updated`),t.invalidateQueries({queryKey:["m3uSources"]})},onError:L=>{N(L.response?.data?.error||L.message||"Failed to import VOD")}}),I=Ve({mutationFn:async()=>Re.importM3USeries(i.id),onSuccess:L=>{R(L.message),t.invalidateQueries({queryKey:["m3uSources"]})},onError:L=>{N(L.response?.data?.error||L.message||"Failed to import series")}}),M=L=>{L.preventDefault(),N(""),z.mutate({name:n,url:o,importVod:d,importSeries:u,vodLibraryId:g??void 0,seriesLibraryId:y??void 0})};return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-lg font-semibold text-white",children:"Edit M3U Source"}),s.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white",children:s.jsx(At,{className:"h-5 w-5"})})]}),s.jsxs("form",{onSubmit:M,children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),s.jsx("input",{type:"text",value:n,onChange:L=>r(L.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"URL"}),s.jsx("input",{type:"url",value:o,onChange:L=>c(L.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://example.com/playlist.m3u",required:!0}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Update the URL if your provider's IP address changed"})]}),s.jsxs("div",{className:"mb-4 pt-4 border-t border-gray-700",children:[s.jsxs("h3",{className:"text-sm font-semibold text-white mb-3 flex items-center gap-2",children:[s.jsx(fn,{className:"h-4 w-4 text-purple-400"}),"VOD Import Settings"]}),s.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Import movies and series from VOD entries in the M3U playlist"}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("label",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",checked:d,onChange:L=>h(L.target.checked),className:"w-4 h-4 rounded bg-gray-700 border-gray-600 text-indigo-500"}),s.jsx("span",{className:"text-sm text-gray-300",children:"Import Movies (VOD)"})]}),d&&s.jsx("div",{className:"mt-2 ml-7",children:s.jsxs("select",{value:g||"",onChange:L=>x(L.target.value?parseInt(L.target.value):null),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white",children:[s.jsx("option",{value:"",children:"Select Movie Library..."}),D.map(L=>s.jsx("option",{value:L.id,children:L.title},L.id))]})})]}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("label",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",checked:u,onChange:L=>m(L.target.checked),className:"w-4 h-4 rounded bg-gray-700 border-gray-600 text-indigo-500"}),s.jsx("span",{className:"text-sm text-gray-300",children:"Import TV Series"})]}),u&&s.jsx("div",{className:"mt-2 ml-7",children:s.jsxs("select",{value:y||"",onChange:L=>v(L.target.value?parseInt(L.target.value):null),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white",children:[s.jsx("option",{value:"",children:"Select TV Library..."}),V.map(L=>s.jsx("option",{value:L.id,children:L.title},L.id))]})})]}),(d||u)&&s.jsxs("div",{className:"flex gap-2 mt-3",children:[d&&g&&s.jsxs("button",{type:"button",onClick:()=>B.mutate(),disabled:B.isPending,className:"flex-1 py-2 px-3 bg-purple-600 hover:bg-purple-700 text-white text-sm rounded-lg flex items-center justify-center gap-2",children:[B.isPending?s.jsx(Et,{className:"h-4 w-4 animate-spin"}):s.jsx(Os,{className:"h-4 w-4"}),"Import Movies"]}),u&&y&&s.jsxs("button",{type:"button",onClick:()=>I.mutate(),disabled:I.isPending,className:"flex-1 py-2 px-3 bg-purple-600 hover:bg-purple-700 text-white text-sm rounded-lg flex items-center justify-center gap-2",children:[I.isPending?s.jsx(Et,{className:"h-4 w-4 animate-spin"}):s.jsx(Os,{className:"h-4 w-4"}),"Import Series"]})]})]}),A&&s.jsx("div",{className:"mb-4 p-3 bg-green-500/20 border border-green-500/50 rounded-lg",children:s.jsxs("p",{className:"text-sm text-green-300 flex items-center gap-2",children:[s.jsx(qs,{className:"h-4 w-4"}),A]})}),S&&s.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg",children:s.jsxs("p",{className:"text-sm text-red-300 flex items-center gap-2",children:[s.jsx(Ct,{className:"h-4 w-4"}),S]})}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:z.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:z.isPending?"Saving...":"Save Changes"})]})]})]})})}function P4({source:i,onClose:e}){const t=ft(),[n,r]=P.useState(i.name),[o,c]=P.useState(i.serverUrl),[d,h]=P.useState(i.username),[u,m]=P.useState(""),[g,x]=P.useState(i.importVod||!1),[y,v]=P.useState(i.importSeries||!1),[S,N]=P.useState(i.vodLibraryId||null),[A,R]=P.useState(i.seriesLibraryId||null),[C,D]=P.useState(""),{data:V}=qe({queryKey:["libraries"],queryFn:()=>Re.getLibraries()}),z=V?.filter(L=>L.type==="movie")||[],B=V?.filter(L=>L.type==="show")||[],I=Ve({mutationFn:async L=>Re.updateXtreamSource(i.id,L),onSuccess:()=>{t.invalidateQueries({queryKey:["xtreamSources"]}),t.invalidateQueries({queryKey:["channels"]}),e()},onError:L=>{D(L.response?.data?.error||L.message||"Failed to update source")}}),M=L=>{L.preventDefault(),D("");const O={name:n,serverUrl:o,username:d,importVod:g,importSeries:y,vodLibraryId:S??void 0,seriesLibraryId:A??void 0};u&&(O.password=u),I.mutate(O)};return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[s.jsx($n,{className:"h-5 w-5 text-yellow-400"}),"Edit Xtream Source"]}),s.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white",children:s.jsx(At,{className:"h-5 w-5"})})]}),s.jsxs("form",{onSubmit:M,children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),s.jsx("input",{type:"text",value:n,onChange:L=>r(L.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Server URL"}),s.jsx("input",{type:"url",value:o,onChange:L=>c(L.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://server.com:8080",required:!0}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Update the URL if your provider's IP address changed"})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Username"}),s.jsx("input",{type:"text",value:d,onChange:L=>h(L.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Password ",s.jsx("span",{className:"text-gray-500",children:"(leave blank to keep current)"})]}),s.jsx("input",{type:"password",value:u,onChange:L=>m(L.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:""})]}),s.jsxs("div",{className:"mb-6 p-4 bg-gray-700/50 rounded-lg border border-gray-600",children:[s.jsx("h3",{className:"text-sm font-semibold text-white mb-3",children:"Content Import"}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:g,onChange:L=>x(L.target.checked),className:"rounded bg-gray-600 border-gray-500"}),"Import VOD Movies"]}),g&&s.jsx("div",{className:"mt-2 ml-6",children:s.jsxs("select",{value:S||"",onChange:L=>N(L.target.value?parseInt(L.target.value):null),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",children:[s.jsx("option",{value:"",children:"Select Movie Library..."}),z.map(L=>s.jsx("option",{value:L.id,children:L.title},L.id))]})})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:y,onChange:L=>v(L.target.checked),className:"rounded bg-gray-600 border-gray-500"}),"Import TV Series"]}),y&&s.jsx("div",{className:"mt-2 ml-6",children:s.jsxs("select",{value:A||"",onChange:L=>R(L.target.value?parseInt(L.target.value):null),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",children:[s.jsx("option",{value:"",children:"Select TV Library..."}),B.map(L=>s.jsx("option",{value:L.id,children:L.title},L.id))]})})]})]}),C&&s.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg",children:s.jsxs("p",{className:"text-sm text-red-300 flex items-center gap-2",children:[s.jsx(Ct,{className:"h-4 w-4"}),C]})}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:I.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:I.isPending?"Saving...":"Save Changes"})]})]})]})})}function B4({source:i,onClose:e}){const t=ft(),[n,r]=P.useState(i.name),[o,c]=P.useState(i.url||""),[d,h]=P.useState(i.gracenoteAffiliate||""),[u,m]=P.useState(i.gracenotePostalCode||""),[g,x]=P.useState(i.gracenoteHours||6),[y,v]=P.useState(""),S=Ve({mutationFn:async A=>Re.updateEPGSource(i.id,A),onSuccess:()=>{t.invalidateQueries({queryKey:["epgSources"]}),e()},onError:A=>{v(A.response?.data?.error||A.message||"Failed to update source")}}),N=A=>{A.preventDefault(),v(""),i.providerType==="xmltv"?S.mutate({name:n,url:o}):S.mutate({name:n,gracenoteAffiliate:d,gracenotePostalCode:u,gracenoteHours:g})};return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-lg font-semibold text-white",children:"Edit EPG Source"}),s.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white",children:s.jsx(At,{className:"h-5 w-5"})})]}),s.jsxs("form",{onSubmit:N,children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),s.jsx("input",{type:"text",value:n,onChange:A=>r(A.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),i.providerType==="xmltv"?s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"XMLTV URL"}),s.jsx("input",{type:"url",value:o,onChange:A=>c(A.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://example.com/guide.xml",required:!0}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Update the URL if your EPG provider's address changed"})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"ZIP Code"}),s.jsx("input",{type:"text",value:u,onChange:A=>m(A.target.value.replace(/\D/g,"").slice(0,5)),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"10001",maxLength:5})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Provider ID (Headend)"}),s.jsx("input",{type:"text",value:d,onChange:A=>h(A.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white font-mono"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Change if you switched TV providers"})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Hours of Guide Data"}),s.jsx("input",{type:"number",value:g,onChange:A=>x(parseInt(A.target.value)||6),min:"1",max:"12",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"})]})]}),y&&s.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg",children:s.jsxs("p",{className:"text-sm text-red-300 flex items-center gap-2",children:[s.jsx(Ct,{className:"h-4 w-4"}),y]})}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:S.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:S.isPending?"Saving...":"Save Changes"})]})]})]})})}function U4({onClose:i}){const e=ft(),[t,n]=P.useState(""),[r,o]=P.useState(""),[c,d]=P.useState(""),[h,u]=P.useState(""),[m,g]=P.useState(""),[x,y]=P.useState(!1),[v,S]=P.useState(null),[N,A]=P.useState(""),[R,C]=P.useState(!1),[D,V]=P.useState(!1),[z,B]=P.useState(!1),[I,M]=P.useState(null),[L,O]=P.useState(null),{data:J}=qe({queryKey:["libraries"],queryFn:()=>Re.getLibraries()}),ie=J?.filter(K=>K.type==="movie")||[],ne=J?.filter(K=>K.type==="show")||[],[se,X]=P.useState(""),ce=Ve({mutationFn:async K=>Re.createXtreamSource(K),onSuccess:()=>{e.invalidateQueries({queryKey:["xtreamSources"]}),i()},onError:K=>{X(K.response?.data?.error||K.message||"Failed to add source")}}),le=async()=>{if(m){C(!0),A(""),S(null);try{const K=await Re.parseXtreamFromM3U(m);K.success?(S(K),o(K.serverUrl||""),d(K.username||""),u(K.password||""),n(K.name||"")):(A(K.error||"Failed to parse URL"),K.serverUrl&&o(K.serverUrl),K.username&&d(K.username))}catch(K){A(K.message||"Failed to parse URL")}finally{C(!1)}}},Y=async K=>{K.preventDefault(),X(""),await ce.mutateAsync({name:t,serverUrl:r,username:c,password:h,importVod:D,importSeries:z,vodLibraryId:I??void 0,seriesLibraryId:L??void 0})};return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[s.jsx($n,{className:"h-5 w-5 text-yellow-400"}),"Add Xtream Source"]}),s.jsx("button",{onClick:i,className:"text-gray-400 hover:text-white",children:s.jsx(At,{className:"h-5 w-5"})})]}),s.jsxs("div",{className:"mb-6 p-4 bg-gray-700/50 rounded-lg border border-gray-600",children:[s.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-300 mb-2 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:x,onChange:K=>y(K.target.checked),className:"rounded"}),"Auto-detect from M3U URL"]}),x&&s.jsxs("div",{className:"mt-3",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"url",value:m,onChange:K=>g(K.target.value),className:"flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",placeholder:"http://server:port/get.php?username=...&password=..."}),s.jsx("button",{type:"button",onClick:le,disabled:R||!m,className:"px-3 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 text-white rounded-lg text-sm",children:R?s.jsx(Et,{className:"h-4 w-4 animate-spin"}):"Parse"})]}),N&&s.jsxs("p",{className:"text-sm text-yellow-400 mt-2 flex items-center gap-1",children:[s.jsx(Ct,{className:"h-4 w-4"}),N]}),v&&v.success&&s.jsxs("div",{className:"mt-3 p-2 bg-green-500/20 border border-green-500/50 rounded text-sm text-green-300",children:[s.jsx(qs,{className:"inline h-4 w-4 mr-1"}),"Credentials detected! Account status: ",v.userInfo?.status]})]})]}),s.jsxs("form",{onSubmit:Y,children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),s.jsx("input",{type:"text",value:t,onChange:K=>n(K.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"My IPTV Provider",required:!0})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Server URL"}),s.jsx("input",{type:"url",value:r,onChange:K=>o(K.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://server.com:8080",required:!0})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Username"}),s.jsx("input",{type:"text",value:c,onChange:K=>d(K.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Password"}),s.jsx("input",{type:"password",value:h,onChange:K=>u(K.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),s.jsxs("div",{className:"mb-6 p-4 bg-gray-700/50 rounded-lg border border-gray-600",children:[s.jsx("h3",{className:"text-sm font-semibold text-white mb-3",children:"Content Import"}),s.jsx("p",{className:"text-xs text-gray-400 mb-4",children:"Import VOD movies and series from this source into your media libraries"}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:D,onChange:K=>V(K.target.checked),className:"rounded bg-gray-600 border-gray-500"}),"Import VOD Movies"]}),D&&s.jsxs("div",{className:"mt-2 ml-6",children:[s.jsxs("select",{value:I||"",onChange:K=>M(K.target.value?parseInt(K.target.value):null),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",required:D,children:[s.jsx("option",{value:"",children:"Select Movie Library..."}),ie.map(K=>s.jsx("option",{value:K.id,children:K.title},K.id))]}),ie.length===0&&s.jsx("p",{className:"text-xs text-yellow-400 mt-1",children:"No movie libraries found. Create one first."})]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:z,onChange:K=>B(K.target.checked),className:"rounded bg-gray-600 border-gray-500"}),"Import TV Series"]}),z&&s.jsxs("div",{className:"mt-2 ml-6",children:[s.jsxs("select",{value:L||"",onChange:K=>O(K.target.value?parseInt(K.target.value):null),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",required:z,children:[s.jsx("option",{value:"",children:"Select TV Library..."}),ne.map(K=>s.jsx("option",{value:K.id,children:K.title},K.id))]}),ne.length===0&&s.jsx("p",{className:"text-xs text-yellow-400 mt-1",children:"No TV show libraries found. Create one first."})]})]})]}),se&&s.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg",children:s.jsxs("p",{className:"text-sm text-red-300 flex items-center gap-2",children:[s.jsx(Ct,{className:"h-4 w-4"}),se]})}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{type:"button",onClick:i,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:ce.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:ce.isPending?"Adding...":"Add Source"})]})]})]})})}function F4({epgSources:i}){const[e,t]=P.useState(null),[n,r]=P.useState(1),o=50,{data:c,isLoading:d}=qe({queryKey:["epgPrograms",e,n],queryFn:()=>Re.getEPGPrograms({page:n,limit:o,epgSourceId:e||void 0}),enabled:i.length>0}),h=i.reduce((u,m)=>u+(m.programCount||0),0);return s.jsx("div",{children:s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-1",children:"EPG Program Listings"}),s.jsxs("p",{className:"text-sm text-gray-400",children:["Total: ",h.toLocaleString()," programs across ",i.length," source(s)"]})]}),i.length>1&&s.jsxs("select",{value:e||"",onChange:u=>{t(u.target.value?parseInt(u.target.value):null),r(1)},className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",children:[s.jsx("option",{value:"",children:"All Sources"}),i.map(u=>s.jsxs("option",{value:u.id,children:[u.name," (",u.programCount," programs)"]},u.id))]})]}),s.jsx("div",{className:"mb-4 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:s.jsxs("p",{className:"text-sm text-blue-300",children:[s.jsx("strong",{children:"Note:"})," Channel names in gray are EPG channel IDs that haven't been mapped to your M3U channels yet. Go to the ",s.jsx("strong",{children:"Channels"})," tab to assign EPG sources to your channels for proper matching."]})}),d?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto"}),s.jsx("p",{className:"text-gray-400 mt-4",children:"Loading programs..."})]}):c&&c.programs.length>0?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-gray-700/50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left p-3 text-gray-300 text-sm font-medium",children:"Channel"}),s.jsx("th",{className:"text-left p-3 text-gray-300 text-sm font-medium",children:"Program"}),s.jsx("th",{className:"text-left p-3 text-gray-300 text-sm font-medium",children:"Time"}),s.jsx("th",{className:"text-left p-3 text-gray-300 text-sm font-medium",children:"Category"})]})}),s.jsx("tbody",{className:"divide-y divide-gray-700",children:c.programs.map(u=>{const m=new Date(u.start),g=new Date(u.end),x=Math.round((g.getTime()-m.getTime())/6e4),y=u.channelName||u.channelId?.replace(/^(fubo|gracenote)-/,"")||"Unknown",v=!u.channelName;return s.jsxs("tr",{className:"hover:bg-gray-700/30",children:[s.jsxs("td",{className:"p-3",children:[s.jsx("div",{className:`font-medium ${v?"text-gray-400":"text-white"}`,children:y}),v&&s.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["EPG ID: ",u.channelId]})]}),s.jsxs("td",{className:"p-3",children:[s.jsx("div",{className:"font-medium text-white",children:u.title}),u.description&&s.jsx("div",{className:"text-sm text-gray-400 mt-1 line-clamp-2",children:u.description}),u.episodeNum&&s.jsx("div",{className:"text-xs text-gray-500 mt-1",children:u.episodeNum})]}),s.jsxs("td",{className:"p-3",children:[s.jsxs("div",{className:"text-sm text-white",children:[m.toLocaleDateString()," ",m.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),s.jsxs("div",{className:"text-xs text-gray-400",children:[x," min"]})]}),s.jsx("td",{className:"p-3",children:u.category&&s.jsx("span",{className:"inline-block px-2 py-1 bg-gray-700 text-gray-300 text-xs rounded",children:u.category})})]},u.id)})})]})}),c.pages>1&&s.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t border-gray-700",children:[s.jsxs("div",{className:"text-sm text-gray-400",children:["Showing ",(n-1)*o+1," - ",Math.min(n*o,c.total)," of ",c.total.toLocaleString()]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>r(u=>Math.max(1,u-1)),disabled:n===1,className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),s.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,c.pages)},(u,m)=>{let g;return c.pages<=5||n<=3?g=m+1:n>=c.pages-2?g=c.pages-4+m:g=n-2+m,s.jsx("button",{onClick:()=>r(g),className:`px-3 py-1.5 text-sm rounded ${n===g?"bg-indigo-600 text-white":"bg-gray-700 hover:bg-gray-600 text-white"}`,children:g},g)})}),s.jsx("button",{onClick:()=>r(u=>Math.min(c.pages,u+1)),disabled:n===c.pages,className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx(Fn,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-400",children:i.length===0?"No EPG sources configured. Add an EPG source to see program listings.":"No programs found. Try refreshing your EPG sources."})]})]})})}function $4({group:i,channels:e,onEdit:t,onDelete:n,onAddMember:r,onUpdatePriority:o,onRemoveMember:c}){const[d,h]=P.useState(!1),[u,m]=P.useState(!1),[g,x]=P.useState(""),y=new Set(i.members?.map(N=>N.channelId)||[]),S=e.filter(N=>N.enabled&&!y.has(N.id)).filter(N=>N.name.toLowerCase().includes(g.toLowerCase()));return s.jsxs("div",{className:"bg-gray-800 rounded-xl overflow-hidden",children:[s.jsxs("div",{className:"p-4 flex items-center justify-between cursor-pointer hover:bg-gray-750",onClick:()=>h(!d),children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("button",{className:"text-gray-400",children:d?s.jsx(Uu,{className:"h-5 w-5"}):s.jsx(Va,{className:"h-5 w-5"})}),i.logo?s.jsx("img",{src:i.logo,alt:i.name,className:"w-10 h-10 object-contain bg-gray-700 rounded"}):s.jsx("div",{className:"w-10 h-10 bg-gray-700 rounded flex items-center justify-center",children:s.jsx(Ha,{className:"h-5 w-5 text-gray-500"})}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-white font-medium",children:i.name}),s.jsxs("span",{className:"text-gray-500 text-sm",children:["#",i.displayNumber]}),!i.enabled&&s.jsx("span",{className:"px-2 py-0.5 bg-gray-700 text-gray-400 text-xs rounded",children:"Disabled"})]}),s.jsxs("div",{className:"text-sm text-gray-400",children:[i.members?.length||0," source",(i.members?.length||0)!==1?"s":"",i.channelId&&`  EPG: ${i.channelId}`]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",onClick:N=>N.stopPropagation(),children:[s.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded",title:"Edit group",children:s.jsx(Ri,{className:"h-4 w-4"})}),s.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded",title:"Delete group",children:s.jsx(ts,{className:"h-4 w-4"})})]})]}),d&&s.jsxs("div",{className:"border-t border-gray-700 p-4",children:[i.members?.length>0?s.jsxs("div",{className:"space-y-2 mb-4",children:[s.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-2",children:"Priority Order (failover from top to bottom)"}),i.members.sort((N,A)=>N.priority-A.priority).map((N,A)=>s.jsxs("div",{className:"flex items-center justify-between bg-gray-750 rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("span",{className:"text-gray-500 text-sm font-mono w-6",children:[A+1,"."]}),N.channel?.logo?s.jsx("img",{src:N.channel.logo,alt:N.channel.name,className:"w-8 h-8 object-contain bg-gray-700 rounded"}):s.jsx("div",{className:"w-8 h-8 bg-gray-700 rounded flex items-center justify-center",children:s.jsx(sn,{className:"h-4 w-4 text-gray-500"})}),s.jsxs("div",{children:[s.jsx("div",{className:"text-white text-sm",children:N.channel?.name}),s.jsx("div",{className:"text-gray-500 text-xs",children:N.channel?.sourceName||"Unknown source"})]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:()=>o(N.channelId,Math.max(0,N.priority-1)),disabled:A===0,className:"p-1.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded disabled:opacity-30",title:"Move up",children:s.jsx(Wg,{className:"h-4 w-4"})}),s.jsx("button",{onClick:()=>o(N.channelId,N.priority+1),disabled:A===(i.members?.length||0)-1,className:"p-1.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded disabled:opacity-30",title:"Move down",children:s.jsx(Bu,{className:"h-4 w-4"})}),s.jsx("button",{onClick:()=>c(N.channelId),className:"p-1.5 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded",title:"Remove from group",children:s.jsx(At,{className:"h-4 w-4"})})]})]},N.channelId))]}):s.jsx("div",{className:"text-center py-4 text-gray-400 mb-4",children:"No channels in this group. Add channels to enable failover."}),u?s.jsxs("div",{className:"bg-gray-750 rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx(qt,{className:"h-4 w-4 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search channels to add...",value:g,onChange:N=>x(N.target.value),className:"flex-1 bg-transparent text-white placeholder-gray-500 outline-none text-sm",autoFocus:!0}),s.jsx("button",{onClick:()=>{m(!1),x("")},className:"p-1 text-gray-400 hover:text-white",children:s.jsx(At,{className:"h-4 w-4"})})]}),s.jsx("div",{className:"max-h-48 overflow-y-auto space-y-1",children:S.length>0?S.slice(0,20).map(N=>s.jsxs("button",{onClick:()=>{r(N.id,i.members?.length||0),x("")},className:"w-full flex items-center gap-3 p-2 hover:bg-gray-700 rounded text-left",children:[N.logo?s.jsx("img",{src:N.logo,alt:N.name,className:"w-6 h-6 object-contain bg-gray-700 rounded"}):s.jsx("div",{className:"w-6 h-6 bg-gray-700 rounded flex items-center justify-center",children:s.jsx(sn,{className:"h-3 w-3 text-gray-500"})}),s.jsx("span",{className:"text-sm text-white",children:N.name}),s.jsxs("span",{className:"text-xs text-gray-500",children:["#",N.number]})]},N.id)):s.jsx("div",{className:"text-center py-2 text-gray-500 text-sm",children:g?"No matching channels":"No available channels"})})]}):s.jsxs("button",{onClick:()=>m(!0),className:"w-full py-2 border border-dashed border-gray-600 rounded-lg text-gray-400 hover:text-white hover:border-gray-500 flex items-center justify-center gap-2",children:[s.jsx(rs,{className:"h-4 w-4"}),"Add Channel Source"]})]})]})}function mb({group:i,onClose:e,onSave:t,isLoading:n}){const[r,o]=P.useState(i?.name||""),[c,d]=P.useState(i?.displayNumber?.toString()||""),[h,u]=P.useState(i?.logo||""),[m,g]=P.useState(i?.channelId||""),[x,y]=P.useState(i?.enabled??!0),v=S=>{S.preventDefault(),t({name:r,displayNumber:parseInt(c)||0,logo:h||void 0,channelId:m||void 0,enabled:x})};return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[s.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:i?"Edit Channel Group":"Create Channel Group"}),s.jsxs("form",{onSubmit:v,children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Group Name"}),s.jsx("input",{type:"text",value:r,onChange:S=>o(S.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"ESPN",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Channel Number"}),s.jsx("input",{type:"number",value:c,onChange:S=>d(S.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"100",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Logo URL (optional)"}),s.jsx("input",{type:"url",value:h,onChange:S=>u(S.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"https://example.com/logo.png"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"EPG Channel ID (optional)"}),s.jsx("input",{type:"text",value:m,onChange:S=>g(S.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"ESPN.us"})]}),i&&s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("button",{type:"button",onClick:()=>y(!x),className:`w-5 h-5 rounded border flex items-center justify-center ${x?"bg-indigo-600 border-indigo-600":"border-gray-500 hover:border-gray-400"}`,children:x&&s.jsx(qs,{className:"h-3 w-3 text-white"})}),s.jsx("span",{className:"text-sm text-gray-300",children:"Enabled"})]})]}),s.jsxs("div",{className:"mt-6 flex gap-3",children:[s.jsx("button",{type:"button",onClick:e,className:"flex-1 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:n||!r||!c,className:"flex-1 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 text-white rounded-lg",children:n?"Saving...":i?"Save Changes":"Create Group"})]})]})]})})}function G4({results:i,onClose:e,onCreateGroup:t,isCreating:n}){const[r,o]=P.useState(new Set);return!i||i.length===0?s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md text-center",children:[s.jsx(Ha,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),s.jsx("h2",{className:"text-lg font-semibold text-white mb-2",children:"No Duplicates Found"}),s.jsx("p",{className:"text-gray-400 mb-4",children:"No duplicate channels were detected across your sources."}),s.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Close"})]})}):s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-2xl max-h-[80vh] flex flex-col",children:[s.jsx("h2",{className:"text-lg font-semibold text-white mb-2",children:"Detected Duplicate Channels"}),s.jsxs("p",{className:"text-gray-400 text-sm mb-4",children:["Found ",i.length," channel",i.length!==1?"s":""," with duplicates across sources. Create groups to enable automatic failover."]}),s.jsx("div",{className:"flex-1 overflow-y-auto space-y-3",children:i.map((c,d)=>s.jsxs("div",{className:"bg-gray-750 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[c.channels[0]?.logo?s.jsx("img",{src:c.channels[0].logo,alt:c.name,className:"w-8 h-8 object-contain bg-gray-700 rounded"}):s.jsx("div",{className:"w-8 h-8 bg-gray-700 rounded flex items-center justify-center",children:s.jsx(sn,{className:"h-4 w-4 text-gray-500"})}),s.jsxs("div",{children:[s.jsx("div",{className:"text-white font-medium",children:c.name}),s.jsxs("div",{className:"text-gray-500 text-xs",children:[c.channels.length," sources found"]})]})]}),r.has(c.name)?s.jsx("span",{className:"px-3 py-1 bg-green-600/20 text-green-400 text-sm rounded-lg",children:"Created"}):s.jsx("button",{onClick:()=>{t(c),o(h=>new Set([...h,c.name]))},disabled:n,className:"px-3 py-1 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 text-white text-sm rounded-lg",children:"Create Group"})]}),s.jsx("div",{className:"space-y-1 pl-11",children:c.channels.map((h,u)=>s.jsxs("div",{className:"text-sm text-gray-400 flex items-center gap-2",children:[s.jsxs("span",{className:"text-gray-600",children:[u+1,"."]}),s.jsx("span",{children:h.name}),s.jsx("span",{className:"text-gray-600",children:""}),s.jsx("span",{className:"text-gray-500",children:h.sourceName||"Unknown"})]},h.id))})]},d))}),s.jsx("div",{className:"mt-4 pt-4 border-t border-gray-700 flex justify-end",children:s.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Done"})})]})})}function V4(){const i=fc(),e=ft(),{data:t,isLoading:n}=o1(),{data:r,isLoading:o}=pk(),c=mk(),d=gk(),h=yk(),u=vk(),[m,g]=P.useState(null),[x,y]=P.useState("sources"),[v,S]=P.useState(""),[N,A]=P.useState(null),[R,C]=P.useState(!1),[D,V]=P.useState(null),[z,B]=P.useState(null),[I,M]=P.useState(null),[L,O]=P.useState(null),[J,ie]=P.useState(null),[ne,se]=P.useState(null),[X,ce]=P.useState(!1),[le,Y]=P.useState(!1),{data:K,isLoading:H}=qe({queryKey:["xtreamSources"],queryFn:()=>Re.getXtreamSources()}),Q=Ve({mutationFn:we=>Re.deleteXtreamSource(we),onSuccess:()=>{e.invalidateQueries({queryKey:["xtreamSources"]}),e.invalidateQueries({queryKey:["channels"]})}}),oe=Ve({mutationFn:we=>Re.refreshXtreamSource(we),onMutate:we=>ie(we),onSuccess:()=>{e.invalidateQueries({queryKey:["xtreamSources"]}),e.invalidateQueries({queryKey:["channels"]})},onSettled:()=>ie(null)}),[ye,xe]=P.useState(null),[pe,ee]=P.useState(null),re=Ve({mutationFn:we=>Re.importXtreamVOD(we),onMutate:we=>xe(we),onSuccess:we=>{e.invalidateQueries({queryKey:["xtreamSources"]}),alert(`VOD Import: ${we.added} added, ${we.updated} updated`)},onSettled:()=>xe(null)}),je=Ve({mutationFn:we=>Re.importXtreamSeries(we),onMutate:we=>ee(we),onSuccess:()=>{e.invalidateQueries({queryKey:["xtreamSources"]}),e.invalidateQueries({queryKey:["libraryStats"]}),alert("Series import started in background. Check library stats for progress.")},onSettled:()=>ee(null)}),{data:Fe}=qe({queryKey:["libraryStats"],queryFn:async()=>{const we={},dt=new Set;K?.forEach(It=>{It.vodLibraryId&&dt.add(It.vodLibraryId),It.seriesLibraryId&&dt.add(It.seriesLibraryId)});for(const It of dt)try{const bs=await Re.getLibraryStats(It);we[It]={movieCount:bs.movieCount,showCount:bs.showCount,episodeCount:bs.episodeCount}}catch{}return we},enabled:!!K?.length,refetchInterval:1e4}),We=Ve({mutationFn:async we=>{const dt=await fetch(`/livetv/epg/sources/${we}/refresh`,{method:"POST",headers:{"X-Plex-Token":Re.getToken()||""}});if(!dt.ok)throw new Error("Failed to refresh EPG source");return dt.json()},onMutate:we=>{O(we)},onSuccess:()=>{e.invalidateQueries({queryKey:["epgSources"]})},onSettled:()=>{O(null)}}),{data:he,isLoading:Ue}=qe({queryKey:["channels"],queryFn:async()=>(await(await fetch("/livetv/channels",{headers:{"X-Plex-Token":Re.getToken()||""}})).json()).channels,enabled:x==="channels"}),Ge=Ve({mutationFn:async({id:we,enabled:dt})=>{const It=await fetch(`/livetv/channels/${we}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Plex-Token":Re.getToken()||""},body:JSON.stringify({enabled:dt})});if(!It.ok)throw new Error("Failed to update channel");return It.json()},onSuccess:()=>{e.invalidateQueries({queryKey:["channels"]})}}),vt=Ve({mutationFn:async({id:we,enabled:dt})=>{const It=dt?`/livetv/channels/${we}/archive/enable`:`/livetv/channels/${we}/archive/disable`,bs=await fetch(It,{method:"POST",headers:{"Content-Type":"application/json","X-Plex-Token":Re.getToken()||""},body:dt?JSON.stringify({days:7}):void 0});if(!bs.ok)throw new Error("Failed to update channel archive");return bs.json()},onSuccess:()=>{e.invalidateQueries({queryKey:["channels"]})}}),{data:Ke,isLoading:ht}=qe({queryKey:["channelGroups"],queryFn:()=>Re.getChannelGroups(),enabled:x==="groups"}),Ft=Ve({mutationFn:we=>Re.createChannelGroup(we),onSuccess:()=>{e.invalidateQueries({queryKey:["channelGroups"]}),ce(!1)}}),hs=Ve({mutationFn:({id:we,data:dt})=>Re.updateChannelGroup(we,dt),onSuccess:()=>{e.invalidateQueries({queryKey:["channelGroups"]}),se(null)}}),gs=Ve({mutationFn:we=>Re.deleteChannelGroup(we),onSuccess:()=>{e.invalidateQueries({queryKey:["channelGroups"]})}}),Se=Ve({mutationFn:({groupId:we,channelId:dt,priority:It})=>Re.addChannelToGroup(we,dt,It),onSuccess:()=>{e.invalidateQueries({queryKey:["channelGroups"]})}}),Ye=Ve({mutationFn:({groupId:we,channelId:dt,priority:It})=>Re.updateGroupMemberPriority(we,dt,It),onSuccess:()=>{e.invalidateQueries({queryKey:["channelGroups"]})}}),lt=Ve({mutationFn:({groupId:we,channelId:dt})=>Re.removeChannelFromGroup(we,dt),onSuccess:()=>{e.invalidateQueries({queryKey:["channelGroups"]})}}),[_t,ln]=P.useState(null),[Gs,Vn]=P.useState(!1),Tn=async()=>{Vn(!0);try{const we=await Re.autoDetectDuplicates();ln(we.duplicates),Y(!0)}catch(we){console.error("Failed to auto-detect duplicates:",we)}finally{Vn(!1)}},ri=he?.filter(we=>we.name.toLowerCase().includes(v.toLowerCase())||we.channelId.toLowerCase().includes(v.toLowerCase())||we.group&&we.group.toLowerCase().includes(v.toLowerCase())),oi=he?.filter(we=>we.enabled).length||0,cn=he?.length||0,Pr=he?.filter(we=>we.archiveEnabled).length||0;return s.jsxs("div",{children:[s.jsxs("div",{className:"mb-8 flex items-start justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Live TV"}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Manage your IPTV sources, channels, and program guide"})]}),s.jsxs("button",{onClick:()=>i("/ui/livetv/epg-editor"),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg",children:[s.jsx($u,{className:"h-4 w-4"}),"EPG Editor"]})]}),s.jsxs("div",{className:"flex gap-4 mb-6 border-b border-gray-700",children:[s.jsx("button",{onClick:()=>y("sources"),className:`pb-3 px-1 text-sm font-medium border-b-2 transition-colors ${x==="sources"?"border-indigo-500 text-white":"border-transparent text-gray-400 hover:text-white"}`,children:"Sources"}),s.jsxs("button",{onClick:()=>y("channels"),className:`pb-3 px-1 text-sm font-medium border-b-2 transition-colors ${x==="channels"?"border-indigo-500 text-white":"border-transparent text-gray-400 hover:text-white"}`,children:["Channels ",cn>0&&`(${oi}/${cn})`,Pr>0&&s.jsxs("span",{className:"ml-2 px-1.5 py-0.5 bg-purple-600 text-white text-xs rounded",children:[Pr," recording"]})]}),s.jsx("button",{onClick:()=>y("programs"),className:`pb-3 px-1 text-sm font-medium border-b-2 transition-colors ${x==="programs"?"border-indigo-500 text-white":"border-transparent text-gray-400 hover:text-white"}`,children:"EPG Programs"}),s.jsx("button",{onClick:()=>y("groups"),className:`pb-3 px-1 text-sm font-medium border-b-2 transition-colors ${x==="groups"?"border-indigo-500 text-white":"border-transparent text-gray-400 hover:text-white"}`,children:"Channel Groups"})]}),x==="sources"&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-8",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[s.jsx(ss,{className:"h-5 w-5"}),"M3U Playlists"]}),s.jsxs("button",{onClick:()=>g("m3u"),className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-sm rounded-lg",children:[s.jsx(rs,{className:"h-4 w-4"}),"Add Playlist"]})]}),n?s.jsx("div",{className:"text-gray-400",children:"Loading..."}):t?.length?s.jsx("div",{className:"bg-gray-800 rounded-xl divide-y divide-gray-700",children:t.map(we=>s.jsxs("div",{className:"p-4 flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-white",children:we.name}),s.jsxs("p",{className:"text-sm text-gray-400",children:[we.channelCount," channels",we.lastRefresh&&s.jsxs(s.Fragment,{children:["  Last updated: ",new Date(we.lastRefresh).toLocaleDateString()]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>V(we),className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:"Edit",children:s.jsx(Ri,{className:"h-4 w-4"})}),s.jsx("button",{onClick:()=>d.mutate(we.id),disabled:d.isPending,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:"Refresh",children:s.jsx(Et,{className:`h-4 w-4 ${d.isPending?"animate-spin":""}`})}),s.jsx("button",{onClick:()=>c.mutate(we.id),className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg",title:"Delete",children:s.jsx(ts,{className:"h-4 w-4"})})]})]},we.id))}):s.jsxs("div",{className:"text-center py-8 bg-gray-800 rounded-xl",children:[s.jsx(ss,{className:"h-10 w-10 text-gray-600 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-400",children:"No M3U playlists configured"})]})]}),s.jsxs("div",{className:"mb-8",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[s.jsx($n,{className:"h-5 w-5 text-yellow-400"}),"Xtream Codes API"]}),s.jsxs("button",{onClick:()=>g("xtream"),className:"flex items-center gap-2 px-3 py-1.5 bg-yellow-600 hover:bg-yellow-700 text-white text-sm rounded-lg",children:[s.jsx(rs,{className:"h-4 w-4"}),"Add Xtream"]})]}),H?s.jsx("div",{className:"text-gray-400",children:"Loading..."}):K?.length?s.jsx("div",{className:"bg-gray-800 rounded-xl divide-y divide-gray-700",children:K.map(we=>s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h3",{className:"font-medium text-white",children:we.name}),!we.enabled&&s.jsx("span",{className:"px-2 py-0.5 bg-gray-700 text-gray-400 text-xs rounded",children:"Disabled"})]}),s.jsxs("p",{className:"text-sm text-gray-400",children:[we.channelCount," channels  ",we.username,"@",we.serverUrl.replace(/^https?:\/\//,"")]}),we.expirationDate&&s.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Expires: ",new Date(we.expirationDate).toLocaleDateString()]}),we.lastError&&s.jsxs("p",{className:"text-xs text-red-400 mt-1 flex items-center gap-1",children:[s.jsx(Ct,{className:"h-3 w-3"}),we.lastError]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>B(we),className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:"Edit",children:s.jsx(Ri,{className:"h-4 w-4"})}),s.jsx("button",{onClick:()=>oe.mutate(we.id),disabled:J===we.id,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:"Refresh Channels",children:s.jsx(Et,{className:`h-4 w-4 ${J===we.id?"animate-spin":""}`})}),s.jsx("button",{onClick:()=>Q.mutate(we.id),className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg",title:"Delete",children:s.jsx(ts,{className:"h-4 w-4"})})]})]}),(we.importVod||we.importSeries)&&s.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-700 flex flex-wrap gap-3",children:[we.importVod&&we.vodLibraryId&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-400",children:[s.jsx(fn,{className:"h-4 w-4"}),s.jsxs("span",{children:["VOD: ",Fe?.[we.vodLibraryId]?.movieCount??we.vodCount??0," movies"]})]}),s.jsxs("button",{onClick:()=>re.mutate(we.id),disabled:ye===we.id,className:"px-2 py-1 text-xs bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white rounded flex items-center gap-1",title:"Import VOD Movies",children:[ye===we.id?s.jsx(Et,{className:"h-3 w-3 animate-spin"}):s.jsx(Os,{className:"h-3 w-3"}),"Import"]})]}),we.importSeries&&we.seriesLibraryId&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-400",children:[s.jsx(Mo,{className:"h-4 w-4"}),s.jsxs("span",{children:["Series: ",Fe?.[we.seriesLibraryId]?.showCount??we.seriesCount??0," shows (",Fe?.[we.seriesLibraryId]?.episodeCount??0," episodes)"]})]}),s.jsxs("button",{onClick:()=>je.mutate(we.id),disabled:pe===we.id,className:"px-2 py-1 text-xs bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 text-white rounded flex items-center gap-1",title:"Import TV Series",children:[pe===we.id?s.jsx(Et,{className:"h-3 w-3 animate-spin"}):s.jsx(Os,{className:"h-3 w-3"}),"Import"]})]})]})]},we.id))}):s.jsxs("div",{className:"text-center py-8 bg-gray-800 rounded-xl",children:[s.jsx($n,{className:"h-10 w-10 text-gray-600 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-400",children:"No Xtream Codes sources configured"}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Add your Xtream provider to import channels via API"})]})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[s.jsx(Fn,{className:"h-5 w-5"}),"EPG Sources"]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:()=>u.mutate(),disabled:u.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded-lg",children:[s.jsx(Et,{className:`h-4 w-4 ${u.isPending?"animate-spin":""}`}),"Refresh All"]}),s.jsxs("button",{onClick:()=>g("epg"),className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-sm rounded-lg",children:[s.jsx(rs,{className:"h-4 w-4"}),"Add EPG"]})]})]}),o?s.jsx("div",{className:"text-gray-400",children:"Loading..."}):r?.length?s.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:r.map(we=>s.jsx(D4,{source:we,onRefresh:dt=>We.mutate(dt),onDelete:dt=>h.mutate(dt),onEdit:dt=>M(dt),isRefreshing:L===we.id},we.id))}):s.jsxs("div",{className:"text-center py-8 bg-gray-800 rounded-xl",children:[s.jsx(Fn,{className:"h-10 w-10 text-gray-600 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-400",children:"No EPG sources configured"})]})]})]}),x==="programs"&&s.jsx(F4,{epgSources:r||[]}),x==="channels"&&s.jsxs("div",{children:[s.jsxs("div",{className:"mb-4 flex gap-3",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx(qt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search channels...",value:v,onChange:we=>S(we.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400"})]}),s.jsxs("button",{onClick:()=>C(!0),className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg flex items-center gap-2 whitespace-nowrap",children:[s.jsx(Fn,{className:"h-4 w-4"}),"Import Numbers"]})]}),Ue?s.jsx("div",{className:"text-gray-400",children:"Loading channels..."}):ri?.length?s.jsx("div",{className:"bg-gray-800 rounded-xl overflow-hidden",children:s.jsx("div",{className:"max-h-[600px] overflow-y-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"sticky top-0 bg-gray-800 border-b border-gray-700",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium",children:"Enabled"}),s.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium",children:"#"}),s.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium",children:"Channel"}),s.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium",children:"Group"}),s.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium",children:s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(RA,{className:"h-3 w-3"}),"Catch-up"]})}),s.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium",children:"Actions"})]})}),s.jsx("tbody",{className:"divide-y divide-gray-700",children:ri.map(we=>s.jsxs("tr",{className:we.enabled?"":"opacity-50",children:[s.jsx("td",{className:"p-3",children:s.jsx("button",{onClick:()=>Ge.mutate({id:we.id,enabled:!we.enabled}),className:`w-5 h-5 rounded border flex items-center justify-center ${we.enabled?"bg-indigo-600 border-indigo-600":"border-gray-500 hover:border-gray-400"}`,children:we.enabled&&s.jsx(qs,{className:"h-3 w-3 text-white"})})}),s.jsx("td",{className:"p-3 text-gray-400 text-sm",children:we.number}),s.jsx("td",{className:"p-3",children:s.jsxs("div",{className:"flex items-center gap-3",children:[we.logo?s.jsx("img",{src:we.logo,alt:we.name,className:"w-8 h-8 object-contain bg-gray-700 rounded"}):s.jsx("div",{className:"w-8 h-8 bg-gray-700 rounded flex items-center justify-center",children:s.jsx(sn,{className:"h-4 w-4 text-gray-500"})}),s.jsxs("div",{children:[s.jsx("div",{className:"text-white text-sm",children:we.name}),s.jsx("div",{className:"text-gray-500 text-xs",children:we.channelId})]})]})}),s.jsx("td",{className:"p-3 text-gray-400 text-sm",children:we.group||"-"}),s.jsx("td",{className:"p-3",children:s.jsxs("button",{onClick:()=>vt.mutate({id:we.id,enabled:!we.archiveEnabled}),disabled:!we.enabled,className:`px-2 py-1 rounded text-xs font-medium flex items-center gap-1 ${we.archiveEnabled?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-700 text-gray-400 hover:bg-gray-600 hover:text-white"} ${we.enabled?"":"opacity-50 cursor-not-allowed"}`,title:we.archiveEnabled?"Disable catch-up recording":"Enable catch-up recording (7 days)",children:[s.jsx(Ts,{className:"h-3 w-3"}),we.archiveEnabled?`${we.archiveDays||7}d`:"Off"]})}),s.jsx("td",{className:"p-3",children:s.jsx("button",{onClick:()=>A(we),className:"p-1.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded",title:"Edit",children:s.jsx(Ri,{className:"h-4 w-4"})})})]},we.id))})]})})}):s.jsxs("div",{className:"text-center py-8 bg-gray-800 rounded-xl",children:[s.jsx(sn,{className:"h-10 w-10 text-gray-600 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-400",children:v?"No channels match your search":"No channels loaded"})]})]}),x==="groups"&&s.jsxs("div",{children:[s.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[s.jsxs("div",{className:"text-sm text-gray-400",children:[Ke?.length||0," channel group",Ke?.length!==1?"s":""]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:Tn,disabled:Gs,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 text-white rounded-lg flex items-center gap-2",children:[Gs?s.jsx(Et,{className:"h-4 w-4 animate-spin"}):s.jsx(_u,{className:"h-4 w-4"}),"Auto-Detect Duplicates"]}),s.jsxs("button",{onClick:()=>ce(!0),className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg flex items-center gap-2",children:[s.jsx(rs,{className:"h-4 w-4"}),"Create Group"]})]})]}),ht?s.jsx("div",{className:"text-gray-400",children:"Loading channel groups..."}):Ke?.length?s.jsx("div",{className:"space-y-4",children:Ke.map(we=>s.jsx($4,{group:we,channels:he||[],onEdit:()=>se(we),onDelete:()=>{confirm(`Delete group "${we.name}"?`)&&gs.mutate(we.id)},onAddMember:(dt,It)=>Se.mutate({groupId:we.id,channelId:dt,priority:It}),onUpdatePriority:(dt,It)=>Ye.mutate({groupId:we.id,channelId:dt,priority:It}),onRemoveMember:dt=>lt.mutate({groupId:we.id,channelId:dt})},we.id))}):s.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[s.jsx(Ha,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No Channel Groups"}),s.jsx("p",{className:"text-gray-400 mb-4",children:"Create groups to combine duplicate channels from different sources with automatic failover."}),s.jsxs("button",{onClick:Tn,disabled:Gs,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 text-white rounded-lg inline-flex items-center gap-2",children:[Gs?s.jsx(Et,{className:"h-4 w-4 animate-spin"}):s.jsx(_u,{className:"h-4 w-4"}),"Auto-Detect Duplicates"]})]})]}),m==="m3u"&&s.jsx(fb,{type:"m3u",onClose:()=>g(null)}),m==="epg"&&s.jsx(fb,{type:"epg",onClose:()=>g(null)}),m==="xtream"&&s.jsx(U4,{onClose:()=>g(null)}),N&&s.jsx(I4,{channel:N,onClose:()=>A(null),epgSources:r||[]}),R&&s.jsx(M4,{onClose:()=>C(!1)}),D&&s.jsx(O4,{source:D,onClose:()=>V(null)}),z&&s.jsx(P4,{source:z,onClose:()=>B(null)}),I&&s.jsx(B4,{source:I,onClose:()=>M(null)}),X&&s.jsx(mb,{onClose:()=>ce(!1),onSave:we=>Ft.mutate(we),isLoading:Ft.isPending}),ne&&s.jsx(mb,{group:ne,onClose:()=>se(null),onSave:we=>hs.mutate({id:ne.id,data:we}),isLoading:hs.isPending}),le&&_t&&s.jsx(G4,{results:_t,onClose:()=>{Y(!1),ln(null)},onCreateGroup:async we=>{const dt=await Re.createChannelGroup({name:we.name,displayNumber:we.channels[0]?.number||0,logo:we.channels[0]?.logo});for(let It=0;It<we.channels.length;It++)await Re.addChannelToGroup(dt.id,we.channels[It].id,It);e.invalidateQueries({queryKey:["channelGroups"]})},isCreating:!1})]})}function H4(){const i=ft(),[e,t]=P.useState(""),[n,r]=P.useState(null),[o,c]=P.useState(null),[d,h]=P.useState(new Set),[u,m]=P.useState(null),[g,x]=P.useState(""),[y,v]=P.useState(""),S=P.useRef(null),{data:N}=qe({queryKey:["channels"],queryFn:async()=>(await(await fetch("/livetv/channels",{headers:{"X-Plex-Token":Re.getToken()||""}})).json()).channels}),{data:A}=qe({queryKey:["epgSources"],queryFn:async()=>await Re.getEPGSources()}),{data:R,isLoading:C}=qe({queryKey:["allEPGPrograms",n],queryFn:()=>Re.getEPGPrograms({epgSourceId:n||void 0,limit:1e4}),enabled:!!n}),D=Ve({mutationFn:async he=>{const Ue=await fetch(`/livetv/channels/${he.channelId}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Plex-Token":Re.getToken()||""},body:JSON.stringify({epgSourceId:he.epgSourceId,channelId:he.epgChannelId})});if(!Ue.ok)throw new Error("Failed to update channel");return Ue.json()},onSuccess:()=>{i.invalidateQueries({queryKey:["channels"]}),c(null)}}),V=Ve({mutationFn:async he=>{const Ue=await fetch("/livetv/channels/bulk-map",{method:"POST",headers:{"Content-Type":"application/json","X-Plex-Token":Re.getToken()||""},body:JSON.stringify({channelIds:he.channelIds,epgSourceId:he.epgSourceId,epgChannelId:he.epgChannelId})});if(!Ue.ok)throw new Error("Failed to bulk map channels");return Ue.json()},onSuccess:()=>{i.invalidateQueries({queryKey:["channels"]}),h(new Set),m(null)}}),z=Ve({mutationFn:async he=>{const Ue=await fetch(`/livetv/channels/${he}/epg-mapping`,{method:"DELETE",headers:{"X-Plex-Token":Re.getToken()||""}});if(!Ue.ok)throw new Error("Failed to unmap channel");return Ue.json()},onSuccess:()=>{i.invalidateQueries({queryKey:["channels"]})}}),B=new Map;R?.programs.forEach(he=>{B.has(he.channelId)||B.set(he.channelId,[]),B.get(he.channelId).push(he)});const I=new Date,M=Array.from(B.entries()).map(([he,Ue])=>{const Ge=Ue.find(ht=>new Date(ht.start)<=I&&new Date(ht.end)>I),vt=Ue.find(ht=>new Date(ht.start)>I),Ke=Ue.sort((ht,Ft)=>new Date(Ft.start).getTime()-new Date(ht.start).getTime())[0];return{channelId:he,currentProgram:Ge||vt||Ke,programCount:Ue.length}}).filter(he=>he.currentProgram),L=M.filter(he=>he.channelId.toLowerCase().includes(e.toLowerCase())||he.currentProgram.callSign?.toLowerCase().includes(e.toLowerCase())||he.currentProgram.channelNo?.toLowerCase().includes(e.toLowerCase())||he.currentProgram.affiliateName?.toLowerCase().includes(e.toLowerCase())||he.currentProgram.title.toLowerCase().includes(e.toLowerCase())||he.currentProgram.description?.toLowerCase().includes(e.toLowerCase())),O=(he,Ue)=>{n&&D.mutate({channelId:Ue,epgSourceId:n,epgChannelId:he})},J=he=>N?.filter(Ue=>Ue.channelId===he&&Ue.epgSourceId===n)||[],ie=he=>{const Ue=new Set(d);Ue.has(he)?Ue.delete(he):Ue.add(he),h(Ue)},ne=he=>{!n||d.size===0||V.mutate({channelIds:Array.from(d),epgSourceId:n,epgChannelId:he})},se={"NEW YORK":{CBS:"WCBS",NBC:"WNBC",ABC:"WABC",FOX:"WNYW",CW:"WPIX",PBS:"WNET"},"LOS ANGELES":{CBS:"KCBS",NBC:"KNBC",ABC:"KABC",FOX:"KTTV",CW:"KTLA",PBS:"KCET"},CHICAGO:{CBS:"WBBM",NBC:"WMAQ",ABC:"WLS",FOX:"WFLD",CW:"WGN",PBS:"WTTW"},PHILADELPHIA:{CBS:"KYW",NBC:"WCAU",ABC:"WPVI",FOX:"WTXF",CW:"WPHL",PBS:"WHYY"},DALLAS:{CBS:"KTVT",NBC:"KXAS",ABC:"WFAA",FOX:"KDFW",CW:"KDAF",PBS:"KERA"},"SAN FRANCISCO":{CBS:"KPIX",NBC:"KNTV",ABC:"KGO",FOX:"KTVU",CW:"KBCW",PBS:"KQED"},BOSTON:{CBS:"WBZ",NBC:"WBTS",ABC:"WCVB",FOX:"WFXT",CW:"WLVI",PBS:"WGBH"},ATLANTA:{CBS:"WGCL",NBC:"WXIA",ABC:"WSB",FOX:"WAGA",CW:"WPCH",PBS:"WGTV"},SEATTLE:{CBS:"KIRO",NBC:"KING",ABC:"KOMO",FOX:"KCPQ",CW:"KSTW",PBS:"KCTS"},HOUSTON:{CBS:"KHOU",NBC:"KPRC",ABC:"KTRK",FOX:"KRIV",CW:"KIAH",PBS:"KUHT"},DENVER:{CBS:"KCNC",NBC:"KUSA",ABC:"KMGH",FOX:"KDVR",CW:"KWGN",PBS:"KRMA"},PHOENIX:{CBS:"KPHO",NBC:"KPNX",ABC:"KNXV",FOX:"KSAZ",CW:"KASW",PBS:"KAET"},MINNEAPOLIS:{CBS:"WCCO",NBC:"KARE",ABC:"KSTP",FOX:"KMSP",CW:"WUCW",PBS:"TPT"},MIAMI:{CBS:"WFOR",NBC:"WTVJ",ABC:"WPLG",FOX:"WSVN",CW:"WSFL",PBS:"WPBT"},"WASHINGTON DC":{CBS:"WUSA",NBC:"WRC",ABC:"WJLA",FOX:"WTTG",CW:"WDCW",PBS:"WETA"},DETROIT:{CBS:"WWJ",NBC:"WDIV",ABC:"WXYZ",FOX:"WJBK",CW:"WKBD",PBS:"WTVS"}},X=he=>{const Ue=he.toUpperCase(),Ge={"NEW YORK":["NEW YORK","NY ","NYC","A3 NEW YORK","WCBS","WNBC","WABC","WNYW","WPIX"],"LOS ANGELES":["LOS ANGELES","LA ","L.A.","KCBS","KNBC","KABC","KTTV","KTLA"],CHICAGO:["CHICAGO","CHI","WBBM","WMAQ","WLS","WFLD","WGN"],PHILADELPHIA:["PHILADELPHIA","PHILLY","KYW","WCAU","WPVI"],DALLAS:["DALLAS","DFW","KTVT","KXAS","WFAA","KDFW"],"SAN FRANCISCO":["SAN FRANCISCO","SF ","BAY AREA","KPIX","KNTV","KGO","KTVU"],BOSTON:["BOSTON","WBZ","WBTS","WCVB","WFXT"],ATLANTA:["ATLANTA","ATL","WGCL","WXIA","WSB","WAGA"],SEATTLE:["SEATTLE","SEA","KIRO","KING","KOMO","KCPQ"],HOUSTON:["HOUSTON","KHOU","KPRC","KTRK","KRIV"],DENVER:["DENVER","KCNC","KUSA","KMGH","KDVR"],PHOENIX:["PHOENIX","PHX","KPHO","KPNX","KNXV","KSAZ"],MINNEAPOLIS:["MINNEAPOLIS","TWIN CITIES","WCCO","KARE","KSTP","KMSP"],MIAMI:["MIAMI","WFOR","WTVJ","WPLG","WSVN"],"WASHINGTON DC":["WASHINGTON","DC","WUSA","WRC","WJLA","WTTG"],DETROIT:["DETROIT","WWJ","WDIV","WXYZ","WJBK"]};for(const[vt,Ke]of Object.entries(Ge))if(Ke.some(ht=>Ue.includes(ht)))return vt;return null},ce=()=>{const he=A?.find(vt=>vt.id===n);if(!he?.gracenotePostalCode)return null;const Ue=he.gracenotePostalCode.substring(0,3);return{100:"NEW YORK",101:"NEW YORK",102:"NEW YORK",103:"NEW YORK",104:"NEW YORK",105:"NEW YORK",106:"NEW YORK",107:"NEW YORK",108:"NEW YORK",109:"NEW YORK",110:"NEW YORK",111:"NEW YORK",112:"NEW YORK",113:"NEW YORK",114:"NEW YORK",900:"LOS ANGELES",901:"LOS ANGELES",902:"LOS ANGELES",903:"LOS ANGELES",904:"LOS ANGELES",905:"LOS ANGELES",906:"LOS ANGELES",907:"LOS ANGELES",908:"LOS ANGELES",910:"LOS ANGELES",911:"LOS ANGELES",912:"LOS ANGELES",913:"LOS ANGELES",914:"LOS ANGELES",915:"LOS ANGELES",916:"LOS ANGELES",917:"LOS ANGELES",918:"LOS ANGELES",600:"CHICAGO",601:"CHICAGO",602:"CHICAGO",603:"CHICAGO",604:"CHICAGO",605:"CHICAGO",606:"CHICAGO",607:"CHICAGO",608:"CHICAGO",190:"PHILADELPHIA",191:"PHILADELPHIA",192:"PHILADELPHIA",193:"PHILADELPHIA",194:"PHILADELPHIA",750:"DALLAS",751:"DALLAS",752:"DALLAS",753:"DALLAS",754:"DALLAS",755:"DALLAS",940:"SAN FRANCISCO",941:"SAN FRANCISCO",942:"SAN FRANCISCO",943:"SAN FRANCISCO",944:"SAN FRANCISCO",945:"SAN FRANCISCO",946:"SAN FRANCISCO",947:"SAN FRANCISCO","021":"BOSTON","022":"BOSTON","023":"BOSTON","024":"BOSTON",300:"ATLANTA",301:"ATLANTA",302:"ATLANTA",303:"ATLANTA",304:"ATLANTA",305:"ATLANTA",306:"ATLANTA",307:"ATLANTA",308:"ATLANTA",309:"ATLANTA",310:"ATLANTA",311:"ATLANTA",312:"ATLANTA",313:"ATLANTA",314:"ATLANTA",315:"ATLANTA",316:"ATLANTA",317:"ATLANTA",318:"ATLANTA",319:"ATLANTA",980:"SEATTLE",981:"SEATTLE",982:"SEATTLE",983:"SEATTLE",984:"SEATTLE",770:"HOUSTON",771:"HOUSTON",772:"HOUSTON",773:"HOUSTON",774:"HOUSTON",775:"HOUSTON",776:"HOUSTON",777:"HOUSTON",778:"HOUSTON",779:"HOUSTON",800:"DENVER",801:"DENVER",802:"DENVER",803:"DENVER",804:"DENVER",805:"DENVER",850:"PHOENIX",851:"PHOENIX",852:"PHOENIX",853:"PHOENIX",550:"MINNEAPOLIS",551:"MINNEAPOLIS",553:"MINNEAPOLIS",554:"MINNEAPOLIS",555:"MINNEAPOLIS",330:"MIAMI",331:"MIAMI",332:"MIAMI",333:"MIAMI",334:"MIAMI",200:"WASHINGTON DC",201:"WASHINGTON DC",202:"WASHINGTON DC",203:"WASHINGTON DC",204:"WASHINGTON DC",205:"WASHINGTON DC",206:"WASHINGTON DC",207:"WASHINGTON DC",208:"WASHINGTON DC",209:"WASHINGTON DC",210:"WASHINGTON DC",211:"WASHINGTON DC",212:"WASHINGTON DC",220:"WASHINGTON DC",221:"WASHINGTON DC",222:"WASHINGTON DC",223:"WASHINGTON DC",480:"DETROIT",481:"DETROIT",482:"DETROIT",483:"DETROIT",484:"DETROIT"}[Ue]||null},le=he=>{const Ue=he.toUpperCase();return Ue.includes("CBS")?"CBS":Ue.includes("NBC")?"NBC":Ue.includes("ABC")?"ABC":Ue.includes("FOX")?"FOX":Ue.includes("PBS")?"PBS":Ue.includes("CW")?"CW":null},K=(()=>{const he=ce();if(!he||d.size===0)return null;const Ue=[];return d.forEach(Ge=>{const vt=N?.find(ht=>ht.id===Ge);if(!vt)return;const Ke=X(vt.name);if(Ke&&Ke!==he){const ht=le(vt.name),Ft=ht&&se[he]?.[ht];Ue.push({channel:vt,m3uMarket:Ke,network:ht,localEquivalent:Ft})}}),Ue.length>0?{epgMarket:he,mismatches:Ue}:null})(),H=he=>{const Ue={CBS:["CBS","WCBS","KCBS","KIRO","WBBM","KDKA","KYW","WJZ","WCCO","WWJ","KCNC","KTVT","KHOU","KPIX","KCAL","CBS TELEVISION"],NBC:["NBC","WNBC","KNBC","KING","WMAQ","WCAU","WRC","WTVJ","KXAS","NATIONAL BROADCASTING"],ABC:["ABC","WABC","KABC","KOMO","WLS","WPVI","KGO","WTVD","AMERICAN BROADCASTING"],FOX:["FOX","WNYW","KTTV","KCPQ","WFLD","WTXF","WTTG","KRIV","FOX ENTERTAINMENT"],PBS:["PBS","WNET","WGBH","KCTS","KCET","WETA","PUBLIC BROADCASTING"],CW:["CW","WPIX","KTLA","KSTW"],ESPN:["ESPN","ESPN2","ESPNU","ESPNEWS"],CNN:["CNN","HLN"],MSNBC:["MSNBC"],HBO:["HBO"],SHOWTIME:["SHOWTIME","SHO"],DISCOVERY:["DISCOVERY","TLC","HGTV","FOOD NETWORK"],NICKELODEON:["NICKELODEON","NICK","NICKJR","NICKTOONS"],DISNEY:["DISNEY","DISN","DXD"],CARTOON:["CARTOON","TOON","BOOMERANG"],AMC:["AMC"],TNT:["TNT","TBS","TRUTV"],USA:["USA NETWORK","USA"],FX:["FX","FXX","FXM"],BRAVO:["BRAVO"],SYFY:["SYFY","SCI-FI"],HALLMARK:["HALLMARK"],LIFETIME:["LIFETIME","LMN"],HISTORY:["HISTORY","H2"],NATGEO:["NAT GEO","NATIONAL GEOGRAPHIC","NGWILD"],COMEDY:["COMEDY CENTRAL","COMEDY"],MTV:["MTV","VH1","CMT"],BET:["BET"],OXYGEN:["OXYGEN"],ANIMAL:["ANIMAL PLANET"]},Ge=he.toUpperCase(),vt=[];for(const[Ke,ht]of Object.entries(Ue))for(const Ft of ht)if(Ge.includes(Ft)){vt.push(Ke),vt.push(Ft);const hs=ce();hs&&se[hs]?.[Ke]&&vt.push(se[hs][Ke]);break}return vt},Q=()=>{if(d.size===0)return[];const he=[];return d.forEach(Ue=>{const Ge=N?.find(vt=>vt.id===Ue);Ge&&he.push(...H(Ge.name))}),[...new Set(he)]},oe=(he,Ue)=>{if(Ue.length===0)return!1;const Ge=he.currentProgram.callSign?.toUpperCase()||"",vt=he.currentProgram.affiliateName?.toUpperCase()||"",Ke=he.channelId.toUpperCase();return Ue.some(ht=>Ge.includes(ht)||vt.includes(ht)||Ke.includes(ht))},ye=Q(),xe=ye.length>0?L.filter(he=>oe(he,ye)):[],pe=ye.length>0?L.filter(he=>!oe(he,ye)):L,ee=P.useMemo(()=>{if(!N)return[];if(!g.trim())return N;const he=g.toLowerCase();return N.filter(Ue=>Ue.name.toLowerCase().includes(he)||Ue.number.toString().includes(he)||Ue.group?.toLowerCase().includes(he))},[N,g]),re=P.useMemo(()=>{const he={};return ee.forEach(Ue=>{const Ge=Ue.group||"Uncategorized";he[Ge]||(he[Ge]=[]),he[Ge].push(Ue)}),Object.entries(he).sort((Ue,Ge)=>Ue[0].localeCompare(Ge[0]))},[ee]),je=P.useMemo(()=>{if(!N)return[];if(!y.trim())return N;const he=y.toLowerCase();return N.filter(Ue=>Ue.name.toLowerCase().includes(he)||Ue.number.toString().includes(he)||Ue.group?.toLowerCase().includes(he))},[N,y]),Fe=P.useMemo(()=>{const he={};return je.forEach(Ue=>{const Ge=Ue.group||"Uncategorized";he[Ge]||(he[Ge]=[]),he[Ge].push(Ue)}),Object.entries(he).sort((Ue,Ge)=>Ue[0].localeCompare(Ge[0]))},[je]);P.useEffect(()=>{o&&S.current&&S.current.focus()},[o]);const We=()=>{c(null),x("")};return s.jsxs("div",{className:"h-screen flex flex-col bg-gray-900",children:[s.jsxs("div",{className:"p-6 border-b border-gray-700",children:[s.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"EPG Mapper - Simple Mode"}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Select EPG Source"}),s.jsxs("select",{value:n||"",onChange:he=>r(he.target.value?parseInt(he.target.value):null),className:"w-full max-w-md px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white",children:[s.jsx("option",{value:"",children:"Choose an EPG source..."}),A?.map(he=>s.jsxs("option",{value:he.id,children:[he.name," (",he.channelCount," channels, ",he.programCount," programs)"]},he.id))]})]}),n&&s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("div",{className:"relative max-w-md flex-1",children:[s.jsx(qt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search EPG channels or programs...",value:e,onChange:he=>t(he.target.value),className:"w-full pl-10 pr-10 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400"}),e&&s.jsx("button",{onClick:()=>t(""),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 hover:bg-gray-700 rounded",title:"Clear search",children:s.jsx(At,{className:"h-4 w-4 text-gray-400"})})]}),e&&s.jsxs("button",{onClick:()=>t(""),className:"px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg text-sm font-medium",children:["Clear Filter - Show All ",M.length," Channels"]})]})]}),n&&s.jsxs("div",{className:"px-6 py-3 bg-gray-800 border-b border-gray-700 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(qs,{className:"h-5 w-5 text-indigo-400"}),s.jsx("span",{className:"text-white font-medium",children:d.size>0?`${d.size} M3U channel(s) selected`:"Select M3U channels to bulk map"})]}),s.jsxs("div",{className:"flex gap-2",children:[d.size>0&&s.jsx("button",{onClick:()=>h(new Set),className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded",children:"Clear Selection"}),s.jsxs("button",{onClick:()=>m("selecting"),className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-sm rounded flex items-center gap-1.5",children:[s.jsx(qs,{className:"h-4 w-4"}),d.size>0?`Selected ${d.size} channels`:"Select M3U Channels..."]})]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:n?C?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto"}),s.jsx("p",{className:"text-gray-400 mt-4",children:"Loading EPG channels..."})]}):s.jsxs("div",{className:"max-w-6xl mx-auto",children:[s.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[s.jsxs("span",{className:"text-sm text-gray-400",children:["Showing ",L.length," of ",M.length," EPG channels",e&&s.jsxs("span",{className:"ml-1 text-yellow-400",children:['(filtered by "',e,'")']})]}),ye.length>0&&xe.length>0&&s.jsxs("span",{className:"text-sm text-green-400",children:["(",xe.length," suggested matches)"]}),e&&s.jsx("button",{onClick:()=>t(""),className:"text-sm text-yellow-400 hover:text-yellow-300 underline",children:"Clear filter to see all channels"})]}),K&&s.jsx("div",{className:"mb-6 bg-yellow-900/30 border-2 border-yellow-600/50 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("span",{className:"text-2xl",children:""}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-bold text-yellow-400 text-lg mb-2",children:"Market Mismatch Detected"}),s.jsxs("p",{className:"text-yellow-200 mb-3",children:["Your EPG source is for ",s.jsx("span",{className:"font-bold",children:K.epgMarket}),", but some selected M3U channels appear to be from different markets:"]}),s.jsx("div",{className:"space-y-2 mb-4",children:K.mismatches.map(({channel:he,m3uMarket:Ue,network:Ge,localEquivalent:vt})=>s.jsxs("div",{className:"bg-yellow-900/30 rounded p-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-white font-medium",children:he.name}),s.jsxs("span",{className:"text-yellow-300 ml-2",children:["(",Ue,")"]})]}),vt&&s.jsxs("div",{className:"text-sm",children:[s.jsxs("span",{className:"text-gray-400",children:["Local ",Ge,": "]}),s.jsx("span",{className:"text-green-400 font-bold",children:vt})]})]}),vt&&s.jsxs("p",{className:"text-sm text-yellow-200/70 mt-1",children:[" Look for ",s.jsx("span",{className:"font-bold text-green-400",children:vt})," in the suggestions below - it's the ",K.epgMarket," ",Ge," affiliate"]})]},he.id))}),s.jsx("p",{className:"text-sm text-yellow-200/70",children:"You can still map these channels, but the EPG data may not match. Consider adding an EPG source for the channel's market or use the local equivalent."})]})]})}),d.size>0&&xe.length>0&&s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full animate-pulse"}),s.jsx("h2",{className:"text-lg font-semibold text-green-400",children:" Suggested Matches for Your Selection"})]}),s.jsxs("p",{className:"text-sm text-gray-400 mb-3",children:["Based on your selected M3U channel(s), these EPG channels are likely matches",ce()&&s.jsxs("span",{className:"text-blue-400",children:[" in ",ce()]}),":"]}),s.jsx("div",{className:"space-y-3",children:xe.map(he=>{const Ue=new Date(he.currentProgram.start)<=I&&new Date(he.currentProgram.end)>I;return s.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border-2 border-green-600/50 shadow-lg shadow-green-900/20",children:s.jsxs("div",{className:"flex items-start justify-between gap-4",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsxs("h3",{className:"font-semibold text-white text-lg",children:[he.currentProgram.callSign||he.channelId.replace(/^(gracenote|fubo)-/,""),he.currentProgram.channelNo&&s.jsxs("span",{className:"ml-2 text-gray-400",children:["Ch ",he.currentProgram.channelNo]})]}),he.currentProgram.affiliateName&&s.jsx("span",{className:"px-3 py-1 bg-green-600 text-white text-sm rounded font-medium",children:he.currentProgram.affiliateName}),Ue&&s.jsx("span",{className:"px-2 py-0.5 bg-red-600 text-white text-xs rounded font-medium",children:"LIVE NOW"})]}),s.jsxs("div",{className:"mb-1",children:[s.jsx("p",{className:"text-white font-medium",children:he.currentProgram.title}),he.currentProgram.description&&s.jsx("p",{className:"text-sm text-gray-400 line-clamp-2 mt-1",children:he.currentProgram.description})]}),J(he.channelId).length>0&&s.jsxs("div",{className:"mt-3 space-y-1.5",children:[s.jsx("p",{className:"text-xs text-gray-400 font-medium",children:"Mapped M3U Channels:"}),J(he.channelId).map(Ge=>s.jsxs("div",{className:"flex items-center gap-2 text-sm bg-gray-700/50 rounded px-2 py-1.5",children:[s.jsx(qs,{className:"h-3.5 w-3.5 text-green-400 flex-shrink-0"}),s.jsxs("span",{className:"text-white flex-1",children:[Ge.name," (#",Ge.number,")"]}),s.jsx("button",{onClick:()=>z.mutate(Ge.id),className:"text-red-400 hover:text-red-300 text-xs px-2 py-0.5 hover:bg-red-900/20 rounded",children:"Unmap"})]},Ge.id))]})]}),s.jsx("div",{className:"flex-shrink-0",children:s.jsxs("button",{onClick:()=>ne(he.channelId),className:"px-6 py-3 bg-green-600 hover:bg-green-700 text-white text-sm rounded-lg font-bold flex items-center gap-2 shadow-lg",children:[s.jsx(qs,{className:"h-5 w-5"}),"Map ",d.size," Here"]})})]})},he.channelId)})}),pe.length>0&&s.jsx("div",{className:"mt-6 mb-3",children:s.jsx("h2",{className:"text-lg font-semibold text-gray-400",children:"Other EPG Channels"})})]}),s.jsx("div",{className:"space-y-3",children:(d.size>0&&xe.length>0?pe:L).map(he=>{const Ue=new Date(he.currentProgram.start)<=I&&new Date(he.currentProgram.end)>I;return s.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:s.jsxs("div",{className:"flex items-start justify-between gap-4",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsxs("h3",{className:"font-semibold text-white",children:[he.currentProgram.callSign||he.channelId.replace(/^(gracenote|fubo)-/,""),he.currentProgram.channelNo&&s.jsxs("span",{className:"ml-2 text-gray-400",children:["Ch ",he.currentProgram.channelNo]})]}),he.currentProgram.affiliateName&&s.jsx("span",{className:"px-2 py-0.5 bg-blue-600 text-white text-xs rounded",children:he.currentProgram.affiliateName}),Ue&&s.jsx("span",{className:"px-2 py-0.5 bg-red-600 text-white text-xs rounded font-medium",children:"LIVE NOW"}),s.jsxs("span",{className:"text-xs text-gray-500",children:[he.programCount," programs"]})]}),s.jsxs("div",{className:"mb-1",children:[s.jsx("p",{className:"text-white font-medium",children:he.currentProgram.title}),he.currentProgram.description&&s.jsx("p",{className:"text-sm text-gray-400 line-clamp-2 mt-1",children:he.currentProgram.description})]}),s.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[s.jsx("span",{children:new Date(he.currentProgram.start).toLocaleString()}),he.currentProgram.category&&s.jsx("span",{className:"px-2 py-1 bg-gray-700 rounded",children:he.currentProgram.category})]}),J(he.channelId).length>0&&s.jsxs("div",{className:"mt-3 space-y-1.5",children:[s.jsx("p",{className:"text-xs text-gray-400 font-medium",children:"Mapped M3U Channels:"}),J(he.channelId).map(Ge=>s.jsxs("div",{className:"flex items-center gap-2 text-sm bg-gray-700/50 rounded px-2 py-1.5",children:[s.jsx(qs,{className:"h-3.5 w-3.5 text-green-400 flex-shrink-0"}),s.jsxs("span",{className:"text-white flex-1",children:[Ge.name," (#",Ge.number,")"]}),s.jsx("button",{onClick:()=>z.mutate(Ge.id),className:"text-red-400 hover:text-red-300 text-xs px-2 py-0.5 hover:bg-red-900/20 rounded",title:"Remove mapping",children:"Unmap"})]},Ge.id))]})]}),s.jsxs("div",{className:"flex-shrink-0 flex flex-col gap-2",children:[d.size>0&&s.jsxs("button",{onClick:()=>ne(he.channelId),className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm rounded font-medium flex items-center gap-1.5",children:[s.jsx(qs,{className:"h-4 w-4"}),"Map ",d.size," Selected Here"]}),s.jsx("button",{onClick:()=>c(he.channelId),className:`px-4 py-2 rounded text-sm font-medium ${J(he.channelId).length>0?"bg-gray-700 hover:bg-gray-600 text-white":"bg-indigo-600 hover:bg-indigo-700 text-white"}`,children:J(he.channelId).length>0?"Map Another":"Map Channel"})]})]})},he.channelId)})})]}):s.jsx("div",{className:"text-center py-12 text-gray-400",children:s.jsx("p",{children:"Select an EPG source above to start mapping channels"})})}),u==="selecting"&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>{m(null),v("")},children:s.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] flex flex-col",onClick:he=>he.stopPropagation(),children:[s.jsxs("div",{className:"p-4 border-b border-gray-700",children:[s.jsx("h2",{className:"text-xl font-bold text-white",children:"Select M3U Channels to Map"}),s.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Choose the M3U channels you want to map to an EPG channel"}),s.jsxs("div",{className:"relative mt-3",children:[s.jsx(qt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search channels by name, number, or group...",value:y,onChange:he=>v(he.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 text-sm",autoFocus:!0}),y&&s.jsx("button",{onClick:()=>v(""),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 hover:bg-gray-600 rounded",children:s.jsx(At,{className:"h-4 w-4 text-gray-400"})})]}),s.jsxs("div",{className:"text-xs text-gray-400 mt-2",children:[je.length," channel",je.length!==1?"s":""," found",y&&` for "${y}"`]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:!N||N.length===0?s.jsx("div",{className:"text-center py-8 text-gray-400",children:s.jsx("p",{children:"No M3U channels available"})}):je.length===0?s.jsx("div",{className:"text-center py-8 text-gray-400",children:s.jsx("p",{children:"No channels match your search"})}):Fe.length>1?s.jsx("div",{className:"space-y-4",children:Fe.map(([he,Ue])=>s.jsxs("div",{children:[s.jsxs("div",{className:"px-2 py-1.5 bg-gray-700 rounded text-sm font-semibold text-gray-300 mb-2 flex items-center justify-between",children:[s.jsx("span",{children:he}),s.jsxs("span",{className:"text-xs text-gray-400",children:[Ue.length," channels"]})]}),s.jsx("div",{className:"space-y-2",children:Ue.map(Ge=>s.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors ${d.has(Ge.id)?"bg-indigo-900/40 border-2 border-indigo-600":"bg-gray-700/50 border-2 border-transparent hover:bg-gray-700"}`,children:[s.jsx("input",{type:"checkbox",checked:d.has(Ge.id),onChange:()=>ie(Ge.id),className:"w-4 h-4 rounded border-gray-500 bg-gray-600 text-indigo-600 focus:ring-indigo-500"}),Ge.logo&&s.jsx("img",{src:Ge.logo,alt:"",className:"w-8 h-8 rounded object-cover"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-white font-medium",children:Ge.name}),s.jsxs("div",{className:"text-xs text-gray-400",children:["Channel #",Ge.number]})]}),Ge.epgSourceId&&s.jsx("span",{className:"text-xs text-green-400",children:"Already mapped"})]},Ge.id))})]},he))}):s.jsx("div",{className:"space-y-2",children:je.map(he=>s.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors ${d.has(he.id)?"bg-indigo-900/40 border-2 border-indigo-600":"bg-gray-700/50 border-2 border-transparent hover:bg-gray-700"}`,children:[s.jsx("input",{type:"checkbox",checked:d.has(he.id),onChange:()=>ie(he.id),className:"w-4 h-4 rounded border-gray-500 bg-gray-600 text-indigo-600 focus:ring-indigo-500"}),he.logo&&s.jsx("img",{src:he.logo,alt:"",className:"w-8 h-8 rounded object-cover"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-white font-medium",children:he.name}),s.jsxs("div",{className:"text-xs text-gray-400",children:["Channel #",he.number]})]}),he.epgSourceId&&s.jsx("span",{className:"text-xs text-green-400",children:"Already mapped"})]},he.id))})}),s.jsxs("div",{className:"p-4 border-t border-gray-700 flex items-center justify-between",children:[s.jsxs("span",{className:"text-sm text-gray-400",children:[d.size," channel(s) selected"]}),s.jsx("div",{className:"flex gap-2",children:s.jsx("button",{onClick:()=>{m(null),v("")},className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded",children:"Done"})})]})]})}),o&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:We,children:s.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] flex flex-col",onClick:he=>he.stopPropagation(),children:[s.jsxs("div",{className:"p-4 border-b border-gray-700",children:[s.jsx("h2",{className:"text-xl font-bold text-white",children:"Map M3U Channel to EPG"}),s.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["Select an M3U channel to map to: ",s.jsx("span",{className:"text-indigo-400 font-medium",children:M.find(he=>he.channelId===o)?.currentProgram.callSign||o})]}),s.jsxs("div",{className:"relative mt-3",children:[s.jsx(qt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),s.jsx("input",{ref:S,type:"text",placeholder:"Search M3U channels by name, number, or group...",value:g,onChange:he=>x(he.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 text-sm",autoFocus:!0}),g&&s.jsx("button",{onClick:()=>x(""),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 hover:bg-gray-600 rounded",children:s.jsx(At,{className:"h-4 w-4 text-gray-400"})})]}),s.jsxs("div",{className:"text-xs text-gray-400 mt-2",children:[ee.length," channel",ee.length!==1?"s":""," found",g&&` for "${g}"`]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:!N||N.length===0?s.jsx("div",{className:"text-center py-8 text-gray-400",children:s.jsx("p",{children:"No M3U channels available"})}):ee.length===0?s.jsx("div",{className:"text-center py-8 text-gray-400",children:s.jsx("p",{children:"No channels match your search"})}):re.length>1?s.jsx("div",{className:"space-y-4",children:re.map(([he,Ue])=>s.jsxs("div",{children:[s.jsxs("div",{className:"px-2 py-1.5 bg-gray-700 rounded text-sm font-semibold text-gray-300 mb-2 flex items-center justify-between",children:[s.jsx("span",{children:he}),s.jsxs("span",{className:"text-xs text-gray-400",children:[Ue.length," channels"]})]}),s.jsx("div",{className:"space-y-1",children:Ue.map(Ge=>s.jsxs("button",{onClick:()=>{O(o,Ge.id),We()},className:"w-full flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors bg-gray-700/50 hover:bg-indigo-900/40 hover:border-indigo-600 border-2 border-transparent",children:[Ge.logo&&s.jsx("img",{src:Ge.logo,alt:"",className:"w-8 h-8 rounded object-cover"}),s.jsxs("div",{className:"flex-1 text-left",children:[s.jsx("div",{className:"text-white font-medium",children:Ge.name}),s.jsxs("div",{className:"text-xs text-gray-400",children:["Channel #",Ge.number]})]}),Ge.epgSourceId&&s.jsx("span",{className:"text-xs text-green-400",children:"Already mapped"})]},Ge.id))})]},he))}):s.jsx("div",{className:"space-y-1",children:ee.map(he=>s.jsxs("button",{onClick:()=>{O(o,he.id),We()},className:"w-full flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors bg-gray-700/50 hover:bg-indigo-900/40 hover:border-indigo-600 border-2 border-transparent",children:[he.logo&&s.jsx("img",{src:he.logo,alt:"",className:"w-8 h-8 rounded object-cover"}),s.jsxs("div",{className:"flex-1 text-left",children:[s.jsx("div",{className:"text-white font-medium",children:he.name}),s.jsxs("div",{className:"text-xs text-gray-400",children:["Channel #",he.number]})]}),he.epgSourceId&&s.jsx("span",{className:"text-xs text-green-400",children:"Already mapped"})]},he.id))})}),s.jsx("div",{className:"p-4 border-t border-gray-700 flex justify-end",children:s.jsx("button",{onClick:We,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded",children:"Cancel"})})]})})]})}const Xe=Number.isFinite||function(i){return typeof i=="number"&&isFinite(i)},K4=Number.isSafeInteger||function(i){return typeof i=="number"&&Math.abs(i)<=q4},q4=Number.MAX_SAFE_INTEGER||9007199254740991;let tt=(function(i){return i.NETWORK_ERROR="networkError",i.MEDIA_ERROR="mediaError",i.KEY_SYSTEM_ERROR="keySystemError",i.MUX_ERROR="muxError",i.OTHER_ERROR="otherError",i})({}),_e=(function(i){return i.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",i.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",i.KEY_SYSTEM_NO_SESSION="keySystemNoSession",i.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",i.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",i.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",i.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",i.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",i.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",i.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",i.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",i.MANIFEST_LOAD_ERROR="manifestLoadError",i.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",i.MANIFEST_PARSING_ERROR="manifestParsingError",i.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",i.LEVEL_EMPTY_ERROR="levelEmptyError",i.LEVEL_LOAD_ERROR="levelLoadError",i.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",i.LEVEL_PARSING_ERROR="levelParsingError",i.LEVEL_SWITCH_ERROR="levelSwitchError",i.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",i.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",i.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",i.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",i.FRAG_LOAD_ERROR="fragLoadError",i.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",i.FRAG_DECRYPT_ERROR="fragDecryptError",i.FRAG_PARSING_ERROR="fragParsingError",i.FRAG_GAP="fragGap",i.REMUX_ALLOC_ERROR="remuxAllocError",i.KEY_LOAD_ERROR="keyLoadError",i.KEY_LOAD_TIMEOUT="keyLoadTimeOut",i.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",i.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",i.BUFFER_APPEND_ERROR="bufferAppendError",i.BUFFER_APPENDING_ERROR="bufferAppendingError",i.BUFFER_STALLED_ERROR="bufferStalledError",i.BUFFER_FULL_ERROR="bufferFullError",i.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",i.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",i.ASSET_LIST_LOAD_ERROR="assetListLoadError",i.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",i.ASSET_LIST_PARSING_ERROR="assetListParsingError",i.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",i.INTERNAL_EXCEPTION="internalException",i.INTERNAL_ABORTED="aborted",i.ATTACH_MEDIA_ERROR="attachMediaError",i.UNKNOWN="unknown",i})({}),F=(function(i){return i.MEDIA_ATTACHING="hlsMediaAttaching",i.MEDIA_ATTACHED="hlsMediaAttached",i.MEDIA_DETACHING="hlsMediaDetaching",i.MEDIA_DETACHED="hlsMediaDetached",i.MEDIA_ENDED="hlsMediaEnded",i.STALL_RESOLVED="hlsStallResolved",i.BUFFER_RESET="hlsBufferReset",i.BUFFER_CODECS="hlsBufferCodecs",i.BUFFER_CREATED="hlsBufferCreated",i.BUFFER_APPENDING="hlsBufferAppending",i.BUFFER_APPENDED="hlsBufferAppended",i.BUFFER_EOS="hlsBufferEos",i.BUFFERED_TO_END="hlsBufferedToEnd",i.BUFFER_FLUSHING="hlsBufferFlushing",i.BUFFER_FLUSHED="hlsBufferFlushed",i.MANIFEST_LOADING="hlsManifestLoading",i.MANIFEST_LOADED="hlsManifestLoaded",i.MANIFEST_PARSED="hlsManifestParsed",i.LEVEL_SWITCHING="hlsLevelSwitching",i.LEVEL_SWITCHED="hlsLevelSwitched",i.LEVEL_LOADING="hlsLevelLoading",i.LEVEL_LOADED="hlsLevelLoaded",i.LEVEL_UPDATED="hlsLevelUpdated",i.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",i.LEVELS_UPDATED="hlsLevelsUpdated",i.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",i.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",i.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",i.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",i.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",i.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",i.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",i.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",i.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",i.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",i.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",i.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",i.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",i.CUES_PARSED="hlsCuesParsed",i.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",i.INIT_PTS_FOUND="hlsInitPtsFound",i.FRAG_LOADING="hlsFragLoading",i.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",i.FRAG_LOADED="hlsFragLoaded",i.FRAG_DECRYPTED="hlsFragDecrypted",i.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",i.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",i.FRAG_PARSING_METADATA="hlsFragParsingMetadata",i.FRAG_PARSED="hlsFragParsed",i.FRAG_BUFFERED="hlsFragBuffered",i.FRAG_CHANGED="hlsFragChanged",i.FPS_DROP="hlsFpsDrop",i.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",i.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",i.ERROR="hlsError",i.DESTROYING="hlsDestroying",i.KEY_LOADING="hlsKeyLoading",i.KEY_LOADED="hlsKeyLoaded",i.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",i.BACK_BUFFER_REACHED="hlsBackBufferReached",i.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",i.ASSET_LIST_LOADING="hlsAssetListLoading",i.ASSET_LIST_LOADED="hlsAssetListLoaded",i.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",i.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",i.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",i.INTERSTITIAL_STARTED="hlsInterstitialStarted",i.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",i.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",i.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",i.INTERSTITIAL_ENDED="hlsInterstitialEnded",i.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",i.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",i.EVENT_CUE_ENTER="hlsEventCueEnter",i})({});var Rt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Je={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Eo{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class z4{constructor(e,t,n,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Eo(e),this.fast_=new Eo(t),this.defaultTTFB_=r,this.ttfb_=new Eo(e)}update(e,t){const{slow_:n,fast_:r,ttfb_:o}=this;n.halfLife!==e&&(this.slow_=new Eo(e,n.getEstimate(),n.getTotalWeight())),r.halfLife!==t&&(this.fast_=new Eo(t,r.getEstimate(),r.getTotalWeight())),o.halfLife!==e&&(this.ttfb_=new Eo(e,o.getEstimate(),o.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,r=e/1e3,o=n/r;this.fast_.sample(r,o),this.slow_.sample(r,o)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function Y4(i,e,t){return(e=Q4(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ns(){return ns=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},ns.apply(null,arguments)}function gb(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,n)}return t}function Qt(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?gb(Object(t),!0).forEach(function(n){Y4(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):gb(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function W4(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function Q4(i){var e=W4(i,"string");return typeof e=="symbol"?e:e+""}class ai{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n=`[${e}]:`;this.trace=Pa,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const Pa=function(){},X4={trace:Pa,debug:Pa,log:Pa,warn:Pa,info:Pa,error:Pa};function dg(){return ns({},X4)}function J4(i,e){const t=self.console[i];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${i}] >`):Pa}function pb(i,e,t){return e[i]?e[i].bind(e):J4(i,t)}const ug=dg();function Z4(i,e,t){const n=dg();if(typeof console=="object"&&i===!0||typeof i=="object"){const r=["debug","log","info","warn","error"];r.forEach(o=>{n[o]=pb(o,i,t)});try{n.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return dg()}r.forEach(o=>{ug[o]=pb(o,i)})}else ns(ug,n);return n}const Xt=ug;function qa(i=!0){return typeof self>"u"?void 0:(i||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function eD(i){return typeof self<"u"&&i===self.ManagedMediaSource}function d1(i,e){const t=Object.keys(i),n=Object.keys(e),r=t.length,o=n.length;return!r||!o||r===o&&!t.some(c=>n.indexOf(c)===-1)}function Gn(i,e=!1){if(typeof TextDecoder<"u"){const u=new TextDecoder("utf-8").decode(i);if(e){const m=u.indexOf("\0");return m!==-1?u.substring(0,m):u}return u.replace(/\0/g,"")}const t=i.length;let n,r,o,c="",d=0;for(;d<t;){if(n=i[d++],n===0&&e)return c;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c+=String.fromCharCode(n);break;case 12:case 13:r=i[d++],c+=String.fromCharCode((n&31)<<6|r&63);break;case 14:r=i[d++],o=i[d++],c+=String.fromCharCode((n&15)<<12|(r&63)<<6|(o&63)<<0);break}}return c}function Zs(i){let e="";for(let t=0;t<i.length;t++){let n=i[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}function u1(i){return Uint8Array.from(i.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function tD(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var mm={exports:{}},xb;function sD(){return xb||(xb=1,(function(i,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,o=/(?:\/|^)\.(?=\/)/g,c=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,d={buildAbsoluteURL:function(h,u,m){if(m=m||{},h=h.trim(),u=u.trim(),!u){if(!m.alwaysNormalize)return h;var g=d.parseURL(h);if(!g)throw new Error("Error trying to parse base URL.");return g.path=d.normalizePath(g.path),d.buildURLFromParts(g)}var x=d.parseURL(u);if(!x)throw new Error("Error trying to parse relative URL.");if(x.scheme)return m.alwaysNormalize?(x.path=d.normalizePath(x.path),d.buildURLFromParts(x)):u;var y=d.parseURL(h);if(!y)throw new Error("Error trying to parse base URL.");if(!y.netLoc&&y.path&&y.path[0]!=="/"){var v=r.exec(y.path);y.netLoc=v[1],y.path=v[2]}y.netLoc&&!y.path&&(y.path="/");var S={scheme:y.scheme,netLoc:x.netLoc,path:null,params:x.params,query:x.query,fragment:x.fragment};if(!x.netLoc&&(S.netLoc=y.netLoc,x.path[0]!=="/"))if(!x.path)S.path=y.path,x.params||(S.params=y.params,x.query||(S.query=y.query));else{var N=y.path,A=N.substring(0,N.lastIndexOf("/")+1)+x.path;S.path=d.normalizePath(A)}return S.path===null&&(S.path=m.alwaysNormalize?d.normalizePath(x.path):x.path),d.buildURLFromParts(S)},parseURL:function(h){var u=n.exec(h);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(h){for(h=h.split("").reverse().join("").replace(o,"");h.length!==(h=h.replace(c,"")).length;);return h.split("").reverse().join("")},buildURLFromParts:function(h){return h.scheme+h.netLoc+h.path+h.params+h.query+h.fragment}};i.exports=d})()})(mm)),mm.exports}var m0=sD();class g0{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var as={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class h1{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,iD(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let r;n.length===1?r=t?.byteRangeEndOffset||0:r=parseInt(n[1]),this._byteRange=[r,parseInt(n[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[as.AUDIO]:null,[as.VIDEO]:null,[as.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new g0),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=m0.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[as.AUDIO]=null,e[as.VIDEO]=null,e[as.AUDIOVIDEO]=null}}function Cs(i){return i.sn!=="initSegment"}class gm extends h1{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(Xe(e)&&Xe(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const n=Object.keys(t);if(n.length===1){const r=this._decryptdata=t[n[0]]||null;r&&(this._decryptdata=r.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=Xe(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const n=Object.keys(this.levelkeys),r=n.length;if(r>1||r===1&&(t=this.levelkeys[n[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Xe(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Cs(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var n;const r=t[e];r&&!((n=this._decryptdata)!=null&&n.keyId)&&(this._decryptdata=r.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,r,o,c=!1){const{elementaryStreams:d}=this,h=d[e];if(!h){d[e]={startPTS:t,endPTS:n,startDTS:r,endDTS:o,partial:c};return}h.startPTS=Math.min(h.startPTS,t),h.endPTS=Math.max(h.endPTS,n),h.startDTS=Math.min(h.startDTS,r),h.endDTS=Math.max(h.endDTS,o)}}class nD extends h1{constructor(e,t,n,r,o){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const c=e.enumeratedString("BYTERANGE");c&&this.setByteRange(c,o),o&&(this.fragOffset=o.fragOffset+o.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function f1(i,e){const t=Object.getPrototypeOf(i);if(t){const n=Object.getOwnPropertyDescriptor(t,e);return n||f1(t,e)}}function iD(i,e){const t=f1(i,e);t&&(t.enumerable=!0,Object.defineProperty(i,e,t))}const yb=Math.pow(2,32)-1,aD=[].push,m1={video:1,audio:2,id3:3,text:4};function Bs(i){return String.fromCharCode.apply(null,i)}function g1(i,e){const t=i[e]<<8|i[e+1];return t<0?65536+t:t}function pt(i,e){const t=p1(i,e);return t<0?4294967296+t:t}function vb(i,e){let t=pt(i,e);return t*=Math.pow(2,32),t+=pt(i,e+4),t}function p1(i,e){return i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}function rD(i){const e=i.byteLength;for(let t=0;t<e;){const n=pt(i,t);if(n>8&&i[t+4]===109&&i[t+5]===111&&i[t+6]===111&&i[t+7]===102)return!0;t=n>1?t+n:e}return!1}function jt(i,e){const t=[];if(!e.length)return t;const n=i.byteLength;for(let r=0;r<n;){const o=pt(i,r),c=Bs(i.subarray(r+4,r+8)),d=o>1?r+o:n;if(c===e[0])if(e.length===1)t.push(i.subarray(r+8,d));else{const h=jt(i.subarray(r+8,d),e.slice(1));h.length&&aD.apply(t,h)}r=d}return t}function oD(i){const e=[],t=i[0];let n=8;const r=pt(i,n);n+=4;let o=0,c=0;t===0?(o=pt(i,n),c=pt(i,n+4),n+=8):(o=vb(i,n),c=vb(i,n+8),n+=16),n+=2;let d=i.length+c;const h=g1(i,n);n+=2;for(let u=0;u<h;u++){let m=n;const g=pt(i,m);m+=4;const x=g&2147483647;if((g&2147483648)>>>31===1)return Xt.warn("SIDX has hierarchical references (not supported)"),null;const v=pt(i,m);m+=4,e.push({referenceSize:x,subsegmentDuration:v,info:{duration:v/r,start:d,end:d+x-1}}),d+=x,m+=4,n=m}return{earliestPresentationTime:o,timescale:r,version:t,referencesCount:h,references:e}}function x1(i){const e=[],t=jt(i,["moov","trak"]);for(let r=0;r<t.length;r++){const o=t[r],c=jt(o,["tkhd"])[0];if(c){let d=c[0];const h=pt(c,d===0?12:20),u=jt(o,["mdia","mdhd"])[0];if(u){d=u[0];const m=pt(u,d===0?12:20),g=jt(o,["mdia","hdlr"])[0];if(g){const x=Bs(g.subarray(8,12)),y={soun:as.AUDIO,vide:as.VIDEO}[x],v=jt(o,["mdia","minf","stbl","stsd"])[0],S=lD(v);y?(e[h]={timescale:m,type:y,stsd:S},e[y]=Qt({timescale:m,id:h},S)):e[h]={timescale:m,type:x,stsd:S}}}}}return jt(i,["moov","mvex","trex"]).forEach(r=>{const o=pt(r,4),c=e[o];c&&(c.default={duration:pt(r,12),flags:pt(r,20)})}),e}function lD(i){const e=i.subarray(8),t=e.subarray(86),n=Bs(e.subarray(4,8));let r=n,o;const c=n==="enca"||n==="encv";if(c){const u=jt(e,[n])[0].subarray(n==="enca"?28:78);jt(u,["sinf"]).forEach(g=>{const x=jt(g,["schm"])[0];if(x){const y=Bs(x.subarray(4,8));if(y==="cbcs"||y==="cenc"){const v=jt(g,["frma"])[0];v&&(r=Bs(v))}}})}const d=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const h=jt(t,["avcC"])[0];h&&h.length>3&&(r+="."+Ud(h[1])+Ud(h[2])+Ud(h[3]),o=Bd(d==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const h=jt(e,[n])[0],u=jt(h.subarray(28),["esds"])[0];if(u&&u.length>7){let m=4;if(u[m++]!==3)break;m=pm(u,m),m+=2;const g=u[m++];if(g&128&&(m+=2),g&64&&(m+=u[m++]),u[m++]!==4)break;m=pm(u,m);const x=u[m++];if(x===64)r+="."+Ud(x);else break;if(m+=12,u[m++]!==5)break;m=pm(u,m);const y=u[m++];let v=(y&248)>>3;v===31&&(v+=1+((y&7)<<3)+((u[m]&224)>>5)),r+="."+v}break}case"hvc1":case"hev1":{const h=jt(t,["hvcC"])[0];if(h&&h.length>12){const u=h[1],m=["","A","B","C"][u>>6],g=u&31,x=pt(h,2),y=(u&32)>>5?"H":"L",v=h[12],S=h.subarray(6,12);r+="."+m+g,r+="."+cD(x).toString(16).toUpperCase(),r+="."+y+v;let N="";for(let A=S.length;A--;){const R=S[A];(R||N)&&(N="."+R.toString(16).toUpperCase()+N)}r+=N}o=Bd(d=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=Bd(r,t)||r;break}case"vp09":{const h=jt(t,["vpcC"])[0];if(h&&h.length>6){const u=h[4],m=h[5],g=h[6]>>4&15;r+="."+wi(u)+"."+wi(m)+"."+wi(g)}break}case"av01":{const h=jt(t,["av1C"])[0];if(h&&h.length>2){const u=h[1]>>>5,m=h[1]&31,g=h[2]>>>7?"H":"M",x=(h[2]&64)>>6,y=(h[2]&32)>>5,v=u===2&&x?y?12:10:x?10:8,S=(h[2]&16)>>4,N=(h[2]&8)>>3,A=(h[2]&4)>>2,R=h[2]&3;r+="."+u+"."+wi(m)+g+"."+wi(v)+"."+S+"."+N+A+R+"."+wi(1)+"."+wi(1)+"."+wi(1)+"."+0,o=Bd("dav1",t)}break}}return{codec:r,encrypted:c,supplemental:o}}function Bd(i,e){const t=jt(e,["dvvC"]),n=t.length?t[0]:jt(e,["dvcC"])[0];if(n){const r=n[2]>>1&127,o=n[2]<<5&32|n[3]>>3&31;return i+"."+wi(r)+"."+wi(o)}}function cD(i){let e=0;for(let t=0;t<32;t++)e|=(i>>t&1)<<31-t;return e>>>0}function pm(i,e){const t=e+5;for(;i[e++]&128&&e<t;);return e}function Ud(i){return("0"+i.toString(16).toUpperCase()).slice(-2)}function wi(i){return(i<10?"0":"")+i}function dD(i,e){if(!i||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&y1(i,(n,r)=>{const o=n.subarray(8,24);o.some(c=>c!==0)||(Xt.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${Zs(o)} -> ${Zs(t)}`),n.set(t,8))})}function uD(i){const e=[];return y1(i,t=>e.push(t.subarray(8,24))),e}function y1(i,e){jt(i,["moov","trak"]).forEach(n=>{const r=jt(n,["mdia","minf","stbl","stsd"])[0];if(!r)return;const o=r.subarray(8);let c=jt(o,["enca"]);const d=c.length>0;d||(c=jt(o,["encv"])),c.forEach(h=>{const u=d?h.subarray(28):h.subarray(78);jt(u,["sinf"]).forEach(g=>{const x=v1(g);x&&e(x,d)})})})}function v1(i){const e=jt(i,["schm"])[0];if(e){const t=Bs(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const n=jt(i,["schi","tenc"])[0];if(n)return n}}}function hD(i,e,t){const n={},r=jt(i,["moof","traf"]);for(let o=0;o<r.length;o++){const c=r[o],d=jt(c,["tfhd"])[0],h=pt(d,4),u=e[h];if(!u)continue;n[h]||(n[h]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type});const m=n[h],g=jt(c,["tfdt"])[0];if(g){const C=g[0];let D=pt(g,4);C===1&&(D===yb?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(D*=yb+1,D+=pt(g,8))),Xe(D)&&(!Xe(m.start)||D<m.start)&&(m.start=D)}const x=u.default,y=pt(d,0)|x?.flags;let v=x?.duration||0;y&8&&(y&2?v=pt(d,12):v=pt(d,8));const S=jt(c,["trun"]);let N=m.start||0,A=0,R=v;for(let C=0;C<S.length;C++){const D=S[C],V=pt(D,4),z=m.sampleCount;m.sampleCount+=V;const B=D[3]&1,I=D[3]&4,M=D[2]&1,L=D[2]&2,O=D[2]&4,J=D[2]&8;let ie=8,ne=V;for(B&&(ie+=4),I&&V&&(!(D[ie+1]&1)&&m.keyFrameIndex===void 0&&(m.keyFrameIndex=z),ie+=4,M?(R=pt(D,ie),ie+=4):R=v,L&&(ie+=4),J&&(ie+=4),N+=R,A+=R,ne--);ne--;)M?(R=pt(D,ie),ie+=4):R=v,L&&(ie+=4),O&&(D[ie+1]&1||m.keyFrameIndex===void 0&&(m.keyFrameIndex=m.sampleCount-(ne+1),m.keyFrameStart=N),ie+=4),J&&(ie+=4),N+=R,A+=R;!A&&v&&(A+=v*V)}m.duration+=A}if(!Object.keys(n).some(o=>n[o].duration)){let o=1/0,c=0;const d=jt(i,["sidx"]);for(let h=0;h<d.length;h++){const u=oD(d[h]);if(u!=null&&u.references){o=Math.min(o,u.earliestPresentationTime/u.timescale);const m=u.references.reduce((g,x)=>g+x.info.duration||0,0);c=Math.max(c,m+u.earliestPresentationTime/u.timescale)}}c&&Xe(c)&&Object.keys(n).forEach(h=>{n[h].duration||(n[h].duration=c*n[h].timescale-n[h].start)})}return n}function fD(i){const e={valid:null,remainder:null},t=jt(i,["moof"]);if(t.length<2)return e.remainder=i,e;const n=t[t.length-1];return e.valid=i.slice(0,n.byteOffset-8),e.remainder=i.slice(n.byteOffset-8),e}function ni(i,e){const t=new Uint8Array(i.length+e.length);return t.set(i),t.set(e,i.length),t}function bb(i,e){const t=[],n=e.samples,r=e.timescale,o=e.id;let c=!1;return jt(n,["moof"]).map(h=>{const u=h.byteOffset-8;jt(h,["traf"]).map(g=>{const x=jt(g,["tfdt"]).map(y=>{const v=y[0];let S=pt(y,4);return v===1&&(S*=Math.pow(2,32),S+=pt(y,8)),S/r})[0];return x!==void 0&&(i=x),jt(g,["tfhd"]).map(y=>{const v=pt(y,4),S=pt(y,0)&16777215,N=(S&1)!==0,A=(S&2)!==0,R=(S&8)!==0;let C=0;const D=(S&16)!==0;let V=0;const z=(S&32)!==0;let B=8;v===o&&(N&&(B+=8),A&&(B+=4),R&&(C=pt(y,B),B+=4),D&&(V=pt(y,B),B+=4),z&&(B+=4),e.type==="video"&&(c=Wu(e.codec)),jt(g,["trun"]).map(I=>{const M=I[0],L=pt(I,0)&16777215,O=(L&1)!==0;let J=0;const ie=(L&4)!==0,ne=(L&256)!==0;let se=0;const X=(L&512)!==0;let ce=0;const le=(L&1024)!==0,Y=(L&2048)!==0;let K=0;const H=pt(I,4);let Q=8;O&&(J=pt(I,Q),Q+=4),ie&&(Q+=4);let oe=J+u;for(let ye=0;ye<H;ye++){if(ne?(se=pt(I,Q),Q+=4):se=C,X?(ce=pt(I,Q),Q+=4):ce=V,le&&(Q+=4),Y&&(M===0?K=pt(I,Q):K=p1(I,Q),Q+=4),e.type===as.VIDEO){let xe=0;for(;xe<ce;){const pe=pt(n,oe);if(oe+=4,mD(c,n[oe])){const ee=n.subarray(oe,oe+pe);p0(ee,c?2:1,i+K/r,t)}oe+=pe,xe+=pe+4}}i+=se/r}}))})})}),t}function Wu(i){if(!i)return!1;const e=i.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function mD(i,e){if(i){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function p0(i,e,t,n){const r=b1(i);let o=0;o+=e;let c=0,d=0,h=0;for(;o<r.length;){c=0;do{if(o>=r.length)break;h=r[o++],c+=h}while(h===255);d=0;do{if(o>=r.length)break;h=r[o++],d+=h}while(h===255);const u=r.length-o;let m=o;if(d<u)o+=d;else if(d>u){Xt.error(`Malformed SEI payload. ${d} is too small, only ${u} bytes left to parse.`);break}if(c===4){if(r[m++]===181){const x=g1(r,m);if(m+=2,x===49){const y=pt(r,m);if(m+=4,y===1195456820){const v=r[m++];if(v===3){const S=r[m++],N=31&S,A=64&S,R=A?2+N*3:0,C=new Uint8Array(R);if(A){C[0]=S;for(let D=1;D<R;D++)C[D]=r[m++]}n.push({type:v,payloadType:c,pts:t,bytes:C})}}}}}else if(c===5&&d>16){const g=[];for(let v=0;v<16;v++){const S=r[m++].toString(16);g.push(S.length==1?"0"+S:S),(v===3||v===5||v===7||v===9)&&g.push("-")}const x=d-16,y=new Uint8Array(x);for(let v=0;v<x;v++)y[v]=r[m++];n.push({payloadType:c,pts:t,uuid:g.join(""),userData:Gn(y),userDataBytes:y})}}}function b1(i){const e=i.byteLength,t=[];let n=1;for(;n<e-2;)i[n]===0&&i[n+1]===0&&i[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return i;const r=e-t.length,o=new Uint8Array(r);let c=0;for(n=0;n<r;c++,n++)c===t[0]&&(c++,t.shift()),o[n]=i[c];return o}function gD(i){const e=i[0];let t="",n="",r=0,o=0,c=0,d=0,h=0,u=0;if(e===0){for(;Bs(i.subarray(u,u+1))!=="\0";)t+=Bs(i.subarray(u,u+1)),u+=1;for(t+=Bs(i.subarray(u,u+1)),u+=1;Bs(i.subarray(u,u+1))!=="\0";)n+=Bs(i.subarray(u,u+1)),u+=1;n+=Bs(i.subarray(u,u+1)),u+=1,r=pt(i,12),o=pt(i,16),d=pt(i,20),h=pt(i,24),u=28}else if(e===1){u+=4,r=pt(i,u),u+=4;const g=pt(i,u);u+=4;const x=pt(i,u);for(u+=4,c=2**32*g+x,K4(c)||(c=Number.MAX_SAFE_INTEGER,Xt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),d=pt(i,u),u+=4,h=pt(i,u),u+=4;Bs(i.subarray(u,u+1))!=="\0";)t+=Bs(i.subarray(u,u+1)),u+=1;for(t+=Bs(i.subarray(u,u+1)),u+=1;Bs(i.subarray(u,u+1))!=="\0";)n+=Bs(i.subarray(u,u+1)),u+=1;n+=Bs(i.subarray(u,u+1)),u+=1}const m=i.subarray(u,i.byteLength);return{schemeIdUri:t,value:n,timeScale:r,presentationTime:c,presentationTimeDelta:o,eventDuration:d,id:h,payload:m}}function pD(i,...e){const t=e.length;let n=8,r=t;for(;r--;)n+=e[r].byteLength;const o=new Uint8Array(n);for(o[0]=n>>24&255,o[1]=n>>16&255,o[2]=n>>8&255,o[3]=n&255,o.set(i,4),r=0,n=8;r<t;r++)o.set(e[r],n),n+=e[r].byteLength;return o}function xD(i,e,t){if(i.byteLength!==16)throw new RangeError("Invalid system id");let n,r;n=0,r=new Uint8Array;let o;n>0?(o=new Uint8Array(4),e.length>0&&new DataView(o.buffer).setUint32(0,e.length,!1)):o=new Uint8Array;const c=new Uint8Array(4);return t.byteLength>0&&new DataView(c.buffer).setUint32(0,t.byteLength,!1),pD([112,115,115,104],new Uint8Array([n,0,0,0]),i,o,r,c,t)}function yD(i){const e=[];if(i instanceof ArrayBuffer){const t=i.byteLength;let n=0;for(;n+32<t;){const r=new DataView(i,n),o=vD(r);e.push(o),n+=o.size}}return e}function vD(i){const e=i.getUint32(0),t=i.byteOffset,n=i.byteLength;if(n<e)return{offset:t,size:n};if(i.getUint32(4)!==1886614376)return{offset:t,size:e};const o=i.getUint32(8)>>>24;if(o!==0&&o!==1)return{offset:t,size:e};const c=i.buffer,d=Zs(new Uint8Array(c,t+12,16));let h=null,u=null,m=0;if(o===0)m=28;else{const x=i.getUint32(28);if(!x||n<32+x*16)return{offset:t,size:e};h=[];for(let y=0;y<x;y++)h.push(new Uint8Array(c,t+32+y*16,16));m=32+x*16}if(!m)return{offset:t,size:e};const g=i.getUint32(m);return e-32<g?{offset:t,size:e}:(u=new Uint8Array(c,t+m+4,g),{version:o,systemId:d,kids:h,data:u,offset:t,size:e})}const _1=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Go={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function x0(i,e){const t=Go[e];return!!t&&!!t[i.slice(0,4)]}function ac(i,e,t=!0){return!i.split(",").some(n=>!y0(n,e,t))}function y0(i,e,t=!0){var n;const r=qa(t);return(n=r?.isTypeSupported(rc(i,e)))!=null?n:!1}function rc(i,e){return`${e}/mp4;codecs=${i}`}function _b(i){if(i){const e=i.substring(0,4);return Go.video[e]}return 2}function Eu(i){const e=_1();return i.split(",").reduce((t,n)=>{const o=e&&Wu(n)?9:Go.video[n];return o?(o*2+t)/(t?3:2):(Go.audio[n]+t)/(t?2:1)},0)}const xm={};function bD(i,e=!0){if(xm[i])return xm[i];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[i];for(let r=0;r<t.length;r++){var n;if(y0(t[r],"audio",e))return xm[i]=t[r],t[r];if(t[r]==="mp3"&&(n=qa(e))!=null&&n.isTypeSupported("audio/mpeg"))return""}return i}const _D=/flac|opus|mp4a\.40\.34/i;function Nu(i,e=!0){return i.replace(_D,t=>bD(t.toLowerCase(),e))}function SD(i,e){const t=[];if(i){const n=i.split(",");for(let r=0;r<n.length;r++)x0(n[r],"video")||t.push(n[r])}return e&&t.push(e),t.join(",")}function lu(i,e){if(i&&(i.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(i)!==-1)&&(Sb(i,"audio")||Sb(i,"video")))return i;if(e){const t=e.split(",");if(t.length>1){if(i){for(let n=t.length;n--;)if(t[n].substring(0,4)===i.substring(0,4))return t[n]}return t[0]}}return e||i}function Sb(i,e){return x0(i,e)&&y0(i,e)}function ED(i){const e=i.split(",");for(let t=0;t<e.length;t++){const n=e[t].split(".");n.length>2&&n[0]==="avc1"&&(e[t]=`avc1.${parseInt(n[1]).toString(16)}${("000"+parseInt(n[2]).toString(16)).slice(-4)}`)}return e.join(",")}function ND(i){if(i.startsWith("av01.")){const e=i.split("."),t=["0","111","01","01","01","0"];for(let n=e.length;n>4&&n<10;n++)e[n]=t[n-4];return e.join(".")}return i}function Eb(i){const e=qa(i)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function hg(i){return i.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const wD={supported:!0,powerEfficient:!0,smooth:!0},TD={supported:!1,smooth:!1,powerEfficient:!1},S1={supported:!0,configurations:[],decodingInfoResults:[wD]};function E1(i,e){return{supported:!1,configurations:e,decodingInfoResults:[TD],error:i}}function AD(i,e,t,n,r,o){const c=i.videoCodec,d=i.audioCodec?i.audioGroups:null,h=o?.audioCodec,u=o?.channels,m=u?parseInt(u):h?1/0:2;let g=null;if(d!=null&&d.length)try{d.length===1&&d[0]?g=e.groups[d[0]].channels:g=d.reduce((x,y)=>{if(y){const v=e.groups[y];if(!v)throw new Error(`Audio track group ${y} not found`);Object.keys(v.channels).forEach(S=>{x[S]=(x[S]||0)+v.channels[S]})}return x},{2:0})}catch{return!0}return c!==void 0&&(c.split(",").some(x=>Wu(x))||i.width>1920&&i.height>1088||i.height>1920&&i.width>1088||i.frameRate>Math.max(n,30)||i.videoRange!=="SDR"&&i.videoRange!==t||i.bitrate>Math.max(r,8e6))||!!g&&Xe(m)&&Object.keys(g).some(x=>parseInt(x)>m)}function N1(i,e,t,n={}){const r=i.videoCodec;if(!r&&!i.audioCodec||!t)return Promise.resolve(S1);const o=[],c=jD(i),d=c.length,h=CD(i,e,d>0),u=h.length;for(let m=d||1*u||1;m--;){const g={type:"media-source"};if(d&&(g.video=c[m%d]),u){g.audio=h[m%u];const x=g.audio.bitrate;g.video&&x&&(g.video.bitrate-=x)}o.push(g)}if(r){const m=navigator.userAgent;if(r.split(",").some(g=>Wu(g))&&_1())return Promise.resolve(E1(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${m})`),o))}return Promise.all(o.map(m=>{const g=LD(m);return n[g]||(n[g]=t.decodingInfo(m))})).then(m=>({supported:!m.some(g=>!g.supported),configurations:o,decodingInfoResults:m})).catch(m=>({supported:!1,configurations:o,decodingInfoResults:[],error:m}))}function jD(i){var e;const t=(e=i.videoCodec)==null?void 0:e.split(","),n=w1(i),r=i.width||640,o=i.height||480,c=i.frameRate||30,d=i.videoRange.toLowerCase();return t?t.map(h=>{const u={contentType:rc(ND(h),"video"),width:r,height:o,bitrate:n,framerate:c};return d!=="sdr"&&(u.transferFunction=d),u}):[]}function CD(i,e,t){var n;const r=(n=i.audioCodec)==null?void 0:n.split(","),o=w1(i);return r&&i.audioGroups?i.audioGroups.reduce((c,d)=>{var h;const u=d?(h=e.groups[d])==null?void 0:h.tracks:null;return u?u.reduce((m,g)=>{if(g.groupId===d){const x=parseFloat(g.channels||"");r.forEach(y=>{const v={contentType:rc(y,"audio"),bitrate:t?RD(y,o):o};x&&(v.channels=""+x),m.push(v)})}return m},c):c},[]):[]}function RD(i,e){if(e<=1)return 1;let t=128e3;return i==="ec-3"?t=768e3:i==="ac-3"&&(t=64e4),Math.min(e/2,t)}function w1(i){return Math.ceil(Math.max(i.bitrate*.9,i.averageBitrate)/1e3)*1e3||1}function LD(i){let e="";const{audio:t,video:n}=i;if(n){const r=hg(n.contentType);e+=`${r}_r${n.height}x${n.width}f${Math.ceil(n.framerate)}${n.transferFunction||"sd"}_${Math.ceil(n.bitrate/1e5)}`}if(t){const r=hg(t.contentType);e+=`${n?"_":""}${r}_c${t.channels}`}return e}const fg=["NONE","TYPE-0","TYPE-1",null];function kD(i){return fg.indexOf(i)>-1}const wu=["SDR","PQ","HLG"];function DD(i){return!!i&&wu.indexOf(i)>-1}var cu={No:"",Yes:"YES",v2:"v2"};function Nb(i){const{canSkipUntil:e,canSkipDateRanges:t,age:n}=i,r=n<e/2;return e&&r?t?cu.v2:cu.Yes:cu.No}class wb{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class oc{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(n=>!!n).map(n=>n.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=(t=e.supplemental)==null?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=`,${n.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Tb(this._audioGroups,e)}hasSubtitleGroup(e){return Tb(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let n=this._audioGroups;n||(n=this._audioGroups=[]),n.indexOf(t)===-1&&n.push(t)}else if(e==="text"){let n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(t)===-1&&n.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Tb(i,e){return!e||!i?!1:i.indexOf(e)!==-1}function ID(){if(typeof matchMedia=="function"){const i=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(i.media!==e.media)return i.matches===!0}return!1}function MD(i,e){let t=!1,n=[];if(i&&(t=i!=="SDR",n=[i]),e){n=e.allowedVideoRanges||wu.slice(0);const r=n.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:r&&ID(),t||(n=["SDR"])}return{preferHDR:t,allowedVideoRanges:n}}const OD=i=>{const e=new WeakSet;return(t,n)=>{if(i&&(n=i(t,n)),typeof n=="object"&&n!==null){if(e.has(n))return;e.add(n)}return n}},os=(i,e)=>JSON.stringify(i,OD(e));function PD(i,e,t,n,r){const o=Object.keys(i),c=n?.channels,d=n?.audioCodec,h=r?.videoCodec,u=c&&parseInt(c)===2;let m=!1,g=!1,x=1/0,y=1/0,v=1/0,S=1/0,N=0,A=[];const{preferHDR:R,allowedVideoRanges:C}=MD(e,r);for(let I=o.length;I--;){const M=i[o[I]];m||(m=M.channels[2]>0),x=Math.min(x,M.minHeight),y=Math.min(y,M.minFramerate),v=Math.min(v,M.minBitrate),C.filter(O=>M.videoRanges[O]>0).length>0&&(g=!0)}x=Xe(x)?x:0,y=Xe(y)?y:0;const D=Math.max(1080,x),V=Math.max(30,y);v=Xe(v)?v:t,t=Math.max(v,t),g||(e=void 0);const z=o.length>1;return{codecSet:o.reduce((I,M)=>{const L=i[M];if(M===I)return I;if(A=g?C.filter(O=>L.videoRanges[O]>0):[],z){if(L.minBitrate>t)return Ei(M,`min bitrate of ${L.minBitrate} > current estimate of ${t}`),I;if(!L.hasDefaultAudio)return Ei(M,"no renditions with default or auto-select sound found"),I;if(d&&M.indexOf(d.substring(0,4))%5!==0)return Ei(M,`audio codec preference "${d}" not found`),I;if(c&&!u){if(!L.channels[c])return Ei(M,`no renditions with ${c} channel sound found (channels options: ${Object.keys(L.channels)})`),I}else if((!d||u)&&m&&L.channels[2]===0)return Ei(M,"no renditions with stereo sound found"),I;if(L.minHeight>D)return Ei(M,`min resolution of ${L.minHeight} > maximum of ${D}`),I;if(L.minFramerate>V)return Ei(M,`min framerate of ${L.minFramerate} > maximum of ${V}`),I;if(!A.some(O=>L.videoRanges[O]>0))return Ei(M,`no variants with VIDEO-RANGE of ${os(A)} found`),I;if(h&&M.indexOf(h.substring(0,4))%5!==0)return Ei(M,`video codec preference "${h}" not found`),I;if(L.maxScore<N)return Ei(M,`max score of ${L.maxScore} < selected max of ${N}`),I}return I&&(Eu(M)>=Eu(I)||L.fragmentError>i[I].fragmentError)?I:(S=L.minIndex,N=L.maxScore,M)},void 0),videoRanges:A,preferHDR:R,minFramerate:y,minBitrate:v,minIndex:S}}function Ei(i,e){Xt.log(`[abr] start candidates with "${i}" ignored because ${e}`)}function T1(i){return i.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const r=t.channels||"2";return n.channels[r]=(n.channels[r]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function BD(i,e,t,n){return i.slice(t,n+1).reduce((r,o,c)=>{if(!o.codecSet)return r;const d=o.audioGroups;let h=r[o.codecSet];h||(r[o.codecSet]=h={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:c,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!d,fragmentError:0}),h.minBitrate=Math.min(h.minBitrate,o.bitrate);const u=Math.min(o.height,o.width);return h.minHeight=Math.min(h.minHeight,u),h.minFramerate=Math.min(h.minFramerate,o.frameRate),h.minIndex=Math.min(h.minIndex,c),h.maxScore=Math.max(h.maxScore,o.score),h.fragmentError+=o.fragmentError,h.videoRanges[o.videoRange]=(h.videoRanges[o.videoRange]||0)+1,d&&d.forEach(m=>{if(!m)return;const g=e.groups[m];g&&(h.hasDefaultAudio=h.hasDefaultAudio||e.hasDefaultAudio?g.hasDefault:g.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(g.channels).forEach(x=>{h.channels[x]=(h.channels[x]||0)+g.channels[x]}))}),r},{})}function Ab(i){if(!i)return i;const{lang:e,assocLang:t,characteristics:n,channels:r,audioCodec:o}=i;return{lang:e,assocLang:t,characteristics:n,channels:r,audioCodec:o}}function Ai(i,e,t){if("attrs"in i){const n=e.indexOf(i);if(n!==-1)return n}for(let n=0;n<e.length;n++){const r=e[n];if(Cr(i,r,t))return n}return-1}function Cr(i,e,t){const{groupId:n,name:r,lang:o,assocLang:c,default:d}=i,h=i.forced;return(n===void 0||e.groupId===n)&&(r===void 0||e.name===r)&&(o===void 0||UD(o,e.lang))&&(o===void 0||e.assocLang===c)&&(d===void 0||e.default===d)&&(h===void 0||e.forced===h)&&(!("characteristics"in i)||FD(i.characteristics||"",e.characteristics))&&(t===void 0||t(i,e))}function UD(i,e="--"){return i.length===e.length?i===e:i.startsWith(e)||e.startsWith(i)}function FD(i,e=""){const t=i.split(","),n=e.split(",");return t.length===n.length&&!t.some(r=>n.indexOf(r)===-1)}function Sr(i,e){const{audioCodec:t,channels:n}=i;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(n===void 0||n===(e.channels||"2"))}function $D(i,e,t,n,r){const o=e[n],d=e.reduce((x,y,v)=>{const S=y.uri;return(x[S]||(x[S]=[])).push(v),x},{})[o.uri];d.length>1&&(n=Math.max.apply(Math,d));const h=o.videoRange,u=o.frameRate,m=o.codecSet.substring(0,4),g=jb(e,n,x=>{if(x.videoRange!==h||x.frameRate!==u||x.codecSet.substring(0,4)!==m)return!1;const y=x.audioGroups,v=t.filter(S=>!y||y.indexOf(S.groupId)!==-1);return Ai(i,v,r)>-1});return g>-1?g:jb(e,n,x=>{const y=x.audioGroups,v=t.filter(S=>!y||y.indexOf(S.groupId)!==-1);return Ai(i,v,r)>-1})}function jb(i,e,t){for(let n=e;n>-1;n--)if(t(i[n]))return n;for(let n=e+1;n<i.length;n++)if(t(i[n]))return n;return-1}function Tu(i,e){var t;return!!i&&i!==((t=e.loadLevelObj)==null?void 0:t.uri)}class GD extends ai{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var n;const{fragCurrent:r,partCurrent:o,hls:c}=this,{autoLevelEnabled:d,media:h}=c;if(!r||!h)return;const u=performance.now(),m=o?o.stats:r.stats,g=o?o.duration:r.duration,x=u-m.loading.start,y=c.minAutoLevel,v=r.level,S=this._nextAutoLevel;if(m.aborted||m.loaded&&m.loaded===m.total||v<=y){this.clearTimer(),this._nextAutoLevel=-1;return}if(!d)return;const N=S>-1&&S!==v,A=!!t||N;if(!A&&(h.paused||!h.playbackRate||!h.readyState))return;const R=c.mainForwardBufferInfo;if(!A&&R===null)return;const C=this.bwEstimator.getEstimateTTFB(),D=Math.abs(h.playbackRate);if(x<=Math.max(C,1e3*(g/(D*2))))return;const V=R?R.len/D:0,z=m.loading.first?m.loading.first-m.loading.start:-1,B=m.loaded&&z>-1,I=this.getBwEstimate(),M=c.levels,L=M[v],O=Math.max(m.loaded,Math.round(g*(r.bitrate||L.averageBitrate)/8));let J=B?x-z:x;J<1&&B&&(J=Math.min(x,m.loaded*8/I));const ie=B?m.loaded*1e3/J:0,ne=C/1e3,se=ie?(O-m.loaded)/ie:O*8/I+ne;if(se<=V)return;const X=ie?ie*8:I,ce=((n=t?.details||this.hls.latestLevelDetails)==null?void 0:n.live)===!0,le=this.hls.config.abrBandWidthUpFactor;let Y=Number.POSITIVE_INFINITY,K;for(K=v-1;K>y;K--){const ye=M[K].maxBitrate,xe=!M[K].details||ce;if(Y=this.getTimeToLoadFrag(ne,X,g*ye,xe),Y<Math.min(V,g+ne))break}if(Y>=se||Y>g*10)return;B?this.bwEstimator.sample(x-Math.min(C,z),m.loaded):this.bwEstimator.sampleTTFB(x);const H=M[K].maxBitrate;this.getBwEstimate()*le>H&&this.resetEstimator(H);const Q=this.findBestLevel(H,y,K,0,V,1,1);Q>-1&&(K=Q),this.warn(`Fragment ${r.sn}${o?" part "+o.index:""} of level ${v} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${V.toFixed(3)} s
      Estimated load time for current fragment: ${se.toFixed(3)} s
      Estimated load time for down switch fragment: ${Y.toFixed(3)} s
      TTFB estimate: ${z|0} ms
      Current BW estimate: ${Xe(I)?I|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${K} @ ${H|0} bps`),c.nextLoadLevel=c.nextAutoLevel=K,this.clearTimer();const oe=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===K&&K>0){const ye=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${K>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${ye.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,K>y){let xe=this.findBestLevel(this.hls.levels[y].bitrate,y,K,0,ye,1,1);xe===-1&&(xe=y),this.hls.nextLoadLevel=this.hls.nextAutoLevel=xe,this.resetEstimator(this.hls.levels[xe].bitrate)}}};N||se>Y*2?oe():this.timer=self.setInterval(oe,Y*1e3),c.trigger(F.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:o,stats:m})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new z4(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.FRAG_LOADING,this.onFragLoading,this),e.on(F.FRAG_LOADED,this.onFragLoaded,this),e.on(F.FRAG_BUFFERED,this.onFragBuffered,this),e.on(F.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(F.LEVEL_LOADED,this.onLevelLoaded,this),e.on(F.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(F.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(F.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.FRAG_LOADING,this.onFragLoading,this),e.off(F.FRAG_LOADED,this.onFragLoaded,this),e.off(F.FRAG_BUFFERED,this.onFragBuffered,this),e.off(F.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(F.LEVEL_LOADED,this.onLevelLoaded,this),e.off(F.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(F.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(F.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var r;this.fragCurrent=n,this.partCurrent=(r=t.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case _e.BUFFER_ADD_CODEC_ERROR:case _e.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case _e.FRAG_LOAD_TIMEOUT:{const n=t.frag,{fragCurrent:r,partCurrent:o}=this;if(n&&r&&n.sn===r.sn&&n.level===r.level){const c=performance.now(),d=o?o.stats:n.stats,h=c-d.loading.start,u=d.loading.first?d.loading.first-d.loading.start:-1;if(d.loaded&&u>-1){const g=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(h-Math.min(g,u),d.loaded)}else this.bwEstimator.sampleTTFB(h)}break}}}getTimeToLoadFrag(e,t,n,r){const o=e+n/t,c=r?e+this.lastLevelLoadSec:0;return o+c}onLevelLoaded(e,t){const n=this.hls.config,{loading:r}=t.stats,o=r.end-r.first;Xe(o)&&(this.lastLevelLoadSec=o/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:n}){const r=n?n.stats:t.stats;if(t.type===Je.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const o=n?n.duration:t.duration,c=this.hls.levels[t.level],d=(c.loaded?c.loaded.bytes:0)+r.loaded,h=(c.loaded?c.loaded.duration:0)+o;c.loaded={bytes:d,duration:h},c.realBitrate=Math.round(8*d/h)}if(t.bitrateTest){const o={stats:r,frag:t,part:n,id:t.type};this.onFragBuffered(F.FRAG_BUFFERED,o),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:r}=t,o=r!=null&&r.stats.loaded?r.stats:n.stats;if(o.aborted||this.ignoreFragment(n))return;const c=o.parsing.end-o.loading.start-Math.min(o.loading.first-o.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(c,o.loaded),o.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=c/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Je.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,o=this.findBestLevel(n,t,e,0,r,1,1);if(o>-1)return o;const c=this.hls.firstLevel,d=Math.min(Math.max(c,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${c} clamped to ${d}`),d}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,n=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!n||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const o=n&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const c=this.hls.levels;if(c.length>Math.max(e,o)&&c[e].loadError<=c[o].loadError)return e}return this._nextAutoLevel=o,this.nextAutoLevelKey=this.getAutoLevelKey(),o}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:r,config:o,minAutoLevel:c}=n,d=t?t.duration:e?e.duration:0,h=this.getBwEstimate(),u=this.getStarvationDelay();let m=o.abrBandWidthFactor,g=o.abrBandWidthUpFactor;if(u){const N=this.findBestLevel(h,c,r,u,0,m,g);if(N>=0)return this.rebufferNotice=-1,N}let x=d?Math.min(d,o.maxStarvationDelay):o.maxStarvationDelay;if(!u){const N=this.bitrateTestDelay;N&&(x=(d?Math.min(d,o.maxLoadingDelay):o.maxLoadingDelay)-N,this.info(`bitrate test took ${Math.round(1e3*N)}ms, set first fragment max fetchDuration to ${Math.round(1e3*x)} ms`),m=g=1)}const y=this.findBestLevel(h,c,r,u,x,m,g);if(this.rebufferNotice!==y&&(this.rebufferNotice=y,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${y}`)),y>-1)return y;const v=n.levels[c],S=n.loadLevelObj;return S&&v?.bitrate<S.bitrate?c:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,r,o,c,d){var h;const u=r+o,m=this.lastLoadedFragLevel,g=m===-1?this.hls.firstLevel:m,{fragCurrent:x,partCurrent:y}=this,{levels:v,allAudioTracks:S,loadLevel:N,config:A}=this.hls;if(v.length===1)return 0;const R=v[g],C=!!((h=this.hls.latestLevelDetails)!=null&&h.live),D=N===-1||m===-1;let V,z="SDR",B=R?.frameRate||0;const{audioPreference:I,videoPreference:M}=A,L=this.audioTracksByGroup||(this.audioTracksByGroup=T1(S));let O=-1;if(D){if(this.firstSelection!==-1)return this.firstSelection;const X=this.codecTiers||(this.codecTiers=BD(v,L,t,n)),ce=PD(X,z,e,I,M),{codecSet:le,videoRanges:Y,minFramerate:K,minBitrate:H,minIndex:Q,preferHDR:oe}=ce;O=Q,V=le,z=oe?Y[Y.length-1]:Y[0],B=K,e=Math.max(e,H),this.log(`picked start tier ${os(ce)}`)}else V=R?.codecSet,z=R?.videoRange;const J=y?y.duration:x?x.duration:0,ie=this.bwEstimator.getEstimateTTFB()/1e3,ne=[];for(let X=n;X>=t;X--){var se;const ce=v[X],le=X>g;if(!ce)continue;if(A.useMediaCapabilities&&!ce.supportedResult&&!ce.supportedPromise){const xe=navigator.mediaCapabilities;typeof xe?.decodingInfo=="function"&&AD(ce,L,z,B,e,I)?(ce.supportedPromise=N1(ce,L,xe,this.supportedCache),ce.supportedPromise.then(pe=>{if(!this.hls)return;ce.supportedResult=pe;const ee=this.hls.levels,re=ee.indexOf(ce);pe.error?this.warn(`MediaCapabilities decodingInfo error: "${pe.error}" for level ${re} ${os(pe)}`):pe.supported?pe.decodingInfoResults.some(je=>je.smooth===!1||je.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${re} not smooth or powerEfficient: ${os(pe)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${re} ${os(pe)}`),re>-1&&ee.length>1&&(this.log(`Removing unsupported level ${re}`),this.hls.removeLevel(re),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(pe=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${pe}`)})):ce.supportedResult=S1}if((V&&ce.codecSet!==V||z&&ce.videoRange!==z||le&&B>ce.frameRate||!le&&B>0&&B<ce.frameRate||(se=ce.supportedResult)!=null&&(se=se.decodingInfoResults)!=null&&se.some(xe=>xe.smooth===!1))&&(!D||X!==O)){ne.push(X);continue}const Y=ce.details,K=(y?Y?.partTarget:Y?.averagetargetduration)||J;let H;le?H=d*e:H=c*e;const Q=J&&r>=J*2&&o===0?ce.averageBitrate:ce.maxBitrate,oe=this.getTimeToLoadFrag(ie,H,Q*K,Y===void 0);if(H>=Q&&(X===m||ce.loadError===0&&ce.fragmentError===0)&&(oe<=ie||!Xe(oe)||C&&!this.bitrateTestDelay||oe<u)){const xe=this.forcedAutoLevel;return X!==N&&(xe===-1||xe!==N)&&(ne.length&&this.trace(`Skipped level(s) ${ne.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${v[ne[0]].codecs}" ${v[ne[0]].videoRange}; not compatible with "${V}" ${z}`),this.info(`switch candidate:${g}->${X} adjustedbw(${Math.round(H)})-bitrate=${Math.round(H-Q)} ttfb:${ie.toFixed(1)} avgDuration:${K.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${oe.toFixed(1)} firstSelection:${D} codecSet:${ce.codecSet} videoRange:${ce.videoRange} hls.loadLevel:${N}`)),D&&(this.firstSelection=X),X}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}}const A1={search:function(i,e){let t=0,n=i.length-1,r=null,o=null;for(;t<=n;){r=(t+n)/2|0,o=i[r];const c=e(o);if(c>0)t=r+1;else if(c<0)n=r-1;else return o}return null}};function VD(i,e,t){if(e===null||!Array.isArray(i)||!i.length||!Xe(e))return null;const n=i[0].programDateTime;if(e<(n||0))return null;const r=i[i.length-1].endProgramDateTime;if(e>=(r||0))return null;for(let o=0;o<i.length;++o){const c=i[o];if(KD(e,t,c))return c}return null}function Mr(i,e,t=0,n=0,r=.005){let o=null;if(i){o=e[1+i.sn-e[0].sn]||null;const d=i.endDTS-t;d>0&&d<15e-7&&(t+=15e-7),o&&i.level!==o.level&&o.end<=i.end&&(o=e[2+i.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(o=e[0]);if(o&&((!i||i.level===o.level)&&Cb(t,n,o)===0||HD(o,i,Math.min(r,n))))return o;const c=A1.search(e,Cb.bind(null,t,n));return c&&(c!==i||!o)?c:o}function HD(i,e,t){if(e&&e.start===0&&e.level<i.level&&(e.endPTS||0)>0){const n=e.tagList.reduce((r,o)=>(o[0]==="INF"&&(r+=parseFloat(o[1])),r),t);return i.start<=n}return!1}function Cb(i=0,e=0,t){if(t.start<=i&&t.start+t.duration>i)return 0;const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=i?1:t.start-n>i&&t.start?-1:0}function KD(i,e,t){const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>i}function j1(i,e,t){if(i&&i.startCC<=e&&i.endCC>=e){let n=i.fragments;const{fragmentHint:r}=i;r&&(n=n.concat(r));let o;return A1.search(n,c=>c.cc<e?1:c.cc>e?-1:(o=c,c.end<=t?1:c.start>t?-1:0)),o||null}return null}function Au(i){switch(i.details){case _e.FRAG_LOAD_TIMEOUT:case _e.KEY_LOAD_TIMEOUT:case _e.LEVEL_LOAD_TIMEOUT:case _e.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function C1(i){return i.details.startsWith("key")}function R1(i){return C1(i)&&!!i.frag&&!i.frag.decryptdata}function Rb(i,e){const t=Au(e);return i.default[`${t?"timeout":"error"}Retry`]}function v0(i,e){const t=i.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*i.retryDelayMs,i.maxRetryDelayMs)}function Lb(i){return Qt(Qt({},i),{errorRetry:null,timeoutRetry:null})}function ju(i,e,t,n){if(!i)return!1;const r=n?.code,o=e<i.maxNumRetry&&(qD(r)||!!t);return i.shouldRetry?i.shouldRetry(i,e,t,n,o):o}function qD(i){return mg(i)||!!i&&(i<400||i>499)}function mg(i){return i===0&&navigator.onLine===!1}var Js={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Pn={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class zD extends ai{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(F.ERROR,this.onError,this),e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(F.ERROR,this.onError,this),e.off(F.ERROR,this.onErrorOut,this),e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===Je.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,n=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||n===-1?t.loadLevel:n}variantHasKey(e,t){if(e){var n;if((n=e.details)!=null&&n.hasKey(t))return!0;const r=e.audioGroups;if(r)return this.hls.allAudioTracks.filter(c=>r.indexOf(c.groupId)>=0).some(c=>{var d;return(d=c.details)==null?void 0:d.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const r=this.hls,o=t.context;switch(t.details){case _e.FRAG_LOAD_ERROR:case _e.FRAG_LOAD_TIMEOUT:case _e.KEY_LOAD_ERROR:case _e.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case _e.FRAG_PARSING_ERROR:if((n=t.frag)!=null&&n.gap){t.errorAction=Oo();return}case _e.FRAG_GAP:case _e.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Js.SendAlternateToPenaltyBox;return}case _e.LEVEL_EMPTY_ERROR:case _e.LEVEL_PARSING_ERROR:{var c;const h=t.parent===Je.MAIN?t.level:r.loadLevel;t.details===_e.LEVEL_EMPTY_ERROR&&((c=t.context)!=null&&(c=c.levelDetails)!=null&&c.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,h):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,h))}return;case _e.LEVEL_LOAD_ERROR:case _e.LEVEL_LOAD_TIMEOUT:typeof o?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,o.level));return;case _e.AUDIO_TRACK_LOAD_ERROR:case _e.AUDIO_TRACK_LOAD_TIMEOUT:case _e.SUBTITLE_LOAD_ERROR:case _e.SUBTITLE_TRACK_LOAD_TIMEOUT:if(o){const h=r.loadLevelObj;if(h&&(o.type===Rt.AUDIO_TRACK&&h.hasAudioGroup(o.groupId)||o.type===Rt.SUBTITLE_TRACK&&h.hasSubtitleGroup(o.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=Js.SendAlternateToPenaltyBox,t.errorAction.flags=Pn.MoveAllAlternatesMatchingHost;return}}return;case _e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Js.SendAlternateToPenaltyBox,flags:Pn.MoveAllAlternatesMatchingHDCP};return;case _e.KEY_SYSTEM_SESSION_UPDATE_FAILED:case _e.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case _e.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Js.SendAlternateToPenaltyBox,flags:Pn.MoveAllAlternatesMatchingKey};return;case _e.BUFFER_ADD_CODEC_ERROR:case _e.REMUX_ALLOC_ERROR:case _e.BUFFER_APPEND_ERROR:if(!t.errorAction){var d;t.errorAction=this.getLevelSwitchAction(t,(d=t.level)!=null?d:r.loadLevel)}return;case _e.INTERNAL_EXCEPTION:case _e.BUFFER_APPENDING_ERROR:case _e.BUFFER_FULL_ERROR:case _e.LEVEL_SWITCH_ERROR:case _e.BUFFER_STALLED_ERROR:case _e.BUFFER_SEEK_OVER_HOLE:case _e.BUFFER_NUDGE_ON_STALL:t.errorAction=Oo();return}t.type===tt.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Oo())}getPlaylistRetryOrSwitchAction(e,t){const n=this.hls,r=Rb(n.config.playlistLoadPolicy,e),o=this.playlistError++;if(ju(r,o,Au(e),e.response))return{action:Js.RetryRequest,flags:Pn.None,retryConfig:r,retryCount:o};const d=this.getLevelSwitchAction(e,t);return r&&(d.retryConfig=r,d.retryCount=o),d}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),r=t.levels[n],{fragLoadPolicy:o,keyLoadPolicy:c}=t.config,d=Rb(C1(e)?c:o,e),h=t.levels.reduce((m,g)=>m+g.fragmentError,0);if(r&&(e.details!==_e.FRAG_GAP&&r.fragmentError++,!R1(e)&&ju(d,h,Au(e),e.response)))return{action:Js.RetryRequest,flags:Pn.None,retryConfig:d,retryCount:h};const u=this.getLevelSwitchAction(e,n);return d&&(u.retryConfig=d,u.retryCount=h),u}getLevelSwitchAction(e,t){const n=this.hls;t==null&&(t=n.loadLevel);const r=this.hls.levels[t];if(r){var o,c;const u=e.details;r.loadError++,u===_e.BUFFER_APPEND_ERROR&&r.fragmentError++;let m=-1;const{levels:g,loadLevel:x,minAutoLevel:y,maxAutoLevel:v}=n;!n.autoLevelEnabled&&!n.config.preserveManualLevelOnError&&(n.loadLevel=-1);const S=(o=e.frag)==null?void 0:o.type,A=(S===Je.AUDIO&&u===_e.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===_e.BUFFER_ADD_CODEC_ERROR||u===_e.BUFFER_APPEND_ERROR))&&g.some(({audioCodec:z})=>r.audioCodec!==z),C=e.sourceBufferName==="video"&&(u===_e.BUFFER_ADD_CODEC_ERROR||u===_e.BUFFER_APPEND_ERROR)&&g.some(({codecSet:z,audioCodec:B})=>r.codecSet!==z&&r.audioCodec===B),{type:D,groupId:V}=(c=e.context)!=null?c:{};for(let z=g.length;z--;){const B=(z+x)%g.length;if(B!==x&&B>=y&&B<=v&&g[B].loadError===0){var d,h;const I=g[B];if(u===_e.FRAG_GAP&&S===Je.MAIN&&e.frag){const M=g[B].details;if(M){const L=Mr(e.frag,M.fragments,e.frag.start);if(L!=null&&L.gap)continue}}else{if(D===Rt.AUDIO_TRACK&&I.hasAudioGroup(V)||D===Rt.SUBTITLE_TRACK&&I.hasSubtitleGroup(V))continue;if(S===Je.AUDIO&&(d=r.audioGroups)!=null&&d.some(M=>I.hasAudioGroup(M))||S===Je.SUBTITLE&&(h=r.subtitleGroups)!=null&&h.some(M=>I.hasSubtitleGroup(M))||A&&r.audioCodec===I.audioCodec||C&&r.codecSet===I.codecSet||!A&&r.codecSet!==I.codecSet)continue}m=B;break}}if(m>-1&&n.loadLevel!==m)return e.levelRetry=!0,this.playlistError=0,{action:Js.SendAlternateToPenaltyBox,flags:Pn.None,nextAutoLevel:m}}return{action:Js.SendAlternateToPenaltyBox,flags:Pn.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case Js.DoNothing:break;case Js.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==_e.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:r}=n,o=n.nextAutoLevel;switch(r){case Pn.None:this.switchLevel(e,o);break;case Pn.MoveAllAlternatesMatchingHDCP:{const h=this.getVariantLevelIndex(e.frag),u=t.levels[h],m=u?.attrs["HDCP-LEVEL"];if(n.hdcpLevel=m,m==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(m){t.maxHdcpLevel=fg[fg.indexOf(m)-1],n.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Pn.MoveAllAlternatesMatchingKey:{const h=e.decryptdata;if(h){const u=this.hls.levels,m=u.length;for(let x=m;x--;)if(this.variantHasKey(u[x],h)){var c,d;this.log(`Banned key found in level ${x} (${u[x].bitrate}bps) or audio group "${(c=u[x].audioGroups)==null?void 0:c.join(",")}" (${(d=e.frag)==null?void 0:d.type} fragment) ${Zs(h.keyId||[])}`),u[x].fragmentError++,u[x].loadError++,this.log(`Removing level ${x} with key error (${e.error})`),this.hls.removeLevel(x)}const g=e.frag;if(this.hls.levels.length<m)n.resolved=!0;else if(g&&g.type!==Je.MAIN){const x=g.decryptdata;x&&!h.matches(x)&&(n.resolved=!0)}}break}}n.resolved||this.switchLevel(e,o)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===_e.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const n=hg(e.mimeType),r=this.hls.levels;for(let o=r.length;o--;)r[o][`${e.sourceBufferName}Codec`]===n&&(this.log(`Removing level ${o} for ${e.details} ("${n}" not supported)`),this.hls.removeLevel(o))}}}function Oo(i){const e={action:Js.DoNothing,flags:Pn.None};return i&&(e.resolved=!0),e}var Fs={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class YD{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.BUFFER_APPENDED,this.onBufferAppended,this),e.on(F.FRAG_BUFFERED,this.onFragBuffered,this),e.on(F.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.BUFFER_APPENDED,this.onBufferAppended,this),e.off(F.FRAG_BUFFERED,this.onFragBuffered,this),e.off(F.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let r=n.length;r--;){const o=n[r];if(!o)break;if(o.start<=e&&e<=o.end&&o.loaded)return o}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:r}=this,o=Object.keys(r);for(let c=o.length;c--;){const d=r[o[c]];if(d?.body.type===t&&(!n||d.buffered)){const h=d.body;if(h.start<=e&&e<=h.end)return h}}return null}detectEvictedFragments(e,t,n,r,o){this.timeRanges&&(this.timeRanges[e]=t);const c=r?.fragment.sn||-1;Object.keys(this.fragments).forEach(d=>{const h=this.fragments[d];if(!h||c>=h.body.sn)return;if(!h.buffered&&(!h.loaded||o)){h.body.type===n&&this.removeFragment(h.body);return}const u=h.range[e];if(u){if(u.time.length===0){this.removeFragment(h.body);return}u.time.some(m=>{const g=!this.isTimeBuffered(m.startPTS,m.endPTS,t);return g&&this.removeFragment(h.body),g})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const n=e.frag,r=No(n),o=this.fragments[r];if(!o||o.buffered&&n.gap)return;const c=!n.relurl;Object.keys(t).forEach(d=>{const h=n.elementaryStreams[d];if(!h)return;const u=t[d],m=c||h.partial===!0;o.range[d]=this.getBufferedTimes(n,e.part,m,u)}),o.loaded=null,Object.keys(o.range).length?(this.bufferedEnd(o,n),Fd(o)||this.removeParts(n.sn-1,n.type)):this.removeFragment(o.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=kb(n,r=>r.fragment.sn>=e))}fragBuffered(e,t){const n=No(e);let r=this.fragments[n];!r&&t&&(r=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,this.bufferedEnd(r,e))}getBufferedTimes(e,t,n,r){const o={time:[],partial:n},c=e.start,d=e.end,h=e.minEndPTS||d,u=e.maxStartPTS||c;for(let m=0;m<r.length;m++){const g=r.start(m)-this.bufferPadding,x=r.end(m)+this.bufferPadding;if(u>=g&&h<=x){o.time.push({startPTS:Math.max(c,r.start(m)),endPTS:Math.min(d,r.end(m))});break}else if(c<x&&d>g){const y=Math.max(c,r.start(m)),v=Math.min(d,r.end(m));v>y&&(o.partial=!0,o.time.push({startPTS:y,endPTS:v}))}else if(d<=g)break}return o}getPartialFragment(e){let t=null,n,r,o,c=0;const{bufferPadding:d,fragments:h}=this;return Object.keys(h).forEach(u=>{const m=h[u];m&&Fd(m)&&(r=m.body.start-d,o=m.body.end+d,e>=r&&e<=o&&(n=Math.min(e-r,o-e),c<=n&&(t=m.body,c=n)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Fd(t))}getState(e){const t=No(e),n=this.fragments[t];return n?n.buffered?Fd(n)?Fs.PARTIAL:Fs.OK:Fs.APPENDING:Fs.NOT_LOADED}isTimeBuffered(e,t,n){let r,o;for(let c=0;c<n.length;c++){if(r=n.start(c)-this.bufferPadding,o=n.end(c)+this.bufferPadding,e>=r&&t<=o)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const n=t.frag,r=t.part?null:t,o=No(n);this.fragments[o]={body:n,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:r,timeRanges:o,type:c}=t;if(n.sn==="initSegment")return;const d=n.type;if(r){let u=this.activePartLists[d];u||(this.activePartLists[d]=u=[]),u.push(r)}this.timeRanges=o;const h=o[c];this.detectEvictedFragments(c,h,d,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=No(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let r=n.length;r--;){const o=t[n[r]];if(o?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,n,r,o){r&&!this.hasGaps||Object.keys(this.fragments).forEach(c=>{const d=this.fragments[c];if(!d)return;const h=d.body;h.type!==n||r&&!h.gap||h.start<t&&h.end>e&&(d.buffered||o)&&this.removeFragment(h)})}removeFragment(e){const t=No(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const r=e.sn;this.activePartLists[e.type]=kb(n,o=>o.fragment.sn!==r)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(n=>n.clearElementaryStreamInfo())}}function Fd(i){var e,t,n;return i.buffered&&!!(i.body.gap||(e=i.range.video)!=null&&e.partial||(t=i.range.audio)!=null&&t.partial||(n=i.range.audiovideo)!=null&&n.partial)}function No(i){return`${i.type}_${i.level}_${i.sn}`}function kb(i,e){return i.filter(t=>{const n=e(t);return n||t.clearElementaryStreamInfo(),n})}var za={cbc:0,ctr:1};class WD{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case za.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case za.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function QD(i){const e=i.byteLength,t=e&&new DataView(i.buffer).getUint8(e-1);return t?i.slice(0,e-t):i}class XD{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let r=0;r<4;r++)n[r]=t.getUint32(r*4);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,r=n[0],o=n[1],c=n[2],d=n[3],h=this.invSubMix,u=h[0],m=h[1],g=h[2],x=h[3],y=new Uint32Array(256);let v=0,S=0,N=0;for(N=0;N<256;N++)N<128?y[N]=N<<1:y[N]=N<<1^283;for(N=0;N<256;N++){let A=S^S<<1^S<<2^S<<3^S<<4;A=A>>>8^A&255^99,e[v]=A,t[A]=v;const R=y[v],C=y[R],D=y[C];let V=y[A]*257^A*16843008;r[v]=V<<24|V>>>8,o[v]=V<<16|V>>>16,c[v]=V<<8|V>>>24,d[v]=V,V=D*16843009^C*65537^R*257^v*16843008,u[A]=V<<24|V>>>8,m[A]=V<<16|V>>>16,g[A]=V<<8|V>>>24,x[A]=V,v?(v=R^y[y[y[D^R]]],S^=y[y[S]]):v=S=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,r=0;for(;r<t.length&&n;)n=t[r]===this.key[r],r++;if(n)return;this.key=t;const o=this.keySize=t.length;if(o!==4&&o!==6&&o!==8)throw new Error("Invalid aes key size="+o);const c=this.ksRows=(o+6+1)*4;let d,h;const u=this.keySchedule=new Uint32Array(c),m=this.invKeySchedule=new Uint32Array(c),g=this.sBox,x=this.rcon,y=this.invSubMix,v=y[0],S=y[1],N=y[2],A=y[3];let R,C;for(d=0;d<c;d++){if(d<o){R=u[d]=t[d];continue}C=R,d%o===0?(C=C<<8|C>>>24,C=g[C>>>24]<<24|g[C>>>16&255]<<16|g[C>>>8&255]<<8|g[C&255],C^=x[d/o|0]<<24):o>6&&d%o===4&&(C=g[C>>>24]<<24|g[C>>>16&255]<<16|g[C>>>8&255]<<8|g[C&255]),u[d]=R=(u[d-o]^C)>>>0}for(h=0;h<c;h++)d=c-h,h&3?C=u[d]:C=u[d-4],h<4||d<=4?m[h]=C:m[h]=v[g[C>>>24]]^S[g[C>>>16&255]]^N[g[C>>>8&255]]^A[g[C&255]],m[h]=m[h]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){const r=this.keySize+6,o=this.invKeySchedule,c=this.invSBox,d=this.invSubMix,h=d[0],u=d[1],m=d[2],g=d[3],x=this.uint8ArrayToUint32Array_(n);let y=x[0],v=x[1],S=x[2],N=x[3];const A=new Int32Array(e),R=new Int32Array(A.length);let C,D,V,z,B,I,M,L,O,J,ie,ne,se,X;const ce=this.networkToHostOrderSwap;for(;t<A.length;){for(O=ce(A[t]),J=ce(A[t+1]),ie=ce(A[t+2]),ne=ce(A[t+3]),B=O^o[0],I=ne^o[1],M=ie^o[2],L=J^o[3],se=4,X=1;X<r;X++)C=h[B>>>24]^u[I>>16&255]^m[M>>8&255]^g[L&255]^o[se],D=h[I>>>24]^u[M>>16&255]^m[L>>8&255]^g[B&255]^o[se+1],V=h[M>>>24]^u[L>>16&255]^m[B>>8&255]^g[I&255]^o[se+2],z=h[L>>>24]^u[B>>16&255]^m[I>>8&255]^g[M&255]^o[se+3],B=C,I=D,M=V,L=z,se=se+4;C=c[B>>>24]<<24^c[I>>16&255]<<16^c[M>>8&255]<<8^c[L&255]^o[se],D=c[I>>>24]<<24^c[M>>16&255]<<16^c[L>>8&255]<<8^c[B&255]^o[se+1],V=c[M>>>24]<<24^c[L>>16&255]<<16^c[B>>8&255]<<8^c[I&255]^o[se+2],z=c[L>>>24]<<24^c[B>>16&255]<<16^c[I>>8&255]<<8^c[M&255]^o[se+3],R[t]=ce(C^y),R[t+1]=ce(z^v),R[t+2]=ce(V^S),R[t+3]=ce(D^N),y=O,v=J,S=ie,N=ne,t=t+4}return R.buffer}}class JD{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=ZD(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function ZD(i){switch(i){case za.cbc:return"AES-CBC";case za.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${i}`)}}const eI=16;class b0{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?QD(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,r){return this.useSoftware?new Promise((o,c)=>{const d=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(d,t,n,r);const h=this.flush();h?o(h.buffer):c(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,r)}softwareDecrypt(e,t,n,r){const{currentIV:o,currentResult:c,remainderData:d}=this;if(r!==za.cbc||t.byteLength!==16)return Xt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),d&&(e=ni(d,e),this.remainderData=null);const h=this.getValidChunk(e);if(!h.length)return null;o&&(n=o);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new XD),u.expandKey(t);const m=c;return this.currentResult=u.decrypt(h.buffer,0,n),this.currentIV=h.slice(-16).buffer,m||null}webCryptoDecrypt(e,t,n,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,r));this.key=t,this.fastAesKey=new JD(this.subtle,t,r)}return this.fastAesKey.expandKey().then(o=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new WD(this.subtle,new Uint8Array(n),r).decrypt(e.buffer,o)):Promise.reject(new Error("web crypto not initialized"))).catch(o=>(Xt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${o.name}: ${o.message}`),this.onWebCryptoError(e,t,n,r)))}onWebCryptoError(e,t,n,r){const o=this.enableSoftwareAES;if(o){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,r);const c=this.flush();if(c)return c.buffer}throw new Error("WebCrypto"+(o?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%eI;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(Xt.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Db=Math.pow(2,17);class tI{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new ta({type:tt.NETWORK_ERROR,details:_e.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,o=r.fLoader,c=r.loader;return new Promise((d,h)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(v=>v[0]==="GAP")){h(Mb(e));return}else e.gap=!1;const u=this.loader=o?new o(r):new c(r),m=Ib(e);e.loader=u;const g=Lb(r.fragLoadPolicy.default),x={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Db};e.stats=u.stats;const y={onSuccess:(v,S,N,A)=>{this.resetLoader(e,u);let R=v.data;N.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(R.slice(0,16)),R=R.slice(16)),d({frag:e,part:null,payload:R,networkDetails:A})},onError:(v,S,N,A)=>{this.resetLoader(e,u),h(new ta({type:tt.NETWORK_ERROR,details:_e.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Qt({url:n,data:void 0},v),error:new Error(`HTTP Error ${v.code} ${v.text}`),networkDetails:N,stats:A}))},onAbort:(v,S,N)=>{this.resetLoader(e,u),h(new ta({type:tt.NETWORK_ERROR,details:_e.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:N,stats:v}))},onTimeout:(v,S,N)=>{this.resetLoader(e,u),h(new ta({type:tt.NETWORK_ERROR,details:_e.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${x.timeout}ms`),networkDetails:N,stats:v}))}};t&&(y.onProgress=(v,S,N,A)=>t({frag:e,part:null,payload:N,networkDetails:A})),u.load(m,x,y)})}loadPart(e,t,n){this.abort();const r=this.config,o=r.fLoader,c=r.loader;return new Promise((d,h)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){h(Mb(e,t));return}const u=this.loader=o?new o(r):new c(r),m=Ib(e,t);e.loader=u;const g=Lb(r.fragLoadPolicy.default),x={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Db};t.stats=u.stats,u.load(m,x,{onSuccess:(y,v,S,N)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const A={frag:e,part:t,payload:y.data,networkDetails:N};n(A),d(A)},onError:(y,v,S,N)=>{this.resetLoader(e,u),h(new ta({type:tt.NETWORK_ERROR,details:_e.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Qt({url:m.url,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:S,stats:N}))},onAbort:(y,v,S)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),h(new ta({type:tt.NETWORK_ERROR,details:_e.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:S,stats:y}))},onTimeout:(y,v,S)=>{this.resetLoader(e,u),h(new ta({type:tt.NETWORK_ERROR,details:_e.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${x.timeout}ms`),networkDetails:S,stats:y}))}})})}updateStatsFromPart(e,t){const n=e.stats,r=t.stats,o=r.total;if(n.loaded+=r.loaded,o){const h=Math.round(e.duration/t.duration),u=Math.min(Math.round(n.loaded/o),h),g=(h-u)*Math.round(n.loaded/u);n.total=n.loaded+g}else n.total=Math.max(n.loaded,n.total);const c=n.loading,d=r.loading;c.start?c.first+=d.first-d.start:(c.start=d.start,c.first=d.first),c.end=d.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Ib(i,e=null){const t=e||i,n={frag:i,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,o=t.byteRangeEndOffset;if(Xe(r)&&Xe(o)){var c;let d=r,h=o;if(i.sn==="initSegment"&&sI((c=i.decryptdata)==null?void 0:c.method)){const u=o-r;u%16&&(h=o+(16-u%16)),r!==0&&(n.resetIV=!0,d=r-16)}n.rangeStart=d,n.rangeEnd=h}return n}function Mb(i,e){const t=new Error(`GAP ${i.gap?"tag":"attribute"} found`),n={type:tt.MEDIA_ERROR,details:_e.FRAG_GAP,fatal:!1,frag:i,error:t,networkDetails:null};return e&&(n.part=e),(e||i).stats.aborted=!0,new ta(n)}function sI(i){return i==="AES-128"||i==="AES-256"}class ta extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class L1 extends ai{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class _0{constructor(e,t,n,r=0,o=-1,c=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=$d(),this.buffering={audio:$d(),video:$d(),audiovideo:$d()},this.level=e,this.sn=t,this.id=n,this.size=r,this.part=o,this.partial=c}}function $d(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Ob={length:0,start:()=>0,end:()=>0};class yt{static isBuffered(e,t){if(e){const n=yt.getBuffered(e);for(let r=n.length;r--;)if(t>=n.start(r)&&t<=n.end(r))return!0}return!1}static bufferedRanges(e){if(e){const t=yt.getBuffered(e);return yt.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const r=yt.bufferedRanges(e);if(r.length)return yt.bufferedInfo(r,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((m,g)=>m.start-g.start||g.end-m.end);let r=-1,o=[];if(n)for(let m=0;m<e.length;m++){t>=e[m].start&&t<=e[m].end&&(r=m);const g=o.length;if(g){const x=o[g-1].end;e[m].start-x<n?e[m].end>x&&(o[g-1].end=e[m].end):o.push(e[m])}else o.push(e[m])}else o=e;let c=0,d,h=t,u=t;for(let m=0;m<o.length;m++){const g=o[m].start,x=o[m].end;if(r===-1&&t>=g&&t<=x&&(r=m),t+n>=g&&t<x)h=g,u=x,c=u-t;else if(t+n<g){d=g;break}}return{len:c,start:h||0,end:u||0,nextStart:d,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||Ob}catch(t){return Xt.log("failed to get media.buffered",t),Ob}}}const k1=/\{\$([a-zA-Z0-9-_]+)\}/g;function Pb(i){return k1.test(i)}function gg(i,e){if(i.variableList!==null||i.hasVariableRefs){const t=i.variableList;return e.replace(k1,n=>{const r=n.substring(2,n.length-1),o=t?.[r];return o===void 0?(i.playlistParsingError||(i.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),n):o})}return e}function Bb(i,e,t){let n=i.variableList;n||(i.variableList=n={});let r,o;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{const c=new self.URL(t).searchParams;if(c.has(r))o=c.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${t}"`)}catch(c){i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${c.message}`))}}else r=e.NAME,o=e.VALUE;r in n?i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):n[r]=o||""}function nI(i,e,t){const n=e.IMPORT;if(t&&n in t){let r=i.variableList;r||(i.variableList=r={}),r[n]=t[n]}else i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const iI=/^(\d+)x(\d+)$/,Ub=/(.+?)=(".*?"|.*?)(?:,|$)/g;class xs{constructor(e,t){typeof e=="string"&&(e=xs.parseAttrList(e,t)),ns(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const n=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)n[r]=parseInt(t.slice(r*2,r*2+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((r,o)=>(r[o.toLowerCase()]=!0,r),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=iI.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const r={};for(Ub.lastIndex=0;(n=Ub.exec(e))!==null;){const c=n[1].trim();let d=n[2];const h=d.indexOf('"')===0&&d.lastIndexOf('"')===d.length-1;let u=!1;if(h)d=d.slice(1,-1);else switch(c){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(t&&(h||u))d=gg(t,d);else if(!u&&!h)switch(c){case"CLOSED-CAPTIONS":if(d==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Xt.warn(`${e}: attribute ${c} is missing quotes`)}r[c]=d}return r}}const aI="com.apple.hls.interstitial";function rI(i){return i!=="ID"&&i!=="CLASS"&&i!=="CUE"&&i!=="START-DATE"&&i!=="DURATION"&&i!=="END-DATE"&&i!=="END-ON-NEXT"}function oI(i){return i==="SCTE35-OUT"||i==="SCTE35-IN"||i==="SCTE35-CMD"}class D1{constructor(e,t,n=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(r=t?.tagOrder)!=null?r:n,t){const o=t.attr;for(const c in o)if(Object.prototype.hasOwnProperty.call(e,c)&&e[c]!==o[c]){Xt.warn(`DATERANGE tag attribute: "${c}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=c;break}e=ns(new xs({}),o,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const o=t?.endDate||new Date(this.attr["END-DATE"]);Xe(o.getTime())&&(this._endDate=o)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Xt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Xe(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===aI}get isValid(){return!!this.id&&!this._badValueForSameId&&Xe(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const lI=10;class cI{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return this.fragments.length?Xe(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||lI}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Cu(i,e){return i.length===e.length?!i.some((t,n)=>t!==e[n]):!1}function Fb(i,e){return!i&&!e?!0:!i||!e?!1:Cu(i,e)}function Po(i){return i==="AES-128"||i==="AES-256"||i==="AES-256-CTR"}function S0(i){switch(i){case"AES-128":case"AES-256":return za.cbc;case"AES-256-CTR":return za.ctr;default:throw new Error(`invalid full segment method ${i}`)}}function E0(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0))}function pg(i){return Uint8Array.from(unescape(encodeURIComponent(i)),e=>e.charCodeAt(0))}function dI(i){const e=pg(i).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function I1(i){const e=function(n,r,o){const c=n[r];n[r]=n[o],n[o]=c};e(i,0,3),e(i,1,2),e(i,4,5),e(i,6,7)}function M1(i){const e=i.split(":");let t=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),r=n[n.length-1].split(",");if(r.length===2){const o=r[0]==="base64",c=r[1];o?(n.splice(-1,1),t=E0(c)):t=dI(c)}}return t}const Ru=typeof self<"u"?self:void 0;var ys={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},en={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function du(i){switch(i){case en.FAIRPLAY:return ys.FAIRPLAY;case en.PLAYREADY:return ys.PLAYREADY;case en.WIDEVINE:return ys.WIDEVINE;case en.CLEARKEY:return ys.CLEARKEY}}function ym(i){switch(i){case ys.FAIRPLAY:return en.FAIRPLAY;case ys.PLAYREADY:return en.PLAYREADY;case ys.WIDEVINE:return en.WIDEVINE;case ys.CLEARKEY:return en.CLEARKEY}}function Zl(i){const{drmSystems:e,widevineLicenseUrl:t}=i,n=e?[ys.FAIRPLAY,ys.WIDEVINE,ys.PLAYREADY,ys.CLEARKEY].filter(r=>!!e[r]):[];return!n[ys.WIDEVINE]&&t&&n.push(ys.WIDEVINE),n}const O1=(function(i){return Ru!=null&&(i=Ru.navigator)!=null&&i.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function uI(i,e,t,n){let r;switch(i){case ys.FAIRPLAY:r=["cenc","sinf"];break;case ys.WIDEVINE:case ys.PLAYREADY:r=["cenc"];break;case ys.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${i}`)}return hI(r,e,t,n)}function hI(i,e,t,n){return[{initDataTypes:i,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(o=>({contentType:`audio/mp4; codecs=${o}`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(o=>({contentType:`video/mp4; codecs=${o}`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function fI(i){var e;return!!i&&(i.sessionType==="persistent-license"||!!((e=i.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function P1(i){const e=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),n=t.substring(t.indexOf("<"),t.length),c=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(c){const d=c.childNodes[0]?c.childNodes[0].nodeValue:c.getAttribute("VALUE");if(d){const h=E0(d).subarray(0,16);return I1(h),h}}return null}let wo={};class Ga{static clearKeyUriToKeyIdMap(){wo={}}static setKeyIdForUri(e,t){wo[e]=t}static addKeyIdForUri(e){const t=Object.keys(wo).length%Number.MAX_SAFE_INTEGER,n=new Uint8Array(16);return new DataView(n.buffer,12,4).setUint32(0,t),wo[e]=n,n}constructor(e,t,n,r=[1],o=null,c){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=r,this.iv=o,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Po(e),c!=null&&c.startsWith("0x")&&(this.keyId=new Uint8Array(u1(c)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Cu(e.keyFormatVersions,this.keyFormatVersions)&&Fb(e.iv,this.iv)&&Fb(e.keyId,this.keyId)}isSupported(){if(this.method){if(Po(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case en.FAIRPLAY:case en.WIDEVINE:case en.PLAYREADY:case en.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Po(this.method)){let o=this.iv;return o||(typeof e!="number"&&(Xt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),o=gI(e)),new Ga(this.method,this.uri,"identity",this.keyFormatVersions,o)}if(this.keyId){const o=wo[this.uri];if(o&&!Cu(this.keyId,o)&&Ga.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const n=M1(this.uri);if(n)switch(this.keyFormat){case en.WIDEVINE:if(this.pssh=n,!this.keyId){const o=yD(n.buffer);if(o.length){var r;const c=o[0];this.keyId=(r=c.kids)!=null&&r.length?c.kids[0]:null}}this.keyId||(this.keyId=$b(t));break;case en.PLAYREADY:{const o=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=xD(o,null,n),this.keyId=P1(n);break}default:{let o=n.subarray(0,16);if(o.length!==16){const c=new Uint8Array(16);c.set(o,16-o.length),o=c}this.keyId=o;break}}if(!this.keyId||this.keyId.byteLength!==16){let o;o=mI(t),o||(o=$b(t),o||(o=wo[this.uri])),o&&(this.keyId=o,Ga.setKeyIdForUri(this.uri,o))}return this}}function mI(i){const e=i?.[en.WIDEVINE];return e?e.keyId:null}function $b(i){const e=i?.[en.PLAYREADY];if(e){const t=M1(e.uri);if(t)return P1(t)}return null}function gI(i){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=i>>8*(15-t)&255;return e}const Gb=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Vb=/#EXT-X-MEDIA:(.*)/g,pI=/^#EXT(?:INF|-X-TARGETDURATION):/m,vm=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),xI=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class ji{static findGroup(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r.id===t)return r}}static resolve(e,t){return m0.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return pI.test(e)}static parseMasterPlaylist(e,t){const n=Pb(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},o=[];if(Gb.lastIndex=0,!e.startsWith("#EXTM3U"))return r.playlistParsingError=new Error("no EXTM3U delimiter"),r;let c;for(;(c=Gb.exec(e))!=null;)if(c[1]){var d;const u=new xs(c[1],r),m=gg(r,c[2]),g={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:ji.resolve(m,t)},x=u.decimalResolution("RESOLUTION");x&&(g.width=x.width,g.height=x.height),qb(u.CODECS,g);const y=u["SUPPLEMENTAL-CODECS"];y&&(g.supplemental={},qb(y,g.supplemental)),(d=g.unknownCodecs)!=null&&d.length||o.push(g),r.levels.push(g)}else if(c[3]){const u=c[3],m=c[4];switch(u){case"SESSION-DATA":{const g=new xs(m,r),x=g["DATA-ID"];x&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[x]=g);break}case"SESSION-KEY":{const g=Hb(m,t,r);g.encrypted&&g.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(g)):Xt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${m}"`);break}case"DEFINE":{{const g=new xs(m,r);Bb(r,g,t)}break}case"CONTENT-STEERING":{const g=new xs(m,r);r.contentSteering={uri:ji.resolve(g["SERVER-URI"],t),pathwayId:g["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=Kb(m);break}}}const h=o.length>0&&o.length<r.levels.length;return r.levels=h?o:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,n){let r;const o={},c=n.levels,d={AUDIO:c.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:c.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let h=0;for(Vb.lastIndex=0;(r=Vb.exec(e))!==null;){const u=new xs(r[1],n),m=u.TYPE;if(m){const g=d[m],x=o[m]||[];o[m]=x;const y=u.LANGUAGE,v=u["ASSOC-LANGUAGE"],S=u.CHANNELS,N=u.CHARACTERISTICS,A=u["INSTREAM-ID"],R={attrs:u,bitrate:0,id:h++,groupId:u["GROUP-ID"]||"",name:u.NAME||y||"",type:m,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:y,url:u.URI?ji.resolve(u.URI,t):""};if(v&&(R.assocLang=v),S&&(R.channels=S),N&&(R.characteristics=N),A&&(R.instreamId=A),g!=null&&g.length){const C=ji.findGroup(g,R.groupId)||g[0];zb(R,C,"audioCodec"),zb(R,C,"textCodec")}x.push(R)}}return o}static parseLevelPlaylist(e,t,n,r,o,c){var d;const h={url:t},u=new cI(t),m=u.fragments,g=[];let x=null,y=0,v=0,S=0,N=0,A=0,R=null,C=new gm(r,h),D,V,z,B=-1,I=!1,M=null,L;if(vm.lastIndex=0,u.m3u8=e,u.hasVariableRefs=Pb(e),((d=vm.exec(e))==null?void 0:d[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(D=vm.exec(e))!==null;){I&&(I=!1,C=new gm(r,h),C.playlistOffset=S,C.setStart(S),C.sn=y,C.cc=N,A&&(C.bitrate=A),C.level=n,x&&(C.initSegment=x,x.rawProgramDateTime&&(C.rawProgramDateTime=x.rawProgramDateTime,x.rawProgramDateTime=null),M&&(C.setByteRange(M),M=null)));const ne=D[1];if(ne){C.duration=parseFloat(ne);const se=(" "+D[2]).slice(1);C.title=se||null,C.tagList.push(se?["INF",ne,se]:["INF",ne])}else if(D[3]){if(Xe(C.duration)){C.playlistOffset=S,C.setStart(S),z&&Wb(C,z,u),C.sn=y,C.level=n,C.cc=N,m.push(C);const se=(" "+D[3]).slice(1);C.relurl=gg(u,se),xg(C,R,g),R=C,S+=C.duration,y++,v=0,I=!0}}else{if(D=D[0].match(xI),!D){Xt.warn("No matches on slow regex match for level playlist!");continue}for(V=1;V<D.length&&D[V]===void 0;V++);const se=(" "+D[V]).slice(1),X=(" "+D[V+1]).slice(1),ce=D[V+2]?(" "+D[V+2]).slice(1):null;switch(se){case"BYTERANGE":R?C.setByteRange(X,R):C.setByteRange(X);break;case"PROGRAM-DATE-TIME":C.rawProgramDateTime=X,C.tagList.push(["PROGRAM-DATE-TIME",X]),B===-1&&(B=m.length);break;case"PLAYLIST-TYPE":u.type&&Zi(u,se,D),u.type=X.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?Zi(u,se,D):m.length>0&&Qb(u,se,D),y=u.startSN=parseInt(X);break;case"SKIP":{u.skippedSegments&&Zi(u,se,D);const le=new xs(X,u),Y=le.decimalInteger("SKIPPED-SEGMENTS");if(Xe(Y)){u.skippedSegments+=Y;for(let H=Y;H--;)m.push(null);y+=Y}const K=le.enumeratedString("RECENTLY-REMOVED-DATERANGES");K&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(K.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&Zi(u,se,D),u.targetduration=Math.max(parseInt(X),1);break;case"VERSION":u.version!==null&&Zi(u,se,D),u.version=parseInt(X);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||Zi(u,se,D),u.live=!1;break;case"#":(X||ce)&&C.tagList.push(ce?[X,ce]:[X]);break;case"DISCONTINUITY":N++,C.tagList.push(["DIS"]);break;case"GAP":C.gap=!0,C.tagList.push([se]);break;case"BITRATE":C.tagList.push([se,X]),A=parseInt(X)*1e3,Xe(A)?C.bitrate=A:A=0;break;case"DATERANGE":{const le=new xs(X,u),Y=new D1(le,u.dateRanges[le.ID],u.dateRangeTagCount);u.dateRangeTagCount++,Y.isValid||u.skippedSegments?u.dateRanges[Y.id]=Y:Xt.warn(`Ignoring invalid DATERANGE tag: "${X}"`),C.tagList.push(["EXT-X-DATERANGE",X]);break}case"DEFINE":{{const le=new xs(X,u);"IMPORT"in le?nI(u,le,c):Bb(u,le,t)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?Zi(u,se,D):m.length>0&&Qb(u,se,D),u.startCC=N=parseInt(X);break;case"KEY":{const le=Hb(X,t,u);if(le.isSupported()){if(le.method==="NONE"){z=void 0;break}z||(z={});const Y=z[le.keyFormat];Y!=null&&Y.matches(le)||(Y&&(z=ns({},z)),z[le.keyFormat]=le)}else Xt.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${X}"`);break}case"START":u.startTimeOffset=Kb(X);break;case"MAP":{const le=new xs(X,u);if(C.duration){const Y=new gm(r,h);Yb(Y,le,n,z),x=Y,C.initSegment=x,x.rawProgramDateTime&&!C.rawProgramDateTime&&(C.rawProgramDateTime=x.rawProgramDateTime)}else{const Y=C.byteRangeEndOffset;if(Y){const K=C.byteRangeStartOffset;M=`${Y-K}@${K}`}else M=null;Yb(C,le,n,z),x=C,I=!0}x.cc=N;break}case"SERVER-CONTROL":{L&&Zi(u,se,D),L=new xs(X),u.canBlockReload=L.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=L.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&L.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=L.optionalFloat("PART-HOLD-BACK",0),u.holdBack=L.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&Zi(u,se,D);const le=new xs(X);u.partTarget=le.decimalFloatingPoint("PART-TARGET");break}case"PART":{let le=u.partList;le||(le=u.partList=[]);const Y=v>0?le[le.length-1]:void 0,K=v++,H=new xs(X,u),Q=new nD(H,C,h,K,Y);le.push(Q),C.duration+=Q.duration;break}case"PRELOAD-HINT":{const le=new xs(X,u);u.preloadHint=le;break}case"RENDITION-REPORT":{const le=new xs(X,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push(le);break}default:Xt.warn(`line parsed but not handled: ${D}`);break}}}R&&!R.relurl?(m.pop(),S-=R.duration,u.partList&&(u.fragmentHint=R)):u.partList&&(xg(C,R,g),C.cc=N,u.fragmentHint=C,z&&Wb(C,z,u)),u.targetduration||(u.playlistParsingError=new Error("Missing Target Duration"));const O=m.length,J=m[0],ie=m[O-1];if(S+=u.skippedSegments*u.targetduration,S>0&&O&&ie){u.averagetargetduration=S/O;const ne=ie.sn;u.endSN=ne!=="initSegment"?ne:0,u.live||(ie.endList=!0),B>0&&(vI(m,B),J&&g.unshift(J))}return u.fragmentHint&&(S+=u.fragmentHint.duration),u.totalduration=S,g.length&&u.dateRangeTagCount&&J&&B1(g,u),u.endCC=N,u}}function B1(i,e){let t=i.length;if(!t)if(e.hasProgramDateTime){const d=e.fragments[e.fragments.length-1];i.push(d),t++}else return;const n=i[t-1],r=e.live?1/0:e.totalduration,o=Object.keys(e.dateRanges);for(let d=o.length;d--;){const h=e.dateRanges[o[d]],u=h.startDate.getTime();h.tagAnchor=n.ref;for(let m=t;m--;){var c;if(((c=i[m])==null?void 0:c.sn)<e.startSN)break;const g=yI(e,u,i,m,r);if(g!==-1){h.tagAnchor=e.fragments[g].ref;break}}}}function yI(i,e,t,n,r){const o=t[n];if(o){const d=o.programDateTime;if(e>=d||n===0){var c;const h=(((c=t[n+1])==null?void 0:c.start)||r)-o.start;if(e<=d+h*1e3){const u=t[n].sn-i.startSN;if(u<0)return-1;const m=i.fragments;if(m.length>t.length){const x=(t[n+1]||m[m.length-1]).sn-i.startSN;for(let y=x;y>u;y--){const v=m[y].programDateTime;if(e>=v&&e<v+m[y].duration*1e3)return y}}return u}}}return-1}function Hb(i,e,t){var n,r;const o=new xs(i,t),c=(n=o.METHOD)!=null?n:"",d=o.URI,h=o.hexadecimalInteger("IV"),u=o.KEYFORMATVERSIONS,m=(r=o.KEYFORMAT)!=null?r:"identity";d&&o.IV&&!h&&Xt.error(`Invalid IV: ${o.IV}`);const g=d?ji.resolve(d,e):"",x=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Ga(c,g,m,x,h,o.KEYID)}function Kb(i){const t=new xs(i).decimalFloatingPoint("TIME-OFFSET");return Xe(t)?t:null}function qb(i,e){let t=(i||"").split(/[ ,]+/).filter(n=>n);["video","audio","text"].forEach(n=>{const r=t.filter(o=>x0(o,n));r.length&&(e[`${n}Codec`]=r.map(o=>o.split("/")[0]).join(","),t=t.filter(o=>r.indexOf(o)===-1))}),e.unknownCodecs=t}function zb(i,e,t){const n=e[t];n&&(i[t]=n)}function vI(i,e){let t=i[e];for(let n=e;n--;){const r=i[n];if(!r)return;r.programDateTime=t.programDateTime-r.duration*1e3,t=r}}function xg(i,e,t){i.rawProgramDateTime?t.push(i):e!=null&&e.programDateTime&&(i.programDateTime=e.endProgramDateTime)}function Yb(i,e,t,n){i.relurl=e.URI,e.BYTERANGE&&i.setByteRange(e.BYTERANGE),i.level=t,i.sn="initSegment",n&&(i.levelkeys=n),i.initSegment=null}function Wb(i,e,t){i.levelkeys=e;const{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&n.push(i)}function Zi(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Qb(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function bm(i,e){const t=e.startPTS;if(Xe(t)){let n=0,r;e.sn>i.sn?(n=t-i.start,r=i):(n=i.start-t,r=e),r.duration!==n&&r.setDuration(n)}else e.sn>i.sn?i.cc===e.cc&&i.minEndPTS?e.setStart(i.start+(i.minEndPTS-i.start)):e.setStart(i.start+i.duration):e.setStart(Math.max(i.start-e.duration,0))}function U1(i,e,t,n,r,o,c){n-t<=0&&(c.warn("Fragment should have a positive duration",e),n=t+e.duration,o=r+e.duration);let h=t,u=n;const m=e.startPTS,g=e.endPTS;if(Xe(m)){const A=Math.abs(m-t);i&&A>i.totalduration?c.warn(`media timestamps and playlist times differ by ${A}s for level ${e.level} ${i.url}`):Xe(e.deltaPTS)?e.deltaPTS=Math.max(A,e.deltaPTS):e.deltaPTS=A,h=Math.max(t,m),t=Math.min(t,m),r=e.startDTS!==void 0?Math.min(r,e.startDTS):r,u=Math.min(n,g),n=Math.max(n,g),o=e.endDTS!==void 0?Math.max(o,e.endDTS):o}const x=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(n-e.start),e.startPTS=t,e.maxStartPTS=h,e.startDTS=r,e.endPTS=n,e.minEndPTS=u,e.endDTS=o;const y=e.sn;if(!i||y<i.startSN||y>i.endSN)return 0;let v;const S=y-i.startSN,N=i.fragments;for(N[S]=e,v=S;v>0;v--)bm(N[v],N[v-1]);for(v=S;v<N.length-1;v++)bm(N[v],N[v+1]);return i.fragmentHint&&bm(N[N.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,x}function bI(i,e,t){if(i===e)return;let n=null;const r=i.fragments;for(let m=r.length-1;m>=0;m--){const g=r[m].initSegment;if(g){n=g;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;let o;EI(i,e,(m,g,x,y)=>{if((!e.startCC||e.skippedSegments)&&g.cc!==m.cc){const v=m.cc-g.cc;for(let S=x;S<y.length;S++)y[S].cc+=v;e.endCC=y[y.length-1].cc}Xe(m.startPTS)&&Xe(m.endPTS)&&(g.setStart(g.startPTS=m.startPTS),g.startDTS=m.startDTS,g.maxStartPTS=m.maxStartPTS,g.endPTS=m.endPTS,g.endDTS=m.endDTS,g.minEndPTS=m.minEndPTS,g.setDuration(m.endPTS-m.startPTS),g.duration&&(o=g),e.PTSKnown=e.alignedSliding=!0),m.hasStreams&&(g.elementaryStreams=m.elementaryStreams),g.loader=m.loader,m.hasStats&&(g.stats=m.stats),m.initSegment&&(g.initSegment=m.initSegment,n=m.initSegment)});const c=e.fragments,d=e.fragmentHint?c.concat(e.fragmentHint):c;if(n&&d.forEach(m=>{var g;m&&(!m.initSegment||m.initSegment.relurl===((g=n)==null?void 0:g.relurl))&&(m.initSegment=n)}),e.skippedSegments){if(e.deltaUpdateFailed=c.some(m=>!m),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let m=e.skippedSegments;m--;)c.shift();e.startSN=c[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=_I(i.dateRanges,e,t));const m=i.fragments.filter(g=>g.rawProgramDateTime);if(i.hasProgramDateTime&&!e.hasProgramDateTime)for(let g=1;g<d.length;g++)d[g].programDateTime===null&&xg(d[g],d[g-1],m);B1(m,e)}e.endCC=c[c.length-1].cc}if(!e.startCC){var h;const m=G1(i,e.startSN-1);e.startCC=(h=m?.cc)!=null?h:c[0].cc}SI(i.partList,e.partList,(m,g)=>{g.elementaryStreams=m.elementaryStreams,g.stats=m.stats}),o?U1(e,o,o.startPTS,o.endPTS,o.startDTS,o.endDTS,t):F1(i,e),c.length&&(e.totalduration=e.edge-c[0].start),e.driftStartTime=i.driftStartTime,e.driftStart=i.driftStart;const u=e.advancedDateTime;if(e.advanced&&u){const m=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=m),e.driftEndTime=u,e.driftEnd=m}else e.driftEndTime=i.driftEndTime,e.driftEnd=i.driftEnd,e.advancedDateTime=i.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=i.requestScheduled)}function _I(i,e,t){const{dateRanges:n,recentlyRemovedDateranges:r}=e,o=ns({},i);r&&r.forEach(h=>{delete o[h]});const d=Object.keys(o).length;return d?(Object.keys(n).forEach(h=>{const u=o[h],m=new D1(n[h].attr,u);m.isValid?(o[h]=m,u||(m.tagOrder+=d)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${os(n[h].attr)}"`)}),o):n}function SI(i,e,t){if(i&&e){let n=0;for(let r=0,o=i.length;r<=o;r++){const c=i[r],d=e[r+n];c&&d&&c.index===d.index&&c.fragment.sn===d.fragment.sn?t(c,d):n--}}}function EI(i,e,t){const n=e.skippedSegments,r=Math.max(i.startSN,e.startSN)-e.startSN,o=(i.fragmentHint?1:0)+(n?e.endSN:Math.min(i.endSN,e.endSN))-e.startSN,c=e.startSN-i.startSN,d=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,h=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments;for(let u=r;u<=o;u++){const m=h[c+u];let g=d[u];if(n&&!g&&m&&(g=e.fragments[u]=m),m&&g){t(m,g,u,d);const x=m.relurl,y=g.relurl;if(x&&NI(x,y)){e.playlistParsingError=Xb(`media sequence mismatch ${g.sn}:`,i,e,m,g);return}else if(m.cc!==g.cc){e.playlistParsingError=Xb(`discontinuity sequence mismatch (${m.cc}!=${g.cc})`,i,e,m,g);return}}}}function Xb(i,e,t,n,r){return new Error(`${i} ${r.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function F1(i,e,t=!0){const n=e.startSN+e.skippedSegments-i.startSN,r=i.fragments,o=n>=0;let c=0;if(o&&n<r.length)c=r[n].start;else if(o&&e.startSN===i.endSN+1)c=i.fragmentEnd;else if(o&&t)c=i.fragmentStart+n*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)c=i.fragmentStart;else return;yg(e,c)}function yg(i,e){if(e){const t=i.fragments;for(let n=i.skippedSegments;n<t.length;n++)t[n].addStart(e);i.fragmentHint&&i.fragmentHint.addStart(e)}}function $1(i,e=1/0){let t=1e3*i.targetduration;if(i.updated){const n=i.fragments;if(n.length&&t*4>e){const o=n[n.length-1].duration*1e3;o<t&&(t=o)}}else t/=2;return Math.round(t)}function G1(i,e,t){if(!i)return null;let n=i.fragments[e-i.startSN];return n||(n=i.fragmentHint,n&&n.sn===e)?n:e<i.startSN&&t&&t.sn===e?t:null}function Jb(i,e,t){return i?V1(i.partList,e,t):null}function V1(i,e,t){if(i)for(let n=i.length;n--;){const r=i[n];if(r.index===t&&r.fragment.sn===e)return r}return null}function H1(i){i.forEach((e,t)=>{var n;(n=e.details)==null||n.fragments.forEach(r=>{r.level=t,r.initSegment&&(r.initSegment.level=t)})})}function NI(i,e){return i!==e&&e?Zb(i)!==Zb(e):!1}function Zb(i){return i.replace(/\?[^?]*$/,"")}function ec(i,e){for(let n=0,r=i.length;n<r;n++){var t;if(((t=i[n])==null?void 0:t.cc)===e)return i[n]}return null}function wI(i,e){return!!(i&&e.startCC<i.endCC&&e.endCC>i.startCC)}function e_(i,e){const t=i.start+e;i.startPTS=t,i.setStart(t),i.endPTS=t+i.duration}function K1(i,e){const t=e.fragments;for(let n=0,r=t.length;n<r;n++)e_(t[n],i);e.fragmentHint&&e_(e.fragmentHint,i),e.alignedSliding=!0}function TI(i,e){i&&(q1(e,i),e.alignedSliding||Lu(e,i),!e.alignedSliding&&!e.skippedSegments&&F1(i,e,!1))}function q1(i,e){if(!wI(e,i))return;const t=Math.min(e.endCC,i.endCC),n=ec(e.fragments,t),r=ec(i.fragments,t);if(!n||!r)return;Xt.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const o=n.start-r.start;K1(o,i)}function Lu(i,e){if(!i.hasProgramDateTime||!e.hasProgramDateTime)return;const t=i.fragments,n=e.fragments;if(!t.length||!n.length)return;let r,o;const c=Math.min(e.endCC,i.endCC);e.startCC<c&&i.startCC<c&&(r=ec(n,c),o=ec(t,c)),(!r||!o)&&(r=n[Math.floor(n.length/2)],o=ec(t,r.cc)||t[Math.floor(t.length/2)]);const d=r.programDateTime,h=o.programDateTime;if(!d||!h)return;const u=(h-d)/1e3-(o.start-r.start);K1(u,i)}function hn(i,e,t){Sn(i,e,t),i.addEventListener(e,t)}function Sn(i,e,t){i.removeEventListener(e,t)}const AI={toString:function(i){let e="";const t=i.length;for(let n=0;n<t;n++)e+=`[${i.start(n).toFixed(3)}-${i.end(n).toFixed(3)}]`;return e}},Me={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class N0 extends L1{constructor(e,t,n,r,o){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=Me.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:c,fragCurrent:d,media:h,mediaBuffer:u,state:m}=this,g=h?h.currentTime:0,x=yt.bufferInfo(u||h,g,c.maxBufferHole),y=!x.len;if(this.log(`Media seeking to ${Xe(g)?g.toFixed(3):g}, state: ${m}, ${y?"out of":"in"} buffer`),this.state===Me.ENDED)this.resetLoadingState();else if(d){const v=c.maxFragLookUpTolerance,S=d.start-v,N=d.start+d.duration+v;if(y||N<x.start||S>x.end){const A=g>N;(g<S||A)&&(A&&d.loader&&(this.log(`Cancelling fragment load for seek (sn: ${d.sn})`),d.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(h){this.fragmentTracker.removeFragmentsInRange(g,1/0,this.playlistType,!0);const v=this.lastCurrentTime;if(g>v&&(this.lastCurrentTime=g),!this.loadingParts){const S=Math.max(x.end,g),N=this.shouldLoadParts(this.getLevelDetails(),S);N&&(this.log(`LL-Part loading ON after seeking to ${g.toFixed(2)} with buffer @${S.toFixed(2)}`),this.loadingParts=N)}}this.hls.hasEnoughToStart||(this.log(`Setting ${y?"startPosition":"nextLoadPosition"} to ${g} for seek without enough to start`),this.nextLoadPosition=g,y&&(this.startPosition=g)),y&&this.state===Me.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=o,this.hls=e,this.fragmentLoader=new tI(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new b0(e.config)}registerListeners(){const{hls:e}=this;e.on(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(F.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(F.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===Me.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Me.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,r=this.config.timelineOffset||0;if(n<=r)return!1;const o=e.buffered;this.config.maxBufferHole&&o&&o.length>1&&(e=yt.bufferedInfo(o,e.start,0));const c=e.nextStart;if(c&&c>r&&c<t.edge||this.media.currentTime<e.start)return!1;const h=t.partList;if(h!=null&&h.length){const m=h[h.length-1];return yt.isBuffered(this.media,m.start+m.duration/2)}const u=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;hn(n,"seeking",this.onMediaSeeking),hn(n,"ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===Me.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Sn(r,"seeking",this.onMediaSeeking),Sn(r,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=Me.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const r=o=>{const c=o.frag;if(this.fragContextChanged(c)){this.warn(`${c.type} sn: ${c.sn}${o.part?" part: "+o.part.index:""} of ${this.fragInfo(c,!1,o.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(c);return}c.stats.chunkCount++,this._handleFragmentLoadProgress(o)};this._doFragLoad(e,t,n,r).then(o=>{if(!o)return;const c=this.state,d=o.frag;if(this.fragContextChanged(d)){(c===Me.FRAG_LOADING||!this.fragCurrent&&c===Me.PARSING)&&(this.fragmentTracker.removeFragment(d),this.state=Me.IDLE);return}"payload"in o&&(this.log(`Loaded ${d.type} sn: ${d.sn} of ${this.playlistLabel()} ${d.level}`),this.hls.trigger(F.FRAG_LOADED,o)),this._handleFragmentLoadComplete(o)}).catch(o=>{this.state===Me.STOPPED||this.state===Me.ERROR||(this.warn(`Frag error: ${o?.message||o}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===Fs.APPENDING){const o=e.type,c=this.getFwdBufferInfo(this.mediaBuffer,o),d=Math.max(e.duration,c?c.len:this.config.maxBufferLength),h=this.backtrackFragment;((h?e.sn-h.sn:0)===1||this.reduceMaxBufferLength(d,e.duration))&&n.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===Fs.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:n};this.hls.trigger(F.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{const r=n?.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:r}=this,{frag:o,payload:c}=n,d=o.decryptdata;if(c&&c.byteLength>0&&d!=null&&d.key&&d.iv&&Po(d.method)){const h=self.performance.now();return this.decrypter.decrypt(new Uint8Array(c),d.key.buffer,d.iv.buffer,S0(d.method)).catch(u=>{throw r.trigger(F.ERROR,{type:tt.MEDIA_ERROR,details:_e.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:o}),u}).then(u=>{const m=self.performance.now();return r.trigger(F.FRAG_DECRYPTED,{frag:o,payload:u,stats:{tstart:h,tdecrypt:m}}),n.payload=u,this.completeInitSegmentLoad(n)})}return this.completeInitSegmentLoad(n)}).catch(n=>{this.state===Me.STOPPED||this.state===Me.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==Me.STOPPED&&(this.state=Me.IDLE),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var n,r;const o=e.tracks;if(o&&!t.encrypted&&((n=o.audio)!=null&&n.encrypted||(r=o.video)!=null&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const c=this.media,d=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${c?"attached mediaKeys: "+c.mediaKeys:"detached"})`);return this.warn(d.message),!c||c.mediaKeys?!1:(this.hls.trigger(F.ERROR,{type:tt.KEY_SYSTEM_ERROR,details:_e.KEY_SYSTEM_NO_KEYS,fatal:!1,error:d,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${n?AI.toString(yt.getBuffered(n)):"(detached)"})`),Cs(e)){var r;if(e.type!==Je.SUBTITLE){const c=e.elementaryStreams;if(!Object.keys(c).some(d=>!!c[d])){this.state=Me.IDLE;return}}const o=(r=this.levels)==null?void 0:r[e.level];o!=null&&o.fragmentError&&(this.log(`Resetting level fragment error count of ${o.fragmentError} on frag buffered`),o.fragmentError=0)}this.state=Me.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:r,partsLoaded:o}=e,c=!o||o.length===0||o.some(h=>!h),d=new _0(n.level,n.sn,n.stats.chunkCount+1,0,r?r.index:-1,!c);t.flush(d)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,r){var o;this.fragCurrent=e;const c=t.details;if(!this.levels||!c)throw new Error(`frag load aborted, missing level${c?"":" detail"}s`);let d=null;if(e.encrypted&&!((o=e.decryptdata)!=null&&o.key)){if(this.log(`Loading key for ${e.sn} of [${c.startSN}-${c.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=Me.KEY_LOADING,this.fragCurrent=e,d=this.keyLoader.load(e).then(x=>{if(!this.fragContextChanged(x.frag))return this.hls.trigger(F.KEY_LOADED,x),this.state===Me.KEY_LOADING&&(this.state=Me.IDLE),x}),this.hls.trigger(F.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(d=this.keyLoader.loadClear(e,c.encryptedFragments,this.startFragRequested),d&&this.log("[eme] blocking frag load until media-keys acquired"));const h=this.fragPrevious;if(Cs(e)&&(!h||e.sn!==h.sn)){const x=this.shouldLoadParts(t.details,e.end);x!==this.loadingParts&&(this.log(`LL-Part loading ${x?"ON":"OFF"} loading sn ${h?.sn}->${e.sn}`),this.loadingParts=x)}if(n=Math.max(e.start,n||0),this.loadingParts&&Cs(e)){const x=c.partList;if(x&&r){n>c.fragmentEnd&&c.fragmentHint&&(e=c.fragmentHint);const y=this.getNextPart(x,e,n);if(y>-1){const v=x[y];e=this.fragCurrent=v.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${v.index} (${y}/${x.length-1}) of ${this.fragInfo(e,!1,v)}) cc: ${e.cc} [${c.startSN}-${c.endSN}], target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=v.start+v.duration,this.state=Me.FRAG_LOADING;let S;return d?S=d.then(N=>!N||this.fragContextChanged(N.frag)?null:this.doFragPartsLoad(e,v,t,r)).catch(N=>this.handleFragLoadError(N)):S=this.doFragPartsLoad(e,v,t,r).catch(N=>this.handleFragLoadError(N)),this.hls.trigger(F.FRAG_LOADING,{frag:e,part:v,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):S}else if(!e.url||this.loadedEndOfParts(x,n))return Promise.resolve(null)}}if(Cs(e)&&this.loadingParts){var u;this.log(`LL-Part loading OFF after next part miss @${n.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(u=c.partList)==null?void 0:u.filter(x=>x.loaded).map(x=>`[${x.start}-${x.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+c.startSN+"-"+c.endSN+"]"}, target: ${parseFloat(n.toFixed(3))}`),Xe(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Me.FRAG_LOADING;const m=this.config.progressive&&e.type!==Je.SUBTITLE;let g;return m&&d?g=d.then(x=>!x||this.fragContextChanged(x.frag)?null:this.fragmentLoader.load(e,r)).catch(x=>this.handleFragLoadError(x)):g=Promise.all([this.fragmentLoader.load(e,m?r:void 0),d]).then(([x])=>(!m&&r&&r(x),x)).catch(x=>this.handleFragLoadError(x)),this.hls.trigger(F.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):g}doFragPartsLoad(e,t,n,r){return new Promise((o,c)=>{var d;const h=[],u=(d=n.details)==null?void 0:d.partList,m=g=>{this.fragmentLoader.loadPart(e,g,r).then(x=>{h[g.index]=x;const y=x.part;this.hls.trigger(F.FRAG_LOADED,x);const v=Jb(n.details,e.sn,g.index+1)||V1(u,e.sn,g.index+1);if(v)m(v);else return o({frag:e,part:y,partsLoaded:h})}).catch(c)};m(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===_e.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===tt.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(F.ERROR,t)}else this.hls.trigger(F.ERROR,{type:tt.OTHER_ERROR,details:_e.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==Me.PARSING){!this.fragCurrent&&this.state!==Me.STOPPED&&this.state!==Me.ERROR&&(this.state=Me.IDLE);return}const{frag:n,part:r,level:o}=t,c=self.performance.now();n.stats.parsing.end=c,r&&(r.stats.parsing.end=c);const d=this.getLevelDetails(),u=d&&n.sn>d.endSN||this.shouldLoadParts(d,n.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${n.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(n,r,o,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const o=e.partList[0];if(o.fragment.type===Je.SUBTITLE)return!1;const c=o.end+(((n=e.fragmentHint)==null?void 0:n.duration)||0);if(t>=c){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>o.start-o.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:r,sn:o,part:c}=e;if(!(t!=null&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${o} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const d=t[r],h=d.details,u=c>-1?Jb(h,o,c):null,m=u?u.fragment:G1(h,o,n);return m?(n&&n!==m&&(m.stats=n.stats),{frag:m,part:u,level:d}):null}bufferFragmentData(e,t,n,r,o){if(this.state!==Me.PARSING)return;const{data1:c,data2:d}=e;let h=c;if(d&&(h=ni(c,d)),!h.length)return;const u=this.initPTS[t.cc],m=u?-u.baseTime/u.timescale:void 0,g={type:e.type,frag:t,part:n,chunkMeta:r,offset:m,parent:t.type,data:h};if(this.hls.trigger(F.BUFFER_APPENDING,g),e.dropped&&e.independent&&!n){if(o)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!yt.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const n=t.currentTime,r=yt.bufferInfo(t,n,0),o=e.duration,c=Math.min(this.config.maxFragLookUpTolerance*2,o*.25),d=Math.max(Math.min(e.start-c,r.end-c),n+c);e.start-d>c&&this.flushMainBuffer(d,e.start)}getFwdBufferInfo(e,t){var n;const r=this.getLoadPosition();if(!Xe(r))return null;const c=this.lastCurrentTime>r||(n=this.media)!=null&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,c)}getFwdBufferInfoAtPos(e,t,n,r){const o=yt.bufferInfo(e,t,r);if(o.len===0&&o.nextStart!==void 0){const c=this.fragmentTracker.getBufferedFrag(t,n);if(c&&(o.nextStart<=c.end||c.gap)){const d=Math.max(Math.min(o.nextStart,c.end)-t,r);return yt.bufferInfo(e,t,d)}}return o}getMaxBufferLength(e){const{config:t}=this;let n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,r=Math.max(Math.min(e-t,n.maxBufferLength),t),o=Math.max(e-t*3,n.maxMaxBufferLength/2,r);return o>=r?(n.maxMaxBufferLength=o,this.warn(`Reduce max buffer length to ${o}s`),!0):!1}getAppendedFrag(e,t=Je.MAIN){const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,r=n.length;if(!r)return null;const{config:o}=this,c=n[0].start,d=o.lowLatencyMode&&!!t.partList;let h=null;if(t.live){const g=o.initialLiveManifestSize;if(r<g)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${g})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<c){var u;d&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),h=this.getInitialLiveFragment(t);const x=this.hls.startPosition,y=this.hls.liveSyncPosition,v=h?(x!==-1&&x>=c?x:y)||h.start:e;this.log(`Setting startPosition to ${v} to match start frag at live edge. mainStart: ${x} liveSyncPosition: ${y} frag.start: ${(u=h)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=v}}else e<=c&&(h=n[0]);if(!h){const g=this.loadingParts?t.partEnd:t.fragmentEnd;h=this.getFragmentAtPosition(e,g,t)}let m=this.filterReplacedPrimary(h,t);if(!m&&h){const g=h.sn-t.startSN;m=this.filterReplacedPrimary(n[g+1]||null,t)}return this.mapToInitFragWhenRequired(m)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===Fs.OK||n===Fs.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,r,o){let c=null;if(e.gap&&(c=this.getNextFragment(this.nextLoadPosition,t),c&&!c.gap&&n.nextStart)){const d=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,r,0);if(d!==null&&n.len+d.len>=o){const h=c.sn;return this.loopSn!==h&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${h}`),this.loopSn=h),null}}return this.loopSn=void 0,c}get primaryPrefetch(){if(t_(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(t_(this.config)&&e.type!==Je.SUBTITLE){const n=this.hls.interstitialsManager,r=n?.bufferingItem;if(r){const c=r.event;if(c){if(c.appendInPlace||Math.abs(e.start-r.start)>1||r.start===0)return null}else if(e.end<=r.start&&t?.live===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}const o=n?.playerQueue;if(o)for(let c=o.length;c--;){const d=o[c].interstitial;if(d.appendInPlace&&e.start>=d.startTime&&e.end<=d.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let r=-1,o=!1,c=!0;for(let d=0,h=e.length;d<h;d++){const u=e[d];if(c=c&&!u.independent,r>-1&&n<u.start)break;const m=u.loaded;m?r=-1:(o||(u.independent||c)&&u.fragment===t)&&(u.fragment!==t&&this.warn(`Need buffer at ${n} but next unloaded part starts at ${u.start}`),r=d),o=m}return r}loadedEndOfParts(e,t){let n;for(let r=e.length;r--;){if(n=e[r],!n.loaded)return!1;if(t>n.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let r=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),r=VD(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const o=n.sn+1;if(o>=e.startSN&&o<=e.endSN){const c=t[o-e.startSN];n.cc===c.cc&&(r=c,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=j1(e,n.cc,n.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const o=this.hls.liveSyncPosition;o!==null&&(r=this.getFragmentAtPosition(o,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,n){const{config:r}=this;let{fragPrevious:o}=this,{fragments:c,endSN:d}=n;const{fragmentHint:h}=n,{maxFragLookUpTolerance:u}=r,m=n.partList,g=!!(this.loadingParts&&m!=null&&m.length&&h);g&&!this.bitrateTest&&m[m.length-1].fragment.sn===h.sn&&(c=c.concat(h),d=h.sn);let x;if(e<t){var y;const S=e<this.lastCurrentTime||e>t-u||(y=this.media)!=null&&y.paused||!this.startFragRequested?0:u;x=Mr(o,c,e,S)}else x=c[c.length-1];if(x){const v=x.sn-n.startSN,S=this.fragmentTracker.getState(x);if((S===Fs.OK||S===Fs.PARTIAL&&x.gap)&&(o=x),o&&x.sn===o.sn&&(!g||m[0].fragment.sn>x.sn||!n.live)&&x.level===o.level){const A=c[v+1];x.sn<d&&this.fragmentTracker.getState(A)!==Fs.OK?x=A:x=null}}return x}alignPlaylists(e,t,n){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const o=e.fragmentStart,c=!t,d=e.alignedSliding&&Xe(o);if(c||!d&&!o){TI(n,e);const h=e.fragmentStart;return this.log(`Live playlist sliding: ${h.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),h}return o}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const r=this.timelineOffset;if(n===-1){const o=this.startTimeOffset!==null,c=o?this.startTimeOffset:e.startTimeOffset;c!==null&&Xe(c)?(n=t+c,c<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Setting startPosition to ${n} for start time offset ${c} found in ${o?"multivariant":"media"} playlist`),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${n}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+r}this.nextLoadPosition=n+r}getLoadPosition(){var e;const{media:t}=this;let n=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Cs(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==Me.FRAG_LOADING_WAITING_RETRY)&&(this.state=Me.IDLE)}onFragmentOrKeyLoadError(e,t){var n;if(t.chunkMeta&&!t.frag){const A=this.getCurrentContext(t.chunkMeta);A&&(t.frag=A.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var o;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(o=this.fragCurrent)==null?void 0:o.url}`);return}const c=t.details===_e.FRAG_GAP;c&&this.fragmentTracker.fragBuffered(r,!0);const d=t.errorAction;if(!d){this.state=Me.ERROR;return}const{action:h,flags:u,retryCount:m=0,retryConfig:g}=d,x=!!g,y=x&&h===Js.RetryRequest,v=x&&!d.resolved&&u===Pn.MoveAllAlternatesMatchingHost,S=(n=this.hls.latestLevelDetails)==null?void 0:n.live;if(!y&&v&&Cs(r)&&!r.endList&&S&&!R1(t))this.resetFragmentErrors(e),this.treatAsGap(r),d.resolved=!0;else if((y||v)&&m<g.maxNumRetry){var N;const A=mg((N=t.response)==null?void 0:N.code),R=v0(g,m);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+R,this.state=Me.FRAG_LOADING_WAITING_RETRY,d.resolved=!0,A){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${m+1}/${g.maxNumRetry} in ${R}ms`)}else if(g)if(this.resetFragmentErrors(e),m<g.maxNumRetry)!c&&h!==Js.RemoveAlternatePermanently&&(d.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${m})`);return}else h===Js.SendAlternateToPenaltyBox?this.state=Me.WAITING_LEVEL:this.state=Me.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!mg(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=Me.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===Me.PARSING||this.state===Me.PARSED){const t=e.frag,n=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,n),o=r&&r.len>.5;o&&this.reduceMaxBufferLength(r.len,t?.duration||10);const c=!o;return c&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${n} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),c}return!1}resetFragmentErrors(e){e===Je.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==Me.STOPPED&&(this.state=Me.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const r=yt.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,n),this.state===Me.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==Me.STOPPED&&(this.state=Me.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,r){const o=n.details;if(!o){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((h,u)=>{const m=e.elementaryStreams[u];if(m){const g=m.endPTS-m.startPTS;if(g<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${g})`),h||!1;const x=r?0:U1(o,e,m.startPTS,m.endPTS,m.startDTS,m.endDTS,this);return this.hls.trigger(F.LEVEL_PTS_UPDATED,{details:o,level:n,drift:x,type:u,frag:e,start:m.startPTS,end:m.endPTS}),!0}return h},!1)){var d;const h=((d=this.transmuxer)==null?void 0:d.error)===null;if((n.fragmentError===0||h&&(n.fragmentError<2||e.endList))&&this.treatAsGap(e,n),h){const u=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(u.message),this.hls.trigger(F.ERROR,{type:tt.MEDIA_ERROR,details:_e.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=Me.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(F.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Je.MAIN?"level":"track"}fragInfo(e,t=!0,n){var r,o;return`${this.playlistLabel()} ${e.level} (${n?"part":"frag"}:[${((r=t&&!n?e.startPTS:(n||e).start)!=null?r:NaN).toFixed(3)}-${((o=t&&!n?e.endPTS:(n||e).end)!=null?o:NaN).toFixed(3)}]${n&&e.type==="main"?"INDEPENDENT="+(n.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function t_(i){return!!i.interstitialsController&&i.enableInterstitialPlayback!==!1}class z1{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;if(e.length)e.length===1?n=e[0]:n=jI(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function jI(i,e){const t=new Uint8Array(e);let n=0;for(let r=0;r<i.length;r++){const o=i[r];t.set(o,n),n+=o.length}return t}var _m={exports:{}},s_;function CI(){return s_||(s_=1,(function(i){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function r(h,u,m){this.fn=h,this.context=u,this.once=m||!1}function o(h,u,m,g,x){if(typeof m!="function")throw new TypeError("The listener must be a function");var y=new r(m,g||h,x),v=t?t+u:u;return h._events[v]?h._events[v].fn?h._events[v]=[h._events[v],y]:h._events[v].push(y):(h._events[v]=y,h._eventsCount++),h}function c(h,u){--h._eventsCount===0?h._events=new n:delete h._events[u]}function d(){this._events=new n,this._eventsCount=0}d.prototype.eventNames=function(){var u=[],m,g;if(this._eventsCount===0)return u;for(g in m=this._events)e.call(m,g)&&u.push(t?g.slice(1):g);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(m)):u},d.prototype.listeners=function(u){var m=t?t+u:u,g=this._events[m];if(!g)return[];if(g.fn)return[g.fn];for(var x=0,y=g.length,v=new Array(y);x<y;x++)v[x]=g[x].fn;return v},d.prototype.listenerCount=function(u){var m=t?t+u:u,g=this._events[m];return g?g.fn?1:g.length:0},d.prototype.emit=function(u,m,g,x,y,v){var S=t?t+u:u;if(!this._events[S])return!1;var N=this._events[S],A=arguments.length,R,C;if(N.fn){switch(N.once&&this.removeListener(u,N.fn,void 0,!0),A){case 1:return N.fn.call(N.context),!0;case 2:return N.fn.call(N.context,m),!0;case 3:return N.fn.call(N.context,m,g),!0;case 4:return N.fn.call(N.context,m,g,x),!0;case 5:return N.fn.call(N.context,m,g,x,y),!0;case 6:return N.fn.call(N.context,m,g,x,y,v),!0}for(C=1,R=new Array(A-1);C<A;C++)R[C-1]=arguments[C];N.fn.apply(N.context,R)}else{var D=N.length,V;for(C=0;C<D;C++)switch(N[C].once&&this.removeListener(u,N[C].fn,void 0,!0),A){case 1:N[C].fn.call(N[C].context);break;case 2:N[C].fn.call(N[C].context,m);break;case 3:N[C].fn.call(N[C].context,m,g);break;case 4:N[C].fn.call(N[C].context,m,g,x);break;default:if(!R)for(V=1,R=new Array(A-1);V<A;V++)R[V-1]=arguments[V];N[C].fn.apply(N[C].context,R)}}return!0},d.prototype.on=function(u,m,g){return o(this,u,m,g,!1)},d.prototype.once=function(u,m,g){return o(this,u,m,g,!0)},d.prototype.removeListener=function(u,m,g,x){var y=t?t+u:u;if(!this._events[y])return this;if(!m)return c(this,y),this;var v=this._events[y];if(v.fn)v.fn===m&&(!x||v.once)&&(!g||v.context===g)&&c(this,y);else{for(var S=0,N=[],A=v.length;S<A;S++)(v[S].fn!==m||x&&!v[S].once||g&&v[S].context!==g)&&N.push(v[S]);N.length?this._events[y]=N.length===1?N[0]:N:c(this,y)}return this},d.prototype.removeAllListeners=function(u){var m;return u?(m=t?t+u:u,this._events[m]&&c(this,m)):(this._events=new n,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=t,d.EventEmitter=d,i.exports=d})(_m)),_m.exports}var RI=CI(),w0=tD(RI);const lc="1.6.15",Vo={};function LI(){return typeof __HLS_WORKER_BUNDLE__=="function"}function kI(){const i=Vo[lc];if(i)return i.clientCount++,i;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),r={worker:new self.Worker(t),objectURL:t,clientCount:1};return Vo[lc]=r,r}function DI(i){const e=Vo[i];if(e)return e.clientCount++,e;const t=new self.URL(i,self.location.href).href,r={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Vo[i]=r,r}function II(i){const e=Vo[i||lc];if(e&&e.clientCount--===1){const{worker:n,objectURL:r}=e;delete Vo[i||lc],r&&self.URL.revokeObjectURL(r),n.terminate()}}function Y1(i,e){return e+10<=i.length&&i[e]===51&&i[e+1]===68&&i[e+2]===73&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function T0(i,e){return e+10<=i.length&&i[e]===73&&i[e+1]===68&&i[e+2]===51&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function Qu(i,e){let t=0;return t=(i[e]&127)<<21,t|=(i[e+1]&127)<<14,t|=(i[e+2]&127)<<7,t|=i[e+3]&127,t}function cc(i,e){const t=e;let n=0;for(;T0(i,e);){n+=10;const r=Qu(i,e+6);n+=r,Y1(i,e+10)&&(n+=10),e+=n}if(n>0)return i.subarray(t,t+n)}function MI(i,e,t,n){const r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],o=e[t+2],c=o>>2&15;if(c>12){const y=new Error(`invalid ADTS sampling index:${c}`);i.emit(F.ERROR,F.ERROR,{type:tt.MEDIA_ERROR,details:_e.FRAG_PARSING_ERROR,fatal:!0,error:y,reason:y.message});return}const d=(o>>6&3)+1,h=e[t+3]>>6&3|(o&1)<<2,u="mp4a.40."+d,m=r[c];let g=c;(d===5||d===29)&&(g-=3);const x=[d<<3|(g&14)>>1,(g&1)<<7|h<<3];return Xt.log(`manifest codec:${n}, parsed codec:${u}, channels:${h}, rate:${m} (ADTS object type:${d} sampling index:${c})`),{config:x,samplerate:m,channelCount:h,codec:u,parsedCodec:u,manifestCodec:n}}function W1(i,e){return i[e]===255&&(i[e+1]&246)===240}function Q1(i,e){return i[e+1]&1?7:9}function A0(i,e){return(i[e+3]&3)<<11|i[e+4]<<3|(i[e+5]&224)>>>5}function OI(i,e){return e+5<i.length}function ku(i,e){return e+1<i.length&&W1(i,e)}function PI(i,e){return OI(i,e)&&W1(i,e)&&A0(i,e)<=i.length-e}function BI(i,e){if(ku(i,e)){const t=Q1(i,e);if(e+t>=i.length)return!1;const n=A0(i,e);if(n<=t)return!1;const r=e+n;return r===i.length||ku(i,r)}return!1}function X1(i,e,t,n,r){if(!i.samplerate){const o=MI(e,t,n,r);if(!o)return;ns(i,o)}}function J1(i){return 1024*9e4/i}function UI(i,e){const t=Q1(i,e);if(e+t<=i.length){const n=A0(i,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function Z1(i,e,t,n,r){const o=J1(i.samplerate),c=n+r*o,d=UI(e,t);let h;if(d){const{frameLength:g,headerLength:x}=d,y=x+g,v=Math.max(0,t+y-e.length);v?(h=new Uint8Array(y-x),h.set(e.subarray(t+x,e.length),0)):h=e.subarray(t+x,t+y);const S={unit:h,pts:c};return v||i.samples.push(S),{sample:S,length:y,missing:v}}const u=e.length-t;return h=new Uint8Array(u),h.set(e.subarray(t,e.length),0),{sample:{unit:h,pts:c},length:u,missing:-1}}function FI(i,e){return T0(i,e)&&Qu(i,e+6)+10<=i.length-e}function $I(i){return i instanceof ArrayBuffer?i:i.byteOffset==0&&i.byteLength==i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer}function Sm(i,e=0,t=1/0){return GI(i,e,t,Uint8Array)}function GI(i,e,t,n){const r=VI(i);let o=1;"BYTES_PER_ELEMENT"in n&&(o=n.BYTES_PER_ELEMENT);const c=HI(i)?i.byteOffset:0,d=(c+i.byteLength)/o,h=(c+e)/o,u=Math.floor(Math.max(0,Math.min(h,d))),m=Math.floor(Math.min(u+Math.max(t,0),d));return new n(r,u,m-u)}function VI(i){return i instanceof ArrayBuffer?i:i.buffer}function HI(i){return i&&i.buffer instanceof ArrayBuffer&&i.byteLength!==void 0&&i.byteOffset!==void 0}function KI(i){const e={key:i.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(i.size<2)return;if(i.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const n=i.data.subarray(1).indexOf(0);if(n===-1)return;const r=Gn(Sm(i.data,1,n)),o=i.data[2+n],c=i.data.subarray(3+n).indexOf(0);if(c===-1)return;const d=Gn(Sm(i.data,3+n,c));let h;return r==="-->"?h=Gn(Sm(i.data,4+n+c)):h=$I(i.data.subarray(4+n+c)),e.mimeType=r,e.pictureType=o,e.description=d,e.data=h,e}function qI(i){if(i.size<2)return;const e=Gn(i.data,!0),t=new Uint8Array(i.data.subarray(e.length+1));return{key:i.type,info:e,data:t.buffer}}function zI(i){if(i.size<2)return;if(i.type==="TXXX"){let t=1;const n=Gn(i.data.subarray(t),!0);t+=n.length+1;const r=Gn(i.data.subarray(t));return{key:i.type,info:n,data:r}}const e=Gn(i.data.subarray(1));return{key:i.type,info:"",data:e}}function YI(i){if(i.type==="WXXX"){if(i.size<2)return;let t=1;const n=Gn(i.data.subarray(t),!0);t+=n.length+1;const r=Gn(i.data.subarray(t));return{key:i.type,info:n,data:r}}const e=Gn(i.data);return{key:i.type,info:"",data:e}}function WI(i){return i.type==="PRIV"?qI(i):i.type[0]==="W"?YI(i):i.type==="APIC"?KI(i):zI(i)}function QI(i){const e=String.fromCharCode(i[0],i[1],i[2],i[3]),t=Qu(i,4),n=10;return{type:e,size:t,data:i.subarray(n,n+t)}}const Gd=10,XI=10;function eE(i){let e=0;const t=[];for(;T0(i,e);){const n=Qu(i,e+6);i[e+5]>>6&1&&(e+=Gd),e+=Gd;const r=e+n;for(;e+XI<r;){const o=QI(i.subarray(e)),c=WI(o);c&&t.push(c),e+=o.size+Gd}Y1(i,e)&&(e+=Gd)}return t}function tE(i){return i&&i.key==="PRIV"&&i.info==="com.apple.streaming.transportStreamTimestamp"}function JI(i){if(i.data.byteLength===8){const e=new Uint8Array(i.data),t=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}}function j0(i){const e=eE(i);for(let t=0;t<e.length;t++){const n=e[t];if(tE(n))return JI(n)}}let Un=(function(i){return i.audioId3="org.id3",i.dateRange="com.apple.quicktime.HLS",i.emsg="https://aomedia.org/emsg/ID3",i.misbklv="urn:misb:KLV:bin:1910.1",i})({});function Ti(i="",e=9e4){return{type:i,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class C0{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=ni(this.cachedData,e),this.cachedData=null);let n=cc(e,0),r=n?n.length:0,o;const c=this._audioTrack,d=this._id3Track,h=n?j0(n):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&Xe(h))&&(this.basePTS=ZI(h,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&d.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Un.audioId3,duration:Number.POSITIVE_INFINITY});r<u;){if(this.canParse(e,r)){const m=this.appendFrame(c,e,r);m?(this.frameIndex++,this.lastPTS=m.sample.pts,r+=m.length,o=r):r=u}else FI(e,r)?(n=cc(e,r),d.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Un.audioId3,duration:Number.POSITIVE_INFINITY}),r+=n.length,o=r):r++;if(r===u&&o!==u){const m=e.slice(o);this.cachedData?this.cachedData=ni(this.cachedData,m):this.cachedData=m}}return{audioTrack:c,videoTrack:Ti(),id3Track:d,textTrack:Ti()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Ti(),id3Track:this._id3Track,textTrack:Ti()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const ZI=(i,e,t)=>{if(Xe(i))return i*90;const n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};let Vd=null;const eM=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],tM=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],sM=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],nM=[0,1,1,4];function sE(i,e,t,n,r){if(t+24>e.length)return;const o=nE(e,t);if(o&&t+o.frameLength<=e.length){const c=o.samplesPerFrame*9e4/o.sampleRate,d=n+r*c,h={unit:e.subarray(t,t+o.frameLength),pts:d,dts:d};return i.config=[],i.channelCount=o.channelCount,i.samplerate=o.sampleRate,i.samples.push(h),{sample:h,length:o.frameLength,missing:0}}}function nE(i,e){const t=i[e+1]>>3&3,n=i[e+1]>>1&3,r=i[e+2]>>4&15,o=i[e+2]>>2&3;if(t!==1&&r!==0&&r!==15&&o!==3){const c=i[e+2]>>1&1,d=i[e+3]>>6,h=t===3?3-n:n===3?3:4,u=eM[h*14+r-1]*1e3,g=tM[(t===3?0:t===2?1:2)*3+o],x=d===3?1:2,y=sM[t][n],v=nM[n],S=y*8*v,N=Math.floor(y*u/g+c)*v;if(Vd===null){const C=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Vd=C?parseInt(C[1]):0}return!!Vd&&Vd<=87&&n===2&&u>=224e3&&d===0&&(i[e+3]=i[e+3]|128),{sampleRate:g,channelCount:x,frameLength:N,samplesPerFrame:S}}}function R0(i,e){return i[e]===255&&(i[e+1]&224)===224&&(i[e+1]&6)!==0}function iE(i,e){return e+1<i.length&&R0(i,e)}function iM(i,e){return R0(i,e)&&4<=i.length-e}function aE(i,e){if(e+1<i.length&&R0(i,e)){const n=nE(i,e);let r=4;n!=null&&n.frameLength&&(r=n.frameLength);const o=e+r;return o===i.length||iE(i,o)}return!1}class aM extends C0{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=cc(e,0);let r=n?.length||0;if(aE(e,r))return!1;for(let o=e.length;r<o;r++)if(BI(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return PI(e,t)}appendFrame(e,t,n){X1(e,this.observer,t,n,e.manifestCodec);const r=Z1(e,t,n,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const rE=(i,e)=>{let t=0,n=5;e+=n;const r=new Uint32Array(1),o=new Uint32Array(1),c=new Uint8Array(1);for(;n>0;){c[0]=i[e];const d=Math.min(n,8),h=8-d;o[0]=4278190080>>>24+h<<h,r[0]=(c[0]&o[0])>>h,t=t?t<<d|r[0]:r[0],e+=1,n-=d}return t};class rM extends C0{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const r=oE(e,t,n,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;const t=cc(e,0);if(!t)return!1;const n=t.length;return e[n]===11&&e[n+1]===119&&j0(t)!==void 0&&rE(e,n)<16}}function oE(i,e,t,n,r){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const o=e[t+4]>>6;if(o>=3)return-1;const d=[48e3,44100,32e3][o],h=e[t+4]&63,m=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][h*3+o]*2;if(t+m>e.length)return-1;const g=e[t+6]>>5;let x=0;g===2?x+=2:(g&1&&g!==1&&(x+=2),g&4&&(x+=2));const y=(e[t+6]<<8|e[t+7])>>12-x&1,S=[2,1,2,3,3,4,4,5][g]+y,N=e[t+5]>>3,A=e[t+5]&7,R=new Uint8Array([o<<6|N<<1|A>>2,(A&3)<<6|g<<3|y<<2|h>>4,h<<4&224]),C=1536/d*9e4,D=n+r*C,V=e.subarray(t,t+m);return i.config=R,i.channelCount=S,i.samplerate=d,i.samples.push({unit:V,pts:D}),m}class oM extends C0{resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=cc(e,0);let n=t?.length||0;if(t&&e[n]===11&&e[n+1]===119&&j0(t)!==void 0&&rE(e,n)<=16)return!1;for(let r=e.length;n<r;n++)if(aE(e,n))return Xt.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return iM(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return sE(e,t,n,this.basePTS,this.frameIndex)}}const lM=/\/emsg[-/]ID3/i;class cM{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,r){const o=this.videoTrack=Ti("video",1),c=this.audioTrack=Ti("audio",1),d=this.txtTrack=Ti("text",1);if(this.id3Track=Ti("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const h=x1(e);if(h.video){const{id:u,timescale:m,codec:g,supplemental:x}=h.video;o.id=u,o.timescale=d.timescale=m,o.codec=g,o.supplemental=x}if(h.audio){const{id:u,timescale:m,codec:g}=h.audio;c.id=u,c.timescale=m,c.codec=g}d.id=m1.text,o.sampleDuration=0,o.duration=c.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return rD(e)}demux(e,t){this.timeOffset=t;let n=e;const r=this.videoTrack,o=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=ni(this.remainderData,e));const d=fD(n);this.remainderData=d.remainder,r.samples=d.valid||new Uint8Array}else r.samples=n;const c=this.extractID3Track(r,t);return o.samples=bb(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:c,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return n.samples=bb(e,t),{videoTrack:t,audioTrack:Ti(),id3Track:r,textTrack:Ti()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const r=jt(e.samples,["emsg"]);r&&r.forEach(o=>{const c=gD(o);if(lM.test(c.schemeIdUri)){const d=n_(c,t);let h=c.eventDuration===4294967295?Number.POSITIVE_INFINITY:c.eventDuration/c.timeScale;h<=.001&&(h=Number.POSITIVE_INFINITY);const u=c.payload;n.samples.push({data:u,len:u.byteLength,dts:d,pts:d,type:Un.emsg,duration:h})}else if(this.config.enableEmsgKLVMetadata&&c.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const d=n_(c,t);n.samples.push({data:c.payload,len:c.payload.byteLength,dts:d,pts:d,type:Un.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function n_(i,e){return Xe(i.presentationTime)?i.presentationTime/i.timeScale:e+i.presentationTimeDelta/i.timeScale}class dM{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new b0(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,za.cbc)}decryptAacSample(e,t,n){const r=e[t].unit;if(r.length<=16)return;const o=r.subarray(16,r.length-r.length%16),c=o.buffer.slice(o.byteOffset,o.byteOffset+o.length);this.decryptBuffer(c).then(d=>{const h=new Uint8Array(d);r.set(h,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)}).catch(n)}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t);let r=0;for(let o=32;o<e.length-16;o+=160,r+=16)n.set(e.subarray(o,o+16),r);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let r=0;for(let o=32;o<e.length-16;o+=160,r+=16)e.set(n.subarray(r,r+16),o);return e}decryptAvcSample(e,t,n,r,o){const c=b1(o.data),d=this.getAvcEncryptedData(c);this.decryptBuffer(d.buffer).then(h=>{o.data=this.getAvcDecryptedUnit(c,h),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,r)}).catch(r)}decryptAvcSamples(e,t,n,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){r();return}const o=e[t].units;for(;!(n>=o.length);n++){const c=o[n];if(!(c.data.length<=48||c.type!==1&&c.type!==5)&&(this.decryptAvcSample(e,t,n,r,c),!this.decrypter.isSync()))return}}}}class lE{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n=this.VideoSample,r;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){const o=n.units;r=o[o.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const n=t.samples,r=n.length;if(r){const o=n[r-1];e.pts=o.pts,e.dts=o.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,n){const r=t.byteLength;let o=e.naluState||0;const c=o,d=[];let h=0,u,m,g,x=-1,y=0;for(o===-1&&(x=0,y=this.getNALuType(t,0),o=0,h=1);h<r;){if(u=t[h++],!o){o=u?0:1;continue}if(o===1){o=u?0:2;continue}if(!u)o=3;else if(u===1){if(m=h-o-1,x>=0){const v={data:t.subarray(x,m),type:y};d.push(v)}else{const v=this.getLastNalUnit(e.samples);v&&(c&&h<=4-c&&v.state&&(v.data=v.data.subarray(0,v.data.byteLength-c)),m>0&&(v.data=ni(v.data,t.subarray(0,m)),v.state=0))}h<r?(g=this.getNALuType(t,h),x=h,y=g,o=0):o=-1}else o=0}if(x>=0&&o>=0){const v={data:t.subarray(x,r),type:y,state:o};d.push(v)}if(d.length===0){const v=this.getLastNalUnit(e.samples);v&&(v.data=ni(v.data,t))}return e.naluState=o,d}}class tc{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),o=Math.min(4,t);if(o===0)throw new Error("no bytes available");r.set(e.subarray(n,n+o)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=o*8,this.bytesAvailable-=o}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&Xt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class uM extends lE{parsePES(e,t,n,r){const o=this.parseNALu(e,n.data,r);let c=this.VideoSample,d,h=!1;n.data=null,c&&o.length&&!e.audFound&&(this.pushAccessUnit(c,e),c=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),o.forEach(u=>{var m,g;switch(u.type){case 1:{let S=!1;d=!0;const N=u.data;if(h&&N.length>4){const A=this.readSliceType(N);(A===2||A===4||A===7||A===9)&&(S=!0)}if(S){var x;(x=c)!=null&&x.frame&&!c.key&&(this.pushAccessUnit(c,e),c=this.VideoSample=null)}c||(c=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),c.frame=!0,c.key=S;break}case 5:d=!0,(m=c)!=null&&m.frame&&!c.key&&(this.pushAccessUnit(c,e),c=this.VideoSample=null),c||(c=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),c.key=!0,c.frame=!0;break;case 6:{d=!0,p0(u.data,1,n.pts,t.samples);break}case 7:{var y,v;d=!0,h=!0;const S=u.data,N=this.readSPS(S);if(!e.sps||e.width!==N.width||e.height!==N.height||((y=e.pixelRatio)==null?void 0:y[0])!==N.pixelRatio[0]||((v=e.pixelRatio)==null?void 0:v[1])!==N.pixelRatio[1]){e.width=N.width,e.height=N.height,e.pixelRatio=N.pixelRatio,e.sps=[S];const A=S.subarray(1,4);let R="avc1.";for(let C=0;C<3;C++){let D=A[C].toString(16);D.length<2&&(D="0"+D),R+=D}e.codec=R}break}case 8:d=!0,e.pps=[u.data];break;case 9:d=!0,e.audFound=!0,(g=c)!=null&&g.frame&&(this.pushAccessUnit(c,e),c=null),c||(c=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:d=!0;break;default:d=!1;break}c&&d&&c.units.push(u)}),r&&c&&(this.pushAccessUnit(c,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new tc(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n=8,r=8,o;for(let c=0;c<e;c++)r!==0&&(o=t.readEG(),r=(n+o+256)%256),n=r===0?n:r}readSPS(e){const t=new tc(e);let n=0,r=0,o=0,c=0,d,h,u;const m=t.readUByte.bind(t),g=t.readBits.bind(t),x=t.readUEG.bind(t),y=t.readBoolean.bind(t),v=t.skipBits.bind(t),S=t.skipEG.bind(t),N=t.skipUEG.bind(t),A=this.skipScalingList.bind(this);m();const R=m();if(g(5),v(3),m(),N(),R===100||R===110||R===122||R===244||R===44||R===83||R===86||R===118||R===128){const I=x();if(I===3&&v(1),N(),N(),v(1),y())for(h=I!==3?8:12,u=0;u<h;u++)y()&&(u<6?A(16,t):A(64,t))}N();const C=x();if(C===0)x();else if(C===1)for(v(1),S(),S(),d=x(),u=0;u<d;u++)S();N(),v(1);const D=x(),V=x(),z=g(1);z===0&&v(1),v(1),y()&&(n=x(),r=x(),o=x(),c=x());let B=[1,1];if(y()&&y())switch(m()){case 1:B=[1,1];break;case 2:B=[12,11];break;case 3:B=[10,11];break;case 4:B=[16,11];break;case 5:B=[40,33];break;case 6:B=[24,11];break;case 7:B=[20,11];break;case 8:B=[32,11];break;case 9:B=[80,33];break;case 10:B=[18,11];break;case 11:B=[15,11];break;case 12:B=[64,33];break;case 13:B=[160,99];break;case 14:B=[4,3];break;case 15:B=[3,2];break;case 16:B=[2,1];break;case 255:{B=[m()<<8|m(),m()<<8|m()];break}}return{width:Math.ceil((D+1)*16-n*2-r*2),height:(2-z)*(V+1)*16-(z?2:4)*(o+c),pixelRatio:B}}}class hM extends lE{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,n,r){const o=this.parseNALu(e,n.data,r);let c=this.VideoSample,d,h=!1;n.data=null,c&&o.length&&!e.audFound&&(this.pushAccessUnit(c,e),c=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),o.forEach(u=>{var m,g;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:c||(c=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),c.frame=!0,d=!0;break;case 16:case 17:case 18:case 21:if(d=!0,h){var x;(x=c)!=null&&x.frame&&!c.key&&(this.pushAccessUnit(c,e),c=this.VideoSample=null)}c||(c=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),c.key=!0,c.frame=!0;break;case 19:case 20:d=!0,(m=c)!=null&&m.frame&&!c.key&&(this.pushAccessUnit(c,e),c=this.VideoSample=null),c||(c=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),c.key=!0,c.frame=!0;break;case 39:d=!0,p0(u.data,2,n.pts,t.samples);break;case 32:d=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=ns(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(d=!0,h=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const y=this.readSPS(u.data);e.width=y.width,e.height=y.height,e.pixelRatio=y.pixelRatio,e.codec=y.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const v in y.params)e.params[v]=y.params[v]}this.pushParameterSet(e.sps,u.data,e.vps),c||(c=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),c.key=!0;break;case 34:if(d=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const y=this.readPPS(u.data);for(const v in y)e.params[v]=y[v]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:d=!0,e.audFound=!0,(g=c)!=null&&g.frame&&(this.pushAccessUnit(c,e),c=null),c||(c=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:d=!1;break}c&&d&&c.units.push(u)}),r&&c&&(this.pushAccessUnit(c,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let r=0;r<e.byteLength;r++)r>=2&&e[r]===3&&e[r-1]===0&&e[r-2]===0||(t[n]=e[r],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new tc(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const n=t.readBits(3),r=t.readBoolean();return{numTemporalLayers:n+1,temporalIdNested:r}}readSPS(e){const t=new tc(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const r=t.readBits(2),o=t.readBoolean(),c=t.readBits(5),d=t.readUByte(),h=t.readUByte(),u=t.readUByte(),m=t.readUByte(),g=t.readUByte(),x=t.readUByte(),y=t.readUByte(),v=t.readUByte(),S=t.readUByte(),N=t.readUByte(),A=t.readUByte(),R=[],C=[];for(let Ke=0;Ke<n;Ke++)R.push(t.readBoolean()),C.push(t.readBoolean());if(n>0)for(let Ke=n;Ke<8;Ke++)t.readBits(2);for(let Ke=0;Ke<n;Ke++)R[Ke]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),C[Ke]&&t.readUByte();t.readUEG();const D=t.readUEG();D==3&&t.skipBits(1);const V=t.readUEG(),z=t.readUEG(),B=t.readBoolean();let I=0,M=0,L=0,O=0;B&&(I+=t.readUEG(),M+=t.readUEG(),L+=t.readUEG(),O+=t.readUEG());const J=t.readUEG(),ie=t.readUEG(),ne=t.readUEG(),se=t.readBoolean();for(let Ke=se?0:n;Ke<=n;Ke++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let ht=0;ht<4;ht++)for(let Ft=0;Ft<(ht===3?2:6);Ft++)if(!t.readBoolean())t.readUEG();else{const gs=Math.min(64,1<<4+(ht<<1));ht>1&&t.readEG();for(let Se=0;Se<gs;Se++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const le=t.readUEG();let Y=0;for(let Ke=0;Ke<le;Ke++){let ht=!1;if(Ke!==0&&(ht=t.readBoolean()),ht){Ke===le&&t.readUEG(),t.readBoolean(),t.readUEG();let Ft=0;for(let hs=0;hs<=Y;hs++){const gs=t.readBoolean();let Se=!1;gs||(Se=t.readBoolean()),(gs||Se)&&Ft++}Y=Ft}else{const Ft=t.readUEG(),hs=t.readUEG();Y=Ft+hs;for(let gs=0;gs<Ft;gs++)t.readUEG(),t.readBoolean();for(let gs=0;gs<hs;gs++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Ke=t.readUEG();for(let ht=0;ht<Ke;ht++){for(let Ft=0;Ft<ne+4;Ft++)t.readBits(1);t.readBits(1)}}let H=0,Q=1,oe=1,ye=!0,xe=1,pe=0;t.readBoolean(),t.readBoolean();let ee=!1;if(t.readBoolean()){if(t.readBoolean()){const Ye=t.readUByte(),lt=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],_t=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Ye>0&&Ye<16?(Q=lt[Ye-1],oe=_t[Ye-1]):Ye===255&&(Q=t.readBits(16),oe=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),ee=t.readBoolean(),ee&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(xe=t.readBits(32),pe=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const _t=t.readBoolean(),ln=t.readBoolean();let Gs=!1;(_t||ln)&&(Gs=t.readBoolean(),Gs&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Gs&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Vn=0;Vn<=n;Vn++){ye=t.readBoolean();const Tn=ye||t.readBoolean();let ri=!1;Tn?t.readEG():ri=t.readBoolean();const oi=ri?1:t.readUEG()+1;if(_t)for(let cn=0;cn<oi;cn++)t.readUEG(),t.readUEG(),Gs&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(ln)for(let cn=0;cn<oi;cn++)t.readUEG(),t.readUEG(),Gs&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),H=t.readUEG())}let je=V,Fe=z;if(B){let Ke=1,ht=1;D===1?Ke=ht=2:D==2&&(Ke=2),je=V-Ke*M-Ke*I,Fe=z-ht*O-ht*L}const We=r?["A","B","C"][r]:"",he=d<<24|h<<16|u<<8|m;let Ue=0;for(let Ke=0;Ke<32;Ke++)Ue=(Ue|(he>>Ke&1)<<31-Ke)>>>0;let Ge=Ue.toString(16);return c===1&&Ge==="2"&&(Ge="6"),{codecString:`hvc1.${We}${c}.${Ge}.${o?"H":"L"}${A}.B0`,params:{general_tier_flag:o,general_profile_idc:c,general_profile_space:r,general_profile_compatibility_flags:[d,h,u,m],general_constraint_indicator_flags:[g,x,y,v,S,N],general_level_idc:A,bit_depth:J+8,bit_depth_luma_minus8:J,bit_depth_chroma_minus8:ie,min_spatial_segmentation_idc:H,chroma_format_idc:D,frame_rate:{fixed:ye,fps:pe/xe}},width:je,height:Fe,pixelRatio:[Q,oe]}}readPPS(e){const t=new tc(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const r=t.readBoolean(),o=t.readBoolean();let c=1;return o&&r?c=0:o?c=3:r&&(c=2),{parallelismType:c}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Ks=188;class Ba{constructor(e,t,n,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=r,this.videoParser=null}static probe(e,t){const n=Ba.syncOffset(e);return n>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${n}`),n!==-1}static syncOffset(e){const t=e.length;let n=Math.min(Ks*5,t-Ks)+1,r=0;for(;r<n;){let o=!1,c=-1,d=0;for(let h=r;h<t;h+=Ks)if(e[h]===71&&(t-h===Ks||e[h+Ks]===71)){if(d++,c===-1&&(c=h,c!==0&&(n=Math.min(c+Ks*99,e.length-Ks)+1)),o||(o=vg(e,h)===0),o&&d>1&&(c===0&&d>2||h+Ks>n))return c}else{if(d)return-1;break}r++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:m1[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Ba.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=Ba.createTrack("audio",r),this._id3Track=Ba.createTrack("id3"),this._txtTrack=Ba.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,r=!1){n||(this.sampleAes=null);let o;const c=this._videoTrack,d=this._audioTrack,h=this._id3Track,u=this._txtTrack;let m=c.pid,g=c.pesData,x=d.pid,y=h.pid,v=d.pesData,S=h.pesData,N=null,A=this.pmtParsed,R=this._pmtId,C=e.length;if(this.remainderData&&(e=ni(this.remainderData,e),C=e.length,this.remainderData=null),C<Ks&&!r)return this.remainderData=e,{audioTrack:d,videoTrack:c,id3Track:h,textTrack:u};const D=Math.max(0,Ba.syncOffset(e));C-=(C-D)%Ks,C<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,C,e.buffer.byteLength-C));let V=0;for(let B=D;B<C;B+=Ks)if(e[B]===71){const I=!!(e[B+1]&64),M=vg(e,B),L=(e[B+3]&48)>>4;let O;if(L>1){if(O=B+5+e[B+4],O===B+Ks)continue}else O=B+4;switch(M){case m:I&&(g&&(o=To(g,this.logger))&&(this.readyVideoParser(c.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(c,u,o,!1)),g={data:[],size:0}),g&&(g.data.push(e.subarray(O,B+Ks)),g.size+=B+Ks-O);break;case x:if(I){if(v&&(o=To(v,this.logger)))switch(d.segmentCodec){case"aac":this.parseAACPES(d,o);break;case"mp3":this.parseMPEGPES(d,o);break;case"ac3":this.parseAC3PES(d,o);break}v={data:[],size:0}}v&&(v.data.push(e.subarray(O,B+Ks)),v.size+=B+Ks-O);break;case y:I&&(S&&(o=To(S,this.logger))&&this.parseID3PES(h,o),S={data:[],size:0}),S&&(S.data.push(e.subarray(O,B+Ks)),S.size+=B+Ks-O);break;case 0:I&&(O+=e[O]+1),R=this._pmtId=fM(e,O);break;case R:{I&&(O+=e[O]+1);const J=mM(e,O,this.typeSupported,n,this.observer,this.logger);m=J.videoPid,m>0&&(c.pid=m,c.segmentCodec=J.segmentVideoCodec),x=J.audioPid,x>0&&(d.pid=x,d.segmentCodec=J.segmentAudioCodec),y=J.id3Pid,y>0&&(h.pid=y),N!==null&&!A&&(this.logger.warn(`MPEG-TS PMT found at ${B} after unknown PID '${N}'. Backtracking to sync byte @${D} to parse all TS packets.`),N=null,B=D-188),A=this.pmtParsed=!0;break}case 17:case 8191:break;default:N=M;break}}else V++;V>0&&bg(this.observer,new Error(`Found ${V} TS packet/s that do not start with 0x47`),void 0,this.logger),c.pesData=g,d.pesData=v,h.pesData=S;const z={audioTrack:d,videoTrack:c,id3Track:h,textTrack:u};return r&&this.extractRemainingSamples(z),z}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:r,textTrack:o}=e,c=n.pesData,d=t.pesData,h=r.pesData;let u;if(c&&(u=To(c,this.logger))?(this.readyVideoParser(n.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(n,o,u,!0),n.pesData=null)):n.pesData=c,d&&(u=To(d,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else d!=null&&d.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=d;h&&(u=To(h,this.logger))?(this.parseID3PES(r,u),r.pesData=null):r.pesData=h}demuxSampleAes(e,t,n){const r=this.demux(e,n,!0,!this.config.progressive),o=this.sampleAes=new dM(this.observer,this.config,t);return this.decrypt(r,o)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new uM:e==="hevc"&&(this.videoParser=new hM))}decrypt(e,t){return new Promise(n=>{const{audioTrack:r,videoTrack:o}=e;r.samples&&r.segmentCodec==="aac"?t.decryptAacSamples(r.samples,0,()=>{o.samples?t.decryptAvcSamples(o.samples,0,0,()=>{n(e)}):n(e)}):o.samples&&t.decryptAvcSamples(o.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const r=this.aacOverFlow;let o=t.data;if(r){this.aacOverFlow=null;const g=r.missing,x=r.sample.unit.byteLength;if(g===-1)o=ni(r.sample.unit,o);else{const y=x-g;r.sample.unit.set(o.subarray(0,g),y),e.samples.push(r.sample),n=r.missing}}let c,d;for(c=n,d=o.length;c<d-1&&!ku(o,c);c++);if(c!==n){let g;const x=c<d-1;if(x?g=`AAC PES did not start with ADTS header,offset:${c}`:g="No ADTS header found in AAC PES",bg(this.observer,new Error(g),x,this.logger),!x)return}X1(e,this.observer,o,c,this.audioCodec);let h;if(t.pts!==void 0)h=t.pts;else if(r){const g=J1(e.samplerate);h=r.sample.pts+g}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,m;for(;c<d;)if(m=Z1(e,o,c,h,u),c+=m.length,m.missing){this.aacOverFlow=m;break}else for(u++;c<d-1&&!ku(o,c);c++);}parseMPEGPES(e,t){const n=t.data,r=n.length;let o=0,c=0;const d=t.pts;if(d===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;c<r;)if(iE(n,c)){const h=sE(e,n,c,d,o);if(h)c+=h.length,o++;else break}else c++}parseAC3PES(e,t){{const n=t.data,r=t.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const o=n.length;let c=0,d=0,h;for(;d<o&&(h=oE(e,n,d,r,c++))>0;)d+=h}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=ns({},t,{type:this._videoTrack?Un.emsg:Un.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function vg(i,e){return((i[e+1]&31)<<8)+i[e+2]}function fM(i,e){return(i[e+10]&31)<<8|i[e+11]}function mM(i,e,t,n,r,o){const c={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},d=(i[e+1]&15)<<8|i[e+2],h=e+3+d-4,u=(i[e+10]&15)<<8|i[e+11];for(e+=12+u;e<h;){const m=vg(i,e),g=(i[e+3]&15)<<8|i[e+4];switch(i[e]){case 207:if(!n){Em("ADTS AAC",o);break}case 15:c.audioPid===-1&&(c.audioPid=m);break;case 21:c.id3Pid===-1&&(c.id3Pid=m);break;case 219:if(!n){Em("H.264",o);break}case 27:c.videoPid===-1&&(c.videoPid=m);break;case 3:case 4:!t.mpeg&&!t.mp3?o.log("MPEG audio found, not supported in this browser"):c.audioPid===-1&&(c.audioPid=m,c.segmentAudioCodec="mp3");break;case 193:if(!n){Em("AC-3",o);break}case 129:t.ac3?c.audioPid===-1&&(c.audioPid=m,c.segmentAudioCodec="ac3"):o.log("AC-3 audio found, not supported in this browser");break;case 6:if(c.audioPid===-1&&g>0){let x=e+5,y=g;for(;y>2;){switch(i[x]){case 106:t.ac3!==!0?o.log("AC-3 audio found, not supported in this browser for now"):(c.audioPid=m,c.segmentAudioCodec="ac3");break}const S=i[x+1]+2;x+=S,y-=S}}break;case 194:case 135:return bg(r,new Error("Unsupported EC-3 in M2TS found"),void 0,o),c;case 36:c.videoPid===-1&&(c.videoPid=m,c.segmentVideoCodec="hevc",o.log("HEVC in M2TS found"));break}e+=g+5}return c}function bg(i,e,t,n){n.warn(`parsing error: ${e.message}`),i.emit(F.ERROR,F.ERROR,{type:tt.MEDIA_ERROR,details:_e.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Em(i,e){e.log(`${i} with AES-128-CBC encryption found in unencrypted stream`)}function To(i,e){let t=0,n,r,o,c,d;const h=i.data;if(!i||i.size===0)return null;for(;h[0].length<19&&h.length>1;)h[0]=ni(h[0],h[1]),h.splice(1,1);if(n=h[0],(n[0]<<16)+(n[1]<<8)+n[2]===1){if(r=(n[4]<<8)+n[5],r&&r>i.size-6)return null;const m=n[7];m&192&&(c=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,m&64?(d=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,c-d>60*9e4&&(e.warn(`${Math.round((c-d)/9e4)}s delta between PTS and DTS, align them`),c=d)):d=c),o=n[8];let g=o+9;if(i.size<=g)return null;i.size-=g;const x=new Uint8Array(i.size);for(let y=0,v=h.length;y<v;y++){n=h[y];let S=n.byteLength;if(g)if(g>S){g-=S;continue}else n=n.subarray(g),S-=g,g=0;x.set(n,t),t+=S}return r&&(r-=o+3),{data:x,pts:c,dts:d,len:r}}return null}class gM{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Ma=Math.pow(2,32)-1;class be{static init(){be.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in be.types)be.types.hasOwnProperty(e)&&(be.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);be.HDLR_TYPES={video:t,audio:n};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);be.STTS=be.STSC=be.STCO=o,be.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),be.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),be.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),be.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const c=new Uint8Array([105,115,111,109]),d=new Uint8Array([97,118,99,49]),h=new Uint8Array([0,0,0,1]);be.FTYP=be.box(be.types.ftyp,c,h,c,d),be.DINF=be.box(be.types.dinf,be.box(be.types.dref,r))}static box(e,...t){let n=8,r=t.length;const o=r;for(;r--;)n+=t[r].byteLength;const c=new Uint8Array(n);for(c[0]=n>>24&255,c[1]=n>>16&255,c[2]=n>>8&255,c[3]=n&255,c.set(e,4),r=0,n=8;r<o;r++)c.set(t[r],n),n+=t[r].byteLength;return c}static hdlr(e){return be.box(be.types.hdlr,be.HDLR_TYPES[e])}static mdat(e){return be.box(be.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(Ma+1)),r=Math.floor(t%(Ma+1));return be.box(be.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(e){return be.box(be.types.mdia,be.mdhd(e.timescale||0,e.duration||0),be.hdlr(e.type),be.minf(e))}static mfhd(e){return be.box(be.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?be.box(be.types.minf,be.box(be.types.smhd,be.SMHD),be.DINF,be.stbl(e)):be.box(be.types.minf,be.box(be.types.vmhd,be.VMHD),be.DINF,be.stbl(e))}static moof(e,t,n){return be.box(be.types.moof,be.mfhd(e),be.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=be.trak(e[t]);return be.box.apply(null,[be.types.moov,be.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(be.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=be.trex(e[t]);return be.box.apply(null,[be.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(Ma+1)),r=Math.floor(t%(Ma+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return be.box(be.types.mvhd,o)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let r,o;for(r=0;r<t.length;r++)o=t[r].flags,n[r+4]=o.dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy;return be.box(be.types.sdtp,n)}static stbl(e){return be.box(be.types.stbl,be.stsd(e),be.box(be.types.stts,be.STTS),be.box(be.types.stsc,be.STSC),be.box(be.types.stsz,be.STSZ),be.box(be.types.stco,be.STCO))}static avc1(e){let t=[],n=[],r,o,c;for(r=0;r<e.sps.length;r++)o=e.sps[r],c=o.byteLength,t.push(c>>>8&255),t.push(c&255),t=t.concat(Array.prototype.slice.call(o));for(r=0;r<e.pps.length;r++)o=e.pps[r],c=o.byteLength,n.push(c>>>8&255),n.push(c&255),n=n.concat(Array.prototype.slice.call(o));const d=be.box(be.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),h=e.width,u=e.height,m=e.pixelRatio[0],g=e.pixelRatio[1];return be.box(be.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,be.box(be.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),be.box(be.types.pasp,new Uint8Array([m>>24,m>>16&255,m>>8&255,m&255,g>>24,g>>16&255,g>>8&255,g&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return be.box(be.types.mp4a,be.audioStsd(e),be.box(be.types.esds,be.esds(e)))}static mp3(e){return be.box(be.types[".mp3"],be.audioStsd(e))}static ac3(e){return be.box(be.types["ac-3"],be.audioStsd(e),be.box(be.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return be.box(be.types.stsd,be.STSD,be.mp4a(e));if(t==="ac3"&&e.config)return be.box(be.types.stsd,be.STSD,be.ac3(e));if(t==="mp3"&&e.codec==="mp3")return be.box(be.types.stsd,be.STSD,be.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return be.box(be.types.stsd,be.STSD,be.avc1(e));if(t==="hevc"&&e.vps)return be.box(be.types.stsd,be.STSD,be.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),r=e.width||0,o=e.height||0,c=Math.floor(n/(Ma+1)),d=Math.floor(n%(Ma+1));return be.box(be.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,c>>24,c>>16&255,c>>8&255,c&255,d>>24,d>>16&255,d>>8&255,d&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,o>>8&255,o&255,0,0]))}static traf(e,t){const n=be.sdtp(e),r=e.id,o=Math.floor(t/(Ma+1)),c=Math.floor(t%(Ma+1));return be.box(be.types.traf,be.box(be.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),be.box(be.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,c>>24,c>>16&255,c>>8&255,c&255])),be.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,be.box(be.types.trak,be.tkhd(e),be.mdia(e))}static trex(e){const t=e.id;return be.box(be.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],r=n.length,o=12+16*r,c=new Uint8Array(o);let d,h,u,m,g,x;for(t+=8+o,c.set([e.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),d=0;d<r;d++)h=n[d],u=h.duration,m=h.size,g=h.flags,x=h.cts,c.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,m>>>24&255,m>>>16&255,m>>>8&255,m&255,g.isLeading<<2|g.dependsOn,g.isDependedOn<<6|g.hasRedundancy<<4|g.paddingValue<<1|g.isNonSync,g.degradPrio&61440,g.degradPrio&15,x>>>24&255,x>>>16&255,x>>>8&255,x&255],12+16*d);return be.box(be.types.trun,c)}static initSegment(e){be.types||be.init();const t=be.moov(e);return ni(be.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],r=4,o=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),r-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let c=o.length;for(let v=0;v<n.length;v+=1){c+=3;for(let S=0;S<n[v].length;S+=1)c+=2+n[v][S].length}const d=new Uint8Array(c);d.set(o,0),c=o.length;const h=n.length-1;for(let v=0;v<n.length;v+=1){d.set(new Uint8Array([32+v|(v===h?128:0),0,n[v].length]),c),c+=3;for(let S=0;S<n[v].length;S+=1)d.set(new Uint8Array([n[v][S].length>>8,n[v][S].length&255]),c),c+=2,d.set(n[v][S],c),c+=n[v][S].length}const u=be.box(be.types.hvcC,d),m=e.width,g=e.height,x=e.pixelRatio[0],y=e.pixelRatio[1];return be.box(be.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>8&255,m&255,g>>8&255,g&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,be.box(be.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),be.box(be.types.pasp,new Uint8Array([x>>24,x>>16&255,x>>8&255,x&255,y>>24,y>>16&255,y>>8&255,y&255])))}}be.types=void 0;be.HDLR_TYPES=void 0;be.STTS=void 0;be.STSC=void 0;be.STCO=void 0;be.STSZ=void 0;be.VMHD=void 0;be.SMHD=void 0;be.STSD=void 0;be.FTYP=void 0;be.DINF=void 0;const cE=9e4;function L0(i,e,t=1,n=!1){const r=i*e*t;return n?Math.round(r):r}function pM(i,e,t=1,n=!1){return L0(i,e,1/t,n)}function Xl(i,e=!1){return L0(i,1e3,1/cE,e)}function xM(i,e=1){return L0(i,cE,1/e)}function i_(i){const{baseTime:e,timescale:t,trackId:n}=i;return`${e/t} (${e}/${t}) trackId: ${n}`}const yM=10*1e3,vM=1024,bM=1152,_M=1536;let Ao=null,Nm=null;function a_(i,e,t,n){return{duration:e,size:t,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:i?2:1,isNonSync:i?0:1}}}class uu extends ai{constructor(e,t,n,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,Ao===null){const c=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ao=c?parseInt(c[1]):0}if(Nm===null){const o=navigator.userAgent.match(/Safari\/(\d+)/i);Nm=o?parseInt(o[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&i_(t)} > ${e&&i_(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,r=e.reduce((o,c)=>{let d=c.pts,h=d-o;return h<-4294967296&&(t=!0,d=Bn(d,n),h=d-o),h>0?o:d},n);return t&&this.debug("PTS rollover detected"),r}remux(e,t,n,r,o,c,d,h){let u,m,g,x,y,v,S=o,N=o;const A=e.pid>-1,R=t.pid>-1,C=t.samples.length,D=e.samples.length>0,V=d&&C>0||C>1;if((!A||D)&&(!R||V)||this.ISGenerated||d){if(this.ISGenerated){var B,I,M,L;const ne=this.videoTrackConfig;(ne&&(t.width!==ne.width||t.height!==ne.height||((B=t.pixelRatio)==null?void 0:B[0])!==((I=ne.pixelRatio)==null?void 0:I[0])||((M=t.pixelRatio)==null?void 0:M[1])!==((L=ne.pixelRatio)==null?void 0:L[1]))||!ne&&V||this.nextAudioTs===null&&D)&&this.resetInitSegment()}this.ISGenerated||(g=this.generateIS(e,t,o,c));const O=this.isVideoContiguous;let J=-1,ie;if(V&&(J=SM(t.samples),!O&&this.config.forceKeyFrameOnDiscontinuity))if(v=!0,J>0){this.warn(`Dropped ${J} out of ${C} video samples due to a missing keyframe`);const ne=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(J),t.dropped+=J,N+=(t.samples[0].pts-ne)/t.inputTimeScale,ie=N}else J===-1&&(this.warn(`No keyframe found out of ${C} video samples`),v=!1);if(this.ISGenerated){if(D&&V){const ne=this.getVideoStartPts(t.samples),X=(Bn(e.samples[0].pts,ne)-ne)/t.inputTimeScale;S+=Math.max(0,X),N+=Math.max(0,-X)}if(D){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),g=this.generateIS(e,t,o,c)),m=this.remuxAudio(e,S,this.isAudioContiguous,c,R||V||h===Je.AUDIO?N:void 0),V){const ne=m?m.endPTS-m.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),g=this.generateIS(e,t,o,c)),u=this.remuxVideo(t,N,O,ne)}}else V&&(u=this.remuxVideo(t,N,O,0));u&&(u.firstKeyFrame=J,u.independent=J!==-1,u.firstKeyFramePTS=ie)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(y=dE(n,o,this._initPTS,this._initDTS)),r.samples.length&&(x=uE(r,o,this._initPTS))),{audio:m,video:u,initSegment:g,independent:v,text:x,id3:y}}computeInitPts(e,t,n,r){const o=Math.round(n*t);let c=Bn(e,o);if(c<o+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(o-c)/t} ${r}`);c<o+t;)c+=8589934592;return c-o}generateIS(e,t,n,r){const o=e.samples,c=t.samples,d=this.typeSupported,h={},u=this._initPTS;let m=!u||r,g="audio/mp4",x,y,v,S=-1;if(m&&(x=y=1/0),e.config&&o.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":d.mpeg?(g="audio/mpeg",e.codec=""):d.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}h.audio={id:"audio",container:g,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&d.mpeg?new Uint8Array(0):be.initSegment([e]),metadata:{channelCount:e.channelCount}},m&&(S=e.id,v=e.inputTimeScale,!u||v!==u.timescale?x=y=this.computeInitPts(o[0].pts,v,n,"audio"):m=!1)}if(t.sps&&t.pps&&c.length){if(t.timescale=t.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:be.initSegment([t]),metadata:{width:t.width,height:t.height}},m)if(S=t.id,v=t.inputTimeScale,!u||v!==u.timescale){const N=this.getVideoStartPts(c),A=Bn(c[0].dts,N),R=this.computeInitPts(A,v,n,"video"),C=this.computeInitPts(N,v,n,"video");y=Math.min(y,R),x=Math.min(x,C)}else m=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(h).length)return this.ISGenerated=!0,m?(u&&this.warn(`Timestamps at playlist time: ${r?"":"~"}${n} ${x/v} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${x/v} (${x}/${v}) trackId: ${S}`),this._initPTS={baseTime:x,timescale:v,trackId:S},this._initDTS={baseTime:y,timescale:v,trackId:S}):x=v=void 0,{tracks:h,initPTS:x,timescale:v,trackId:S}}remuxVideo(e,t,n,r){const o=e.inputTimeScale,c=e.samples,d=[],h=c.length,u=this._initPTS,m=u.baseTime*o/u.timescale;let g=this.nextVideoTs,x=8,y=this.videoSampleDuration,v,S,N=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,R=!1;if(!n||g===null){const H=m+t*o,Q=c[0].pts-Bn(c[0].dts,c[0].pts);Ao&&g!==null&&Math.abs(H-Q-(g+m))<15e3?n=!0:g=H-Q-m}const C=g+m;for(let H=0;H<h;H++){const Q=c[H];Q.pts=Bn(Q.pts,C),Q.dts=Bn(Q.dts,C),Q.dts<c[H>0?H-1:H].dts&&(R=!0)}R&&c.sort(function(H,Q){const oe=H.dts-Q.dts,ye=H.pts-Q.pts;return oe||ye}),v=c[0].dts,S=c[c.length-1].dts;const D=S-v,V=D?Math.round(D/(h-1)):y||e.inputTimeScale/30;if(n){const H=v-C,Q=H>V,oe=H<-1;if((Q||oe)&&(Q?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Xl(H,!0)} ms (${H}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Xl(-H,!0)} ms (${H}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!oe||C>=c[0].pts||Ao)){v=C;const ye=c[0].pts-H;if(Q)c[0].dts=v,c[0].pts=ye;else{let xe=!0;for(let pe=0;pe<c.length&&!(c[pe].dts>ye&&xe);pe++){const ee=c[pe].pts;if(c[pe].dts-=H,c[pe].pts-=H,pe<c.length-1){const re=c[pe+1].pts,je=c[pe].pts,Fe=re<=je,We=re<=ee;xe=Fe==We}}}this.log(`Video: Initial PTS/DTS adjusted: ${Xl(ye,!0)}/${Xl(v,!0)}, delta: ${Xl(H,!0)} ms`)}}v=Math.max(0,v);let z=0,B=0,I=v;for(let H=0;H<h;H++){const Q=c[H],oe=Q.units,ye=oe.length;let xe=0;for(let pe=0;pe<ye;pe++)xe+=oe[pe].data.length;B+=xe,z+=ye,Q.length=xe,Q.dts<I?(Q.dts=I,I+=V/4|0||1):I=Q.dts,N=Math.min(Q.pts,N),A=Math.max(Q.pts,A)}S=c[h-1].dts;const M=B+4*z+8;let L;try{L=new Uint8Array(M)}catch(H){this.observer.emit(F.ERROR,F.ERROR,{type:tt.MUX_ERROR,details:_e.REMUX_ALLOC_ERROR,fatal:!1,error:H,bytes:M,reason:`fail allocating video mdat ${M}`});return}const O=new DataView(L.buffer);O.setUint32(0,M),L.set(be.types.mdat,4);let J=!1,ie=Number.POSITIVE_INFINITY,ne=Number.POSITIVE_INFINITY,se=Number.NEGATIVE_INFINITY,X=Number.NEGATIVE_INFINITY;for(let H=0;H<h;H++){const Q=c[H],oe=Q.units;let ye=0;for(let ee=0,re=oe.length;ee<re;ee++){const je=oe[ee],Fe=je.data,We=je.data.byteLength;O.setUint32(x,We),x+=4,L.set(Fe,x),x+=We,ye+=4+We}let xe;if(H<h-1)y=c[H+1].dts-Q.dts,xe=c[H+1].pts-Q.pts;else{const ee=this.config,re=H>0?Q.dts-c[H-1].dts:V;if(xe=H>0?Q.pts-c[H-1].pts:V,ee.stretchShortVideoTrack&&this.nextAudioTs!==null){const je=Math.floor(ee.maxBufferHole*o),Fe=(r?N+r*o:this.nextAudioTs+m)-Q.pts;Fe>je?(y=Fe-re,y<0?y=re:J=!0,this.log(`It is approximately ${Fe/90} ms to the next segment; using duration ${y/90} ms for the last video frame.`)):y=re}else y=re}const pe=Math.round(Q.pts-Q.dts);ie=Math.min(ie,y),se=Math.max(se,y),ne=Math.min(ne,xe),X=Math.max(X,xe),d.push(a_(Q.key,y,ye,pe))}if(d.length){if(Ao){if(Ao<70){const H=d[0].flags;H.dependsOn=2,H.isNonSync=0}}else if(Nm&&X-ne<se-ie&&V/se<.025&&d[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let H=v;for(let Q=0,oe=d.length;Q<oe;Q++){const ye=H+d[Q].duration,xe=H+d[Q].cts;if(Q<oe-1){const pe=ye+d[Q+1].cts;d[Q].duration=pe-xe}else d[Q].duration=Q?d[Q-1].duration:V;d[Q].cts=0,H=ye}}}y=J||!y?V:y;const ce=S+y;this.nextVideoTs=g=ce-m,this.videoSampleDuration=y,this.isVideoContiguous=!0;const K={data1:be.moof(e.sequenceNumber++,v,ns(e,{samples:d})),data2:L,startPTS:(N-m)/o,endPTS:(A+y-m)/o,startDTS:(v-m)/o,endDTS:g/o,type:"video",hasAudio:!1,hasVideo:!0,nb:d.length,dropped:e.dropped};return e.samples=[],e.dropped=0,K}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return bM;case"ac3":return _M;default:return vM}}remuxAudio(e,t,n,r,o){const c=e.inputTimeScale,d=e.samplerate?e.samplerate:c,h=c/d,u=this.getSamplesPerFrame(e),m=u*h,g=this._initPTS,x=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,y=[],v=o!==void 0;let S=e.samples,N=x?0:8,A=this.nextAudioTs||-1;const R=g.baseTime*c/g.timescale,C=R+t*c;if(this.isAudioContiguous=n=n||S.length&&A>0&&(r&&Math.abs(C-(A+R))<9e3||Math.abs(Bn(S[0].pts,C)-(A+R))<20*m),S.forEach(function(X){X.pts=Bn(X.pts,C)}),!n||A<0){const X=S.length;if(S=S.filter(ce=>ce.pts>=0),X!==S.length&&this.warn(`Removed ${S.length-X} of ${X} samples (initPTS ${R} / ${c})`),!S.length)return;o===0?A=0:r&&!v?A=Math.max(0,C-R):A=S[0].pts-R}if(e.segmentCodec==="aac"){const X=this.config.maxAudioFramesDrift;for(let ce=0,le=A+R;ce<S.length;ce++){const Y=S[ce],K=Y.pts,H=K-le,Q=Math.abs(1e3*H/c);if(H<=-X*m&&v)ce===0&&(this.warn(`Audio frame @ ${(K/c).toFixed(3)}s overlaps marker by ${Math.round(1e3*H/c)} ms.`),this.nextAudioTs=A=K-R,le=K);else if(H>=X*m&&Q<yM&&v){let oe=Math.round(H/m);for(le=K-oe*m;le<0&&oe&&m;)oe--,le+=m;ce===0&&(this.nextAudioTs=A=le-R),this.warn(`Injecting ${oe} audio frames @ ${((le-R)/c).toFixed(3)}s due to ${Math.round(1e3*H/c)} ms gap.`);for(let ye=0;ye<oe;ye++){let xe=gM.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);xe||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),xe=Y.unit.subarray()),S.splice(ce,0,{unit:xe,pts:le}),le+=m,ce++}}Y.pts=le,le+=m}}let D=null,V=null,z,B=0,I=S.length;for(;I--;)B+=S[I].unit.byteLength;for(let X=0,ce=S.length;X<ce;X++){const le=S[X],Y=le.unit;let K=le.pts;if(V!==null){const Q=y[X-1];Q.duration=Math.round((K-V)/h)}else if(n&&e.segmentCodec==="aac"&&(K=A+R),D=K,B>0){B+=N;try{z=new Uint8Array(B)}catch(Q){this.observer.emit(F.ERROR,F.ERROR,{type:tt.MUX_ERROR,details:_e.REMUX_ALLOC_ERROR,fatal:!1,error:Q,bytes:B,reason:`fail allocating audio mdat ${B}`});return}x||(new DataView(z.buffer).setUint32(0,B),z.set(be.types.mdat,4))}else return;z.set(Y,N);const H=Y.byteLength;N+=H,y.push(a_(!0,u,H,0)),V=K}const M=y.length;if(!M)return;const L=y[y.length-1];A=V-R,this.nextAudioTs=A+h*L.duration;const O=x?new Uint8Array(0):be.moof(e.sequenceNumber++,D/h,ns({},e,{samples:y}));e.samples=[];const J=(D-R)/c,ie=this.nextAudioTs/c,se={data1:O,data2:z,startPTS:J,endPTS:ie,startDTS:J,endDTS:ie,type:"audio",hasAudio:!0,hasVideo:!1,nb:M};return this.isAudioContiguous=!0,se}}function Bn(i,e){let t;if(e===null)return i;for(e<i?t=-8589934592:t=8589934592;Math.abs(i-e)>4294967296;)i+=t;return i}function SM(i){for(let e=0;e<i.length;e++)if(i[e].key)return e;return-1}function dE(i,e,t,n){const r=i.samples.length;if(!r)return;const o=i.inputTimeScale;for(let d=0;d<r;d++){const h=i.samples[d];h.pts=Bn(h.pts-t.baseTime*o/t.timescale,e*o)/o,h.dts=Bn(h.dts-n.baseTime*o/n.timescale,e*o)/o}const c=i.samples;return i.samples=[],{samples:c}}function uE(i,e,t){const n=i.samples.length;if(!n)return;const r=i.inputTimeScale;for(let c=0;c<n;c++){const d=i.samples[c];d.pts=Bn(d.pts-t.baseTime*r/t.timescale,e*r)/r}i.samples.sort((c,d)=>c.pts-d.pts);const o=i.samples;return i.samples=[],{samples:o}}class EM extends ai{constructor(e,t,n,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,r){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,r),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:n,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:o,video:c}=this.initData=x1(e);if(t)dD(e,t);else{const h=o||c;h!=null&&h.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${h.codec}")!`)}o&&(n=r_(o,as.AUDIO,this)),c&&(r=r_(c,as.VIDEO,this));const d={};o&&c?d.audiovideo={container:"video/mp4",codec:n+","+r,supplemental:c.supplemental,encrypted:c.encrypted,initSegment:e,id:"main"}:o?d.audio={container:"audio/mp4",codec:n,encrypted:o.encrypted,initSegment:e,id:"audio"}:c?d.video={container:"video/mp4",codec:r,supplemental:c.supplemental,encrypted:c.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=d}remux(e,t,n,r,o,c){var d,h;let{initPTS:u,lastEndTime:m}=this;const g={audio:void 0,video:void 0,text:r,id3:n,initSegment:void 0};Xe(m)||(m=this.lastEndTime=o||0);const x=t.samples;if(!x.length)return g;const y={initPTS:void 0,timescale:void 0,trackId:void 0};let v=this.initData;if((d=v)!=null&&d.length||(this.generateInitSegment(x),v=this.initData),!((h=v)!=null&&h.length))return this.warn("Failed to generate initSegment."),g;this.emitInitSegment&&(y.tracks=this.initTracks,this.emitInitSegment=!1);const S=hD(x,v,this),N=v.audio?S[v.audio.id]:null,A=v.video?S[v.video.id]:null,R=Hd(A,1/0),C=Hd(N,1/0),D=Hd(A,0,!0),V=Hd(N,0,!0);let z=o,B=0;const I=N&&(!A||!u&&C<R||u&&u.trackId===v.audio.id),M=I?N:A;if(M){const le=M.timescale,Y=M.start-o*le,K=I?v.audio.id:v.video.id;z=M.start/le,B=I?V-C:D-R,(c||!u)&&(NM(u,z,o,B)||le!==u.timescale)&&(u&&this.warn(`Timestamps at playlist time: ${c?"":"~"}${o} ${Y/le} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${o} offset: ${z-o} (${Y}/${le}) trackId: ${K}`),u=null,y.initPTS=Y,y.timescale=le,y.trackId=K)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${o}`);u?(y.initPTS=u.baseTime,y.timescale=u.timescale,y.trackId=u.trackId):((!y.timescale||y.trackId===void 0||y.initPTS===void 0)&&(this.warn("Could not set initPTS"),y.initPTS=z,y.timescale=1,y.trackId=-1),this.initPTS=u={baseTime:y.initPTS,timescale:y.timescale,trackId:y.trackId});const L=z-u.baseTime/u.timescale,O=L+B;B>0?this.lastEndTime=O:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const J=!!v.audio,ie=!!v.video;let ne="";J&&(ne+="audio"),ie&&(ne+="video");const se=(v.audio?v.audio.encrypted:!1)||(v.video?v.video.encrypted:!1),X={data1:x,startPTS:L,startDTS:L,endPTS:O,endDTS:O,type:ne,hasAudio:J,hasVideo:ie,nb:1,dropped:0,encrypted:se};g.audio=J&&!ie?X:void 0,g.video=ie?X:void 0;const ce=A?.sampleCount;if(ce){const le=A.keyFrameIndex,Y=le!==-1;X.nb=ce,X.dropped=le===0||this.isVideoContiguous?0:Y?le:ce,X.independent=Y,X.firstKeyFrame=le,Y&&A.keyFrameStart&&(X.firstKeyFramePTS=(A.keyFrameStart-u.baseTime)/u.timescale),this.isVideoContiguous||(g.independent=Y),this.isVideoContiguous||(this.isVideoContiguous=Y),X.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${le}/${ce} dropped: ${X.dropped} start: ${X.firstKeyFramePTS||"NA"}`)}return g.initSegment=y,g.id3=dE(n,o,u,u),r.samples.length&&(g.text=uE(r,o,u)),g}}function Hd(i,e,t=!1){return i?.start!==void 0?(i.start+(t?i.duration:0))/i.timescale:e}function NM(i,e,t,n){if(i===null)return!0;const r=Math.max(n,1),o=e-i.baseTime/i.timescale;return Math.abs(o-t)>r}function r_(i,e,t){const n=i.codec;return n&&n.length>4?n:e===as.AUDIO?n==="ec-3"||n==="ac-3"||n==="alac"?n:n==="fLaC"||n==="Opus"?Nu(n,!1):(t.warn(`Unhandled audio codec "${n}" in mp4 MAP`),n||"mp4a"):(t.warn(`Unhandled video codec "${n}" in mp4 MAP`),n||"avc1")}let sa;try{sa=self.performance.now.bind(self.performance)}catch{sa=Date.now}const hu=[{demux:cM,remux:EM},{demux:Ba,remux:uu},{demux:aM,remux:uu},{demux:oM,remux:uu}];hu.splice(2,0,{demux:rM,remux:uu});class o_{constructor(e,t,n,r,o,c){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=o,this.logger=c}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,r){const o=n.transmuxing;o.executeStart=sa();let c=new Uint8Array(e);const{currentTransmuxState:d,transmuxConfig:h}=this;r&&(this.currentTransmuxState=r);const{contiguous:u,discontinuity:m,trackSwitch:g,accurateTimeOffset:x,timeOffset:y,initSegmentChange:v}=r||d,{audioCodec:S,videoCodec:N,defaultInitPts:A,duration:R,initSegmentData:C}=h,D=wM(c,t);if(D&&Po(D.method)){const I=this.getDecrypter(),M=S0(D.method);if(I.isSync()){let L=I.softwareDecrypt(c,D.key.buffer,D.iv.buffer,M);if(n.part>-1){const J=I.flush();L=J&&J.buffer}if(!L)return o.executeEnd=sa(),wm(n);c=new Uint8Array(L)}else return this.asyncResult=!0,this.decryptionPromise=I.webCryptoDecrypt(c,D.key.buffer,D.iv.buffer,M).then(L=>{const O=this.push(L,null,n);return this.decryptionPromise=null,O}),this.decryptionPromise}const V=this.needsProbing(m,g);if(V){const I=this.configureTransmuxer(c);if(I)return this.logger.warn(`[transmuxer] ${I.message}`),this.observer.emit(F.ERROR,F.ERROR,{type:tt.MEDIA_ERROR,details:_e.FRAG_PARSING_ERROR,fatal:!1,error:I,reason:I.message}),o.executeEnd=sa(),wm(n)}(m||g||v||V)&&this.resetInitSegment(C,S,N,R,t),(m||v||V)&&this.resetInitialTimestamp(A),u||this.resetContiguity();const z=this.transmux(c,D,y,x,n);this.asyncResult=dc(z);const B=this.currentTransmuxState;return B.contiguous=!0,B.discontinuity=!1,B.trackSwitch=!1,o.executeEnd=sa(),z}flush(e){const t=e.transmuxing;t.executeStart=sa();const{decrypter:n,currentTransmuxState:r,decryptionPromise:o}=this;if(o)return this.asyncResult=!0,o.then(()=>this.flush(e));const c=[],{timeOffset:d}=r;if(n){const g=n.flush();g&&c.push(this.push(g.buffer,null,e))}const{demuxer:h,remuxer:u}=this;if(!h||!u){t.executeEnd=sa();const g=[wm(e)];return this.asyncResult?Promise.resolve(g):g}const m=h.flush(d);return dc(m)?(this.asyncResult=!0,m.then(g=>(this.flushRemux(c,g,e),c))):(this.flushRemux(c,m,e),this.asyncResult?Promise.resolve(c):c)}flushRemux(e,t,n){const{audioTrack:r,videoTrack:o,id3Track:c,textTrack:d}=t,{accurateTimeOffset:h,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${n.sn}${n.part>-1?" part: "+n.part:""} of ${this.id===Je.MAIN?"level":"track"} ${n.level}`);const m=this.remuxer.remux(r,o,c,d,u,h,!0,this.id);e.push({remuxResult:m,chunkMeta:n}),n.transmuxing.executeEnd=sa()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,r,o){const{demuxer:c,remuxer:d}=this;!c||!d||(c.resetInitSegment(e,t,n,r),d.resetInitSegment(e,t,n,o))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,r,o){let c;return t&&t.method==="SAMPLE-AES"?c=this.transmuxSampleAes(e,t,n,r,o):c=this.transmuxUnencrypted(e,n,r,o),c}transmuxUnencrypted(e,t,n,r){const{audioTrack:o,videoTrack:c,id3Track:d,textTrack:h}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(o,c,d,h,t,n,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,n,r,o){return this.demuxer.demuxSampleAes(e,t,n).then(c=>({remuxResult:this.remuxer.remux(c.audioTrack,c.videoTrack,c.id3Track,c.textTrack,n,r,!1,this.id),chunkMeta:o}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:r}=this;let o;for(let g=0,x=hu.length;g<x;g++){var c;if((c=hu[g].demux)!=null&&c.probe(e,this.logger)){o=hu[g];break}}if(!o)return new Error("Failed to find demuxer by probing fragment data");const d=this.demuxer,h=this.remuxer,u=o.remux,m=o.demux;(!h||!(h instanceof u))&&(this.remuxer=new u(n,t,r,this.logger)),(!d||!(d instanceof m))&&(this.demuxer=new m(n,t,r,this.logger),this.probe=m.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new b0(this.config)),e}}function wM(i,e){let t=null;return i.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const wm=i=>({remuxResult:{},chunkMeta:i});function dc(i){return"then"in i&&i.then instanceof Function}class TM{constructor(e,t,n,r,o){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=r,this.defaultInitPts=o||null}}class AM{constructor(e,t,n,r,o,c){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=r,this.timeOffset=o,this.initSegmentChange=c}}let l_=0;class hE{constructor(e,t,n,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=l_++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=h=>{const u=h.data,m=this.hls;if(!(!m||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var g;const x=(g=this.workerContext)==null?void 0:g.objectURL;x&&self.URL.revokeObjectURL(x);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{m.logger[u.data.logType]&&m.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,m.trigger(u.event,u.data);break}}},this.onWorkerError=h=>{if(!this.hls)return;const u=new Error(`${h.message}  (${h.filename}:${h.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(F.ERROR,{type:tt.OTHER_ERROR,details:_e.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};const o=e.config;this.hls=e,this.id=t,this.useWorker=!!o.enableWorker,this.onTransmuxComplete=n,this.onFlush=r;const c=(h,u)=>{u=u||{},u.frag=this.frag||void 0,h===F.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(h,u)};this.observer=new w0,this.observer.on(F.FRAG_DECRYPTED,c),this.observer.on(F.ERROR,c);const d=Eb(o.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const h=this.hls.logger;if(o.workerPath||LI()){try{o.workerPath?(h.log(`loading Web Worker ${o.workerPath} for "${t}"`),this.workerContext=DI(o.workerPath)):(h.log(`injecting Web Worker for "${t}"`),this.workerContext=kI());const{worker:m}=this.workerContext;m.addEventListener("message",this.onWorkerMessage),m.addEventListener("error",this.onWorkerError),m.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:d,id:t,config:os(o)})}catch(m){h.warn(`Error setting up "${t}" Web Worker, fallback to inline`,m),this.terminateWorker(),this.error=null,this.transmuxer=new o_(this.observer,d,o,"",t,e.logger)}return}}this.transmuxer=new o_(this.observer,d,o,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=l_++;const t=this.hls.config,n=Eb(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:os(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),II(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,r,o,c,d,h,u,m){var g,x;u.transmuxing.start=self.performance.now();const{instanceNo:y,transmuxer:v}=this,S=c?c.start:o.start,N=o.decryptdata,A=this.frag,R=!(A&&o.cc===A.cc),C=!(A&&u.level===A.level),D=A?u.sn-A.sn:-1,V=this.part?u.part-this.part.index:-1,z=D===0&&u.id>1&&u.id===A?.stats.chunkCount,B=!C&&(D===1||D===0&&(V===1||z&&V<=0)),I=self.performance.now();(C||D||o.stats.parsing.start===0)&&(o.stats.parsing.start=I),c&&(V||!B)&&(c.stats.parsing.start=I);const M=!(A&&((g=o.initSegment)==null?void 0:g.url)===((x=A.initSegment)==null?void 0:x.url)),L=new AM(R,B,h,C,S,M);if(!B||R||M){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${o.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===Je.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${R}
        trackSwitch: ${C}
        contiguous: ${B}
        accurateTimeOffset: ${h}
        timeOffset: ${S}
        initSegmentChange: ${M}`);const O=new TM(n,r,t,d,m);this.configureTransmuxer(O)}if(this.frag=o,this.part=c,this.workerContext)this.workerContext.worker.postMessage({instanceNo:y,cmd:"demux",data:e,decryptdata:N,chunkMeta:u,state:L},e instanceof ArrayBuffer?[e]:[]);else if(v){const O=v.push(e,N,u,L);dc(O)?O.then(J=>{this.handleTransmuxComplete(J)}).catch(J=>{this.transmuxerError(J,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(O)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const r=n.flush(e);dc(r)?r.then(o=>{this.handleFlushResult(o,e)}).catch(o=>{this.transmuxerError(o,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(F.ERROR,{type:tt.MEDIA_ERROR,details:_e.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const c_=100;class jM extends N0{constructor(e,t,n){super(e,t,n,"audio-stream-controller",Je.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(F.LEVEL_LOADED,this.onLevelLoaded,this),e.on(F.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(F.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(F.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(F.BUFFER_RESET,this.onBufferReset,this),e.on(F.BUFFER_CREATED,this.onBufferCreated,this),e.on(F.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(F.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(F.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(F.FRAG_LOADING,this.onFragLoading,this),e.on(F.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(F.LEVEL_LOADED,this.onLevelLoaded,this),e.off(F.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(F.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(F.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(F.BUFFER_RESET,this.onBufferReset,this),e.off(F.BUFFER_CREATED,this.onBufferCreated,this),e.off(F.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(F.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(F.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(F.FRAG_LOADING,this.onFragLoading,this),e.off(F.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:n,initPTS:r,timescale:o,trackId:c}){if(n===Je.MAIN){const d=t.cc,h=this.fragCurrent;if(this.initPTS[d]={baseTime:r,timescale:o,trackId:c},this.log(`InitPTS for cc: ${d} found from main: ${r/o} (${r}/${o}) trackId: ${c}`),this.mainAnchor=t,this.state===Me.WAITING_INIT_PTS){const u=this.waitingData;(!u&&!this.loadingParts||u&&u.frag.cc!==d)&&this.syncWithAnchor(t,u?.frag)}else!this.hls.hasEnoughToStart&&h&&h.cc!==d?(h.abortRequests(),this.syncWithAnchor(t,h)):this.state===Me.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const r=((n=this.mainFragLoading)==null?void 0:n.frag)||null;if(t&&r?.cc===t.cc)return;const o=(r||e).cc,c=this.getLevelDetails(),d=this.getLoadPosition(),h=j1(c,o,d);h&&(this.log(`Syncing with main frag at ${h.start} cc ${h.cc}`),this.startFragRequested=!1,this.nextLoadPosition=h.start,this.resetLoadingState(),this.state===Me.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=Me.STOPPED;return}const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(c_),n>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n,this.state=Me.IDLE):this.state=Me.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case Me.IDLE:this.doTickIdle();break;case Me.WAITING_TRACK:{const{levels:e,trackId:t}=this,n=e?.[t],r=n?.details;if(r&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(r))break;this.state=Me.WAITING_INIT_PTS}break}case Me.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case Me.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:r,complete:o}=e,c=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=Me.FRAG_LOADING;const d=r.flush().buffer,h={frag:t,part:n,payload:d,networkDetails:null};this._handleFragmentLoadProgress(h),o&&super._handleFragmentLoadComplete(h)}else c&&c.cc!==e.frag.cc&&this.syncWithAnchor(c,e.frag)}else this.state=Me.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:r,trackId:o}=this,c=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!c.startFragPrefetch)||!(n!=null&&n[o]))return;const d=n[o],h=d.details;if(!h||this.waitForLive(d)||this.waitForCdnTuneIn(h)){this.state=Me.WAITING_TRACK,this.startFragRequested=!1;return}const u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,as.AUDIO,Je.AUDIO));const m=this.getFwdBufferInfo(u,Je.AUDIO);if(m===null)return;if(!this.switchingTrack&&this._streamEnded(m,h)){t.trigger(F.BUFFER_EOS,{type:"audio"}),this.state=Me.ENDED;return}const g=m.len,x=t.maxBufferLength,y=h.fragments,v=y[0].start,S=this.getLoadPosition(),N=this.flushing?S:m.end;if(this.switchingTrack&&r){const C=S;h.PTSKnown&&C<v&&(m.end>v||m.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=v+.05)}if(g>=x&&!this.switchingTrack&&N<y[y.length-1].start)return;let A=this.getNextFragment(N,h);if(A&&this.isLoopLoading(A,N)&&(A=this.getNextFragmentLoopLoading(A,h,m,Je.MAIN,x)),!A){this.bufferFlushed=!0;return}let R=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&R&&Cs(A)&&!A.endList&&(!h.live||!this.loadingParts&&N<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(R)===Fs.OK&&(this.mainFragLoading=R=null),R&&Cs(R))){if(A.start>R.end){const D=this.fragmentTracker.getFragAtPos(N,Je.MAIN);D&&D.end>R.end&&(R=D,this.mainFragLoading={frag:D,targetBufferTime:null})}if(A.start>R.end)return}this.loadFragment(A,d,N)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new oc(n))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==Me.STOPPED&&(this.setInterval(c_),this.state=Me.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(F.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:r}=this,{details:o,id:c,groupId:d,track:h}=t;if(!r){this.warn(`Audio tracks reset while loading track ${c} "${h.name}" of "${d}"`);return}const u=this.mainDetails;if(!u||o.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=t,this.state!==Me.STOPPED&&(this.state=Me.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${c} "${h.name}" of "${d}" loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`);const m=r[c];let g=0;if(o.live||(n=m.details)!=null&&n.live){if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;if(m.details){var x;g=this.alignPlaylists(o,m.details,(x=this.levelLastLoaded)==null?void 0:x.details)}o.alignedSliding||(q1(o,u),o.alignedSliding||Lu(o,u),g=o.fragmentStart)}m.details=o,this.levelLastLoaded=m,this.startFragRequested||this.setStartPosition(u,g),this.hls.trigger(F.AUDIO_TRACK_UPDATED,{details:o,id:c,groupId:t.groupId}),this.state===Me.WAITING_TRACK&&!this.waitForCdnTuneIn(o)&&(this.state=Me.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:r,payload:o}=e,{config:c,trackId:d,levels:h}=this;if(!h){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const u=h[d];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const m=u.details;if(!m){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const g=c.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let x=this.transmuxer;x||(x=this.transmuxer=new hE(this.hls,Je.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const y=this.initPTS[n.cc],v=(t=n.initSegment)==null?void 0:t.data;if(y!==void 0){const N=r?r.index:-1,A=N!==-1,R=new _0(n.level,n.sn,n.stats.chunkCount,o.byteLength,N,A);x.push(o,v,g,"",n,r,m.totalduration,!1,R,y)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${m.startSN} ,${m.endSN}],track ${d}`);const{cache:S}=this.waitingData=this.waitingData||{frag:n,part:r,cache:new z1,complete:!1};S.push(new Uint8Array(o)),this.state!==Me.STOPPED&&(this.state=Me.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Je.MAIN&&Cs(t.frag)&&(this.mainFragLoading=t,this.state===Me.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:n,part:r}=t;if(n.type!==Je.AUDIO){!this.audioOnly&&n.type===Je.MAIN&&!n.elementaryStreams.video&&!n.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${r?" p: "+r.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Cs(n)){this.fragPrevious=n;const o=this.switchingTrack;o&&(this.bufferedTrack=o,this.switchingTrack=null,this.hls.trigger(F.AUDIO_TRACK_SWITCHED,Qt({},o)))}this.fragBufferedComplete(n,r),this.media&&this.tick()}onError(e,t){var n;if(t.fatal){this.state=Me.ERROR;return}switch(t.details){case _e.FRAG_GAP:case _e.FRAG_PARSING_ERROR:case _e.FRAG_DECRYPT_ERROR:case _e.FRAG_LOAD_ERROR:case _e.FRAG_LOAD_TIMEOUT:case _e.KEY_LOAD_ERROR:case _e.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Je.AUDIO,t);break;case _e.AUDIO_TRACK_LOAD_ERROR:case _e.AUDIO_TRACK_LOAD_TIMEOUT:case _e.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===Me.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===Rt.AUDIO_TRACK&&(this.state=Me.IDLE);break;case _e.BUFFER_ADD_CODEC_ERROR:case _e.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case _e.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case _e.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==as.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==as.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===Me.ENDED&&(this.state=Me.IDLE);const n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,t,Je.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:r}=this,{remuxResult:o,chunkMeta:c}=e,d=this.getCurrentContext(c);if(!d){this.resetWhenMissingContext(c);return}const{frag:h,part:u,level:m}=d,{details:g}=m,{audio:x,text:y,id3:v,initSegment:S}=o;if(this.fragContextChanged(h)||!g){this.fragmentTracker.removeFragment(h);return}if(this.state=Me.PARSING,this.switchingTrack&&x&&this.completeAudioSwitch(this.switchingTrack),S!=null&&S.tracks){const N=h.initSegment||h;if(this.unhandledEncryptionError(S,h))return;this._bufferInitSegment(m,S.tracks,N,c),r.trigger(F.FRAG_PARSING_INIT_SEGMENT,{frag:N,id:n,tracks:S.tracks})}if(x){const{startPTS:N,endPTS:A,startDTS:R,endDTS:C}=x;u&&(u.elementaryStreams[as.AUDIO]={startPTS:N,endPTS:A,startDTS:R,endDTS:C}),h.setElementaryStreamInfo(as.AUDIO,N,A,R,C),this.bufferFragmentData(x,h,u,c)}if(v!=null&&(t=v.samples)!=null&&t.length){const N=ns({id:n,frag:h,details:g},v);r.trigger(F.FRAG_PARSING_METADATA,N)}if(y){const N=ns({id:n,frag:h,details:g},y);r.trigger(F.FRAG_PARSING_USERDATA,N)}}_bufferInitSegment(e,t,n,r){if(this.state!==Me.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const o=t.audio;o.id=Je.AUDIO;const c=e.audioCodec;this.log(`Init audio buffer, container:${o.container}, codecs[level/parsed]=[${c}/${o.codec}]`),c&&c.split(",").length===1&&(o.levelCodec=c),this.hls.trigger(F.BUFFER_CODECS,t);const d=o.initSegment;if(d!=null&&d.byteLength){const h={type:"audio",frag:n,part:null,chunkMeta:r,parent:n.type,data:d};this.hls.trigger(F.BUFFER_APPENDING,h)}this.tickImmediate()}loadFragment(e,t,n){const r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===Fs.NOT_LOADED||r===Fs.PARTIAL){var o;if(!Cs(e))this._loadInitSegment(e,t);else if((o=t.details)!=null&&o.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=Me.WAITING_INIT_PTS;const c=this.mainDetails;c&&c.fragmentStart!==t.details.fragmentStart&&Lu(t.details,c)}else super.loadFragment(e,t,n)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:r,characteristics:o,audioCodec:c,channels:d}=this.bufferedTrack;Cr({name:t,lang:n,assocLang:r,characteristics:o,audioCodec:c,channels:d},e,Sr)||(Tu(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(F.AUDIO_TRACK_SWITCHED,Qt({},e))}}class k0 extends ai{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const r=t?.renditionReports;if(r){let o=-1;for(let c=0;c<r.length;c++){const d=r[c];let h;try{h=new self.URL(d.URI,t.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),h=d.URI||""}if(h===e){o=c;break}else h===e.substring(0,h.length)&&(o=c)}if(o!==-1){const c=r[o],d=parseInt(c["LAST-MSN"])||t.lastPartSn;let h=parseInt(c["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const m=Math.min(t.age-t.partTarget,t.targetduration);h>=0&&m>t.partTarget&&(h+=1)}const u=n&&Nb(n);return new wb(d,h>=0?h:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}return e}playlistLoaded(e,t,n){const{details:r,stats:o}=t,c=self.performance.now(),d=o.loading.first?Math.max(0,c-o.loading.first):0;r.advancedDateTime=Date.now()-d;const h=this.hls.config.timelineOffset;if(h!==r.appliedTimelineOffset){const m=Math.max(h||0,0);r.appliedTimelineOffset=m,r.fragments.forEach(g=>{g.setStart(g.playlistOffset+m)})}if(r.live||n!=null&&n.live){const m="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(n),n&&r.fragments.length>0){bI(n,r,this);const R=r.playlistParsingError;if(R){this.warn(R);const C=this.hls;if(!C.config.ignorePlaylistParsingErrors){var u;const{networkDetails:D}=t;C.trigger(F.ERROR,{type:tt.NETWORK_ERROR,details:_e.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:R,reason:R.message,level:t.level||void 0,parent:(u=r.fragments[0])==null?void 0:u.type,networkDetails:D,stats:o});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=o.loading.start);const g=this.hls.mainForwardBufferInfo,x=g?g.end-g.len:0,y=(r.edge-x)*1e3,v=$1(r,y);if(r.requestScheduled+v<c?r.requestScheduled=c:r.requestScheduled+=v,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let S,N,A;if(r.canBlockReload&&r.endSN&&r.advanced){const R=this.hls.config.lowLatencyMode,C=r.lastPartSn,D=r.endSN,V=r.lastPartIndex,z=V!==-1,B=C===D;z?B?(N=D+1,A=R?0:V):(N=C,A=R?V+1:r.maxPartIndex):N=D+1;const I=r.age,M=I+r.ageHeader;let L=Math.min(M-r.partTarget,r.targetduration*1.5);if(L>0){if(M>r.targetduration*3)this.log(`Playlist last advanced ${I.toFixed(2)}s ago. Omitting segment and part directives.`),N=void 0,A=void 0;else if(n!=null&&n.tuneInGoal&&M-r.partTarget>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${L} with playlist age: ${r.age}`),L=0;else{const O=Math.floor(L/r.targetduration);if(N+=O,A!==void 0){const J=Math.round(L%r.targetduration/r.partTarget);A+=J}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${I.toFixed(2)}s goal: ${L} skip sn ${O} to part ${A}`)}r.tuneInGoal=L}if(S=this.getDeliveryDirectives(r,t.deliveryDirectives,N,A),R||!B){r.requestScheduled=c,this.loadingPlaylist(m,S);return}}else(r.canBlockReload||r.canSkipUntil)&&(S=this.getDeliveryDirectives(r,t.deliveryDirectives,N,A));S&&N!==void 0&&r.canBlockReload&&(r.requestScheduled=o.loading.first+Math.max(v-d*2,v/2)),this.scheduleLoading(m,S,r)}else this.clearTimer()}scheduleLoading(e,t,n){const r=n||e.details;if(!r){this.loadingPlaylist(e,t);return}const o=self.performance.now(),c=r.requestScheduled;if(o>=c){this.loadingPlaylist(e,t);return}const d=c-o;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(d)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),d)}getDeliveryDirectives(e,t,n,r){let o=Nb(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,r=t.part,o=cu.No),new wb(n,r,o)}checkRetry(e){const t=e.details,n=Au(e),r=e.errorAction,{action:o,retryCount:c=0,retryConfig:d}=r||{},h=!!r&&!!d&&(o===Js.RetryRequest||!r.resolved&&o===Js.SendAlternateToPenaltyBox);if(h){var u;if(c>=d.maxNumRetry)return!1;if(n&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${c+1}/${d.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const m=v0(d,c);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),m),this.warn(`Retrying playlist loading ${c+1}/${d.maxNumRetry} after "${t}" in ${m}ms`)}e.levelRetry=!0,r.resolved=!0}return h}}function fE(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(!uc(i[t].attrs,e[t].attrs))return!1;return!0}function uc(i,e,t){const n=i["STABLE-RENDITION-ID"];return n&&!t?n===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>i[r]!==e[r])}function _g(i,e){return e.label.toLowerCase()===i.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(i.lang||"").toLowerCase())}class CM extends k0{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.MANIFEST_PARSED,this.onManifestParsed,this),e.on(F.LEVEL_LOADING,this.onLevelLoading,this),e.on(F.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(F.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(F.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.MANIFEST_PARSED,this.onManifestParsed,this),e.off(F.LEVEL_LOADING,this.onLevelLoading,this),e.off(F.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(F.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(F.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:r,details:o}=t,c=this.tracksInGroup[n];if(!c||c.groupId!==r){this.warn(`Audio track with id:${n} and group:${r} not found in active group ${c?.groupId}`);return}const d=c.details;c.details=t.details,this.log(`Audio track ${n} "${c.name}" lang:${c.lang} group:${r} loaded [${o.startSN}-${o.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,d)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,r=this.groupIds;let o=this.currentTrack;if(!n||r?.length!==n?.length||n!=null&&n.some(d=>r?.indexOf(d)===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const d=this.tracks.filter(x=>!n||n.indexOf(x.groupId)!==-1);if(d.length)this.selectDefaultTrack&&!d.some(x=>x.default)&&(this.selectDefaultTrack=!1),d.forEach((x,y)=>{x.id=y});else if(!o&&!this.tracksInGroup.length)return;this.tracksInGroup=d;const h=this.hls.config.audioPreference;if(!o&&h){const x=Ai(h,d,Sr);if(x>-1)o=d[x];else{const y=Ai(h,this.tracks);o=this.tracks[y]}}let u=this.findTrackId(o);u===-1&&o&&(u=this.findTrackId(null));const m={audioTracks:d};this.log(`Updating audio tracks, ${d.length} track(s) found in group(s): ${n?.join(",")}`),this.hls.trigger(F.AUDIO_TRACKS_UPDATED,m);const g=this.trackId;if(u!==-1&&g===-1)this.setAudioTrack(u);else if(d.length&&g===-1){var c;const x=new Error(`No audio track selected for current audio group-ID(s): ${(c=this.groupIds)==null?void 0:c.join(",")} track count: ${d.length}`);this.warn(x.message),this.hls.trigger(F.ERROR,{type:tt.MEDIA_ERROR,details:_e.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:x})}}}onError(e,t){t.fatal||!t.context||t.context.type===Rt.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const r=this.currentTrack;if(r&&Cr(e,r,Sr))return r;const o=Ai(e,this.tracksInGroup,Sr);if(o>-1){const c=this.tracksInGroup[o];return this.setAudioTrack(o),c}else if(r){let c=t.loadLevel;c===-1&&(c=t.firstAutoLevel);const d=$D(e,t.levels,n,c,Sr);if(d===-1)return null;t.nextLoadLevel=d}if(e.channels||e.audioCodec){const c=Ai(e,n);if(c>-1)return n[c]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,r=t[e],o=r.details&&!r.details.live;if(e===this.trackId&&r===n&&o||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(F.AUDIO_TRACK_SWITCHING,Qt({},r)),o))return;const c=this.switchParams(r.url,n?.details,r.details);this.loadPlaylist(c)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const r=t[n];if(!(this.selectDefaultTrack&&!r.default)&&(!e||Cr(e,r,Sr)))return n}if(e){const{name:n,lang:r,assocLang:o,characteristics:c,audioCodec:d,channels:h}=e;for(let u=0;u<t.length;u++){const m=t[u];if(Cr({name:n,lang:r,assocLang:o,characteristics:c,audioCodec:d,channels:h},m,Sr))return u}for(let u=0;u<t.length;u++){const m=t[u];if(uc(e.attrs,m.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){const m=t[u];if(uc(e.attrs,m.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Tu(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,r=e.groupId,o=this.getUrlWithDirectives(e.url,t),c=e.details,d=c?.age;this.log(`Loading audio-track ${n} "${e.name}" lang:${e.lang} group:${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${d&&c.live?" age "+d.toFixed(1)+(c.type&&" "+c.type||""):""} ${o}`),this.hls.trigger(F.AUDIO_TRACK_LOADING,{url:o,id:n,groupId:r,deliveryDirectives:t||null,track:e})}}class RM{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(this.queues===null||this.tracks===null)return;const r=this.queues[t];r.push(e),r.length===1&&!n&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=(t=e[0])==null?void 0:t.label;(n==="async-blocker"||n==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(o){var n;if(r.onError(o),this.queues===null||this.tracks===null)return;const c=(n=this.tracks[e])==null?void 0:n.buffer;c!=null&&c.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,n;return(t=this.queues)!=null&&t[e]||(n=this.tracks)!=null&&n[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const n=(t=this.tracks)==null?void 0:t[e],r=n?.buffer;return r?`SourceBuffer${r.updating?" updating":""}${n.ended?" ended":""}${n.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(n=>n.label).join(", "))||""}}const d_=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,mE="HlsJsTrackRemovedError";class LM extends Error{constructor(e){super(e),this.name=mE}}class kM extends ai{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=n=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=n=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=n=>{const{media:r,mediaSource:o}=this;n&&this.log("Media source opened"),!(!r||!o)&&(o.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(F.MEDIA_ATTACHED,{media:r,mediaSource:o}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:n,_objectUrl:r}=this;n!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${n})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=eD(qa(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(F.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.MANIFEST_PARSED,this.onManifestParsed,this),e.on(F.BUFFER_RESET,this.onBufferReset,this),e.on(F.BUFFER_APPENDING,this.onBufferAppending,this),e.on(F.BUFFER_CODECS,this.onBufferCodecs,this),e.on(F.BUFFER_EOS,this.onBufferEos,this),e.on(F.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(F.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(F.FRAG_PARSED,this.onFragParsed,this),e.on(F.FRAG_CHANGED,this.onFragChanged,this),e.on(F.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(F.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.MANIFEST_PARSED,this.onManifestParsed,this),e.off(F.BUFFER_RESET,this.onBufferReset,this),e.off(F.BUFFER_APPENDING,this.onBufferAppending,this),e.off(F.BUFFER_CODECS,this.onBufferCodecs,this),e.off(F.BUFFER_EOS,this.onBufferEos,this),e.off(F.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(F.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(F.FRAG_PARSED,this.onFragParsed,this),e.off(F.FRAG_CHANGED,this.onFragChanged,this),e.off(F.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const o=this.isUpdating();o||this.operationQueue.removeBlockers();const c=this.isQueued();(o||c)&&this.warn(`Transfering MediaSource with${c?" operations in queue":""}${o?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?ns(n,r.tracks):this.sourceBuffers.forEach(o=>{const[c]=o;c&&(n[c]=ns({},this.tracks[c]),this.removeBuffer(c)),o[0]=o[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(n=this.transferData)!=null&&n.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media;this.transferData=this.overrides=void 0;const r=qa(this.appendSource);if(r){const o=!!t.mediaSource;(o||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const c=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(c),o)this._objectUrl=n.src,this.attachTransferred();else{const d=this._objectUrl=self.URL.createObjectURL(c);if(this.appendSource)try{n.removeAttribute("src");const h=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||h&&c instanceof h,u_(n),DM(n,d),n.load()}catch{n.src=d}else n.src=d}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(n=e.constructor)==null?void 0:n.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,r=t.tracks,o=r?Object.keys(r):null,c=o?o.length:0,d=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&o&&c){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${os(n,(h,u)=>h==="initSegment"?void 0:u)};
transfer tracks: ${os(r,(h,u)=>h==="initSegment"?void 0:u)}}`),!d1(r,n)){t.mediaSource=null,t.tracks=void 0;const h=e.currentTime,u=this.details,m=Math.max(h,u?.fragments[0].start||0);if(m-h>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${h} -> ${m}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(n)}") start time: ${m} currentTime: ${h}`),this.onMediaDetaching(F.MEDIA_DETACHING,{}),this.onMediaAttaching(F.MEDIA_ATTACHING,t),e.currentTime=m;return}this.transferData=void 0,o.forEach(h=>{const u=h,m=r[u];if(m){const g=m.buffer;if(g){const x=this.fragmentTracker,y=m.id;if(x.hasFragments(y)||x.hasParts(y)){const N=yt.getBuffered(g);x.detectEvictedFragments(u,N,y,null,!0)}const v=Tm(u),S=[u,g];this.sourceBuffers[v]=S,g.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,m)}}}),d(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),d()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:o,_objectUrl:c}=this;if(o){if(this.log(`media source ${n?"transferring":"detaching"}`),n)this.sourceBuffers.forEach(([d])=>{d&&this.removeBuffer(d)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const d=o.readyState==="open";try{const h=o.sourceBuffers;for(let u=h.length;u--;)d&&h[u].abort(),o.removeSourceBuffer(h[u]);d&&o.endOfStream()}catch(h){this.warn(`onMediaDetaching: ${h.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}o.removeEventListener("sourceopen",this._onMediaSourceOpen),o.removeEventListener("sourceended",this._onMediaSourceEnded),o.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(o.removeEventListener("startstreaming",this._onStartStreaming),o.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),n||(c&&self.URL.revokeObjectURL(c),this.mediaSrc===c?(r.removeAttribute("src"),this.appendSource&&u_(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(F.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const n=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),n)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(o){this.warn(`onBufferReset ${e}`,o)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Tm(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new RM(this.tracks)}onBufferCodecs(e,t){var n;const r=this.tracks,o=Object.keys(t);this.log(`BUFFER_CODECS: "${o}" (current SB count ${this.sourceBufferCount})`);const c="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),d=!c&&this.sourceBufferCount&&this.media&&o.some(h=>!r[h]);if(c||d){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${o}" SourceBuffers`);return}o.forEach(h=>{var u,m;const g=t[h],{id:x,codec:y,levelCodec:v,container:S,metadata:N,supplemental:A}=g;let R=r[h];const C=(u=this.transferData)==null||(u=u.tracks)==null?void 0:u[h],D=C!=null&&C.buffer?C:R,V=D?.pendingCodec||D?.codec,z=D?.levelCodec;R||(R=r[h]={buffer:void 0,listeners:[],codec:y,supplemental:A,container:S,levelCodec:v,metadata:N,id:x});const B=lu(V,z),I=B?.replace(d_,"$1");let M=lu(y,v);const L=(m=M)==null?void 0:m.replace(d_,"$1");M&&B&&I!==L&&(h.slice(0,5)==="audio"&&(M=Nu(M,this.appendSource)),this.log(`switching codec ${V} to ${M}`),M!==(R.pendingCodec||R.codec)&&(R.pendingCodec=M),R.container=S,this.appendChangeType(h,S,M))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((n=t.audio)==null?void 0:n.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const r=`${t};codecs=${n}`,o={label:`change-type=${r}`,execute:()=>{const c=this.tracks[e];if(c){const d=c.buffer;d!=null&&d.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),d.changeType(r),c.codec=n,c.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:c=>{this.warn(`Failed to change ${e} SourceBuffer type`,c)}};this.append(o,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,r=n+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(n,Je.MAIN))==null?void 0:t.gap)===!0)return;const c={label:"block-audio",execute:()=>{var d;const h=this.tracks.video;(this.lastVideoAppendEnd>r||h!=null&&h.buffer&&yt.isBuffered(h.buffer,r)||((d=this.fragmentTracker.getAppendedFrag(r,Je.MAIN))==null?void 0:d.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:d=>{this.warn("Error executing block-audio operation",d)}};this.blockedAudioAppend={op:c,frag:e},this.append(c,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:r,type:o,parent:c,frag:d,part:h,chunkMeta:u,offset:m}=t,g=u.buffering[o],{sn:x,cc:y}=d,v=self.performance.now();g.start=v;const S=d.stats.buffering,N=h?h.stats.buffering:null;S.start===0&&(S.start=v),N&&N.start===0&&(N.start=v);const A=n.audio;let R=!1;o==="audio"&&A?.container==="audio/mpeg"&&(R=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const C=n.video,D=C?.buffer;if(D&&x!=="initSegment"){const B=h||d,I=this.blockedAudioAppend;if(o==="audio"&&c!=="main"&&!this.blockedAudioAppend&&!(C.ending||C.ended)){const L=B.start+B.duration*.05,O=D.buffered,J=this.currentOp("video");!O.length&&!J?this.blockAudio(B):!J&&!yt.isBuffered(D,L)&&this.lastVideoAppendEnd<L&&this.blockAudio(B)}else if(o==="video"){const M=B.end;if(I){const L=I.frag.start;(M>L||M<this.lastVideoAppendEnd||yt.isBuffered(D,L))&&this.unblockAudio()}this.lastVideoAppendEnd=M}}const V=(h||d).start,z={label:`append-${o}`,execute:()=>{var B;g.executeStart=self.performance.now();const I=(B=this.tracks[o])==null?void 0:B.buffer;I&&(R?this.updateTimestampOffset(I,V,.1,o,x,y):m!==void 0&&Xe(m)&&this.updateTimestampOffset(I,m,1e-6,o,x,y)),this.appendExecutor(r,o)},onStart:()=>{},onComplete:()=>{const B=self.performance.now();g.executeEnd=g.end=B,S.first===0&&(S.first=B),N&&N.first===0&&(N.first=B);const I={};this.sourceBuffers.forEach(([M,L])=>{M&&(I[M]=yt.getBuffered(L))}),this.appendErrors[o]=0,o==="audio"||o==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(F.BUFFER_APPENDED,{type:o,frag:d,part:h,chunkMeta:u,parent:d.type,timeRanges:I})},onError:B=>{var I;const M={type:tt.MEDIA_ERROR,parent:d.type,details:_e.BUFFER_APPEND_ERROR,sourceBufferName:o,frag:d,part:h,chunkMeta:u,error:B,err:B,fatal:!1},L=(I=this.media)==null?void 0:I.error;if(B.code===DOMException.QUOTA_EXCEEDED_ERR||B.name=="QuotaExceededError"||"quota"in B)M.details=_e.BUFFER_FULL_ERROR;else if(B.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!L)M.errorAction=Oo(!0);else if(B.name===mE&&this.sourceBufferCount===0)M.errorAction=Oo(!0);else{const O=++this.appendErrors[o];this.warn(`Failed ${O}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${o}" sourceBuffer (${L||"no media error"})`),(O>=this.hls.config.appendErrorMaxRetry||L)&&(M.fatal=!0)}this.hls.trigger(F.ERROR,M)}};this.log(`queuing "${o}" append sn: ${x}${h?" p: "+h.index:""} of ${d.type===Je.MAIN?"level":"track"} ${d.level} cc: ${y}`),this.append(z,o,this.isPending(this.tracks[o]))}getFlushOp(e,t,n){return this.log(`queuing "${e}" remove ${t}-${n}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(F.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${t}-${n} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,t){const{type:n,startOffset:r,endOffset:o}=t;n?this.append(this.getFlushOp(n,r,o),n):this.sourceBuffers.forEach(([c])=>{c&&this.append(this.getFlushOp(c,r,o),c)})}onFragParsed(e,t){const{frag:n,part:r}=t,o=[],c=r?r.elementaryStreams:n.elementaryStreams;c[as.AUDIOVIDEO]?o.push("audiovideo"):(c[as.AUDIO]&&o.push("audio"),c[as.VIDEO]&&o.push("video"));const d=()=>{const h=self.performance.now();n.stats.buffering.end=h,r&&(r.stats.buffering.end=h);const u=r?r.stats:n.stats;this.hls.trigger(F.FRAG_BUFFERED,{frag:n,part:r,stats:u,id:n.type})};o.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(d,o).catch(h=>{this.warn(`Fragment buffered callback ${h}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(([c])=>{if(c){const d=this.tracks[c];(!t.type||t.type===c)&&(d.ending=!0,d.ended||(d.ended=!0,this.log(`${c} buffer reached EOS`)))}});const r=((n=this.overrides)==null?void 0:n.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([c])=>{var d;return c&&!((d=this.tracks[c])!=null&&d.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:c}=this;if(!c||c.readyState!=="open"){c&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${c.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),c.endOfStream(),this.hls.trigger(F.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(F.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===_e.BUFFER_APPEND_ERROR&&t.frag){var n;const r=(n=t.errorAction)==null?void 0:n.nextAutoLevel;Xe(r)&&r!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||t===null||!this.sourceBufferCount)return;const r=e.config,o=n.currentTime,c=t.levelTargetDuration,d=t.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(Xe(d)&&d>=0){const u=Math.max(d,c),m=Math.floor(o/c)*c-u;this.flushBackBuffer(o,c,m)}const h=r.frontBufferFlushThreshold;if(Xe(h)&&h>0){const u=Math.max(r.maxBufferLength,h),m=Math.max(u,c),g=Math.floor(o/c)*c+m;this.flushFrontBuffer(o,c,g)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(([r,o])=>{if(o){const d=yt.getBuffered(o);if(d.length>0&&n>d.start(0)){var c;this.hls.trigger(F.BACK_BUFFER_REACHED,{bufferEnd:n});const h=this.tracks[r];if((c=this.details)!=null&&c.live)this.hls.trigger(F.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(h!=null&&h.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(F.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:r})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(([r,o])=>{if(o){const c=yt.getBuffered(o),d=c.length;if(d<2)return;const h=c.start(d-1),u=c.end(d-1);if(n>h||e>=h&&e<=u)return;this.hls.trigger(F.BUFFER_FLUSHING,{startOffset:h,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||n?.readyState!=="open")return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){const u=Math.max(0,t.fragmentStart),m=Math.max(u,r);return{duration:1/0,start:u,end:m}}return{duration:1/0}}const o=(e=this.overrides)==null?void 0:e.duration;if(o)return Xe(o)?{duration:o}:null;const c=this.media.duration,d=Xe(n.duration)?n.duration:0;return r>d&&r>c||!Xe(c)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:n}){const r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==e&&(Xe(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),t!==void 0&&n!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${n}.`),r.setLiveSeekableRange(t,n)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${os(n)}`),this.tracksReady){var r;const o=(r=this.transferData)==null?void 0:r.tracks;o&&Object.keys(o).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,n])=>{if(t){const r=this.tracks[t];e[t]={buffer:n,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(F.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(F.ERROR,{type:tt.MEDIA_ERROR,details:_e.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const o in e){const c=o,d=e[c];if(this.isPending(d)){const h=this.getTrackCodec(d,c),u=`${d.container};codecs=${h}`;d.codec=h,this.log(`creating sourceBuffer(${u})${this.currentOp(c)?" Queued":""} ${os(d)}`);try{const m=n.addSourceBuffer(u),g=Tm(c),x=[c,m];t[g]=x,d.buffer=m}catch(m){var r;this.error(`error while trying to add sourceBuffer: ${m.message}`),this.shiftAndExecuteNext(c),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[c],this.hls.trigger(F.ERROR,{type:tt.MEDIA_ERROR,details:_e.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:m,sourceBufferName:c,mimeType:u,parent:d.id});return}this.trackSourceBuffer(c,d)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let r=e.codec;n&&(t==="video"||t==="audiovideo")&&ac(n,"video")&&(r=SD(r,n));const o=lu(r,e.levelCodec);return o?t.slice(0,5)==="audio"?Nu(o,this.appendSource):o:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(o,c)=>{const d=c.removedRanges;d!=null&&d.length&&this.hls.trigger(F.BUFFER_FLUSHED,{type:o})})}get mediaSrc(){var e,t;const n=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return n?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(n=this.mediaSource)==null?void 0:n.readyState}`);this.error(`${r}`,t),this.hls.trigger(F.ERROR,{type:tt.MEDIA_ERROR,details:_e.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const o=this.currentOp(e);o&&o.onError(r)}updateTimestampOffset(e,t,n,r,o,c){const d=t-e.timestampOffset;Math.abs(d)>=n&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${t} (sn: ${o} cc: ${c})`),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:r,mediaSource:o}=this,c=this.tracks[e],d=c?.buffer;if(!r||!o||!d){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const h=Xe(r.duration)?r.duration:1/0,u=Xe(o.duration)?o.duration:1/0,m=Math.max(0,t),g=Math.min(n,h,u);g>m&&(!c.ending||c.ended)?(c.ended=!1,this.log(`Removing [${m},${g}] from the ${e} SourceBuffer`),d.remove(m,g)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],r=n?.buffer;if(!r)throw new LM(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);n.ending=!1,n.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,r=t.map(c=>this.appendBlocker(c));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(c=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var n;const r=(n=this.tracks[t])==null?void 0:n.buffer;!r||r.updating||this.shiftAndExecuteNext(t)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,n){const r=this.tracks[e];if(!r)return;const o=r.buffer;if(!o)return;const c=n.bind(this,e);r.listeners.push({event:t,listener:c}),o.addEventListener(t,c)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(r=>{n.removeEventListener(r.event,r.listener)}),t.listeners.length=0)}}function u_(i){const e=i.querySelectorAll("source");[].slice.call(e).forEach(t=>{i.removeChild(t)})}function DM(i,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,i.appendChild(t)}function Tm(i){return i==="audio"?1:0}class D0{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(F.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(F.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(F.MANIFEST_PARSED,this.onManifestParsed,this),e.on(F.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(F.BUFFER_CODECS,this.onBufferCodecs,this),e.on(F.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(F.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(F.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(F.MANIFEST_PARSED,this.onManifestParsed,this),e.off(F.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(F.BUFFER_CODECS,this.onBufferCodecs,this),e.off(F.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Xe(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((r,o)=>this.isLevelAllowed(r)&&o<=e);return this.clientRect=null,D0.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;const r=(d,h)=>h?d.width!==h.width||d.height!==h.height:!0;let o=e.length-1;const c=Math.max(t,n);for(let d=0;d<e.length;d+=1){const h=e[d];if((h.width>=c||h.height>=c)&&r(h,e[d+1])){o=d;break}}return o}}const IM={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},_n=IM,MM={HLS:"h"},OM=MM;class ki{constructor(e,t){Array.isArray(e)&&(e=e.map(n=>n instanceof ki?n:new ki(n))),this.value=e,this.params=t}}const PM="Dict";function BM(i){return Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":typeof i=="object"?JSON.stringify(i):String(i)}function UM(i,e,t,n){return new Error(`failed to ${i} "${BM(e)}" as ${t}`,{cause:n})}function Di(i,e,t){return UM("serialize",i,e,t)}class gE{constructor(e){this.description=e}}const h_="Bare Item",FM="Boolean";function $M(i){if(typeof i!="boolean")throw Di(i,FM);return i?"?1":"?0"}function GM(i){return btoa(String.fromCharCode(...i))}const VM="Byte Sequence";function HM(i){if(ArrayBuffer.isView(i)===!1)throw Di(i,VM);return`:${GM(i)}:`}const KM="Integer";function qM(i){return i<-999999999999999||999999999999999<i}function pE(i){if(qM(i))throw Di(i,KM);return i.toString()}function zM(i){return`@${pE(i.getTime()/1e3)}`}function xE(i,e){if(i<0)return-xE(-i,e);const t=Math.pow(10,e);if(Math.abs(i*t%1-.5)<Number.EPSILON){const r=Math.floor(i*t);return(r%2===0?r:r+1)/t}else return Math.round(i*t)/t}const YM="Decimal";function WM(i){const e=xE(i,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Di(i,YM);const t=e.toString();return t.includes(".")?t:`${t}.0`}const QM="String",XM=/[\x00-\x1f\x7f]+/;function JM(i){if(XM.test(i))throw Di(i,QM);return`"${i.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function ZM(i){return i.description||i.toString().slice(7,-1)}const e3="Token";function f_(i){const e=ZM(i);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Di(e,e3);return e}function Sg(i){switch(typeof i){case"number":if(!Xe(i))throw Di(i,h_);return Number.isInteger(i)?pE(i):WM(i);case"string":return JM(i);case"symbol":return f_(i);case"boolean":return $M(i);case"object":if(i instanceof Date)return zM(i);if(i instanceof Uint8Array)return HM(i);if(i instanceof gE)return f_(i);default:throw Di(i,h_)}}const t3="Key";function Eg(i){if(/^[a-z*][a-z0-9\-_.*]*$/.test(i)===!1)throw Di(i,t3);return i}function I0(i){return i==null?"":Object.entries(i).map(([e,t])=>t===!0?`;${Eg(e)}`:`;${Eg(e)}=${Sg(t)}`).join("")}function yE(i){return i instanceof ki?`${Sg(i.value)}${I0(i.params)}`:Sg(i)}function s3(i){return`(${i.value.map(yE).join(" ")})${I0(i.params)}`}function n3(i,e={whitespace:!0}){if(typeof i!="object"||i==null)throw Di(i,PM);const t=i instanceof Map?i.entries():Object.entries(i),n=e?.whitespace?" ":"";return Array.from(t).map(([r,o])=>{o instanceof ki||(o=new ki(o));let c=Eg(r);return o.value===!0?c+=I0(o.params):(c+="=",Array.isArray(o.value)?c+=s3(o):c+=yE(o)),c}).join(`,${n}`)}function vE(i,e){return n3(i,e)}const Ni="CMCD-Object",Ns="CMCD-Request",pr="CMCD-Session",Oa="CMCD-Status",i3={br:Ni,ab:Ni,d:Ni,ot:Ni,tb:Ni,tpb:Ni,lb:Ni,tab:Ni,lab:Ni,url:Ni,pb:Ns,bl:Ns,tbl:Ns,dl:Ns,ltc:Ns,mtp:Ns,nor:Ns,nrr:Ns,rc:Ns,sn:Ns,sta:Ns,su:Ns,ttfb:Ns,ttfbb:Ns,ttlb:Ns,cmsdd:Ns,cmsds:Ns,smrt:Ns,df:Ns,cs:Ns,ts:Ns,cid:pr,pr,sf:pr,sid:pr,st:pr,v:pr,msd:pr,bs:Oa,bsd:Oa,cdn:Oa,rtp:Oa,bg:Oa,pt:Oa,ec:Oa,e:Oa},a3={REQUEST:Ns};function r3(i){return Object.keys(i).reduce((e,t)=>{var n;return(n=i[t])===null||n===void 0||n.forEach(r=>e[r]=t),e},{})}function o3(i,e){const t={};if(!i)return t;const n=Object.keys(i),r=e?r3(e):{};return n.reduce((o,c)=>{var d;const h=i3[c]||r[c]||a3.REQUEST,u=(d=o[h])!==null&&d!==void 0?d:o[h]={};return u[c]=i[c],o},t)}function l3(i){return["ot","sf","st","e","sta"].includes(i)}function c3(i){return typeof i=="number"?Xe(i):i!=null&&i!==""&&i!==!1}const bE="event";function d3(i,e){const t=new URL(i),n=new URL(e);if(t.origin!==n.origin)return i;const r=t.pathname.split("/").slice(1),o=n.pathname.split("/").slice(1,-1);for(;r[0]===o[0];)r.shift(),o.shift();for(;o.length;)o.shift(),r.unshift("..");return r.join("/")+t.search+t.hash}const fu=i=>Math.round(i),Ng=(i,e)=>Array.isArray(i)?i.map(t=>Ng(t,e)):i instanceof ki&&typeof i.value=="string"?new ki(Ng(i.value,e),i.params):(e.baseUrl&&(i=d3(i,e.baseUrl)),e.version===1?encodeURIComponent(i):i),Kd=i=>fu(i/100)*100,u3=(i,e)=>{let t=i;return e.version>=2&&(i instanceof ki&&typeof i.value=="string"?t=new ki([i]):typeof i=="string"&&(t=[i])),Ng(t,e)},h3={br:fu,d:fu,bl:Kd,dl:Kd,mtp:Kd,nor:u3,rtp:Kd,tb:fu},_E="request",SE="response",M0=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],f3=["e"],m3=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Xu(i){return m3.test(i)}function g3(i){return M0.includes(i)||f3.includes(i)||Xu(i)}const EE=["d","dl","nor","ot","rtp","su"];function p3(i){return M0.includes(i)||EE.includes(i)||Xu(i)}const x3=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function y3(i){return M0.includes(i)||EE.includes(i)||x3.includes(i)||Xu(i)}const v3=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function b3(i){return v3.includes(i)||Xu(i)}const _3={[SE]:y3,[bE]:g3,[_E]:p3};function NE(i,e={}){const t={};if(i==null||typeof i!="object")return t;const n=e.version||i.v||1,r=e.reportingMode||_E,o=n===1?b3:_3[r];let c=Object.keys(i).filter(o);const d=e.filter;typeof d=="function"&&(c=c.filter(d));const h=r===SE||r===bE;h&&!c.includes("ts")&&c.push("ts"),n>1&&!c.includes("v")&&c.push("v");const u=ns({},h3,e.formatters),m={version:n,reportingMode:r,baseUrl:e.baseUrl};return c.sort().forEach(g=>{let x=i[g];const y=u[g];if(typeof y=="function"&&(x=y(x,m)),g==="v"){if(n===1)return;x=n}g=="pr"&&x===1||(h&&g==="ts"&&!Xe(x)&&(x=Date.now()),c3(x)&&(l3(g)&&typeof x=="string"&&(x=new gE(x)),t[g]=x))}),t}function S3(i,e={}){const t={};if(!i)return t;const n=NE(i,e),r=o3(n,e?.customHeaderMap);return Object.entries(r).reduce((o,[c,d])=>{const h=vE(d,{whitespace:!1});return h&&(o[c]=h),o},t)}function E3(i,e,t){return ns(i,S3(e,t))}const N3="CMCD";function w3(i,e={}){return i?vE(NE(i,e),{whitespace:!1}):""}function T3(i,e={}){if(!i)return"";const t=w3(i,e);return encodeURIComponent(t)}function A3(i,e={}){if(!i)return"";const t=T3(i,e);return`${N3}=${t}`}const m_=/CMCD=[^&#]+/;function j3(i,e,t){const n=A3(e,t);if(!n)return i;if(m_.test(i))return i.replace(m_,n);const r=i.includes("?")?"&":"?";return`${i}${r}${n}`}class C3{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:_n.MANIFEST,su:!this.initialized})}catch(o){this.hls.logger.warn("Could not generate manifest CMCD data.",o)}},this.applyFragmentData=r=>{try{const{frag:o,part:c}=r,d=this.hls.levels[o.level],h=this.getObjectType(o),u={d:(c||o).duration*1e3,ot:h};(h===_n.VIDEO||h===_n.AUDIO||h==_n.MUXED)&&(u.br=d.bitrate/1e3,u.tb=this.getTopBandwidth(h)/1e3,u.bl=this.getBufferLength(h));const m=c?this.getNextPart(c):this.getNextFrag(o);m!=null&&m.url&&m.url!==o.url&&(u.nor=m.url),this.apply(r,u)}catch(o){this.hls.logger.warn("Could not generate segment CMCD data.",o)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(F.MEDIA_DETACHED,this.onMediaDetached,this),e.on(F.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(F.MEDIA_DETACHED,this.onMediaDetached,this),e.off(F.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,r;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(r=t.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:OM.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){ns(t,this.createData());const n=t.ot===_n.INIT||t.ot===_n.VIDEO||t.ot===_n.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((c,d)=>(r.includes(d)&&(c[d]=t[d]),c),{}));const o={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),E3(e.headers,t,o)):e.url=j3(e.url,t,o)}getNextFrag(e){var t;const n=(t=this.hls.levels[e.level])==null?void 0:t.details;if(n){const r=e.sn-n.startSN;return n.fragments[r+1]}}getNextPart(e){var t;const{index:n,fragment:r}=e,o=(t=this.hls.levels[r.level])==null||(t=t.details)==null?void 0:t.partList;if(o){const{sn:c}=r;for(let d=o.length-1;d>=0;d--){const h=o[d];if(h.index===n&&h.fragment.sn===c)return o[d+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return _n.TIMED_TEXT;if(e.sn==="initSegment")return _n.INIT;if(t==="audio")return _n.AUDIO;if(t==="main")return this.hls.audioTracks.length?_n.VIDEO:_n.MUXED}getTopBandwidth(e){let t=0,n;const r=this.hls;if(e===_n.AUDIO)n=r.audioTracks;else{const o=r.maxAutoLevel,c=o>-1?o+1:r.levels.length;n=r.levels.slice(0,c)}return n.forEach(o=>{o.bitrate>t&&(t=o.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,n=e===_n.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:yt.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(o){this.loader=void 0,this.loader=new n(o)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(o,c,d){t(o),this.loader.load(o,c,d)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(o){this.loader=void 0,this.loader=new n(o)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(o,c,d){t(o),this.loader.load(o,c,d)}}}}const R3=3e5;class L3 extends ai{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(F.MANIFEST_PARSED,this.onManifestParsed,this),e.on(F.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(F.MANIFEST_PARSED,this.onManifestParsed,this),e.off(F.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if(n?.action===Js.SendAlternateToPenaltyBox&&n.flags===Pn.MoveAllAlternatesMatchingHost){const r=this.levels;let o=this._pathwayPriority,c=this.pathwayId;if(t.context){const{groupId:d,pathwayId:h,type:u}=t.context;d&&r?c=this.getPathwayForGroupId(d,u,c):h&&(c=h)}c in this.penalizedPathways||(this.penalizedPathways[c]=performance.now()),!o&&r&&(o=this.pathways()),o&&o.length>1&&(this.updatePathwayPriority(o),n.resolved=this.pathwayId!==c),t.details===_e.BUFFER_APPEND_ERROR&&!t.fatal?n.resolved=!0:n.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${c} levels: ${r&&r.length} priorities: ${os(o)} penalized: ${os(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const n=this.penalizedPathways,r=performance.now();Object.keys(n).forEach(o=>{r-n[o]>R3&&delete n[o]});for(let o=0;o<e.length;o++){const c=e[o];if(c in n)continue;if(c===this.pathwayId)return;const d=this.hls.nextLoadLevel,h=this.hls.levels[d];if(t=this.getLevelsForPathway(c),t.length>0){this.log(`Setting Pathway to "${c}"`),this.pathwayId=c,H1(t),this.hls.trigger(F.LEVELS_UPDATED,{levels:t});const u=this.hls.levels[d];h&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==h.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==h.bitrate&&this.log(`Unstable Pathways change from bitrate ${h.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=d);break}}}getPathwayForGroupId(e,t,n){const r=this.getLevelsForPathway(n).concat(this.levels||[]);for(let o=0;o<r.length;o++)if(t===Rt.AUDIO_TRACK&&r[o].hasAudioGroup(e)||t===Rt.SUBTITLE_TRACK&&r[o].hasSubtitleGroup(e))return r[o].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},r={};e.forEach(o=>{const{ID:c,"BASE-ID":d,"URI-REPLACEMENT":h}=o;if(t.some(m=>m.pathwayId===c))return;const u=this.getLevelsForPathway(d).map(m=>{const g=new xs(m.attrs);g["PATHWAY-ID"]=c;const x=g.AUDIO&&`${g.AUDIO}_clone_${c}`,y=g.SUBTITLES&&`${g.SUBTITLES}_clone_${c}`;x&&(n[g.AUDIO]=x,g.AUDIO=x),y&&(r[g.SUBTITLES]=y,g.SUBTITLES=y);const v=wE(m.uri,g["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",h),S=new oc({attrs:g,audioCodec:m.audioCodec,bitrate:m.bitrate,height:m.height,name:m.name,url:v,videoCodec:m.videoCodec,width:m.width});if(m.audioGroups)for(let N=1;N<m.audioGroups.length;N++)S.addGroupId("audio",`${m.audioGroups[N]}_clone_${c}`);if(m.subtitleGroups)for(let N=1;N<m.subtitleGroups.length;N++)S.addGroupId("text",`${m.subtitleGroups[N]}_clone_${c}`);return S});t.push(...u),g_(this.audioTracks,n,h,c),g_(this.subtitleTracks,r,h,c)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let r;try{r=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){const m=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+m)}const o={responseType:"json",url:r.href},c=t.steeringManifestLoadPolicy.default,d=c.errorRetry||c.timeoutRetry||{},h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:d.maxNumRetry||0,retryDelay:d.retryDelayMs||0,maxRetryDelay:d.maxRetryDelayMs||0},u={onSuccess:(m,g,x,y)=>{this.log(`Loaded steering manifest: "${r}"`);const v=m.data;if(v?.VERSION!==1){this.log(`Steering VERSION ${v.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=v.TTL;const{"RELOAD-URI":S,"PATHWAY-CLONES":N,"PATHWAY-PRIORITY":A}=v;if(S)try{this.uri=new self.URL(S,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${S}`);return}this.scheduleRefresh(this.uri||x.url),N&&this.clonePathways(N);const R={steeringManifest:v,url:r.toString()};this.hls.trigger(F.STEERING_MANIFEST_LOADED,R),A&&this.updatePathwayPriority(A)},onError:(m,g,x,y)=>{if(this.log(`Error loading steering manifest: ${m.code} ${m.text} (${g.url})`),this.stopLoad(),m.code===410){this.enabled=!1,this.log(`Steering manifest ${g.url} no longer available`);return}let v=this.timeToLoad*1e3;if(m.code===429){const S=this.loader;if(typeof S?.getResponseHeader=="function"){const N=S.getResponseHeader("Retry-After");N&&(v=parseFloat(N)*1e3)}this.log(`Steering manifest ${g.url} rate limited`);return}this.scheduleRefresh(this.uri||g.url,v)},onTimeout:(m,g,x)=>{this.log(`Timeout loading steering manifest (${g.url})`),this.scheduleRefresh(this.uri||g.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(o,h,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var n;const r=(n=this.hls)==null?void 0:n.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function g_(i,e,t,n){i&&Object.keys(e).forEach(r=>{const o=i.filter(c=>c.groupId===r).map(c=>{const d=ns({},c);return d.details=void 0,d.attrs=new xs(d.attrs),d.url=d.attrs.URI=wE(c.url,c.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),d.groupId=d.attrs["GROUP-ID"]=e[r],d.attrs["PATHWAY-ID"]=n,d});i.push(...o)})}function wE(i,e,t,n){const{HOST:r,PARAMS:o,[t]:c}=n;let d;e&&(d=c?.[e],d&&(i=d));const h=new self.URL(i);return r&&!d&&(h.host=r),o&&Object.keys(o).sort().forEach(u=>{u&&h.searchParams.set(u,o[u])}),h.href}class Bo extends ai{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Bo.CDMCleanupPromise?[Bo.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:n,initData:r}=t,o=`"${t.type}" event: init data type: "${n}"`;if(this.debug(o),r!==null){if(!this.keyFormatPromise){let c=Object.keys(this.keySystemAccessPromises);c.length||(c=Zl(this.config));const d=c.map(ym).filter(h=>!!h);this.keyFormatPromise=this.getKeyFormatPromise(d)}this.keyFormatPromise.then(c=>{const d=du(c);if(n!=="sinf"||d!==ys.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${n}" for selected key-system ${d}`);return}let h;try{const y=Bs(new Uint8Array(r)),v=E0(JSON.parse(y).sinf),S=v1(v);if(!S)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");h=new Uint8Array(S.subarray(8,24))}catch(y){this.warn(`${o} Failed to parse sinf: ${y}`);return}const u=Zs(h),{keyIdToKeySessionPromise:m,mediaKeySessions:g}=this;let x=m[u];for(let y=0;y<g.length;y++){const v=g[y],S=v.decryptdata;if(!S.keyId)continue;const N=Zs(S.keyId);if(Cu(h,S.keyId)||S.uri.replace(/-/g,"").indexOf(u)!==-1){if(x=m[N],!x)continue;if(S.pssh)break;delete m[N],S.pssh=new Uint8Array(r),S.keyId=h,x=m[u]=x.then(()=>this.generateRequestWithPreferredKeySession(v,n,r,"encrypted-event-key-match")),x.catch(A=>this.handleError(A));break}}x||this.handleError(new Error(`Key ID ${u} not encountered in playlist. Key-system sessions ${g.length}.`))}).catch(c=>this.handleError(c))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(F.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(F.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(F.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(F.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(F.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(F.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(F.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(F.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(F.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(F.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,r=t?.[e];if(r)return r.licenseUrl;if(e===ys.WIDEVINE&&n)return n}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t?.[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(c,d,h)=>!!c&&h.indexOf(c)===d,r=t.map(c=>c.audioCodec).filter(n),o=t.map(c=>c.videoCodec).filter(n);return r.length+o.length===0&&o.push("avc1.42e01e"),new Promise((c,d)=>{const h=u=>{const m=u.shift();this.getMediaKeysPromise(m,r,o).then(g=>c({keySystem:m,mediaKeys:g})).catch(g=>{u.length?h(u):g instanceof On?d(g):d(new On({type:tt.KEY_SYSTEM_ERROR,details:_e.KEY_SYSTEM_NO_ACCESS,error:g,fatal:!0},g.message))})};h(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${n}`;return O1===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return n(e,t)}getMediaKeysPromise(e,t,n){var r;const o=uI(e,t,n,this.config.drmSystemOptions||{});let c=this.keySystemAccessPromises[e],d=(r=c)==null?void 0:r.keySystemAccess;if(!d){this.log(`Requesting encrypted media "${e}" key-system access with config: ${os(o)}`),d=this.requestMediaKeySystemAccess(e,o);const h=c=this.keySystemAccessPromises[e]={keySystemAccess:d};return d.catch(u=>{this.log(`Failed to obtain access to key-system "${e}": ${u}`)}),d.then(u=>{this.log(`Access for key-system "${u.keySystem}" obtained`);const m=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const g=h.mediaKeys=u.createMediaKeys().then(x=>(this.log(`Media-keys created for "${e}"`),h.hasMediaKeys=!0,m.then(y=>y?this.setMediaKeysServerCertificate(x,e,y):x)));return g.catch(x=>{this.error(`Failed to create media-keys for "${e}"}: ${x}`)}),g})}return d.then(()=>c.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${Zs(e.keyId||[])} keyUri: ${e.uri}`);const r=n.createSession(),o={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(o),o}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),r=qd(t),o="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(n,o,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyId ${Zs(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>ym(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:n})=>this.attemptSetMediaKeys(t,n))}selectKeySystem(e){return new Promise((t,n)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:r})=>{const o=ym(r);o?t(o):n(new Error(`Unable to find format for key-system "${r}"`))}).catch(n)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Zl(this.config),n=e.map(du).filter(r=>!!r&&t.indexOf(r)!==-1);return this.selectKeySystem(n)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let n=0;n<t.length;n++){const r=k3(e,t[n]);if(r)return r}}loadKey(e){const t=e.keyInfo.decryptdata,n=qd(t),r=this.bannedKeyIds[n];if(r||this.getKeyStatus(t)==="internal-error"){const d=p_(r||"internal-error",t);return this.handleError(d,e.frag),Promise.reject(d)}const o=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${o}`);const c=this.keyIdToKeySessionPromise[n];if(!c){const d=this.getKeySystemForKeyPromise(t).then(({keySystem:h,mediaKeys:u})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${o}`),this.attemptSetMediaKeys(h,u).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:h,mediaKeys:u,decryptdata:t}))))).then(h=>{const u="cenc",m=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(h,u,m,"playlist-key")});return d.catch(h=>this.handleError(h,e.frag)),this.keyIdToKeySessionPromise[n]=d,d}return c.catch(d=>{if(d instanceof On){const h=Qt({},d.data);this.getKeyStatus(t)==="internal-error"&&(h.decryptdata=t);const u=new On(h,d.message);this.handleError(u,e.frag)}}),c}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof On){t&&(e.data.frag=t);const n=e.data.decryptdata;this.error(`${e.message}${n?` (${Zs(n.keyId||[])})`:""}`),this.hls.trigger(F.ERROR,e.data)}else this.error(e.message),this.hls.trigger(F.ERROR,{type:tt.KEY_SYSTEM_ERROR,details:_e.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=qd(e),n=this.keyIdToKeySessionPromise[t];if(!n){const r=du(e.keyFormat),o=r?[r]:Zl(this.config);return this.attemptKeySystemAccess(o)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=Zl(this.config)),e.length===0)throw new On({type:tt.KEY_SYSTEM_ERROR,details:_e.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${os({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(n).then(()=>this.media?this.media.setMediaKeys(t):new Promise((o,c)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return c(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(o).catch(c)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(o=>n.indexOf(o)===-1)})}generateRequestWithPreferredKeySession(e,t,n,r){var o;const c=(o=this.config.drmSystems)==null||(o=o[e.keySystem])==null?void 0:o.generateRequest;if(c)try{const v=c.call(this.hls,t,n,e);if(!v)throw new Error("Invalid response from configured generateRequest filter");t=v.initDataType,n=v.initData?v.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(v){if(this.warn(v.message),this.hls&&this.hls.config.debug)throw v}if(n===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const d=qd(e.decryptdata),h=e.decryptdata.uri;this.log(`Generating key-session request for "${r}" keyId: ${d} URI: ${h} (init data type: ${t} length: ${n.byteLength})`);const u=new w0,m=e._onmessage=v=>{const S=e.mediaKeysSession;if(!S){u.emit("error",new Error("invalid state"));return}const{messageType:N,message:A}=v;this.log(`"${N}" message event for session "${S.sessionId}" message size: ${A.byteLength}`),N==="license-request"||N==="license-renewal"?this.renewLicense(e,A).catch(R=>{u.eventNames().length?u.emit("error",R):this.handleError(R)}):N==="license-release"?e.keySystem===ys.FAIRPLAY&&this.updateKeySession(e,pg("acknowledged")).then(()=>this.removeSession(e)).catch(R=>this.handleError(R)):this.warn(`unhandled media key message type "${N}"`)},g=(v,S)=>{S.keyStatus=v;let N;v.startsWith("usable")?u.emit("resolved"):v==="internal-error"||v==="output-restricted"||v==="output-downscaled"?N=p_(v,S.decryptdata):v==="expired"?N=new Error(`key expired (keyId: ${d})`):v==="released"?N=new Error("key released"):v==="status-pending"||this.warn(`unhandled key status change "${v}" (keyId: ${d})`),N&&(u.eventNames().length?u.emit("error",N):this.handleError(N))},x=e._onkeystatuseschange=v=>{if(!e.mediaKeysSession){u.emit("error",new Error("invalid state"));return}const N=this.getKeyStatuses(e);if(!Object.keys(N).some(D=>N[D]!=="status-pending"))return;if(N[d]==="expired"){this.log(`Expired key ${os(N)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let R=N[d];if(R)g(R,e);else{var C;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(C=e.keyStatusTimeouts)[d]||(C[d]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const V=this.getKeyStatus(e.decryptdata);if(V&&V!=="status-pending")return this.log(`No status for keyId ${d} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${V} from other session.`),g(V,e);this.log(`key status for ${d} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),R="internal-error",g(R,e)},1e3)),this.log(`No status for keyId ${d} (${os(N)}).`)}};hn(e.mediaKeysSession,"message",m),hn(e.mediaKeysSession,"keystatuseschange",x);const y=new Promise((v,S)=>{u.on("error",S),u.on("resolved",v)});return e.mediaKeysSession.generateRequest(t,n).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${d} URI: ${h}`)}).catch(v=>{throw new On({type:tt.KEY_SYSTEM_ERROR,details:_e.KEY_SYSTEM_NO_SESSION,error:v,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${v}`)}).then(()=>y).catch(v=>(u.removeAllListeners(),this.removeSession(e).then(()=>{throw v}))).then(()=>(u.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((n,r)=>{if(typeof r=="string"&&typeof n=="object"){const d=r;r=n,n=d}const o="buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);if(e.keySystem===ys.PLAYREADY&&o.length===16){const d=Zs(o);t[d]=n,I1(o)}const c=Zs(o);n==="internal-error"&&(this.bannedKeyIds[c]=n),this.log(`key status change "${n}" for keyStatuses keyId: ${c} key-session "${e.mediaKeysSession.sessionId}"`),t[c]=n}),t}fetchServerCertificate(e){const t=this.config,n=t.loader,r=new n(t),o=this.getServerCertificateUrl(e);return o?(this.log(`Fetching server certificate for "${e}"`),new Promise((c,d)=>{const h={responseType:"arraybuffer",url:o},u=t.certLoadPolicy.default,m={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(x,y,v,S)=>{c(x.data)},onError:(x,y,v,S)=>{d(new On({type:tt.KEY_SYSTEM_ERROR,details:_e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:Qt({url:h.url,data:void 0},x)},`"${e}" certificate request failed (${o}). Status: ${x.code} (${x.text})`))},onTimeout:(x,y,v)=>{d(new On({type:tt.KEY_SYSTEM_ERROR,details:_e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:{url:h.url,data:void 0}},`"${e}" certificate request timed out (${o})`))},onAbort:(x,y,v)=>{d(new Error("aborted"))}};r.load(h,m,g)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((r,o)=>{e.setServerCertificate(n).then(c=>{this.log(`setServerCertificate ${c?"success":"not supported by CDM"} (${n.byteLength}) on "${t}"`),r(e)}).catch(c=>{o(new On({type:tt.KEY_SYSTEM_ERROR,details:_e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:c,fatal:!0},c.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(r=>{throw new On({type:tt.KEY_SYSTEM_ERROR,details:_e.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:r,fatal:!1},r.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=new DOMParser().parseFromString(n,"application/xml"),o=r.querySelectorAll("HttpHeader");if(o.length>0){let m;for(let g=0,x=o.length;g<x;g++){var c,d;m=o[g];const y=(c=m.querySelector("name"))==null?void 0:c.textContent,v=(d=m.querySelector("value"))==null?void 0:d.textContent;y&&v&&e.setRequestHeader(y,v)}}const h=r.querySelector("Challenge"),u=h?.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return pg(atob(u))}setupLicenseXHR(e,t,n,r){const o=this.config.licenseXhrSetup;return o?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return o.call(this.hls,e,t,n,r)}).catch(c=>{if(!n.decryptdata)throw c;return e.open("POST",t,!0),o.call(this.hls,e,t,n,r)}).then(c=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:c||r})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((r,o)=>{const c=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${c}`);const d=new XMLHttpRequest;d.responseType="arraybuffer",d.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return o(new Error("invalid state"));if(d.readyState===4)if(d.status===200){this._requestLicenseFailureCount=0;let h=d.response;this.log(`License received ${h instanceof ArrayBuffer?h.byteLength:h}`);const u=this.config.licenseResponseCallback;if(u)try{h=u.call(this.hls,d,c,e)}catch(m){this.error(m)}r(h)}else{const h=n.errorRetry,u=h?h.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||d.status>=400&&d.status<500)o(new On({type:tt.KEY_SYSTEM_ERROR,details:_e.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:d,response:{url:c,data:void 0,code:d.status,text:d.statusText}},`License Request XHR failed (${c}). Status: ${d.status} (${d.statusText})`));else{const m=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${m} attempts left`),this.requestLicense(e,t).then(r,o)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=d,this.setupLicenseXHR(d,c,e,t).then(({xhr:h,licenseChallenge:u})=>{e.keySystem==ys.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(h,u)),h.send(u)}).catch(o)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,hn(n,"encrypted",this.onMediaEncrypted),hn(n,"waitingforkey",this.onWaitingForKey);const r=this.mediaResolved;r?r():this.mediaKeys=n.mediaKeys}onMediaDetached(){const e=this.media;e&&(Sn(e,"encrypted",this.onMediaEncrypted),Sn(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const n=this.media,r=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Ga.clearKeyUriToKeyIdMap();const o=r.length;Bo.CDMCleanupPromise=Promise.all(r.map(c=>this.removeSession(c)).concat((n==null||(e=n.setMediaKeys(null))==null?void 0:e.catch(c=>{this.log(`Could not clear media keys: ${c}`),this.hls&&this.hls.trigger(F.ERROR,{type:tt.OTHER_ERROR,details:_e.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${c}`)})}))||Promise.resolve())).catch(c=>{this.log(`Could not close sessions and clear media keys: ${c}`),this.hls&&this.hls.trigger(F.ERROR,{type:tt.OTHER_ERROR,details:_e.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${c}`)})}).then(()=>{o&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=t.reduce((r,o)=>(r.indexOf(o.keyFormat)===-1&&r.push(o.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n,decryptdata:r}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Zs(r?.keyId||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const o=this.mediaKeySessions.indexOf(e);o>-1&&this.mediaKeySessions.splice(o,1);const{keyStatusTimeouts:c}=e;c&&Object.keys(c).forEach(u=>self.clearTimeout(c[u]));const{drmSystemOptions:d}=this.config;return(fI(d)?new Promise((u,m)=>{self.setTimeout(()=>m(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(u).catch(m)}):Promise.resolve()).catch(u=>{this.log(`Could not remove session: ${u}`),this.hls&&this.hls.trigger(F.ERROR,{type:tt.OTHER_ERROR,details:_e.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${u}`)})}).then(()=>t.close()).catch(u=>{this.log(`Could not close session: ${u}`),this.hls&&this.hls.trigger(F.ERROR,{type:tt.OTHER_ERROR,details:_e.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${u}`)})})}return Promise.resolve()}}Bo.CDMCleanupPromise=void 0;function qd(i){if(!i)throw new Error("Could not read keyId of undefined decryptdata");if(i.keyId===null)throw new Error("keyId is null");return Zs(i.keyId)}function k3(i,e){if(i.keyId&&e.mediaKeysSession.keyStatuses.has(i.keyId))return e.mediaKeysSession.keyStatuses.get(i.keyId);if(i.matches(e.decryptdata))return e.keyStatus}class On extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function p_(i,e){const t=i==="output-restricted",n=t?_e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:_e.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new On({type:tt.KEY_SYSTEM_ERROR,details:n,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${i}"`)}class D3{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(F.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(F.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(F.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(F.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const r=performance.now();if(t){if(this.lastTime){const o=r-this.lastTime,c=n-this.lastDroppedFrames,d=t-this.lastDecodedFrames,h=1e3*c/o,u=this.hls;if(u.trigger(F.FPS_DROP,{currentDropped:c,currentDecoded:d,totalDroppedFrames:n}),h>0&&c>u.config.fpsDroppedMonitoringThreshold*d){let m=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+m),m>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=m)&&(m=m-1,u.trigger(F.FPS_DROP_LEVEL_CAPPING,{level:m,droppedLevel:u.currentLevel}),u.autoLevelCapping=m,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function TE(i,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=i,e.dispatchEvent(t)}function AE(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues&&!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){Xt.debug(`[texttrack-utils]: ${n}`);try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,i.addCue(r)}catch(r){Xt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}t==="disabled"&&(i.mode=t)}function Ro(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues)for(let n=i.cues.length;n--;)e&&i.cues[n].removeEventListener("enter",e),i.removeCue(i.cues[n]);t==="disabled"&&(i.mode=t)}function wg(i,e,t,n){const r=i.mode;if(r==="disabled"&&(i.mode="hidden"),i.cues&&i.cues.length>0){const o=M3(i.cues,e,t);for(let c=0;c<o.length;c++)(!n||n(o[c]))&&i.removeCue(o[c])}r==="disabled"&&(i.mode=r)}function I3(i,e){if(e<=i[0].startTime)return 0;const t=i.length-1;if(e>i[t].endTime)return-1;let n=0,r=t,o;for(;n<=r;)if(o=Math.floor((r+n)/2),e<i[o].startTime)r=o-1;else if(e>i[o].startTime&&n<t)n=o+1;else return o;return i[n].startTime-e<e-i[r].startTime?n:r}function M3(i,e,t){const n=[],r=I3(i,e);if(r>-1)for(let o=r,c=i.length;o<c;o++){const d=i[o];if(d.startTime>=e&&d.endTime<=t)n.push(d);else if(d.startTime>t)return n}return n}function mu(i){const e=[];for(let t=0;t<i.length;t++){const n=i[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(i[t])}return e}class O3 extends k0{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const n=mu(this.media.textTracks);for(let o=0;o<n.length;o++)if(n[o].mode==="hidden")t=n[o];else if(n[o].mode==="showing"){t=n[o];break}const r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.MANIFEST_PARSED,this.onManifestParsed,this),e.on(F.LEVEL_LOADING,this.onLevelLoading,this),e.on(F.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(F.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(F.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.MANIFEST_PARSED,this.onManifestParsed,this),e.off(F.LEVEL_LOADING,this.onLevelLoading,this),e.off(F.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(F.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(F.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;mu(n.textTracks).forEach(c=>{Ro(c)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:r,details:o}=t,c=this.tracksInGroup[n];if(!c||c.groupId!==r){this.warn(`Subtitle track with id:${n} and group:${r} not found in active group ${c?.groupId}`);return}const d=c.details;c.details=t.details,this.log(`Subtitle track ${n} "${c.name}" lang:${c.lang} group:${r} loaded [${o.startSN}-${o.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,d)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,r=this.groupIds;let o=this.currentTrack;if(!n||r?.length!==n?.length||n!=null&&n.some(c=>r?.indexOf(c)===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const c=this.tracks.filter(m=>!n||n.indexOf(m.groupId)!==-1);if(c.length)this.selectDefaultTrack&&!c.some(m=>m.default)&&(this.selectDefaultTrack=!1),c.forEach((m,g)=>{m.id=g});else if(!o&&!this.tracksInGroup.length)return;this.tracksInGroup=c;const d=this.hls.config.subtitlePreference;if(!o&&d){this.selectDefaultTrack=!1;const m=Ai(d,c);if(m>-1)o=c[m];else{const g=Ai(d,this.tracks);o=this.tracks[g]}}let h=this.findTrackId(o);h===-1&&o&&(h=this.findTrackId(null));const u={subtitleTracks:c};this.log(`Updating subtitle tracks, ${c.length} track(s) found in "${n?.join(",")}" group-id`),this.hls.trigger(F.SUBTITLE_TRACKS_UPDATED,u),h!==-1&&this.trackId===-1&&this.setSubtitleTrack(h)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const o=t[r];if(!(n&&!o.default||!n&&!e)&&(!e||Cr(o,e)))return r}if(e){for(let r=0;r<t.length;r++){const o=t[r];if(uc(e.attrs,o.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const o=t[r];if(uc(e.attrs,o.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const r=t[n];if(_g(r,e))return n}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Rt.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&Cr(e,n))return n;const r=Ai(e,this.tracksInGroup);if(r>-1){const o=this.tracksInGroup[r];return this.setSubtitleTrack(r),o}else{if(n)return null;{const o=Ai(e,t);if(o>-1)return t[o]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,r=e.groupId,o=this.getUrlWithDirectives(e.url,t),c=e.details,d=c?.age;this.log(`Loading subtitle ${n} "${e.name}" lang:${e.lang} group:${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${d&&c.live?" age "+d.toFixed(1)+(c.type&&" "+c.type||""):""} ${o}`),this.hls.trigger(F.SUBTITLE_TRACK_LOADING,{url:o,id:n,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=mu(e.textTracks),n=this.currentTrack;let r;if(n&&(r=t.filter(o=>_g(n,o))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(o=>{o.mode!=="disabled"&&o!==r&&(o.mode="disabled")}),r){const o=this.subtitleDisplay?"showing":"hidden";r.mode!==o&&(r.mode=o)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Xe(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(F.SUBTITLE_TRACK_SWITCH,{id:e});return}const o=!!r.details&&!r.details.live;if(e===this.trackId&&r===n&&o)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:c,groupId:d="",name:h,type:u,url:m}=r;this.hls.trigger(F.SUBTITLE_TRACK_SWITCH,{id:c,groupId:d,name:h,type:u,url:m});const g=this.switchParams(r.url,n?.details,r.details);this.loadPlaylist(g)}}function P3(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const o=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(r=="x"?o:o&3|8).toString(16)})}}}function sc(i){let e=5381,t=i.length;for(;t;)e=e*33^i.charCodeAt(--t);return(e>>>0).toString()}const Uo=.025;let Du=(function(i){return i[i.Point=0]="Point",i[i.Range=1]="Range",i})({});function B3(i,e,t){return`${i.identifier}-${t+1}-${sc(e)}`}class U3{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;return e<=0||isNaN(n)?!1:n===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Am(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,n=Am(t,e);return t-n<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Xe(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Am(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Uo))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Du.Range:Du.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return F3(this)}}function Am(i,e){return i-e.start<e.duration/2&&!(Math.abs(i-(e.start+e.duration))<Uo)?e.start:e.start+e.duration}function jE(i,e,t){const n=new self.URL(i,t);return n.protocol!=="data:"&&n.searchParams.set("_HLS_primary_id",e),n}function jm(i,e){for(;(t=i.assetList[++e])!=null&&t.error;)var t;return e}function F3(i){return`["${i.identifier}" ${i.cue.pre?"<pre>":i.cue.post?"<post>":""}${i.timelineStart.toFixed(2)}-${i.resumeTime.toFixed(2)}]`}function jo(i){const e=i.timelineStart,t=i.duration||0;return`["${i.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class $3{constructor(e,t,n,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(F.PLAYOUT_LIMIT_REACHED,{})};const o=this.hls=new e(t);this.interstitial=n,this.assetItem=r;const c=()=>{this.hasDetails=!0};o.once(F.LEVEL_LOADED,c),o.once(F.AUDIO_TRACK_LOADED,c),o.once(F.SUBTITLE_TRACK_LOADED,c),o.on(F.MEDIA_ATTACHING,(d,{media:h})=>{this.removeMediaListeners(),this.mediaAttached=h,this.interstitial.playoutLimit&&(h.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&o.on(F.BUFFER_APPENDED,()=>{const m=this.bufferedEnd;this.reachedPlayout(m)&&(this._bufferedEosTime=m,o.trigger(F.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=jE(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,o=yt.bufferInfo(e,r,0);return this.getAssetTime(o.end)>=n-.02}reachedPlayout(e){const n=this.interstitial.playoutLimit;return this.startOffset+e>=n}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=yt.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const n=t-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=n=>delete n.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){var r;(r=this.hls)==null||r.on(e,t)}once(e,t,n){var r;(r=this.hls)==null||r.once(e,t)}off(e,t,n){var r;(r=this.hls)==null||r.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${jo(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const x_=.033;class G3 extends ai{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[n]||(t===void 0&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&(o=r[n])!=null&&o.event;){var o;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let r=0;r<n.length;r++){let o=n[r];if(t&&t!=="primary"&&(o=o[t]),e===o.start||e>o.start&&e<o.end)return r}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let r=e;r<=t&&n[r];r++){const o=n[r].event;if(o!=null&&o.restrictions.jump&&!o.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var n;if(((n=t[r].event)==null?void 0:n.identifier)===e)return r}return-1}findAssetIndex(e,t){const n=e.assetList,r=n.length;if(r>1)for(let o=0;o<r;o++){const c=n[o];if(!c.error){const d=c.timelineStart;if(t===d||t>d&&(t<d+(c.duration||0)||o===r-1))return o}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const n=t.assetList,r=n[n.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:r}=n,o=this.events,c=this.parseDateRanges(r,{url:n.url},t),d=Object.keys(r),h=o?o.filter(u=>!d.includes(u.identifier)):[];c.length&&c.sort((u,m)=>{const g=u.cue.pre,x=u.cue.post,y=m.cue.pre,v=m.cue.post;if(g&&!y)return-1;if(y&&!g||x&&!v)return 1;if(v&&!x)return-1;if(!g&&!y&&!x&&!v){const S=u.startTime,N=m.startTime;if(S!==N)return S-N}return u.dateRange.tagOrder-m.dateRange.tagOrder}),this.events=c,h.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,h)}updateSchedule(e,t=[],n=!1){const r=this.events||[];if(r.length||t.length||this.length<2){const o=this.items,c=this.parseSchedule(r,e);(n||t.length||o?.length!==c.length||c.some((h,u)=>Math.abs(h.playout.start-o[u].playout.start)>.005||Math.abs(h.playout.end-o[u].playout.end)>.005))&&(this.items=c,this.onScheduleUpdate(t,o))}}parseDateRanges(e,t,n){const r=[],o=Object.keys(e);for(let c=0;c<o.length;c++){const d=o[c],h=e[d];if(h.isInterstitial){let u=this.eventMap[d];u?u.setDateRange(h):(u=new U3(h,t),this.eventMap[d]=u,n===!1&&(u.appendInPlace=n)),r.push(u)}}return r}parseSchedule(e,t){const n=[],r=t.main.details,o=r.live?1/0:r.edge;let c=0;if(e=e.filter(h=>!h.error&&!(h.cue.once&&h.hasPlayed)),e.length){this.resolveOffsets(e,t);let h=0,u=0;if(e.forEach((m,g)=>{const x=m.cue.pre,y=m.cue.post,v=e[g-1]||null,S=m.appendInPlace,N=y?o:m.startOffset,A=m.duration,R=m.timelineOccupancy===Du.Range?A:0,C=m.resumptionOffset,D=v?.startTime===N,V=N+m.cumulativeDuration;let z=S?V+A:N+C;if(x||!y&&N<=0){const I=u;u+=R,m.timelineStart=V;const M=c;c+=A,n.push({event:m,start:V,end:z,playout:{start:M,end:c},integrated:{start:I,end:u}})}else if(N<=o){if(!D){const L=N-h;if(L>x_){const O=h,J=u;u+=L;const ie=c;c+=L;const ne={previousEvent:e[g-1]||null,nextEvent:m,start:O,end:O+L,playout:{start:ie,end:c},integrated:{start:J,end:u}};n.push(ne)}else L>0&&v&&(v.cumulativeDuration+=L,n[n.length-1].end=N)}y&&(z=V),m.timelineStart=V;const I=u;u+=R;const M=c;c+=A,n.push({event:m,start:V,end:z,playout:{start:M,end:c},integrated:{start:I,end:u}})}else return;const B=m.resumeTime;y||B>o?h=o:h=B}),h<o){var d;const m=h,g=u,x=o-h;u+=x;const y=c;c+=x,n.push({previousEvent:((d=n[n.length-1])==null?void 0:d.event)||null,nextEvent:null,start:h,end:m+x,playout:{start:y,end:c},integrated:{start:g,end:u}})}this.setDurations(o,c,u)}else n.push({previousEvent:null,nextEvent:null,start:0,end:o,playout:{start:0,end:o},integrated:{start:0,end:o}}),this.setDurations(o,o,o);return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,r=n.live?1/0:n.edge;let o=0,c=-1;e.forEach((d,h)=>{const u=d.cue.pre,m=d.cue.post,g=u?0:m?r:d.startTime;this.updateAssetDurations(d),c===g?d.cumulativeDuration=o:(o=0,c=g),!m&&d.snapOptions.in&&(d.resumeAnchor=Mr(null,n.fragments,d.startOffset+d.resumptionOffset,0,0)||void 0),d.appendInPlace&&!d.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(d,t)||(d.appendInPlace=!1)),!d.appendInPlace&&h+1<e.length&&e[h+1].startTime-e[h].resumeTime<x_&&(e[h+1].appendInPlace=!1,e[h+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${d}`));const y=Xe(d.resumeOffset)?d.resumeOffset:d.duration;o+=y})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(n-r)>Uo?(this.log(`"${e.identifier}" resumption ${n} not aligned with estimated timeline end ${r}`),!1):!Object.keys(t).some(c=>{const d=t[c].details,h=d.edge;if(n>=h)return this.log(`"${e.identifier}" resumption ${n} past ${c} playlist end ${h}`),!1;const u=Mr(null,d.fragments,n);if(!u)return this.log(`"${e.identifier}" resumption ${n} does not align with any fragments in ${c} playlist (${d.fragStart}-${d.fragmentEnd})`),!0;const m=c==="audio"?.175:0;return Math.abs(u.start-n)<Uo+m||Math.abs(u.end-n)<Uo+m?!1:(this.log(`"${e.identifier}" resumption ${n} not aligned with ${c} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,r=!1,o=!1;for(let c=0;c<e.assetList.length;c++){const d=e.assetList[c],h=t+n;d.startOffset=n,d.timelineStart=h,r||(r=d.duration===null),o||(o=!!d.error);const u=d.error?0:d.duration||0;n+=u}r&&!o?e.duration=Math.max(n,e.duration):e.duration=n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function hi(i){return`[${i.event?'"'+i.event.identifier+'"':"primary"}: ${i.start.toFixed(2)}-${i.end.toFixed(2)}]`}class V3{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let r;try{r=jE(n,this.hls.sessionId,e.baseUrl)}catch(x){const y=this.assignAssetListError(e,_e.ASSET_LIST_LOAD_ERROR,x,n);this.hls.trigger(F.ERROR,y);return}t&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+t);const o=this.hls.config,c=o.loader,d=new c(o),h={responseType:"json",url:r.href},u=o.interstitialAssetListLoadPolicy.default,m={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(x,y,v,S)=>{const N=x.data,A=N?.ASSETS;if(!Array.isArray(A)){const R=this.assignAssetListError(e,_e.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),v.url,y,S);this.hls.trigger(F.ERROR,R);return}e.assetListResponse=N,this.hls.trigger(F.ASSET_LIST_LOADED,{event:e,assetListResponse:N,networkDetails:S})},onError:(x,y,v,S)=>{const N=this.assignAssetListError(e,_e.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${x.code} ${x.text} (${y.url})`),y.url,S,v);this.hls.trigger(F.ERROR,N)},onTimeout:(x,y,v)=>{const S=this.assignAssetListError(e,_e.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${y.url})`),y.url,x,v);this.hls.trigger(F.ERROR,S)}};return d.load(h,m,g),this.hls.trigger(F.ASSET_LIST_LOADING,{event:e}),d}assignAssetListError(e,t,n,r,o,c){return e.error=n,{type:tt.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:n,networkDetails:c,stats:o}}}function y_(i){var e;i==null||(e=i.play())==null||e.catch(()=>{})}function zd(i,e){return`[${i}] Advancing timeline position to ${e}`}class H3 extends ai{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled||!this.schedule)return;const r=n-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const c=r<=-.01;this.timelinePos=n,this.bufferedPos=n;const d=this.playingItem;if(!d){this.checkBuffer();return}if(c&&this.schedule.resetErrorsInRange(n,n-r)&&this.updateSchedule(!0),this.checkBuffer(),c&&n<d.start||n>=d.end){var h;const y=this.findItemIndex(d);let v=this.schedule.findItemIndexAtTime(n);if(v===-1&&(v=y+(c?-1:1),this.log(`seeked ${c?"back ":""}to position not covered by schedule ${n} (resolving from ${y} to ${v})`)),!this.isInterstitial(d)&&(h=this.media)!=null&&h.paused&&(this.shouldPlay=!1),!c&&v>y){const S=this.schedule.findJumpRestrictedIndex(y+1,v);if(S>y){this.setSchedulePosition(S);return}}this.setSchedulePosition(v);return}const u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(d)){const y=d.event.assetList[0];y&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(n,y))}return}const m=u.timelineStart,g=u.duration||0;if(c&&n<m||n>=m+g){var x;(x=d.event)!=null&&x.appendInPlace&&(this.clearAssetPlayers(d.event,d),this.flushFrontBuffer(n)),this.setScheduleToAssetAtTime(n,u)}},this.onTimeupdate=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;if(n>this.timelinePos)this.timelinePos=n,n>this.bufferedPos&&this.checkBuffer();else return;const r=this.playingItem;if(!r||this.playingLastItem)return;if(n>=r.end){this.timelinePos=r.end;const d=this.findItemIndex(r);this.setSchedulePosition(d+1)}const o=this.playingAsset;if(!o)return;const c=o.timelineStart+(o.duration||0);n>=c&&this.setScheduleToAssetAtTime(n,o)},this.onScheduleUpdate=(n,r)=>{const o=this.schedule;if(!o)return;const c=this.playingItem,d=o.events||[],h=o.items||[],u=o.durations,m=n.map(S=>S.identifier),g=!!(d.length||m.length);(g||r)&&this.log(`INTERSTITIALS_UPDATED (${d.length}): ${d}
Schedule: ${h.map(S=>hi(S))} pos: ${this.timelinePos}`),m.length&&this.log(`Removed events ${m}`);let x=null,y=null;c&&(x=this.updateItem(c,this.timelinePos),this.itemsMatch(c,x)?this.playingItem=x:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const v=this.bufferingItem;if(v&&(y=this.updateItem(v,this.bufferedPos),this.itemsMatch(v,y)?this.bufferingItem=y:v.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(v.event,null))),n.forEach(S=>{S.assetList.forEach(N=>{this.clearAssetPlayer(N.identifier,null)})}),this.playerQueue.forEach(S=>{if(S.interstitial.appendInPlace){const N=S.assetItem.timelineStart,A=S.timelineOffset-N;if(A)try{S.timelineOffset=N}catch(R){Math.abs(A)>Uo&&this.warn(`${R} ("${S.assetId}" ${S.timelineOffset}->${N})`)}}}),g||r){if(this.hls.trigger(F.INTERSTITIALS_UPDATED,{events:d.slice(0),schedule:h.slice(0),durations:u,removedIds:m}),this.isInterstitial(c)&&m.includes(c.event.identifier)){this.warn(`Interstitial "${c.event.identifier}" removed while playing`),this.primaryFallback(c.event);return}c&&this.trimInPlace(x,c),v&&y!==x&&this.trimInPlace(y,v),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new V3(e),this.schedule=new G3(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(F.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(F.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(F.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(F.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(F.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(F.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(F.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(F.BUFFER_APPENDED,this.onBufferAppended,this),e.on(F.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(F.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(F.MEDIA_ENDED,this.onMediaEnded,this),e.on(F.ERROR,this.onError,this),e.on(F.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(F.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(F.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(F.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(F.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(F.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(F.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(F.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(F.BUFFER_CODECS,this.onBufferCodecs,this),e.off(F.BUFFER_APPENDED,this.onBufferAppended,this),e.off(F.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(F.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(F.MEDIA_ENDED,this.onMediaEnded,this),e.off(F.ERROR,this.onError,this),e.off(F.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Sn(e,"play",this.onPlay),Sn(e,"pause",this.onPause),Sn(e,"seeking",this.onSeeking),Sn(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;hn(n,"seeking",this.onSeeking),hn(n,"timeupdate",this.onTimeupdate),hn(n,"play",this.onPlay),hn(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,n===null)this.checkStart();else if(!r){this.clearScheduleState();const o=this.findItemIndex(n);this.setSchedulePosition(o)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,r=this.media;if(this.media=null,!n&&(r&&this.removeMediaListeners(r),this.detachedData)){const o=this.getBufferingPlayer();o&&(this.log(`Removing schedule state for detachedData and ${o}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,o.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=g=>g&&e.getAssetPlayer(g.identifier),r=(g,x,y,v,S)=>{if(g){let N=g[x].start;const A=g.event;if(A){if(x==="playout"||A.timelineOccupancy!==Du.Point){const R=n(y);R?.interstitial===A&&(N+=R.assetItem.startOffset+R[S])}}else{const R=v==="bufferedPos"?c():e[v];N+=R-g.start}return N}return 0},o=(g,x)=>{var y;if(g!==0&&x!=="primary"&&(y=e.schedule)!=null&&y.length){var v;const S=e.schedule.findItemIndexAtTime(g),N=(v=e.schedule.items)==null?void 0:v[S];if(N){const A=N[x].start-N.start;return g+A}}return g},c=()=>{const g=e.bufferedPos;return g===Number.MAX_VALUE?d("primary"):Math.max(g,0)},d=g=>{var x,y;return(x=e.primaryDetails)!=null&&x.live?e.primaryDetails.edge:((y=e.schedule)==null?void 0:y.durations[g])||0},h=(g,x)=>{var y,v;const S=e.effectivePlayingItem;if(S!=null&&(y=S.event)!=null&&y.restrictions.skip||!e.schedule)return;e.log(`seek to ${g} "${x}"`);const N=e.effectivePlayingItem,A=e.schedule.findItemIndexAtTime(g,x),R=(v=e.schedule.items)==null?void 0:v[A],C=e.getBufferingPlayer(),D=C?.interstitial,V=D?.appendInPlace,z=N&&e.itemsMatch(N,R);if(N&&(V||z)){const B=n(e.playingAsset),I=B?.media||e.primaryMedia;if(I){const M=x==="primary"?I.currentTime:r(N,x,e.playingAsset,"timelinePos","currentTime"),L=g-M,O=(V?M:I.currentTime)+L;if(O>=0&&(!B||V||O<=B.duration)){I.currentTime=O;return}}}if(R){let B=g;if(x!=="primary"){const M=R[x].start,L=g-M;B=R.start+L}const I=!e.isInterstitial(R);if((!e.isInterstitial(N)||N.event.appendInPlace)&&(I||R.event.appendInPlace)){const M=e.media||(V?C?.media:null);M&&(M.currentTime=B)}else if(N){const M=e.findItemIndex(N);if(A>M){const O=e.schedule.findJumpRestrictedIndex(M+1,A);if(O>M){e.setSchedulePosition(O);return}}let L=0;if(I)e.timelinePos=B,e.checkBuffer();else{const O=R.event.assetList,J=g-(R[x]||R).start;for(let ie=O.length;ie--;){const ne=O[ie];if(ne.duration&&J>=ne.startOffset&&J<ne.startOffset+ne.duration){L=ie;break}}}e.setSchedulePosition(A,L)}}},u=()=>{const g=e.effectivePlayingItem;if(e.isInterstitial(g))return g;const x=t();return e.isInterstitial(x)?x:null},m={get bufferedEnd(){const g=t(),x=e.bufferingItem;if(x&&x===g){var y;return r(x,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-x.playout.start||((y=e.bufferingAsset)==null?void 0:y.startOffset)||0}return 0},get currentTime(){const g=u(),x=e.effectivePlayingItem;return x&&x===g?r(x,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-x.playout.start:0},set currentTime(g){const x=u(),y=e.effectivePlayingItem;y&&y===x&&h(g+y.playout.start,"playout")},get duration(){const g=u();return g?g.playout.end-g.playout.start:0},get assetPlayers(){var g;const x=(g=u())==null?void 0:g.event.assetList;return x?x.map(y=>e.getAssetPlayer(y.identifier)):[]},get playingIndex(){var g;const x=(g=u())==null?void 0:g.event;return x&&e.effectivePlayingAsset?x.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};return this.manager={get events(){var g;return((g=e.schedule)==null||(g=g.events)==null?void 0:g.slice(0))||[]},get schedule(){var g;return((g=e.schedule)==null||(g=g.items)==null?void 0:g.slice(0))||[]},get interstitialPlayer(){return u()?m:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const g=t();return e.findItemIndex(g)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const g=e.effectivePlayingItem;return e.findItemIndex(g)},primary:{get bufferedEnd(){return c()},get currentTime(){const g=e.timelinePos;return g>0?g:0},set currentTime(g){h(g,"primary")},get duration(){return d("primary")},get seekableStart(){var g;return((g=e.primaryDetails)==null?void 0:g.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(g){h(g,"integrated")},get duration(){return d("integrated")},get seekableStart(){var g;return o(((g=e.primaryDetails)==null?void 0:g.fragmentStart)||0,"integrated")}},skip:()=>{const g=e.effectivePlayingItem,x=g?.event;if(x&&!x.restrictions.skip){const y=e.findItemIndex(g);if(x.appendInPlace){const v=g.playout.start+g.event.duration;h(v+.001,"playout")}else e.advanceAfterAssetEnded(x,y,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!n?!1:this.findItemIndex(t)===n.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let r=this.media;!r&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(r=this.primaryMedia);const o=(t=r)==null?void 0:t.currentTime;if(!(o===void 0||!Xe(o)))return o}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,r=e.media;if(n&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r){this.detachedData={media:r};return}const o=e.transferMedia();this.log(`transfer MediaSource from ${e} ${os(o)}`),this.detachedData=o}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var n,r;if(e.media===t)return;let o=null;const c=this.hls,d=e!==c,h=d&&e.interstitial.appendInPlace,u=(n=this.detachedData)==null?void 0:n.mediaSource;let m;if(c.media)h&&(o=c.transferMedia(),this.detachedData=o),m="Primary";else if(u){const v=this.getBufferingPlayer();v?(o=v.transferMedia(),m=`${v}`):m="detached MediaSource"}else m="detached media";if(!o){if(u)o=this.detachedData,this.log(`using detachedData: MediaSource ${os(o)}`);else if(!this.detachedData||c.media===t){const v=this.playerQueue;v.length>1&&v.forEach(S=>{if(d&&S.interstitial.appendInPlace!==h){const N=S.interstitial;this.clearInterstitial(S.interstitial,null),N.appendInPlace=!1,N.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${N}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const g=o&&"mediaSource"in o&&((r=o.mediaSource)==null?void 0:r.readyState)!=="closed",x=g&&o?o:t;this.log(`${g?"transfering MediaSource":"attaching media"} to ${d?e:"Primary"} from ${m} (media.currentTime: ${t.currentTime})`);const y=this.schedule;if(x===o&&y){const v=d&&e.assetId===y.assetIdAtEnd;x.overrides={duration:y.duration,endOfStream:!d||v,cueRemoval:!d}}e.attachMedia(x)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const n=this.timelinePos,r=this.effectivePlayingItem;if(n===-1){const o=this.hls.startPosition;if(this.log(zd("checkStart",o)),this.timelinePos=o,t.length&&t[0].cue.pre){const c=e.findEventIndex(t[0].identifier);this.setSchedulePosition(c)}else if(o>=0||!this.primaryLive){const c=this.timelinePos=o>0?o:0,d=e.findItemIndexAtTime(c);this.setSchedulePosition(d)}}else if(r&&!this.playingItem){const o=e.findItemIndex(r);this.setSchedulePosition(o)}}advanceAssetBuffering(e,t){const n=e.event,r=n.findAssetIndex(t),o=jm(n,r);if(!n.isAssetPastPlayoutLimit(o))this.bufferedToEvent(e,o);else if(this.schedule){var c;const d=(c=this.schedule.items)==null?void 0:c[this.findItemIndex(e)+1];d&&this.bufferedToItem(d)}}advanceAfterAssetEnded(e,t,n){const r=jm(e,n);if(e.isAssetPastPlayoutLimit(r)){if(this.schedule){const o=this.schedule.items;if(o){const c=t+1,d=o.length;if(c>=d){this.setSchedulePosition(-1);return}const h=e.resumeTime;this.timelinePos<h&&(this.log(zd("advanceAfterAssetEnded",h)),this.timelinePos=h,e.appendInPlace&&this.advanceInPlace(h),this.checkBuffer(this.bufferedPos<h)),this.setSchedulePosition(c)}}}else{if(e.appendInPlace){const o=e.assetList[r];o&&this.advanceInPlace(o.timelineStart)}this.setSchedulePosition(t,r)}}setScheduleToAssetAtTime(e,t){const n=this.schedule;if(!n)return;const r=t.parentIdentifier,o=n.getEvent(r);if(o){const c=n.findEventIndex(r),d=n.findAssetIndex(o,e);this.advanceAfterAssetEnded(o,c,d-1)}}setSchedulePosition(e,t){var n;const r=(n=this.schedule)==null?void 0:n.items;if(!r||this.playbackDisabled)return;const o=e>=0?r[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${o&&hi(o)}) pos: ${this.timelinePos}`);const c=this.waitingItem||this.playingItem,d=this.playingLastItem;if(this.isInterstitial(c)){const m=c.event,g=this.playingAsset,x=g?.identifier,y=x?this.getAssetPlayer(x):null;if(y&&x&&(!this.eventItemsMatch(c,o)||t!==void 0&&x!==m.assetList[t].identifier)){var h;const v=m.findAssetIndex(g);if(this.log(`INTERSTITIAL_ASSET_ENDED ${v+1}/${m.assetList.length} ${jo(g)}`),this.endedAsset=g,this.playingAsset=null,this.hls.trigger(F.INTERSTITIAL_ASSET_ENDED,{asset:g,assetListIndex:v,event:m,schedule:r.slice(0),scheduleIndex:e,player:y}),c!==this.playingItem){this.itemsMatch(c,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(m,this.findItemIndex(this.playingItem),v);return}this.retreiveMediaSource(x,o),y.media&&!((h=this.detachedData)!=null&&h.mediaSource)&&y.detachMedia()}if(!this.eventItemsMatch(c,o)&&(this.endedItem=c,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${m} ${hi(c)}`),m.hasPlayed=!0,this.hls.trigger(F.INTERSTITIAL_ENDED,{event:m,schedule:r.slice(0),scheduleIndex:e}),m.cue.once)){var u;this.updateSchedule();const v=(u=this.schedule)==null?void 0:u.items;if(o&&v){const S=this.findItemIndex(o);this.advanceSchedule(S,v,t,c,d)}return}}this.advanceSchedule(e,r,t,c,d)}advanceSchedule(e,t,n,r,o){const c=this.schedule;if(!c)return;const d=t[e]||null,h=this.primaryMedia,u=this.playerQueue;if(u.length&&u.forEach(m=>{const g=m.interstitial,x=c.findEventIndex(g.identifier);(x<e||x>e+1)&&this.clearInterstitial(g,d)}),this.isInterstitial(d)){this.timelinePos=Math.min(Math.max(this.timelinePos,d.start),d.end);const m=d.event;if(n===void 0){n=c.findAssetIndex(m,this.timelinePos);const v=jm(m,n-1);if(m.isAssetPastPlayoutLimit(v)||m.appendInPlace&&this.timelinePos===d.end){this.advanceAfterAssetEnded(m,e,n);return}n=v}const g=this.waitingItem;this.assetsBuffered(d,h)||this.setBufferingItem(d);let x=this.preloadAssets(m,n);if(this.eventItemsMatch(d,g||r)||(this.waitingItem=d,this.log(`INTERSTITIAL_STARTED ${hi(d)} ${m.appendInPlace?"append in place":""}`),this.hls.trigger(F.INTERSTITIAL_STARTED,{event:m,schedule:t.slice(0),scheduleIndex:e})),!m.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${m}`);return}if(m.assetListLoader&&(m.assetListLoader.destroy(),m.assetListLoader=void 0),!h){this.log(`Waiting for attachMedia to start Interstitial ${m}`);return}this.waitingItem=this.endedItem=null,this.playingItem=d;const y=m.assetList[n];if(!y){this.advanceAfterAssetEnded(m,e,n||0);return}if(x||(x=this.getAssetPlayer(y.identifier)),x===null||x.destroyed){const v=m.assetList.length;this.warn(`asset ${n+1}/${v} player destroyed ${m}`),x=this.createAssetPlayer(m,y,n),x.loadSource()}if(!this.eventItemsMatch(d,this.bufferingItem)&&m.appendInPlace&&this.isAssetBuffered(y))return;this.startAssetPlayer(x,n,t,e,h),this.shouldPlay&&y_(x.media)}else d?(this.resumePrimary(d,e,r),this.shouldPlay&&y_(this.hls.media)):o&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(c.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,n){var r,o;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${hi(e)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let d=this.timelinePos;(d<e.start||d>=e.end)&&(d=this.getPrimaryResumption(e,t),this.log(zd("resumePrimary",d)),this.timelinePos=d),this.attachPrimary(d,e)}if(!n)return;const c=(o=this.schedule)==null?void 0:o.items;c&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${hi(e)}`),this.hls.trigger(F.INTERSTITIALS_PRIMARY_RESUMED,{schedule:c.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const r=this.primaryDetails;if(t===0)return this.hls.startPosition;if(r&&(n<r.fragmentStart||n>r.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:yt.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const o=this.hls;o.media?this.checkBuffer():(this.transferMediaTo(o,r),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(zd("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((n=r.mainForwardBufferInfo)==null?void 0:n.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(F.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(F.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const n=this.hls.levels[t.level];if(!n.details)return;const r=Qt(Qt({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Qt(Qt({},this.altSelection),{},{audio:n});return}const o=Qt(Qt({},r),{},{audio:n});this.mediaSelection=o}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Qt(Qt({},this.altSelection),{},{subtitles:n});return}const o=Qt(Qt({},r),{},{subtitles:n});this.mediaSelection=o}onAudioTrackSwitching(e,t){const n=Ab(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setAudioOption(t)||r.setAudioOption(n)))}onSubtitleTrackSwitch(e,t){const n=Ab(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setSubtitleOption(t)||t.id!==-1&&r.setSubtitleOption(n)))}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let r=0;r<t.length;r++){const o=t[r];if(o.cue.post){var n;const c=this.schedule.findEventIndex(o.identifier),d=(n=this.schedule.items)==null?void 0:n[c];this.isInterstitial(d)&&this.eventItemsMatch(d,this.bufferingItem)&&this.bufferedToItem(d,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const n=this.findItemIndex(t);this.setSchedulePosition(n+1)}else this.shouldPlay=!1}updateItem(e,t){var n;const r=(n=this.schedule)==null?void 0:n.items;if(e&&r){const o=this.findItemIndex(e,t);return r[o]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((o,c)=>{e.event.isAssetPastPlayoutLimit(c)&&this.clearAssetPlayer(o.identifier,null)});const n=e.end+.25,r=yt.bufferInfo(this.primaryMedia,n,0);(r.end>n||(r.nextStart||0)>n)&&(this.log(`trim buffered interstitial ${hi(e)} (was ${hi(t)})`),this.attachPrimary(n,null,!0),this.flushFrontBuffer(n))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===((n=t.event)==null?void 0:n.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const n=this.mediaSelection;n&&((t=this.schedule)==null||t.updateSchedule(n,[],e))}checkBuffer(e){var t;const n=(t=this.schedule)==null?void 0:t.items;if(!n)return;const r=yt.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,n,e)}updateBufferedPos(e,t,n){const r=this.schedule,o=this.bufferingItem;if(this.bufferedPos>e||!r)return;if(t.length===1&&this.itemsMatch(t[0],o)){this.bufferedPos=e;return}const c=this.playingItem,d=this.findItemIndex(c);let h=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var u;const m=this.findItemIndex(o),g=Math.min(m+1,t.length-1),x=t[g];if((h===-1&&o&&e>=o.end||(u=x.event)!=null&&u.appendInPlace&&e+.01>=x.start)&&(h=g),this.isInterstitial(o)){const y=o.event;if(g-d>1&&y.appendInPlace===!1||y.assetList.length===0&&y.assetListLoader)return}if(this.bufferedPos=e,h>m&&h>d)this.bufferedToItem(x);else{const y=this.primaryDetails;this.primaryLive&&y&&e>y.edge-y.targetduration&&x.start<y.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(x)&&this.preloadAssets(x.event,0)}}else n&&c&&!this.itemsMatch(c,o)&&(h===d?this.bufferedToItem(c):h===d+1&&this.bufferedToItem(t[h]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(r=>{const o=this.getAssetPlayer(r.identifier);return!(o!=null&&o.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,t)&&n){const{items:r,events:o}=n;if(!r||!o)return t;const c=this.isInterstitial(e),d=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const h=d?d.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${hi(e)}`+(t?` (${h.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(c){const u=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((m,g)=>{const x=this.getAssetPlayer(m.identifier);x&&(g===u&&x.loadSource(),x.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering());this.hls.trigger(F.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:o.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const n=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(n!==null){this.bufferingAsset=null;const r=this.detachedData;r?r.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,r=n.assetList.length===0&&!n.assetListLoader,o=n.cue.once;if(r||!o){const c=this.preloadAssets(n,t);if(c!=null&&c.interstitial.appendInPlace){const d=this.primaryMedia;d&&this.bufferAssetPlayer(c,d)}}}preloadAssets(e,t){const n=e.assetUrl,r=e.assetList.length,o=r===0&&!e.assetListLoader,c=e.cue.once;if(o){const h=e.timelineStart;if(e.appendInPlace){var d;const x=this.playingItem;!this.isInterstitial(x)&&(x==null||(d=x.nextEvent)==null?void 0:d.identifier)===e.identifier&&this.flushFrontBuffer(h+.25)}let u,m=0;if(!this.playingItem&&this.primaryLive&&(m=this.hls.startPosition,m===-1&&(m=this.hls.liveSyncPosition||0)),m&&!(e.cue.pre||e.cue.post)){const x=m-h;x>0&&(u=Math.round(x*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${n?1:r} ${e}${u?` live-start: ${m} start-offset: ${u}`:""}`),n)return this.createAsset(e,0,0,h,e.duration,n);const g=this.assetListLoader.loadAssetList(e,u);g&&(e.assetListLoader=g)}else if(!c&&r){for(let u=t;u<r;u++){const m=e.assetList[u],g=this.getAssetPlayerQueueIndex(m.identifier);(g===-1||this.playerQueue[g].destroyed)&&!m.error&&this.createAssetPlayer(e,m,u)}const h=e.assetList[t];if(h){const u=this.getAssetPlayer(h.identifier);return u&&u.loadSource(),u}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(r=>{this.hls.trigger(F.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n]}return null}createAsset(e,t,n,r,o,c){const d={parentIdentifier:e.identifier,identifier:B3(e,c,t),duration:o,startOffset:n,timelineStart:r,uri:c};return this.createAssetPlayer(e,d,t)}createAssetPlayer(e,t,n){const r=this.hls,o=r.userConfig;let c=o.videoPreference;const d=r.loadLevelObj||r.levels[r.currentLevel];(c||d)&&(c=ns({},c),d.videoCodec&&(c.videoCodec=d.videoCodec),d.videoRange&&(c.allowedVideoRanges=[d.videoRange]));const h=r.audioTracks[r.audioTrack],u=r.subtitleTracks[r.subtitleTrack];let m=0;if(this.primaryLive||e.appendInPlace){const D=this.timelinePos-t.timelineStart;if(D>1){const V=t.duration;V&&D<V&&(m=D)}}const g=t.identifier,x=Qt(Qt({},o),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:g,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:m,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:c,audioPreference:h||o.audioPreference,subtitlePreference:u||o.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(x.timelineOffset=t.timelineStart));const y=x.cmcd;y!=null&&y.sessionId&&y.contentId&&(x.cmcd=ns({},y,{contentId:sc(t.uri)})),this.getAssetPlayer(g)&&this.warn(`Duplicate date range identifier ${e} and asset ${g}`);const v=new $3(this.HlsPlayerClass,x,e,t);this.playerQueue.push(v),e.assetList[n]=t;let S=!0;const N=D=>{if(D.live){var V;const I=new Error(`Interstitials MUST be VOD assets ${e}`),M={fatal:!0,type:tt.OTHER_ERROR,details:_e.INTERSTITIAL_ASSET_ITEM_ERROR,error:I},L=((V=this.schedule)==null?void 0:V.findEventIndex(e.identifier))||-1;this.handleAssetItemError(M,e,L,n,I.message);return}const z=D.edge-D.fragmentStart,B=t.duration;(S||B===null||z>B)&&(S=!1,this.log(`Interstitial asset "${g}" duration change ${B} > ${z}`),t.duration=z,this.updateSchedule())};v.on(F.LEVEL_UPDATED,(D,{details:V})=>N(V)),v.on(F.LEVEL_PTS_UPDATED,(D,{details:V})=>N(V)),v.on(F.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const A=(D,V)=>{const z=this.getAssetPlayer(g);if(z&&V.tracks){z.off(F.BUFFER_CODECS,A),z.tracks=V.tracks;const B=this.primaryMedia;this.bufferingAsset===z.assetItem&&B&&!z.media&&this.bufferAssetPlayer(z,B)}};v.on(F.BUFFER_CODECS,A);const R=()=>{var D;const V=this.getAssetPlayer(g);if(this.log(`buffered to end of asset ${V}`),!V||!this.schedule)return;const z=this.schedule.findEventIndex(e.identifier),B=(D=this.schedule.items)==null?void 0:D[z];this.isInterstitial(B)&&this.advanceAssetBuffering(B,t)};v.on(F.BUFFERED_TO_END,R);const C=D=>()=>{if(!this.getAssetPlayer(g)||!this.schedule)return;this.shouldPlay=!0;const z=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,z,D)};return v.once(F.MEDIA_ENDED,C(n)),v.once(F.PLAYOUT_LIMIT_REACHED,C(1/0)),v.on(F.ERROR,(D,V)=>{if(!this.schedule)return;const z=this.getAssetPlayer(g);if(V.details===_e.BUFFER_STALLED_ERROR){if(z!=null&&z.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(V,e,this.schedule.findEventIndex(e.identifier),n,`Asset player error ${V.error} ${e}`)}),v.on(F.DESTROYING,()=>{if(!this.getAssetPlayer(g)||!this.schedule)return;const V=new Error(`Asset player destroyed unexpectedly ${g}`),z={fatal:!0,type:tt.OTHER_ERROR,details:_e.INTERSTITIAL_ASSET_ITEM_ERROR,error:V};this.handleAssetItemError(z,e,this.schedule.findEventIndex(e.identifier),n,V.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${jo(t)}`),this.hls.trigger(F.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:v}),v}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(n=>{this.clearAssetPlayer(n.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(n!==-1){const r=this.playerQueue[n];this.log(`clear ${r} toSegment: ${t&&hi(t)}`),this.transferMediaFromPlayer(r,t),this.playerQueue.splice(n,1),r.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,r,o){const{interstitial:c,assetItem:d,assetId:h}=e,u=c.assetList.length,m=this.playingAsset;this.endedAsset=null,this.playingAsset=d,(!m||m.identifier!==h)&&(m&&(this.clearAssetPlayer(m.identifier,n[r]),delete m.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${u} ${jo(d)}`),this.hls.trigger(F.INTERSTITIAL_ASSET_STARTED,{asset:d,assetListIndex:t,event:c,schedule:n.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,o)}bufferAssetPlayer(e,t){var n,r;if(!this.schedule)return;const{interstitial:o,assetItem:c}=e,d=this.schedule.findEventIndex(o.identifier),h=(n=this.schedule.items)==null?void 0:n[d];if(!h)return;e.loadSource(),this.setBufferingItem(h),this.bufferingAsset=c;const u=this.getBufferingPlayer();if(u===e)return;const m=o.appendInPlace;if(m&&u?.interstitial.appendInPlace===!1)return;const g=u?.tracks||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(m&&c!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(g&&!d1(g,e.tracks)){const x=new Error(`Asset ${jo(c)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(g)}')`),y={fatal:!0,type:tt.OTHER_ERROR,details:_e.INTERSTITIAL_ASSET_ITEM_ERROR,error:x},v=o.findAssetIndex(c);this.handleAssetItemError(y,o,d,v,x.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,n=this.primaryMedia;if(!t||!n)return;const r=n.currentTime,o=t.findAssetIndex(e,r),c=e.assetList[o];if(c){const d=this.getAssetPlayer(c.identifier);if(d){const h=d.currentTime||r-c.timelineStart,u=d.duration-h;if(this.warn(`Stalled at ${h} of ${h+u} in ${d} ${e} (media.currentTime: ${r})`),h&&(u/n.playbackRate<.5||d.bufferedInPlaceToEnd(n))&&d.hls){const m=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,m,o)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,n,r,o){if(e.details===_e.BUFFER_STALLED_ERROR)return;const c=t.assetList[r]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${c&&jo(c)} ${e.error}`),!this.schedule)return;const d=c?.identifier||"",h=this.getAssetPlayerQueueIndex(d),u=this.playerQueue[h]||null,m=this.schedule.items,g=ns({},e,{fatal:!1,errorAction:Oo(!0),asset:c,assetListIndex:r,event:t,schedule:m,scheduleIndex:n,player:u});if(this.hls.trigger(F.INTERSTITIAL_ASSET_ERROR,g),!e.fatal)return;const x=this.playingAsset,y=this.bufferingAsset,v=new Error(o);if(c&&(this.clearAssetPlayer(d,null),c.error=v),!t.assetList.some(S=>!S.error))t.error=v;else for(let S=r;S<t.assetList.length;S++)this.resetAssetPlayer(t.assetList[S].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):x&&x.identifier===d?this.advanceAfterAssetEnded(t,n,r):y&&y.identifier===d&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,y)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;let r=this.timelinePos;if(n){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${r} playing: ${hi(n)} error: ${e.error}`),r===-1&&(r=this.hls.startPosition);const c=this.updateItem(n,r);this.itemsMatch(n,c)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(r===-1){this.checkStart();return}if(!this.schedule)return;const o=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(o)}onAssetListLoaded(e,t){var n,r;const o=t.event,c=o.identifier,d=t.assetListResponse.ASSETS;if(!((n=this.schedule)!=null&&n.hasEvent(c)))return;const h=o.timelineStart,u=o.duration;let m=0;d.forEach((S,N)=>{const A=parseFloat(S.DURATION);this.createAsset(o,N,m,h+m,A,S.URI),m+=A}),o.duration=m,this.log(`Loaded asset-list with duration: ${m} (was: ${u}) ${o}`);const g=this.waitingItem,x=g?.event.identifier===c;this.updateSchedule();const y=(r=this.bufferingItem)==null?void 0:r.event;if(x){var v;const S=this.schedule.findEventIndex(c),N=(v=this.schedule.items)==null?void 0:v[S];if(N){if(!this.playingItem&&this.timelinePos>N.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==S){o.error=new Error(`Interstitial ${d.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${o}`),this.log(o.error.message),this.updateSchedule(!0),this.primaryFallback(o);return}this.setBufferingItem(N)}this.setSchedulePosition(S)}else if(y?.identifier===c){const S=o.assetList[0];if(S){const N=this.getAssetPlayer(S.identifier);if(y.appendInPlace){const A=this.primaryMedia;N&&A&&this.bufferAssetPlayer(N,A)}else N&&N.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case _e.ASSET_LIST_PARSING_ERROR:case _e.ASSET_LIST_LOAD_ERROR:case _e.ASSET_LIST_LOAD_TIMEOUT:{const n=t.interstitial;n&&(this.updateSchedule(!0),this.primaryFallback(n));break}case _e.BUFFER_STALLED_ERROR:{const n=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&n.event.appendInPlace){this.handleInPlaceStall(n.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const v_=500;class K3 extends N0{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",Je.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(F.LEVEL_LOADED,this.onLevelLoaded,this),e.on(F.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(F.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(F.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(F.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(F.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(F.LEVEL_LOADED,this.onLevelLoaded,this),e.off(F.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(F.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(F.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(F.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(F.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=Me.IDLE,this.setInterval(v_),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:r}=t;if(this.fragContextChanged(n)||(Cs(n)&&(this.fragPrevious=n),this.state=Me.IDLE),!r)return;const o=this.tracksBuffered[this.currentTrackId];if(!o)return;let c;const d=n.start;for(let u=0;u<o.length;u++)if(d>=o[u].start&&d<=o[u].end){c=o[u];break}const h=n.start+n.duration;c?c.end=h:(c={start:d,end:h},o.push(c)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:r}=t;if(n===0&&r!==Number.POSITIVE_INFINITY){const o=r-1;if(o<=0)return;t.endOffsetSubtitles=Math.max(0,o),this.tracksBuffered.forEach(c=>{for(let d=0;d<c.length;){if(c[d].end<=o){c.shift();continue}else if(c[d].start<o)c[d].start=o;else break;d++}}),this.fragmentTracker.removeFragmentsInRange(n,o,Je.SUBTITLE)}}onError(e,t){const n=t.frag;n?.type===Je.SUBTITLE&&(t.details===_e.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Me.STOPPED&&(this.state=Me.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&fE(this.levels,t)){this.levels=t.map(n=>new oc(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{const r=new oc(n);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Je.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,!((n=this.levels)!=null&&n.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==Me.STOPPED&&this.setInterval(v_)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:r,levels:o}=this,{details:c,id:d}=t;if(!o){this.warn(`Subtitle tracks were reset while loading level ${d}`);return}const h=o[d];if(d>=o.length||!h)return;this.log(`Subtitle track ${d} loaded [${c.startSN},${c.endSN}]${c.lastPartSn?`[part-${c.lastPartSn}-${c.lastPartIndex}]`:""},duration:${c.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(c.live||(n=h.details)!=null&&n.live){if(c.deltaUpdateFailed)return;const g=this.mainDetails;if(!g){this.startFragRequested=!1;return}const x=g.fragments[0];if(!h.details)c.hasProgramDateTime&&g.hasProgramDateTime?(Lu(c,g),u=c.fragmentStart):x&&(u=x.start,yg(c,u));else{var m;u=this.alignPlaylists(c,h.details,(m=this.levelLastLoaded)==null?void 0:m.details),u===0&&x&&(u=x.start,yg(c,u))}g&&!this.startFragRequested&&this.setStartPosition(g,u)}h.details=c,this.levelLastLoaded=h,d===r&&(this.hls.trigger(F.SUBTITLE_TRACK_UPDATED,{details:c,id:d,groupId:t.groupId}),this.tick(),c.live&&!this.fragCurrent&&this.media&&this.state===Me.IDLE&&(Mr(null,c.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),h.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,r=t.decryptdata,o=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&r!=null&&r.key&&r.iv&&Po(r.method)){const c=performance.now();this.decrypter.decrypt(new Uint8Array(n),r.key.buffer,r.iv.buffer,S0(r.method)).catch(d=>{throw o.trigger(F.ERROR,{type:tt.MEDIA_ERROR,details:_e.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:t}),d}).then(d=>{const h=performance.now();o.trigger(F.FRAG_DECRYPTED,{frag:t,payload:d,stats:{tstart:c,tdecrypt:h}})}).catch(d=>{this.warn(`${d.name}: ${d.message}`),this.state=Me.IDLE})}}doTick(){if(!this.media){this.state=Me.IDLE;return}if(this.state===Me.IDLE){const{currentTrackId:e,levels:t}=this,n=t?.[e];if(!n||!t.length||!n.details||this.waitForLive(n))return;const{config:r}=this,o=this.getLoadPosition(),c=yt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],o,r.maxBufferHole),{end:d,len:h}=c,u=n.details,m=this.hls.maxBufferLength+u.levelTargetDuration;if(h>m)return;const g=u.fragments,x=g.length,y=u.edge;let v=null;const S=this.fragPrevious;if(d<y){const R=r.maxFragLookUpTolerance,C=d>y-R?0:R;v=Mr(S,g,Math.max(g[0].start,d),C),!v&&S&&S.start<g[0].start&&(v=g[0])}else v=g[x-1];if(v=this.filterReplacedPrimary(v,n.details),!v)return;const N=v.sn-u.startSN,A=g[N-1];if(A&&A.cc===v.cc&&this.fragmentTracker.getState(A)===Fs.NOT_LOADED&&(v=A),this.fragmentTracker.getState(v)===Fs.NOT_LOADED){const R=this.mapToInitFragWhenRequired(v);R&&this.loadFragment(R,n,d)}}}loadFragment(e,t,n){Cs(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new q3(this.tracksBuffered[this.currentTrackId]||[])}}class q3{constructor(e){this.buffered=void 0;const t=(n,r,o)=>{if(r=r>>>0,r>o-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${o})`);return e[r][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}const z3={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},CE=i=>String.fromCharCode(z3[i]||i),fi=15,ea=100,Y3={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},W3={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Q3={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},X3={25:2,26:4,29:6,30:8,31:10,27:13,28:15},J3=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Z3{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n=typeof t=="function"?t():t;Xt.log(`${this.time} [${e}] ${n}`)}}}const xr=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class RE{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class eO{constructor(){this.uchar=" ",this.penState=new RE}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class tO{constructor(e){this.chars=[],this.pos=0,this.currPenState=new RE,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<ea;t++)this.chars.push(new eO);this.logger=e}equals(e){for(let t=0;t<ea;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<ea;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<ea;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>ea&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=ea)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=CE(e);if(this.pos>=ea){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<ea;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<ea;n++){const r=this.chars[n].uchar;r!==" "&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Cm{constructor(e){this.rows=[],this.currRow=fi-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<fi;t++)this.rows.push(new tO(e));this.logger=e}reset(){for(let e=0;e<fi;e++)this.rows[e].clear();this.currRow=fi-1}equals(e){let t=!0;for(let n=0;n<fi;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<fi;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<fi;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+os(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let d=0;d<fi;d++)this.rows[d].clear();const o=this.currRow+1-this.nrRollUpRows,c=this.lastOutputScreen;if(c){const d=c.rows[o].cueStartTime,h=this.logger.time;if(d!==null&&h!==null&&d<h)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(c.rows[o+u])}}this.currRow=t;const n=this.rows[this.currRow];if(e.indent!==null){const o=e.indent,c=Math.max(o-1,0);n.setCursor(e.indent),e.color=n.chars[c].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+os(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",r=-1;for(let o=0;o<fi;o++){const c=this.rows[o].getTextString();c&&(r=o+1,e?t.push("Row "+r+": '"+c+"'"):t.push(c.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}}class b_{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Cm(n),this.nonDisplayedMemory=new Cm(n),this.lastOutputScreen=new Cm(n),this.currRollUpRow=this.displayedMemory.rows[fi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[fi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[n]}this.logger.log(2,"MIDROW: "+os(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class __{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=nO(),this.logger=void 0;const r=this.logger=new Z3;this.channels=[null,new b_(e,t,r),new b_(e+1,n,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const r=t[n]&127,o=t[n+1]&127;let c=!1,d=null;if(r===0&&o===0)continue;this.logger.log(3,()=>"["+xr([t[n],t[n+1]])+"] -> ("+xr([r,o])+")");const h=this.cmdHistory;if(r>=16&&r<=31){if(sO(r,o,h)){Yd(null,null,h),this.logger.log(3,()=>"Repeated command ("+xr([r,o])+") is dropped");continue}Yd(r,o,this.cmdHistory),c=this.parseCmd(r,o),c||(c=this.parseMidrow(r,o)),c||(c=this.parsePAC(r,o)),c||(c=this.parseBackgroundAttributes(r,o))}else Yd(null,null,h);if(!c&&(d=this.parseChars(r,o),d)){const m=this.currentChannel;m&&m>0?this.channels[m].insertChars(d):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!c&&!d&&this.logger.log(2,()=>"Couldn't parse cleaned data "+xr([r,o])+" orig: "+xr([t[n],t[n+1]]))}}parseCmd(e,t){const n=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=33&&t<=35;if(!(n||r))return!1;const o=e===20||e===21||e===23?1:2,c=this.channels[o];return e===20||e===21||e===28||e===29?t===32?c.ccRCL():t===33?c.ccBS():t===34?c.ccAOF():t===35?c.ccAON():t===36?c.ccDER():t===37?c.ccRU(2):t===38?c.ccRU(3):t===39?c.ccRU(4):t===40?c.ccFON():t===41?c.ccRDC():t===42?c.ccTR():t===43?c.ccRTD():t===44?c.ccEDM():t===45?c.ccCR():t===46?c.ccENM():t===47&&c.ccEOC():c.ccTO(t-32),this.currentChannel=o,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[n];return r?(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+xr([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n;const r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,o=(e===16||e===24)&&t>=64&&t<=95;if(!(r||o))return!1;const c=e<=23?1:2;t>=64&&t<=95?n=c===1?Y3[e]:Q3[e]:n=c===1?W3[e]:X3[e];const d=this.channels[c];return d?(d.setPAC(this.interpretPAC(n,t)),this.currentChannel=c,!0):!1}interpretPAC(e,t){let n;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,r.underline=(n&1)===1,n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((n-16)/2)*4,r}parseChars(e,t){let n,r=null,o=null;if(e>=25?(n=2,o=e-8):(n=1,o=e),o>=17&&o<=19){let c;o===17?c=t+80:o===18?c=t+112:c=t+144,this.logger.log(2,()=>"Special char '"+CE(c)+"' in channel "+n),r=[c]}else e>=32&&e<=127&&(r=t===0?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+xr(r).join(",")),r}parseBackgroundAttributes(e,t){const n=(e===16||e===24)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=45&&t<=47;if(!(n||r))return!1;let o;const c={};e===16||e===24?(o=Math.floor((t-32)/2),c.background=J3[o],t%2===1&&(c.background=c.background+"_semi")):t===45?c.background="transparent":(c.foreground="black",t===47&&(c.underline=!0));const d=e<=23?1:2;return this.channels[d].setBkgData(c),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Yd(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function Yd(i,e,t){t.a=i,t.b=e}function sO(i,e,t){return t.a===i&&t.b===e}function nO(){return{a:null,b:null}}var O0=(function(){if(Ru!=null&&Ru.VTTCue)return self.VTTCue;const i=["","lr","rl"],e=["start","middle","end","left","right"];function t(d,h){if(typeof h!="string"||!Array.isArray(d))return!1;const u=h.toLowerCase();return~d.indexOf(u)?u:!1}function n(d){return t(i,d)}function r(d){return t(e,d)}function o(d,...h){let u=1;for(;u<arguments.length;u++){const m=arguments[u];for(const g in m)d[g]=m[g]}return d}function c(d,h,u){const m=this,g={enumerable:!0};m.hasBeenReset=!1;let x="",y=!1,v=d,S=h,N=u,A=null,R="",C=!0,D="auto",V="start",z=50,B="middle",I=50,M="middle";Object.defineProperty(m,"id",o({},g,{get:function(){return x},set:function(L){x=""+L}})),Object.defineProperty(m,"pauseOnExit",o({},g,{get:function(){return y},set:function(L){y=!!L}})),Object.defineProperty(m,"startTime",o({},g,{get:function(){return v},set:function(L){if(typeof L!="number")throw new TypeError("Start time must be set to a number.");v=L,this.hasBeenReset=!0}})),Object.defineProperty(m,"endTime",o({},g,{get:function(){return S},set:function(L){if(typeof L!="number")throw new TypeError("End time must be set to a number.");S=L,this.hasBeenReset=!0}})),Object.defineProperty(m,"text",o({},g,{get:function(){return N},set:function(L){N=""+L,this.hasBeenReset=!0}})),Object.defineProperty(m,"region",o({},g,{get:function(){return A},set:function(L){A=L,this.hasBeenReset=!0}})),Object.defineProperty(m,"vertical",o({},g,{get:function(){return R},set:function(L){const O=n(L);if(O===!1)throw new SyntaxError("An invalid or illegal string was specified.");R=O,this.hasBeenReset=!0}})),Object.defineProperty(m,"snapToLines",o({},g,{get:function(){return C},set:function(L){C=!!L,this.hasBeenReset=!0}})),Object.defineProperty(m,"line",o({},g,{get:function(){return D},set:function(L){if(typeof L!="number"&&L!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");D=L,this.hasBeenReset=!0}})),Object.defineProperty(m,"lineAlign",o({},g,{get:function(){return V},set:function(L){const O=r(L);if(!O)throw new SyntaxError("An invalid or illegal string was specified.");V=O,this.hasBeenReset=!0}})),Object.defineProperty(m,"position",o({},g,{get:function(){return z},set:function(L){if(L<0||L>100)throw new Error("Position must be between 0 and 100.");z=L,this.hasBeenReset=!0}})),Object.defineProperty(m,"positionAlign",o({},g,{get:function(){return B},set:function(L){const O=r(L);if(!O)throw new SyntaxError("An invalid or illegal string was specified.");B=O,this.hasBeenReset=!0}})),Object.defineProperty(m,"size",o({},g,{get:function(){return I},set:function(L){if(L<0||L>100)throw new Error("Size must be between 0 and 100.");I=L,this.hasBeenReset=!0}})),Object.defineProperty(m,"align",o({},g,{get:function(){return M},set:function(L){const O=r(L);if(!O)throw new SyntaxError("An invalid or illegal string was specified.");M=O,this.hasBeenReset=!0}})),m.displayState=void 0}return c.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},c})();class iO{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function LE(i){function e(n,r,o,c){return(n|0)*3600+(r|0)*60+(o|0)+parseFloat(c||0)}const t=i.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class aO{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function kE(i,e,t,n){const r=n?i.split(n):[i];for(const o in r){if(typeof r[o]!="string")continue;const c=r[o].split(t);if(c.length!==2)continue;const d=c[0],h=c[1];e(d,h)}}const Tg=new O0(0,0,""),Wd=Tg.align==="middle"?"middle":"center";function rO(i,e,t){const n=i;function r(){const d=LE(i);if(d===null)throw new Error("Malformed timestamp: "+n);return i=i.replace(/^[^\sa-zA-Z-]+/,""),d}function o(d,h){const u=new aO;kE(d,function(x,y){let v;switch(x){case"region":for(let S=t.length-1;S>=0;S--)if(t[S].id===y){u.set(x,t[S].region);break}break;case"vertical":u.alt(x,y,["rl","lr"]);break;case"line":v=y.split(","),u.integer(x,v[0]),u.percent(x,v[0])&&u.set("snapToLines",!1),u.alt(x,v[0],["auto"]),v.length===2&&u.alt("lineAlign",v[1],["start",Wd,"end"]);break;case"position":v=y.split(","),u.percent(x,v[0]),v.length===2&&u.alt("positionAlign",v[1],["start",Wd,"end","line-left","line-right","auto"]);break;case"size":u.percent(x,y);break;case"align":u.alt(x,y,["start",Wd,"end","left","right"]);break}},/:/,/\s/),h.region=u.get("region",null),h.vertical=u.get("vertical","");let m=u.get("line","auto");m==="auto"&&Tg.line===-1&&(m=-1),h.line=m,h.lineAlign=u.get("lineAlign","start"),h.snapToLines=u.get("snapToLines",!0),h.size=u.get("size",100),h.align=u.get("align",Wd);let g=u.get("position","auto");g==="auto"&&Tg.position===50&&(g=h.align==="start"||h.align==="left"?0:h.align==="end"||h.align==="right"?100:50),h.position=g}function c(){i=i.replace(/^\s+/,"")}if(c(),e.startTime=r(),c(),i.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);i=i.slice(3),c(),e.endTime=r(),c(),o(i,e)}function DE(i){return i.replace(/<br(?: \/)?>/gi,`
`)}class oO{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new iO,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let o=t.buffer,c=0;for(o=DE(o);c<o.length&&o[c]!=="\r"&&o[c]!==`
`;)++c;const d=o.slice(0,c);return o[c]==="\r"&&++c,o[c]===`
`&&++c,t.buffer=o.slice(c),d}function r(o){kE(o,function(c,d){},/:/)}try{let o="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;o=n();const d=o.match(/^()?WEBVTT([ \t].*)?$/);if(!(d!=null&&d[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let c=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(c?c=!1:o=n(),t.state){case"HEADER":/:/.test(o)?r(o):o||(t.state="ID");continue;case"NOTE":o||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(o)){t.state="NOTE";break}if(!o)continue;if(t.cue=new O0(0,0,""),t.state="CUE",o.indexOf("-->")===-1){t.cue.id=o;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{rO(o,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const d=o.indexOf("-->")!==-1;if(!o||d&&(c=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=o}continue;case"BADCUE":o||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const lO=/\r\n|\n\r|\n|\r/g,Rm=function(e,t,n=0){return e.slice(n,n+t.length)===t},cO=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),o=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Xe(t)||!Xe(n)||!Xe(r)||!Xe(o))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*r,t+=3600*1e3*o,t};function P0(i,e,t){return sc(i.toString())+sc(e.toString())+sc(t)}const dO=function(e,t,n){let r=e[t],o=e[r.prevCC];if(!o||!o.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(c=o)!=null&&c.new;){var c;e.ccOffset+=r.start-o.start,r.new=!1,r=o,o=e[r.prevCC]}e.presentationOffset=n};function uO(i,e,t,n,r,o,c){const d=new oO,h=Gn(new Uint8Array(i)).trim().replace(lO,`
`).split(`
`),u=[],m=e?xM(e.baseTime,e.timescale):0;let g="00:00.000",x=0,y=0,v,S=!0;d.oncue=function(N){const A=t[n];let R=t.ccOffset;const C=(x-m)/9e4;if(A!=null&&A.new&&(y!==void 0?R=t.ccOffset=A.start:dO(t,n,C)),C){if(!e){v=new Error("Missing initPTS for VTT MPEGTS");return}R=C-t.presentationOffset}const D=N.endTime-N.startTime,V=Bn((N.startTime+R-y)*9e4,r*9e4)/9e4;N.startTime=Math.max(V,0),N.endTime=Math.max(V+D,0);const z=N.text.trim();N.text=decodeURIComponent(encodeURIComponent(z)),N.id||(N.id=P0(N.startTime,N.endTime,z)),N.endTime>0&&u.push(N)},d.onparsingerror=function(N){v=N},d.onflush=function(){if(v){c(v);return}o(u)},h.forEach(N=>{if(S)if(Rm(N,"X-TIMESTAMP-MAP=")){S=!1,N.slice(16).split(",").forEach(A=>{Rm(A,"LOCAL:")?g=A.slice(6):Rm(A,"MPEGTS:")&&(x=parseInt(A.slice(7)))});try{y=cO(g)/1e3}catch(A){v=A}return}else N===""&&(S=!1);d.parse(N+`
`)}),d.flush()}const Lm="stpp.ttml.im1t",IE=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,ME=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,hO={left:"start",center:"center",right:"end",start:"start",end:"end"};function S_(i,e,t,n){const r=jt(new Uint8Array(i),["mdat"]);if(r.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const o=r.map(d=>Gn(d)),c=pM(e.baseTime,1,e.timescale);try{o.forEach(d=>t(fO(d,c)))}catch(d){n(d)}}function fO(i,e){const r=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const o={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},c=Object.keys(o).reduce((g,x)=>(g[x]=r.getAttribute(`ttp:${x}`)||o[x],g),{}),d=r.getAttribute("xml:space")!=="preserve",h=E_(km(r,"styling","style")),u=E_(km(r,"layout","region")),m=km(r,"body","[begin]");return[].map.call(m,g=>{const x=OE(g,d);if(!x||!g.hasAttribute("begin"))return null;const y=Im(g.getAttribute("begin"),c),v=Im(g.getAttribute("dur"),c);let S=Im(g.getAttribute("end"),c);if(y===null)throw N_(g);if(S===null){if(v===null)throw N_(g);S=y+v}const N=new O0(y-e,S-e,x);N.id=P0(N.startTime,N.endTime,N.text);const A=u[g.getAttribute("region")],R=h[g.getAttribute("style")],C=mO(A,R,h),{textAlign:D}=C;if(D){const V=hO[D];V&&(N.lineAlign=V),N.align=D}return ns(N,C),N}).filter(g=>g!==null)}function km(i,e,t){const n=i.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function E_(i){return i.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function OE(i,e){return[].slice.call(i.childNodes).reduce((t,n,r)=>{var o;return n.nodeName==="br"&&r?t+`
`:(o=n.childNodes)!=null&&o.length?OE(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function mO(i,e,t){const n="http://www.w3.org/ns/ttml#styling";let r=null;const o=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],c=i!=null&&i.hasAttribute("style")?i.getAttribute("style"):null;return c&&t.hasOwnProperty(c)&&(r=t[c]),o.reduce((d,h)=>{const u=Dm(e,n,h)||Dm(i,n,h)||Dm(r,n,h);return u&&(d[h]=u),d},{})}function Dm(i,e,t){return i&&i.hasAttributeNS(e,t)?i.getAttributeNS(e,t):null}function N_(i){return new Error(`Could not parse ttml timestamp ${i}`)}function Im(i,e){if(!i)return null;let t=LE(i);return t===null&&(IE.test(i)?t=gO(i,e):ME.test(i)&&(t=pO(i,e))),t}function gO(i,e){const t=IE.exec(i),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function pO(i,e){const t=ME.exec(i),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class Qd{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class xO{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=T_(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(F.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(F.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(F.FRAG_LOADING,this.onFragLoading,this),e.on(F.FRAG_LOADED,this.onFragLoaded,this),e.on(F.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(F.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(F.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(F.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(F.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(F.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(F.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(F.FRAG_LOADING,this.onFragLoading,this),e.off(F.FRAG_LOADED,this.onFragLoaded,this),e.off(F.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(F.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(F.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(F.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(F.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Qd(this,"textTrack1"),t=new Qd(this,"textTrack2"),n=new Qd(this,"textTrack3"),r=new Qd(this,"textTrack4");this.cea608Parser1=new __(1,e,t),this.cea608Parser2=new __(3,n,r)}addCues(e,t,n,r,o){let c=!1;for(let d=o.length;d--;){const h=o[d],u=yO(h[0],h[1],t,n);if(u>=0&&(h[0]=Math.min(h[0],t),h[1]=Math.max(h[1],n),c=!0,u/(n-t)>.5))return}if(c||o.push([t,n]),this.config.renderTextTracksNatively){const d=this.captionsTracks[e];this.Cues.newCue(d,t,n,r)}else{const d=this.Cues.newCue(null,t,n,r);this.hls.trigger(F.CUES_PARSED,{type:"captions",cues:d,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:r,timescale:o,trackId:c}){const{unparsedVttFrags:d}=this;n===Je.MAIN&&(this.initPTS[t.cc]={baseTime:r,timescale:o,trackId:c}),d.length&&(this.unparsedVttFrags=[],d.forEach(h=>{this.initPTS[h.frag.cc]?this.onFragLoaded(F.FRAG_LOADED,h):this.hls.trigger(F.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:h.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let r=0;r<n.textTracks.length;r++){const o=n.textTracks[r];if(w_(o,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return o}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:r}=this,{label:o,languageCode:c}=t[e],d=this.getExistingTrack(o,c);if(d)n[e]=d,Ro(n[e]),TE(n[e],r);else{const h=this.createTextTrack("captions",o,c);h&&(h[e]=!0,n[e]=h)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,r={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(F.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,n){const r=this.media;if(r)return r.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:r}=this;Object.keys(r).forEach(o=>{Ro(r[o]),delete r[o]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=T_(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)Ro(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],r=n.some(o=>o.textCodec===Lm);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(fE(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const c=this.media,d=c?mu(c.textTracks):null;if(this.tracks.forEach((h,u)=>{let m;if(d){let g=null;for(let x=0;x<d.length;x++)if(d[x]&&w_(d[x],h)){g=d[x],d[x]=null;break}g&&(m=g)}if(m)Ro(m);else{const g=PE(h);m=this.createTextTrack(g,h.name,h.lang),m&&(m.mode="disabled")}m&&this.textTracks.push(m)}),d!=null&&d.length){const h=d.filter(u=>u!==null).map(u=>u.label);h.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${h.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const c=this.tracks.map(d=>({label:d.name,kind:d.type.toLowerCase(),default:d.default,subtitleTrack:d}));this.hls.trigger(F.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:c})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{const r=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!r)return;const o=`textTrack${r[1]}`,c=this.captionsProperties[o];c&&(c.label=n.name,n.lang&&(c.languageCode=n.lang),c.media=n)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Je.MAIN){var n,r;const{cea608Parser1:o,cea608Parser2:c,lastSn:d}=this,{cc:h,sn:u}=t.frag,m=(n=(r=t.part)==null?void 0:r.index)!=null?n:-1;o&&c&&(u!==d+1||u===d&&m!==this.lastPartIndex+1||h!==this.lastCc)&&(o.reset(),c.reset()),this.lastCc=h,this.lastSn=u,this.lastPartIndex=m}}onFragLoaded(e,t){const{frag:n,payload:r}=t;if(n.type===Je.SUBTITLE)if(r.byteLength){const o=n.decryptdata,c="stats"in t;if(o==null||!o.encrypted||c){const d=this.tracks[n.level],h=this.vttCCs;h[n.cc]||(h[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),d&&d.textCodec===Lm?this._parseIMSC1(n,r):this._parseVTTs(t)}}else this.hls.trigger(F.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;S_(t,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),n.trigger(F.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{n.logger.log(`Failed to parse IMSC1: ${r}`),n.trigger(F.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var t;const{frag:n,payload:r}=e,{initPTS:o,unparsedVttFrags:c}=this,d=o.length-1;if(!o[n.cc]&&d===-1){c.push(e);return}const h=this.hls,u=(t=n.initSegment)!=null&&t.data?ni(n.initSegment.data,new Uint8Array(r)).buffer:r;uO(u,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,m=>{this._appendCues(m,n.level),h.trigger(F.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},m=>{const g=m.message==="Missing initPTS for VTT MPEGTS";g?c.push(e):this._fallbackToIMSC1(n,r),h.logger.log(`Failed to parse VTT cue: ${m}`),!(g&&d>n.cc)&&h.trigger(F.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:m})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||S_(t,this.initPTS[e.cc],()=>{n.textCodec=Lm,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||r.mode==="disabled")return;e.forEach(o=>AE(r,o))}else{const r=this.tracks[t];if(!r)return;const o=r.default?"default":"subtitles"+t;n.trigger(F.CUES_PARSED,{type:"subtitles",cues:e,track:o})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===Je.SUBTITLE&&this.onFragLoaded(F.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:r}=t;if(!(n.type===Je.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let o=0;o<r.length;o++){const c=r[o].bytes;if(c){this.cea608Parser1||this.initCea608Parsers();const d=this.extractCea608Data(c);this.cea608Parser1.addData(r[o].pts,d[0]),this.cea608Parser2.addData(r[o].pts,d[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:r,type:o}){const{media:c}=this;if(!(!c||c.currentTime<n)){if(!o||o==="video"){const{captionsTracks:d}=this;Object.keys(d).forEach(h=>wg(d[h],t,n))}if(this.config.renderTextTracksNatively&&t===0&&r!==void 0){const{textTracks:d}=this;Object.keys(d).forEach(h=>wg(d[h],t,r))}}}extractCea608Data(e){const t=[[],[]],n=e[0]&31;let r=2;for(let o=0;o<n;o++){const c=e[r++],d=127&e[r++],h=127&e[r++];if(d===0&&h===0)continue;if((4&c)!==0){const m=3&c;(m===0||m===1)&&(t[m].push(d),t[m].push(h))}}return t}}function PE(i){return i.characteristics&&/transcribes-spoken-dialog/gi.test(i.characteristics)&&/describes-music-and-sound/gi.test(i.characteristics)?"captions":"subtitles"}function w_(i,e){return!!i&&i.kind===PE(e)&&_g(e,i)}function yO(i,e,t,n){return Math.min(e,n)-Math.max(i,t)}function T_(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const vO=/\s/,bO={newCue(i,e,t,n){const r=[];let o,c,d,h,u;const m=self.VTTCue||self.TextTrackCue;for(let x=0;x<n.rows.length;x++)if(o=n.rows[x],d=!0,h=0,u="",!o.isEmpty()){var g;for(let S=0;S<o.chars.length;S++)vO.test(o.chars[S].uchar)&&d?h++:(u+=o.chars[S].uchar,d=!1);o.cueStartTime=e,e===t&&(t+=1e-4),h>=16?h--:h++;const y=DE(u.trim()),v=P0(e,t,y);i!=null&&(g=i.cues)!=null&&g.getCueById(v)||(c=new m(e,t,y),c.id=v,c.line=x+1,c.align="left",c.position=10+Math.min(80,Math.floor(h*8/32)*10),r.push(c))}return i&&r.length&&(r.sort((x,y)=>x.line==="auto"||y.line==="auto"?0:x.line>8&&y.line>8?y.line-x.line:x.line-y.line),r.forEach(x=>AE(i,x))),r}};function _O(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const SO=/(\d+)-(\d+)\/(\d+)/;class A_{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||TO,this.controller=new self.AbortController,this.stats=new g0}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const o=EO(e,this.controller.signal),c=e.responseType==="arraybuffer",d=c?"byteLength":"length",{maxTimeToFirstByteMs:h,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,o),self.clearTimeout(this.requestTimeout),t.timeout=h&&Xe(h)?h:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout),(dc(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(g=>{var x;this.response=this.loader=g;const y=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},u-(y-r.loading.start)),!g.ok){const{status:S,statusText:N}=g;throw new AO(N||"fetch, bad network response",S,g)}r.loading.first=y,r.total=wO(g.headers)||r.total;const v=(x=this.callbacks)==null?void 0:x.onProgress;return v&&Xe(t.highWaterMark)?this.loadProgressively(g,r,e,t.highWaterMark,v):c?g.arrayBuffer():e.responseType==="json"?g.json():g.text()}).then(g=>{var x,y;const v=this.response;if(!v)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const S=g[d];S&&(r.loaded=r.total=S);const N={url:v.url,data:g,code:v.status},A=(x=this.callbacks)==null?void 0:x.onProgress;A&&!Xe(t.highWaterMark)&&A(r,e,g,v),(y=this.callbacks)==null||y.onSuccess(N,r,e,v)}).catch(g=>{var x;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const y=g&&g.code||0,v=g?g.message:null;(x=this.callbacks)==null||x.onError({code:y,text:v},e,g?g.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,r=0,o){const c=new z1,d=e.body.getReader(),h=()=>d.read().then(u=>{if(u.done)return c.dataLength&&o(t,n,c.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const m=u.value,g=m.length;return t.loaded+=g,g<r||c.dataLength?(c.push(m),c.dataLength>=r&&o(t,n,c.flush().buffer,e)):o(t,n,m.buffer,e),h()}).catch(()=>Promise.reject());return h()}}function EO(i,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(ns({},i.headers))};return i.rangeEnd&&t.headers.set("Range","bytes="+i.rangeStart+"-"+String(i.rangeEnd-1)),t}function NO(i){const e=SO.exec(i);if(e)return parseInt(e[2])-parseInt(e[1])+1}function wO(i){const e=i.get("Content-Range");if(e){const n=NO(e);if(Xe(n))return n}const t=i.get("Content-Length");if(t)return parseInt(t)}function TO(i,e){return new self.Request(i.url,e)}class AO extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const jO=/^age:\s*[\d.]+\s*$/im;class BE{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new g0,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const o=this.xhrSetup;o?Promise.resolve().then(()=>{if(!(this.loader!==n||this.stats.aborted))return o(n,t.url)}).catch(c=>{if(!(this.loader!==n||this.stats.aborted))return n.open("GET",t.url,!0),o(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(c=>{var d;(d=this.callbacks)==null||d.onError({code:n.status,text:c.message},t,n,r)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:o,maxLoadTimeMs:c}=n.loadPolicy;if(r)for(const d in r)e.setRequestHeader(d,r[d]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=o&&Xe(o)?o:c,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const r=t.readyState,o=this.config;if(!n.aborted&&r>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),o.timeout!==o.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),o.timeout=o.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const u=t.status,m=t.responseType==="text"?t.responseText:null;if(u>=200&&u<300){const v=m??t.response;if(v!=null){var c,d;n.loading.end=Math.max(self.performance.now(),n.loading.first);const S=t.responseType==="arraybuffer"?v.byteLength:v.length;n.loaded=n.total=S,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first);const N=(c=this.callbacks)==null?void 0:c.onProgress;N&&N(n,e,v,t);const A={url:t.responseURL,data:v,code:u};(d=this.callbacks)==null||d.onSuccess(A,n,e,t);return}}const g=o.loadPolicy.errorRetry,x=n.retry,y={url:e.url,data:void 0,code:u};if(ju(g,x,!1,y))this.retry(g);else{var h;Xt.error(`${u} while loading ${e.url}`),(h=this.callbacks)==null||h.onError({code:u,text:t.statusText},e,t,n)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(ju(e,t,!0))this.retry(e);else{var n;Xt.warn(`timeout while loading ${(n=this.context)==null?void 0:n.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=v0(e,n.retry),n.retry++,Xt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&jO.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const CO={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},RO=Qt(Qt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:BE,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:GD,bufferController:kM,capLevelController:D0,errorController:zD,fpsController:D3,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:O1,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:CO},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},LO()),{},{subtitleStreamController:K3,subtitleTrackController:O3,timelineController:xO,audioStreamController:jM,audioTrackController:CM,emeController:Bo,cmcdController:C3,contentSteeringController:L3,interstitialsController:H3});function LO(){return{cueHandler:bO,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function kO(i,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=Ag(i),r=["manifest","level","frag"],o=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(c=>{const d=`${c==="level"?"playlist":c}LoadPolicy`,h=e[d]===void 0,u=[];o.forEach(m=>{const g=`${c}Loading${m}`,x=e[g];if(x!==void 0&&h){u.push(g);const y=n[d].default;switch(e[d]={default:y},m){case"TimeOut":y.maxLoadTimeMs=x,y.maxTimeToFirstByteMs=x;break;case"MaxRetry":y.errorRetry.maxNumRetry=x,y.timeoutRetry.maxNumRetry=x;break;case"RetryDelay":y.errorRetry.retryDelayMs=x,y.timeoutRetry.retryDelayMs=x;break;case"MaxRetryTimeout":y.errorRetry.maxRetryDelayMs=x,y.timeoutRetry.maxRetryDelayMs=x;break}}}),u.length&&t.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${d}": ${os(e[d])}`)}),Qt(Qt({},n),e)}function Ag(i){return i&&typeof i=="object"?Array.isArray(i)?i.map(Ag):Object.keys(i).reduce((e,t)=>(e[t]=Ag(i[t]),e),{}):i}function DO(i,e){const t=i.loader;t!==A_&&t!==BE?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),i.progressive=!1):_O()&&(i.loader=A_,i.progressive=!0,i.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const gu=2,IO=.1,MO=.05,OO=100;class PO extends L1{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var n;(n=this.media)!=null&&n.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var n;this.ended=((n=this.media)==null?void 0:n.currentTime)||1,this.hls.trigger(F.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(F.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(F.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(OO),this.mediaSource=t.mediaSource;const n=this.media=t.media;hn(n,"playing",this.onMediaPlaying),hn(n,"waiting",this.onMediaWaiting),hn(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(Sn(n,"playing",this.onMediaPlaying),Sn(n,"waiting",this.onMediaWaiting),Sn(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,r;const o=(n=this.hls)==null?void 0:n.config;if(!o)return;const c=this.media;if(!c)return;const{seeking:d}=c,h=this.seeking&&!d,u=!this.seeking&&d,m=c.paused&&!d||c.ended||c.playbackRate===0;if(this.seeking=d,e!==t){t&&(this.ended=0),this.moved=!0,d||(this.nudgeRetry=0,o.nudgeOnVideoHole&&!m&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(u||h){h&&this.stallResolved(e);return}if(m){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&c.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(F.MEDIA_ENDED,{stalled:!1}));return}if(!yt.getBuffered(c).length){this.nudgeRetry=0;return}const g=yt.bufferInfo(c,e,0),x=g.nextStart||0,y=this.fragmentTracker;if(d&&y&&this.hls){const z=j_(this.hls.inFlightFragments,e),B=g.len>gu,I=!x||z||x-e>gu&&!y.getPartialFragment(e);if(B||I)return;this.moved=!1}const v=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&y){if(!(g.len>0)&&!x)return;const B=Math.max(x,g.start||0)-e,M=!!(v!=null&&v.live)?v.targetduration*2:gu,L=Xd(e,y);if(B>0&&(B<=M||L)){c.paused||this._trySkipBufferHole(L);return}}const S=o.detectStallWithCurrentTimeMs,N=self.performance.now(),A=this.waiting;let R=this.stalled;if(R===null)if(A>0&&N-A<S)R=this.stalled=A;else{this.stalled=N;return}const C=N-R;if(!d&&(C>=S||A)&&this.hls){var D;if(((D=this.mediaSource)==null?void 0:D.readyState)==="ended"&&!(v!=null&&v.live)&&Math.abs(e-(v?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(F.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(g),!this.media||!this.hls)return}const V=yt.bufferInfo(c,e,o.maxBufferHole);this._tryFixBufferStall(V,C,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(n)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(F.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(n=this.buffered.audio)!=null&&n.length&&r&&r.length>1&&e>r.end(0)){const o=yt.bufferedInfo(yt.timeRangesToArray(this.buffered.audio),e,0);if(o.len>1&&t>=o.start){const c=yt.timeRangesToArray(r),d=yt.bufferedInfo(c,t,0).bufferedIndex;if(d>-1&&d<c.length-1){const h=yt.bufferedInfo(c,e,0).bufferedIndex,u=c[d].end,m=c[d+1].start;if((h===-1||h>d)&&m-u<1&&e-u<2){const g=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${m} buffered index: ${h}`);this.warn(g.message),this.media.currentTime+=1e-6;let x=Xd(e,this.fragmentTracker);x&&"fragment"in x?x=x.fragment:x||(x=void 0);const y=yt.bufferInfo(this.media,e,0);this.hls.trigger(F.ERROR,{type:tt.MEDIA_ERROR,details:_e.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,frag:x,buffer:y.len,bufferInfo:y})}}}}}_tryFixBufferStall(e,t,n){var r,o;const{fragmentTracker:c,media:d}=this,h=(r=this.hls)==null?void 0:r.config;if(!d||!c||!h)return;const u=(o=this.hls)==null?void 0:o.latestLevelDetails,m=Xd(n,c);if((m||u!=null&&u.live&&n<u.fragmentStart)&&(this._trySkipBufferHole(m)||!this.media))return;const g=e.buffered,x=this.adjacentTraversal(e,n);(g&&g.length>1&&e.len>h.maxBufferHole||e.nextStart&&(e.nextStart-n<h.maxBufferHole||x))&&(t>h.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,r=e.nextStart;if(n&&r){const o=n.getFragAtPos(t,Je.MAIN),c=n.getFragAtPos(r,Je.MAIN);if(o&&c)return c.sn-o.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:r,stalled:o}=this;if(!r&&o!==null&&n&&t){this.stallReported=!0;const c=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${os(e)})`);this.warn(c.message),t.trigger(F.ERROR,{type:tt.MEDIA_ERROR,details:_e.BUFFER_STALLED_ERROR,fatal:!1,error:c,buffer:e.len,bufferInfo:e,stalled:{start:o}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:r}=this,o=(t=this.hls)==null?void 0:t.config;if(!r||!n||!o)return 0;const c=r.currentTime,d=yt.bufferInfo(r,c,0),h=c<d.start?d.start:d.nextStart;if(h&&this.hls){const m=d.len<=o.maxBufferHole,g=d.len>0&&d.len<1&&r.readyState<3,x=h-c;if(x>0&&(m||g)){if(x>o.maxBufferHole){let v=!1;if(c===0){const S=n.getAppendedFrag(0,Je.MAIN);S&&h<S.end&&(v=!0)}if(!v&&e){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||j_(this.hls.inFlightFragments,h))return 0;let N=!1,A=e.end;for(;A<h;){const R=Xd(A,n);if(R)A+=R.duration;else{N=!0;break}}if(N)return 0}}const y=Math.max(h+MO,c+IO);if(this.warn(`skipping hole, adjusting currentTime from ${c} to ${y}`),this.moved=!0,r.currentTime=y,!(e!=null&&e.gap)){const v=new Error(`fragment loaded with buffer holes, seeking from ${c} to ${y}`),S={type:tt.MEDIA_ERROR,details:_e.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:v,reason:v.message,buffer:d.len,bufferInfo:d};e&&("fragment"in e?S.part=e:S.frag=e),this.hls.trigger(F.ERROR,S)}return y}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:r}=this,o=t?.config;if(!n||!o)return 0;const c=n.currentTime;if(this.nudgeRetry++,r<o.nudgeMaxRetry){const d=c+(r+1)*o.nudgeOffset,h=new Error(`Nudging 'currentTime' from ${c} to ${d}`);this.warn(h.message),n.currentTime=d,t.trigger(F.ERROR,{type:tt.MEDIA_ERROR,details:_e.BUFFER_NUDGE_ON_STALL,error:h,fatal:!1,buffer:e.len,bufferInfo:e})}else{const d=new Error(`Playhead still not moving while enough data buffered @${c} after ${o.nudgeMaxRetry} nudges`);this.error(d.message),t.trigger(F.ERROR,{type:tt.MEDIA_ERROR,details:_e.BUFFER_STALLED_ERROR,error:d,fatal:!0,buffer:e.len,bufferInfo:e})}}}function j_(i,e){const t=C_(i.main);if(t&&t.start<=e)return t;const n=C_(i.audio);return n&&n.start<=e?n:null}function C_(i){if(!i)return null;switch(i.state){case Me.IDLE:case Me.STOPPED:case Me.ENDED:case Me.ERROR:return null}return i.frag}function Xd(i,e){return e.getAppendedFrag(i,Je.MAIN)||e.getPartialFragment(i)}const BO=.25;function jg(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Mm(i,e,t,n,r){let o=new i(e,t,"");try{o.value=n,r&&(o.type=r)}catch{o=new i(e,t,os(r?Qt({type:r},n):n))}return o}const Jd=(()=>{const i=jg();try{i&&new i(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class UO{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(F.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(F.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(F.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(F.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(F.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(F.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(F.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(F.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(F.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var n;this.media=t.media,((n=t.overrides)==null?void 0:n.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Ro(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if(n.kind==="metadata"&&n.label==="id3")return TE(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:r}=this.hls.config;if(!n&&!r)return;const{samples:o}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const c=jg();if(c)for(let d=0;d<o.length;d++){const h=o[d].type;if(h===Un.emsg&&!n||!r)continue;const u=eE(o[d].data),m=o[d].pts;let g=m+o[d].duration;g>Jd&&(g=Jd),g-m<=0&&(g=m+BO);for(let y=0;y<u.length;y++){const v=u[y];if(!tE(v)){this.updateId3CueEnds(m,h);const S=Mm(c,m,g,v,h);S&&this.id3Track.addCue(S)}}}}updateId3CueEnds(e,t){var n;const r=(n=this.id3Track)==null?void 0:n.cues;if(r)for(let o=r.length;o--;){const c=r[o];c.type===t&&c.startTime<e&&c.endTime===Jd&&(c.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:r}){const{id3Track:o,hls:c}=this;if(!c)return;const{config:{enableEmsgMetadataCues:d,enableID3MetadataCues:h}}=c;if(o&&(d||h)){let u;r==="audio"?u=m=>m.type===Un.audioId3&&h:r==="video"?u=m=>m.type===Un.emsg&&d:u=m=>m.type===Un.audioId3&&h||m.type===Un.emsg&&d,wg(o,t,n,u)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:r,enableDateRangeMetadataCues:o,interstitialsController:c}=this.hls.config;if(!o)return;const d=jg();if(n&&r&&!c){const{fragmentStart:S,fragmentEnd:N}=e;let A=this.assetCue;A?(A.startTime=S,A.endTime=N):d&&(A=this.assetCue=Mm(d,S,N,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),A&&(A.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(A),A.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:h}=this,{dateRanges:u}=e,m=Object.keys(u);let g=this.dateRangeCuesAppended;if(h&&t){var x;if((x=h.cues)!=null&&x.length){const S=Object.keys(g).filter(N=>!m.includes(N));for(let N=S.length;N--;){var y;const A=S[N],R=(y=g[A])==null?void 0:y.cues;delete g[A],R&&Object.keys(R).forEach(C=>{const D=R[C];if(D){D.removeEventListener("enter",this.onEventCueEnter);try{h.removeCue(D)}catch{}}})}}else g=this.dateRangeCuesAppended={}}const v=e.fragments[e.fragments.length-1];if(!(m.length===0||!Xe(v?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let S=0;S<m.length;S++){const N=m[S],A=u[N],R=A.startTime,C=g[N],D=C?.cues||{};let V=C?.durationKnown||!1,z=Jd;const{duration:B,endDate:I}=A;if(I&&B!==null)z=R+B,V=!0;else if(A.endOnNext&&!V){const L=m.reduce((O,J)=>{if(J!==A.id){const ie=u[J];if(ie.class===A.class&&ie.startDate>A.startDate&&(!O||A.startDate<O.startDate))return ie}return O},null);L&&(z=L.startTime,V=!0)}const M=Object.keys(A.attr);for(let L=0;L<M.length;L++){const O=M[L];if(!rI(O))continue;const J=D[O];if(J)V&&!(C!=null&&C.durationKnown)?J.endTime=z:Math.abs(J.startTime-R)>.01&&(J.startTime=R,J.endTime=z);else if(d){let ie=A.attr[O];oI(O)&&(ie=u1(ie));const se=Mm(d,R,z,{key:O,data:ie},Un.dateRange);se&&(se.id=N,this.id3Track.addCue(se),D[O]=se,c&&(O==="X-ASSET-LIST"||O==="X-ASSET-URL")&&se.addEventListener("enter",this.onEventCueEnter))}}g[N]={cues:D,dateRange:A,durationKnown:V}}}}}class FO{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,n=this.levelDetails;if(!t||!n)return;this.currentTime=t.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:o,maxLiveSyncPlaybackRate:c}=this.config;if(!o||c===1||!n.live)return;const d=this.targetLatency;if(d===null)return;const h=r-d,u=Math.min(this.maxLatency,d+n.targetduration);if(h<u&&h>.05&&this.forwardBufferLength>1){const g=Math.min(2,Math.max(1,c)),x=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20,y=Math.min(g,Math.max(1,x));this.changeMediaPlaybackRate(t,y)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:n,targetduration:r}=e,{liveSyncDuration:o,liveSyncDurationCount:c,lowLatencyMode:d}=this.config,h=this.hls.userConfig;let u=d&&n||t;(this._targetLatencyUpdated||h.liveSyncDuration||h.liveSyncDurationCount||u===0)&&(u=o!==void 0?o:c*r);const m=r;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,m)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const n=this.levelDetails;if(n===null)return null;const r=n.edge,o=e-t-this.edgeStalled,c=r-n.totalduration,d=r-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(c,o),d)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(F.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(F.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===_e.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(n=this.levelDetails)!=null&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,r;e.playbackRate!==t&&((n=this.hls)==null||n.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class $O extends k0{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(F.LEVEL_LOADED,this.onLevelLoaded,this),e.on(F.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(F.FRAG_BUFFERED,this.onFragBuffered,this),e.on(F.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(F.LEVEL_LOADED,this.onLevelLoaded,this),e.off(F.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(F.FRAG_BUFFERED,this.onFragBuffered,this),e.off(F.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,r=[],o={},c={};let d=!1,h=!1,u=!1;t.levels.forEach(m=>{const g=m.attrs;let{audioCodec:x,videoCodec:y}=m;x&&(m.audioCodec=x=Nu(x,n)||void 0),y&&(y=m.videoCodec=ED(y));const{width:v,height:S,unknownCodecs:N}=m,A=N?.length||0;if(d||(d=!!(v&&S)),h||(h=!!y),u||(u=!!x),A||x&&!this.isAudioSupported(x)||y&&!this.isVideoSupported(y)){this.log(`Some or all CODECS not supported "${g.CODECS}"`);return}const{CODECS:R,"FRAME-RATE":C,"HDCP-LEVEL":D,"PATHWAY-ID":V,RESOLUTION:z,"VIDEO-RANGE":B}=g,M=`${`${V||"."}-`}${m.bitrate}-${z}-${C}-${R}-${B}-${D}`;if(o[M])if(o[M].uri!==m.url&&!m.attrs["PATHWAY-ID"]){const L=c[M]+=1;m.attrs["PATHWAY-ID"]=new Array(L+1).join(".");const O=this.createLevel(m);o[M]=O,r.push(O)}else o[M].addGroupId("audio",g.AUDIO),o[M].addGroupId("text",g.SUBTITLES);else{const L=this.createLevel(m);o[M]=L,c[M]=1,r.push(L)}}),this.filterAndSortMediaOptions(r,t,d,h,u)}createLevel(e){const t=new oc(e),n=e.supplemental;if(n!=null&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${n.videoCodec}"`);this.log(r.message),t.supportedResult=E1(r,[])}return t}isAudioSupported(e){return ac(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return ac(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,r,o){var c;let d=[],h=[],u=e;const m=((c=t.stats)==null?void 0:c.parsing)||{};if((n||r)&&o&&(u=u.filter(({videoCodec:R,videoRange:C,width:D,height:V})=>(!!R||!!(D&&V))&&DD(C))),u.length===0){Promise.resolve().then(()=>{if(this.hls){let R="no level with compatible codecs found in manifest",C=R;t.levels.length&&(C=`one or more CODECS in variant not supported: ${os(t.levels.map(V=>V.attrs.CODECS).filter((V,z,B)=>B.indexOf(V)===z))}`,this.warn(C),R+=` (${C})`);const D=new Error(R);this.hls.trigger(F.ERROR,{type:tt.MEDIA_ERROR,details:_e.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:D,reason:C})}}),m.end=performance.now();return}t.audioTracks&&(d=t.audioTracks.filter(R=>!R.audioCodec||this.isAudioSupported(R.audioCodec)),R_(d)),t.subtitles&&(h=t.subtitles,R_(h));const g=u.slice(0);u.sort((R,C)=>{if(R.attrs["HDCP-LEVEL"]!==C.attrs["HDCP-LEVEL"])return(R.attrs["HDCP-LEVEL"]||"")>(C.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&R.height!==C.height)return R.height-C.height;if(R.frameRate!==C.frameRate)return R.frameRate-C.frameRate;if(R.videoRange!==C.videoRange)return wu.indexOf(R.videoRange)-wu.indexOf(C.videoRange);if(R.videoCodec!==C.videoCodec){const D=_b(R.videoCodec),V=_b(C.videoCodec);if(D!==V)return V-D}if(R.uri===C.uri&&R.codecSet!==C.codecSet){const D=Eu(R.codecSet),V=Eu(C.codecSet);if(D!==V)return V-D}return R.averageBitrate!==C.averageBitrate?R.averageBitrate-C.averageBitrate:0});let x=g[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==g.length)){for(let R=0;R<g.length;R++)if(g[R].pathwayId===u[0].pathwayId){x=g[R];break}}this._levels=u;for(let R=0;R<u.length;R++)if(u[R]===x){var y;this._firstLevel=R;const C=x.bitrate,D=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${u.length} level(s) found, first bitrate: ${C}`),((y=this.hls.userConfig)==null?void 0:y.abrEwmaDefaultEstimate)===void 0){const V=Math.min(C,this.hls.config.abrEwmaDefaultEstimateMax);V>D&&D===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=V)}break}const v=o&&!r,S=this.hls.config,N=!!(S.audioStreamController&&S.audioTrackController),A={levels:u,audioTracks:d,subtitleTracks:h,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:o,video:r,altAudio:N&&!v&&d.some(R=>!!R.url)};m.end=performance.now(),this.hls.trigger(F.MANIFEST_PARSED,A)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const m=new Error("invalid level idx"),g=e<0;if(this.hls.trigger(F.ERROR,{type:tt.OTHER_ERROR,details:_e.LEVEL_SWITCH_ERROR,level:e,fatal:g,error:m,reason:m.message}),g)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,r=this.currentLevel,o=r?r.attrs["PATHWAY-ID"]:void 0,c=t[e],d=c.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=c,n===e&&r&&o===d)return;this.log(`Switching to level ${e} (${c.height?c.height+"p ":""}${c.videoRange?c.videoRange+" ":""}${c.codecSet?c.codecSet+" ":""}@${c.bitrate})${d?" with Pathway "+d:""} from level ${n}${o?" with Pathway "+o:""}`);const h={level:e,attrs:c.attrs,details:c.details,bitrate:c.bitrate,averageBitrate:c.averageBitrate,maxBitrate:c.maxBitrate,realBitrate:c.realBitrate,width:c.width,height:c.height,codecSet:c.codecSet,audioCodec:c.audioCodec,videoCodec:c.videoCodec,audioGroups:c.audioGroups,subtitleGroups:c.subtitleGroups,loaded:c.loaded,loadError:c.loadError,fragmentError:c.fragmentError,name:c.name,id:c.id,uri:c.uri,url:c.url,urlId:0,audioGroupIds:c.audioGroupIds,textGroupIds:c.textGroupIds};this.hls.trigger(F.LEVEL_SWITCHING,h);const u=c.details;if(!u||u.live){const m=this.switchParams(c.uri,r?.details,u);this.loadPlaylist(m)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(r=>t.indexOf(r)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=n}}onError(e,t){t.fatal||!t.context||t.context.type===Rt.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===Je.MAIN){const n=t.elementaryStreams;if(!Object.keys(n).some(o=>!!n[o]))return;const r=this._levels[t.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var n;const{level:r,details:o}=t,c=t.levelInfo;if(!c){var d;this.warn(`Invalid level index ${r}`),(d=t.deliveryDirectives)!=null&&d.skip&&(o.deltaUpdateFailed=!0);return}if(c===this.currentLevel||t.withoutMultiVariant){c.fragmentError===0&&(c.loadError=0);let h=c.details;h===t.details&&h.advanced&&(h=void 0),this.playlistLoaded(r,t,h)}else(n=t.deliveryDirectives)!=null&&n.skip&&(o.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,o=e.attrs["PATHWAY-ID"],c=e.details,d=c?.age;this.log(`Loading level index ${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${o?" Pathway "+o:""}${d&&c.live?" age "+d.toFixed(1)+(c.type&&" "+c.type||""):""} ${n}`),this.hls.trigger(F.LEVEL_LOADING,{url:n,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const n=this._levels.filter((o,c)=>c!==e?!0:(this.steering&&this.steering.removeLevel(o),o===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,o.details&&o.details.fragments.forEach(d=>d.level=-1)),!1));H1(n),this._levels=n,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=n.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(F.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(F.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function R_(i){const e={};i.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}function UE(){return self.SourceBuffer||self.WebKitSourceBuffer}function FE(){if(!qa())return!1;const e=UE();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function GO(){if(!FE())return!1;const i=qa();return typeof i?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>i.isTypeSupported(rc(e,"video")))||["mp4a.40.2","fLaC"].some(e=>i.isTypeSupported(rc(e,"audio"))))}function VO(){var i;const e=UE();return typeof(e==null||(i=e.prototype)==null?void 0:i.changeType)=="function"}const HO=100;class KO extends N0{constructor(e,t,n){super(e,t,n,"stream-controller",Je.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,o=r?r.currentTime:null;if(o===null||!Xe(o)||(this.log(`Media seeked to ${o.toFixed(3)}`),!this.getBufferedFrag(o)))return;const c=this.getFwdBufferInfoAtPos(r,o,Je.MAIN,0);if(c===null||c.len===0){this.warn(`Main forward buffer length at ${o} on "seeked" event ${c?c.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(F.MANIFEST_PARSED,this.onManifestParsed,this),e.on(F.LEVEL_LOADING,this.onLevelLoading,this),e.on(F.LEVEL_LOADED,this.onLevelLoaded,this),e.on(F.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(F.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(F.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(F.BUFFER_CREATED,this.onBufferCreated,this),e.on(F.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(F.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(F.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(F.MANIFEST_PARSED,this.onManifestParsed,this),e.off(F.LEVEL_LOADED,this.onLevelLoaded,this),e.off(F.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(F.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(F.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(F.BUFFER_CREATED,this.onBufferCreated,this),e.off(F.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(F.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(F.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:r}=this;if(this.stopLoad(),this.setInterval(HO),this.level=-1,!this.startFragRequested){let o=r.startLevel;o===-1&&(r.config.testBandwidth&&this.levels.length>1?(o=0,this.bitrateTest=!0):o=r.firstAutoLevel),r.nextLoadLevel=o,this.level=r.loadLevel,this._hasEnoughToStart=!!t}n>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n),this.state=Me.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=Me.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case Me.WAITING_LEVEL:{const{levels:e,level:t}=this,n=e?.[t],r=n?.details;if(r&&(!r.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(r))break;this.state=Me.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=Me.IDLE;break}break}case Me.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===Me.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:r}=this;if(t===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const o=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(n!=null&&n[o]))return;const c=n[o],d=this.getMainFwdBufferInfo();if(d===null)return;const h=this.getLevelDetails();if(h&&this._streamEnded(d,h)){const S={};this.altAudio===2&&(S.type="video"),this.hls.trigger(F.BUFFER_EOS,S),this.state=Me.ENDED;return}if(!this.buffering)return;e.loadLevel!==o&&e.manualLevel===-1&&this.log(`Adapting to level ${o} from level ${this.level}`),this.level=e.nextLoadLevel=o;const u=c.details;if(!u||this.state===Me.WAITING_LEVEL||this.waitForLive(c)){this.level=o,this.state=Me.WAITING_LEVEL,this.startFragRequested=!1;return}const m=d.len,g=this.getMaxBufferLength(c.maxBitrate);if(m>=g)return;this.backtrackFragment&&this.backtrackFragment.start>d.end&&(this.backtrackFragment=null);const x=this.backtrackFragment?this.backtrackFragment.start:d.end;let y=this.getNextFragment(x,u);if(this.couldBacktrack&&!this.fragPrevious&&y&&Cs(y)&&this.fragmentTracker.getState(y)!==Fs.OK){var v;const N=((v=this.backtrackFragment)!=null?v:y).sn-u.startSN,A=u.fragments[N-1];A&&y.cc===A.cc&&(y=A,this.fragmentTracker.removeFragment(A))}else this.backtrackFragment&&d.len&&(this.backtrackFragment=null);if(y&&this.isLoopLoading(y,x)){if(!y.gap){const N=this.audioOnly&&!this.altAudio?as.AUDIO:as.VIDEO,A=(N===as.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;A&&this.afterBufferFlushed(A,N,Je.MAIN)}y=this.getNextFragmentLoopLoading(y,u,d,Je.MAIN,g)}y&&(y.initSegment&&!y.initSegment.data&&!this.bitrateTest&&(y=y.initSegment),this.loadFragment(y,c,x))}loadFragment(e,t,n){const r=this.fragmentTracker.getState(e);r===Fs.NOT_LOADED||r===Fs.PARTIAL?Cs(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Je.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let n;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const o=this.getLevelDetails();if(o!=null&&o.live){const d=this.getMainFwdBufferInfo();if(!d||d.len<o.targetduration*2)return}if(!t.paused&&e){const d=this.hls.nextLoadLevel,h=e[d],u=this.fragLastKbps;u&&this.fragCurrent?n=this.fragCurrent.duration*h.maxBitrate/(1e3*u)+1:n=0}else n=0;const c=this.getBufferedFrag(t.currentTime+n);if(c){const d=this.followingBufferedFrag(c);if(d){this.abortCurrentFrag();const h=d.maxStartPTS?d.maxStartPTS:d.start,u=d.duration,m=Math.max(c.end,h+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(m,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Me.KEY_LOADING:case Me.FRAG_LOADING:case Me.FRAG_LOADING_WAITING_RETRY:case Me.PARSING:case Me.PARSED:this.state=Me.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;hn(n,"playing",this.onMediaPlaying),hn(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(Sn(n,"playing",this.onMediaPlaying),Sn(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(F.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,r=!1;for(let o=0;o<t.levels.length;o++){const c=t.levels[o].audioCodec;c&&(n=n||c.indexOf("mp4a.40.2")!==-1,r=r||c.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=n&&r&&!VO(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==Me.IDLE)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=Me.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:r,startFragRequested:o}=this,c=t.level,d=t.details,h=d.totalduration;if(!r){this.warn(`Levels were reset while loading level ${c}`);return}this.log(`Level ${c} loaded [${d.startSN},${d.endSN}]${d.lastPartSn?`[part-${d.lastPartSn}-${d.lastPartIndex}]`:""}, cc [${d.startCC}, ${d.endCC}] duration:${h}`);const u=t.levelInfo,m=this.fragCurrent;m&&(this.state===Me.FRAG_LOADING||this.state===Me.FRAG_LOADING_WAITING_RETRY)&&m.level!==t.level&&m.loader&&this.abortCurrentFrag();let g=0;if(d.live||(n=u.details)!=null&&n.live){var x;if(this.checkLiveUpdate(d),d.deltaUpdateFailed)return;g=this.alignPlaylists(d,u.details,(x=this.levelLastLoaded)==null?void 0:x.details)}if(u.details=d,this.levelLastLoaded=u,o||this.setStartPosition(d,g),this.hls.trigger(F.LEVEL_UPDATED,{details:d,level:c}),this.state===Me.WAITING_LEVEL){if(this.waitForCdnTuneIn(d))return;this.state=Me.IDLE}o&&d.live&&this.synchronizeToLiveEdge(d),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const r=this.hls.liveSyncPosition,o=this.getLoadPosition(),c=e.fragmentStart,d=e.edge,h=o>=c-t.maxFragLookUpTolerance&&o<=d;if(r!==null&&n.duration>r&&(o<r||!h)){const m=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!h&&n.readyState<4||o<d-m)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),n.readyState))if(this.warn(`Playback: ${o.toFixed(3)} is located too far from the end of live sliding playlist: ${d}, reset currentTime to : ${r.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var u;const g=yt.bufferInfo(n,r,0);if(!((u=g.buffered)!=null&&u.length)){n.currentTime=r;return}if(g.start<=o){n.currentTime=r;return}const{nextStart:y}=yt.bufferedInfo(g.buffered,o,0);y&&(n.currentTime=y)}else n.currentTime=r}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:r,payload:o}=e,{levels:c}=this;if(!c){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const d=c[n.level];if(!d){this.warn(`Level ${n.level} not found on progress`);return}const h=d.details;if(!h){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const u=d.videoCodec,m=h.PTSKnown||!h.live,g=(t=n.initSegment)==null?void 0:t.data,x=this._getAudioCodec(d),y=this.transmuxer=this.transmuxer||new hE(this.hls,Je.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),v=r?r.index:-1,S=v!==-1,N=new _0(n.level,n.sn,n.stats.chunkCount,o.byteLength,v,S),A=this.initPTS[n.cc];y.push(o,g,x,u,n,r,h.totalduration,m,N,A)}onAudioTrackSwitching(e,t){const n=this.hls,r=this.altAudio!==0;if(Tu(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const c=this.fragCurrent;c&&(this.log("Switching to main audio track, cancel main fragment load"),c.abortRequests(),this.fragmentTracker.removeFragment(c)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.altAudio=0,this.fragmentTracker.removeAllFragments(),n.once(F.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(F.AUDIO_TRACK_SWITCHED,t)}),n.trigger(F.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}n.trigger(F.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=Tu(t.url,this.hls);if(n){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let r,o,c=!1;for(const d in n){const h=n[d];if(h.id==="main"){if(o=d,r=h,d==="video"){const u=n[d];u&&(this.videoBuffer=u.buffer)}}else c=!0}c&&r?(this.log(`Alternate track found, use ${o}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:r}=t,o=n.type===Je.MAIN;if(o){if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${r?" p: "+r.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===Me.PARSED&&(this.state=Me.IDLE);return}const d=r?r.stats:n.stats;this.fragLastKbps=Math.round(8*d.total/(d.buffering.end-d.loading.first)),Cs(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,r)}const c=this.media;c&&(!this._hasEnoughToStart&&yt.getBuffered(c).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),o&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal){this.state=Me.ERROR;return}switch(t.details){case _e.FRAG_GAP:case _e.FRAG_PARSING_ERROR:case _e.FRAG_DECRYPT_ERROR:case _e.FRAG_LOAD_ERROR:case _e.FRAG_LOAD_TIMEOUT:case _e.KEY_LOAD_ERROR:case _e.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Je.MAIN,t);break;case _e.LEVEL_LOAD_ERROR:case _e.LEVEL_LOAD_TIMEOUT:case _e.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===Me.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===Rt.LEVEL&&(this.state=Me.IDLE);break;case _e.BUFFER_ADD_CODEC_ERROR:case _e.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case _e.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case _e.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=Me.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==as.AUDIO||!this.altAudio){const n=(t===as.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;n&&(this.afterBufferFlushed(n,t,Je.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}const r=this.timelineOffset;r&&n&&(n+=r);const o=this.getLevelDetails(),c=yt.getBuffered(e),d=c.length?c.start(0):0,h=d-n,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||h>0&&(h<u||this.loadingParts&&h<2*(o?.partTarget||0)))&&(this.log(`adjusting start position by ${h} to match buffer start`),n+=h,this.startPosition=n),t<n&&(this.log(`seek to target start position ${n} from current time ${t} buffer start ${d}`),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:r}=this,o=n?.frag;if(!o||this.fragContextChanged(o))return;t.fragmentError=0,this.state=Me.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const c=o.stats;c.parsing.start=c.parsing.end=c.buffering.start=c.buffering.end=self.performance.now(),r.trigger(F.FRAG_LOADED,n),o.bitrateTest=!1}).catch(n=>{this.state===Me.STOPPED||this.state===Me.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:n}=this,{remuxResult:r,chunkMeta:o}=e,c=this.getCurrentContext(o);if(!c){this.resetWhenMissingContext(o);return}const{frag:d,part:h,level:u}=c,{video:m,text:g,id3:x,initSegment:y}=r,{details:v}=u,S=this.altAudio?void 0:r.audio;if(this.fragContextChanged(d)){this.fragmentTracker.removeFragment(d);return}if(this.state=Me.PARSING,y){const N=y.tracks;if(N){const D=d.initSegment||d;if(this.unhandledEncryptionError(y,d))return;this._bufferInitSegment(u,N,D,o),n.trigger(F.FRAG_PARSING_INIT_SEGMENT,{frag:D,id:t,tracks:N})}const A=y.initPTS,R=y.timescale,C=this.initPTS[d.cc];if(Xe(A)&&(!C||C.baseTime!==A||C.timescale!==R)){const D=y.trackId;this.initPTS[d.cc]={baseTime:A,timescale:R,trackId:D},n.trigger(F.INIT_PTS_FOUND,{frag:d,id:t,initPTS:A,timescale:R,trackId:D})}}if(m&&v){S&&m.type==="audiovideo"&&this.logMuxedErr(d);const N=v.fragments[d.sn-1-v.startSN],A=d.sn===v.startSN,R=!N||d.cc>N.cc;if(r.independent!==!1){const{startPTS:C,endPTS:D,startDTS:V,endDTS:z}=m;if(h)h.elementaryStreams[m.type]={startPTS:C,endPTS:D,startDTS:V,endDTS:z};else if(m.firstKeyFrame&&m.independent&&o.id===1&&!R&&(this.couldBacktrack=!0),m.dropped&&m.independent){const B=this.getMainFwdBufferInfo(),I=(B?B.end:this.getLoadPosition())+this.config.maxBufferHole,M=m.firstKeyFramePTS?m.firstKeyFramePTS:C;if(!A&&I<M-this.config.maxBufferHole&&!R){this.backtrack(d);return}else R&&(d.gap=!0);d.setElementaryStreamInfo(m.type,d.start,D,d.start,z,!0)}else A&&C-(v.appliedTimelineOffset||0)>gu&&(d.gap=!0);d.setElementaryStreamInfo(m.type,C,D,V,z),this.backtrackFragment&&(this.backtrackFragment=d),this.bufferFragmentData(m,d,h,o,A||R)}else if(A||R)d.gap=!0;else{this.backtrack(d);return}}if(S){const{startPTS:N,endPTS:A,startDTS:R,endDTS:C}=S;h&&(h.elementaryStreams[as.AUDIO]={startPTS:N,endPTS:A,startDTS:R,endDTS:C}),d.setElementaryStreamInfo(as.AUDIO,N,A,R,C),this.bufferFragmentData(S,d,h,o)}if(v&&x!=null&&x.samples.length){const N={id:t,frag:d,details:v,samples:x.samples};n.trigger(F.FRAG_PARSING_METADATA,N)}if(v&&g){const N={id:t,frag:d,details:v,samples:g.samples};n.trigger(F.FRAG_PARSING_USERDATA,N)}}logMuxedErr(e){this.warn(`${Cs(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,n,r){if(this.state!==Me.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:o,video:c,audiovideo:d}=t;if(o){const u=e.audioCodec;let m=lu(o.codec,u);m==="mp4a"&&(m="mp4a.40.5");const g=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){m&&(m.indexOf("mp4a.40.5")!==-1?m="mp4a.40.2":m="mp4a.40.5");const x=o.metadata;x&&"channelCount"in x&&(x.channelCount||1)!==1&&g.indexOf("firefox")===-1&&(m="mp4a.40.5")}m&&m.indexOf("mp4a.40.5")!==-1&&g.indexOf("android")!==-1&&o.container!=="audio/mpeg"&&(m="mp4a.40.2",this.log(`Android: force audio codec to ${m}`)),u&&u!==m&&this.log(`Swapping manifest audio codec "${u}" for "${m}"`),o.levelCodec=m,o.id=Je.MAIN,this.log(`Init audio buffer, container:${o.container}, codecs[selected/level/parsed]=[${m||""}/${u||""}/${o.codec}]`),delete t.audiovideo}if(c){c.levelCodec=e.videoCodec,c.id=Je.MAIN;const u=c.codec;if(u?.length===4)switch(u){case"hvc1":case"hev1":c.codec="hvc1.1.6.L120.90";break;case"av01":c.codec="av01.0.04M.08";break;case"avc1":c.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${c.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${c.codec!==u?" parsed-corrected="+c.codec:""}${c.supplemental?" supplemental="+c.supplemental:""}`),delete t.audiovideo}d&&(this.log(`Init audiovideo buffer, container:${d.container}, codecs[level/parsed]=[${e.codecs}/${d.codec}]`),delete t.video,delete t.audio);const h=Object.keys(t);if(h.length){if(this.hls.trigger(F.BUFFER_CODECS,t),!this.hls)return;h.forEach(u=>{const g=t[u].initSegment;g!=null&&g.byteLength&&this.hls.trigger(F.BUFFER_APPENDING,{type:u,data:g,frag:n,part:null,chunkMeta:r,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Je.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,n=e?.[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Me.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(yt.isBuffered(e,n)?t=this.getAppendedFrag(n):yt.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const r=this.fragPlaying,o=t.level;(!r||t.sn!==r.sn||r.level!==o)&&(this.fragPlaying=t,this.hls.trigger(F.FRAG_CHANGED,{frag:t}),(!r||r.level!==o)&&this.hls.trigger(F.LEVEL_SWITCHED,{level:o}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Xe(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Xe(t)){const n=this.getLevelDetails(),r=this.currentFrag||(n?Mr(null,n.fragments,t):null);if(r){const o=r.programDateTime;if(o!==null){const c=o+(t-r.start)*1e3;return new Date(c)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class qO extends ai{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const r=this.keyIdToKeyInfo[n].loader;if(r){var t;if(e&&e!==((t=r.context)==null?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=_e.KEY_LOAD_ERROR,n,r,o){return new ta({type:tt.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:o,error:n,networkDetails:r})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,o=t.length;r<o;r++){const c=t[r];if(e.cc<=c.cc&&(!Cs(e)||!Cs(c)||e.sn<c.sn)||!n&&r==o-1)return this.emeController.selectKeySystemFormat(c).then(d=>{if(!this.emeController)return;c.setKeyFormat(d);const h=du(d);if(h)return this.emeController.getKeySystemAccess([h])})}if(this.config.requireKeySystemAccessOnStart){const r=Zl(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,r;t&&e.setKeyFormat(t);const o=e.decryptdata;if(!o){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,_e.KEY_LOAD_ERROR,u))}const c=o.uri;if(!c)return Promise.reject(this.createKeyLoadError(e,_e.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${c}"`)));const d=Om(o);let h=this.keyIdToKeyInfo[d];if((n=h)!=null&&n.decryptdata.key)return o.key=h.decryptdata.key,Promise.resolve({frag:e,keyInfo:h});if(this.emeController&&(r=h)!=null&&r.keyLoadPromise)switch(this.emeController.getKeyStatus(h.decryptdata)){case"usable":case"usable-in-future":return h.keyLoadPromise.then(m=>{const{keyInfo:g}=m;return o.key=g.decryptdata.key,{frag:e,keyInfo:g}})}switch(this.log(`${this.keyIdToKeyInfo[d]?"Rel":"L"}oading${o.keyId?" keyId: "+Zs(o.keyId):""} URI: ${o.uri} from ${e.type} ${e.level}`),h=this.keyIdToKeyInfo[d]={decryptdata:o,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},o.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return o.keyFormat==="identity"?this.loadKeyHTTP(h,e):this.loadKeyEME(h,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(h,e);default:return Promise.reject(this.createKeyLoadError(e,_e.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${o.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var r;if(!e.decryptdata.keyId&&(r=t.initSegment)!=null&&r.data){const c=uD(t.initSegment.data);if(c.length){let d=c[0];d.some(h=>h!==0)?(this.log(`Using keyId found in init segment ${Zs(d)}`),Ga.setKeyIdForUri(e.decryptdata.uri,d)):(d=Ga.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Zs(d)}`)),e.decryptdata.keyId=d}}if(!e.decryptdata.keyId&&!Cs(t))return Promise.resolve(n);const o=this.emeController.loadKey(n);return(e.keyLoadPromise=o.then(c=>(e.mediaKeySessionContext=c,n))).catch(c=>{throw e.keyLoadPromise=null,"data"in c&&(c.data.frag=t),c})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,r=n.loader,o=new r(n);return t.keyLoader=e.loader=o,e.keyLoadPromise=new Promise((c,d)=>{const h={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=n.keyLoadPolicy.default,m={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(x,y,v,S)=>{const{frag:N,keyInfo:A}=v,R=Om(A.decryptdata);if(!N.decryptdata||A!==this.keyIdToKeyInfo[R])return d(this.createKeyLoadError(N,_e.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),S));A.decryptdata.key=N.decryptdata.key=new Uint8Array(x.data),N.keyLoader=null,A.loader=null,c({frag:N,keyInfo:A})},onError:(x,y,v,S)=>{this.resetLoader(y),d(this.createKeyLoadError(t,_e.KEY_LOAD_ERROR,new Error(`HTTP Error ${x.code} loading key ${x.text}`),v,Qt({url:h.url,data:void 0},x)))},onTimeout:(x,y,v)=>{this.resetLoader(y),d(this.createKeyLoadError(t,_e.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),v))},onAbort:(x,y,v)=>{this.resetLoader(y),d(this.createKeyLoadError(t,_e.INTERNAL_ABORTED,new Error("key loading aborted"),v))}};o.load(h,m,g)})}resetLoader(e){const{frag:t,keyInfo:n,url:r}=e,o=n.loader;t.keyLoader===o&&(t.keyLoader=null,n.loader=null);const c=Om(n.decryptdata)||r;delete this.keyIdToKeyInfo[c],o&&o.destroy()}}function Om(i){if(i.keyFormat!==en.FAIRPLAY){const e=i.keyId;if(e)return Zs(e)}return i.uri}function L_(i){const{type:e}=i;switch(e){case Rt.AUDIO_TRACK:return Je.AUDIO;case Rt.SUBTITLE_TRACK:return Je.SUBTITLE;default:return Je.MAIN}}function Pm(i,e){let t=i.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class zO{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.LEVEL_LOADING,this.onLevelLoading,this),e.on(F.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(F.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(F.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.LEVEL_LOADING,this.onLevelLoading,this),e.off(F.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(F.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(F.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,r=t.loader,o=n||r,c=new o(t);return this.loaders[e.type]=c,c}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Rt.MANIFEST,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:r,pathwayId:o,url:c,deliveryDirectives:d,levelInfo:h}=t;this.load({id:n,level:r,pathwayId:o,responseType:"text",type:Rt.LEVEL,url:c,deliveryDirectives:d,levelOrTrack:h})}onAudioTrackLoading(e,t){const{id:n,groupId:r,url:o,deliveryDirectives:c,track:d}=t;this.load({id:n,groupId:r,level:null,responseType:"text",type:Rt.AUDIO_TRACK,url:o,deliveryDirectives:c,levelOrTrack:d})}onSubtitleTrackLoading(e,t){const{id:n,groupId:r,url:o,deliveryDirectives:c,track:d}=t;this.load({id:n,groupId:r,level:null,responseType:"text",type:Rt.SUBTITLE_TRACK,url:o,deliveryDirectives:c,levelOrTrack:d})}onLevelsUpdated(e,t){const n=this.loaders[Rt.LEVEL];if(n){const r=n.context;r&&!t.levels.some(o=>o===r.levelOrTrack)&&(n.abort(),delete this.loaders[Rt.LEVEL])}}load(e){var t;const n=this.hls.config;let r=this.getInternalLoader(e);if(r){const u=this.hls.logger,m=r.context;if(m&&m.levelOrTrack===e.levelOrTrack&&(m.url===e.url||m.deliveryDirectives&&!e.deliveryDirectives)){m.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${m.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let o;if(e.type===Rt.MANIFEST?o=n.manifestLoadPolicy.default:o=ns({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),Xe((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===Rt.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===Rt.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===Rt.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const m=u.partTarget,g=u.targetduration;if(m&&g){const x=Math.max(m*3,g*.8)*1e3;o=ns({},o,{maxTimeToFirstByteMs:Math.min(x,o.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(x,o.maxTimeToFirstByteMs)})}}}const c=o.errorRetry||o.timeoutRetry||{},d={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},h={onSuccess:(u,m,g,x)=>{const y=this.getInternalLoader(g);this.resetInternalLoader(g.type);const v=u.data;m.parsing.start=performance.now(),ji.isMediaPlaylist(v)||g.type!==Rt.MANIFEST?this.handleTrackOrLevelPlaylist(u,m,g,x||null,y):this.handleMasterPlaylist(u,m,g,x)},onError:(u,m,g,x)=>{this.handleNetworkError(m,g,!1,u,x)},onTimeout:(u,m,g)=>{this.handleNetworkError(m,g,!0,void 0,u)}};r.load(e,d,h)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,r){const o=this.hls,c=e.data,d=Pm(e,n),h=ji.parseMasterPlaylist(c,d);if(h.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,n,h.playlistParsingError,r,t);return}const{contentSteering:u,levels:m,sessionData:g,sessionKeys:x,startTimeOffset:y,variableList:v}=h;this.variableList=v,m.forEach(R=>{const{unknownCodecs:C}=R;if(C){const{preferManagedMediaSource:D}=this.hls.config;let{audioCodec:V,videoCodec:z}=R;for(let B=C.length;B--;){const I=C[B];ac(I,"audio",D)?(R.audioCodec=V=V?`${V},${I}`:I,Go.audio[V.substring(0,4)]=2,C.splice(B,1)):ac(I,"video",D)&&(R.videoCodec=z=z?`${z},${I}`:I,Go.video[z.substring(0,4)]=2,C.splice(B,1))}}});const{AUDIO:S=[],SUBTITLES:N,"CLOSED-CAPTIONS":A}=ji.parseMasterPlaylistMedia(c,d,h);S.length&&!S.some(C=>!C.url)&&m[0].audioCodec&&!m[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),S.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new xs({}),bitrate:0,url:""})),o.trigger(F.MANIFEST_LOADED,{levels:m,audioTracks:S,subtitles:N,captions:A,contentSteering:u,url:d,stats:t,networkDetails:r,sessionData:g,sessionKeys:x,startTimeOffset:y,variableList:v})}handleTrackOrLevelPlaylist(e,t,n,r,o){const c=this.hls,{id:d,level:h,type:u}=n,m=Pm(e,n),g=Xe(h)?h:Xe(d)?d:0,x=L_(n),y=ji.parseLevelPlaylist(e.data,m,g,x,0,this.variableList);if(u===Rt.MANIFEST){const v={attrs:new xs({}),bitrate:0,details:y,name:"",url:m};y.requestScheduled=t.loading.start+$1(y,0),c.trigger(F.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:m,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=y,this.handlePlaylistLoaded(y,e,t,n,r,o)}handleManifestParsingError(e,t,n,r,o){this.hls.trigger(F.ERROR,{type:tt.NETWORK_ERROR,details:_e.MANIFEST_PARSING_ERROR,fatal:t.type===Rt.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:r,stats:o})}handleNetworkError(e,t,n=!1,r,o){let c=`A network ${n?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===Rt.LEVEL?c+=`: ${e.level} id: ${e.id}`:(e.type===Rt.AUDIO_TRACK||e.type===Rt.SUBTITLE_TRACK)&&(c+=` id: ${e.id} group-id: "${e.groupId}"`);const d=new Error(c);this.hls.logger.warn(`[playlist-loader]: ${c}`);let h=_e.UNKNOWN,u=!1;const m=this.getInternalLoader(e);switch(e.type){case Rt.MANIFEST:h=n?_e.MANIFEST_LOAD_TIMEOUT:_e.MANIFEST_LOAD_ERROR,u=!0;break;case Rt.LEVEL:h=n?_e.LEVEL_LOAD_TIMEOUT:_e.LEVEL_LOAD_ERROR,u=!1;break;case Rt.AUDIO_TRACK:h=n?_e.AUDIO_TRACK_LOAD_TIMEOUT:_e.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case Rt.SUBTITLE_TRACK:h=n?_e.SUBTITLE_TRACK_LOAD_TIMEOUT:_e.SUBTITLE_LOAD_ERROR,u=!1;break}m&&this.resetInternalLoader(e.type);const g={type:tt.NETWORK_ERROR,details:h,fatal:u,url:e.url,loader:m,context:e,error:d,networkDetails:t,stats:o};if(r){const x=t?.url||e.url;g.response=Qt({url:x,data:void 0},r)}this.hls.trigger(F.ERROR,g)}handlePlaylistLoaded(e,t,n,r,o,c){const d=this.hls,{type:h,level:u,levelOrTrack:m,id:g,groupId:x,deliveryDirectives:y}=r,v=Pm(t,r),S=L_(r);let N=typeof r.level=="number"&&S===Je.MAIN?u:void 0;const A=e.playlistParsingError;if(A){if(this.hls.logger.warn(`${A} ${e.url}`),!d.config.ignorePlaylistParsingErrors){d.trigger(F.ERROR,{type:tt.NETWORK_ERROR,details:_e.LEVEL_PARSING_ERROR,fatal:!1,url:v,error:A,reason:A.message,response:t,context:r,level:N,parent:S,networkDetails:o,stats:n});return}e.playlistParsingError=null}if(!e.fragments.length){const R=e.playlistParsingError=new Error("No Segments found in Playlist");d.trigger(F.ERROR,{type:tt.NETWORK_ERROR,details:_e.LEVEL_EMPTY_ERROR,fatal:!1,url:v,error:R,reason:R.message,response:t,context:r,level:N,parent:S,networkDetails:o,stats:n});return}switch(e.live&&c&&(c.getCacheAge&&(e.ageHeader=c.getCacheAge()||0),(!c.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),h){case Rt.MANIFEST:case Rt.LEVEL:if(N){if(!m)N=0;else if(m!==d.levels[N]){const R=d.levels.indexOf(m);R>-1&&(N=R)}}d.trigger(F.LEVEL_LOADED,{details:e,levelInfo:m||d.levels[0],level:N||0,id:g||0,stats:n,networkDetails:o,deliveryDirectives:y,withoutMultiVariant:h===Rt.MANIFEST});break;case Rt.AUDIO_TRACK:d.trigger(F.AUDIO_TRACK_LOADED,{details:e,track:m,id:g||0,groupId:x||"",stats:n,networkDetails:o,deliveryDirectives:y});break;case Rt.SUBTITLE_TRACK:d.trigger(F.SUBTITLE_TRACK_LOADED,{details:e,track:m,id:g||0,groupId:x||"",stats:n,networkDetails:o,deliveryDirectives:y});break}}}class us{static get version(){return lc}static isMSESupported(){return FE()}static isSupported(){return GO()}static getMediaSource(){return qa()}static get Events(){return F}static get MetadataSchema(){return Un}static get ErrorTypes(){return tt}static get ErrorDetails(){return _e}static get DefaultConfig(){return us.defaultConfig?us.defaultConfig:RO}static set DefaultConfig(e){us.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new w0,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=Z4(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=kO(us.DefaultConfig,e,t);this.userConfig=e,n.progressive&&DO(n,t);const{abrController:r,bufferController:o,capLevelController:c,errorController:d,fpsController:h}=n,u=new d(this),m=this.abrController=new r(this),g=new YD(this),x=n.interstitialsController,y=x?this.interstitialsController=new x(this,us):null,v=this.bufferController=new o(this,g),S=this.capLevelController=new c(this),N=new h(this),A=new zO(this),R=n.contentSteeringController,C=R?new R(this):null,D=this.levelController=new $O(this,C),V=new UO(this),z=new qO(this.config,this.logger),B=this.streamController=new KO(this,g,z),I=this.gapController=new PO(this,g);S.setStreamController(B),N.setStreamController(B);const M=[A,D,B];y&&M.splice(1,0,y),C&&M.splice(1,0,C),this.networkControllers=M;const L=[m,v,I,S,N,V,g];this.audioTrackController=this.createController(n.audioTrackController,M);const O=n.audioStreamController;O&&M.push(this.audioStreamController=new O(this,g,z)),this.subtitleTrackController=this.createController(n.subtitleTrackController,M);const J=n.subtitleStreamController;J&&M.push(this.subtititleStreamController=new J(this,g,z)),this.createController(n.timelineController,L),z.emeController=this.emeController=this.createController(n.emeController,L),this.cmcdController=this.createController(n.cmcdController,L),this.latencyController=this.createController(FO,L),this.coreComponents=L,M.push(u);const ie=u.onErrorOut;typeof ie=="function"&&this.on(F.ERROR,ie,u),this.on(F.MANIFEST_LOADED,A.onManifestLoaded,A)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,r){this._emitter.off(e,t,n,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const r=e===F.ERROR;this.trigger(F.ERROR,{type:tt.OTHER_ERROR,details:_e.INTERNAL_EXCEPTION,fatal:r,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(F.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const o=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(F.ERROR,{type:tt.OTHER_ERROR,details:_e.ATTACH_MEDIA_ERROR,fatal:!0,error:o});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,r=t?e:{media:n};this._media=n,this.trigger(F.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(F.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(F.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,r=this._url=m0.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),t&&n&&(n!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(F.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),!(!this.started||!this.networkControllers));n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[Je.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Je.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Je.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=P3()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){kD(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let r=0;r<n;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let r;if(t===-1&&e!=null&&e.length?r=e.length-1:r=t,n)for(let o=r;o--;){const c=e[o].attrs["HDCP-LEVEL"];if(c&&c<=n)return o}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const n=T1(t);return N1(e,n,navigator.mediaCapabilities)}}us.defaultConfig=void 0;var Bm={exports:{}},k_;function YO(){return k_||(k_=1,(function(i,e){(function(t,n){i.exports=n()})(window,(function(){return(function(t){var n={};function r(o){if(n[o])return n[o].exports;var c=n[o]={i:o,l:!1,exports:{}};return t[o].call(c.exports,c,c.exports,r),c.l=!0,c.exports}return r.m=t,r.c=n,r.d=function(o,c,d){r.o(o,c)||Object.defineProperty(o,c,{enumerable:!0,get:d})},r.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},r.t=function(o,c){if(1&c&&(o=r(o)),8&c||4&c&&typeof o=="object"&&o&&o.__esModule)return o;var d=Object.create(null);if(r.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:o}),2&c&&typeof o!="string")for(var h in o)r.d(d,h,(function(u){return o[u]}).bind(null,h));return d},r.n=function(o){var c=o&&o.__esModule?function(){return o.default}:function(){return o};return r.d(c,"a",c),c},r.o=function(o,c){return Object.prototype.hasOwnProperty.call(o,c)},r.p="",r(r.s=20)})([function(t,n,r){var o=r(9),c=r.n(o),d=(function(){function h(){}return h.e=function(u,m){u&&!h.FORCE_GLOBAL_TAG||(u=h.GLOBAL_TAG);var g="[".concat(u,"] > ").concat(m);h.ENABLE_CALLBACK&&h.emitter.emit("log","error",g),h.ENABLE_ERROR&&(console.error?console.error(g):console.warn?console.warn(g):console.log(g))},h.i=function(u,m){u&&!h.FORCE_GLOBAL_TAG||(u=h.GLOBAL_TAG);var g="[".concat(u,"] > ").concat(m);h.ENABLE_CALLBACK&&h.emitter.emit("log","info",g),h.ENABLE_INFO&&(console.info?console.info(g):console.log(g))},h.w=function(u,m){u&&!h.FORCE_GLOBAL_TAG||(u=h.GLOBAL_TAG);var g="[".concat(u,"] > ").concat(m);h.ENABLE_CALLBACK&&h.emitter.emit("log","warn",g),h.ENABLE_WARN&&(console.warn?console.warn(g):console.log(g))},h.d=function(u,m){u&&!h.FORCE_GLOBAL_TAG||(u=h.GLOBAL_TAG);var g="[".concat(u,"] > ").concat(m);h.ENABLE_CALLBACK&&h.emitter.emit("log","debug",g),h.ENABLE_DEBUG&&(console.debug?console.debug(g):console.log(g))},h.v=function(u,m){u&&!h.FORCE_GLOBAL_TAG||(u=h.GLOBAL_TAG);var g="[".concat(u,"] > ").concat(m);h.ENABLE_CALLBACK&&h.emitter.emit("log","verbose",g),h.ENABLE_VERBOSE&&console.log(g)},h})();d.GLOBAL_TAG="mpegts.js",d.FORCE_GLOBAL_TAG=!1,d.ENABLE_ERROR=!0,d.ENABLE_INFO=!0,d.ENABLE_WARN=!0,d.ENABLE_DEBUG=!0,d.ENABLE_VERBOSE=!0,d.ENABLE_CALLBACK=!1,d.emitter=new c.a,n.a=d},function(t,n,r){var o;(function(c){c.IO_ERROR="io_error",c.DEMUX_ERROR="demux_error",c.INIT_SEGMENT="init_segment",c.MEDIA_SEGMENT="media_segment",c.LOADING_COMPLETE="loading_complete",c.RECOVERED_EARLY_EOF="recovered_early_eof",c.MEDIA_INFO="media_info",c.METADATA_ARRIVED="metadata_arrived",c.SCRIPTDATA_ARRIVED="scriptdata_arrived",c.TIMED_ID3_METADATA_ARRIVED="timed_id3_metadata_arrived",c.SYNCHRONOUS_KLV_METADATA_ARRIVED="synchronous_klv_metadata_arrived",c.ASYNCHRONOUS_KLV_METADATA_ARRIVED="asynchronous_klv_metadata_arrived",c.SMPTE2038_METADATA_ARRIVED="smpte2038_metadata_arrived",c.SCTE35_METADATA_ARRIVED="scte35_metadata_arrived",c.PES_PRIVATE_DATA_DESCRIPTOR="pes_private_data_descriptor",c.PES_PRIVATE_DATA_ARRIVED="pes_private_data_arrived",c.STATISTICS_INFO="statistics_info",c.RECOMMEND_SEEKPOINT="recommend_seekpoint"})(o||(o={})),n.a=o},function(t,n,r){r.d(n,"c",(function(){return c})),r.d(n,"b",(function(){return d})),r.d(n,"a",(function(){return h}));var o=r(3),c={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},d={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},h=(function(){function u(m){this._type=m||"undefined",this._status=c.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return u.prototype.destroy=function(){this._status=c.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},u.prototype.isWorking=function(){return this._status===c.kConnecting||this._status===c.kBuffering},Object.defineProperty(u.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(m){this._onContentLengthKnown=m},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(m){this._onURLRedirect=m},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(m){this._onDataArrival=m},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"onError",{get:function(){return this._onError},set:function(m){this._onError=m},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"onComplete",{get:function(){return this._onComplete},set:function(m){this._onComplete=m},enumerable:!1,configurable:!0}),u.prototype.open=function(m,g){throw new o.c("Unimplemented abstract function!")},u.prototype.abort=function(){throw new o.c("Unimplemented abstract function!")},u})()},function(t,n,r){r.d(n,"d",(function(){return d})),r.d(n,"a",(function(){return h})),r.d(n,"b",(function(){return u})),r.d(n,"c",(function(){return m}));var o,c=(o=function(g,x){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,v){y.__proto__=v}||function(y,v){for(var S in v)Object.prototype.hasOwnProperty.call(v,S)&&(y[S]=v[S])})(g,x)},function(g,x){if(typeof x!="function"&&x!==null)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");function y(){this.constructor=g}o(g,x),g.prototype=x===null?Object.create(x):(y.prototype=x.prototype,new y)}),d=(function(){function g(x){this._message=x}return Object.defineProperty(g.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),g.prototype.toString=function(){return this.name+": "+this.message},g})(),h=(function(g){function x(y){return g.call(this,y)||this}return c(x,g),Object.defineProperty(x.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),x})(d),u=(function(g){function x(y){return g.call(this,y)||this}return c(x,g),Object.defineProperty(x.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),x})(d),m=(function(g){function x(y){return g.call(this,y)||this}return c(x,g),Object.defineProperty(x.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),x})(d)},function(t,n,r){var o;(function(c){c.ERROR="error",c.LOADING_COMPLETE="loading_complete",c.RECOVERED_EARLY_EOF="recovered_early_eof",c.MEDIA_INFO="media_info",c.METADATA_ARRIVED="metadata_arrived",c.SCRIPTDATA_ARRIVED="scriptdata_arrived",c.TIMED_ID3_METADATA_ARRIVED="timed_id3_metadata_arrived",c.SYNCHRONOUS_KLV_METADATA_ARRIVED="synchronous_klv_metadata_arrived",c.ASYNCHRONOUS_KLV_METADATA_ARRIVED="asynchronous_klv_metadata_arrived",c.SMPTE2038_METADATA_ARRIVED="smpte2038_metadata_arrived",c.SCTE35_METADATA_ARRIVED="scte35_metadata_arrived",c.PES_PRIVATE_DATA_DESCRIPTOR="pes_private_data_descriptor",c.PES_PRIVATE_DATA_ARRIVED="pes_private_data_arrived",c.STATISTICS_INFO="statistics_info",c.DESTROYING="destroying"})(o||(o={})),n.a=o},function(t,n,r){var o={};(function(){var c=self.navigator.userAgent.toLowerCase(),d=/(edge)\/([\w.]+)/.exec(c)||/(opr)[\/]([\w.]+)/.exec(c)||/(chrome)[ \/]([\w.]+)/.exec(c)||/(iemobile)[\/]([\w.]+)/.exec(c)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(c)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(c)||/(webkit)[ \/]([\w.]+)/.exec(c)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(c)||/(msie) ([\w.]+)/.exec(c)||c.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(c)||c.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(c)||[],h=/(ipad)/.exec(c)||/(ipod)/.exec(c)||/(windows phone)/.exec(c)||/(iphone)/.exec(c)||/(kindle)/.exec(c)||/(android)/.exec(c)||/(windows)/.exec(c)||/(mac)/.exec(c)||/(linux)/.exec(c)||/(cros)/.exec(c)||[],u={browser:d[5]||d[3]||d[1]||"",version:d[2]||d[4]||"0",majorVersion:d[4]||d[2]||"0",platform:h[0]||""},m={};if(u.browser){m[u.browser]=!0;var g=u.majorVersion.split(".");m.version={major:parseInt(u.majorVersion,10),string:u.version},g.length>1&&(m.version.minor=parseInt(g[1],10)),g.length>2&&(m.version.build=parseInt(g[2],10))}u.platform&&(m[u.platform]=!0),(m.chrome||m.opr||m.safari)&&(m.webkit=!0),(m.rv||m.iemobile)&&(m.rv&&delete m.rv,u.browser="msie",m.msie=!0),m.edge&&(delete m.edge,u.browser="msedge",m.msedge=!0),m.opr&&(u.browser="opera",m.opera=!0),m.safari&&m.android&&(u.browser="android",m.android=!0);for(var x in m.name=u.browser,m.platform=u.platform,o)o.hasOwnProperty(x)&&delete o[x];Object.assign(o,m)})(),n.a=o},function(t,n,r){n.a={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"}},function(t,n,r){var o;(function(c){c.ERROR="error",c.SOURCE_OPEN="source_open",c.UPDATE_END="update_end",c.BUFFER_FULL="buffer_full",c.START_STREAMING="start_streaming",c.END_STREAMING="end_streaming"})(o||(o={})),n.a=o},function(t,n,r){var o=r(9),c=r.n(o),d=r(0),h=(function(){function u(){}return Object.defineProperty(u,"forceGlobalTag",{get:function(){return d.a.FORCE_GLOBAL_TAG},set:function(m){d.a.FORCE_GLOBAL_TAG=m,u._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(u,"globalTag",{get:function(){return d.a.GLOBAL_TAG},set:function(m){d.a.GLOBAL_TAG=m,u._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(u,"enableAll",{get:function(){return d.a.ENABLE_VERBOSE&&d.a.ENABLE_DEBUG&&d.a.ENABLE_INFO&&d.a.ENABLE_WARN&&d.a.ENABLE_ERROR},set:function(m){d.a.ENABLE_VERBOSE=m,d.a.ENABLE_DEBUG=m,d.a.ENABLE_INFO=m,d.a.ENABLE_WARN=m,d.a.ENABLE_ERROR=m,u._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(u,"enableDebug",{get:function(){return d.a.ENABLE_DEBUG},set:function(m){d.a.ENABLE_DEBUG=m,u._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(u,"enableVerbose",{get:function(){return d.a.ENABLE_VERBOSE},set:function(m){d.a.ENABLE_VERBOSE=m,u._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(u,"enableInfo",{get:function(){return d.a.ENABLE_INFO},set:function(m){d.a.ENABLE_INFO=m,u._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(u,"enableWarn",{get:function(){return d.a.ENABLE_WARN},set:function(m){d.a.ENABLE_WARN=m,u._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(u,"enableError",{get:function(){return d.a.ENABLE_ERROR},set:function(m){d.a.ENABLE_ERROR=m,u._notifyChange()},enumerable:!1,configurable:!0}),u.getConfig=function(){return{globalTag:d.a.GLOBAL_TAG,forceGlobalTag:d.a.FORCE_GLOBAL_TAG,enableVerbose:d.a.ENABLE_VERBOSE,enableDebug:d.a.ENABLE_DEBUG,enableInfo:d.a.ENABLE_INFO,enableWarn:d.a.ENABLE_WARN,enableError:d.a.ENABLE_ERROR,enableCallback:d.a.ENABLE_CALLBACK}},u.applyConfig=function(m){d.a.GLOBAL_TAG=m.globalTag,d.a.FORCE_GLOBAL_TAG=m.forceGlobalTag,d.a.ENABLE_VERBOSE=m.enableVerbose,d.a.ENABLE_DEBUG=m.enableDebug,d.a.ENABLE_INFO=m.enableInfo,d.a.ENABLE_WARN=m.enableWarn,d.a.ENABLE_ERROR=m.enableError,d.a.ENABLE_CALLBACK=m.enableCallback},u._notifyChange=function(){var m=u.emitter;if(m.listenerCount("change")>0){var g=u.getConfig();m.emit("change",g)}},u.registerListener=function(m){u.emitter.addListener("change",m)},u.removeListener=function(m){u.emitter.removeListener("change",m)},u.addLogListener=function(m){d.a.emitter.addListener("log",m),d.a.emitter.listenerCount("log")>0&&(d.a.ENABLE_CALLBACK=!0,u._notifyChange())},u.removeLogListener=function(m){d.a.emitter.removeListener("log",m),d.a.emitter.listenerCount("log")===0&&(d.a.ENABLE_CALLBACK=!1,u._notifyChange())},u})();h.emitter=new c.a,n.a=h},function(t,n,r){var o,c=typeof Reflect=="object"?Reflect:null,d=c&&typeof c.apply=="function"?c.apply:function(D,V,z){return Function.prototype.apply.call(D,V,z)};o=c&&typeof c.ownKeys=="function"?c.ownKeys:Object.getOwnPropertySymbols?function(D){return Object.getOwnPropertyNames(D).concat(Object.getOwnPropertySymbols(D))}:function(D){return Object.getOwnPropertyNames(D)};var h=Number.isNaN||function(D){return D!=D};function u(){u.init.call(this)}t.exports=u,t.exports.once=function(D,V){return new Promise((function(z,B){function I(L){D.removeListener(V,M),B(L)}function M(){typeof D.removeListener=="function"&&D.removeListener("error",I),z([].slice.call(arguments))}C(D,V,M,{once:!0}),V!=="error"&&(function(L,O,J){typeof L.on=="function"&&C(L,"error",O,J)})(D,I,{once:!0})}))},u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var m=10;function g(D){if(typeof D!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof D)}function x(D){return D._maxListeners===void 0?u.defaultMaxListeners:D._maxListeners}function y(D,V,z,B){var I,M,L,O;if(g(z),(M=D._events)===void 0?(M=D._events=Object.create(null),D._eventsCount=0):(M.newListener!==void 0&&(D.emit("newListener",V,z.listener?z.listener:z),M=D._events),L=M[V]),L===void 0)L=M[V]=z,++D._eventsCount;else if(typeof L=="function"?L=M[V]=B?[z,L]:[L,z]:B?L.unshift(z):L.push(z),(I=x(D))>0&&L.length>I&&!L.warned){L.warned=!0;var J=new Error("Possible EventEmitter memory leak detected. "+L.length+" "+String(V)+" listeners added. Use emitter.setMaxListeners() to increase limit");J.name="MaxListenersExceededWarning",J.emitter=D,J.type=V,J.count=L.length,O=J,console&&console.warn&&console.warn(O)}return D}function v(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function S(D,V,z){var B={fired:!1,wrapFn:void 0,target:D,type:V,listener:z},I=v.bind(B);return I.listener=z,B.wrapFn=I,I}function N(D,V,z){var B=D._events;if(B===void 0)return[];var I=B[V];return I===void 0?[]:typeof I=="function"?z?[I.listener||I]:[I]:z?(function(M){for(var L=new Array(M.length),O=0;O<L.length;++O)L[O]=M[O].listener||M[O];return L})(I):R(I,I.length)}function A(D){var V=this._events;if(V!==void 0){var z=V[D];if(typeof z=="function")return 1;if(z!==void 0)return z.length}return 0}function R(D,V){for(var z=new Array(V),B=0;B<V;++B)z[B]=D[B];return z}function C(D,V,z,B){if(typeof D.on=="function")B.once?D.once(V,z):D.on(V,z);else{if(typeof D.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof D);D.addEventListener(V,(function I(M){B.once&&D.removeEventListener(V,I),z(M)}))}}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return m},set:function(D){if(typeof D!="number"||D<0||h(D))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+D+".");m=D}}),u.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(D){if(typeof D!="number"||D<0||h(D))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+D+".");return this._maxListeners=D,this},u.prototype.getMaxListeners=function(){return x(this)},u.prototype.emit=function(D){for(var V=[],z=1;z<arguments.length;z++)V.push(arguments[z]);var B=D==="error",I=this._events;if(I!==void 0)B=B&&I.error===void 0;else if(!B)return!1;if(B){var M;if(V.length>0&&(M=V[0]),M instanceof Error)throw M;var L=new Error("Unhandled error."+(M?" ("+M.message+")":""));throw L.context=M,L}var O=I[D];if(O===void 0)return!1;if(typeof O=="function")d(O,this,V);else{var J=O.length,ie=R(O,J);for(z=0;z<J;++z)d(ie[z],this,V)}return!0},u.prototype.addListener=function(D,V){return y(this,D,V,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(D,V){return y(this,D,V,!0)},u.prototype.once=function(D,V){return g(V),this.on(D,S(this,D,V)),this},u.prototype.prependOnceListener=function(D,V){return g(V),this.prependListener(D,S(this,D,V)),this},u.prototype.removeListener=function(D,V){var z,B,I,M,L;if(g(V),(B=this._events)===void 0)return this;if((z=B[D])===void 0)return this;if(z===V||z.listener===V)--this._eventsCount==0?this._events=Object.create(null):(delete B[D],B.removeListener&&this.emit("removeListener",D,z.listener||V));else if(typeof z!="function"){for(I=-1,M=z.length-1;M>=0;M--)if(z[M]===V||z[M].listener===V){L=z[M].listener,I=M;break}if(I<0)return this;I===0?z.shift():(function(O,J){for(;J+1<O.length;J++)O[J]=O[J+1];O.pop()})(z,I),z.length===1&&(B[D]=z[0]),B.removeListener!==void 0&&this.emit("removeListener",D,L||V)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(D){var V,z,B;if((z=this._events)===void 0)return this;if(z.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):z[D]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete z[D]),this;if(arguments.length===0){var I,M=Object.keys(z);for(B=0;B<M.length;++B)(I=M[B])!=="removeListener"&&this.removeAllListeners(I);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(V=z[D])=="function")this.removeListener(D,V);else if(V!==void 0)for(B=V.length-1;B>=0;B--)this.removeListener(D,V[B]);return this},u.prototype.listeners=function(D){return N(this,D,!0)},u.prototype.rawListeners=function(D){return N(this,D,!1)},u.listenerCount=function(D,V){return typeof D.listenerCount=="function"?D.listenerCount(V):A.call(D,V)},u.prototype.listenerCount=A,u.prototype.eventNames=function(){return this._eventsCount>0?o(this._events):[]}},function(t,n,r){r.d(n,"b",(function(){return d})),r.d(n,"a",(function(){return h}));var o=r(2),c=r(6),d={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},h={NETWORK_EXCEPTION:o.b.EXCEPTION,NETWORK_STATUS_CODE_INVALID:o.b.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:o.b.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:o.b.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:c.a.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:c.a.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:c.a.CODEC_UNSUPPORTED}},function(t,n,r){r.d(n,"d",(function(){return o})),r.d(n,"b",(function(){return c})),r.d(n,"a",(function(){return d})),r.d(n,"c",(function(){return h}));var o=function(u,m,g,x,y){this.dts=u,this.pts=m,this.duration=g,this.originalDts=x,this.isSyncPoint=y,this.fileposition=null},c=(function(){function u(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return u.prototype.appendSyncPoint=function(m){m.isSyncPoint=!0,this.syncPoints.push(m)},u})(),d=(function(){function u(){this._list=[]}return u.prototype.clear=function(){this._list=[]},u.prototype.appendArray=function(m){var g=this._list;m.length!==0&&(g.length>0&&m[0].originalDts<g[g.length-1].originalDts&&this.clear(),Array.prototype.push.apply(g,m))},u.prototype.getLastSyncPointBeforeDts=function(m){if(this._list.length==0)return null;var g=this._list,x=0,y=g.length-1,v=0,S=0,N=y;for(m<g[0].dts&&(x=0,S=N+1);S<=N;){if((v=S+Math.floor((N-S)/2))===y||m>=g[v].dts&&m<g[v+1].dts){x=v;break}g[v].dts<m?S=v+1:N=v-1}return this._list[x]},u})(),h=(function(){function u(m){this._type=m,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(u.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),u.prototype.isEmpty=function(){return this._list.length===0},u.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},u.prototype._searchNearestSegmentBefore=function(m){var g=this._list;if(g.length===0)return-2;var x=g.length-1,y=0,v=0,S=x,N=0;if(m<g[0].originalBeginDts)return N=-1;for(;v<=S;){if((y=v+Math.floor((S-v)/2))===x||m>g[y].lastSample.originalDts&&m<g[y+1].originalBeginDts){N=y;break}g[y].originalBeginDts<m?v=y+1:S=y-1}return N},u.prototype._searchNearestSegmentAfter=function(m){return this._searchNearestSegmentBefore(m)+1},u.prototype.append=function(m){var g=this._list,x=m,y=this._lastAppendLocation,v=0;y!==-1&&y<g.length&&x.originalBeginDts>=g[y].lastSample.originalDts&&(y===g.length-1||y<g.length-1&&x.originalBeginDts<g[y+1].originalBeginDts)?v=y+1:g.length>0&&(v=this._searchNearestSegmentBefore(x.originalBeginDts)+1),this._lastAppendLocation=v,this._list.splice(v,0,x)},u.prototype.getLastSegmentBefore=function(m){var g=this._searchNearestSegmentBefore(m);return g>=0?this._list[g]:null},u.prototype.getLastSampleBefore=function(m){var g=this.getLastSegmentBefore(m);return g!=null?g.lastSample:null},u.prototype.getLastSyncPointBefore=function(m){for(var g=this._searchNearestSegmentBefore(m),x=this._list[g].syncPoints;x.length===0&&g>0;)g--,x=this._list[g].syncPoints;return x.length>0?x[x.length-1]:null},u})()},function(t,n,r){var o=(function(){function c(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return c.prototype.isComplete=function(){var d=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,h=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&d&&h},c.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},c.prototype.getNearestKeyframe=function(d){if(this.keyframesIndex==null)return null;var h=this.keyframesIndex,u=this._search(h.times,d);return{index:u,milliseconds:h.times[u],fileposition:h.filepositions[u]}},c.prototype._search=function(d,h){var u=0,m=d.length-1,g=0,x=0,y=m;for(h<d[0]&&(u=0,x=y+1);x<=y;){if((g=x+Math.floor((y-x)/2))===m||h>=d[g]&&h<d[g+1]){u=g;break}d[g]<h?x=g+1:y=g-1}return u},c})();n.a=o},function(t,n,r){var o=r(9),c=r.n(o),d=r(0),h=r(5),u=r(12);function m(j,T,E){var b=j;if(T+E<b.length){for(;E--;)if((192&b[++T])!=128)return!1;return!0}return!1}var g,x=function(j){for(var T=[],E=j,b=0,k=j.length;b<k;)if(E[b]<128)T.push(String.fromCharCode(E[b])),++b;else{if(!(E[b]<192)){if(E[b]<224){if(m(E,b,1)&&($=(31&E[b])<<6|63&E[b+1])>=128){T.push(String.fromCharCode(65535&$)),b+=2;continue}}else if(E[b]<240){if(m(E,b,2)&&($=(15&E[b])<<12|(63&E[b+1])<<6|63&E[b+2])>=2048&&(63488&$)!=55296){T.push(String.fromCharCode(65535&$)),b+=3;continue}}else if(E[b]<248){var $;if(m(E,b,3)&&($=(7&E[b])<<18|(63&E[b+1])<<12|(63&E[b+2])<<6|63&E[b+3])>65536&&$<1114112){$-=65536,T.push(String.fromCharCode($>>>10|55296)),T.push(String.fromCharCode(1023&$|56320)),b+=4;continue}}}T.push(""),++b}return T.join("")},y=r(3),v=(g=new ArrayBuffer(2),new DataView(g).setInt16(0,256,!0),new Int16Array(g)[0]===256),S=(function(){function j(){}return j.parseScriptData=function(T,E,b){var k={};try{var $=j.parseValue(T,E,b),G=j.parseValue(T,E+$.size,b-$.size);k[$.data]=G.data}catch(q){d.a.e("AMF",q.toString())}return k},j.parseObject=function(T,E,b){if(b<3)throw new y.a("Data not enough when parse ScriptDataObject");var k=j.parseString(T,E,b),$=j.parseValue(T,E+k.size,b-k.size),G=$.objectEnd;return{data:{name:k.data,value:$.data},size:k.size+$.size,objectEnd:G}},j.parseVariable=function(T,E,b){return j.parseObject(T,E,b)},j.parseString=function(T,E,b){if(b<2)throw new y.a("Data not enough when parse String");var k=new DataView(T,E,b).getUint16(0,!v);return{data:k>0?x(new Uint8Array(T,E+2,k)):"",size:2+k}},j.parseLongString=function(T,E,b){if(b<4)throw new y.a("Data not enough when parse LongString");var k=new DataView(T,E,b).getUint32(0,!v);return{data:k>0?x(new Uint8Array(T,E+4,k)):"",size:4+k}},j.parseDate=function(T,E,b){if(b<10)throw new y.a("Data size invalid when parse Date");var k=new DataView(T,E,b),$=k.getFloat64(0,!v),G=k.getInt16(8,!v);return{data:new Date($+=60*G*1e3),size:10}},j.parseValue=function(T,E,b){if(b<1)throw new y.a("Data not enough when parse Value");var k,$=new DataView(T,E,b),G=1,q=$.getUint8(0),te=!1;try{switch(q){case 0:k=$.getFloat64(1,!v),G+=8;break;case 1:k=!!$.getUint8(1),G+=1;break;case 2:var Z=j.parseString(T,E+1,b-1);k=Z.data,G+=Z.size;break;case 3:k={};var ae=0;for((16777215&$.getUint32(b-4,!v))==9&&(ae=3);G<b-4;){var fe=j.parseObject(T,E+G,b-G-ae);if(fe.objectEnd)break;k[fe.data.name]=fe.data.value,G+=fe.size}G<=b-3&&(16777215&$.getUint32(G-1,!v))===9&&(G+=3);break;case 8:for(k={},G+=4,ae=0,(16777215&$.getUint32(b-4,!v))==9&&(ae=3);G<b-8;){var de=j.parseVariable(T,E+G,b-G-ae);if(de.objectEnd)break;k[de.data.name]=de.data.value,G+=de.size}G<=b-3&&(16777215&$.getUint32(G-1,!v))===9&&(G+=3);break;case 9:k=void 0,G=1,te=!0;break;case 10:k=[];var me=$.getUint32(1,!v);G+=4;for(var Te=0;Te<me;Te++){var De=j.parseValue(T,E+G,b-G);k.push(De.data),G+=De.size}break;case 11:var ke=j.parseDate(T,E+1,b-1);k=ke.data,G+=ke.size;break;case 12:var Qe=j.parseString(T,E+1,b-1);k=Qe.data,G+=Qe.size;break;default:G=b,d.a.w("AMF","Unsupported AMF value type "+q)}}catch(He){d.a.e("AMF",He.toString())}return{data:k,size:G,objectEnd:te}},j})(),N=(function(){function j(T){this.TAG="ExpGolomb",this._buffer=T,this._buffer_index=0,this._total_bytes=T.byteLength,this._total_bits=8*T.byteLength,this._current_word=0,this._current_word_bits_left=0}return j.prototype.destroy=function(){this._buffer=null},j.prototype._fillCurrentWord=function(){var T=this._total_bytes-this._buffer_index;if(T<=0)throw new y.a("ExpGolomb: _fillCurrentWord() but no bytes available");var E=Math.min(4,T),b=new Uint8Array(4);b.set(this._buffer.subarray(this._buffer_index,this._buffer_index+E)),this._current_word=new DataView(b.buffer).getUint32(0,!1),this._buffer_index+=E,this._current_word_bits_left=8*E},j.prototype.readBits=function(T){if(T>32)throw new y.b("ExpGolomb: readBits() bits exceeded max 32bits!");if(T<=this._current_word_bits_left){var E=this._current_word>>>32-T;return this._current_word<<=T,this._current_word_bits_left-=T,E}var b=this._current_word_bits_left?this._current_word:0;b>>>=32-this._current_word_bits_left;var k=T-this._current_word_bits_left;this._fillCurrentWord();var $=Math.min(k,this._current_word_bits_left),G=this._current_word>>>32-$;return this._current_word<<=$,this._current_word_bits_left-=$,b=b<<$|G},j.prototype.readBool=function(){return this.readBits(1)===1},j.prototype.readByte=function(){return this.readBits(8)},j.prototype._skipLeadingZero=function(){var T;for(T=0;T<this._current_word_bits_left;T++)if((this._current_word&2147483648>>>T)!=0)return this._current_word<<=T,this._current_word_bits_left-=T,T;return this._fillCurrentWord(),T+this._skipLeadingZero()},j.prototype.readUEG=function(){var T=this._skipLeadingZero();return this.readBits(T+1)-1},j.prototype.readSEG=function(){var T=this.readUEG();return 1&T?T+1>>>1:-1*(T>>>1)},j})(),A=(function(){function j(){}return j._ebsp2rbsp=function(T){for(var E=T,b=E.byteLength,k=new Uint8Array(b),$=0,G=0;G<b;G++)G>=2&&E[G]===3&&E[G-1]===0&&E[G-2]===0||(k[$]=E[G],$++);return new Uint8Array(k.buffer,0,$)},j.parseSPS=function(T){for(var E=T.subarray(1,4),b="avc1.",k=0;k<3;k++){var $=E[k].toString(16);$.length<2&&($="0"+$),b+=$}var G=j._ebsp2rbsp(T),q=new N(G);q.readByte();var te=q.readByte();q.readByte();var Z=q.readByte();q.readUEG();var ae=j.getProfileString(te),fe=j.getLevelString(Z),de=1,me=420,Te=8,De=8;if((te===100||te===110||te===122||te===244||te===44||te===83||te===86||te===118||te===128||te===138||te===144)&&((de=q.readUEG())===3&&q.readBits(1),de<=3&&(me=[0,420,422,444][de]),Te=q.readUEG()+8,De=q.readUEG()+8,q.readBits(1),q.readBool()))for(var ke=de!==3?8:12,Qe=0;Qe<ke;Qe++)q.readBool()&&(Qe<6?j._skipScalingList(q,16):j._skipScalingList(q,64));q.readUEG();var He=q.readUEG();if(He===0)q.readUEG();else if(He===1){q.readBits(1),q.readSEG(),q.readSEG();var $e=q.readUEG();for(Qe=0;Qe<$e;Qe++)q.readSEG()}var rt=q.readUEG();q.readBits(1);var xt=q.readUEG(),ze=q.readUEG(),st=q.readBits(1);st===0&&q.readBits(1),q.readBits(1);var mt=0,at=0,it=0,gt=0;q.readBool()&&(mt=q.readUEG(),at=q.readUEG(),it=q.readUEG(),gt=q.readUEG());var $t=1,ut=1,St=0,Ht=!0,ls=0,An=0;if(q.readBool()){if(q.readBool()){var zt=q.readByte();zt>0&&zt<16?($t=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][zt-1],ut=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][zt-1]):zt===255&&($t=q.readByte()<<8|q.readByte(),ut=q.readByte()<<8|q.readByte())}if(q.readBool()&&q.readBool(),q.readBool()&&(q.readBits(4),q.readBool()&&q.readBits(24)),q.readBool()&&(q.readUEG(),q.readUEG()),q.readBool()){var zs=q.readBits(32),Vs=q.readBits(32);Ht=q.readBool(),St=(ls=Vs)/(An=2*zs)}}var Ls=1;$t===1&&ut===1||(Ls=$t/ut);var _s=0,Bt=0;de===0?(_s=1,Bt=2-st):(_s=de===3?1:2,Bt=(de===1?2:1)*(2-st));var Kn=16*(xt+1),nn=16*(ze+1)*(2-st);Kn-=(mt+at)*_s,nn-=(it+gt)*Bt;var Vr=Math.ceil(Kn*Ls);return q.destroy(),q=null,{codec_mimetype:b,profile_idc:te,level_idc:Z,profile_string:ae,level_string:fe,chroma_format_idc:de,bit_depth:Te,bit_depth_luma:Te,bit_depth_chroma:De,ref_frames:rt,chroma_format:me,chroma_format_string:j.getChromaFormatString(me),frame_rate:{fixed:Ht,fps:St,fps_den:An,fps_num:ls},sar_ratio:{width:$t,height:ut},codec_size:{width:Kn,height:nn},present_size:{width:Vr,height:nn}}},j._skipScalingList=function(T,E){for(var b=8,k=8,$=0;$<E;$++)k!==0&&(k=(b+T.readSEG()+256)%256),b=k===0?b:k},j.getProfileString=function(T){switch(T){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},j.getLevelString=function(T){return(T/10).toFixed(1)},j.getChromaFormatString=function(T){switch(T){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},j})(),R=r(6),C=(function(){function j(){}return j._ebsp2rbsp=function(T){for(var E=T,b=E.byteLength,k=new Uint8Array(b),$=0,G=0;G<b;G++)G>=2&&E[G]===3&&E[G-1]===0&&E[G-2]===0||(k[$]=E[G],$++);return new Uint8Array(k.buffer,0,$)},j.parseVPS=function(T){var E=j._ebsp2rbsp(T),b=new N(E);return b.readByte(),b.readByte(),b.readBits(4),b.readBits(2),b.readBits(6),{num_temporal_layers:b.readBits(3)+1,temporal_id_nested:b.readBool()}},j.parseSPS=function(T){var E=j._ebsp2rbsp(T),b=new N(E);b.readByte(),b.readByte();for(var k=0,$=0,G=0,q=0,te=(b.readBits(4),b.readBits(3)),Z=(b.readBool(),b.readBits(2)),ae=b.readBool(),fe=b.readBits(5),de=b.readByte(),me=b.readByte(),Te=b.readByte(),De=b.readByte(),ke=b.readByte(),Qe=b.readByte(),He=b.readByte(),$e=b.readByte(),rt=b.readByte(),xt=b.readByte(),ze=b.readByte(),st=[],mt=[],at=0;at<te;at++)st.push(b.readBool()),mt.push(b.readBool());if(te>0)for(at=te;at<8;at++)b.readBits(2);for(at=0;at<te;at++)st[at]&&(b.readByte(),b.readByte(),b.readByte(),b.readByte(),b.readByte(),b.readByte(),b.readByte(),b.readByte(),b.readByte(),b.readByte(),b.readByte()),mt[at]&&b.readByte();b.readUEG();var it=b.readUEG();it==3&&b.readBits(1);var gt=b.readUEG(),$t=b.readUEG();b.readBool()&&(k+=b.readUEG(),$+=b.readUEG(),G+=b.readUEG(),q+=b.readUEG());var ut=b.readUEG(),St=b.readUEG(),Ht=b.readUEG();for(at=b.readBool()?0:te;at<=te;at++)b.readUEG(),b.readUEG(),b.readUEG();if(b.readUEG(),b.readUEG(),b.readUEG(),b.readUEG(),b.readUEG(),b.readUEG(),b.readBool()&&b.readBool())for(var ls=0;ls<4;ls++)for(var An=0;An<(ls===3?2:6);An++)if(b.readBool()){var zt=Math.min(64,1<<4+(ls<<1));for(ls>1&&b.readSEG(),at=0;at<zt;at++)b.readSEG()}else b.readUEG();b.readBool(),b.readBool(),b.readBool()&&(b.readByte(),b.readUEG(),b.readUEG(),b.readBool());var zs=b.readUEG(),Vs=0;for(at=0;at<zs;at++){var Ls=!1;if(at!==0&&(Ls=b.readBool()),Ls){at===zs&&b.readUEG(),b.readBool(),b.readUEG();for(var _s=0,Bt=0;Bt<=Vs;Bt++){var Kn=b.readBool(),nn=!1;Kn||(nn=b.readBool()),(Kn||nn)&&_s++}Vs=_s}else{var Vr=b.readUEG(),nl=b.readUEG();for(Vs=Vr+nl,Bt=0;Bt<Vr;Bt++)b.readUEG(),b.readBool();for(Bt=0;Bt<nl;Bt++)b.readUEG(),b.readBool()}}if(b.readBool()){var Ec=b.readUEG();for(at=0;at<Ec;at++){for(Bt=0;Bt<Ht+4;Bt++)b.readBits(1);b.readBits(1)}}var Hr=0,Wa=1,Qa=1,Xa=!1,jn=1,Ja=1;if(b.readBool(),b.readBool(),b.readBool()){if(b.readBool()){var Oi=b.readByte();Oi>0&&Oi<=16?(Wa=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][Oi-1],Qa=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][Oi-1]):Oi===255&&(Wa=b.readBits(16),Qa=b.readBits(16))}if(b.readBool()&&b.readBool(),b.readBool()&&(b.readBits(3),b.readBool(),b.readBool()&&(b.readByte(),b.readByte(),b.readByte())),b.readBool()&&(b.readUEG(),b.readUEG()),b.readBool(),b.readBool(),b.readBool(),b.readBool()&&(b.readUEG(),b.readUEG(),b.readUEG(),b.readUEG()),b.readBool()&&(jn=b.readBits(32),Ja=b.readBits(32),b.readBool()&&b.readUEG(),b.readBool())){var pi=!1,xi=!1,Za=!1;for(pi=b.readBool(),xi=b.readBool(),(pi||xi)&&((Za=b.readBool())&&(b.readByte(),b.readBits(5),b.readBool(),b.readBits(5)),b.readBits(4),b.readBits(4),Za&&b.readBits(4),b.readBits(5),b.readBits(5),b.readBits(5)),at=0;at<=te;at++){var Kr=b.readBool();Xa=Kr;var il=!0,Pi=1;Kr||(il=b.readBool());var qn=!1;if(il?b.readUEG():qn=b.readBool(),qn||(Pi=b.readUEG()+1),pi){for(Bt=0;Bt<Pi;Bt++)b.readUEG(),b.readUEG(),Za&&(b.readUEG(),b.readUEG());b.readBool()}if(xi){for(Bt=0;Bt<Pi;Bt++)b.readUEG(),b.readUEG(),Za&&(b.readUEG(),b.readUEG());b.readBool()}}}b.readBool()&&(b.readBool(),b.readBool(),b.readBool(),Hr=b.readUEG(),b.readUEG(),b.readUEG(),b.readUEG(),b.readUEG())}b.readBool();var al="hvc1.".concat(fe,".1.L").concat(ze,".B0"),ha=gt-(k+$)*(it===1||it===2?2:1),li=$t-(G+q)*(it===1?2:1),qr=1;return Wa!==1&&Qa!==1&&(qr=Wa/Qa),b.destroy(),b=null,{codec_mimetype:al,profile_string:j.getProfileString(fe),level_string:j.getLevelString(ze),profile_idc:fe,bit_depth:ut+8,ref_frames:1,chroma_format:it,chroma_format_string:j.getChromaFormatString(it),general_level_idc:ze,general_profile_space:Z,general_tier_flag:ae,general_profile_idc:fe,general_profile_compatibility_flags_1:de,general_profile_compatibility_flags_2:me,general_profile_compatibility_flags_3:Te,general_profile_compatibility_flags_4:De,general_constraint_indicator_flags_1:ke,general_constraint_indicator_flags_2:Qe,general_constraint_indicator_flags_3:He,general_constraint_indicator_flags_4:$e,general_constraint_indicator_flags_5:rt,general_constraint_indicator_flags_6:xt,min_spatial_segmentation_idc:Hr,constant_frame_rate:0,chroma_format_idc:it,bit_depth_luma_minus8:ut,bit_depth_chroma_minus8:St,frame_rate:{fixed:Xa,fps:Ja/jn,fps_den:jn,fps_num:Ja},sar_ratio:{width:Wa,height:Qa},codec_size:{width:ha,height:li},present_size:{width:ha*qr,height:li}}},j.parsePPS=function(T){var E=j._ebsp2rbsp(T),b=new N(E);b.readByte(),b.readByte(),b.readUEG(),b.readUEG(),b.readBool(),b.readBool(),b.readBits(3),b.readBool(),b.readBool(),b.readUEG(),b.readUEG(),b.readSEG(),b.readBool(),b.readBool(),b.readBool()&&b.readUEG(),b.readSEG(),b.readSEG(),b.readBool(),b.readBool(),b.readBool(),b.readBool();var k=b.readBool(),$=b.readBool(),G=1;return $&&k?G=0:$?G=3:k&&(G=2),{parallelismType:G}},j.getChromaFormatString=function(T){switch(T){case 0:return"4:0:0";case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}},j.getProfileString=function(T){switch(T){case 1:return"Main";case 2:return"Main10";case 3:return"MainSP";case 4:return"Rext";case 9:return"SCC";default:return"Unknown"}},j.getLevelString=function(T){return(T/30).toFixed(1)},j})();function D(j){return j.byteOffset%2==0&&j.byteLength%2==0}function V(j){return j.byteOffset%4==0&&j.byteLength%4==0}function z(j,T){for(var E=0;E<j.length;E++)if(j[E]!==T[E])return!1;return!0}var B=function(j,T){return j.byteLength===T.byteLength&&(V(j)&&V(T)?(function(E,b){return z(new Uint32Array(E.buffer,E.byteOffset,E.byteLength/4),new Uint32Array(b.buffer,b.byteOffset,b.byteLength/4))})(j,T):D(j)&&D(T)?(function(E,b){return z(new Uint16Array(E.buffer,E.byteOffset,E.byteLength/2),new Uint16Array(b.buffer,b.byteOffset,b.byteLength/2))})(j,T):(function(E,b){return z(E,b)})(j,T))},I=function(){return(I=Object.assign||function(j){for(var T,E=1,b=arguments.length;E<b;E++)for(var k in T=arguments[E])Object.prototype.hasOwnProperty.call(T,k)&&(j[k]=T[k]);return j}).apply(this,arguments)},M=(function(){function j(){}return j.parseOBUs=function(T,E){for(var b=0;b<T.byteLength;){var k=b,$=(T[b],(120&T[b])>>3),G=(4&T[b])!=0,q=(2&T[b])!=0;T[b],b+=1,G&&(b+=1);var te=Number.POSITIVE_INFINITY;if(q){te=0;for(var Z=0;;Z++){var ae=T[b++];if(te|=(127&ae)<<7*Z,(128&ae)==0)break}}console.log($),$===1?E=I(I({},j.parseSeuqneceHeader(T.subarray(b,b+te))),{sequence_header_data:T.subarray(k,b+te)}):($==3&&E||$==6&&E)&&(E=j.parseOBUFrameHeader(T.subarray(b,b+te),0,0,E)),b+=te}return E},j.parseSeuqneceHeader=function(T){var E=new N(T),b=E.readBits(3),k=(E.readBool(),E.readBool()),$=!0,G=0,q=1,te=void 0,Z=[];if(k)Z.push({operating_point_idc:0,level:E.readBits(5),tier:0});else{if(E.readBool()){var ae=E.readBits(32),fe=E.readBits(32),de=E.readBool();if(de){for(var me=0;E.readBits(1)===0;)me+=1;me>=32||(1<<me)-1+E.readBits(me)}(G=fe)/(q=ae),$=de,E.readBool()&&(E.readBits(5),E.readBits(32),te=E.readBits(5),E.readBits(5))}for(var Te=E.readBool(),De=E.readBits(5),ke=0;ke<=De;ke++){var Qe=E.readBits(12),He=E.readBits(5),$e=He>7?E.readBits(1):0;Z.push({operating_point_idc:Qe,level:He,tier:$e}),Te&&E.readBool()&&E.readBits(4)}}var rt=Z[0],xt=rt.level,ze=rt.tier,st=E.readBits(4),mt=E.readBits(4),at=E.readBits(st+1)+1,it=E.readBits(mt+1)+1,gt=!1;k||(gt=E.readBool()),gt&&(E.readBits(4),E.readBits(4)),E.readBool(),E.readBool(),E.readBool();var $t=!1,ut=2,St=2,Ht=0;k||(E.readBool(),E.readBool(),E.readBool(),E.readBool(),($t=E.readBool())&&(E.readBool(),E.readBool()),(ut=E.readBool()?2:E.readBits(1))?St=E.readBool()?2:E.readBits(1):St=2,$t?Ht=E.readBits(3)+1:Ht=0);var ls=E.readBool(),An=(E.readBool(),E.readBool(),E.readBool()),zt=8;b===2&&An?zt=E.readBool()?12:10:zt=An?10:8;var zs=!1;b!==1&&(zs=E.readBool()),E.readBool()&&(E.readBits(8),E.readBits(8),E.readBits(8));var Vs=1,Ls=1;return zs?(E.readBits(1),Vs=1,Ls=1):(E.readBits(1),b==0?(Vs=1,Ls=1):b==1?(Vs=0,Ls=0):zt==12?E.readBits(1)&&E.readBits(1):(Vs=1,Ls=0),Vs&&Ls&&E.readBits(2),E.readBits(1)),E.readBool(),E.destroy(),E=null,{codec_mimetype:"av01.".concat(b,".").concat(j.getLevelString(xt,ze),".").concat(zt.toString(10).padStart(2,"0")),level:xt,tier:ze,level_string:j.getLevelString(xt,ze),profile_idc:b,profile_string:"".concat(b),bit_depth:zt,ref_frames:1,chroma_format:j.getChromaFormat(zs,Vs,Ls),chroma_format_string:j.getChromaFormatString(zs,Vs,Ls),sequence_header:{frame_id_numbers_present_flag:gt,additional_frame_id_length_minus_1:void 0,delta_frame_id_length_minus_2:void 0,reduced_still_picture_header:k,decoder_model_info_present_flag:!1,operating_points:Z,buffer_removal_time_length_minus_1:te,equal_picture_interval:$,seq_force_screen_content_tools:ut,seq_force_integer_mv:St,enable_order_hint:$t,order_hint_bits:Ht,enable_superres:ls,frame_width_bit:st+1,frame_height_bit:mt+1,max_frame_width:at,max_frame_height:it},keyframe:void 0,frame_rate:{fixed:$,fps:G/q,fps_den:q,fps_num:G}}},j.parseOBUFrameHeader=function(T,E,b,k){var $=k.sequence_header,G=new N(T),q=($.max_frame_width,$.max_frame_height,0);$.frame_id_numbers_present_flag&&(q=$.additional_frame_id_length_minus_1+$.delta_frame_id_length_minus_2+3);var te=0,Z=!0,ae=!0,fe=!1;if(!$.reduced_still_picture_header){if(G.readBool())return k;Z=(te=G.readBits(2))===2||te===0,(ae=G.readBool())&&$.decoder_model_info_present_flag&&$.equal_picture_interval,ae&&G.readBool(),fe=!!(te===3||te===0&&ae)||G.readBool()}k.keyframe=Z,G.readBool();var de=$.seq_force_screen_content_tools;$.seq_force_screen_content_tools===2&&(de=G.readBits(1)),de&&($.seq_force_integer_mv,$.seq_force_integer_mv==2&&G.readBits(1)),$.frame_id_numbers_present_flag&&G.readBits(q);var me=!1;if(me=te==3||!$.reduced_still_picture_header&&G.readBool(),G.readBits($.order_hint_bits),Z||fe||G.readBits(3),$.decoder_model_info_present_flag&&G.readBool()){for(var Te=0;Te<=$.operating_points_cnt_minus_1;Te++)if($.operating_points[Te].decoder_model_present_for_this_op[Te]){var De=$.operating_points[Te].operating_point_idc;(De===0||De>>E&1&&De>>b+8&1)&&G.readBits($.buffer_removal_time_length_minus_1+1)}}var ke=255;if(te===3||te==0&&ae||(ke=G.readBits(8)),(Z||ke!==255)&&fe&&$.enable_order_hint)for(var Qe=0;Qe<8;Qe++)G.readBits($.order_hint_bits);if(Z){var He=j.frameSizeAndRenderSize(G,me,$);k.codec_size={width:He.FrameWidth,height:He.FrameHeight},k.present_size={width:He.RenderWidth,height:He.RenderHeight},k.sar_ratio={width:He.RenderWidth/He.FrameWidth,height:He.RenderHeight/He.FrameHeight}}return G.destroy(),G=null,k},j.frameSizeAndRenderSize=function(T,E,b){var k=b.max_frame_width,$=b.max_frame_height;E&&(k=T.readBits(b.frame_width_bit)+1,$=T.readBits(b.frame_height_bit)+1);var G=!1;b.enable_superres&&(G=T.readBool());var q=8;G&&(q=T.readBits(3)+9);var te=k;k=Math.floor((8*te+q/2)/q);var Z=te,ae=$;if(T.readBool()){var fe=T.readBits(16)+1,de=T.readBits(16)+1;Z=T.readBits(fe)+1,ae=T.readBits(de)+1}return{UpscaledWidth:te,FrameWidth:k,FrameHeight:$,RenderWidth:Z,RenderHeight:ae}},j.getLevelString=function(T,E){return"".concat(T.toString(10).padStart(2,"0")).concat(E===0?"M":"H")},j.getChromaFormat=function(T,E,b){return T?0:E===0&&b===0?3:E===1&&b===0?2:E===1&&b===1?1:Number.NaN},j.getChromaFormatString=function(T,E,b){return T?"4:0:0":E===0&&b===0?"4:4:4":E===1&&b===0?"4:2:2":E===1&&b===1?"4:2:0":"Unknown"},j})(),L,O=(function(){function j(T,E){this.TAG="FLVDemuxer",this._config=E,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=T.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=T.hasAudioTrack,this._hasVideo=T.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new u.a,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=(function(){var b=new ArrayBuffer(2);return new DataView(b).setInt16(0,256,!0),new Int16Array(b)[0]===256})()}return j.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},j.probe=function(T){var E=new Uint8Array(T);if(E.byteLength<9)return{needMoreData:!0};var b={match:!1};if(E[0]!==70||E[1]!==76||E[2]!==86||E[3]!==1)return b;var k,$,G=(4&E[4])>>>2!=0,q=(1&E[4])!=0,te=(k=E)[$=5]<<24|k[$+1]<<16|k[$+2]<<8|k[$+3];return te<9?b:{match:!0,consumed:te,dataOffset:te,hasAudioTrack:G,hasVideoTrack:q}},j.prototype.bindDataSource=function(T){return T.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(j.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(T){this._onTrackMetadata=T},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(T){this._onMediaInfo=T},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(T){this._onMetaDataArrived=T},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(T){this._onScriptDataArrived=T},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"onError",{get:function(){return this._onError},set:function(T){this._onError=T},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(T){this._onDataAvailable=T},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(T){this._timestampBase=T},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"overridedDuration",{get:function(){return this._duration},set:function(T){this._durationOverrided=!0,this._duration=T,this._mediaInfo.duration=T},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"overridedHasAudio",{set:function(T){this._hasAudioFlagOverrided=!0,this._hasAudio=T,this._mediaInfo.hasAudio=T},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"overridedHasVideo",{set:function(T){this._hasVideoFlagOverrided=!0,this._hasVideo=T,this._mediaInfo.hasVideo=T},enumerable:!1,configurable:!0}),j.prototype.resetMediaInfo=function(){this._mediaInfo=new u.a},j.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched},j.prototype.parseChunks=function(T,E){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new y.a("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var b=0,k=this._littleEndian;if(E===0){if(!(T.byteLength>13))return 0;b=j.probe(T).dataOffset}for(this._firstParse&&(this._firstParse=!1,E+b!==this._dataOffset&&d.a.w(this.TAG,"First time parsing but chunk byteStart invalid!"),($=new DataView(T,b)).getUint32(0,!k)!==0&&d.a.w(this.TAG,"PrevTagSize0 !== 0 !!!"),b+=4);b<T.byteLength;){this._dispatch=!0;var $=new DataView(T,b);if(b+11+4>T.byteLength)break;var G=$.getUint8(0),q=16777215&$.getUint32(0,!k);if(b+11+q+4>T.byteLength)break;if(G===8||G===9||G===18){var te=$.getUint8(4),Z=$.getUint8(5),ae=$.getUint8(6)|Z<<8|te<<16|$.getUint8(7)<<24;(16777215&$.getUint32(7,!k))!==0&&d.a.w(this.TAG,"Meet tag which has StreamID != 0!");var fe=b+11;switch(G){case 8:this._parseAudioData(T,fe,q,ae);break;case 9:this._parseVideoData(T,fe,q,ae,E+b);break;case 18:this._parseScriptData(T,fe,q)}var de=$.getUint32(11+q,!k);de!==11+q&&d.a.w(this.TAG,"Invalid PrevTagSize ".concat(de)),b+=11+q+4}else d.a.w(this.TAG,"Unsupported tag type ".concat(G,", skipped")),b+=11+q+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),b},j.prototype._parseScriptData=function(T,E,b){var k=S.parseScriptData(T,E,b);if(k.hasOwnProperty("onMetaData")){if(k.onMetaData==null||typeof k.onMetaData!="object")return void d.a.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&d.a.w(this.TAG,"Found another onMetaData tag!"),this._metadata=k;var $=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},$)),typeof $.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=$.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof $.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=$.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof $.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=$.audiodatarate),typeof $.videodatarate=="number"&&(this._mediaInfo.videoDataRate=$.videodatarate),typeof $.width=="number"&&(this._mediaInfo.width=$.width),typeof $.height=="number"&&(this._mediaInfo.height=$.height),typeof $.duration=="number"){if(!this._durationOverrided){var G=Math.floor($.duration*this._timescale);this._duration=G,this._mediaInfo.duration=G}}else this._mediaInfo.duration=0;if(typeof $.framerate=="number"){var q=Math.floor(1e3*$.framerate);if(q>0){var te=q/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=te,this._referenceFrameRate.fps_num=q,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=te}}if(typeof $.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var Z=$.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(Z),$.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=$,d.a.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(k).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},k))},j.prototype._parseKeyframesIndex=function(T){for(var E=[],b=[],k=1;k<T.times.length;k++){var $=this._timestampBase+Math.floor(1e3*T.times[k]);E.push($),b.push(T.filepositions[k])}return{times:E,filepositions:b}},j.prototype._parseAudioData=function(T,E,b,k){if(b<=1)d.a.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else if(this._hasAudioFlagOverrided!==!0||this._hasAudio!==!1){this._littleEndian;var $=new DataView(T,E,b).getUint8(0),G=$>>>4;if(G!==9)if(G===2||G===10){var q=0,te=(12&$)>>>2;if(te>=0&&te<=4){q=this._flvSoundRateTable[te];var Z=1&$,ae=this._audioMetadata,fe=this._audioTrack;if(ae||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(ae=this._audioMetadata={}).type="audio",ae.id=fe.id,ae.timescale=this._timescale,ae.duration=this._duration,ae.audioSampleRate=q,ae.channelCount=Z===0?1:2),G===10){var de=this._parseAACAudioData(T,E+1,b-1);if(de==null)return;if(de.packetType===0){if(ae.config){if(B(de.data.config,ae.config))return;d.a.w(this.TAG,"AudioSpecificConfig has been changed, re-generate initialization segment")}var me=de.data;ae.audioSampleRate=me.samplingRate,ae.channelCount=me.channelCount,ae.codec=me.codec,ae.originalCodec=me.originalCodec,ae.config=me.config,ae.refSampleDuration=1024/ae.audioSampleRate*ae.timescale,d.a.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",ae),(ke=this._mediaInfo).audioCodec=ae.originalCodec,ke.audioSampleRate=ae.audioSampleRate,ke.audioChannelCount=ae.channelCount,ke.hasVideo?ke.videoCodec!=null&&(ke.mimeType='video/x-flv; codecs="'+ke.videoCodec+","+ke.audioCodec+'"'):ke.mimeType='video/x-flv; codecs="'+ke.audioCodec+'"',ke.isComplete()&&this._onMediaInfo(ke)}else if(de.packetType===1){var Te=this._timestampBase+k,De={unit:de.data,length:de.data.byteLength,dts:Te,pts:Te};fe.samples.push(De),fe.length+=de.data.length}else d.a.e(this.TAG,"Flv: Unsupported AAC data type ".concat(de.packetType))}else if(G===2){if(!ae.codec){var ke;if((me=this._parseMP3AudioData(T,E+1,b-1,!0))==null)return;ae.audioSampleRate=me.samplingRate,ae.channelCount=me.channelCount,ae.codec=me.codec,ae.originalCodec=me.originalCodec,ae.refSampleDuration=1152/ae.audioSampleRate*ae.timescale,d.a.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",ae),(ke=this._mediaInfo).audioCodec=ae.codec,ke.audioSampleRate=ae.audioSampleRate,ke.audioChannelCount=ae.channelCount,ke.audioDataRate=me.bitRate,ke.hasVideo?ke.videoCodec!=null&&(ke.mimeType='video/x-flv; codecs="'+ke.videoCodec+","+ke.audioCodec+'"'):ke.mimeType='video/x-flv; codecs="'+ke.audioCodec+'"',ke.isComplete()&&this._onMediaInfo(ke)}var Qe=this._parseMP3AudioData(T,E+1,b-1,!1);if(Qe==null)return;Te=this._timestampBase+k;var He={unit:Qe,length:Qe.byteLength,dts:Te,pts:Te};fe.samples.push(He),fe.length+=Qe.length}}else this._onError(R.a.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+te)}else this._onError(R.a.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+G);else{if(b<=5)return void d.a.w(this.TAG,"Flv: Invalid audio packet, missing AudioFourCC in Ehnanced FLV payload!");var $e=15&$,rt=String.fromCharCode.apply(String,new Uint8Array(T,E,b).slice(1,5));switch(rt){case"Opus":this._parseOpusAudioPacket(T,E+5,b-5,k,$e);break;case"fLaC":this._parseFlacAudioPacket(T,E+5,b-5,k,$e);break;default:this._onError(R.a.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec: "+rt)}}}},j.prototype._parseAACAudioData=function(T,E,b){if(!(b<=1)){var k={},$=new Uint8Array(T,E,b);return k.packetType=$[0],$[0]===0?k.data=this._parseAACAudioSpecificConfig(T,E+1,b-1):k.data=$.subarray(1),k}d.a.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")},j.prototype._parseAACAudioSpecificConfig=function(T,E,b){var k,$,G=new Uint8Array(T,E,b),q=null,te=0,Z=null;if(te=k=G[0]>>>3,($=(7&G[0])<<1|G[1]>>>7)<0||$>=this._mpegSamplingRates.length)this._onError(R.a.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var ae=this._mpegSamplingRates[$],fe=(120&G[1])>>>3;if(!(fe<0||fe>=8)){te===5&&(Z=(7&G[1])<<1|G[2]>>>7,(124&G[2])>>>2);var de=self.navigator.userAgent.toLowerCase();return de.indexOf("firefox")!==-1?$>=6?(te=5,q=new Array(4),Z=$-3):(te=2,q=new Array(2),Z=$):de.indexOf("android")!==-1?(te=2,q=new Array(2),Z=$):(te=5,Z=$,q=new Array(4),$>=6?Z=$-3:fe===1&&(te=2,q=new Array(2),Z=$)),q[0]=te<<3,q[0]|=(15&$)>>>1,q[1]=(15&$)<<7,q[1]|=(15&fe)<<3,te===5&&(q[1]|=(15&Z)>>>1,q[2]=(1&Z)<<7,q[2]|=8,q[3]=0),{config:q,samplingRate:ae,channelCount:fe,codec:"mp4a.40."+te,originalCodec:"mp4a.40."+k}}this._onError(R.a.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}},j.prototype._parseMP3AudioData=function(T,E,b,k){if(!(b<4)){this._littleEndian;var $=new Uint8Array(T,E,b),G=null;if(k){if($[0]!==255)return;var q=$[1]>>>3&3,te=(6&$[1])>>1,Z=(240&$[2])>>>4,ae=(12&$[2])>>>2,fe=($[3]>>>6&3)!==3?2:1,de=0,me=0;switch(q){case 0:de=this._mpegAudioV25SampleRateTable[ae];break;case 2:de=this._mpegAudioV20SampleRateTable[ae];break;case 3:de=this._mpegAudioV10SampleRateTable[ae]}switch(te){case 1:Z<this._mpegAudioL3BitRateTable.length&&(me=this._mpegAudioL3BitRateTable[Z]);break;case 2:Z<this._mpegAudioL2BitRateTable.length&&(me=this._mpegAudioL2BitRateTable[Z]);break;case 3:Z<this._mpegAudioL1BitRateTable.length&&(me=this._mpegAudioL1BitRateTable[Z])}G={bitRate:me,samplingRate:de,channelCount:fe,codec:"mp3",originalCodec:"mp3"}}else G=$;return G}d.a.w(this.TAG,"Flv: Invalid MP3 packet, header missing!")},j.prototype._parseOpusAudioPacket=function(T,E,b,k,$){if($===0)this._parseOpusSequenceHeader(T,E,b);else if($===1)this._parseOpusAudioData(T,E,b,k);else if($!==2)return void this._onError(R.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat($))},j.prototype._parseOpusSequenceHeader=function(T,E,b){if(b<=16)d.a.w(this.TAG,"Flv: Invalid OpusSequenceHeader, lack of data!");else{var k=this._audioMetadata,$=this._audioTrack;k||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(k=this._audioMetadata={}).type="audio",k.id=$.id,k.timescale=this._timescale,k.duration=this._duration);var G=new DataView(T,E,b);G.setUint8(8,0);var q=G.getUint8(9);G.setUint16(10,G.getUint16(10,!0),!1);var te=G.getUint32(12,!0);G.setUint32(12,G.getUint32(12,!0),!1);var Z={config:new Uint8Array(T,E+8,b-8),channelCount:q,samplingFrequence:te,codec:"opus",originalCodec:"opus"};if(k.config){if(B(Z.config,k.config))return;d.a.w(this.TAG,"OpusSequenceHeader has been changed, re-generate initialization segment")}k.audioSampleRate=Z.samplingFrequence,k.channelCount=Z.channelCount,k.codec=Z.codec,k.originalCodec=Z.originalCodec,k.config=Z.config,k.refSampleDuration=20,d.a.v(this.TAG,"Parsed OpusSequenceHeader"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",k);var ae=this._mediaInfo;ae.audioCodec=k.originalCodec,ae.audioSampleRate=k.audioSampleRate,ae.audioChannelCount=k.channelCount,ae.hasVideo?ae.videoCodec!=null&&(ae.mimeType='video/x-flv; codecs="'+ae.videoCodec+","+ae.audioCodec+'"'):ae.mimeType='video/x-flv; codecs="'+ae.audioCodec+'"',ae.isComplete()&&this._onMediaInfo(ae)}},j.prototype._parseOpusAudioData=function(T,E,b,k){var $=this._audioTrack,G=new Uint8Array(T,E,b),q=this._timestampBase+k,te={unit:G,length:G.byteLength,dts:q,pts:q};$.samples.push(te),$.length+=G.length},j.prototype._parseFlacAudioPacket=function(T,E,b,k,$){if($===0)this._parseFlacSequenceHeader(T,E,b);else if($===1)this._parseFlacAudioData(T,E,b,k);else if($!==2)return void this._onError(R.a.FORMAT_ERROR,"Flv: Invalid Flac audio packet type ".concat($))},j.prototype._parseFlacSequenceHeader=function(T,E,b){var k=this._audioMetadata,$=this._audioTrack;k||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(k=this._audioMetadata={}).type="audio",k.id=$.id,k.timescale=this._timescale,k.duration=this._duration);var G=new Uint8Array(T,E+4,b-4),q=new N(G),te=q.readBits(16),Z=q.readBits(16),ae=Z===te?Z:null;q.readBits(24),q.readBits(24);var fe=q.readBits(20),de=q.readBits(3)+1,me=q.readBits(5)+1;q.destroy();var Te=new Uint8Array(G.byteLength+4);Te.set(G,4),Te[0]=128,Te[1]=G.byteLength>>>16&255,Te[2]=G.byteLength>>>8&255,Te[3]=G.byteLength>>>0&255;var De={config:Te,channelCount:de,samplingFrequence:fe,sampleSize:me,codec:"flac",originalCodec:"flac"};if(k.config){if(B(De.config,k.config))return;d.a.w(this.TAG,"FlacSequenceHeader has been changed, re-generate initialization segment")}k.audioSampleRate=De.samplingFrequence,k.channelCount=De.channelCount,k.sampleSize=De.sampleSize,k.codec=De.codec,k.originalCodec=De.originalCodec,k.config=De.config,k.refSampleDuration=ae!=null?1e3*ae/De.samplingFrequence:null,d.a.v(this.TAG,"Parsed FlacSequenceHeader"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",k);var ke=this._mediaInfo;ke.audioCodec=k.originalCodec,ke.audioSampleRate=k.audioSampleRate,ke.audioChannelCount=k.channelCount,ke.hasVideo?ke.videoCodec!=null&&(ke.mimeType='video/x-flv; codecs="'+ke.videoCodec+","+ke.audioCodec+'"'):ke.mimeType='video/x-flv; codecs="'+ke.audioCodec+'"',ke.isComplete()&&this._onMediaInfo(ke)},j.prototype._parseFlacAudioData=function(T,E,b,k){var $=this._audioTrack,G=new Uint8Array(T,E,b),q=this._timestampBase+k,te={unit:G,length:G.byteLength,dts:q,pts:q};$.samples.push(te),$.length+=G.length},j.prototype._parseVideoData=function(T,E,b,k,$){if(b<=1)d.a.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else if(this._hasVideoFlagOverrided!==!0||this._hasVideo!==!1){var G=new Uint8Array(T,E,b)[0],q=(112&G)>>>4;if((128&G)!=0){var te=15&G,Z=String.fromCharCode.apply(String,new Uint8Array(T,E,b).slice(1,5));if(Z==="hvc1")this._parseEnhancedHEVCVideoPacket(T,E+5,b-5,k,$,q,te);else{if(Z!=="av01")return void this._onError(R.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: ".concat(Z));this._parseEnhancedAV1VideoPacket(T,E+5,b-5,k,$,q,te)}}else{var ae=15&G;if(ae===7)this._parseAVCVideoPacket(T,E+1,b-1,k,$,q);else{if(ae!==12)return void this._onError(R.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: ".concat(ae));this._parseHEVCVideoPacket(T,E+1,b-1,k,$,q)}}}},j.prototype._parseAVCVideoPacket=function(T,E,b,k,$,G){if(b<4)d.a.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var q=this._littleEndian,te=new DataView(T,E,b),Z=te.getUint8(0),ae=(16777215&te.getUint32(0,!q))<<8>>8;if(Z===0)this._parseAVCDecoderConfigurationRecord(T,E+4,b-4);else if(Z===1)this._parseAVCVideoData(T,E+4,b-4,k,$,G,ae);else if(Z!==2)return void this._onError(R.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(Z))}},j.prototype._parseHEVCVideoPacket=function(T,E,b,k,$,G){if(b<4)d.a.w(this.TAG,"Flv: Invalid HEVC packet, missing HEVCPacketType or/and CompositionTime");else{var q=this._littleEndian,te=new DataView(T,E,b),Z=te.getUint8(0),ae=(16777215&te.getUint32(0,!q))<<8>>8;if(Z===0)this._parseHEVCDecoderConfigurationRecord(T,E+4,b-4);else if(Z===1)this._parseHEVCVideoData(T,E+4,b-4,k,$,G,ae);else if(Z!==2)return void this._onError(R.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(Z))}},j.prototype._parseEnhancedHEVCVideoPacket=function(T,E,b,k,$,G,q){var te=this._littleEndian,Z=new DataView(T,E,b);if(q===0)this._parseHEVCDecoderConfigurationRecord(T,E,b);else if(q===1){var ae=(4294967040&Z.getUint32(0,!te))>>8;this._parseHEVCVideoData(T,E+3,b-3,k,$,G,ae)}else if(q===3)this._parseHEVCVideoData(T,E,b,k,$,G,0);else if(q!==2)return void this._onError(R.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(q))},j.prototype._parseEnhancedAV1VideoPacket=function(T,E,b,k,$,G,q){if(this._littleEndian,q===0)this._parseAV1CodecConfigurationRecord(T,E,b);else if(q===1)this._parseAV1VideoData(T,E,b,k,$,G,0);else{if(q===5)return void this._onError(R.a.FORMAT_ERROR,"Flv: Not Supported MP2T AV1 video packet type ".concat(q));if(q!==2)return void this._onError(R.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(q))}},j.prototype._parseAVCDecoderConfigurationRecord=function(T,E,b){if(b<7)d.a.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var k=this._videoMetadata,$=this._videoTrack,G=this._littleEndian,q=new DataView(T,E,b);if(k){if(k.avcc!==void 0){var te=new Uint8Array(T,E,b);if(B(te,k.avcc))return;d.a.w(this.TAG,"AVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(k=this._videoMetadata={}).type="video",k.id=$.id,k.timescale=this._timescale,k.duration=this._duration;var Z=q.getUint8(0),ae=q.getUint8(1);if(q.getUint8(2),q.getUint8(3),Z===1&&ae!==0)if(this._naluLengthSize=1+(3&q.getUint8(4)),this._naluLengthSize===3||this._naluLengthSize===4){var fe=31&q.getUint8(5);if(fe!==0){fe>1&&d.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = ".concat(fe));for(var de=6,me=0;me<fe;me++){var Te=q.getUint16(de,!G);if(de+=2,Te!==0){var De=new Uint8Array(T,E+de,Te);de+=Te;var ke=A.parseSPS(De);if(me===0){k.codecWidth=ke.codec_size.width,k.codecHeight=ke.codec_size.height,k.presentWidth=ke.present_size.width,k.presentHeight=ke.present_size.height,k.profile=ke.profile_string,k.level=ke.level_string,k.bitDepth=ke.bit_depth,k.chromaFormat=ke.chroma_format,k.sarRatio=ke.sar_ratio,k.frameRate=ke.frame_rate,ke.frame_rate.fixed!==!1&&ke.frame_rate.fps_num!==0&&ke.frame_rate.fps_den!==0||(k.frameRate=this._referenceFrameRate);var Qe=k.frameRate.fps_den,He=k.frameRate.fps_num;k.refSampleDuration=k.timescale*(Qe/He);for(var $e=De.subarray(1,4),rt="avc1.",xt=0;xt<3;xt++){var ze=$e[xt].toString(16);ze.length<2&&(ze="0"+ze),rt+=ze}k.codec=rt;var st=this._mediaInfo;st.width=k.codecWidth,st.height=k.codecHeight,st.fps=k.frameRate.fps,st.profile=k.profile,st.level=k.level,st.refFrames=ke.ref_frames,st.chromaFormat=ke.chroma_format_string,st.sarNum=k.sarRatio.width,st.sarDen=k.sarRatio.height,st.videoCodec=rt,st.hasAudio?st.audioCodec!=null&&(st.mimeType='video/x-flv; codecs="'+st.videoCodec+","+st.audioCodec+'"'):st.mimeType='video/x-flv; codecs="'+st.videoCodec+'"',st.isComplete()&&this._onMediaInfo(st)}}}var mt=q.getUint8(de);if(mt!==0){for(mt>1&&d.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = ".concat(mt)),de++,me=0;me<mt;me++)Te=q.getUint16(de,!G),de+=2,Te!==0&&(de+=Te);k.avcc=new Uint8Array(b),k.avcc.set(new Uint8Array(T,E,b),0),d.a.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",k)}else this._onError(R.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else this._onError(R.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else this._onError(R.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: ".concat(this._naluLengthSize-1));else this._onError(R.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}},j.prototype._parseHEVCDecoderConfigurationRecord=function(T,E,b){if(b<22)d.a.w(this.TAG,"Flv: Invalid HEVCDecoderConfigurationRecord, lack of data!");else{var k=this._videoMetadata,$=this._videoTrack,G=this._littleEndian,q=new DataView(T,E,b);if(k){if(k.hvcc!==void 0){var te=new Uint8Array(T,E,b);if(B(te,k.hvcc))return;d.a.w(this.TAG,"HEVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(k=this._videoMetadata={}).type="video",k.id=$.id,k.timescale=this._timescale,k.duration=this._duration;var Z=q.getUint8(0),ae=31&q.getUint8(1);if(Z!==0&&Z!==1||ae===0)this._onError(R.a.FORMAT_ERROR,"Flv: Invalid HEVCDecoderConfigurationRecord");else if(this._naluLengthSize=1+(3&q.getUint8(21)),this._naluLengthSize===3||this._naluLengthSize===4){for(var fe=q.getUint8(22),de=0,me=23;de<fe;de++){var Te=63&q.getUint8(me+0),De=q.getUint16(me+1,!G);me+=3;for(var ke=0;ke<De;ke++){var Qe=q.getUint16(me+0,!G);if(ke===0)if(Te===33){me+=2;var He=new Uint8Array(T,E+me,Qe),$e=C.parseSPS(He);k.codecWidth=$e.codec_size.width,k.codecHeight=$e.codec_size.height,k.presentWidth=$e.present_size.width,k.presentHeight=$e.present_size.height,k.profile=$e.profile_string,k.level=$e.level_string,k.bitDepth=$e.bit_depth,k.chromaFormat=$e.chroma_format,k.sarRatio=$e.sar_ratio,k.frameRate=$e.frame_rate,$e.frame_rate.fixed!==!1&&$e.frame_rate.fps_num!==0&&$e.frame_rate.fps_den!==0||(k.frameRate=this._referenceFrameRate);var rt=k.frameRate.fps_den,xt=k.frameRate.fps_num;k.refSampleDuration=k.timescale*(rt/xt),k.codec=$e.codec_mimetype;var ze=this._mediaInfo;ze.width=k.codecWidth,ze.height=k.codecHeight,ze.fps=k.frameRate.fps,ze.profile=k.profile,ze.level=k.level,ze.refFrames=$e.ref_frames,ze.chromaFormat=$e.chroma_format_string,ze.sarNum=k.sarRatio.width,ze.sarDen=k.sarRatio.height,ze.videoCodec=$e.codec_mimetype,ze.hasAudio?ze.audioCodec!=null&&(ze.mimeType='video/x-flv; codecs="'+ze.videoCodec+","+ze.audioCodec+'"'):ze.mimeType='video/x-flv; codecs="'+ze.videoCodec+'"',ze.isComplete()&&this._onMediaInfo(ze),me+=Qe}else me+=2+Qe;else me+=2+Qe}}k.hvcc=new Uint8Array(b),k.hvcc.set(new Uint8Array(T,E,b),0),d.a.v(this.TAG,"Parsed HEVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",k)}else this._onError(R.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: ".concat(this._naluLengthSize-1))}},j.prototype._parseAV1CodecConfigurationRecord=function(T,E,b){if(b<4)d.a.w(this.TAG,"Flv: Invalid AV1CodecConfigurationRecord, lack of data!");else{var k=this._videoMetadata,$=this._videoTrack,G=(this._littleEndian,new DataView(T,E,b));k?k.av1c!==void 0&&d.a.w(this.TAG,"Found another AV1CodecConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(k=this._videoMetadata={}).type="video",k.id=$.id,k.timescale=this._timescale,k.duration=this._duration);var q=127&G.getUint8(0);if(G.getUint8(1),G.getUint8(1),G.getUint8(2),q===1){var te=M.parseOBUs(new Uint8Array(T,E+4,b-4));if(te!=null){k.profile=te.profile_string,k.level=te.level_string,k.bitDepth=te.bit_depth,k.chromaFormat=te.chroma_format,k.frameRate=te.frame_rate,te.frame_rate.fixed!==!1&&te.frame_rate.fps_num!==0&&te.frame_rate.fps_den!==0||(k.frameRate=this._referenceFrameRate);var Z=k.frameRate.fps_den,ae=k.frameRate.fps_num;k.refSampleDuration=k.timescale*(Z/ae),k.codec=te.codec_mimetype,k.extra=te;var fe=this._mediaInfo;fe.fps=k.frameRate.fps,fe.profile=k.profile,fe.level=k.level,fe.refFrames=te.ref_frames,fe.chromaFormat=te.chroma_format_string,fe.videoCodec=te.codec_mimetype,fe.hasAudio?fe.audioCodec!=null&&(fe.mimeType='video/x-flv; codecs="'+fe.videoCodec+","+fe.audioCodec+'"'):fe.mimeType='video/x-flv; codecs="'+fe.videoCodec+'"',fe.isComplete()&&this._onMediaInfo(fe),k.av1c=new Uint8Array(b),k.av1c.set(new Uint8Array(T,E,b),0),d.a.v(this.TAG,"Preparing AV1CodecConfigurationRecord")}else this._onError(R.a.FORMAT_ERROR,"Flv: Invalid AV1CodecConfigurationRecord")}else this._onError(R.a.FORMAT_ERROR,"Flv: Invalid AV1CodecConfigurationRecord")}},j.prototype._parseAVCVideoData=function(T,E,b,k,$,G,q){for(var te=this._littleEndian,Z=new DataView(T,E,b),ae=[],fe=0,de=0,me=this._naluLengthSize,Te=this._timestampBase+k,De=G===1;de<b;){if(de+4>=b){d.a.w(this.TAG,"Malformed Nalu near timestamp ".concat(Te,", offset = ").concat(de,", dataSize = ").concat(b));break}var ke=Z.getUint32(de,!te);if(me===3&&(ke>>>=8),ke>b-me)return void d.a.w(this.TAG,"Malformed Nalus near timestamp ".concat(Te,", NaluSize > DataSize!"));var Qe=31&Z.getUint8(de+me);Qe===5&&(De=!0);var He=new Uint8Array(T,E+de,me+ke),$e={type:Qe,data:He};ae.push($e),fe+=He.byteLength,de+=me+ke}if(ae.length){var rt=this._videoTrack,xt={units:ae,length:fe,isKeyframe:De,dts:Te,cts:q,pts:Te+q};De&&(xt.fileposition=$),rt.samples.push(xt),rt.length+=fe}},j.prototype._parseHEVCVideoData=function(T,E,b,k,$,G,q){for(var te=this._littleEndian,Z=new DataView(T,E,b),ae=[],fe=0,de=0,me=this._naluLengthSize,Te=this._timestampBase+k,De=G===1;de<b;){if(de+4>=b){d.a.w(this.TAG,"Malformed Nalu near timestamp ".concat(Te,", offset = ").concat(de,", dataSize = ").concat(b));break}var ke=Z.getUint32(de,!te);if(me===3&&(ke>>>=8),ke>b-me)return void d.a.w(this.TAG,"Malformed Nalus near timestamp ".concat(Te,", NaluSize > DataSize!"));var Qe=Z.getUint8(de+me)>>1&63;Qe!==19&&Qe!==20&&Qe!==21||(De=!0);var He=new Uint8Array(T,E+de,me+ke),$e={type:Qe,data:He};ae.push($e),fe+=He.byteLength,de+=me+ke}if(ae.length){var rt=this._videoTrack,xt={units:ae,length:fe,isKeyframe:De,dts:Te,cts:q,pts:Te+q};De&&(xt.fileposition=$),rt.samples.push(xt),rt.length+=fe}},j.prototype._parseAV1VideoData=function(T,E,b,k,$,G,q){this._littleEndian;var te,Z=[],ae=this._timestampBase+k,fe=G===1;if(fe){var de=this._videoMetadata,me=M.parseOBUs(new Uint8Array(T,E,b),de.extra);if(me==null)return void this._onError(R.a.FORMAT_ERROR,"Flv: Invalid AV1 VideoData");console.log(me),de.codecWidth=me.codec_size.width,de.codecHeight=me.codec_size.height,de.presentWidth=me.present_size.width,de.presentHeight=me.present_size.height,de.sarRatio=me.sar_ratio;var Te=this._mediaInfo;Te.width=de.codecWidth,Te.height=de.codecHeight,Te.sarNum=de.sarRatio.width,Te.sarDen=de.sarRatio.height,d.a.v(this.TAG,"Parsed AV1DecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",de)}if(te=b,Z.push({unitType:0,data:new Uint8Array(T,E+0,b)}),Z.length){var De=this._videoTrack,ke={units:Z,length:te,isKeyframe:fe,dts:ae,cts:q,pts:ae+q};fe&&(ke.fileposition=$),De.samples.push(ke),De.length+=te}},j})(),J=(function(){function j(){}return j.prototype.destroy=function(){this.onError=null,this.onMediaInfo=null,this.onMetaDataArrived=null,this.onTrackMetadata=null,this.onDataAvailable=null,this.onTimedID3Metadata=null,this.onSynchronousKLVMetadata=null,this.onAsynchronousKLVMetadata=null,this.onSMPTE2038Metadata=null,this.onSCTE35Metadata=null,this.onPESPrivateData=null,this.onPESPrivateDataDescriptor=null},j})(),ie=function(){this.program_pmt_pid={}};(function(j){j[j.kMPEG1Audio=3]="kMPEG1Audio",j[j.kMPEG2Audio=4]="kMPEG2Audio",j[j.kPESPrivateData=6]="kPESPrivateData",j[j.kADTSAAC=15]="kADTSAAC",j[j.kLOASAAC=17]="kLOASAAC",j[j.kAC3=129]="kAC3",j[j.kEAC3=135]="kEAC3",j[j.kMetadata=21]="kMetadata",j[j.kSCTE35=134]="kSCTE35",j[j.kH264=27]="kH264",j[j.kH265=36]="kH265"})(L||(L={}));var ne,se=function(){this.pid_stream_type={},this.common_pids={h264:void 0,h265:void 0,av1:void 0,adts_aac:void 0,loas_aac:void 0,opus:void 0,ac3:void 0,eac3:void 0,mp3:void 0},this.pes_private_data_pids={},this.timed_id3_pids={},this.synchronous_klv_pids={},this.asynchronous_klv_pids={},this.scte_35_pids={},this.smpte2038_pids={}},X=function(){},ce=function(){},le=function(){this.slices=[],this.total_length=0,this.expected_length=0,this.file_position=0};(function(j){j[j.kUnspecified=0]="kUnspecified",j[j.kSliceNonIDR=1]="kSliceNonIDR",j[j.kSliceDPA=2]="kSliceDPA",j[j.kSliceDPB=3]="kSliceDPB",j[j.kSliceDPC=4]="kSliceDPC",j[j.kSliceIDR=5]="kSliceIDR",j[j.kSliceSEI=6]="kSliceSEI",j[j.kSliceSPS=7]="kSliceSPS",j[j.kSlicePPS=8]="kSlicePPS",j[j.kSliceAUD=9]="kSliceAUD",j[j.kEndOfSequence=10]="kEndOfSequence",j[j.kEndOfStream=11]="kEndOfStream",j[j.kFiller=12]="kFiller",j[j.kSPSExt=13]="kSPSExt",j[j.kReserved0=14]="kReserved0"})(ne||(ne={}));var Y,K,H=function(){},Q=function(j){var T=j.data.byteLength;this.type=j.type,this.data=new Uint8Array(4+T),new DataView(this.data.buffer).setUint32(0,T),this.data.set(j.data,4)},oe=(function(){function j(T){this.TAG="H264AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=T,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&d.a.e(this.TAG,"Could not find H264 startcode until payload end!")}return j.prototype.findNextStartCodeOffset=function(T){for(var E=T,b=this.data_;;){if(E+3>=b.byteLength)return this.eof_flag_=!0,b.byteLength;var k=b[E+0]<<24|b[E+1]<<16|b[E+2]<<8|b[E+3],$=b[E+0]<<16|b[E+1]<<8|b[E+2];if(k===1||$===1)return E;E++}},j.prototype.readNextNaluPayload=function(){for(var T=this.data_,E=null;E==null&&!this.eof_flag_;){var b=this.current_startcode_offset_,k=31&T[b+=(T[b]<<24|T[b+1]<<16|T[b+2]<<8|T[b+3])===1?4:3],$=(128&T[b])>>>7,G=this.findNextStartCodeOffset(b);if(this.current_startcode_offset_=G,!(k>=ne.kReserved0)&&$===0){var q=T.subarray(b,G);(E=new H).type=k,E.data=q}}return E},j})(),ye=(function(){function j(T,E,b){var k=8+T.byteLength+1+2+E.byteLength,$=!1;T[3]!==66&&T[3]!==77&&T[3]!==88&&($=!0,k+=4);var G=this.data=new Uint8Array(k);G[0]=1,G[1]=T[1],G[2]=T[2],G[3]=T[3],G[4]=255,G[5]=225;var q=T.byteLength;G[6]=q>>>8,G[7]=255&q;var te=8;G.set(T,8),G[te+=q]=1;var Z=E.byteLength;G[te+1]=Z>>>8,G[te+2]=255&Z,G.set(E,te+3),te+=3+Z,$&&(G[te]=252|b.chroma_format_idc,G[te+1]=248|b.bit_depth_luma-8,G[te+2]=248|b.bit_depth_chroma-8,G[te+3]=0,te+=4)}return j.prototype.getData=function(){return this.data},j})();(function(j){j[j.kNull=0]="kNull",j[j.kAACMain=1]="kAACMain",j[j.kAAC_LC=2]="kAAC_LC",j[j.kAAC_SSR=3]="kAAC_SSR",j[j.kAAC_LTP=4]="kAAC_LTP",j[j.kAAC_SBR=5]="kAAC_SBR",j[j.kAAC_Scalable=6]="kAAC_Scalable",j[j.kLayer1=32]="kLayer1",j[j.kLayer2=33]="kLayer2",j[j.kLayer3=34]="kLayer3"})(Y||(Y={})),(function(j){j[j.k96000Hz=0]="k96000Hz",j[j.k88200Hz=1]="k88200Hz",j[j.k64000Hz=2]="k64000Hz",j[j.k48000Hz=3]="k48000Hz",j[j.k44100Hz=4]="k44100Hz",j[j.k32000Hz=5]="k32000Hz",j[j.k24000Hz=6]="k24000Hz",j[j.k22050Hz=7]="k22050Hz",j[j.k16000Hz=8]="k16000Hz",j[j.k12000Hz=9]="k12000Hz",j[j.k11025Hz=10]="k11025Hz",j[j.k8000Hz=11]="k8000Hz",j[j.k7350Hz=12]="k7350Hz"})(K||(K={}));var xe,pe,ee=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],re=(xe=function(j,T){return(xe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,b){E.__proto__=b}||function(E,b){for(var k in b)Object.prototype.hasOwnProperty.call(b,k)&&(E[k]=b[k])})(j,T)},function(j,T){if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");function E(){this.constructor=j}xe(j,T),j.prototype=T===null?Object.create(T):(E.prototype=T.prototype,new E)}),je=function(){},Fe=(function(j){function T(){return j!==null&&j.apply(this,arguments)||this}return re(T,j),T})(je),We=(function(){function j(T){this.TAG="AACADTSParser",this.data_=T,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&d.a.e(this.TAG,"Could not found ADTS syncword until payload end")}return j.prototype.findNextSyncwordOffset=function(T){for(var E=T,b=this.data_;;){if(E+7>=b.byteLength)return this.eof_flag_=!0,b.byteLength;if((b[E+0]<<8|b[E+1])>>>4===4095)return E;E++}},j.prototype.readNextAACFrame=function(){for(var T=this.data_,E=null;E==null&&!this.eof_flag_;){var b=this.current_syncword_offset_,k=(8&T[b+1])>>>3,$=(6&T[b+1])>>>1,G=1&T[b+1],q=(192&T[b+2])>>>6,te=(60&T[b+2])>>>2,Z=(1&T[b+2])<<2|(192&T[b+3])>>>6,ae=(3&T[b+3])<<11|T[b+4]<<3|(224&T[b+5])>>>5;if(T[b+6],b+ae>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var fe=G===1?7:9,de=ae-fe;b+=fe;var me=this.findNextSyncwordOffset(b+de);if(this.current_syncword_offset_=me,(k===0||k===1)&&$===0){var Te=T.subarray(b,b+de);(E=new je).audio_object_type=q+1,E.sampling_freq_index=te,E.sampling_frequency=ee[te],E.channel_config=Z,E.data=Te}}return E},j.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},j.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},j})(),he=(function(){function j(T){this.TAG="AACLOASParser",this.data_=T,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&d.a.e(this.TAG,"Could not found LOAS syncword until payload end")}return j.prototype.findNextSyncwordOffset=function(T){for(var E=T,b=this.data_;;){if(E+1>=b.byteLength)return this.eof_flag_=!0,b.byteLength;if((b[E+0]<<3|b[E+1]>>>5)===695)return E;E++}},j.prototype.getLATMValue=function(T){for(var E=T.readBits(2),b=0,k=0;k<=E;k++)b<<=8,b|=T.readByte();return b},j.prototype.readNextAACFrame=function(T){for(var E=this.data_,b=null;b==null&&!this.eof_flag_;){var k=this.current_syncword_offset_,$=(31&E[k+1])<<8|E[k+2];if(k+3+$>=this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var G=new N(E.subarray(k+3,k+3+$)),q=null;if(G.readBool()){if(T==null){d.a.w(this.TAG,"StreamMuxConfig Missing"),this.current_syncword_offset_=this.findNextSyncwordOffset(k+3+$),G.destroy();continue}q=T}else{var te=G.readBool();if(te&&G.readBool()){d.a.e(this.TAG,"audioMuxVersionA is Not Supported"),G.destroy();break}if(te&&this.getLATMValue(G),!G.readBool()){d.a.e(this.TAG,"allStreamsSameTimeFraming zero is Not Supported"),G.destroy();break}if(G.readBits(6)!==0){d.a.e(this.TAG,"more than 2 numSubFrames Not Supported"),G.destroy();break}if(G.readBits(4)!==0){d.a.e(this.TAG,"more than 2 numProgram Not Supported"),G.destroy();break}if(G.readBits(3)!==0){d.a.e(this.TAG,"more than 2 numLayer Not Supported"),G.destroy();break}var Z=te?this.getLATMValue(G):0,ae=G.readBits(5);Z-=5;var fe=G.readBits(4);Z-=4;var de=G.readBits(4);Z-=4,G.readBits(3),(Z-=3)>0&&G.readBits(Z);var me=G.readBits(3);if(me!==0){d.a.e(this.TAG,"frameLengthType = ".concat(me,". Only frameLengthType = 0 Supported")),G.destroy();break}G.readByte();var Te=G.readBool();if(Te)if(te)this.getLATMValue(G);else{for(var De=0;;){De<<=8;var ke=G.readBool();if(De+=G.readByte(),!ke)break}console.log(De)}G.readBool()&&G.readByte(),(q=new Fe).audio_object_type=ae,q.sampling_freq_index=fe,q.sampling_frequency=ee[q.sampling_freq_index],q.channel_config=de,q.other_data_present=Te}for(var Qe=0;;){var He=G.readByte();if(Qe+=He,He!==255)break}for(var $e=new Uint8Array(Qe),rt=0;rt<Qe;rt++)$e[rt]=G.readByte();(b=new Fe).audio_object_type=q.audio_object_type,b.sampling_freq_index=q.sampling_freq_index,b.sampling_frequency=ee[q.sampling_freq_index],b.channel_config=q.channel_config,b.other_data_present=q.other_data_present,b.data=$e,this.current_syncword_offset_=this.findNextSyncwordOffset(k+3+$)}return b},j.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},j.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},j})(),Ue=function(j){var T=null,E=j.audio_object_type,b=j.audio_object_type,k=j.sampling_freq_index,$=j.channel_config,G=0,q=navigator.userAgent.toLowerCase();q.indexOf("firefox")!==-1?k>=6?(b=5,T=new Array(4),G=k-3):(b=2,T=new Array(2),G=k):q.indexOf("android")!==-1?(b=2,T=new Array(2),G=k):(b=5,G=k,T=new Array(4),k>=6?G=k-3:$===1&&(b=2,T=new Array(2),G=k)),T[0]=b<<3,T[0]|=(15&k)>>>1,T[1]=(15&k)<<7,T[1]|=(15&$)<<3,b===5&&(T[1]|=(15&G)>>>1,T[2]=(1&G)<<7,T[2]|=8,T[3]=0),this.config=T,this.sampling_rate=ee[k],this.channel_count=$,this.codec_mimetype="mp4a.40."+b,this.original_codec_mimetype="mp4a.40."+E},Ge=function(){},vt=function(){};(function(j){j[j.kSpliceNull=0]="kSpliceNull",j[j.kSpliceSchedule=4]="kSpliceSchedule",j[j.kSpliceInsert=5]="kSpliceInsert",j[j.kTimeSignal=6]="kTimeSignal",j[j.kBandwidthReservation=7]="kBandwidthReservation",j[j.kPrivateCommand=255]="kPrivateCommand"})(pe||(pe={}));var Ke,ht=function(j){var T=j.readBool();return T?(j.readBits(6),{time_specified_flag:T,pts_time:4*j.readBits(31)+j.readBits(2)}):(j.readBits(7),{time_specified_flag:T})},Ft=function(j){var T=j.readBool();return j.readBits(6),{auto_return:T,duration:4*j.readBits(31)+j.readBits(2)}},hs=function(j,T){var E=T.readBits(8);return j?{component_tag:E}:{component_tag:E,splice_time:ht(T)}},gs=function(j){return{component_tag:j.readBits(8),utc_splice_time:j.readBits(32)}},Se=function(j){var T=j.readBits(32),E=j.readBool();j.readBits(7);var b={splice_event_id:T,splice_event_cancel_indicator:E};if(E)return b;if(b.out_of_network_indicator=j.readBool(),b.program_splice_flag=j.readBool(),b.duration_flag=j.readBool(),j.readBits(5),b.program_splice_flag)b.utc_splice_time=j.readBits(32);else{b.component_count=j.readBits(8),b.components=[];for(var k=0;k<b.component_count;k++)b.components.push(gs(j))}return b.duration_flag&&(b.break_duration=Ft(j)),b.unique_program_id=j.readBits(16),b.avail_num=j.readBits(8),b.avails_expected=j.readBits(8),b},Ye=function(j,T,E,b){return{descriptor_tag:j,descriptor_length:T,identifier:E,provider_avail_id:b.readBits(32)}},lt=function(j,T,E,b){var k=b.readBits(8),$=b.readBits(3);b.readBits(5);for(var G="",q=0;q<$;q++)G+=String.fromCharCode(b.readBits(8));return{descriptor_tag:j,descriptor_length:T,identifier:E,preroll:k,dtmf_count:$,DTMF_char:G}},_t=function(j){var T=j.readBits(8);return j.readBits(7),{component_tag:T,pts_offset:4*j.readBits(31)+j.readBits(2)}},ln=function(j,T,E,b){var k=b.readBits(32),$=b.readBool();b.readBits(7);var G={descriptor_tag:j,descriptor_length:T,identifier:E,segmentation_event_id:k,segmentation_event_cancel_indicator:$};if($)return G;if(G.program_segmentation_flag=b.readBool(),G.segmentation_duration_flag=b.readBool(),G.delivery_not_restricted_flag=b.readBool(),G.delivery_not_restricted_flag?b.readBits(5):(G.web_delivery_allowed_flag=b.readBool(),G.no_regional_blackout_flag=b.readBool(),G.archive_allowed_flag=b.readBool(),G.device_restrictions=b.readBits(2)),!G.program_segmentation_flag){G.component_count=b.readBits(8),G.components=[];for(var q=0;q<G.component_count;q++)G.components.push(_t(b))}G.segmentation_duration_flag&&(G.segmentation_duration=b.readBits(40)),G.segmentation_upid_type=b.readBits(8),G.segmentation_upid_length=b.readBits(8);var te=new Uint8Array(G.segmentation_upid_length);for(q=0;q<G.segmentation_upid_length;q++)te[q]=b.readBits(8);return G.segmentation_upid=te.buffer,G.segmentation_type_id=b.readBits(8),G.segment_num=b.readBits(8),G.segments_expected=b.readBits(8),G.segmentation_type_id!==52&&G.segmentation_type_id!==54&&G.segmentation_type_id!==56&&G.segmentation_type_id!==58||(G.sub_segment_num=b.readBits(8),G.sub_segments_expected=b.readBits(8)),G},Gs=function(j,T,E,b){return{descriptor_tag:j,descriptor_length:T,identifier:E,TAI_seconds:b.readBits(48),TAI_ns:b.readBits(32),UTC_offset:b.readBits(16)}},Vn=function(j){return{component_tag:j.readBits(8),ISO_code:String.fromCharCode(j.readBits(8),j.readBits(8),j.readBits(8)),Bit_Stream_Mode:j.readBits(3),Num_Channels:j.readBits(4),Full_Srvc_Audio:j.readBool()}},Tn=function(j,T,E,b){for(var k=b.readBits(4),$=[],G=0;G<k;G++)$.push(Vn(b));return{descriptor_tag:j,descriptor_length:T,identifier:E,audio_count:k,components:$}},ri=function(j){var T=new N(j),E=T.readBits(8),b=T.readBool(),k=T.readBool();T.readBits(2);var $=T.readBits(12),G=T.readBits(8),q=T.readBool(),te=T.readBits(6),Z=4*T.readBits(31)+T.readBits(2),ae=T.readBits(8),fe=T.readBits(12),de=T.readBits(12),me=T.readBits(8),Te=null;me===pe.kSpliceNull?Te={}:me===pe.kSpliceSchedule?Te=(function(it){for(var gt=it.readBits(8),$t=[],ut=0;ut<gt;ut++)$t.push(Se(it));return{splice_count:gt,events:$t}})(T):me===pe.kSpliceInsert?Te=(function(it){var gt=it.readBits(32),$t=it.readBool();it.readBits(7);var ut={splice_event_id:gt,splice_event_cancel_indicator:$t};if($t)return ut;if(ut.out_of_network_indicator=it.readBool(),ut.program_splice_flag=it.readBool(),ut.duration_flag=it.readBool(),ut.splice_immediate_flag=it.readBool(),it.readBits(4),ut.program_splice_flag&&!ut.splice_immediate_flag&&(ut.splice_time=ht(it)),!ut.program_splice_flag){ut.component_count=it.readBits(8),ut.components=[];for(var St=0;St<ut.component_count;St++)ut.components.push(hs(ut.splice_immediate_flag,it))}return ut.duration_flag&&(ut.break_duration=Ft(it)),ut.unique_program_id=it.readBits(16),ut.avail_num=it.readBits(8),ut.avails_expected=it.readBits(8),ut})(T):me===pe.kTimeSignal?Te=(function(it){return{splice_time:ht(it)}})(T):me===pe.kBandwidthReservation?Te={}:me===pe.kPrivateCommand?Te=(function(it,gt){for(var $t=String.fromCharCode(gt.readBits(8),gt.readBits(8),gt.readBits(8),gt.readBits(8)),ut=new Uint8Array(it-4),St=0;St<it-4;St++)ut[St]=gt.readBits(8);return{identifier:$t,private_data:ut.buffer}})(de,T):T.readBits(8*de);for(var De=[],ke=T.readBits(16),Qe=0;Qe<ke;){var He=T.readBits(8),$e=T.readBits(8),rt=String.fromCharCode(T.readBits(8),T.readBits(8),T.readBits(8),T.readBits(8));He===0?De.push(Ye(He,$e,rt,T)):He===1?De.push(lt(He,$e,rt,T)):He===2?De.push(ln(He,$e,rt,T)):He===3?De.push(Gs(He,$e,rt,T)):He===4?De.push(Tn(He,$e,rt,T)):T.readBits(8*($e-4)),Qe+=2+$e}var xt={table_id:E,section_syntax_indicator:b,private_indicator:k,section_length:$,protocol_version:G,encrypted_packet:q,encryption_algorithm:te,pts_adjustment:Z,cw_index:ae,tier:fe,splice_command_length:de,splice_command_type:me,splice_command:Te,descriptor_loop_length:ke,splice_descriptors:De,E_CRC32:q?T.readBits(32):void 0,CRC32:T.readBits(32)};if(me===pe.kSpliceInsert){var ze=Te;if(ze.splice_event_cancel_indicator)return{splice_command_type:me,detail:xt,data:j};if(ze.program_splice_flag&&!ze.splice_immediate_flag){var st=ze.duration_flag?ze.break_duration.auto_return:void 0,mt=ze.duration_flag?ze.break_duration.duration/90:void 0;return ze.splice_time.time_specified_flag?{splice_command_type:me,pts:(Z+ze.splice_time.pts_time)%Math.pow(2,33),auto_return:st,duraiton:mt,detail:xt,data:j}:{splice_command_type:me,auto_return:st,duraiton:mt,detail:xt,data:j}}return{splice_command_type:me,auto_return:st=ze.duration_flag?ze.break_duration.auto_return:void 0,duraiton:mt=ze.duration_flag?ze.break_duration.duration/90:void 0,detail:xt,data:j}}if(me===pe.kTimeSignal){var at=Te;return at.splice_time.time_specified_flag?{splice_command_type:me,pts:(Z+at.splice_time.pts_time)%Math.pow(2,33),detail:xt,data:j}:{splice_command_type:me,detail:xt,data:j}}return{splice_command_type:me,detail:xt,data:j}};(function(j){j[j.kSliceIDR_W_RADL=19]="kSliceIDR_W_RADL",j[j.kSliceIDR_N_LP=20]="kSliceIDR_N_LP",j[j.kSliceCRA_NUT=21]="kSliceCRA_NUT",j[j.kSliceVPS=32]="kSliceVPS",j[j.kSliceSPS=33]="kSliceSPS",j[j.kSlicePPS=34]="kSlicePPS",j[j.kSliceAUD=35]="kSliceAUD"})(Ke||(Ke={}));var oi=function(){},cn=function(j){var T=j.data.byteLength;this.type=j.type,this.data=new Uint8Array(4+T),new DataView(this.data.buffer).setUint32(0,T),this.data.set(j.data,4)},Pr=(function(){function j(T){this.TAG="H265AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=T,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&d.a.e(this.TAG,"Could not find H265 startcode until payload end!")}return j.prototype.findNextStartCodeOffset=function(T){for(var E=T,b=this.data_;;){if(E+3>=b.byteLength)return this.eof_flag_=!0,b.byteLength;var k=b[E+0]<<24|b[E+1]<<16|b[E+2]<<8|b[E+3],$=b[E+0]<<16|b[E+1]<<8|b[E+2];if(k===1||$===1)return E;E++}},j.prototype.readNextNaluPayload=function(){for(var T=this.data_,E=null;E==null&&!this.eof_flag_;){var b=this.current_startcode_offset_,k=T[b+=(T[b]<<24|T[b+1]<<16|T[b+2]<<8|T[b+3])===1?4:3]>>1&63,$=(128&T[b])>>>7,G=this.findNextStartCodeOffset(b);if(this.current_startcode_offset_=G,$===0){var q=T.subarray(b,G);(E=new oi).type=k,E.data=q}}return E},j})(),we=(function(){function j(T,E,b,k){var $=23+(5+T.byteLength)+(5+E.byteLength)+(5+b.byteLength),G=this.data=new Uint8Array($);G[0]=1,G[1]=(3&k.general_profile_space)<<6|(k.general_tier_flag?1:0)<<5|31&k.general_profile_idc,G[2]=k.general_profile_compatibility_flags_1,G[3]=k.general_profile_compatibility_flags_2,G[4]=k.general_profile_compatibility_flags_3,G[5]=k.general_profile_compatibility_flags_4,G[6]=k.general_constraint_indicator_flags_1,G[7]=k.general_constraint_indicator_flags_2,G[8]=k.general_constraint_indicator_flags_3,G[9]=k.general_constraint_indicator_flags_4,G[10]=k.general_constraint_indicator_flags_5,G[11]=k.general_constraint_indicator_flags_6,G[12]=k.general_level_idc,G[13]=240|(3840&k.min_spatial_segmentation_idc)>>8,G[14]=255&k.min_spatial_segmentation_idc,G[15]=252|3&k.parallelismType,G[16]=252|3&k.chroma_format_idc,G[17]=248|7&k.bit_depth_luma_minus8,G[18]=248|7&k.bit_depth_chroma_minus8,G[19]=0,G[20]=0,G[21]=(3&k.constant_frame_rate)<<6|(7&k.num_temporal_layers)<<3|(k.temporal_id_nested?1:0)<<2|3,G[22]=3,G[23]=128|Ke.kSliceVPS,G[24]=0,G[25]=1,G[26]=(65280&T.byteLength)>>8,G[27]=(255&T.byteLength)>>0,G.set(T,28),G[23+(5+T.byteLength)+0]=128|Ke.kSliceSPS,G[23+(5+T.byteLength)+1]=0,G[23+(5+T.byteLength)+2]=1,G[23+(5+T.byteLength)+3]=(65280&E.byteLength)>>8,G[23+(5+T.byteLength)+4]=(255&E.byteLength)>>0,G.set(E,23+(5+T.byteLength)+5),G[23+(5+T.byteLength+5+E.byteLength)+0]=128|Ke.kSlicePPS,G[23+(5+T.byteLength+5+E.byteLength)+1]=0,G[23+(5+T.byteLength+5+E.byteLength)+2]=1,G[23+(5+T.byteLength+5+E.byteLength)+3]=(65280&b.byteLength)>>8,G[23+(5+T.byteLength+5+E.byteLength)+4]=(255&b.byteLength)>>0,G.set(b,23+(5+T.byteLength+5+E.byteLength)+5)}return j.prototype.getData=function(){return this.data},j})(),dt=function(){},It=function(){},bs=function(){},Zu=[[64,64,80,80,96,96,112,112,128,128,160,160,192,192,224,224,256,256,320,320,384,384,448,448,512,512,640,640,768,768,896,896,1024,1024,1152,1152,1280,1280],[69,70,87,88,104,105,121,122,139,140,174,175,208,209,243,244,278,279,348,349,417,418,487,488,557,558,696,697,835,836,975,976,1114,1115,1253,1254,1393,1394],[96,96,120,120,144,144,168,168,192,192,240,240,288,288,336,336,384,384,480,480,576,576,672,672,768,768,960,960,1152,1152,1344,1344,1536,1536,1728,1728,1920,1920]],eh=(function(){function j(T){this.TAG="AC3Parser",this.data_=T,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&d.a.e(this.TAG,"Could not found AC3 syncword until payload end")}return j.prototype.findNextSyncwordOffset=function(T){for(var E=T,b=this.data_;;){if(E+7>=b.byteLength)return this.eof_flag_=!0,b.byteLength;if((b[E+0]<<8|b[E+1]<<0)===2935)return E;E++}},j.prototype.readNextAC3Frame=function(){for(var T=this.data_,E=null;E==null&&!this.eof_flag_;){var b=this.current_syncword_offset_,k=T[b+4]>>6,$=[48e3,44200,33e3][k],G=63&T[b+4],q=2*Zu[k][G];if(isNaN(q)||b+q>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var te=this.findNextSyncwordOffset(b+q);this.current_syncword_offset_=te;var Z=T[b+5]>>3,ae=7&T[b+5],fe=T[b+6]>>5,de=0;(1&fe)!=0&&fe!==1&&(de+=2),(4&fe)!=0&&(de+=2),fe===2&&(de+=2);var me=(T[b+6]<<8|T[b+7]<<0)>>12-de&1,Te=[2,1,2,3,3,4,4,5][fe]+me;(E=new bs).sampling_frequency=$,E.channel_count=Te,E.channel_mode=fe,E.bit_stream_identification=Z,E.low_frequency_effects_channel_on=me,E.bit_stream_mode=ae,E.frame_size_code=G,E.data=T.subarray(b,b+q)}return E},j.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},j.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},j})(),th=function(j){var T;T=[j.sampling_rate_code<<6|j.bit_stream_identification<<1|j.bit_stream_mode>>2,(3&j.bit_stream_mode)<<6|j.channel_mode<<3|j.low_frequency_effects_channel_on<<2|j.frame_size_code>>4,j.frame_size_code<<4&224],this.config=T,this.sampling_rate=j.sampling_frequency,this.bit_stream_identification=j.bit_stream_identification,this.bit_stream_mode=j.bit_stream_mode,this.low_frequency_effects_channel_on=j.low_frequency_effects_channel_on,this.channel_count=j.channel_count,this.channel_mode=j.channel_mode,this.codec_mimetype="ac-3",this.original_codec_mimetype="ac-3"},Br=function(){},Ur=(function(){function j(T){this.TAG="EAC3Parser",this.data_=T,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&d.a.e(this.TAG,"Could not found AC3 syncword until payload end")}return j.prototype.findNextSyncwordOffset=function(T){for(var E=T,b=this.data_;;){if(E+7>=b.byteLength)return this.eof_flag_=!0,b.byteLength;if((b[E+0]<<8|b[E+1]<<0)===2935)return E;E++}},j.prototype.readNextEAC3Frame=function(){for(var T=this.data_,E=null;E==null&&!this.eof_flag_;){var b=this.current_syncword_offset_,k=new N(T.subarray(b+2)),$=(k.readBits(2),k.readBits(3),k.readBits(11)+1<<1),G=k.readBits(2),q=null,te=null;G===3?(q=[24e3,22060,16e3][G=k.readBits(2)],te=3):(q=[48e3,44100,32e3][G],te=k.readBits(2));var Z=k.readBits(3),ae=k.readBits(1),fe=k.readBits(5);if(b+$>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var de=this.findNextSyncwordOffset(b+$);this.current_syncword_offset_=de;var me=[2,1,2,3,3,4,4,5][Z]+ae;k.destroy(),(E=new Br).sampling_frequency=q,E.channel_count=me,E.channel_mode=Z,E.bit_stream_identification=fe,E.low_frequency_effects_channel_on=ae,E.frame_size=$,E.num_blks=[1,2,3,6][te],E.data=T.subarray(b,b+$)}return E},j.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},j.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},j})(),Fr=function(j){var T,E=Math.floor(j.frame_size*j.sampling_frequency/(16*j.num_blks));T=[255&E,248&E,j.sampling_rate_code<<6|j.bit_stream_identification<<1|0,0|j.channel_mode<<1|j.low_frequency_effects_channel_on<<0,0],this.config=T,this.sampling_rate=j.sampling_frequency,this.bit_stream_identification=j.bit_stream_identification,this.num_blks=j.num_blks,this.low_frequency_effects_channel_on=j.low_frequency_effects_channel_on,this.channel_count=j.channel_count,this.channel_mode=j.channel_mode,this.codec_mimetype="ec-3",this.original_codec_mimetype="ec-3"},Ii=function(){},$r=(function(){function j(T){this.TAG="AV1OBUInMpegTsParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=T,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&d.a.e(this.TAG,"Could not find AV1 startcode until payload end!")}return j._ebsp2rbsp=function(T){for(var E=T,b=E.byteLength,k=new Uint8Array(b),$=0,G=0;G<b;G++)G>=2&&E[G]===3&&E[G-1]===0&&E[G-2]===0||(k[$]=E[G],$++);return new Uint8Array(k.buffer,0,$)},j.prototype.findNextStartCodeOffset=function(T){for(var E=T,b=this.data_;;){if(E+2>=b.byteLength)return this.eof_flag_=!0,b.byteLength;if((b[E+0]<<16|b[E+1]<<8|b[E+2])===1)return E;E++}},j.prototype.readNextOBUPayload=function(){for(var T=this.data_,E=null;E==null&&!this.eof_flag_;){var b=this.current_startcode_offset_+3,k=this.findNextStartCodeOffset(b);this.current_startcode_offset_=k,E=j._ebsp2rbsp(T.subarray(b,k))}return E},j})(),Ya=(function(){var j=function(T,E){return(j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,k){b.__proto__=k}||function(b,k){for(var $ in k)Object.prototype.hasOwnProperty.call(k,$)&&(b[$]=k[$])})(T,E)};return function(T,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");function b(){this.constructor=T}j(T,E),T.prototype=E===null?Object.create(E):(b.prototype=E.prototype,new b)}})(),Mi=function(){return(Mi=Object.assign||function(j){for(var T,E=1,b=arguments.length;E<b;E++)for(var k in T=arguments[E])Object.prototype.hasOwnProperty.call(T,k)&&(j[k]=T[k]);return j}).apply(this,arguments)},Zo=(function(j){function T(E,b){var k=j.call(this)||this;return k.TAG="TSDemuxer",k.first_parse_=!0,k.media_info_=new u.a,k.timescale_=90,k.duration_=0,k.current_pmt_pid_=-1,k.program_pmt_map_={},k.pes_slice_queues_={},k.section_slice_queues_={},k.video_metadata_={vps:void 0,sps:void 0,pps:void 0,av1c:void 0,details:void 0},k.audio_metadata_={codec:void 0,audio_object_type:void 0,sampling_freq_index:void 0,sampling_frequency:void 0,channel_config:void 0},k.last_pcr_base_=NaN,k.timestamp_offset_=0,k.audio_last_sample_pts_=void 0,k.aac_last_incomplete_data_=null,k.has_video_=!1,k.has_audio_=!1,k.video_init_segment_dispatched_=!1,k.audio_init_segment_dispatched_=!1,k.video_metadata_changed_=!1,k.audio_metadata_changed_=!1,k.loas_previous_frame=null,k.video_track_={type:"video",id:1,sequenceNumber:0,samples:[],length:0},k.audio_track_={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},k.ts_packet_size_=E.ts_packet_size,k.sync_offset_=E.sync_offset,k.config_=b,k}return Ya(T,j),T.prototype.destroy=function(){this.media_info_=null,this.pes_slice_queues_=null,this.section_slice_queues_=null,this.video_metadata_=null,this.audio_metadata_=null,this.aac_last_incomplete_data_=null,this.video_track_=null,this.audio_track_=null,j.prototype.destroy.call(this)},T.probe=function(E){var b=new Uint8Array(E),k=-1,$=188;if(b.byteLength<=3*$)return{needMoreData:!0};for(;k===-1;){for(var G=Math.min(1e3,b.byteLength-3*$),q=0;q<G;){if(b[q]===71&&b[q+$]===71&&b[q+2*$]===71){k=q;break}q++}if(k===-1)if($===188)$=192;else{if($!==192)break;$=204}}return k===-1?{match:!1}:($===192&&k>=4?(d.a.v("TSDemuxer","ts_packet_size = 192, m2ts mode"),k-=4):$===204&&d.a.v("TSDemuxer","ts_packet_size = 204, RS encoded MPEG2-TS stream"),{match:!0,consumed:0,ts_packet_size:$,sync_offset:k})},T.prototype.bindDataSource=function(E){return E.onDataArrival=this.parseChunks.bind(this),this},T.prototype.resetMediaInfo=function(){this.media_info_=new u.a},T.prototype.parseChunks=function(E,b){if(!(this.onError&&this.onMediaInfo&&this.onTrackMetadata&&this.onDataAvailable))throw new y.a("onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var k=0;for(this.first_parse_&&(this.first_parse_=!1,k=this.sync_offset_);k+this.ts_packet_size_<=E.byteLength;){var $=b+k;this.ts_packet_size_===192&&(k+=4);var G=new Uint8Array(E,k,188),q=G[0];if(q!==71){d.a.e(this.TAG,"sync_byte = ".concat(q,", not 0x47"));break}var te=(64&G[1])>>>6,Z=(G[1],(31&G[1])<<8|G[2]),ae=(48&G[3])>>>4,fe=15&G[3],de=!(!this.pmt_||this.pmt_.pcr_pid!==Z),me={},Te=4;if(ae==2||ae==3){var De=G[4];if(De>0&&(de||ae==3)&&(me.discontinuity_indicator=(128&G[5])>>>7,me.random_access_indicator=(64&G[5])>>>6,me.elementary_stream_priority_indicator=(32&G[5])>>>5,(16&G[5])>>>4)){var ke=300*this.getPcrBase(G)+((1&G[10])<<8|G[11]);this.last_pcr_=ke}if(ae==2||5+De===188){k+=188,this.ts_packet_size_===204&&(k+=16);continue}Te=5+De}if(ae==1||ae==3){if(Z===0||Z===this.current_pmt_pid_||this.pmt_!=null&&this.pmt_.pid_stream_type[Z]===L.kSCTE35){var Qe=188-Te;this.handleSectionSlice(E,k+Te,Qe,{pid:Z,file_position:$,payload_unit_start_indicator:te,continuity_conunter:fe,random_access_indicator:me.random_access_indicator})}else if(this.pmt_!=null&&this.pmt_.pid_stream_type[Z]!=null){Qe=188-Te;var He=this.pmt_.pid_stream_type[Z];Z!==this.pmt_.common_pids.h264&&Z!==this.pmt_.common_pids.h265&&Z!==this.pmt_.common_pids.av1&&Z!==this.pmt_.common_pids.adts_aac&&Z!==this.pmt_.common_pids.loas_aac&&Z!==this.pmt_.common_pids.ac3&&Z!==this.pmt_.common_pids.eac3&&Z!==this.pmt_.common_pids.opus&&Z!==this.pmt_.common_pids.mp3&&this.pmt_.pes_private_data_pids[Z]!==!0&&this.pmt_.timed_id3_pids[Z]!==!0&&this.pmt_.synchronous_klv_pids[Z]!==!0&&this.pmt_.asynchronous_klv_pids[Z]!==!0||this.handlePESSlice(E,k+Te,Qe,{pid:Z,stream_type:He,file_position:$,payload_unit_start_indicator:te,continuity_conunter:fe,random_access_indicator:me.random_access_indicator})}}k+=188,this.ts_packet_size_===204&&(k+=16)}return this.dispatchAudioVideoMediaSegment(),k},T.prototype.handleSectionSlice=function(E,b,k,$){var G=new Uint8Array(E,b,k),q=this.section_slice_queues_[$.pid];if($.payload_unit_start_indicator){var te=G[0];if(q!=null&&q.total_length!==0){var Z=new Uint8Array(E,b+1,Math.min(k,te));q.slices.push(Z),q.total_length+=Z.byteLength,q.total_length===q.expected_length?this.emitSectionSlices(q,$):this.clearSlices(q,$)}for(var ae=1+te;ae<G.byteLength&&G[ae+0]!==255;){var fe=(15&G[ae+1])<<8|G[ae+2];this.section_slice_queues_[$.pid]=new le,(q=this.section_slice_queues_[$.pid]).expected_length=fe+3,q.file_position=$.file_position,q.random_access_indicator=$.random_access_indicator,Z=new Uint8Array(E,b+ae,Math.min(k-ae,q.expected_length-q.total_length)),q.slices.push(Z),q.total_length+=Z.byteLength,q.total_length===q.expected_length?this.emitSectionSlices(q,$):q.total_length>=q.expected_length&&this.clearSlices(q,$),ae+=Z.byteLength}}else q!=null&&q.total_length!==0&&(Z=new Uint8Array(E,b,Math.min(k,q.expected_length-q.total_length)),q.slices.push(Z),q.total_length+=Z.byteLength,q.total_length===q.expected_length?this.emitSectionSlices(q,$):q.total_length>=q.expected_length&&this.clearSlices(q,$))},T.prototype.handlePESSlice=function(E,b,k,$){var G=new Uint8Array(E,b,k),q=G[0]<<16|G[1]<<8|G[2],te=(G[3],G[4]<<8|G[5]);if($.payload_unit_start_indicator){if(q!==1)return void d.a.e(this.TAG,"handlePESSlice: packet_start_code_prefix should be 1 but with value ".concat(q));var Z=this.pes_slice_queues_[$.pid];Z&&(Z.expected_length===0||Z.expected_length===Z.total_length?this.emitPESSlices(Z,$):this.clearSlices(Z,$)),this.pes_slice_queues_[$.pid]=new le,this.pes_slice_queues_[$.pid].file_position=$.file_position,this.pes_slice_queues_[$.pid].random_access_indicator=$.random_access_indicator}if(this.pes_slice_queues_[$.pid]!=null){var ae=this.pes_slice_queues_[$.pid];ae.slices.push(G),$.payload_unit_start_indicator&&(ae.expected_length=te===0?0:te+6),ae.total_length+=G.byteLength,ae.expected_length>0&&ae.expected_length===ae.total_length?this.emitPESSlices(ae,$):ae.expected_length>0&&ae.expected_length<ae.total_length&&this.clearSlices(ae,$)}},T.prototype.emitSectionSlices=function(E,b){for(var k=new Uint8Array(E.total_length),$=0,G=0;$<E.slices.length;$++){var q=E.slices[$];k.set(q,G),G+=q.byteLength}E.slices=[],E.expected_length=-1,E.total_length=0;var te=new ce;te.pid=b.pid,te.data=k,te.file_position=E.file_position,te.random_access_indicator=E.random_access_indicator,this.parseSection(te)},T.prototype.emitPESSlices=function(E,b){for(var k=new Uint8Array(E.total_length),$=0,G=0;$<E.slices.length;$++){var q=E.slices[$];k.set(q,G),G+=q.byteLength}E.slices=[],E.expected_length=-1,E.total_length=0;var te=new X;te.pid=b.pid,te.data=k,te.stream_type=b.stream_type,te.file_position=E.file_position,te.random_access_indicator=E.random_access_indicator,this.parsePES(te)},T.prototype.clearSlices=function(E,b){E.slices=[],E.expected_length=-1,E.total_length=0},T.prototype.parseSection=function(E){var b=E.data,k=E.pid;k===0?this.parsePAT(b):k===this.current_pmt_pid_?this.parsePMT(b):this.pmt_!=null&&this.pmt_.scte_35_pids[k]&&this.parseSCTE35(b)},T.prototype.parsePES=function(E){var b=E.data,k=b[0]<<16|b[1]<<8|b[2],$=b[3],G=b[4]<<8|b[5];if(k===1)if($!==188&&$!==190&&$!==191&&$!==240&&$!==241&&$!==255&&$!==242&&$!==248){b[6];var q=(192&b[7])>>>6,te=b[8],Z=void 0,ae=void 0;q!==2&&q!==3||(Z=this.getTimestamp(b,9),ae=q===3?this.getTimestamp(b,14):Z);var fe=9+te,de=void 0;if(G!==0){if(G<3+te)return void d.a.v(this.TAG,"Malformed PES: PES_packet_length < 3 + PES_header_data_length");de=G-3-te}else de=b.byteLength-fe;var me=b.subarray(fe,fe+de);switch(E.stream_type){case L.kMPEG1Audio:case L.kMPEG2Audio:this.parseMP3Payload(me,Z);break;case L.kPESPrivateData:this.pmt_.common_pids.av1===E.pid?this.parseAV1Payload(me,Z,ae,E.file_position,E.random_access_indicator):this.pmt_.common_pids.opus===E.pid?this.parseOpusPayload(me,Z):this.pmt_.common_pids.ac3===E.pid?this.parseAC3Payload(me,Z):this.pmt_.common_pids.eac3===E.pid?this.parseEAC3Payload(me,Z):this.pmt_.asynchronous_klv_pids[E.pid]?this.parseAsynchronousKLVMetadataPayload(me,E.pid,$):this.pmt_.smpte2038_pids[E.pid]?this.parseSMPTE2038MetadataPayload(me,Z,ae,E.pid,$):this.parsePESPrivateDataPayload(me,Z,ae,E.pid,$);break;case L.kADTSAAC:this.parseADTSAACPayload(me,Z);break;case L.kLOASAAC:this.parseLOASAACPayload(me,Z);break;case L.kAC3:this.parseAC3Payload(me,Z);break;case L.kEAC3:this.parseEAC3Payload(me,Z);break;case L.kMetadata:this.pmt_.timed_id3_pids[E.pid]?this.parseTimedID3MetadataPayload(me,Z,ae,E.pid,$):this.pmt_.synchronous_klv_pids[E.pid]&&this.parseSynchronousKLVMetadataPayload(me,Z,ae,E.pid,$);break;case L.kH264:this.parseH264Payload(me,Z,ae,E.file_position,E.random_access_indicator);break;case L.kH265:this.parseH265Payload(me,Z,ae,E.file_position,E.random_access_indicator)}}else($===188||$===191||$===240||$===241||$===255||$===242||$===248)&&E.stream_type===L.kPESPrivateData&&(fe=6,de=void 0,de=G!==0?G:b.byteLength-fe,me=b.subarray(fe,fe+de),this.parsePESPrivateDataPayload(me,void 0,void 0,E.pid,$));else d.a.e(this.TAG,"parsePES: packet_start_code_prefix should be 1 but with value ".concat(k))},T.prototype.parsePAT=function(E){var b=E[0];if(b===0){var k=(15&E[1])<<8|E[2],$=(E[3],E[4],(62&E[5])>>>1),G=1&E[5],q=E[6],te=(E[7],null);if(G===1&&q===0)(te=new ie).version_number=$;else if((te=this.pat_)==null)return;for(var Z=k-5-4,ae=-1,fe=-1,de=8;de<8+Z;de+=4){var me=E[de]<<8|E[de+1],Te=(31&E[de+2])<<8|E[de+3];me===0?te.network_pid=Te:(te.program_pmt_pid[me]=Te,ae===-1&&(ae=me),fe===-1&&(fe=Te))}G===1&&q===0&&(this.pat_==null&&d.a.v(this.TAG,"Parsed first PAT: ".concat(JSON.stringify(te))),this.pat_=te,this.current_program_=ae,this.current_pmt_pid_=fe)}else d.a.e(this.TAG,"parsePAT: table_id ".concat(b," is not corresponded to PAT!"))},T.prototype.parsePMT=function(E){var b=E[0];if(b===2){var k=(15&E[1])<<8|E[2],$=E[3]<<8|E[4],G=(62&E[5])>>>1,q=1&E[5],te=E[6],Z=(E[7],null);if(q===1&&te===0)(Z=new se).program_number=$,Z.version_number=G,this.program_pmt_map_[$]=Z;else if((Z=this.program_pmt_map_[$])==null)return;Z.pcr_pid=(31&E[8])<<8|E[9];for(var ae=(15&E[10])<<8|E[11],fe=12+ae,de=k-9-ae-4,me=fe;me<fe+de;){var Te=E[me],De=(31&E[me+1])<<8|E[me+2],ke=(15&E[me+3])<<8|E[me+4];Z.pid_stream_type[De]=Te;var Qe=Z.common_pids.h264||Z.common_pids.h265,He=Z.common_pids.adts_aac||Z.common_pids.loas_aac||Z.common_pids.ac3||Z.common_pids.eac3||Z.common_pids.opus||Z.common_pids.mp3;if(Te!==L.kH264||Qe)if(Te!==L.kH265||Qe)if(Te!==L.kADTSAAC||He)if(Te!==L.kLOASAAC||He)if(Te!==L.kAC3||He)if(Te!==L.kEAC3||He)if(Te!==L.kMPEG1Audio&&Te!==L.kMPEG2Audio||He)if(Te===L.kPESPrivateData){if(Z.pes_private_data_pids[De]=!0,ke>0){for(var $e=me+5;$e<me+5+ke;){var rt=E[$e+0],xt=E[$e+1];if(rt===5){var ze=String.fromCharCode.apply(String,Array.from(E.subarray($e+2,$e+2+xt)));ze==="VANC"?Z.smpte2038_pids[De]=!0:ze==="AV01"?Z.common_pids.av1=De:ze==="Opus"?Z.common_pids.opus=De:ze==="KLVA"&&(Z.asynchronous_klv_pids[De]=!0)}else if(rt===127){if(De===Z.common_pids.opus){var st=null;if(E[$e+2]===128&&(st=E[$e+3]),st==null){d.a.e(this.TAG,"Not Supported Opus channel count.");continue}var mt={codec:"opus",channel_count:(15&st)==0?2:15&st,channel_config_code:st,sample_rate:48e3},at={codec:"opus",meta:mt};this.audio_init_segment_dispatched_==0?(this.audio_metadata_=mt,this.dispatchAudioInitSegment(at)):this.detectAudioMetadataChange(at)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(at))}}else rt===128&&De===Z.common_pids.av1&&(this.video_metadata_.av1c=E.subarray($e+2,$e+2+xt));$e+=2+xt}var it=E.subarray(me+5,me+5+ke);this.dispatchPESPrivateDataDescriptor(De,Te,it)}}else if(Te===L.kMetadata){if(ke>0)for($e=me+5;$e<me+5+ke;){rt=E[$e+0];var gt=E[$e+1];if(rt===38){var $t=E[$e+2]<<8|E[$e+3]<<0,ut=null;$t===65535&&(ut=String.fromCharCode.apply(String,Array.from(E.subarray($e+4,$e+4+4))));var St=null;if(E[$e+4+($t===65535?4:0)]===255){var Ht=4+($t===65535?4:0)+1;St=String.fromCharCode.apply(String,Array.from(E.subarray($e+Ht,$e+Ht+4)))}ut==="ID3 "&&St==="ID3 "?Z.timed_id3_pids[De]=!0:St==="KLVA"&&(Z.synchronous_klv_pids[De]=!0)}$e+=2+gt}}else Te===L.kSCTE35&&(Z.scte_35_pids[De]=!0);else Z.common_pids.mp3=De;else Z.common_pids.eac3=De;else Z.common_pids.ac3=De;else Z.common_pids.loas_aac=De;else Z.common_pids.adts_aac=De;else Z.common_pids.h265=De;else Z.common_pids.h264=De;me+=5+ke}$===this.current_program_&&(this.pmt_==null&&d.a.v(this.TAG,"Parsed first PMT: ".concat(JSON.stringify(Z))),this.pmt_=Z,(Z.common_pids.h264||Z.common_pids.h265||Z.common_pids.av1)&&(this.has_video_=!0),(Z.common_pids.adts_aac||Z.common_pids.loas_aac||Z.common_pids.ac3||Z.common_pids.opus||Z.common_pids.mp3)&&(this.has_audio_=!0))}else d.a.e(this.TAG,"parsePMT: table_id ".concat(b," is not corresponded to PMT!"))},T.prototype.parseSCTE35=function(E){var b=ri(E);if(b.pts!=null){var k=Math.floor(b.pts/this.timescale_);b.pts=k}else b.nearest_pts=this.getNearestTimestampMilliseconds();this.onSCTE35Metadata&&this.onSCTE35Metadata(b)},T.prototype.parseAV1Payload=function(E,b,k,$,G){for(var q=new $r(E),te=null,Z=[],ae=0,fe=!1,de=null;(te=q.readNextOBUPayload())!=null;){if((de=M.parseOBUs(te,this.video_metadata_.details))&&de.keyframe===!0)if(this.video_init_segment_dispatched_){if(this.detectVideoMetadataChange(null,de)===!0){var me;this.video_metadata_changed_=!0,this.dispatchVideoMediaSegment(),(me=new Uint8Array(new ArrayBuffer(this.video_metadata_.av1c.byteLength+de.sequence_header_data.byteLength))).set(this.video_metadata_.av1c,0),me.set(de.sequence_header_data,this.video_metadata_.av1c.byteLength),de.av1c=me,this.dispatchVideoInitSegment()}}else(me=new Uint8Array(new ArrayBuffer(this.video_metadata_.av1c.byteLength+de.sequence_header_data.byteLength))).set(this.video_metadata_.av1c,0),me.set(de.sequence_header_data,this.video_metadata_.av1c.byteLength),de.av1c=me,this.video_metadata_.details=de,this.dispatchVideoInitSegment();this.video_metadata_.details=de,fe||(fe=de.keyframe),Z.push({data:te}),ae+=te.byteLength}var Te=Math.floor(b/this.timescale_),De=Math.floor(k/this.timescale_);if(Z.length){var ke=this.video_track_,Qe={units:Z,length:ae,isKeyframe:fe,dts:De,pts:Te,cts:Te-De,file_position:$};ke.samples.push(Qe),ke.length+=ae}},T.prototype.parseH264Payload=function(E,b,k,$,G){for(var q=new oe(E),te=null,Z=[],ae=0,fe=!1;(te=q.readNextNaluPayload())!=null;){var de=new Q(te);if(de.type===ne.kSliceSPS){var me=A.parseSPS(te.data);this.video_init_segment_dispatched_?this.detectVideoMetadataChange(de,me)===!0&&(d.a.v(this.TAG,"H264: Critical h264 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:de,pps:void 0,av1c:void 0,details:me}):(this.video_metadata_.sps=de,this.video_metadata_.details=me)}else de.type===ne.kSlicePPS?this.video_init_segment_dispatched_&&!this.video_metadata_changed_||(this.video_metadata_.pps=de,this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):(de.type===ne.kSliceIDR||de.type===ne.kSliceNonIDR&&G===1)&&(fe=!0);this.video_init_segment_dispatched_&&(Z.push(de),ae+=de.data.byteLength)}var Te=Math.floor(b/this.timescale_),De=Math.floor(k/this.timescale_);if(Z.length){var ke=this.video_track_,Qe={units:Z,length:ae,isKeyframe:fe,dts:De,pts:Te,cts:Te-De,file_position:$};ke.samples.push(Qe),ke.length+=ae}},T.prototype.parseH265Payload=function(E,b,k,$,G){for(var q=new Pr(E),te=null,Z=[],ae=0,fe=!1;(te=q.readNextNaluPayload())!=null;){var de=new cn(te);if(de.type===Ke.kSliceVPS){if(!this.video_init_segment_dispatched_){var me=C.parseVPS(te.data);this.video_metadata_.vps=de,this.video_metadata_.details=Mi(Mi({},this.video_metadata_.details),me)}}else de.type===Ke.kSliceSPS?(me=C.parseSPS(te.data),this.video_init_segment_dispatched_?this.detectVideoMetadataChange(de,me)===!0&&(d.a.v(this.TAG,"H265: Critical h265 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:de,pps:void 0,av1c:void 0,details:me}):(this.video_metadata_.sps=de,this.video_metadata_.details=Mi(Mi({},this.video_metadata_.details),me))):de.type===Ke.kSlicePPS?(!this.video_init_segment_dispatched_||this.video_metadata_changed_)&&(me=C.parsePPS(te.data),this.video_metadata_.pps=de,this.video_metadata_.details=Mi(Mi({},this.video_metadata_.details),me),this.video_metadata_.vps&&this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):de.type!==Ke.kSliceIDR_W_RADL&&de.type!==Ke.kSliceIDR_N_LP&&de.type!==Ke.kSliceCRA_NUT||(fe=!0);this.video_init_segment_dispatched_&&(Z.push(de),ae+=de.data.byteLength)}var Te=Math.floor(b/this.timescale_),De=Math.floor(k/this.timescale_);if(Z.length){var ke=this.video_track_,Qe={units:Z,length:ae,isKeyframe:fe,dts:De,pts:Te,cts:Te-De,file_position:$};ke.samples.push(Qe),ke.length+=ae}},T.prototype.detectVideoMetadataChange=function(E,b){if(b.codec_mimetype!==this.video_metadata_.details.codec_mimetype)return d.a.v(this.TAG,"Video: Codec mimeType changed from "+"".concat(this.video_metadata_.details.codec_mimetype," to ").concat(b.codec_mimetype)),!0;if(b.codec_size.width!==this.video_metadata_.details.codec_size.width||b.codec_size.height!==this.video_metadata_.details.codec_size.height){var k=this.video_metadata_.details.codec_size,$=b.codec_size;return d.a.v(this.TAG,"Video: Coded Resolution changed from "+"".concat(k.width,"x").concat(k.height," to ").concat($.width,"x").concat($.height)),!0}return b.present_size.width!==this.video_metadata_.details.present_size.width&&(d.a.v(this.TAG,"Video: Present resolution width changed from "+"".concat(this.video_metadata_.details.present_size.width," to ").concat(b.present_size.width)),!0)},T.prototype.isInitSegmentDispatched=function(){return this.has_video_&&this.has_audio_?this.video_init_segment_dispatched_&&this.audio_init_segment_dispatched_:this.has_video_&&!this.has_audio_?this.video_init_segment_dispatched_:!(this.has_video_||!this.has_audio_)&&this.audio_init_segment_dispatched_},T.prototype.dispatchVideoInitSegment=function(){var E=this.video_metadata_.details,b={type:"video"};b.id=this.video_track_.id,b.timescale=1e3,b.duration=this.duration_,b.codecWidth=E.codec_size.width,b.codecHeight=E.codec_size.height,b.presentWidth=E.present_size.width,b.presentHeight=E.present_size.height,b.profile=E.profile_string,b.level=E.level_string,b.bitDepth=E.bit_depth,b.chromaFormat=E.chroma_format,b.sarRatio=E.sar_ratio,b.frameRate=E.frame_rate;var k=b.frameRate.fps_den,$=b.frameRate.fps_num;if(b.refSampleDuration=k/$*1e3,b.codec=E.codec_mimetype,this.video_metadata_.av1c)b.av1c=this.video_metadata_.av1c,this.video_init_segment_dispatched_==0&&d.a.v(this.TAG,"Generated first AV1 for mimeType: ".concat(b.codec));else if(this.video_metadata_.vps){var G=this.video_metadata_.vps.data.subarray(4),q=this.video_metadata_.sps.data.subarray(4),te=this.video_metadata_.pps.data.subarray(4),Z=new we(G,q,te,E);b.hvcc=Z.getData(),this.video_init_segment_dispatched_==0&&d.a.v(this.TAG,"Generated first HEVCDecoderConfigurationRecord for mimeType: ".concat(b.codec))}else{q=this.video_metadata_.sps.data.subarray(4),te=this.video_metadata_.pps.data.subarray(4);var ae=new ye(q,te,E);b.avcc=ae.getData(),this.video_init_segment_dispatched_==0&&d.a.v(this.TAG,"Generated first AVCDecoderConfigurationRecord for mimeType: ".concat(b.codec))}this.onTrackMetadata("video",b),this.video_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var fe=this.media_info_;fe.hasVideo=!0,fe.width=b.codecWidth,fe.height=b.codecHeight,fe.fps=b.frameRate.fps,fe.profile=b.profile,fe.level=b.level,fe.refFrames=E.ref_frames,fe.chromaFormat=E.chroma_format_string,fe.sarNum=b.sarRatio.width,fe.sarDen=b.sarRatio.height,fe.videoCodec=b.codec,fe.hasAudio&&fe.audioCodec?fe.mimeType='video/mp2t; codecs="'.concat(fe.videoCodec,",").concat(fe.audioCodec,'"'):fe.mimeType='video/mp2t; codecs="'.concat(fe.videoCodec,'"'),fe.isComplete()&&this.onMediaInfo(fe)},T.prototype.dispatchVideoMediaSegment=function(){this.isInitSegmentDispatched()&&this.video_track_.length&&this.onDataAvailable(null,this.video_track_)},T.prototype.dispatchAudioMediaSegment=function(){this.isInitSegmentDispatched()&&this.audio_track_.length&&this.onDataAvailable(this.audio_track_,null)},T.prototype.dispatchAudioVideoMediaSegment=function(){this.isInitSegmentDispatched()&&(this.audio_track_.length||this.video_track_.length)&&this.onDataAvailable(this.audio_track_,this.video_track_)},T.prototype.parseADTSAACPayload=function(E,b){if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var k=new Uint8Array(E.byteLength+this.aac_last_incomplete_data_.byteLength);k.set(this.aac_last_incomplete_data_,0),k.set(E,this.aac_last_incomplete_data_.byteLength),E=k}var $,G;if(b!=null&&(G=b/this.timescale_),this.audio_metadata_.codec==="aac"){if(b==null&&this.audio_last_sample_pts_!=null)$=1024/this.audio_metadata_.sampling_frequency*1e3,G=this.audio_last_sample_pts_+$;else if(b==null)return void d.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.audio_last_sample_pts_){$=1024/this.audio_metadata_.sampling_frequency*1e3;var q=this.audio_last_sample_pts_+$;Math.abs(q-G)>1&&(d.a.w(this.TAG,"AAC: Detected pts overlapped, "+"expected: ".concat(q,"ms, PES pts: ").concat(G,"ms")),G=q)}}for(var te,Z=new We(E),ae=null,fe=G;(ae=Z.readNextAACFrame())!=null;){$=1024/ae.sampling_frequency*1e3;var de={codec:"aac",data:ae};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"aac",audio_object_type:ae.audio_object_type,sampling_freq_index:ae.sampling_freq_index,sampling_frequency:ae.sampling_frequency,channel_config:ae.channel_config},this.dispatchAudioInitSegment(de)):this.detectAudioMetadataChange(de)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(de)),te=fe;var me=Math.floor(fe),Te={unit:ae.data,length:ae.data.byteLength,pts:me,dts:me};this.audio_track_.samples.push(Te),this.audio_track_.length+=ae.data.byteLength,fe+=$}Z.hasIncompleteData()&&(this.aac_last_incomplete_data_=Z.getIncompleteData()),te&&(this.audio_last_sample_pts_=te)}},T.prototype.parseLOASAACPayload=function(E,b){var k;if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var $=new Uint8Array(E.byteLength+this.aac_last_incomplete_data_.byteLength);$.set(this.aac_last_incomplete_data_,0),$.set(E,this.aac_last_incomplete_data_.byteLength),E=$}var G,q;if(b!=null&&(q=b/this.timescale_),this.audio_metadata_.codec==="aac"){if(b==null&&this.audio_last_sample_pts_!=null)G=1024/this.audio_metadata_.sampling_frequency*1e3,q=this.audio_last_sample_pts_+G;else if(b==null)return void d.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.audio_last_sample_pts_){G=1024/this.audio_metadata_.sampling_frequency*1e3;var te=this.audio_last_sample_pts_+G;Math.abs(te-q)>1&&(d.a.w(this.TAG,"AAC: Detected pts overlapped, "+"expected: ".concat(te,"ms, PES pts: ").concat(q,"ms")),q=te)}}for(var Z,ae=new he(E),fe=null,de=q;(fe=ae.readNextAACFrame((k=this.loas_previous_frame)!==null&&k!==void 0?k:void 0))!=null;){this.loas_previous_frame=fe,G=1024/fe.sampling_frequency*1e3;var me={codec:"aac",data:fe};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"aac",audio_object_type:fe.audio_object_type,sampling_freq_index:fe.sampling_freq_index,sampling_frequency:fe.sampling_frequency,channel_config:fe.channel_config},this.dispatchAudioInitSegment(me)):this.detectAudioMetadataChange(me)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(me)),Z=de;var Te=Math.floor(de),De={unit:fe.data,length:fe.data.byteLength,pts:Te,dts:Te};this.audio_track_.samples.push(De),this.audio_track_.length+=fe.data.byteLength,de+=G}ae.hasIncompleteData()&&(this.aac_last_incomplete_data_=ae.getIncompleteData()),Z&&(this.audio_last_sample_pts_=Z)}},T.prototype.parseAC3Payload=function(E,b){if(!this.has_video_||this.video_init_segment_dispatched_){var k,$;if(b!=null&&($=b/this.timescale_),this.audio_metadata_.codec==="ac-3"){if(b==null&&this.audio_last_sample_pts_!=null)k=1536/this.audio_metadata_.sampling_frequency*1e3,$=this.audio_last_sample_pts_+k;else if(b==null)return void d.a.w(this.TAG,"AC3: Unknown pts")}for(var G,q=new eh(E),te=null,Z=$;(te=q.readNextAC3Frame())!=null;){k=1536/te.sampling_frequency*1e3;var ae={codec:"ac-3",data:te};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"ac-3",sampling_frequency:te.sampling_frequency,bit_stream_identification:te.bit_stream_identification,bit_stream_mode:te.bit_stream_mode,low_frequency_effects_channel_on:te.low_frequency_effects_channel_on,channel_mode:te.channel_mode},this.dispatchAudioInitSegment(ae)):this.detectAudioMetadataChange(ae)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(ae)),G=Z;var fe=Math.floor(Z),de={unit:te.data,length:te.data.byteLength,pts:fe,dts:fe};this.audio_track_.samples.push(de),this.audio_track_.length+=te.data.byteLength,Z+=k}G&&(this.audio_last_sample_pts_=G)}},T.prototype.parseEAC3Payload=function(E,b){if(!this.has_video_||this.video_init_segment_dispatched_){var k,$;if(b!=null&&($=b/this.timescale_),this.audio_metadata_.codec==="ec-3"){if(b==null&&this.audio_last_sample_pts_!=null)k=256*this.audio_metadata_.num_blks/this.audio_metadata_.sampling_frequency*1e3,$=this.audio_last_sample_pts_+k;else if(b==null)return void d.a.w(this.TAG,"EAC3: Unknown pts")}for(var G,q=new Ur(E),te=null,Z=$;(te=q.readNextEAC3Frame())!=null;){k=1536/te.sampling_frequency*1e3;var ae={codec:"ec-3",data:te};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"ec-3",sampling_frequency:te.sampling_frequency,bit_stream_identification:te.bit_stream_identification,low_frequency_effects_channel_on:te.low_frequency_effects_channel_on,num_blks:te.num_blks,channel_mode:te.channel_mode},this.dispatchAudioInitSegment(ae)):this.detectAudioMetadataChange(ae)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(ae)),G=Z;var fe=Math.floor(Z),de={unit:te.data,length:te.data.byteLength,pts:fe,dts:fe};this.audio_track_.samples.push(de),this.audio_track_.length+=te.data.byteLength,Z+=k}G&&(this.audio_last_sample_pts_=G)}},T.prototype.parseOpusPayload=function(E,b){if(!this.has_video_||this.video_init_segment_dispatched_){var k,$;if(b!=null&&($=b/this.timescale_),this.audio_metadata_.codec==="opus"){if(b==null&&this.audio_last_sample_pts_!=null)k=20,$=this.audio_last_sample_pts_+k;else if(b==null)return void d.a.w(this.TAG,"Opus: Unknown pts")}for(var G,q=$,te=0;te<E.length;){k=20;for(var Z=(16&E[te+1])!=0,ae=(8&E[te+1])!=0,fe=te+2,de=0;E[fe]===255;)de+=255,fe+=1;de+=E[fe],fe+=1,fe+=Z?2:0,fe+=ae?2:0,G=q;var me=Math.floor(q),Te=E.slice(fe,fe+de),De={unit:Te,length:Te.byteLength,pts:me,dts:me};this.audio_track_.samples.push(De),this.audio_track_.length+=Te.byteLength,q+=k,te=fe+de}G&&(this.audio_last_sample_pts_=G)}},T.prototype.parseMP3Payload=function(E,b){if(!this.has_video_||this.video_init_segment_dispatched_){var k=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],$=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],G=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],q=E[1]>>>3&3,te=(6&E[1])>>1,Z=(240&E[2])>>>4,ae=(12&E[2])>>>2,fe=(E[3]>>>6&3)!==3?2:1,de=0,me=34;switch(q){case 0:de=[11025,12e3,8e3,0][ae];break;case 2:de=[22050,24e3,16e3,0][ae];break;case 3:de=[44100,48e3,32e3,0][ae]}switch(te){case 1:me=34,Z<G.length&&G[Z];break;case 2:me=33,Z<$.length&&$[Z];break;case 3:me=32,Z<k.length&&k[Z]}var Te=new It;Te.object_type=me,Te.sample_rate=de,Te.channel_count=fe,Te.data=E;var De={codec:"mp3",data:Te};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"mp3",object_type:me,sample_rate:de,channel_count:fe},this.dispatchAudioInitSegment(De)):this.detectAudioMetadataChange(De)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(De));var ke={unit:E,length:E.byteLength,pts:b/this.timescale_,dts:b/this.timescale_};this.audio_track_.samples.push(ke),this.audio_track_.length+=E.byteLength}},T.prototype.detectAudioMetadataChange=function(E){if(E.codec!==this.audio_metadata_.codec)return d.a.v(this.TAG,"Audio: Audio Codecs changed from "+"".concat(this.audio_metadata_.codec," to ").concat(E.codec)),!0;if(E.codec==="aac"&&this.audio_metadata_.codec==="aac"){if((b=E.data).audio_object_type!==this.audio_metadata_.audio_object_type)return d.a.v(this.TAG,"AAC: AudioObjectType changed from "+"".concat(this.audio_metadata_.audio_object_type," to ").concat(b.audio_object_type)),!0;if(b.sampling_freq_index!==this.audio_metadata_.sampling_freq_index)return d.a.v(this.TAG,"AAC: SamplingFrequencyIndex changed from "+"".concat(this.audio_metadata_.sampling_freq_index," to ").concat(b.sampling_freq_index)),!0;if(b.channel_config!==this.audio_metadata_.channel_config)return d.a.v(this.TAG,"AAC: Channel configuration changed from "+"".concat(this.audio_metadata_.channel_config," to ").concat(b.channel_config)),!0}else if(E.codec==="ac-3"&&this.audio_metadata_.codec==="ac-3"){var b;if((b=E.data).sampling_frequency!==this.audio_metadata_.sampling_frequency)return d.a.v(this.TAG,"AC3: Sampling Frequency changed from "+"".concat(this.audio_metadata_.sampling_frequency," to ").concat(b.sampling_frequency)),!0;if(b.bit_stream_identification!==this.audio_metadata_.bit_stream_identification)return d.a.v(this.TAG,"AC3: Bit Stream Identification changed from "+"".concat(this.audio_metadata_.bit_stream_identification," to ").concat(b.bit_stream_identification)),!0;if(b.bit_stream_mode!==this.audio_metadata_.bit_stream_mode)return d.a.v(this.TAG,"AC3: BitStream Mode changed from "+"".concat(this.audio_metadata_.bit_stream_mode," to ").concat(b.bit_stream_mode)),!0;if(b.channel_mode!==this.audio_metadata_.channel_mode)return d.a.v(this.TAG,"AC3: Channel Mode changed from "+"".concat(this.audio_metadata_.channel_mode," to ").concat(b.channel_mode)),!0;if(b.low_frequency_effects_channel_on!==this.audio_metadata_.low_frequency_effects_channel_on)return d.a.v(this.TAG,"AC3: Low Frequency Effects Channel On changed from "+"".concat(this.audio_metadata_.low_frequency_effects_channel_on," to ").concat(b.low_frequency_effects_channel_on)),!0}else if(E.codec==="opus"&&this.audio_metadata_.codec==="opus"){if((k=E.meta).sample_rate!==this.audio_metadata_.sample_rate)return d.a.v(this.TAG,"Opus: SamplingFrequencyIndex changed from "+"".concat(this.audio_metadata_.sample_rate," to ").concat(k.sample_rate)),!0;if(k.channel_count!==this.audio_metadata_.channel_count)return d.a.v(this.TAG,"Opus: Channel count changed from "+"".concat(this.audio_metadata_.channel_count," to ").concat(k.channel_count)),!0}else if(E.codec==="mp3"&&this.audio_metadata_.codec==="mp3"){var k;if((k=E.data).object_type!==this.audio_metadata_.object_type)return d.a.v(this.TAG,"MP3: AudioObjectType changed from "+"".concat(this.audio_metadata_.object_type," to ").concat(k.object_type)),!0;if(k.sample_rate!==this.audio_metadata_.sample_rate)return d.a.v(this.TAG,"MP3: SamplingFrequencyIndex changed from "+"".concat(this.audio_metadata_.sample_rate," to ").concat(k.sample_rate)),!0;if(k.channel_count!==this.audio_metadata_.channel_count)return d.a.v(this.TAG,"MP3: Channel count changed from "+"".concat(this.audio_metadata_.channel_count," to ").concat(k.channel_count)),!0}return!1},T.prototype.dispatchAudioInitSegment=function(E){var b={type:"audio"};if(b.id=this.audio_track_.id,b.timescale=1e3,b.duration=this.duration_,this.audio_metadata_.codec==="aac"){var k=E.codec==="aac"?E.data:null,$=new Ue(k);b.audioSampleRate=$.sampling_rate,b.channelCount=$.channel_count,b.codec=$.codec_mimetype,b.originalCodec=$.original_codec_mimetype,b.config=$.config,b.refSampleDuration=1024/b.audioSampleRate*b.timescale}else if(this.audio_metadata_.codec==="ac-3"){var G=E.codec==="ac-3"?E.data:null,q=new th(G);b.audioSampleRate=q.sampling_rate,b.channelCount=q.channel_count,b.codec=q.codec_mimetype,b.originalCodec=q.original_codec_mimetype,b.config=q.config,b.refSampleDuration=1536/b.audioSampleRate*b.timescale}else if(this.audio_metadata_.codec==="ec-3"){var te=E.codec==="ec-3"?E.data:null,Z=new Fr(te);b.audioSampleRate=Z.sampling_rate,b.channelCount=Z.channel_count,b.codec=Z.codec_mimetype,b.originalCodec=Z.original_codec_mimetype,b.config=Z.config,b.refSampleDuration=256*Z.num_blks/b.audioSampleRate*b.timescale}else this.audio_metadata_.codec==="opus"?(b.audioSampleRate=this.audio_metadata_.sample_rate,b.channelCount=this.audio_metadata_.channel_count,b.channelConfigCode=this.audio_metadata_.channel_config_code,b.codec="opus",b.originalCodec="opus",b.config=void 0,b.refSampleDuration=20):this.audio_metadata_.codec==="mp3"&&(b.audioSampleRate=this.audio_metadata_.sample_rate,b.channelCount=this.audio_metadata_.channel_count,b.codec="mp3",b.originalCodec="mp3",b.config=void 0);this.audio_init_segment_dispatched_==0&&d.a.v(this.TAG,"Generated first AudioSpecificConfig for mimeType: ".concat(b.codec)),this.onTrackMetadata("audio",b),this.audio_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var ae=this.media_info_;ae.hasAudio=!0,ae.audioCodec=b.originalCodec,ae.audioSampleRate=b.audioSampleRate,ae.audioChannelCount=b.channelCount,ae.hasVideo&&ae.videoCodec?ae.mimeType='video/mp2t; codecs="'.concat(ae.videoCodec,",").concat(ae.audioCodec,'"'):ae.mimeType='video/mp2t; codecs="'.concat(ae.audioCodec,'"'),ae.isComplete()&&this.onMediaInfo(ae)},T.prototype.dispatchPESPrivateDataDescriptor=function(E,b,k){var $=new vt;$.pid=E,$.stream_type=b,$.descriptor=k,this.onPESPrivateDataDescriptor&&this.onPESPrivateDataDescriptor($)},T.prototype.parsePESPrivateDataPayload=function(E,b,k,$,G){var q=new Ge;if(q.pid=$,q.stream_id=G,q.len=E.byteLength,q.data=E,b!=null){var te=Math.floor(b/this.timescale_);q.pts=te}else q.nearest_pts=this.getNearestTimestampMilliseconds();if(k!=null){var Z=Math.floor(k/this.timescale_);q.dts=Z}this.onPESPrivateData&&this.onPESPrivateData(q)},T.prototype.parseTimedID3MetadataPayload=function(E,b,k,$,G){var q=new Ge;if(q.pid=$,q.stream_id=G,q.len=E.byteLength,q.data=E,b!=null){var te=Math.floor(b/this.timescale_);q.pts=te}if(k!=null){var Z=Math.floor(k/this.timescale_);q.dts=Z}this.onTimedID3Metadata&&this.onTimedID3Metadata(q)},T.prototype.parseSynchronousKLVMetadataPayload=function(E,b,k,$,G){var q=new Ii;if(q.pid=$,q.stream_id=G,q.len=E.byteLength,q.data=E,b!=null){var te=Math.floor(b/this.timescale_);q.pts=te}if(k!=null){var Z=Math.floor(k/this.timescale_);q.dts=Z}q.access_units=(function(ae){for(var fe=[],de=0;de+5<ae.byteLength;){var me=ae[de+0],Te=ae[de+1],De=ae[de+2],ke=ae[de+3]<<8|ae[de+4]<<0,Qe=ae.slice(de+5,de+5+ke);fe.push({service_id:me,sequence_number:Te,flags:De,data:Qe}),de+=5+ke}return fe})(E),this.onSynchronousKLVMetadata&&this.onSynchronousKLVMetadata(q)},T.prototype.parseAsynchronousKLVMetadataPayload=function(E,b,k){var $=new Ge;$.pid=b,$.stream_id=k,$.len=E.byteLength,$.data=E,this.onAsynchronousKLVMetadata&&this.onAsynchronousKLVMetadata($)},T.prototype.parseSMPTE2038MetadataPayload=function(E,b,k,$,G){var q=new dt;if(q.pid=$,q.stream_id=G,q.len=E.byteLength,q.data=E,b!=null){var te=Math.floor(b/this.timescale_);q.pts=te}if(q.nearest_pts=this.getNearestTimestampMilliseconds(),k!=null){var Z=Math.floor(k/this.timescale_);q.dts=Z}q.ancillaries=(function(ae){for(var fe=new N(ae),de=0,me=[];de+=6,fe.readBits(6)===0;){var Te=fe.readBool();de+=1;var De=fe.readBits(11);de+=11;var ke=fe.readBits(12);de+=12;var Qe=255&fe.readBits(10);de+=10;var He=255&fe.readBits(10);de+=10;var $e=255&fe.readBits(10);de+=10;for(var rt=new Uint8Array($e),xt=0;xt<$e;xt++){var ze=255&fe.readBits(10);de+=10,rt[xt]=ze}fe.readBits(10),de+=10;var st="User Defined";Qe===65?He===7&&(st="SCTE-104"):Qe===95?He===220?st="ARIB STD-B37 (1SEG)":He===221?st="ARIB STD-B37 (ANALOG)":He===222?st="ARIB STD-B37 (SD)":He===223&&(st="ARIB STD-B37 (HD)"):Qe===97&&(He===1?st="EIA-708":He===2&&(st="EIA-608")),me.push({yc_indicator:Te,line_number:De,horizontal_offset:ke,did:Qe,sdid:He,user_data:rt,description:st,information:{}}),fe.readBits(8-(de-Math.floor(de/8))%8),de+=(8-(de-Math.floor(de/8)))%8}return fe.destroy(),fe=null,me})(E),this.onSMPTE2038Metadata&&this.onSMPTE2038Metadata(q)},T.prototype.getNearestTimestampMilliseconds=function(){return this.audio_last_sample_pts_!=null?Math.floor(this.audio_last_sample_pts_):this.last_pcr_!=null?Math.floor(this.last_pcr_/300/this.timescale_):void 0},T.prototype.getPcrBase=function(E){var b=33554432*E[6]+131072*E[7]+512*E[8]+2*E[9]+(128&E[10])/128+this.timestamp_offset_;return b+4294967296<this.last_pcr_base_&&(b+=8589934592,this.timestamp_offset_+=8589934592),this.last_pcr_base_=b,b},T.prototype.getTimestamp=function(E,b){var k=536870912*(14&E[b])+4194304*(255&E[b+1])+16384*(254&E[b+2])+128*(255&E[b+3])+(254&E[b+4])/2+this.timestamp_offset_;return k+4294967296<this.last_pcr_base_&&(k+=8589934592),k},T})(J),Gr=function(j,T,E){for(var b,k=0,$=T.length;k<$;k++)!b&&k in T||(b||(b=Array.prototype.slice.call(T,0,k)),b[k]=T[k]);return j.concat(b||Array.prototype.slice.call(T))},da=(function(){function j(){}return j.init=function(){for(var T in j.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],hvc1:[],hvcC:[],av01:[],av1C:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[],Opus:[],dOps:[],"ac-3":[],dac3:[],"ec-3":[],dec3:[],fLaC:[],dfLa:[]},j.types)j.types.hasOwnProperty(T)&&(j.types[T]=[T.charCodeAt(0),T.charCodeAt(1),T.charCodeAt(2),T.charCodeAt(3)]);var E=j.constants={};E.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),E.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),E.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),E.STSC=E.STCO=E.STTS,E.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),E.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),E.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),E.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),E.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),E.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},j.box=function(T){for(var E=8,b=null,k=Array.prototype.slice.call(arguments,1),$=k.length,G=0;G<$;G++)E+=k[G].byteLength;(b=new Uint8Array(E))[0]=E>>>24&255,b[1]=E>>>16&255,b[2]=E>>>8&255,b[3]=255&E,b.set(T,4);var q=8;for(G=0;G<$;G++)b.set(k[G],q),q+=k[G].byteLength;return b},j.generateInitSegment=function(T){var E=j.box(j.types.ftyp,j.constants.FTYP),b=j.moov(T),k=new Uint8Array(E.byteLength+b.byteLength);return k.set(E,0),k.set(b,E.byteLength),k},j.moov=function(T){var E=j.mvhd(T.timescale,T.duration),b=j.trak(T),k=j.mvex(T);return j.box(j.types.moov,E,b,k)},j.mvhd=function(T,E){return j.box(j.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,T>>>24&255,T>>>16&255,T>>>8&255,255&T,E>>>24&255,E>>>16&255,E>>>8&255,255&E,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},j.trak=function(T){return j.box(j.types.trak,j.tkhd(T),j.mdia(T))},j.tkhd=function(T){var E=T.id,b=T.duration,k=T.presentWidth,$=T.presentHeight;return j.box(j.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,E>>>24&255,E>>>16&255,E>>>8&255,255&E,0,0,0,0,b>>>24&255,b>>>16&255,b>>>8&255,255&b,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,k>>>8&255,255&k,0,0,$>>>8&255,255&$,0,0]))},j.mdia=function(T){return j.box(j.types.mdia,j.mdhd(T),j.hdlr(T),j.minf(T))},j.mdhd=function(T){var E=T.timescale,b=T.duration;return j.box(j.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,E>>>24&255,E>>>16&255,E>>>8&255,255&E,b>>>24&255,b>>>16&255,b>>>8&255,255&b,85,196,0,0]))},j.hdlr=function(T){var E=null;return E=T.type==="audio"?j.constants.HDLR_AUDIO:j.constants.HDLR_VIDEO,j.box(j.types.hdlr,E)},j.minf=function(T){var E=null;return E=T.type==="audio"?j.box(j.types.smhd,j.constants.SMHD):j.box(j.types.vmhd,j.constants.VMHD),j.box(j.types.minf,E,j.dinf(),j.stbl(T))},j.dinf=function(){return j.box(j.types.dinf,j.box(j.types.dref,j.constants.DREF))},j.stbl=function(T){return j.box(j.types.stbl,j.stsd(T),j.box(j.types.stts,j.constants.STTS),j.box(j.types.stsc,j.constants.STSC),j.box(j.types.stsz,j.constants.STSZ),j.box(j.types.stco,j.constants.STCO))},j.stsd=function(T){return T.type==="audio"?T.codec==="mp3"?j.box(j.types.stsd,j.constants.STSD_PREFIX,j.mp3(T)):T.codec==="ac-3"?j.box(j.types.stsd,j.constants.STSD_PREFIX,j.ac3(T)):T.codec==="ec-3"?j.box(j.types.stsd,j.constants.STSD_PREFIX,j.ec3(T)):T.codec==="opus"?j.box(j.types.stsd,j.constants.STSD_PREFIX,j.Opus(T)):T.codec=="flac"?j.box(j.types.stsd,j.constants.STSD_PREFIX,j.fLaC(T)):j.box(j.types.stsd,j.constants.STSD_PREFIX,j.mp4a(T)):T.type==="video"&&T.codec.startsWith("hvc1")?j.box(j.types.stsd,j.constants.STSD_PREFIX,j.hvc1(T)):T.type==="video"&&T.codec.startsWith("av01")?j.box(j.types.stsd,j.constants.STSD_PREFIX,j.av01(T)):j.box(j.types.stsd,j.constants.STSD_PREFIX,j.avc1(T))},j.mp3=function(T){var E=T.channelCount,b=T.audioSampleRate,k=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,E,0,16,0,0,0,0,b>>>8&255,255&b,0,0]);return j.box(j.types[".mp3"],k)},j.mp4a=function(T){var E=T.channelCount,b=T.audioSampleRate,k=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,E,0,16,0,0,0,0,b>>>8&255,255&b,0,0]);return j.box(j.types.mp4a,k,j.esds(T))},j.ac3=function(T){var E=T.channelCount,b=T.audioSampleRate,k=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,E,0,16,0,0,0,0,b>>>8&255,255&b,0,0]);return j.box(j.types["ac-3"],k,j.box(j.types.dac3,new Uint8Array(T.config)))},j.ec3=function(T){var E=T.channelCount,b=T.audioSampleRate,k=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,E,0,16,0,0,0,0,b>>>8&255,255&b,0,0]);return j.box(j.types["ec-3"],k,j.box(j.types.dec3,new Uint8Array(T.config)))},j.esds=function(T){var E=T.config||[],b=E.length,k=new Uint8Array([0,0,0,0,3,23+b,0,1,0,4,15+b,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([b]).concat(E).concat([6,1,2]));return j.box(j.types.esds,k)},j.Opus=function(T){var E=T.channelCount,b=T.audioSampleRate,k=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,E,0,16,0,0,0,0,b>>>8&255,255&b,0,0]);return j.box(j.types.Opus,k,j.dOps(T))},j.dOps=function(T){var E=T.channelCount,b=T.channelConfigCode,k=T.audioSampleRate;if(T.config)return j.box(j.types.dOps,T.config);var $=[];switch(b){case 1:case 2:$=[0];break;case 0:$=[255,1,1,0,1];break;case 128:$=[255,2,0,0,1];break;case 3:$=[1,2,1,0,2,1];break;case 4:$=[1,2,2,0,1,2,3];break;case 5:$=[1,3,2,0,4,1,2,3];break;case 6:$=[1,4,2,0,4,1,2,3,5];break;case 7:$=[1,4,2,0,4,1,2,3,5,6];break;case 8:$=[1,5,3,0,6,1,2,3,4,5,7];break;case 130:$=[1,1,2,0,1];break;case 131:$=[1,1,3,0,1,2];break;case 132:$=[1,1,4,0,1,2,3];break;case 133:$=[1,1,5,0,1,2,3,4];break;case 134:$=[1,1,6,0,1,2,3,4,5];break;case 135:$=[1,1,7,0,1,2,3,4,5,6];break;case 136:$=[1,1,8,0,1,2,3,4,5,6,7]}var G=new Uint8Array(Gr([0,E,0,0,k>>>24&255,k>>>17&255,k>>>8&255,k>>>0&255,0,0],$));return j.box(j.types.dOps,G)},j.fLaC=function(T){var E=T.channelCount,b=Math.min(T.audioSampleRate,65535),k=T.sampleSize,$=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,E,0,k,0,0,0,0,b>>>8&255,255&b,0,0]);return j.box(j.types.fLaC,$,j.dfLa(T))},j.dfLa=function(T){var E=new Uint8Array(Gr([0,0,0,0],T.config));return j.box(j.types.dfLa,E)},j.avc1=function(T){var E=T.avcc,b=T.codecWidth,k=T.codecHeight,$=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,b>>>8&255,255&b,k>>>8&255,255&k,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return j.box(j.types.avc1,$,j.box(j.types.avcC,E))},j.hvc1=function(T){var E=T.hvcc,b=T.codecWidth,k=T.codecHeight,$=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,b>>>8&255,255&b,k>>>8&255,255&k,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return j.box(j.types.hvc1,$,j.box(j.types.hvcC,E))},j.av01=function(T){var E=T.av1c,b=T.codecWidth||192,k=T.codecHeight||108,$=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,b>>>8&255,255&b,k>>>8&255,255&k,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return j.box(j.types.av01,$,j.box(j.types.av1C,E))},j.mvex=function(T){return j.box(j.types.mvex,j.trex(T))},j.trex=function(T){var E=T.id,b=new Uint8Array([0,0,0,0,E>>>24&255,E>>>16&255,E>>>8&255,255&E,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return j.box(j.types.trex,b)},j.moof=function(T,E){return j.box(j.types.moof,j.mfhd(T.sequenceNumber),j.traf(T,E))},j.mfhd=function(T){var E=new Uint8Array([0,0,0,0,T>>>24&255,T>>>16&255,T>>>8&255,255&T]);return j.box(j.types.mfhd,E)},j.traf=function(T,E){var b=T.id,k=j.box(j.types.tfhd,new Uint8Array([0,0,0,0,b>>>24&255,b>>>16&255,b>>>8&255,255&b])),$=j.box(j.types.tfdt,new Uint8Array([0,0,0,0,E>>>24&255,E>>>16&255,E>>>8&255,255&E])),G=j.sdtp(T),q=j.trun(T,G.byteLength+16+16+8+16+8+8);return j.box(j.types.traf,k,$,q,G)},j.sdtp=function(T){for(var E=T.samples||[],b=E.length,k=new Uint8Array(4+b),$=0;$<b;$++){var G=E[$].flags;k[$+4]=G.isLeading<<6|G.dependsOn<<4|G.isDependedOn<<2|G.hasRedundancy}return j.box(j.types.sdtp,k)},j.trun=function(T,E){var b=T.samples||[],k=b.length,$=12+16*k,G=new Uint8Array($);E+=8+$,G.set([0,0,15,1,k>>>24&255,k>>>16&255,k>>>8&255,255&k,E>>>24&255,E>>>16&255,E>>>8&255,255&E],0);for(var q=0;q<k;q++){var te=b[q].duration,Z=b[q].size,ae=b[q].flags,fe=b[q].cts;G.set([te>>>24&255,te>>>16&255,te>>>8&255,255&te,Z>>>24&255,Z>>>16&255,Z>>>8&255,255&Z,ae.isLeading<<2|ae.dependsOn,ae.isDependedOn<<6|ae.hasRedundancy<<4|ae.isNonSync,0,0,fe>>>24&255,fe>>>16&255,fe>>>8&255,255&fe],12+16*q)}return j.box(j.types.trun,G)},j.mdat=function(T){return j.box(j.types.mdat,T)},j})();da.init();var ua=da,el=(function(){function j(){}return j.getSilentFrame=function(T,E){if(T==="mp4a.40.2"){if(E===1)return new Uint8Array([0,200,0,128,35,128]);if(E===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(E===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(E===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(E===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(E===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(E===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(E===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(E===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},j})(),Hn=r(11),tl=(function(){function j(T){this.TAG="MP4Remuxer",this._config=T,this._isLive=T.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new Hn.c("audio"),this._videoSegmentInfoList=new Hn.c("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!h.a.chrome||!(h.a.version.major<50||h.a.version.major===50&&h.a.version.build<2661)),this._fillSilentAfterSeek=h.a.msedge||h.a.msie,this._mp3UseMpegAudio=!h.a.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return j.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},j.prototype.bindDataSource=function(T){return T.onDataAvailable=this.remux.bind(this),T.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(j.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(T){this._onInitSegment=T},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(T){this._onMediaSegment=T},enumerable:!1,configurable:!0}),j.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},j.prototype.seek=function(T){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},j.prototype.remux=function(T,E){if(!this._onMediaSegment)throw new y.a("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(T,E),E&&this._remuxVideo(E),T&&this._remuxAudio(T)},j.prototype._onTrackMetadataReceived=function(T,E){var b=null,k="mp4",$=E.codec;if(T==="audio")this._audioMeta=E,E.codec==="mp3"&&this._mp3UseMpegAudio?(k="mpeg",$="",b=new Uint8Array):b=ua.generateInitSegment(E);else{if(T!=="video")return;this._videoMeta=E,b=ua.generateInitSegment(E)}if(!this._onInitSegment)throw new y.a("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(T,{type:T,data:b.buffer,codec:$,container:"".concat(T,"/").concat(k),mediaDuration:E.duration})},j.prototype._calculateDtsBase=function(T,E){this._dtsBaseInited||(T&&T.samples&&T.samples.length&&(this._audioDtsBase=T.samples[0].dts),E&&E.samples&&E.samples.length&&(this._videoDtsBase=E.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},j.prototype.getTimestampBase=function(){if(this._dtsBaseInited)return this._dtsBase},j.prototype.flushStashedSamples=function(){var T=this._videoStashedLastSample,E=this._audioStashedLastSample,b={type:"video",id:1,sequenceNumber:0,samples:[],length:0};T!=null&&(b.samples.push(T),b.length=T.length);var k={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};E!=null&&(k.samples.push(E),k.length=E.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(b,!0),this._remuxAudio(k,!0)},j.prototype._remuxAudio=function(T,E){if(this._audioMeta!=null){var b,k=T,$=k.samples,G=void 0,q=-1,te=this._audioMeta.refSampleDuration,Z=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,ae=this._dtsBaseInited&&this._audioNextDts===void 0,fe=!1;if($&&$.length!==0&&($.length!==1||E)){var de=0,me=null,Te=0;Z?(de=0,Te=k.length):(de=8,Te=8+k.length);var De=null;if($.length>1&&(Te-=(De=$.pop()).length),this._audioStashedLastSample!=null){var ke=this._audioStashedLastSample;this._audioStashedLastSample=null,$.unshift(ke),Te+=ke.length}De!=null&&(this._audioStashedLastSample=De);var Qe=$[0].dts-this._dtsBase;if(this._audioNextDts)G=Qe-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())G=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(fe=!0);else{var He=this._audioSegmentInfoList.getLastSampleBefore(Qe);if(He!=null){var $e=Qe-(He.originalDts+He.duration);$e<=3&&($e=0),G=Qe-(He.dts+He.duration+$e)}else G=0}if(fe){var rt=Qe-G,xt=this._videoSegmentInfoList.getLastSegmentBefore(Qe);if(xt!=null&&xt.beginDts<rt){if(ls=el.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount)){var ze=xt.beginDts,st=rt-xt.beginDts;d.a.v(this.TAG,"InsertPrefixSilentAudio: dts: ".concat(ze,", duration: ").concat(st)),$.unshift({unit:ls,dts:ze,pts:ze}),Te+=ls.byteLength}}else fe=!1}for(var mt=[],at=0;at<$.length;at++){var it=(ke=$[at]).unit,gt=ke.dts-this._dtsBase,$t=(ze=gt,!1),ut=null,St=0;if(!(gt<-.001)){if(this._audioMeta.codec!=="mp3"&&te!=null){var Ht=gt;if(this._audioNextDts&&(Ht=this._audioNextDts),(G=gt-Ht)<=-3*te){d.a.w(this.TAG,"Dropping 1 audio frame (originalDts: ".concat(gt," ms ,curRefDts: ").concat(Ht," ms)  due to dtsCorrection: ").concat(G," ms overlap."));continue}if(G>=3*te&&this._fillAudioTimestampGap&&!h.a.safari){$t=!0;var ls,An=Math.floor(G/te);d.a.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+"originalDts: ".concat(gt," ms, curRefDts: ").concat(Ht," ms, ")+"dtsCorrection: ".concat(Math.round(G)," ms, generate: ").concat(An," frames")),ze=Math.floor(Ht),St=Math.floor(Ht+te)-ze,(ls=el.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount))==null&&(d.a.w(this.TAG,"Unable to generate silent frame for "+"".concat(this._audioMeta.originalCodec," with ").concat(this._audioMeta.channelCount," channels, repeat last frame")),ls=it),ut=[];for(var zt=0;zt<An;zt++){Ht+=te;var zs=Math.floor(Ht),Vs=Math.floor(Ht+te)-zs,Ls={dts:zs,pts:zs,cts:0,unit:ls,size:ls.byteLength,duration:Vs,originalDts:gt,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};ut.push(Ls),Te+=Ls.size}this._audioNextDts=Ht+te}else ze=Math.floor(Ht),St=Math.floor(Ht+te)-ze,this._audioNextDts=Ht+te}else ze=gt-G,at!==$.length-1?St=$[at+1].dts-this._dtsBase-G-ze:De!=null?St=De.dts-this._dtsBase-G-ze:St=mt.length>=1?mt[mt.length-1].duration:Math.floor(te),this._audioNextDts=ze+St;q===-1&&(q=ze),mt.push({dts:ze,pts:ze,cts:0,unit:ke.unit,size:ke.unit.byteLength,duration:St,originalDts:gt,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),$t&&mt.push.apply(mt,ut)}}if(mt.length===0)return k.samples=[],void(k.length=0);for(Z?me=new Uint8Array(Te):((me=new Uint8Array(Te))[0]=Te>>>24&255,me[1]=Te>>>16&255,me[2]=Te>>>8&255,me[3]=255&Te,me.set(ua.types.mdat,4)),at=0;at<mt.length;at++)it=mt[at].unit,me.set(it,de),de+=it.byteLength;var _s=mt[mt.length-1];b=_s.dts+_s.duration;var Bt=new Hn.b;Bt.beginDts=q,Bt.endDts=b,Bt.beginPts=q,Bt.endPts=b,Bt.originalBeginDts=mt[0].originalDts,Bt.originalEndDts=_s.originalDts+_s.duration,Bt.firstSample=new Hn.d(mt[0].dts,mt[0].pts,mt[0].duration,mt[0].originalDts,!1),Bt.lastSample=new Hn.d(_s.dts,_s.pts,_s.duration,_s.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(Bt),k.samples=mt,k.sequenceNumber++;var Kn=null;Kn=Z?new Uint8Array:ua.moof(k,q),k.samples=[],k.length=0;var nn={type:"audio",data:this._mergeBoxes(Kn,me).buffer,sampleCount:mt.length,info:Bt};Z&&ae&&(nn.timestampOffset=q),this._onMediaSegment("audio",nn)}}},j.prototype._remuxVideo=function(T,E){if(this._videoMeta!=null){var b,k,$=T,G=$.samples,q=void 0,te=-1,Z=-1;if(G&&G.length!==0&&(G.length!==1||E)){var ae=8,fe=null,de=8+T.length,me=null;if(G.length>1&&(de-=(me=G.pop()).length),this._videoStashedLastSample!=null){var Te=this._videoStashedLastSample;this._videoStashedLastSample=null,G.unshift(Te),de+=Te.length}me!=null&&(this._videoStashedLastSample=me);var De=G[0].dts-this._dtsBase;if(this._videoNextDts)q=De-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())q=0;else{var ke=this._videoSegmentInfoList.getLastSampleBefore(De);if(ke!=null){var Qe=De-(ke.originalDts+ke.duration);Qe<=3&&(Qe=0),q=De-(ke.dts+ke.duration+Qe)}else q=0}for(var He=new Hn.b,$e=[],rt=0;rt<G.length;rt++){var xt=(Te=G[rt]).dts-this._dtsBase,ze=Te.isKeyframe,st=xt-q,mt=Te.cts,at=st+mt;te===-1&&(te=st,Z=at);var it=0;if(rt!==G.length-1?it=G[rt+1].dts-this._dtsBase-q-st:me!=null?it=me.dts-this._dtsBase-q-st:it=$e.length>=1?$e[$e.length-1].duration:Math.floor(this._videoMeta.refSampleDuration),ze){var gt=new Hn.d(st,at,it,Te.dts,!0);gt.fileposition=Te.fileposition,He.appendSyncPoint(gt)}$e.push({dts:st,pts:at,cts:mt,units:Te.units,size:Te.length,isKeyframe:ze,duration:it,originalDts:xt,flags:{isLeading:0,dependsOn:ze?2:1,isDependedOn:ze?1:0,hasRedundancy:0,isNonSync:ze?0:1}})}for((fe=new Uint8Array(de))[0]=de>>>24&255,fe[1]=de>>>16&255,fe[2]=de>>>8&255,fe[3]=255&de,fe.set(ua.types.mdat,4),rt=0;rt<$e.length;rt++)for(var $t=$e[rt].units;$t.length;){var ut=$t.shift().data;fe.set(ut,ae),ae+=ut.byteLength}var St=$e[$e.length-1];if(b=St.dts+St.duration,k=St.pts+St.duration,this._videoNextDts=b,He.beginDts=te,He.endDts=b,He.beginPts=Z,He.endPts=k,He.originalBeginDts=$e[0].originalDts,He.originalEndDts=St.originalDts+St.duration,He.firstSample=new Hn.d($e[0].dts,$e[0].pts,$e[0].duration,$e[0].originalDts,$e[0].isKeyframe),He.lastSample=new Hn.d(St.dts,St.pts,St.duration,St.originalDts,St.isKeyframe),this._isLive||this._videoSegmentInfoList.append(He),$.samples=$e,$.sequenceNumber++,this._forceFirstIDR){var Ht=$e[0].flags;Ht.dependsOn=2,Ht.isNonSync=0}var ls=ua.moof($,te);$.samples=[],$.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(ls,fe).buffer,sampleCount:$e.length,info:He})}}},j.prototype._mergeBoxes=function(T,E){var b=new Uint8Array(T.byteLength+E.byteLength);return b.set(T,0),b.set(E,T.byteLength),b},j})(),sl=r(14),ps=r(1),Sc=(r(2),(function(){function j(T,E){this.TAG="TransmuxingController",this._emitter=new c.a,this._config=E,T.segments||(T.segments=[{duration:T.duration,filesize:T.filesize,url:T.url}]),typeof T.cors!="boolean"&&(T.cors=!0),typeof T.withCredentials!="boolean"&&(T.withCredentials=!1),this._mediaDataSource=T,this._currentSegmentIndex=0;var b=0;this._mediaDataSource.segments.forEach((function(k){k.timestampBase=b,b+=k.duration,k.cors=T.cors,k.withCredentials=T.withCredentials,E.referrerPolicy&&(k.referrerPolicy=E.referrerPolicy)})),isNaN(b)||this._mediaDataSource.duration===b||(this._mediaDataSource.duration=b),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return j.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},j.prototype.on=function(T,E){this._emitter.addListener(T,E)},j.prototype.off=function(T,E){this._emitter.removeListener(T,E)},j.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},j.prototype._loadSegment=function(T,E){this._currentSegmentIndex=T;var b=this._mediaDataSource.segments[T],k=this._ioctl=new sl.a(b,this._config,T);k.onError=this._onIOException.bind(this),k.onSeeked=this._onIOSeeked.bind(this),k.onComplete=this._onIOComplete.bind(this),k.onRedirect=this._onIORedirect.bind(this),k.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),E?this._demuxer.bindDataSource(this._ioctl):k.onDataArrival=this._onInitChunkArrival.bind(this),k.open(E)},j.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},j.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},j.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},j.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},j.prototype.seek=function(T){if(this._mediaInfo!=null&&this._mediaInfo.isSeekable()){var E=this._searchSegmentIndexContains(T);if(E===this._currentSegmentIndex){var b=this._mediaInfo.segments[E];if(b==null)this._pendingSeekTime=T;else{var k=b.getNearestKeyframe(T);this._remuxer.seek(k.milliseconds),this._ioctl.seek(k.fileposition),this._pendingResolveSeekPoint=k.milliseconds}}else{var $=this._mediaInfo.segments[E];$==null?(this._pendingSeekTime=T,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(E)):(k=$.getNearestKeyframe(T),this._internalAbort(),this._remuxer.seek(T),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[E].timestampBase,this._loadSegment(E,k.fileposition),this._pendingResolveSeekPoint=k.milliseconds,this._reportSegmentMediaInfo(E))}this._enableStatisticsReporter()}},j.prototype._searchSegmentIndexContains=function(T){for(var E=this._mediaDataSource.segments,b=E.length-1,k=0;k<E.length;k++)if(T<E[k].timestampBase){b=k-1;break}return b},j.prototype._onInitChunkArrival=function(T,E){var b=this,k=0;if(E>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,k=this._demuxer.parseChunks(T,E);else{var $=null;($=O.probe(T)).match&&(this._setupFLVDemuxerRemuxer($),k=this._demuxer.parseChunks(T,E)),$.match||$.needMoreData||($=Zo.probe(T)).match&&(this._setupTSDemuxerRemuxer($),k=this._demuxer.parseChunks(T,E)),$.match||$.needMoreData||($=null,d.a.e(this.TAG,"Non MPEG-TS/FLV, Unsupported media type!"),Promise.resolve().then((function(){b._internalAbort()})),this._emitter.emit(ps.a.DEMUX_ERROR,R.a.FORMAT_UNSUPPORTED,"Non MPEG-TS/FLV, Unsupported media type!"))}return k},j.prototype._setupFLVDemuxerRemuxer=function(T){this._demuxer=new O(T,this._config),this._remuxer||(this._remuxer=new tl(this._config));var E=this._mediaDataSource;E.duration==null||isNaN(E.duration)||(this._demuxer.overridedDuration=E.duration),typeof E.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=E.hasAudio),typeof E.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=E.hasVideo),this._demuxer.timestampBase=E.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},j.prototype._setupTSDemuxerRemuxer=function(T){var E=this._demuxer=new Zo(T,this._config);this._remuxer||(this._remuxer=new tl(this._config)),E.onError=this._onDemuxException.bind(this),E.onMediaInfo=this._onMediaInfo.bind(this),E.onMetaDataArrived=this._onMetaDataArrived.bind(this),E.onTimedID3Metadata=this._onTimedID3Metadata.bind(this),E.onSynchronousKLVMetadata=this._onSynchronousKLVMetadata.bind(this),E.onAsynchronousKLVMetadata=this._onAsynchronousKLVMetadata.bind(this),E.onSMPTE2038Metadata=this._onSMPTE2038Metadata.bind(this),E.onSCTE35Metadata=this._onSCTE35Metadata.bind(this),E.onPESPrivateDataDescriptor=this._onPESPrivateDataDescriptor.bind(this),E.onPESPrivateData=this._onPESPrivateData.bind(this),this._remuxer.bindDataSource(this._demuxer),this._demuxer.bindDataSource(this._ioctl),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},j.prototype._onMediaInfo=function(T){var E=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},T),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,u.a.prototype));var b=Object.assign({},T);Object.setPrototypeOf(b,u.a.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=b,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then((function(){var k=E._pendingSeekTime;E._pendingSeekTime=null,E.seek(k)}))},j.prototype._onMetaDataArrived=function(T){this._emitter.emit(ps.a.METADATA_ARRIVED,T)},j.prototype._onScriptDataArrived=function(T){this._emitter.emit(ps.a.SCRIPTDATA_ARRIVED,T)},j.prototype._onTimedID3Metadata=function(T){var E=this._remuxer.getTimestampBase();E!=null&&(T.pts!=null&&(T.pts-=E),T.dts!=null&&(T.dts-=E),this._emitter.emit(ps.a.TIMED_ID3_METADATA_ARRIVED,T))},j.prototype._onSynchronousKLVMetadata=function(T){var E=this._remuxer.getTimestampBase();E!=null&&(T.pts!=null&&(T.pts-=E),T.dts!=null&&(T.dts-=E),this._emitter.emit(ps.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,T))},j.prototype._onAsynchronousKLVMetadata=function(T){this._emitter.emit(ps.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,T)},j.prototype._onSMPTE2038Metadata=function(T){var E=this._remuxer.getTimestampBase();E!=null&&(T.pts!=null&&(T.pts-=E),T.dts!=null&&(T.dts-=E),T.nearest_pts!=null&&(T.nearest_pts-=E),this._emitter.emit(ps.a.SMPTE2038_METADATA_ARRIVED,T))},j.prototype._onSCTE35Metadata=function(T){var E=this._remuxer.getTimestampBase();E!=null&&(T.pts!=null&&(T.pts-=E),T.nearest_pts!=null&&(T.nearest_pts-=E),this._emitter.emit(ps.a.SCTE35_METADATA_ARRIVED,T))},j.prototype._onPESPrivateDataDescriptor=function(T){this._emitter.emit(ps.a.PES_PRIVATE_DATA_DESCRIPTOR,T)},j.prototype._onPESPrivateData=function(T){var E=this._remuxer.getTimestampBase();E!=null&&(T.pts!=null&&(T.pts-=E),T.nearest_pts!=null&&(T.nearest_pts-=E),T.dts!=null&&(T.dts-=E),this._emitter.emit(ps.a.PES_PRIVATE_DATA_ARRIVED,T))},j.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},j.prototype._onIOComplete=function(T){var E=T+1;E<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer&&this._remuxer.flushStashedSamples(),this._loadSegment(E)):(this._remuxer&&this._remuxer.flushStashedSamples(),this._emitter.emit(ps.a.LOADING_COMPLETE),this._disableStatisticsReporter())},j.prototype._onIORedirect=function(T){var E=this._ioctl.extraData;this._mediaDataSource.segments[E].redirectedURL=T},j.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(ps.a.RECOVERED_EARLY_EOF)},j.prototype._onIOException=function(T,E){d.a.e(this.TAG,"IOException: type = ".concat(T,", code = ").concat(E.code,", msg = ").concat(E.msg)),this._emitter.emit(ps.a.IO_ERROR,T,E),this._disableStatisticsReporter()},j.prototype._onDemuxException=function(T,E){d.a.e(this.TAG,"DemuxException: type = ".concat(T,", info = ").concat(E)),this._emitter.emit(ps.a.DEMUX_ERROR,T,E)},j.prototype._onRemuxerInitSegmentArrival=function(T,E){this._emitter.emit(ps.a.INIT_SEGMENT,T,E)},j.prototype._onRemuxerMediaSegmentArrival=function(T,E){if(this._pendingSeekTime==null&&(this._emitter.emit(ps.a.MEDIA_SEGMENT,T,E),this._pendingResolveSeekPoint!=null&&T==="video")){var b=E.info.syncPoints,k=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,h.a.safari&&b.length>0&&b[0].originalDts===k&&(k=b[0].pts),this._emitter.emit(ps.a.RECOMMEND_SEEKPOINT,k)}},j.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},j.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},j.prototype._reportSegmentMediaInfo=function(T){var E=this._mediaInfo.segments[T],b=Object.assign({},E);b.duration=this._mediaInfo.duration,b.segmentCount=this._mediaInfo.segmentCount,delete b.segments,delete b.keyframesIndex,this._emitter.emit(ps.a.MEDIA_INFO,b)},j.prototype._reportStatisticsInfo=function(){var T={};T.url=this._ioctl.currentURL,T.hasRedirect=this._ioctl.hasRedirect,T.hasRedirect&&(T.redirectedURL=this._ioctl.currentRedirectedURL),T.speed=this._ioctl.currentSpeed,T.loaderType=this._ioctl.loaderType,T.currentSegmentIndex=this._currentSegmentIndex,T.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(ps.a.STATISTICS_INFO,T)},j})());n.a=Sc},function(t,n,r){var o,c=r(0),d=(function(){function B(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return B.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},B.prototype.addBytes=function(I){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=I,this._totalBytes+=I):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=I,this._totalBytes+=I):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=I,this._totalBytes+=I,this._lastCheckpoint=this._now())},Object.defineProperty(B.prototype,"currentKBps",{get:function(){this.addBytes(0);var I=(this._now()-this._lastCheckpoint)/1e3;return I==0&&(I=1),this._intervalBytes/I/1024},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"averageKBps",{get:function(){var I=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/I/1024},enumerable:!1,configurable:!0}),B})(),h=r(2),u=r(5),m=r(3),g=(o=function(B,I){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(M,L){M.__proto__=L}||function(M,L){for(var O in L)Object.prototype.hasOwnProperty.call(L,O)&&(M[O]=L[O])})(B,I)},function(B,I){if(typeof I!="function"&&I!==null)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");function M(){this.constructor=B}o(B,I),B.prototype=I===null?Object.create(I):(M.prototype=I.prototype,new M)}),x=(function(B){function I(M,L){var O=B.call(this,"fetch-stream-loader")||this;return O.TAG="FetchStreamLoader",O._seekHandler=M,O._config=L,O._needStash=!0,O._requestAbort=!1,O._abortController=null,O._contentLength=null,O._receivedLength=0,O}return g(I,B),I.isSupported=function(){try{var M=u.a.msedge&&u.a.version.minor>=15048,L=!u.a.msedge||M;return self.fetch&&self.ReadableStream&&L}catch{return!1}},I.prototype.destroy=function(){this.isWorking()&&this.abort(),B.prototype.destroy.call(this)},I.prototype.open=function(M,L){var O=this;this._dataSource=M,this._range=L;var J=M.url;this._config.reuseRedirectedURL&&M.redirectedURL!=null&&(J=M.redirectedURL);var ie=this._seekHandler.getConfig(J,L),ne=new self.Headers;if(typeof ie.headers=="object"){var se=ie.headers;for(var X in se)se.hasOwnProperty(X)&&ne.append(X,se[X])}var ce={method:"GET",headers:ne,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var X in this._config.headers)ne.append(X,this._config.headers[X]);M.cors===!1&&(ce.mode="same-origin"),M.withCredentials&&(ce.credentials="include"),M.referrerPolicy&&(ce.referrerPolicy=M.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,ce.signal=this._abortController.signal),this._status=h.c.kConnecting,self.fetch(ie.url,ce).then((function(le){if(O._requestAbort)return O._status=h.c.kIdle,void le.body.cancel();if(le.ok&&le.status>=200&&le.status<=299){if(le.url!==ie.url&&O._onURLRedirect){var Y=O._seekHandler.removeURLParameters(le.url);O._onURLRedirect(Y)}var K=le.headers.get("Content-Length");return K!=null&&(O._contentLength=parseInt(K),O._contentLength!==0&&O._onContentLengthKnown&&O._onContentLengthKnown(O._contentLength)),O._pump.call(O,le.body.getReader())}if(O._status=h.c.kError,!O._onError)throw new m.d("FetchStreamLoader: Http code invalid, "+le.status+" "+le.statusText);O._onError(h.b.HTTP_STATUS_CODE_INVALID,{code:le.status,msg:le.statusText})})).catch((function(le){if(!O._abortController||!O._abortController.signal.aborted){if(O._status=h.c.kError,!O._onError)throw le;O._onError(h.b.EXCEPTION,{code:-1,msg:le.message})}}))},I.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==h.c.kBuffering||!u.a.chrome)&&this._abortController)try{this._abortController.abort()}catch{}},I.prototype._pump=function(M){var L=this;return M.read().then((function(O){if(O.done)if(L._contentLength!==null&&L._receivedLength<L._contentLength){L._status=h.c.kError;var J=h.b.EARLY_EOF,ie={code:-1,msg:"Fetch stream meet Early-EOF"};if(!L._onError)throw new m.d(ie.msg);L._onError(J,ie)}else L._status=h.c.kComplete,L._onComplete&&L._onComplete(L._range.from,L._range.from+L._receivedLength-1);else{if(L._abortController&&L._abortController.signal.aborted)return void(L._status=h.c.kComplete);if(L._requestAbort===!0)return L._status=h.c.kComplete,M.cancel();L._status=h.c.kBuffering;var ne=O.value.buffer,se=L._range.from+L._receivedLength;L._receivedLength+=ne.byteLength,L._onDataArrival&&L._onDataArrival(ne,se,L._receivedLength),L._pump(M)}})).catch((function(O){if(L._abortController&&L._abortController.signal.aborted)L._status=h.c.kComplete;else if(O.code!==11||!u.a.msedge){L._status=h.c.kError;var J=0,ie=null;if(O.code!==19&&O.message!=="network error"||!(L._contentLength===null||L._contentLength!==null&&L._receivedLength<L._contentLength)?(J=h.b.EXCEPTION,ie={code:O.code,msg:O.message}):(J=h.b.EARLY_EOF,ie={code:O.code,msg:"Fetch stream meet Early-EOF"}),!L._onError)throw new m.d(ie.msg);L._onError(J,ie)}}))},I})(h.a),y=(function(){var B=function(I,M){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,O){L.__proto__=O}||function(L,O){for(var J in O)Object.prototype.hasOwnProperty.call(O,J)&&(L[J]=O[J])})(I,M)};return function(I,M){if(typeof M!="function"&&M!==null)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");function L(){this.constructor=I}B(I,M),I.prototype=M===null?Object.create(M):(L.prototype=M.prototype,new L)}})(),v=(function(B){function I(M,L){var O=B.call(this,"xhr-moz-chunked-loader")||this;return O.TAG="MozChunkedLoader",O._seekHandler=M,O._config=L,O._needStash=!0,O._xhr=null,O._requestAbort=!1,O._contentLength=null,O._receivedLength=0,O}return y(I,B),I.isSupported=function(){try{var M=new XMLHttpRequest;return M.open("GET","https://example.com",!0),M.responseType="moz-chunked-arraybuffer",M.responseType==="moz-chunked-arraybuffer"}catch(L){return c.a.w("MozChunkedLoader",L.message),!1}},I.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),B.prototype.destroy.call(this)},I.prototype.open=function(M,L){this._dataSource=M,this._range=L;var O=M.url;this._config.reuseRedirectedURL&&M.redirectedURL!=null&&(O=M.redirectedURL);var J=this._seekHandler.getConfig(O,L);this._requestURL=J.url;var ie=this._xhr=new XMLHttpRequest;if(ie.open("GET",J.url,!0),ie.responseType="moz-chunked-arraybuffer",ie.onreadystatechange=this._onReadyStateChange.bind(this),ie.onprogress=this._onProgress.bind(this),ie.onloadend=this._onLoadEnd.bind(this),ie.onerror=this._onXhrError.bind(this),M.withCredentials&&(ie.withCredentials=!0),typeof J.headers=="object"){var ne=J.headers;for(var se in ne)ne.hasOwnProperty(se)&&ie.setRequestHeader(se,ne[se])}if(typeof this._config.headers=="object"){ne=this._config.headers;for(var se in ne)ne.hasOwnProperty(se)&&ie.setRequestHeader(se,ne[se])}this._status=h.c.kConnecting,ie.send()},I.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=h.c.kComplete},I.prototype._onReadyStateChange=function(M){var L=M.target;if(L.readyState===2){if(L.responseURL!=null&&L.responseURL!==this._requestURL&&this._onURLRedirect){var O=this._seekHandler.removeURLParameters(L.responseURL);this._onURLRedirect(O)}if(L.status!==0&&(L.status<200||L.status>299)){if(this._status=h.c.kError,!this._onError)throw new m.d("MozChunkedLoader: Http code invalid, "+L.status+" "+L.statusText);this._onError(h.b.HTTP_STATUS_CODE_INVALID,{code:L.status,msg:L.statusText})}else this._status=h.c.kBuffering}},I.prototype._onProgress=function(M){if(this._status!==h.c.kError){this._contentLength===null&&M.total!==null&&M.total!==0&&(this._contentLength=M.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var L=M.target.response,O=this._range.from+this._receivedLength;this._receivedLength+=L.byteLength,this._onDataArrival&&this._onDataArrival(L,O,this._receivedLength)}},I.prototype._onLoadEnd=function(M){this._requestAbort!==!0?this._status!==h.c.kError&&(this._status=h.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1},I.prototype._onXhrError=function(M){this._status=h.c.kError;var L=0,O=null;if(this._contentLength&&M.loaded<this._contentLength?(L=h.b.EARLY_EOF,O={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(L=h.b.EXCEPTION,O={code:-1,msg:M.constructor.name+" "+M.type}),!this._onError)throw new m.d(O.msg);this._onError(L,O)},I})(h.a),S=(function(){var B=function(I,M){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,O){L.__proto__=O}||function(L,O){for(var J in O)Object.prototype.hasOwnProperty.call(O,J)&&(L[J]=O[J])})(I,M)};return function(I,M){if(typeof M!="function"&&M!==null)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");function L(){this.constructor=I}B(I,M),I.prototype=M===null?Object.create(M):(L.prototype=M.prototype,new L)}})(),N=((function(B){function I(M,L){var O=B.call(this,"xhr-msstream-loader")||this;return O.TAG="MSStreamLoader",O._seekHandler=M,O._config=L,O._needStash=!0,O._xhr=null,O._reader=null,O._totalRange=null,O._currentRange=null,O._currentRequestURL=null,O._currentRedirectedURL=null,O._contentLength=null,O._receivedLength=0,O._bufferLimit=16777216,O._lastTimeBufferSize=0,O._isReconnecting=!1,O}S(I,B),I.isSupported=function(){try{if(self.MSStream===void 0||self.MSStreamReader===void 0)return!1;var M=new XMLHttpRequest;return M.open("GET","https://example.com",!0),M.responseType="ms-stream",M.responseType==="ms-stream"}catch(L){return c.a.w("MSStreamLoader",L.message),!1}},I.prototype.destroy=function(){this.isWorking()&&this.abort(),this._reader&&(this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr=null),B.prototype.destroy.call(this)},I.prototype.open=function(M,L){this._internalOpen(M,L,!1)},I.prototype._internalOpen=function(M,L,O){this._dataSource=M,O?this._currentRange=L:this._totalRange=L;var J=M.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?J=this._currentRedirectedURL:M.redirectedURL!=null&&(J=M.redirectedURL));var ie=this._seekHandler.getConfig(J,L);this._currentRequestURL=ie.url;var ne=this._reader=new self.MSStreamReader;ne.onprogress=this._msrOnProgress.bind(this),ne.onload=this._msrOnLoad.bind(this),ne.onerror=this._msrOnError.bind(this);var se=this._xhr=new XMLHttpRequest;if(se.open("GET",ie.url,!0),se.responseType="ms-stream",se.onreadystatechange=this._xhrOnReadyStateChange.bind(this),se.onerror=this._xhrOnError.bind(this),M.withCredentials&&(se.withCredentials=!0),typeof ie.headers=="object"){var X=ie.headers;for(var ce in X)X.hasOwnProperty(ce)&&se.setRequestHeader(ce,X[ce])}if(typeof this._config.headers=="object"){X=this._config.headers;for(var ce in X)X.hasOwnProperty(ce)&&se.setRequestHeader(ce,X[ce])}this._isReconnecting?this._isReconnecting=!1:this._status=h.c.kConnecting,se.send()},I.prototype.abort=function(){this._internalAbort(),this._status=h.c.kComplete},I.prototype._internalAbort=function(){this._reader&&(this._reader.readyState===1&&this._reader.abort(),this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.abort(),this._xhr.onreadystatechange=null,this._xhr=null)},I.prototype._xhrOnReadyStateChange=function(M){var L=M.target;if(L.readyState===2)if(L.status>=200&&L.status<=299){if(this._status=h.c.kBuffering,L.responseURL!=null){var O=this._seekHandler.removeURLParameters(L.responseURL);L.responseURL!==this._currentRequestURL&&O!==this._currentRedirectedURL&&(this._currentRedirectedURL=O,this._onURLRedirect&&this._onURLRedirect(O))}var J=L.getResponseHeader("Content-Length");if(J!=null&&this._contentLength==null){var ie=parseInt(J);ie>0&&(this._contentLength=ie,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength))}}else{if(this._status=h.c.kError,!this._onError)throw new m.d("MSStreamLoader: Http code invalid, "+L.status+" "+L.statusText);this._onError(h.b.HTTP_STATUS_CODE_INVALID,{code:L.status,msg:L.statusText})}else if(L.readyState===3&&L.status>=200&&L.status<=299){this._status=h.c.kBuffering;var ne=L.response;this._reader.readAsArrayBuffer(ne)}},I.prototype._xhrOnError=function(M){this._status=h.c.kError;var L=h.b.EXCEPTION,O={code:-1,msg:M.constructor.name+" "+M.type};if(!this._onError)throw new m.d(O.msg);this._onError(L,O)},I.prototype._msrOnProgress=function(M){var L=M.target.result;if(L!=null){var O=L.slice(this._lastTimeBufferSize);this._lastTimeBufferSize=L.byteLength;var J=this._totalRange.from+this._receivedLength;this._receivedLength+=O.byteLength,this._onDataArrival&&this._onDataArrival(O,J,this._receivedLength),L.byteLength>=this._bufferLimit&&(c.a.v(this.TAG,"MSStream buffer exceeded max size near ".concat(J+O.byteLength,", reconnecting...")),this._doReconnectIfNeeded())}else this._doReconnectIfNeeded()},I.prototype._doReconnectIfNeeded=function(){if(this._contentLength==null||this._receivedLength<this._contentLength){this._isReconnecting=!0,this._lastTimeBufferSize=0,this._internalAbort();var M={from:this._totalRange.from+this._receivedLength,to:-1};this._internalOpen(this._dataSource,M,!0)}},I.prototype._msrOnLoad=function(M){this._status=h.c.kComplete,this._onComplete&&this._onComplete(this._totalRange.from,this._totalRange.from+this._receivedLength-1)},I.prototype._msrOnError=function(M){this._status=h.c.kError;var L=0,O=null;if(this._contentLength&&this._receivedLength<this._contentLength?(L=h.b.EARLY_EOF,O={code:-1,msg:"MSStream meet Early-Eof"}):(L=h.b.EARLY_EOF,O={code:-1,msg:M.constructor.name+" "+M.type}),!this._onError)throw new m.d(O.msg);this._onError(L,O)}})(h.a),(function(){var B=function(I,M){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,O){L.__proto__=O}||function(L,O){for(var J in O)Object.prototype.hasOwnProperty.call(O,J)&&(L[J]=O[J])})(I,M)};return function(I,M){if(typeof M!="function"&&M!==null)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");function L(){this.constructor=I}B(I,M),I.prototype=M===null?Object.create(M):(L.prototype=M.prototype,new L)}})()),A=(function(B){function I(M,L){var O=B.call(this,"xhr-range-loader")||this;return O.TAG="RangeLoader",O._seekHandler=M,O._config=L,O._needStash=!1,O._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],O._currentChunkSizeKB=384,O._currentSpeedNormalized=0,O._zeroSpeedChunkCount=0,O._xhr=null,O._speedSampler=new d,O._requestAbort=!1,O._waitForTotalLength=!1,O._totalLengthReceived=!1,O._currentRequestURL=null,O._currentRedirectedURL=null,O._currentRequestRange=null,O._totalLength=null,O._contentLength=null,O._receivedLength=0,O._lastTimeLoaded=0,O}return N(I,B),I.isSupported=function(){try{var M=new XMLHttpRequest;return M.open("GET","https://example.com",!0),M.responseType="arraybuffer",M.responseType==="arraybuffer"}catch(L){return c.a.w("RangeLoader",L.message),!1}},I.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),B.prototype.destroy.call(this)},Object.defineProperty(I.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),I.prototype.open=function(M,L){this._dataSource=M,this._range=L,this._status=h.c.kConnecting;var O=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(O=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||O?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))},I.prototype._openSubRange=function(){var M=1024*this._currentChunkSizeKB,L=this._range.from+this._receivedLength,O=L+M;this._contentLength!=null&&O-this._range.from>=this._contentLength&&(O=this._range.from+this._contentLength-1),this._currentRequestRange={from:L,to:O},this._internalOpen(this._dataSource,this._currentRequestRange)},I.prototype._internalOpen=function(M,L){this._lastTimeLoaded=0;var O=M.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?O=this._currentRedirectedURL:M.redirectedURL!=null&&(O=M.redirectedURL));var J=this._seekHandler.getConfig(O,L);this._currentRequestURL=J.url;var ie=this._xhr=new XMLHttpRequest;if(ie.open("GET",J.url,!0),ie.responseType="arraybuffer",ie.onreadystatechange=this._onReadyStateChange.bind(this),ie.onprogress=this._onProgress.bind(this),ie.onload=this._onLoad.bind(this),ie.onerror=this._onXhrError.bind(this),M.withCredentials&&(ie.withCredentials=!0),typeof J.headers=="object"){var ne=J.headers;for(var se in ne)ne.hasOwnProperty(se)&&ie.setRequestHeader(se,ne[se])}if(typeof this._config.headers=="object"){ne=this._config.headers;for(var se in ne)ne.hasOwnProperty(se)&&ie.setRequestHeader(se,ne[se])}ie.send()},I.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=h.c.kComplete},I.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},I.prototype._onReadyStateChange=function(M){var L=M.target;if(L.readyState===2){if(L.responseURL!=null){var O=this._seekHandler.removeURLParameters(L.responseURL);L.responseURL!==this._currentRequestURL&&O!==this._currentRedirectedURL&&(this._currentRedirectedURL=O,this._onURLRedirect&&this._onURLRedirect(O))}if(L.status>=200&&L.status<=299){if(this._waitForTotalLength)return;this._status=h.c.kBuffering}else{if(this._status=h.c.kError,!this._onError)throw new m.d("RangeLoader: Http code invalid, "+L.status+" "+L.statusText);this._onError(h.b.HTTP_STATUS_CODE_INVALID,{code:L.status,msg:L.statusText})}}},I.prototype._onProgress=function(M){if(this._status!==h.c.kError){if(this._contentLength===null){var L=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,L=!0;var O=M.total;this._internalAbort(),O!=null&O!==0&&(this._totalLength=O)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,L)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var J=M.loaded-this._lastTimeLoaded;this._lastTimeLoaded=M.loaded,this._speedSampler.addBytes(J)}},I.prototype._normalizeSpeed=function(M){var L=this._chunkSizeKBList,O=L.length-1,J=0,ie=0,ne=O;if(M<L[0])return L[0];for(;ie<=ne;){if((J=ie+Math.floor((ne-ie)/2))===O||M>=L[J]&&M<L[J+1])return L[J];L[J]<M?ie=J+1:ne=J-1}},I.prototype._onLoad=function(M){if(this._status!==h.c.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var L=this._speedSampler.lastSecondKBps;if(L===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(L=this._speedSampler.currentKBps)),L!==0){var O=this._normalizeSpeed(L);this._currentSpeedNormalized!==O&&(this._currentSpeedNormalized=O,this._currentChunkSizeKB=O)}var J=M.target.response,ie=this._range.from+this._receivedLength;this._receivedLength+=J.byteLength;var ne=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():ne=!0,this._onDataArrival&&this._onDataArrival(J,ie,this._receivedLength),ne&&(this._status=h.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},I.prototype._onXhrError=function(M){this._status=h.c.kError;var L=0,O=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(L=h.b.EARLY_EOF,O={code:-1,msg:"RangeLoader meet Early-Eof"}):(L=h.b.EXCEPTION,O={code:-1,msg:M.constructor.name+" "+M.type}),!this._onError)throw new m.d(O.msg);this._onError(L,O)},I})(h.a),R=(function(){var B=function(I,M){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,O){L.__proto__=O}||function(L,O){for(var J in O)Object.prototype.hasOwnProperty.call(O,J)&&(L[J]=O[J])})(I,M)};return function(I,M){if(typeof M!="function"&&M!==null)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");function L(){this.constructor=I}B(I,M),I.prototype=M===null?Object.create(M):(L.prototype=M.prototype,new L)}})(),C=(function(B){function I(){var M=B.call(this,"websocket-loader")||this;return M.TAG="WebSocketLoader",M._needStash=!0,M._ws=null,M._requestAbort=!1,M._receivedLength=0,M}return R(I,B),I.isSupported=function(){try{return self.WebSocket!==void 0}catch{return!1}},I.prototype.destroy=function(){this._ws&&this.abort(),B.prototype.destroy.call(this)},I.prototype.open=function(M){try{var L=this._ws=new self.WebSocket(M.url);L.binaryType="arraybuffer",L.onopen=this._onWebSocketOpen.bind(this),L.onclose=this._onWebSocketClose.bind(this),L.onmessage=this._onWebSocketMessage.bind(this),L.onerror=this._onWebSocketError.bind(this),this._status=h.c.kConnecting}catch(J){this._status=h.c.kError;var O={code:J.code,msg:J.message};if(!this._onError)throw new m.d(O.msg);this._onError(h.b.EXCEPTION,O)}},I.prototype.abort=function(){var M=this._ws;!M||M.readyState!==0&&M.readyState!==1||(this._requestAbort=!0,M.close()),this._ws=null,this._status=h.c.kComplete},I.prototype._onWebSocketOpen=function(M){this._status=h.c.kBuffering},I.prototype._onWebSocketClose=function(M){this._requestAbort!==!0?(this._status=h.c.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1},I.prototype._onWebSocketMessage=function(M){var L=this;if(M.data instanceof ArrayBuffer)this._dispatchArrayBuffer(M.data);else if(M.data instanceof Blob){var O=new FileReader;O.onload=function(){L._dispatchArrayBuffer(O.result)},O.readAsArrayBuffer(M.data)}else{this._status=h.c.kError;var J={code:-1,msg:"Unsupported WebSocket message type: "+M.data.constructor.name};if(!this._onError)throw new m.d(J.msg);this._onError(h.b.EXCEPTION,J)}},I.prototype._dispatchArrayBuffer=function(M){var L=M,O=this._receivedLength;this._receivedLength+=L.byteLength,this._onDataArrival&&this._onDataArrival(L,O,this._receivedLength)},I.prototype._onWebSocketError=function(M){this._status=h.c.kError;var L={code:M.code,msg:M.message};if(!this._onError)throw new m.d(L.msg);this._onError(h.b.EXCEPTION,L)},I})(h.a),D=(function(){function B(I){this._zeroStart=I||!1}return B.prototype.getConfig=function(I,M){var L={};if(M.from!==0||M.to!==-1){var O=void 0;O=M.to!==-1?"bytes=".concat(M.from.toString(),"-").concat(M.to.toString()):"bytes=".concat(M.from.toString(),"-"),L.Range=O}else this._zeroStart&&(L.Range="bytes=0-");return{url:I,headers:L}},B.prototype.removeURLParameters=function(I){return I},B})(),V=(function(){function B(I,M){this._startName=I,this._endName=M}return B.prototype.getConfig=function(I,M){var L=I;if(M.from!==0||M.to!==-1){var O=!0;L.indexOf("?")===-1&&(L+="?",O=!1),O&&(L+="&"),L+="".concat(this._startName,"=").concat(M.from.toString()),M.to!==-1&&(L+="&".concat(this._endName,"=").concat(M.to.toString()))}return{url:L,headers:{}}},B.prototype.removeURLParameters=function(I){var M=I.split("?")[0],L=void 0,O=I.indexOf("?");O!==-1&&(L=I.substring(O+1));var J="";if(L!=null&&L.length>0)for(var ie=L.split("&"),ne=0;ne<ie.length;ne++){var se=ie[ne].split("="),X=ne>0;se[0]!==this._startName&&se[0]!==this._endName&&(X&&(J+="&"),J+=ie[ne])}return J.length===0?M:M+"?"+J},B})(),z=(function(){function B(I,M,L){this.TAG="IOController",this._config=M,this._extraData=L,this._stashInitialSize=65536,M.stashInitialSize!=null&&M.stashInitialSize>0&&(this._stashInitialSize=M.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=Math.max(this._stashSize,3145728),this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,M.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=I,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(I.url),this._refTotalLength=I.filesize?I.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new d,this._speedNormalizeList=[32,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return B.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},B.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},B.prototype.isPaused=function(){return this._paused},Object.defineProperty(B.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"extraData",{get:function(){return this._extraData},set:function(I){this._extraData=I},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(I){this._onDataArrival=I},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(I){this._onSeeked=I},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onError",{get:function(){return this._onError},set:function(I){this._onError=I},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onComplete",{get:function(){return this._onComplete},set:function(I){this._onComplete=I},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(I){this._onRedirect=I},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(I){this._onRecoveredEarlyEof=I},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"currentSpeed",{get:function(){return this._loaderClass===A?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),B.prototype._selectSeekHandler=function(){var I=this._config;if(I.seekType==="range")this._seekHandler=new D(this._config.rangeLoadZeroStart);else if(I.seekType==="param"){var M=I.seekParamStart||"bstart",L=I.seekParamEnd||"bend";this._seekHandler=new V(M,L)}else{if(I.seekType!=="custom")throw new m.b("Invalid seekType in config: ".concat(I.seekType));if(typeof I.customSeekHandler!="function")throw new m.b("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new I.customSeekHandler}},B.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=C;else if(x.isSupported())this._loaderClass=x;else if(v.isSupported())this._loaderClass=v;else{if(!A.isSupported())throw new m.d("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=A}},B.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},B.prototype.open=function(I){this._currentRange={from:0,to:-1},I&&(this._currentRange.from=I),this._speedSampler.reset(),I||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},B.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},B.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},B.prototype.resume=function(){if(this._paused){this._paused=!1;var I=this._resumeFrom;this._resumeFrom=0,this._internalSeek(I,!0)}},B.prototype.seek=function(I){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(I,!0)},B.prototype._internalSeek=function(I,M){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(M),this._loader.destroy(),this._loader=null;var L={from:I,to:-1};this._currentRange={from:L.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,L),this._onSeeked&&this._onSeeked()},B.prototype.updateUrl=function(I){if(!I||typeof I!="string"||I.length===0)throw new m.b("Url must be a non-empty string!");this._dataSource.url=I},B.prototype._expandBuffer=function(I){for(var M=this._stashSize;M+1048576<I;)M*=2;if((M+=1048576)!==this._bufferSize){var L=new ArrayBuffer(M);if(this._stashUsed>0){var O=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(L,0,M).set(O,0)}this._stashBuffer=L,this._bufferSize=M}},B.prototype._normalizeSpeed=function(I){var M=this._speedNormalizeList,L=M.length-1,O=0,J=0,ie=L;if(I<M[0])return M[0];for(;J<=ie;){if((O=J+Math.floor((ie-J)/2))===L||I>=M[O]&&I<M[O+1])return M[O];M[O]<I?J=O+1:ie=O-1}},B.prototype._adjustStashSize=function(I){var M=0;(M=this._config.isLive?I/8:I<512?I:I>=512&&I<=1024?Math.floor(1.5*I):2*I)>8192&&(M=8192);var L=1024*M+1048576;this._bufferSize<L&&this._expandBuffer(L),this._stashSize=1024*M},B.prototype._dispatchChunks=function(I,M){return this._currentRange.to=M+I.byteLength-1,this._onDataArrival(I,M)},B.prototype._onURLRedirect=function(I){this._redirectedURL=I,this._onRedirect&&this._onRedirect(I)},B.prototype._onContentLengthKnown=function(I){I&&this._fullRequestFlag&&(this._totalLength=I,this._fullRequestFlag=!1)},B.prototype._onLoaderChunkArrival=function(I,M,L){if(!this._onDataArrival)throw new m.a("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(I.byteLength);var O=this._speedSampler.lastSecondKBps;if(O!==0){var J=this._normalizeSpeed(O);this._speedNormalized!==J&&(this._speedNormalized=J,this._adjustStashSize(J))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=M),this._stashUsed+I.byteLength<=this._stashSize)(se=new Uint8Array(this._stashBuffer,0,this._stashSize)).set(new Uint8Array(I),this._stashUsed),this._stashUsed+=I.byteLength;else if(se=new Uint8Array(this._stashBuffer,0,this._bufferSize),this._stashUsed>0){var ie=this._stashBuffer.slice(0,this._stashUsed);(X=this._dispatchChunks(ie,this._stashByteStart))<ie.byteLength?X>0&&(ce=new Uint8Array(ie,X),se.set(ce,0),this._stashUsed=ce.byteLength,this._stashByteStart+=X):(this._stashUsed=0,this._stashByteStart+=X),this._stashUsed+I.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+I.byteLength),se=new Uint8Array(this._stashBuffer,0,this._bufferSize)),se.set(new Uint8Array(I),this._stashUsed),this._stashUsed+=I.byteLength}else(X=this._dispatchChunks(I,M))<I.byteLength&&((ne=I.byteLength-X)>this._bufferSize&&(this._expandBuffer(ne),se=new Uint8Array(this._stashBuffer,0,this._bufferSize)),se.set(new Uint8Array(I,X),0),this._stashUsed+=ne,this._stashByteStart=M+X);else if(this._stashUsed===0){var ne;(X=this._dispatchChunks(I,M))<I.byteLength&&((ne=I.byteLength-X)>this._bufferSize&&this._expandBuffer(ne),(se=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(I,X),0),this._stashUsed+=ne,this._stashByteStart=M+X)}else{var se,X;if(this._stashUsed+I.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+I.byteLength),(se=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(I),this._stashUsed),this._stashUsed+=I.byteLength,(X=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart))<this._stashUsed&&X>0){var ce=new Uint8Array(this._stashBuffer,X);se.set(ce,0)}this._stashUsed-=X,this._stashByteStart+=X}}},B.prototype._flushStashBuffer=function(I){if(this._stashUsed>0){var M=this._stashBuffer.slice(0,this._stashUsed),L=this._dispatchChunks(M,this._stashByteStart),O=M.byteLength-L;if(L<M.byteLength){if(!I){if(L>0){var J=new Uint8Array(this._stashBuffer,0,this._bufferSize),ie=new Uint8Array(M,L);J.set(ie,0),this._stashUsed=ie.byteLength,this._stashByteStart+=L}return 0}c.a.w(this.TAG,"".concat(O," bytes unconsumed data remain when flush buffer, dropped"))}return this._stashUsed=0,this._stashByteStart=0,O}return 0},B.prototype._onLoaderComplete=function(I,M){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},B.prototype._onLoaderError=function(I,M){switch(c.a.e(this.TAG,"Loader error, code = ".concat(M.code,", msg = ").concat(M.msg)),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,I=h.b.UNRECOVERABLE_EARLY_EOF),I){case h.b.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var L=this._currentRange.to+1;return void(L<this._totalLength&&(c.a.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(L,!1)))}I=h.b.UNRECOVERABLE_EARLY_EOF;break;case h.b.UNRECOVERABLE_EARLY_EOF:case h.b.CONNECTING_TIMEOUT:case h.b.HTTP_STATUS_CODE_INVALID:case h.b.EXCEPTION:}if(!this._onError)throw new m.d("IOException: "+M.msg);this._onError(I,M)},B})();n.a=z},function(t,n,r){var o=(function(){function c(){}return c.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(d,h){return d.__proto__=h,d},Object.assign=Object.assign||function(d){if(d==null)throw new TypeError("Cannot convert undefined or null to object");for(var h=Object(d),u=1;u<arguments.length;u++){var m=arguments[u];if(m!=null)for(var g in m)m.hasOwnProperty(g)&&(h[g]=m[g])}return h},String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(d,h){var u=h>0?0|h:0;return this.substring(u,u+d.length)===d}}),typeof self.Promise!="function"&&r(21).polyfill()},c})();o.install(),n.a=o},function(t,n,r){var o=r(9),c=r.n(o),d=r(0),h=r(5),u=r(7),m=r(3),g=(function(){function x(y){this.TAG="MSEController",this._config=y,this._emitter=new c.a,this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onStartStreaming:this._onStartStreaming.bind(this),onEndStreaming:this._onEndStreaming.bind(this),onQualityChange:this._onQualityChange.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._useManagedMediaSource="ManagedMediaSource"in self&&!("MediaSource"in self),this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElementProxy=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]}}return x.prototype.destroy=function(){this._mediaSource&&this.shutdown(),this._mediaSourceObjectURL&&this.revokeObjectURL(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},x.prototype.on=function(y,v){this._emitter.addListener(y,v)},x.prototype.off=function(y,v){this._emitter.removeListener(y,v)},x.prototype.initialize=function(y){if(this._mediaSource)throw new m.a("MediaSource has been attached to an HTMLMediaElement!");this._useManagedMediaSource&&d.a.v(this.TAG,"Using ManagedMediaSource");var v=this._mediaSource=this._useManagedMediaSource?new self.ManagedMediaSource:new self.MediaSource;v.addEventListener("sourceopen",this.e.onSourceOpen),v.addEventListener("sourceended",this.e.onSourceEnded),v.addEventListener("sourceclose",this.e.onSourceClose),this._useManagedMediaSource&&(v.addEventListener("startstreaming",this.e.onStartStreaming),v.addEventListener("endstreaming",this.e.onEndStreaming),v.addEventListener("qualitychange",this.e.onQualityChange)),this._mediaElementProxy=y},x.prototype.shutdown=function(){if(this._mediaSource){var y=this._mediaSource;for(var v in this._sourceBuffers){var S=this._pendingSegments[v];S.splice(0,S.length),this._pendingSegments[v]=null,this._pendingRemoveRanges[v]=null,this._lastInitSegments[v]=null;var N=this._sourceBuffers[v];if(N){if(y.readyState!=="closed"){try{y.removeSourceBuffer(N)}catch(A){d.a.e(this.TAG,A.message)}N.removeEventListener("error",this.e.onSourceBufferError),N.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[v]=null,this._sourceBuffers[v]=null}}if(y.readyState==="open")try{y.endOfStream()}catch(A){d.a.e(this.TAG,A.message)}this._mediaElementProxy=null,y.removeEventListener("sourceopen",this.e.onSourceOpen),y.removeEventListener("sourceended",this.e.onSourceEnded),y.removeEventListener("sourceclose",this.e.onSourceClose),this._useManagedMediaSource&&(y.removeEventListener("startstreaming",this.e.onStartStreaming),y.removeEventListener("endstreaming",this.e.onEndStreaming),y.removeEventListener("qualitychange",this.e.onQualityChange)),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._mediaSource=null}},x.prototype.isManagedMediaSource=function(){return this._useManagedMediaSource},x.prototype.getObject=function(){if(!this._mediaSource)throw new m.a("MediaSource has not been initialized yet!");return this._mediaSource},x.prototype.getHandle=function(){if(!this._mediaSource)throw new m.a("MediaSource has not been initialized yet!");return this._mediaSource.handle},x.prototype.getObjectURL=function(){if(!this._mediaSource)throw new m.a("MediaSource has not been initialized yet!");return this._mediaSourceObjectURL==null&&(this._mediaSourceObjectURL=URL.createObjectURL(this._mediaSource)),this._mediaSourceObjectURL},x.prototype.revokeObjectURL=function(){this._mediaSourceObjectURL&&(URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},x.prototype.appendInitSegment=function(y,v){if(v===void 0&&(v=void 0),!this._mediaSource||this._mediaSource.readyState!=="open"||this._mediaSource.streaming===!1)return this._pendingSourceBufferInit.push(y),void this._pendingSegments[y.type].push(y);var S=y,N="".concat(S.container);S.codec&&S.codec.length>0&&(S.codec==="opus"&&h.a.safari&&(S.codec="Opus"),N+=";codecs=".concat(S.codec));var A=!1;if(d.a.v(this.TAG,"Received Initialization Segment, mimeType: "+N),this._lastInitSegments[S.type]=S,N!==this._mimeTypes[S.type]){if(this._mimeTypes[S.type])d.a.v(this.TAG,"Notice: ".concat(S.type," mimeType changed, origin: ").concat(this._mimeTypes[S.type],", target: ").concat(N));else{A=!0;try{var R=this._sourceBuffers[S.type]=this._mediaSource.addSourceBuffer(N);R.addEventListener("error",this.e.onSourceBufferError),R.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(C){return d.a.e(this.TAG,C.message),void this._emitter.emit(u.a.ERROR,{code:C.code,msg:C.message})}}this._mimeTypes[S.type]=N}v||this._pendingSegments[S.type].push(S),A||this._sourceBuffers[S.type]&&!this._sourceBuffers[S.type].updating&&this._doAppendSegments(),h.a.safari&&S.container==="audio/mpeg"&&S.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=S.mediaDuration/1e3,this._updateMediaSourceDuration())},x.prototype.appendMediaSegment=function(y){var v=y;this._pendingSegments[v.type].push(v),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var S=this._sourceBuffers[v.type];!S||S.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()},x.prototype.flush=function(){for(var y in this._sourceBuffers)if(this._sourceBuffers[y]){var v=this._sourceBuffers[y];if(this._mediaSource.readyState==="open")try{v.abort()}catch(D){d.a.e(this.TAG,D.message)}var S=this._pendingSegments[y];if(S.splice(0,S.length),this._mediaSource.readyState!=="closed"){for(var N=0;N<v.buffered.length;N++){var A=v.buffered.start(N),R=v.buffered.end(N);this._pendingRemoveRanges[y].push({start:A,end:R})}if(v.updating||this._doRemoveRanges(),h.a.safari){var C=this._lastInitSegments[y];C&&(this._pendingSegments[y].push(C),v.updating||this._doAppendSegments())}}}},x.prototype.endOfStream=function(){var y=this._mediaSource,v=this._sourceBuffers;y&&y.readyState==="open"?v.video&&v.video.updating||v.audio&&v.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,y.endOfStream()):y&&y.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0)},x.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var y=this._mediaElementProxy.getCurrentTime();for(var v in this._sourceBuffers){var S=this._sourceBuffers[v];if(S){var N=S.buffered;if(N.length>=1&&y-N.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},x.prototype._doCleanupSourceBuffer=function(){var y=this._mediaElementProxy.getCurrentTime();for(var v in this._sourceBuffers){var S=this._sourceBuffers[v];if(S){for(var N=S.buffered,A=!1,R=0;R<N.length;R++){var C=N.start(R),D=N.end(R);if(C<=y&&y<D+3){if(y-C>=this._config.autoCleanupMaxBackwardDuration){A=!0;var V=y-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[v].push({start:C,end:V})}}else D<y&&(A=!0,this._pendingRemoveRanges[v].push({start:C,end:D}))}A&&!S.updating&&this._doRemoveRanges()}}},x.prototype._updateMediaSourceDuration=function(){var y=this._sourceBuffers;if(this._mediaElementProxy.getReadyState()!==0&&this._mediaSource.readyState==="open"&&!(y.video&&y.video.updating||y.audio&&y.audio.updating)){var v=this._mediaSource.duration,S=this._pendingMediaDuration;S>0&&(isNaN(v)||S>v)&&(d.a.v(this.TAG,"Update MediaSource duration from ".concat(v," to ").concat(S)),this._mediaSource.duration=S),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},x.prototype._doRemoveRanges=function(){for(var y in this._pendingRemoveRanges)if(this._sourceBuffers[y]&&!this._sourceBuffers[y].updating)for(var v=this._sourceBuffers[y],S=this._pendingRemoveRanges[y];S.length&&!v.updating;){var N=S.shift();v.remove(N.start,N.end)}},x.prototype._doAppendSegments=function(){var y=this._pendingSegments;for(var v in y)if(this._sourceBuffers[v]&&!this._sourceBuffers[v].updating&&this._mediaSource.streaming!==!1&&y[v].length>0){var S=y[v].shift();if(typeof S.timestampOffset=="number"&&isFinite(S.timestampOffset)){var N=this._sourceBuffers[v].timestampOffset,A=S.timestampOffset/1e3;Math.abs(N-A)>.1&&(d.a.v(this.TAG,"Update MPEG audio timestampOffset from ".concat(N," to ").concat(A)),this._sourceBuffers[v].timestampOffset=A),delete S.timestampOffset}if(!S.data||S.data.byteLength===0)continue;try{this._sourceBuffers[v].appendBuffer(S.data),this._isBufferFull=!1}catch(R){this._pendingSegments[v].unshift(S),R.code===22?(this._isBufferFull||this._emitter.emit(u.a.BUFFER_FULL),this._isBufferFull=!0):(d.a.e(this.TAG,R.message),this._emitter.emit(u.a.ERROR,{code:R.code,msg:R.message}))}}},x.prototype._onSourceOpen=function(){if(d.a.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var y=this._pendingSourceBufferInit;y.length;){var v=y.shift();this.appendInitSegment(v,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(u.a.SOURCE_OPEN)},x.prototype._onStartStreaming=function(){d.a.v(this.TAG,"ManagedMediaSource onStartStreaming"),this._emitter.emit(u.a.START_STREAMING)},x.prototype._onEndStreaming=function(){d.a.v(this.TAG,"ManagedMediaSource onEndStreaming"),this._emitter.emit(u.a.END_STREAMING)},x.prototype._onQualityChange=function(){d.a.v(this.TAG,"ManagedMediaSource onQualityChange")},x.prototype._onSourceEnded=function(){d.a.v(this.TAG,"MediaSource onSourceEnded")},x.prototype._onSourceClose=function(){d.a.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose),this._useManagedMediaSource&&(this._mediaSource.removeEventListener("startstreaming",this.e.onStartStreaming),this._mediaSource.removeEventListener("endstreaming",this.e.onEndStreaming),this._mediaSource.removeEventListener("qualitychange",this.e.onQualityChange)))},x.prototype._hasPendingSegments=function(){var y=this._pendingSegments;return y.video.length>0||y.audio.length>0},x.prototype._hasPendingRemoveRanges=function(){var y=this._pendingRemoveRanges;return y.video.length>0||y.audio.length>0},x.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(u.a.UPDATE_END)},x.prototype._onSourceBufferError=function(y){d.a.e(this.TAG,"SourceBuffer Error: ".concat(y))},x})();n.a=g},function(t,n,r){var o=r(9),c=r.n(o),d=r(18),h=r.n(d),u=r(0),m=r(8),g=r(13),x=r(1),y=(r(19),r(12)),v=(function(){function S(N,A){if(this.TAG="Transmuxer",this._emitter=new c.a,A.enableWorker&&typeof Worker<"u")try{this._worker=h()(19),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[N,A]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},m.a.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:m.a.getConfig()})}catch{u.a.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new g.a(N,A)}else this._controller=new g.a(N,A);if(this._controller){var R=this._controller;R.on(x.a.IO_ERROR,this._onIOError.bind(this)),R.on(x.a.DEMUX_ERROR,this._onDemuxError.bind(this)),R.on(x.a.INIT_SEGMENT,this._onInitSegment.bind(this)),R.on(x.a.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),R.on(x.a.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),R.on(x.a.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),R.on(x.a.MEDIA_INFO,this._onMediaInfo.bind(this)),R.on(x.a.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),R.on(x.a.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),R.on(x.a.TIMED_ID3_METADATA_ARRIVED,this._onTimedID3MetadataArrived.bind(this)),R.on(x.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,this._onSynchronousKLVMetadataArrived.bind(this)),R.on(x.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,this._onAsynchronousKLVMetadataArrived.bind(this)),R.on(x.a.SMPTE2038_METADATA_ARRIVED,this._onSMPTE2038MetadataArrived.bind(this)),R.on(x.a.SCTE35_METADATA_ARRIVED,this._onSCTE35MetadataArrived.bind(this)),R.on(x.a.PES_PRIVATE_DATA_DESCRIPTOR,this._onPESPrivateDataDescriptor.bind(this)),R.on(x.a.PES_PRIVATE_DATA_ARRIVED,this._onPESPrivateDataArrived.bind(this)),R.on(x.a.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),R.on(x.a.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return S.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),m.a.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},S.prototype.on=function(N,A){this._emitter.addListener(N,A)},S.prototype.off=function(N,A){this._emitter.removeListener(N,A)},S.prototype.hasWorker=function(){return this._worker!=null},S.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},S.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},S.prototype.seek=function(N){this._worker?this._worker.postMessage({cmd:"seek",param:N}):this._controller.seek(N)},S.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},S.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},S.prototype._onInitSegment=function(N,A){var R=this;Promise.resolve().then((function(){R._emitter.emit(x.a.INIT_SEGMENT,N,A)}))},S.prototype._onMediaSegment=function(N,A){var R=this;Promise.resolve().then((function(){R._emitter.emit(x.a.MEDIA_SEGMENT,N,A)}))},S.prototype._onLoadingComplete=function(){var N=this;Promise.resolve().then((function(){N._emitter.emit(x.a.LOADING_COMPLETE)}))},S.prototype._onRecoveredEarlyEof=function(){var N=this;Promise.resolve().then((function(){N._emitter.emit(x.a.RECOVERED_EARLY_EOF)}))},S.prototype._onMediaInfo=function(N){var A=this;Promise.resolve().then((function(){A._emitter.emit(x.a.MEDIA_INFO,N)}))},S.prototype._onMetaDataArrived=function(N){var A=this;Promise.resolve().then((function(){A._emitter.emit(x.a.METADATA_ARRIVED,N)}))},S.prototype._onScriptDataArrived=function(N){var A=this;Promise.resolve().then((function(){A._emitter.emit(x.a.SCRIPTDATA_ARRIVED,N)}))},S.prototype._onTimedID3MetadataArrived=function(N){var A=this;Promise.resolve().then((function(){A._emitter.emit(x.a.TIMED_ID3_METADATA_ARRIVED,N)}))},S.prototype._onSynchronousKLVMetadataArrived=function(N){var A=this;Promise.resolve().then((function(){A._emitter.emit(x.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,N)}))},S.prototype._onAsynchronousKLVMetadataArrived=function(N){var A=this;Promise.resolve().then((function(){A._emitter.emit(x.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,N)}))},S.prototype._onSMPTE2038MetadataArrived=function(N){var A=this;Promise.resolve().then((function(){A._emitter.emit(x.a.SMPTE2038_METADATA_ARRIVED,N)}))},S.prototype._onSCTE35MetadataArrived=function(N){var A=this;Promise.resolve().then((function(){A._emitter.emit(x.a.SCTE35_METADATA_ARRIVED,N)}))},S.prototype._onPESPrivateDataDescriptor=function(N){var A=this;Promise.resolve().then((function(){A._emitter.emit(x.a.PES_PRIVATE_DATA_DESCRIPTOR,N)}))},S.prototype._onPESPrivateDataArrived=function(N){var A=this;Promise.resolve().then((function(){A._emitter.emit(x.a.PES_PRIVATE_DATA_ARRIVED,N)}))},S.prototype._onStatisticsInfo=function(N){var A=this;Promise.resolve().then((function(){A._emitter.emit(x.a.STATISTICS_INFO,N)}))},S.prototype._onIOError=function(N,A){var R=this;Promise.resolve().then((function(){R._emitter.emit(x.a.IO_ERROR,N,A)}))},S.prototype._onDemuxError=function(N,A){var R=this;Promise.resolve().then((function(){R._emitter.emit(x.a.DEMUX_ERROR,N,A)}))},S.prototype._onRecommendSeekpoint=function(N){var A=this;Promise.resolve().then((function(){A._emitter.emit(x.a.RECOMMEND_SEEKPOINT,N)}))},S.prototype._onLoggingConfigChanged=function(N){this._worker&&this._worker.postMessage({cmd:"logging_config",param:N})},S.prototype._onWorkerMessage=function(N){var A=N.data,R=A.data;if(A.msg==="destroyed"||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(A.msg){case x.a.INIT_SEGMENT:case x.a.MEDIA_SEGMENT:this._emitter.emit(A.msg,R.type,R.data);break;case x.a.LOADING_COMPLETE:case x.a.RECOVERED_EARLY_EOF:this._emitter.emit(A.msg);break;case x.a.MEDIA_INFO:Object.setPrototypeOf(R,y.a.prototype),this._emitter.emit(A.msg,R);break;case x.a.METADATA_ARRIVED:case x.a.SCRIPTDATA_ARRIVED:case x.a.TIMED_ID3_METADATA_ARRIVED:case x.a.SYNCHRONOUS_KLV_METADATA_ARRIVED:case x.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED:case x.a.SMPTE2038_METADATA_ARRIVED:case x.a.SCTE35_METADATA_ARRIVED:case x.a.PES_PRIVATE_DATA_DESCRIPTOR:case x.a.PES_PRIVATE_DATA_ARRIVED:case x.a.STATISTICS_INFO:this._emitter.emit(A.msg,R);break;case x.a.IO_ERROR:case x.a.DEMUX_ERROR:this._emitter.emit(A.msg,R.type,R.info);break;case x.a.RECOMMEND_SEEKPOINT:this._emitter.emit(A.msg,R);break;case"logcat_callback":u.a.emitter.emit("log",R.type,R.logcat)}},S})();n.a=v},function(t,n,r){function o(u){var m={};function g(y){if(m[y])return m[y].exports;var v=m[y]={i:y,l:!1,exports:{}};return u[y].call(v.exports,v,v.exports,g),v.l=!0,v.exports}g.m=u,g.c=m,g.i=function(y){return y},g.d=function(y,v,S){g.o(y,v)||Object.defineProperty(y,v,{configurable:!1,enumerable:!0,get:S})},g.r=function(y){Object.defineProperty(y,"__esModule",{value:!0})},g.n=function(y){var v=y&&y.__esModule?function(){return y.default}:function(){return y};return g.d(v,"a",v),v},g.o=function(y,v){return Object.prototype.hasOwnProperty.call(y,v)},g.p="/",g.oe=function(y){throw console.error(y),y};var x=g(g.s=ENTRY_MODULE);return x.default||x}function c(u){return(u+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function d(u,m,g){var x={};x[g]=[];var y=m.toString(),v=y.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!v)return x;for(var S,N=v[1],A=new RegExp("(\\\\n|\\W)"+c(N)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");S=A.exec(y);)S[3]!=="dll-reference"&&x[g].push(S[3]);for(A=new RegExp("\\("+c(N)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");S=A.exec(y);)u[S[2]]||(x[g].push(S[1]),u[S[2]]=r(S[1]).m),x[S[2]]=x[S[2]]||[],x[S[2]].push(S[4]);for(var R,C=Object.keys(x),D=0;D<C.length;D++)for(var V=0;V<x[C[D]].length;V++)R=x[C[D]][V],isNaN(1*R)||(x[C[D]][V]=1*x[C[D]][V]);return x}function h(u){return Object.keys(u).reduce((function(m,g){return m||u[g].length>0}),!1)}t.exports=function(u,m){m=m||{};var g={main:r.m},x=m.all?{main:Object.keys(g.main)}:(function(A,R){for(var C={main:[R]},D={main:[]},V={main:{}};h(C);)for(var z=Object.keys(C),B=0;B<z.length;B++){var I=z[B],M=C[I].pop();if(V[I]=V[I]||{},!V[I][M]&&A[I][M]){V[I][M]=!0,D[I]=D[I]||[],D[I].push(M);for(var L=d(A,A[I][M],I),O=Object.keys(L),J=0;J<O.length;J++)C[O[J]]=C[O[J]]||[],C[O[J]]=C[O[J]].concat(L[O[J]])}}return D})(g,u),y="";Object.keys(x).filter((function(A){return A!=="main"})).forEach((function(A){for(var R=0;x[A][R];)R++;x[A].push(R),g[A][R]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",y=y+"var "+A+" = ("+o.toString().replace("ENTRY_MODULE",JSON.stringify(R))+")({"+x[A].map((function(C){return JSON.stringify(C)+": "+g[A][C].toString()})).join(",")+`});
`})),y=y+"new (("+o.toString().replace("ENTRY_MODULE",JSON.stringify(u))+")({"+x.main.map((function(A){return JSON.stringify(A)+": "+g.main[A].toString()})).join(",")+"}))(self);";var v=new self.Blob([y],{type:"text/javascript"});if(m.bare)return v;var S=(self.URL||self.webkitURL||self.mozURL||self.msURL).createObjectURL(v),N=new self.Worker(S);return N.objectURL=S,N}},function(t,n,r){r.r(n),r(0);var o=r(8),c=r(15),d=r(13),h=r(1);n.default=function(u){var m=null,g=(function(ne,se){u.postMessage({msg:"logcat_callback",data:{type:ne,logcat:se}})}).bind(this);function x(ne,se){var X={msg:h.a.INIT_SEGMENT,data:{type:ne,data:se}};u.postMessage(X,[se.data])}function y(ne,se){var X={msg:h.a.MEDIA_SEGMENT,data:{type:ne,data:se}};u.postMessage(X,[se.data])}function v(){var ne={msg:h.a.LOADING_COMPLETE};u.postMessage(ne)}function S(){var ne={msg:h.a.RECOVERED_EARLY_EOF};u.postMessage(ne)}function N(ne){var se={msg:h.a.MEDIA_INFO,data:ne};u.postMessage(se)}function A(ne){var se={msg:h.a.METADATA_ARRIVED,data:ne};u.postMessage(se)}function R(ne){var se={msg:h.a.SCRIPTDATA_ARRIVED,data:ne};u.postMessage(se)}function C(ne){var se={msg:h.a.TIMED_ID3_METADATA_ARRIVED,data:ne};u.postMessage(se)}function D(ne){var se={msg:h.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,data:ne};u.postMessage(se)}function V(ne){var se={msg:h.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,data:ne};u.postMessage(se)}function z(ne){var se={msg:h.a.SMPTE2038_METADATA_ARRIVED,data:ne};u.postMessage(se)}function B(ne){var se={msg:h.a.SCTE35_METADATA_ARRIVED,data:ne};u.postMessage(se)}function I(ne){var se={msg:h.a.PES_PRIVATE_DATA_DESCRIPTOR,data:ne};u.postMessage(se)}function M(ne){var se={msg:h.a.PES_PRIVATE_DATA_ARRIVED,data:ne};u.postMessage(se)}function L(ne){var se={msg:h.a.STATISTICS_INFO,data:ne};u.postMessage(se)}function O(ne,se){u.postMessage({msg:h.a.IO_ERROR,data:{type:ne,info:se}})}function J(ne,se){u.postMessage({msg:h.a.DEMUX_ERROR,data:{type:ne,info:se}})}function ie(ne){u.postMessage({msg:h.a.RECOMMEND_SEEKPOINT,data:ne})}c.a.install(),u.addEventListener("message",(function(ne){switch(ne.data.cmd){case"init":(m=new d.a(ne.data.param[0],ne.data.param[1])).on(h.a.IO_ERROR,O.bind(this)),m.on(h.a.DEMUX_ERROR,J.bind(this)),m.on(h.a.INIT_SEGMENT,x.bind(this)),m.on(h.a.MEDIA_SEGMENT,y.bind(this)),m.on(h.a.LOADING_COMPLETE,v.bind(this)),m.on(h.a.RECOVERED_EARLY_EOF,S.bind(this)),m.on(h.a.MEDIA_INFO,N.bind(this)),m.on(h.a.METADATA_ARRIVED,A.bind(this)),m.on(h.a.SCRIPTDATA_ARRIVED,R.bind(this)),m.on(h.a.TIMED_ID3_METADATA_ARRIVED,C.bind(this)),m.on(h.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,D.bind(this)),m.on(h.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,V.bind(this)),m.on(h.a.SMPTE2038_METADATA_ARRIVED,z.bind(this)),m.on(h.a.SCTE35_METADATA_ARRIVED,B.bind(this)),m.on(h.a.PES_PRIVATE_DATA_DESCRIPTOR,I.bind(this)),m.on(h.a.PES_PRIVATE_DATA_ARRIVED,M.bind(this)),m.on(h.a.STATISTICS_INFO,L.bind(this)),m.on(h.a.RECOMMEND_SEEKPOINT,ie.bind(this));break;case"destroy":m&&(m.destroy(),m=null),u.postMessage({msg:"destroyed"});break;case"start":m.start();break;case"stop":m.stop();break;case"seek":m.seek(ne.data.param);break;case"pause":m.pause();break;case"resume":m.resume();break;case"logging_config":var se=ne.data.param;o.a.applyConfig(se),se.enableCallback===!0?o.a.addLogListener(g):o.a.removeLogListener(g)}}))}},function(t,n,r){t.exports=r(25).default},function(t,n,r){(function(o,c){var d;d=function(){function h(ee){return typeof ee=="function"}var u=Array.isArray?Array.isArray:function(ee){return Object.prototype.toString.call(ee)==="[object Array]"},m=0,g=void 0,x=void 0,y=function(ee,re){D[m]=ee,D[m+1]=re,(m+=2)===2&&(x?x(V):L())},v=typeof window<"u"?window:void 0,S=v||{},N=S.MutationObserver||S.WebKitMutationObserver,A=typeof self>"u"&&o!==void 0&&{}.toString.call(o)==="[object process]",R=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function C(){var ee=setTimeout;return function(){return ee(V,1)}}var D=new Array(1e3);function V(){for(var ee=0;ee<m;ee+=2)(0,D[ee])(D[ee+1]),D[ee]=void 0,D[ee+1]=void 0;m=0}var z,B,I,M,L=void 0;function O(ee,re){var je=this,Fe=new this.constructor(ne);Fe[ie]===void 0&&ye(Fe);var We=je._state;if(We){var he=arguments[We-1];y((function(){return Q(We,Fe,he,je._result)}))}else K(je,Fe,ee,re);return Fe}function J(ee){if(ee&&typeof ee=="object"&&ee.constructor===this)return ee;var re=new this(ne);return X(re,ee),re}A?L=function(){return o.nextTick(V)}:N?(B=0,I=new N(V),M=document.createTextNode(""),I.observe(M,{characterData:!0}),L=function(){M.data=B=++B%2}):R?((z=new MessageChannel).port1.onmessage=V,L=function(){return z.port2.postMessage(0)}):L=v===void 0?(function(){try{var ee=Function("return this")().require("vertx");return(g=ee.runOnLoop||ee.runOnContext)!==void 0?function(){g(V)}:C()}catch{return C()}})():C();var ie=Math.random().toString(36).substring(2);function ne(){}function se(ee,re,je){re.constructor===ee.constructor&&je===O&&re.constructor.resolve===J?(function(Fe,We){We._state===1?le(Fe,We._result):We._state===2?Y(Fe,We._result):K(We,void 0,(function(he){return X(Fe,he)}),(function(he){return Y(Fe,he)}))})(ee,re):je===void 0?le(ee,re):h(je)?(function(Fe,We,he){y((function(Ue){var Ge=!1,vt=(function(Ke,ht,Ft,hs){try{Ke.call(ht,Ft,hs)}catch(gs){return gs}})(he,We,(function(Ke){Ge||(Ge=!0,We!==Ke?X(Ue,Ke):le(Ue,Ke))}),(function(Ke){Ge||(Ge=!0,Y(Ue,Ke))}),Ue._label);!Ge&&vt&&(Ge=!0,Y(Ue,vt))}),Fe)})(ee,re,je):le(ee,re)}function X(ee,re){if(ee===re)Y(ee,new TypeError("You cannot resolve a promise with itself"));else if(We=typeof(Fe=re),Fe===null||We!=="object"&&We!=="function")le(ee,re);else{var je=void 0;try{je=re.then}catch(he){return void Y(ee,he)}se(ee,re,je)}var Fe,We}function ce(ee){ee._onerror&&ee._onerror(ee._result),H(ee)}function le(ee,re){ee._state===void 0&&(ee._result=re,ee._state=1,ee._subscribers.length!==0&&y(H,ee))}function Y(ee,re){ee._state===void 0&&(ee._state=2,ee._result=re,y(ce,ee))}function K(ee,re,je,Fe){var We=ee._subscribers,he=We.length;ee._onerror=null,We[he]=re,We[he+1]=je,We[he+2]=Fe,he===0&&ee._state&&y(H,ee)}function H(ee){var re=ee._subscribers,je=ee._state;if(re.length!==0){for(var Fe=void 0,We=void 0,he=ee._result,Ue=0;Ue<re.length;Ue+=3)Fe=re[Ue],We=re[Ue+je],Fe?Q(je,Fe,We,he):We(he);ee._subscribers.length=0}}function Q(ee,re,je,Fe){var We=h(je),he=void 0,Ue=void 0,Ge=!0;if(We){try{he=je(Fe)}catch(vt){Ge=!1,Ue=vt}if(re===he)return void Y(re,new TypeError("A promises callback cannot return that same promise."))}else he=Fe;re._state!==void 0||(We&&Ge?X(re,he):Ge===!1?Y(re,Ue):ee===1?le(re,he):ee===2&&Y(re,he))}var oe=0;function ye(ee){ee[ie]=oe++,ee._state=void 0,ee._result=void 0,ee._subscribers=[]}var xe=(function(){function ee(re,je){this._instanceConstructor=re,this.promise=new re(ne),this.promise[ie]||ye(this.promise),u(je)?(this.length=je.length,this._remaining=je.length,this._result=new Array(this.length),this.length===0?le(this.promise,this._result):(this.length=this.length||0,this._enumerate(je),this._remaining===0&&le(this.promise,this._result))):Y(this.promise,new Error("Array Methods must be provided an Array"))}return ee.prototype._enumerate=function(re){for(var je=0;this._state===void 0&&je<re.length;je++)this._eachEntry(re[je],je)},ee.prototype._eachEntry=function(re,je){var Fe=this._instanceConstructor,We=Fe.resolve;if(We===J){var he=void 0,Ue=void 0,Ge=!1;try{he=re.then}catch(Ke){Ge=!0,Ue=Ke}if(he===O&&re._state!==void 0)this._settledAt(re._state,je,re._result);else if(typeof he!="function")this._remaining--,this._result[je]=re;else if(Fe===pe){var vt=new Fe(ne);Ge?Y(vt,Ue):se(vt,re,he),this._willSettleAt(vt,je)}else this._willSettleAt(new Fe((function(Ke){return Ke(re)})),je)}else this._willSettleAt(We(re),je)},ee.prototype._settledAt=function(re,je,Fe){var We=this.promise;We._state===void 0&&(this._remaining--,re===2?Y(We,Fe):this._result[je]=Fe),this._remaining===0&&le(We,this._result)},ee.prototype._willSettleAt=function(re,je){var Fe=this;K(re,void 0,(function(We){return Fe._settledAt(1,je,We)}),(function(We){return Fe._settledAt(2,je,We)}))},ee})(),pe=(function(){function ee(re){this[ie]=oe++,this._result=this._state=void 0,this._subscribers=[],ne!==re&&(typeof re!="function"&&(function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")})(),this instanceof ee?(function(je,Fe){try{Fe((function(We){X(je,We)}),(function(We){Y(je,We)}))}catch(We){Y(je,We)}})(this,re):(function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")})())}return ee.prototype.catch=function(re){return this.then(null,re)},ee.prototype.finally=function(re){var je=this.constructor;return h(re)?this.then((function(Fe){return je.resolve(re()).then((function(){return Fe}))}),(function(Fe){return je.resolve(re()).then((function(){throw Fe}))})):this.then(re,re)},ee})();return pe.prototype.then=O,pe.all=function(ee){return new xe(this,ee).promise},pe.race=function(ee){var re=this;return u(ee)?new re((function(je,Fe){for(var We=ee.length,he=0;he<We;he++)re.resolve(ee[he]).then(je,Fe)})):new re((function(je,Fe){return Fe(new TypeError("You must pass an array to race."))}))},pe.resolve=J,pe.reject=function(ee){var re=new this(ne);return Y(re,ee),re},pe._setScheduler=function(ee){x=ee},pe._setAsap=function(ee){y=ee},pe._asap=y,pe.polyfill=function(){var ee=void 0;if(c!==void 0)ee=c;else if(typeof self<"u")ee=self;else try{ee=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var re=ee.Promise;if(re){var je=null;try{je=Object.prototype.toString.call(re.resolve())}catch{}if(je==="[object Promise]"&&!re.cast)return}ee.Promise=pe},pe.Promise=pe,pe},t.exports=d()}).call(this,r(22),r(23))},function(t,n){var r,o,c=t.exports={};function d(){throw new Error("setTimeout has not been defined")}function h(){throw new Error("clearTimeout has not been defined")}function u(R){if(r===setTimeout)return setTimeout(R,0);if((r===d||!r)&&setTimeout)return r=setTimeout,setTimeout(R,0);try{return r(R,0)}catch{try{return r.call(null,R,0)}catch{return r.call(this,R,0)}}}(function(){try{r=typeof setTimeout=="function"?setTimeout:d}catch{r=d}try{o=typeof clearTimeout=="function"?clearTimeout:h}catch{o=h}})();var m,g=[],x=!1,y=-1;function v(){x&&m&&(x=!1,m.length?g=m.concat(g):y=-1,g.length&&S())}function S(){if(!x){var R=u(v);x=!0;for(var C=g.length;C;){for(m=g,g=[];++y<C;)m&&m[y].run();y=-1,C=g.length}m=null,x=!1,(function(D){if(o===clearTimeout)return clearTimeout(D);if((o===h||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(D);try{o(D)}catch{try{return o.call(null,D)}catch{return o.call(this,D)}}})(R)}}function N(R,C){this.fun=R,this.array=C}function A(){}c.nextTick=function(R){var C=new Array(arguments.length-1);if(arguments.length>1)for(var D=1;D<arguments.length;D++)C[D-1]=arguments[D];g.push(new N(R,C)),g.length!==1||x||u(S)},N.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=A,c.addListener=A,c.once=A,c.off=A,c.removeListener=A,c.removeAllListeners=A,c.emit=A,c.prependListener=A,c.prependOnceListener=A,c.listeners=function(R){return[]},c.binding=function(R){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(R){throw new Error("process.chdir is not supported")},c.umask=function(){return 0}},function(t,n){var r;r=(function(){return this})();try{r=r||new Function("return this")()}catch{typeof window=="object"&&(r=window)}t.exports=r},function(t,n,r){r.r(n);var o=r(0),c=r(8),d=r(3),h=r(7),u=r(16),m=r(17),g=r(1),x=r(4),y=r(10);n.default=function(v){var S="PlayerEngineWorker",N=(function(Y,K){v.postMessage({msg:"logcat_callback",type:Y,logcat:K})}).bind(void 0),A=null,R=null,C=null,D=null,V=!1,z=!1,B=0,I=0,M=!1;function L(){C&&(C.shutdown(),C.destroy(),C=null)}function O(){if(A==null||R==null)throw new d.a("Worker not initialized");if(D)throw new d.a("Transmuxer has been initialized");z||(!R.deferLoadAfterSourceOpen||V?((D=new m.a(A,R)).on(g.a.INIT_SEGMENT,(function(Y,K){C.appendInitSegment(K)})),D.on(g.a.MEDIA_SEGMENT,(function(Y,K){C.appendMediaSegment(K),v.postMessage({msg:"buffered_position_changed",buffered_position_milliseconds:K.info.endDts})})),D.on(g.a.LOADING_COMPLETE,(function(){C.endOfStream(),v.postMessage({msg:"player_event",event:x.a.LOADING_COMPLETE})})),D.on(g.a.RECOVERED_EARLY_EOF,(function(){v.postMessage({msg:"player_event",event:x.a.RECOVERED_EARLY_EOF})})),D.on(g.a.IO_ERROR,(function(Y,K){v.postMessage({msg:"player_event",event:x.a.ERROR,error_type:y.b.NETWORK_ERROR,error_detail:Y,info:K})})),D.on(g.a.DEMUX_ERROR,(function(Y,K){v.postMessage({msg:"player_event",event:x.a.ERROR,error_type:y.b.MEDIA_ERROR,error_detail:Y,info:K})})),D.on(g.a.MEDIA_INFO,(function(Y){ce(g.a.MEDIA_INFO,Y)})),D.on(g.a.STATISTICS_INFO,(function(Y){ce(g.a.STATISTICS_INFO,Y)})),D.on(g.a.RECOMMEND_SEEKPOINT,(function(Y){(function(K){v.postMessage({msg:"transmuxing_event",event:g.a.RECOMMEND_SEEKPOINT,milliseconds:K})})(Y)})),D.on(g.a.METADATA_ARRIVED,(function(Y){le(x.a.METADATA_ARRIVED,Y)})),D.on(g.a.SCRIPTDATA_ARRIVED,(function(Y){le(x.a.SCRIPTDATA_ARRIVED,Y)})),D.on(g.a.TIMED_ID3_METADATA_ARRIVED,(function(Y){le(x.a.TIMED_ID3_METADATA_ARRIVED,Y)})),D.on(g.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,(function(Y){le(x.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,Y)})),D.on(g.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,(function(Y){le(x.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,Y)})),D.on(g.a.SMPTE2038_METADATA_ARRIVED,(function(Y){le(x.a.SMPTE2038_METADATA_ARRIVED,Y)})),D.on(g.a.SCTE35_METADATA_ARRIVED,(function(Y){le(x.a.SCTE35_METADATA_ARRIVED,Y)})),D.on(g.a.PES_PRIVATE_DATA_DESCRIPTOR,(function(Y){le(x.a.PES_PRIVATE_DATA_DESCRIPTOR,Y)})),D.on(g.a.PES_PRIVATE_DATA_ARRIVED,(function(Y){le(x.a.PES_PRIVATE_DATA_ARRIVED,Y)})),D.open()):z=!0)}function J(){C&&C.flush(),D&&(D.close(),D.destroy(),D=null)}function ie(){V=!0,z&&(z=!1,O())}function ne(){v.postMessage({msg:"mse_event",event:h.a.UPDATE_END})}function se(){o.a.v(S,"MSE SourceBuffer is full, report to main thread"),v.postMessage({msg:"mse_event",event:h.a.BUFFER_FULL})}function X(Y){v.postMessage({msg:"player_event",event:x.a.ERROR,error_type:y.b.MEDIA_ERROR,error_detail:y.b.MEDIA_MSE_ERROR,info:Y})}function ce(Y,K){v.postMessage({msg:"transmuxing_event",event:Y,info:K})}function le(Y,K){v.postMessage({msg:"player_event",event:Y,extraData:K})}v.addEventListener("message",(function(Y){if(!M){var K=Y.data;switch(K.cmd){case"logging_config":var H=K;c.a.applyConfig(H.logging_config),H.logging_config.enableCallback===!0?c.a.addLogListener(N):c.a.removeLogListener(N);break;case"init":A=(H=K).media_data_source,R=H.config;break;case"destroy":(function(){D&&J(),C&&L(),M=!0,v.postMessage({msg:"destroyed"})})();break;case"initialize_mse":(function(){o.a.v(S,"Initializing MediaSource in DedicatedWorker"),(C=new u.a(R)).on(h.a.SOURCE_OPEN,ie.bind(this)),C.on(h.a.UPDATE_END,ne.bind(this)),C.on(h.a.BUFFER_FULL,se.bind(this)),C.on(h.a.ERROR,X.bind(this)),C.initialize({getCurrentTime:function(){return B},getReadyState:function(){return I}});var Q=C.getHandle();v.postMessage({msg:"mse_init",handle:Q},[Q])})();break;case"shutdown_mse":L();break;case"load":O();break;case"unload":J();break;case"unbuffered_seek":H=K,C.flush(),D.seek(H.milliseconds);break;case"timeupdate":B=(H=K).current_time;break;case"readystatechange":I=(H=K).ready_state;break;case"pause_transmuxer":D.pause();break;case"resume_transmuxer":D.resume()}}}))}},function(t,n,r){r.r(n);var o=r(15),c=r(14),d={enableWorker:!1,enableWorkerForMSE:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,liveBufferLatencyChasing:!1,liveBufferLatencyChasingOnPaused:!1,liveBufferLatencyMaxLatency:1.5,liveBufferLatencyMinRemain:.5,liveSync:!1,liveSyncMaxLatency:1.2,liveSyncTargetLatency:.8,liveSyncPlaybackRate:1.2,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function h(){return Object.assign({},d)}var u=(function(){function Y(){}return Y.supportMSEH264Playback=function(){var K=self.MediaSource&&self.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),H=self.ManagedMediaSource&&self.ManagedMediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');return K||H},Y.supportMSEH265Playback=function(){var K=self.MediaSource&&self.MediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"'),H=self.ManagedMediaSource&&self.ManagedMediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"');return K||H},Y.supportNetworkStreamIO=function(){var K=new c.a({},h()),H=K.loaderType;return K.destroy(),H=="fetch-stream-loader"||H=="xhr-moz-chunked-loader"},Y.getNetworkLoaderTypeName=function(){var K=new c.a({},h()),H=K.loaderType;return K.destroy(),H},Y.supportNativeMediaPlayback=function(K){Y.videoElement==null&&(Y.videoElement=window.document.createElement("video"));var H=Y.videoElement.canPlayType(K);return H==="probably"||H=="maybe"},Y.getFeatureList=function(){var K={msePlayback:!1,mseLivePlayback:!1,mseH265Playback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeMP4H265Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return K.msePlayback=Y.supportMSEH264Playback(),K.networkStreamIO=Y.supportNetworkStreamIO(),K.networkLoaderName=Y.getNetworkLoaderTypeName(),K.mseLivePlayback=K.msePlayback&&K.networkStreamIO,K.mseH265Playback=Y.supportMSEH265Playback(),K.nativeMP4H264Playback=Y.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),K.nativeMP4H265Playback=Y.supportNativeMediaPlayback('video/mp4; codecs="hvc1.1.6.L93.B0"'),K.nativeWebmVP8Playback=Y.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),K.nativeWebmVP9Playback=Y.supportNativeMediaPlayback('video/webm; codecs="vp9"'),K},Y})(),m=r(2),g=r(0),x=r(9),y=r.n(x),v=r(16),S=r(4),N=r(17),A=r(7),R=r(10),C=r(3),D=r(1),V=r(5),z=r(11),B=(function(){function Y(K,H,Q){this.TAG="SeekingHandler",this._config=null,this._media_element=null,this._always_seek_keyframe=!1,this._on_unbuffered_seek=null,this._request_set_current_time=!1,this._seek_request_record_clocktime=null,this._idr_sample_list=new z.a,this.e=null,this._config=K,this._media_element=H,this._on_unbuffered_seek=Q,this.e={onMediaSeeking:this._onMediaSeeking.bind(this)};var oe=V.a.chrome&&(V.a.version.major<50||V.a.version.major===50&&V.a.version.build<2661);this._always_seek_keyframe=!!(oe||V.a.msedge||V.a.msie),this._always_seek_keyframe&&(this._config.accurateSeek=!1),this._media_element.addEventListener("seeking",this.e.onMediaSeeking)}return Y.prototype.destroy=function(){this._idr_sample_list.clear(),this._idr_sample_list=null,this._media_element.removeEventListener("seeking",this.e.onMediaSeeking),this._media_element=null,this._on_unbuffered_seek=null},Y.prototype.seek=function(K){var H=this._isPositionBuffered(K),Q=!1;if(K<1&&this._media_element.buffered.length>0){var oe=this._media_element.buffered.start(0);(oe<1&&K<oe||V.a.safari)&&(Q=!0,K=V.a.safari?.1:oe)}if(Q)this.directSeek(K);else if(H)if(this._always_seek_keyframe){var ye=this._getNearestKeyframe(Math.floor(1e3*K));ye!=null&&(K=ye.dts/1e3),this.directSeek(K)}else this.directSeek(K);else this._idr_sample_list.clear(),this._on_unbuffered_seek(Math.floor(1e3*K)),this._config.accurateSeek&&this.directSeek(K)},Y.prototype.directSeek=function(K){this._request_set_current_time=!0,this._media_element.currentTime=K},Y.prototype.appendSyncPoints=function(K){this._idr_sample_list.appendArray(K)},Y.prototype._onMediaSeeking=function(K){if(this._request_set_current_time)this._request_set_current_time=!1;else{var H=this._media_element.currentTime,Q=this._media_element.buffered;if(H<1&&Q.length>0){var oe=Q.start(0);if(oe<1&&H<oe||V.a.safari){var ye=V.a.safari?.1:oe;return void this.directSeek(ye)}}if(this._isPositionBuffered(H)){if(this._always_seek_keyframe){var xe=this._getNearestKeyframe(Math.floor(1e3*H));xe!=null&&(H=xe.dts/1e3,this.directSeek(H))}}else this._seek_request_record_clocktime=Y._getClockTime(),window.setTimeout(this._pollAndApplyUnbufferedSeek.bind(this),50)}},Y.prototype._pollAndApplyUnbufferedSeek=function(){if(this._seek_request_record_clocktime!=null)if(this._seek_request_record_clocktime<=Y._getClockTime()-100){var K=this._media_element.currentTime;this._seek_request_record_clocktime=null,this._isPositionBuffered(K)||(this._idr_sample_list.clear(),this._on_unbuffered_seek(Math.floor(1e3*K)),this._config.accurateSeek&&this.directSeek(K))}else window.setTimeout(this._pollAndApplyUnbufferedSeek.bind(this),50)},Y.prototype._isPositionBuffered=function(K){for(var H=this._media_element.buffered,Q=0;Q<H.length;Q++){var oe=H.start(Q),ye=H.end(Q);if(K>=oe&&K<ye)return!0}return!1},Y.prototype._getNearestKeyframe=function(K){return this._idr_sample_list.getLastSyncPointBeforeDts(K)},Y._getClockTime=function(){return self.performance&&self.performance.now?self.performance.now():Date.now()},Y})(),I=(function(){function Y(K,H,Q,oe){this.TAG="LoadingController",this._config=null,this._media_element=null,this._on_pause_transmuxer=null,this._on_resume_transmuxer=null,this._paused=!1,this.e=null,this._config=K,this._media_element=H,this._on_pause_transmuxer=Q,this._on_resume_transmuxer=oe,this.e={onMediaTimeUpdate:this._onMediaTimeUpdate.bind(this)}}return Y.prototype.destroy=function(){this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate),this.e=null,this._media_element=null,this._config=null,this._on_pause_transmuxer=null,this._on_resume_transmuxer=null},Y.prototype.notifyBufferedPositionChanged=function(K){!this._config.isLive&&this._config.lazyLoad&&(K==null?this._suspendTransmuxerIfNeeded():this._suspendTransmuxerIfBufferedPositionExceeded(K))},Y.prototype._onMediaTimeUpdate=function(K){this._paused&&this._resumeTransmuxerIfNeeded()},Y.prototype._suspendTransmuxerIfNeeded=function(){for(var K=this._media_element.buffered,H=this._media_element.currentTime,Q=0,oe=0;oe<K.length;oe++){var ye=K.start(oe),xe=K.end(oe);if(ye<=H&&H<xe){Q=xe;break}}Q>0&&this._suspendTransmuxerIfBufferedPositionExceeded(Q)},Y.prototype._suspendTransmuxerIfBufferedPositionExceeded=function(K){K>=this._media_element.currentTime+this._config.lazyLoadMaxDuration&&!this._paused&&(g.a.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this.suspendTransmuxer(),this._media_element.addEventListener("timeupdate",this.e.onMediaTimeUpdate))},Y.prototype.suspendTransmuxer=function(){this._paused=!0,this._on_pause_transmuxer()},Y.prototype._resumeTransmuxerIfNeeded=function(){for(var K=this._media_element.buffered,H=this._media_element.currentTime,Q=this._config.lazyLoadRecoverDuration,oe=!1,ye=0;ye<K.length;ye++){var xe=K.start(ye),pe=K.end(ye);if(H>=xe&&H<pe){H>=pe-Q&&(oe=!0);break}}oe&&(g.a.v(this.TAG,"Continue loading from paused position"),this.resumeTransmuxer(),this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate))},Y.prototype.resumeTransmuxer=function(){this._paused=!1,this._on_resume_transmuxer()},Y})(),M=(function(){function Y(K,H){this.TAG="StartupStallJumper",this._media_element=null,this._on_direct_seek=null,this._canplay_received=!1,this.e=null,this._media_element=K,this._on_direct_seek=H,this.e={onMediaCanPlay:this._onMediaCanPlay.bind(this),onMediaStalled:this._onMediaStalled.bind(this),onMediaProgress:this._onMediaProgress.bind(this)},this._media_element.addEventListener("canplay",this.e.onMediaCanPlay),this._media_element.addEventListener("stalled",this.e.onMediaStalled),this._media_element.addEventListener("progress",this.e.onMediaProgress)}return Y.prototype.destroy=function(){this._media_element.removeEventListener("canplay",this.e.onMediaCanPlay),this._media_element.removeEventListener("stalled",this.e.onMediaStalled),this._media_element.removeEventListener("progress",this.e.onMediaProgress),this._media_element=null,this._on_direct_seek=null},Y.prototype._onMediaCanPlay=function(K){this._canplay_received=!0,this._media_element.removeEventListener("canplay",this.e.onMediaCanPlay)},Y.prototype._onMediaStalled=function(K){this._detectAndFixStuckPlayback(!0)},Y.prototype._onMediaProgress=function(K){this._detectAndFixStuckPlayback()},Y.prototype._detectAndFixStuckPlayback=function(K){var H=this._media_element,Q=H.buffered;K||!this._canplay_received||H.readyState<2?Q.length>0&&H.currentTime<Q.start(0)&&(g.a.w(this.TAG,"Playback seems stuck at ".concat(H.currentTime,", seek to ").concat(Q.start(0))),this._on_direct_seek(Q.start(0)),this._media_element.removeEventListener("progress",this.e.onMediaProgress)):this._media_element.removeEventListener("progress",this.e.onMediaProgress)},Y})(),L=(function(){function Y(K,H,Q){this._config=null,this._media_element=null,this._on_direct_seek=null,this._config=K,this._media_element=H,this._on_direct_seek=Q}return Y.prototype.destroy=function(){this._on_direct_seek=null,this._media_element=null,this._config=null},Y.prototype.notifyBufferedRangeUpdate=function(){this._chaseLiveLatency()},Y.prototype._chaseLiveLatency=function(){var K=this._media_element.buffered,H=this._media_element.currentTime,Q=this._media_element.paused;if(this._config.isLive&&this._config.liveBufferLatencyChasing&&K.length!=0&&(this._config.liveBufferLatencyChasingOnPaused||!Q)){var oe=K.end(K.length-1);if(oe>this._config.liveBufferLatencyMaxLatency&&oe-H>this._config.liveBufferLatencyMaxLatency){var ye=oe-this._config.liveBufferLatencyMinRemain;this._on_direct_seek(ye)}}},Y})(),O=(function(){function Y(K,H){this._config=null,this._media_element=null,this.e=null,this._config=K,this._media_element=H,this.e={onMediaTimeUpdate:this._onMediaTimeUpdate.bind(this)},this._media_element.addEventListener("timeupdate",this.e.onMediaTimeUpdate)}return Y.prototype.destroy=function(){this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate),this._media_element=null,this._config=null},Y.prototype._onMediaTimeUpdate=function(K){if(this._config.isLive&&this._config.liveSync){var H=this._getCurrentLatency();if(H>this._config.liveSyncMaxLatency){var Q=Math.min(2,Math.max(1,this._config.liveSyncPlaybackRate));this._media_element.playbackRate=Q}else H>this._config.liveSyncTargetLatency||this._media_element.playbackRate!==1&&this._media_element.playbackRate!==0&&(this._media_element.playbackRate=1)}},Y.prototype._getCurrentLatency=function(){if(!this._media_element)return 0;var K=this._media_element.buffered,H=this._media_element.currentTime;return K.length==0?0:K.end(K.length-1)-H},Y})(),J=(function(){function Y(K,H){this.TAG="PlayerEngineMainThread",this._emitter=new x,this._media_element=null,this._mse_controller=null,this._transmuxer=null,this._pending_seek_time=null,this._seeking_handler=null,this._loading_controller=null,this._startup_stall_jumper=null,this._live_latency_chaser=null,this._live_latency_synchronizer=null,this._mse_source_opened=!1,this._has_pending_load=!1,this._loaded_metadata_received=!1,this._media_info=null,this._statistics_info=null,this.e=null,this._media_data_source=K,this._config=h(),typeof H=="object"&&Object.assign(this._config,H),K.isLive===!0&&(this._config.isLive=!0),this.e={onMediaLoadedMetadata:this._onMediaLoadedMetadata.bind(this)}}return Y.prototype.destroy=function(){this._emitter.emit(S.a.DESTROYING),this._transmuxer&&this.unload(),this._media_element&&this.detachMediaElement(),this.e=null,this._media_data_source=null,this._emitter.removeAllListeners(),this._emitter=null},Y.prototype.on=function(K,H){var Q=this;this._emitter.addListener(K,H),K===S.a.MEDIA_INFO&&this._media_info?Promise.resolve().then((function(){return Q._emitter.emit(S.a.MEDIA_INFO,Q.mediaInfo)})):K==S.a.STATISTICS_INFO&&this._statistics_info&&Promise.resolve().then((function(){return Q._emitter.emit(S.a.STATISTICS_INFO,Q.statisticsInfo)}))},Y.prototype.off=function(K,H){this._emitter.removeListener(K,H)},Y.prototype.attachMediaElement=function(K){var H=this;this._media_element=K,K.src="",K.removeAttribute("src"),K.srcObject=null,K.load(),K.addEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._mse_controller=new v.a(this._config),this._mse_controller.on(A.a.UPDATE_END,this._onMSEUpdateEnd.bind(this)),this._mse_controller.on(A.a.BUFFER_FULL,this._onMSEBufferFull.bind(this)),this._mse_controller.on(A.a.SOURCE_OPEN,this._onMSESourceOpen.bind(this)),this._mse_controller.on(A.a.ERROR,this._onMSEError.bind(this)),this._mse_controller.on(A.a.START_STREAMING,this._onMSEStartStreaming.bind(this)),this._mse_controller.on(A.a.END_STREAMING,this._onMSEEndStreaming.bind(this)),this._mse_controller.initialize({getCurrentTime:function(){return H._media_element.currentTime},getReadyState:function(){return H._media_element.readyState}}),this._mse_controller.isManagedMediaSource()?(K.disableRemotePlayback=!0,K.srcObject=this._mse_controller.getObject()):K.src=this._mse_controller.getObjectURL()},Y.prototype.detachMediaElement=function(){this._media_element&&(this._mse_controller.shutdown(),this._media_element.removeEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._media_element.src="",this._media_element.removeAttribute("src"),this._media_element.srcObject=null,this._media_element.load(),this._media_element=null,this._mse_controller.revokeObjectURL()),this._mse_controller&&(this._mse_controller.destroy(),this._mse_controller=null)},Y.prototype.load=function(){var K=this;if(!this._media_element)throw new C.a("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new C.a("load() has been called, please call unload() first!");this._has_pending_load||(!this._config.deferLoadAfterSourceOpen||this._mse_source_opened?(this._transmuxer=new N.a(this._media_data_source,this._config),this._transmuxer.on(D.a.INIT_SEGMENT,(function(H,Q){K._mse_controller.appendInitSegment(Q)})),this._transmuxer.on(D.a.MEDIA_SEGMENT,(function(H,Q){K._mse_controller.appendMediaSegment(Q),!K._config.isLive&&H==="video"&&Q.data&&Q.data.byteLength>0&&"info"in Q&&K._seeking_handler.appendSyncPoints(Q.info.syncPoints),K._loading_controller.notifyBufferedPositionChanged(Q.info.endDts/1e3)})),this._transmuxer.on(D.a.LOADING_COMPLETE,(function(){K._mse_controller.endOfStream(),K._emitter.emit(S.a.LOADING_COMPLETE)})),this._transmuxer.on(D.a.RECOVERED_EARLY_EOF,(function(){K._emitter.emit(S.a.RECOVERED_EARLY_EOF)})),this._transmuxer.on(D.a.IO_ERROR,(function(H,Q){K._emitter.emit(S.a.ERROR,R.b.NETWORK_ERROR,H,Q)})),this._transmuxer.on(D.a.DEMUX_ERROR,(function(H,Q){K._emitter.emit(S.a.ERROR,R.b.MEDIA_ERROR,H,Q)})),this._transmuxer.on(D.a.MEDIA_INFO,(function(H){K._media_info=H,K._emitter.emit(S.a.MEDIA_INFO,Object.assign({},H))})),this._transmuxer.on(D.a.STATISTICS_INFO,(function(H){K._statistics_info=K._fillStatisticsInfo(H),K._emitter.emit(S.a.STATISTICS_INFO,Object.assign({},H))})),this._transmuxer.on(D.a.RECOMMEND_SEEKPOINT,(function(H){K._media_element&&!K._config.accurateSeek&&K._seeking_handler.directSeek(H/1e3)})),this._transmuxer.on(D.a.METADATA_ARRIVED,(function(H){K._emitter.emit(S.a.METADATA_ARRIVED,H)})),this._transmuxer.on(D.a.SCRIPTDATA_ARRIVED,(function(H){K._emitter.emit(S.a.SCRIPTDATA_ARRIVED,H)})),this._transmuxer.on(D.a.TIMED_ID3_METADATA_ARRIVED,(function(H){K._emitter.emit(S.a.TIMED_ID3_METADATA_ARRIVED,H)})),this._transmuxer.on(D.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,(function(H){K._emitter.emit(S.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,H)})),this._transmuxer.on(D.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,(function(H){K._emitter.emit(S.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,H)})),this._transmuxer.on(D.a.SMPTE2038_METADATA_ARRIVED,(function(H){K._emitter.emit(S.a.SMPTE2038_METADATA_ARRIVED,H)})),this._transmuxer.on(D.a.SCTE35_METADATA_ARRIVED,(function(H){K._emitter.emit(S.a.SCTE35_METADATA_ARRIVED,H)})),this._transmuxer.on(D.a.PES_PRIVATE_DATA_DESCRIPTOR,(function(H){K._emitter.emit(S.a.PES_PRIVATE_DATA_DESCRIPTOR,H)})),this._transmuxer.on(D.a.PES_PRIVATE_DATA_ARRIVED,(function(H){K._emitter.emit(S.a.PES_PRIVATE_DATA_ARRIVED,H)})),this._seeking_handler=new B(this._config,this._media_element,this._onRequiredUnbufferedSeek.bind(this)),this._loading_controller=new I(this._config,this._media_element,this._onRequestPauseTransmuxer.bind(this),this._onRequestResumeTransmuxer.bind(this)),this._startup_stall_jumper=new M(this._media_element,this._onRequestDirectSeek.bind(this)),this._config.isLive&&this._config.liveBufferLatencyChasing&&(this._live_latency_chaser=new L(this._config,this._media_element,this._onRequestDirectSeek.bind(this))),this._config.isLive&&this._config.liveSync&&(this._live_latency_synchronizer=new O(this._config,this._media_element)),this._media_element.readyState>0&&this._seeking_handler.directSeek(0),this._transmuxer.open()):this._has_pending_load=!0)},Y.prototype.unload=function(){var K,H,Q,oe,ye,xe,pe,ee,re;(K=this._media_element)===null||K===void 0||K.pause(),(H=this._live_latency_synchronizer)===null||H===void 0||H.destroy(),this._live_latency_synchronizer=null,(Q=this._live_latency_chaser)===null||Q===void 0||Q.destroy(),this._live_latency_chaser=null,(oe=this._startup_stall_jumper)===null||oe===void 0||oe.destroy(),this._startup_stall_jumper=null,(ye=this._loading_controller)===null||ye===void 0||ye.destroy(),this._loading_controller=null,(xe=this._seeking_handler)===null||xe===void 0||xe.destroy(),this._seeking_handler=null,(pe=this._mse_controller)===null||pe===void 0||pe.flush(),(ee=this._transmuxer)===null||ee===void 0||ee.close(),(re=this._transmuxer)===null||re===void 0||re.destroy(),this._transmuxer=null},Y.prototype.play=function(){return this._media_element.play()},Y.prototype.pause=function(){this._media_element.pause()},Y.prototype.seek=function(K){this._media_element&&this._seeking_handler?this._seeking_handler.seek(K):this._pending_seek_time=K},Object.defineProperty(Y.prototype,"mediaInfo",{get:function(){return Object.assign({},this._media_info)},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"statisticsInfo",{get:function(){return Object.assign({},this._statistics_info)},enumerable:!1,configurable:!0}),Y.prototype._onMSESourceOpen=function(){this._mse_source_opened=!0,this._has_pending_load&&(this._has_pending_load=!1,this.load())},Y.prototype._onMSEUpdateEnd=function(){this._config.isLive&&this._config.liveBufferLatencyChasing&&this._live_latency_chaser&&this._live_latency_chaser.notifyBufferedRangeUpdate(),this._loading_controller.notifyBufferedPositionChanged()},Y.prototype._onMSEBufferFull=function(){g.a.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._loading_controller.suspendTransmuxer()},Y.prototype._onMSEError=function(K){this._emitter.emit(S.a.ERROR,R.b.MEDIA_ERROR,R.a.MEDIA_MSE_ERROR,K)},Y.prototype._onMSEStartStreaming=function(){this._loaded_metadata_received&&(this._config.isLive||(g.a.v(this.TAG,"Resume transmuxing task due to ManagedMediaSource onStartStreaming"),this._loading_controller.resumeTransmuxer()))},Y.prototype._onMSEEndStreaming=function(){this._config.isLive||(g.a.v(this.TAG,"Suspend transmuxing task due to ManagedMediaSource onEndStreaming"),this._loading_controller.suspendTransmuxer())},Y.prototype._onMediaLoadedMetadata=function(K){this._loaded_metadata_received=!0,this._pending_seek_time!=null&&(this._seeking_handler.seek(this._pending_seek_time),this._pending_seek_time=null)},Y.prototype._onRequestDirectSeek=function(K){this._seeking_handler.directSeek(K)},Y.prototype._onRequiredUnbufferedSeek=function(K){this._mse_controller.flush(),this._transmuxer.seek(K)},Y.prototype._onRequestPauseTransmuxer=function(){this._transmuxer.pause()},Y.prototype._onRequestResumeTransmuxer=function(){this._transmuxer.resume()},Y.prototype._fillStatisticsInfo=function(K){if(K.playerType="MSEPlayer",!(this._media_element instanceof HTMLVideoElement))return K;var H=!0,Q=0,oe=0;if(this._media_element.getVideoPlaybackQuality){var ye=this._media_element.getVideoPlaybackQuality();Q=ye.totalVideoFrames,oe=ye.droppedVideoFrames}else this._media_element.webkitDecodedFrameCount!=null?(Q=this._media_element.webkitDecodedFrameCount,oe=this._media_element.webkitDroppedFrameCount):H=!1;return H&&(K.decodedFrames=Q,K.droppedFrames=oe),K},Y})(),ie=r(18),ne=r(8),se=(function(){function Y(K,H){this.TAG="PlayerEngineDedicatedThread",this._emitter=new x,this._media_element=null,this._worker_destroying=!1,this._seeking_handler=null,this._loading_controller=null,this._startup_stall_jumper=null,this._live_latency_chaser=null,this._live_latency_synchronizer=null,this._pending_seek_time=null,this._media_info=null,this._statistics_info=null,this.e=null,this._media_data_source=K,this._config=h(),typeof H=="object"&&Object.assign(this._config,H),K.isLive===!0&&(this._config.isLive=!0),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this),onMediaLoadedMetadata:this._onMediaLoadedMetadata.bind(this),onMediaTimeUpdate:this._onMediaTimeUpdate.bind(this),onMediaReadyStateChanged:this._onMediaReadyStateChange.bind(this)},ne.a.registerListener(this.e.onLoggingConfigChanged),this._worker=ie(24,{all:!0}),this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",media_data_source:this._media_data_source,config:this._config}),this._worker.postMessage({cmd:"logging_config",logging_config:ne.a.getConfig()})}return Y.isSupported=function(){return!!self.Worker&&(!(!self.MediaSource||!("canConstructInDedicatedWorker"in self.MediaSource)||self.MediaSource.canConstructInDedicatedWorker!==!0)||!(!self.ManagedMediaSource||!("canConstructInDedicatedWorker"in self.ManagedMediaSource)||self.ManagedMediaSource.canConstructInDedicatedWorker!==!0))},Y.prototype.destroy=function(){this._emitter.emit(S.a.DESTROYING),this.unload(),this.detachMediaElement(),this._worker_destroying=!0,this._worker.postMessage({cmd:"destroy"}),ne.a.removeListener(this.e.onLoggingConfigChanged),this.e=null,this._media_data_source=null,this._emitter.removeAllListeners(),this._emitter=null},Y.prototype.on=function(K,H){var Q=this;this._emitter.addListener(K,H),K===S.a.MEDIA_INFO&&this._media_info?Promise.resolve().then((function(){return Q._emitter.emit(S.a.MEDIA_INFO,Q.mediaInfo)})):K==S.a.STATISTICS_INFO&&this._statistics_info&&Promise.resolve().then((function(){return Q._emitter.emit(S.a.STATISTICS_INFO,Q.statisticsInfo)}))},Y.prototype.off=function(K,H){this._emitter.removeListener(K,H)},Y.prototype.attachMediaElement=function(K){this._media_element=K,this._media_element.src="",this._media_element.removeAttribute("src"),this._media_element.srcObject=null,this._media_element.load(),this._media_element.addEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._media_element.addEventListener("timeupdate",this.e.onMediaTimeUpdate),this._media_element.addEventListener("readystatechange",this.e.onMediaReadyStateChanged),this._worker.postMessage({cmd:"initialize_mse"})},Y.prototype.detachMediaElement=function(){this._worker.postMessage({cmd:"shutdown_mse"}),this._media_element&&(this._media_element.removeEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate),this._media_element.removeEventListener("readystatechange",this.e.onMediaReadyStateChanged),this._media_element.src="",this._media_element.removeAttribute("src"),this._media_element.srcObject=null,this._media_element.load(),this._media_element=null)},Y.prototype.load=function(){this._worker.postMessage({cmd:"load"}),this._seeking_handler=new B(this._config,this._media_element,this._onRequiredUnbufferedSeek.bind(this)),this._loading_controller=new I(this._config,this._media_element,this._onRequestPauseTransmuxer.bind(this),this._onRequestResumeTransmuxer.bind(this)),this._startup_stall_jumper=new M(this._media_element,this._onRequestDirectSeek.bind(this)),this._config.isLive&&this._config.liveBufferLatencyChasing&&(this._live_latency_chaser=new L(this._config,this._media_element,this._onRequestDirectSeek.bind(this))),this._config.isLive&&this._config.liveSync&&(this._live_latency_synchronizer=new O(this._config,this._media_element)),this._media_element.readyState>0&&this._seeking_handler.directSeek(0)},Y.prototype.unload=function(){var K,H,Q,oe,ye,xe;(K=this._media_element)===null||K===void 0||K.pause(),this._worker.postMessage({cmd:"unload"}),(H=this._live_latency_synchronizer)===null||H===void 0||H.destroy(),this._live_latency_synchronizer=null,(Q=this._live_latency_chaser)===null||Q===void 0||Q.destroy(),this._live_latency_chaser=null,(oe=this._startup_stall_jumper)===null||oe===void 0||oe.destroy(),this._startup_stall_jumper=null,(ye=this._loading_controller)===null||ye===void 0||ye.destroy(),this._loading_controller=null,(xe=this._seeking_handler)===null||xe===void 0||xe.destroy(),this._seeking_handler=null},Y.prototype.play=function(){return this._media_element.play()},Y.prototype.pause=function(){this._media_element.pause()},Y.prototype.seek=function(K){this._media_element&&this._seeking_handler?this._seeking_handler.seek(K):this._pending_seek_time=K},Object.defineProperty(Y.prototype,"mediaInfo",{get:function(){return Object.assign({},this._media_info)},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"statisticsInfo",{get:function(){return Object.assign({},this._statistics_info)},enumerable:!1,configurable:!0}),Y.prototype._onLoggingConfigChanged=function(K){var H;(H=this._worker)===null||H===void 0||H.postMessage({cmd:"logging_config",logging_config:K})},Y.prototype._onMSEUpdateEnd=function(){this._config.isLive&&this._config.liveBufferLatencyChasing&&this._live_latency_chaser&&this._live_latency_chaser.notifyBufferedRangeUpdate(),this._loading_controller.notifyBufferedPositionChanged()},Y.prototype._onMSEBufferFull=function(){g.a.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._loading_controller.suspendTransmuxer()},Y.prototype._onMediaLoadedMetadata=function(K){this._pending_seek_time!=null&&(this._seeking_handler.seek(this._pending_seek_time),this._pending_seek_time=null)},Y.prototype._onRequestDirectSeek=function(K){this._seeking_handler.directSeek(K)},Y.prototype._onRequiredUnbufferedSeek=function(K){this._worker.postMessage({cmd:"unbuffered_seek",milliseconds:K})},Y.prototype._onRequestPauseTransmuxer=function(){this._worker.postMessage({cmd:"pause_transmuxer"})},Y.prototype._onRequestResumeTransmuxer=function(){this._worker.postMessage({cmd:"resume_transmuxer"})},Y.prototype._onMediaTimeUpdate=function(K){this._worker.postMessage({cmd:"timeupdate",current_time:K.target.currentTime})},Y.prototype._onMediaReadyStateChange=function(K){this._worker.postMessage({cmd:"readystatechange",ready_state:K.target.readyState})},Y.prototype._onWorkerMessage=function(K){var H,Q=K.data,oe=Q.msg;if(oe=="destroyed"||this._worker_destroying)return this._worker_destroying=!1,(H=this._worker)===null||H===void 0||H.terminate(),void(this._worker=null);switch(oe){case"mse_init":var ye=Q;"ManagedMediaSource"in self&&!("MediaSource"in self)&&(this._media_element.disableRemotePlayback=!0),this._media_element.srcObject=ye.handle;break;case"mse_event":(ye=Q).event==A.a.UPDATE_END?this._onMSEUpdateEnd():ye.event==A.a.BUFFER_FULL&&this._onMSEBufferFull();break;case"transmuxing_event":if((ye=Q).event==D.a.MEDIA_INFO){var xe=Q;this._media_info=xe.info,this._emitter.emit(S.a.MEDIA_INFO,Object.assign({},xe.info))}else if(ye.event==D.a.STATISTICS_INFO){var pe=Q;this._statistics_info=this._fillStatisticsInfo(pe.info),this._emitter.emit(S.a.STATISTICS_INFO,Object.assign({},pe.info))}else if(ye.event==D.a.RECOMMEND_SEEKPOINT){var ee=Q;this._media_element&&!this._config.accurateSeek&&this._seeking_handler.directSeek(ee.milliseconds/1e3)}break;case"player_event":if((ye=Q).event==S.a.ERROR){var re=Q;this._emitter.emit(S.a.ERROR,re.error_type,re.error_detail,re.info)}else if("extraData"in ye){var je=Q;this._emitter.emit(je.event,je.extraData)}break;case"logcat_callback":ye=Q,g.a.emitter.emit("log",ye.type,ye.logcat);break;case"buffered_position_changed":ye=Q,this._loading_controller.notifyBufferedPositionChanged(ye.buffered_position_milliseconds/1e3)}},Y.prototype._fillStatisticsInfo=function(K){if(K.playerType="MSEPlayer",!(this._media_element instanceof HTMLVideoElement))return K;var H=!0,Q=0,oe=0;if(this._media_element.getVideoPlaybackQuality){var ye=this._media_element.getVideoPlaybackQuality();Q=ye.totalVideoFrames,oe=ye.droppedVideoFrames}else this._media_element.webkitDecodedFrameCount!=null?(Q=this._media_element.webkitDecodedFrameCount,oe=this._media_element.webkitDroppedFrameCount):H=!1;return H&&(K.decodedFrames=Q,K.droppedFrames=oe),K},Y})(),X=(function(){function Y(K,H){this.TAG="MSEPlayer",this._type="MSEPlayer",this._media_element=null,this._player_engine=null;var Q=K.type.toLowerCase();if(Q!=="mse"&&Q!=="mpegts"&&Q!=="m2ts"&&Q!=="flv")throw new C.b("MSEPlayer requires an mpegts/m2ts/flv MediaDataSource input!");if(H&&H.enableWorkerForMSE&&se.isSupported())try{this._player_engine=new se(K,H)}catch{g.a.e(this.TAG,"Error while initializing PlayerEngineDedicatedThread, fallback to PlayerEngineMainThread"),this._player_engine=new J(K,H)}else this._player_engine=new J(K,H)}return Y.prototype.destroy=function(){this._player_engine.destroy(),this._player_engine=null,this._media_element=null},Y.prototype.on=function(K,H){this._player_engine.on(K,H)},Y.prototype.off=function(K,H){this._player_engine.off(K,H)},Y.prototype.attachMediaElement=function(K){this._media_element=K,this._player_engine.attachMediaElement(K)},Y.prototype.detachMediaElement=function(){this._media_element=null,this._player_engine.detachMediaElement()},Y.prototype.load=function(){this._player_engine.load()},Y.prototype.unload=function(){this._player_engine.unload()},Y.prototype.play=function(){return this._player_engine.play()},Y.prototype.pause=function(){this._player_engine.pause()},Object.defineProperty(Y.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"buffered",{get:function(){return this._media_element.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"duration",{get:function(){return this._media_element.duration},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"volume",{get:function(){return this._media_element.volume},set:function(K){this._media_element.volume=K},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"muted",{get:function(){return this._media_element.muted},set:function(K){this._media_element.muted=K},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"currentTime",{get:function(){return this._media_element?this._media_element.currentTime:0},set:function(K){this._player_engine.seek(K)},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"mediaInfo",{get:function(){return this._player_engine.mediaInfo},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"statisticsInfo",{get:function(){return this._player_engine.statisticsInfo},enumerable:!1,configurable:!0}),Y})(),ce=(function(){function Y(K,H){this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new y.a,this._config=h(),typeof H=="object"&&Object.assign(this._config,H);var Q=K.type.toLowerCase();if(Q==="mse"||Q==="mpegts"||Q==="m2ts"||Q==="flv")throw new C.b("NativePlayer does't support mse/mpegts/m2ts/flv MediaDataSource input!");if(K.hasOwnProperty("segments"))throw new C.b("NativePlayer(".concat(K.type,") doesn't support multipart playback!"));this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=K,this._mediaElement=null}return Y.prototype.destroy=function(){this._emitter.emit(S.a.DESTROYING),this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},Y.prototype.on=function(K,H){var Q=this;K===S.a.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then((function(){Q._emitter.emit(S.a.MEDIA_INFO,Q.mediaInfo)})):K===S.a.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then((function(){Q._emitter.emit(S.a.STATISTICS_INFO,Q.statisticsInfo)})),this._emitter.addListener(K,H)},Y.prototype.off=function(K,H){this._emitter.removeListener(K,H)},Y.prototype.attachMediaElement=function(K){if(this._mediaElement=K,K.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{K.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},Y.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},Y.prototype.load=function(){if(!this._mediaElement)throw new C.a("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},Y.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},Y.prototype.play=function(){return this._mediaElement.play()},Y.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(Y.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(K){this._mediaElement.volume=K},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(K){this._mediaElement.muted=K},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(K){this._mediaElement?this._mediaElement.currentTime=K:this._pendingSeekTime=K},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"mediaInfo",{get:function(){var K={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&(K.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(K.width=this._mediaElement.videoWidth,K.height=this._mediaElement.videoHeight)),K},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"statisticsInfo",{get:function(){var K={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return K;var H=!0,Q=0,oe=0;if(this._mediaElement.getVideoPlaybackQuality){var ye=this._mediaElement.getVideoPlaybackQuality();Q=ye.totalVideoFrames,oe=ye.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(Q=this._mediaElement.webkitDecodedFrameCount,oe=this._mediaElement.webkitDroppedFrameCount):H=!1;return H&&(K.decodedFrames=Q,K.droppedFrames=oe),K},enumerable:!1,configurable:!0}),Y.prototype._onvLoadedMetadata=function(K){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(S.a.MEDIA_INFO,this.mediaInfo)},Y.prototype._reportStatisticsInfo=function(){this._emitter.emit(S.a.STATISTICS_INFO,this.statisticsInfo)},Y})();o.a.install();var le={createPlayer:function(Y,K){var H=Y;if(H==null||typeof H!="object")throw new C.b("MediaDataSource must be an javascript object!");if(!H.hasOwnProperty("type"))throw new C.b("MediaDataSource must has type field to indicate video file type!");switch(H.type){case"mse":case"mpegts":case"m2ts":case"flv":return new X(H,K);default:return new ce(H,K)}},isSupported:function(){return u.supportMSEH264Playback()},getFeatureList:function(){return u.getFeatureList()}};le.BaseLoader=m.a,le.LoaderStatus=m.c,le.LoaderErrors=m.b,le.Events=S.a,le.ErrorTypes=R.b,le.ErrorDetails=R.a,le.MSEPlayer=X,le.NativePlayer=ce,le.LoggingControl=ne.a,Object.defineProperty(le,"version",{enumerable:!0,get:function(){return"1.8.0"}}),n.default=le}])}))})(Bm)),Bm.exports}var WO=YO();const Zd=Q_(WO),D_=220,Um=70,I_=50,yr=3,B0={Movies:"bg-purple-600",TVShow:"bg-blue-600",Sports:"bg-green-600",News:"bg-red-600",Kids:"bg-orange-500",Documentary:"bg-teal-600"};function Tr(i){return i.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function QO({program:i,startOffset:e,width:t,onClick:n,isNow:r,isScheduled:o,isRecording:c}){const d=B0[i.category||""]||"bg-gray-600",h=60;return t<20?null:s.jsxs("div",{onClick:n,className:`absolute top-1 bottom-1 rounded-md cursor-pointer overflow-hidden transition-all hover:z-20 hover:ring-2 hover:ring-white/80 hover:brightness-110 ${d} ${r?"ring-1 ring-yellow-400/70 shadow-[0_0_4px_rgba(250,204,21,0.3)]":""}`,style:{left:`${e}px`,width:`${Math.max(t-4,h)}px`},title:`${i.title}
${Tr(new Date(i.start))} - ${Tr(new Date(i.end))}${o?`
 Scheduled to record`:""}`,children:[(o||c)&&s.jsx("div",{className:"absolute top-1 right-1 z-10",children:s.jsx("div",{className:`w-3 h-3 rounded-full flex items-center justify-center ${c?"bg-red-600 animate-pulse":"bg-red-500"}`,children:s.jsx(Io,{className:"w-2 h-2 text-white fill-current"})})}),(()=>{const u=i.isSports&&!i.isLive,m=i.isNew&&!u,g=i.isPremiere&&!u,x=i.isLive,y=i.isFinale;return!m&&!g&&!y&&!x?null:s.jsxs("div",{className:"absolute top-1 left-1 z-10 flex gap-1",children:[x&&s.jsx("span",{className:"px-1 py-0.5 bg-red-500 text-white text-[9px] font-bold rounded uppercase animate-pulse",children:"Live"}),g&&s.jsx("span",{className:"px-1 py-0.5 bg-yellow-500 text-black text-[9px] font-bold rounded uppercase",children:"Premiere"}),m&&!g&&s.jsx("span",{className:"px-1 py-0.5 bg-green-500 text-white text-[9px] font-bold rounded uppercase",children:"New"}),y&&s.jsx("span",{className:"px-1 py-0.5 bg-purple-500 text-white text-[9px] font-bold rounded uppercase",children:"Finale"})]})})(),s.jsxs("div",{className:"p-2 h-full flex flex-col justify-center",children:[s.jsx("div",{className:"font-semibold text-white text-sm leading-tight truncate",children:i.title}),t>120&&s.jsxs("div",{className:"text-xs text-white/80 mt-1 truncate",children:[Tr(new Date(i.start))," - ",Tr(new Date(i.end))]}),t>200&&i.description&&s.jsx("div",{className:"text-xs text-white/60 mt-1 line-clamp-1",children:i.description})]})]})}function XO({program:i,channel:e,onClose:t,onRecord:n,onWatchNow:r,isRecording:o,scheduledStatus:c,onCancelRecording:d}){const h=new Date(i.start),u=new Date(i.end),m=Math.round((u.getTime()-h.getTime())/6e4),g=new Date>=h&&new Date<u,x=new Date<h,y=B0[i.category||""]||"bg-gray-600",v=c==="scheduled"||c==="recording";return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4",onClick:t,children:s.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-lg overflow-hidden shadow-2xl",onClick:S=>S.stopPropagation(),children:[s.jsxs("div",{className:`relative h-28 ${y} flex items-end p-4`,children:[s.jsx("button",{onClick:t,className:"absolute top-3 right-3 p-1.5 bg-black/30 hover:bg-black/50 rounded-full transition-colors",children:s.jsx(At,{className:"h-5 w-5 text-white"})}),c==="recording"?s.jsxs("span",{className:"absolute top-3 left-3 flex items-center gap-1.5 px-2.5 py-1 bg-red-600 text-white text-xs font-bold rounded-full",children:[s.jsx(Io,{className:"h-2 w-2 fill-current animate-pulse"}),"RECORDING"]}):c==="scheduled"?s.jsxs("span",{className:"absolute top-3 left-3 flex items-center gap-1.5 px-2.5 py-1 bg-red-500 text-white text-xs font-bold rounded-full",children:[s.jsx(Io,{className:"h-2 w-2 fill-current"}),"SCHEDULED"]}):g&&s.jsxs("span",{className:"absolute top-3 left-3 flex items-center gap-1.5 px-2.5 py-1 bg-red-600 text-white text-xs font-bold rounded-full",children:[s.jsx(Io,{className:"h-2 w-2 fill-current animate-pulse"}),"LIVE NOW"]}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold text-white drop-shadow-lg",children:i.title}),e&&s.jsxs("p",{className:"text-white/90 text-sm mt-1",children:["Ch ",e.number,"  ",e.name]})]})]}),s.jsxs("div",{className:"p-5",children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-gray-400 mb-4",children:[s.jsxs("div",{className:"flex items-center gap-1.5 bg-gray-700/50 px-2.5 py-1 rounded",children:[s.jsx(Ci,{className:"h-4 w-4"}),h.toLocaleDateString()]}),s.jsxs("div",{className:"flex items-center gap-1.5 bg-gray-700/50 px-2.5 py-1 rounded",children:[s.jsx(Ts,{className:"h-4 w-4"}),Tr(h)," - ",Tr(u)," (",m," min)"]}),i.category&&s.jsx("span",{className:`px-2.5 py-1 rounded text-xs font-semibold text-white ${y}`,children:i.category}),(()=>{const S=i.isSports&&!i.isLive;return s.jsxs(s.Fragment,{children:[i.isPremiere&&!S&&s.jsx("span",{className:"px-2.5 py-1 bg-yellow-500 text-black text-xs font-bold rounded uppercase",children:"Premiere"}),i.isNew&&!i.isPremiere&&!S&&s.jsx("span",{className:"px-2.5 py-1 bg-green-500 text-white text-xs font-bold rounded uppercase",children:"New Episode"}),i.isFinale&&s.jsx("span",{className:"px-2.5 py-1 bg-purple-500 text-white text-xs font-bold rounded uppercase",children:"Finale"}),i.isLive&&s.jsx("span",{className:"px-2.5 py-1 bg-red-500 text-white text-xs font-bold rounded uppercase animate-pulse",children:"Live"})]})})()]}),i.description&&s.jsx("p",{className:"text-gray-300 text-sm leading-relaxed mb-4",children:i.description}),i.episodeNum&&s.jsx("p",{className:"text-gray-500 text-xs mb-4",children:i.episodeNum}),s.jsxs("div",{className:"flex gap-3 mt-6 pt-4 border-t border-gray-700",children:[g&&e?.streamUrl&&s.jsxs("button",{onClick:r,className:"flex-1 flex items-center justify-center gap-2 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold transition-colors",children:[s.jsx(la,{className:"h-5 w-5"}),"Watch Now"]}),(g||x)&&!v&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>n(!1),disabled:o,className:"flex-1 py-3 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 text-white rounded-lg font-semibold transition-colors",children:o?"Recording...":"Record"}),s.jsx("button",{onClick:()=>n(!0),disabled:o,className:"flex-1 py-3 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 text-white rounded-lg font-semibold transition-colors",children:"Record Series"})]}),v&&d&&s.jsx("button",{onClick:d,className:"flex-1 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold transition-colors",children:c==="recording"?"Stop Recording":"Cancel Recording"})]})]})]})})}function JO({channel:i,program:e,onClose:t}){const n=P.useRef(null),r=P.useRef(null),o=P.useRef(null),[c,d]=P.useState(!0),[h,u]=P.useState(null),[m,g]=P.useState(!1),[x,y]=P.useState(!0),[v,S]=P.useState(!0),[N,A]=P.useState(0),R=P.useRef(null),C=P.useRef(null),D=()=>{const M=n.current;M&&(M.paused?(M.play().catch(()=>{}),y(!0)):(M.pause(),y(!1)))},V=()=>{const M=n.current;M&&(M.currentTime=Math.max(0,M.currentTime-10))},z=()=>{const M=n.current;M&&(M.currentTime=M.currentTime+10)};P.useEffect(()=>{const M=n.current;if(!M)return;if(!i.streamUrl){u("No stream URL available for this channel"),d(!1);return}d(!0),u(null);const L=`${window.location.origin}/livetv/channels/${i.id}/stream`;if(console.log("[LiveTVPlayer] Loading stream:",L,"Original URL:",i.streamUrl),Zd.isSupported()){console.log("[LiveTVPlayer] Trying mpegts.js first (most live TV is MPEG-TS)");let O=!1;const J=Zd.createPlayer({type:"mpegts",isLive:!0,url:L},{enableWorker:!1,lazyLoad:!1,autoCleanupSourceBuffer:!0,autoCleanupMaxBackwardDuration:60,autoCleanupMinBackwardDuration:30,stashInitialSize:512*1024,enableStashBuffer:!0,liveBufferLatencyChasing:!1,liveBufferLatencyMaxLatency:10,liveBufferLatencyMinRemain:3});o.current=J,J.attachMediaElement(M),J.load(),J.on(Zd.Events.MEDIA_INFO,()=>{console.log("[LiveTVPlayer] mpegts media info received - stream is MPEG-TS"),O=!0,C.current&&(clearTimeout(C.current),C.current=null),d(!1),M.play().catch(ie=>console.error("[LiveTVPlayer] Play error:",ie))}),J.on(Zd.Events.ERROR,(ie,ne)=>{if(console.error("[LiveTVPlayer] mpegts error:",ie,ne),O)u(`Stream error: ${ie} - ${ne}`),d(!1);else if(console.log("[LiveTVPlayer] mpegts failed, trying HLS.js..."),J.destroy(),o.current=null,us.isSupported()){const se=new us({enableWorker:!0,lowLatencyMode:!0});r.current=se,se.on(us.Events.MANIFEST_PARSED,()=>{console.log("[LiveTVPlayer] HLS manifest parsed successfully"),C.current&&(clearTimeout(C.current),C.current=null),d(!1),M.play().catch(X=>console.error("[LiveTVPlayer] Play error:",X))}),se.on(us.Events.ERROR,(X,ce)=>{console.error("[LiveTVPlayer] HLS error:",ce.type,ce.details),ce.fatal&&(u(`Stream error: ${ce.details}`),d(!1))}),se.loadSource(L),se.attachMedia(M)}else u(`Stream error: ${ie} - ${ne}`),d(!1)})}else if(us.isSupported()){console.log("[LiveTVPlayer] Using HLS.js (mpegts not supported)");const O=new us({enableWorker:!0,lowLatencyMode:!0});r.current=O,O.on(us.Events.MANIFEST_PARSED,()=>{console.log("[LiveTVPlayer] HLS manifest parsed successfully"),C.current&&(clearTimeout(C.current),C.current=null),d(!1),M.play().catch(J=>console.error("[LiveTVPlayer] Play error:",J))}),O.on(us.Events.ERROR,(J,ie)=>{console.error("[LiveTVPlayer] HLS error:",ie.type,ie.details),ie.fatal&&(u(`Stream error: ${ie.details}`),d(!1))}),O.loadSource(L),O.attachMedia(M)}else M.canPlayType("application/vnd.apple.mpegurl")?(console.log("[LiveTVPlayer] Using native HLS (Safari)"),M.src=L,M.addEventListener("loadedmetadata",()=>{console.log("[LiveTVPlayer] Native HLS loaded"),C.current&&(clearTimeout(C.current),C.current=null),d(!1),M.play().catch(O=>console.error("[LiveTVPlayer] Play error:",O))}),M.addEventListener("error",()=>{console.error("[LiveTVPlayer] Native HLS error:",M.error),u(`Video error: ${M.error?.message||"Unknown error"}`),d(!1)})):(u("Your browser does not support video playback"),d(!1));return C.current=window.setTimeout(()=>{console.error("[LiveTVPlayer] Loading timeout - stream failed to load within 30 seconds"),u("Stream failed to load. Please check if the channel is available."),d(!1),C.current=null},3e4),()=>{C.current&&(clearTimeout(C.current),C.current=null),r.current&&(r.current.destroy(),r.current=null),o.current&&(o.current.destroy(),o.current=null)}},[i.id,i.streamUrl,N]),P.useEffect(()=>(v&&(R.current&&clearTimeout(R.current),R.current=window.setTimeout(()=>{S(!1)},3e3)),()=>{R.current&&clearTimeout(R.current)}),[v]);const B=()=>S(!0),I=()=>{const M=document.getElementById("livetv-player-container");M&&(document.fullscreenElement?document.exitFullscreen():M.requestFullscreen())};return s.jsx("div",{className:"fixed inset-0 z-50 bg-black",children:s.jsxs("div",{id:"livetv-player-container",className:"relative w-full h-full",onMouseMove:B,onClick:B,children:[c&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsx(nt,{className:"w-12 h-12 text-white animate-spin"})}),h?s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsxs("div",{className:"text-center max-w-md px-4",children:[s.jsx("p",{className:"text-red-400 text-lg mb-4",children:h}),s.jsxs("div",{className:"flex gap-3 justify-center",children:[s.jsxs("button",{onClick:()=>{u(null),d(!0),A(M=>M+1)},className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg flex items-center gap-2",children:[s.jsx(Et,{className:"w-4 h-4"}),"Retry"]}),s.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Close"})]})]})}):s.jsx("video",{ref:n,className:"w-full h-full object-contain",muted:m,playsInline:!0}),s.jsxs("div",{className:`absolute inset-0 transition-opacity duration-300 ${v?"opacity-100":"opacity-0 pointer-events-none"}`,children:[s.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/80 to-transparent",children:s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("button",{onClick:t,className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",children:s.jsx(At,{className:"w-6 h-6"})}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("h2",{className:"text-xl font-semibold text-white",children:["Ch ",i.number," - ",i.name]}),s.jsxs("span",{className:"flex items-center gap-1.5 px-2.5 py-1 bg-red-600 text-white text-xs font-bold rounded-full",children:[s.jsx(Io,{className:"h-2 w-2 fill-current animate-pulse"}),"LIVE"]})]}),e&&s.jsx("p",{className:"text-gray-300 mt-1",children:e.title})]})]})})}),s.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("button",{onClick:()=>g(!m),className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",title:m?"Unmute":"Mute",children:m?s.jsx(o0,{className:"w-6 h-6"}):s.jsx(r0,{className:"w-6 h-6"})})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:V,className:"p-3 text-white hover:bg-white/20 rounded-full transition-colors",title:"Rewind 10s",children:s.jsx(DS,{className:"w-6 h-6"})}),s.jsx("button",{onClick:D,className:"p-4 text-white bg-white/20 hover:bg-white/30 rounded-full transition-colors",title:x?"Pause":"Play",children:x?s.jsx(Yo,{className:"w-8 h-8"}):s.jsx(wn,{className:"w-8 h-8"})}),s.jsx("button",{onClick:z,className:"p-3 text-white hover:bg-white/20 rounded-full transition-colors",title:"Forward 10s",children:s.jsx(n0,{className:"w-6 h-6"})})]}),s.jsx("button",{onClick:I,className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",title:"Fullscreen",children:s.jsx(e0,{className:"w-6 h-6"})})]})})]})]})})}function ZO(){const i=ft(),e=P.useRef(null),t=P.useRef(null),[n,r]=P.useState(null),[o,c]=P.useState(null),[d,h]=P.useState(0),[u,m]=P.useState("all"),[g,x]=P.useState(!1),[y,v]=P.useState(null),[S,N]=P.useState(null),[A,R]=P.useState(""),{startTime:C,endTime:D}=P.useMemo(()=>{const Se=new Date,Ye=new Date(Se);Ye.setMinutes(0,0,0),Ye.setHours(Ye.getHours()+d-1);const lt=new Date(Ye);return lt.setHours(lt.getHours()+6),{startTime:Ye,endTime:lt}},[d]),V=new Date,z=P.useMemo(()=>{const Se=[],Ye=new Date(C);for(;Ye<D;)Se.push(new Date(Ye)),Ye.setMinutes(Ye.getMinutes()+30);return Se},[C,D]),{data:B,isLoading:I}=qe({queryKey:["channels"],queryFn:async()=>(await(await fetch("/livetv/channels",{headers:{"X-Plex-Token":Re.getToken()||""}})).json()).channels.filter(lt=>lt.enabled!==!1).sort((lt,_t)=>lt.number-_t.number)}),{data:M,isLoading:L}=qe({queryKey:["guide"],queryFn:()=>Re.getGuide(),staleTime:300*1e3}),{data:O}=qe({queryKey:["scheduled-recordings"],queryFn:()=>Re.getRecordings(),staleTime:30*1e3}),J=P.useMemo(()=>{const Se=new Map;return O&&O.filter(Ye=>Ye.status==="scheduled"||Ye.status==="recording").forEach(Ye=>{const lt=`${Ye.channelId}-${Ye.startTime}`;Se.set(lt,{status:Ye.status,recordingId:Ye.id})}),Se},[O]),ie=P.useCallback((Se,Ye)=>{const lt=`${Se}-${Ye}`;return J.get(lt)?.status||null},[J]),ne=P.useCallback((Se,Ye)=>{const lt=`${Se}-${Ye}`;return J.get(lt)?.recordingId||null},[J]),se=P.useMemo(()=>M?.programs?M.programs:{},[M]),X=P.useMemo(()=>{if(!B)return[];const Se=new Set;return B.forEach(Ye=>{Ye.group&&Se.add(Ye.group)}),Array.from(Se).sort()},[B]),ce=P.useCallback(Se=>(se[Se.channelId]||[]).length>0,[se]),le=P.useCallback(Se=>{const Ye=se[Se.channelId]||[],lt=new Date;return Ye.find(_t=>new Date(_t.start)<=lt&&new Date(_t.end)>lt)},[se]),Y=P.useMemo(()=>B?B.filter(Se=>!(u!=="all"&&Se.group!==u||g&&ce(Se))):[],[B,u,g,ce]),K=P.useMemo(()=>{if(!B)return{};const Se={all:0};return B.forEach(Ye=>{ce(Ye)||(Se.all++,Ye.group&&(Se[Ye.group]=(Se[Ye.group]||0)+1))}),Se},[B,ce]),H=Ve({mutationFn:async({channelId:Se,programId:Ye,seriesRecord:lt})=>{const _t=await fetch("/dvr/recordings/from-program",{method:"POST",headers:{"Content-Type":"application/json","X-Plex-Token":Re.getToken()||""},body:JSON.stringify({channelId:Se,programId:Ye,seriesRecord:lt})});if(!_t.ok)throw new Error("Failed to create recording");return _t.json()},onSuccess:()=>{i.invalidateQueries({queryKey:["recordings"]}),i.invalidateQueries({queryKey:["scheduled-recordings"]}),r(null)}}),Q=Ve({mutationFn:async Se=>{await Re.deleteRecording(Se)},onSuccess:()=>{i.invalidateQueries({queryKey:["recordings"]}),i.invalidateQueries({queryKey:["scheduled-recordings"]}),r(null)}}),{data:oe}=qe({queryKey:["epgSources"],queryFn:async()=>await Re.getEPGSources()}),{data:ye}=qe({queryKey:["epgChannels",S],queryFn:async()=>(await(await fetch(`/livetv/epg/channels?epgSourceId=${S}`,{headers:{"X-Plex-Token":Re.getToken()||""}})).json()).channels,enabled:!!S&&!!y}),xe=P.useMemo(()=>{if(!ye)return[];if(!A.trim())return ye;const Se=A.toLowerCase();return ye.filter(Ye=>Ye.callSign?.toLowerCase().includes(Se)||Ye.channelNo?.toLowerCase().includes(Se)||Ye.channelId.toLowerCase().includes(Se)||Ye.sampleTitle?.toLowerCase().includes(Se))},[ye,A]),pe=Ve({mutationFn:async({channelId:Se,epgSourceId:Ye,epgChannelId:lt})=>{const _t=await fetch(`/livetv/channels/${Se}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Plex-Token":Re.getToken()||""},body:JSON.stringify({epgSourceId:Ye,channelId:lt})});if(!_t.ok)throw new Error("Failed to map channel");return _t.json()},onSuccess:async()=>{await i.refetchQueries({queryKey:["channels"]}),await i.refetchQueries({queryKey:["guide"]}),v(null),R("")}}),ee=Ve({mutationFn:async Se=>{const Ye=await fetch(`/livetv/channels/${Se}/epg-mapping`,{method:"DELETE",headers:{"X-Plex-Token":Re.getToken()||""}});if(!Ye.ok)throw new Error("Failed to unmap channel");return Ye.json()},onSuccess:async()=>{await i.refetchQueries({queryKey:["channels"]}),await i.refetchQueries({queryKey:["guide"]}),v(null)}}),[re,je]=P.useState(null),Fe=Ve({mutationFn:async()=>{const Se=await fetch("/livetv/channels/auto-detect?apply=true&unmappedOnly=true",{method:"POST",headers:{"X-Plex-Token":Re.getToken()||""}});if(!Se.ok)throw new Error("Failed to auto-detect EPG mappings");return Se.json()},onSuccess:async Se=>{await i.refetchQueries({queryKey:["channels"]}),await i.refetchQueries({queryKey:["guide"]}),je(Se)}});P.useEffect(()=>{y&&oe&&oe.length>0&&!S&&N(oe[0].id)},[y,oe,S]);const We=P.useCallback(()=>{e.current&&t.current&&(t.current.scrollTop=e.current.scrollTop)},[]);P.useEffect(()=>{if(e.current&&d===0){const Ye=(V.getTime()-C.getTime())/6e4*yr-100;e.current.scrollLeft=Math.max(0,Ye)}},[C,d]);const he=(D.getTime()-C.getTime())/6e4*yr,Ue=(V.getTime()-C.getTime())/6e4*yr,Ge=Y,vt=I||L,Ke=B?.length||0,ht=Se=>{n&&H.mutate({channelId:n.channel?.id||0,programId:n.program.id,seriesRecord:Se})},Ft=()=>h(Se=>Se-3),hs=()=>h(Se=>Se+3),gs=()=>h(0);return s.jsxs("div",{className:"h-full flex flex-col",children:[s.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"TV Guide"}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Browse the program schedule and record shows"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>{i.refetchQueries({queryKey:["channels"]}),i.refetchQueries({queryKey:["guide"]})},className:"p-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors",title:"Refresh EPG data",children:s.jsx(Et,{className:`h-5 w-5 ${I||L?"animate-spin":""}`})}),s.jsx("div",{className:"h-6 w-px bg-gray-600"}),s.jsx("button",{onClick:Ft,className:"p-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors",children:s.jsx(Qg,{className:"h-5 w-5"})}),s.jsx("button",{onClick:gs,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors",children:"Now"}),s.jsx("button",{onClick:hs,className:"p-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors",children:s.jsx(Va,{className:"h-5 w-5"})})]})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("label",{className:"text-sm text-gray-400",children:"Provider:"}),s.jsxs("select",{value:u,onChange:Se=>m(Se.target.value),className:"px-3 py-1.5 bg-gray-700 border border-gray-600 rounded text-white text-sm min-w-[180px]",children:[s.jsxs("option",{value:"all",children:["All Groups (",Ke," channels)"]}),X.map(Se=>s.jsxs("option",{value:Se,children:[Se," (",B?.filter(Ye=>Ye.group===Se).length||0,")",K[Se]>0&&` - ${K[Se]} need EPG`]},Se))]})]}),s.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:g,onChange:Se=>x(Se.target.checked),className:"w-4 h-4 rounded border-gray-500 bg-gray-600 text-red-600 focus:ring-red-500"}),s.jsxs("span",{className:"text-sm text-gray-400",children:["Show only channels without EPG",K.all>0&&s.jsxs("span",{className:"ml-1 text-red-400",children:["(",K.all,")"]})]})]}),K.all>0&&s.jsxs("button",{onClick:()=>Fe.mutate(),disabled:Fe.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 text-white text-sm font-medium rounded-lg transition-colors",children:[s.jsx(_u,{className:`h-4 w-4 ${Fe.isPending?"animate-spin":""}`}),Fe.isPending?"Detecting...":"Auto-Detect EPG"]}),s.jsx("div",{className:"h-6 w-px bg-gray-700"}),Object.entries(B0).map(([Se,Ye])=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`w-4 h-4 rounded ${Ye}`}),s.jsx("span",{className:"text-sm text-gray-400",children:Se})]},Se))]}),vt?s.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-800 rounded-xl",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-500 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-400",children:"Loading TV Guide..."})]})}):s.jsxs("div",{className:"flex-1 bg-gray-800 rounded-xl overflow-hidden flex flex-col min-h-0",children:[s.jsxs("div",{className:"flex flex-shrink-0 border-b border-gray-700",children:[s.jsxs("div",{className:"flex-shrink-0 bg-gray-900 border-r border-gray-700 flex items-center justify-center flex-col",style:{width:D_,height:I_},children:[s.jsxs("span",{className:"text-sm font-semibold text-gray-400",children:[Ge.length," Channels"]}),Ge.length!==Ke&&s.jsxs("span",{className:"text-xs text-gray-500",children:["of ",Ke]})]}),s.jsx("div",{className:"flex-1 overflow-hidden",children:s.jsxs("div",{className:"relative bg-gray-900",style:{width:he,height:I_},children:[z.map((Se,Ye)=>s.jsx("div",{className:"absolute top-0 bottom-0 border-l border-gray-700 flex items-center px-3",style:{left:(Se.getTime()-C.getTime())/6e4*yr},children:s.jsx("span",{className:"text-sm font-medium text-gray-300",children:Tr(Se)})},Ye)),Ue>0&&Ue<he&&s.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-red-500 z-20",style:{left:Ue},children:s.jsx("div",{className:"absolute -top-0 left-1/2 -translate-x-1/2 w-3 h-3 bg-red-500 rounded-full"})})]})})]}),s.jsxs("div",{className:"flex flex-1 min-h-0",children:[s.jsx("div",{ref:t,className:"flex-shrink-0 overflow-hidden border-r border-gray-700",style:{width:D_},children:s.jsx("div",{children:Ge.map(Se=>{const Ye=ce(Se);return s.jsxs("div",{className:`flex items-center gap-2 px-3 border-b border-gray-700/50 hover:bg-gray-750 cursor-pointer group ${Ye?"bg-gray-800":"bg-red-900/20"}`,style:{height:Um},onClick:()=>{Se.streamUrl&&c({channel:Se,program:le(Se)})},children:[s.jsx("button",{onClick:lt=>{lt.stopPropagation(),Se.streamUrl&&c({channel:Se,program:le(Se)})},className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 transition-all ${Se.streamUrl?"bg-green-600 hover:bg-green-500 text-white opacity-70 group-hover:opacity-100":"bg-gray-700 text-gray-500 cursor-not-allowed"}`,title:Se.streamUrl?"Watch Now":"No stream available",disabled:!Se.streamUrl,children:s.jsx(wn,{className:"h-4 w-4 ml-0.5"})}),Se.logo?s.jsx("img",{src:Se.logo,alt:Se.name,className:"w-10 h-7 object-contain bg-gray-700 rounded flex-shrink-0",onError:lt=>{lt.target.style.display="none"}}):s.jsx("div",{className:"w-10 h-7 bg-gray-700 rounded flex items-center justify-center text-xs text-gray-400 flex-shrink-0",children:Se.number}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("div",{className:"text-sm font-medium text-white truncate",children:Se.name}),s.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1 flex-wrap",children:["Ch ",Se.number,Se.sourceName&&s.jsxs("span",{className:"text-indigo-400",children:[" ",Se.sourceName]}),Ye?s.jsxs("button",{onClick:lt=>{lt.stopPropagation(),v(Se)},className:"ml-1 px-1.5 py-0.5 bg-gray-600 hover:bg-gray-500 text-white text-xs rounded transition-colors flex items-center gap-0.5 opacity-60 hover:opacity-100",title:"Change EPG mapping",children:[s.jsx(Id,{className:"h-3 w-3"}),"Re-map"]}):s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"text-red-400 font-medium",children:" No EPG"}),s.jsxs("button",{onClick:lt=>{lt.stopPropagation(),v(Se)},className:"ml-1 px-1.5 py-0.5 bg-indigo-600 hover:bg-indigo-700 text-white text-xs rounded transition-colors flex items-center gap-0.5",title:"Map to EPG channel",children:[s.jsx(Id,{className:"h-3 w-3"}),"Map"]})]})]})]})]},Se.id)})})}),s.jsx("div",{ref:e,className:"flex-1 overflow-auto",onScroll:We,children:s.jsxs("div",{className:"relative",style:{width:he,minWidth:"100%"},children:[Ue>0&&Ue<he&&s.jsx("div",{className:"absolute w-0.5 bg-red-500 z-10 pointer-events-none",style:{left:Ue,top:0,height:Ge.length*Um}}),Ge.map(Se=>{const Ye=se[Se.channelId]||[];return s.jsxs("div",{className:"relative border-b border-gray-700/50",style:{height:Um},children:[z.map((lt,_t)=>s.jsx("div",{className:"absolute top-0 bottom-0 border-l border-gray-700/30",style:{left:(lt.getTime()-C.getTime())/6e4*yr}},_t)),Ye.map(lt=>{const _t=new Date(lt.start),ln=new Date(lt.end);if(ln<=C||_t>=D)return null;const Gs=_t<C?C:_t,Vn=ln>D?D:ln,Tn=(Gs.getTime()-C.getTime())/6e4*yr,ri=(Vn.getTime()-Gs.getTime())/6e4*yr,oi=V>=_t&&V<ln,cn=ie(Se.id,lt.start);return s.jsx(QO,{program:lt,startOffset:Tn,width:ri,isNow:oi,isScheduled:cn==="scheduled",isRecording:cn==="recording",onClick:()=>r({program:lt,channel:Se})},lt.id)}),Ye.filter(lt=>{const _t=new Date(lt.start);return!(new Date(lt.end)<=C||_t>=D)}).length===0&&s.jsx("div",{className:"absolute inset-1 flex items-center justify-center",children:s.jsx("span",{className:"text-xs text-gray-600",children:"No program info"})})]},Se.id)})]})})]})]}),n&&s.jsx(XO,{program:n.program,channel:n.channel,onClose:()=>r(null),onRecord:ht,onWatchNow:()=>{n.channel?.streamUrl&&c({channel:n.channel,program:n.program}),r(null)},isRecording:H.isPending,scheduledStatus:n.channel?ie(n.channel.id,n.program.start):null,onCancelRecording:()=>{if(n.channel){const Se=ne(n.channel.id,n.program.start);Se&&Q.mutate(Se)}}}),o&&s.jsx(JO,{channel:o.channel,program:o.program,onClose:()=>c(null)}),y&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4",onClick:()=>v(null),children:s.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl flex flex-col",onClick:Se=>Se.stopPropagation(),children:[s.jsxs("div",{className:"p-4 border-b border-gray-700 flex-shrink-0",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[s.jsx(Id,{className:"h-5 w-5"}),"Map EPG Channel"]}),s.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["Map ",s.jsxs("span",{className:"text-indigo-400 font-medium",children:["Ch ",y.number," - ",y.name]})," to an EPG channel"]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[ce(y)&&s.jsxs("button",{onClick:()=>ee.mutate(y.id),disabled:ee.isPending,className:"px-3 py-1.5 bg-red-600 hover:bg-red-700 disabled:opacity-50 text-white text-sm rounded-lg transition-colors flex items-center gap-1.5",children:[s.jsx(At,{className:"h-4 w-4"}),ee.isPending?"Removing...":"Remove Mapping"]}),s.jsx("button",{onClick:()=>v(null),className:"p-1.5 bg-gray-700 hover:bg-gray-600 rounded-full transition-colors",children:s.jsx(At,{className:"h-5 w-5 text-white"})})]})]}),oe&&oe.length>0&&s.jsxs("div",{className:"mt-3",children:[s.jsx("label",{className:"text-sm text-gray-400 mb-1 block",children:"EPG Source:"}),s.jsx("select",{value:S||"",onChange:Se=>{N(parseInt(Se.target.value)),R("")},className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white text-sm",children:oe.map(Se=>s.jsxs("option",{value:Se.id,children:[Se.name," (",Se.channelCount," channels)"]},Se.id))})]}),s.jsxs("div",{className:"relative mt-3",children:[s.jsx(qt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search by call sign, channel number, or title...",value:A,onChange:Se=>R(Se.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 text-sm",autoFocus:!0})]}),s.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:[xe.length," channel",xe.length!==1?"s":""," found",A&&` for "${A}"`]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:ye?xe.length===0?s.jsx("div",{className:"text-center py-8 text-gray-400",children:s.jsx("p",{children:"No channels match your search"})}):s.jsxs("div",{className:"space-y-2",children:[xe.slice(0,100).map(Se=>s.jsx("button",{onClick:()=>{S&&pe.mutate({channelId:y.id,epgSourceId:S,epgChannelId:Se.channelId})},disabled:pe.isPending,className:"w-full p-3 bg-gray-700 hover:bg-gray-600 rounded-lg text-left transition-colors disabled:opacity-50",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsxs("div",{className:"text-white font-medium",children:[Se.callSign||Se.channelId,Se.channelNo&&s.jsxs("span",{className:"text-gray-400 font-normal ml-2",children:["Ch ",Se.channelNo]})]}),s.jsx("div",{className:"text-sm text-gray-400 truncate",children:Se.sampleTitle})]}),s.jsx(Id,{className:"h-4 w-4 text-gray-500 flex-shrink-0 ml-2"})]})},Se.channelId)),xe.length>100&&s.jsx("p",{className:"text-center text-sm text-gray-500 py-2",children:"Showing first 100 results. Use search to narrow down."})]}):s.jsxs("div",{className:"text-center py-8 text-gray-400",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto mb-3"}),s.jsx("p",{children:"Loading EPG channels..."})]})})]})}),re&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4",onClick:()=>je(null),children:s.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl flex flex-col",onClick:Se=>Se.stopPropagation(),children:[s.jsxs("div",{className:"p-4 border-b border-gray-700 flex-shrink-0",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[s.jsx(_u,{className:"h-5 w-5 text-indigo-400"}),"Auto-Detect Results"]}),s.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"EPG channel mapping completed"})]}),s.jsx("button",{onClick:()=>je(null),className:"p-1.5 bg-gray-700 hover:bg-gray-600 rounded-full transition-colors",children:s.jsx(At,{className:"h-5 w-5 text-white"})})]}),s.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mt-4",children:[s.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-3 text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-white",children:re.summary.totalChannels}),s.jsx("div",{className:"text-xs text-gray-400",children:"Scanned"})]}),s.jsxs("div",{className:"bg-green-600/20 rounded-lg p-3 text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-green-400",children:re.summary.newMappings}),s.jsx("div",{className:"text-xs text-gray-400",children:"New Mappings"})]}),s.jsxs("div",{className:"bg-blue-600/20 rounded-lg p-3 text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-400",children:re.summary.alreadyMapped}),s.jsx("div",{className:"text-xs text-gray-400",children:"Already Mapped"})]}),s.jsxs("div",{className:"bg-yellow-600/20 rounded-lg p-3 text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:re.summary.noMatchFound}),s.jsx("div",{className:"text-xs text-gray-400",children:"No Match"})]})]})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[re.results.filter(Se=>Se.autoMapped).length>0&&s.jsxs(s.Fragment,{children:[s.jsx("h3",{className:"text-sm font-semibold text-green-400 mb-2",children:"Successfully Mapped"}),s.jsx("div",{className:"space-y-2 mb-4",children:re.results.filter(Se=>Se.autoMapped).map(Se=>s.jsxs("div",{className:"p-3 bg-green-600/10 border border-green-600/30 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-white font-medium",children:Se.channelName}),Se.bestMatch&&s.jsxs("span",{className:"text-green-400 ml-2",children:[" ",Se.bestMatch.epgCallSign||Se.bestMatch.epgName]})]}),Se.bestMatch&&s.jsxs("span",{className:"text-xs bg-green-600/30 text-green-300 px-2 py-1 rounded",children:[Math.round(Se.bestMatch.confidence*100),"%  ",Se.bestMatch.matchStrategy]})]}),Se.bestMatch?.matchReason&&s.jsx("div",{className:"text-xs text-gray-400 mt-1",children:Se.bestMatch.matchReason})]},Se.channelId))})]}),re.results.filter(Se=>!Se.autoMapped&&!Se.currentMapping).length>0&&s.jsxs(s.Fragment,{children:[s.jsx("h3",{className:"text-sm font-semibold text-yellow-400 mb-2",children:"No Match Found"}),s.jsx("div",{className:"space-y-2",children:re.results.filter(Se=>!Se.autoMapped&&!Se.currentMapping).map(Se=>s.jsx("div",{className:"p-3 bg-yellow-600/10 border border-yellow-600/30 rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-white",children:Se.channelName}),s.jsx("button",{onClick:()=>{const Ye=B?.find(lt=>lt.id===Se.channelId);Ye&&(je(null),v(Ye))},className:"text-xs bg-gray-600 hover:bg-gray-500 text-white px-2 py-1 rounded transition-colors",children:"Map Manually"})]})},Se.channelId))})]})]}),s.jsx("div",{className:"p-4 border-t border-gray-700 flex-shrink-0",children:s.jsx("button",{onClick:()=>je(null),className:"w-full py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition-colors",children:"Done"})})]})})]})}const e5=[{id:"tonight",name:"Tonight",icon:Ts,color:"bg-indigo-600"},{id:"movies",name:"Movies",icon:fn,color:"bg-purple-600"},{id:"sports",name:"Sports",icon:$a,color:"bg-green-600"},{id:"kids",name:"Kids",icon:NS,color:"bg-orange-500"},{id:"news",name:"News",icon:CS,color:"bg-red-600"},{id:"premieres",name:"Premieres",icon:IS,color:"bg-yellow-500"},{id:"week",name:"This Week",icon:Ci,color:"bg-blue-600"}];function t5(i){return new Date(i).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function s5(i){const e=new Date(i),t=new Date,n=new Date(t);return n.setDate(n.getDate()+1),e.toDateString()===t.toDateString()?"Today":e.toDateString()===n.toDateString()?"Tomorrow":e.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"})}function n5(i,e){const t=new Date(i),n=new Date(e),r=Math.round((n.getTime()-t.getTime())/6e4),o=Math.floor(r/60),c=r%60;return o>0?c>0?`${o}h ${c}m`:`${o}h`:`${c}m`}function i5({item:i,onRecord:e,isRecording:t}){const{program:n,channel:r,hasRecording:o}=i,c=d=>{d.stopPropagation(),!o&&r&&e()};return s.jsxs("div",{className:"bg-gray-800 rounded-lg overflow-hidden hover:ring-2 hover:ring-indigo-500 transition-all cursor-pointer",children:[s.jsxs("div",{className:"relative aspect-video bg-gray-700",children:[n.icon||n.art?s.jsx("img",{src:n.icon||n.art,alt:n.title,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center",children:s.jsx(ss,{className:"w-12 h-12 text-gray-600"})}),s.jsxs("div",{className:"absolute top-2 left-2 flex gap-1",children:[n.isLive&&s.jsxs("span",{className:"px-2 py-0.5 bg-red-600 text-white text-xs font-medium rounded flex items-center gap-1",children:[s.jsx(Io,{className:"w-2 h-2 fill-current"}),"LIVE"]}),n.isNew&&s.jsx("span",{className:"px-2 py-0.5 bg-green-600 text-white text-xs font-medium rounded",children:"NEW"}),n.isPremiere&&s.jsx("span",{className:"px-2 py-0.5 bg-yellow-500 text-black text-xs font-medium rounded",children:"PREMIERE"})]}),o&&s.jsx("div",{className:"absolute top-2 right-2",children:s.jsxs("span",{className:"px-2 py-0.5 bg-red-600 text-white text-xs font-medium rounded flex items-center gap-1",children:[s.jsx(kr,{className:"w-3 h-3"}),"REC"]})}),s.jsx("div",{className:"absolute bottom-2 right-2",children:s.jsx("span",{className:"px-2 py-0.5 bg-black/70 text-white text-xs rounded",children:n5(n.start,n.end)})})]}),s.jsxs("div",{className:"p-3",children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsx("h3",{className:"font-medium text-white truncate flex-1",children:n.title}),r&&s.jsx("button",{onClick:c,disabled:o||t,className:`flex-shrink-0 p-1.5 rounded-full transition-colors ${o?"bg-red-600 text-white cursor-default":t?"bg-gray-600 text-gray-400":"bg-gray-700 text-gray-300 hover:bg-red-600 hover:text-white"}`,title:o?"Recording scheduled":"Record this program",children:t?s.jsx(ia,{className:"w-4 h-4 animate-spin"}):o?s.jsx(qs,{className:"w-4 h-4"}):s.jsx(kr,{className:"w-4 h-4"})})]}),n.subtitle&&s.jsx("p",{className:"text-sm text-gray-400 truncate",children:n.subtitle}),s.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-gray-400",children:[s.jsxs("span",{className:"font-medium text-indigo-400",children:[s5(n.start)," ",t5(n.start)]}),r&&s.jsxs(s.Fragment,{children:[s.jsx("span",{children:""}),s.jsx("span",{className:"truncate",children:r.name})]})]}),s.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[n.category&&s.jsx("span",{className:"px-2 py-0.5 bg-gray-700 text-gray-300 text-xs rounded",children:n.category}),n.league&&s.jsx("span",{className:"px-2 py-0.5 bg-green-900 text-green-300 text-xs rounded",children:n.league}),n.rating&&s.jsx("span",{className:"px-2 py-0.5 bg-gray-700 text-gray-300 text-xs rounded",children:n.rating})]}),n.teams&&s.jsx("p",{className:"mt-1 text-xs text-gray-500 truncate",children:n.teams})]})]})}function a5(){const i=ft(),[e,t]=P.useState("tonight"),[n,r]=P.useState(""),[o,c]=P.useState(""),[d,h]=P.useState(null),u=Ve({mutationFn:async()=>(await fetch("/api/onlater/enrich?limit=200",{method:"POST",headers:{"X-Plex-Token":Re.getToken()||""}})).json(),onSuccess:()=>{setTimeout(()=>{i.invalidateQueries({queryKey:["onlater"]})},5e3)}}),[m,g]=P.useState(null),x=Ve({mutationFn:async({programId:z,channelId:B,seriesRecord:I})=>{h(z);const M=await fetch("/api/dvr/recordings/from-program",{method:"POST",headers:{"Content-Type":"application/json","X-Plex-Token":Re.getToken()||""},body:JSON.stringify({programId:z,channelId:B,seriesRecord:I||!1})});if(!M.ok)throw new Error("Failed to schedule recording");return M.json()},onSuccess:()=>{i.invalidateQueries({queryKey:["onlater"]}),i.invalidateQueries({queryKey:["onlater-search"]}),h(null),g(null)},onError:()=>{h(null)}}),y=(z,B,I)=>{x.mutate({programId:z,channelId:B,seriesRecord:I})},v=z=>{g(z)},{data:S}=qe({queryKey:["onlater-stats"],queryFn:async()=>(await fetch("/api/onlater/stats",{headers:{"X-Plex-Token":Re.getToken()||""}})).json()}),{data:N,isLoading:A}=qe({queryKey:["onlater",e,o],queryFn:async()=>{let z=`/api/onlater/${e}`;const B=new URLSearchParams;e==="sports"&&o&&B.set("league",o);const I=B.toString()?`${z}?${B}`:z;return(await fetch(I,{headers:{"X-Plex-Token":Re.getToken()||""}})).json()}}),{data:R,isLoading:C}=qe({queryKey:["onlater-search",n],queryFn:async()=>(await fetch(`/api/onlater/search?q=${encodeURIComponent(n)}`,{headers:{"X-Plex-Token":Re.getToken()||""}})).json(),enabled:n.length>2}),{data:D}=qe({queryKey:["onlater-leagues"],queryFn:async()=>(await fetch("/api/onlater/leagues",{headers:{"X-Plex-Token":Re.getToken()||""}})).json()}),V=n.length>2?R?.items:N?.items;return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"On Later"}),s.jsx("p",{className:"text-gray-400",children:"Browse upcoming content from your EPG"})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("button",{onClick:()=>u.mutate(),disabled:u.isPending,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-500 transition-colors disabled:opacity-50",title:"Fetch artwork from TMDB for programs missing images",children:[u.isPending?s.jsx(ia,{className:"w-4 h-4 animate-spin"}):s.jsx(YC,{className:"w-4 h-4"}),"Enrich Artwork"]}),s.jsxs("div",{className:"relative",children:[s.jsx(qt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search upcoming...",value:n,onChange:z=>r(z.target.value),className:"pl-9 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 w-64"})]})]})]}),S&&s.jsxs("div",{className:"grid grid-cols-5 gap-4 mb-6",children:[s.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-purple-400",children:[s.jsx(fn,{className:"w-5 h-5"}),s.jsx("span",{className:"text-2xl font-bold",children:S.movies})]}),s.jsx("p",{className:"text-sm text-gray-400",children:"Movies"})]}),s.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-green-400",children:[s.jsx($a,{className:"w-5 h-5"}),s.jsx("span",{className:"text-2xl font-bold",children:S.sports})]}),s.jsx("p",{className:"text-sm text-gray-400",children:"Sports"})]}),s.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-orange-400",children:[s.jsx(NS,{className:"w-5 h-5"}),s.jsx("span",{className:"text-2xl font-bold",children:S.kids})]}),s.jsx("p",{className:"text-sm text-gray-400",children:"Kids"})]}),s.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-red-400",children:[s.jsx(CS,{className:"w-5 h-5"}),s.jsx("span",{className:"text-2xl font-bold",children:S.news})]}),s.jsx("p",{className:"text-sm text-gray-400",children:"News"})]}),s.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-yellow-400",children:[s.jsx(IS,{className:"w-5 h-5"}),s.jsx("span",{className:"text-2xl font-bold",children:S.premieres})]}),s.jsx("p",{className:"text-sm text-gray-400",children:"Premieres"})]})]}),s.jsx("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:e5.map(z=>s.jsxs("button",{onClick:()=>{t(z.id),r("")},className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${e===z.id?`${z.color} text-white`:"bg-gray-800 text-gray-300 hover:bg-gray-700"}`,children:[s.jsx(z.icon,{className:"w-4 h-4"}),z.name]},z.id))}),e==="sports"&&D?.leagues&&s.jsxs("div",{className:"flex gap-2 mb-6",children:[s.jsx("button",{onClick:()=>c(""),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${o?"bg-gray-800 text-gray-300 hover:bg-gray-700":"bg-green-600 text-white"}`,children:"All Leagues"}),D.leagues.map(z=>s.jsx("button",{onClick:()=>c(z),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${o===z?"bg-green-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"}`,children:z},z))]}),A||C?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx(ia,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):V&&V.length>0?s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:V.map(z=>s.jsx(i5,{item:z,onRecord:()=>v(z),isRecording:d===z.program.id},z.program.id))}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx(ss,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No upcoming content"}),s.jsx("p",{className:"text-gray-400",children:n?`No results found for "${n}"`:"Check back later or try a different category"})]}),V&&V.length>0&&s.jsxs("div",{className:"mt-6 text-center text-sm text-gray-400",children:["Showing ",V.length," programs"]}),m&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md mx-4 shadow-2xl",children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-semibold text-white",children:"Record Program"}),s.jsx("p",{className:"text-gray-400 text-sm mt-1",children:m.program.title})]}),s.jsx("button",{onClick:()=>g(null),className:"p-1 text-gray-400 hover:text-white hover:bg-gray-700 rounded",children:s.jsx(At,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("button",{onClick:()=>{m.channel&&y(m.program.id,m.channel.id,!1)},disabled:x.isPending,className:"w-full flex items-center gap-4 p-4 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors text-left",children:[s.jsx("div",{className:"flex-shrink-0 p-2 bg-indigo-600 rounded-lg",children:s.jsx(kr,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium text-white",children:"Record This Episode"}),s.jsx("p",{className:"text-sm text-gray-400",children:"Record only this airing"})]}),x.isPending&&s.jsx(ia,{className:"w-5 h-5 text-indigo-400 animate-spin"})]}),s.jsxs("button",{onClick:()=>{m.channel&&y(m.program.id,m.channel.id,!0)},disabled:x.isPending,className:"w-full flex items-center gap-4 p-4 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors text-left",children:[s.jsx("div",{className:"flex-shrink-0 p-2 bg-purple-600 rounded-lg",children:s.jsx(t0,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium text-white",children:"Record Series"}),s.jsx("p",{className:"text-sm text-gray-400",children:"Record all future episodes with this title"})]}),x.isPending&&s.jsx(ia,{className:"w-5 h-5 text-purple-400 animate-spin"})]})]}),s.jsx("button",{onClick:()=>g(null),className:"w-full mt-4 py-2 text-gray-400 hover:text-white transition-colors",children:"Cancel"})]})})]})}const r5=["NFL","NBA","MLB","NHL","MLS"];function o5(){const i=ft(),[e,t]=P.useState(!1),[n,r]=P.useState(null),[o,c]=P.useState(null),[d,h]=P.useState(""),[u,m]=P.useState("NFL"),{data:g,isLoading:x}=qe({queryKey:["teamPasses"],queryFn:async()=>(await fetch("/api/teampass",{headers:{"X-Plex-Token":Re.getToken()||""}})).json()}),{data:y}=qe({queryKey:["teamPassStats"],queryFn:async()=>(await fetch("/api/teampass/stats",{headers:{"X-Plex-Token":Re.getToken()||""}})).json()}),{data:v}=qe({queryKey:["leagueTeams",u],queryFn:async()=>(await fetch(`/api/teampass/leagues/${u}/teams`,{headers:{"X-Plex-Token":Re.getToken()||""}})).json(),enabled:e||n!==null}),{data:S}=qe({queryKey:["teamSearch",d],queryFn:async()=>(await fetch(`/api/teampass/teams/search?q=${encodeURIComponent(d)}`,{headers:{"X-Plex-Token":Re.getToken()||""}})).json(),enabled:d.length>=2}),{data:N}=qe({queryKey:["teamPassUpcoming",o?.id],queryFn:async()=>(await fetch(`/api/teampass/${o.id}/upcoming`,{headers:{"X-Plex-Token":Re.getToken()||""}})).json(),enabled:o!==null}),A=Ve({mutationFn:async I=>(await fetch("/api/teampass",{method:"POST",headers:{"Content-Type":"application/json","X-Plex-Token":Re.getToken()||""},body:JSON.stringify(I)})).json(),onSuccess:()=>{i.invalidateQueries({queryKey:["teamPasses"]}),i.invalidateQueries({queryKey:["teamPassStats"]}),t(!1)}}),R=Ve({mutationFn:async({id:I,data:M})=>(await fetch(`/api/teampass/${I}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Plex-Token":Re.getToken()||""},body:JSON.stringify(M)})).json(),onSuccess:()=>{i.invalidateQueries({queryKey:["teamPasses"]}),r(null)}}),C=Ve({mutationFn:async I=>{await fetch(`/api/teampass/${I}`,{method:"DELETE",headers:{"X-Plex-Token":Re.getToken()||""}})},onSuccess:()=>{i.invalidateQueries({queryKey:["teamPasses"]}),i.invalidateQueries({queryKey:["teamPassStats"]})}}),D=Ve({mutationFn:async I=>(await fetch(`/api/teampass/${I}/toggle`,{method:"PUT",headers:{"X-Plex-Token":Re.getToken()||""}})).json(),onSuccess:()=>{i.invalidateQueries({queryKey:["teamPasses"]})}}),V=Ve({mutationFn:async()=>(await fetch("/api/teampass/process",{method:"POST",headers:{"X-Plex-Token":Re.getToken()||""}})).json(),onSuccess:()=>{i.invalidateQueries({queryKey:["teamPassStats"]})}}),z=g?.teamPasses||[],B=d.length>=2?S?.teams||[]:v?.teams||[];return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Team Pass"}),s.jsx("p",{className:"text-gray-400",children:"Auto-record games for your favorite sports teams"})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("button",{onClick:()=>V.mutate(),disabled:V.isPending,className:"flex items-center gap-2 px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors",children:[V.isPending?s.jsx(ia,{className:"w-4 h-4 animate-spin"}):s.jsx(Ci,{className:"w-4 h-4"}),"Process Now"]}),s.jsxs("button",{onClick:()=>t(!0),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500 transition-colors",children:[s.jsx(rs,{className:"w-4 h-4"}),"Add Team"]})]})]}),y&&s.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[s.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-orange-400",children:[s.jsx($a,{className:"w-5 h-5"}),s.jsx("span",{className:"text-2xl font-bold",children:y.totalPasses})]}),s.jsx("p",{className:"text-sm text-gray-400",children:"Team Passes"})]}),s.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-green-400",children:[s.jsx(sg,{className:"w-5 h-5"}),s.jsx("span",{className:"text-2xl font-bold",children:y.activePasses})]}),s.jsx("p",{className:"text-sm text-gray-400",children:"Active"})]}),s.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-blue-400",children:[s.jsx(Ci,{className:"w-5 h-5"}),s.jsx("span",{className:"text-2xl font-bold",children:y.upcomingGames})]}),s.jsx("p",{className:"text-sm text-gray-400",children:"Upcoming Games"})]}),s.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-red-400",children:[s.jsx(Ts,{className:"w-5 h-5"}),s.jsx("span",{className:"text-2xl font-bold",children:y.scheduledRecordings})]}),s.jsx("p",{className:"text-sm text-gray-400",children:"Scheduled"})]})]}),x?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx(ia,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):z.length===0?s.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-lg",children:[s.jsx($a,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No Team Passes"}),s.jsx("p",{className:"text-gray-400 mb-4",children:"Add your favorite teams to automatically record their games"}),s.jsx("button",{onClick:()=>t(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500",children:"Add Your First Team"})]}):s.jsx("div",{className:"grid gap-4",children:z.map(I=>s.jsxs("div",{className:`bg-gray-800 rounded-lg p-4 border-l-4 ${I.enabled?"border-green-500":"border-gray-600"}`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:`w-12 h-12 rounded-lg ${Fo(I.league)} flex items-center justify-center overflow-hidden`,children:I.logoUrl?s.jsx("img",{src:I.logoUrl,alt:I.teamName,className:"w-10 h-10 object-contain"}):s.jsx($a,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-white",children:I.teamName}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[s.jsx("span",{className:`px-2 py-0.5 rounded ${Fo(I.league)} text-white text-xs`,children:I.league}),I.upcomingCount!==void 0&&I.upcomingCount>0&&s.jsxs("span",{className:"text-blue-400",children:[I.upcomingCount," upcoming game",I.upcomingCount!==1?"s":""]})]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>c(I),className:"p-2 text-gray-400 hover:text-blue-400 transition-colors",title:"View upcoming games",children:s.jsx(Ci,{className:"w-5 h-5"})}),s.jsx("button",{onClick:()=>D.mutate(I.id),className:`p-2 transition-colors ${I.enabled?"text-green-400 hover:text-green-300":"text-gray-500 hover:text-gray-400"}`,title:I.enabled?"Disable":"Enable",children:s.jsx(sg,{className:"w-5 h-5"})}),s.jsx("button",{onClick:()=>r(I),className:"p-2 text-gray-400 hover:text-white transition-colors",title:"Edit",children:s.jsx(Ri,{className:"w-5 h-5"})}),s.jsx("button",{onClick:()=>{confirm(`Delete team pass for ${I.teamName}?`)&&C.mutate(I.id)},className:"p-2 text-gray-400 hover:text-red-400 transition-colors",title:"Delete",children:s.jsx(ts,{className:"w-5 h-5"})})]})]}),s.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-700 flex gap-6 text-sm text-gray-400",children:[s.jsxs("span",{children:["Pre-padding: ",I.prePadding,"m"]}),s.jsxs("span",{children:["Post-padding: ",I.postPadding,"m"]}),I.keepCount>0&&s.jsxs("span",{children:["Keep: ",I.keepCount," recordings"]})]})]},I.id))}),(e||n)&&s.jsx(l5,{pass:n,teams:B,selectedLeague:u,onLeagueChange:m,teamSearch:d,onTeamSearchChange:h,onClose:()=>{t(!1),r(null),h("")},onSave:I=>{n?R.mutate({id:n.id,data:I}):A.mutate(I)},isLoading:A.isPending||R.isPending}),o&&N&&s.jsx(c5,{teamPass:o,games:N.games||[],onClose:()=>c(null)})]})}function l5({pass:i,teams:e,selectedLeague:t,onLeagueChange:n,teamSearch:r,onTeamSearchChange:o,onClose:c,onSave:d,isLoading:h}){const[u,m]=P.useState({teamName:i?.teamName||"",league:i?.league||t,logoUrl:i?.logoUrl||"",prePadding:i?.prePadding??5,postPadding:i?.postPadding??60,keepCount:i?.keepCount??0,priority:i?.priority??0,enabled:i?.enabled??!0}),g=y=>{y.preventDefault(),d(u)},x=y=>{m({...u,teamName:y.name,league:y.league,logoUrl:y.logoUrl||""}),o("")};return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",children:s.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-lg p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-xl font-bold text-white",children:i?"Edit Team Pass":"Add Team Pass"}),s.jsx("button",{onClick:c,className:"text-gray-400 hover:text-white",children:s.jsx(At,{className:"w-6 h-6"})})]}),s.jsxs("form",{onSubmit:g,className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Team"}),u.teamName?s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-700 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`w-10 h-10 rounded ${Fo(u.league)} flex items-center justify-center overflow-hidden`,children:u.logoUrl?s.jsx("img",{src:u.logoUrl,alt:u.teamName,className:"w-8 h-8 object-contain"}):s.jsx($a,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-white font-medium",children:u.teamName}),s.jsx("p",{className:"text-sm text-gray-400",children:u.league})]})]}),s.jsx("button",{type:"button",onClick:()=>m({...u,teamName:"",league:t,logoUrl:""}),className:"text-gray-400 hover:text-white",children:s.jsx(At,{className:"w-5 h-5"})})]}):s.jsxs("div",{children:[s.jsx("div",{className:"flex gap-2 mb-3",children:r5.map(y=>s.jsx("button",{type:"button",onClick:()=>{n(y),m({...u,league:y})},className:`px-3 py-1.5 rounded text-sm font-medium transition-colors ${t===y?Fo(y)+" text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:y},y))}),s.jsxs("div",{className:"relative mb-3",children:[s.jsx(qt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx("input",{type:"text",value:r,onChange:y=>o(y.target.value),placeholder:"Search teams...",className:"w-full pl-9 pr-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500"})]}),s.jsx("div",{className:"max-h-48 overflow-y-auto grid grid-cols-2 gap-2",children:e.map(y=>s.jsxs("button",{type:"button",onClick:()=>x(y),className:"p-2 bg-gray-700 rounded hover:bg-gray-600 text-left transition-colors flex items-center gap-2",children:[s.jsx("div",{className:`w-8 h-8 rounded ${Fo(y.league)} flex items-center justify-center overflow-hidden flex-shrink-0`,children:y.logoUrl?s.jsx("img",{src:y.logoUrl,alt:y.name,className:"w-6 h-6 object-contain"}):s.jsx($a,{className:"w-4 h-4 text-white"})}),s.jsxs("div",{className:"min-w-0",children:[s.jsx("p",{className:"text-white text-sm font-medium truncate",children:y.name}),s.jsx("p",{className:"text-xs text-gray-400 truncate",children:y.city})]})]},y.name))})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Start Early (minutes)"}),s.jsx("input",{type:"number",value:u.prePadding,onChange:y=>m({...u,prePadding:parseInt(y.target.value)||0}),min:0,max:60,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Extend (minutes)"}),s.jsx("input",{type:"number",value:u.postPadding,onChange:y=>m({...u,postPadding:parseInt(y.target.value)||0}),min:0,max:120,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Extra time for overtime"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Keep Last N Recordings (0 = unlimited)"}),s.jsx("input",{type:"number",value:u.keepCount,onChange:y=>m({...u,keepCount:parseInt(y.target.value)||0}),min:0,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500"})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx("button",{type:"button",onClick:c,className:"px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600",children:"Cancel"}),s.jsxs("button",{type:"submit",disabled:!u.teamName||h,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[h&&s.jsx(ia,{className:"w-4 h-4 animate-spin"}),i?"Save Changes":"Add Team Pass"]})]})]})]})})}function c5({teamPass:i,games:e,onClose:t}){return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",children:s.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-2xl max-h-[80vh] flex flex-col",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-700",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold text-white",children:i.teamName}),s.jsx("p",{className:"text-sm text-gray-400",children:"Upcoming Games"})]}),s.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white",children:s.jsx(At,{className:"w-6 h-6"})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.length===0?s.jsxs("div",{className:"text-center py-8",children:[s.jsx(Ci,{className:"w-12 h-12 text-gray-600 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-400",children:"No upcoming games found"})]}):s.jsx("div",{className:"space-y-3",children:e.map((n,r)=>s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-white",children:n.program.title}),n.program.teams&&s.jsx("p",{className:"text-sm text-gray-300",children:n.program.teams})]}),n.program.league&&s.jsx("span",{className:`px-2 py-0.5 rounded text-xs text-white ${Fo(n.program.league)}`,children:n.program.league})]}),s.jsxs("div",{className:"mt-2 flex items-center gap-4 text-sm text-gray-400",children:[s.jsx("span",{className:"text-blue-400",children:d5(n.program.start)}),n.channel&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(ss,{className:"w-3 h-3"}),n.channel.name]})]})]},r))})})]})})}function Fo(i){switch(i?.toUpperCase()){case"NFL":return"bg-blue-600";case"NBA":return"bg-orange-600";case"MLB":return"bg-red-600";case"NHL":return"bg-gray-600";case"MLS":return"bg-green-600";default:return"bg-purple-600"}}function d5(i){const e=new Date(i),t=new Date,n=new Date(t);n.setDate(n.getDate()+1);const r=e.toDateString()===t.toDateString(),o=e.toDateString()===n.toDateString(),c=e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return r?`Today ${c}`:o?`Tomorrow ${c}`:e.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"})+` ${c}`}const Cg={scheduled:{icon:Ts,color:"text-blue-400",bgColor:"bg-blue-500/10",borderColor:"border-blue-500/30",label:"Scheduled"},recording:{icon:kr,color:"text-red-400 animate-pulse",bgColor:"bg-red-500/10",borderColor:"border-red-500/30",label:"Recording"},completed:{icon:vs,color:"text-green-400",bgColor:"bg-green-500/10",borderColor:"border-green-500/30",label:"Completed"},failed:{icon:Ct,color:"text-red-400",bgColor:"bg-red-500/10",borderColor:"border-red-500/30",label:"Failed"}};function u5(i){if(!i)return"";const e=i/(1024*1024*1024);return e>=1?`${e.toFixed(1)} GB`:`${(i/(1024*1024)).toFixed(0)} MB`}function h5(i){if(!i)return"";const e=Math.floor(i/60),t=i%60;return e>0?t>0?`${e}h ${t}m`:`${e}h`:`${t}m`}function $E(i,e){const t=new Date(i),n=new Date(e),r={hour:"numeric",minute:"2-digit"};return`${t.toLocaleTimeString([],r)} - ${n.toLocaleTimeString([],r)}`}function GE(i){const e=new Date(i),t=new Date,n=new Date(t);return n.setDate(n.getDate()+1),e.toDateString()===t.toDateString()?"Today":e.toDateString()===n.toDateString()?"Tomorrow":e.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"})}function f5({onClose:i}){const e=Sk(),[t,n]=P.useState(""),[r,o]=P.useState(!0),[c,d]=P.useState(5),h=async u=>{u.preventDefault(),await e.mutateAsync({title:t,anyChannel:r,anyTime:!0,keepCount:c,priority:0,prePadding:2,postPadding:5,enabled:!0}),i()};return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[s.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Create Series Rule"}),s.jsxs("form",{onSubmit:h,children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Series Title (keyword match)"}),s.jsx("input",{type:"text",value:t,onChange:u=>n(u.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"Game of Thrones",required:!0})]}),s.jsx("div",{className:"mb-4",children:s.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300",children:[s.jsx("input",{type:"checkbox",checked:r,onChange:u=>o(u.target.checked),className:"rounded bg-gray-700 border-gray-600"}),"Record from any channel"]})}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Keep last"}),s.jsxs("select",{value:c,onChange:u=>d(Number(u.target.value)),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:[s.jsx("option",{value:0,children:"All recordings"}),s.jsx("option",{value:3,children:"3 recordings"}),s.jsx("option",{value:5,children:"5 recordings"}),s.jsx("option",{value:10,children:"10 recordings"}),s.jsx("option",{value:20,children:"20 recordings"})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{type:"button",onClick:i,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:e.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:e.isPending?"Creating...":"Create"})]})]})]})})}function m5({conflict:i,onClose:e,onResolve:t,isResolving:n}){const[r,o]=P.useState(null),c=()=>{if(r===null)return;const d=i.recordings.filter(h=>h.id!==r).map(h=>h.id);d.length>0&&t(r,d[0])};return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(tn,{className:"w-5 h-5 text-amber-400"}),s.jsx("h2",{className:"text-lg font-semibold text-white",children:"Recording Conflict"})]}),s.jsx("button",{onClick:e,className:"p-1 text-gray-400 hover:text-white",children:s.jsx(At,{className:"w-5 h-5"})})]}),s.jsx("p",{className:"text-gray-400 mb-4",children:"These recordings overlap in time. Select which one to keep:"}),s.jsx("div",{className:"space-y-3 mb-6",children:i.recordings.map(d=>s.jsx("button",{onClick:()=>o(d.id),className:`w-full p-4 rounded-lg border text-left transition-colors ${r===d.id?"border-indigo-500 bg-indigo-500/10":"border-gray-600 bg-gray-700 hover:border-gray-500"}`,children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-white",children:d.title}),d.channelName&&s.jsx("p",{className:"text-sm text-gray-400",children:d.channelName}),s.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[GE(d.startTime)," ",$E(d.startTime,d.endTime)]})]}),r===d.id&&s.jsx(vs,{className:"w-5 h-5 text-indigo-400 flex-shrink-0"})]})},d.id))}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),s.jsx("button",{onClick:c,disabled:r===null||n,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg",children:n?"Resolving...":"Keep Selected"})]})]})})}function g5({recording:i,onClose:e,onSelect:t}){return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(kr,{className:"w-5 h-5 text-red-400 animate-pulse"}),s.jsx("h2",{className:"text-lg font-semibold text-white",children:"Now Recording"})]}),s.jsx("button",{onClick:e,className:"p-1 text-gray-400 hover:text-white",children:s.jsx(At,{className:"w-5 h-5"})})]}),s.jsx("p",{className:"text-gray-300 mb-2",children:i.title}),s.jsx("p",{className:"text-gray-500 text-sm mb-6",children:"This recording is currently in progress. How would you like to watch it?"}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:()=>t("start"),className:"w-full p-4 rounded-lg border border-gray-600 bg-gray-700 hover:border-indigo-500 hover:bg-gray-600 transition-colors text-left",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-indigo-500/20 rounded-lg",children:s.jsx(RS,{className:"w-5 h-5 text-indigo-400"})}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-white",children:"Watch from Start"}),s.jsx("p",{className:"text-sm text-gray-400",children:"Begin playback from the beginning"})]})]})}),s.jsx("button",{onClick:()=>t("live"),className:"w-full p-4 rounded-lg border border-gray-600 bg-gray-700 hover:border-red-500 hover:bg-gray-600 transition-colors text-left",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-red-500/20 rounded-lg",children:s.jsx(sn,{className:"w-5 h-5 text-red-400"})}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-white",children:"Watch Live"}),s.jsx("p",{className:"text-sm text-gray-400",children:"Jump to the current live position"})]})]})})]}),s.jsx("button",{onClick:e,className:"w-full mt-4 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg",children:"Cancel"})]})})}function p5({recording:i,onResume:e,onStartOver:t}){const n=r=>{const o=Math.floor(r/1e3),c=Math.floor(o/3600),d=Math.floor(o%3600/60),h=o%60;return c>0?`${c}:${d.toString().padStart(2,"0")}:${h.toString().padStart(2,"0")}`:`${d}:${h.toString().padStart(2,"0")}`};return s.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/70",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx(wn,{className:"w-6 h-6 text-indigo-400"}),s.jsx("h2",{className:"text-lg font-semibold text-white",children:"Resume Playback?"})]}),s.jsx("p",{className:"text-gray-300 mb-2",children:i.title}),s.jsxs("p",{className:"text-gray-500 text-sm mb-6",children:["You were watching at ",n(i.viewOffset||0),". Would you like to continue?"]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:e,className:"w-full p-4 rounded-lg border border-indigo-500 bg-indigo-500/20 hover:bg-indigo-500/30 transition-colors text-left",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-indigo-500/30 rounded-lg",children:s.jsx(wn,{className:"w-5 h-5 text-indigo-400"})}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-white",children:"Resume"}),s.jsxs("p",{className:"text-sm text-gray-400",children:["Continue from ",n(i.viewOffset||0)]})]})]})}),s.jsx("button",{onClick:t,className:"w-full p-4 rounded-lg border border-gray-600 bg-gray-700 hover:border-gray-500 hover:bg-gray-600 transition-colors text-left",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-gray-600 rounded-lg",children:s.jsx(RS,{className:"w-5 h-5 text-gray-400"})}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-white",children:"Start Over"}),s.jsx("p",{className:"text-sm text-gray-400",children:"Watch from the beginning"})]})]})})]})]})})}function x5({recording:i,onClose:e,startLive:t=!1}){const n=P.useRef(null),r=P.useRef(null),[o,c]=P.useState(!1),[d,h]=P.useState(0),[u,m]=P.useState(0),[g,x]=P.useState(!1),[y,v]=P.useState(!0),[S,N]=P.useState(null),[A,R]=P.useState(new Set),[C,D]=P.useState(!0),V=P.useRef(null),[z,B]=P.useState(!1),[I,M]=P.useState(null),L=P.useRef(null),O=P.useRef(0),{data:J,isLoading:ie}=qe({queryKey:["recording-stream",i.id],queryFn:()=>Re.getRecordingStreamUrl(i.id)}),{data:ne}=qe({queryKey:["recording-commercials",i.id],queryFn:()=>Re.getRecordingCommercials(i.id)}),se=ne?.segments||[];P.useEffect(()=>{i.viewOffset&&i.viewOffset>1e4&&!t&&i.status==="completed"&&B(!0)},[i.viewOffset,t,i.status]),P.useEffect(()=>{const xe=()=>{const pe=n.current;if(!pe||i.status!=="completed")return;const ee=Math.floor(pe.currentTime*1e3);Math.abs(ee-O.current)>5e3&&(O.current=ee,Re.updateRecordingProgress(i.id,ee).catch(()=>{}))};return L.current=window.setInterval(xe,15e3),()=>{const pe=n.current;if(pe&&i.status==="completed"){const ee=Math.floor(pe.currentTime*1e3);Re.updateRecordingProgress(i.id,ee).catch(()=>{})}L.current&&clearInterval(L.current)}},[i.id,i.status]),P.useEffect(()=>{const xe=n.current;xe&&I!==null&&u>0&&(xe.currentTime=I,M(null))},[I,u]),P.useEffect(()=>{const xe=n.current;if(!xe||!J)return;const pe=localStorage.getItem("token");if(J.includes(".m3u8"))if(us.isSupported()){const ee=new us({enableWorker:!0,lowLatencyMode:!1,xhrSetup:re=>{pe&&re.setRequestHeader("Authorization",`Bearer ${pe}`)}});r.current=ee,ee.loadSource(J),ee.attachMedia(xe),ee.on(us.Events.MANIFEST_PARSED,()=>{xe.play().catch(()=>{})}),ee.on(us.Events.ERROR,(re,je)=>{je.fatal&&(console.error("HLS fatal error:",je.type,je.details),je.type===us.ErrorTypes.NETWORK_ERROR?ee.startLoad():je.type===us.ErrorTypes.MEDIA_ERROR&&ee.recoverMediaError())})}else xe.canPlayType("application/vnd.apple.mpegurl")&&(xe.src=J,xe.play().catch(()=>{}));else xe.src=J,xe.play().catch(()=>{});return()=>{r.current&&(r.current.destroy(),r.current=null)}},[J]);const X=P.useCallback(xe=>se.find(pe=>xe>=pe.startTime&&xe<pe.endTime)||null,[se]);P.useEffect(()=>{const xe=n.current;if(!xe)return;const pe=()=>{const Fe=xe.currentTime;h(Fe);const We=X(Fe);N(We),We&&y&&!A.has(We.id)&&(R(he=>new Set(he).add(We.id)),xe.currentTime=We.endTime)},ee=()=>m(xe.duration),re=()=>c(!0),je=()=>c(!1);return xe.addEventListener("timeupdate",pe),xe.addEventListener("durationchange",ee),xe.addEventListener("play",re),xe.addEventListener("pause",je),()=>{xe.removeEventListener("timeupdate",pe),xe.removeEventListener("durationchange",ee),xe.removeEventListener("play",re),xe.removeEventListener("pause",je)}},[y,A,X]),P.useEffect(()=>(C&&o&&(V.current&&clearTimeout(V.current),V.current=window.setTimeout(()=>{D(!1)},3e3)),()=>{V.current&&clearTimeout(V.current)}),[C,o]),P.useEffect(()=>{if(t&&u>0&&n.current){const xe=Math.max(0,u-10);n.current.currentTime=xe}},[t,u]);const ce=i.status==="recording",le=()=>{n.current&&u>0&&(n.current.currentTime=Math.max(0,u-5))},Y=()=>{D(!0)},K=()=>{const xe=n.current;xe&&(o?xe.pause():xe.play())},H=()=>{S&&n.current&&(R(xe=>new Set(xe).add(S.id)),n.current.currentTime=S.endTime)},Q=xe=>{n.current&&(n.current.currentTime=xe,R(new Set))},oe=xe=>{const pe=Math.floor(xe/3600),ee=Math.floor(xe%3600/60),re=Math.floor(xe%60);return pe>0?`${pe}:${ee.toString().padStart(2,"0")}:${re.toString().padStart(2,"0")}`:`${ee}:${re.toString().padStart(2,"0")}`},ye=()=>{const xe=document.getElementById("dvr-player-container");xe&&(document.fullscreenElement?document.exitFullscreen():xe.requestFullscreen())};return s.jsxs("div",{className:"fixed inset-0 z-50 bg-black",children:[s.jsxs("div",{id:"dvr-player-container",className:"relative w-full h-full",onMouseMove:Y,onClick:Y,children:[ie?s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx(nt,{className:"w-12 h-12 text-white animate-spin"})}):J?s.jsx("video",{ref:n,className:"w-full h-full object-contain",muted:g}):s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx("p",{className:"text-red-400",children:"Failed to load video"})}),S&&!y&&s.jsxs("button",{onClick:H,className:"absolute bottom-32 right-8 px-6 py-3 bg-yellow-500 hover:bg-yellow-400 text-black font-semibold rounded-lg flex items-center gap-2 transition-colors",children:[s.jsx(n0,{className:"w-5 h-5"}),s.jsxs("div",{children:[s.jsx("div",{children:"Skip Ad"}),s.jsxs("div",{className:"text-xs opacity-75",children:[Math.ceil(S.endTime-d),"s remaining"]})]})]}),S&&y&&s.jsx("div",{className:"absolute bottom-32 right-8 px-4 py-2 bg-indigo-600 text-white rounded-lg",children:"Skipping commercial..."}),s.jsxs("div",{className:`absolute inset-0 transition-opacity duration-300 ${C?"opacity-100":"opacity-0 pointer-events-none"}`,children:[s.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/80 to-transparent",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("button",{onClick:e,className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",children:s.jsx(At,{className:"w-6 h-6"})}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("h2",{className:"text-xl font-semibold text-white",children:i.title}),ce&&s.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 bg-red-500 text-white text-xs font-bold rounded animate-pulse",children:[s.jsx(kr,{className:"w-3 h-3"}),"LIVE"]})]}),i.episodeNum&&s.jsx("p",{className:"text-sm text-gray-300",children:i.episodeNum})]})]}),se.length>0&&s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("span",{className:"text-sm text-yellow-400",children:[se.length," commercial break",se.length>1?"s":""," detected"]}),s.jsxs("button",{onClick:()=>v(!y),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${y?"bg-green-500/20 text-green-400 hover:bg-green-500/30":"bg-gray-500/20 text-gray-400 hover:bg-gray-500/30"}`,children:[y?s.jsx(a0,{className:"w-4 h-4"}):s.jsx(i0,{className:"w-4 h-4"}),"Auto-Skip ",y?"ON":"OFF"]})]})]})}),s.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent",children:[s.jsx("div",{className:"relative mb-4",children:s.jsxs("div",{className:"relative h-2 bg-white/30 rounded-full cursor-pointer group",onClick:xe=>{const pe=xe.currentTarget.getBoundingClientRect(),ee=(xe.clientX-pe.left)/pe.width;Q(ee*u)},children:[se.map(xe=>{const pe=xe.startTime/u*100,ee=(xe.endTime-xe.startTime)/u*100;return s.jsx("div",{className:"absolute top-0 h-full bg-yellow-500/80",style:{left:`${pe}%`,width:`${Math.max(ee,.5)}%`}},xe.id)}),s.jsx("div",{className:"absolute top-0 left-0 h-full bg-indigo-500 rounded-full",style:{width:`${d/u*100}%`}}),s.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 w-4 h-4 bg-white rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",style:{left:`calc(${d/u*100}% - 8px)`}})]})}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("button",{onClick:K,className:"p-3 bg-white/20 hover:bg-white/30 rounded-full transition-colors",children:o?s.jsx(Yo,{className:"w-6 h-6 text-white"}):s.jsx(wn,{className:"w-6 h-6 text-white"})}),s.jsx("button",{onClick:()=>x(!g),className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",children:g?s.jsx(o0,{className:"w-5 h-5"}):s.jsx(r0,{className:"w-5 h-5"})}),s.jsxs("span",{className:"text-sm text-white",children:[oe(d)," / ",oe(u)]}),ce&&s.jsxs("button",{onClick:le,className:"flex items-center gap-1.5 px-3 py-1.5 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-lg text-sm font-medium transition-colors",children:[s.jsx(sn,{className:"w-4 h-4"}),"LIVE"]})]}),s.jsx("button",{onClick:ye,className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",children:s.jsx(e0,{className:"w-5 h-5"})})]})]})]})]}),z&&s.jsx(p5,{recording:i,onResume:()=>{B(!1),i.viewOffset&&M(i.viewOffset/1e3)},onStartOver:()=>{B(!1),Re.updateRecordingProgress(i.id,0).catch(()=>{})}})]})}function y5({recording:i,onDelete:e,onPlay:t,onDetectCommercials:n,isDetecting:r,liveStats:o,isSelected:c,onToggleSelect:d,selectionMode:h}){const u=Cg[i.status],m=u.icon,g=i.status==="recording",x=i.thumb||i.art||i.channelLogo,y=i.art||i.thumb;return s.jsxs("div",{className:`bg-gray-800 rounded-xl overflow-hidden border ${u.borderColor} hover:border-gray-600 transition-colors`,children:[g&&o&&s.jsx("div",{className:"h-1 bg-gray-700",children:s.jsx("div",{className:`h-full transition-all duration-1000 ${o.isFailed?"bg-red-600":"bg-green-500"}`,style:{width:`${o.isFailed?100:o.progressPercent}%`}})}),s.jsx("div",{className:"p-4",children:s.jsxs("div",{className:"flex items-start gap-4",children:[h&&d&&s.jsx("button",{onClick:v=>{v.stopPropagation(),d()},className:"flex-shrink-0 p-1 -ml-1 mt-1",children:c?s.jsx(QC,{className:"w-5 h-5 text-indigo-400"}):s.jsx(ZC,{className:"w-5 h-5 text-gray-500 hover:text-gray-300"})}),s.jsxs("div",{className:`flex-shrink-0 relative ${i.isMovie?"w-24 h-36":"w-40 h-24"} rounded-lg overflow-hidden bg-gray-700`,children:[x?s.jsx("img",{src:i.isMovie?x:y||x,alt:i.title,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center",children:s.jsx(la,{className:"w-8 h-8 text-gray-600"})}),i.channelLogo&&!i.isMovie&&s.jsx("div",{className:"absolute bottom-1 right-1 w-8 h-8 bg-black/70 rounded p-1",children:s.jsx("img",{src:i.channelLogo,alt:i.channelName||"",className:"w-full h-full object-contain"})}),s.jsx("div",{className:`absolute top-1 left-1 p-1.5 rounded ${u.bgColor}`,children:s.jsx(m,{className:`w-3.5 h-3.5 ${u.color}`})}),i.status==="completed"&&i.viewOffset&&i.duration&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-black/60",children:s.jsx("div",{className:"h-full bg-indigo-500",style:{width:`${Math.min(100,i.viewOffset/(i.duration*6e4)*100)}%`}})})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"min-w-0",children:[s.jsx("h4",{className:"font-medium text-white truncate",children:i.title}),i.episodeNum&&s.jsx("p",{className:"text-sm text-gray-400",children:i.episodeNum})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[g&&o&&s.jsx("span",{title:o.isHealthy?"Recording healthy":"Recording may have issues",children:o.isHealthy?s.jsx(Dj,{className:"w-4 h-4 text-green-400"}):s.jsx(Lj,{className:"w-4 h-4 text-red-400"})}),s.jsx("span",{className:`flex-shrink-0 px-2 py-0.5 text-xs font-medium rounded ${u.bgColor} ${u.color}`,children:u.label})]})]}),s.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-sm",children:[i.year&&s.jsx("span",{className:"text-gray-400",children:i.year}),i.contentRating&&s.jsx("span",{className:"px-1.5 py-0.5 text-xs border border-gray-600 text-gray-400 rounded",children:i.contentRating}),i.rating&&i.rating>0&&s.jsxs("span",{className:"flex items-center gap-1 text-gray-400",children:[s.jsx("span",{className:"text-yellow-400",children:""}),i.rating.toFixed(1)]}),i.isMovie&&s.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-indigo-500/20 text-indigo-400 rounded",children:"MOVIE"}),i.isLive&&s.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-red-500 text-white font-bold rounded animate-pulse",children:"LIVE"})]}),g&&o&&s.jsx("div",{className:`mt-3 p-3 rounded-lg border ${o.isFailed?"bg-red-900/30 border-red-500/40":"bg-gray-900/50 border-red-500/20"}`,children:o.isFailed?s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Ct,{className:"w-5 h-5 text-red-400 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-red-400 font-medium",children:"Recording Failed"}),s.jsx("p",{className:"text-sm text-gray-400",children:o.failureReason})]})]}):s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Li,{className:"w-4 h-4 text-red-400"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-white font-medium",children:o.fileSizeFormatted}),s.jsx("p",{className:"text-xs text-gray-500",children:"File Size"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(zv,{className:"w-4 h-4 text-red-400"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-white font-medium",children:o.elapsedFormatted}),s.jsx("p",{className:"text-xs text-gray-500",children:"Elapsed"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Do,{className:"w-4 h-4 text-red-400"}),s.jsxs("div",{children:[s.jsxs("p",{className:"text-white font-medium",children:[Math.round(o.progressPercent),"%"]}),s.jsx("p",{className:"text-xs text-gray-500",children:"Progress"})]})]}),o.bitrate&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx($n,{className:"w-4 h-4 text-red-400"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-white font-medium",children:o.bitrate}),s.jsx("p",{className:"text-xs text-gray-500",children:"Bitrate"})]})]})]})}),s.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-gray-400",children:[i.channelName&&!i.channelLogo&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(ss,{className:"w-3.5 h-3.5"}),i.channelName]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Ci,{className:"w-3.5 h-3.5"}),GE(i.startTime)]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Ts,{className:"w-3.5 h-3.5"}),$E(i.startTime,i.endTime)]}),i.duration&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(zv,{className:"w-3.5 h-3.5"}),h5(i.duration)]}),!g&&i.fileSize&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Li,{className:"w-3.5 h-3.5"}),u5(i.fileSize)]})]}),i.genres&&s.jsx("p",{className:"mt-1 text-xs text-gray-500 truncate",children:i.genres}),(i.summary||i.description)&&s.jsx("p",{className:"mt-2 text-sm text-gray-500 line-clamp-2",children:i.summary||i.description}),s.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[i.status==="completed"&&i.duration&&(()=>{const v=i.duration*6e4,S=i.viewOffset?i.viewOffset/v*100:0;return S>=90?s.jsxs("span",{className:"px-2 py-0.5 text-xs bg-green-500/20 text-green-400 rounded flex items-center gap-1",children:[s.jsx(vs,{className:"w-3 h-3"}),"Watched"]}):S>5?s.jsxs("span",{className:"px-2 py-0.5 text-xs bg-blue-500/20 text-blue-400 rounded",children:[Math.round(S),"% watched"]}):s.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-600/50 text-gray-400 rounded",children:"Unwatched"})})(),i.category&&!i.isMovie&&s.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-700 text-gray-300 rounded",children:i.category}),i.seriesRecord&&s.jsx("span",{className:"px-2 py-0.5 text-xs bg-indigo-500/20 text-indigo-400 rounded",children:"Series Recording"})]})]}),s.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1",children:[(i.status==="completed"||i.status==="recording")&&t&&s.jsx("button",{onClick:t,className:`p-2 hover:bg-gray-700 rounded-lg transition-colors ${i.status==="recording"?"text-red-400 hover:text-red-300":"text-gray-400 hover:text-green-400"}`,title:i.status==="recording"?"Watch":"Play",children:s.jsx(wn,{className:"w-4 h-4"})}),i.status==="completed"&&n&&s.jsx("button",{onClick:n,disabled:r,className:"p-2 text-gray-400 hover:text-indigo-400 hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50",title:"Detect Commercials",children:r?s.jsx(nt,{className:"w-4 h-4 animate-spin"}):s.jsx(Jl,{className:"w-4 h-4"})}),s.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Delete",children:s.jsx(ts,{className:"w-4 h-4"})})]})]})})]})}function v5({recordings:i}){const e=P.useMemo(()=>{const d=new Date,h=new Date(d.getTime()+10080*60*1e3);return i.filter(u=>u.status==="scheduled"||u.status==="recording").filter(u=>{const m=new Date(u.startTime);return(u.endTime?new Date(u.endTime):new Date(m.getTime()+3600*1e3))>=d&&m<=h}).sort((u,m)=>new Date(u.startTime).getTime()-new Date(m.startTime).getTime())},[i]),t=P.useMemo(()=>{const d=new Map;return e.forEach(h=>{const u=new Date(h.startTime).toDateString(),m=d.get(u)||[];m.push(h),d.set(u,m)}),d},[e]),n=P.useMemo(()=>{const d=[],h=new Date;for(let u=0;u<7;u++){const m=new Date(h);m.setDate(h.getDate()+u),m.setHours(0,0,0,0),d.push(m)}return d},[]),r=d=>{const h=new Date,u=new Date(h);return u.setDate(u.getDate()+1),d.toDateString()===h.toDateString()?"Today":d.toDateString()===u.toDateString()?"Tomorrow":d.toLocaleDateString([],{weekday:"short"})},o=d=>d.toLocaleDateString([],{month:"short",day:"numeric"}),c=d=>new Date(d).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx(Ci,{className:"w-5 h-5 text-indigo-400"}),s.jsx("h3",{className:"font-semibold text-white",children:"Upcoming Recordings (Next 7 Days)"})]}),e.length===0?s.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[s.jsx(Ci,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No upcoming recordings"}),s.jsx("p",{className:"text-gray-400",children:"Schedule recordings from the TV Guide"})]}):s.jsx("div",{className:"grid grid-cols-7 gap-2",children:n.map(d=>{const h=d.toDateString(),u=t.get(h)||[],m=d.toDateString()===new Date().toDateString();return s.jsxs("div",{className:`bg-gray-800 rounded-xl p-3 min-h-[200px] ${m?"border border-indigo-500/50":""}`,children:[s.jsxs("div",{className:`text-center mb-3 pb-2 border-b border-gray-700 ${m?"text-indigo-400":"text-gray-400"}`,children:[s.jsx("div",{className:"font-medium",children:r(d)}),s.jsx("div",{className:"text-sm",children:o(d)})]}),s.jsxs("div",{className:"space-y-2",children:[u.map(g=>s.jsxs("div",{className:`p-2 rounded-lg text-xs ${g.status==="recording"?"bg-red-500/20 border border-red-500/40":"bg-blue-500/10 border border-blue-500/30"}`,children:[s.jsx("div",{className:`font-medium truncate ${g.status==="recording"?"text-red-300":"text-white"}`,children:g.title}),s.jsxs("div",{className:"text-gray-400 mt-0.5 flex items-center gap-1",children:[s.jsx(Ts,{className:"w-3 h-3"}),c(g.startTime)]}),g.channelName&&s.jsx("div",{className:"text-gray-500 truncate",children:g.channelName}),g.status==="recording"&&s.jsxs("div",{className:"flex items-center gap-1 text-red-400 mt-1",children:[s.jsx(kr,{className:"w-3 h-3 animate-pulse"}),"Recording"]})]},g.id)),u.length===0&&s.jsx("div",{className:"text-center text-gray-600 text-xs py-4",children:"No recordings"})]})]},h)})})]})}function b5({recordings:i}){const e=P.useMemo(()=>{const n=i.filter(u=>u.status==="completed"),r=n.reduce((u,m)=>u+(m.fileSize||0),0),o=n.filter(u=>{if(!u.viewOffset||!u.duration)return!1;const m=u.duration*6e4;return u.viewOffset/m>=.9}).length,c=n.length-o,d=new Map;n.forEach(u=>{const m=u.title,g=d.get(m)||{count:0,size:0};g.count++,g.size+=u.fileSize||0,d.set(m,g)});const h=Array.from(d.entries()).sort((u,m)=>m[1].size-u[1].size).slice(0,5);return{totalSize:r,totalCount:n.length,watchedCount:o,unwatchedCount:c,topTitles:h}},[i]),t=n=>{if(n===0)return"0 B";const r=n/(1024*1024*1024);if(r>=1)return`${r.toFixed(1)} GB`;const o=n/(1024*1024);return o>=1?`${o.toFixed(0)} MB`:`${(n/1024).toFixed(0)} KB`};return s.jsxs("div",{className:"bg-gray-800 rounded-xl p-5 mb-6",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx(Li,{className:"w-5 h-5 text-indigo-400"}),s.jsx("h3",{className:"font-semibold text-white",children:"Storage"})]}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[s.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-3",children:[s.jsx("p",{className:"text-2xl font-bold text-white",children:t(e.totalSize)}),s.jsx("p",{className:"text-sm text-gray-400",children:"Total Used"})]}),s.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-3",children:[s.jsx("p",{className:"text-2xl font-bold text-white",children:e.totalCount}),s.jsx("p",{className:"text-sm text-gray-400",children:"Recordings"})]}),s.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-3",children:[s.jsx("p",{className:"text-2xl font-bold text-green-400",children:e.watchedCount}),s.jsx("p",{className:"text-sm text-gray-400",children:"Watched"})]}),s.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-3",children:[s.jsx("p",{className:"text-2xl font-bold text-blue-400",children:e.unwatchedCount}),s.jsx("p",{className:"text-sm text-gray-400",children:"Unwatched"})]})]}),e.topTitles.length>0&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Storage by Series"}),s.jsx("div",{className:"space-y-2",children:e.topTitles.map(([n,r])=>{const o=e.totalSize>0?r.size/e.totalSize*100:0;return s.jsx("div",{className:"flex items-center gap-3",children:s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("span",{className:"text-sm text-white truncate",children:n}),s.jsxs("span",{className:"text-xs text-gray-400 ml-2",children:[r.count," rec  ",t(r.size)]})]}),s.jsx("div",{className:"h-1.5 bg-gray-700 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-indigo-500 rounded-full",style:{width:`${o}%`}})})]})},n)})})]})]})}function _5(){const{data:i,isLoading:e}=l1(),{data:t,isLoading:n}=_k(),{data:r}=Nk(),{data:o}=Tk(),{data:c}=qe({queryKey:["dvrSettings"],queryFn:()=>Re.getDVRSettings()}),d=bk(),h=Ek(),u=wk(),[m,g]=P.useState(!1),[x,y]=P.useState("recordings"),[v,S]=P.useState(null),N=c?.maxConcurrentRecordings!==void 0&&c.maxConcurrentRecordings>0,[A,R]=P.useState(null),[C,D]=P.useState(!1),[V,z]=P.useState(null),[B,I]=P.useState(""),[M,L]=P.useState(new Set),[O,J]=P.useState(!1),[ie,ne]=P.useState(null),{data:se}=qe({queryKey:["commercialDetectionStatus"],queryFn:()=>Re.getCommercialDetectionStatus()}),X=async pe=>{ne(pe);try{await Re.runCommercialDetection(pe)}catch(ee){console.error("Commercial detection failed:",ee)}finally{ne(null)}},ce=P.useMemo(()=>{if(!i||!B.trim())return i;const pe=B.toLowerCase();return i.filter(ee=>ee.title?.toLowerCase().includes(pe)||ee.description?.toLowerCase().includes(pe)||ee.summary?.toLowerCase().includes(pe)||ee.channelName?.toLowerCase().includes(pe)||ee.genres?.toLowerCase().includes(pe)||ee.episodeNum?.toLowerCase().includes(pe))},[i,B]),le=M.size>0,Y=pe=>{L(ee=>{const re=new Set(ee);return re.has(pe)?re.delete(pe):re.add(pe),re})},K=pe=>{const ee=ce?.filter(re=>re.status===pe)||[];L(re=>{const je=new Set(re);return ee.forEach(Fe=>je.add(Fe.id)),je})},H=()=>{L(new Set)},Q=async()=>{if(M.size===0)return;const pe=`Are you sure you want to delete ${M.size} recording${M.size>1?"s":""}?`;if(!confirm(pe))return;J(!0);const ee=Array.from(M);for(const re of ee)try{await d.mutateAsync(re)}catch{}L(new Set),J(!1)},oe=new Map;o?.stats?.forEach(pe=>{oe.set(pe.id,pe)});const ye=ce?.reduce((pe,ee)=>(pe[ee.status]=pe[ee.status]||[],pe[ee.status].push(ee),pe),{}),xe=(pe,ee)=>{u.mutate({keepId:pe,cancelId:ee},{onSuccess:()=>{S(null)}})};return s.jsxs("div",{children:[s.jsxs("div",{className:"mb-8",children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"DVR"}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Manage recordings and series rules"})]}),N&&r?.hasConflicts&&s.jsx("div",{className:"mb-6 p-4 bg-amber-500/10 border border-amber-500/30 rounded-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(tn,{className:"w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("h3",{className:"font-medium text-amber-400",children:[r.totalCount," Recording Conflict",r.totalCount>1?"s":""," Detected"]}),s.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["Some of your scheduled recordings overlap in time. Only ",c?.maxConcurrentRecordings," can be recorded at a time."]}),s.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:r.conflicts.map((pe,ee)=>s.jsx("button",{onClick:()=>S(pe),className:"px-3 py-1.5 text-sm bg-amber-500/20 hover:bg-amber-500/30 text-amber-300 rounded-lg transition-colors",children:pe.recordings.map(re=>re.title).join(" vs ")},ee))})]})]})}),s.jsxs("div",{className:"flex gap-2 mb-6",children:[s.jsx("button",{onClick:()=>y("recordings"),className:`px-4 py-2 rounded-lg font-medium ${x==="recordings"?"bg-indigo-600 text-white":"bg-gray-800 text-gray-400 hover:text-white"}`,children:"Recordings"}),s.jsx("button",{onClick:()=>y("rules"),className:`px-4 py-2 rounded-lg font-medium ${x==="rules"?"bg-indigo-600 text-white":"bg-gray-800 text-gray-400 hover:text-white"}`,children:"Series Rules"}),s.jsxs("button",{onClick:()=>y("calendar"),className:`px-4 py-2 rounded-lg font-medium flex items-center gap-2 ${x==="calendar"?"bg-indigo-600 text-white":"bg-gray-800 text-gray-400 hover:text-white"}`,children:[s.jsx(Ci,{className:"w-4 h-4"}),"Calendar"]})]}),x==="recordings"&&s.jsxs("div",{children:[s.jsx("div",{className:"mb-6 flex flex-col sm:flex-row gap-4",children:s.jsxs("div",{className:"relative flex-1",children:[s.jsx(qt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search recordings by title, channel, description...",value:B,onChange:pe=>I(pe.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"}),B&&s.jsx("button",{onClick:()=>I(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-white",children:s.jsx(At,{className:"w-4 h-4"})})]})}),le&&s.jsxs("div",{className:"mb-4 p-3 bg-indigo-600/20 border border-indigo-500/30 rounded-lg flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("span",{className:"text-indigo-300 font-medium",children:[M.size," selected"]}),s.jsx("button",{onClick:H,className:"text-sm text-gray-400 hover:text-white",children:"Clear selection"})]}),s.jsxs("button",{onClick:Q,disabled:O,className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 disabled:opacity-50 text-white rounded-lg font-medium",children:[O?s.jsx(nt,{className:"w-4 h-4 animate-spin"}):s.jsx(ts,{className:"w-4 h-4"}),"Delete Selected"]})]}),e?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx(nt,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):i?.length?s.jsxs("div",{className:"space-y-8",children:[s.jsx("div",{className:"grid grid-cols-4 gap-4",children:["scheduled","recording","completed","failed"].map(pe=>{const ee=ye?.[pe]?.length||0,re=Cg[pe],je=re.icon;return s.jsx("div",{className:`p-4 rounded-xl border ${re.borderColor} ${re.bgColor}`,children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(je,{className:`w-5 h-5 ${re.color}`}),s.jsxs("div",{children:[s.jsx("p",{className:"text-2xl font-bold text-white",children:ee}),s.jsx("p",{className:"text-sm text-gray-400",children:re.label})]})]})},pe)})}),s.jsx(b5,{recordings:i}),["recording","scheduled","completed","failed"].map(pe=>{const ee=ye?.[pe];if(!ee?.length)return null;const re=Cg[pe],je=re.icon;return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h3",{className:"text-sm font-medium text-gray-400 uppercase tracking-wider flex items-center gap-2",children:[s.jsx(je,{className:`h-4 w-4 ${re.color}`}),re.label," (",ee.length,")"]}),ee.length>0&&s.jsxs("button",{onClick:()=>K(pe),className:"text-xs text-indigo-400 hover:text-indigo-300",children:["Select all ",re.label.toLowerCase()]})]}),s.jsx("div",{className:"space-y-3",children:ee.map(Fe=>s.jsx(y5,{recording:Fe,onDelete:()=>d.mutate(Fe.id),onPlay:Fe.status==="completed"||Fe.status==="recording"?()=>{Fe.status==="recording"?z(Fe):(D(!1),R(Fe))}:void 0,onDetectCommercials:se?.enabled?()=>X(Fe.id):void 0,isDetecting:ie===Fe.id,liveStats:oe.get(Fe.id),isSelected:M.has(Fe.id),onToggleSelect:()=>Y(Fe.id),selectionMode:!0},Fe.id))})]},pe)})]}):B&&i?.length?s.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[s.jsx(qt,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No matches found"}),s.jsxs("p",{className:"text-gray-400",children:['No recordings match "',B,'"']}),s.jsx("button",{onClick:()=>I(""),className:"mt-4 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Clear search"})]}):s.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[s.jsx(la,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No recordings"}),s.jsx("p",{className:"text-gray-400",children:"Schedule recordings from On Later or the EPG Guide"})]})]}),x==="rules"&&s.jsxs("div",{children:[s.jsx("div",{className:"flex justify-end mb-4",children:s.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[s.jsx(rs,{className:"h-4 w-4"}),"Add Series Rule"]})}),n?s.jsx("div",{className:"text-gray-400",children:"Loading..."}):t?.length?s.jsx("div",{className:"bg-gray-800 rounded-xl divide-y divide-gray-700",children:t.map(pe=>s.jsxs("div",{className:"p-4 flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-white",children:pe.title}),s.jsxs("p",{className:"text-sm text-gray-400",children:[pe.anyChannel?"Any channel":"Specific channel","  Keep ",pe.keepCount===0?"all":`last ${pe.keepCount}`,"  ",pe.enabled?s.jsx("span",{className:"text-green-400",children:"Enabled"}):s.jsx("span",{className:"text-gray-500",children:"Disabled"})]})]}),s.jsx("button",{onClick:()=>h.mutate(pe.id),className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg",title:"Delete",children:s.jsx(ts,{className:"h-4 w-4"})})]},pe.id))}):s.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[s.jsx(la,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No series rules"}),s.jsx("p",{className:"text-gray-400 mb-4",children:"Create rules to automatically record shows"}),s.jsxs("button",{onClick:()=>g(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[s.jsx(rs,{className:"h-4 w-4"}),"Add Series Rule"]})]})]}),x==="calendar"&&i&&s.jsx(v5,{recordings:i}),m&&s.jsx(f5,{onClose:()=>g(!1)}),v&&s.jsx(m5,{conflict:v,onClose:()=>S(null),onResolve:xe,isResolving:u.isPending}),V&&s.jsx(g5,{recording:V,onClose:()=>z(null),onSelect:pe=>{D(pe==="live"),R(V),z(null)}}),A&&s.jsx(x5,{recording:A,onClose:()=>{R(null),D(!1)},startLive:C})]})}function S5({title:i,streamUrl:e,onClose:t}){const n=P.useRef(null),r=P.useRef(null),[o,c]=P.useState(!0),[d,h]=P.useState(null),[u,m]=P.useState(!1),[g,x]=P.useState(!0),[y,v]=P.useState(!0),[S,N]=P.useState(0),[A,R]=P.useState(0),C=P.useRef(null),D=()=>{const O=n.current;O&&(O.paused?(O.play().catch(()=>{}),x(!0)):(O.pause(),x(!1)))},V=()=>{const O=n.current;O&&(O.currentTime=Math.max(0,O.currentTime-10))},z=()=>{const O=n.current;O&&(O.currentTime=O.currentTime+10)},B=O=>{const J=n.current;J&&(J.currentTime=parseFloat(O.target.value))},I=O=>{const J=Math.floor(O/3600),ie=Math.floor(O%3600/60),ne=Math.floor(O%60);return J>0?`${J}:${ie.toString().padStart(2,"0")}:${ne.toString().padStart(2,"0")}`:`${ie}:${ne.toString().padStart(2,"0")}`};P.useEffect(()=>{const O=n.current;if(!O||!e)return;c(!0),h(null);const J=()=>{N(O.currentTime)},ie=()=>{R(O.duration)},ne=()=>{x(!1)};if(O.addEventListener("timeupdate",J),O.addEventListener("loadedmetadata",ie),O.addEventListener("ended",ne),us.isSupported()){const se=new us({enableWorker:!0,lowLatencyMode:!1});r.current=se,se.on(us.Events.MANIFEST_PARSED,()=>{c(!1),O.play().catch(()=>{})}),se.on(us.Events.ERROR,(X,ce)=>{ce.fatal&&(console.error("HLS error:",ce),se.destroy(),r.current=null,O.src=e,O.play().catch(le=>{h(`Playback error: ${le.message}`),c(!1)}))}),se.loadSource(e),se.attachMedia(O)}else O.canPlayType("application/vnd.apple.mpegurl")?(O.src=e,O.addEventListener("loadedmetadata",()=>{c(!1),O.play().catch(()=>{})})):(O.src=e,O.addEventListener("canplay",()=>{c(!1),O.play().catch(()=>{})}),O.addEventListener("error",()=>{h("Unable to play this video format"),c(!1)}));return()=>{O.removeEventListener("timeupdate",J),O.removeEventListener("loadedmetadata",ie),O.removeEventListener("ended",ne),r.current&&(r.current.destroy(),r.current=null)}},[e]),P.useEffect(()=>(y&&(C.current&&clearTimeout(C.current),C.current=window.setTimeout(()=>{v(!1)},3e3)),()=>{C.current&&clearTimeout(C.current)}),[y]);const M=()=>v(!0),L=()=>{const O=document.getElementById("vod-player-container");O&&(document.fullscreenElement?document.exitFullscreen():O.requestFullscreen())};return s.jsx("div",{className:"fixed inset-0 z-50 bg-black",children:s.jsxs("div",{id:"vod-player-container",className:"relative w-full h-full",onMouseMove:M,onClick:M,children:[o&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsx(nt,{className:"w-12 h-12 text-white animate-spin"})}),d?s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-red-400 text-lg mb-4",children:d}),s.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Close"})]})}):s.jsx("video",{ref:n,className:"w-full h-full object-contain",muted:u,playsInline:!0}),s.jsxs("div",{className:`absolute inset-0 transition-opacity duration-300 ${y?"opacity-100":"opacity-0 pointer-events-none"}`,children:[s.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/80 to-transparent",children:s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("button",{onClick:t,className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",children:s.jsx(At,{className:"w-6 h-6"})}),s.jsx("div",{children:s.jsx("h2",{className:"text-xl font-semibold text-white",children:i})})]})})}),s.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent",children:[A>0&&s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("span",{className:"text-white text-sm",children:I(S)}),s.jsx("input",{type:"range",min:"0",max:A,value:S,onChange:B,className:"flex-1 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-white"}),s.jsx("span",{className:"text-white text-sm",children:I(A)})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("button",{onClick:()=>m(!u),className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",title:u?"Unmute":"Mute",children:u?s.jsx(o0,{className:"w-6 h-6"}):s.jsx(r0,{className:"w-6 h-6"})})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:V,className:"p-3 text-white hover:bg-white/20 rounded-full transition-colors",title:"Rewind 10s",children:s.jsx(DS,{className:"w-6 h-6"})}),s.jsx("button",{onClick:D,className:"p-4 text-white bg-white/20 hover:bg-white/30 rounded-full transition-colors",title:g?"Pause":"Play",children:g?s.jsx(Yo,{className:"w-8 h-8"}):s.jsx(wn,{className:"w-8 h-8"})}),s.jsx("button",{onClick:z,className:"p-3 text-white hover:bg-white/20 rounded-full transition-colors",title:"Forward 10s",children:s.jsx(n0,{className:"w-6 h-6"})})]}),s.jsx("button",{onClick:L,className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",title:"Fullscreen",children:s.jsx(e0,{className:"w-6 h-6"})})]})]})]})]})})}function E5({movie:i,onClose:e,onDownload:t,onPlay:n,isDownloading:r}){return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"relative",children:[i.poster&&s.jsx("div",{className:"h-48 bg-gradient-to-b from-gray-700 to-gray-800 overflow-hidden",children:s.jsx("img",{src:i.poster,alt:i.title,className:"w-full h-full object-cover opacity-30"})}),s.jsx("button",{onClick:e,className:"absolute top-4 right-4 p-2 bg-black/50 hover:bg-black/70 rounded-full text-white",children:s.jsx(At,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex gap-6",children:[i.poster&&s.jsx("div",{className:"flex-shrink-0 w-32",children:s.jsx("img",{src:i.poster,alt:i.title,className:"w-full rounded-lg shadow-lg"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h2",{className:"text-2xl font-bold text-white",children:i.title}),s.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-2 text-sm text-gray-400",children:[i.year&&s.jsx("span",{children:i.year}),i.runtime&&s.jsx("span",{children:i.runtime}),i.rating&&s.jsx("span",{className:"px-2 py-0.5 border border-gray-600 rounded",children:i.rating})]}),i.genres&&i.genres.length>0&&s.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:i.genres.map(o=>s.jsx("span",{className:"px-2 py-1 text-xs bg-gray-700 text-gray-300 rounded",children:o},o))})]})]}),i.description&&s.jsx("p",{className:"mt-4 text-gray-300 text-sm leading-relaxed",children:i.description}),s.jsxs("div",{className:"mt-6 flex gap-3",children:[i.downloadUrl&&s.jsxs("button",{onClick:n,className:"flex items-center gap-2 px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium",children:[s.jsx(wn,{className:"w-5 h-5"}),"Play"]}),s.jsxs("button",{onClick:t,disabled:r,className:"flex items-center gap-2 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg font-medium",children:[r?s.jsx(nt,{className:"w-5 h-5 animate-spin"}):s.jsx(Os,{className:"w-5 h-5"}),r?"Starting Download...":"Download"]}),s.jsx("button",{onClick:e,className:"px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Close"})]})]})]})})}function N5({showId:i,provider:e,onClose:t,onDownload:n,onPlay:r,isDownloading:o}){const[c,d]=P.useState([1]),{data:h,isLoading:u}=qe({queryKey:["vod-show",e,i],queryFn:()=>Re.vod.getShow(e,i)}),m=g=>{d(x=>x.includes(g)?x.filter(y=>y!==g):[...x,g])};return u?s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",children:s.jsx(nt,{className:"w-12 h-12 text-white animate-spin"})}):h?s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"relative",children:[h.poster&&s.jsx("div",{className:"h-48 bg-gradient-to-b from-gray-700 to-gray-800 overflow-hidden",children:s.jsx("img",{src:h.poster,alt:h.title,className:"w-full h-full object-cover opacity-30"})}),s.jsx("button",{onClick:t,className:"absolute top-4 right-4 p-2 bg-black/50 hover:bg-black/70 rounded-full text-white",children:s.jsx(At,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex gap-6",children:[h.poster&&s.jsx("div",{className:"flex-shrink-0 w-32",children:s.jsx("img",{src:h.poster,alt:h.title,className:"w-full rounded-lg shadow-lg"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h2",{className:"text-2xl font-bold text-white",children:h.title}),s.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-2 text-sm text-gray-400",children:[h.year&&s.jsx("span",{children:h.year}),h.seasonCount&&s.jsxs("span",{children:[h.seasonCount," Season",h.seasonCount>1?"s":""]}),h.rating&&s.jsx("span",{className:"px-2 py-0.5 border border-gray-600 rounded",children:h.rating})]}),h.genres&&h.genres.length>0&&s.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:h.genres.map(g=>s.jsx("span",{className:"px-2 py-1 text-xs bg-gray-700 text-gray-300 rounded",children:g},g))})]})]}),h.description&&s.jsx("p",{className:"mt-4 text-gray-300 text-sm leading-relaxed",children:h.description}),h.seasons&&h.seasons.length>0&&s.jsxs("div",{className:"mt-6 space-y-2",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Episodes"}),h.seasons.map(g=>s.jsxs("div",{className:"border border-gray-700 rounded-lg overflow-hidden",children:[s.jsxs("button",{onClick:()=>m(g.seasonNumber),className:"w-full flex items-center justify-between p-4 bg-gray-700/50 hover:bg-gray-700 text-white",children:[s.jsxs("span",{className:"font-medium",children:["Season ",g.seasonNumber]}),c.includes(g.seasonNumber)?s.jsx(Uu,{className:"w-5 h-5"}):s.jsx(Va,{className:"w-5 h-5"})]}),c.includes(g.seasonNumber)&&g.episodes&&s.jsx("div",{className:"divide-y divide-gray-700",children:g.episodes.map(x=>s.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-gray-700/30",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"text-gray-500 text-sm",children:["E",x.episodeNumber]}),s.jsx("span",{className:"text-white font-medium truncate",children:x.title})]}),x.runtime&&s.jsxs("span",{className:"text-xs text-gray-500",children:[x.runtime," min"]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[x.downloadUrl&&s.jsx("button",{onClick:()=>r({id:x.id,title:x.title,downloadUrl:x.downloadUrl}),className:"flex-shrink-0 p-2 text-gray-400 hover:text-green-400 hover:bg-gray-700 rounded-lg",title:"Play",children:s.jsx(wn,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>n(x.id),disabled:o===x.id,className:"flex-shrink-0 p-2 text-gray-400 hover:text-indigo-400 hover:bg-gray-700 rounded-lg disabled:opacity-50",title:"Download",children:o===x.id?s.jsx(nt,{className:"w-4 h-4 animate-spin"}):s.jsx(Os,{className:"w-4 h-4"})})]})]},x.id))})]},g.seasonNumber))]}),s.jsx("div",{className:"mt-6 flex justify-end",children:s.jsx("button",{onClick:t,className:"px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Close"})})]})]})}):null}function M_({title:i,year:e,poster:t,rating:n,onClick:r}){return s.jsxs("button",{onClick:r,className:"group relative bg-gray-800 rounded-lg overflow-hidden hover:ring-2 hover:ring-indigo-500 transition-all",children:[s.jsx("div",{className:"aspect-[2/3] bg-gray-700",children:t?s.jsx("img",{src:t,alt:i,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center",children:s.jsx(fn,{className:"w-12 h-12 text-gray-600"})})}),s.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),s.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-3",children:[s.jsx("h4",{className:"font-medium text-white text-sm truncate",children:i}),s.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-400",children:[e&&s.jsx("span",{children:e}),n&&s.jsx("span",{className:"px-1 border border-gray-600 rounded",children:n})]})]}),s.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:s.jsx("div",{className:"p-3 bg-indigo-600 rounded-full",children:s.jsx(wn,{className:"w-6 h-6 text-white"})})})]})}function w5({queue:i,onCancel:e,onRefresh:t,isRefreshing:n}){return i.length?s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("span",{className:"text-sm text-gray-400",children:[i.length," download",i.length>1?"s":""]}),s.jsx("button",{onClick:t,disabled:n,className:"p-1 text-gray-400 hover:text-white",children:s.jsx(Et,{className:`w-4 h-4 ${n?"animate-spin":""}`})})]}),i.map(r=>s.jsxs("div",{className:"bg-gray-700 rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h4",{className:"font-medium text-white text-sm truncate",children:r.title}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[r.status==="queued"&&s.jsxs("span",{className:"flex items-center gap-1 text-xs text-blue-400",children:[s.jsx(Ts,{className:"w-3 h-3"}),"Queued"]}),r.status==="downloading"&&s.jsxs("span",{className:"flex items-center gap-1 text-xs text-indigo-400",children:[s.jsx(nt,{className:"w-3 h-3 animate-spin"}),r.progress.toFixed(0),"%"]}),r.status==="completed"&&s.jsxs("span",{className:"flex items-center gap-1 text-xs text-green-400",children:[s.jsx(vs,{className:"w-3 h-3"}),"Completed"]}),r.status==="failed"&&s.jsxs("span",{className:"flex items-center gap-1 text-xs text-red-400",children:[s.jsx(Ct,{className:"w-3 h-3"}),"Failed"]})]})]}),(r.status==="queued"||r.status==="downloading")&&s.jsx("button",{onClick:()=>e(r.id),className:"p-1 text-gray-400 hover:text-red-400",children:s.jsx(ts,{className:"w-4 h-4"})})]}),r.status==="downloading"&&s.jsx("div",{className:"mt-2 h-1.5 bg-gray-600 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300",style:{width:`${r.progress}%`}})}),r.error&&s.jsx("p",{className:"mt-2 text-xs text-red-400",children:r.error})]},r.id))]}):s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx(Os,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),s.jsx("p",{children:"No active downloads"})]})}function T5(){const i=ft(),[e,t]=P.useState(null),[n,r]=P.useState("movies"),[o,c]=P.useState(""),[d,h]=P.useState(null),[u,m]=P.useState(null),[g,x]=P.useState(null),[y,v]=P.useState(null),[S,N]=P.useState(!1),[A,R]=P.useState(null),{data:C}=qe({queryKey:["serverConfig"],queryFn:()=>Re.getServerConfig(),retry:!1}),D=C?.vod_api_url||"",{data:V}=qe({queryKey:["vod-connection"],queryFn:()=>Re.vod.testConnection(),refetchInterval:3e4}),{data:z,isLoading:B}=qe({queryKey:["vod-providers"],queryFn:()=>Re.vod.getProviders(),enabled:V?.connected===!0});P.useEffect(()=>{z?.length&&!e&&t(z[0].id)},[z,e]);const{data:I,isLoading:M}=qe({queryKey:["vod-movies",e],queryFn:()=>Re.vod.getMovies(e),enabled:!!e&&n==="movies"}),{data:L,isLoading:O}=qe({queryKey:["vod-shows",e],queryFn:()=>Re.vod.getShows(e),enabled:!!e&&n==="shows"}),{data:J}=qe({queryKey:["vod-genres",e],queryFn:()=>Re.vod.getGenres(e),enabled:!!e}),{data:ie,refetch:ne,isRefetching:se}=qe({queryKey:["vod-queue"],queryFn:()=>Re.vod.getQueue(),refetchInterval:5e3,enabled:V?.connected===!0}),X=Ve({mutationFn:({contentId:ee,type:re})=>Re.vod.startDownload(e,ee,re),onSuccess:()=>{i.invalidateQueries({queryKey:["vod-queue"]})}}),ce=Ve({mutationFn:ee=>Re.vod.cancelDownload(ee),onSuccess:()=>{i.invalidateQueries({queryKey:["vod-queue"]})}}),le=()=>{u&&e&&X.mutate({contentId:u.id,type:"movie"},{onSuccess:()=>{m(null)}})},Y=ee=>{e&&(v(ee),X.mutate({contentId:ee,type:"episode"},{onSettled:()=>{v(null)}}))},K=()=>{if(u?.downloadUrl&&D){const ee=`${D}${u.downloadUrl}`;R({title:u.title,streamUrl:ee}),m(null)}},H=ee=>{if(ee.downloadUrl&&D){const re=`${D}${ee.downloadUrl}`;R({title:ee.title||"Episode",streamUrl:re}),x(null)}},Q=I?.filter(ee=>{const re=!o||ee.title.toLowerCase().includes(o.toLowerCase()),je=!d||ee.genres?.includes(d);return re&&je}),oe=L?.filter(ee=>{const re=!o||ee.title.toLowerCase().includes(o.toLowerCase()),je=!d||ee.genres?.includes(d);return re&&je}),ye=B||(n==="movies"?M:O),xe=ie?.items||[],pe=xe.filter(ee=>ee.status==="queued"||ee.status==="downloading").length;return V?.connected===!1?s.jsxs("div",{children:[s.jsxs("div",{className:"mb-8",children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"VOD Downloads"}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Browse and download Disney+ content"})]}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-8 text-center",children:[s.jsx(vR,{className:"w-16 h-16 text-red-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"VOD Service Not Available"}),s.jsx("p",{className:"text-gray-400 mb-4",children:V?.error||"Could not connect to VOD API"}),s.jsxs("p",{className:"text-sm text-gray-500",children:["Configure the VOD API URL in ",s.jsx("a",{href:"/ui/settings",className:"text-indigo-400 hover:underline",children:"Settings"})]})]})]}):s.jsxs("div",{children:[s.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"VOD Downloads"}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Browse and download Disney+ content"})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[V?.connected&&s.jsxs("span",{className:"flex items-center gap-1.5 text-sm text-green-400",children:[s.jsx(Vu,{className:"w-4 h-4"}),"Connected"]}),s.jsxs("button",{onClick:()=>N(!S),className:`relative flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${S?"bg-indigo-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"}`,children:[s.jsx(Os,{className:"w-4 h-4"}),"Queue",pe>0&&s.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 flex items-center justify-center text-xs bg-red-500 text-white rounded-full",children:pe})]})]})]}),s.jsxs("div",{className:"flex gap-6",children:[s.jsxs("div",{className:"flex-1",children:[z&&z.length>0&&s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("label",{className:"text-sm text-gray-400",children:"Provider:"}),s.jsx("select",{value:e||"",onChange:ee=>t(ee.target.value),className:"px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-indigo-500 min-w-[200px]",children:z.map(ee=>s.jsx("option",{value:ee.id,children:ee.name},ee.id))})]}),s.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[s.jsxs("div",{className:"flex bg-gray-800 rounded-lg p-1",children:[s.jsxs("button",{onClick:()=>r("movies"),className:`flex items-center gap-2 px-4 py-2 rounded-md font-medium transition-colors ${n==="movies"?"bg-gray-700 text-white":"text-gray-400 hover:text-white"}`,children:[s.jsx(fn,{className:"w-4 h-4"}),"Movies"]}),s.jsxs("button",{onClick:()=>r("shows"),className:`flex items-center gap-2 px-4 py-2 rounded-md font-medium transition-colors ${n==="shows"?"bg-gray-700 text-white":"text-gray-400 hover:text-white"}`,children:[s.jsx(ag,{className:"w-4 h-4"}),"TV Shows"]})]}),s.jsxs("div",{className:"flex-1 relative",children:[s.jsx(qt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),s.jsx("input",{type:"text",value:o,onChange:ee=>c(ee.target.value),placeholder:"Search...",className:"w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),J&&J.length>0&&s.jsxs("select",{value:d||"",onChange:ee=>h(ee.target.value||null),className:"px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-indigo-500",children:[s.jsx("option",{value:"",children:"All Genres"}),J.map(ee=>s.jsx("option",{value:ee,children:ee},ee))]})]}),ye?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx(nt,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):n==="movies"?Q?.length?s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:Q.map(ee=>s.jsx(M_,{title:ee.title,year:ee.year,poster:ee.poster,rating:ee.rating,onClick:()=>m(ee)},ee.id))}):s.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[s.jsx(fn,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No movies found"}),s.jsx("p",{className:"text-gray-400",children:"Try adjusting your search or filters"})]}):oe?.length?s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:oe.map(ee=>s.jsx(M_,{title:ee.title,year:ee.year,poster:ee.poster,rating:ee.rating,onClick:()=>x(ee.id)},ee.id))}):s.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[s.jsx(ag,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No TV shows found"}),s.jsx("p",{className:"text-gray-400",children:"Try adjusting your search or filters"})]})]}),S&&s.jsx("div",{className:"w-80 flex-shrink-0",children:s.jsxs("div",{className:"sticky top-6 bg-gray-800 rounded-xl p-4",children:[s.jsx("h3",{className:"font-semibold text-white mb-4",children:"Download Queue"}),s.jsx(w5,{queue:xe,onCancel:ee=>ce.mutate(ee),onRefresh:()=>ne(),isRefreshing:se})]})})]}),u&&e&&s.jsx(E5,{movie:u,onClose:()=>m(null),onDownload:le,onPlay:K,isDownloading:X.isPending}),g&&e&&s.jsx(N5,{showId:g,provider:e,onClose:()=>x(null),onDownload:Y,onPlay:H,isDownloading:y}),A&&s.jsx(S5,{title:A.title,streamUrl:A.streamUrl,onClose:()=>R(null)})]})}function A5(){return qe({queryKey:["transcodeInfo"],queryFn:async()=>{const i=await fetch("/api/transcode",{headers:{"X-Plex-Token":localStorage.getItem("openflix_token")||""}});if(!i.ok)throw new Error("Failed to fetch transcode info");return i.json()},refetchInterval:1e4})}function j5({hardware:i}){const e=i.detectedGpus&&i.detectedGpus.length>0,t=()=>{if(!i.available&&e)return s.jsx(Ct,{className:"h-8 w-8 text-yellow-400"});if(!i.available)return s.jsx(Ar,{className:"h-8 w-8 text-gray-400"});switch(i.type){case"nvenc":return s.jsx($n,{className:"h-8 w-8 text-green-400"});case"qsv":return s.jsx(Ar,{className:"h-8 w-8 text-blue-400"});case"videotoolbox":return s.jsx(tg,{className:"h-8 w-8 text-purple-400"});case"vaapi":return s.jsx(Li,{className:"h-8 w-8 text-orange-400"});default:return s.jsx(Ar,{className:"h-8 w-8 text-gray-400"})}};return s.jsx("div",{className:"bg-gray-800 rounded-xl p-6",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"p-3 bg-gray-700 rounded-lg",children:t()}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("h3",{className:"text-lg font-semibold text-white",children:i.name}),i.available?s.jsxs("span",{className:"flex items-center gap-1 text-xs bg-green-500/20 text-green-400 px-2 py-0.5 rounded-full",children:[s.jsx(Ua,{className:"h-3 w-3"})," Available"]}):e?s.jsxs("span",{className:"flex items-center gap-1 text-xs bg-yellow-500/20 text-yellow-400 px-2 py-0.5 rounded-full",children:[s.jsx(Ct,{className:"h-3 w-3"})," GPU Detected - Not Usable"]}):s.jsxs("span",{className:"flex items-center gap-1 text-xs bg-gray-500/20 text-gray-400 px-2 py-0.5 rounded-full",children:[s.jsx(Ct,{className:"h-3 w-3"})," Software Only"]})]}),i.gpuInfo&&s.jsx("p",{className:"text-sm text-gray-400 mb-3",children:i.gpuInfo}),!i.available&&e&&s.jsxs("div",{className:"mb-3",children:[s.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase mb-1",children:"Detected GPUs"}),s.jsx("div",{className:"space-y-1",children:i.detectedGpus.map((n,r)=>s.jsx("p",{className:"text-sm text-yellow-400",children:n},r))})]}),i.missingSupport&&s.jsx("div",{className:"mb-3 p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg",children:s.jsx("p",{className:"text-sm text-yellow-300",children:i.missingSupport})}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase mb-2",children:"Encoders"}),s.jsx("div",{className:"flex flex-wrap gap-1",children:i.encoders.map(n=>s.jsx("span",{className:"text-xs bg-gray-700 text-gray-300 px-2 py-1 rounded",children:n},n))})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase mb-2",children:"Decoders"}),s.jsx("div",{className:"flex flex-wrap gap-1",children:i.decoders.map(n=>s.jsx("span",{className:"text-xs bg-gray-700 text-gray-300 px-2 py-1 rounded",children:n},n))})]})]}),s.jsxs("div",{className:"flex gap-4 mt-4 pt-4 border-t border-gray-700",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-xs text-gray-500",children:"HEVC"}),i.supportsHevc?s.jsx(Ua,{className:"h-4 w-4 text-green-400"}):s.jsx(Ct,{className:"h-4 w-4 text-gray-500"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-xs text-gray-500",children:"AV1"}),i.supportsAv1?s.jsx(Ua,{className:"h-4 w-4 text-green-400"}):s.jsx(Ct,{className:"h-4 w-4 text-gray-500"})]}),i.maxResolution&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-xs text-gray-500",children:"Max Resolution"}),s.jsx("span",{className:"text-xs text-white font-medium",children:i.maxResolution})]})]})]})]})})}function C5({modes:i,recommended:e}){return s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[s.jsx(WA,{className:"h-5 w-5"}),"Playback Modes"]}),s.jsx("div",{className:"space-y-3",children:i.map(t=>s.jsxs("div",{className:`p-4 rounded-lg border ${t.id===e?"border-indigo-500 bg-indigo-500/10":"border-gray-700 bg-gray-700/50"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("span",{className:"font-medium text-white",children:t.name}),t.id===e&&s.jsx("span",{className:"text-xs bg-indigo-500 text-white px-2 py-0.5 rounded",children:"Recommended"})]}),s.jsx("p",{className:"text-sm text-gray-400",children:t.description})]},t.id))})]})}function R5({config:i}){return s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[s.jsx(DC,{className:"h-5 w-5"}),"Configuration"]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-700",children:[s.jsx("span",{className:"text-gray-400",children:"Transcoding Enabled"}),s.jsx("span",{className:i.enabled?"text-green-400":"text-red-400",children:i.enabled?"Yes":"No"})]}),s.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-700",children:[s.jsx("span",{className:"text-gray-400",children:"FFmpeg Path"}),s.jsx("span",{className:"text-white font-mono text-sm",children:i.ffmpegPath})]}),s.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-700",children:[s.jsx("span",{className:"text-gray-400",children:"Hardware Acceleration"}),s.jsx("span",{className:"text-white capitalize",children:i.hwAccel})]}),s.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-700",children:[s.jsx("span",{className:"text-gray-400",children:"Temp Directory"}),s.jsx("span",{className:"text-white font-mono text-sm truncate max-w-xs",children:i.tempDir})]}),s.jsxs("div",{className:"flex justify-between items-center py-2",children:[s.jsx("span",{className:"text-gray-400",children:"Max Sessions"}),s.jsx("span",{className:"text-white",children:i.maxSessions})]})]})]})}function L5({sessions:i}){return s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[s.jsx(tg,{className:"h-5 w-5"}),"Active Sessions"]}),s.jsxs("span",{className:"text-sm text-gray-400",children:[i.active," / ",i.max]})]}),s.jsx("div",{className:"h-2 bg-gray-700 rounded-full mb-4",children:s.jsx("div",{className:`h-full rounded-full transition-all ${i.active>=i.max?"bg-red-500":"bg-indigo-500"}`,style:{width:`${Math.min(i.active/i.max*100,100)}%`}})}),i.details.length===0?s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx(tg,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),s.jsx("p",{children:"No active transcoding sessions"})]}):s.jsx("div",{className:"space-y-2",children:i.details.map(e=>s.jsx("div",{className:"p-3 bg-gray-700 rounded-lg",children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsxs("p",{className:"text-white font-mono text-sm truncate",children:[e.id.slice(0,8),"..."]}),s.jsxs("p",{className:"text-xs text-gray-400",children:["Quality: ",e.quality]})]}),s.jsx("span",{className:"text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded",children:"Active"})]})},e.id))})]})}function k5(){const{data:i,isLoading:e,refetch:t}=A5();return e?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx(Et,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):i?s.jsxs("div",{children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Transcoding"}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Hardware acceleration and transcoding settings"})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsx(j5,{hardware:i.hardware}),s.jsx(R5,{config:i.config}),s.jsx(C5,{modes:i.playbackModes,recommended:i.hardware.recommendedMode}),s.jsx(L5,{sessions:i.sessions})]}),s.jsxs("div",{className:"mt-6 bg-gray-800 rounded-xl p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Playback Strategy"}),s.jsxs("div",{className:"prose prose-invert prose-sm max-w-none",children:[s.jsx("p",{className:"text-gray-300",children:"OpenFlix supports multiple playback strategies to optimize quality and performance:"}),s.jsxs("ul",{className:"text-gray-300 mt-3 space-y-2",children:[s.jsxs("li",{children:[s.jsx("strong",{className:"text-white",children:"Direct Play:"})," The client device decodes the original file directly. This provides the best quality and requires no server resources. Most modern devices (Android, iOS, Smart TVs) support hardware decoding for H.264 and often HEVC."]}),s.jsxs("li",{children:[s.jsx("strong",{className:"text-white",children:"Direct Stream:"})," The server remuxes the file (changes container format) without re-encoding. Useful when the client supports the codec but not the container format."]}),s.jsxs("li",{children:[s.jsx("strong",{className:"text-white",children:"Server Transcode:"})," The server re-encodes the video to a compatible format. Uses server CPU or GPU resources. Enable hardware acceleration (NVENC, QSV, VideoToolbox) for better performance."]})]}),s.jsx("p",{className:"text-gray-400 mt-4 text-sm",children:i.hardware.available?`Your server has hardware acceleration available (${i.hardware.name}). Server transcoding will use the GPU for efficient encoding.`:"Your server will use software (CPU) transcoding. Consider using Direct Play when possible to reduce server load."})]})]}),s.jsx("div",{className:"mt-6 bg-gradient-to-br from-indigo-900/50 to-purple-900/50 rounded-xl p-6 border border-indigo-500/30",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"p-3 bg-indigo-500/20 rounded-lg",children:s.jsx($n,{className:"h-6 w-6 text-indigo-400"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Smart Playback Selection"}),s.jsx("p",{className:"text-gray-300 text-sm mb-3",children:"OpenFlix automatically analyzes each media file and your device's capabilities to choose the optimal playback mode:"}),s.jsxs("ul",{className:"text-gray-400 text-sm space-y-1",children:[s.jsxs("li",{className:"flex items-center gap-2",children:[s.jsx(Ua,{className:"h-4 w-4 text-green-400"}),s.jsx("span",{children:"Analyzes video codec, audio codec, container format, and resolution"})]}),s.jsxs("li",{className:"flex items-center gap-2",children:[s.jsx(Ua,{className:"h-4 w-4 text-green-400"}),s.jsx("span",{children:"Detects HDR, Dolby Vision, and Atmos compatibility"})]}),s.jsxs("li",{className:"flex items-center gap-2",children:[s.jsx(Ua,{className:"h-4 w-4 text-green-400"}),s.jsx("span",{children:"Considers network bandwidth and client device capabilities"})]}),s.jsxs("li",{className:"flex items-center gap-2",children:[s.jsx(Ua,{className:"h-4 w-4 text-green-400"}),s.jsx("span",{children:"Prioritizes Direct Play for best quality, falls back to transcoding when needed"})]})]}),s.jsx("p",{className:"text-indigo-300 text-xs mt-3",children:"API: GET /api/playback/decide/:fileId  Returns recommended playback mode for any media file"})]})]})})]}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx(Ct,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white",children:"Failed to load transcoding info"}),s.jsx("button",{onClick:()=>t(),className:"mt-4 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:"Retry"})]})}function D5(i){return qe({queryKey:["serverLogs"],queryFn:async()=>{const e=await fetch("/api/logs?lines=1000",{headers:{"X-Plex-Token":localStorage.getItem("openflix_token")||""}});if(!e.ok)throw new Error("Failed to fetch logs");return e.json()},refetchInterval:i?5e3:!1})}function I5(){const i=ft();return Ve({mutationFn:async()=>{const e=await fetch("/api/logs",{method:"DELETE",headers:{"X-Plex-Token":localStorage.getItem("openflix_token")||""}});if(!e.ok)throw new Error("Failed to clear logs");return e.json()},onSuccess:()=>{i.invalidateQueries({queryKey:["serverLogs"]})}})}function O_(i){return i.includes("level=debug")||i.includes('"level":"debug"')?"debug":i.includes("level=info")||i.includes('"level":"info"')?"info":i.includes("level=warning")||i.includes('"level":"warning"')?"warn":i.includes("level=error")||i.includes('"level":"error"')?"error":null}const M5={debug:"text-gray-400",info:"text-blue-400",warn:"text-yellow-400",error:"text-red-400"};function O5(){const[i,e]=P.useState(!0),[t,n]=P.useState("all"),[r,o]=P.useState(""),{data:c,isLoading:d,refetch:h}=D5(i),u=I5(),m=P.useRef(null),[g,x]=P.useState(!0);P.useEffect(()=>{g&&m.current&&m.current.scrollIntoView({behavior:"smooth"})},[c?.lines,g]);const y=c?.lines.filter(S=>!(t!=="all"&&O_(S)!==t||r&&!S.toLowerCase().includes(r.toLowerCase())))||[],v=()=>{if(!c?.lines)return;const S=c.lines.join(`
`),N=new Blob([S],{type:"text/plain"}),A=URL.createObjectURL(N),R=document.createElement("a");R.href=A,R.download=`openflix-logs-${new Date().toISOString().split("T")[0]}.log`,R.click(),URL.revokeObjectURL(A)};return s.jsxs("div",{className:"h-full flex flex-col",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Server Logs"}),s.jsx("p",{className:"text-gray-400 mt-1",children:c?.path?`Log file: ${c.path}`:"View server logs in real-time"})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[s.jsx("input",{type:"text",placeholder:"Search logs...",value:r,onChange:S=>o(S.target.value),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm w-64"}),s.jsxs("select",{value:t,onChange:S=>n(S.target.value),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",children:[s.jsx("option",{value:"all",children:"All Levels"}),s.jsx("option",{value:"debug",children:"Debug"}),s.jsx("option",{value:"info",children:"Info"}),s.jsx("option",{value:"warn",children:"Warning"}),s.jsx("option",{value:"error",children:"Error"})]}),s.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:i,onChange:S=>e(S.target.checked),className:"rounded bg-gray-700 border-gray-600"}),"Auto-refresh"]}),s.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:g,onChange:S=>x(S.target.checked),className:"rounded bg-gray-700 border-gray-600"}),"Auto-scroll"]}),s.jsx("div",{className:"flex-1"}),s.jsxs("button",{onClick:()=>h(),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:[s.jsx(Et,{className:"h-4 w-4"}),"Refresh"]}),s.jsxs("button",{onClick:v,disabled:!c?.lines.length,className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 text-white rounded-lg text-sm",children:[s.jsx(Os,{className:"h-4 w-4"}),"Download"]}),s.jsxs("button",{onClick:()=>{confirm("Are you sure you want to clear all logs?")&&u.mutate()},disabled:u.isPending,className:"flex items-center gap-2 px-3 py-2 bg-red-600 hover:bg-red-700 disabled:opacity-50 text-white rounded-lg text-sm",children:[s.jsx(ts,{className:"h-4 w-4"}),"Clear"]})]}),s.jsxs("div",{className:"text-sm text-gray-400 mb-2",children:["Showing ",y.length," of ",c?.count||0," log entries",c?.level&&s.jsxs("span",{className:"ml-2",children:["(Log level: ",c.level,")"]})]}),s.jsx("div",{className:"flex-1 bg-gray-900 rounded-xl overflow-hidden",children:d?s.jsx("div",{className:"p-4 text-gray-400",children:"Loading logs..."}):y.length===0?s.jsxs("div",{className:"p-8 text-center",children:[s.jsx(Fn,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No logs found"}),s.jsx("p",{className:"text-gray-400",children:r||t!=="all"?"Try adjusting your filters":"Logs will appear here as they are generated"})]}):s.jsxs("div",{className:"h-full overflow-auto p-4 font-mono text-xs leading-relaxed",children:[y.map((S,N)=>{const A=O_(S);return s.jsx("div",{className:`${A?M5[A]:"text-gray-300"} hover:bg-gray-800 px-1 -mx-1 rounded`,children:S},N)}),s.jsx("div",{ref:m})]})}),!g&&s.jsx("button",{onClick:()=>m.current?.scrollIntoView({behavior:"smooth"}),className:"fixed bottom-8 right-8 p-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full shadow-lg",children:s.jsx(Bu,{className:"h-5 w-5"})})]})}function P5(){return qe({queryKey:["serverConfig"],queryFn:()=>Re.getServerConfig(),retry:!1})}function B5({title:i,children:e}){return s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:i}),s.jsx("div",{className:"space-y-4",children:e})]})}function Lo({label:i,description:e,children:t}){return s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:i}),e&&s.jsx("p",{className:"text-xs text-gray-500 mb-2",children:e}),t]})}function U5(){const i=ft(),[e,t]=P.useState(!1),{data:n,isLoading:r,error:o}=qe({queryKey:["dvrSettings"],queryFn:()=>Re.getDVRSettings(),retry:1}),{data:c}=qe({queryKey:["commercialDetectionStatus"],queryFn:()=>Re.getCommercialDetectionStatus(),retry:1}),[d,h]=P.useState(0);P.useEffect(()=>{n&&h(n.maxConcurrentRecordings)},[n]);const u=Ve({mutationFn:g=>Re.updateDVRSettings(g),onSuccess:()=>{i.invalidateQueries({queryKey:["dvrSettings"]}),t(!0),setTimeout(()=>t(!1),3e3)}}),m=()=>{u.mutate({maxConcurrentRecordings:d})};return r?s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"DVR Settings"}),s.jsx("div",{className:"text-gray-400",children:"Loading..."})]}):o?s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"DVR Settings"}),s.jsx("div",{className:"text-red-400 text-sm",children:"Failed to load DVR settings"})]}):s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-lg font-semibold text-white",children:"DVR Settings"}),s.jsxs("button",{onClick:m,disabled:u.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white text-sm rounded-lg",children:[s.jsx(s0,{className:"h-3.5 w-3.5"}),u.isPending?"Saving...":e?"Saved!":"Save"]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(Lo,{label:"Max Concurrent Recordings",description:"Maximum number of recordings that can run at the same time. Set to 0 for unlimited.",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"number",min:"0",value:d,onChange:g=>h(Number(g.target.value)),className:"w-32 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"}),s.jsx("span",{className:"text-gray-400 text-sm",children:d===0?"(Unlimited)":`(Max ${d} at once)`})]})}),s.jsx("p",{className:"text-xs text-gray-500",children:"If you have limited tuners or bandwidth, you may want to set a limit. When conflicts occur, higher priority recordings will be preferred."}),s.jsxs("div",{className:"pt-4 border-t border-gray-700",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"Commercial Detection"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Automatically detect and skip commercials in recordings using Comskip"})]}),s.jsx("div",{className:"flex items-center gap-2",children:c?.enabled?s.jsxs(s.Fragment,{children:[s.jsx(vs,{className:"h-4 w-4 text-green-400"}),s.jsx("span",{className:"text-sm text-green-400",children:"Enabled"})]}):s.jsxs(s.Fragment,{children:[s.jsx(gc,{className:"h-4 w-4 text-gray-500"}),s.jsx("span",{className:"text-sm text-gray-500",children:"Not Available"})]})})]}),!c?.enabled&&s.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Comskip is not installed. Commercial detection will be enabled automatically when Comskip is available."})]})]})]})}function F5({vodApiUrl:i,onUrlChange:e}){const[t,n]=P.useState(null),[r,o]=P.useState(!1),c=async()=>{if(!i){n({connected:!1,error:"Please enter a VOD API URL"});return}o(!0),n(null);try{const d=await Re.vod.testConnection(i);n(d)}catch(d){n({connected:!1,error:d.message||"Connection failed"})}finally{o(!1)}};return s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"VOD Downloads"}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(Lo,{label:"VOD API URL",description:"URL of the external VOD download service (e.g., http://192.168.1.82:7070)",children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:i,onChange:d=>{e(d.target.value),n(null)},className:"flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://192.168.1.82:7070"}),s.jsx("button",{onClick:c,disabled:r,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 text-white rounded-lg whitespace-nowrap",children:r?s.jsx(nt,{className:"w-4 h-4 animate-spin"}):"Test Connection"})]})}),t&&s.jsx("div",{className:`flex items-center gap-2 p-3 rounded-lg ${t.connected?"bg-green-500/10 border border-green-500/30":"bg-red-500/10 border border-red-500/30"}`,children:t.connected?s.jsxs(s.Fragment,{children:[s.jsx(vs,{className:"w-4 h-4 text-green-400"}),s.jsx("span",{className:"text-green-400 text-sm",children:"Connection successful"})]}):s.jsxs(s.Fragment,{children:[s.jsx(gc,{className:"w-4 h-4 text-red-400"}),s.jsx("span",{className:"text-red-400 text-sm",children:t.error||"Connection failed"})]})}),s.jsx("p",{className:"text-xs text-gray-500",children:"The VOD service provides access to Disney+ and other streaming content for download. Downloads will be saved to your configured movie and TV show library paths."})]})]})}function $5(){const i=P.useRef(null),[e,t]=P.useState(!1),[n,r]=P.useState(!1),[o,c]=P.useState(null),[d,h]=P.useState(null),[u,m]=P.useState(null),{data:g,isLoading:x}=qe({queryKey:["configStats"],queryFn:()=>Re.getConfigStats(),retry:1}),y=async()=>{t(!0),m(null);try{const A=await Re.exportConfig(),R=window.URL.createObjectURL(A),C=document.createElement("a");C.href=R,C.download=`openflix-config-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(C),C.click(),window.URL.revokeObjectURL(R),document.body.removeChild(C)}catch(A){m(A.message||"Failed to export configuration")}finally{t(!1)}},v=async A=>{const R=A.target.files?.[0];if(R){m(null),c(null),r(!0);try{const C=await R.text(),D=JSON.parse(C),V=await Re.importConfig(D,!0);c(V),h(D)}catch(C){m(C.message||"Failed to parse configuration file")}finally{r(!1),i.current&&(i.current.value="")}}},S=async()=>{if(d){r(!0),m(null);try{const A=await Re.importConfig(d,!1);c(A),h(null)}catch(A){m(A.message||"Failed to import configuration")}finally{r(!1)}}},N=()=>{h(null),c(null)};return s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Configuration Backup"}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{className:"text-sm text-gray-400",children:"Export your entire OpenFlix configuration including channels, sources, EPG, libraries, users, playlists, and more."}),!x&&g&&s.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-5 gap-3 p-4 bg-gray-900 rounded-lg",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-xl font-semibold text-white",children:g.channels}),s.jsx("div",{className:"text-xs text-gray-500",children:"Channels"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-xl font-semibold text-white",children:g.m3uSources+g.xtreamSources}),s.jsx("div",{className:"text-xs text-gray-500",children:"Sources"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-xl font-semibold text-white",children:g.epgSources}),s.jsx("div",{className:"text-xs text-gray-500",children:"EPG"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-xl font-semibold text-white",children:g.libraries}),s.jsx("div",{className:"text-xs text-gray-500",children:"Libraries"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-xl font-semibold text-white",children:g.recordings}),s.jsx("div",{className:"text-xs text-gray-500",children:"Recordings"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-xl font-semibold text-white",children:g.users}),s.jsx("div",{className:"text-xs text-gray-500",children:"Users"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-xl font-semibold text-white",children:g.playlists}),s.jsx("div",{className:"text-xs text-gray-500",children:"Playlists"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-xl font-semibold text-white",children:g.seriesRules+g.teamPasses}),s.jsx("div",{className:"text-xs text-gray-500",children:"DVR Rules"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-xl font-semibold text-white",children:g.watchHistory}),s.jsx("div",{className:"text-xs text-gray-500",children:"Watch History"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-xl font-semibold text-white",children:g.settings}),s.jsx("div",{className:"text-xs text-gray-500",children:"Settings"})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("button",{onClick:y,disabled:e,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg",children:[e?s.jsx(nt,{className:"h-4 w-4 animate-spin"}):s.jsx(Os,{className:"h-4 w-4"}),e?"Exporting...":"Export Configuration"]}),s.jsx("input",{ref:i,type:"file",accept:".json",onChange:v,className:"hidden"}),s.jsxs("button",{onClick:()=>i.current?.click(),disabled:n,className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 text-white rounded-lg",children:[n?s.jsx(nt,{className:"h-4 w-4 animate-spin"}):s.jsx(ra,{className:"h-4 w-4"}),n?"Processing...":"Import Configuration"]})]}),u&&s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:[s.jsx(gc,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),s.jsx("span",{className:"text-red-400 text-sm",children:u})]}),o&&d!==null&&s.jsxs("div",{className:"p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg",children:[s.jsxs("div",{className:"flex items-start gap-2 mb-3",children:[s.jsx(Ct,{className:"h-5 w-5 text-yellow-400 flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-yellow-400",children:"Import Preview"}),s.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"This will import the following items. Existing items with the same ID will be updated."})]})]}),o.version&&s.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:["Export version: ",o.version," | Exported: ",o.exportedAt?new Date(o.exportedAt).toLocaleString():"Unknown"]}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 mb-4",children:o.counts&&Object.entries(o.counts).map(([A,R])=>R>0?s.jsxs("div",{className:"text-center p-2 bg-gray-800 rounded",children:[s.jsx("div",{className:"text-lg font-semibold text-white",children:R}),s.jsx("div",{className:"text-xs text-gray-500 capitalize",children:A.replace(/([A-Z])/g," $1").trim()})]},A):null)}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:S,disabled:n,className:"flex items-center gap-2 px-4 py-2 bg-yellow-600 hover:bg-yellow-700 disabled:bg-yellow-800 text-white rounded-lg",children:[n?s.jsx(nt,{className:"h-4 w-4 animate-spin"}):s.jsx(vs,{className:"h-4 w-4"}),n?"Importing...":"Confirm Import"]}),s.jsx("button",{onClick:N,disabled:n,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"})]})]}),o&&o.success&&d===null&&s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-500/10 border border-green-500/30 rounded-lg",children:[s.jsx(vs,{className:"h-4 w-4 text-green-400 flex-shrink-0"}),s.jsxs("span",{className:"text-green-400 text-sm",children:["Configuration imported successfully!",o.imported&&s.jsxs("span",{className:"text-gray-400 ml-2",children:["(",Object.entries(o.imported).filter(([,A])=>A>0).map(([A,R])=>`${R} ${A}`).join(", "),")"]})]})]}),s.jsx("p",{className:"text-xs text-gray-500",children:"Note: Passwords and sensitive credentials are not included in exports for security."})]})]})}function G5(){const{data:i,isLoading:e,error:t}=P5(),n=ft(),[r,o]=P.useState({}),[c,d]=P.useState(!1);P.useEffect(()=>{i&&o(i)},[i]);const h=Ve({mutationFn:g=>Re.updateServerConfig(g),onSuccess:()=>{n.invalidateQueries({queryKey:["serverConfig"]}),d(!0),setTimeout(()=>d(!1),3e3)}}),u=()=>{h.mutate(r)},m=(g,x)=>{o(y=>({...y,[g]:x}))};return e?s.jsx("div",{className:"text-gray-400",children:"Loading settings..."}):t?s.jsxs("div",{children:[s.jsxs("div",{className:"mb-8",children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Settings"}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Server configuration"})]}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsx("p",{className:"text-yellow-400 mb-4",children:"Settings API not available. Configure via config.yaml file."}),s.jsx("pre",{className:"text-sm text-gray-300 bg-gray-900 p-4 rounded-lg overflow-x-auto",children:`# ~/.openflix/config.yaml or ./config.yaml

server:
  host: "0.0.0.0"
  port: 32400

auth:
  jwt_secret: "change-me-in-production"
  token_expiry: 720
  allow_signup: true

library:
  scan_interval: 60
  metadata_lang: "en"
  tmdb_api_key: ""

livetv:
  enabled: true
  epg_interval: 12

dvr:
  enabled: true
  recording_dir: "~/.openflix/recordings"
  pre_padding: 2
  post_padding: 5

transcode:
  enabled: true
  ffmpeg_path: "ffmpeg"
  hardware_accel: "auto"
  max_sessions: 3`})]})]}):s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-8",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Settings"}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Configure your OpenFlix server"})]}),s.jsxs("button",{onClick:u,disabled:h.isPending,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg",children:[s.jsx(s0,{className:"h-4 w-4"}),h.isPending?"Saving...":c?"Saved!":"Save Changes"]})]}),s.jsxs(B5,{title:"Metadata",children:[s.jsx(Lo,{label:"TMDB API Key",description:"For movie and TV show metadata (get yours at themoviedb.org)",children:s.jsx("input",{type:"password",value:r.tmdb_api_key||"",onChange:g=>m("tmdb_api_key",g.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"Enter your TMDB API key"})}),s.jsx(Lo,{label:"TVDB API Key",description:"For additional TV show metadata (optional)",children:s.jsx("input",{type:"password",value:r.tvdb_api_key||"",onChange:g=>m("tvdb_api_key",g.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"Enter your TVDB API key"})}),s.jsx(Lo,{label:"Metadata Language",description:"Preferred language for metadata",children:s.jsxs("select",{value:r.metadata_lang||"en",onChange:g=>m("metadata_lang",g.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:[s.jsx("option",{value:"en",children:"English"}),s.jsx("option",{value:"es",children:"Spanish"}),s.jsx("option",{value:"fr",children:"French"}),s.jsx("option",{value:"de",children:"German"}),s.jsx("option",{value:"it",children:"Italian"}),s.jsx("option",{value:"pt",children:"Portuguese"}),s.jsx("option",{value:"ja",children:"Japanese"}),s.jsx("option",{value:"ko",children:"Korean"}),s.jsx("option",{value:"zh",children:"Chinese"})]})}),s.jsx(Lo,{label:"Scan Interval",description:"Minutes between automatic library scans",children:s.jsx("input",{type:"number",value:r.scan_interval||60,onChange:g=>m("scan_interval",Number(g.target.value)),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"})})]}),s.jsx(U5,{}),s.jsx(F5,{vodApiUrl:r.vod_api_url||"",onUrlChange:g=>m("vod_api_url",g)}),s.jsx($5,{}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Other Settings"}),s.jsxs("p",{className:"text-gray-400 text-sm",children:["Additional server settings (Live TV, Transcoding) can be configured via the ",s.jsx("code",{className:"bg-gray-700 px-2 py-1 rounded",children:"config.yaml"})," file."]}),s.jsxs("p",{className:"text-gray-500 text-sm mt-2",children:["Location: ",s.jsx("code",{className:"bg-gray-700 px-2 py-1 rounded",children:"~/.openflix/config.yaml"})]})]})]})}var V5=Object.defineProperty,Iu=Object.getOwnPropertySymbols,VE=Object.prototype.hasOwnProperty,HE=Object.prototype.propertyIsEnumerable,P_=(i,e,t)=>e in i?V5(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Rg=(i,e)=>{for(var t in e||(e={}))VE.call(e,t)&&P_(i,t,e[t]);if(Iu)for(var t of Iu(e))HE.call(e,t)&&P_(i,t,e[t]);return i},Lg=(i,e)=>{var t={};for(var n in i)VE.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&Iu)for(var n of Iu(i))e.indexOf(n)<0&&HE.call(i,n)&&(t[n]=i[n]);return t};var Or;(i=>{const e=class Dt{constructor(h,u,m,g){if(this.version=h,this.errorCorrectionLevel=u,this.modules=[],this.isFunction=[],h<Dt.MIN_VERSION||h>Dt.MAX_VERSION)throw new RangeError("Version value out of range");if(g<-1||g>7)throw new RangeError("Mask value out of range");this.size=h*4+17;let x=[];for(let v=0;v<this.size;v++)x.push(!1);for(let v=0;v<this.size;v++)this.modules.push(x.slice()),this.isFunction.push(x.slice());this.drawFunctionPatterns();const y=this.addEccAndInterleave(m);if(this.drawCodewords(y),g==-1){let v=1e9;for(let S=0;S<8;S++){this.applyMask(S),this.drawFormatBits(S);const N=this.getPenaltyScore();N<v&&(g=S,v=N),this.applyMask(S)}}r(0<=g&&g<=7),this.mask=g,this.applyMask(g),this.drawFormatBits(g),this.isFunction=[]}static encodeText(h,u){const m=i.QrSegment.makeSegments(h);return Dt.encodeSegments(m,u)}static encodeBinary(h,u){const m=i.QrSegment.makeBytes(h);return Dt.encodeSegments([m],u)}static encodeSegments(h,u,m=1,g=40,x=-1,y=!0){if(!(Dt.MIN_VERSION<=m&&m<=g&&g<=Dt.MAX_VERSION)||x<-1||x>7)throw new RangeError("Invalid value");let v,S;for(v=m;;v++){const C=Dt.getNumDataCodewords(v,u)*8,D=c.getTotalBits(h,v);if(D<=C){S=D;break}if(v>=g)throw new RangeError("Data too long")}for(const C of[Dt.Ecc.MEDIUM,Dt.Ecc.QUARTILE,Dt.Ecc.HIGH])y&&S<=Dt.getNumDataCodewords(v,C)*8&&(u=C);let N=[];for(const C of h){t(C.mode.modeBits,4,N),t(C.numChars,C.mode.numCharCountBits(v),N);for(const D of C.getData())N.push(D)}r(N.length==S);const A=Dt.getNumDataCodewords(v,u)*8;r(N.length<=A),t(0,Math.min(4,A-N.length),N),t(0,(8-N.length%8)%8,N),r(N.length%8==0);for(let C=236;N.length<A;C^=253)t(C,8,N);let R=[];for(;R.length*8<N.length;)R.push(0);return N.forEach((C,D)=>R[D>>>3]|=C<<7-(D&7)),new Dt(v,u,R,x)}getModule(h,u){return 0<=h&&h<this.size&&0<=u&&u<this.size&&this.modules[u][h]}getModules(){return this.modules}drawFunctionPatterns(){for(let m=0;m<this.size;m++)this.setFunctionModule(6,m,m%2==0),this.setFunctionModule(m,6,m%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const h=this.getAlignmentPatternPositions(),u=h.length;for(let m=0;m<u;m++)for(let g=0;g<u;g++)m==0&&g==0||m==0&&g==u-1||m==u-1&&g==0||this.drawAlignmentPattern(h[m],h[g]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(h){const u=this.errorCorrectionLevel.formatBits<<3|h;let m=u;for(let x=0;x<10;x++)m=m<<1^(m>>>9)*1335;const g=(u<<10|m)^21522;r(g>>>15==0);for(let x=0;x<=5;x++)this.setFunctionModule(8,x,n(g,x));this.setFunctionModule(8,7,n(g,6)),this.setFunctionModule(8,8,n(g,7)),this.setFunctionModule(7,8,n(g,8));for(let x=9;x<15;x++)this.setFunctionModule(14-x,8,n(g,x));for(let x=0;x<8;x++)this.setFunctionModule(this.size-1-x,8,n(g,x));for(let x=8;x<15;x++)this.setFunctionModule(8,this.size-15+x,n(g,x));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let h=this.version;for(let m=0;m<12;m++)h=h<<1^(h>>>11)*7973;const u=this.version<<12|h;r(u>>>18==0);for(let m=0;m<18;m++){const g=n(u,m),x=this.size-11+m%3,y=Math.floor(m/3);this.setFunctionModule(x,y,g),this.setFunctionModule(y,x,g)}}drawFinderPattern(h,u){for(let m=-4;m<=4;m++)for(let g=-4;g<=4;g++){const x=Math.max(Math.abs(g),Math.abs(m)),y=h+g,v=u+m;0<=y&&y<this.size&&0<=v&&v<this.size&&this.setFunctionModule(y,v,x!=2&&x!=4)}}drawAlignmentPattern(h,u){for(let m=-2;m<=2;m++)for(let g=-2;g<=2;g++)this.setFunctionModule(h+g,u+m,Math.max(Math.abs(g),Math.abs(m))!=1)}setFunctionModule(h,u,m){this.modules[u][h]=m,this.isFunction[u][h]=!0}addEccAndInterleave(h){const u=this.version,m=this.errorCorrectionLevel;if(h.length!=Dt.getNumDataCodewords(u,m))throw new RangeError("Invalid argument");const g=Dt.NUM_ERROR_CORRECTION_BLOCKS[m.ordinal][u],x=Dt.ECC_CODEWORDS_PER_BLOCK[m.ordinal][u],y=Math.floor(Dt.getNumRawDataModules(u)/8),v=g-y%g,S=Math.floor(y/g);let N=[];const A=Dt.reedSolomonComputeDivisor(x);for(let C=0,D=0;C<g;C++){let V=h.slice(D,D+S-x+(C<v?0:1));D+=V.length;const z=Dt.reedSolomonComputeRemainder(V,A);C<v&&V.push(0),N.push(V.concat(z))}let R=[];for(let C=0;C<N[0].length;C++)N.forEach((D,V)=>{(C!=S-x||V>=v)&&R.push(D[C])});return r(R.length==y),R}drawCodewords(h){if(h.length!=Math.floor(Dt.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let u=0;for(let m=this.size-1;m>=1;m-=2){m==6&&(m=5);for(let g=0;g<this.size;g++)for(let x=0;x<2;x++){const y=m-x,S=(m+1&2)==0?this.size-1-g:g;!this.isFunction[S][y]&&u<h.length*8&&(this.modules[S][y]=n(h[u>>>3],7-(u&7)),u++)}}r(u==h.length*8)}applyMask(h){if(h<0||h>7)throw new RangeError("Mask value out of range");for(let u=0;u<this.size;u++)for(let m=0;m<this.size;m++){let g;switch(h){case 0:g=(m+u)%2==0;break;case 1:g=u%2==0;break;case 2:g=m%3==0;break;case 3:g=(m+u)%3==0;break;case 4:g=(Math.floor(m/3)+Math.floor(u/2))%2==0;break;case 5:g=m*u%2+m*u%3==0;break;case 6:g=(m*u%2+m*u%3)%2==0;break;case 7:g=((m+u)%2+m*u%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[u][m]&&g&&(this.modules[u][m]=!this.modules[u][m])}}getPenaltyScore(){let h=0;for(let x=0;x<this.size;x++){let y=!1,v=0,S=[0,0,0,0,0,0,0];for(let N=0;N<this.size;N++)this.modules[x][N]==y?(v++,v==5?h+=Dt.PENALTY_N1:v>5&&h++):(this.finderPenaltyAddHistory(v,S),y||(h+=this.finderPenaltyCountPatterns(S)*Dt.PENALTY_N3),y=this.modules[x][N],v=1);h+=this.finderPenaltyTerminateAndCount(y,v,S)*Dt.PENALTY_N3}for(let x=0;x<this.size;x++){let y=!1,v=0,S=[0,0,0,0,0,0,0];for(let N=0;N<this.size;N++)this.modules[N][x]==y?(v++,v==5?h+=Dt.PENALTY_N1:v>5&&h++):(this.finderPenaltyAddHistory(v,S),y||(h+=this.finderPenaltyCountPatterns(S)*Dt.PENALTY_N3),y=this.modules[N][x],v=1);h+=this.finderPenaltyTerminateAndCount(y,v,S)*Dt.PENALTY_N3}for(let x=0;x<this.size-1;x++)for(let y=0;y<this.size-1;y++){const v=this.modules[x][y];v==this.modules[x][y+1]&&v==this.modules[x+1][y]&&v==this.modules[x+1][y+1]&&(h+=Dt.PENALTY_N2)}let u=0;for(const x of this.modules)u=x.reduce((y,v)=>y+(v?1:0),u);const m=this.size*this.size,g=Math.ceil(Math.abs(u*20-m*10)/m)-1;return r(0<=g&&g<=9),h+=g*Dt.PENALTY_N4,r(0<=h&&h<=2568888),h}getAlignmentPatternPositions(){if(this.version==1)return[];{const h=Math.floor(this.version/7)+2,u=this.version==32?26:Math.ceil((this.version*4+4)/(h*2-2))*2;let m=[6];for(let g=this.size-7;m.length<h;g-=u)m.splice(1,0,g);return m}}static getNumRawDataModules(h){if(h<Dt.MIN_VERSION||h>Dt.MAX_VERSION)throw new RangeError("Version number out of range");let u=(16*h+128)*h+64;if(h>=2){const m=Math.floor(h/7)+2;u-=(25*m-10)*m-55,h>=7&&(u-=36)}return r(208<=u&&u<=29648),u}static getNumDataCodewords(h,u){return Math.floor(Dt.getNumRawDataModules(h)/8)-Dt.ECC_CODEWORDS_PER_BLOCK[u.ordinal][h]*Dt.NUM_ERROR_CORRECTION_BLOCKS[u.ordinal][h]}static reedSolomonComputeDivisor(h){if(h<1||h>255)throw new RangeError("Degree out of range");let u=[];for(let g=0;g<h-1;g++)u.push(0);u.push(1);let m=1;for(let g=0;g<h;g++){for(let x=0;x<u.length;x++)u[x]=Dt.reedSolomonMultiply(u[x],m),x+1<u.length&&(u[x]^=u[x+1]);m=Dt.reedSolomonMultiply(m,2)}return u}static reedSolomonComputeRemainder(h,u){let m=u.map(g=>0);for(const g of h){const x=g^m.shift();m.push(0),u.forEach((y,v)=>m[v]^=Dt.reedSolomonMultiply(y,x))}return m}static reedSolomonMultiply(h,u){if(h>>>8||u>>>8)throw new RangeError("Byte out of range");let m=0;for(let g=7;g>=0;g--)m=m<<1^(m>>>7)*285,m^=(u>>>g&1)*h;return r(m>>>8==0),m}finderPenaltyCountPatterns(h){const u=h[1];r(u<=this.size*3);const m=u>0&&h[2]==u&&h[3]==u*3&&h[4]==u&&h[5]==u;return(m&&h[0]>=u*4&&h[6]>=u?1:0)+(m&&h[6]>=u*4&&h[0]>=u?1:0)}finderPenaltyTerminateAndCount(h,u,m){return h&&(this.finderPenaltyAddHistory(u,m),u=0),u+=this.size,this.finderPenaltyAddHistory(u,m),this.finderPenaltyCountPatterns(m)}finderPenaltyAddHistory(h,u){u[0]==0&&(h+=this.size),u.pop(),u.unshift(h)}};e.MIN_VERSION=1,e.MAX_VERSION=40,e.PENALTY_N1=3,e.PENALTY_N2=3,e.PENALTY_N3=40,e.PENALTY_N4=10,e.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],e.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],i.QrCode=e;function t(d,h,u){if(h<0||h>31||d>>>h)throw new RangeError("Value out of range");for(let m=h-1;m>=0;m--)u.push(d>>>m&1)}function n(d,h){return(d>>>h&1)!=0}function r(d){if(!d)throw new Error("Assertion error")}const o=class ws{constructor(h,u,m){if(this.mode=h,this.numChars=u,this.bitData=m,u<0)throw new RangeError("Invalid argument");this.bitData=m.slice()}static makeBytes(h){let u=[];for(const m of h)t(m,8,u);return new ws(ws.Mode.BYTE,h.length,u)}static makeNumeric(h){if(!ws.isNumeric(h))throw new RangeError("String contains non-numeric characters");let u=[];for(let m=0;m<h.length;){const g=Math.min(h.length-m,3);t(parseInt(h.substring(m,m+g),10),g*3+1,u),m+=g}return new ws(ws.Mode.NUMERIC,h.length,u)}static makeAlphanumeric(h){if(!ws.isAlphanumeric(h))throw new RangeError("String contains unencodable characters in alphanumeric mode");let u=[],m;for(m=0;m+2<=h.length;m+=2){let g=ws.ALPHANUMERIC_CHARSET.indexOf(h.charAt(m))*45;g+=ws.ALPHANUMERIC_CHARSET.indexOf(h.charAt(m+1)),t(g,11,u)}return m<h.length&&t(ws.ALPHANUMERIC_CHARSET.indexOf(h.charAt(m)),6,u),new ws(ws.Mode.ALPHANUMERIC,h.length,u)}static makeSegments(h){return h==""?[]:ws.isNumeric(h)?[ws.makeNumeric(h)]:ws.isAlphanumeric(h)?[ws.makeAlphanumeric(h)]:[ws.makeBytes(ws.toUtf8ByteArray(h))]}static makeEci(h){let u=[];if(h<0)throw new RangeError("ECI assignment value out of range");if(h<128)t(h,8,u);else if(h<16384)t(2,2,u),t(h,14,u);else if(h<1e6)t(6,3,u),t(h,21,u);else throw new RangeError("ECI assignment value out of range");return new ws(ws.Mode.ECI,0,u)}static isNumeric(h){return ws.NUMERIC_REGEX.test(h)}static isAlphanumeric(h){return ws.ALPHANUMERIC_REGEX.test(h)}getData(){return this.bitData.slice()}static getTotalBits(h,u){let m=0;for(const g of h){const x=g.mode.numCharCountBits(u);if(g.numChars>=1<<x)return 1/0;m+=4+x+g.bitData.length}return m}static toUtf8ByteArray(h){h=encodeURI(h);let u=[];for(let m=0;m<h.length;m++)h.charAt(m)!="%"?u.push(h.charCodeAt(m)):(u.push(parseInt(h.substring(m+1,m+3),16)),m+=2);return u}};o.NUMERIC_REGEX=/^[0-9]*$/,o.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,o.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let c=o;i.QrSegment=o})(Or||(Or={}));(i=>{(e=>{const t=class{constructor(r,o){this.ordinal=r,this.formatBits=o}};t.LOW=new t(0,1),t.MEDIUM=new t(1,0),t.QUARTILE=new t(2,3),t.HIGH=new t(3,2),e.Ecc=t})(i.QrCode||(i.QrCode={}))})(Or||(Or={}));(i=>{(e=>{const t=class{constructor(r,o){this.modeBits=r,this.numBitsCharCount=o}numCharCountBits(r){return this.numBitsCharCount[Math.floor((r+7)/17)]}};t.NUMERIC=new t(1,[10,12,14]),t.ALPHANUMERIC=new t(2,[9,11,13]),t.BYTE=new t(4,[8,16,16]),t.KANJI=new t(8,[8,10,12]),t.ECI=new t(7,[0,0,0]),e.Mode=t})(i.QrSegment||(i.QrSegment={}))})(Or||(Or={}));var ko=Or;var H5={L:ko.QrCode.Ecc.LOW,M:ko.QrCode.Ecc.MEDIUM,Q:ko.QrCode.Ecc.QUARTILE,H:ko.QrCode.Ecc.HIGH},KE=128,qE="L",zE="#FFFFFF",YE="#000000",WE=!1,QE=1,K5=4,q5=0,z5=.1;function XE(i,e=0){const t=[];return i.forEach(function(n,r){let o=null;n.forEach(function(c,d){if(!c&&o!==null){t.push(`M${o+e} ${r+e}h${d-o}v1H${o+e}z`),o=null;return}if(d===n.length-1){if(!c)return;o===null?t.push(`M${d+e},${r+e} h1v1H${d+e}z`):t.push(`M${o+e},${r+e} h${d+1-o}v1H${o+e}z`);return}c&&o===null&&(o=d)})}),t.join("")}function JE(i,e){return i.slice().map((t,n)=>n<e.y||n>=e.y+e.h?t:t.map((r,o)=>o<e.x||o>=e.x+e.w?r:!1))}function Y5(i,e,t,n){if(n==null)return null;const r=i.length+t*2,o=Math.floor(e*z5),c=r/e,d=(n.width||o)*c,h=(n.height||o)*c,u=n.x==null?i.length/2-d/2:n.x*c,m=n.y==null?i.length/2-h/2:n.y*c,g=n.opacity==null?1:n.opacity;let x=null;if(n.excavate){let v=Math.floor(u),S=Math.floor(m),N=Math.ceil(d+u-v),A=Math.ceil(h+m-S);x={x:v,y:S,w:N,h:A}}const y=n.crossOrigin;return{x:u,y:m,h,w:d,excavation:x,opacity:g,crossOrigin:y}}function W5(i,e){return e!=null?Math.max(Math.floor(e),0):i?K5:q5}function ZE({value:i,level:e,minVersion:t,includeMargin:n,marginSize:r,imageSettings:o,size:c,boostLevel:d}){let h=Us.useMemo(()=>{const v=(Array.isArray(i)?i:[i]).reduce((S,N)=>(S.push(...ko.QrSegment.makeSegments(N)),S),[]);return ko.QrCode.encodeSegments(v,H5[e],t,void 0,void 0,d)},[i,e,t,d]);const{cells:u,margin:m,numCells:g,calculatedImageSettings:x}=Us.useMemo(()=>{let y=h.getModules();const v=W5(n,r),S=y.length+v*2,N=Y5(y,c,v,o);return{cells:y,margin:v,numCells:S,calculatedImageSettings:N}},[h,c,o,n,r]);return{qrcode:h,margin:m,cells:u,numCells:g,calculatedImageSettings:x}}var Q5=(function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0})(),X5=Us.forwardRef(function(e,t){const n=e,{value:r,size:o=KE,level:c=qE,bgColor:d=zE,fgColor:h=YE,includeMargin:u=WE,minVersion:m=QE,boostLevel:g,marginSize:x,imageSettings:y}=n,S=Lg(n,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:N}=S,A=Lg(S,["style"]),R=y?.src,C=Us.useRef(null),D=Us.useRef(null),V=Us.useCallback(ne=>{C.current=ne,typeof t=="function"?t(ne):t&&(t.current=ne)},[t]),[z,B]=Us.useState(!1),{margin:I,cells:M,numCells:L,calculatedImageSettings:O}=ZE({value:r,level:c,minVersion:m,boostLevel:g,includeMargin:u,marginSize:x,imageSettings:y,size:o});Us.useEffect(()=>{if(C.current!=null){const ne=C.current,se=ne.getContext("2d");if(!se)return;let X=M;const ce=D.current,le=O!=null&&ce!==null&&ce.complete&&ce.naturalHeight!==0&&ce.naturalWidth!==0;le&&O.excavation!=null&&(X=JE(M,O.excavation));const Y=window.devicePixelRatio||1;ne.height=ne.width=o*Y;const K=o/L*Y;se.scale(K,K),se.fillStyle=d,se.fillRect(0,0,L,L),se.fillStyle=h,Q5?se.fill(new Path2D(XE(X,I))):M.forEach(function(H,Q){H.forEach(function(oe,ye){oe&&se.fillRect(ye+I,Q+I,1,1)})}),O&&(se.globalAlpha=O.opacity),le&&se.drawImage(ce,O.x+I,O.y+I,O.w,O.h)}}),Us.useEffect(()=>{B(!1)},[R]);const J=Rg({height:o,width:o},N);let ie=null;return R!=null&&(ie=Us.createElement("img",{src:R,key:R,style:{display:"none"},onLoad:()=>{B(!0)},ref:D,crossOrigin:O?.crossOrigin})),Us.createElement(Us.Fragment,null,Us.createElement("canvas",Rg({style:J,height:o,width:o,ref:V,role:"img"},A)),ie)});X5.displayName="QRCodeCanvas";var eN=Us.forwardRef(function(e,t){const n=e,{value:r,size:o=KE,level:c=qE,bgColor:d=zE,fgColor:h=YE,includeMargin:u=WE,minVersion:m=QE,boostLevel:g,title:x,marginSize:y,imageSettings:v}=n,S=Lg(n,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:N,cells:A,numCells:R,calculatedImageSettings:C}=ZE({value:r,level:c,minVersion:m,boostLevel:g,includeMargin:u,marginSize:y,imageSettings:v,size:o});let D=A,V=null;v!=null&&C!=null&&(C.excavation!=null&&(D=JE(A,C.excavation)),V=Us.createElement("image",{href:v.src,height:C.h,width:C.w,x:C.x+N,y:C.y+N,preserveAspectRatio:"none",opacity:C.opacity,crossOrigin:C.crossOrigin}));const z=XE(D,N);return Us.createElement("svg",Rg({height:o,width:o,viewBox:`0 0 ${R} ${R}`,ref:t,role:"img"},S),!!x&&Us.createElement("title",null,x),Us.createElement("path",{fill:d,d:`M0,0 h${R}v${R}H0z`,shapeRendering:"crispEdges"}),Us.createElement("path",{fill:h,d:z,shapeRendering:"crispEdges"}),V)});eN.displayName="QRCodeSVG";function J5(i){if(i===0)return"0 Bytes";const e=1024,t=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(i)/Math.log(e));return parseFloat((i/Math.pow(e,n)).toFixed(2))+" "+t[n]}function Z5(i){switch(i){case"android":return s.jsx(nu,{className:"h-8 w-8"});case"android-tv":return s.jsx(ss,{className:"h-8 w-8"});case"ios":return s.jsx(Xm,{className:"h-8 w-8"});case"macos":return s.jsx(Xm,{className:"h-8 w-8"});case"windows":return s.jsx(Mo,{className:"h-8 w-8"});case"linux":return s.jsx(jS,{className:"h-8 w-8"});default:return s.jsx(Os,{className:"h-8 w-8"})}}function B_(i){switch(i){case"android":case"android-tv":return"bg-green-500/20 text-green-400 border-green-500/30";case"ios":case"macos":return"bg-gray-500/20 text-gray-300 border-gray-500/30";case"windows":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"linux":return"bg-orange-500/20 text-orange-400 border-orange-500/30";default:return"bg-purple-500/20 text-purple-400 border-purple-500/30"}}function eP(){const[i,e]=P.useState(!1),[t,n]=P.useState(null),{data:r,isLoading:o,error:c}=qe({queryKey:["downloads"],queryFn:async()=>{const u=await fetch("/downloads");if(!u.ok)throw new Error("Failed to fetch downloads");return u.json()}}),d=typeof window<"u"?window.location.origin:"",h=u=>{n(u),e(!0)};return s.jsxs("div",{children:[s.jsxs("div",{className:"mb-8",children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Download Apps"}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Download OpenFlix apps for your devices to stream your media library"})]}),o&&s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"})}),c&&s.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-4 text-red-400",children:"Failed to load downloads. Please try again later."}),r&&r.downloads.length===0&&s.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[s.jsx(Os,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No Apps Available"}),s.jsx("p",{className:"text-gray-400",children:"No app downloads are currently available. Check back later."})]}),r&&r.downloads.length>0&&s.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:r.downloads.map(u=>s.jsxs("div",{className:`bg-gray-800 rounded-xl p-6 border ${B_(u.platform)} hover:border-opacity-60 transition-colors`,children:[s.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[s.jsx("div",{className:`p-3 rounded-lg ${B_(u.platform)}`,children:Z5(u.platform)}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"text-lg font-semibold text-white truncate",children:u.name}),s.jsxs("p",{className:"text-sm text-gray-400",children:["Version ",u.version]})]})]}),s.jsx("p",{className:"text-sm text-gray-300 mb-4",children:u.description}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-500",children:J5(u.size)}),s.jsxs("div",{className:"flex gap-2",children:[(u.platform==="android"||u.platform==="android-tv")&&s.jsxs("button",{onClick:()=>h(u),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white text-sm font-medium rounded-lg transition-colors",title:"Send to TV",children:[s.jsx(bC,{className:"h-4 w-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Send to TV"})]}),s.jsxs("a",{href:u.downloadUrl,download:!0,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium rounded-lg transition-colors",children:[s.jsx(Os,{className:"h-4 w-4"}),"Download"]})]})]})]},u.filename))}),s.jsxs("div",{className:"mt-12",children:[s.jsx("h2",{className:"text-xl font-semibold text-white mb-6",children:"Installation Instructions"}),s.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx(ss,{className:"h-6 w-6 text-green-400"}),s.jsx("h3",{className:"text-lg font-medium text-white",children:"Android TV / Fire TV"})]}),s.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-sm text-gray-300",children:[s.jsx("li",{children:"Download the APK file to a USB drive or use a file manager app"}),s.jsxs("li",{children:['Enable "Install from unknown sources" in Settings ',">"," Security"]}),s.jsx("li",{children:"Use a file manager to locate and install the APK"}),s.jsx("li",{children:"Launch OpenFlix from your apps"})]})]}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx(nu,{className:"h-6 w-6 text-green-400"}),s.jsx("h3",{className:"text-lg font-medium text-white",children:"Android Phone / Tablet"})]}),s.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-sm text-gray-300",children:[s.jsx("li",{children:"Download the APK file directly on your device"}),s.jsx("li",{children:"Open the downloaded file from your notifications or Downloads app"}),s.jsx("li",{children:"Allow installation from this source if prompted"}),s.jsx("li",{children:"Tap Install and wait for completion"})]})]})]})]}),s.jsxs("div",{className:"mt-8 bg-gray-800 rounded-xl p-6",children:[s.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"Quick Setup"}),s.jsx("p",{className:"text-sm text-gray-300 mb-4",children:"After installing the app, open it and enter your server address to connect:"}),s.jsx("div",{className:"bg-gray-900 rounded-lg p-4 font-mono text-indigo-400",children:d||"http://your-server:32400"})]}),i&&t&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",onClick:()=>e(!1),children:s.jsxs("div",{className:"bg-gray-800 rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto",onClick:u=>u.stopPropagation(),children:[s.jsxs("div",{className:"p-6 border-b border-gray-700",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h2",{className:"text-xl font-bold text-white",children:"Send App to Your TV"}),s.jsx("button",{onClick:()=>e(!1),className:"text-gray-400 hover:text-white p-1",children:s.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsxs("p",{className:"text-gray-400 text-sm mt-1",children:["Follow these easy steps to install ",t.name]})]}),s.jsxs("div",{className:"p-6 flex flex-col items-center border-b border-gray-700",children:[s.jsx("div",{className:"bg-white p-4 rounded-xl",children:s.jsx(eN,{value:t.downloadUrl,size:180,level:"M"})}),s.jsx("p",{className:"text-gray-400 text-sm mt-3 text-center",children:"Scan with your phone to download the app"})]}),s.jsxs("div",{className:"p-6",children:[s.jsxs("h3",{className:"text-white font-semibold mb-4 flex items-center gap-2",children:[s.jsx(nu,{className:"h-5 w-5 text-indigo-400"}),"Easy 3-Step Setup"]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex gap-4",children:[s.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center text-white font-bold text-sm",children:"1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-white font-medium",children:"Scan QR Code with your phone"}),s.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Use your phone's camera app to scan the QR code above. The APK will download to your phone."})]})]}),s.jsxs("div",{className:"flex gap-4",children:[s.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center text-white font-bold text-sm",children:"2"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-white font-medium",children:'Install "Send Files to TV" app'}),s.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Get this free app on both your phone AND your TV from their app stores."}),s.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[s.jsxs("a",{href:"https://play.google.com/store/apps/details?id=com.yablio.sendfilestotv",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xs bg-green-700 hover:bg-green-600 text-white px-3 py-1.5 rounded-lg transition-colors",children:[s.jsx(nu,{className:"h-3 w-3"}),"Android Phone"]}),s.jsxs("a",{href:"https://apps.apple.com/app/send-files-to-android-tv/id6723898949",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xs bg-gray-600 hover:bg-gray-500 text-white px-3 py-1.5 rounded-lg transition-colors",children:[s.jsx(Xm,{className:"h-3 w-3"}),"iPhone"]}),s.jsxs("a",{href:"https://play.google.com/store/apps/details?id=com.yablio.sendfilestotv",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xs bg-indigo-700 hover:bg-indigo-600 text-white px-3 py-1.5 rounded-lg transition-colors",children:[s.jsx(ss,{className:"h-3 w-3"}),"Android TV"]})]})]})]}),s.jsxs("div",{className:"flex gap-4",children:[s.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center text-white font-bold text-sm",children:"3"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-white font-medium",children:"Send the APK to your TV"}),s.jsx("p",{className:"text-gray-400 text-sm mt-1",children:'Open "Send Files to TV" on your phone, select the downloaded APK, and send it to your TV. Then install it on your TV!'})]})]})]}),s.jsx("div",{className:"mt-6 p-4 bg-green-500/10 border border-green-500/30 rounded-lg",children:s.jsxs("div",{className:"flex gap-3",children:[s.jsx(Ua,{className:"h-5 w-5 text-green-400 flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-green-400 font-medium text-sm",children:"After Installation"}),s.jsx("p",{className:"text-gray-300 text-sm mt-1",children:"Open OpenFlix on your TV and enter this server address:"}),s.jsx("code",{className:"block mt-2 text-indigo-400 bg-gray-900 px-3 py-2 rounded text-sm",children:d})]})]})})]}),s.jsxs("div",{className:"p-4 border-t border-gray-700 flex justify-between items-center",children:[s.jsxs("a",{href:t.downloadUrl,download:!0,className:"text-sm text-gray-400 hover:text-white flex items-center gap-1",children:[s.jsx(Os,{className:"h-4 w-4"}),"Direct download instead"]}),s.jsx("button",{onClick:()=>e(!1),className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium rounded-lg transition-colors",children:"Done"})]})]})})]})}const Er=async(i,e)=>{const t=localStorage.getItem("openflix_token")||"",n=await fetch(i,{...e,headers:{"X-Plex-Token":t,"Content-Type":"application/json",...e?.headers}});if(!n.ok)throw new Error(`API error: ${n.status}`);return n.json()};function tP({strength:i}){const t=Math.round(i/100*5),n=r=>r>t?"bg-gray-600":i>=80?"bg-green-500":i>=50?"bg-yellow-500":"bg-red-500";return s.jsx("div",{className:"flex items-end gap-0.5 h-4",title:`${i}%`,children:Array.from({length:5}).map((r,o)=>s.jsx("div",{className:`w-1.5 rounded-sm transition-all ${n(o+1)}`,style:{height:`${(o+1)/5*100}%`}},o))})}function sP({onClose:i,onAdd:e,isAdding:t}){const[n,r]=P.useState(""),o=c=>{c.preventDefault(),n.trim()&&e(n.trim())};return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-lg font-semibold text-white",children:"Add Tuner Manually"}),s.jsx("button",{onClick:i,className:"p-1 text-gray-400 hover:text-white",children:s.jsx(At,{className:"h-5 w-5"})})]}),s.jsxs("form",{onSubmit:o,children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Tuner URL"}),s.jsx("input",{type:"text",value:n,onChange:c=>r(c.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://192.168.1.100:5004",required:!0}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter the base URL of your HDHomeRun device."})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{type:"button",onClick:i,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:t||!n.trim(),className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg",children:t?"Adding...":"Add Tuner"})]})]})]})})}function nP({tuner:i,onRemove:e,onImportChannels:t,isImporting:n}){const[r,o]=P.useState(!1),{data:c,isLoading:d}=qe({queryKey:["tunerStatus",i.id],queryFn:()=>Er(`/api/tuners/${i.id}/status`),refetchInterval:5e3}),{data:h,isLoading:u}=qe({queryKey:["tunerLineup",i.id],queryFn:()=>Er(`/api/tuners/${i.id}/lineup`),enabled:r}),m=c?.tuners||[],g=m.filter(x=>x.active).length;return s.jsx("div",{className:"bg-gray-800 rounded-xl overflow-hidden",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"p-3 bg-gray-700 rounded-lg",children:s.jsx(sn,{className:"h-6 w-6 text-indigo-400"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-white",children:i.name||i.model}),s.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 mt-1 text-sm text-gray-400",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Vu,{className:"h-3.5 w-3.5"}),i.ip]}),i.model&&s.jsxs("span",{children:["Model: ",i.model]}),i.firmware&&s.jsxs("span",{children:["Firmware: ",i.firmware]}),s.jsxs("span",{children:[i.tunerCount," tuner",i.tunerCount!==1?"s":""]})]})]})]}),s.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[s.jsxs("button",{onClick:t,disabled:n,className:"flex items-center gap-1.5 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white text-sm rounded-lg transition-colors",children:[n?s.jsx(nt,{className:"h-3.5 w-3.5 animate-spin"}):s.jsx(Os,{className:"h-3.5 w-3.5"}),"Import Channels"]}),s.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Remove tuner",children:s.jsx(ts,{className:"h-4 w-4"})})]})]}),s.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("h4",{className:"text-sm font-medium text-gray-400",children:["Tuner Status",g>0&&s.jsxs("span",{className:"ml-2 text-green-400",children:["(",g," active)"]})]}),d&&s.jsx(nt,{className:"h-4 w-4 text-gray-500 animate-spin"})]}),m.length>0?s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:m.map((x,y)=>s.jsxs("div",{className:`p-3 rounded-lg ${x.active?"bg-green-500/10 border border-green-500/30":"bg-gray-700/50 border border-gray-700"}`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("span",{className:"text-xs font-medium text-gray-400",children:["Tuner ",y+1]}),s.jsx(tP,{strength:x.signalStrength})]}),x.active?s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-white font-medium",children:x.channel||"Active"}),s.jsxs("div",{className:"flex gap-2 mt-1 text-xs text-gray-400",children:[s.jsxs("span",{children:["Sig: ",x.signalStrength,"%"]}),s.jsxs("span",{children:["Qual: ",x.signalQuality,"%"]})]})]}):s.jsx("p",{className:"text-sm text-gray-500",children:"Idle"})]},x.id||y))}):d?null:s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:Array.from({length:i.tunerCount||2}).map((x,y)=>s.jsxs("div",{className:"p-3 rounded-lg bg-gray-700/50 border border-gray-700",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("span",{className:"text-xs font-medium text-gray-400",children:["Tuner ",y+1]}),s.jsx($C,{className:"h-4 w-4 text-gray-600"})]}),s.jsx("p",{className:"text-sm text-gray-500",children:"Idle"})]},y))})]}),s.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[s.jsx("button",{onClick:()=>o(!r),className:"text-sm text-indigo-400 hover:text-indigo-300 transition-colors",children:r?"Hide Channel Lineup":"Show Channel Lineup"}),r&&s.jsx("div",{className:"mt-3",children:u?s.jsx("div",{className:"flex items-center justify-center py-6",children:s.jsx(nt,{className:"h-6 w-6 text-indigo-500 animate-spin"})}):h&&h.channels.length>0?s.jsx("div",{className:"overflow-x-auto max-h-96 overflow-y-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"sticky top-0 bg-gray-800",children:s.jsxs("tr",{className:"border-b border-gray-700",children:[s.jsx("th",{className:"text-left py-2 px-3 text-xs font-medium text-gray-400",children:"Ch"}),s.jsx("th",{className:"text-left py-2 px-3 text-xs font-medium text-gray-400",children:"Name"}),s.jsx("th",{className:"text-left py-2 px-3 text-xs font-medium text-gray-400",children:"HD"}),s.jsx("th",{className:"text-left py-2 px-3 text-xs font-medium text-gray-400",children:"Status"})]})}),s.jsx("tbody",{children:h.channels.map(x=>s.jsxs("tr",{className:"border-b border-gray-700/50 hover:bg-gray-700/30",children:[s.jsx("td",{className:"py-2 px-3 text-sm text-white font-mono",children:x.number}),s.jsx("td",{className:"py-2 px-3 text-sm text-gray-300",children:x.name}),s.jsx("td",{className:"py-2 px-3",children:x.hd&&s.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-indigo-500/20 text-indigo-400 rounded",children:"HD"})}),s.jsx("td",{className:"py-2 px-3",children:x.enabled?s.jsxs("span",{className:"flex items-center gap-1 text-xs text-green-400",children:[s.jsx(vs,{className:"h-3 w-3"}),"Enabled"]}):s.jsx("span",{className:"text-xs text-gray-500",children:"Disabled"})})]},x.number))})]})}):s.jsx("div",{className:"text-center py-6",children:s.jsx("p",{className:"text-gray-500 text-sm",children:"No channels in lineup"})})})]})]})})}function iP(){const i=ft(),[e,t]=P.useState(!1),[n,r]=P.useState(null),{data:o,isLoading:c,error:d}=qe({queryKey:["tuners"],queryFn:()=>Er("/api/tuners")}),h=Ve({mutationFn:()=>Er("/api/tuners/discover",{method:"POST"}),onSuccess:()=>{i.invalidateQueries({queryKey:["tuners"]})}}),u=Ve({mutationFn:y=>Er("/api/tuners",{method:"POST",body:JSON.stringify({url:y})}),onSuccess:()=>{i.invalidateQueries({queryKey:["tuners"]}),t(!1)}}),m=Ve({mutationFn:y=>Er(`/api/tuners/${y}`,{method:"DELETE"}),onSuccess:()=>{i.invalidateQueries({queryKey:["tuners"]})}}),g=async y=>{r(y);try{await Er(`/api/tuners/${y}/import`,{method:"POST"}),i.invalidateQueries({queryKey:["tunerLineup",y]})}catch(v){console.error("Channel import failed:",v)}finally{r(null)}},x=o?.tuners||[];return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-8",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(sn,{className:"h-6 w-6 text-indigo-400"}),s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Tuners"})]}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Manage HDHomeRun and network tuner devices"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:()=>h.mutate(),disabled:h.isPending,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg",children:[h.isPending?s.jsx(nt,{className:"h-4 w-4 animate-spin"}):s.jsx(Et,{className:"h-4 w-4"}),"Discover Tuners"]}),s.jsxs("button",{onClick:()=>t(!0),className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:[s.jsx(rs,{className:"h-4 w-4"}),"Add Manually"]})]})]}),h.isSuccess&&s.jsxs("div",{className:"mb-6 flex items-center gap-2 p-3 bg-green-500/10 border border-green-500/30 rounded-lg",children:[s.jsx(vs,{className:"h-4 w-4 text-green-400"}),s.jsx("span",{className:"text-green-400 text-sm",children:"Network discovery complete. Found tuners have been added."})]}),h.isError&&s.jsxs("div",{className:"mb-6 flex items-center gap-2 p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:[s.jsx(Ct,{className:"h-4 w-4 text-red-400"}),s.jsx("span",{className:"text-red-400 text-sm",children:"Discovery failed. Check that your network allows broadcast traffic."})]}),c?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx(nt,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):d?s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 text-center",children:[s.jsx(Ct,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Failed to Load Tuners"}),s.jsx("p",{className:"text-gray-400",children:"Could not retrieve tuner information from the server."})]}):x.length===0?s.jsxs("div",{className:"bg-gray-800 rounded-xl p-12 text-center",children:[s.jsx(sn,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No Tuners Found"}),s.jsx("p",{className:"text-gray-400 mb-6",children:'Connect an HDHomeRun device to your network and click "Discover Tuners" to find it.'}),s.jsxs("div",{className:"flex justify-center gap-3",children:[s.jsxs("button",{onClick:()=>h.mutate(),disabled:h.isPending,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[h.isPending?s.jsx(nt,{className:"h-4 w-4 animate-spin"}):s.jsx(Et,{className:"h-4 w-4"}),"Discover Tuners"]}),s.jsxs("button",{onClick:()=>t(!0),className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:[s.jsx(rs,{className:"h-4 w-4"}),"Add Manually"]})]})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"bg-gray-800 rounded-xl p-4",children:[s.jsx("p",{className:"text-2xl font-bold text-white",children:x.length}),s.jsxs("p",{className:"text-sm text-gray-400",children:["Tuner Device",x.length!==1?"s":""]})]}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-4",children:[s.jsx("p",{className:"text-2xl font-bold text-white",children:x.reduce((y,v)=>y+(v.tunerCount||0),0)}),s.jsx("p",{className:"text-sm text-gray-400",children:"Total Tuners"})]}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-4",children:[s.jsx("p",{className:"text-2xl font-bold text-green-400",children:x.filter(y=>y.firmware).length}),s.jsx("p",{className:"text-sm text-gray-400",children:"Online"})]}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-4",children:[s.jsx("p",{className:"text-2xl font-bold text-gray-400",children:x.filter(y=>!y.firmware).length}),s.jsx("p",{className:"text-sm text-gray-400",children:"Offline"})]})]}),s.jsx("div",{className:"space-y-4",children:x.map(y=>s.jsx(nP,{tuner:y,onRemove:()=>{confirm(`Remove tuner ${y.name||y.model}?`)&&m.mutate(y.id)},onImportChannels:()=>g(y.id),isImporting:n===y.id},y.id))})]}),e&&s.jsx(sP,{onClose:()=>t(!1),onAdd:y=>u.mutate(y),isAdding:u.isPending})]})}const Xo={"X-Plex-Token":localStorage.getItem("openflix_token")||"","Content-Type":"application/json"};async function aP(){const i=await fetch("/dvr/v2/channel-collections",{headers:Xo});if(!i.ok)throw new Error("Failed to fetch channel collections");return(await i.json()).collections||[]}async function rP(i){const e=await fetch("/dvr/v2/channel-collections",{method:"POST",headers:Xo,body:JSON.stringify(i)});if(!e.ok)throw new Error("Failed to create channel collection");return e.json()}async function oP(i,e){const t=await fetch(`/dvr/v2/channel-collections/${i}`,{method:"PUT",headers:Xo,body:JSON.stringify(e)});if(!t.ok)throw new Error("Failed to update channel collection");return t.json()}async function lP(i){if(!(await fetch(`/dvr/v2/channel-collections/${i}`,{method:"DELETE",headers:Xo})).ok)throw new Error("Failed to delete channel collection")}async function cP(){const i=await fetch("/livetv/channels",{headers:Xo});if(!i.ok)throw new Error("Failed to fetch channels");return(await i.json()).channels||[]}async function dP(){const i=await fetch("/dvr/v2/virtual-stations",{headers:Xo});if(!i.ok)throw new Error("Failed to fetch virtual stations");return(await i.json()).stations||[]}function Mu(i){return i?i.split(",").map(e=>parseInt(e.trim(),10)).filter(e=>!isNaN(e)):[]}function U_(i){return i.join(",")}function F_(i){const e=localStorage.getItem("openflix_token")||"";return`/dvr/v2/channel-collections/${i}/export.m3u?X-Plex-Token=${e}`}function uP({allChannels:i,selectedIds:e,onChange:t}){const[n,r]=P.useState(""),[o,c]=P.useState(""),d=P.useMemo(()=>new Set(e),[e]),h=P.useMemo(()=>i.filter(A=>{if(d.has(A.id))return!1;if(!n.trim())return!0;const R=n.toLowerCase();return A.name.toLowerCase().includes(R)||String(A.number).includes(R)||A.group?.toLowerCase().includes(R)}),[i,d,n]),u=P.useMemo(()=>e.map(A=>i.find(R=>R.id===A)).filter(Boolean),[e,i]),m=P.useMemo(()=>u.filter(A=>{if(!o.trim())return!0;const R=o.toLowerCase();return A.name.toLowerCase().includes(R)||String(A.number).includes(R)}),[u,o]),g=A=>{t([...e,A])},x=A=>{t(e.filter(R=>R!==A))},y=A=>{if(A<=0)return;const R=[...e];[R[A-1],R[A]]=[R[A],R[A-1]],t(R)},v=A=>{if(A>=e.length-1)return;const R=[...e];[R[A],R[A+1]]=[R[A+1],R[A]],t(R)},S=()=>{const A=h.map(R=>R.id);t([...e,...A])},N=()=>{t([])};return s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("label",{className:"text-sm font-medium text-gray-300",children:["Available (",h.length,")"]}),s.jsx("button",{type:"button",onClick:S,className:"text-xs text-indigo-400 hover:text-indigo-300 transition-colors",children:"Add All"})]}),s.jsxs("div",{className:"relative mb-2",children:[s.jsx(qt,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),s.jsx("input",{type:"text",value:n,onChange:A=>r(A.target.value),placeholder:"Search...",className:"w-full pl-8 pr-3 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-white text-xs placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),s.jsx("div",{className:"bg-gray-700/40 border border-gray-600 rounded-lg max-h-64 overflow-y-auto",children:h.length===0?s.jsx("div",{className:"p-4 text-center text-xs text-gray-500",children:n?"No matches":"All channels selected"}):h.map(A=>s.jsxs("button",{type:"button",onClick:()=>g(A.id),className:"w-full flex items-center gap-2 px-3 py-2 text-left hover:bg-gray-700 transition-colors border-b border-gray-700/50 last:border-0",children:[A.logo?s.jsx("img",{src:A.logo,alt:"",className:"w-6 h-6 rounded object-contain flex-shrink-0 bg-gray-800"}):s.jsx("div",{className:"w-6 h-6 rounded bg-gray-800 flex items-center justify-center flex-shrink-0",children:s.jsx(ss,{className:"w-3 h-3 text-gray-600"})}),s.jsx("span",{className:"text-xs text-gray-400 font-mono w-8 text-right flex-shrink-0",children:A.number}),s.jsx("span",{className:"text-sm text-gray-300 truncate flex-1",children:A.name}),s.jsx(Va,{className:"w-3.5 h-3.5 text-gray-600 flex-shrink-0"})]},A.id))})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("label",{className:"text-sm font-medium text-gray-300",children:["Selected (",e.length,")"]}),e.length>0&&s.jsx("button",{type:"button",onClick:N,className:"text-xs text-red-400 hover:text-red-300 transition-colors",children:"Remove All"})]}),s.jsxs("div",{className:"relative mb-2",children:[s.jsx(qt,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),s.jsx("input",{type:"text",value:o,onChange:A=>c(A.target.value),placeholder:"Search...",className:"w-full pl-8 pr-3 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-white text-xs placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),s.jsx("div",{className:"bg-gray-700/40 border border-gray-600 rounded-lg max-h-64 overflow-y-auto",children:m.length===0?s.jsx("div",{className:"p-4 text-center text-xs text-gray-500",children:o?"No matches":"No channels selected"}):m.map(A=>{const R=e.indexOf(A.id);return s.jsxs("div",{className:"flex items-center gap-1 px-2 py-1.5 border-b border-gray-700/50 last:border-0 group",children:[s.jsx(Aj,{className:"w-3.5 h-3.5 text-gray-600 flex-shrink-0"}),s.jsx("span",{className:"text-xs text-gray-500 font-mono w-5 text-right flex-shrink-0",children:R+1}),A.logo?s.jsx("img",{src:A.logo,alt:"",className:"w-5 h-5 rounded object-contain flex-shrink-0 bg-gray-800"}):s.jsx("div",{className:"w-5 h-5 rounded bg-gray-800 flex items-center justify-center flex-shrink-0",children:s.jsx(ss,{className:"w-2.5 h-2.5 text-gray-600"})}),s.jsx("span",{className:"text-sm text-gray-300 truncate flex-1",children:A.name}),s.jsxs("div",{className:"flex items-center gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",children:[s.jsx("button",{type:"button",onClick:()=>y(R),disabled:R===0,className:"p-0.5 text-gray-500 hover:text-white disabled:opacity-30 transition-colors",title:"Move up",children:s.jsx(Qg,{className:"w-3.5 h-3.5 rotate-90"})}),s.jsx("button",{type:"button",onClick:()=>v(R),disabled:R===e.length-1,className:"p-0.5 text-gray-500 hover:text-white disabled:opacity-30 transition-colors",title:"Move down",children:s.jsx(Va,{className:"w-3.5 h-3.5 rotate-90"})}),s.jsx("button",{type:"button",onClick:()=>x(A.id),className:"p-0.5 text-gray-500 hover:text-red-400 transition-colors",title:"Remove",children:s.jsx(At,{className:"w-3.5 h-3.5"})})]})]},A.id)})})]})]})}function hP({collection:i,onClose:e}){const t=ft(),n=!!i,[r,o]=P.useState(i?.name||""),[c,d]=P.useState(i?.description||""),[h,u]=P.useState(Mu(i?.channelIds)),[m,g]=P.useState(Mu(i?.virtualStationIds)),{data:x,isLoading:y}=qe({queryKey:["live-channels"],queryFn:cP}),{data:v}=qe({queryKey:["virtual-stations"],queryFn:dP}),S=Ve({mutationFn:rP,onSuccess:()=>{t.invalidateQueries({queryKey:["channel-collections"]}),e()}}),N=Ve({mutationFn:D=>oP(i.id,D),onSuccess:()=>{t.invalidateQueries({queryKey:["channel-collections"]}),e()}}),A=S.isPending||N.isPending,R=D=>{g(V=>V.includes(D)?V.filter(z=>z!==D):[...V,D])},C=D=>{D.preventDefault();const V={name:r,description:c||void 0,channelIds:U_(h),virtualStationIds:U_(m)||void 0};n?N.mutate(V):S.mutate(V)};return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"sticky top-0 bg-gray-800 px-6 pt-6 pb-4 border-b border-gray-700 flex items-center justify-between z-10",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Zg,{className:"w-5 h-5 text-indigo-400"}),s.jsx("h2",{className:"text-lg font-semibold text-white",children:n?"Edit Channel Lineup":"Create Channel Lineup"})]}),s.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-white rounded-lg hover:bg-gray-700 transition-colors",children:s.jsx(At,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:C,className:"p-6 space-y-5",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Lineup Name"}),s.jsx("input",{type:"text",value:r,onChange:D=>o(D.target.value),required:!0,placeholder:"My Custom Lineup",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Description"}),s.jsx("input",{type:"text",value:c,onChange:D=>d(D.target.value),placeholder:"Optional description",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-gray-300 mb-3",children:"Channels"}),y?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx(nt,{className:"w-6 h-6 text-indigo-500 animate-spin"})}):x?s.jsx(uP,{allChannels:x,selectedIds:h,onChange:u}):s.jsx("p",{className:"text-gray-500 text-sm",children:"No channels available"})]}),v&&v.length>0&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-gray-300 mb-3",children:"Include Virtual Stations"}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:v.filter(D=>D.enabled).map(D=>{const V=m.includes(D.id);return s.jsxs("button",{type:"button",onClick:()=>R(D.id),className:`flex items-center gap-2 px-3 py-2 rounded-lg border text-sm text-left transition-colors ${V?"border-indigo-500 bg-indigo-500/10 text-white":"border-gray-600 bg-gray-700/40 text-gray-400 hover:border-gray-500"}`,children:[s.jsx(sn,{className:`w-4 h-4 flex-shrink-0 ${V?"text-indigo-400":"text-gray-500"}`}),s.jsx("span",{className:"truncate",children:D.name}),s.jsxs("span",{className:"text-xs text-gray-500 font-mono flex-shrink-0",children:["#",D.number]})]},D.id)})})]}),(S.isError||N.isError)&&s.jsxs("p",{className:"text-red-400 text-sm flex items-center gap-1",children:[s.jsx(Ct,{className:"w-4 h-4"}),(S.error||N.error)?.message||"Operation failed"]}),s.jsxs("div",{className:"flex gap-3 pt-2",children:[s.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2.5 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:A||!r.trim(),className:"flex-1 py-2.5 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-40 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors",children:A?s.jsx(nt,{className:"w-4 h-4 animate-spin mx-auto"}):n?"Save Changes":"Create Lineup"})]})]})]})})}function fP({lineup:i,onEdit:e,onDelete:t}){const[n,r]=P.useState(!1),o=Mu(i.channelIds).length,c=Mu(i.virtualStationIds).length,d=o+c,h=()=>{const m=F_(i.id);window.open(m,"_blank")},u=async()=>{const m=`${window.location.origin}${F_(i.id)}`;try{await navigator.clipboard.writeText(m),r(!0),setTimeout(()=>r(!1),2e3)}catch{const g=document.createElement("textarea");g.value=m,document.body.appendChild(g),g.select(),document.execCommand("copy"),document.body.removeChild(g),r(!0),setTimeout(()=>r(!1),2e3)}};return s.jsx("div",{className:"bg-gray-800 rounded-xl p-5 border border-gray-700 hover:border-gray-600 transition-colors",children:s.jsxs("div",{className:"flex items-start justify-between gap-4",children:[s.jsxs("div",{className:"flex items-start gap-4 flex-1 min-w-0",children:[s.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-indigo-600/20 rounded-xl flex items-center justify-center",children:s.jsx(Zg,{className:"w-6 h-6 text-indigo-400"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"text-white font-semibold truncate",children:i.name}),i.description&&s.jsx("p",{className:"text-sm text-gray-400 line-clamp-1 mt-0.5",children:i.description}),s.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-2 text-xs text-gray-500",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(ss,{className:"w-3 h-3"}),o," channels"]}),c>0&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(sn,{className:"w-3 h-3"}),c," virtual"]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Jg,{className:"w-3 h-3"}),d," total"]})]})]})]}),s.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[s.jsx("button",{onClick:h,className:"p-2 text-gray-400 hover:text-green-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Export M3U",children:s.jsx(Os,{className:"w-4 h-4"})}),s.jsx("button",{onClick:u,className:"p-2 text-gray-400 hover:text-blue-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Copy M3U URL",children:n?s.jsx(qs,{className:"w-4 h-4 text-green-400"}):s.jsx(sj,{className:"w-4 h-4"})}),s.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-indigo-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Edit",children:s.jsx(Ri,{className:"w-4 h-4"})}),s.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Delete",children:s.jsx(ts,{className:"w-4 h-4"})})]})]})})}function mP(){const i=ft(),{data:e,isLoading:t,error:n}=qe({queryKey:["channel-collections"],queryFn:aP}),r=Ve({mutationFn:lP,onSuccess:()=>i.invalidateQueries({queryKey:["channel-collections"]})}),[o,c]=P.useState(null),[d,h]=P.useState(""),u=(e||[]).filter(g=>{if(!d.trim())return!0;const x=d.toLowerCase();return g.name.toLowerCase().includes(x)||g.description?.toLowerCase().includes(x)}),m=g=>{confirm("Delete this channel lineup? This cannot be undone.")&&r.mutate(g)};return s.jsxs("div",{children:[s.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Channel Lineups"}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Build custom channel lineups and export them as M3U playlists"})]}),s.jsxs("button",{onClick:()=>c("new"),className:"flex items-center gap-2 px-4 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors",children:[s.jsx(rs,{className:"w-4 h-4"}),"New Lineup"]})]}),(e?.length||0)>3&&s.jsxs("div",{className:"relative mb-6",children:[s.jsx(qt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),s.jsx("input",{type:"text",value:d,onChange:g=>h(g.target.value),placeholder:"Search lineups...",className:"w-full pl-10 pr-4 py-2.5 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),t?s.jsx("div",{className:"flex items-center justify-center py-16",children:s.jsx(nt,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):n?s.jsxs("div",{className:"text-center py-16 bg-gray-800 rounded-xl",children:[s.jsx(Ct,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Failed to load channel lineups"}),s.jsx("p",{className:"text-gray-400 text-sm",children:n instanceof Error?n.message:"Unknown error"})]}):u.length===0?s.jsxs("div",{className:"text-center py-16 bg-gray-800 rounded-xl",children:[s.jsx(Zg,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:d?"No matching lineups":"No channel lineups yet"}),s.jsx("p",{className:"text-gray-400 mb-6",children:d?`No lineups match "${d}"`:"Create custom channel lineups for external players via M3U."}),!d&&s.jsxs("button",{onClick:()=>c("new"),className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors",children:[s.jsx(rs,{className:"w-4 h-4"}),"New Lineup"]})]}):s.jsx("div",{className:"space-y-3",children:u.map(g=>s.jsx(fP,{lineup:g,onEdit:()=>c(g),onDelete:()=>m(g.id)},g.id))}),o!==null&&s.jsx(hP,{collection:o==="new"?null:o,onClose:()=>c(null)})]})}const kg=async(i,e)=>{const t=localStorage.getItem("openflix_token")||"",n=await fetch(i,{...e,headers:{"X-Plex-Token":t,"Content-Type":"application/json",...e?.headers}});if(!n.ok)throw new Error(`API error: ${n.status}`);return n.json()};function gP(i,e){return qe({queryKey:["mediaSearch",i,e],queryFn:()=>kg(`/admin/media?search=${encodeURIComponent(i)}&page=${e}`),enabled:i.length>=2,placeholderData:t=>t})}function pu(i){if(!i)return"";const e=localStorage.getItem("openflix_token")||"";return`/api/images/proxy?url=${encodeURIComponent(i)}&X-Plex-Token=${e}`}function pP({items:i,onSelect:e}){return s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:i.map(t=>s.jsxs("button",{onClick:()=>e(t),className:"group bg-gray-700/50 rounded-lg overflow-hidden text-left hover:ring-2 hover:ring-indigo-500 transition-all",children:[s.jsxs("div",{className:"aspect-[2/3] bg-gray-700 relative",children:[t.posterUrl?s.jsx("img",{src:pu(t.posterUrl),alt:t.title,className:"w-full h-full object-cover",loading:"lazy"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center",children:s.jsx(Dr,{className:"h-8 w-8 text-gray-600"})}),s.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-colors flex items-center justify-center",children:s.jsx(bu,{className:"h-6 w-6 text-white opacity-0 group-hover:opacity-100 transition-opacity"})})]}),s.jsxs("div",{className:"p-2",children:[s.jsx("p",{className:"text-sm text-white truncate",children:t.title}),s.jsxs("p",{className:"text-xs text-gray-400",children:[t.year&&`${t.year} - `,s.jsx("span",{className:"capitalize",children:t.type})]})]})]},t.id))})}function xP({item:i,onClose:e}){const[t,n]=P.useState("poster"),[r,o]=P.useState(""),[c,d]=P.useState(null),[h,u]=P.useState(!1),[m,g]=P.useState(null),{data:x,isLoading:y}=qe({queryKey:["tmdbArtwork",i.id,i.tmdbId,t],queryFn:async()=>i.tmdbId?(await kg(`/admin/media/${i.id}/artwork?type=${t}&tmdbId=${i.tmdbId}`)).results||[]:[],enabled:!!i.tmdbId}),v=t==="poster"?i.posterUrl:i.backdropUrl,S=c||r||null,N=P.useCallback(async()=>{const A=c||r;if(A){u(!0),g(null);try{await kg(`/admin/media/${i.id}/artwork`,{method:"PUT",body:JSON.stringify({type:t,url:A})}),g({success:!0,message:"Artwork updated successfully"})}catch(R){g({success:!1,message:R instanceof Error?R.message:"Failed to update artwork"})}finally{u(!1)}}},[c,r,t,i.id]);return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg transition-colors",children:s.jsx(Yg,{className:"h-5 w-5"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-white",children:i.title}),s.jsxs("p",{className:"text-sm text-gray-400",children:[i.year&&`${i.year} - `,s.jsx("span",{className:"capitalize",children:i.type}),i.tmdbId&&` - TMDB: ${i.tmdbId}`]})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>{n("poster"),d(null),o(""),g(null)},className:`px-4 py-2 rounded-lg font-medium ${t==="poster"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-400 hover:text-white"}`,children:"Poster"}),s.jsx("button",{onClick:()=>{n("backdrop"),d(null),o(""),g(null)},className:`px-4 py-2 rounded-lg font-medium ${t==="backdrop"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-400 hover:text-white"}`,children:"Backdrop"})]}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-400 uppercase tracking-wider mb-4",children:"Preview"}),s.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Current"}),s.jsx("div",{className:`bg-gray-700 rounded-lg overflow-hidden ${t==="poster"?"aspect-[2/3]":"aspect-video"}`,children:v?s.jsx("img",{src:pu(v),alt:"Current artwork",className:"w-full h-full object-cover"}):s.jsxs("div",{className:"w-full h-full flex items-center justify-center",children:[s.jsx(Dr,{className:"h-12 w-12 text-gray-600"}),s.jsx("span",{className:"text-gray-500 ml-2",children:"No artwork"})]})})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"New"}),s.jsx("div",{className:`bg-gray-700 rounded-lg overflow-hidden border-2 ${S?"border-indigo-500":"border-gray-600 border-dashed"} ${t==="poster"?"aspect-[2/3]":"aspect-video"}`,children:S?s.jsx("img",{src:pu(S),alt:"New artwork",className:"w-full h-full object-cover"}):s.jsxs("div",{className:"w-full h-full flex items-center justify-center",children:[s.jsx(bu,{className:"h-12 w-12 text-gray-600"}),s.jsx("span",{className:"text-gray-500 ml-2",children:"Select artwork below"})]})})]})]}),S&&s.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[s.jsxs("button",{onClick:N,disabled:h,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg",children:[h?s.jsx(nt,{className:"h-4 w-4 animate-spin"}):s.jsx(bu,{className:"h-4 w-4"}),h?"Saving...":"Apply Artwork"]}),s.jsx("button",{onClick:()=>{d(null),o(""),g(null)},className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg",children:"Cancel"})]}),m&&s.jsx("div",{className:`mt-3 flex items-center gap-2 p-3 rounded-lg ${m.success?"bg-green-500/10 border border-green-500/30":"bg-red-500/10 border border-red-500/30"}`,children:s.jsx("span",{className:m.success?"text-green-400 text-sm":"text-red-400 text-sm",children:m.message})})]}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx(Hj,{className:"h-4 w-4 text-gray-400"}),s.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"Custom URL"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:r,onChange:A=>{o(A.target.value),d(null)},className:"flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",placeholder:"https://example.com/artwork.jpg"}),r&&s.jsx("button",{onClick:()=>o(""),className:"p-2 text-gray-400 hover:text-white",children:s.jsx(At,{className:"h-4 w-4"})})]})]}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx(ra,{className:"h-4 w-4 text-gray-400"}),s.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"Upload Custom Artwork"})]}),s.jsxs("label",{className:"block border-2 border-dashed border-gray-600 hover:border-gray-500 rounded-lg p-6 text-center cursor-pointer transition-colors",children:[s.jsx(ra,{className:"h-8 w-8 mx-auto text-gray-500 mb-2"}),s.jsx("p",{className:"text-gray-400 text-sm",children:"Click to upload an image"}),s.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"PNG, JPG, or WebP"}),s.jsx("input",{type:"file",className:"hidden",accept:"image/png,image/jpeg,image/webp",onChange:async A=>{const R=A.target.files?.[0];if(!R)return;const C=localStorage.getItem("openflix_token")||"",D=new FormData;D.append("file",R),D.append("type",t);try{const V=await fetch(`/admin/media/${i.id}/artwork/upload`,{method:"POST",headers:{"X-Plex-Token":C},body:D});if(!V.ok)throw new Error("Upload failed");const z=await V.json();z.url&&(d(z.url),o(""))}catch{g({success:!1,message:"Failed to upload artwork"})}}})]})]}),i.tmdbId&&s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsxs("h3",{className:"text-sm font-medium text-gray-300 mb-4",children:["TMDB ",t==="poster"?"Posters":"Backdrops"]}),y?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx(nt,{className:"h-6 w-6 text-indigo-500 animate-spin"})}):x&&x.length>0?s.jsx("div",{className:`grid gap-3 ${t==="poster"?"grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6":"grid-cols-2 sm:grid-cols-3 md:grid-cols-4"}`,children:x.map((A,R)=>s.jsxs("button",{onClick:()=>{d(A.url),o("")},className:`rounded-lg overflow-hidden border-2 transition-all ${c===A.url?"border-indigo-500 ring-2 ring-indigo-500/50":"border-transparent hover:border-gray-500"}`,children:[s.jsx("div",{className:t==="poster"?"aspect-[2/3]":"aspect-video",children:s.jsx("img",{src:pu(A.url),alt:`TMDB artwork ${R+1}`,className:"w-full h-full object-cover",loading:"lazy"})}),s.jsx("div",{className:"p-1 bg-gray-700 text-center",children:s.jsxs("span",{className:"text-xs text-gray-400",children:[A.width,"x",A.height]})})]},R))}):s.jsxs("div",{className:"text-center py-8",children:[s.jsx(Dr,{className:"h-8 w-8 text-gray-600 mx-auto mb-2"}),s.jsx("p",{className:"text-gray-500 text-sm",children:"No TMDB artwork found"})]})]})]})}function yP(){const[i,e]=P.useState(""),[t,n]=P.useState(1),[r,o]=P.useState(null),{data:c,isLoading:d,error:h}=gP(i,t);return r?s.jsx("div",{children:s.jsx(xP,{item:r,onClose:()=>o(null)})}):s.jsxs("div",{children:[s.jsxs("div",{className:"mb-8",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(bu,{className:"h-6 w-6 text-indigo-400"}),s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Artwork Manager"})]}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Search and update artwork for movies, TV shows, and other media"})]}),s.jsx("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:s.jsxs("div",{className:"relative",children:[s.jsx(qt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),s.jsx("input",{type:"text",value:i,onChange:u=>{e(u.target.value),n(1)},className:"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500",placeholder:"Search for a movie or TV show..."}),i&&s.jsx("button",{onClick:()=>e(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-white",children:s.jsx(At,{className:"h-4 w-4"})})]})}),!i||i.length<2?s.jsxs("div",{className:"bg-gray-800 rounded-xl p-12 text-center",children:[s.jsx(Dr,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Search for Media"}),s.jsx("p",{className:"text-gray-400",children:"Enter at least 2 characters to search your media library."})]}):d?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx(nt,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):h?s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 text-center",children:[s.jsx(Ct,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Search Failed"}),s.jsx("p",{className:"text-gray-400",children:"Could not search media library. Please try again."})]}):c&&c.items.length>0?s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("p",{className:"text-sm text-gray-400",children:[c.total," result",c.total!==1?"s":""," found"]})}),s.jsx(pP,{items:c.items,onSelect:o}),c.total>24&&s.jsxs("div",{className:"flex justify-center gap-2 pt-4",children:[s.jsx("button",{onClick:()=>n(u=>Math.max(1,u-1)),disabled:t===1,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:text-gray-600 text-white rounded-lg",children:"Previous"}),s.jsxs("span",{className:"px-4 py-2 text-gray-400",children:["Page ",t]}),s.jsx("button",{onClick:()=>n(u=>u+1),disabled:c.items.length<24,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:text-gray-600 text-white rounded-lg",children:"Next"})]})]}):s.jsxs("div",{className:"bg-gray-800 rounded-xl p-12 text-center",children:[s.jsx(qt,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No Results"}),s.jsxs("p",{className:"text-gray-400",children:['No media found matching "',i,'"']})]})]})}const Jo={"X-Plex-Token":localStorage.getItem("openflix_token")||"","Content-Type":"application/json"};async function vP(){const i=await fetch("/dvr/v2/collections",{headers:Jo});if(!i.ok)throw new Error("Failed to fetch collections");return(await i.json()).collections||[]}async function bP(i){const e=await fetch("/dvr/v2/collections",{method:"POST",headers:Jo,body:JSON.stringify(i)});if(!e.ok)throw new Error("Failed to create collection");return e.json()}async function _P(i,e){const t=await fetch(`/dvr/v2/collections/${i}`,{method:"PUT",headers:Jo,body:JSON.stringify(e)});if(!t.ok)throw new Error("Failed to update collection");return t.json()}async function SP(i){if(!(await fetch(`/dvr/v2/collections/${i}`,{method:"DELETE",headers:Jo})).ok)throw new Error("Failed to delete collection")}async function EP(i){const e=await fetch(`/dvr/v2/collections/${i}/items`,{headers:Jo});if(!e.ok)throw new Error("Failed to fetch items");return(await e.json()).items||[]}async function NP(i){const e=await fetch("/dvr/v2/collections/preview",{method:"POST",headers:Jo,body:JSON.stringify({smartRule:i})});if(!e.ok)throw new Error("Failed to preview");const t=await e.json();return t.files||t.items||[]}const wP=[{value:"title",label:"Title"},{value:"genre",label:"Genre"},{value:"year",label:"Year"},{value:"rating",label:"Rating"},{value:"duration",label:"Duration"},{value:"type",label:"Type"},{value:"studio",label:"Studio"},{value:"resolution",label:"Resolution"},{value:"addedAt",label:"Date Added"}],TP=[{value:"is",label:"is"},{value:"is_not",label:"is not"},{value:"contains",label:"contains"},{value:"starts_with",label:"starts with"},{value:"ends_with",label:"ends with"},{value:"gt",label:"greater than"},{value:"lt",label:"less than"}],AP=[{value:"title",label:"Title"},{value:"year",label:"Year"},{value:"addedAt",label:"Date Added"},{value:"duration",label:"Duration"},{value:"rating",label:"Rating"}];function jP(i){if(!i)return[{field:"title",operator:"contains",value:""}];try{const e=JSON.parse(i);if(Array.isArray(e)&&e.length>0)return e}catch{}return[{field:"title",operator:"contains",value:""}]}function $_(i){return JSON.stringify(i.filter(e=>e.value.trim()!==""))}function CP(i){return i?i.split(",").filter(Boolean).length:0}function RP({conditions:i,onChange:e}){const t=(o,c)=>{e(i.map((d,h)=>h===o?{...d,...c}:d))},n=()=>e([...i,{field:"title",operator:"contains",value:""}]),r=o=>{i.length<=1||e(i.filter((c,d)=>d!==o))};return s.jsxs("div",{className:"space-y-3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Smart Rules"}),i.map((o,c)=>s.jsxs("div",{className:"flex items-center gap-2",children:[c>0&&s.jsx("span",{className:"text-xs text-indigo-400 font-medium w-8",children:"AND"}),c===0&&s.jsx("span",{className:"w-8"}),s.jsx("select",{value:o.field,onChange:d=>t(c,{field:d.target.value}),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",children:wP.map(d=>s.jsx("option",{value:d.value,children:d.label},d.value))}),s.jsx("select",{value:o.operator,onChange:d=>t(c,{operator:d.target.value}),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",children:TP.map(d=>s.jsx("option",{value:d.value,children:d.label},d.value))}),s.jsx("input",{type:"text",value:o.value,onChange:d=>t(c,{value:d.target.value}),placeholder:"Value",className:"flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500"}),s.jsx("button",{onClick:()=>r(c),disabled:i.length<=1,className:"p-2 text-gray-400 hover:text-red-400 disabled:opacity-30 rounded-lg hover:bg-gray-700 transition-colors",children:s.jsx(ts,{className:"w-4 h-4"})})]},c)),s.jsxs("button",{onClick:n,className:"flex items-center gap-1 text-sm text-indigo-400 hover:text-indigo-300 transition-colors",children:[s.jsx(rs,{className:"w-3.5 h-3.5"}),"Add Condition"]})]})}function LP({collection:i,onClose:e}){const t=ft(),n=!!i,[r,o]=P.useState(i?.title||""),[c,d]=P.useState(i?.description||""),[h,u]=P.useState(i?.thumb||""),[m,g]=P.useState(i?.smart??!0),[x,y]=P.useState(jP(i?.smartRule)),[v,S]=P.useState(i?.fileIds||""),[N,A]=P.useState(i?.sort||"title"),[R,C]=P.useState(i?.order||"asc"),[D,V]=P.useState([]),[z,B]=P.useState(!1),[I,M]=P.useState(""),L=Ve({mutationFn:bP,onSuccess:()=>{t.invalidateQueries({queryKey:["collections"]}),e()}}),O=Ve({mutationFn:se=>_P(i.id,se),onSuccess:()=>{t.invalidateQueries({queryKey:["collections"]}),e()}}),J=L.isPending||O.isPending,ie=async()=>{B(!0),M("");try{const se=await NP($_(x));V(se)}catch(se){M(se instanceof Error?se.message:"Preview failed")}finally{B(!1)}},ne=se=>{se.preventDefault();const X={title:r,description:c||void 0,thumb:h||void 0,smart:m,sort:N,order:R};m?(X.smartRule=$_(x),X.fileIds=void 0):(X.fileIds=v,X.smartRule=void 0),n?O.mutate(X):L.mutate(X)};return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"sticky top-0 bg-gray-800 px-6 pt-6 pb-4 border-b border-gray-700 flex items-center justify-between z-10",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx($j,{className:"w-5 h-5 text-indigo-400"}),s.jsx("h2",{className:"text-lg font-semibold text-white",children:n?"Edit Collection":"Create Collection"})]}),s.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-white rounded-lg hover:bg-gray-700 transition-colors",children:s.jsx(At,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:ne,className:"p-6 space-y-5",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Title"}),s.jsx("input",{type:"text",value:r,onChange:se=>o(se.target.value),required:!0,placeholder:"My Collection",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Description"}),s.jsx("textarea",{value:c,onChange:se=>d(se.target.value),rows:2,placeholder:"Optional description...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 resize-none focus:outline-none focus:border-indigo-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Thumbnail URL"}),s.jsx("input",{type:"url",value:h,onChange:se=>u(se.target.value),placeholder:"https://...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Content Source"}),s.jsxs("div",{className:"flex gap-2 mb-4",children:[s.jsx("button",{type:"button",onClick:()=>g(!0),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${m?"bg-indigo-600 text-white":"bg-gray-700 text-gray-400 hover:text-white"}`,children:"Smart"}),s.jsx("button",{type:"button",onClick:()=>g(!1),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${m?"bg-gray-700 text-gray-400 hover:text-white":"bg-indigo-600 text-white"}`,children:"Manual"})]}),m?s.jsxs("div",{className:"space-y-4",children:[s.jsx(RP,{conditions:x,onChange:y}),s.jsxs("button",{type:"button",onClick:ie,disabled:z,className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm font-medium transition-colors",children:[z?s.jsx(nt,{className:"w-4 h-4 animate-spin"}):s.jsx(wS,{className:"w-4 h-4"}),"Preview Matches"]}),I&&s.jsxs("p",{className:"text-red-400 text-sm flex items-center gap-1",children:[s.jsx(Ct,{className:"w-4 h-4"}),I]}),D.length>0&&s.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-3 max-h-48 overflow-y-auto",children:[s.jsxs("p",{className:"text-xs text-gray-400 mb-2",children:[D.length," matched items"]}),D.map(se=>s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-300 py-1.5 border-b border-gray-700 last:border-0",children:[s.jsx("span",{className:"flex-1 truncate",children:se.title}),se.year&&s.jsx("span",{className:"text-xs text-gray-500",children:se.year}),se.type&&s.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-gray-600 text-gray-400 rounded",children:se.type})]},se.id))]})]}):s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"File IDs (comma-separated)"}),s.jsx("textarea",{value:v,onChange:se=>S(se.target.value),rows:3,placeholder:"1, 2, 3, ...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm font-mono placeholder-gray-500 resize-none focus:outline-none focus:border-indigo-500"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Sort By"}),s.jsx("select",{value:N,onChange:se=>A(se.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",children:AP.map(se=>s.jsx("option",{value:se.value,children:se.label},se.value))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Order"}),s.jsxs("select",{value:R,onChange:se=>C(se.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",children:[s.jsx("option",{value:"asc",children:"Ascending"}),s.jsx("option",{value:"desc",children:"Descending"})]})]})]}),(L.isError||O.isError)&&s.jsxs("p",{className:"text-red-400 text-sm flex items-center gap-1",children:[s.jsx(Ct,{className:"w-4 h-4"}),(L.error||O.error)?.message||"Operation failed"]}),s.jsxs("div",{className:"flex gap-3 pt-2",children:[s.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2.5 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:J||!r.trim(),className:"flex-1 py-2.5 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-40 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors",children:J?s.jsx(nt,{className:"w-4 h-4 animate-spin mx-auto"}):n?"Save Changes":"Create Collection"})]})]})]})})}function kP({collection:i,onBack:e}){const{data:t,isLoading:n,error:r}=qe({queryKey:["collection-items",i.id],queryFn:()=>EP(i.id)});return s.jsxs("div",{children:[s.jsxs("button",{onClick:e,className:"flex items-center gap-2 text-gray-400 hover:text-white mb-6 transition-colors",children:[s.jsx(Yg,{className:"w-4 h-4"}),"Back to Collections"]}),s.jsx("div",{className:"mb-6",children:s.jsxs("div",{className:"flex items-center gap-4",children:[i.thumb?s.jsx("img",{src:i.thumb,alt:i.title,className:"w-20 h-20 rounded-xl object-cover"}):s.jsx("div",{className:"w-20 h-20 bg-gray-800 rounded-xl flex items-center justify-center",children:s.jsx(mn,{className:"w-8 h-8 text-gray-600"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold text-white",children:i.title}),i.description&&s.jsx("p",{className:"text-gray-400 mt-1",children:i.description}),s.jsxs("div",{className:"flex items-center gap-3 mt-2 text-sm text-gray-500",children:[s.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${i.smart?"bg-purple-500/10 text-purple-400":"bg-gray-700 text-gray-400"}`,children:i.smart?"Smart":"Manual"}),t&&s.jsxs("span",{children:[t.length," items"]})]})]})]})}),n?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx(nt,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):r?s.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[s.jsx(Ct,{className:"w-10 h-10 text-red-400 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-400",children:"Failed to load items"})]}):t&&t.length>0?s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:t.map(o=>s.jsxs("div",{className:"bg-gray-800 rounded-xl overflow-hidden border border-gray-700 hover:border-gray-600 transition-colors",children:[s.jsxs("div",{className:"aspect-[2/3] bg-gray-700 relative",children:[o.thumb?s.jsx("img",{src:o.thumb,alt:o.title,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center",children:s.jsx(Dr,{className:"w-8 h-8 text-gray-600"})}),o.type&&s.jsx("span",{className:"absolute top-2 right-2 px-1.5 py-0.5 bg-black/70 text-gray-300 text-xs rounded",children:o.type})]}),s.jsxs("div",{className:"p-3",children:[s.jsx("h4",{className:"text-sm font-medium text-white truncate",children:o.title}),o.year&&s.jsx("p",{className:"text-xs text-gray-500",children:o.year})]})]},o.id))}):s.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[s.jsx(mn,{className:"w-10 h-10 text-gray-600 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-400",children:"This collection is empty"})]})]})}function DP({collection:i,onEdit:e,onDelete:t,onView:n}){const r=i.smart?null:CP(i.fileIds);return s.jsxs("div",{className:"bg-gray-800 rounded-xl overflow-hidden border border-gray-700 hover:border-gray-600 transition-colors group cursor-pointer",onClick:n,children:[s.jsxs("div",{className:"aspect-video bg-gray-700 relative overflow-hidden",children:[i.thumb?s.jsx("img",{src:i.thumb,alt:i.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center",children:s.jsx(mn,{className:"w-12 h-12 text-gray-600"})}),s.jsx("div",{className:"absolute top-2 left-2",children:s.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${i.smart?"bg-purple-500/80 text-white":"bg-gray-800/80 text-gray-300"}`,children:i.smart?"Smart":"Manual"})}),s.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[s.jsx("button",{onClick:o=>{o.stopPropagation(),e()},className:"p-1.5 bg-gray-800/80 hover:bg-indigo-600 text-white rounded-lg transition-colors",title:"Edit",children:s.jsx(Ri,{className:"w-3.5 h-3.5"})}),s.jsx("button",{onClick:o=>{o.stopPropagation(),t()},className:"p-1.5 bg-gray-800/80 hover:bg-red-600 text-white rounded-lg transition-colors",title:"Delete",children:s.jsx(ts,{className:"w-3.5 h-3.5"})})]})]}),s.jsxs("div",{className:"p-4",children:[s.jsx("h3",{className:"text-white font-semibold truncate",children:i.title}),i.description&&s.jsx("p",{className:"text-sm text-gray-400 line-clamp-1 mt-0.5",children:i.description}),s.jsxs("div",{className:"flex items-center justify-between mt-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[r!==null&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Jg,{className:"w-3 h-3"}),r," items"]}),i.tmdbCollectionId&&s.jsx("span",{className:"px-1.5 py-0.5 bg-blue-500/10 text-blue-400 rounded",children:"TMDB"})]}),s.jsx(Va,{className:"w-4 h-4 text-gray-600 group-hover:text-gray-400 transition-colors"})]})]})]})}function IP(){const i=ft(),{data:e,isLoading:t,error:n}=qe({queryKey:["collections"],queryFn:vP}),r=Ve({mutationFn:SP,onSuccess:()=>i.invalidateQueries({queryKey:["collections"]})}),[o,c]=P.useState(null),[d,h]=P.useState(null),[u,m]=P.useState(""),g=(e||[]).filter(y=>{if(!u.trim())return!0;const v=u.toLowerCase();return y.title.toLowerCase().includes(v)||y.description?.toLowerCase().includes(v)}),x=y=>{confirm("Delete this collection? This cannot be undone.")&&r.mutate(y)};return d?s.jsx(kP,{collection:d,onBack:()=>h(null)}):s.jsxs("div",{children:[s.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Collections"}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Organize your media into smart playlists and curated collections"})]}),s.jsxs("button",{onClick:()=>c("new"),className:"flex items-center gap-2 px-4 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors",children:[s.jsx(rs,{className:"w-4 h-4"}),"New Collection"]})]}),(e?.length||0)>3&&s.jsxs("div",{className:"relative mb-6",children:[s.jsx(qt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),s.jsx("input",{type:"text",value:u,onChange:y=>m(y.target.value),placeholder:"Search collections...",className:"w-full pl-10 pr-4 py-2.5 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),t?s.jsx("div",{className:"flex items-center justify-center py-16",children:s.jsx(nt,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):n?s.jsxs("div",{className:"text-center py-16 bg-gray-800 rounded-xl",children:[s.jsx(Ct,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Failed to load collections"}),s.jsx("p",{className:"text-gray-400 text-sm",children:n instanceof Error?n.message:"Unknown error"})]}):g.length===0?s.jsxs("div",{className:"text-center py-16 bg-gray-800 rounded-xl",children:[s.jsx(mn,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:u?"No matching collections":"No collections yet"}),s.jsx("p",{className:"text-gray-400 mb-6",children:u?`No collections match "${u}"`:"Create smart playlists or curate collections from your library."}),!u&&s.jsxs("button",{onClick:()=>c("new"),className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors",children:[s.jsx(rs,{className:"w-4 h-4"}),"New Collection"]})]}):s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5",children:g.map(y=>s.jsx(DP,{collection:y,onEdit:()=>c(y),onDelete:()=>x(y.id),onView:()=>h(y)},y.id))}),o!==null&&s.jsx(LP,{collection:o==="new"?null:o,onClose:()=>c(null)})]})}function MP({onFiles:i}){const[e,t]=P.useState(!1),n=P.useRef(null);return s.jsxs("div",{className:`border-2 border-dashed rounded-xl p-12 text-center transition-colors cursor-pointer ${e?"border-indigo-500 bg-indigo-500/10":"border-gray-600 hover:border-gray-500"}`,onDragOver:r=>{r.preventDefault(),t(!0)},onDragLeave:()=>t(!1),onDrop:r=>{r.preventDefault(),t(!1),i(r.dataTransfer.files)},onClick:()=>n.current?.click(),children:[s.jsx(ra,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),s.jsx("p",{className:"text-gray-300 text-lg",children:"Drag and drop video files here"}),s.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"or click to browse"}),s.jsx("p",{className:"text-gray-600 text-xs mt-3",children:"Supports MP4, MKV, AVI, TS, M2TS, MOV"}),s.jsx("input",{ref:n,type:"file",className:"hidden",accept:"video/*,.mkv,.avi,.ts,.m2ts,.mov",multiple:!0,onChange:r=>r.target.files&&i(r.target.files)})]})}function OP({item:i,onRemove:e,onUpdateMeta:t}){const n=r=>r>=1073741824?`${(r/1073741824).toFixed(1)} GB`:r>=1048576?`${(r/1048576).toFixed(0)} MB`:`${(r/1024).toFixed(0)} KB`;return s.jsx("div",{className:"bg-gray-700/50 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"p-2 bg-gray-600 rounded-lg flex-shrink-0",children:s.jsx(TS,{className:"h-5 w-5 text-gray-300"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-white font-medium truncate",children:i.file.name}),s.jsx("p",{className:"text-xs text-gray-500",children:n(i.file.size)})]}),s.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[i.status==="uploading"&&s.jsx(nt,{className:"h-4 w-4 text-indigo-400 animate-spin"}),i.status==="complete"&&s.jsx(vs,{className:"h-4 w-4 text-green-400"}),i.status==="error"&&s.jsx(Ct,{className:"h-4 w-4 text-red-400"}),(i.status==="pending"||i.status==="error")&&s.jsx("button",{onClick:e,className:"p-1 text-gray-400 hover:text-red-400 transition-colors",children:s.jsx(At,{className:"h-4 w-4"})})]})]}),i.status==="uploading"&&s.jsx("div",{className:"h-1.5 bg-gray-600 rounded-full overflow-hidden mb-3",children:s.jsx("div",{className:"h-full bg-indigo-500 rounded-full transition-all duration-300",style:{width:`${i.progress}%`}})}),i.status==="error"&&s.jsx("p",{className:"text-sm text-red-400 mb-2",children:i.error||"Upload failed"}),i.status==="pending"&&s.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-2",children:[s.jsx("input",{type:"text",value:i.title,onChange:r=>t("title",r.target.value),className:"px-3 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",placeholder:"Title"}),s.jsx("input",{type:"text",value:i.group,onChange:r=>t("group",r.target.value),className:"px-3 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",placeholder:"Group (optional)"}),s.jsxs("select",{value:i.category,onChange:r=>t("category",r.target.value),className:"px-3 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",children:[s.jsx("option",{value:"",children:"Category"}),s.jsx("option",{value:"movie",children:"Movie"}),s.jsx("option",{value:"tv",children:"TV Show"}),s.jsx("option",{value:"sports",children:"Sports"}),s.jsx("option",{value:"other",children:"Other"})]})]})]})]})})}function PP(){const[i,e]=P.useState(""),[t,n]=P.useState(!1),[r,o]=P.useState(null),c=async()=>{if(i.trim()){n(!0),o(null);try{const d=localStorage.getItem("openflix_token")||"",h=await fetch("/dvr/v2/files/import",{method:"POST",headers:{"X-Plex-Token":d,"Content-Type":"application/json"},body:JSON.stringify({path:i.trim()})});if(!h.ok)throw new Error(`Import failed: ${h.status}`);const u=await h.json();o({success:!0,message:u.message||"File imported successfully",imported:u.imported})}catch(d){o({success:!1,message:d instanceof Error?d.message:"Import failed"})}finally{n(!1)}}};return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Server File Path"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:i,onChange:d=>{e(d.target.value),o(null)},className:"flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white font-mono text-sm",placeholder:"/path/to/video/file.mp4"}),s.jsxs("button",{onClick:c,disabled:!i.trim()||t,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 disabled:cursor-not-allowed text-white rounded-lg whitespace-nowrap",children:[t?s.jsx(nt,{className:"h-4 w-4 animate-spin"}):s.jsx(Co,{className:"h-4 w-4"}),"Import"]})]}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter the full path to a video file on the server."})]}),r&&s.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-lg ${r.success?"bg-green-500/10 border border-green-500/30":"bg-red-500/10 border border-red-500/30"}`,children:[r.success?s.jsx(vs,{className:"h-4 w-4 text-green-400 flex-shrink-0"}):s.jsx(Ct,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),s.jsx("span",{className:r.success?"text-green-400 text-sm":"text-red-400 text-sm",children:r.message})]})]})}function BP(){const[i,e]=P.useState(""),[t,n]=P.useState(!0),[r,o]=P.useState(""),[c,d]=P.useState(!1),[h,u]=P.useState(null),m=async()=>{if(i.trim()){d(!0),u(null);try{const g=localStorage.getItem("openflix_token")||"",x=await fetch("/dvr/v2/files/import/bulk",{method:"POST",headers:{"X-Plex-Token":g,"Content-Type":"application/json"},body:JSON.stringify({path:i.trim(),recursive:t,groupName:r.trim()||void 0})});if(!x.ok)throw new Error(`Bulk import failed: ${x.status}`);const y=await x.json();u({success:!0,message:y.message||"Bulk import completed",imported:y.imported})}catch(g){u({success:!1,message:g instanceof Error?g.message:"Bulk import failed"})}finally{d(!1)}}};return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Directory Path"}),s.jsx("input",{type:"text",value:i,onChange:g=>{e(g.target.value),u(null)},className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white font-mono text-sm",placeholder:"/path/to/video/directory"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Group Name (optional)"}),s.jsx("input",{type:"text",value:r,onChange:g=>o(g.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",placeholder:"e.g., Season 1"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Recursive Scan"}),s.jsx("button",{onClick:()=>n(!t),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${t?"bg-green-500/20 text-green-400 hover:bg-green-500/30":"bg-gray-700 text-gray-400 hover:bg-gray-600"}`,children:t?s.jsxs(s.Fragment,{children:[s.jsx(a0,{className:"h-5 w-5"}),"Include Subdirectories"]}):s.jsxs(s.Fragment,{children:[s.jsx(i0,{className:"h-5 w-5"}),"Top-Level Only"]})})]})]}),s.jsxs("button",{onClick:m,disabled:!i.trim()||c,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 disabled:cursor-not-allowed text-white rounded-lg",children:[c?s.jsx(nt,{className:"h-4 w-4 animate-spin"}):s.jsx(Co,{className:"h-4 w-4"}),c?"Importing...":"Start Bulk Import"]}),h&&s.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-lg ${h.success?"bg-green-500/10 border border-green-500/30":"bg-red-500/10 border border-red-500/30"}`,children:[h.success?s.jsx(vs,{className:"h-4 w-4 text-green-400 flex-shrink-0"}):s.jsx(Ct,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),s.jsxs("span",{className:h.success?"text-green-400 text-sm":"text-red-400 text-sm",children:[h.message,h.imported!==void 0&&` (${h.imported} files imported)`]})]})]})}function UP(){const[i,e]=P.useState("upload"),[t,n]=P.useState([]),r=g=>{const x=Array.from(g).map(y=>({id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,file:y,progress:0,status:"pending",title:y.name.replace(/\.[^.]+$/,"").replace(/[._-]/g," "),group:"",category:""}));n(y=>[...y,...x])},o=g=>{n(x=>x.filter(y=>y.id!==g))},c=(g,x,y)=>{n(v=>v.map(S=>S.id===g?{...S,[x]:y}:S))},d=async g=>{n(x=>x.map(y=>y.id===g.id?{...y,status:"uploading",progress:0}:y));try{const x=localStorage.getItem("openflix_token")||"",y=new FormData;y.append("file",g.file),g.title&&y.append("title",g.title),g.group&&y.append("group",g.group),g.category&&y.append("category",g.category);const v=new XMLHttpRequest;v.open("POST","/dvr/v2/files/upload"),v.setRequestHeader("X-Plex-Token",x),v.upload.onprogress=S=>{if(S.lengthComputable){const N=Math.round(S.loaded/S.total*100);n(A=>A.map(R=>R.id===g.id?{...R,progress:N}:R))}},await new Promise((S,N)=>{v.onload=()=>{v.status>=200&&v.status<300?(n(A=>A.map(R=>R.id===g.id?{...R,status:"complete",progress:100}:R)),S()):N(new Error(`Upload failed: ${v.status}`))},v.onerror=()=>N(new Error("Upload failed")),v.send(y)})}catch(x){n(y=>y.map(v=>v.id===g.id?{...v,status:"error",error:x instanceof Error?x.message:"Upload failed"}:v))}},h=async()=>{const g=t.filter(x=>x.status==="pending");for(const x of g)await d(x)},u=t.filter(g=>g.status==="pending").length,m=t.filter(g=>g.status==="complete").length;return s.jsxs("div",{children:[s.jsxs("div",{className:"mb-8",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(ra,{className:"h-6 w-6 text-indigo-400"}),s.jsx("h1",{className:"text-2xl font-bold text-white",children:"File Upload"})]}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Upload video files or import from the server filesystem"})]}),s.jsx("div",{className:"flex gap-2 mb-6",children:[{key:"upload",label:"Upload Files",icon:ra},{key:"import",label:"Import from Server",icon:Co},{key:"bulk",label:"Bulk Import",icon:Co}].map(({key:g,label:x,icon:y})=>s.jsxs("button",{onClick:()=>e(g),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${i===g?"bg-indigo-600 text-white":"bg-gray-800 text-gray-400 hover:text-white"}`,children:[s.jsx(y,{className:"h-4 w-4"}),x]},g))}),i==="upload"&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-gray-800 rounded-xl p-6",children:s.jsx(MP,{onFiles:r})}),t.length>0&&s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h2",{className:"text-lg font-semibold text-white",children:["Upload Queue",s.jsxs("span",{className:"text-sm text-gray-400 font-normal ml-2",children:[m,"/",t.length," complete"]})]}),s.jsxs("div",{className:"flex gap-2",children:[u>0&&s.jsxs("button",{onClick:h,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm",children:[s.jsx(ra,{className:"h-4 w-4"}),"Upload All (",u,")"]}),s.jsx("button",{onClick:()=>n([]),className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg text-sm",children:"Clear"})]})]}),s.jsx("div",{className:"space-y-3",children:t.map(g=>s.jsx(OP,{item:g,onRemove:()=>o(g.id),onUpdateMeta:(x,y)=>c(g.id,x,y)},g.id))})]})]}),i==="import"&&s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx(Co,{className:"h-5 w-5 text-indigo-400"}),s.jsx("h2",{className:"text-lg font-semibold text-white",children:"Import from Server"})]}),s.jsx(PP,{})]}),i==="bulk"&&s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx(Co,{className:"h-5 w-5 text-indigo-400"}),s.jsx("h2",{className:"text-lg font-semibold text-white",children:"Bulk Import Directory"})]}),s.jsx(BP,{})]})]})}const FP="openflix_token";function $P(){return localStorage.getItem(FP)||""}function G_(i){const e=Math.floor(i/1e3),t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=e%60;return t>0?`${t}:${String(n).padStart(2,"0")}:${String(r).padStart(2,"0")}`:`${n}:${String(r).padStart(2,"0")}`}function GP(i){const e=Date.now()-new Date(i).getTime(),t=Math.floor(e/6e4);if(t<1)return"just now";if(t<60)return`${t}m ago`;const n=Math.floor(t/60);return n<24?`${n}h ago`:`${Math.floor(n/24)}d ago`}async function VP(){const i=await fetch("/status/sessions",{headers:{"X-Plex-Token":$P()}});if(!i.ok)throw new Error("Failed to fetch sessions");return i.json()}function HP({state:i}){return i==="playing"?s.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-500/10 text-green-400 border border-green-500/30 rounded-full text-xs font-medium",children:[s.jsx(wn,{className:"h-3 w-3",fill:"currentColor"}),"Playing"]}):i==="paused"?s.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-yellow-500/10 text-yellow-400 border border-yellow-500/30 rounded-full text-xs font-medium",children:[s.jsx(Yo,{className:"h-3 w-3"}),"Paused"]}):i==="buffering"?s.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-blue-500/10 text-blue-400 border border-blue-500/30 rounded-full text-xs font-medium",children:[s.jsx(nt,{className:"h-3 w-3 animate-spin"}),"Buffering"]}):s.jsx("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-gray-500/10 text-gray-400 border border-gray-500/30 rounded-full text-xs font-medium",children:i})}function KP({progress:i,viewOffset:e,duration:t}){const n=Math.min(100,Math.max(0,i));return s.jsxs("div",{children:[s.jsx("div",{className:"h-2 bg-gray-700 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-indigo-600 rounded-full transition-all duration-1000",style:{width:`${n}%`}})}),s.jsxs("div",{className:"flex justify-between mt-1 text-xs text-gray-500",children:[s.jsx("span",{children:G_(e)}),s.jsx("span",{children:G_(t)})]})]})}function qP({session:i}){return s.jsx("div",{className:"bg-gray-800 rounded-xl p-5 hover:bg-gray-750 transition-colors",children:s.jsxs("div",{className:"flex items-start gap-4",children:[i.mediaThumb?s.jsx("img",{src:i.mediaThumb,alt:"",className:"w-16 h-24 rounded-lg object-cover flex-shrink-0 bg-gray-700"}):s.jsx("div",{className:"w-16 h-24 rounded-lg bg-gray-700 flex items-center justify-center flex-shrink-0",children:s.jsx(ss,{className:"h-8 w-8 text-gray-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center justify-between gap-3 mb-2",children:[s.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[s.jsx(HP,{state:i.state}),i.transcoding&&s.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-orange-500/10 text-orange-400 rounded text-xs",children:[s.jsx($n,{className:"h-3 w-3"}),"Transcoding"]})]}),s.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1 flex-shrink-0",children:[s.jsx(Ts,{className:"h-3 w-3"}),GP(i.startedAt)]})]}),s.jsx("h3",{className:"text-white font-medium truncate mb-1",children:i.mediaTitle||`Media #${i.mediaItemId}`}),s.jsx("div",{className:"mb-3",children:s.jsx(KP,{progress:i.progress,viewOffset:i.viewOffset,duration:i.duration})}),s.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 text-xs text-gray-400",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(hR,{className:"h-3 w-3"}),i.username||`User #${i.userId}`]}),i.player&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Mo,{className:"h-3 w-3"}),i.player]}),i.platform&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(ss,{className:"h-3 w-3"}),i.platform]}),i.quality&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Vu,{className:"h-3 w-3"}),i.quality]}),i.address&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(wj,{className:"h-3 w-3"}),i.address]})]})]})]})})}function zP(){const{data:i,isLoading:e,error:t,refetch:n}=qe({queryKey:["sessions"],queryFn:VP,refetchInterval:5e3}),r=i?.sessions||[],o=r.filter(h=>h.state==="playing").length,c=r.filter(h=>h.state==="paused").length,d=r.filter(h=>h.transcoding).length;return e?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx(nt,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):t?s.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[s.jsx(tn,{className:"h-12 w-12 text-red-400"}),s.jsx("h3",{className:"text-lg font-medium text-white",children:"Failed to load sessions"}),s.jsx("p",{className:"text-gray-400 text-sm",children:t.message}),s.jsxs("button",{onClick:()=>n(),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[s.jsx(Et,{className:"h-4 w-4"}),"Retry"]})]}):s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-8",children:[s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[s.jsx(Mo,{className:"h-7 w-7 text-indigo-400"}),"Client Connections"]}),s.jsxs("p",{className:"text-gray-400 mt-1",children:[r.length," active session",r.length!==1?"s":""]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500",children:[s.jsx(Et,{className:"h-3 w-3 animate-spin"}),"Auto-refresh: 5s"]}),s.jsxs("button",{onClick:()=>n(),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:[s.jsx(Et,{className:"h-4 w-4"}),"Refresh"]})]})]}),r.length>0&&s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[s.jsx("div",{className:"bg-gray-800 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-indigo-600/20",children:s.jsx(Mo,{className:"h-5 w-5 text-indigo-400"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-2xl font-bold text-white",children:r.length}),s.jsx("p",{className:"text-xs text-gray-400",children:"Total"})]})]})}),s.jsx("div",{className:"bg-gray-800 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-green-500/20",children:s.jsx(wn,{className:"h-5 w-5 text-green-400"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-2xl font-bold text-white",children:o}),s.jsx("p",{className:"text-xs text-gray-400",children:"Playing"})]})]})}),s.jsx("div",{className:"bg-gray-800 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-yellow-500/20",children:s.jsx(Yo,{className:"h-5 w-5 text-yellow-400"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-2xl font-bold text-white",children:c}),s.jsx("p",{className:"text-xs text-gray-400",children:"Paused"})]})]})}),s.jsx("div",{className:"bg-gray-800 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-orange-500/20",children:s.jsx($n,{className:"h-5 w-5 text-orange-400"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-2xl font-bold text-white",children:d}),s.jsx("p",{className:"text-xs text-gray-400",children:"Transcoding"})]})]})})]}),r.length===0?s.jsxs("div",{className:"flex flex-col items-center justify-center h-64 bg-gray-800 rounded-xl",children:[s.jsx(Mo,{className:"h-16 w-16 text-gray-600 mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No active sessions"}),s.jsx("p",{className:"text-gray-400 text-sm",children:"Active playback sessions will appear here in real-time"})]}):s.jsx("div",{className:"space-y-3",children:r.map(h=>s.jsx(qP,{session:h},h.sessionKey))})]})}const YP="openflix_token";function WP(){return localStorage.getItem(YP)||""}async function QP(){const i=await fetch("/health",{headers:{"X-Plex-Token":WP()}});if(!i.ok)throw new Error("Health check failed");return i.json()}function rn({title:i,value:e,icon:t,color:n,subtitle:r}){return s.jsx("div",{className:"bg-gray-800 rounded-xl p-5",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`p-2.5 rounded-lg ${n}`,children:s.jsx(t,{className:"h-5 w-5 text-white"})}),s.jsxs("div",{className:"min-w-0",children:[s.jsx("p",{className:"text-xs text-gray-400",children:i}),s.jsx("p",{className:"text-xl font-bold text-white truncate",children:e}),r&&s.jsx("p",{className:"text-xs text-gray-500 truncate",children:r})]})]})})}function XP({value:i,max:e,label:t,color:n="bg-indigo-600"}){const r=e>0?Math.min(100,Math.round(i/e*100)):0;return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between text-sm mb-1.5",children:[s.jsx("span",{className:"text-gray-300",children:t}),s.jsxs("span",{className:"text-gray-400",children:[r,"%"]})]}),s.jsx("div",{className:"h-3 bg-gray-700 rounded-full overflow-hidden",children:s.jsx("div",{className:`h-full ${n} rounded-full transition-all duration-500`,style:{width:`${r}%`}})})]})}function JP({health:i}){if(!i)return s.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-gray-700 rounded-lg",children:[s.jsx(nt,{className:"h-4 w-4 text-gray-400 animate-spin"}),s.jsx("span",{className:"text-sm text-gray-400",children:"Checking..."})]});const e=i.status==="ok";return s.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-lg ${e?"bg-green-500/10 border border-green-500/30":"bg-red-500/10 border border-red-500/30"}`,children:[e?s.jsx(vs,{className:"h-4 w-4 text-green-400"}):s.jsx(gc,{className:"h-4 w-4 text-red-400"}),s.jsx("span",{className:`text-sm ${e?"text-green-400":"text-red-400"}`,children:e?"Healthy":"Unhealthy"})]})}function ZP(){const{data:i,isLoading:e,error:t,refetch:n}=qe({queryKey:["serverStatus"],queryFn:()=>Re.getServerStatus(),refetchInterval:1e4}),{data:r,isLoading:o,error:c}=qe({queryKey:["healthCheck"],queryFn:QP,refetchInterval:1e4});return e?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx(nt,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):t?s.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[s.jsx(tn,{className:"h-12 w-12 text-red-400"}),s.jsx("h3",{className:"text-lg font-medium text-white",children:"Failed to load diagnostics"}),s.jsx("p",{className:"text-gray-400 text-sm",children:t.message}),s.jsxs("button",{onClick:()=>n(),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[s.jsx(Et,{className:"h-4 w-4"}),"Retry"]})]}):s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-8",children:[s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[s.jsx(Do,{className:"h-7 w-7 text-indigo-400"}),"Diagnostics"]}),s.jsx("p",{className:"text-gray-400 mt-1",children:"System health and performance overview"})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500",children:[s.jsx(Et,{className:"h-3 w-3 animate-spin"}),"Auto-refresh: 10s"]}),s.jsx(JP,{health:r,isLoading:o,error:c}),s.jsxs("button",{onClick:()=>n(),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:[s.jsx(Et,{className:"h-4 w-4"}),"Refresh"]})]})]}),i&&s.jsx("div",{className:"bg-gray-800 rounded-xl p-5 mb-6",children:s.jsxs("div",{className:"flex flex-wrap items-center gap-6 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Fu,{className:"h-4 w-4 text-indigo-400"}),s.jsx("span",{className:"text-white font-medium",children:i.server.name}),s.jsxs("span",{className:"text-gray-500",children:["v",i.server.version]})]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("span",{className:"text-gray-400",children:[i.server.platform,"/",i.server.arch]})}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("span",{className:"text-gray-400",children:["Go ",i.server.goVersion]})}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("span",{className:"text-gray-400",children:i.server.hostname})}),s.jsx("div",{className:"flex items-center gap-2 text-gray-500 font-mono text-xs",children:i.server.machineIdentifier})]})}),i&&s.jsxs(s.Fragment,{children:[s.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[s.jsx(Ar,{className:"h-5 w-5"}),"System Resources"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[s.jsx(rn,{title:"CPUs",value:i.system.numCPU,icon:Ar,color:"bg-blue-600"}),s.jsx(rn,{title:"Memory Used",value:`${i.system.memAllocMB} MB`,icon:tC,color:"bg-purple-600",subtitle:`${i.system.memTotalMB} MB total allocated`}),s.jsx(rn,{title:"Goroutines",value:i.system.goroutines,icon:Ha,color:"bg-orange-600"}),s.jsx(rn,{title:"Uptime",value:i.server.uptime,icon:Ts,color:"bg-green-600"})]}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-8",children:[s.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[s.jsx(Li,{className:"h-5 w-5"}),"Memory Usage"]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(XP,{value:i.system.memAllocMB,max:i.system.memTotalMB,label:"Heap Allocation",color:i.system.memAllocMB/i.system.memTotalMB>.9?"bg-red-600":i.system.memAllocMB/i.system.memTotalMB>.7?"bg-yellow-600":"bg-indigo-600"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{className:"bg-gray-900 rounded-lg p-3",children:[s.jsx("p",{className:"text-gray-400 text-xs",children:"Allocated"}),s.jsxs("p",{className:"text-white font-medium",children:[i.system.memAllocMB," MB"]})]}),s.jsxs("div",{className:"bg-gray-900 rounded-lg p-3",children:[s.jsx("p",{className:"text-gray-400 text-xs",children:"Total System"}),s.jsxs("p",{className:"text-white font-medium",children:[i.system.memTotalMB," MB"]})]})]})]})]}),s.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[s.jsx(mn,{className:"h-5 w-5"}),"Library Statistics"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[s.jsx(rn,{title:"Libraries",value:i.libraries.count,icon:mn,color:"bg-blue-600"}),s.jsx(rn,{title:"Movies",value:i.libraries.movies,icon:la,color:"bg-purple-600"}),s.jsx(rn,{title:"TV Shows",value:i.libraries.shows,icon:ss,color:"bg-green-600"}),s.jsx(rn,{title:"Episodes",value:i.libraries.episodes,icon:Ha,color:"bg-orange-600"})]}),s.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[s.jsx(la,{className:"h-5 w-5"}),"DVR Statistics"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[s.jsx(rn,{title:"Scheduled",value:i.dvr.scheduled,icon:Ts,color:"bg-blue-600"}),s.jsx(rn,{title:"Recording Now",value:i.dvr.recording,icon:$n,color:"bg-red-600",subtitle:i.dvr.recording>0?"Active recording":void 0}),s.jsx(rn,{title:"Completed",value:i.dvr.completed,icon:vs,color:"bg-green-600"}),s.jsx(rn,{title:"Commercial Detect",value:i.dvr.commercialDetect?"Enabled":"Disabled",icon:$n,color:i.dvr.commercialDetect?"bg-green-600":"bg-gray-600"})]}),s.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[s.jsx(ss,{className:"h-5 w-5"}),"Live TV Statistics"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[s.jsx(rn,{title:"Total Channels",value:i.livetv.channels,icon:ss,color:"bg-blue-600"}),s.jsx(rn,{title:"Timeshift Channels",value:i.livetv.timeshiftChannels,icon:Ts,color:"bg-purple-600"}),s.jsx(rn,{title:"Timeshift",value:i.livetv.timeshiftEnabled?"Enabled":"Disabled",icon:$n,color:i.livetv.timeshiftEnabled?"bg-green-600":"bg-gray-600"}),s.jsx(rn,{title:"Active Sessions",value:i.sessions.active,icon:Do,color:"bg-orange-600"})]}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[s.jsx(Do,{className:"h-5 w-5"}),"Logging"]}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[s.jsxs("div",{className:"bg-gray-900 rounded-lg p-3",children:[s.jsx("p",{className:"text-gray-400 text-xs",children:"Log Level"}),s.jsx("p",{className:"text-white font-medium capitalize",children:i.logging.level})]}),s.jsxs("div",{className:"bg-gray-900 rounded-lg p-3",children:[s.jsx("p",{className:"text-gray-400 text-xs",children:"JSON Format"}),s.jsx("p",{className:"text-white font-medium",children:i.logging.json?"Yes":"No"})]})]})]})]})]})}const e6=async(i,e)=>{const t=localStorage.getItem("openflix_token")||"",n=await fetch(i,{...e,headers:{"X-Plex-Token":t,"Content-Type":"application/json",...e?.headers}});if(!n.ok)throw new Error(`API error: ${n.status}`);return n},U0="openflix_speedtest_history";function t6(){try{const i=localStorage.getItem(U0);return i?JSON.parse(i):[]}catch{return[]}}function s6(i){localStorage.setItem(U0,JSON.stringify(i.slice(0,20)))}function n6({speed:i,max:e=1e3}){const t=Math.min(i/e*100,100),n=283,r=n-t/100*n,o=377-n;return s.jsxs("div",{className:"relative w-64 h-64 mx-auto",children:[s.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 200 200",children:[s.jsx("circle",{cx:"100",cy:"100",r:"80",fill:"none",stroke:"#374151",strokeWidth:"12",strokeDasharray:"377",strokeDashoffset:o,strokeLinecap:"round",transform:"rotate(135 100 100)"}),s.jsx("circle",{cx:"100",cy:"100",r:"80",fill:"none",stroke:"#6366f1",strokeWidth:"12",strokeDasharray:`${n} 377`,strokeDashoffset:r,strokeLinecap:"round",transform:"rotate(135 100 100)",className:"transition-all duration-500"})]}),s.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[s.jsx("span",{className:"text-4xl font-bold text-white",children:i.toFixed(1)}),s.jsx("span",{className:"text-gray-400 text-sm",children:"Mbps"})]})]})}function Fm({phase:i,currentPhase:e}){const t=["latency","download","upload"],n=t.indexOf(e),r=t.indexOf(i),o=e===i,c=e==="complete"||n>r,d={latency:"Latency",download:"Download",upload:"Upload"},h={latency:s.jsx(Ts,{className:"h-4 w-4"}),download:s.jsx(Bu,{className:"h-4 w-4"}),upload:s.jsx(Wg,{className:"h-4 w-4"})};return s.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${o?"bg-indigo-600 text-white":c?"bg-green-500/20 text-green-400":"bg-gray-700 text-gray-500"}`,children:[o&&s.jsx(nt,{className:"h-4 w-4 animate-spin"}),!o&&h[i],d[i]]})}function i6(){const[i,e]=P.useState("idle"),[t,n]=P.useState(0),[r,o]=P.useState(0),[c,d]=P.useState(0),[h,u]=P.useState(0),[m,g]=P.useState(t6),[x,y]=P.useState(null),v=P.useCallback(async()=>{const D=[];for(let z=0;z<5;z++){const B=performance.now();await e6("/api/speedtest/ping");const I=performance.now();D.push(I-B)}D.sort((z,B)=>z-B);const V=D.slice(1,-1);return V.reduce((z,B)=>z+B,0)/V.length},[]),S=P.useCallback(async()=>{const V=localStorage.getItem("openflix_token")||"",z=performance.now(),B=await fetch("/api/speedtest/download?size=10000000",{headers:{"X-Plex-Token":V}});if(!B.ok)throw new Error("Download test failed");const I=B.body?.getReader();let M=0;if(I)for(;;){const{done:O,value:J}=await I.read();if(O)break;M+=J.length;const ie=(performance.now()-z)/1e3;if(ie>0){const ne=M*8/(ie*1e6);n(ne)}}const L=(performance.now()-z)/1e3;return M*8/(L*1e6)},[]),N=P.useCallback(async()=>{const V=new Uint8Array(5e6);for(let L=0;L<5e6;L++)V[L]=L*7+13&255;const z=localStorage.getItem("openflix_token")||"",B=performance.now();if(!(await fetch("/api/speedtest/upload",{method:"POST",headers:{"X-Plex-Token":z},body:V})).ok)throw new Error("Upload test failed");const M=(performance.now()-B)/1e3;return 5e6*8/(M*1e6)},[]),A=P.useCallback(async()=>{y(null),n(0),o(0),d(0),u(0);try{e("latency");const D=await v();o(D),e("download"),n(0);const V=await S();d(V),n(V),e("upload"),n(0);const z=await N();u(z),n(z),e("complete"),n(Math.max(V,z));const I=[{id:Date.now().toString(),timestamp:new Date().toISOString(),latency:Math.round(D*10)/10,download:Math.round(V*10)/10,upload:Math.round(z*10)/10},...m].slice(0,20);g(I),s6(I)}catch(D){y(D instanceof Error?D.message:"Speed test failed"),e("idle")}},[v,S,N,m]),R=()=>{g([]),localStorage.removeItem(U0)},C=i==="complete"?c:i==="upload"?t||h:t||c;return s.jsxs("div",{children:[s.jsxs("div",{className:"mb-8",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Zm,{className:"h-6 w-6 text-indigo-400"}),s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Speed Test"})]}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Test network speed between your browser and the server"})]}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-8 mb-6",children:[s.jsx(n6,{speed:C}),s.jsxs("div",{className:"flex justify-center gap-3 mt-6",children:[s.jsx(Fm,{phase:"latency",currentPhase:i}),s.jsx(Fm,{phase:"download",currentPhase:i}),s.jsx(Fm,{phase:"upload",currentPhase:i})]}),s.jsx("div",{className:"text-center mt-8",children:i==="idle"||i==="complete"?s.jsxs("button",{onClick:A,className:"inline-flex items-center gap-2 px-8 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-xl text-lg transition-colors",children:[s.jsx($n,{className:"h-5 w-5"}),i==="complete"?"Test Again":"Start Test"]}):s.jsxs("div",{className:"text-gray-400",children:[s.jsx(nt,{className:"h-6 w-6 animate-spin mx-auto mb-2"}),"Testing..."]})}),x&&s.jsx("div",{className:"mt-4 p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-center",children:s.jsx("span",{className:"text-red-400 text-sm",children:x})}),i==="complete"&&s.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-8",children:[s.jsxs("div",{className:"bg-gray-700/50 rounded-xl p-4 text-center",children:[s.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[s.jsx(Ts,{className:"h-4 w-4 text-yellow-400"}),s.jsx("span",{className:"text-sm text-gray-400",children:"Latency"})]}),s.jsx("p",{className:"text-2xl font-bold text-white",children:r.toFixed(1)}),s.jsx("p",{className:"text-xs text-gray-500",children:"ms"})]}),s.jsxs("div",{className:"bg-gray-700/50 rounded-xl p-4 text-center",children:[s.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[s.jsx(Bu,{className:"h-4 w-4 text-green-400"}),s.jsx("span",{className:"text-sm text-gray-400",children:"Download"})]}),s.jsx("p",{className:"text-2xl font-bold text-white",children:c.toFixed(1)}),s.jsx("p",{className:"text-xs text-gray-500",children:"Mbps"})]}),s.jsxs("div",{className:"bg-gray-700/50 rounded-xl p-4 text-center",children:[s.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[s.jsx(Wg,{className:"h-4 w-4 text-blue-400"}),s.jsx("span",{className:"text-sm text-gray-400",children:"Upload"})]}),s.jsx("p",{className:"text-2xl font-bold text-white",children:h.toFixed(1)}),s.jsx("p",{className:"text-xs text-gray-500",children:"Mbps"})]})]})]}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Vu,{className:"h-5 w-5 text-indigo-400"}),s.jsx("h2",{className:"text-lg font-semibold text-white",children:"Test History"})]}),m.length>0&&s.jsxs("button",{onClick:R,className:"flex items-center gap-1 px-3 py-1.5 text-sm text-gray-400 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors",children:[s.jsx(ts,{className:"h-3.5 w-3.5"}),"Clear"]})]}),m.length===0?s.jsxs("div",{className:"text-center py-8",children:[s.jsx(Zm,{className:"h-12 w-12 text-gray-600 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-400",children:"No test history yet"}),s.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Run a speed test to see results here."})]}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-gray-700",children:[s.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-400",children:"Date"}),s.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-400",children:"Latency"}),s.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-400",children:"Download"}),s.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-400",children:"Upload"})]})}),s.jsx("tbody",{children:m.map(D=>s.jsxs("tr",{className:"border-b border-gray-700/50 hover:bg-gray-700/30",children:[s.jsx("td",{className:"py-3 px-4 text-sm text-gray-300",children:new Date(D.timestamp).toLocaleString()}),s.jsx("td",{className:"py-3 px-4 text-sm text-right",children:s.jsxs("span",{className:"text-yellow-400",children:[D.latency," ms"]})}),s.jsx("td",{className:"py-3 px-4 text-sm text-right",children:s.jsxs("span",{className:"text-green-400",children:[D.download," Mbps"]})}),s.jsx("td",{className:"py-3 px-4 text-sm text-right",children:s.jsxs("span",{className:"text-blue-400",children:[D.upload," Mbps"]})})]},D.id))})]})})]})]})}const a6="openflix_token";function r6(){return localStorage.getItem(a6)||""}function $m(i){return new Date(i).toLocaleString()}function o6(i,e){if(!i)return"--";const t=new Date(i).getTime(),r=(e?new Date(e).getTime():Date.now())-t,o=Math.floor(r/1e3);if(o<60)return`${o}s`;const c=Math.floor(o/60),d=o%60;if(c<60)return`${c}m ${d}s`;const h=Math.floor(c/60),u=c%60;return`${h}h ${u}m`}const Dg={pending:{icon:Ts,color:"text-yellow-400",bgColor:"bg-yellow-500/10",borderColor:"border-yellow-500/30",label:"Pending"},running:{icon:wn,color:"text-blue-400",bgColor:"bg-blue-500/10",borderColor:"border-blue-500/30",label:"Running"},completed:{icon:vs,color:"text-green-400",bgColor:"bg-green-500/10",borderColor:"border-green-500/30",label:"Completed"},failed:{icon:gc,color:"text-red-400",bgColor:"bg-red-500/10",borderColor:"border-red-500/30",label:"Failed"},paused:{icon:Yo,color:"text-gray-400",bgColor:"bg-gray-500/10",borderColor:"border-gray-500/30",label:"Paused"}};function l6({status:i}){const e=Dg[i]||Dg.pending,t=e.icon;return s.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 ${e.bgColor} ${e.color} border ${e.borderColor} rounded-full text-xs font-medium`,children:[s.jsx(t,{className:"h-3 w-3"}),e.label]})}function c6({priority:i}){let e="text-gray-400 bg-gray-500/10",t="Normal";return i>=8?(e="text-red-400 bg-red-500/10",t="Critical"):i>=5?(e="text-orange-400 bg-orange-500/10",t="High"):i>=3?(e="text-yellow-400 bg-yellow-500/10",t="Medium"):i<=1&&(e="text-gray-500 bg-gray-500/10",t="Low"),s.jsx("span",{className:`px-2 py-0.5 ${e} rounded text-xs`,children:t})}const V_=[{id:"job-001",type:"library_scan",status:"running",priority:5,payload:'{"libraryId": 1, "type": "full"}',createdAt:new Date(Date.now()-3e5).toISOString(),startedAt:new Date(Date.now()-12e4).toISOString()},{id:"job-002",type:"metadata_refresh",status:"pending",priority:3,payload:'{"mediaId": 42}',createdAt:new Date(Date.now()-6e4).toISOString()},{id:"job-003",type:"epg_update",status:"completed",priority:4,payload:'{"sourceId": 2}',result:'{"channelsUpdated": 150, "programsAdded": 3200}',createdAt:new Date(Date.now()-36e5).toISOString(),startedAt:new Date(Date.now()-35e5).toISOString(),completedAt:new Date(Date.now()-34e5).toISOString()},{id:"job-004",type:"recording_post_process",status:"failed",priority:7,payload:'{"recordingId": 88}',error:"ffmpeg exited with code 1: output file already exists",createdAt:new Date(Date.now()-72e5).toISOString(),startedAt:new Date(Date.now()-71e5).toISOString(),completedAt:new Date(Date.now()-705e4).toISOString()},{id:"job-005",type:"commercial_detect",status:"completed",priority:2,payload:'{"recordingId": 85}',result:'{"segments": 5, "totalDuration": 180}',createdAt:new Date(Date.now()-108e5).toISOString(),startedAt:new Date(Date.now()-107e5).toISOString(),completedAt:new Date(Date.now()-105e5).toISOString()},{id:"job-006",type:"thumbnail_generation",status:"pending",priority:1,payload:'{"mediaId": 100}',createdAt:new Date(Date.now()-3e4).toISOString()}];async function d6(){const i=await fetch("/api/jobs",{headers:{"X-Plex-Token":r6()}});return i.ok?i.json():{jobs:V_,total:V_.length}}const u6=["all","pending","running","completed","failed"];function h6(){const[i,e]=P.useState("all"),[t,n]=P.useState(null),{data:r,isLoading:o,error:c,refetch:d}=qe({queryKey:["jobs"],queryFn:d6,refetchInterval:5e3}),h=r?.jobs||[],u=i==="all"?h:h.filter(g=>g.status===i),m=h.reduce((g,x)=>(g[x.status]=(g[x.status]||0)+1,g),{});return o?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx(nt,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):c?s.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[s.jsx(tn,{className:"h-12 w-12 text-red-400"}),s.jsx("h3",{className:"text-lg font-medium text-white",children:"Failed to load jobs"}),s.jsx("p",{className:"text-gray-400 text-sm",children:c.message}),s.jsxs("button",{onClick:()=>d(),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[s.jsx(Et,{className:"h-4 w-4"}),"Retry"]})]}):s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-8",children:[s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[s.jsx(eg,{className:"h-7 w-7 text-indigo-400"}),"Job Queue"]}),s.jsxs("p",{className:"text-gray-400 mt-1",children:[h.length," job",h.length!==1?"s":""," total",m.running?` / ${m.running} running`:""]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500",children:[s.jsx(Et,{className:"h-3 w-3 animate-spin"}),"Auto-refresh: 5s"]}),s.jsxs("button",{onClick:()=>d(),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:[s.jsx(Et,{className:"h-4 w-4"}),"Refresh"]})]})]}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:["pending","running","completed","failed"].map(g=>{const x=Dg[g],y=x.icon;return s.jsx("button",{onClick:()=>e(i===g?"all":g),className:`bg-gray-800 rounded-xl p-4 text-left transition-colors ${i===g?"ring-2 ring-indigo-500":"hover:bg-gray-750"}`,children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`p-2 rounded-lg ${x.bgColor}`,children:s.jsx(y,{className:`h-5 w-5 ${x.color}`})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-2xl font-bold text-white",children:m[g]||0}),s.jsx("p",{className:"text-xs text-gray-400",children:x.label})]})]})},g)})}),s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx(Sj,{className:"h-4 w-4 text-gray-500"}),s.jsx("div",{className:"flex gap-1",children:u6.map(g=>s.jsxs("button",{onClick:()=>e(g),className:`px-3 py-1.5 rounded-lg text-xs capitalize transition-colors ${i===g?"bg-indigo-600 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"}`,children:[g," ",g!=="all"&&m[g]?`(${m[g]})`:""]},g))})]}),u.length===0?s.jsxs("div",{className:"flex flex-col items-center justify-center h-48 bg-gray-800 rounded-xl",children:[s.jsx(eg,{className:"h-12 w-12 text-gray-600 mb-3"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-1",children:"No jobs"}),s.jsx("p",{className:"text-gray-400 text-sm",children:i!=="all"?`No ${i} jobs found`:"The job queue is empty"})]}):s.jsx("div",{className:"bg-gray-800 rounded-xl overflow-hidden",children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"text-left text-sm text-gray-400 border-b border-gray-700",children:[s.jsx("th",{className:"px-6 py-4 font-medium",children:"Job ID"}),s.jsx("th",{className:"px-6 py-4 font-medium",children:"Type"}),s.jsx("th",{className:"px-6 py-4 font-medium",children:"Status"}),s.jsx("th",{className:"px-6 py-4 font-medium",children:"Priority"}),s.jsx("th",{className:"px-6 py-4 font-medium",children:"Created"}),s.jsx("th",{className:"px-6 py-4 font-medium",children:"Duration"})]})}),s.jsx("tbody",{className:"text-sm",children:u.map(g=>s.jsxs(s.Fragment,{children:[s.jsxs("tr",{onClick:()=>n(t===g.id?null:g.id),className:"border-b border-gray-700/50 hover:bg-gray-700/30 transition-colors cursor-pointer",children:[s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:"text-gray-300 font-mono text-xs",children:g.id})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:"text-white font-medium",children:g.type.replace(/_/g," ").replace(/\b\w/g,x=>x.toUpperCase())})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx(l6,{status:g.status})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx(c6,{priority:g.priority})}),s.jsx("td",{className:"px-6 py-4 text-gray-400 text-xs",children:$m(g.createdAt)}),s.jsx("td",{className:"px-6 py-4 text-gray-400 text-xs",children:o6(g.startedAt,g.completedAt)})]},g.id),t===g.id&&s.jsx("tr",{children:s.jsx("td",{colSpan:6,className:"px-6 py-4 bg-gray-900/50",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-xs",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500 mb-1",children:"Payload"}),s.jsx("pre",{className:"text-gray-300 bg-gray-900 p-3 rounded-lg overflow-x-auto font-mono",children:(()=>{try{return JSON.stringify(JSON.parse(g.payload),null,2)}catch{return g.payload}})()})]}),g.result&&s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500 mb-1",children:"Result"}),s.jsx("pre",{className:"text-green-400 bg-gray-900 p-3 rounded-lg overflow-x-auto font-mono",children:(()=>{try{return JSON.stringify(JSON.parse(g.result),null,2)}catch{return g.result}})()})]}),g.error&&s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500 mb-1",children:"Error"}),s.jsx("pre",{className:"text-red-400 bg-gray-900 p-3 rounded-lg overflow-x-auto font-mono",children:g.error})]}),s.jsx("div",{className:"md:col-span-2",children:s.jsxs("div",{className:"flex gap-6 text-gray-400",children:[g.startedAt&&s.jsxs("span",{children:["Started: ",$m(g.startedAt)]}),g.completedAt&&s.jsxs("span",{children:["Completed: ",$m(g.completedAt)]})]})})]})})},`${g.id}-details`)]}))})]})})})]})}const bc={"X-Plex-Token":localStorage.getItem("openflix_token")||"","Content-Type":"application/json"};async function f6(){const i=await fetch("/dvr/v2/virtual-stations",{headers:bc});if(!i.ok)throw new Error("Failed to fetch virtual stations");return(await i.json()).stations||[]}async function m6(i){const e=await fetch("/dvr/v2/virtual-stations",{method:"POST",headers:bc,body:JSON.stringify(i)});if(!e.ok)throw new Error("Failed to create station");return e.json()}async function tN(i,e){const t=await fetch(`/dvr/v2/virtual-stations/${i}`,{method:"PUT",headers:bc,body:JSON.stringify(e)});if(!t.ok)throw new Error("Failed to update station");return t.json()}async function g6(i){if(!(await fetch(`/dvr/v2/virtual-stations/${i}`,{method:"DELETE",headers:bc})).ok)throw new Error("Failed to delete station")}async function p6(i){const e=await fetch("/dvr/v2/virtual-stations/preview",{method:"POST",headers:bc,body:JSON.stringify({smartRule:i})});if(!e.ok)throw new Error("Failed to preview");return(await e.json()).files||[]}const x6=[{value:"title",label:"Title"},{value:"genre",label:"Genre"},{value:"year",label:"Year"},{value:"rating",label:"Rating"},{value:"duration",label:"Duration"},{value:"type",label:"Type"},{value:"studio",label:"Studio"},{value:"resolution",label:"Resolution"},{value:"addedAt",label:"Date Added"}],y6=[{value:"is",label:"is"},{value:"is_not",label:"is not"},{value:"contains",label:"contains"},{value:"starts_with",label:"starts with"},{value:"ends_with",label:"ends with"},{value:"gt",label:"greater than"},{value:"lt",label:"less than"}],v6=[{value:"title",label:"Title"},{value:"year",label:"Year"},{value:"addedAt",label:"Date Added"},{value:"duration",label:"Duration"},{value:"rating",label:"Rating"},{value:"random",label:"Random"}];function b6(i){if(!i)return[{field:"title",operator:"contains",value:""}];try{const e=JSON.parse(i);if(Array.isArray(e)&&e.length>0)return e}catch{}return[{field:"title",operator:"contains",value:""}]}function H_(i){return JSON.stringify(i.filter(e=>e.value.trim()!==""))}function _6({conditions:i,onChange:e}){const t=(o,c)=>{const d=i.map((h,u)=>u===o?{...h,...c}:h);e(d)},n=()=>{e([...i,{field:"title",operator:"contains",value:""}])},r=o=>{i.length<=1||e(i.filter((c,d)=>d!==o))};return s.jsxs("div",{className:"space-y-3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Smart Rules"}),i.map((o,c)=>s.jsxs("div",{className:"flex items-center gap-2",children:[c>0&&s.jsx("span",{className:"text-xs text-indigo-400 font-medium w-8",children:"AND"}),c===0&&s.jsx("span",{className:"w-8"}),s.jsx("select",{value:o.field,onChange:d=>t(c,{field:d.target.value}),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",children:x6.map(d=>s.jsx("option",{value:d.value,children:d.label},d.value))}),s.jsx("select",{value:o.operator,onChange:d=>t(c,{operator:d.target.value}),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",children:y6.map(d=>s.jsx("option",{value:d.value,children:d.label},d.value))}),s.jsx("input",{type:"text",value:o.value,onChange:d=>t(c,{value:d.target.value}),placeholder:"Value",className:"flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500"}),s.jsx("button",{onClick:()=>r(c),disabled:i.length<=1,className:"p-2 text-gray-400 hover:text-red-400 disabled:opacity-30 rounded-lg hover:bg-gray-700 transition-colors",children:s.jsx(ts,{className:"w-4 h-4"})})]},c)),s.jsxs("button",{onClick:n,className:"flex items-center gap-1 text-sm text-indigo-400 hover:text-indigo-300 transition-colors",children:[s.jsx(rs,{className:"w-3.5 h-3.5"}),"Add Condition"]})]})}function S6({station:i,onClose:e}){const t=ft(),n=!!i,[r,o]=P.useState(i?.name||""),[c,d]=P.useState(i?.number||1),[h,u]=P.useState(i?.logo||""),[m,g]=P.useState(i?.description||""),[x,y]=P.useState(i?.smartRule?"smart":"manual"),[v,S]=P.useState(b6(i?.smartRule)),[N,A]=P.useState(i?.fileIds||""),[R,C]=P.useState(i?.shuffle??!1),[D,V]=P.useState(i?.loop??!0),[z,B]=P.useState(i?.sort||"title"),[I,M]=P.useState(i?.order||"asc"),[L,O]=P.useState(i?.limit||0),[J,ie]=P.useState([]),[ne,se]=P.useState(!1),[X,ce]=P.useState(""),le=Ve({mutationFn:m6,onSuccess:()=>{t.invalidateQueries({queryKey:["virtual-stations"]}),e()}}),Y=Ve({mutationFn:oe=>tN(i.id,oe),onSuccess:()=>{t.invalidateQueries({queryKey:["virtual-stations"]}),e()}}),K=le.isPending||Y.isPending,H=async()=>{if(x==="smart"){se(!0),ce("");try{const oe=await p6(H_(v));ie(oe)}catch(oe){ce(oe instanceof Error?oe.message:"Preview failed")}finally{se(!1)}}},Q=oe=>{oe.preventDefault();const ye={name:r,number:c,logo:h||void 0,description:m||void 0,shuffle:R,loop:D,sort:z,order:I,limit:L,enabled:i?.enabled??!0};x==="smart"?(ye.smartRule=H_(v),ye.fileIds=void 0):(ye.fileIds=N,ye.smartRule=void 0),n?Y.mutate(ye):le.mutate(ye)};return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"sticky top-0 bg-gray-800 px-6 pt-6 pb-4 border-b border-gray-700 flex items-center justify-between z-10",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(sn,{className:"w-5 h-5 text-indigo-400"}),s.jsx("h2",{className:"text-lg font-semibold text-white",children:n?"Edit Virtual Channel":"Create Virtual Channel"})]}),s.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-white rounded-lg hover:bg-gray-700 transition-colors",children:s.jsx(At,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:Q,className:"p-6 space-y-5",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Channel Name"}),s.jsx("input",{type:"text",value:r,onChange:oe=>o(oe.target.value),required:!0,placeholder:"24/7 Action Movies",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Channel Number"}),s.jsx("input",{type:"number",value:c,onChange:oe=>d(parseInt(oe.target.value)||1),min:1,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Logo URL"}),s.jsx("input",{type:"url",value:h,onChange:oe=>u(oe.target.value),placeholder:"https://...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Description"}),s.jsx("textarea",{value:m,onChange:oe=>g(oe.target.value),rows:2,placeholder:"Optional description...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 resize-none focus:outline-none focus:border-indigo-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Content Source"}),s.jsxs("div",{className:"flex gap-2 mb-4",children:[s.jsx("button",{type:"button",onClick:()=>y("smart"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${x==="smart"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-400 hover:text-white"}`,children:"Smart Rule"}),s.jsx("button",{type:"button",onClick:()=>y("manual"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${x==="manual"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-400 hover:text-white"}`,children:"Manual"})]}),x==="smart"?s.jsxs("div",{className:"space-y-4",children:[s.jsx(_6,{conditions:v,onChange:S}),s.jsxs("button",{type:"button",onClick:H,disabled:ne,className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm font-medium transition-colors",children:[ne?s.jsx(nt,{className:"w-4 h-4 animate-spin"}):s.jsx(wS,{className:"w-4 h-4"}),"Preview Matches"]}),X&&s.jsxs("p",{className:"text-red-400 text-sm flex items-center gap-1",children:[s.jsx(Ct,{className:"w-4 h-4"}),X]}),J.length>0&&s.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-3 max-h-40 overflow-y-auto",children:[s.jsxs("p",{className:"text-xs text-gray-400 mb-2",children:[J.length," matched files"]}),J.map(oe=>s.jsxs("div",{className:"text-sm text-gray-300 py-1 border-b border-gray-700 last:border-0",children:[oe.title,oe.type&&s.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",oe.type,")"]})]},oe.id))]})]}):s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"File IDs (comma-separated)"}),s.jsx("textarea",{value:N,onChange:oe=>A(oe.target.value),rows:3,placeholder:"1, 2, 3, ...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm font-mono placeholder-gray-500 resize-none focus:outline-none focus:border-indigo-500"})]})]}),s.jsxs("div",{className:"border-t border-gray-700 pt-5 space-y-4",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"Playback Options"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[s.jsx("div",{className:`relative w-10 h-5 rounded-full transition-colors ${R?"bg-indigo-600":"bg-gray-600"}`,onClick:()=>C(!R),children:s.jsx("div",{className:`absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full shadow transition-transform ${R?"translate-x-5":""}`})}),s.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-gray-300",children:[s.jsx(kS,{className:"w-4 h-4"}),"Shuffle"]})]}),s.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[s.jsx("div",{className:`relative w-10 h-5 rounded-full transition-colors ${D?"bg-indigo-600":"bg-gray-600"}`,onClick:()=>V(!D),children:s.jsx("div",{className:`absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full shadow transition-transform ${D?"translate-x-5":""}`})}),s.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-gray-300",children:[s.jsx(t0,{className:"w-4 h-4"}),"Loop"]})]})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Sort"}),s.jsx("select",{value:z,onChange:oe=>B(oe.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",children:v6.map(oe=>s.jsx("option",{value:oe.value,children:oe.label},oe.value))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Order"}),s.jsxs("select",{value:I,onChange:oe=>M(oe.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",children:[s.jsx("option",{value:"asc",children:"Ascending"}),s.jsx("option",{value:"desc",children:"Descending"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Limit (0 = all)"}),s.jsx("input",{type:"number",value:L,onChange:oe=>O(parseInt(oe.target.value)||0),min:0,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500"})]})]})]}),(le.isError||Y.isError)&&s.jsxs("p",{className:"text-red-400 text-sm flex items-center gap-1",children:[s.jsx(Ct,{className:"w-4 h-4"}),(le.error||Y.error)?.message||"Operation failed"]}),s.jsxs("div",{className:"flex gap-3 pt-2",children:[s.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2.5 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:K||!r.trim(),className:"flex-1 py-2.5 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-40 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors",children:K?s.jsx(nt,{className:"w-4 h-4 animate-spin mx-auto"}):n?"Save Changes":"Create Channel"})]})]})]})})}function E6({station:i,onEdit:e,onDelete:t,onToggle:n}){const r=i.fileIds?i.fileIds.split(",").filter(Boolean).length:0;return s.jsx("div",{className:`bg-gray-800 rounded-xl p-5 border transition-colors ${i.enabled?"border-gray-700 hover:border-gray-600":"border-gray-700/50 opacity-60"}`,children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"flex-shrink-0 w-16 h-16 rounded-lg bg-gray-700 flex items-center justify-center overflow-hidden",children:i.logo?s.jsx("img",{src:i.logo,alt:i.name,className:"w-full h-full object-cover"}):s.jsx(ss,{className:"w-8 h-8 text-gray-500"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsxs("span",{className:"px-2 py-0.5 bg-indigo-600/20 text-indigo-400 text-xs font-mono rounded",children:["#",i.number]}),s.jsx("h3",{className:"text-white font-semibold truncate",children:i.name})]}),i.description&&s.jsx("p",{className:"text-sm text-gray-400 line-clamp-1 mb-2",children:i.description}),s.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-gray-500",children:[i.smartRule&&s.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 bg-purple-500/10 text-purple-400 rounded",children:[s.jsx(qt,{className:"w-3 h-3"}),"Smart Rule"]}),r>0&&!i.smartRule&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Jg,{className:"w-3 h-3"}),r," files"]}),i.shuffle&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(kS,{className:"w-3 h-3"}),"Shuffle"]}),i.loop&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(t0,{className:"w-3 h-3"}),"Loop"]}),i.limit>0&&s.jsxs("span",{children:["Limit: ",i.limit]})]})]}),s.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[s.jsx("button",{onClick:n,className:`p-2 rounded-lg transition-colors ${i.enabled?"text-green-400 hover:bg-gray-700":"text-gray-500 hover:bg-gray-700"}`,title:i.enabled?"Disable":"Enable",children:s.jsx(sg,{className:"w-4 h-4"})}),s.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-indigo-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Edit",children:s.jsx(Ri,{className:"w-4 h-4"})}),s.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Delete",children:s.jsx(ts,{className:"w-4 h-4"})})]})]})})}function N6(){const i=ft(),{data:e,isLoading:t,error:n}=qe({queryKey:["virtual-stations"],queryFn:f6}),r=Ve({mutationFn:g6,onSuccess:()=>i.invalidateQueries({queryKey:["virtual-stations"]})}),o=Ve({mutationFn:({id:x,enabled:y})=>tN(x,{enabled:y}),onSuccess:()=>i.invalidateQueries({queryKey:["virtual-stations"]})}),[c,d]=P.useState(null),[h,u]=P.useState(""),m=(e||[]).filter(x=>{if(!h.trim())return!0;const y=h.toLowerCase();return x.name.toLowerCase().includes(y)||x.description?.toLowerCase().includes(y)||String(x.number).includes(y)}),g=x=>{confirm("Delete this virtual channel? This cannot be undone.")&&r.mutate(x)};return s.jsxs("div",{children:[s.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Virtual Channels"}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Create custom 24/7 channels from your DVR library"})]}),s.jsxs("button",{onClick:()=>d("new"),className:"flex items-center gap-2 px-4 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors",children:[s.jsx(rs,{className:"w-4 h-4"}),"New Channel"]})]}),(e?.length||0)>3&&s.jsxs("div",{className:"relative mb-6",children:[s.jsx(qt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),s.jsx("input",{type:"text",value:h,onChange:x=>u(x.target.value),placeholder:"Search channels...",className:"w-full pl-10 pr-4 py-2.5 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),t?s.jsx("div",{className:"flex items-center justify-center py-16",children:s.jsx(nt,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):n?s.jsxs("div",{className:"text-center py-16 bg-gray-800 rounded-xl",children:[s.jsx(Ct,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Failed to load virtual channels"}),s.jsx("p",{className:"text-gray-400 text-sm",children:n instanceof Error?n.message:"Unknown error"})]}):m.length===0?s.jsxs("div",{className:"text-center py-16 bg-gray-800 rounded-xl",children:[s.jsx(sn,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:h?"No matching channels":"No virtual channels yet"}),s.jsx("p",{className:"text-gray-400 mb-6",children:h?`No channels match "${h}"`:"Create your first custom 24/7 channel."}),!h&&s.jsxs("button",{onClick:()=>d("new"),className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors",children:[s.jsx(rs,{className:"w-4 h-4"}),"New Channel"]})]}):s.jsx("div",{className:"space-y-3",children:m.sort((x,y)=>x.number-y.number).map(x=>s.jsx(E6,{station:x,onEdit:()=>d(x),onDelete:()=>g(x.id),onToggle:()=>o.mutate({id:x.id,enabled:!x.enabled})},x.id))}),c!==null&&s.jsx(S6,{station:c==="new"?null:c,onClose:()=>d(null)})]})}const vr=async(i,e)=>{const t=localStorage.getItem("openflix_token")||"",n=await fetch(i,{...e,headers:{"X-Plex-Token":t,"Content-Type":"application/json",...e?.headers}});if(!n.ok)throw new Error(`API error: ${n.status}`);return n.json()};function na(i){const e=Math.floor(i/3600),t=Math.floor(i%3600/60),n=Math.floor(i%60);return e>0?`${e}:${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`:`${t}:${n.toString().padStart(2,"0")}`}function w6(i,e){const t=e-i;return t<60?`${t.toFixed(1)}s`:na(t)}const Ig={intro:"bg-blue-500",outro:"bg-orange-500",credits:"bg-purple-500",commercial:"bg-red-500"},T6={intro:"text-blue-400",outro:"text-orange-400",credits:"text-purple-400",commercial:"text-red-400"},A6={intro:"bg-blue-500/20",outro:"bg-orange-500/20",credits:"bg-purple-500/20",commercial:"bg-red-500/20"};function K_({segments:i,duration:e}){return e<=0?null:s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"relative h-12 bg-gray-700 rounded-lg overflow-hidden",children:i.map(t=>{const n=t.startTime/e*100,r=(t.endTime-t.startTime)/e*100;return s.jsx("div",{className:`absolute top-0 bottom-0 ${Ig[t.type]||"bg-gray-500"} opacity-70 hover:opacity-90 transition-opacity cursor-pointer`,style:{left:`${n}%`,width:`${Math.max(r,.5)}%`},title:`${t.type}: ${na(t.startTime)} - ${na(t.endTime)}`},t.id)})}),s.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[s.jsx("span",{children:"0:00"}),s.jsx("span",{children:na(e/4)}),s.jsx("span",{children:na(e/2)}),s.jsx("span",{children:na(e*3/4)}),s.jsx("span",{children:na(e)})]}),s.jsx("div",{className:"flex gap-4 flex-wrap",children:Object.entries(Ig).map(([t,n])=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`w-3 h-3 rounded ${n}`}),s.jsx("span",{className:"text-xs text-gray-400 capitalize",children:t})]},t))})]})}function j6({onAdd:i,isAdding:e}){const[t,n]=P.useState("intro"),[r,o]=P.useState(0),[c,d]=P.useState(0),[h,u]=P.useState(0),[m,g]=P.useState(30),x=y=>{y.preventDefault();const v=r*60+c,S=h*60+m;S<=v||i({type:t,startTime:v,endTime:S})};return s.jsxs("form",{onSubmit:x,className:"bg-gray-700/50 rounded-lg p-4",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-3",children:"Add Segment Manually"}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Type"}),s.jsxs("select",{value:t,onChange:y=>n(y.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",children:[s.jsx("option",{value:"intro",children:"Intro"}),s.jsx("option",{value:"outro",children:"Outro"}),s.jsx("option",{value:"credits",children:"Credits"}),s.jsx("option",{value:"commercial",children:"Commercial"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Start Time"}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx("input",{type:"number",min:"0",value:r,onChange:y=>o(Number(y.target.value)),className:"w-16 px-2 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm text-center",placeholder:"min"}),s.jsx("span",{className:"text-gray-500 self-center",children:":"}),s.jsx("input",{type:"number",min:"0",max:"59",value:c,onChange:y=>d(Number(y.target.value)),className:"w-16 px-2 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm text-center",placeholder:"sec"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"End Time"}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx("input",{type:"number",min:"0",value:h,onChange:y=>u(Number(y.target.value)),className:"w-16 px-2 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm text-center",placeholder:"min"}),s.jsx("span",{className:"text-gray-500 self-center",children:":"}),s.jsx("input",{type:"number",min:"0",max:"59",value:m,onChange:y=>g(Number(y.target.value)),className:"w-16 px-2 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm text-center",placeholder:"sec"})]})]}),s.jsx("div",{className:"flex items-end",children:s.jsxs("button",{type:"submit",disabled:e,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg text-sm",children:[e?s.jsx(nt,{className:"h-4 w-4 animate-spin"}):s.jsx(rs,{className:"h-4 w-4"}),"Add"]})})]})]})}function C6({segment:i,onSave:e,onClose:t}){const[n,r]=P.useState(i.type),[o,c]=P.useState(Math.floor(i.startTime/60)),[d,h]=P.useState(Math.floor(i.startTime%60)),[u,m]=P.useState(Math.floor(i.endTime/60)),[g,x]=P.useState(Math.floor(i.endTime%60)),y=v=>{v.preventDefault();const S=o*60+d,N=u*60+g;N<=S||(e(i.id,{type:n,startTime:S,endTime:N}),t())};return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Edit Segment"}),s.jsxs("form",{onSubmit:y,className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Type"}),s.jsxs("select",{value:n,onChange:v=>r(v.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:[s.jsx("option",{value:"intro",children:"Intro"}),s.jsx("option",{value:"outro",children:"Outro"}),s.jsx("option",{value:"credits",children:"Credits"}),s.jsx("option",{value:"commercial",children:"Commercial"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Start Time"}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx("input",{type:"number",min:"0",value:o,onChange:v=>c(Number(v.target.value)),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",placeholder:"min"}),s.jsx("span",{className:"text-gray-500 self-center",children:":"}),s.jsx("input",{type:"number",min:"0",max:"59",value:d,onChange:v=>h(Number(v.target.value)),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",placeholder:"sec"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"End Time"}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx("input",{type:"number",min:"0",value:u,onChange:v=>m(Number(v.target.value)),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",placeholder:"min"}),s.jsx("span",{className:"text-gray-500 self-center",children:":"}),s.jsx("input",{type:"number",min:"0",max:"59",value:g,onChange:v=>x(Number(v.target.value)),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",placeholder:"sec"})]})]})]}),s.jsxs("div",{className:"flex gap-3 pt-2",children:[s.jsx("button",{type:"button",onClick:t,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),s.jsx("button",{type:"submit",className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:"Save"})]})]})]})})}function R6(){const i=ft(),[e,t]=P.useState(""),[n,r]=P.useState(""),[o,c]=P.useState(null),d=e.trim(),{data:h,isLoading:u,error:m}=qe({queryKey:["segments",d],queryFn:()=>vr(`/dvr/v2/files/${d}/segments`),enabled:!!d}),g=Ve({mutationFn:C=>vr(`/dvr/v2/files/${C}/detect-segments`,{method:"POST"}),onSuccess:()=>{i.invalidateQueries({queryKey:["segments",d]})}}),x=Ve({mutationFn:C=>vr(`/dvr/v2/groups/${C}/detect-segments`,{method:"POST"}),onSuccess:()=>{i.invalidateQueries({queryKey:["segments",d]})}}),y=Ve({mutationFn:C=>vr(`/dvr/v2/files/${C}/segments`,{method:"DELETE"}),onSuccess:()=>{i.invalidateQueries({queryKey:["segments",d]})}}),v=h?.segments||[],S=h?.duration||0,N=C=>{vr(`/dvr/v2/files/${d}/segments`,{method:"POST",body:JSON.stringify(C)}).then(()=>{i.invalidateQueries({queryKey:["segments",d]})})},A=(C,D)=>{vr(`/dvr/v2/files/${d}/segments/${C}`,{method:"PUT",body:JSON.stringify(D)}).then(()=>{i.invalidateQueries({queryKey:["segments",d]})})},R=C=>{vr(`/dvr/v2/files/${d}/segments/${C}`,{method:"DELETE"}).then(()=>{i.invalidateQueries({queryKey:["segments",d]})})};return s.jsxs("div",{children:[s.jsxs("div",{className:"mb-8",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Jl,{className:"h-6 w-6 text-indigo-400"}),s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Segment Detection"})]}),s.jsx("p",{className:"text-gray-400 mt-1",children:"View and edit intro, outro, credits, and commercial segments"})]}),s.jsx("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"File ID"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:e,onChange:C=>t(C.target.value),className:"flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"Enter file ID..."}),s.jsxs("button",{onClick:()=>g.mutate(d),disabled:!d||g.isPending,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 disabled:cursor-not-allowed text-white rounded-lg whitespace-nowrap",children:[g.isPending?s.jsx(nt,{className:"h-4 w-4 animate-spin"}):s.jsx(wn,{className:"h-4 w-4"}),"Detect Segments"]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Group ID (cross-episode)"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:n,onChange:C=>r(C.target.value),className:"flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"Enter group ID..."}),s.jsxs("button",{onClick:()=>x.mutate(n.trim()),disabled:!n.trim()||x.isPending,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 disabled:cursor-not-allowed text-white rounded-lg whitespace-nowrap",children:[x.isPending?s.jsx(nt,{className:"h-4 w-4 animate-spin"}):s.jsx(Ha,{className:"h-4 w-4"}),"Detect Group"]})]})]})]})}),d?u?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx(nt,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):m?s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 text-center",children:[s.jsx(Ct,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Failed to load segments"}),s.jsxs("p",{className:"text-gray-400",children:["Could not fetch segments for file ID: ",d]})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h2",{className:"text-lg font-semibold text-white",children:["Timeline",h?.fileName&&s.jsxs("span",{className:"text-sm text-gray-400 font-normal ml-2",children:["- ",h.fileName]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"text-sm text-gray-400",children:[v.length," segment",v.length!==1?"s":""," detected"]}),v.length>0&&s.jsxs("button",{onClick:()=>{confirm("Delete all segments for this file?")&&y.mutate(d)},disabled:y.isPending,className:"flex items-center gap-1 px-3 py-1 text-sm text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-lg transition-colors",children:[s.jsx(ts,{className:"h-3.5 w-3.5"}),"Clear All"]})]})]}),S>0?s.jsx(K_,{segments:v,duration:S}):v.length>0?s.jsx(K_,{segments:v,duration:Math.max(...v.map(C=>C.endTime),1)}):s.jsx("div",{className:"h-12 bg-gray-700 rounded-lg flex items-center justify-center",children:s.jsx("span",{className:"text-sm text-gray-500",children:"No segments detected"})})]}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Segments"}),v.length===0?s.jsxs("div",{className:"text-center py-8",children:[s.jsx(Jl,{className:"h-10 w-10 text-gray-600 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-400 mb-2",children:"No segments found"}),s.jsx("p",{className:"text-gray-500 text-sm",children:"Run detection or add segments manually below."})]}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-gray-700",children:[s.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-400",children:"Type"}),s.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-400",children:"Start"}),s.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-400",children:"End"}),s.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-400",children:"Duration"}),s.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-400",children:"Actions"})]})}),s.jsx("tbody",{children:v.map(C=>s.jsxs("tr",{className:"border-b border-gray-700/50 hover:bg-gray-700/30",children:[s.jsx("td",{className:"py-3 px-4",children:s.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded text-xs font-medium capitalize ${A6[C.type]||"bg-gray-700"} ${T6[C.type]||"text-gray-300"}`,children:[s.jsx("span",{className:`w-2 h-2 rounded-full ${Ig[C.type]||"bg-gray-500"}`}),C.type]})}),s.jsx("td",{className:"py-3 px-4 text-sm text-gray-300 font-mono",children:na(C.startTime)}),s.jsx("td",{className:"py-3 px-4 text-sm text-gray-300 font-mono",children:na(C.endTime)}),s.jsx("td",{className:"py-3 px-4 text-sm text-gray-400",children:w6(C.startTime,C.endTime)}),s.jsx("td",{className:"py-3 px-4 text-right",children:s.jsxs("div",{className:"flex items-center justify-end gap-1",children:[s.jsx("button",{onClick:()=>c(C),className:"p-1.5 text-gray-400 hover:text-indigo-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Edit",children:s.jsx(gC,{className:"h-4 w-4"})}),s.jsx("button",{onClick:()=>R(C.id),className:"p-1.5 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Delete",children:s.jsx(ts,{className:"h-4 w-4"})})]})})]},C.id))})]})}),s.jsx("div",{className:"mt-4 pt-4 border-t border-gray-700",children:s.jsx(j6,{onAdd:N,isAdding:!1})})]}),g.isSuccess&&s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-500/10 border border-green-500/30 rounded-lg",children:[s.jsx(Jl,{className:"h-4 w-4 text-green-400"}),s.jsx("span",{className:"text-green-400 text-sm",children:"Segment detection completed successfully."})]}),g.isError&&s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:[s.jsx(Ct,{className:"h-4 w-4 text-red-400"}),s.jsx("span",{className:"text-red-400 text-sm",children:"Segment detection failed. Please try again."})]}),x.isSuccess&&s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-500/10 border border-green-500/30 rounded-lg",children:[s.jsx(Ha,{className:"h-4 w-4 text-green-400"}),s.jsx("span",{className:"text-green-400 text-sm",children:"Group segment detection completed."})]})]}):s.jsxs("div",{className:"bg-gray-800 rounded-xl p-12 text-center",children:[s.jsx(Jl,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Enter a File ID"}),s.jsx("p",{className:"text-gray-400",children:"Enter a DVR file ID above to view and manage its detected segments."})]}),o&&s.jsx(C6,{segment:o,onSave:A,onClose:()=>c(null)})]})}const L6="openflix_token";function k6(){return localStorage.getItem(L6)||""}const q_=[{value:"",label:"All",icon:qt},{value:"media",label:"Media",icon:fn},{value:"channel",label:"Channels",icon:ss},{value:"program",label:"Programs",icon:sn},{value:"file",label:"Files",icon:Fn},{value:"group",label:"Groups",icon:Gu}],D6={media:{color:"text-purple-400",bg:"bg-purple-500/20",label:"Media"},movie:{color:"text-purple-400",bg:"bg-purple-500/20",label:"Movie"},show:{color:"text-blue-400",bg:"bg-blue-500/20",label:"TV Show"},episode:{color:"text-blue-300",bg:"bg-blue-500/15",label:"Episode"},channel:{color:"text-green-400",bg:"bg-green-500/20",label:"Channel"},program:{color:"text-orange-400",bg:"bg-orange-500/20",label:"Program"},file:{color:"text-gray-400",bg:"bg-gray-500/20",label:"File"},group:{color:"text-yellow-400",bg:"bg-yellow-500/20",label:"Group"}},br=25;async function I6(i,e,t,n){const r=new URLSearchParams;r.set("q",i),e&&r.set("type",e),r.set("limit",String(t)),r.set("offset",String(n));const o=await fetch(`/api/search?${r.toString()}`,{headers:{"X-Plex-Token":k6()}});if(!o.ok)throw new Error("Search failed");return o.json()}function M6({type:i}){const e=D6[i]||{color:"text-gray-400",bg:"bg-gray-500/20",label:i};return s.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 ${e.bg} ${e.color} rounded text-xs font-medium`,children:[s.jsx(MS,{className:"h-3 w-3"}),e.label]})}function O6(){const[i,e]=P.useState(""),[t,n]=P.useState(""),[r,o]=P.useState(""),[c,d]=P.useState(0),{data:h,isLoading:u,error:m,refetch:g}=qe({queryKey:["search",t,r,c],queryFn:()=>I6(t,r,br,c),enabled:t.length>0}),x=P.useCallback(()=>{i.trim()&&(n(i.trim()),d(0))},[i]),y=C=>{C.key==="Enter"&&x()},v=C=>{o(C),d(0)},S=h?.results||[],N=h?.total||0,A=Math.floor(c/br)+1,R=Math.ceil(N/br);return s.jsxs("div",{children:[s.jsxs("div",{className:"mb-8",children:[s.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[s.jsx(qt,{className:"h-7 w-7 text-indigo-400"}),"Search"]}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Search across channels, media, programs, and more"})]}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx(qt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),s.jsx("input",{type:"text",value:i,onChange:C=>e(C.target.value),onKeyDown:y,placeholder:"Search for anything...",className:"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base placeholder-gray-500 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500",autoFocus:!0})]}),s.jsxs("button",{onClick:x,disabled:!i.trim()||u,className:"flex items-center gap-2 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 disabled:cursor-not-allowed text-white rounded-lg font-medium",children:[u?s.jsx(nt,{className:"h-4 w-4 animate-spin"}):s.jsx(qt,{className:"h-4 w-4"}),"Search"]})]}),s.jsx("div",{className:"flex flex-wrap gap-2 mt-4",children:q_.map(({value:C,label:D,icon:V})=>s.jsxs("button",{onClick:()=>v(C),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm transition-colors ${r===C?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:[s.jsx(V,{className:"h-3.5 w-3.5"}),D]},C))})]}),m&&s.jsxs("div",{className:"mb-6 flex flex-col items-center justify-center h-48 gap-4",children:[s.jsx(tn,{className:"h-10 w-10 text-red-400"}),s.jsx("p",{className:"text-red-400 text-sm",children:m.message}),s.jsxs("button",{onClick:()=>g(),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm",children:[s.jsx(Et,{className:"h-4 w-4"}),"Retry"]})]}),!t&&!m&&s.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-500",children:[s.jsx(qt,{className:"h-16 w-16 mb-4 text-gray-600"}),s.jsx("p",{className:"text-lg",children:"Enter a search term to get started"})]}),u&&s.jsx("div",{className:"flex items-center justify-center h-48",children:s.jsx(nt,{className:"h-8 w-8 text-indigo-500 animate-spin"})}),t&&!u&&!m&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex items-center justify-between mb-4",children:s.jsx("p",{className:"text-sm text-gray-400",children:N===0?"No results found":s.jsxs(s.Fragment,{children:["Showing ",c+1,"-",Math.min(c+br,N)," of ",N," result",N!==1?"s":"",r&&s.jsxs("span",{className:"ml-1",children:["in ",q_.find(C=>C.value===r)?.label||r]})]})})}),S.length===0?s.jsxs("div",{className:"flex flex-col items-center justify-center h-48 bg-gray-800 rounded-xl",children:[s.jsx(qt,{className:"h-12 w-12 text-gray-600 mb-3"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-1",children:"No results found"}),s.jsx("p",{className:"text-gray-400 text-sm",children:"Try a different search term or filter"})]}):s.jsx("div",{className:"space-y-2",children:S.map((C,D)=>s.jsxs("div",{className:"bg-gray-800 rounded-xl p-4 hover:bg-gray-750 transition-colors cursor-pointer flex items-center gap-4",children:[C.thumb?s.jsx("img",{src:C.thumb,alt:"",className:"w-12 h-12 rounded-lg object-cover flex-shrink-0 bg-gray-700"}):s.jsx("div",{className:"w-12 h-12 rounded-lg bg-gray-700 flex items-center justify-center flex-shrink-0",children:C.type==="channel"?s.jsx(ss,{className:"h-5 w-5 text-gray-500"}):C.type==="program"?s.jsx(sn,{className:"h-5 w-5 text-gray-500"}):s.jsx(fn,{className:"h-5 w-5 text-gray-500"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(M6,{type:C.type}),C.channelNumber&&s.jsxs("span",{className:"text-xs text-gray-500",children:["Ch. ",C.channelNumber]}),C.year&&s.jsx("span",{className:"text-xs text-gray-500",children:C.year})]}),s.jsx("p",{className:"text-white font-medium truncate",children:C.title}),C.description&&s.jsx("p",{className:"text-gray-400 text-sm mt-0.5 line-clamp-1",children:C.description}),C.groupName&&s.jsxs("p",{className:"text-gray-500 text-xs mt-0.5",children:["Group: ",C.groupName]})]})]},`${C.type}-${C.id}-${D}`))}),R>1&&s.jsxs("div",{className:"flex items-center justify-center gap-3 mt-6",children:[s.jsxs("button",{onClick:()=>d(Math.max(0,c-br)),disabled:c===0,className:"flex items-center gap-1.5 px-3 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:text-gray-600 text-white rounded-lg text-sm",children:[s.jsx(Qg,{className:"h-4 w-4"}),"Previous"]}),s.jsxs("span",{className:"text-sm text-gray-400",children:["Page ",A," of ",R]}),s.jsxs("button",{onClick:()=>d(c+br),disabled:c+br>=N,className:"flex items-center gap-1.5 px-3 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:text-gray-600 text-white rounded-lg text-sm",children:["Next",s.jsx(Va,{className:"h-4 w-4"})]})]})]})]})}const P6="openflix_token";function F0(){return localStorage.getItem(P6)||""}function z_(i){return new Date(i).toLocaleString()}function Y_(i){const e=Date.now()-new Date(i).getTime(),t=Math.floor(e/6e4);if(t<1)return"just now";if(t<60)return`${t}m ago`;const n=Math.floor(t/60);return n<24?`${n}h ago`:`${Math.floor(n/24)}d ago`}async function B6(){const i=await fetch("/admin/updater/status",{headers:{"X-Plex-Token":F0()}});if(!i.ok)throw new Error("Failed to fetch updater status");return i.json()}async function U6(){const i=await fetch("/admin/updater/check",{method:"POST",headers:{"X-Plex-Token":F0()}});if(!i.ok)throw new Error("Failed to check for updates");return i.json()}async function F6(){if(!(await fetch("/admin/updater/apply",{method:"POST",headers:{"X-Plex-Token":F0()}})).ok)throw new Error("Failed to apply update")}function $6(){const i=ft(),[e,t]=P.useState(!1),[n,r]=P.useState(!1),{data:o,isLoading:c,error:d,refetch:h}=qe({queryKey:["updaterStatus"],queryFn:B6}),u=Ve({mutationFn:U6,onSuccess:g=>{i.setQueryData(["updaterStatus"],g)}}),m=Ve({mutationFn:F6,onSuccess:()=>{t(!1),r(!0)}});return c?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx(nt,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):d?s.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[s.jsx(tn,{className:"h-12 w-12 text-red-400"}),s.jsx("h3",{className:"text-lg font-medium text-white",children:"Failed to load updater status"}),s.jsx("p",{className:"text-gray-400 text-sm",children:d.message}),s.jsxs("button",{onClick:()=>h(),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[s.jsx(Et,{className:"h-4 w-4"}),"Retry"]})]}):s.jsxs("div",{children:[s.jsxs("div",{className:"mb-8",children:[s.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[s.jsx(Et,{className:"h-7 w-7 text-indigo-400"}),"Server Updates"]}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Manage OpenFlix server updates"})]}),n&&s.jsx("div",{className:"mb-6 p-4 bg-green-500/10 border border-green-500/30 rounded-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(vs,{className:"h-5 w-5 text-green-400 mt-0.5"}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-green-400",children:"Update applied successfully"}),s.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"The server is restarting with the new version. This page will reload automatically once the server is back online. If it does not reload, try refreshing the page manually."})]})]})}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"p-3 bg-indigo-600/20 rounded-lg",children:s.jsx(Fu,{className:"h-8 w-8 text-indigo-400"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-400",children:"Current Version"}),s.jsx("p",{className:"text-3xl font-bold text-white",children:o?.currentVersion||"Unknown"})]})]}),s.jsxs("button",{onClick:()=>u.mutate(),disabled:u.isPending,className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 text-white rounded-lg",children:[u.isPending?s.jsx(nt,{className:"h-4 w-4 animate-spin"}):s.jsx(Et,{className:"h-4 w-4"}),u.isPending?"Checking...":"Check for Updates"]})]}),o?.lastChecked&&s.jsxs("p",{className:"text-xs text-gray-500 mt-3 flex items-center gap-1.5",children:[s.jsx(Ts,{className:"h-3 w-3"}),"Last checked: ",z_(o.lastChecked)," (",Y_(o.lastChecked),")"]})]}),u.error&&s.jsxs("div",{className:"mb-6 p-3 bg-red-500/10 border border-red-500/30 rounded-lg flex items-center gap-2",children:[s.jsx(tn,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),s.jsx("span",{className:"text-red-400 text-sm",children:u.error.message})]}),m.error&&s.jsxs("div",{className:"mb-6 p-3 bg-red-500/10 border border-red-500/30 rounded-lg flex items-center gap-2",children:[s.jsx(tn,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),s.jsx("span",{className:"text-red-400 text-sm",children:m.error.message})]}),o?.updateAvailable&&o.latestVersion?s.jsxs("div",{className:"bg-gray-800 rounded-xl overflow-hidden mb-6",children:[s.jsx("div",{className:"p-6 border-b border-gray-700",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("div",{className:"flex items-center gap-3 mb-2",children:s.jsx("span",{className:"px-2.5 py-1 bg-green-600/20 text-green-400 border border-green-500/30 rounded-full text-xs font-medium",children:"Update Available"})}),s.jsxs("div",{className:"flex items-center gap-3 text-lg",children:[s.jsx("span",{className:"text-gray-400 font-mono",children:o.currentVersion}),s.jsx(Jm,{className:"h-5 w-5 text-gray-500"}),s.jsx("span",{className:"text-green-400 font-bold font-mono",children:o.latestVersion})]}),o.releaseDate&&s.jsxs("p",{className:"text-xs text-gray-500 mt-2 flex items-center gap-1.5",children:[s.jsx(MS,{className:"h-3 w-3"}),"Released: ",z_(o.releaseDate)]})]}),e?s.jsxs("div",{className:"flex flex-col items-end gap-2",children:[s.jsx("p",{className:"text-xs text-yellow-400",children:"The server will restart during the update."}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:()=>m.mutate(),disabled:m.isPending,className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-green-800 text-white rounded-lg text-sm",children:[m.isPending?s.jsx(nt,{className:"h-4 w-4 animate-spin"}):s.jsx(Os,{className:"h-4 w-4"}),m.isPending?"Applying...":"Confirm Update"]}),s.jsx("button",{onClick:()=>t(!1),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:"Cancel"})]})]}):s.jsxs("button",{onClick:()=>t(!0),className:"flex items-center gap-2 px-5 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium",children:[s.jsx(Os,{className:"h-4 w-4"}),"Update Now"]})]})}),(o.releaseNotes||o.changelog&&o.changelog.length>0)&&s.jsxs("div",{className:"p-6",children:[s.jsxs("h3",{className:"text-sm font-medium text-gray-300 mb-3 flex items-center gap-2",children:[s.jsx(Fn,{className:"h-4 w-4"}),"Release Notes"]}),o.releaseNotes?s.jsx("div",{className:"bg-gray-900 rounded-lg p-4 text-sm text-gray-300 leading-relaxed whitespace-pre-wrap font-mono",children:o.releaseNotes}):o.changelog?s.jsx("ul",{className:"space-y-1.5",children:o.changelog.map((g,x)=>s.jsxs("li",{className:"text-sm text-gray-300 flex items-start gap-2",children:[s.jsx("span",{className:"text-indigo-400 mt-1",children:"-"}),g]},x))}):null]})]}):o&&!o.updateAvailable?s.jsxs("div",{className:"bg-gray-800 rounded-xl p-8 text-center",children:[s.jsx(vs,{className:"h-16 w-16 text-green-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"You're up to date!"}),s.jsxs("p",{className:"text-gray-400",children:["OpenFlix ",o.currentVersion," is the latest version."]}),o.lastChecked&&s.jsxs("p",{className:"text-xs text-gray-500 mt-3",children:["Last checked ",Y_(o.lastChecked)]})]}):null]})}const $0=async(i,e)=>{const t=localStorage.getItem("openflix_token")||"",n=await fetch(i,{...e,headers:{"X-Plex-Token":t,"Content-Type":"application/json",...e?.headers}});if(!n.ok)throw new Error(`API error: ${n.status}`);return n.json()};function G6(){return qe({queryKey:["comskipStatus"],queryFn:()=>$0("/dvr/commercials/status")})}function V6(){return qe({queryKey:["comskipSettings"],queryFn:()=>$0("/dvr/settings")})}function H6(){const i=ft(),{data:e,isLoading:t,error:n}=G6(),{data:r,isLoading:o}=V6(),[c,d]=P.useState(!1),[h,u]=P.useState("comskip"),[m,g]=P.useState("/usr/bin/comskip"),[x,y]=P.useState(50),[v,S]=P.useState("show_prompt"),[N,A]=P.useState(5),[R,C]=P.useState(!1);P.useEffect(()=>{if(r?.settings){const B=r.settings;u(B.detection_method||"comskip"),g(B.comskip_path||"/usr/bin/comskip"),y(B.sensitivity??50),S(B.auto_skip_behavior||"show_prompt"),A(B.skip_prompt_duration??5)}},[r]),P.useEffect(()=>{e&&C(e.enabled)},[e]);const D=Ve({mutationFn:B=>$0("/dvr/settings",{method:"PUT",body:JSON.stringify(B)}),onSuccess:()=>{i.invalidateQueries({queryKey:["comskipSettings"]}),i.invalidateQueries({queryKey:["comskipStatus"]}),d(!0),setTimeout(()=>d(!1),3e3)}}),V=()=>{D.mutate({enabled:R,detection_method:h,comskip_path:m,sensitivity:x,auto_skip_behavior:v,skip_prompt_duration:N})},z=[{file:"Recording_2024_01_15_19_00.ts",segmentsFound:4,processingTime:12.3,status:"completed",timestamp:"2024-01-15T19:45:00Z"},{file:"Recording_2024_01_15_20_00.ts",segmentsFound:6,processingTime:18.7,status:"completed",timestamp:"2024-01-15T20:50:00Z"},{file:"Recording_2024_01_15_21_00.ts",segmentsFound:0,processingTime:8.1,status:"completed",timestamp:"2024-01-15T22:00:00Z"}];return t||o?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx(nt,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):n?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(Ct,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white",children:"Failed to load commercial detection settings"}),s.jsx("p",{className:"text-gray-400 mt-2",children:"Check that the DVR service is running."})]}):s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-8",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx($u,{className:"h-6 w-6 text-indigo-400"}),s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Commercial Skip Settings"})]}),s.jsx("p",{className:"text-gray-400 mt-1",children:"Configure automatic commercial detection and skipping"})]}),s.jsxs("button",{onClick:V,disabled:D.isPending,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg",children:[s.jsx(s0,{className:"h-4 w-4"}),D.isPending?"Saving...":c?"Saved!":"Save Changes"]})]}),s.jsx("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-semibold text-white",children:"Commercial Detection"}),s.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Automatically detect commercial breaks in DVR recordings"})]}),s.jsx("button",{onClick:()=>C(!R),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${R?"bg-green-500/20 text-green-400 hover:bg-green-500/30":"bg-gray-700 text-gray-400 hover:bg-gray-600"}`,children:R?s.jsxs(s.Fragment,{children:[s.jsx(a0,{className:"h-5 w-5"}),"Enabled"]}):s.jsxs(s.Fragment,{children:[s.jsx(i0,{className:"h-5 w-5"}),"Disabled"]})})]})}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx(ig,{className:"h-5 w-5 text-indigo-400"}),s.jsx("h2",{className:"text-lg font-semibold text-white",children:"Detection Configuration"})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Detection Method"}),s.jsxs("select",{value:h,onChange:B=>u(B.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:[s.jsx("option",{value:"comskip",children:"Comskip (External)"}),s.jsx("option",{value:"black_frames",children:"Black Frame Detection"}),s.jsx("option",{value:"hybrid",children:"Hybrid (Comskip + Black Frames)"})]}),s.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[h==="comskip"&&"Uses the external Comskip binary for accurate commercial detection.",h==="black_frames"&&"Detects black frames as commercial boundaries. Less accurate but no external dependency.",h==="hybrid"&&"Combines Comskip output with black frame detection for best results."]})]}),(h==="comskip"||h==="hybrid")&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Comskip Path"}),s.jsx("input",{type:"text",value:m,onChange:B=>g(B.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white font-mono text-sm",placeholder:"/usr/bin/comskip"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Full path to the Comskip binary on the server."})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Detection Sensitivity: ",x,"%"]}),s.jsx("input",{type:"range",min:"0",max:"100",value:x,onChange:B=>y(Number(B.target.value)),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-indigo-600"}),s.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[s.jsx("span",{children:"Less Aggressive (fewer cuts)"}),s.jsx("span",{children:"More Aggressive (more cuts)"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Auto-Skip Behavior"}),s.jsx("div",{className:"space-y-2",children:[{value:"disabled",label:"Disabled",desc:"Show commercial markers but do not skip automatically"},{value:"show_prompt",label:"Show Skip Prompt",desc:'Display a "Skip" button when a commercial is detected'},{value:"skip_immediately",label:"Skip Immediately",desc:"Automatically skip past detected commercials"}].map(B=>s.jsxs("label",{className:`flex items-start gap-3 p-4 rounded-lg border cursor-pointer transition-colors ${v===B.value?"border-indigo-500 bg-indigo-500/10":"border-gray-700 bg-gray-700/50 hover:border-gray-600"}`,children:[s.jsx("input",{type:"radio",name:"autoSkipBehavior",value:B.value,checked:v===B.value,onChange:I=>S(I.target.value),className:"mt-1 accent-indigo-600"}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-white",children:B.label}),s.jsx("div",{className:"text-sm text-gray-400",children:B.desc})]})]},B.value))})]}),v==="show_prompt"&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Skip Prompt Duration (seconds)"}),s.jsx("input",{type:"number",min:"1",max:"30",value:N,onChange:B=>A(Number(B.target.value)),className:"w-32 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"How long the skip button is displayed before auto-dismissing."})]})]})]}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Recent Detection Results"}),z.length===0?s.jsxs("div",{className:"text-center py-8",children:[s.jsx(ig,{className:"h-12 w-12 text-gray-600 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-400",children:"No recent detection results"})]}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-gray-700",children:[s.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-400",children:"File"}),s.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-400",children:"Segments Found"}),s.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-400",children:"Processing Time"}),s.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-400",children:"Status"}),s.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-400",children:"Timestamp"})]})}),s.jsx("tbody",{children:z.map((B,I)=>s.jsxs("tr",{className:"border-b border-gray-700/50 hover:bg-gray-700/30",children:[s.jsx("td",{className:"py-3 px-4 text-sm text-white font-mono",children:B.file}),s.jsx("td",{className:"py-3 px-4 text-sm text-gray-300",children:s.jsx("span",{className:`px-2 py-0.5 rounded ${B.segmentsFound>0?"bg-indigo-500/20 text-indigo-400":"bg-gray-700 text-gray-400"}`,children:B.segmentsFound})}),s.jsxs("td",{className:"py-3 px-4 text-sm text-gray-300",children:[B.processingTime.toFixed(1),"s"]}),s.jsx("td",{className:"py-3 px-4 text-sm",children:s.jsxs("span",{className:"flex items-center gap-1 text-green-400",children:[s.jsx(vs,{className:"h-3.5 w-3.5"}),B.status]})}),s.jsx("td",{className:"py-3 px-4 text-sm text-gray-400",children:new Date(B.timestamp).toLocaleString()})]},I))})]})})]})]})}const _r={"X-Plex-Token":localStorage.getItem("openflix_token")||"","Content-Type":"application/json"},eu=5,W_=[{label:"Welcome",icon:Fu},{label:"Libraries",icon:mn},{label:"Live TV",icon:ss},{label:"DVR",icon:la},{label:"Done",icon:LS}];function K6({current:i,total:e}){return s.jsx("div",{className:"flex items-center justify-center gap-2 mb-8",children:Array.from({length:e}).map((t,n)=>{const r=n+1,o=r<i,c=r===i,d=W_[n].icon;return s.jsxs("div",{className:"flex items-center gap-2",children:[n>0&&s.jsx("div",{className:`h-0.5 w-8 ${o?"bg-green-500":"bg-gray-600"}`}),s.jsxs("div",{className:"flex flex-col items-center gap-1",children:[s.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full border-2 text-sm font-bold transition-colors ${o?"bg-green-500 border-green-500 text-white":c?"bg-indigo-600 border-indigo-600 text-white":"bg-gray-800 border-gray-600 text-gray-400"}`,children:o?s.jsx(vs,{className:"w-5 h-5"}):s.jsx(d,{className:"w-5 h-5"})}),s.jsx("span",{className:`text-xs ${c?"text-indigo-400 font-medium":"text-gray-500"}`,children:W_[n].label})]})]},n)})})}function q6({state:i,onChange:e,needsAdmin:t}){return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center mb-4",children:[s.jsx("h2",{className:"text-2xl font-bold text-white",children:"Welcome to OpenFlix"}),s.jsx("p",{className:"text-gray-400 mt-2",children:"Let's configure your new media server in a few quick steps."})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Server Name"}),s.jsx("input",{type:"text",value:i.serverName,onChange:n=>e({serverName:n.target.value}),placeholder:"My OpenFlix Server",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),t&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"border-t border-gray-700 pt-4",children:s.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Create Admin Account"})}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Username"}),s.jsx("input",{type:"text",value:i.adminUsername,onChange:n=>e({adminUsername:n.target.value}),placeholder:"admin",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email"}),s.jsx("input",{type:"email",value:i.adminEmail,onChange:n=>e({adminEmail:n.target.value}),placeholder:"admin@example.com",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Password"}),s.jsx("input",{type:"password",value:i.adminPassword,onChange:n=>e({adminPassword:n.target.value}),placeholder:"Choose a strong password",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]})]})]})}function z6({state:i,onChange:e}){const[t,n]=P.useState(""),[r,o]=P.useState("movie"),[c,d]=P.useState(""),h=()=>{!t.trim()||!c.trim()||(e({libraries:[...i.libraries,{title:t.trim(),type:r,paths:[c.trim()]}]}),n(""),d(""))},u=m=>{e({libraries:i.libraries.filter((g,x)=>x!==m)})};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center mb-4",children:[s.jsx("h2",{className:"text-2xl font-bold text-white",children:"Media Libraries"}),s.jsx("p",{className:"text-gray-400 mt-2",children:"Add folders containing your movies and TV shows."})]}),i.libraries.length>0&&s.jsx("div",{className:"space-y-3",children:i.libraries.map((m,g)=>s.jsxs("div",{className:"flex items-center justify-between bg-gray-700/50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(mn,{className:"w-5 h-5 text-indigo-400"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-white font-medium",children:m.title}),s.jsxs("p",{className:"text-sm text-gray-400",children:[m.type==="movie"?"Movies":"TV Shows"," "," ",m.paths.join(", ")]})]})]}),s.jsx("button",{onClick:()=>u(g),className:"p-2 text-gray-400 hover:text-red-400 rounded-lg hover:bg-gray-700 transition-colors",children:s.jsx(ts,{className:"w-4 h-4"})})]},g))}),s.jsxs("div",{className:"bg-gray-700/30 rounded-xl p-4 space-y-4 border border-gray-700",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"Add Library"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Title"}),s.jsx("input",{type:"text",value:t,onChange:m=>n(m.target.value),placeholder:"e.g. Movies",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Type"}),s.jsxs("select",{value:r,onChange:m=>o(m.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",children:[s.jsx("option",{value:"movie",children:"Movies"}),s.jsx("option",{value:"show",children:"TV Shows"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Folder Path"}),s.jsx("input",{type:"text",value:c,onChange:m=>d(m.target.value),placeholder:"/media/movies",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),s.jsxs("button",{onClick:h,disabled:!t.trim()||!c.trim(),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-40 disabled:cursor-not-allowed text-white rounded-lg text-sm font-medium transition-colors",children:[s.jsx(rs,{className:"w-4 h-4"}),"Add Library"]})]})]})}function Y6({state:i,onChange:e}){const[t,n]=P.useState(i.m3uSource?.name||""),[r,o]=P.useState(i.m3uSource?.url||""),c=()=>{t.trim()&&r.trim()&&e({m3uSource:{name:t.trim(),url:r.trim()}})},d=()=>{e({m3uSource:void 0}),n(""),o("")};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center mb-4",children:[s.jsx("h2",{className:"text-2xl font-bold text-white",children:"Live TV"}),s.jsx("p",{className:"text-gray-400 mt-2",children:"Optionally add an M3U source for live TV channels. You can skip this and add sources later."})]}),i.m3uSource?s.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-lg p-4 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(vs,{className:"w-5 h-5 text-green-400"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-white font-medium",children:i.m3uSource.name}),s.jsx("p",{className:"text-sm text-gray-400 truncate max-w-md",children:i.m3uSource.url})]})]}),s.jsx("button",{onClick:d,className:"p-2 text-gray-400 hover:text-red-400 rounded-lg hover:bg-gray-700 transition-colors",children:s.jsx(ts,{className:"w-4 h-4"})})]}):s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Source Name"}),s.jsx("input",{type:"text",value:t,onChange:h=>n(h.target.value),placeholder:"My IPTV",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"M3U URL"}),s.jsx("input",{type:"url",value:r,onChange:h=>o(h.target.value),placeholder:"http://example.com/playlist.m3u",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),s.jsxs("button",{onClick:c,disabled:!t.trim()||!r.trim(),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-40 disabled:cursor-not-allowed text-white rounded-lg text-sm font-medium transition-colors",children:[s.jsx(rs,{className:"w-4 h-4"}),"Add M3U Source"]})]}),s.jsx("p",{className:"text-xs text-gray-500 text-center",children:"This step is optional. You can always add or edit Live TV sources from Settings later."})]})}function W6({state:i,onChange:e}){return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center mb-4",children:[s.jsx("h2",{className:"text-2xl font-bold text-white",children:"DVR Settings"}),s.jsx("p",{className:"text-gray-400 mt-2",children:"Configure recording options for your Live TV channels."})]}),s.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[s.jsx("div",{className:`relative w-11 h-6 rounded-full transition-colors ${i.dvrEnabled?"bg-indigo-600":"bg-gray-600"}`,onClick:()=>e({dvrEnabled:!i.dvrEnabled}),children:s.jsx("div",{className:`absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow transition-transform ${i.dvrEnabled?"translate-x-5":""}`})}),s.jsx("span",{className:"text-white font-medium",children:"Enable DVR Recording"})]}),i.dvrEnabled&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Recording Directory"}),s.jsx("input",{type:"text",value:i.recordingDir,onChange:t=>e({recordingDir:t.target.value}),placeholder:"/recordings",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Path where recorded programmes will be saved on disk."})]})]})}function Q6({state:i}){return s.jsxs("div",{className:"space-y-6 text-center",children:[s.jsx("div",{className:"flex justify-center",children:s.jsx("div",{className:"w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center",children:s.jsx(LS,{className:"w-8 h-8 text-green-400"})})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-white",children:"All Set!"}),s.jsx("p",{className:"text-gray-400 mt-2",children:"Your OpenFlix server is ready. Here is a summary of what was configured:"})]}),s.jsxs("div",{className:"bg-gray-700/30 rounded-xl p-5 text-left space-y-3 max-w-md mx-auto",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-gray-400",children:"Server Name"}),s.jsx("span",{className:"text-white font-medium",children:i.serverName||"OpenFlix"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-gray-400",children:"Libraries"}),s.jsxs("span",{className:"text-white font-medium",children:[i.libraries.length," added"]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-gray-400",children:"Live TV Source"}),s.jsx("span",{className:"text-white font-medium",children:i.m3uSource?i.m3uSource.name:"Skipped"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-gray-400",children:"DVR"}),s.jsx("span",{className:"text-white font-medium",children:i.dvrEnabled?"Enabled":"Disabled"})]})]})]})}function X6(){const[i,e]=P.useState({step:1,serverName:"",adminUsername:"",adminEmail:"",adminPassword:"",libraries:[],m3uSource:void 0,dvrEnabled:!1,recordingDir:"/recordings"}),[t,n]=P.useState(!1),[r,o]=P.useState(!0),[c,d]=P.useState(!1),[h,u]=P.useState(null);P.useEffect(()=>{(async()=>{try{const A=await fetch("/api/status",{headers:_r});if(!A.ok)throw new Error("Failed to fetch status");const R=await A.json();e(C=>({...C,serverName:R.server?.name||""})),R.libraries?.count===0&&n(!0)}catch{n(!0)}finally{o(!1)}})()},[]);const m=N=>{e(A=>({...A,...N}))},g=()=>{switch(i.step){case 1:return t?!!i.serverName.trim()&&!!i.adminUsername.trim()&&!!i.adminEmail.trim()&&!!i.adminPassword.trim():!!i.serverName.trim();case 2:return!0;case 3:return!0;case 4:return!i.dvrEnabled||!!i.recordingDir.trim();case 5:return!0;default:return!1}},x=async N=>{u(null),d(!0);try{switch(N){case 1:{if(t){const A=await fetch("/auth/register",{method:"POST",headers:_r,body:JSON.stringify({username:i.adminUsername,email:i.adminEmail,password:i.adminPassword})});if(!A.ok){const C=await A.json().catch(()=>({}));throw new Error(C.error||"Failed to create admin account")}const R=await fetch("/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:i.adminUsername,password:i.adminPassword})});if(R.ok){const C=await R.json();C.authToken&&(localStorage.setItem("openflix_token",C.authToken),_r["X-Plex-Token"]=C.authToken)}}await fetch("/admin/settings",{method:"PUT",headers:_r,body:JSON.stringify({server_name:i.serverName})});break}case 2:{for(const A of i.libraries)await fetch("/admin/libraries",{method:"POST",headers:_r,body:JSON.stringify({title:A.title,type:A.type,paths:A.paths})});break}case 3:{i.m3uSource&&await fetch("/livetv/sources",{method:"POST",headers:_r,body:JSON.stringify({name:i.m3uSource.name,url:i.m3uSource.url})});break}case 4:{i.dvrEnabled&&await fetch("/admin/settings",{method:"PUT",headers:_r,body:JSON.stringify({dvr_enabled:!0,recording_dir:i.recordingDir})});break}}}catch(A){return u(A instanceof Error?A.message:"An error occurred"),d(!1),!1}return d(!1),!0},y=async()=>{i.step<eu&&await x(i.step)&&m({step:i.step+1})},v=()=>{i.step>1&&(m({step:i.step-1}),u(null))},S=()=>{window.location.href="/ui"};return r?s.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:s.jsx(nt,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):s.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-6",children:s.jsxs("div",{className:"w-full max-w-2xl",children:[s.jsx(K6,{current:i.step,total:eu}),s.jsxs("div",{className:"bg-gray-800 rounded-xl p-8 shadow-2xl",children:[i.step===1&&s.jsx(q6,{state:i,onChange:m,needsAdmin:t}),i.step===2&&s.jsx(z6,{state:i,onChange:m}),i.step===3&&s.jsx(Y6,{state:i,onChange:m}),i.step===4&&s.jsx(W6,{state:i,onChange:m}),i.step===5&&s.jsx(Q6,{state:i}),h&&s.jsxs("div",{className:"mt-4 flex items-center gap-2 text-red-400 bg-red-500/10 border border-red-500/30 rounded-lg p-3 text-sm",children:[s.jsx(Ct,{className:"w-4 h-4 flex-shrink-0"}),h]}),s.jsxs("div",{className:"flex items-center justify-between mt-8 pt-6 border-t border-gray-700",children:[i.step>1&&i.step<eu?s.jsxs("button",{onClick:v,className:"flex items-center gap-2 px-5 py-2.5 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors",children:[s.jsx(Yg,{className:"w-4 h-4"}),"Back"]}):s.jsx("div",{}),i.step<eu?s.jsx("button",{onClick:y,disabled:!g()||c,className:"flex items-center gap-2 px-5 py-2.5 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-40 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors",children:c?s.jsx(nt,{className:"w-4 h-4 animate-spin"}):s.jsxs(s.Fragment,{children:[i.step===2&&i.libraries.length===0||i.step===3&&!i.m3uSource?"Skip":"Next",s.jsx(Jm,{className:"w-4 h-4"})]})}):s.jsxs("button",{onClick:S,className:"flex items-center gap-2 px-6 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors",children:["Go to Dashboard",s.jsx(Jm,{className:"w-4 h-4"})]})]})]})]})})}const J6="openflix_token";function _c(){return localStorage.getItem(J6)||""}function Z6(i){if(i===0)return"0 B";const e=1024,t=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(i)/Math.log(e));return`${parseFloat((i/Math.pow(e,n)).toFixed(1))} ${t[n]}`}function eB(i){return new Date(i).toLocaleString()}function tB(i){const e=Date.now()-new Date(i).getTime(),t=Math.floor(e/6e4);if(t<1)return"just now";if(t<60)return`${t}m ago`;const n=Math.floor(t/60);return n<24?`${n}h ago`:`${Math.floor(n/24)}d ago`}async function sB(){const i=await fetch("/admin/backups",{headers:{"X-Plex-Token":_c()}});if(!i.ok)throw new Error("Failed to fetch backups");return i.json()}async function nB(){if(!(await fetch("/admin/backups",{method:"POST",headers:{"X-Plex-Token":_c()}})).ok)throw new Error("Failed to create backup")}async function iB(i){if(!(await fetch(`/admin/backups/${encodeURIComponent(i)}`,{method:"DELETE",headers:{"X-Plex-Token":_c()}})).ok)throw new Error("Failed to delete backup")}async function aB(i){if(!(await fetch(`/admin/backups/${encodeURIComponent(i)}/restore`,{method:"POST",headers:{"X-Plex-Token":_c()}})).ok)throw new Error("Failed to restore backup")}function rB(i){const e=_c(),t=`/admin/backups/${encodeURIComponent(i)}/download?X-Plex-Token=${encodeURIComponent(e)}`,n=document.createElement("a");n.href=t,n.download=i,document.body.appendChild(n),n.click(),document.body.removeChild(n)}function oB(){const i=ft(),[e,t]=P.useState(null),[n,r]=P.useState(null),[o,c]=P.useState(null),{data:d,isLoading:h,error:u,refetch:m}=qe({queryKey:["backups"],queryFn:sB}),g=Ve({mutationFn:nB,onSuccess:()=>{i.invalidateQueries({queryKey:["backups"]}),c("Backup created successfully"),setTimeout(()=>c(null),4e3)}}),x=Ve({mutationFn:iB,onSuccess:()=>{i.invalidateQueries({queryKey:["backups"]}),r(null),c("Backup deleted"),setTimeout(()=>c(null),4e3)}}),y=Ve({mutationFn:aB,onSuccess:()=>{i.invalidateQueries({queryKey:["backups"]}),t(null),c("Backup restored successfully. You may need to restart the server."),setTimeout(()=>c(null),8e3)}}),v=d?.backups||[];return h?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx(nt,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):u?s.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[s.jsx(tn,{className:"h-12 w-12 text-red-400"}),s.jsx("h3",{className:"text-lg font-medium text-white",children:"Failed to load backups"}),s.jsx("p",{className:"text-gray-400 text-sm",children:u.message}),s.jsxs("button",{onClick:()=>m(),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[s.jsx(Et,{className:"h-4 w-4"}),"Retry"]})]}):s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-8",children:[s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[s.jsx(qv,{className:"h-7 w-7 text-indigo-400"}),"Backups"]}),s.jsxs("p",{className:"text-gray-400 mt-1",children:[v.length," backup",v.length!==1?"s":""," available"]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("button",{onClick:()=>m(),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:[s.jsx(Et,{className:"h-4 w-4"}),"Refresh"]}),s.jsxs("button",{onClick:()=>g.mutate(),disabled:g.isPending,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg text-sm",children:[g.isPending?s.jsx(nt,{className:"h-4 w-4 animate-spin"}):s.jsx(rs,{className:"h-4 w-4"}),g.isPending?"Creating...":"Create Backup"]})]})]}),o&&s.jsxs("div",{className:"mb-6 p-3 bg-green-500/10 border border-green-500/30 rounded-lg flex items-center gap-2",children:[s.jsx(vs,{className:"h-4 w-4 text-green-400 flex-shrink-0"}),s.jsx("span",{className:"text-green-400 text-sm",children:o})]}),(g.error||x.error||y.error)&&s.jsxs("div",{className:"mb-6 p-3 bg-red-500/10 border border-red-500/30 rounded-lg flex items-center gap-2",children:[s.jsx(tn,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),s.jsx("span",{className:"text-red-400 text-sm",children:g.error?.message||x.error?.message||y.error?.message})]}),e&&s.jsx("div",{className:"mb-6 p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(tn,{className:"h-5 w-5 text-yellow-400 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-medium text-yellow-400",children:"Restore backup?"}),s.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["This will restore the database from ",s.jsx("span",{className:"font-mono text-gray-300",children:e}),". The current database will be overwritten. The server may restart after restore."]}),s.jsxs("div",{className:"flex gap-2 mt-3",children:[s.jsxs("button",{onClick:()=>y.mutate(e),disabled:y.isPending,className:"flex items-center gap-1.5 px-3 py-1.5 bg-yellow-600 hover:bg-yellow-700 disabled:bg-yellow-800 text-white text-sm rounded-lg",children:[y.isPending?s.jsx(nt,{className:"h-3.5 w-3.5 animate-spin"}):s.jsx(ng,{className:"h-3.5 w-3.5"}),y.isPending?"Restoring...":"Yes, Restore"]}),s.jsx("button",{onClick:()=>t(null),className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded-lg",children:"Cancel"})]})]})]})}),v.length===0?s.jsxs("div",{className:"flex flex-col items-center justify-center h-64 bg-gray-800 rounded-xl",children:[s.jsx(qv,{className:"h-16 w-16 text-gray-600 mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No backups yet"}),s.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Create your first backup to protect your configuration"}),s.jsxs("button",{onClick:()=>g.mutate(),disabled:g.isPending,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[s.jsx(rs,{className:"h-4 w-4"}),"Create Backup"]})]}):s.jsx("div",{className:"space-y-3",children:v.map(S=>s.jsxs("div",{className:"bg-gray-800 rounded-xl p-5 flex items-center gap-4 hover:bg-gray-750 transition-colors",children:[s.jsx("div",{className:"p-3 bg-indigo-600/20 rounded-lg flex-shrink-0",children:s.jsx(Fn,{className:"h-6 w-6 text-indigo-400"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-white font-medium truncate",children:S.filename}),s.jsxs("div",{className:"flex items-center gap-4 mt-1 text-xs text-gray-400",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Ts,{className:"h-3 w-3"}),eB(S.createdAt),s.jsxs("span",{className:"text-gray-500",children:["(",tB(S.createdAt),")"]})]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Li,{className:"h-3 w-3"}),Z6(S.size)]}),S.version&&s.jsxs("span",{className:"text-gray-500",children:["v",S.version]})]})]}),s.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[s.jsxs("button",{onClick:()=>rB(S.filename),className:"flex items-center gap-1.5 px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-xs",title:"Download",children:[s.jsx(Os,{className:"h-3.5 w-3.5"}),"Download"]}),s.jsxs("button",{onClick:()=>t(S.filename),className:"flex items-center gap-1.5 px-3 py-1.5 bg-yellow-600/20 hover:bg-yellow-600/30 text-yellow-400 border border-yellow-500/30 rounded-lg text-xs",title:"Restore",children:[s.jsx(ng,{className:"h-3.5 w-3.5"}),"Restore"]}),n===S.filename?s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:()=>x.mutate(S.filename),disabled:x.isPending,className:"px-2 py-1.5 bg-red-600 hover:bg-red-700 text-white rounded-lg text-xs",children:x.isPending?"...":"Confirm"}),s.jsx("button",{onClick:()=>r(null),className:"px-2 py-1.5 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-xs",children:"Cancel"})]}):s.jsxs("button",{onClick:()=>r(S.filename),className:"flex items-center gap-1.5 px-3 py-1.5 bg-red-600/20 hover:bg-red-600/30 text-red-400 border border-red-500/30 rounded-lg text-xs",title:"Delete",children:[s.jsx(ts,{className:"h-3.5 w-3.5"}),"Delete"]})]})]},S.filename))})]})}const lB="openflix_token";function Ju(){return localStorage.getItem(lB)||""}function Gm(i){if(i===0)return"0 B";const e=1024,t=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(i)/Math.log(e));return`${parseFloat((i/Math.pow(e,n)).toFixed(1))} ${t[n]}`}function cB(i){return new Date(i).toLocaleString()}function dB(i){if(!i)return"--";const e=Math.floor(i/60),t=i%60;return e>0?`${e}h ${t}m`:`${t}m`}async function uB(){const i=await fetch("/dvr/v2/trash",{headers:{"X-Plex-Token":Ju()}});if(!i.ok)throw new Error("Failed to fetch trash");return i.json()}async function hB(i){if(!(await fetch(`/dvr/v2/trash/${i}/restore`,{method:"POST",headers:{"X-Plex-Token":Ju()}})).ok)throw new Error("Failed to restore item")}async function fB(i){if(!(await fetch(`/dvr/v2/trash/${i}`,{method:"DELETE",headers:{"X-Plex-Token":Ju()}})).ok)throw new Error("Failed to delete item")}async function mB(){if(!(await fetch("/dvr/v2/trash",{method:"DELETE",headers:{"X-Plex-Token":Ju()}})).ok)throw new Error("Failed to empty trash")}function gB(){const i=ft(),[e,t]=P.useState(!1),[n,r]=P.useState(null),{data:o,isLoading:c,error:d,refetch:h}=qe({queryKey:["trash"],queryFn:uB}),u=Ve({mutationFn:hB,onSuccess:()=>{i.invalidateQueries({queryKey:["trash"]})}}),m=Ve({mutationFn:fB,onSuccess:()=>{i.invalidateQueries({queryKey:["trash"]}),r(null)}}),g=Ve({mutationFn:mB,onSuccess:()=>{i.invalidateQueries({queryKey:["trash"]}),t(!1)}}),x=o?.items||[],y=x.reduce((v,S)=>v+(S.fileSize||0),0);return c?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx(nt,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):d?s.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[s.jsx(tn,{className:"h-12 w-12 text-red-400"}),s.jsx("h3",{className:"text-lg font-medium text-white",children:"Failed to load trash"}),s.jsx("p",{className:"text-gray-400 text-sm",children:d.message}),s.jsxs("button",{onClick:()=>h(),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[s.jsx(Et,{className:"h-4 w-4"}),"Retry"]})]}):s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-8",children:[s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[s.jsx(ts,{className:"h-7 w-7 text-red-400"}),"Trash"]}),s.jsxs("p",{className:"text-gray-400 mt-1",children:[x.length," item",x.length!==1?"s":""," in trash",y>0&&` (${Gm(y)} total)`]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("button",{onClick:()=>h(),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:[s.jsx(Et,{className:"h-4 w-4"}),"Refresh"]}),x.length>0&&s.jsxs("button",{onClick:()=>t(!0),disabled:g.isPending,className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 disabled:bg-red-800 text-white rounded-lg text-sm",children:[s.jsx(ts,{className:"h-4 w-4"}),g.isPending?"Emptying...":"Empty Trash"]})]})]}),e&&s.jsx("div",{className:"mb-6 p-4 bg-red-500/10 border border-red-500/30 rounded-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(tn,{className:"h-5 w-5 text-red-400 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-medium text-red-400",children:"Permanently delete all items?"}),s.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["This will permanently delete ",x.length," item",x.length!==1?"s":""," (",Gm(y),"). This action cannot be undone."]}),s.jsxs("div",{className:"flex gap-2 mt-3",children:[s.jsx("button",{onClick:()=>g.mutate(),disabled:g.isPending,className:"px-3 py-1.5 bg-red-600 hover:bg-red-700 disabled:bg-red-800 text-white text-sm rounded-lg",children:g.isPending?"Deleting...":"Yes, Delete All"}),s.jsx("button",{onClick:()=>t(!1),className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded-lg",children:"Cancel"})]})]})]})}),x.length===0?s.jsxs("div",{className:"flex flex-col items-center justify-center h-64 bg-gray-800 rounded-xl",children:[s.jsx(ts,{className:"h-16 w-16 text-gray-600 mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Trash is empty"}),s.jsx("p",{className:"text-gray-400 text-sm",children:"Deleted DVR recordings will appear here"})]}):s.jsx("div",{className:"bg-gray-800 rounded-xl overflow-hidden",children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"text-left text-sm text-gray-400 border-b border-gray-700",children:[s.jsx("th",{className:"px-6 py-4 font-medium",children:"Title"}),s.jsx("th",{className:"px-6 py-4 font-medium",children:"Channel"}),s.jsx("th",{className:"px-6 py-4 font-medium",children:"Duration"}),s.jsx("th",{className:"px-6 py-4 font-medium",children:"Size"}),s.jsx("th",{className:"px-6 py-4 font-medium",children:"Deleted"}),s.jsx("th",{className:"px-6 py-4 font-medium text-right",children:"Actions"})]})}),s.jsx("tbody",{className:"text-sm",children:x.map(v=>s.jsxs("tr",{className:"border-b border-gray-700/50 hover:bg-gray-700/30 transition-colors",children:[s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Fn,{className:"h-5 w-5 text-gray-500 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-white font-medium",children:v.title}),v.description&&s.jsx("p",{className:"text-gray-500 text-xs mt-0.5 line-clamp-1 max-w-xs",children:v.description})]})]})}),s.jsx("td",{className:"px-6 py-4 text-gray-300",children:v.channelName||"--"}),s.jsx("td",{className:"px-6 py-4 text-gray-300",children:dB(v.duration)}),s.jsx("td",{className:"px-6 py-4 text-gray-300",children:s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(Li,{className:"h-3.5 w-3.5 text-gray-500"}),v.fileSize?Gm(v.fileSize):"--"]})}),s.jsx("td",{className:"px-6 py-4 text-gray-400 text-xs",children:cB(v.deletedAt)}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.jsxs("button",{onClick:()=>u.mutate(v.id),disabled:u.isPending,className:"flex items-center gap-1.5 px-3 py-1.5 bg-green-600/20 hover:bg-green-600/30 text-green-400 border border-green-500/30 rounded-lg text-xs",title:"Restore",children:[s.jsx(ng,{className:"h-3.5 w-3.5"}),"Restore"]}),n===v.id?s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:()=>m.mutate(v.id),disabled:m.isPending,className:"px-2 py-1.5 bg-red-600 hover:bg-red-700 text-white rounded-lg text-xs",children:m.isPending?"Deleting...":"Confirm"}),s.jsx("button",{onClick:()=>r(null),className:"px-2 py-1.5 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-xs",children:"Cancel"})]}):s.jsxs("button",{onClick:()=>r(v.id),className:"flex items-center gap-1.5 px-3 py-1.5 bg-red-600/20 hover:bg-red-600/30 text-red-400 border border-red-500/30 rounded-lg text-xs",title:"Delete Permanently",children:[s.jsx(ts,{className:"h-3.5 w-3.5"}),"Delete"]})]})})]},v.id))})]})})}),u.error&&s.jsxs("div",{className:"mt-4 p-3 bg-red-500/10 border border-red-500/30 rounded-lg flex items-center gap-2",children:[s.jsx(tn,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),s.jsxs("span",{className:"text-red-400 text-sm",children:["Failed to restore: ",u.error.message]})]}),m.error&&s.jsxs("div",{className:"mt-4 p-3 bg-red-500/10 border border-red-500/30 rounded-lg flex items-center gap-2",children:[s.jsx(tn,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),s.jsxs("span",{className:"text-red-400 text-sm",children:["Failed to delete: ",m.error.message]})]}),g.error&&s.jsxs("div",{className:"mt-4 p-3 bg-red-500/10 border border-red-500/30 rounded-lg flex items-center gap-2",children:[s.jsx(tn,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),s.jsxs("span",{className:"text-red-400 text-sm",children:["Failed to empty trash: ",g.error.message]})]})]})}const pB=new cA({defaultOptions:{queries:{staleTime:3e4,retry:1}}});function xB({children:i}){return Re.isAuthenticated()?s.jsx(s.Fragment,{children:i}):s.jsx(rS,{to:"/ui/login",replace:!0})}function yB(){return s.jsx(dA,{client:pB,children:s.jsx(L2,{children:s.jsxs(l2,{children:[s.jsx(Pt,{path:"/ui/login",element:s.jsx(ak,{})}),s.jsxs(Pt,{path:"/ui",element:s.jsx(xB,{children:s.jsx(ik,{})}),children:[s.jsx(Pt,{index:!0,element:s.jsx(jk,{})}),s.jsx(Pt,{path:"users",element:s.jsx(Lk,{})}),s.jsx(Pt,{path:"libraries",element:s.jsx(Uk,{})}),s.jsx(Pt,{path:"media",element:s.jsx(Fk,{})}),s.jsx(Pt,{path:"livetv",element:s.jsx(V4,{})}),s.jsx(Pt,{path:"livetv/epg-editor",element:s.jsx(H4,{})}),s.jsx(Pt,{path:"tvguide",element:s.jsx(ZO,{})}),s.jsx(Pt,{path:"onlater",element:s.jsx(a5,{})}),s.jsx(Pt,{path:"teampass",element:s.jsx(o5,{})}),s.jsx(Pt,{path:"dvr",element:s.jsx(_5,{})}),s.jsx(Pt,{path:"vod",element:s.jsx(T5,{})}),s.jsx(Pt,{path:"transcode",element:s.jsx(k5,{})}),s.jsx(Pt,{path:"logs",element:s.jsx(O5,{})}),s.jsx(Pt,{path:"settings",element:s.jsx(G5,{})}),s.jsx(Pt,{path:"downloads",element:s.jsx(eP,{})}),s.jsx(Pt,{path:"tuners",element:s.jsx(iP,{})}),s.jsx(Pt,{path:"channel-collections",element:s.jsx(mP,{})}),s.jsx(Pt,{path:"artwork",element:s.jsx(yP,{})}),s.jsx(Pt,{path:"collections",element:s.jsx(IP,{})}),s.jsx(Pt,{path:"upload",element:s.jsx(UP,{})}),s.jsx(Pt,{path:"connections",element:s.jsx(zP,{})}),s.jsx(Pt,{path:"diagnostics",element:s.jsx(ZP,{})}),s.jsx(Pt,{path:"speedtest",element:s.jsx(i6,{})}),s.jsx(Pt,{path:"jobs",element:s.jsx(h6,{})}),s.jsx(Pt,{path:"virtual-channels",element:s.jsx(N6,{})}),s.jsx(Pt,{path:"segments",element:s.jsx(R6,{})}),s.jsx(Pt,{path:"search",element:s.jsx(O6,{})}),s.jsx(Pt,{path:"updater",element:s.jsx($6,{})}),s.jsx(Pt,{path:"comskip",element:s.jsx(H6,{})}),s.jsx(Pt,{path:"setup",element:s.jsx(X6,{})}),s.jsx(Pt,{path:"backups",element:s.jsx(oB,{})}),s.jsx(Pt,{path:"trash",element:s.jsx(gB,{})})]}),s.jsx(Pt,{path:"*",element:s.jsx(rS,{to:"/ui",replace:!0})})]})})})}fT.createRoot(document.getElementById("root")).render(s.jsx(P.StrictMode,{children:s.jsx(yB,{})}));
