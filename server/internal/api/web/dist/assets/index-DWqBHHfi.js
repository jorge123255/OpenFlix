(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function t(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(a){if(a.ep)return;a.ep=!0;const l=t(a);fetch(a.href,l)}})();function H_(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Af={exports:{}},Nl={};var Sx;function QT(){if(Sx)return Nl;Sx=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,a,l){var c=null;if(l!==void 0&&(c=""+l),a.key!==void 0&&(c=""+a.key),"key"in a){l={};for(var u in a)u!=="key"&&(l[u]=a[u])}else l=a;return a=l.ref,{$$typeof:i,type:s,key:c,ref:a!==void 0?a:null,props:l}}return Nl.Fragment=e,Nl.jsx=t,Nl.jsxs=t,Nl}var Ex;function ZT(){return Ex||(Ex=1,Af.exports=QT()),Af.exports}var r=ZT(),wf={exports:{}},xt={};var Tx;function JT(){if(Tx)return xt;Tx=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),y=Symbol.iterator;function x($){return $===null||typeof $!="object"?null:($=y&&$[y]||$["@@iterator"],typeof $=="function"?$:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,A={};function R($,X,me){this.props=$,this.context=X,this.refs=A,this.updater=me||v}R.prototype.isReactComponent={},R.prototype.setState=function($,X){if(typeof $!="object"&&typeof $!="function"&&$!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,$,X,"setState")},R.prototype.forceUpdate=function($){this.updater.enqueueForceUpdate(this,$,"forceUpdate")};function D(){}D.prototype=R.prototype;function L($,X,me){this.props=$,this.context=X,this.refs=A,this.updater=me||v}var O=L.prototype=new D;O.constructor=L,E(O,R.prototype),O.isPureReactComponent=!0;var H=Array.isArray;function q(){}var U={H:null,A:null,T:null,S:null},k=Object.prototype.hasOwnProperty;function M($,X,me){var ve=me.ref;return{$$typeof:i,type:$,key:X,ref:ve!==void 0?ve:null,props:me}}function I($,X){return M($.type,X,$.props)}function j($){return typeof $=="object"&&$!==null&&$.$$typeof===i}function Z($){var X={"=":"=0",":":"=2"};return"$"+$.replace(/[=:]/g,function(me){return X[me]})}var ae=/\/+/g;function ie($,X){return typeof $=="object"&&$!==null&&$.key!=null?Z(""+$.key):X.toString(36)}function re($){switch($.status){case"fulfilled":return $.value;case"rejected":throw $.reason;default:switch(typeof $.status=="string"?$.then(q,q):($.status="pending",$.then(function(X){$.status==="pending"&&($.status="fulfilled",$.value=X)},function(X){$.status==="pending"&&($.status="rejected",$.reason=X)})),$.status){case"fulfilled":return $.value;case"rejected":throw $.reason}}throw $}function Q($,X,me,ve,pe){var ge=typeof $;(ge==="undefined"||ge==="boolean")&&($=null);var ee=!1;if($===null)ee=!0;else switch(ge){case"bigint":case"string":case"number":ee=!0;break;case"object":switch($.$$typeof){case i:case e:ee=!0;break;case m:return ee=$._init,Q(ee($._payload),X,me,ve,pe)}}if(ee)return pe=pe($),ee=ve===""?"."+ie($,0):ve,H(pe)?(me="",ee!=null&&(me=ee.replace(ae,"$&/")+"/"),Q(pe,X,me,"",function(Ue){return Ue})):pe!=null&&(j(pe)&&(pe=I(pe,me+(pe.key==null||$&&$.key===pe.key?"":(""+pe.key).replace(ae,"$&/")+"/")+ee)),X.push(pe)),1;ee=0;var ye=ve===""?".":ve+":";if(H($))for(var Ie=0;Ie<$.length;Ie++)ve=$[Ie],ge=ye+ie(ve,Ie),ee+=Q(ve,X,me,ge,pe);else if(Ie=x($),typeof Ie=="function")for($=Ie.call($),Ie=0;!(ve=$.next()).done;)ve=ve.value,ge=ye+ie(ve,Ie++),ee+=Q(ve,X,me,ge,pe);else if(ge==="object"){if(typeof $.then=="function")return Q(re($),X,me,ve,pe);throw X=String($),Error("Objects are not valid as a React child (found: "+(X==="[object Object]"?"object with keys {"+Object.keys($).join(", ")+"}":X)+"). If you meant to render a collection of children, use an array instead.")}return ee}function se($,X,me){if($==null)return $;var ve=[],pe=0;return Q($,ve,"","",function(ge){return X.call(me,ge,pe++)}),ve}function oe($){if($._status===-1){var X=$._result;X=X(),X.then(function(me){($._status===0||$._status===-1)&&($._status=1,$._result=me)},function(me){($._status===0||$._status===-1)&&($._status=2,$._result=me)}),$._status===-1&&($._status=0,$._result=X)}if($._status===1)return $._result.default;throw $._result}var Y=typeof reportError=="function"?reportError:function($){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var X=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof $=="object"&&$!==null&&typeof $.message=="string"?String($.message):String($),error:$});if(!window.dispatchEvent(X))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",$);return}console.error($)},V={map:se,forEach:function($,X,me){se($,function(){X.apply(this,arguments)},me)},count:function($){var X=0;return se($,function(){X++}),X},toArray:function($){return se($,function(X){return X})||[]},only:function($){if(!j($))throw Error("React.Children.only expected to receive a single React element child.");return $}};return xt.Activity=g,xt.Children=V,xt.Component=R,xt.Fragment=t,xt.Profiler=a,xt.PureComponent=L,xt.StrictMode=s,xt.Suspense=f,xt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=U,xt.__COMPILER_RUNTIME={__proto__:null,c:function($){return U.H.useMemoCache($)}},xt.cache=function($){return function(){return $.apply(null,arguments)}},xt.cacheSignal=function(){return null},xt.cloneElement=function($,X,me){if($==null)throw Error("The argument must be a React element, but you passed "+$+".");var ve=E({},$.props),pe=$.key;if(X!=null)for(ge in X.key!==void 0&&(pe=""+X.key),X)!k.call(X,ge)||ge==="key"||ge==="__self"||ge==="__source"||ge==="ref"&&X.ref===void 0||(ve[ge]=X[ge]);var ge=arguments.length-2;if(ge===1)ve.children=me;else if(1<ge){for(var ee=Array(ge),ye=0;ye<ge;ye++)ee[ye]=arguments[ye+2];ve.children=ee}return M($.type,pe,ve)},xt.createContext=function($){return $={$$typeof:c,_currentValue:$,_currentValue2:$,_threadCount:0,Provider:null,Consumer:null},$.Provider=$,$.Consumer={$$typeof:l,_context:$},$},xt.createElement=function($,X,me){var ve,pe={},ge=null;if(X!=null)for(ve in X.key!==void 0&&(ge=""+X.key),X)k.call(X,ve)&&ve!=="key"&&ve!=="__self"&&ve!=="__source"&&(pe[ve]=X[ve]);var ee=arguments.length-2;if(ee===1)pe.children=me;else if(1<ee){for(var ye=Array(ee),Ie=0;Ie<ee;Ie++)ye[Ie]=arguments[Ie+2];pe.children=ye}if($&&$.defaultProps)for(ve in ee=$.defaultProps,ee)pe[ve]===void 0&&(pe[ve]=ee[ve]);return M($,ge,pe)},xt.createRef=function(){return{current:null}},xt.forwardRef=function($){return{$$typeof:u,render:$}},xt.isValidElement=j,xt.lazy=function($){return{$$typeof:m,_payload:{_status:-1,_result:$},_init:oe}},xt.memo=function($,X){return{$$typeof:d,type:$,compare:X===void 0?null:X}},xt.startTransition=function($){var X=U.T,me={};U.T=me;try{var ve=$(),pe=U.S;pe!==null&&pe(me,ve),typeof ve=="object"&&ve!==null&&typeof ve.then=="function"&&ve.then(q,Y)}catch(ge){Y(ge)}finally{X!==null&&me.types!==null&&(X.types=me.types),U.T=X}},xt.unstable_useCacheRefresh=function(){return U.H.useCacheRefresh()},xt.use=function($){return U.H.use($)},xt.useActionState=function($,X,me){return U.H.useActionState($,X,me)},xt.useCallback=function($,X){return U.H.useCallback($,X)},xt.useContext=function($){return U.H.useContext($)},xt.useDebugValue=function(){},xt.useDeferredValue=function($,X){return U.H.useDeferredValue($,X)},xt.useEffect=function($,X){return U.H.useEffect($,X)},xt.useEffectEvent=function($){return U.H.useEffectEvent($)},xt.useId=function(){return U.H.useId()},xt.useImperativeHandle=function($,X,me){return U.H.useImperativeHandle($,X,me)},xt.useInsertionEffect=function($,X){return U.H.useInsertionEffect($,X)},xt.useLayoutEffect=function($,X){return U.H.useLayoutEffect($,X)},xt.useMemo=function($,X){return U.H.useMemo($,X)},xt.useOptimistic=function($,X){return U.H.useOptimistic($,X)},xt.useReducer=function($,X,me){return U.H.useReducer($,X,me)},xt.useRef=function($){return U.H.useRef($)},xt.useState=function($){return U.H.useState($)},xt.useSyncExternalStore=function($,X,me){return U.H.useSyncExternalStore($,X,me)},xt.useTransition=function(){return U.H.useTransition()},xt.version="19.2.3",xt}var Ax;function zm(){return Ax||(Ax=1,wf.exports=JT()),wf.exports}var K=zm();const Ds=H_(K);var Nf={exports:{}},Rl={},Rf={exports:{}},Cf={};var wx;function eA(){return wx||(wx=1,(function(i){function e(Q,se){var oe=Q.length;Q.push(se);e:for(;0<oe;){var Y=oe-1>>>1,V=Q[Y];if(0<a(V,se))Q[Y]=se,Q[oe]=V,oe=Y;else break e}}function t(Q){return Q.length===0?null:Q[0]}function s(Q){if(Q.length===0)return null;var se=Q[0],oe=Q.pop();if(oe!==se){Q[0]=oe;e:for(var Y=0,V=Q.length,$=V>>>1;Y<$;){var X=2*(Y+1)-1,me=Q[X],ve=X+1,pe=Q[ve];if(0>a(me,oe))ve<V&&0>a(pe,me)?(Q[Y]=pe,Q[ve]=oe,Y=ve):(Q[Y]=me,Q[X]=oe,Y=X);else if(ve<V&&0>a(pe,oe))Q[Y]=pe,Q[ve]=oe,Y=ve;else break e}}return se}function a(Q,se){var oe=Q.sortIndex-se.sortIndex;return oe!==0?oe:Q.id-se.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;i.unstable_now=function(){return l.now()}}else{var c=Date,u=c.now();i.unstable_now=function(){return c.now()-u}}var f=[],d=[],m=1,g=null,y=3,x=!1,v=!1,E=!1,A=!1,R=typeof setTimeout=="function"?setTimeout:null,D=typeof clearTimeout=="function"?clearTimeout:null,L=typeof setImmediate<"u"?setImmediate:null;function O(Q){for(var se=t(d);se!==null;){if(se.callback===null)s(d);else if(se.startTime<=Q)s(d),se.sortIndex=se.expirationTime,e(f,se);else break;se=t(d)}}function H(Q){if(E=!1,O(Q),!v)if(t(f)!==null)v=!0,q||(q=!0,Z());else{var se=t(d);se!==null&&re(H,se.startTime-Q)}}var q=!1,U=-1,k=5,M=-1;function I(){return A?!0:!(i.unstable_now()-M<k)}function j(){if(A=!1,q){var Q=i.unstable_now();M=Q;var se=!0;try{e:{v=!1,E&&(E=!1,D(U),U=-1),x=!0;var oe=y;try{t:{for(O(Q),g=t(f);g!==null&&!(g.expirationTime>Q&&I());){var Y=g.callback;if(typeof Y=="function"){g.callback=null,y=g.priorityLevel;var V=Y(g.expirationTime<=Q);if(Q=i.unstable_now(),typeof V=="function"){g.callback=V,O(Q),se=!0;break t}g===t(f)&&s(f),O(Q)}else s(f);g=t(f)}if(g!==null)se=!0;else{var $=t(d);$!==null&&re(H,$.startTime-Q),se=!1}}break e}finally{g=null,y=oe,x=!1}se=void 0}}finally{se?Z():q=!1}}}var Z;if(typeof L=="function")Z=function(){L(j)};else if(typeof MessageChannel<"u"){var ae=new MessageChannel,ie=ae.port2;ae.port1.onmessage=j,Z=function(){ie.postMessage(null)}}else Z=function(){R(j,0)};function re(Q,se){U=R(function(){Q(i.unstable_now())},se)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(Q){Q.callback=null},i.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<Q?Math.floor(1e3/Q):5},i.unstable_getCurrentPriorityLevel=function(){return y},i.unstable_next=function(Q){switch(y){case 1:case 2:case 3:var se=3;break;default:se=y}var oe=y;y=se;try{return Q()}finally{y=oe}},i.unstable_requestPaint=function(){A=!0},i.unstable_runWithPriority=function(Q,se){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var oe=y;y=Q;try{return se()}finally{y=oe}},i.unstable_scheduleCallback=function(Q,se,oe){var Y=i.unstable_now();switch(typeof oe=="object"&&oe!==null?(oe=oe.delay,oe=typeof oe=="number"&&0<oe?Y+oe:Y):oe=Y,Q){case 1:var V=-1;break;case 2:V=250;break;case 5:V=1073741823;break;case 4:V=1e4;break;default:V=5e3}return V=oe+V,Q={id:m++,callback:se,priorityLevel:Q,startTime:oe,expirationTime:V,sortIndex:-1},oe>Y?(Q.sortIndex=oe,e(d,Q),t(f)===null&&Q===t(d)&&(E?(D(U),U=-1):E=!0,re(H,oe-Y))):(Q.sortIndex=V,e(f,Q),v||x||(v=!0,q||(q=!0,Z()))),Q},i.unstable_shouldYield=I,i.unstable_wrapCallback=function(Q){var se=y;return function(){var oe=y;y=se;try{return Q.apply(this,arguments)}finally{y=oe}}}})(Cf)),Cf}var Nx;function tA(){return Nx||(Nx=1,Rf.exports=eA()),Rf.exports}var Lf={exports:{}},qs={};var Rx;function sA(){if(Rx)return qs;Rx=1;var i=zm();function e(f){var d="https://react.dev/errors/"+f;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)d+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+f+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},a=Symbol.for("react.portal");function l(f,d,m){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:g==null?null:""+g,children:f,containerInfo:d,implementation:m}}var c=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(f,d){if(f==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return qs.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,qs.createPortal=function(f,d){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return l(f,d,null,m)},qs.flushSync=function(f){var d=c.T,m=s.p;try{if(c.T=null,s.p=2,f)return f()}finally{c.T=d,s.p=m,s.d.f()}},qs.preconnect=function(f,d){typeof f=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,s.d.C(f,d))},qs.prefetchDNS=function(f){typeof f=="string"&&s.d.D(f)},qs.preinit=function(f,d){if(typeof f=="string"&&d&&typeof d.as=="string"){var m=d.as,g=u(m,d.crossOrigin),y=typeof d.integrity=="string"?d.integrity:void 0,x=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;m==="style"?s.d.S(f,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:g,integrity:y,fetchPriority:x}):m==="script"&&s.d.X(f,{crossOrigin:g,integrity:y,fetchPriority:x,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},qs.preinitModule=function(f,d){if(typeof f=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var m=u(d.as,d.crossOrigin);s.d.M(f,{crossOrigin:m,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&s.d.M(f)},qs.preload=function(f,d){if(typeof f=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var m=d.as,g=u(m,d.crossOrigin);s.d.L(f,m,{crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},qs.preloadModule=function(f,d){if(typeof f=="string")if(d){var m=u(d.as,d.crossOrigin);s.d.m(f,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:m,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else s.d.m(f)},qs.requestFormReset=function(f){s.d.r(f)},qs.unstable_batchedUpdates=function(f,d){return f(d)},qs.useFormState=function(f,d,m){return c.H.useFormState(f,d,m)},qs.useFormStatus=function(){return c.H.useHostTransitionStatus()},qs.version="19.2.3",qs}var Cx;function iA(){if(Cx)return Lf.exports;Cx=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),Lf.exports=sA(),Lf.exports}var Lx;function nA(){if(Lx)return Rl;Lx=1;var i=tA(),e=zm(),t=iA();function s(n){var o="https://react.dev/errors/"+n;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)o+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+n+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function l(n){var o=n,h=n;if(n.alternate)for(;o.return;)o=o.return;else{n=o;do o=n,(o.flags&4098)!==0&&(h=o.return),n=o.return;while(n)}return o.tag===3?h:null}function c(n){if(n.tag===13){var o=n.memoizedState;if(o===null&&(n=n.alternate,n!==null&&(o=n.memoizedState)),o!==null)return o.dehydrated}return null}function u(n){if(n.tag===31){var o=n.memoizedState;if(o===null&&(n=n.alternate,n!==null&&(o=n.memoizedState)),o!==null)return o.dehydrated}return null}function f(n){if(l(n)!==n)throw Error(s(188))}function d(n){var o=n.alternate;if(!o){if(o=l(n),o===null)throw Error(s(188));return o!==n?null:n}for(var h=n,p=o;;){var b=h.return;if(b===null)break;var T=b.alternate;if(T===null){if(p=b.return,p!==null){h=p;continue}break}if(b.child===T.child){for(T=b.child;T;){if(T===h)return f(b),n;if(T===p)return f(b),o;T=T.sibling}throw Error(s(188))}if(h.return!==p.return)h=b,p=T;else{for(var P=!1,W=b.child;W;){if(W===h){P=!0,h=b,p=T;break}if(W===p){P=!0,p=b,h=T;break}W=W.sibling}if(!P){for(W=T.child;W;){if(W===h){P=!0,h=T,p=b;break}if(W===p){P=!0,p=T,h=b;break}W=W.sibling}if(!P)throw Error(s(189))}}if(h.alternate!==p)throw Error(s(190))}if(h.tag!==3)throw Error(s(188));return h.stateNode.current===h?n:o}function m(n){var o=n.tag;if(o===5||o===26||o===27||o===6)return n;for(n=n.child;n!==null;){if(o=m(n),o!==null)return o;n=n.sibling}return null}var g=Object.assign,y=Symbol.for("react.element"),x=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),D=Symbol.for("react.consumer"),L=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),H=Symbol.for("react.suspense"),q=Symbol.for("react.suspense_list"),U=Symbol.for("react.memo"),k=Symbol.for("react.lazy"),M=Symbol.for("react.activity"),I=Symbol.for("react.memo_cache_sentinel"),j=Symbol.iterator;function Z(n){return n===null||typeof n!="object"?null:(n=j&&n[j]||n["@@iterator"],typeof n=="function"?n:null)}var ae=Symbol.for("react.client.reference");function ie(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===ae?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case E:return"Fragment";case R:return"Profiler";case A:return"StrictMode";case H:return"Suspense";case q:return"SuspenseList";case M:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case v:return"Portal";case L:return n.displayName||"Context";case D:return(n._context.displayName||"Context")+".Consumer";case O:var o=n.render;return n=n.displayName,n||(n=o.displayName||o.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case U:return o=n.displayName||null,o!==null?o:ie(n.type)||"Memo";case k:o=n._payload,n=n._init;try{return ie(n(o))}catch{}}return null}var re=Array.isArray,Q=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,se=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,oe={pending:!1,data:null,method:null,action:null},Y=[],V=-1;function $(n){return{current:n}}function X(n){0>V||(n.current=Y[V],Y[V]=null,V--)}function me(n,o){V++,Y[V]=n.current,n.current=o}var ve=$(null),pe=$(null),ge=$(null),ee=$(null);function ye(n,o){switch(me(ge,o),me(pe,n),me(ve,null),o.nodeType){case 9:case 11:n=(n=o.documentElement)&&(n=n.namespaceURI)?Ky(n):0;break;default:if(n=o.tagName,o=o.namespaceURI)o=Ky(o),n=zy(o,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}X(ve),me(ve,n)}function Ie(){X(ve),X(pe),X(ge)}function Ue(n){n.memoizedState!==null&&me(ee,n);var o=ve.current,h=zy(o,n.type);o!==h&&(me(pe,n),me(ve,h))}function qe(n){pe.current===n&&(X(ve),X(pe)),ee.current===n&&(X(ee),El._currentValue=oe)}var ue,Be;function Ge(n){if(ue===void 0)try{throw Error()}catch(h){var o=h.stack.trim().match(/\n( *(at )?)/);ue=o&&o[1]||"",Be=-1<h.stack.indexOf(`
    at`)?" (<anonymous>)":-1<h.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ue+n+Be}var yt=!1;function He(n,o){if(!n||yt)return"";yt=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(o){var Pe=function(){throw Error()};if(Object.defineProperty(Pe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Pe,[])}catch(Ce){var Ne=Ce}Reflect.construct(n,[],Pe)}else{try{Pe.call()}catch(Ce){Ne=Ce}n.call(Pe.prototype)}}else{try{throw Error()}catch(Ce){Ne=Ce}(Pe=n())&&typeof Pe.catch=="function"&&Pe.catch(function(){})}}catch(Ce){if(Ce&&Ne&&typeof Ce.stack=="string")return[Ce.stack,Ne.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var T=p.DetermineComponentFrameRoot(),P=T[0],W=T[1];if(P&&W){var ce=P.split(`
`),Te=W.split(`
`);for(b=p=0;p<ce.length&&!ce[p].includes("DetermineComponentFrameRoot");)p++;for(;b<Te.length&&!Te[b].includes("DetermineComponentFrameRoot");)b++;if(p===ce.length||b===Te.length)for(p=ce.length-1,b=Te.length-1;1<=p&&0<=b&&ce[p]!==Te[b];)b--;for(;1<=p&&0<=b;p--,b--)if(ce[p]!==Te[b]){if(p!==1||b!==1)do if(p--,b--,0>b||ce[p]!==Te[b]){var Me=`
`+ce[p].replace(" at new "," at ");return n.displayName&&Me.includes("<anonymous>")&&(Me=Me.replace("<anonymous>",n.displayName)),Me}while(1<=p&&0<=b);break}}}finally{yt=!1,Error.prepareStackTrace=h}return(h=n?n.displayName||n.name:"")?Ge(h):""}function dt(n,o){switch(n.tag){case 26:case 27:case 5:return Ge(n.type);case 16:return Ge("Lazy");case 13:return n.child!==o&&o!==null?Ge("Suspense Fallback"):Ge("Suspense");case 19:return Ge("SuspenseList");case 0:case 15:return He(n.type,!1);case 11:return He(n.type.render,!1);case 1:return He(n.type,!0);case 31:return Ge("Activity");default:return""}}function Ot(n){try{var o="",h=null;do o+=dt(n,h),h=n,n=n.return;while(n);return o}catch(p){return`
Error generating stack: `+p.message+`
`+p.stack}}var ns=Object.prototype.hasOwnProperty,os=i.unstable_scheduleCallback,Se=i.unstable_cancelCallback,ze=i.unstable_shouldYield,ot=i.unstable_requestPaint,vt=i.unstable_now,Zs=i.unstable_getCurrentPriorityLevel,Ms=i.unstable_ImmediatePriority,Di=i.unstable_UserBlockingPriority,mi=i.unstable_NormalPriority,Xi=i.unstable_LowPriority,Qi=i.unstable_IdlePriority,Js=i.log,Tr=i.unstable_setDisableYieldValue,Ae=null,ct=null;function Lt(n){if(typeof Js=="function"&&Tr(n),ct&&typeof ct.setStrictMode=="function")try{ct.setStrictMode(Ae,n)}catch{}}var ds=Math.clz32?Math.clz32:Ad,Ed=Math.log,Td=Math.LN2;function Ad(n){return n>>>=0,n===0?32:31-(Ed(n)/Td|0)|0}var Ar=256,wr=262144,Nr=4194304;function An(n){var o=n&42;if(o!==0)return o;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return n&261888;case 262144:case 524288:case 1048576:case 2097152:return n&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function Rr(n,o,h){var p=n.pendingLanes;if(p===0)return 0;var b=0,T=n.suspendedLanes,P=n.pingedLanes;n=n.warmLanes;var W=p&134217727;return W!==0?(p=W&~T,p!==0?b=An(p):(P&=W,P!==0?b=An(P):h||(h=W&~n,h!==0&&(b=An(h))))):(W=p&~T,W!==0?b=An(W):P!==0?b=An(P):h||(h=p&~n,h!==0&&(b=An(h)))),b===0?0:o!==0&&o!==b&&(o&T)===0&&(T=b&-b,h=o&-o,T>=h||T===32&&(h&4194048)!==0)?o:b}function Oa(n,o){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&o)===0}function wn(n,o){switch(n){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function jo(){var n=Nr;return Nr<<=1,(Nr&62914560)===0&&(Nr=4194304),n}function Cr(n){for(var o=[],h=0;31>h;h++)o.push(n);return o}function ea(n,o){n.pendingLanes|=o,o!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function ta(n,o,h,p,b,T){var P=n.pendingLanes;n.pendingLanes=h,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=h,n.entangledLanes&=h,n.errorRecoveryDisabledLanes&=h,n.shellSuspendCounter=0;var W=n.entanglements,ce=n.expirationTimes,Te=n.hiddenUpdates;for(h=P&~h;0<h;){var Me=31-ds(h),Pe=1<<Me;W[Me]=0,ce[Me]=-1;var Ne=Te[Me];if(Ne!==null)for(Te[Me]=null,Me=0;Me<Ne.length;Me++){var Ce=Ne[Me];Ce!==null&&(Ce.lane&=-536870913)}h&=~Pe}p!==0&&Oo(n,p,0),T!==0&&b===0&&n.tag!==0&&(n.suspendedLanes|=T&~(P&~o))}function Oo(n,o,h){n.pendingLanes|=o,n.suspendedLanes&=~o;var p=31-ds(o);n.entangledLanes|=o,n.entanglements[p]=n.entanglements[p]|1073741824|h&261930}function Ii(n,o){var h=n.entangledLanes|=o;for(n=n.entanglements;h;){var p=31-ds(h),b=1<<p;b&o|n[p]&o&&(n[p]|=o),h&=~b}}function Po(n,o){var h=o&-o;return h=(h&42)!==0?1:Bo(h),(h&(n.suspendedLanes|o))!==0?0:h}function Bo(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function ls(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function tc(){var n=se.p;return n!==0?n:(n=window.event,n===void 0?32:gx(n.type))}function N(n,o){var h=se.p;try{return se.p=n,o()}finally{se.p=h}}var w=Math.random().toString(36).slice(2),S="__reactFiber$"+w,_="__reactProps$"+w,C="__reactContainer$"+w,F="__reactEvents$"+w,G="__reactListeners$"+w,z="__reactHandles$"+w,te="__reactResources$"+w,J="__reactMarker$"+w;function ne(n){delete n[S],delete n[_],delete n[F],delete n[G],delete n[z]}function de(n){var o=n[S];if(o)return o;for(var h=n.parentNode;h;){if(o=h[C]||h[S]){if(h=o.alternate,o.child!==null||h!==null&&h.child!==null)for(n=Jy(n);n!==null;){if(h=n[S])return h;n=Jy(n)}return o}n=h,h=n.parentNode}return null}function le(n){if(n=n[S]||n[C]){var o=n.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return n}return null}function he(n){var o=n.tag;if(o===5||o===26||o===27||o===6)return n.stateNode;throw Error(s(33))}function we(n){var o=n[te];return o||(o=n[te]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function ke(n){n[J]=!0}var De=new Set,Ye={};function Ve(n,o){Fe(n,o),Fe(n+"Capture",o)}function Fe(n,o){for(Ye[n]=o,n=0;n<o.length;n++)De.add(o[n])}var at=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),gt={},Ke={};function tt(n){return ns.call(Ke,n)?!0:ns.call(gt,n)?!1:at.test(n)?Ke[n]=!0:(gt[n]=!0,!1)}function ht(n,o,h){if(tt(o))if(h===null)n.removeAttribute(o);else{switch(typeof h){case"undefined":case"function":case"symbol":n.removeAttribute(o);return;case"boolean":var p=o.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){n.removeAttribute(o);return}}n.setAttribute(o,""+h)}}function nt(n,o,h){if(h===null)n.removeAttribute(o);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(o);return}n.setAttribute(o,""+h)}}function st(n,o,h,p){if(p===null)n.removeAttribute(h);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(h);return}n.setAttributeNS(o,h,""+p)}}function ft(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Pt(n){var o=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function ut(n,o,h){var p=Object.getOwnPropertyDescriptor(n.constructor.prototype,o);if(!n.hasOwnProperty(o)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var b=p.get,T=p.set;return Object.defineProperty(n,o,{configurable:!0,get:function(){return b.call(this)},set:function(P){h=""+P,T.call(this,P)}}),Object.defineProperty(n,o,{enumerable:p.enumerable}),{getValue:function(){return h},setValue:function(P){h=""+P},stopTracking:function(){n._valueTracker=null,delete n[o]}}}}function _t(n){if(!n._valueTracker){var o=Pt(n)?"checked":"value";n._valueTracker=ut(n,o,""+n[o])}}function Ft(n){if(!n)return!1;var o=n._valueTracker;if(!o)return!0;var h=o.getValue(),p="";return n&&(p=Pt(n)?n.checked?"true":"false":n.value),n=p,n!==h?(o.setValue(n),!0):!1}function es(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var gi=/[\n"\\]/g;function $t(n){return n.replace(gi,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Bs(n,o,h,p,b,T,P,W){n.name="",P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"?n.type=P:n.removeAttribute("type"),o!=null?P==="number"?(o===0&&n.value===""||n.value!=o)&&(n.value=""+ft(o)):n.value!==""+ft(o)&&(n.value=""+ft(o)):P!=="submit"&&P!=="reset"||n.removeAttribute("value"),o!=null?Ss(n,P,ft(o)):h!=null?Ss(n,P,ft(h)):p!=null&&n.removeAttribute("value"),b==null&&T!=null&&(n.defaultChecked=!!T),b!=null&&(n.checked=b&&typeof b!="function"&&typeof b!="symbol"),W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?n.name=""+ft(W):n.removeAttribute("name")}function js(n,o,h,p,b,T,P,W){if(T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(n.type=T),o!=null||h!=null){if(!(T!=="submit"&&T!=="reset"||o!=null)){_t(n);return}h=h!=null?""+ft(h):"",o=o!=null?""+ft(o):h,W||o===n.value||(n.value=o),n.defaultValue=o}p=p??b,p=typeof p!="function"&&typeof p!="symbol"&&!!p,n.checked=W?n.checked:!!p,n.defaultChecked=!!p,P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"&&(n.name=P),_t(n)}function Ss(n,o,h){o==="number"&&es(n.ownerDocument)===n||n.defaultValue===""+h||(n.defaultValue=""+h)}function hs(n,o,h,p){if(n=n.options,o){o={};for(var b=0;b<h.length;b++)o["$"+h[b]]=!0;for(h=0;h<n.length;h++)b=o.hasOwnProperty("$"+n[h].value),n[h].selected!==b&&(n[h].selected=b),b&&p&&(n[h].defaultSelected=!0)}else{for(h=""+ft(h),o=null,b=0;b<n.length;b++){if(n[b].value===h){n[b].selected=!0,p&&(n[b].defaultSelected=!0);return}o!==null||n[b].disabled||(o=n[b])}o!==null&&(o.selected=!0)}}function kt(n,o,h){if(o!=null&&(o=""+ft(o),o!==n.value&&(n.value=o),h==null)){n.defaultValue!==o&&(n.defaultValue=o);return}n.defaultValue=h!=null?""+ft(h):""}function ki(n,o,h,p){if(o==null){if(p!=null){if(h!=null)throw Error(s(92));if(re(p)){if(1<p.length)throw Error(s(93));p=p[0]}h=p}h==null&&(h=""),o=h}h=ft(o),n.defaultValue=h,p=n.textContent,p===h&&p!==""&&p!==null&&(n.value=p),_t(n)}function zs(n,o){if(o){var h=n.firstChild;if(h&&h===n.lastChild&&h.nodeType===3){h.nodeValue=o;return}}n.textContent=o}var Lr=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Uo(n,o,h){var p=o.indexOf("--")===0;h==null||typeof h=="boolean"||h===""?p?n.setProperty(o,""):o==="float"?n.cssFloat="":n[o]="":p?n.setProperty(o,h):typeof h!="number"||h===0||Lr.has(o)?o==="float"?n.cssFloat=h:n[o]=(""+h).trim():n[o]=h+"px"}function sc(n,o,h){if(o!=null&&typeof o!="object")throw Error(s(62));if(n=n.style,h!=null){for(var p in h)!h.hasOwnProperty(p)||o!=null&&o.hasOwnProperty(p)||(p.indexOf("--")===0?n.setProperty(p,""):p==="float"?n.cssFloat="":n[p]="");for(var b in o)p=o[b],o.hasOwnProperty(b)&&h[b]!==p&&Uo(n,b,p)}else for(var T in o)o.hasOwnProperty(T)&&Uo(n,T,o[T])}function Dr(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Pa=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ba=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ua(n){return Ba.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}function pi(){}var Fa=null;function Nn(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var ln=null,cn=null;function Ga(n){var o=le(n);if(o&&(n=o.stateNode)){var h=n[_]||null;e:switch(n=o.stateNode,o.type){case"input":if(Bs(n,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name),o=h.name,h.type==="radio"&&o!=null){for(h=n;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll('input[name="'+$t(""+o)+'"][type="radio"]'),o=0;o<h.length;o++){var p=h[o];if(p!==n&&p.form===n.form){var b=p[_]||null;if(!b)throw Error(s(90));Bs(p,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(o=0;o<h.length;o++)p=h[o],p.form===n.form&&Ft(p)}break e;case"textarea":kt(n,h.value,h.defaultValue);break e;case"select":o=h.value,o!=null&&hs(n,!!h.multiple,o,!1)}}}var Ir=!1;function Fo(n,o,h){if(Ir)return n(o,h);Ir=!0;try{var p=n(o);return p}finally{if(Ir=!1,(ln!==null||cn!==null)&&(Vc(),ln&&(o=ln,n=cn,cn=ln=null,Ga(o),n)))for(o=0;o<n.length;o++)Ga(n[o])}}function Rn(n,o){var h=n.stateNode;if(h===null)return null;var p=h[_]||null;if(p===null)return null;h=p[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(n=n.type,p=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!p;break e;default:n=!1}if(n)return null;if(h&&typeof h!="function")throw Error(s(231,o,typeof h));return h}var Mi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Go=!1;if(Mi)try{var sa={};Object.defineProperty(sa,"passive",{get:function(){Go=!0}}),window.addEventListener("test",sa,sa),window.removeEventListener("test",sa,sa)}catch{Go=!1}var Zi=null,kr=null,ic=null;function zg(){if(ic)return ic;var n,o=kr,h=o.length,p,b="value"in Zi?Zi.value:Zi.textContent,T=b.length;for(n=0;n<h&&o[n]===b[n];n++);var P=h-n;for(p=1;p<=P&&o[h-p]===b[T-p];p++);return ic=b.slice(n,1<p?1-p:void 0)}function nc(n){var o=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&o===13&&(n=13)):n=o,n===10&&(n=13),32<=n||n===13?n:0}function ac(){return!0}function qg(){return!1}function ni(n){function o(h,p,b,T,P){this._reactName=h,this._targetInst=b,this.type=p,this.nativeEvent=T,this.target=P,this.currentTarget=null;for(var W in n)n.hasOwnProperty(W)&&(h=n[W],this[W]=h?h(T):T[W]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?ac:qg,this.isPropagationStopped=qg,this}return g(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=ac)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=ac)},persist:function(){},isPersistent:ac}),o}var $a={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rc=ni($a),$o=g({},$a,{view:0,detail:0}),WE=ni($o),wd,Nd,Vo,oc=g({},$o,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cd,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Vo&&(Vo&&n.type==="mousemove"?(wd=n.screenX-Vo.screenX,Nd=n.screenY-Vo.screenY):Nd=wd=0,Vo=n),wd)},movementY:function(n){return"movementY"in n?n.movementY:Nd}}),Yg=ni(oc),XE=g({},oc,{dataTransfer:0}),QE=ni(XE),ZE=g({},$o,{relatedTarget:0}),Rd=ni(ZE),JE=g({},$a,{animationName:0,elapsedTime:0,pseudoElement:0}),e1=ni(JE),t1=g({},$a,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),s1=ni(t1),i1=g({},$a,{data:0}),Wg=ni(i1),n1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},a1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},r1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function o1(n){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(n):(n=r1[n])?!!o[n]:!1}function Cd(){return o1}var l1=g({},$o,{key:function(n){if(n.key){var o=n1[n.key]||n.key;if(o!=="Unidentified")return o}return n.type==="keypress"?(n=nc(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?a1[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cd,charCode:function(n){return n.type==="keypress"?nc(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?nc(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),c1=ni(l1),u1=g({},oc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Xg=ni(u1),d1=g({},$o,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cd}),h1=ni(d1),f1=g({},$a,{propertyName:0,elapsedTime:0,pseudoElement:0}),m1=ni(f1),g1=g({},oc,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),p1=ni(g1),y1=g({},$a,{newState:0,oldState:0}),x1=ni(y1),v1=[9,13,27,32],Ld=Mi&&"CompositionEvent"in window,Ho=null;Mi&&"documentMode"in document&&(Ho=document.documentMode);var _1=Mi&&"TextEvent"in window&&!Ho,Qg=Mi&&(!Ld||Ho&&8<Ho&&11>=Ho),Zg=" ",Jg=!1;function ep(n,o){switch(n){case"keyup":return v1.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function tp(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Mr=!1;function b1(n,o){switch(n){case"compositionend":return tp(o);case"keypress":return o.which!==32?null:(Jg=!0,Zg);case"textInput":return n=o.data,n===Zg&&Jg?null:n;default:return null}}function S1(n,o){if(Mr)return n==="compositionend"||!Ld&&ep(n,o)?(n=zg(),ic=kr=Zi=null,Mr=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return Qg&&o.locale!=="ko"?null:o.data;default:return null}}var E1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function sp(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o==="input"?!!E1[n.type]:o==="textarea"}function ip(n,o,h,p){ln?cn?cn.push(p):cn=[p]:ln=p,o=Xc(o,"onChange"),0<o.length&&(h=new rc("onChange","change",null,h,p),n.push({event:h,listeners:o}))}var Ko=null,zo=null;function T1(n){Uy(n,0)}function lc(n){var o=he(n);if(Ft(o))return n}function np(n,o){if(n==="change")return o}var ap=!1;if(Mi){var Dd;if(Mi){var Id="oninput"in document;if(!Id){var rp=document.createElement("div");rp.setAttribute("oninput","return;"),Id=typeof rp.oninput=="function"}Dd=Id}else Dd=!1;ap=Dd&&(!document.documentMode||9<document.documentMode)}function op(){Ko&&(Ko.detachEvent("onpropertychange",lp),zo=Ko=null)}function lp(n){if(n.propertyName==="value"&&lc(zo)){var o=[];ip(o,zo,n,Nn(n)),Fo(T1,o)}}function A1(n,o,h){n==="focusin"?(op(),Ko=o,zo=h,Ko.attachEvent("onpropertychange",lp)):n==="focusout"&&op()}function w1(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return lc(zo)}function N1(n,o){if(n==="click")return lc(o)}function R1(n,o){if(n==="input"||n==="change")return lc(o)}function C1(n,o){return n===o&&(n!==0||1/n===1/o)||n!==n&&o!==o}var yi=typeof Object.is=="function"?Object.is:C1;function qo(n,o){if(yi(n,o))return!0;if(typeof n!="object"||n===null||typeof o!="object"||o===null)return!1;var h=Object.keys(n),p=Object.keys(o);if(h.length!==p.length)return!1;for(p=0;p<h.length;p++){var b=h[p];if(!ns.call(o,b)||!yi(n[b],o[b]))return!1}return!0}function cp(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function up(n,o){var h=cp(n);n=0;for(var p;h;){if(h.nodeType===3){if(p=n+h.textContent.length,n<=o&&p>=o)return{node:h,offset:o-n};n=p}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=cp(h)}}function dp(n,o){return n&&o?n===o?!0:n&&n.nodeType===3?!1:o&&o.nodeType===3?dp(n,o.parentNode):"contains"in n?n.contains(o):n.compareDocumentPosition?!!(n.compareDocumentPosition(o)&16):!1:!1}function hp(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var o=es(n.document);o instanceof n.HTMLIFrameElement;){try{var h=typeof o.contentWindow.location.href=="string"}catch{h=!1}if(h)n=o.contentWindow;else break;o=es(n.document)}return o}function kd(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o&&(o==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||o==="textarea"||n.contentEditable==="true")}var L1=Mi&&"documentMode"in document&&11>=document.documentMode,jr=null,Md=null,Yo=null,jd=!1;function fp(n,o,h){var p=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;jd||jr==null||jr!==es(p)||(p=jr,"selectionStart"in p&&kd(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),Yo&&qo(Yo,p)||(Yo=p,p=Xc(Md,"onSelect"),0<p.length&&(o=new rc("onSelect","select",null,o,h),n.push({event:o,listeners:p}),o.target=jr)))}function Va(n,o){var h={};return h[n.toLowerCase()]=o.toLowerCase(),h["Webkit"+n]="webkit"+o,h["Moz"+n]="moz"+o,h}var Or={animationend:Va("Animation","AnimationEnd"),animationiteration:Va("Animation","AnimationIteration"),animationstart:Va("Animation","AnimationStart"),transitionrun:Va("Transition","TransitionRun"),transitionstart:Va("Transition","TransitionStart"),transitioncancel:Va("Transition","TransitionCancel"),transitionend:Va("Transition","TransitionEnd")},Od={},mp={};Mi&&(mp=document.createElement("div").style,"AnimationEvent"in window||(delete Or.animationend.animation,delete Or.animationiteration.animation,delete Or.animationstart.animation),"TransitionEvent"in window||delete Or.transitionend.transition);function Ha(n){if(Od[n])return Od[n];if(!Or[n])return n;var o=Or[n],h;for(h in o)if(o.hasOwnProperty(h)&&h in mp)return Od[n]=o[h];return n}var gp=Ha("animationend"),pp=Ha("animationiteration"),yp=Ha("animationstart"),D1=Ha("transitionrun"),I1=Ha("transitionstart"),k1=Ha("transitioncancel"),xp=Ha("transitionend"),vp=new Map,Pd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Pd.push("scrollEnd");function Ji(n,o){vp.set(n,o),Ve(o,[n])}var cc=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)},ji=[],Pr=0,Bd=0;function uc(){for(var n=Pr,o=Bd=Pr=0;o<n;){var h=ji[o];ji[o++]=null;var p=ji[o];ji[o++]=null;var b=ji[o];ji[o++]=null;var T=ji[o];if(ji[o++]=null,p!==null&&b!==null){var P=p.pending;P===null?b.next=b:(b.next=P.next,P.next=b),p.pending=b}T!==0&&_p(h,b,T)}}function dc(n,o,h,p){ji[Pr++]=n,ji[Pr++]=o,ji[Pr++]=h,ji[Pr++]=p,Bd|=p,n.lanes|=p,n=n.alternate,n!==null&&(n.lanes|=p)}function Ud(n,o,h,p){return dc(n,o,h,p),hc(n)}function Ka(n,o){return dc(n,null,null,o),hc(n)}function _p(n,o,h){n.lanes|=h;var p=n.alternate;p!==null&&(p.lanes|=h);for(var b=!1,T=n.return;T!==null;)T.childLanes|=h,p=T.alternate,p!==null&&(p.childLanes|=h),T.tag===22&&(n=T.stateNode,n===null||n._visibility&1||(b=!0)),n=T,T=T.return;return n.tag===3?(T=n.stateNode,b&&o!==null&&(b=31-ds(h),n=T.hiddenUpdates,p=n[b],p===null?n[b]=[o]:p.push(o),o.lane=h|536870912),T):null}function hc(n){if(50<pl)throw pl=0,Yh=null,Error(s(185));for(var o=n.return;o!==null;)n=o,o=n.return;return n.tag===3?n.stateNode:null}var Br={};function M1(n,o,h,p){this.tag=n,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xi(n,o,h,p){return new M1(n,o,h,p)}function Fd(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Cn(n,o){var h=n.alternate;return h===null?(h=xi(n.tag,o,n.key,n.mode),h.elementType=n.elementType,h.type=n.type,h.stateNode=n.stateNode,h.alternate=n,n.alternate=h):(h.pendingProps=o,h.type=n.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=n.flags&65011712,h.childLanes=n.childLanes,h.lanes=n.lanes,h.child=n.child,h.memoizedProps=n.memoizedProps,h.memoizedState=n.memoizedState,h.updateQueue=n.updateQueue,o=n.dependencies,h.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},h.sibling=n.sibling,h.index=n.index,h.ref=n.ref,h.refCleanup=n.refCleanup,h}function bp(n,o){n.flags&=65011714;var h=n.alternate;return h===null?(n.childLanes=0,n.lanes=o,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=h.childLanes,n.lanes=h.lanes,n.child=h.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=h.memoizedProps,n.memoizedState=h.memoizedState,n.updateQueue=h.updateQueue,n.type=h.type,o=h.dependencies,n.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),n}function fc(n,o,h,p,b,T){var P=0;if(p=n,typeof n=="function")Fd(n)&&(P=1);else if(typeof n=="string")P=UT(n,h,ve.current)?26:n==="html"||n==="head"||n==="body"?27:5;else e:switch(n){case M:return n=xi(31,h,o,b),n.elementType=M,n.lanes=T,n;case E:return za(h.children,b,T,o);case A:P=8,b|=24;break;case R:return n=xi(12,h,o,b|2),n.elementType=R,n.lanes=T,n;case H:return n=xi(13,h,o,b),n.elementType=H,n.lanes=T,n;case q:return n=xi(19,h,o,b),n.elementType=q,n.lanes=T,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case L:P=10;break e;case D:P=9;break e;case O:P=11;break e;case U:P=14;break e;case k:P=16,p=null;break e}P=29,h=Error(s(130,n===null?"null":typeof n,"")),p=null}return o=xi(P,h,o,b),o.elementType=n,o.type=p,o.lanes=T,o}function za(n,o,h,p){return n=xi(7,n,p,o),n.lanes=h,n}function Gd(n,o,h){return n=xi(6,n,null,o),n.lanes=h,n}function Sp(n){var o=xi(18,null,null,0);return o.stateNode=n,o}function $d(n,o,h){return o=xi(4,n.children!==null?n.children:[],n.key,o),o.lanes=h,o.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},o}var Ep=new WeakMap;function Oi(n,o){if(typeof n=="object"&&n!==null){var h=Ep.get(n);return h!==void 0?h:(o={value:n,source:o,stack:Ot(o)},Ep.set(n,o),o)}return{value:n,source:o,stack:Ot(o)}}var Ur=[],Fr=0,mc=null,Wo=0,Pi=[],Bi=0,ia=null,un=1,dn="";function Ln(n,o){Ur[Fr++]=Wo,Ur[Fr++]=mc,mc=n,Wo=o}function Tp(n,o,h){Pi[Bi++]=un,Pi[Bi++]=dn,Pi[Bi++]=ia,ia=n;var p=un;n=dn;var b=32-ds(p)-1;p&=~(1<<b),h+=1;var T=32-ds(o)+b;if(30<T){var P=b-b%5;T=(p&(1<<P)-1).toString(32),p>>=P,b-=P,un=1<<32-ds(o)+b|h<<b|p,dn=T+n}else un=1<<T|h<<b|p,dn=n}function Vd(n){n.return!==null&&(Ln(n,1),Tp(n,1,0))}function Hd(n){for(;n===mc;)mc=Ur[--Fr],Ur[Fr]=null,Wo=Ur[--Fr],Ur[Fr]=null;for(;n===ia;)ia=Pi[--Bi],Pi[Bi]=null,dn=Pi[--Bi],Pi[Bi]=null,un=Pi[--Bi],Pi[Bi]=null}function Ap(n,o){Pi[Bi++]=un,Pi[Bi++]=dn,Pi[Bi++]=ia,un=o.id,dn=o.overflow,ia=n}var Us=null,ts=null,Mt=!1,na=null,Ui=!1,Kd=Error(s(519));function aa(n){var o=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Xo(Oi(o,n)),Kd}function wp(n){var o=n.stateNode,h=n.type,p=n.memoizedProps;switch(o[S]=n,o[_]=p,h){case"dialog":Nt("cancel",o),Nt("close",o);break;case"iframe":case"object":case"embed":Nt("load",o);break;case"video":case"audio":for(h=0;h<xl.length;h++)Nt(xl[h],o);break;case"source":Nt("error",o);break;case"img":case"image":case"link":Nt("error",o),Nt("load",o);break;case"details":Nt("toggle",o);break;case"input":Nt("invalid",o),js(o,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0);break;case"select":Nt("invalid",o);break;case"textarea":Nt("invalid",o),ki(o,p.value,p.defaultValue,p.children)}h=p.children,typeof h!="string"&&typeof h!="number"&&typeof h!="bigint"||o.textContent===""+h||p.suppressHydrationWarning===!0||Vy(o.textContent,h)?(p.popover!=null&&(Nt("beforetoggle",o),Nt("toggle",o)),p.onScroll!=null&&Nt("scroll",o),p.onScrollEnd!=null&&Nt("scrollend",o),p.onClick!=null&&(o.onclick=pi),o=!0):o=!1,o||aa(n,!0)}function Np(n){for(Us=n.return;Us;)switch(Us.tag){case 5:case 31:case 13:Ui=!1;return;case 27:case 3:Ui=!0;return;default:Us=Us.return}}function Gr(n){if(n!==Us)return!1;if(!Mt)return Np(n),Mt=!0,!1;var o=n.tag,h;if((h=o!==3&&o!==27)&&((h=o===5)&&(h=n.type,h=!(h!=="form"&&h!=="button")||uf(n.type,n.memoizedProps)),h=!h),h&&ts&&aa(n),Np(n),o===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(s(317));ts=Zy(n)}else if(o===31){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(s(317));ts=Zy(n)}else o===27?(o=ts,va(n.type)?(n=gf,gf=null,ts=n):ts=o):ts=Us?Gi(n.stateNode.nextSibling):null;return!0}function qa(){ts=Us=null,Mt=!1}function zd(){var n=na;return n!==null&&(li===null?li=n:li.push.apply(li,n),na=null),n}function Xo(n){na===null?na=[n]:na.push(n)}var qd=$(null),Ya=null,Dn=null;function ra(n,o,h){me(qd,o._currentValue),o._currentValue=h}function In(n){n._currentValue=qd.current,X(qd)}function Yd(n,o,h){for(;n!==null;){var p=n.alternate;if((n.childLanes&o)!==o?(n.childLanes|=o,p!==null&&(p.childLanes|=o)):p!==null&&(p.childLanes&o)!==o&&(p.childLanes|=o),n===h)break;n=n.return}}function Wd(n,o,h,p){var b=n.child;for(b!==null&&(b.return=n);b!==null;){var T=b.dependencies;if(T!==null){var P=b.child;T=T.firstContext;e:for(;T!==null;){var W=T;T=b;for(var ce=0;ce<o.length;ce++)if(W.context===o[ce]){T.lanes|=h,W=T.alternate,W!==null&&(W.lanes|=h),Yd(T.return,h,n),p||(P=null);break e}T=W.next}}else if(b.tag===18){if(P=b.return,P===null)throw Error(s(341));P.lanes|=h,T=P.alternate,T!==null&&(T.lanes|=h),Yd(P,h,n),P=null}else P=b.child;if(P!==null)P.return=b;else for(P=b;P!==null;){if(P===n){P=null;break}if(b=P.sibling,b!==null){b.return=P.return,P=b;break}P=P.return}b=P}}function $r(n,o,h,p){n=null;for(var b=o,T=!1;b!==null;){if(!T){if((b.flags&524288)!==0)T=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var P=b.alternate;if(P===null)throw Error(s(387));if(P=P.memoizedProps,P!==null){var W=b.type;yi(b.pendingProps.value,P.value)||(n!==null?n.push(W):n=[W])}}else if(b===ee.current){if(P=b.alternate,P===null)throw Error(s(387));P.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(n!==null?n.push(El):n=[El])}b=b.return}n!==null&&Wd(o,n,h,p),o.flags|=262144}function gc(n){for(n=n.firstContext;n!==null;){if(!yi(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function Wa(n){Ya=n,Dn=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function Fs(n){return Rp(Ya,n)}function pc(n,o){return Ya===null&&Wa(n),Rp(n,o)}function Rp(n,o){var h=o._currentValue;if(o={context:o,memoizedValue:h,next:null},Dn===null){if(n===null)throw Error(s(308));Dn=o,n.dependencies={lanes:0,firstContext:o},n.flags|=524288}else Dn=Dn.next=o;return h}var j1=typeof AbortController<"u"?AbortController:function(){var n=[],o=this.signal={aborted:!1,addEventListener:function(h,p){n.push(p)}};this.abort=function(){o.aborted=!0,n.forEach(function(h){return h()})}},O1=i.unstable_scheduleCallback,P1=i.unstable_NormalPriority,Es={$$typeof:L,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Xd(){return{controller:new j1,data:new Map,refCount:0}}function Qo(n){n.refCount--,n.refCount===0&&O1(P1,function(){n.controller.abort()})}var Zo=null,Qd=0,Vr=0,Hr=null;function B1(n,o){if(Zo===null){var h=Zo=[];Qd=0,Vr=ef(),Hr={status:"pending",value:void 0,then:function(p){h.push(p)}}}return Qd++,o.then(Cp,Cp),o}function Cp(){if(--Qd===0&&Zo!==null){Hr!==null&&(Hr.status="fulfilled");var n=Zo;Zo=null,Vr=0,Hr=null;for(var o=0;o<n.length;o++)(0,n[o])()}}function U1(n,o){var h=[],p={status:"pending",value:null,reason:null,then:function(b){h.push(b)}};return n.then(function(){p.status="fulfilled",p.value=o;for(var b=0;b<h.length;b++)(0,h[b])(o)},function(b){for(p.status="rejected",p.reason=b,b=0;b<h.length;b++)(0,h[b])(void 0)}),p}var Lp=Q.S;Q.S=function(n,o){fy=vt(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&B1(n,o),Lp!==null&&Lp(n,o)};var Xa=$(null);function Zd(){var n=Xa.current;return n!==null?n:Qt.pooledCache}function yc(n,o){o===null?me(Xa,Xa.current):me(Xa,o.pool)}function Dp(){var n=Zd();return n===null?null:{parent:Es._currentValue,pool:n}}var Kr=Error(s(460)),Jd=Error(s(474)),xc=Error(s(542)),vc={then:function(){}};function Ip(n){return n=n.status,n==="fulfilled"||n==="rejected"}function kp(n,o,h){switch(h=n[h],h===void 0?n.push(o):h!==o&&(o.then(pi,pi),o=h),o.status){case"fulfilled":return o.value;case"rejected":throw n=o.reason,jp(n),n;default:if(typeof o.status=="string")o.then(pi,pi);else{if(n=Qt,n!==null&&100<n.shellSuspendCounter)throw Error(s(482));n=o,n.status="pending",n.then(function(p){if(o.status==="pending"){var b=o;b.status="fulfilled",b.value=p}},function(p){if(o.status==="pending"){var b=o;b.status="rejected",b.reason=p}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw n=o.reason,jp(n),n}throw Za=o,Kr}}function Qa(n){try{var o=n._init;return o(n._payload)}catch(h){throw h!==null&&typeof h=="object"&&typeof h.then=="function"?(Za=h,Kr):h}}var Za=null;function Mp(){if(Za===null)throw Error(s(459));var n=Za;return Za=null,n}function jp(n){if(n===Kr||n===xc)throw Error(s(483))}var zr=null,Jo=0;function _c(n){var o=Jo;return Jo+=1,zr===null&&(zr=[]),kp(zr,n,o)}function el(n,o){o=o.props.ref,n.ref=o!==void 0?o:null}function bc(n,o){throw o.$$typeof===y?Error(s(525)):(n=Object.prototype.toString.call(o),Error(s(31,n==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":n)))}function Op(n){function o(xe,fe){if(n){var Ee=xe.deletions;Ee===null?(xe.deletions=[fe],xe.flags|=16):Ee.push(fe)}}function h(xe,fe){if(!n)return null;for(;fe!==null;)o(xe,fe),fe=fe.sibling;return null}function p(xe){for(var fe=new Map;xe!==null;)xe.key!==null?fe.set(xe.key,xe):fe.set(xe.index,xe),xe=xe.sibling;return fe}function b(xe,fe){return xe=Cn(xe,fe),xe.index=0,xe.sibling=null,xe}function T(xe,fe,Ee){return xe.index=Ee,n?(Ee=xe.alternate,Ee!==null?(Ee=Ee.index,Ee<fe?(xe.flags|=67108866,fe):Ee):(xe.flags|=67108866,fe)):(xe.flags|=1048576,fe)}function P(xe){return n&&xe.alternate===null&&(xe.flags|=67108866),xe}function W(xe,fe,Ee,Oe){return fe===null||fe.tag!==6?(fe=Gd(Ee,xe.mode,Oe),fe.return=xe,fe):(fe=b(fe,Ee),fe.return=xe,fe)}function ce(xe,fe,Ee,Oe){var rt=Ee.type;return rt===E?Me(xe,fe,Ee.props.children,Oe,Ee.key):fe!==null&&(fe.elementType===rt||typeof rt=="object"&&rt!==null&&rt.$$typeof===k&&Qa(rt)===fe.type)?(fe=b(fe,Ee.props),el(fe,Ee),fe.return=xe,fe):(fe=fc(Ee.type,Ee.key,Ee.props,null,xe.mode,Oe),el(fe,Ee),fe.return=xe,fe)}function Te(xe,fe,Ee,Oe){return fe===null||fe.tag!==4||fe.stateNode.containerInfo!==Ee.containerInfo||fe.stateNode.implementation!==Ee.implementation?(fe=$d(Ee,xe.mode,Oe),fe.return=xe,fe):(fe=b(fe,Ee.children||[]),fe.return=xe,fe)}function Me(xe,fe,Ee,Oe,rt){return fe===null||fe.tag!==7?(fe=za(Ee,xe.mode,Oe,rt),fe.return=xe,fe):(fe=b(fe,Ee),fe.return=xe,fe)}function Pe(xe,fe,Ee){if(typeof fe=="string"&&fe!==""||typeof fe=="number"||typeof fe=="bigint")return fe=Gd(""+fe,xe.mode,Ee),fe.return=xe,fe;if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case x:return Ee=fc(fe.type,fe.key,fe.props,null,xe.mode,Ee),el(Ee,fe),Ee.return=xe,Ee;case v:return fe=$d(fe,xe.mode,Ee),fe.return=xe,fe;case k:return fe=Qa(fe),Pe(xe,fe,Ee)}if(re(fe)||Z(fe))return fe=za(fe,xe.mode,Ee,null),fe.return=xe,fe;if(typeof fe.then=="function")return Pe(xe,_c(fe),Ee);if(fe.$$typeof===L)return Pe(xe,pc(xe,fe),Ee);bc(xe,fe)}return null}function Ne(xe,fe,Ee,Oe){var rt=fe!==null?fe.key:null;if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number"||typeof Ee=="bigint")return rt!==null?null:W(xe,fe,""+Ee,Oe);if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case x:return Ee.key===rt?ce(xe,fe,Ee,Oe):null;case v:return Ee.key===rt?Te(xe,fe,Ee,Oe):null;case k:return Ee=Qa(Ee),Ne(xe,fe,Ee,Oe)}if(re(Ee)||Z(Ee))return rt!==null?null:Me(xe,fe,Ee,Oe,null);if(typeof Ee.then=="function")return Ne(xe,fe,_c(Ee),Oe);if(Ee.$$typeof===L)return Ne(xe,fe,pc(xe,Ee),Oe);bc(xe,Ee)}return null}function Ce(xe,fe,Ee,Oe,rt){if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number"||typeof Oe=="bigint")return xe=xe.get(Ee)||null,W(fe,xe,""+Oe,rt);if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case x:return xe=xe.get(Oe.key===null?Ee:Oe.key)||null,ce(fe,xe,Oe,rt);case v:return xe=xe.get(Oe.key===null?Ee:Oe.key)||null,Te(fe,xe,Oe,rt);case k:return Oe=Qa(Oe),Ce(xe,fe,Ee,Oe,rt)}if(re(Oe)||Z(Oe))return xe=xe.get(Ee)||null,Me(fe,xe,Oe,rt,null);if(typeof Oe.then=="function")return Ce(xe,fe,Ee,_c(Oe),rt);if(Oe.$$typeof===L)return Ce(xe,fe,Ee,pc(fe,Oe),rt);bc(fe,Oe)}return null}function Qe(xe,fe,Ee,Oe){for(var rt=null,Bt=null,Je=fe,Et=fe=0,It=null;Je!==null&&Et<Ee.length;Et++){Je.index>Et?(It=Je,Je=null):It=Je.sibling;var Ut=Ne(xe,Je,Ee[Et],Oe);if(Ut===null){Je===null&&(Je=It);break}n&&Je&&Ut.alternate===null&&o(xe,Je),fe=T(Ut,fe,Et),Bt===null?rt=Ut:Bt.sibling=Ut,Bt=Ut,Je=It}if(Et===Ee.length)return h(xe,Je),Mt&&Ln(xe,Et),rt;if(Je===null){for(;Et<Ee.length;Et++)Je=Pe(xe,Ee[Et],Oe),Je!==null&&(fe=T(Je,fe,Et),Bt===null?rt=Je:Bt.sibling=Je,Bt=Je);return Mt&&Ln(xe,Et),rt}for(Je=p(Je);Et<Ee.length;Et++)It=Ce(Je,xe,Et,Ee[Et],Oe),It!==null&&(n&&It.alternate!==null&&Je.delete(It.key===null?Et:It.key),fe=T(It,fe,Et),Bt===null?rt=It:Bt.sibling=It,Bt=It);return n&&Je.forEach(function(Ta){return o(xe,Ta)}),Mt&&Ln(xe,Et),rt}function lt(xe,fe,Ee,Oe){if(Ee==null)throw Error(s(151));for(var rt=null,Bt=null,Je=fe,Et=fe=0,It=null,Ut=Ee.next();Je!==null&&!Ut.done;Et++,Ut=Ee.next()){Je.index>Et?(It=Je,Je=null):It=Je.sibling;var Ta=Ne(xe,Je,Ut.value,Oe);if(Ta===null){Je===null&&(Je=It);break}n&&Je&&Ta.alternate===null&&o(xe,Je),fe=T(Ta,fe,Et),Bt===null?rt=Ta:Bt.sibling=Ta,Bt=Ta,Je=It}if(Ut.done)return h(xe,Je),Mt&&Ln(xe,Et),rt;if(Je===null){for(;!Ut.done;Et++,Ut=Ee.next())Ut=Pe(xe,Ut.value,Oe),Ut!==null&&(fe=T(Ut,fe,Et),Bt===null?rt=Ut:Bt.sibling=Ut,Bt=Ut);return Mt&&Ln(xe,Et),rt}for(Je=p(Je);!Ut.done;Et++,Ut=Ee.next())Ut=Ce(Je,xe,Et,Ut.value,Oe),Ut!==null&&(n&&Ut.alternate!==null&&Je.delete(Ut.key===null?Et:Ut.key),fe=T(Ut,fe,Et),Bt===null?rt=Ut:Bt.sibling=Ut,Bt=Ut);return n&&Je.forEach(function(XT){return o(xe,XT)}),Mt&&Ln(xe,Et),rt}function Wt(xe,fe,Ee,Oe){if(typeof Ee=="object"&&Ee!==null&&Ee.type===E&&Ee.key===null&&(Ee=Ee.props.children),typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case x:e:{for(var rt=Ee.key;fe!==null;){if(fe.key===rt){if(rt=Ee.type,rt===E){if(fe.tag===7){h(xe,fe.sibling),Oe=b(fe,Ee.props.children),Oe.return=xe,xe=Oe;break e}}else if(fe.elementType===rt||typeof rt=="object"&&rt!==null&&rt.$$typeof===k&&Qa(rt)===fe.type){h(xe,fe.sibling),Oe=b(fe,Ee.props),el(Oe,Ee),Oe.return=xe,xe=Oe;break e}h(xe,fe);break}else o(xe,fe);fe=fe.sibling}Ee.type===E?(Oe=za(Ee.props.children,xe.mode,Oe,Ee.key),Oe.return=xe,xe=Oe):(Oe=fc(Ee.type,Ee.key,Ee.props,null,xe.mode,Oe),el(Oe,Ee),Oe.return=xe,xe=Oe)}return P(xe);case v:e:{for(rt=Ee.key;fe!==null;){if(fe.key===rt)if(fe.tag===4&&fe.stateNode.containerInfo===Ee.containerInfo&&fe.stateNode.implementation===Ee.implementation){h(xe,fe.sibling),Oe=b(fe,Ee.children||[]),Oe.return=xe,xe=Oe;break e}else{h(xe,fe);break}else o(xe,fe);fe=fe.sibling}Oe=$d(Ee,xe.mode,Oe),Oe.return=xe,xe=Oe}return P(xe);case k:return Ee=Qa(Ee),Wt(xe,fe,Ee,Oe)}if(re(Ee))return Qe(xe,fe,Ee,Oe);if(Z(Ee)){if(rt=Z(Ee),typeof rt!="function")throw Error(s(150));return Ee=rt.call(Ee),lt(xe,fe,Ee,Oe)}if(typeof Ee.then=="function")return Wt(xe,fe,_c(Ee),Oe);if(Ee.$$typeof===L)return Wt(xe,fe,pc(xe,Ee),Oe);bc(xe,Ee)}return typeof Ee=="string"&&Ee!==""||typeof Ee=="number"||typeof Ee=="bigint"?(Ee=""+Ee,fe!==null&&fe.tag===6?(h(xe,fe.sibling),Oe=b(fe,Ee),Oe.return=xe,xe=Oe):(h(xe,fe),Oe=Gd(Ee,xe.mode,Oe),Oe.return=xe,xe=Oe),P(xe)):h(xe,fe)}return function(xe,fe,Ee,Oe){try{Jo=0;var rt=Wt(xe,fe,Ee,Oe);return zr=null,rt}catch(Je){if(Je===Kr||Je===xc)throw Je;var Bt=xi(29,Je,null,xe.mode);return Bt.lanes=Oe,Bt.return=xe,Bt}finally{}}}var Ja=Op(!0),Pp=Op(!1),oa=!1;function eh(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function th(n,o){n=n.updateQueue,o.updateQueue===n&&(o.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function la(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function ca(n,o,h){var p=n.updateQueue;if(p===null)return null;if(p=p.shared,(Gt&2)!==0){var b=p.pending;return b===null?o.next=o:(o.next=b.next,b.next=o),p.pending=o,o=hc(n),_p(n,null,h),o}return dc(n,p,o,h),hc(n)}function tl(n,o,h){if(o=o.updateQueue,o!==null&&(o=o.shared,(h&4194048)!==0)){var p=o.lanes;p&=n.pendingLanes,h|=p,o.lanes=h,Ii(n,h)}}function sh(n,o){var h=n.updateQueue,p=n.alternate;if(p!==null&&(p=p.updateQueue,h===p)){var b=null,T=null;if(h=h.firstBaseUpdate,h!==null){do{var P={lane:h.lane,tag:h.tag,payload:h.payload,callback:null,next:null};T===null?b=T=P:T=T.next=P,h=h.next}while(h!==null);T===null?b=T=o:T=T.next=o}else b=T=o;h={baseState:p.baseState,firstBaseUpdate:b,lastBaseUpdate:T,shared:p.shared,callbacks:p.callbacks},n.updateQueue=h;return}n=h.lastBaseUpdate,n===null?h.firstBaseUpdate=o:n.next=o,h.lastBaseUpdate=o}var ih=!1;function sl(){if(ih){var n=Hr;if(n!==null)throw n}}function il(n,o,h,p){ih=!1;var b=n.updateQueue;oa=!1;var T=b.firstBaseUpdate,P=b.lastBaseUpdate,W=b.shared.pending;if(W!==null){b.shared.pending=null;var ce=W,Te=ce.next;ce.next=null,P===null?T=Te:P.next=Te,P=ce;var Me=n.alternate;Me!==null&&(Me=Me.updateQueue,W=Me.lastBaseUpdate,W!==P&&(W===null?Me.firstBaseUpdate=Te:W.next=Te,Me.lastBaseUpdate=ce))}if(T!==null){var Pe=b.baseState;P=0,Me=Te=ce=null,W=T;do{var Ne=W.lane&-536870913,Ce=Ne!==W.lane;if(Ce?(Dt&Ne)===Ne:(p&Ne)===Ne){Ne!==0&&Ne===Vr&&(ih=!0),Me!==null&&(Me=Me.next={lane:0,tag:W.tag,payload:W.payload,callback:null,next:null});e:{var Qe=n,lt=W;Ne=o;var Wt=h;switch(lt.tag){case 1:if(Qe=lt.payload,typeof Qe=="function"){Pe=Qe.call(Wt,Pe,Ne);break e}Pe=Qe;break e;case 3:Qe.flags=Qe.flags&-65537|128;case 0:if(Qe=lt.payload,Ne=typeof Qe=="function"?Qe.call(Wt,Pe,Ne):Qe,Ne==null)break e;Pe=g({},Pe,Ne);break e;case 2:oa=!0}}Ne=W.callback,Ne!==null&&(n.flags|=64,Ce&&(n.flags|=8192),Ce=b.callbacks,Ce===null?b.callbacks=[Ne]:Ce.push(Ne))}else Ce={lane:Ne,tag:W.tag,payload:W.payload,callback:W.callback,next:null},Me===null?(Te=Me=Ce,ce=Pe):Me=Me.next=Ce,P|=Ne;if(W=W.next,W===null){if(W=b.shared.pending,W===null)break;Ce=W,W=Ce.next,Ce.next=null,b.lastBaseUpdate=Ce,b.shared.pending=null}}while(!0);Me===null&&(ce=Pe),b.baseState=ce,b.firstBaseUpdate=Te,b.lastBaseUpdate=Me,T===null&&(b.shared.lanes=0),ma|=P,n.lanes=P,n.memoizedState=Pe}}function Bp(n,o){if(typeof n!="function")throw Error(s(191,n));n.call(o)}function Up(n,o){var h=n.callbacks;if(h!==null)for(n.callbacks=null,n=0;n<h.length;n++)Bp(h[n],o)}var qr=$(null),Sc=$(0);function Fp(n,o){n=Gn,me(Sc,n),me(qr,o),Gn=n|o.baseLanes}function nh(){me(Sc,Gn),me(qr,qr.current)}function ah(){Gn=Sc.current,X(qr),X(Sc)}var vi=$(null),Fi=null;function ua(n){var o=n.alternate;me(ys,ys.current&1),me(vi,n),Fi===null&&(o===null||qr.current!==null||o.memoizedState!==null)&&(Fi=n)}function rh(n){me(ys,ys.current),me(vi,n),Fi===null&&(Fi=n)}function Gp(n){n.tag===22?(me(ys,ys.current),me(vi,n),Fi===null&&(Fi=n)):da()}function da(){me(ys,ys.current),me(vi,vi.current)}function _i(n){X(vi),Fi===n&&(Fi=null),X(ys)}var ys=$(0);function Ec(n){for(var o=n;o!==null;){if(o.tag===13){var h=o.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||ff(h)||mf(h)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var kn=0,bt=null,qt=null,Ts=null,Tc=!1,Yr=!1,er=!1,Ac=0,nl=0,Wr=null,F1=0;function fs(){throw Error(s(321))}function oh(n,o){if(o===null)return!1;for(var h=0;h<o.length&&h<n.length;h++)if(!yi(n[h],o[h]))return!1;return!0}function lh(n,o,h,p,b,T){return kn=T,bt=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Q.H=n===null||n.memoizedState===null?T0:Eh,er=!1,T=h(p,b),er=!1,Yr&&(T=Vp(o,h,p,b)),$p(n),T}function $p(n){Q.H=ol;var o=qt!==null&&qt.next!==null;if(kn=0,Ts=qt=bt=null,Tc=!1,nl=0,Wr=null,o)throw Error(s(300));n===null||As||(n=n.dependencies,n!==null&&gc(n)&&(As=!0))}function Vp(n,o,h,p){bt=n;var b=0;do{if(Yr&&(Wr=null),nl=0,Yr=!1,25<=b)throw Error(s(301));if(b+=1,Ts=qt=null,n.updateQueue!=null){var T=n.updateQueue;T.lastEffect=null,T.events=null,T.stores=null,T.memoCache!=null&&(T.memoCache.index=0)}Q.H=A0,T=o(h,p)}while(Yr);return T}function G1(){var n=Q.H,o=n.useState()[0];return o=typeof o.then=="function"?al(o):o,n=n.useState()[0],(qt!==null?qt.memoizedState:null)!==n&&(bt.flags|=1024),o}function ch(){var n=Ac!==0;return Ac=0,n}function uh(n,o,h){o.updateQueue=n.updateQueue,o.flags&=-2053,n.lanes&=~h}function dh(n){if(Tc){for(n=n.memoizedState;n!==null;){var o=n.queue;o!==null&&(o.pending=null),n=n.next}Tc=!1}kn=0,Ts=qt=bt=null,Yr=!1,nl=Ac=0,Wr=null}function ei(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ts===null?bt.memoizedState=Ts=n:Ts=Ts.next=n,Ts}function xs(){if(qt===null){var n=bt.alternate;n=n!==null?n.memoizedState:null}else n=qt.next;var o=Ts===null?bt.memoizedState:Ts.next;if(o!==null)Ts=o,qt=n;else{if(n===null)throw bt.alternate===null?Error(s(467)):Error(s(310));qt=n,n={memoizedState:qt.memoizedState,baseState:qt.baseState,baseQueue:qt.baseQueue,queue:qt.queue,next:null},Ts===null?bt.memoizedState=Ts=n:Ts=Ts.next=n}return Ts}function wc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function al(n){var o=nl;return nl+=1,Wr===null&&(Wr=[]),n=kp(Wr,n,o),o=bt,(Ts===null?o.memoizedState:Ts.next)===null&&(o=o.alternate,Q.H=o===null||o.memoizedState===null?T0:Eh),n}function Nc(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return al(n);if(n.$$typeof===L)return Fs(n)}throw Error(s(438,String(n)))}function hh(n){var o=null,h=bt.updateQueue;if(h!==null&&(o=h.memoCache),o==null){var p=bt.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(o={data:p.data.map(function(b){return b.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),h===null&&(h=wc(),bt.updateQueue=h),h.memoCache=o,h=o.data[o.index],h===void 0)for(h=o.data[o.index]=Array(n),p=0;p<n;p++)h[p]=I;return o.index++,h}function Mn(n,o){return typeof o=="function"?o(n):o}function Rc(n){var o=xs();return fh(o,qt,n)}function fh(n,o,h){var p=n.queue;if(p===null)throw Error(s(311));p.lastRenderedReducer=h;var b=n.baseQueue,T=p.pending;if(T!==null){if(b!==null){var P=b.next;b.next=T.next,T.next=P}o.baseQueue=b=T,p.pending=null}if(T=n.baseState,b===null)n.memoizedState=T;else{o=b.next;var W=P=null,ce=null,Te=o,Me=!1;do{var Pe=Te.lane&-536870913;if(Pe!==Te.lane?(Dt&Pe)===Pe:(kn&Pe)===Pe){var Ne=Te.revertLane;if(Ne===0)ce!==null&&(ce=ce.next={lane:0,revertLane:0,gesture:null,action:Te.action,hasEagerState:Te.hasEagerState,eagerState:Te.eagerState,next:null}),Pe===Vr&&(Me=!0);else if((kn&Ne)===Ne){Te=Te.next,Ne===Vr&&(Me=!0);continue}else Pe={lane:0,revertLane:Te.revertLane,gesture:null,action:Te.action,hasEagerState:Te.hasEagerState,eagerState:Te.eagerState,next:null},ce===null?(W=ce=Pe,P=T):ce=ce.next=Pe,bt.lanes|=Ne,ma|=Ne;Pe=Te.action,er&&h(T,Pe),T=Te.hasEagerState?Te.eagerState:h(T,Pe)}else Ne={lane:Pe,revertLane:Te.revertLane,gesture:Te.gesture,action:Te.action,hasEagerState:Te.hasEagerState,eagerState:Te.eagerState,next:null},ce===null?(W=ce=Ne,P=T):ce=ce.next=Ne,bt.lanes|=Pe,ma|=Pe;Te=Te.next}while(Te!==null&&Te!==o);if(ce===null?P=T:ce.next=W,!yi(T,n.memoizedState)&&(As=!0,Me&&(h=Hr,h!==null)))throw h;n.memoizedState=T,n.baseState=P,n.baseQueue=ce,p.lastRenderedState=T}return b===null&&(p.lanes=0),[n.memoizedState,p.dispatch]}function mh(n){var o=xs(),h=o.queue;if(h===null)throw Error(s(311));h.lastRenderedReducer=n;var p=h.dispatch,b=h.pending,T=o.memoizedState;if(b!==null){h.pending=null;var P=b=b.next;do T=n(T,P.action),P=P.next;while(P!==b);yi(T,o.memoizedState)||(As=!0),o.memoizedState=T,o.baseQueue===null&&(o.baseState=T),h.lastRenderedState=T}return[T,p]}function Hp(n,o,h){var p=bt,b=xs(),T=Mt;if(T){if(h===void 0)throw Error(s(407));h=h()}else h=o();var P=!yi((qt||b).memoizedState,h);if(P&&(b.memoizedState=h,As=!0),b=b.queue,yh(qp.bind(null,p,b,n),[n]),b.getSnapshot!==o||P||Ts!==null&&Ts.memoizedState.tag&1){if(p.flags|=2048,Xr(9,{destroy:void 0},zp.bind(null,p,b,h,o),null),Qt===null)throw Error(s(349));T||(kn&127)!==0||Kp(p,o,h)}return h}function Kp(n,o,h){n.flags|=16384,n={getSnapshot:o,value:h},o=bt.updateQueue,o===null?(o=wc(),bt.updateQueue=o,o.stores=[n]):(h=o.stores,h===null?o.stores=[n]:h.push(n))}function zp(n,o,h,p){o.value=h,o.getSnapshot=p,Yp(o)&&Wp(n)}function qp(n,o,h){return h(function(){Yp(o)&&Wp(n)})}function Yp(n){var o=n.getSnapshot;n=n.value;try{var h=o();return!yi(n,h)}catch{return!0}}function Wp(n){var o=Ka(n,2);o!==null&&ci(o,n,2)}function gh(n){var o=ei();if(typeof n=="function"){var h=n;if(n=h(),er){Lt(!0);try{h()}finally{Lt(!1)}}}return o.memoizedState=o.baseState=n,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Mn,lastRenderedState:n},o}function Xp(n,o,h,p){return n.baseState=h,fh(n,qt,typeof p=="function"?p:Mn)}function $1(n,o,h,p,b){if(Dc(n))throw Error(s(485));if(n=o.action,n!==null){var T={payload:b,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(P){T.listeners.push(P)}};Q.T!==null?h(!0):T.isTransition=!1,p(T),h=o.pending,h===null?(T.next=o.pending=T,Qp(o,T)):(T.next=h.next,o.pending=h.next=T)}}function Qp(n,o){var h=o.action,p=o.payload,b=n.state;if(o.isTransition){var T=Q.T,P={};Q.T=P;try{var W=h(b,p),ce=Q.S;ce!==null&&ce(P,W),Zp(n,o,W)}catch(Te){ph(n,o,Te)}finally{T!==null&&P.types!==null&&(T.types=P.types),Q.T=T}}else try{T=h(b,p),Zp(n,o,T)}catch(Te){ph(n,o,Te)}}function Zp(n,o,h){h!==null&&typeof h=="object"&&typeof h.then=="function"?h.then(function(p){Jp(n,o,p)},function(p){return ph(n,o,p)}):Jp(n,o,h)}function Jp(n,o,h){o.status="fulfilled",o.value=h,e0(o),n.state=h,o=n.pending,o!==null&&(h=o.next,h===o?n.pending=null:(h=h.next,o.next=h,Qp(n,h)))}function ph(n,o,h){var p=n.pending;if(n.pending=null,p!==null){p=p.next;do o.status="rejected",o.reason=h,e0(o),o=o.next;while(o!==p)}n.action=null}function e0(n){n=n.listeners;for(var o=0;o<n.length;o++)(0,n[o])()}function t0(n,o){return o}function s0(n,o){if(Mt){var h=Qt.formState;if(h!==null){e:{var p=bt;if(Mt){if(ts){t:{for(var b=ts,T=Ui;b.nodeType!==8;){if(!T){b=null;break t}if(b=Gi(b.nextSibling),b===null){b=null;break t}}T=b.data,b=T==="F!"||T==="F"?b:null}if(b){ts=Gi(b.nextSibling),p=b.data==="F!";break e}}aa(p)}p=!1}p&&(o=h[0])}}return h=ei(),h.memoizedState=h.baseState=o,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t0,lastRenderedState:o},h.queue=p,h=b0.bind(null,bt,p),p.dispatch=h,p=gh(!1),T=Sh.bind(null,bt,!1,p.queue),p=ei(),b={state:o,dispatch:null,action:n,pending:null},p.queue=b,h=$1.bind(null,bt,b,T,h),b.dispatch=h,p.memoizedState=n,[o,h,!1]}function i0(n){var o=xs();return n0(o,qt,n)}function n0(n,o,h){if(o=fh(n,o,t0)[0],n=Rc(Mn)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var p=al(o)}catch(P){throw P===Kr?xc:P}else p=o;o=xs();var b=o.queue,T=b.dispatch;return h!==o.memoizedState&&(bt.flags|=2048,Xr(9,{destroy:void 0},V1.bind(null,b,h),null)),[p,T,n]}function V1(n,o){n.action=o}function a0(n){var o=xs(),h=qt;if(h!==null)return n0(o,h,n);xs(),o=o.memoizedState,h=xs();var p=h.queue.dispatch;return h.memoizedState=n,[o,p,!1]}function Xr(n,o,h,p){return n={tag:n,create:h,deps:p,inst:o,next:null},o=bt.updateQueue,o===null&&(o=wc(),bt.updateQueue=o),h=o.lastEffect,h===null?o.lastEffect=n.next=n:(p=h.next,h.next=n,n.next=p,o.lastEffect=n),n}function r0(){return xs().memoizedState}function Cc(n,o,h,p){var b=ei();bt.flags|=n,b.memoizedState=Xr(1|o,{destroy:void 0},h,p===void 0?null:p)}function Lc(n,o,h,p){var b=xs();p=p===void 0?null:p;var T=b.memoizedState.inst;qt!==null&&p!==null&&oh(p,qt.memoizedState.deps)?b.memoizedState=Xr(o,T,h,p):(bt.flags|=n,b.memoizedState=Xr(1|o,T,h,p))}function o0(n,o){Cc(8390656,8,n,o)}function yh(n,o){Lc(2048,8,n,o)}function H1(n){bt.flags|=4;var o=bt.updateQueue;if(o===null)o=wc(),bt.updateQueue=o,o.events=[n];else{var h=o.events;h===null?o.events=[n]:h.push(n)}}function l0(n){var o=xs().memoizedState;return H1({ref:o,nextImpl:n}),function(){if((Gt&2)!==0)throw Error(s(440));return o.impl.apply(void 0,arguments)}}function c0(n,o){return Lc(4,2,n,o)}function u0(n,o){return Lc(4,4,n,o)}function d0(n,o){if(typeof o=="function"){n=n();var h=o(n);return function(){typeof h=="function"?h():o(null)}}if(o!=null)return n=n(),o.current=n,function(){o.current=null}}function h0(n,o,h){h=h!=null?h.concat([n]):null,Lc(4,4,d0.bind(null,o,n),h)}function xh(){}function f0(n,o){var h=xs();o=o===void 0?null:o;var p=h.memoizedState;return o!==null&&oh(o,p[1])?p[0]:(h.memoizedState=[n,o],n)}function m0(n,o){var h=xs();o=o===void 0?null:o;var p=h.memoizedState;if(o!==null&&oh(o,p[1]))return p[0];if(p=n(),er){Lt(!0);try{n()}finally{Lt(!1)}}return h.memoizedState=[p,o],p}function vh(n,o,h){return h===void 0||(kn&1073741824)!==0&&(Dt&261930)===0?n.memoizedState=o:(n.memoizedState=h,n=gy(),bt.lanes|=n,ma|=n,h)}function g0(n,o,h,p){return yi(h,o)?h:qr.current!==null?(n=vh(n,h,p),yi(n,o)||(As=!0),n):(kn&42)===0||(kn&1073741824)!==0&&(Dt&261930)===0?(As=!0,n.memoizedState=h):(n=gy(),bt.lanes|=n,ma|=n,o)}function p0(n,o,h,p,b){var T=se.p;se.p=T!==0&&8>T?T:8;var P=Q.T,W={};Q.T=W,Sh(n,!1,o,h);try{var ce=b(),Te=Q.S;if(Te!==null&&Te(W,ce),ce!==null&&typeof ce=="object"&&typeof ce.then=="function"){var Me=U1(ce,p);rl(n,o,Me,Ei(n))}else rl(n,o,p,Ei(n))}catch(Pe){rl(n,o,{then:function(){},status:"rejected",reason:Pe},Ei())}finally{se.p=T,P!==null&&W.types!==null&&(P.types=W.types),Q.T=P}}function K1(){}function _h(n,o,h,p){if(n.tag!==5)throw Error(s(476));var b=y0(n).queue;p0(n,b,o,oe,h===null?K1:function(){return x0(n),h(p)})}function y0(n){var o=n.memoizedState;if(o!==null)return o;o={memoizedState:oe,baseState:oe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Mn,lastRenderedState:oe},next:null};var h={};return o.next={memoizedState:h,baseState:h,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Mn,lastRenderedState:h},next:null},n.memoizedState=o,n=n.alternate,n!==null&&(n.memoizedState=o),o}function x0(n){var o=y0(n);o.next===null&&(o=n.alternate.memoizedState),rl(n,o.next.queue,{},Ei())}function bh(){return Fs(El)}function v0(){return xs().memoizedState}function _0(){return xs().memoizedState}function z1(n){for(var o=n.return;o!==null;){switch(o.tag){case 24:case 3:var h=Ei();n=la(h);var p=ca(o,n,h);p!==null&&(ci(p,o,h),tl(p,o,h)),o={cache:Xd()},n.payload=o;return}o=o.return}}function q1(n,o,h){var p=Ei();h={lane:p,revertLane:0,gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null},Dc(n)?S0(o,h):(h=Ud(n,o,h,p),h!==null&&(ci(h,n,p),E0(h,o,p)))}function b0(n,o,h){var p=Ei();rl(n,o,h,p)}function rl(n,o,h,p){var b={lane:p,revertLane:0,gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null};if(Dc(n))S0(o,b);else{var T=n.alternate;if(n.lanes===0&&(T===null||T.lanes===0)&&(T=o.lastRenderedReducer,T!==null))try{var P=o.lastRenderedState,W=T(P,h);if(b.hasEagerState=!0,b.eagerState=W,yi(W,P))return dc(n,o,b,0),Qt===null&&uc(),!1}catch{}finally{}if(h=Ud(n,o,b,p),h!==null)return ci(h,n,p),E0(h,o,p),!0}return!1}function Sh(n,o,h,p){if(p={lane:2,revertLane:ef(),gesture:null,action:p,hasEagerState:!1,eagerState:null,next:null},Dc(n)){if(o)throw Error(s(479))}else o=Ud(n,h,p,2),o!==null&&ci(o,n,2)}function Dc(n){var o=n.alternate;return n===bt||o!==null&&o===bt}function S0(n,o){Yr=Tc=!0;var h=n.pending;h===null?o.next=o:(o.next=h.next,h.next=o),n.pending=o}function E0(n,o,h){if((h&4194048)!==0){var p=o.lanes;p&=n.pendingLanes,h|=p,o.lanes=h,Ii(n,h)}}var ol={readContext:Fs,use:Nc,useCallback:fs,useContext:fs,useEffect:fs,useImperativeHandle:fs,useLayoutEffect:fs,useInsertionEffect:fs,useMemo:fs,useReducer:fs,useRef:fs,useState:fs,useDebugValue:fs,useDeferredValue:fs,useTransition:fs,useSyncExternalStore:fs,useId:fs,useHostTransitionStatus:fs,useFormState:fs,useActionState:fs,useOptimistic:fs,useMemoCache:fs,useCacheRefresh:fs};ol.useEffectEvent=fs;var T0={readContext:Fs,use:Nc,useCallback:function(n,o){return ei().memoizedState=[n,o===void 0?null:o],n},useContext:Fs,useEffect:o0,useImperativeHandle:function(n,o,h){h=h!=null?h.concat([n]):null,Cc(4194308,4,d0.bind(null,o,n),h)},useLayoutEffect:function(n,o){return Cc(4194308,4,n,o)},useInsertionEffect:function(n,o){Cc(4,2,n,o)},useMemo:function(n,o){var h=ei();o=o===void 0?null:o;var p=n();if(er){Lt(!0);try{n()}finally{Lt(!1)}}return h.memoizedState=[p,o],p},useReducer:function(n,o,h){var p=ei();if(h!==void 0){var b=h(o);if(er){Lt(!0);try{h(o)}finally{Lt(!1)}}}else b=o;return p.memoizedState=p.baseState=b,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:b},p.queue=n,n=n.dispatch=q1.bind(null,bt,n),[p.memoizedState,n]},useRef:function(n){var o=ei();return n={current:n},o.memoizedState=n},useState:function(n){n=gh(n);var o=n.queue,h=b0.bind(null,bt,o);return o.dispatch=h,[n.memoizedState,h]},useDebugValue:xh,useDeferredValue:function(n,o){var h=ei();return vh(h,n,o)},useTransition:function(){var n=gh(!1);return n=p0.bind(null,bt,n.queue,!0,!1),ei().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,o,h){var p=bt,b=ei();if(Mt){if(h===void 0)throw Error(s(407));h=h()}else{if(h=o(),Qt===null)throw Error(s(349));(Dt&127)!==0||Kp(p,o,h)}b.memoizedState=h;var T={value:h,getSnapshot:o};return b.queue=T,o0(qp.bind(null,p,T,n),[n]),p.flags|=2048,Xr(9,{destroy:void 0},zp.bind(null,p,T,h,o),null),h},useId:function(){var n=ei(),o=Qt.identifierPrefix;if(Mt){var h=dn,p=un;h=(p&~(1<<32-ds(p)-1)).toString(32)+h,o="_"+o+"R_"+h,h=Ac++,0<h&&(o+="H"+h.toString(32)),o+="_"}else h=F1++,o="_"+o+"r_"+h.toString(32)+"_";return n.memoizedState=o},useHostTransitionStatus:bh,useFormState:s0,useActionState:s0,useOptimistic:function(n){var o=ei();o.memoizedState=o.baseState=n;var h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=h,o=Sh.bind(null,bt,!0,h),h.dispatch=o,[n,o]},useMemoCache:hh,useCacheRefresh:function(){return ei().memoizedState=z1.bind(null,bt)},useEffectEvent:function(n){var o=ei(),h={impl:n};return o.memoizedState=h,function(){if((Gt&2)!==0)throw Error(s(440));return h.impl.apply(void 0,arguments)}}},Eh={readContext:Fs,use:Nc,useCallback:f0,useContext:Fs,useEffect:yh,useImperativeHandle:h0,useInsertionEffect:c0,useLayoutEffect:u0,useMemo:m0,useReducer:Rc,useRef:r0,useState:function(){return Rc(Mn)},useDebugValue:xh,useDeferredValue:function(n,o){var h=xs();return g0(h,qt.memoizedState,n,o)},useTransition:function(){var n=Rc(Mn)[0],o=xs().memoizedState;return[typeof n=="boolean"?n:al(n),o]},useSyncExternalStore:Hp,useId:v0,useHostTransitionStatus:bh,useFormState:i0,useActionState:i0,useOptimistic:function(n,o){var h=xs();return Xp(h,qt,n,o)},useMemoCache:hh,useCacheRefresh:_0};Eh.useEffectEvent=l0;var A0={readContext:Fs,use:Nc,useCallback:f0,useContext:Fs,useEffect:yh,useImperativeHandle:h0,useInsertionEffect:c0,useLayoutEffect:u0,useMemo:m0,useReducer:mh,useRef:r0,useState:function(){return mh(Mn)},useDebugValue:xh,useDeferredValue:function(n,o){var h=xs();return qt===null?vh(h,n,o):g0(h,qt.memoizedState,n,o)},useTransition:function(){var n=mh(Mn)[0],o=xs().memoizedState;return[typeof n=="boolean"?n:al(n),o]},useSyncExternalStore:Hp,useId:v0,useHostTransitionStatus:bh,useFormState:a0,useActionState:a0,useOptimistic:function(n,o){var h=xs();return qt!==null?Xp(h,qt,n,o):(h.baseState=n,[n,h.queue.dispatch])},useMemoCache:hh,useCacheRefresh:_0};A0.useEffectEvent=l0;function Th(n,o,h,p){o=n.memoizedState,h=h(p,o),h=h==null?o:g({},o,h),n.memoizedState=h,n.lanes===0&&(n.updateQueue.baseState=h)}var Ah={enqueueSetState:function(n,o,h){n=n._reactInternals;var p=Ei(),b=la(p);b.payload=o,h!=null&&(b.callback=h),o=ca(n,b,p),o!==null&&(ci(o,n,p),tl(o,n,p))},enqueueReplaceState:function(n,o,h){n=n._reactInternals;var p=Ei(),b=la(p);b.tag=1,b.payload=o,h!=null&&(b.callback=h),o=ca(n,b,p),o!==null&&(ci(o,n,p),tl(o,n,p))},enqueueForceUpdate:function(n,o){n=n._reactInternals;var h=Ei(),p=la(h);p.tag=2,o!=null&&(p.callback=o),o=ca(n,p,h),o!==null&&(ci(o,n,h),tl(o,n,h))}};function w0(n,o,h,p,b,T,P){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(p,T,P):o.prototype&&o.prototype.isPureReactComponent?!qo(h,p)||!qo(b,T):!0}function N0(n,o,h,p){n=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(h,p),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(h,p),o.state!==n&&Ah.enqueueReplaceState(o,o.state,null)}function tr(n,o){var h=o;if("ref"in o){h={};for(var p in o)p!=="ref"&&(h[p]=o[p])}if(n=n.defaultProps){h===o&&(h=g({},h));for(var b in n)h[b]===void 0&&(h[b]=n[b])}return h}function R0(n){cc(n)}function C0(n){console.error(n)}function L0(n){cc(n)}function Ic(n,o){try{var h=n.onUncaughtError;h(o.value,{componentStack:o.stack})}catch(p){setTimeout(function(){throw p})}}function D0(n,o,h){try{var p=n.onCaughtError;p(h.value,{componentStack:h.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function wh(n,o,h){return h=la(h),h.tag=3,h.payload={element:null},h.callback=function(){Ic(n,o)},h}function I0(n){return n=la(n),n.tag=3,n}function k0(n,o,h,p){var b=h.type.getDerivedStateFromError;if(typeof b=="function"){var T=p.value;n.payload=function(){return b(T)},n.callback=function(){D0(o,h,p)}}var P=h.stateNode;P!==null&&typeof P.componentDidCatch=="function"&&(n.callback=function(){D0(o,h,p),typeof b!="function"&&(ga===null?ga=new Set([this]):ga.add(this));var W=p.stack;this.componentDidCatch(p.value,{componentStack:W!==null?W:""})})}function Y1(n,o,h,p,b){if(h.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(o=h.alternate,o!==null&&$r(o,h,b,!0),h=vi.current,h!==null){switch(h.tag){case 31:case 13:return Fi===null?Hc():h.alternate===null&&ms===0&&(ms=3),h.flags&=-257,h.flags|=65536,h.lanes=b,p===vc?h.flags|=16384:(o=h.updateQueue,o===null?h.updateQueue=new Set([p]):o.add(p),Qh(n,p,b)),!1;case 22:return h.flags|=65536,p===vc?h.flags|=16384:(o=h.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([p])},h.updateQueue=o):(h=o.retryQueue,h===null?o.retryQueue=new Set([p]):h.add(p)),Qh(n,p,b)),!1}throw Error(s(435,h.tag))}return Qh(n,p,b),Hc(),!1}if(Mt)return o=vi.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=b,p!==Kd&&(n=Error(s(422),{cause:p}),Xo(Oi(n,h)))):(p!==Kd&&(o=Error(s(423),{cause:p}),Xo(Oi(o,h))),n=n.current.alternate,n.flags|=65536,b&=-b,n.lanes|=b,p=Oi(p,h),b=wh(n.stateNode,p,b),sh(n,b),ms!==4&&(ms=2)),!1;var T=Error(s(520),{cause:p});if(T=Oi(T,h),gl===null?gl=[T]:gl.push(T),ms!==4&&(ms=2),o===null)return!0;p=Oi(p,h),h=o;do{switch(h.tag){case 3:return h.flags|=65536,n=b&-b,h.lanes|=n,n=wh(h.stateNode,p,n),sh(h,n),!1;case 1:if(o=h.type,T=h.stateNode,(h.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(ga===null||!ga.has(T))))return h.flags|=65536,b&=-b,h.lanes|=b,b=I0(b),k0(b,n,h,p),sh(h,b),!1}h=h.return}while(h!==null);return!1}var Nh=Error(s(461)),As=!1;function Gs(n,o,h,p){o.child=n===null?Pp(o,null,h,p):Ja(o,n.child,h,p)}function M0(n,o,h,p,b){h=h.render;var T=o.ref;if("ref"in p){var P={};for(var W in p)W!=="ref"&&(P[W]=p[W])}else P=p;return Wa(o),p=lh(n,o,h,P,T,b),W=ch(),n!==null&&!As?(uh(n,o,b),jn(n,o,b)):(Mt&&W&&Vd(o),o.flags|=1,Gs(n,o,p,b),o.child)}function j0(n,o,h,p,b){if(n===null){var T=h.type;return typeof T=="function"&&!Fd(T)&&T.defaultProps===void 0&&h.compare===null?(o.tag=15,o.type=T,O0(n,o,T,p,b)):(n=fc(h.type,null,p,o,o.mode,b),n.ref=o.ref,n.return=o,o.child=n)}if(T=n.child,!jh(n,b)){var P=T.memoizedProps;if(h=h.compare,h=h!==null?h:qo,h(P,p)&&n.ref===o.ref)return jn(n,o,b)}return o.flags|=1,n=Cn(T,p),n.ref=o.ref,n.return=o,o.child=n}function O0(n,o,h,p,b){if(n!==null){var T=n.memoizedProps;if(qo(T,p)&&n.ref===o.ref)if(As=!1,o.pendingProps=p=T,jh(n,b))(n.flags&131072)!==0&&(As=!0);else return o.lanes=n.lanes,jn(n,o,b)}return Rh(n,o,h,p,b)}function P0(n,o,h,p){var b=p.children,T=n!==null?n.memoizedState:null;if(n===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),p.mode==="hidden"){if((o.flags&128)!==0){if(T=T!==null?T.baseLanes|h:h,n!==null){for(p=o.child=n.child,b=0;p!==null;)b=b|p.lanes|p.childLanes,p=p.sibling;p=b&~T}else p=0,o.child=null;return B0(n,o,T,h,p)}if((h&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},n!==null&&yc(o,T!==null?T.cachePool:null),T!==null?Fp(o,T):nh(),Gp(o);else return p=o.lanes=536870912,B0(n,o,T!==null?T.baseLanes|h:h,h,p)}else T!==null?(yc(o,T.cachePool),Fp(o,T),da(),o.memoizedState=null):(n!==null&&yc(o,null),nh(),da());return Gs(n,o,b,h),o.child}function ll(n,o){return n!==null&&n.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function B0(n,o,h,p,b){var T=Zd();return T=T===null?null:{parent:Es._currentValue,pool:T},o.memoizedState={baseLanes:h,cachePool:T},n!==null&&yc(o,null),nh(),Gp(o),n!==null&&$r(n,o,p,!0),o.childLanes=b,null}function kc(n,o){return o=jc({mode:o.mode,children:o.children},n.mode),o.ref=n.ref,n.child=o,o.return=n,o}function U0(n,o,h){return Ja(o,n.child,null,h),n=kc(o,o.pendingProps),n.flags|=2,_i(o),o.memoizedState=null,n}function W1(n,o,h){var p=o.pendingProps,b=(o.flags&128)!==0;if(o.flags&=-129,n===null){if(Mt){if(p.mode==="hidden")return n=kc(o,p),o.lanes=536870912,ll(null,n);if(rh(o),(n=ts)?(n=Qy(n,Ui),n=n!==null&&n.data==="&"?n:null,n!==null&&(o.memoizedState={dehydrated:n,treeContext:ia!==null?{id:un,overflow:dn}:null,retryLane:536870912,hydrationErrors:null},h=Sp(n),h.return=o,o.child=h,Us=o,ts=null)):n=null,n===null)throw aa(o);return o.lanes=536870912,null}return kc(o,p)}var T=n.memoizedState;if(T!==null){var P=T.dehydrated;if(rh(o),b)if(o.flags&256)o.flags&=-257,o=U0(n,o,h);else if(o.memoizedState!==null)o.child=n.child,o.flags|=128,o=null;else throw Error(s(558));else if(As||$r(n,o,h,!1),b=(h&n.childLanes)!==0,As||b){if(p=Qt,p!==null&&(P=Po(p,h),P!==0&&P!==T.retryLane))throw T.retryLane=P,Ka(n,P),ci(p,n,P),Nh;Hc(),o=U0(n,o,h)}else n=T.treeContext,ts=Gi(P.nextSibling),Us=o,Mt=!0,na=null,Ui=!1,n!==null&&Ap(o,n),o=kc(o,p),o.flags|=4096;return o}return n=Cn(n.child,{mode:p.mode,children:p.children}),n.ref=o.ref,o.child=n,n.return=o,n}function Mc(n,o){var h=o.ref;if(h===null)n!==null&&n.ref!==null&&(o.flags|=4194816);else{if(typeof h!="function"&&typeof h!="object")throw Error(s(284));(n===null||n.ref!==h)&&(o.flags|=4194816)}}function Rh(n,o,h,p,b){return Wa(o),h=lh(n,o,h,p,void 0,b),p=ch(),n!==null&&!As?(uh(n,o,b),jn(n,o,b)):(Mt&&p&&Vd(o),o.flags|=1,Gs(n,o,h,b),o.child)}function F0(n,o,h,p,b,T){return Wa(o),o.updateQueue=null,h=Vp(o,p,h,b),$p(n),p=ch(),n!==null&&!As?(uh(n,o,T),jn(n,o,T)):(Mt&&p&&Vd(o),o.flags|=1,Gs(n,o,h,T),o.child)}function G0(n,o,h,p,b){if(Wa(o),o.stateNode===null){var T=Br,P=h.contextType;typeof P=="object"&&P!==null&&(T=Fs(P)),T=new h(p,T),o.memoizedState=T.state!==null&&T.state!==void 0?T.state:null,T.updater=Ah,o.stateNode=T,T._reactInternals=o,T=o.stateNode,T.props=p,T.state=o.memoizedState,T.refs={},eh(o),P=h.contextType,T.context=typeof P=="object"&&P!==null?Fs(P):Br,T.state=o.memoizedState,P=h.getDerivedStateFromProps,typeof P=="function"&&(Th(o,h,P,p),T.state=o.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof T.getSnapshotBeforeUpdate=="function"||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(P=T.state,typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount(),P!==T.state&&Ah.enqueueReplaceState(T,T.state,null),il(o,p,T,b),sl(),T.state=o.memoizedState),typeof T.componentDidMount=="function"&&(o.flags|=4194308),p=!0}else if(n===null){T=o.stateNode;var W=o.memoizedProps,ce=tr(h,W);T.props=ce;var Te=T.context,Me=h.contextType;P=Br,typeof Me=="object"&&Me!==null&&(P=Fs(Me));var Pe=h.getDerivedStateFromProps;Me=typeof Pe=="function"||typeof T.getSnapshotBeforeUpdate=="function",W=o.pendingProps!==W,Me||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(W||Te!==P)&&N0(o,T,p,P),oa=!1;var Ne=o.memoizedState;T.state=Ne,il(o,p,T,b),sl(),Te=o.memoizedState,W||Ne!==Te||oa?(typeof Pe=="function"&&(Th(o,h,Pe,p),Te=o.memoizedState),(ce=oa||w0(o,h,ce,p,Ne,Te,P))?(Me||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(o.flags|=4194308)):(typeof T.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=p,o.memoizedState=Te),T.props=p,T.state=Te,T.context=P,p=ce):(typeof T.componentDidMount=="function"&&(o.flags|=4194308),p=!1)}else{T=o.stateNode,th(n,o),P=o.memoizedProps,Me=tr(h,P),T.props=Me,Pe=o.pendingProps,Ne=T.context,Te=h.contextType,ce=Br,typeof Te=="object"&&Te!==null&&(ce=Fs(Te)),W=h.getDerivedStateFromProps,(Te=typeof W=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(P!==Pe||Ne!==ce)&&N0(o,T,p,ce),oa=!1,Ne=o.memoizedState,T.state=Ne,il(o,p,T,b),sl();var Ce=o.memoizedState;P!==Pe||Ne!==Ce||oa||n!==null&&n.dependencies!==null&&gc(n.dependencies)?(typeof W=="function"&&(Th(o,h,W,p),Ce=o.memoizedState),(Me=oa||w0(o,h,Me,p,Ne,Ce,ce)||n!==null&&n.dependencies!==null&&gc(n.dependencies))?(Te||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(p,Ce,ce),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(p,Ce,ce)),typeof T.componentDidUpdate=="function"&&(o.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof T.componentDidUpdate!="function"||P===n.memoizedProps&&Ne===n.memoizedState||(o.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||P===n.memoizedProps&&Ne===n.memoizedState||(o.flags|=1024),o.memoizedProps=p,o.memoizedState=Ce),T.props=p,T.state=Ce,T.context=ce,p=Me):(typeof T.componentDidUpdate!="function"||P===n.memoizedProps&&Ne===n.memoizedState||(o.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||P===n.memoizedProps&&Ne===n.memoizedState||(o.flags|=1024),p=!1)}return T=p,Mc(n,o),p=(o.flags&128)!==0,T||p?(T=o.stateNode,h=p&&typeof h.getDerivedStateFromError!="function"?null:T.render(),o.flags|=1,n!==null&&p?(o.child=Ja(o,n.child,null,b),o.child=Ja(o,null,h,b)):Gs(n,o,h,b),o.memoizedState=T.state,n=o.child):n=jn(n,o,b),n}function $0(n,o,h,p){return qa(),o.flags|=256,Gs(n,o,h,p),o.child}var Ch={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Lh(n){return{baseLanes:n,cachePool:Dp()}}function Dh(n,o,h){return n=n!==null?n.childLanes&~h:0,o&&(n|=Si),n}function V0(n,o,h){var p=o.pendingProps,b=!1,T=(o.flags&128)!==0,P;if((P=T)||(P=n!==null&&n.memoizedState===null?!1:(ys.current&2)!==0),P&&(b=!0,o.flags&=-129),P=(o.flags&32)!==0,o.flags&=-33,n===null){if(Mt){if(b?ua(o):da(),(n=ts)?(n=Qy(n,Ui),n=n!==null&&n.data!=="&"?n:null,n!==null&&(o.memoizedState={dehydrated:n,treeContext:ia!==null?{id:un,overflow:dn}:null,retryLane:536870912,hydrationErrors:null},h=Sp(n),h.return=o,o.child=h,Us=o,ts=null)):n=null,n===null)throw aa(o);return mf(n)?o.lanes=32:o.lanes=536870912,null}var W=p.children;return p=p.fallback,b?(da(),b=o.mode,W=jc({mode:"hidden",children:W},b),p=za(p,b,h,null),W.return=o,p.return=o,W.sibling=p,o.child=W,p=o.child,p.memoizedState=Lh(h),p.childLanes=Dh(n,P,h),o.memoizedState=Ch,ll(null,p)):(ua(o),Ih(o,W))}var ce=n.memoizedState;if(ce!==null&&(W=ce.dehydrated,W!==null)){if(T)o.flags&256?(ua(o),o.flags&=-257,o=kh(n,o,h)):o.memoizedState!==null?(da(),o.child=n.child,o.flags|=128,o=null):(da(),W=p.fallback,b=o.mode,p=jc({mode:"visible",children:p.children},b),W=za(W,b,h,null),W.flags|=2,p.return=o,W.return=o,p.sibling=W,o.child=p,Ja(o,n.child,null,h),p=o.child,p.memoizedState=Lh(h),p.childLanes=Dh(n,P,h),o.memoizedState=Ch,o=ll(null,p));else if(ua(o),mf(W)){if(P=W.nextSibling&&W.nextSibling.dataset,P)var Te=P.dgst;P=Te,p=Error(s(419)),p.stack="",p.digest=P,Xo({value:p,source:null,stack:null}),o=kh(n,o,h)}else if(As||$r(n,o,h,!1),P=(h&n.childLanes)!==0,As||P){if(P=Qt,P!==null&&(p=Po(P,h),p!==0&&p!==ce.retryLane))throw ce.retryLane=p,Ka(n,p),ci(P,n,p),Nh;ff(W)||Hc(),o=kh(n,o,h)}else ff(W)?(o.flags|=192,o.child=n.child,o=null):(n=ce.treeContext,ts=Gi(W.nextSibling),Us=o,Mt=!0,na=null,Ui=!1,n!==null&&Ap(o,n),o=Ih(o,p.children),o.flags|=4096);return o}return b?(da(),W=p.fallback,b=o.mode,ce=n.child,Te=ce.sibling,p=Cn(ce,{mode:"hidden",children:p.children}),p.subtreeFlags=ce.subtreeFlags&65011712,Te!==null?W=Cn(Te,W):(W=za(W,b,h,null),W.flags|=2),W.return=o,p.return=o,p.sibling=W,o.child=p,ll(null,p),p=o.child,W=n.child.memoizedState,W===null?W=Lh(h):(b=W.cachePool,b!==null?(ce=Es._currentValue,b=b.parent!==ce?{parent:ce,pool:ce}:b):b=Dp(),W={baseLanes:W.baseLanes|h,cachePool:b}),p.memoizedState=W,p.childLanes=Dh(n,P,h),o.memoizedState=Ch,ll(n.child,p)):(ua(o),h=n.child,n=h.sibling,h=Cn(h,{mode:"visible",children:p.children}),h.return=o,h.sibling=null,n!==null&&(P=o.deletions,P===null?(o.deletions=[n],o.flags|=16):P.push(n)),o.child=h,o.memoizedState=null,h)}function Ih(n,o){return o=jc({mode:"visible",children:o},n.mode),o.return=n,n.child=o}function jc(n,o){return n=xi(22,n,null,o),n.lanes=0,n}function kh(n,o,h){return Ja(o,n.child,null,h),n=Ih(o,o.pendingProps.children),n.flags|=2,o.memoizedState=null,n}function H0(n,o,h){n.lanes|=o;var p=n.alternate;p!==null&&(p.lanes|=o),Yd(n.return,o,h)}function Mh(n,o,h,p,b,T){var P=n.memoizedState;P===null?n.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:p,tail:h,tailMode:b,treeForkCount:T}:(P.isBackwards=o,P.rendering=null,P.renderingStartTime=0,P.last=p,P.tail=h,P.tailMode=b,P.treeForkCount=T)}function K0(n,o,h){var p=o.pendingProps,b=p.revealOrder,T=p.tail;p=p.children;var P=ys.current,W=(P&2)!==0;if(W?(P=P&1|2,o.flags|=128):P&=1,me(ys,P),Gs(n,o,p,h),p=Mt?Wo:0,!W&&n!==null&&(n.flags&128)!==0)e:for(n=o.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&H0(n,h,o);else if(n.tag===19)H0(n,h,o);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===o)break e;for(;n.sibling===null;){if(n.return===null||n.return===o)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}switch(b){case"forwards":for(h=o.child,b=null;h!==null;)n=h.alternate,n!==null&&Ec(n)===null&&(b=h),h=h.sibling;h=b,h===null?(b=o.child,o.child=null):(b=h.sibling,h.sibling=null),Mh(o,!1,b,h,T,p);break;case"backwards":case"unstable_legacy-backwards":for(h=null,b=o.child,o.child=null;b!==null;){if(n=b.alternate,n!==null&&Ec(n)===null){o.child=b;break}n=b.sibling,b.sibling=h,h=b,b=n}Mh(o,!0,h,null,T,p);break;case"together":Mh(o,!1,null,null,void 0,p);break;default:o.memoizedState=null}return o.child}function jn(n,o,h){if(n!==null&&(o.dependencies=n.dependencies),ma|=o.lanes,(h&o.childLanes)===0)if(n!==null){if($r(n,o,h,!1),(h&o.childLanes)===0)return null}else return null;if(n!==null&&o.child!==n.child)throw Error(s(153));if(o.child!==null){for(n=o.child,h=Cn(n,n.pendingProps),o.child=h,h.return=o;n.sibling!==null;)n=n.sibling,h=h.sibling=Cn(n,n.pendingProps),h.return=o;h.sibling=null}return o.child}function jh(n,o){return(n.lanes&o)!==0?!0:(n=n.dependencies,!!(n!==null&&gc(n)))}function X1(n,o,h){switch(o.tag){case 3:ye(o,o.stateNode.containerInfo),ra(o,Es,n.memoizedState.cache),qa();break;case 27:case 5:Ue(o);break;case 4:ye(o,o.stateNode.containerInfo);break;case 10:ra(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,rh(o),null;break;case 13:var p=o.memoizedState;if(p!==null)return p.dehydrated!==null?(ua(o),o.flags|=128,null):(h&o.child.childLanes)!==0?V0(n,o,h):(ua(o),n=jn(n,o,h),n!==null?n.sibling:null);ua(o);break;case 19:var b=(n.flags&128)!==0;if(p=(h&o.childLanes)!==0,p||($r(n,o,h,!1),p=(h&o.childLanes)!==0),b){if(p)return K0(n,o,h);o.flags|=128}if(b=o.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),me(ys,ys.current),p)break;return null;case 22:return o.lanes=0,P0(n,o,h,o.pendingProps);case 24:ra(o,Es,n.memoizedState.cache)}return jn(n,o,h)}function z0(n,o,h){if(n!==null)if(n.memoizedProps!==o.pendingProps)As=!0;else{if(!jh(n,h)&&(o.flags&128)===0)return As=!1,X1(n,o,h);As=(n.flags&131072)!==0}else As=!1,Mt&&(o.flags&1048576)!==0&&Tp(o,Wo,o.index);switch(o.lanes=0,o.tag){case 16:e:{var p=o.pendingProps;if(n=Qa(o.elementType),o.type=n,typeof n=="function")Fd(n)?(p=tr(n,p),o.tag=1,o=G0(null,o,n,p,h)):(o.tag=0,o=Rh(null,o,n,p,h));else{if(n!=null){var b=n.$$typeof;if(b===O){o.tag=11,o=M0(null,o,n,p,h);break e}else if(b===U){o.tag=14,o=j0(null,o,n,p,h);break e}}throw o=ie(n)||n,Error(s(306,o,""))}}return o;case 0:return Rh(n,o,o.type,o.pendingProps,h);case 1:return p=o.type,b=tr(p,o.pendingProps),G0(n,o,p,b,h);case 3:e:{if(ye(o,o.stateNode.containerInfo),n===null)throw Error(s(387));p=o.pendingProps;var T=o.memoizedState;b=T.element,th(n,o),il(o,p,null,h);var P=o.memoizedState;if(p=P.cache,ra(o,Es,p),p!==T.cache&&Wd(o,[Es],h,!0),sl(),p=P.element,T.isDehydrated)if(T={element:p,isDehydrated:!1,cache:P.cache},o.updateQueue.baseState=T,o.memoizedState=T,o.flags&256){o=$0(n,o,p,h);break e}else if(p!==b){b=Oi(Error(s(424)),o),Xo(b),o=$0(n,o,p,h);break e}else{switch(n=o.stateNode.containerInfo,n.nodeType){case 9:n=n.body;break;default:n=n.nodeName==="HTML"?n.ownerDocument.body:n}for(ts=Gi(n.firstChild),Us=o,Mt=!0,na=null,Ui=!0,h=Pp(o,null,p,h),o.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling}else{if(qa(),p===b){o=jn(n,o,h);break e}Gs(n,o,p,h)}o=o.child}return o;case 26:return Mc(n,o),n===null?(h=ix(o.type,null,o.pendingProps,null))?o.memoizedState=h:Mt||(h=o.type,n=o.pendingProps,p=Qc(ge.current).createElement(h),p[S]=o,p[_]=n,$s(p,h,n),ke(p),o.stateNode=p):o.memoizedState=ix(o.type,n.memoizedProps,o.pendingProps,n.memoizedState),null;case 27:return Ue(o),n===null&&Mt&&(p=o.stateNode=ex(o.type,o.pendingProps,ge.current),Us=o,Ui=!0,b=ts,va(o.type)?(gf=b,ts=Gi(p.firstChild)):ts=b),Gs(n,o,o.pendingProps.children,h),Mc(n,o),n===null&&(o.flags|=4194304),o.child;case 5:return n===null&&Mt&&((b=p=ts)&&(p=wT(p,o.type,o.pendingProps,Ui),p!==null?(o.stateNode=p,Us=o,ts=Gi(p.firstChild),Ui=!1,b=!0):b=!1),b||aa(o)),Ue(o),b=o.type,T=o.pendingProps,P=n!==null?n.memoizedProps:null,p=T.children,uf(b,T)?p=null:P!==null&&uf(b,P)&&(o.flags|=32),o.memoizedState!==null&&(b=lh(n,o,G1,null,null,h),El._currentValue=b),Mc(n,o),Gs(n,o,p,h),o.child;case 6:return n===null&&Mt&&((n=h=ts)&&(h=NT(h,o.pendingProps,Ui),h!==null?(o.stateNode=h,Us=o,ts=null,n=!0):n=!1),n||aa(o)),null;case 13:return V0(n,o,h);case 4:return ye(o,o.stateNode.containerInfo),p=o.pendingProps,n===null?o.child=Ja(o,null,p,h):Gs(n,o,p,h),o.child;case 11:return M0(n,o,o.type,o.pendingProps,h);case 7:return Gs(n,o,o.pendingProps,h),o.child;case 8:return Gs(n,o,o.pendingProps.children,h),o.child;case 12:return Gs(n,o,o.pendingProps.children,h),o.child;case 10:return p=o.pendingProps,ra(o,o.type,p.value),Gs(n,o,p.children,h),o.child;case 9:return b=o.type._context,p=o.pendingProps.children,Wa(o),b=Fs(b),p=p(b),o.flags|=1,Gs(n,o,p,h),o.child;case 14:return j0(n,o,o.type,o.pendingProps,h);case 15:return O0(n,o,o.type,o.pendingProps,h);case 19:return K0(n,o,h);case 31:return W1(n,o,h);case 22:return P0(n,o,h,o.pendingProps);case 24:return Wa(o),p=Fs(Es),n===null?(b=Zd(),b===null&&(b=Qt,T=Xd(),b.pooledCache=T,T.refCount++,T!==null&&(b.pooledCacheLanes|=h),b=T),o.memoizedState={parent:p,cache:b},eh(o),ra(o,Es,b)):((n.lanes&h)!==0&&(th(n,o),il(o,null,null,h),sl()),b=n.memoizedState,T=o.memoizedState,b.parent!==p?(b={parent:p,cache:p},o.memoizedState=b,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=b),ra(o,Es,p)):(p=T.cache,ra(o,Es,p),p!==b.cache&&Wd(o,[Es],h,!0))),Gs(n,o,o.pendingProps.children,h),o.child;case 29:throw o.pendingProps}throw Error(s(156,o.tag))}function On(n){n.flags|=4}function Oh(n,o,h,p,b){if((o=(n.mode&32)!==0)&&(o=!1),o){if(n.flags|=16777216,(b&335544128)===b)if(n.stateNode.complete)n.flags|=8192;else if(vy())n.flags|=8192;else throw Za=vc,Jd}else n.flags&=-16777217}function q0(n,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!lx(o))if(vy())n.flags|=8192;else throw Za=vc,Jd}function Oc(n,o){o!==null&&(n.flags|=4),n.flags&16384&&(o=n.tag!==22?jo():536870912,n.lanes|=o,eo|=o)}function cl(n,o){if(!Mt)switch(n.tailMode){case"hidden":o=n.tail;for(var h=null;o!==null;)o.alternate!==null&&(h=o),o=o.sibling;h===null?n.tail=null:h.sibling=null;break;case"collapsed":h=n.tail;for(var p=null;h!==null;)h.alternate!==null&&(p=h),h=h.sibling;p===null?o||n.tail===null?n.tail=null:n.tail.sibling=null:p.sibling=null}}function ss(n){var o=n.alternate!==null&&n.alternate.child===n.child,h=0,p=0;if(o)for(var b=n.child;b!==null;)h|=b.lanes|b.childLanes,p|=b.subtreeFlags&65011712,p|=b.flags&65011712,b.return=n,b=b.sibling;else for(b=n.child;b!==null;)h|=b.lanes|b.childLanes,p|=b.subtreeFlags,p|=b.flags,b.return=n,b=b.sibling;return n.subtreeFlags|=p,n.childLanes=h,o}function Q1(n,o,h){var p=o.pendingProps;switch(Hd(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ss(o),null;case 1:return ss(o),null;case 3:return h=o.stateNode,p=null,n!==null&&(p=n.memoizedState.cache),o.memoizedState.cache!==p&&(o.flags|=2048),In(Es),Ie(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(n===null||n.child===null)&&(Gr(o)?On(o):n===null||n.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,zd())),ss(o),null;case 26:var b=o.type,T=o.memoizedState;return n===null?(On(o),T!==null?(ss(o),q0(o,T)):(ss(o),Oh(o,b,null,p,h))):T?T!==n.memoizedState?(On(o),ss(o),q0(o,T)):(ss(o),o.flags&=-16777217):(n=n.memoizedProps,n!==p&&On(o),ss(o),Oh(o,b,n,p,h)),null;case 27:if(qe(o),h=ge.current,b=o.type,n!==null&&o.stateNode!=null)n.memoizedProps!==p&&On(o);else{if(!p){if(o.stateNode===null)throw Error(s(166));return ss(o),null}n=ve.current,Gr(o)?wp(o):(n=ex(b,p,h),o.stateNode=n,On(o))}return ss(o),null;case 5:if(qe(o),b=o.type,n!==null&&o.stateNode!=null)n.memoizedProps!==p&&On(o);else{if(!p){if(o.stateNode===null)throw Error(s(166));return ss(o),null}if(T=ve.current,Gr(o))wp(o);else{var P=Qc(ge.current);switch(T){case 1:T=P.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:T=P.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":T=P.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":T=P.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":T=P.createElement("div"),T.innerHTML="<script><\/script>",T=T.removeChild(T.firstChild);break;case"select":T=typeof p.is=="string"?P.createElement("select",{is:p.is}):P.createElement("select"),p.multiple?T.multiple=!0:p.size&&(T.size=p.size);break;default:T=typeof p.is=="string"?P.createElement(b,{is:p.is}):P.createElement(b)}}T[S]=o,T[_]=p;e:for(P=o.child;P!==null;){if(P.tag===5||P.tag===6)T.appendChild(P.stateNode);else if(P.tag!==4&&P.tag!==27&&P.child!==null){P.child.return=P,P=P.child;continue}if(P===o)break e;for(;P.sibling===null;){if(P.return===null||P.return===o)break e;P=P.return}P.sibling.return=P.return,P=P.sibling}o.stateNode=T;e:switch($s(T,b,p),b){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}p&&On(o)}}return ss(o),Oh(o,o.type,n===null?null:n.memoizedProps,o.pendingProps,h),null;case 6:if(n&&o.stateNode!=null)n.memoizedProps!==p&&On(o);else{if(typeof p!="string"&&o.stateNode===null)throw Error(s(166));if(n=ge.current,Gr(o)){if(n=o.stateNode,h=o.memoizedProps,p=null,b=Us,b!==null)switch(b.tag){case 27:case 5:p=b.memoizedProps}n[S]=o,n=!!(n.nodeValue===h||p!==null&&p.suppressHydrationWarning===!0||Vy(n.nodeValue,h)),n||aa(o,!0)}else n=Qc(n).createTextNode(p),n[S]=o,o.stateNode=n}return ss(o),null;case 31:if(h=o.memoizedState,n===null||n.memoizedState!==null){if(p=Gr(o),h!==null){if(n===null){if(!p)throw Error(s(318));if(n=o.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(s(557));n[S]=o}else qa(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;ss(o),n=!1}else h=zd(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=h),n=!0;if(!n)return o.flags&256?(_i(o),o):(_i(o),null);if((o.flags&128)!==0)throw Error(s(558))}return ss(o),null;case 13:if(p=o.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(b=Gr(o),p!==null&&p.dehydrated!==null){if(n===null){if(!b)throw Error(s(318));if(b=o.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(s(317));b[S]=o}else qa(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;ss(o),b=!1}else b=zd(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=b),b=!0;if(!b)return o.flags&256?(_i(o),o):(_i(o),null)}return _i(o),(o.flags&128)!==0?(o.lanes=h,o):(h=p!==null,n=n!==null&&n.memoizedState!==null,h&&(p=o.child,b=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(b=p.alternate.memoizedState.cachePool.pool),T=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(T=p.memoizedState.cachePool.pool),T!==b&&(p.flags|=2048)),h!==n&&h&&(o.child.flags|=8192),Oc(o,o.updateQueue),ss(o),null);case 4:return Ie(),n===null&&af(o.stateNode.containerInfo),ss(o),null;case 10:return In(o.type),ss(o),null;case 19:if(X(ys),p=o.memoizedState,p===null)return ss(o),null;if(b=(o.flags&128)!==0,T=p.rendering,T===null)if(b)cl(p,!1);else{if(ms!==0||n!==null&&(n.flags&128)!==0)for(n=o.child;n!==null;){if(T=Ec(n),T!==null){for(o.flags|=128,cl(p,!1),n=T.updateQueue,o.updateQueue=n,Oc(o,n),o.subtreeFlags=0,n=h,h=o.child;h!==null;)bp(h,n),h=h.sibling;return me(ys,ys.current&1|2),Mt&&Ln(o,p.treeForkCount),o.child}n=n.sibling}p.tail!==null&&vt()>Gc&&(o.flags|=128,b=!0,cl(p,!1),o.lanes=4194304)}else{if(!b)if(n=Ec(T),n!==null){if(o.flags|=128,b=!0,n=n.updateQueue,o.updateQueue=n,Oc(o,n),cl(p,!0),p.tail===null&&p.tailMode==="hidden"&&!T.alternate&&!Mt)return ss(o),null}else 2*vt()-p.renderingStartTime>Gc&&h!==536870912&&(o.flags|=128,b=!0,cl(p,!1),o.lanes=4194304);p.isBackwards?(T.sibling=o.child,o.child=T):(n=p.last,n!==null?n.sibling=T:o.child=T,p.last=T)}return p.tail!==null?(n=p.tail,p.rendering=n,p.tail=n.sibling,p.renderingStartTime=vt(),n.sibling=null,h=ys.current,me(ys,b?h&1|2:h&1),Mt&&Ln(o,p.treeForkCount),n):(ss(o),null);case 22:case 23:return _i(o),ah(),p=o.memoizedState!==null,n!==null?n.memoizedState!==null!==p&&(o.flags|=8192):p&&(o.flags|=8192),p?(h&536870912)!==0&&(o.flags&128)===0&&(ss(o),o.subtreeFlags&6&&(o.flags|=8192)):ss(o),h=o.updateQueue,h!==null&&Oc(o,h.retryQueue),h=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(h=n.memoizedState.cachePool.pool),p=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(p=o.memoizedState.cachePool.pool),p!==h&&(o.flags|=2048),n!==null&&X(Xa),null;case 24:return h=null,n!==null&&(h=n.memoizedState.cache),o.memoizedState.cache!==h&&(o.flags|=2048),In(Es),ss(o),null;case 25:return null;case 30:return null}throw Error(s(156,o.tag))}function Z1(n,o){switch(Hd(o),o.tag){case 1:return n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 3:return In(Es),Ie(),n=o.flags,(n&65536)!==0&&(n&128)===0?(o.flags=n&-65537|128,o):null;case 26:case 27:case 5:return qe(o),null;case 31:if(o.memoizedState!==null){if(_i(o),o.alternate===null)throw Error(s(340));qa()}return n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 13:if(_i(o),n=o.memoizedState,n!==null&&n.dehydrated!==null){if(o.alternate===null)throw Error(s(340));qa()}return n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 19:return X(ys),null;case 4:return Ie(),null;case 10:return In(o.type),null;case 22:case 23:return _i(o),ah(),n!==null&&X(Xa),n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 24:return In(Es),null;case 25:return null;default:return null}}function Y0(n,o){switch(Hd(o),o.tag){case 3:In(Es),Ie();break;case 26:case 27:case 5:qe(o);break;case 4:Ie();break;case 31:o.memoizedState!==null&&_i(o);break;case 13:_i(o);break;case 19:X(ys);break;case 10:In(o.type);break;case 22:case 23:_i(o),ah(),n!==null&&X(Xa);break;case 24:In(Es)}}function ul(n,o){try{var h=o.updateQueue,p=h!==null?h.lastEffect:null;if(p!==null){var b=p.next;h=b;do{if((h.tag&n)===n){p=void 0;var T=h.create,P=h.inst;p=T(),P.destroy=p}h=h.next}while(h!==b)}}catch(W){Ht(o,o.return,W)}}function ha(n,o,h){try{var p=o.updateQueue,b=p!==null?p.lastEffect:null;if(b!==null){var T=b.next;p=T;do{if((p.tag&n)===n){var P=p.inst,W=P.destroy;if(W!==void 0){P.destroy=void 0,b=o;var ce=h,Te=W;try{Te()}catch(Me){Ht(b,ce,Me)}}}p=p.next}while(p!==T)}}catch(Me){Ht(o,o.return,Me)}}function W0(n){var o=n.updateQueue;if(o!==null){var h=n.stateNode;try{Up(o,h)}catch(p){Ht(n,n.return,p)}}}function X0(n,o,h){h.props=tr(n.type,n.memoizedProps),h.state=n.memoizedState;try{h.componentWillUnmount()}catch(p){Ht(n,o,p)}}function dl(n,o){try{var h=n.ref;if(h!==null){switch(n.tag){case 26:case 27:case 5:var p=n.stateNode;break;case 30:p=n.stateNode;break;default:p=n.stateNode}typeof h=="function"?n.refCleanup=h(p):h.current=p}}catch(b){Ht(n,o,b)}}function hn(n,o){var h=n.ref,p=n.refCleanup;if(h!==null)if(typeof p=="function")try{p()}catch(b){Ht(n,o,b)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof h=="function")try{h(null)}catch(b){Ht(n,o,b)}else h.current=null}function Q0(n){var o=n.type,h=n.memoizedProps,p=n.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":h.autoFocus&&p.focus();break e;case"img":h.src?p.src=h.src:h.srcSet&&(p.srcset=h.srcSet)}}catch(b){Ht(n,n.return,b)}}function Ph(n,o,h){try{var p=n.stateNode;_T(p,n.type,h,o),p[_]=o}catch(b){Ht(n,n.return,b)}}function Z0(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&va(n.type)||n.tag===4}function Bh(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Z0(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&va(n.type)||n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Uh(n,o,h){var p=n.tag;if(p===5||p===6)n=n.stateNode,o?(h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h).insertBefore(n,o):(o=h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h,o.appendChild(n),h=h._reactRootContainer,h!=null||o.onclick!==null||(o.onclick=pi));else if(p!==4&&(p===27&&va(n.type)&&(h=n.stateNode,o=null),n=n.child,n!==null))for(Uh(n,o,h),n=n.sibling;n!==null;)Uh(n,o,h),n=n.sibling}function Pc(n,o,h){var p=n.tag;if(p===5||p===6)n=n.stateNode,o?h.insertBefore(n,o):h.appendChild(n);else if(p!==4&&(p===27&&va(n.type)&&(h=n.stateNode),n=n.child,n!==null))for(Pc(n,o,h),n=n.sibling;n!==null;)Pc(n,o,h),n=n.sibling}function J0(n){var o=n.stateNode,h=n.memoizedProps;try{for(var p=n.type,b=o.attributes;b.length;)o.removeAttributeNode(b[0]);$s(o,p,h),o[S]=n,o[_]=h}catch(T){Ht(n,n.return,T)}}var Pn=!1,ws=!1,Fh=!1,ey=typeof WeakSet=="function"?WeakSet:Set,Os=null;function J1(n,o){if(n=n.containerInfo,lf=nu,n=hp(n),kd(n)){if("selectionStart"in n)var h={start:n.selectionStart,end:n.selectionEnd};else e:{h=(h=n.ownerDocument)&&h.defaultView||window;var p=h.getSelection&&h.getSelection();if(p&&p.rangeCount!==0){h=p.anchorNode;var b=p.anchorOffset,T=p.focusNode;p=p.focusOffset;try{h.nodeType,T.nodeType}catch{h=null;break e}var P=0,W=-1,ce=-1,Te=0,Me=0,Pe=n,Ne=null;t:for(;;){for(var Ce;Pe!==h||b!==0&&Pe.nodeType!==3||(W=P+b),Pe!==T||p!==0&&Pe.nodeType!==3||(ce=P+p),Pe.nodeType===3&&(P+=Pe.nodeValue.length),(Ce=Pe.firstChild)!==null;)Ne=Pe,Pe=Ce;for(;;){if(Pe===n)break t;if(Ne===h&&++Te===b&&(W=P),Ne===T&&++Me===p&&(ce=P),(Ce=Pe.nextSibling)!==null)break;Pe=Ne,Ne=Pe.parentNode}Pe=Ce}h=W===-1||ce===-1?null:{start:W,end:ce}}else h=null}h=h||{start:0,end:0}}else h=null;for(cf={focusedElem:n,selectionRange:h},nu=!1,Os=o;Os!==null;)if(o=Os,n=o.child,(o.subtreeFlags&1028)!==0&&n!==null)n.return=o,Os=n;else for(;Os!==null;){switch(o=Os,T=o.alternate,n=o.flags,o.tag){case 0:if((n&4)!==0&&(n=o.updateQueue,n=n!==null?n.events:null,n!==null))for(h=0;h<n.length;h++)b=n[h],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((n&1024)!==0&&T!==null){n=void 0,h=o,b=T.memoizedProps,T=T.memoizedState,p=h.stateNode;try{var Qe=tr(h.type,b);n=p.getSnapshotBeforeUpdate(Qe,T),p.__reactInternalSnapshotBeforeUpdate=n}catch(lt){Ht(h,h.return,lt)}}break;case 3:if((n&1024)!==0){if(n=o.stateNode.containerInfo,h=n.nodeType,h===9)hf(n);else if(h===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":hf(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(s(163))}if(n=o.sibling,n!==null){n.return=o.return,Os=n;break}Os=o.return}}function ty(n,o,h){var p=h.flags;switch(h.tag){case 0:case 11:case 15:Un(n,h),p&4&&ul(5,h);break;case 1:if(Un(n,h),p&4)if(n=h.stateNode,o===null)try{n.componentDidMount()}catch(P){Ht(h,h.return,P)}else{var b=tr(h.type,o.memoizedProps);o=o.memoizedState;try{n.componentDidUpdate(b,o,n.__reactInternalSnapshotBeforeUpdate)}catch(P){Ht(h,h.return,P)}}p&64&&W0(h),p&512&&dl(h,h.return);break;case 3:if(Un(n,h),p&64&&(n=h.updateQueue,n!==null)){if(o=null,h.child!==null)switch(h.child.tag){case 27:case 5:o=h.child.stateNode;break;case 1:o=h.child.stateNode}try{Up(n,o)}catch(P){Ht(h,h.return,P)}}break;case 27:o===null&&p&4&&J0(h);case 26:case 5:Un(n,h),o===null&&p&4&&Q0(h),p&512&&dl(h,h.return);break;case 12:Un(n,h);break;case 31:Un(n,h),p&4&&ny(n,h);break;case 13:Un(n,h),p&4&&ay(n,h),p&64&&(n=h.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(h=lT.bind(null,h),RT(n,h))));break;case 22:if(p=h.memoizedState!==null||Pn,!p){o=o!==null&&o.memoizedState!==null||ws,b=Pn;var T=ws;Pn=p,(ws=o)&&!T?Fn(n,h,(h.subtreeFlags&8772)!==0):Un(n,h),Pn=b,ws=T}break;case 30:break;default:Un(n,h)}}function sy(n){var o=n.alternate;o!==null&&(n.alternate=null,sy(o)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(o=n.stateNode,o!==null&&ne(o)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var as=null,ai=!1;function Bn(n,o,h){for(h=h.child;h!==null;)iy(n,o,h),h=h.sibling}function iy(n,o,h){if(ct&&typeof ct.onCommitFiberUnmount=="function")try{ct.onCommitFiberUnmount(Ae,h)}catch{}switch(h.tag){case 26:ws||hn(h,o),Bn(n,o,h),h.memoizedState?h.memoizedState.count--:h.stateNode&&(h=h.stateNode,h.parentNode.removeChild(h));break;case 27:ws||hn(h,o);var p=as,b=ai;va(h.type)&&(as=h.stateNode,ai=!1),Bn(n,o,h),_l(h.stateNode),as=p,ai=b;break;case 5:ws||hn(h,o);case 6:if(p=as,b=ai,as=null,Bn(n,o,h),as=p,ai=b,as!==null)if(ai)try{(as.nodeType===9?as.body:as.nodeName==="HTML"?as.ownerDocument.body:as).removeChild(h.stateNode)}catch(T){Ht(h,o,T)}else try{as.removeChild(h.stateNode)}catch(T){Ht(h,o,T)}break;case 18:as!==null&&(ai?(n=as,Wy(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,h.stateNode),lo(n)):Wy(as,h.stateNode));break;case 4:p=as,b=ai,as=h.stateNode.containerInfo,ai=!0,Bn(n,o,h),as=p,ai=b;break;case 0:case 11:case 14:case 15:ha(2,h,o),ws||ha(4,h,o),Bn(n,o,h);break;case 1:ws||(hn(h,o),p=h.stateNode,typeof p.componentWillUnmount=="function"&&X0(h,o,p)),Bn(n,o,h);break;case 21:Bn(n,o,h);break;case 22:ws=(p=ws)||h.memoizedState!==null,Bn(n,o,h),ws=p;break;default:Bn(n,o,h)}}function ny(n,o){if(o.memoizedState===null&&(n=o.alternate,n!==null&&(n=n.memoizedState,n!==null))){n=n.dehydrated;try{lo(n)}catch(h){Ht(o,o.return,h)}}}function ay(n,o){if(o.memoizedState===null&&(n=o.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{lo(n)}catch(h){Ht(o,o.return,h)}}function eT(n){switch(n.tag){case 31:case 13:case 19:var o=n.stateNode;return o===null&&(o=n.stateNode=new ey),o;case 22:return n=n.stateNode,o=n._retryCache,o===null&&(o=n._retryCache=new ey),o;default:throw Error(s(435,n.tag))}}function Bc(n,o){var h=eT(n);o.forEach(function(p){if(!h.has(p)){h.add(p);var b=cT.bind(null,n,p);p.then(b,b)}})}function ri(n,o){var h=o.deletions;if(h!==null)for(var p=0;p<h.length;p++){var b=h[p],T=n,P=o,W=P;e:for(;W!==null;){switch(W.tag){case 27:if(va(W.type)){as=W.stateNode,ai=!1;break e}break;case 5:as=W.stateNode,ai=!1;break e;case 3:case 4:as=W.stateNode.containerInfo,ai=!0;break e}W=W.return}if(as===null)throw Error(s(160));iy(T,P,b),as=null,ai=!1,T=b.alternate,T!==null&&(T.return=null),b.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)ry(o,n),o=o.sibling}var en=null;function ry(n,o){var h=n.alternate,p=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:ri(o,n),oi(n),p&4&&(ha(3,n,n.return),ul(3,n),ha(5,n,n.return));break;case 1:ri(o,n),oi(n),p&512&&(ws||h===null||hn(h,h.return)),p&64&&Pn&&(n=n.updateQueue,n!==null&&(p=n.callbacks,p!==null&&(h=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=h===null?p:h.concat(p))));break;case 26:var b=en;if(ri(o,n),oi(n),p&512&&(ws||h===null||hn(h,h.return)),p&4){var T=h!==null?h.memoizedState:null;if(p=n.memoizedState,h===null)if(p===null)if(n.stateNode===null){e:{p=n.type,h=n.memoizedProps,b=b.ownerDocument||b;t:switch(p){case"title":T=b.getElementsByTagName("title")[0],(!T||T[J]||T[S]||T.namespaceURI==="http://www.w3.org/2000/svg"||T.hasAttribute("itemprop"))&&(T=b.createElement(p),b.head.insertBefore(T,b.querySelector("head > title"))),$s(T,p,h),T[S]=n,ke(T),p=T;break e;case"link":var P=rx("link","href",b).get(p+(h.href||""));if(P){for(var W=0;W<P.length;W++)if(T=P[W],T.getAttribute("href")===(h.href==null||h.href===""?null:h.href)&&T.getAttribute("rel")===(h.rel==null?null:h.rel)&&T.getAttribute("title")===(h.title==null?null:h.title)&&T.getAttribute("crossorigin")===(h.crossOrigin==null?null:h.crossOrigin)){P.splice(W,1);break t}}T=b.createElement(p),$s(T,p,h),b.head.appendChild(T);break;case"meta":if(P=rx("meta","content",b).get(p+(h.content||""))){for(W=0;W<P.length;W++)if(T=P[W],T.getAttribute("content")===(h.content==null?null:""+h.content)&&T.getAttribute("name")===(h.name==null?null:h.name)&&T.getAttribute("property")===(h.property==null?null:h.property)&&T.getAttribute("http-equiv")===(h.httpEquiv==null?null:h.httpEquiv)&&T.getAttribute("charset")===(h.charSet==null?null:h.charSet)){P.splice(W,1);break t}}T=b.createElement(p),$s(T,p,h),b.head.appendChild(T);break;default:throw Error(s(468,p))}T[S]=n,ke(T),p=T}n.stateNode=p}else ox(b,n.type,n.stateNode);else n.stateNode=ax(b,p,n.memoizedProps);else T!==p?(T===null?h.stateNode!==null&&(h=h.stateNode,h.parentNode.removeChild(h)):T.count--,p===null?ox(b,n.type,n.stateNode):ax(b,p,n.memoizedProps)):p===null&&n.stateNode!==null&&Ph(n,n.memoizedProps,h.memoizedProps)}break;case 27:ri(o,n),oi(n),p&512&&(ws||h===null||hn(h,h.return)),h!==null&&p&4&&Ph(n,n.memoizedProps,h.memoizedProps);break;case 5:if(ri(o,n),oi(n),p&512&&(ws||h===null||hn(h,h.return)),n.flags&32){b=n.stateNode;try{zs(b,"")}catch(Qe){Ht(n,n.return,Qe)}}p&4&&n.stateNode!=null&&(b=n.memoizedProps,Ph(n,b,h!==null?h.memoizedProps:b)),p&1024&&(Fh=!0);break;case 6:if(ri(o,n),oi(n),p&4){if(n.stateNode===null)throw Error(s(162));p=n.memoizedProps,h=n.stateNode;try{h.nodeValue=p}catch(Qe){Ht(n,n.return,Qe)}}break;case 3:if(eu=null,b=en,en=Zc(o.containerInfo),ri(o,n),en=b,oi(n),p&4&&h!==null&&h.memoizedState.isDehydrated)try{lo(o.containerInfo)}catch(Qe){Ht(n,n.return,Qe)}Fh&&(Fh=!1,oy(n));break;case 4:p=en,en=Zc(n.stateNode.containerInfo),ri(o,n),oi(n),en=p;break;case 12:ri(o,n),oi(n);break;case 31:ri(o,n),oi(n),p&4&&(p=n.updateQueue,p!==null&&(n.updateQueue=null,Bc(n,p)));break;case 13:ri(o,n),oi(n),n.child.flags&8192&&n.memoizedState!==null!=(h!==null&&h.memoizedState!==null)&&(Fc=vt()),p&4&&(p=n.updateQueue,p!==null&&(n.updateQueue=null,Bc(n,p)));break;case 22:b=n.memoizedState!==null;var ce=h!==null&&h.memoizedState!==null,Te=Pn,Me=ws;if(Pn=Te||b,ws=Me||ce,ri(o,n),ws=Me,Pn=Te,oi(n),p&8192)e:for(o=n.stateNode,o._visibility=b?o._visibility&-2:o._visibility|1,b&&(h===null||ce||Pn||ws||sr(n)),h=null,o=n;;){if(o.tag===5||o.tag===26){if(h===null){ce=h=o;try{if(T=ce.stateNode,b)P=T.style,typeof P.setProperty=="function"?P.setProperty("display","none","important"):P.display="none";else{W=ce.stateNode;var Pe=ce.memoizedProps.style,Ne=Pe!=null&&Pe.hasOwnProperty("display")?Pe.display:null;W.style.display=Ne==null||typeof Ne=="boolean"?"":(""+Ne).trim()}}catch(Qe){Ht(ce,ce.return,Qe)}}}else if(o.tag===6){if(h===null){ce=o;try{ce.stateNode.nodeValue=b?"":ce.memoizedProps}catch(Qe){Ht(ce,ce.return,Qe)}}}else if(o.tag===18){if(h===null){ce=o;try{var Ce=ce.stateNode;b?Xy(Ce,!0):Xy(ce.stateNode,!1)}catch(Qe){Ht(ce,ce.return,Qe)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===n)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break e;for(;o.sibling===null;){if(o.return===null||o.return===n)break e;h===o&&(h=null),o=o.return}h===o&&(h=null),o.sibling.return=o.return,o=o.sibling}p&4&&(p=n.updateQueue,p!==null&&(h=p.retryQueue,h!==null&&(p.retryQueue=null,Bc(n,h))));break;case 19:ri(o,n),oi(n),p&4&&(p=n.updateQueue,p!==null&&(n.updateQueue=null,Bc(n,p)));break;case 30:break;case 21:break;default:ri(o,n),oi(n)}}function oi(n){var o=n.flags;if(o&2){try{for(var h,p=n.return;p!==null;){if(Z0(p)){h=p;break}p=p.return}if(h==null)throw Error(s(160));switch(h.tag){case 27:var b=h.stateNode,T=Bh(n);Pc(n,T,b);break;case 5:var P=h.stateNode;h.flags&32&&(zs(P,""),h.flags&=-33);var W=Bh(n);Pc(n,W,P);break;case 3:case 4:var ce=h.stateNode.containerInfo,Te=Bh(n);Uh(n,Te,ce);break;default:throw Error(s(161))}}catch(Me){Ht(n,n.return,Me)}n.flags&=-3}o&4096&&(n.flags&=-4097)}function oy(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var o=n;oy(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),n=n.sibling}}function Un(n,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)ty(n,o.alternate,o),o=o.sibling}function sr(n){for(n=n.child;n!==null;){var o=n;switch(o.tag){case 0:case 11:case 14:case 15:ha(4,o,o.return),sr(o);break;case 1:hn(o,o.return);var h=o.stateNode;typeof h.componentWillUnmount=="function"&&X0(o,o.return,h),sr(o);break;case 27:_l(o.stateNode);case 26:case 5:hn(o,o.return),sr(o);break;case 22:o.memoizedState===null&&sr(o);break;case 30:sr(o);break;default:sr(o)}n=n.sibling}}function Fn(n,o,h){for(h=h&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var p=o.alternate,b=n,T=o,P=T.flags;switch(T.tag){case 0:case 11:case 15:Fn(b,T,h),ul(4,T);break;case 1:if(Fn(b,T,h),p=T,b=p.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(Te){Ht(p,p.return,Te)}if(p=T,b=p.updateQueue,b!==null){var W=p.stateNode;try{var ce=b.shared.hiddenCallbacks;if(ce!==null)for(b.shared.hiddenCallbacks=null,b=0;b<ce.length;b++)Bp(ce[b],W)}catch(Te){Ht(p,p.return,Te)}}h&&P&64&&W0(T),dl(T,T.return);break;case 27:J0(T);case 26:case 5:Fn(b,T,h),h&&p===null&&P&4&&Q0(T),dl(T,T.return);break;case 12:Fn(b,T,h);break;case 31:Fn(b,T,h),h&&P&4&&ny(b,T);break;case 13:Fn(b,T,h),h&&P&4&&ay(b,T);break;case 22:T.memoizedState===null&&Fn(b,T,h),dl(T,T.return);break;case 30:break;default:Fn(b,T,h)}o=o.sibling}}function Gh(n,o){var h=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(h=n.memoizedState.cachePool.pool),n=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(n=o.memoizedState.cachePool.pool),n!==h&&(n!=null&&n.refCount++,h!=null&&Qo(h))}function $h(n,o){n=null,o.alternate!==null&&(n=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==n&&(o.refCount++,n!=null&&Qo(n))}function tn(n,o,h,p){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)ly(n,o,h,p),o=o.sibling}function ly(n,o,h,p){var b=o.flags;switch(o.tag){case 0:case 11:case 15:tn(n,o,h,p),b&2048&&ul(9,o);break;case 1:tn(n,o,h,p);break;case 3:tn(n,o,h,p),b&2048&&(n=null,o.alternate!==null&&(n=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==n&&(o.refCount++,n!=null&&Qo(n)));break;case 12:if(b&2048){tn(n,o,h,p),n=o.stateNode;try{var T=o.memoizedProps,P=T.id,W=T.onPostCommit;typeof W=="function"&&W(P,o.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(ce){Ht(o,o.return,ce)}}else tn(n,o,h,p);break;case 31:tn(n,o,h,p);break;case 13:tn(n,o,h,p);break;case 23:break;case 22:T=o.stateNode,P=o.alternate,o.memoizedState!==null?T._visibility&2?tn(n,o,h,p):hl(n,o):T._visibility&2?tn(n,o,h,p):(T._visibility|=2,Qr(n,o,h,p,(o.subtreeFlags&10256)!==0||!1)),b&2048&&Gh(P,o);break;case 24:tn(n,o,h,p),b&2048&&$h(o.alternate,o);break;default:tn(n,o,h,p)}}function Qr(n,o,h,p,b){for(b=b&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var T=n,P=o,W=h,ce=p,Te=P.flags;switch(P.tag){case 0:case 11:case 15:Qr(T,P,W,ce,b),ul(8,P);break;case 23:break;case 22:var Me=P.stateNode;P.memoizedState!==null?Me._visibility&2?Qr(T,P,W,ce,b):hl(T,P):(Me._visibility|=2,Qr(T,P,W,ce,b)),b&&Te&2048&&Gh(P.alternate,P);break;case 24:Qr(T,P,W,ce,b),b&&Te&2048&&$h(P.alternate,P);break;default:Qr(T,P,W,ce,b)}o=o.sibling}}function hl(n,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var h=n,p=o,b=p.flags;switch(p.tag){case 22:hl(h,p),b&2048&&Gh(p.alternate,p);break;case 24:hl(h,p),b&2048&&$h(p.alternate,p);break;default:hl(h,p)}o=o.sibling}}var fl=8192;function Zr(n,o,h){if(n.subtreeFlags&fl)for(n=n.child;n!==null;)cy(n,o,h),n=n.sibling}function cy(n,o,h){switch(n.tag){case 26:Zr(n,o,h),n.flags&fl&&n.memoizedState!==null&&FT(h,en,n.memoizedState,n.memoizedProps);break;case 5:Zr(n,o,h);break;case 3:case 4:var p=en;en=Zc(n.stateNode.containerInfo),Zr(n,o,h),en=p;break;case 22:n.memoizedState===null&&(p=n.alternate,p!==null&&p.memoizedState!==null?(p=fl,fl=16777216,Zr(n,o,h),fl=p):Zr(n,o,h));break;default:Zr(n,o,h)}}function uy(n){var o=n.alternate;if(o!==null&&(n=o.child,n!==null)){o.child=null;do o=n.sibling,n.sibling=null,n=o;while(n!==null)}}function ml(n){var o=n.deletions;if((n.flags&16)!==0){if(o!==null)for(var h=0;h<o.length;h++){var p=o[h];Os=p,hy(p,n)}uy(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)dy(n),n=n.sibling}function dy(n){switch(n.tag){case 0:case 11:case 15:ml(n),n.flags&2048&&ha(9,n,n.return);break;case 3:ml(n);break;case 12:ml(n);break;case 22:var o=n.stateNode;n.memoizedState!==null&&o._visibility&2&&(n.return===null||n.return.tag!==13)?(o._visibility&=-3,Uc(n)):ml(n);break;default:ml(n)}}function Uc(n){var o=n.deletions;if((n.flags&16)!==0){if(o!==null)for(var h=0;h<o.length;h++){var p=o[h];Os=p,hy(p,n)}uy(n)}for(n=n.child;n!==null;){switch(o=n,o.tag){case 0:case 11:case 15:ha(8,o,o.return),Uc(o);break;case 22:h=o.stateNode,h._visibility&2&&(h._visibility&=-3,Uc(o));break;default:Uc(o)}n=n.sibling}}function hy(n,o){for(;Os!==null;){var h=Os;switch(h.tag){case 0:case 11:case 15:ha(8,h,o);break;case 23:case 22:if(h.memoizedState!==null&&h.memoizedState.cachePool!==null){var p=h.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:Qo(h.memoizedState.cache)}if(p=h.child,p!==null)p.return=h,Os=p;else e:for(h=n;Os!==null;){p=Os;var b=p.sibling,T=p.return;if(sy(p),p===h){Os=null;break e}if(b!==null){b.return=T,Os=b;break e}Os=T}}}var tT={getCacheForType:function(n){var o=Fs(Es),h=o.data.get(n);return h===void 0&&(h=n(),o.data.set(n,h)),h},cacheSignal:function(){return Fs(Es).controller.signal}},sT=typeof WeakMap=="function"?WeakMap:Map,Gt=0,Qt=null,wt=null,Dt=0,Vt=0,bi=null,fa=!1,Jr=!1,Vh=!1,Gn=0,ms=0,ma=0,ir=0,Hh=0,Si=0,eo=0,gl=null,li=null,Kh=!1,Fc=0,fy=0,Gc=1/0,$c=null,ga=null,Rs=0,pa=null,to=null,$n=0,zh=0,qh=null,my=null,pl=0,Yh=null;function Ei(){return(Gt&2)!==0&&Dt!==0?Dt&-Dt:Q.T!==null?ef():tc()}function gy(){if(Si===0)if((Dt&536870912)===0||Mt){var n=wr;wr<<=1,(wr&3932160)===0&&(wr=262144),Si=n}else Si=536870912;return n=vi.current,n!==null&&(n.flags|=32),Si}function ci(n,o,h){(n===Qt&&(Vt===2||Vt===9)||n.cancelPendingCommit!==null)&&(so(n,0),ya(n,Dt,Si,!1)),ea(n,h),((Gt&2)===0||n!==Qt)&&(n===Qt&&((Gt&2)===0&&(ir|=h),ms===4&&ya(n,Dt,Si,!1)),fn(n))}function py(n,o,h){if((Gt&6)!==0)throw Error(s(327));var p=!h&&(o&127)===0&&(o&n.expiredLanes)===0||Oa(n,o),b=p?aT(n,o):Xh(n,o,!0),T=p;do{if(b===0){Jr&&!p&&ya(n,o,0,!1);break}else{if(h=n.current.alternate,T&&!iT(h)){b=Xh(n,o,!1),T=!1;continue}if(b===2){if(T=o,n.errorRecoveryDisabledLanes&T)var P=0;else P=n.pendingLanes&-536870913,P=P!==0?P:P&536870912?536870912:0;if(P!==0){o=P;e:{var W=n;b=gl;var ce=W.current.memoizedState.isDehydrated;if(ce&&(so(W,P).flags|=256),P=Xh(W,P,!1),P!==2){if(Vh&&!ce){W.errorRecoveryDisabledLanes|=T,ir|=T,b=4;break e}T=li,li=b,T!==null&&(li===null?li=T:li.push.apply(li,T))}b=P}if(T=!1,b!==2)continue}}if(b===1){so(n,0),ya(n,o,0,!0);break}e:{switch(p=n,T=b,T){case 0:case 1:throw Error(s(345));case 4:if((o&4194048)!==o)break;case 6:ya(p,o,Si,!fa);break e;case 2:li=null;break;case 3:case 5:break;default:throw Error(s(329))}if((o&62914560)===o&&(b=Fc+300-vt(),10<b)){if(ya(p,o,Si,!fa),Rr(p,0,!0)!==0)break e;$n=o,p.timeoutHandle=qy(yy.bind(null,p,h,li,$c,Kh,o,Si,ir,eo,fa,T,"Throttled",-0,0),b);break e}yy(p,h,li,$c,Kh,o,Si,ir,eo,fa,T,null,-0,0)}}break}while(!0);fn(n)}function yy(n,o,h,p,b,T,P,W,ce,Te,Me,Pe,Ne,Ce){if(n.timeoutHandle=-1,Pe=o.subtreeFlags,Pe&8192||(Pe&16785408)===16785408){Pe={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:pi},cy(o,T,Pe);var Qe=(T&62914560)===T?Fc-vt():(T&4194048)===T?fy-vt():0;if(Qe=GT(Pe,Qe),Qe!==null){$n=T,n.cancelPendingCommit=Qe(Ay.bind(null,n,o,T,h,p,b,P,W,ce,Me,Pe,null,Ne,Ce)),ya(n,T,P,!Te);return}}Ay(n,o,T,h,p,b,P,W,ce)}function iT(n){for(var o=n;;){var h=o.tag;if((h===0||h===11||h===15)&&o.flags&16384&&(h=o.updateQueue,h!==null&&(h=h.stores,h!==null)))for(var p=0;p<h.length;p++){var b=h[p],T=b.getSnapshot;b=b.value;try{if(!yi(T(),b))return!1}catch{return!1}}if(h=o.child,o.subtreeFlags&16384&&h!==null)h.return=o,o=h;else{if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function ya(n,o,h,p){o&=~Hh,o&=~ir,n.suspendedLanes|=o,n.pingedLanes&=~o,p&&(n.warmLanes|=o),p=n.expirationTimes;for(var b=o;0<b;){var T=31-ds(b),P=1<<T;p[T]=-1,b&=~P}h!==0&&Oo(n,h,o)}function Vc(){return(Gt&6)===0?(yl(0),!1):!0}function Wh(){if(wt!==null){if(Vt===0)var n=wt.return;else n=wt,Dn=Ya=null,dh(n),zr=null,Jo=0,n=wt;for(;n!==null;)Y0(n.alternate,n),n=n.return;wt=null}}function so(n,o){var h=n.timeoutHandle;h!==-1&&(n.timeoutHandle=-1,ET(h)),h=n.cancelPendingCommit,h!==null&&(n.cancelPendingCommit=null,h()),$n=0,Wh(),Qt=n,wt=h=Cn(n.current,null),Dt=o,Vt=0,bi=null,fa=!1,Jr=Oa(n,o),Vh=!1,eo=Si=Hh=ir=ma=ms=0,li=gl=null,Kh=!1,(o&8)!==0&&(o|=o&32);var p=n.entangledLanes;if(p!==0)for(n=n.entanglements,p&=o;0<p;){var b=31-ds(p),T=1<<b;o|=n[b],p&=~T}return Gn=o,uc(),h}function xy(n,o){bt=null,Q.H=ol,o===Kr||o===xc?(o=Mp(),Vt=3):o===Jd?(o=Mp(),Vt=4):Vt=o===Nh?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,bi=o,wt===null&&(ms=1,Ic(n,Oi(o,n.current)))}function vy(){var n=vi.current;return n===null?!0:(Dt&4194048)===Dt?Fi===null:(Dt&62914560)===Dt||(Dt&536870912)!==0?n===Fi:!1}function _y(){var n=Q.H;return Q.H=ol,n===null?ol:n}function by(){var n=Q.A;return Q.A=tT,n}function Hc(){ms=4,fa||(Dt&4194048)!==Dt&&vi.current!==null||(Jr=!0),(ma&134217727)===0&&(ir&134217727)===0||Qt===null||ya(Qt,Dt,Si,!1)}function Xh(n,o,h){var p=Gt;Gt|=2;var b=_y(),T=by();(Qt!==n||Dt!==o)&&($c=null,so(n,o)),o=!1;var P=ms;e:do try{if(Vt!==0&&wt!==null){var W=wt,ce=bi;switch(Vt){case 8:Wh(),P=6;break e;case 3:case 2:case 9:case 6:vi.current===null&&(o=!0);var Te=Vt;if(Vt=0,bi=null,io(n,W,ce,Te),h&&Jr){P=0;break e}break;default:Te=Vt,Vt=0,bi=null,io(n,W,ce,Te)}}nT(),P=ms;break}catch(Me){xy(n,Me)}while(!0);return o&&n.shellSuspendCounter++,Dn=Ya=null,Gt=p,Q.H=b,Q.A=T,wt===null&&(Qt=null,Dt=0,uc()),P}function nT(){for(;wt!==null;)Sy(wt)}function aT(n,o){var h=Gt;Gt|=2;var p=_y(),b=by();Qt!==n||Dt!==o?($c=null,Gc=vt()+500,so(n,o)):Jr=Oa(n,o);e:do try{if(Vt!==0&&wt!==null){o=wt;var T=bi;t:switch(Vt){case 1:Vt=0,bi=null,io(n,o,T,1);break;case 2:case 9:if(Ip(T)){Vt=0,bi=null,Ey(o);break}o=function(){Vt!==2&&Vt!==9||Qt!==n||(Vt=7),fn(n)},T.then(o,o);break e;case 3:Vt=7;break e;case 4:Vt=5;break e;case 7:Ip(T)?(Vt=0,bi=null,Ey(o)):(Vt=0,bi=null,io(n,o,T,7));break;case 5:var P=null;switch(wt.tag){case 26:P=wt.memoizedState;case 5:case 27:var W=wt;if(P?lx(P):W.stateNode.complete){Vt=0,bi=null;var ce=W.sibling;if(ce!==null)wt=ce;else{var Te=W.return;Te!==null?(wt=Te,Kc(Te)):wt=null}break t}}Vt=0,bi=null,io(n,o,T,5);break;case 6:Vt=0,bi=null,io(n,o,T,6);break;case 8:Wh(),ms=6;break e;default:throw Error(s(462))}}rT();break}catch(Me){xy(n,Me)}while(!0);return Dn=Ya=null,Q.H=p,Q.A=b,Gt=h,wt!==null?0:(Qt=null,Dt=0,uc(),ms)}function rT(){for(;wt!==null&&!ze();)Sy(wt)}function Sy(n){var o=z0(n.alternate,n,Gn);n.memoizedProps=n.pendingProps,o===null?Kc(n):wt=o}function Ey(n){var o=n,h=o.alternate;switch(o.tag){case 15:case 0:o=F0(h,o,o.pendingProps,o.type,void 0,Dt);break;case 11:o=F0(h,o,o.pendingProps,o.type.render,o.ref,Dt);break;case 5:dh(o);default:Y0(h,o),o=wt=bp(o,Gn),o=z0(h,o,Gn)}n.memoizedProps=n.pendingProps,o===null?Kc(n):wt=o}function io(n,o,h,p){Dn=Ya=null,dh(o),zr=null,Jo=0;var b=o.return;try{if(Y1(n,b,o,h,Dt)){ms=1,Ic(n,Oi(h,n.current)),wt=null;return}}catch(T){if(b!==null)throw wt=b,T;ms=1,Ic(n,Oi(h,n.current)),wt=null;return}o.flags&32768?(Mt||p===1?n=!0:Jr||(Dt&536870912)!==0?n=!1:(fa=n=!0,(p===2||p===9||p===3||p===6)&&(p=vi.current,p!==null&&p.tag===13&&(p.flags|=16384))),Ty(o,n)):Kc(o)}function Kc(n){var o=n;do{if((o.flags&32768)!==0){Ty(o,fa);return}n=o.return;var h=Q1(o.alternate,o,Gn);if(h!==null){wt=h;return}if(o=o.sibling,o!==null){wt=o;return}wt=o=n}while(o!==null);ms===0&&(ms=5)}function Ty(n,o){do{var h=Z1(n.alternate,n);if(h!==null){h.flags&=32767,wt=h;return}if(h=n.return,h!==null&&(h.flags|=32768,h.subtreeFlags=0,h.deletions=null),!o&&(n=n.sibling,n!==null)){wt=n;return}wt=n=h}while(n!==null);ms=6,wt=null}function Ay(n,o,h,p,b,T,P,W,ce){n.cancelPendingCommit=null;do zc();while(Rs!==0);if((Gt&6)!==0)throw Error(s(327));if(o!==null){if(o===n.current)throw Error(s(177));if(T=o.lanes|o.childLanes,T|=Bd,ta(n,h,T,P,W,ce),n===Qt&&(wt=Qt=null,Dt=0),to=o,pa=n,$n=h,zh=T,qh=b,my=p,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,uT(mi,function(){return Ly(),null})):(n.callbackNode=null,n.callbackPriority=0),p=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||p){p=Q.T,Q.T=null,b=se.p,se.p=2,P=Gt,Gt|=4;try{J1(n,o,h)}finally{Gt=P,se.p=b,Q.T=p}}Rs=1,wy(),Ny(),Ry()}}function wy(){if(Rs===1){Rs=0;var n=pa,o=to,h=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||h){h=Q.T,Q.T=null;var p=se.p;se.p=2;var b=Gt;Gt|=4;try{ry(o,n);var T=cf,P=hp(n.containerInfo),W=T.focusedElem,ce=T.selectionRange;if(P!==W&&W&&W.ownerDocument&&dp(W.ownerDocument.documentElement,W)){if(ce!==null&&kd(W)){var Te=ce.start,Me=ce.end;if(Me===void 0&&(Me=Te),"selectionStart"in W)W.selectionStart=Te,W.selectionEnd=Math.min(Me,W.value.length);else{var Pe=W.ownerDocument||document,Ne=Pe&&Pe.defaultView||window;if(Ne.getSelection){var Ce=Ne.getSelection(),Qe=W.textContent.length,lt=Math.min(ce.start,Qe),Wt=ce.end===void 0?lt:Math.min(ce.end,Qe);!Ce.extend&&lt>Wt&&(P=Wt,Wt=lt,lt=P);var xe=up(W,lt),fe=up(W,Wt);if(xe&&fe&&(Ce.rangeCount!==1||Ce.anchorNode!==xe.node||Ce.anchorOffset!==xe.offset||Ce.focusNode!==fe.node||Ce.focusOffset!==fe.offset)){var Ee=Pe.createRange();Ee.setStart(xe.node,xe.offset),Ce.removeAllRanges(),lt>Wt?(Ce.addRange(Ee),Ce.extend(fe.node,fe.offset)):(Ee.setEnd(fe.node,fe.offset),Ce.addRange(Ee))}}}}for(Pe=[],Ce=W;Ce=Ce.parentNode;)Ce.nodeType===1&&Pe.push({element:Ce,left:Ce.scrollLeft,top:Ce.scrollTop});for(typeof W.focus=="function"&&W.focus(),W=0;W<Pe.length;W++){var Oe=Pe[W];Oe.element.scrollLeft=Oe.left,Oe.element.scrollTop=Oe.top}}nu=!!lf,cf=lf=null}finally{Gt=b,se.p=p,Q.T=h}}n.current=o,Rs=2}}function Ny(){if(Rs===2){Rs=0;var n=pa,o=to,h=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||h){h=Q.T,Q.T=null;var p=se.p;se.p=2;var b=Gt;Gt|=4;try{ty(n,o.alternate,o)}finally{Gt=b,se.p=p,Q.T=h}}Rs=3}}function Ry(){if(Rs===4||Rs===3){Rs=0,ot();var n=pa,o=to,h=$n,p=my;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?Rs=5:(Rs=0,to=pa=null,Cy(n,n.pendingLanes));var b=n.pendingLanes;if(b===0&&(ga=null),ls(h),o=o.stateNode,ct&&typeof ct.onCommitFiberRoot=="function")try{ct.onCommitFiberRoot(Ae,o,void 0,(o.current.flags&128)===128)}catch{}if(p!==null){o=Q.T,b=se.p,se.p=2,Q.T=null;try{for(var T=n.onRecoverableError,P=0;P<p.length;P++){var W=p[P];T(W.value,{componentStack:W.stack})}}finally{Q.T=o,se.p=b}}($n&3)!==0&&zc(),fn(n),b=n.pendingLanes,(h&261930)!==0&&(b&42)!==0?n===Yh?pl++:(pl=0,Yh=n):pl=0,yl(0)}}function Cy(n,o){(n.pooledCacheLanes&=o)===0&&(o=n.pooledCache,o!=null&&(n.pooledCache=null,Qo(o)))}function zc(){return wy(),Ny(),Ry(),Ly()}function Ly(){if(Rs!==5)return!1;var n=pa,o=zh;zh=0;var h=ls($n),p=Q.T,b=se.p;try{se.p=32>h?32:h,Q.T=null,h=qh,qh=null;var T=pa,P=$n;if(Rs=0,to=pa=null,$n=0,(Gt&6)!==0)throw Error(s(331));var W=Gt;if(Gt|=4,dy(T.current),ly(T,T.current,P,h),Gt=W,yl(0,!1),ct&&typeof ct.onPostCommitFiberRoot=="function")try{ct.onPostCommitFiberRoot(Ae,T)}catch{}return!0}finally{se.p=b,Q.T=p,Cy(n,o)}}function Dy(n,o,h){o=Oi(h,o),o=wh(n.stateNode,o,2),n=ca(n,o,2),n!==null&&(ea(n,2),fn(n))}function Ht(n,o,h){if(n.tag===3)Dy(n,n,h);else for(;o!==null;){if(o.tag===3){Dy(o,n,h);break}else if(o.tag===1){var p=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(ga===null||!ga.has(p))){n=Oi(h,n),h=I0(2),p=ca(o,h,2),p!==null&&(k0(h,p,o,n),ea(p,2),fn(p));break}}o=o.return}}function Qh(n,o,h){var p=n.pingCache;if(p===null){p=n.pingCache=new sT;var b=new Set;p.set(o,b)}else b=p.get(o),b===void 0&&(b=new Set,p.set(o,b));b.has(h)||(Vh=!0,b.add(h),n=oT.bind(null,n,o,h),o.then(n,n))}function oT(n,o,h){var p=n.pingCache;p!==null&&p.delete(o),n.pingedLanes|=n.suspendedLanes&h,n.warmLanes&=~h,Qt===n&&(Dt&h)===h&&(ms===4||ms===3&&(Dt&62914560)===Dt&&300>vt()-Fc?(Gt&2)===0&&so(n,0):Hh|=h,eo===Dt&&(eo=0)),fn(n)}function Iy(n,o){o===0&&(o=jo()),n=Ka(n,o),n!==null&&(ea(n,o),fn(n))}function lT(n){var o=n.memoizedState,h=0;o!==null&&(h=o.retryLane),Iy(n,h)}function cT(n,o){var h=0;switch(n.tag){case 31:case 13:var p=n.stateNode,b=n.memoizedState;b!==null&&(h=b.retryLane);break;case 19:p=n.stateNode;break;case 22:p=n.stateNode._retryCache;break;default:throw Error(s(314))}p!==null&&p.delete(o),Iy(n,h)}function uT(n,o){return os(n,o)}var qc=null,no=null,Zh=!1,Yc=!1,Jh=!1,xa=0;function fn(n){n!==no&&n.next===null&&(no===null?qc=no=n:no=no.next=n),Yc=!0,Zh||(Zh=!0,hT())}function yl(n,o){if(!Jh&&Yc){Jh=!0;do for(var h=!1,p=qc;p!==null;){if(n!==0){var b=p.pendingLanes;if(b===0)var T=0;else{var P=p.suspendedLanes,W=p.pingedLanes;T=(1<<31-ds(42|n)+1)-1,T&=b&~(P&~W),T=T&201326741?T&201326741|1:T?T|2:0}T!==0&&(h=!0,Oy(p,T))}else T=Dt,T=Rr(p,p===Qt?T:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(T&3)===0||Oa(p,T)||(h=!0,Oy(p,T));p=p.next}while(h);Jh=!1}}function dT(){ky()}function ky(){Yc=Zh=!1;var n=0;xa!==0&&ST()&&(n=xa);for(var o=vt(),h=null,p=qc;p!==null;){var b=p.next,T=My(p,o);T===0?(p.next=null,h===null?qc=b:h.next=b,b===null&&(no=h)):(h=p,(n!==0||(T&3)!==0)&&(Yc=!0)),p=b}Rs!==0&&Rs!==5||yl(n),xa!==0&&(xa=0)}function My(n,o){for(var h=n.suspendedLanes,p=n.pingedLanes,b=n.expirationTimes,T=n.pendingLanes&-62914561;0<T;){var P=31-ds(T),W=1<<P,ce=b[P];ce===-1?((W&h)===0||(W&p)!==0)&&(b[P]=wn(W,o)):ce<=o&&(n.expiredLanes|=W),T&=~W}if(o=Qt,h=Dt,h=Rr(n,n===o?h:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),p=n.callbackNode,h===0||n===o&&(Vt===2||Vt===9)||n.cancelPendingCommit!==null)return p!==null&&p!==null&&Se(p),n.callbackNode=null,n.callbackPriority=0;if((h&3)===0||Oa(n,h)){if(o=h&-h,o===n.callbackPriority)return o;switch(p!==null&&Se(p),ls(h)){case 2:case 8:h=Di;break;case 32:h=mi;break;case 268435456:h=Qi;break;default:h=mi}return p=jy.bind(null,n),h=os(h,p),n.callbackPriority=o,n.callbackNode=h,o}return p!==null&&p!==null&&Se(p),n.callbackPriority=2,n.callbackNode=null,2}function jy(n,o){if(Rs!==0&&Rs!==5)return n.callbackNode=null,n.callbackPriority=0,null;var h=n.callbackNode;if(zc()&&n.callbackNode!==h)return null;var p=Dt;return p=Rr(n,n===Qt?p:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),p===0?null:(py(n,p,o),My(n,vt()),n.callbackNode!=null&&n.callbackNode===h?jy.bind(null,n):null)}function Oy(n,o){if(zc())return null;py(n,o,!0)}function hT(){TT(function(){(Gt&6)!==0?os(Ms,dT):ky()})}function ef(){if(xa===0){var n=Vr;n===0&&(n=Ar,Ar<<=1,(Ar&261888)===0&&(Ar=256)),xa=n}return xa}function Py(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:Ua(""+n)}function By(n,o){var h=o.ownerDocument.createElement("input");return h.name=o.name,h.value=o.value,n.id&&h.setAttribute("form",n.id),o.parentNode.insertBefore(h,o),n=new FormData(n),h.parentNode.removeChild(h),n}function fT(n,o,h,p,b){if(o==="submit"&&h&&h.stateNode===b){var T=Py((b[_]||null).action),P=p.submitter;P&&(o=(o=P[_]||null)?Py(o.formAction):P.getAttribute("formAction"),o!==null&&(T=o,P=null));var W=new rc("action","action",null,p,b);n.push({event:W,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(xa!==0){var ce=P?By(b,P):new FormData(b);_h(h,{pending:!0,data:ce,method:b.method,action:T},null,ce)}}else typeof T=="function"&&(W.preventDefault(),ce=P?By(b,P):new FormData(b),_h(h,{pending:!0,data:ce,method:b.method,action:T},T,ce))},currentTarget:b}]})}}for(var tf=0;tf<Pd.length;tf++){var sf=Pd[tf],mT=sf.toLowerCase(),gT=sf[0].toUpperCase()+sf.slice(1);Ji(mT,"on"+gT)}Ji(gp,"onAnimationEnd"),Ji(pp,"onAnimationIteration"),Ji(yp,"onAnimationStart"),Ji("dblclick","onDoubleClick"),Ji("focusin","onFocus"),Ji("focusout","onBlur"),Ji(D1,"onTransitionRun"),Ji(I1,"onTransitionStart"),Ji(k1,"onTransitionCancel"),Ji(xp,"onTransitionEnd"),Fe("onMouseEnter",["mouseout","mouseover"]),Fe("onMouseLeave",["mouseout","mouseover"]),Fe("onPointerEnter",["pointerout","pointerover"]),Fe("onPointerLeave",["pointerout","pointerover"]),Ve("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ve("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ve("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ve("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ve("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ve("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),pT=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(xl));function Uy(n,o){o=(o&4)!==0;for(var h=0;h<n.length;h++){var p=n[h],b=p.event;p=p.listeners;e:{var T=void 0;if(o)for(var P=p.length-1;0<=P;P--){var W=p[P],ce=W.instance,Te=W.currentTarget;if(W=W.listener,ce!==T&&b.isPropagationStopped())break e;T=W,b.currentTarget=Te;try{T(b)}catch(Me){cc(Me)}b.currentTarget=null,T=ce}else for(P=0;P<p.length;P++){if(W=p[P],ce=W.instance,Te=W.currentTarget,W=W.listener,ce!==T&&b.isPropagationStopped())break e;T=W,b.currentTarget=Te;try{T(b)}catch(Me){cc(Me)}b.currentTarget=null,T=ce}}}}function Nt(n,o){var h=o[F];h===void 0&&(h=o[F]=new Set);var p=n+"__bubble";h.has(p)||(Fy(o,n,2,!1),h.add(p))}function nf(n,o,h){var p=0;o&&(p|=4),Fy(h,n,p,o)}var Wc="_reactListening"+Math.random().toString(36).slice(2);function af(n){if(!n[Wc]){n[Wc]=!0,De.forEach(function(h){h!=="selectionchange"&&(pT.has(h)||nf(h,!1,n),nf(h,!0,n))});var o=n.nodeType===9?n:n.ownerDocument;o===null||o[Wc]||(o[Wc]=!0,nf("selectionchange",!1,o))}}function Fy(n,o,h,p){switch(gx(o)){case 2:var b=HT;break;case 8:b=KT;break;default:b=_f}h=b.bind(null,o,h,n),b=void 0,!Go||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(b=!0),p?b!==void 0?n.addEventListener(o,h,{capture:!0,passive:b}):n.addEventListener(o,h,!0):b!==void 0?n.addEventListener(o,h,{passive:b}):n.addEventListener(o,h,!1)}function rf(n,o,h,p,b){var T=p;if((o&1)===0&&(o&2)===0&&p!==null)e:for(;;){if(p===null)return;var P=p.tag;if(P===3||P===4){var W=p.stateNode.containerInfo;if(W===b)break;if(P===4)for(P=p.return;P!==null;){var ce=P.tag;if((ce===3||ce===4)&&P.stateNode.containerInfo===b)return;P=P.return}for(;W!==null;){if(P=de(W),P===null)return;if(ce=P.tag,ce===5||ce===6||ce===26||ce===27){p=T=P;continue e}W=W.parentNode}}p=p.return}Fo(function(){var Te=T,Me=Nn(h),Pe=[];e:{var Ne=vp.get(n);if(Ne!==void 0){var Ce=rc,Qe=n;switch(n){case"keypress":if(nc(h)===0)break e;case"keydown":case"keyup":Ce=c1;break;case"focusin":Qe="focus",Ce=Rd;break;case"focusout":Qe="blur",Ce=Rd;break;case"beforeblur":case"afterblur":Ce=Rd;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ce=Yg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ce=QE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ce=h1;break;case gp:case pp:case yp:Ce=e1;break;case xp:Ce=m1;break;case"scroll":case"scrollend":Ce=WE;break;case"wheel":Ce=p1;break;case"copy":case"cut":case"paste":Ce=s1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ce=Xg;break;case"toggle":case"beforetoggle":Ce=x1}var lt=(o&4)!==0,Wt=!lt&&(n==="scroll"||n==="scrollend"),xe=lt?Ne!==null?Ne+"Capture":null:Ne;lt=[];for(var fe=Te,Ee;fe!==null;){var Oe=fe;if(Ee=Oe.stateNode,Oe=Oe.tag,Oe!==5&&Oe!==26&&Oe!==27||Ee===null||xe===null||(Oe=Rn(fe,xe),Oe!=null&&lt.push(vl(fe,Oe,Ee))),Wt)break;fe=fe.return}0<lt.length&&(Ne=new Ce(Ne,Qe,null,h,Me),Pe.push({event:Ne,listeners:lt}))}}if((o&7)===0){e:{if(Ne=n==="mouseover"||n==="pointerover",Ce=n==="mouseout"||n==="pointerout",Ne&&h!==Fa&&(Qe=h.relatedTarget||h.fromElement)&&(de(Qe)||Qe[C]))break e;if((Ce||Ne)&&(Ne=Me.window===Me?Me:(Ne=Me.ownerDocument)?Ne.defaultView||Ne.parentWindow:window,Ce?(Qe=h.relatedTarget||h.toElement,Ce=Te,Qe=Qe?de(Qe):null,Qe!==null&&(Wt=l(Qe),lt=Qe.tag,Qe!==Wt||lt!==5&&lt!==27&&lt!==6)&&(Qe=null)):(Ce=null,Qe=Te),Ce!==Qe)){if(lt=Yg,Oe="onMouseLeave",xe="onMouseEnter",fe="mouse",(n==="pointerout"||n==="pointerover")&&(lt=Xg,Oe="onPointerLeave",xe="onPointerEnter",fe="pointer"),Wt=Ce==null?Ne:he(Ce),Ee=Qe==null?Ne:he(Qe),Ne=new lt(Oe,fe+"leave",Ce,h,Me),Ne.target=Wt,Ne.relatedTarget=Ee,Oe=null,de(Me)===Te&&(lt=new lt(xe,fe+"enter",Qe,h,Me),lt.target=Ee,lt.relatedTarget=Wt,Oe=lt),Wt=Oe,Ce&&Qe)t:{for(lt=yT,xe=Ce,fe=Qe,Ee=0,Oe=xe;Oe;Oe=lt(Oe))Ee++;Oe=0;for(var rt=fe;rt;rt=lt(rt))Oe++;for(;0<Ee-Oe;)xe=lt(xe),Ee--;for(;0<Oe-Ee;)fe=lt(fe),Oe--;for(;Ee--;){if(xe===fe||fe!==null&&xe===fe.alternate){lt=xe;break t}xe=lt(xe),fe=lt(fe)}lt=null}else lt=null;Ce!==null&&Gy(Pe,Ne,Ce,lt,!1),Qe!==null&&Wt!==null&&Gy(Pe,Wt,Qe,lt,!0)}}e:{if(Ne=Te?he(Te):window,Ce=Ne.nodeName&&Ne.nodeName.toLowerCase(),Ce==="select"||Ce==="input"&&Ne.type==="file")var Bt=np;else if(sp(Ne))if(ap)Bt=R1;else{Bt=w1;var Je=A1}else Ce=Ne.nodeName,!Ce||Ce.toLowerCase()!=="input"||Ne.type!=="checkbox"&&Ne.type!=="radio"?Te&&Dr(Te.elementType)&&(Bt=np):Bt=N1;if(Bt&&(Bt=Bt(n,Te))){ip(Pe,Bt,h,Me);break e}Je&&Je(n,Ne,Te),n==="focusout"&&Te&&Ne.type==="number"&&Te.memoizedProps.value!=null&&Ss(Ne,"number",Ne.value)}switch(Je=Te?he(Te):window,n){case"focusin":(sp(Je)||Je.contentEditable==="true")&&(jr=Je,Md=Te,Yo=null);break;case"focusout":Yo=Md=jr=null;break;case"mousedown":jd=!0;break;case"contextmenu":case"mouseup":case"dragend":jd=!1,fp(Pe,h,Me);break;case"selectionchange":if(L1)break;case"keydown":case"keyup":fp(Pe,h,Me)}var Et;if(Ld)e:{switch(n){case"compositionstart":var It="onCompositionStart";break e;case"compositionend":It="onCompositionEnd";break e;case"compositionupdate":It="onCompositionUpdate";break e}It=void 0}else Mr?ep(n,h)&&(It="onCompositionEnd"):n==="keydown"&&h.keyCode===229&&(It="onCompositionStart");It&&(Qg&&h.locale!=="ko"&&(Mr||It!=="onCompositionStart"?It==="onCompositionEnd"&&Mr&&(Et=zg()):(Zi=Me,kr="value"in Zi?Zi.value:Zi.textContent,Mr=!0)),Je=Xc(Te,It),0<Je.length&&(It=new Wg(It,n,null,h,Me),Pe.push({event:It,listeners:Je}),Et?It.data=Et:(Et=tp(h),Et!==null&&(It.data=Et)))),(Et=_1?b1(n,h):S1(n,h))&&(It=Xc(Te,"onBeforeInput"),0<It.length&&(Je=new Wg("onBeforeInput","beforeinput",null,h,Me),Pe.push({event:Je,listeners:It}),Je.data=Et)),fT(Pe,n,Te,h,Me)}Uy(Pe,o)})}function vl(n,o,h){return{instance:n,listener:o,currentTarget:h}}function Xc(n,o){for(var h=o+"Capture",p=[];n!==null;){var b=n,T=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||T===null||(b=Rn(n,h),b!=null&&p.unshift(vl(n,b,T)),b=Rn(n,o),b!=null&&p.push(vl(n,b,T))),n.tag===3)return p;n=n.return}return[]}function yT(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function Gy(n,o,h,p,b){for(var T=o._reactName,P=[];h!==null&&h!==p;){var W=h,ce=W.alternate,Te=W.stateNode;if(W=W.tag,ce!==null&&ce===p)break;W!==5&&W!==26&&W!==27||Te===null||(ce=Te,b?(Te=Rn(h,T),Te!=null&&P.unshift(vl(h,Te,ce))):b||(Te=Rn(h,T),Te!=null&&P.push(vl(h,Te,ce)))),h=h.return}P.length!==0&&n.push({event:o,listeners:P})}var xT=/\r\n?/g,vT=/\u0000|\uFFFD/g;function $y(n){return(typeof n=="string"?n:""+n).replace(xT,`
`).replace(vT,"")}function Vy(n,o){return o=$y(o),$y(n)===o}function Yt(n,o,h,p,b,T){switch(h){case"children":typeof p=="string"?o==="body"||o==="textarea"&&p===""||zs(n,p):(typeof p=="number"||typeof p=="bigint")&&o!=="body"&&zs(n,""+p);break;case"className":nt(n,"class",p);break;case"tabIndex":nt(n,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":nt(n,h,p);break;case"style":sc(n,p,T);break;case"data":if(o!=="object"){nt(n,"data",p);break}case"src":case"href":if(p===""&&(o!=="a"||h!=="href")){n.removeAttribute(h);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){n.removeAttribute(h);break}p=Ua(""+p),n.setAttribute(h,p);break;case"action":case"formAction":if(typeof p=="function"){n.setAttribute(h,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof T=="function"&&(h==="formAction"?(o!=="input"&&Yt(n,o,"name",b.name,b,null),Yt(n,o,"formEncType",b.formEncType,b,null),Yt(n,o,"formMethod",b.formMethod,b,null),Yt(n,o,"formTarget",b.formTarget,b,null)):(Yt(n,o,"encType",b.encType,b,null),Yt(n,o,"method",b.method,b,null),Yt(n,o,"target",b.target,b,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){n.removeAttribute(h);break}p=Ua(""+p),n.setAttribute(h,p);break;case"onClick":p!=null&&(n.onclick=pi);break;case"onScroll":p!=null&&Nt("scroll",n);break;case"onScrollEnd":p!=null&&Nt("scrollend",n);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(s(61));if(h=p.__html,h!=null){if(b.children!=null)throw Error(s(60));n.innerHTML=h}}break;case"multiple":n.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":n.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){n.removeAttribute("xlink:href");break}h=Ua(""+p),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?n.setAttribute(h,""+p):n.removeAttribute(h);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?n.setAttribute(h,""):n.removeAttribute(h);break;case"capture":case"download":p===!0?n.setAttribute(h,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?n.setAttribute(h,p):n.removeAttribute(h);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?n.setAttribute(h,p):n.removeAttribute(h);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?n.removeAttribute(h):n.setAttribute(h,p);break;case"popover":Nt("beforetoggle",n),Nt("toggle",n),ht(n,"popover",p);break;case"xlinkActuate":st(n,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":st(n,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":st(n,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":st(n,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":st(n,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":st(n,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":st(n,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":st(n,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":st(n,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":ht(n,"is",p);break;case"innerText":case"textContent":break;default:(!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(h=Pa.get(h)||h,ht(n,h,p))}}function of(n,o,h,p,b,T){switch(h){case"style":sc(n,p,T);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(s(61));if(h=p.__html,h!=null){if(b.children!=null)throw Error(s(60));n.innerHTML=h}}break;case"children":typeof p=="string"?zs(n,p):(typeof p=="number"||typeof p=="bigint")&&zs(n,""+p);break;case"onScroll":p!=null&&Nt("scroll",n);break;case"onScrollEnd":p!=null&&Nt("scrollend",n);break;case"onClick":p!=null&&(n.onclick=pi);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ye.hasOwnProperty(h))e:{if(h[0]==="o"&&h[1]==="n"&&(b=h.endsWith("Capture"),o=h.slice(2,b?h.length-7:void 0),T=n[_]||null,T=T!=null?T[h]:null,typeof T=="function"&&n.removeEventListener(o,T,b),typeof p=="function")){typeof T!="function"&&T!==null&&(h in n?n[h]=null:n.hasAttribute(h)&&n.removeAttribute(h)),n.addEventListener(o,p,b);break e}h in n?n[h]=p:p===!0?n.setAttribute(h,""):ht(n,h,p)}}}function $s(n,o,h){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Nt("error",n),Nt("load",n);var p=!1,b=!1,T;for(T in h)if(h.hasOwnProperty(T)){var P=h[T];if(P!=null)switch(T){case"src":p=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:Yt(n,o,T,P,h,null)}}b&&Yt(n,o,"srcSet",h.srcSet,h,null),p&&Yt(n,o,"src",h.src,h,null);return;case"input":Nt("invalid",n);var W=T=P=b=null,ce=null,Te=null;for(p in h)if(h.hasOwnProperty(p)){var Me=h[p];if(Me!=null)switch(p){case"name":b=Me;break;case"type":P=Me;break;case"checked":ce=Me;break;case"defaultChecked":Te=Me;break;case"value":T=Me;break;case"defaultValue":W=Me;break;case"children":case"dangerouslySetInnerHTML":if(Me!=null)throw Error(s(137,o));break;default:Yt(n,o,p,Me,h,null)}}js(n,T,W,ce,Te,P,b,!1);return;case"select":Nt("invalid",n),p=P=T=null;for(b in h)if(h.hasOwnProperty(b)&&(W=h[b],W!=null))switch(b){case"value":T=W;break;case"defaultValue":P=W;break;case"multiple":p=W;default:Yt(n,o,b,W,h,null)}o=T,h=P,n.multiple=!!p,o!=null?hs(n,!!p,o,!1):h!=null&&hs(n,!!p,h,!0);return;case"textarea":Nt("invalid",n),T=b=p=null;for(P in h)if(h.hasOwnProperty(P)&&(W=h[P],W!=null))switch(P){case"value":p=W;break;case"defaultValue":b=W;break;case"children":T=W;break;case"dangerouslySetInnerHTML":if(W!=null)throw Error(s(91));break;default:Yt(n,o,P,W,h,null)}ki(n,p,b,T);return;case"option":for(ce in h)if(h.hasOwnProperty(ce)&&(p=h[ce],p!=null))switch(ce){case"selected":n.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:Yt(n,o,ce,p,h,null)}return;case"dialog":Nt("beforetoggle",n),Nt("toggle",n),Nt("cancel",n),Nt("close",n);break;case"iframe":case"object":Nt("load",n);break;case"video":case"audio":for(p=0;p<xl.length;p++)Nt(xl[p],n);break;case"image":Nt("error",n),Nt("load",n);break;case"details":Nt("toggle",n);break;case"embed":case"source":case"link":Nt("error",n),Nt("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Te in h)if(h.hasOwnProperty(Te)&&(p=h[Te],p!=null))switch(Te){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:Yt(n,o,Te,p,h,null)}return;default:if(Dr(o)){for(Me in h)h.hasOwnProperty(Me)&&(p=h[Me],p!==void 0&&of(n,o,Me,p,h,void 0));return}}for(W in h)h.hasOwnProperty(W)&&(p=h[W],p!=null&&Yt(n,o,W,p,h,null))}function _T(n,o,h,p){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,T=null,P=null,W=null,ce=null,Te=null,Me=null;for(Ce in h){var Pe=h[Ce];if(h.hasOwnProperty(Ce)&&Pe!=null)switch(Ce){case"checked":break;case"value":break;case"defaultValue":ce=Pe;default:p.hasOwnProperty(Ce)||Yt(n,o,Ce,null,p,Pe)}}for(var Ne in p){var Ce=p[Ne];if(Pe=h[Ne],p.hasOwnProperty(Ne)&&(Ce!=null||Pe!=null))switch(Ne){case"type":T=Ce;break;case"name":b=Ce;break;case"checked":Te=Ce;break;case"defaultChecked":Me=Ce;break;case"value":P=Ce;break;case"defaultValue":W=Ce;break;case"children":case"dangerouslySetInnerHTML":if(Ce!=null)throw Error(s(137,o));break;default:Ce!==Pe&&Yt(n,o,Ne,Ce,p,Pe)}}Bs(n,P,W,ce,Te,Me,T,b);return;case"select":Ce=P=W=Ne=null;for(T in h)if(ce=h[T],h.hasOwnProperty(T)&&ce!=null)switch(T){case"value":break;case"multiple":Ce=ce;default:p.hasOwnProperty(T)||Yt(n,o,T,null,p,ce)}for(b in p)if(T=p[b],ce=h[b],p.hasOwnProperty(b)&&(T!=null||ce!=null))switch(b){case"value":Ne=T;break;case"defaultValue":W=T;break;case"multiple":P=T;default:T!==ce&&Yt(n,o,b,T,p,ce)}o=W,h=P,p=Ce,Ne!=null?hs(n,!!h,Ne,!1):!!p!=!!h&&(o!=null?hs(n,!!h,o,!0):hs(n,!!h,h?[]:"",!1));return;case"textarea":Ce=Ne=null;for(W in h)if(b=h[W],h.hasOwnProperty(W)&&b!=null&&!p.hasOwnProperty(W))switch(W){case"value":break;case"children":break;default:Yt(n,o,W,null,p,b)}for(P in p)if(b=p[P],T=h[P],p.hasOwnProperty(P)&&(b!=null||T!=null))switch(P){case"value":Ne=b;break;case"defaultValue":Ce=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(s(91));break;default:b!==T&&Yt(n,o,P,b,p,T)}kt(n,Ne,Ce);return;case"option":for(var Qe in h)if(Ne=h[Qe],h.hasOwnProperty(Qe)&&Ne!=null&&!p.hasOwnProperty(Qe))switch(Qe){case"selected":n.selected=!1;break;default:Yt(n,o,Qe,null,p,Ne)}for(ce in p)if(Ne=p[ce],Ce=h[ce],p.hasOwnProperty(ce)&&Ne!==Ce&&(Ne!=null||Ce!=null))switch(ce){case"selected":n.selected=Ne&&typeof Ne!="function"&&typeof Ne!="symbol";break;default:Yt(n,o,ce,Ne,p,Ce)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var lt in h)Ne=h[lt],h.hasOwnProperty(lt)&&Ne!=null&&!p.hasOwnProperty(lt)&&Yt(n,o,lt,null,p,Ne);for(Te in p)if(Ne=p[Te],Ce=h[Te],p.hasOwnProperty(Te)&&Ne!==Ce&&(Ne!=null||Ce!=null))switch(Te){case"children":case"dangerouslySetInnerHTML":if(Ne!=null)throw Error(s(137,o));break;default:Yt(n,o,Te,Ne,p,Ce)}return;default:if(Dr(o)){for(var Wt in h)Ne=h[Wt],h.hasOwnProperty(Wt)&&Ne!==void 0&&!p.hasOwnProperty(Wt)&&of(n,o,Wt,void 0,p,Ne);for(Me in p)Ne=p[Me],Ce=h[Me],!p.hasOwnProperty(Me)||Ne===Ce||Ne===void 0&&Ce===void 0||of(n,o,Me,Ne,p,Ce);return}}for(var xe in h)Ne=h[xe],h.hasOwnProperty(xe)&&Ne!=null&&!p.hasOwnProperty(xe)&&Yt(n,o,xe,null,p,Ne);for(Pe in p)Ne=p[Pe],Ce=h[Pe],!p.hasOwnProperty(Pe)||Ne===Ce||Ne==null&&Ce==null||Yt(n,o,Pe,Ne,p,Ce)}function Hy(n){switch(n){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function bT(){if(typeof performance.getEntriesByType=="function"){for(var n=0,o=0,h=performance.getEntriesByType("resource"),p=0;p<h.length;p++){var b=h[p],T=b.transferSize,P=b.initiatorType,W=b.duration;if(T&&W&&Hy(P)){for(P=0,W=b.responseEnd,p+=1;p<h.length;p++){var ce=h[p],Te=ce.startTime;if(Te>W)break;var Me=ce.transferSize,Pe=ce.initiatorType;Me&&Hy(Pe)&&(ce=ce.responseEnd,P+=Me*(ce<W?1:(W-Te)/(ce-Te)))}if(--p,o+=8*(T+P)/(b.duration/1e3),n++,10<n)break}}if(0<n)return o/n/1e6}return navigator.connection&&(n=navigator.connection.downlink,typeof n=="number")?n:5}var lf=null,cf=null;function Qc(n){return n.nodeType===9?n:n.ownerDocument}function Ky(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function zy(n,o){if(n===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&o==="foreignObject"?0:n}function uf(n,o){return n==="textarea"||n==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var df=null;function ST(){var n=window.event;return n&&n.type==="popstate"?n===df?!1:(df=n,!0):(df=null,!1)}var qy=typeof setTimeout=="function"?setTimeout:void 0,ET=typeof clearTimeout=="function"?clearTimeout:void 0,Yy=typeof Promise=="function"?Promise:void 0,TT=typeof queueMicrotask=="function"?queueMicrotask:typeof Yy<"u"?function(n){return Yy.resolve(null).then(n).catch(AT)}:qy;function AT(n){setTimeout(function(){throw n})}function va(n){return n==="head"}function Wy(n,o){var h=o,p=0;do{var b=h.nextSibling;if(n.removeChild(h),b&&b.nodeType===8)if(h=b.data,h==="/$"||h==="/&"){if(p===0){n.removeChild(b),lo(o);return}p--}else if(h==="$"||h==="$?"||h==="$~"||h==="$!"||h==="&")p++;else if(h==="html")_l(n.ownerDocument.documentElement);else if(h==="head"){h=n.ownerDocument.head,_l(h);for(var T=h.firstChild;T;){var P=T.nextSibling,W=T.nodeName;T[J]||W==="SCRIPT"||W==="STYLE"||W==="LINK"&&T.rel.toLowerCase()==="stylesheet"||h.removeChild(T),T=P}}else h==="body"&&_l(n.ownerDocument.body);h=b}while(h);lo(o)}function Xy(n,o){var h=n;n=0;do{var p=h.nextSibling;if(h.nodeType===1?o?(h._stashedDisplay=h.style.display,h.style.display="none"):(h.style.display=h._stashedDisplay||"",h.getAttribute("style")===""&&h.removeAttribute("style")):h.nodeType===3&&(o?(h._stashedText=h.nodeValue,h.nodeValue=""):h.nodeValue=h._stashedText||""),p&&p.nodeType===8)if(h=p.data,h==="/$"){if(n===0)break;n--}else h!=="$"&&h!=="$?"&&h!=="$~"&&h!=="$!"||n++;h=p}while(h)}function hf(n){var o=n.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var h=o;switch(o=o.nextSibling,h.nodeName){case"HTML":case"HEAD":case"BODY":hf(h),ne(h);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(h.rel.toLowerCase()==="stylesheet")continue}n.removeChild(h)}}function wT(n,o,h,p){for(;n.nodeType===1;){var b=h;if(n.nodeName.toLowerCase()!==o.toLowerCase()){if(!p&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(p){if(!n[J])switch(o){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(T=n.getAttribute("rel"),T==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(T!==b.rel||n.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||n.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||n.getAttribute("title")!==(b.title==null?null:b.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(T=n.getAttribute("src"),(T!==(b.src==null?null:b.src)||n.getAttribute("type")!==(b.type==null?null:b.type)||n.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&T&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(o==="input"&&n.type==="hidden"){var T=b.name==null?null:""+b.name;if(b.type==="hidden"&&n.getAttribute("name")===T)return n}else return n;if(n=Gi(n.nextSibling),n===null)break}return null}function NT(n,o,h){if(o==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!h||(n=Gi(n.nextSibling),n===null))return null;return n}function Qy(n,o){for(;n.nodeType!==8;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!o||(n=Gi(n.nextSibling),n===null))return null;return n}function ff(n){return n.data==="$?"||n.data==="$~"}function mf(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState!=="loading"}function RT(n,o){var h=n.ownerDocument;if(n.data==="$~")n._reactRetry=o;else if(n.data!=="$?"||h.readyState!=="loading")o();else{var p=function(){o(),h.removeEventListener("DOMContentLoaded",p)};h.addEventListener("DOMContentLoaded",p),n._reactRetry=p}}function Gi(n){for(;n!=null;n=n.nextSibling){var o=n.nodeType;if(o===1||o===3)break;if(o===8){if(o=n.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return n}var gf=null;function Zy(n){n=n.nextSibling;for(var o=0;n;){if(n.nodeType===8){var h=n.data;if(h==="/$"||h==="/&"){if(o===0)return Gi(n.nextSibling);o--}else h!=="$"&&h!=="$!"&&h!=="$?"&&h!=="$~"&&h!=="&"||o++}n=n.nextSibling}return null}function Jy(n){n=n.previousSibling;for(var o=0;n;){if(n.nodeType===8){var h=n.data;if(h==="$"||h==="$!"||h==="$?"||h==="$~"||h==="&"){if(o===0)return n;o--}else h!=="/$"&&h!=="/&"||o++}n=n.previousSibling}return null}function ex(n,o,h){switch(o=Qc(h),n){case"html":if(n=o.documentElement,!n)throw Error(s(452));return n;case"head":if(n=o.head,!n)throw Error(s(453));return n;case"body":if(n=o.body,!n)throw Error(s(454));return n;default:throw Error(s(451))}}function _l(n){for(var o=n.attributes;o.length;)n.removeAttributeNode(o[0]);ne(n)}var $i=new Map,tx=new Set;function Zc(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var Vn=se.d;se.d={f:CT,r:LT,D:DT,C:IT,L:kT,m:MT,X:OT,S:jT,M:PT};function CT(){var n=Vn.f(),o=Vc();return n||o}function LT(n){var o=le(n);o!==null&&o.tag===5&&o.type==="form"?x0(o):Vn.r(n)}var ao=typeof document>"u"?null:document;function sx(n,o,h){var p=ao;if(p&&typeof o=="string"&&o){var b=$t(o);b='link[rel="'+n+'"][href="'+b+'"]',typeof h=="string"&&(b+='[crossorigin="'+h+'"]'),tx.has(b)||(tx.add(b),n={rel:n,crossOrigin:h,href:o},p.querySelector(b)===null&&(o=p.createElement("link"),$s(o,"link",n),ke(o),p.head.appendChild(o)))}}function DT(n){Vn.D(n),sx("dns-prefetch",n,null)}function IT(n,o){Vn.C(n,o),sx("preconnect",n,o)}function kT(n,o,h){Vn.L(n,o,h);var p=ao;if(p&&n&&o){var b='link[rel="preload"][as="'+$t(o)+'"]';o==="image"&&h&&h.imageSrcSet?(b+='[imagesrcset="'+$t(h.imageSrcSet)+'"]',typeof h.imageSizes=="string"&&(b+='[imagesizes="'+$t(h.imageSizes)+'"]')):b+='[href="'+$t(n)+'"]';var T=b;switch(o){case"style":T=ro(n);break;case"script":T=oo(n)}$i.has(T)||(n=g({rel:"preload",href:o==="image"&&h&&h.imageSrcSet?void 0:n,as:o},h),$i.set(T,n),p.querySelector(b)!==null||o==="style"&&p.querySelector(bl(T))||o==="script"&&p.querySelector(Sl(T))||(o=p.createElement("link"),$s(o,"link",n),ke(o),p.head.appendChild(o)))}}function MT(n,o){Vn.m(n,o);var h=ao;if(h&&n){var p=o&&typeof o.as=="string"?o.as:"script",b='link[rel="modulepreload"][as="'+$t(p)+'"][href="'+$t(n)+'"]',T=b;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":T=oo(n)}if(!$i.has(T)&&(n=g({rel:"modulepreload",href:n},o),$i.set(T,n),h.querySelector(b)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(h.querySelector(Sl(T)))return}p=h.createElement("link"),$s(p,"link",n),ke(p),h.head.appendChild(p)}}}function jT(n,o,h){Vn.S(n,o,h);var p=ao;if(p&&n){var b=we(p).hoistableStyles,T=ro(n);o=o||"default";var P=b.get(T);if(!P){var W={loading:0,preload:null};if(P=p.querySelector(bl(T)))W.loading=5;else{n=g({rel:"stylesheet",href:n,"data-precedence":o},h),(h=$i.get(T))&&pf(n,h);var ce=P=p.createElement("link");ke(ce),$s(ce,"link",n),ce._p=new Promise(function(Te,Me){ce.onload=Te,ce.onerror=Me}),ce.addEventListener("load",function(){W.loading|=1}),ce.addEventListener("error",function(){W.loading|=2}),W.loading|=4,Jc(P,o,p)}P={type:"stylesheet",instance:P,count:1,state:W},b.set(T,P)}}}function OT(n,o){Vn.X(n,o);var h=ao;if(h&&n){var p=we(h).hoistableScripts,b=oo(n),T=p.get(b);T||(T=h.querySelector(Sl(b)),T||(n=g({src:n,async:!0},o),(o=$i.get(b))&&yf(n,o),T=h.createElement("script"),ke(T),$s(T,"link",n),h.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},p.set(b,T))}}function PT(n,o){Vn.M(n,o);var h=ao;if(h&&n){var p=we(h).hoistableScripts,b=oo(n),T=p.get(b);T||(T=h.querySelector(Sl(b)),T||(n=g({src:n,async:!0,type:"module"},o),(o=$i.get(b))&&yf(n,o),T=h.createElement("script"),ke(T),$s(T,"link",n),h.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},p.set(b,T))}}function ix(n,o,h,p){var b=(b=ge.current)?Zc(b):null;if(!b)throw Error(s(446));switch(n){case"meta":case"title":return null;case"style":return typeof h.precedence=="string"&&typeof h.href=="string"?(o=ro(h.href),h=we(b).hoistableStyles,p=h.get(o),p||(p={type:"style",instance:null,count:0,state:null},h.set(o,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(h.rel==="stylesheet"&&typeof h.href=="string"&&typeof h.precedence=="string"){n=ro(h.href);var T=we(b).hoistableStyles,P=T.get(n);if(P||(b=b.ownerDocument||b,P={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},T.set(n,P),(T=b.querySelector(bl(n)))&&!T._p&&(P.instance=T,P.state.loading=5),$i.has(n)||(h={rel:"preload",as:"style",href:h.href,crossOrigin:h.crossOrigin,integrity:h.integrity,media:h.media,hrefLang:h.hrefLang,referrerPolicy:h.referrerPolicy},$i.set(n,h),T||BT(b,n,h,P.state))),o&&p===null)throw Error(s(528,""));return P}if(o&&p!==null)throw Error(s(529,""));return null;case"script":return o=h.async,h=h.src,typeof h=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=oo(h),h=we(b).hoistableScripts,p=h.get(o),p||(p={type:"script",instance:null,count:0,state:null},h.set(o,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,n))}}function ro(n){return'href="'+$t(n)+'"'}function bl(n){return'link[rel="stylesheet"]['+n+"]"}function nx(n){return g({},n,{"data-precedence":n.precedence,precedence:null})}function BT(n,o,h,p){n.querySelector('link[rel="preload"][as="style"]['+o+"]")?p.loading=1:(o=n.createElement("link"),p.preload=o,o.addEventListener("load",function(){return p.loading|=1}),o.addEventListener("error",function(){return p.loading|=2}),$s(o,"link",h),ke(o),n.head.appendChild(o))}function oo(n){return'[src="'+$t(n)+'"]'}function Sl(n){return"script[async]"+n}function ax(n,o,h){if(o.count++,o.instance===null)switch(o.type){case"style":var p=n.querySelector('style[data-href~="'+$t(h.href)+'"]');if(p)return o.instance=p,ke(p),p;var b=g({},h,{"data-href":h.href,"data-precedence":h.precedence,href:null,precedence:null});return p=(n.ownerDocument||n).createElement("style"),ke(p),$s(p,"style",b),Jc(p,h.precedence,n),o.instance=p;case"stylesheet":b=ro(h.href);var T=n.querySelector(bl(b));if(T)return o.state.loading|=4,o.instance=T,ke(T),T;p=nx(h),(b=$i.get(b))&&pf(p,b),T=(n.ownerDocument||n).createElement("link"),ke(T);var P=T;return P._p=new Promise(function(W,ce){P.onload=W,P.onerror=ce}),$s(T,"link",p),o.state.loading|=4,Jc(T,h.precedence,n),o.instance=T;case"script":return T=oo(h.src),(b=n.querySelector(Sl(T)))?(o.instance=b,ke(b),b):(p=h,(b=$i.get(T))&&(p=g({},h),yf(p,b)),n=n.ownerDocument||n,b=n.createElement("script"),ke(b),$s(b,"link",p),n.head.appendChild(b),o.instance=b);case"void":return null;default:throw Error(s(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(p=o.instance,o.state.loading|=4,Jc(p,h.precedence,n));return o.instance}function Jc(n,o,h){for(var p=h.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=p.length?p[p.length-1]:null,T=b,P=0;P<p.length;P++){var W=p[P];if(W.dataset.precedence===o)T=W;else if(T!==b)break}T?T.parentNode.insertBefore(n,T.nextSibling):(o=h.nodeType===9?h.head:h,o.insertBefore(n,o.firstChild))}function pf(n,o){n.crossOrigin==null&&(n.crossOrigin=o.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=o.referrerPolicy),n.title==null&&(n.title=o.title)}function yf(n,o){n.crossOrigin==null&&(n.crossOrigin=o.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=o.referrerPolicy),n.integrity==null&&(n.integrity=o.integrity)}var eu=null;function rx(n,o,h){if(eu===null){var p=new Map,b=eu=new Map;b.set(h,p)}else b=eu,p=b.get(h),p||(p=new Map,b.set(h,p));if(p.has(n))return p;for(p.set(n,null),h=h.getElementsByTagName(n),b=0;b<h.length;b++){var T=h[b];if(!(T[J]||T[S]||n==="link"&&T.getAttribute("rel")==="stylesheet")&&T.namespaceURI!=="http://www.w3.org/2000/svg"){var P=T.getAttribute(o)||"";P=n+P;var W=p.get(P);W?W.push(T):p.set(P,[T])}}return p}function ox(n,o,h){n=n.ownerDocument||n,n.head.insertBefore(h,o==="title"?n.querySelector("head > title"):null)}function UT(n,o,h){if(h===1||o.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return n=o.disabled,typeof o.precedence=="string"&&n==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function lx(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}function FT(n,o,h,p){if(h.type==="stylesheet"&&(typeof p.media!="string"||matchMedia(p.media).matches!==!1)&&(h.state.loading&4)===0){if(h.instance===null){var b=ro(p.href),T=o.querySelector(bl(b));if(T){o=T._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(n.count++,n=tu.bind(n),o.then(n,n)),h.state.loading|=4,h.instance=T,ke(T);return}T=o.ownerDocument||o,p=nx(p),(b=$i.get(b))&&pf(p,b),T=T.createElement("link"),ke(T);var P=T;P._p=new Promise(function(W,ce){P.onload=W,P.onerror=ce}),$s(T,"link",p),h.instance=T}n.stylesheets===null&&(n.stylesheets=new Map),n.stylesheets.set(h,o),(o=h.state.preload)&&(h.state.loading&3)===0&&(n.count++,h=tu.bind(n),o.addEventListener("load",h),o.addEventListener("error",h))}}var xf=0;function GT(n,o){return n.stylesheets&&n.count===0&&iu(n,n.stylesheets),0<n.count||0<n.imgCount?function(h){var p=setTimeout(function(){if(n.stylesheets&&iu(n,n.stylesheets),n.unsuspend){var T=n.unsuspend;n.unsuspend=null,T()}},6e4+o);0<n.imgBytes&&xf===0&&(xf=62500*bT());var b=setTimeout(function(){if(n.waitingForImages=!1,n.count===0&&(n.stylesheets&&iu(n,n.stylesheets),n.unsuspend)){var T=n.unsuspend;n.unsuspend=null,T()}},(n.imgBytes>xf?50:800)+o);return n.unsuspend=h,function(){n.unsuspend=null,clearTimeout(p),clearTimeout(b)}}:null}function tu(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)iu(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var su=null;function iu(n,o){n.stylesheets=null,n.unsuspend!==null&&(n.count++,su=new Map,o.forEach($T,n),su=null,tu.call(n))}function $T(n,o){if(!(o.state.loading&4)){var h=su.get(n);if(h)var p=h.get(null);else{h=new Map,su.set(n,h);for(var b=n.querySelectorAll("link[data-precedence],style[data-precedence]"),T=0;T<b.length;T++){var P=b[T];(P.nodeName==="LINK"||P.getAttribute("media")!=="not all")&&(h.set(P.dataset.precedence,P),p=P)}p&&h.set(null,p)}b=o.instance,P=b.getAttribute("data-precedence"),T=h.get(P)||p,T===p&&h.set(null,b),h.set(P,b),this.count++,p=tu.bind(this),b.addEventListener("load",p),b.addEventListener("error",p),T?T.parentNode.insertBefore(b,T.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(b,n.firstChild)),o.state.loading|=4}}var El={$$typeof:L,Provider:null,Consumer:null,_currentValue:oe,_currentValue2:oe,_threadCount:0};function VT(n,o,h,p,b,T,P,W,ce){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Cr(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Cr(0),this.hiddenUpdates=Cr(null),this.identifierPrefix=p,this.onUncaughtError=b,this.onCaughtError=T,this.onRecoverableError=P,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ce,this.incompleteTransitions=new Map}function cx(n,o,h,p,b,T,P,W,ce,Te,Me,Pe){return n=new VT(n,o,h,P,ce,Te,Me,Pe,W),o=1,T===!0&&(o|=24),T=xi(3,null,null,o),n.current=T,T.stateNode=n,o=Xd(),o.refCount++,n.pooledCache=o,o.refCount++,T.memoizedState={element:p,isDehydrated:h,cache:o},eh(T),n}function ux(n){return n?(n=Br,n):Br}function dx(n,o,h,p,b,T){b=ux(b),p.context===null?p.context=b:p.pendingContext=b,p=la(o),p.payload={element:h},T=T===void 0?null:T,T!==null&&(p.callback=T),h=ca(n,p,o),h!==null&&(ci(h,n,o),tl(h,n,o))}function hx(n,o){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var h=n.retryLane;n.retryLane=h!==0&&h<o?h:o}}function vf(n,o){hx(n,o),(n=n.alternate)&&hx(n,o)}function fx(n){if(n.tag===13||n.tag===31){var o=Ka(n,67108864);o!==null&&ci(o,n,67108864),vf(n,67108864)}}function mx(n){if(n.tag===13||n.tag===31){var o=Ei();o=Bo(o);var h=Ka(n,o);h!==null&&ci(h,n,o),vf(n,o)}}var nu=!0;function HT(n,o,h,p){var b=Q.T;Q.T=null;var T=se.p;try{se.p=2,_f(n,o,h,p)}finally{se.p=T,Q.T=b}}function KT(n,o,h,p){var b=Q.T;Q.T=null;var T=se.p;try{se.p=8,_f(n,o,h,p)}finally{se.p=T,Q.T=b}}function _f(n,o,h,p){if(nu){var b=bf(p);if(b===null)rf(n,o,p,au,h),px(n,p);else if(qT(b,n,o,h,p))p.stopPropagation();else if(px(n,p),o&4&&-1<zT.indexOf(n)){for(;b!==null;){var T=le(b);if(T!==null)switch(T.tag){case 3:if(T=T.stateNode,T.current.memoizedState.isDehydrated){var P=An(T.pendingLanes);if(P!==0){var W=T;for(W.pendingLanes|=2,W.entangledLanes|=2;P;){var ce=1<<31-ds(P);W.entanglements[1]|=ce,P&=~ce}fn(T),(Gt&6)===0&&(Gc=vt()+500,yl(0))}}break;case 31:case 13:W=Ka(T,2),W!==null&&ci(W,T,2),Vc(),vf(T,2)}if(T=bf(p),T===null&&rf(n,o,p,au,h),T===b)break;b=T}b!==null&&p.stopPropagation()}else rf(n,o,p,null,h)}}function bf(n){return n=Nn(n),Sf(n)}var au=null;function Sf(n){if(au=null,n=de(n),n!==null){var o=l(n);if(o===null)n=null;else{var h=o.tag;if(h===13){if(n=c(o),n!==null)return n;n=null}else if(h===31){if(n=u(o),n!==null)return n;n=null}else if(h===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;n=null}else o!==n&&(n=null)}}return au=n,null}function gx(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Zs()){case Ms:return 2;case Di:return 8;case mi:case Xi:return 32;case Qi:return 268435456;default:return 32}default:return 32}}var Ef=!1,_a=null,ba=null,Sa=null,Tl=new Map,Al=new Map,Ea=[],zT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function px(n,o){switch(n){case"focusin":case"focusout":_a=null;break;case"dragenter":case"dragleave":ba=null;break;case"mouseover":case"mouseout":Sa=null;break;case"pointerover":case"pointerout":Tl.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Al.delete(o.pointerId)}}function wl(n,o,h,p,b,T){return n===null||n.nativeEvent!==T?(n={blockedOn:o,domEventName:h,eventSystemFlags:p,nativeEvent:T,targetContainers:[b]},o!==null&&(o=le(o),o!==null&&fx(o)),n):(n.eventSystemFlags|=p,o=n.targetContainers,b!==null&&o.indexOf(b)===-1&&o.push(b),n)}function qT(n,o,h,p,b){switch(o){case"focusin":return _a=wl(_a,n,o,h,p,b),!0;case"dragenter":return ba=wl(ba,n,o,h,p,b),!0;case"mouseover":return Sa=wl(Sa,n,o,h,p,b),!0;case"pointerover":var T=b.pointerId;return Tl.set(T,wl(Tl.get(T)||null,n,o,h,p,b)),!0;case"gotpointercapture":return T=b.pointerId,Al.set(T,wl(Al.get(T)||null,n,o,h,p,b)),!0}return!1}function yx(n){var o=de(n.target);if(o!==null){var h=l(o);if(h!==null){if(o=h.tag,o===13){if(o=c(h),o!==null){n.blockedOn=o,N(n.priority,function(){mx(h)});return}}else if(o===31){if(o=u(h),o!==null){n.blockedOn=o,N(n.priority,function(){mx(h)});return}}else if(o===3&&h.stateNode.current.memoizedState.isDehydrated){n.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}n.blockedOn=null}function ru(n){if(n.blockedOn!==null)return!1;for(var o=n.targetContainers;0<o.length;){var h=bf(n.nativeEvent);if(h===null){h=n.nativeEvent;var p=new h.constructor(h.type,h);Fa=p,h.target.dispatchEvent(p),Fa=null}else return o=le(h),o!==null&&fx(o),n.blockedOn=h,!1;o.shift()}return!0}function xx(n,o,h){ru(n)&&h.delete(o)}function YT(){Ef=!1,_a!==null&&ru(_a)&&(_a=null),ba!==null&&ru(ba)&&(ba=null),Sa!==null&&ru(Sa)&&(Sa=null),Tl.forEach(xx),Al.forEach(xx)}function ou(n,o){n.blockedOn===o&&(n.blockedOn=null,Ef||(Ef=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,YT)))}var lu=null;function vx(n){lu!==n&&(lu=n,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){lu===n&&(lu=null);for(var o=0;o<n.length;o+=3){var h=n[o],p=n[o+1],b=n[o+2];if(typeof p!="function"){if(Sf(p||h)===null)continue;break}var T=le(h);T!==null&&(n.splice(o,3),o-=3,_h(T,{pending:!0,data:b,method:h.method,action:p},p,b))}}))}function lo(n){function o(ce){return ou(ce,n)}_a!==null&&ou(_a,n),ba!==null&&ou(ba,n),Sa!==null&&ou(Sa,n),Tl.forEach(o),Al.forEach(o);for(var h=0;h<Ea.length;h++){var p=Ea[h];p.blockedOn===n&&(p.blockedOn=null)}for(;0<Ea.length&&(h=Ea[0],h.blockedOn===null);)yx(h),h.blockedOn===null&&Ea.shift();if(h=(n.ownerDocument||n).$$reactFormReplay,h!=null)for(p=0;p<h.length;p+=3){var b=h[p],T=h[p+1],P=b[_]||null;if(typeof T=="function")P||vx(h);else if(P){var W=null;if(T&&T.hasAttribute("formAction")){if(b=T,P=T[_]||null)W=P.formAction;else if(Sf(b)!==null)continue}else W=P.action;typeof W=="function"?h[p+1]=W:(h.splice(p,3),p-=3),vx(h)}}}function _x(){function n(T){T.canIntercept&&T.info==="react-transition"&&T.intercept({handler:function(){return new Promise(function(P){return b=P})},focusReset:"manual",scroll:"manual"})}function o(){b!==null&&(b(),b=null),p||setTimeout(h,20)}function h(){if(!p&&!navigation.transition){var T=navigation.currentEntry;T&&T.url!=null&&navigation.navigate(T.url,{state:T.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var p=!1,b=null;return navigation.addEventListener("navigate",n),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(h,100),function(){p=!0,navigation.removeEventListener("navigate",n),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),b!==null&&(b(),b=null)}}}function Tf(n){this._internalRoot=n}cu.prototype.render=Tf.prototype.render=function(n){var o=this._internalRoot;if(o===null)throw Error(s(409));var h=o.current,p=Ei();dx(h,p,n,o,null,null)},cu.prototype.unmount=Tf.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var o=n.containerInfo;dx(n.current,2,null,n,null,null),Vc(),o[C]=null}};function cu(n){this._internalRoot=n}cu.prototype.unstable_scheduleHydration=function(n){if(n){var o=tc();n={blockedOn:null,target:n,priority:o};for(var h=0;h<Ea.length&&o!==0&&o<Ea[h].priority;h++);Ea.splice(h,0,n),h===0&&yx(n)}};var bx=e.version;if(bx!=="19.2.3")throw Error(s(527,bx,"19.2.3"));se.findDOMNode=function(n){var o=n._reactInternals;if(o===void 0)throw typeof n.render=="function"?Error(s(188)):(n=Object.keys(n).join(","),Error(s(268,n)));return n=d(o),n=n!==null?m(n):null,n=n===null?null:n.stateNode,n};var WT={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:Q,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var uu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!uu.isDisabled&&uu.supportsFiber)try{Ae=uu.inject(WT),ct=uu}catch{}}return Rl.createRoot=function(n,o){if(!a(n))throw Error(s(299));var h=!1,p="",b=R0,T=C0,P=L0;return o!=null&&(o.unstable_strictMode===!0&&(h=!0),o.identifierPrefix!==void 0&&(p=o.identifierPrefix),o.onUncaughtError!==void 0&&(b=o.onUncaughtError),o.onCaughtError!==void 0&&(T=o.onCaughtError),o.onRecoverableError!==void 0&&(P=o.onRecoverableError)),o=cx(n,1,!1,null,null,h,p,null,b,T,P,_x),n[C]=o.current,af(n),new Tf(o)},Rl.hydrateRoot=function(n,o,h){if(!a(n))throw Error(s(299));var p=!1,b="",T=R0,P=C0,W=L0,ce=null;return h!=null&&(h.unstable_strictMode===!0&&(p=!0),h.identifierPrefix!==void 0&&(b=h.identifierPrefix),h.onUncaughtError!==void 0&&(T=h.onUncaughtError),h.onCaughtError!==void 0&&(P=h.onCaughtError),h.onRecoverableError!==void 0&&(W=h.onRecoverableError),h.formState!==void 0&&(ce=h.formState)),o=cx(n,1,!0,o,h??null,p,b,ce,T,P,W,_x),o.context=ux(null),h=o.current,p=Ei(),p=Bo(p),b=la(p),b.callback=null,ca(h,b,p),h=p,o.current.lanes=h,ea(o,h),fn(o),n[C]=o.current,af(n),new cu(o)},Rl.version="19.2.3",Rl}var Dx;function aA(){if(Dx)return Nf.exports;Dx=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),Nf.exports=nA(),Nf.exports}var rA=aA();var Ix="popstate";function oA(i={}){function e(s,a){let{pathname:l,search:c,hash:u}=s.location;return um("",{pathname:l,search:c,hash:u},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function t(s,a){return typeof a=="string"?a:Ul(a)}return cA(e,t,null,i)}function rs(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function zi(i,e){if(!i){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function lA(){return Math.random().toString(36).substring(2,10)}function kx(i,e){return{usr:i.state,key:i.key,idx:e}}function um(i,e,t=null,s){return{pathname:typeof i=="string"?i:i.pathname,search:"",hash:"",...typeof e=="string"?Co(e):e,state:t,key:e&&e.key||s||lA()}}function Ul({pathname:i="/",search:e="",hash:t=""}){return e&&e!=="?"&&(i+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(i+=t.charAt(0)==="#"?t:"#"+t),i}function Co(i){let e={};if(i){let t=i.indexOf("#");t>=0&&(e.hash=i.substring(t),i=i.substring(0,t));let s=i.indexOf("?");s>=0&&(e.search=i.substring(s),i=i.substring(0,s)),i&&(e.pathname=i)}return e}function cA(i,e,t,s={}){let{window:a=document.defaultView,v5Compat:l=!1}=s,c=a.history,u="POP",f=null,d=m();d==null&&(d=0,c.replaceState({...c.state,idx:d},""));function m(){return(c.state||{idx:null}).idx}function g(){u="POP";let A=m(),R=A==null?null:A-d;d=A,f&&f({action:u,location:E.location,delta:R})}function y(A,R){u="PUSH";let D=um(E.location,A,R);d=m()+1;let L=kx(D,d),O=E.createHref(D);try{c.pushState(L,"",O)}catch(H){if(H instanceof DOMException&&H.name==="DataCloneError")throw H;a.location.assign(O)}l&&f&&f({action:u,location:E.location,delta:1})}function x(A,R){u="REPLACE";let D=um(E.location,A,R);d=m();let L=kx(D,d),O=E.createHref(D);c.replaceState(L,"",O),l&&f&&f({action:u,location:E.location,delta:0})}function v(A){return uA(A)}let E={get action(){return u},get location(){return i(a,c)},listen(A){if(f)throw new Error("A history only accepts one active listener");return a.addEventListener(Ix,g),f=A,()=>{a.removeEventListener(Ix,g),f=null}},createHref(A){return e(a,A)},createURL:v,encodeLocation(A){let R=v(A);return{pathname:R.pathname,search:R.search,hash:R.hash}},push:y,replace:x,go(A){return c.go(A)}};return E}function uA(i,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),rs(t,"No window.location.(origin|href) available to create URL");let s=typeof i=="string"?i:Ul(i);return s=s.replace(/ $/,"%20"),!e&&s.startsWith("//")&&(s=t+s),new URL(s,t)}function K_(i,e,t="/"){return dA(i,e,t,!1)}function dA(i,e,t,s){let a=typeof e=="string"?Co(e):e,l=Qn(a.pathname||"/",t);if(l==null)return null;let c=z_(i);hA(c);let u=null;for(let f=0;u==null&&f<c.length;++f){let d=EA(l);u=bA(c[f],d,s)}return u}function z_(i,e=[],t=[],s="",a=!1){let l=(c,u,f=a,d)=>{let m={relativePath:d===void 0?c.path||"":d,caseSensitive:c.caseSensitive===!0,childrenIndex:u,route:c};if(m.relativePath.startsWith("/")){if(!m.relativePath.startsWith(s)&&f)return;rs(m.relativePath.startsWith(s),`Absolute route path "${m.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),m.relativePath=m.relativePath.slice(s.length)}let g=Wn([s,m.relativePath]),y=t.concat(m);c.children&&c.children.length>0&&(rs(c.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),z_(c.children,e,y,g,f)),!(c.path==null&&!c.index)&&e.push({path:g,score:vA(g,c.index),routesMeta:y})};return i.forEach((c,u)=>{if(c.path===""||!c.path?.includes("?"))l(c,u);else for(let f of q_(c.path))l(c,u,!0,f)}),e}function q_(i){let e=i.split("/");if(e.length===0)return[];let[t,...s]=e,a=t.endsWith("?"),l=t.replace(/\?$/,"");if(s.length===0)return a?[l,""]:[l];let c=q_(s.join("/")),u=[];return u.push(...c.map(f=>f===""?l:[l,f].join("/"))),a&&u.push(...c),u.map(f=>i.startsWith("/")&&f===""?"/":f)}function hA(i){i.sort((e,t)=>e.score!==t.score?t.score-e.score:_A(e.routesMeta.map(s=>s.childrenIndex),t.routesMeta.map(s=>s.childrenIndex)))}var fA=/^:[\w-]+$/,mA=3,gA=2,pA=1,yA=10,xA=-2,Mx=i=>i==="*";function vA(i,e){let t=i.split("/"),s=t.length;return t.some(Mx)&&(s+=xA),e&&(s+=gA),t.filter(a=>!Mx(a)).reduce((a,l)=>a+(fA.test(l)?mA:l===""?pA:yA),s)}function _A(i,e){return i.length===e.length&&i.slice(0,-1).every((s,a)=>s===e[a])?i[i.length-1]-e[e.length-1]:0}function bA(i,e,t=!1){let{routesMeta:s}=i,a={},l="/",c=[];for(let u=0;u<s.length;++u){let f=s[u],d=u===s.length-1,m=l==="/"?e:e.slice(l.length)||"/",g=Yu({path:f.relativePath,caseSensitive:f.caseSensitive,end:d},m),y=f.route;if(!g&&d&&t&&!s[s.length-1].route.index&&(g=Yu({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},m)),!g)return null;Object.assign(a,g.params),c.push({params:a,pathname:Wn([l,g.pathname]),pathnameBase:RA(Wn([l,g.pathnameBase])),route:y}),g.pathnameBase!=="/"&&(l=Wn([l,g.pathnameBase]))}return c}function Yu(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[t,s]=SA(i.path,i.caseSensitive,i.end),a=e.match(t);if(!a)return null;let l=a[0],c=l.replace(/(.)\/+$/,"$1"),u=a.slice(1);return{params:s.reduce((d,{paramName:m,isOptional:g},y)=>{if(m==="*"){let v=u[y]||"";c=l.slice(0,l.length-v.length).replace(/(.)\/+$/,"$1")}const x=u[y];return g&&!x?d[m]=void 0:d[m]=(x||"").replace(/%2F/g,"/"),d},{}),pathname:l,pathnameBase:c,pattern:i}}function SA(i,e=!1,t=!0){zi(i==="*"||!i.endsWith("*")||i.endsWith("/*"),`Route path "${i}" will be treated as if it were "${i.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${i.replace(/\*$/,"/*")}".`);let s=[],a="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(c,u,f)=>(s.push({paramName:u,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return i.endsWith("*")?(s.push({paramName:"*"}),a+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?a+="\\/*$":i!==""&&i!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,e?void 0:"i"),s]}function EA(i){try{return i.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return zi(!1,`The URL path "${i}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),i}}function Qn(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,s=i.charAt(t);return s&&s!=="/"?null:i.slice(t)||"/"}var TA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,AA=i=>TA.test(i);function wA(i,e="/"){let{pathname:t,search:s="",hash:a=""}=typeof i=="string"?Co(i):i,l;if(t)if(AA(t))l=t;else{if(t.includes("//")){let c=t;t=t.replace(/\/\/+/g,"/"),zi(!1,`Pathnames cannot have embedded double slashes - normalizing ${c} -> ${t}`)}t.startsWith("/")?l=jx(t.substring(1),"/"):l=jx(t,e)}else l=e;return{pathname:l,search:CA(s),hash:LA(a)}}function jx(i,e){let t=e.replace(/\/+$/,"").split("/");return i.split("/").forEach(a=>{a===".."?t.length>1&&t.pop():a!=="."&&t.push(a)}),t.length>1?t.join("/"):"/"}function Df(i,e,t,s){return`Cannot include a '${i}' character in a manually specified \`to.${e}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function NA(i){return i.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function qm(i){let e=NA(i);return e.map((t,s)=>s===e.length-1?t.pathname:t.pathnameBase)}function Ym(i,e,t,s=!1){let a;typeof i=="string"?a=Co(i):(a={...i},rs(!a.pathname||!a.pathname.includes("?"),Df("?","pathname","search",a)),rs(!a.pathname||!a.pathname.includes("#"),Df("#","pathname","hash",a)),rs(!a.search||!a.search.includes("#"),Df("#","search","hash",a)));let l=i===""||a.pathname==="",c=l?"/":a.pathname,u;if(c==null)u=t;else{let g=e.length-1;if(!s&&c.startsWith("..")){let y=c.split("/");for(;y[0]==="..";)y.shift(),g-=1;a.pathname=y.join("/")}u=g>=0?e[g]:"/"}let f=wA(a,u),d=c&&c!=="/"&&c.endsWith("/"),m=(l||c===".")&&t.endsWith("/");return!f.pathname.endsWith("/")&&(d||m)&&(f.pathname+="/"),f}var Wn=i=>i.join("/").replace(/\/\/+/g,"/"),RA=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),CA=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,LA=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;function DA(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}function IA(i){return i.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Y_=["POST","PUT","PATCH","DELETE"];new Set(Y_);var kA=["GET",...Y_];new Set(kA);var Lo=K.createContext(null);Lo.displayName="DataRouter";var dd=K.createContext(null);dd.displayName="DataRouterState";K.createContext(!1);var W_=K.createContext({isTransitioning:!1});W_.displayName="ViewTransition";var MA=K.createContext(new Map);MA.displayName="Fetchers";var jA=K.createContext(null);jA.displayName="Await";var Yi=K.createContext(null);Yi.displayName="Navigation";var Yl=K.createContext(null);Yl.displayName="Location";var rn=K.createContext({outlet:null,matches:[],isDataRoute:!1});rn.displayName="Route";var Wm=K.createContext(null);Wm.displayName="RouteError";function OA(i,{relative:e}={}){rs(Do(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:s}=K.useContext(Yi),{hash:a,pathname:l,search:c}=Xl(i,{relative:e}),u=l;return t!=="/"&&(u=l==="/"?t:Wn([t,l])),s.createHref({pathname:u,search:c,hash:a})}function Do(){return K.useContext(Yl)!=null}function Jn(){return rs(Do(),"useLocation() may be used only in the context of a <Router> component."),K.useContext(Yl).location}var X_="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Q_(i){K.useContext(Yi).static||K.useLayoutEffect(i)}function Wl(){let{isDataRoute:i}=K.useContext(rn);return i?QA():PA()}function PA(){rs(Do(),"useNavigate() may be used only in the context of a <Router> component.");let i=K.useContext(Lo),{basename:e,navigator:t}=K.useContext(Yi),{matches:s}=K.useContext(rn),{pathname:a}=Jn(),l=JSON.stringify(qm(s)),c=K.useRef(!1);return Q_(()=>{c.current=!0}),K.useCallback((f,d={})=>{if(zi(c.current,X_),!c.current)return;if(typeof f=="number"){t.go(f);return}let m=Ym(f,JSON.parse(l),a,d.relative==="path");i==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:Wn([e,m.pathname])),(d.replace?t.replace:t.push)(m,d.state,d)},[e,t,l,a,i])}var BA=K.createContext(null);function UA(i){let e=K.useContext(rn).outlet;return K.useMemo(()=>e&&K.createElement(BA.Provider,{value:i},e),[e,i])}function Xl(i,{relative:e}={}){let{matches:t}=K.useContext(rn),{pathname:s}=Jn(),a=JSON.stringify(qm(t));return K.useMemo(()=>Ym(i,JSON.parse(a),s,e==="path"),[i,a,s,e])}function FA(i,e){return Z_(i,e)}function Z_(i,e,t,s,a){rs(Do(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:l}=K.useContext(Yi),{matches:c}=K.useContext(rn),u=c[c.length-1],f=u?u.params:{},d=u?u.pathname:"/",m=u?u.pathnameBase:"/",g=u&&u.route;{let D=g&&g.path||"";J_(d,!g||D.endsWith("*")||D.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${D}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${D}"> to <Route path="${D==="/"?"*":`${D}/*`}">.`)}let y=Jn(),x;if(e){let D=typeof e=="string"?Co(e):e;rs(m==="/"||D.pathname?.startsWith(m),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${m}" but pathname "${D.pathname}" was given in the \`location\` prop.`),x=D}else x=y;let v=x.pathname||"/",E=v;if(m!=="/"){let D=m.replace(/^\//,"").split("/");E="/"+v.replace(/^\//,"").split("/").slice(D.length).join("/")}let A=K_(i,{pathname:E});zi(g||A!=null,`No routes matched location "${x.pathname}${x.search}${x.hash}" `),zi(A==null||A[A.length-1].route.element!==void 0||A[A.length-1].route.Component!==void 0||A[A.length-1].route.lazy!==void 0,`Matched leaf route at location "${x.pathname}${x.search}${x.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let R=KA(A&&A.map(D=>Object.assign({},D,{params:Object.assign({},f,D.params),pathname:Wn([m,l.encodeLocation?l.encodeLocation(D.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:D.pathname]),pathnameBase:D.pathnameBase==="/"?m:Wn([m,l.encodeLocation?l.encodeLocation(D.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:D.pathnameBase])})),c,t,s,a);return e&&R?K.createElement(Yl.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...x},navigationType:"POP"}},R):R}function GA(){let i=XA(),e=DA(i)?`${i.status} ${i.statusText}`:i instanceof Error?i.message:JSON.stringify(i),t=i instanceof Error?i.stack:null,s="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:s},l={padding:"2px 4px",backgroundColor:s},c=null;return console.error("Error handled by React Router default ErrorBoundary:",i),c=K.createElement(K.Fragment,null,K.createElement("p",null," Hey developer "),K.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",K.createElement("code",{style:l},"ErrorBoundary")," or"," ",K.createElement("code",{style:l},"errorElement")," prop on your route.")),K.createElement(K.Fragment,null,K.createElement("h2",null,"Unexpected Application Error!"),K.createElement("h3",{style:{fontStyle:"italic"}},e),t?K.createElement("pre",{style:a},t):null,c)}var $A=K.createElement(GA,null),VA=class extends K.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,e){return e.location!==i.location||e.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:e.error,location:e.location,revalidation:i.revalidation||e.revalidation}}componentDidCatch(i,e){this.props.onError?this.props.onError(i,e):console.error("React Router caught the following error during render",i)}render(){return this.state.error!==void 0?K.createElement(rn.Provider,{value:this.props.routeContext},K.createElement(Wm.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function HA({routeContext:i,match:e,children:t}){let s=K.useContext(Lo);return s&&s.static&&s.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=e.route.id),K.createElement(rn.Provider,{value:i},t)}function KA(i,e=[],t=null,s=null,a=null){if(i==null){if(!t)return null;if(t.errors)i=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)i=t.matches;else return null}let l=i,c=t?.errors;if(c!=null){let m=l.findIndex(g=>g.route.id&&c?.[g.route.id]!==void 0);rs(m>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(c).join(",")}`),l=l.slice(0,Math.min(l.length,m+1))}let u=!1,f=-1;if(t)for(let m=0;m<l.length;m++){let g=l[m];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(f=m),g.route.id){let{loaderData:y,errors:x}=t,v=g.route.loader&&!y.hasOwnProperty(g.route.id)&&(!x||x[g.route.id]===void 0);if(g.route.lazy||v){u=!0,f>=0?l=l.slice(0,f+1):l=[l[0]];break}}}let d=t&&s?(m,g)=>{s(m,{location:t.location,params:t.matches?.[0]?.params??{},unstable_pattern:IA(t.matches),errorInfo:g})}:void 0;return l.reduceRight((m,g,y)=>{let x,v=!1,E=null,A=null;t&&(x=c&&g.route.id?c[g.route.id]:void 0,E=g.route.errorElement||$A,u&&(f<0&&y===0?(J_("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),v=!0,A=null):f===y&&(v=!0,A=g.route.hydrateFallbackElement||null)));let R=e.concat(l.slice(0,y+1)),D=()=>{let L;return x?L=E:v?L=A:g.route.Component?L=K.createElement(g.route.Component,null):g.route.element?L=g.route.element:L=m,K.createElement(HA,{match:g,routeContext:{outlet:m,matches:R,isDataRoute:t!=null},children:L})};return t&&(g.route.ErrorBoundary||g.route.errorElement||y===0)?K.createElement(VA,{location:t.location,revalidation:t.revalidation,component:E,error:x,children:D(),routeContext:{outlet:null,matches:R,isDataRoute:!0},onError:d}):D()},null)}function Xm(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function zA(i){let e=K.useContext(Lo);return rs(e,Xm(i)),e}function qA(i){let e=K.useContext(dd);return rs(e,Xm(i)),e}function YA(i){let e=K.useContext(rn);return rs(e,Xm(i)),e}function Qm(i){let e=YA(i),t=e.matches[e.matches.length-1];return rs(t.route.id,`${i} can only be used on routes that contain a unique "id"`),t.route.id}function WA(){return Qm("useRouteId")}function XA(){let i=K.useContext(Wm),e=qA("useRouteError"),t=Qm("useRouteError");return i!==void 0?i:e.errors?.[t]}function QA(){let{router:i}=zA("useNavigate"),e=Qm("useNavigate"),t=K.useRef(!1);return Q_(()=>{t.current=!0}),K.useCallback(async(a,l={})=>{zi(t.current,X_),t.current&&(typeof a=="number"?await i.navigate(a):await i.navigate(a,{fromRouteId:e,...l}))},[i,e])}var Ox={};function J_(i,e,t){!e&&!Ox[i]&&(Ox[i]=!0,zi(!1,t))}K.memo(ZA);function ZA({routes:i,future:e,state:t,unstable_onError:s}){return Z_(i,void 0,t,s,e)}function eb({to:i,replace:e,state:t,relative:s}){rs(Do(),"<Navigate> may be used only in the context of a <Router> component.");let{static:a}=K.useContext(Yi);zi(!a,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:l}=K.useContext(rn),{pathname:c}=Jn(),u=Wl(),f=Ym(i,qm(l),c,s==="path"),d=JSON.stringify(f);return K.useEffect(()=>{u(JSON.parse(d),{replace:e,state:t,relative:s})},[u,d,s,e,t]),null}function JA(i){return UA(i.context)}function Cs(i){rs(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function ew({basename:i="/",children:e=null,location:t,navigationType:s="POP",navigator:a,static:l=!1,unstable_useTransitions:c}){rs(!Do(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let u=i.replace(/^\/*/,"/"),f=K.useMemo(()=>({basename:u,navigator:a,static:l,unstable_useTransitions:c,future:{}}),[u,a,l,c]);typeof t=="string"&&(t=Co(t));let{pathname:d="/",search:m="",hash:g="",state:y=null,key:x="default"}=t,v=K.useMemo(()=>{let E=Qn(d,u);return E==null?null:{location:{pathname:E,search:m,hash:g,state:y,key:x},navigationType:s}},[u,d,m,g,y,x,s]);return zi(v!=null,`<Router basename="${u}"> is not able to match the URL "${d}${m}${g}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:K.createElement(Yi.Provider,{value:f},K.createElement(Yl.Provider,{children:e,value:v}))}function tw({children:i,location:e}){return FA(dm(i),e)}function dm(i,e=[]){let t=[];return K.Children.forEach(i,(s,a)=>{if(!K.isValidElement(s))return;let l=[...e,a];if(s.type===K.Fragment){t.push.apply(t,dm(s.props.children,l));return}rs(s.type===Cs,`[${typeof s.type=="string"?s.type:s.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),rs(!s.props.index||!s.props.children,"An index route cannot have child routes.");let c={id:s.props.id||l.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,middleware:s.props.middleware,loader:s.props.loader,action:s.props.action,hydrateFallbackElement:s.props.hydrateFallbackElement,HydrateFallback:s.props.HydrateFallback,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.hasErrorBoundary===!0||s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(c.children=dm(s.props.children,l)),t.push(c)}),t}var ku="get",Mu="application/x-www-form-urlencoded";function hd(i){return typeof HTMLElement<"u"&&i instanceof HTMLElement}function sw(i){return hd(i)&&i.tagName.toLowerCase()==="button"}function iw(i){return hd(i)&&i.tagName.toLowerCase()==="form"}function nw(i){return hd(i)&&i.tagName.toLowerCase()==="input"}function aw(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function rw(i,e){return i.button===0&&(!e||e==="_self")&&!aw(i)}var du=null;function ow(){if(du===null)try{new FormData(document.createElement("form"),0),du=!1}catch{du=!0}return du}var lw=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function If(i){return i!=null&&!lw.has(i)?(zi(!1,`"${i}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Mu}"`),null):i}function cw(i,e){let t,s,a,l,c;if(iw(i)){let u=i.getAttribute("action");s=u?Qn(u,e):null,t=i.getAttribute("method")||ku,a=If(i.getAttribute("enctype"))||Mu,l=new FormData(i)}else if(sw(i)||nw(i)&&(i.type==="submit"||i.type==="image")){let u=i.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let f=i.getAttribute("formaction")||u.getAttribute("action");if(s=f?Qn(f,e):null,t=i.getAttribute("formmethod")||u.getAttribute("method")||ku,a=If(i.getAttribute("formenctype"))||If(u.getAttribute("enctype"))||Mu,l=new FormData(u,i),!ow()){let{name:d,type:m,value:g}=i;if(m==="image"){let y=d?`${d}.`:"";l.append(`${y}x`,"0"),l.append(`${y}y`,"0")}else d&&l.append(d,g)}}else{if(hd(i))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=ku,s=null,a=Mu,c=i}return l&&a==="text/plain"&&(c=l,l=void 0),{action:s,method:t.toLowerCase(),encType:a,formData:l,body:c}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Zm(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function uw(i,e,t){let s=typeof i=="string"?new URL(i,typeof window>"u"?"server://singlefetch/":window.location.origin):i;return s.pathname==="/"?s.pathname=`_root.${t}`:e&&Qn(s.pathname,e)==="/"?s.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:s.pathname=`${s.pathname.replace(/\/$/,"")}.${t}`,s}async function dw(i,e){if(i.id in e)return e[i.id];try{let t=await import(i.module);return e[i.id]=t,t}catch(t){return console.error(`Error loading route module \`${i.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function hw(i){return i==null?!1:i.href==null?i.rel==="preload"&&typeof i.imageSrcSet=="string"&&typeof i.imageSizes=="string":typeof i.rel=="string"&&typeof i.href=="string"}async function fw(i,e,t){let s=await Promise.all(i.map(async a=>{let l=e.routes[a.route.id];if(l){let c=await dw(l,t);return c.links?c.links():[]}return[]}));return yw(s.flat(1).filter(hw).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function Px(i,e,t,s,a,l){let c=(f,d)=>t[d]?f.route.id!==t[d].route.id:!0,u=(f,d)=>t[d].pathname!==f.pathname||t[d].route.path?.endsWith("*")&&t[d].params["*"]!==f.params["*"];return l==="assets"?e.filter((f,d)=>c(f,d)||u(f,d)):l==="data"?e.filter((f,d)=>{let m=s.routes[f.route.id];if(!m||!m.hasLoader)return!1;if(c(f,d)||u(f,d))return!0;if(f.route.shouldRevalidate){let g=f.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(i,window.origin),nextParams:f.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function mw(i,e,{includeHydrateFallback:t}={}){return gw(i.map(s=>{let a=e.routes[s.route.id];if(!a)return[];let l=[a.module];return a.clientActionModule&&(l=l.concat(a.clientActionModule)),a.clientLoaderModule&&(l=l.concat(a.clientLoaderModule)),t&&a.hydrateFallbackModule&&(l=l.concat(a.hydrateFallbackModule)),a.imports&&(l=l.concat(a.imports)),l}).flat(1))}function gw(i){return[...new Set(i)]}function pw(i){let e={},t=Object.keys(i).sort();for(let s of t)e[s]=i[s];return e}function yw(i,e){let t=new Set;return new Set(e),i.reduce((s,a)=>{let l=JSON.stringify(pw(a));return t.has(l)||(t.add(l),s.push({key:l,link:a})),s},[])}function tb(){let i=K.useContext(Lo);return Zm(i,"You must render this element inside a <DataRouterContext.Provider> element"),i}function xw(){let i=K.useContext(dd);return Zm(i,"You must render this element inside a <DataRouterStateContext.Provider> element"),i}var Jm=K.createContext(void 0);Jm.displayName="FrameworkContext";function sb(){let i=K.useContext(Jm);return Zm(i,"You must render this element inside a <HydratedRouter> element"),i}function vw(i,e){let t=K.useContext(Jm),[s,a]=K.useState(!1),[l,c]=K.useState(!1),{onFocus:u,onBlur:f,onMouseEnter:d,onMouseLeave:m,onTouchStart:g}=e,y=K.useRef(null);K.useEffect(()=>{if(i==="render"&&c(!0),i==="viewport"){let E=R=>{R.forEach(D=>{c(D.isIntersecting)})},A=new IntersectionObserver(E,{threshold:.5});return y.current&&A.observe(y.current),()=>{A.disconnect()}}},[i]),K.useEffect(()=>{if(s){let E=setTimeout(()=>{c(!0)},100);return()=>{clearTimeout(E)}}},[s]);let x=()=>{a(!0)},v=()=>{a(!1),c(!1)};return t?i!=="intent"?[l,y,{}]:[l,y,{onFocus:Cl(u,x),onBlur:Cl(f,v),onMouseEnter:Cl(d,x),onMouseLeave:Cl(m,v),onTouchStart:Cl(g,x)}]:[!1,y,{}]}function Cl(i,e){return t=>{i&&i(t),t.defaultPrevented||e(t)}}function _w({page:i,...e}){let{router:t}=tb(),s=K.useMemo(()=>K_(t.routes,i,t.basename),[t.routes,i,t.basename]);return s?K.createElement(Sw,{page:i,matches:s,...e}):null}function bw(i){let{manifest:e,routeModules:t}=sb(),[s,a]=K.useState([]);return K.useEffect(()=>{let l=!1;return fw(i,e,t).then(c=>{l||a(c)}),()=>{l=!0}},[i,e,t]),s}function Sw({page:i,matches:e,...t}){let s=Jn(),{manifest:a,routeModules:l}=sb(),{basename:c}=tb(),{loaderData:u,matches:f}=xw(),d=K.useMemo(()=>Px(i,e,f,a,s,"data"),[i,e,f,a,s]),m=K.useMemo(()=>Px(i,e,f,a,s,"assets"),[i,e,f,a,s]),g=K.useMemo(()=>{if(i===s.pathname+s.search+s.hash)return[];let v=new Set,E=!1;if(e.forEach(R=>{let D=a.routes[R.route.id];!D||!D.hasLoader||(!d.some(L=>L.route.id===R.route.id)&&R.route.id in u&&l[R.route.id]?.shouldRevalidate||D.hasClientLoader?E=!0:v.add(R.route.id))}),v.size===0)return[];let A=uw(i,c,"data");return E&&v.size>0&&A.searchParams.set("_routes",e.filter(R=>v.has(R.route.id)).map(R=>R.route.id).join(",")),[A.pathname+A.search]},[c,u,s,a,d,e,i,l]),y=K.useMemo(()=>mw(m,a),[m,a]),x=bw(m);return K.createElement(K.Fragment,null,g.map(v=>K.createElement("link",{key:v,rel:"prefetch",as:"fetch",href:v,...t})),y.map(v=>K.createElement("link",{key:v,rel:"modulepreload",href:v,...t})),x.map(({key:v,link:E})=>K.createElement("link",{key:v,nonce:t.nonce,...E})))}function Ew(...i){return e=>{i.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var ib=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{ib&&(window.__reactRouterVersion="7.10.1")}catch{}function Tw({basename:i,children:e,unstable_useTransitions:t,window:s}){let a=K.useRef();a.current==null&&(a.current=oA({window:s,v5Compat:!0}));let l=a.current,[c,u]=K.useState({action:l.action,location:l.location}),f=K.useCallback(d=>{t===!1?u(d):K.startTransition(()=>u(d))},[t]);return K.useLayoutEffect(()=>l.listen(f),[l,f]),K.createElement(ew,{basename:i,children:e,location:c.location,navigationType:c.action,navigator:l,unstable_useTransitions:t===!0})}var nb=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,eg=K.forwardRef(function({onClick:e,discover:t="render",prefetch:s="none",relative:a,reloadDocument:l,replace:c,state:u,target:f,to:d,preventScrollReset:m,viewTransition:g,...y},x){let{basename:v,unstable_useTransitions:E}=K.useContext(Yi),A=typeof d=="string"&&nb.test(d),R,D=!1;if(typeof d=="string"&&A&&(R=d,ib))try{let I=new URL(window.location.href),j=d.startsWith("//")?new URL(I.protocol+d):new URL(d),Z=Qn(j.pathname,v);j.origin===I.origin&&Z!=null?d=Z+j.search+j.hash:D=!0}catch{zi(!1,`<Link to="${d}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let L=OA(d,{relative:a}),[O,H,q]=vw(s,y),U=Rw(d,{replace:c,state:u,target:f,preventScrollReset:m,relative:a,viewTransition:g,unstable_useTransitions:E});function k(I){e&&e(I),I.defaultPrevented||U(I)}let M=K.createElement("a",{...y,...q,href:R||L,onClick:D||l?e:k,ref:Ew(x,H),target:f,"data-discover":!A&&t==="render"?"true":void 0});return O&&!A?K.createElement(K.Fragment,null,M,K.createElement(_w,{page:L})):M});eg.displayName="Link";var Aw=K.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:s="",end:a=!1,style:l,to:c,viewTransition:u,children:f,...d},m){let g=Xl(c,{relative:d.relative}),y=Jn(),x=K.useContext(dd),{navigator:v,basename:E}=K.useContext(Yi),A=x!=null&&kw(g)&&u===!0,R=v.encodeLocation?v.encodeLocation(g).pathname:g.pathname,D=y.pathname,L=x&&x.navigation&&x.navigation.location?x.navigation.location.pathname:null;t||(D=D.toLowerCase(),L=L?L.toLowerCase():null,R=R.toLowerCase()),L&&E&&(L=Qn(L,E)||L);const O=R!=="/"&&R.endsWith("/")?R.length-1:R.length;let H=D===R||!a&&D.startsWith(R)&&D.charAt(O)==="/",q=L!=null&&(L===R||!a&&L.startsWith(R)&&L.charAt(R.length)==="/"),U={isActive:H,isPending:q,isTransitioning:A},k=H?e:void 0,M;typeof s=="function"?M=s(U):M=[s,H?"active":null,q?"pending":null,A?"transitioning":null].filter(Boolean).join(" ");let I=typeof l=="function"?l(U):l;return K.createElement(eg,{...d,"aria-current":k,className:M,ref:m,style:I,to:c,viewTransition:u},typeof f=="function"?f(U):f)});Aw.displayName="NavLink";var ww=K.forwardRef(({discover:i="render",fetcherKey:e,navigate:t,reloadDocument:s,replace:a,state:l,method:c=ku,action:u,onSubmit:f,relative:d,preventScrollReset:m,viewTransition:g,...y},x)=>{let{unstable_useTransitions:v}=K.useContext(Yi),E=Dw(),A=Iw(u,{relative:d}),R=c.toLowerCase()==="get"?"get":"post",D=typeof u=="string"&&nb.test(u),L=O=>{if(f&&f(O),O.defaultPrevented)return;O.preventDefault();let H=O.nativeEvent.submitter,q=H?.getAttribute("formmethod")||c,U=()=>E(H||O.currentTarget,{fetcherKey:e,method:q,navigate:t,replace:a,state:l,relative:d,preventScrollReset:m,viewTransition:g});v&&t!==!1?K.startTransition(()=>U()):U()};return K.createElement("form",{ref:x,method:R,action:A,onSubmit:s?f:L,...y,"data-discover":!D&&i==="render"?"true":void 0})});ww.displayName="Form";function Nw(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function ab(i){let e=K.useContext(Lo);return rs(e,Nw(i)),e}function Rw(i,{target:e,replace:t,state:s,preventScrollReset:a,relative:l,viewTransition:c,unstable_useTransitions:u}={}){let f=Wl(),d=Jn(),m=Xl(i,{relative:l});return K.useCallback(g=>{if(rw(g,e)){g.preventDefault();let y=t!==void 0?t:Ul(d)===Ul(m),x=()=>f(i,{replace:y,state:s,preventScrollReset:a,relative:l,viewTransition:c});u?K.startTransition(()=>x()):x()}},[d,f,m,t,s,e,i,a,l,c,u])}var Cw=0,Lw=()=>`__${String(++Cw)}__`;function Dw(){let{router:i}=ab("useSubmit"),{basename:e}=K.useContext(Yi),t=WA(),s=i.fetch,a=i.navigate;return K.useCallback(async(l,c={})=>{let{action:u,method:f,encType:d,formData:m,body:g}=cw(l,e);if(c.navigate===!1){let y=c.fetcherKey||Lw();await s(y,t,c.action||u,{preventScrollReset:c.preventScrollReset,formData:m,body:g,formMethod:c.method||f,formEncType:c.encType||d,flushSync:c.flushSync})}else await a(c.action||u,{preventScrollReset:c.preventScrollReset,formData:m,body:g,formMethod:c.method||f,formEncType:c.encType||d,replace:c.replace,state:c.state,fromRouteId:t,flushSync:c.flushSync,viewTransition:c.viewTransition})},[s,a,e,t])}function Iw(i,{relative:e}={}){let{basename:t}=K.useContext(Yi),s=K.useContext(rn);rs(s,"useFormAction must be used inside a RouteContext");let[a]=s.matches.slice(-1),l={...Xl(i||".",{relative:e})},c=Jn();if(i==null){l.search=c.search;let u=new URLSearchParams(l.search),f=u.getAll("index");if(f.some(m=>m==="")){u.delete("index"),f.filter(g=>g).forEach(g=>u.append("index",g));let m=u.toString();l.search=m?`?${m}`:""}}return(!i||i===".")&&a.route.index&&(l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(l.pathname=l.pathname==="/"?t:Wn([t,l.pathname])),Ul(l)}function kw(i,{relative:e}={}){let t=K.useContext(W_);rs(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=ab("useViewTransitionState"),a=Xl(i,{relative:e});if(!t.isTransitioning)return!1;let l=Qn(t.currentLocation.pathname,s)||t.currentLocation.pathname,c=Qn(t.nextLocation.pathname,s)||t.nextLocation.pathname;return Yu(a.pathname,c)!=null||Yu(a.pathname,l)!=null}var Io=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(i){return this.listeners.add(i),this.onSubscribe(),()=>{this.listeners.delete(i),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Mw={setTimeout:(i,e)=>setTimeout(i,e),clearTimeout:i=>clearTimeout(i),setInterval:(i,e)=>setInterval(i,e),clearInterval:i=>clearInterval(i)},jw=class{#e=Mw;#t=!1;setTimeoutProvider(i){this.#e=i}setTimeout(i,e){return this.#e.setTimeout(i,e)}clearTimeout(i){this.#e.clearTimeout(i)}setInterval(i,e){return this.#e.setInterval(i,e)}clearInterval(i){this.#e.clearInterval(i)}},lr=new jw;function Ow(i){setTimeout(i,0)}var mr=typeof window>"u"||"Deno"in globalThis;function ti(){}function Pw(i,e){return typeof i=="function"?i(e):i}function hm(i){return typeof i=="number"&&i>=0&&i!==1/0}function rb(i,e){return Math.max(i+(e||0)-Date.now(),0)}function La(i,e){return typeof i=="function"?i(e):i}function Vi(i,e){return typeof i=="function"?i(e):i}function Bx(i,e){const{type:t="all",exact:s,fetchStatus:a,predicate:l,queryKey:c,stale:u}=i;if(c){if(s){if(e.queryHash!==tg(c,e.options))return!1}else if(!Fl(e.queryKey,c))return!1}if(t!=="all"){const f=e.isActive();if(t==="active"&&!f||t==="inactive"&&f)return!1}return!(typeof u=="boolean"&&e.isStale()!==u||a&&a!==e.state.fetchStatus||l&&!l(e))}function Ux(i,e){const{exact:t,status:s,predicate:a,mutationKey:l}=i;if(l){if(!e.options.mutationKey)return!1;if(t){if(gr(e.options.mutationKey)!==gr(l))return!1}else if(!Fl(e.options.mutationKey,l))return!1}return!(s&&e.state.status!==s||a&&!a(e))}function tg(i,e){return(e?.queryKeyHashFn||gr)(i)}function gr(i){return JSON.stringify(i,(e,t)=>fm(t)?Object.keys(t).sort().reduce((s,a)=>(s[a]=t[a],s),{}):t)}function Fl(i,e){return i===e?!0:typeof i!=typeof e?!1:i&&e&&typeof i=="object"&&typeof e=="object"?Object.keys(e).every(t=>Fl(i[t],e[t])):!1}var Bw=Object.prototype.hasOwnProperty;function ob(i,e){if(i===e)return i;const t=Fx(i)&&Fx(e);if(!t&&!(fm(i)&&fm(e)))return e;const a=(t?i:Object.keys(i)).length,l=t?e:Object.keys(e),c=l.length,u=t?new Array(c):{};let f=0;for(let d=0;d<c;d++){const m=t?d:l[d],g=i[m],y=e[m];if(g===y){u[m]=g,(t?d<a:Bw.call(i,m))&&f++;continue}if(g===null||y===null||typeof g!="object"||typeof y!="object"){u[m]=y;continue}const x=ob(g,y);u[m]=x,x===g&&f++}return a===c&&f===a?i:u}function Wu(i,e){if(!e||Object.keys(i).length!==Object.keys(e).length)return!1;for(const t in i)if(i[t]!==e[t])return!1;return!0}function Fx(i){return Array.isArray(i)&&i.length===Object.keys(i).length}function fm(i){if(!Gx(i))return!1;const e=i.constructor;if(e===void 0)return!0;const t=e.prototype;return!(!Gx(t)||!t.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(i)!==Object.prototype)}function Gx(i){return Object.prototype.toString.call(i)==="[object Object]"}function Uw(i){return new Promise(e=>{lr.setTimeout(e,i)})}function mm(i,e,t){return typeof t.structuralSharing=="function"?t.structuralSharing(i,e):t.structuralSharing!==!1?ob(i,e):e}function Fw(i,e,t=0){const s=[...i,e];return t&&s.length>t?s.slice(1):s}function Gw(i,e,t=0){const s=[e,...i];return t&&s.length>t?s.slice(0,-1):s}var sg=Symbol();function lb(i,e){return!i.queryFn&&e?.initialPromise?()=>e.initialPromise:!i.queryFn||i.queryFn===sg?()=>Promise.reject(new Error(`Missing queryFn: '${i.queryHash}'`)):i.queryFn}function cb(i,e){return typeof i=="function"?i(...e):!!i}var $w=class extends Io{#e;#t;#s;constructor(){super(),this.#s=i=>{if(!mr&&window.addEventListener){const e=()=>i();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(i){this.#s=i,this.#t?.(),this.#t=i(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(i){this.#e!==i&&(this.#e=i,this.onFocus())}onFocus(){const i=this.isFocused();this.listeners.forEach(e=>{e(i)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},ig=new $w;function gm(){let i,e;const t=new Promise((a,l)=>{i=a,e=l});t.status="pending",t.catch(()=>{});function s(a){Object.assign(t,a),delete t.resolve,delete t.reject}return t.resolve=a=>{s({status:"fulfilled",value:a}),i(a)},t.reject=a=>{s({status:"rejected",reason:a}),e(a)},t}var Vw=Ow;function Hw(){let i=[],e=0,t=u=>{u()},s=u=>{u()},a=Vw;const l=u=>{e?i.push(u):a(()=>{t(u)})},c=()=>{const u=i;i=[],u.length&&a(()=>{s(()=>{u.forEach(f=>{t(f)})})})};return{batch:u=>{let f;e++;try{f=u()}finally{e--,e||c()}return f},batchCalls:u=>(...f)=>{l(()=>{u(...f)})},schedule:l,setNotifyFunction:u=>{t=u},setBatchNotifyFunction:u=>{s=u},setScheduler:u=>{a=u}}}var ks=Hw(),Kw=class extends Io{#e=!0;#t;#s;constructor(){super(),this.#s=i=>{if(!mr&&window.addEventListener){const e=()=>i(!0),t=()=>i(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",t,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}}}}onSubscribe(){this.#t||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(i){this.#s=i,this.#t?.(),this.#t=i(this.setOnline.bind(this))}setOnline(i){this.#e!==i&&(this.#e=i,this.listeners.forEach(t=>{t(i)}))}isOnline(){return this.#e}},Xu=new Kw;function zw(i){return Math.min(1e3*2**i,3e4)}function ub(i){return(i??"online")==="online"?Xu.isOnline():!0}var pm=class extends Error{constructor(i){super("CancelledError"),this.revert=i?.revert,this.silent=i?.silent}};function db(i){let e=!1,t=0,s;const a=gm(),l=()=>a.status!=="pending",c=E=>{if(!l()){const A=new pm(E);y(A),i.onCancel?.(A)}},u=()=>{e=!0},f=()=>{e=!1},d=()=>ig.isFocused()&&(i.networkMode==="always"||Xu.isOnline())&&i.canRun(),m=()=>ub(i.networkMode)&&i.canRun(),g=E=>{l()||(s?.(),a.resolve(E))},y=E=>{l()||(s?.(),a.reject(E))},x=()=>new Promise(E=>{s=A=>{(l()||d())&&E(A)},i.onPause?.()}).then(()=>{s=void 0,l()||i.onContinue?.()}),v=()=>{if(l())return;let E;const A=t===0?i.initialPromise:void 0;try{E=A??i.fn()}catch(R){E=Promise.reject(R)}Promise.resolve(E).then(g).catch(R=>{if(l())return;const D=i.retry??(mr?0:3),L=i.retryDelay??zw,O=typeof L=="function"?L(t,R):L,H=D===!0||typeof D=="number"&&t<D||typeof D=="function"&&D(t,R);if(e||!H){y(R);return}t++,i.onFail?.(t,R),Uw(O).then(()=>d()?void 0:x()).then(()=>{e?y(R):v()})})};return{promise:a,status:()=>a.status,cancel:c,continue:()=>(s?.(),a),cancelRetry:u,continueRetry:f,canStart:m,start:()=>(m()?v():x().then(v),a)}}var hb=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),hm(this.gcTime)&&(this.#e=lr.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(i){this.gcTime=Math.max(this.gcTime||0,i??(mr?1/0:300*1e3))}clearGcTimeout(){this.#e&&(lr.clearTimeout(this.#e),this.#e=void 0)}},qw=class extends hb{#e;#t;#s;#n;#i;#r;#o;constructor(i){super(),this.#o=!1,this.#r=i.defaultOptions,this.setOptions(i.options),this.observers=[],this.#n=i.client,this.#s=this.#n.getQueryCache(),this.queryKey=i.queryKey,this.queryHash=i.queryHash,this.#e=Vx(this.options),this.state=i.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#i?.promise}setOptions(i){if(this.options={...this.#r,...i},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const e=Vx(this.options);e.data!==void 0&&(this.setState($x(e.data,e.dataUpdatedAt)),this.#e=e)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#s.remove(this)}setData(i,e){const t=mm(this.state.data,i,this.options);return this.#a({data:t,type:"success",dataUpdatedAt:e?.updatedAt,manual:e?.manual}),t}setState(i,e){this.#a({type:"setState",state:i,setStateOptions:e})}cancel(i){const e=this.#i?.promise;return this.#i?.cancel(i),e?e.then(ti).catch(ti):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(i=>Vi(i.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===sg||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(i=>La(i.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(i=>i.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(i=0){return this.state.data===void 0?!0:i==="static"?!1:this.state.isInvalidated?!0:!rb(this.state.dataUpdatedAt,i)}onFocus(){this.observers.find(e=>e.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#i?.continue()}onOnline(){this.observers.find(e=>e.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#i?.continue()}addObserver(i){this.observers.includes(i)||(this.observers.push(i),this.clearGcTimeout(),this.#s.notify({type:"observerAdded",query:this,observer:i}))}removeObserver(i){this.observers.includes(i)&&(this.observers=this.observers.filter(e=>e!==i),this.observers.length||(this.#i&&(this.#o?this.#i.cancel({revert:!0}):this.#i.cancelRetry()),this.scheduleGc()),this.#s.notify({type:"observerRemoved",query:this,observer:i}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#a({type:"invalidate"})}async fetch(i,e){if(this.state.fetchStatus!=="idle"&&this.#i?.status()!=="rejected"){if(this.state.data!==void 0&&e?.cancelRefetch)this.cancel({silent:!0});else if(this.#i)return this.#i.continueRetry(),this.#i.promise}if(i&&this.setOptions(i),!this.options.queryFn){const u=this.observers.find(f=>f.options.queryFn);u&&this.setOptions(u.options)}const t=new AbortController,s=u=>{Object.defineProperty(u,"signal",{enumerable:!0,get:()=>(this.#o=!0,t.signal)})},a=()=>{const u=lb(this.options,e),d=(()=>{const m={client:this.#n,queryKey:this.queryKey,meta:this.meta};return s(m),m})();return this.#o=!1,this.options.persister?this.options.persister(u,d,this):u(d)},c=(()=>{const u={fetchOptions:e,options:this.options,queryKey:this.queryKey,client:this.#n,state:this.state,fetchFn:a};return s(u),u})();this.options.behavior?.onFetch(c,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==c.fetchOptions?.meta)&&this.#a({type:"fetch",meta:c.fetchOptions?.meta}),this.#i=db({initialPromise:e?.initialPromise,fn:c.fetchFn,onCancel:u=>{u instanceof pm&&u.revert&&this.setState({...this.#t,fetchStatus:"idle"}),t.abort()},onFail:(u,f)=>{this.#a({type:"failed",failureCount:u,error:f})},onPause:()=>{this.#a({type:"pause"})},onContinue:()=>{this.#a({type:"continue"})},retry:c.options.retry,retryDelay:c.options.retryDelay,networkMode:c.options.networkMode,canRun:()=>!0});try{const u=await this.#i.start();if(u===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(u),this.#s.config.onSuccess?.(u,this),this.#s.config.onSettled?.(u,this.state.error,this),u}catch(u){if(u instanceof pm){if(u.silent)return this.#i.promise;if(u.revert){if(this.state.data===void 0)throw u;return this.state.data}}throw this.#a({type:"error",error:u}),this.#s.config.onError?.(u,this),this.#s.config.onSettled?.(this.state.data,u,this),u}finally{this.scheduleGc()}}#a(i){const e=t=>{switch(i.type){case"failed":return{...t,fetchFailureCount:i.failureCount,fetchFailureReason:i.error};case"pause":return{...t,fetchStatus:"paused"};case"continue":return{...t,fetchStatus:"fetching"};case"fetch":return{...t,...fb(t.data,this.options),fetchMeta:i.meta??null};case"success":const s={...t,...$x(i.data,i.dataUpdatedAt),dataUpdateCount:t.dataUpdateCount+1,...!i.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=i.manual?s:void 0,s;case"error":const a=i.error;return{...t,error:a,errorUpdateCount:t.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:t.fetchFailureCount+1,fetchFailureReason:a,fetchStatus:"idle",status:"error"};case"invalidate":return{...t,isInvalidated:!0};case"setState":return{...t,...i.state}}};this.state=e(this.state),ks.batch(()=>{this.observers.forEach(t=>{t.onQueryUpdate()}),this.#s.notify({query:this,type:"updated",action:i})})}};function fb(i,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:ub(e.networkMode)?"fetching":"paused",...i===void 0&&{error:null,status:"pending"}}}function $x(i,e){return{data:i,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function Vx(i){const e=typeof i.initialData=="function"?i.initialData():i.initialData,t=e!==void 0,s=t?typeof i.initialDataUpdatedAt=="function"?i.initialDataUpdatedAt():i.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:t?s??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}var Yw=class extends Io{constructor(i,e){super(),this.options=e,this.#e=i,this.#a=null,this.#o=gm(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#s=void 0;#n=void 0;#i;#r;#o;#a;#g;#h;#f;#c;#u;#l;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),Hx(this.#t,this.options)?this.#d():this.updateResult(),this.#v())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ym(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ym(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#_(),this.#b(),this.#t.removeObserver(this)}setOptions(i){const e=this.options,t=this.#t;if(this.options=this.#e.defaultQueryOptions(i),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Vi(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#S(),this.#t.setOptions(this.options),e._defaulted&&!Wu(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const s=this.hasListeners();s&&Kx(this.#t,t,this.options,e)&&this.#d(),this.updateResult(),s&&(this.#t!==t||Vi(this.options.enabled,this.#t)!==Vi(e.enabled,this.#t)||La(this.options.staleTime,this.#t)!==La(e.staleTime,this.#t))&&this.#p();const a=this.#y();s&&(this.#t!==t||Vi(this.options.enabled,this.#t)!==Vi(e.enabled,this.#t)||a!==this.#l)&&this.#x(a)}getOptimisticResult(i){const e=this.#e.getQueryCache().build(this.#e,i),t=this.createResult(e,i);return Xw(this,t)&&(this.#n=t,this.#r=this.options,this.#i=this.#t.state),t}getCurrentResult(){return this.#n}trackResult(i,e){return new Proxy(i,{get:(t,s)=>(this.trackProp(s),e?.(s),s==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(t,s))})}trackProp(i){this.#m.add(i)}getCurrentQuery(){return this.#t}refetch({...i}={}){return this.fetch({...i})}fetchOptimistic(i){const e=this.#e.defaultQueryOptions(i),t=this.#e.getQueryCache().build(this.#e,e);return t.fetch().then(()=>this.createResult(t,e))}fetch(i){return this.#d({...i,cancelRefetch:i.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#n))}#d(i){this.#S();let e=this.#t.fetch(this.options,i);return i?.throwOnError||(e=e.catch(ti)),e}#p(){this.#_();const i=La(this.options.staleTime,this.#t);if(mr||this.#n.isStale||!hm(i))return;const t=rb(this.#n.dataUpdatedAt,i)+1;this.#c=lr.setTimeout(()=>{this.#n.isStale||this.updateResult()},t)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#x(i){this.#b(),this.#l=i,!(mr||Vi(this.options.enabled,this.#t)===!1||!hm(this.#l)||this.#l===0)&&(this.#u=lr.setInterval(()=>{(this.options.refetchIntervalInBackground||ig.isFocused())&&this.#d()},this.#l))}#v(){this.#p(),this.#x(this.#y())}#_(){this.#c&&(lr.clearTimeout(this.#c),this.#c=void 0)}#b(){this.#u&&(lr.clearInterval(this.#u),this.#u=void 0)}createResult(i,e){const t=this.#t,s=this.options,a=this.#n,l=this.#i,c=this.#r,f=i!==t?i.state:this.#s,{state:d}=i;let m={...d},g=!1,y;if(e._optimisticResults){const k=this.hasListeners(),M=!k&&Hx(i,e),I=k&&Kx(i,t,e,s);(M||I)&&(m={...m,...fb(d.data,i.options)}),e._optimisticResults==="isRestoring"&&(m.fetchStatus="idle")}let{error:x,errorUpdatedAt:v,status:E}=m;y=m.data;let A=!1;if(e.placeholderData!==void 0&&y===void 0&&E==="pending"){let k;a?.isPlaceholderData&&e.placeholderData===c?.placeholderData?(k=a.data,A=!0):k=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,k!==void 0&&(E="success",y=mm(a?.data,k,e),g=!0)}if(e.select&&y!==void 0&&!A)if(a&&y===l?.data&&e.select===this.#g)y=this.#h;else try{this.#g=e.select,y=e.select(y),y=mm(a?.data,y,e),this.#h=y,this.#a=null}catch(k){this.#a=k}this.#a&&(x=this.#a,y=this.#h,v=Date.now(),E="error");const R=m.fetchStatus==="fetching",D=E==="pending",L=E==="error",O=D&&R,H=y!==void 0,U={status:E,fetchStatus:m.fetchStatus,isPending:D,isSuccess:E==="success",isError:L,isInitialLoading:O,isLoading:O,data:y,dataUpdatedAt:m.dataUpdatedAt,error:x,errorUpdatedAt:v,failureCount:m.fetchFailureCount,failureReason:m.fetchFailureReason,errorUpdateCount:m.errorUpdateCount,isFetched:m.dataUpdateCount>0||m.errorUpdateCount>0,isFetchedAfterMount:m.dataUpdateCount>f.dataUpdateCount||m.errorUpdateCount>f.errorUpdateCount,isFetching:R,isRefetching:R&&!D,isLoadingError:L&&!H,isPaused:m.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:L&&H,isStale:ng(i,e),refetch:this.refetch,promise:this.#o,isEnabled:Vi(e.enabled,i)!==!1};if(this.options.experimental_prefetchInRender){const k=j=>{U.status==="error"?j.reject(U.error):U.data!==void 0&&j.resolve(U.data)},M=()=>{const j=this.#o=U.promise=gm();k(j)},I=this.#o;switch(I.status){case"pending":i.queryHash===t.queryHash&&k(I);break;case"fulfilled":(U.status==="error"||U.data!==I.value)&&M();break;case"rejected":(U.status!=="error"||U.error!==I.reason)&&M();break}}return U}updateResult(){const i=this.#n,e=this.createResult(this.#t,this.options);if(this.#i=this.#t.state,this.#r=this.options,this.#i.data!==void 0&&(this.#f=this.#t),Wu(e,i))return;this.#n=e;const t=()=>{if(!i)return!0;const{notifyOnChangeProps:s}=this.options,a=typeof s=="function"?s():s;if(a==="all"||!a&&!this.#m.size)return!0;const l=new Set(a??this.#m);return this.options.throwOnError&&l.add("error"),Object.keys(this.#n).some(c=>{const u=c;return this.#n[u]!==i[u]&&l.has(u)})};this.#E({listeners:t()})}#S(){const i=this.#e.getQueryCache().build(this.#e,this.options);if(i===this.#t)return;const e=this.#t;this.#t=i,this.#s=i.state,this.hasListeners()&&(e?.removeObserver(this),i.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#v()}#E(i){ks.batch(()=>{i.listeners&&this.listeners.forEach(e=>{e(this.#n)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function Ww(i,e){return Vi(e.enabled,i)!==!1&&i.state.data===void 0&&!(i.state.status==="error"&&e.retryOnMount===!1)}function Hx(i,e){return Ww(i,e)||i.state.data!==void 0&&ym(i,e,e.refetchOnMount)}function ym(i,e,t){if(Vi(e.enabled,i)!==!1&&La(e.staleTime,i)!=="static"){const s=typeof t=="function"?t(i):t;return s==="always"||s!==!1&&ng(i,e)}return!1}function Kx(i,e,t,s){return(i!==e||Vi(s.enabled,i)===!1)&&(!t.suspense||i.state.status!=="error")&&ng(i,t)}function ng(i,e){return Vi(e.enabled,i)!==!1&&i.isStaleByTime(La(e.staleTime,i))}function Xw(i,e){return!Wu(i.getCurrentResult(),e)}function zx(i){return{onFetch:(e,t)=>{const s=e.options,a=e.fetchOptions?.meta?.fetchMore?.direction,l=e.state.data?.pages||[],c=e.state.data?.pageParams||[];let u={pages:[],pageParams:[]},f=0;const d=async()=>{let m=!1;const g=v=>{Object.defineProperty(v,"signal",{enumerable:!0,get:()=>(e.signal.aborted?m=!0:e.signal.addEventListener("abort",()=>{m=!0}),e.signal)})},y=lb(e.options,e.fetchOptions),x=async(v,E,A)=>{if(m)return Promise.reject();if(E==null&&v.pages.length)return Promise.resolve(v);const D=(()=>{const q={client:e.client,queryKey:e.queryKey,pageParam:E,direction:A?"backward":"forward",meta:e.options.meta};return g(q),q})(),L=await y(D),{maxPages:O}=e.options,H=A?Gw:Fw;return{pages:H(v.pages,L,O),pageParams:H(v.pageParams,E,O)}};if(a&&l.length){const v=a==="backward",E=v?Qw:qx,A={pages:l,pageParams:c},R=E(s,A);u=await x(A,R,v)}else{const v=i??l.length;do{const E=f===0?c[0]??s.initialPageParam:qx(s,u);if(f>0&&E==null)break;u=await x(u,E),f++}while(f<v)}return u};e.options.persister?e.fetchFn=()=>e.options.persister?.(d,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t):e.fetchFn=d}}}function qx(i,{pages:e,pageParams:t}){const s=e.length-1;return e.length>0?i.getNextPageParam(e[s],e,t[s],t):void 0}function Qw(i,{pages:e,pageParams:t}){return e.length>0?i.getPreviousPageParam?.(e[0],e,t[0],t):void 0}var Zw=class extends hb{#e;#t;#s;#n;constructor(i){super(),this.#e=i.client,this.mutationId=i.mutationId,this.#s=i.mutationCache,this.#t=[],this.state=i.state||mb(),this.setOptions(i.options),this.scheduleGc()}setOptions(i){this.options=i,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(i){this.#t.includes(i)||(this.#t.push(i),this.clearGcTimeout(),this.#s.notify({type:"observerAdded",mutation:this,observer:i}))}removeObserver(i){this.#t=this.#t.filter(e=>e!==i),this.scheduleGc(),this.#s.notify({type:"observerRemoved",mutation:this,observer:i})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#s.remove(this))}continue(){return this.#n?.continue()??this.execute(this.state.variables)}async execute(i){const e=()=>{this.#i({type:"continue"})},t={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#n=db({fn:()=>this.options.mutationFn?this.options.mutationFn(i,t):Promise.reject(new Error("No mutationFn found")),onFail:(l,c)=>{this.#i({type:"failed",failureCount:l,error:c})},onPause:()=>{this.#i({type:"pause"})},onContinue:e,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#s.canRun(this)});const s=this.state.status==="pending",a=!this.#n.canStart();try{if(s)e();else{this.#i({type:"pending",variables:i,isPaused:a}),await this.#s.config.onMutate?.(i,this,t);const c=await this.options.onMutate?.(i,t);c!==this.state.context&&this.#i({type:"pending",context:c,variables:i,isPaused:a})}const l=await this.#n.start();return await this.#s.config.onSuccess?.(l,i,this.state.context,this,t),await this.options.onSuccess?.(l,i,this.state.context,t),await this.#s.config.onSettled?.(l,null,this.state.variables,this.state.context,this,t),await this.options.onSettled?.(l,null,i,this.state.context,t),this.#i({type:"success",data:l}),l}catch(l){try{throw await this.#s.config.onError?.(l,i,this.state.context,this,t),await this.options.onError?.(l,i,this.state.context,t),await this.#s.config.onSettled?.(void 0,l,this.state.variables,this.state.context,this,t),await this.options.onSettled?.(void 0,l,i,this.state.context,t),l}finally{this.#i({type:"error",error:l})}}finally{this.#s.runNext(this)}}#i(i){const e=t=>{switch(i.type){case"failed":return{...t,failureCount:i.failureCount,failureReason:i.error};case"pause":return{...t,isPaused:!0};case"continue":return{...t,isPaused:!1};case"pending":return{...t,context:i.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:i.isPaused,status:"pending",variables:i.variables,submittedAt:Date.now()};case"success":return{...t,data:i.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...t,data:void 0,error:i.error,failureCount:t.failureCount+1,failureReason:i.error,isPaused:!1,status:"error"}}};this.state=e(this.state),ks.batch(()=>{this.#t.forEach(t=>{t.onMutationUpdate(i)}),this.#s.notify({mutation:this,type:"updated",action:i})})}};function mb(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Jw=class extends Io{constructor(i={}){super(),this.config=i,this.#e=new Set,this.#t=new Map,this.#s=0}#e;#t;#s;build(i,e,t){const s=new Zw({client:i,mutationCache:this,mutationId:++this.#s,options:i.defaultMutationOptions(e),state:t});return this.add(s),s}add(i){this.#e.add(i);const e=hu(i);if(typeof e=="string"){const t=this.#t.get(e);t?t.push(i):this.#t.set(e,[i])}this.notify({type:"added",mutation:i})}remove(i){if(this.#e.delete(i)){const e=hu(i);if(typeof e=="string"){const t=this.#t.get(e);if(t)if(t.length>1){const s=t.indexOf(i);s!==-1&&t.splice(s,1)}else t[0]===i&&this.#t.delete(e)}}this.notify({type:"removed",mutation:i})}canRun(i){const e=hu(i);if(typeof e=="string"){const s=this.#t.get(e)?.find(a=>a.state.status==="pending");return!s||s===i}else return!0}runNext(i){const e=hu(i);return typeof e=="string"?this.#t.get(e)?.find(s=>s!==i&&s.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){ks.batch(()=>{this.#e.forEach(i=>{this.notify({type:"removed",mutation:i})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(i){const e={exact:!0,...i};return this.getAll().find(t=>Ux(e,t))}findAll(i={}){return this.getAll().filter(e=>Ux(i,e))}notify(i){ks.batch(()=>{this.listeners.forEach(e=>{e(i)})})}resumePausedMutations(){const i=this.getAll().filter(e=>e.state.isPaused);return ks.batch(()=>Promise.all(i.map(e=>e.continue().catch(ti))))}};function hu(i){return i.options.scope?.id}var eN=class extends Io{#e;#t=void 0;#s;#n;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const t=this.options;this.options=this.#e.defaultMutationOptions(e),Wu(this.options,t)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#s,observer:this}),t?.mutationKey&&this.options.mutationKey&&gr(t.mutationKey)!==gr(this.options.mutationKey)?this.reset():this.#s?.state.status==="pending"&&this.#s.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#s?.removeObserver(this)}onMutationUpdate(e){this.#i(),this.#r(e)}getCurrentResult(){return this.#t}reset(){this.#s?.removeObserver(this),this.#s=void 0,this.#i(),this.#r()}mutate(e,t){return this.#n=t,this.#s?.removeObserver(this),this.#s=this.#e.getMutationCache().build(this.#e,this.options),this.#s.addObserver(this),this.#s.execute(e)}#i(){const e=this.#s?.state??mb();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#r(e){ks.batch(()=>{if(this.#n&&this.hasListeners()){const t=this.#t.variables,s=this.#t.context,a={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#n.onSuccess?.(e.data,t,s,a),this.#n.onSettled?.(e.data,null,t,s,a)):e?.type==="error"&&(this.#n.onError?.(e.error,t,s,a),this.#n.onSettled?.(void 0,e.error,t,s,a))}this.listeners.forEach(t=>{t(this.#t)})})}},tN=class extends Io{constructor(i={}){super(),this.config=i,this.#e=new Map}#e;build(i,e,t){const s=e.queryKey,a=e.queryHash??tg(s,e);let l=this.get(a);return l||(l=new qw({client:i,queryKey:s,queryHash:a,options:i.defaultQueryOptions(e),state:t,defaultOptions:i.getQueryDefaults(s)}),this.add(l)),l}add(i){this.#e.has(i.queryHash)||(this.#e.set(i.queryHash,i),this.notify({type:"added",query:i}))}remove(i){const e=this.#e.get(i.queryHash);e&&(i.destroy(),e===i&&this.#e.delete(i.queryHash),this.notify({type:"removed",query:i}))}clear(){ks.batch(()=>{this.getAll().forEach(i=>{this.remove(i)})})}get(i){return this.#e.get(i)}getAll(){return[...this.#e.values()]}find(i){const e={exact:!0,...i};return this.getAll().find(t=>Bx(e,t))}findAll(i={}){const e=this.getAll();return Object.keys(i).length>0?e.filter(t=>Bx(i,t)):e}notify(i){ks.batch(()=>{this.listeners.forEach(e=>{e(i)})})}onFocus(){ks.batch(()=>{this.getAll().forEach(i=>{i.onFocus()})})}onOnline(){ks.batch(()=>{this.getAll().forEach(i=>{i.onOnline()})})}},sN=class{#e;#t;#s;#n;#i;#r;#o;#a;constructor(i={}){this.#e=i.queryCache||new tN,this.#t=i.mutationCache||new Jw,this.#s=i.defaultOptions||{},this.#n=new Map,this.#i=new Map,this.#r=0}mount(){this.#r++,this.#r===1&&(this.#o=ig.subscribe(async i=>{i&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#a=Xu.subscribe(async i=>{i&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#r--,this.#r===0&&(this.#o?.(),this.#o=void 0,this.#a?.(),this.#a=void 0)}isFetching(i){return this.#e.findAll({...i,fetchStatus:"fetching"}).length}isMutating(i){return this.#t.findAll({...i,status:"pending"}).length}getQueryData(i){const e=this.defaultQueryOptions({queryKey:i});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(i){const e=this.defaultQueryOptions(i),t=this.#e.build(this,e),s=t.state.data;return s===void 0?this.fetchQuery(i):(i.revalidateIfStale&&t.isStaleByTime(La(e.staleTime,t))&&this.prefetchQuery(e),Promise.resolve(s))}getQueriesData(i){return this.#e.findAll(i).map(({queryKey:e,state:t})=>{const s=t.data;return[e,s]})}setQueryData(i,e,t){const s=this.defaultQueryOptions({queryKey:i}),l=this.#e.get(s.queryHash)?.state.data,c=Pw(e,l);if(c!==void 0)return this.#e.build(this,s).setData(c,{...t,manual:!0})}setQueriesData(i,e,t){return ks.batch(()=>this.#e.findAll(i).map(({queryKey:s})=>[s,this.setQueryData(s,e,t)]))}getQueryState(i){const e=this.defaultQueryOptions({queryKey:i});return this.#e.get(e.queryHash)?.state}removeQueries(i){const e=this.#e;ks.batch(()=>{e.findAll(i).forEach(t=>{e.remove(t)})})}resetQueries(i,e){const t=this.#e;return ks.batch(()=>(t.findAll(i).forEach(s=>{s.reset()}),this.refetchQueries({type:"active",...i},e)))}cancelQueries(i,e={}){const t={revert:!0,...e},s=ks.batch(()=>this.#e.findAll(i).map(a=>a.cancel(t)));return Promise.all(s).then(ti).catch(ti)}invalidateQueries(i,e={}){return ks.batch(()=>(this.#e.findAll(i).forEach(t=>{t.invalidate()}),i?.refetchType==="none"?Promise.resolve():this.refetchQueries({...i,type:i?.refetchType??i?.type??"active"},e)))}refetchQueries(i,e={}){const t={...e,cancelRefetch:e.cancelRefetch??!0},s=ks.batch(()=>this.#e.findAll(i).filter(a=>!a.isDisabled()&&!a.isStatic()).map(a=>{let l=a.fetch(void 0,t);return t.throwOnError||(l=l.catch(ti)),a.state.fetchStatus==="paused"?Promise.resolve():l}));return Promise.all(s).then(ti)}fetchQuery(i){const e=this.defaultQueryOptions(i);e.retry===void 0&&(e.retry=!1);const t=this.#e.build(this,e);return t.isStaleByTime(La(e.staleTime,t))?t.fetch(e):Promise.resolve(t.state.data)}prefetchQuery(i){return this.fetchQuery(i).then(ti).catch(ti)}fetchInfiniteQuery(i){return i.behavior=zx(i.pages),this.fetchQuery(i)}prefetchInfiniteQuery(i){return this.fetchInfiniteQuery(i).then(ti).catch(ti)}ensureInfiniteQueryData(i){return i.behavior=zx(i.pages),this.ensureQueryData(i)}resumePausedMutations(){return Xu.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#s}setDefaultOptions(i){this.#s=i}setQueryDefaults(i,e){this.#n.set(gr(i),{queryKey:i,defaultOptions:e})}getQueryDefaults(i){const e=[...this.#n.values()],t={};return e.forEach(s=>{Fl(i,s.queryKey)&&Object.assign(t,s.defaultOptions)}),t}setMutationDefaults(i,e){this.#i.set(gr(i),{mutationKey:i,defaultOptions:e})}getMutationDefaults(i){const e=[...this.#i.values()],t={};return e.forEach(s=>{Fl(i,s.mutationKey)&&Object.assign(t,s.defaultOptions)}),t}defaultQueryOptions(i){if(i._defaulted)return i;const e={...this.#s.queries,...this.getQueryDefaults(i.queryKey),...i,_defaulted:!0};return e.queryHash||(e.queryHash=tg(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===sg&&(e.enabled=!1),e}defaultMutationOptions(i){return i?._defaulted?i:{...this.#s.mutations,...i?.mutationKey&&this.getMutationDefaults(i.mutationKey),...i,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},gb=K.createContext(void 0),Ct=i=>{const e=K.useContext(gb);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},iN=({client:i,children:e})=>(K.useEffect(()=>(i.mount(),()=>{i.unmount()}),[i]),r.jsx(gb.Provider,{value:i,children:e})),pb=K.createContext(!1),nN=()=>K.useContext(pb);pb.Provider;function aN(){let i=!1;return{clearReset:()=>{i=!1},reset:()=>{i=!0},isReset:()=>i}}var rN=K.createContext(aN()),oN=()=>K.useContext(rN),lN=(i,e)=>{(i.suspense||i.throwOnError||i.experimental_prefetchInRender)&&(e.isReset()||(i.retryOnMount=!1))},cN=i=>{K.useEffect(()=>{i.clearReset()},[i])},uN=({result:i,errorResetBoundary:e,throwOnError:t,query:s,suspense:a})=>i.isError&&!e.isReset()&&!i.isFetching&&s&&(a&&i.data===void 0||cb(t,[i.error,s])),dN=i=>{if(i.suspense){const t=a=>a==="static"?a:Math.max(a??1e3,1e3),s=i.staleTime;i.staleTime=typeof s=="function"?(...a)=>t(s(...a)):t(s),typeof i.gcTime=="number"&&(i.gcTime=Math.max(i.gcTime,1e3))}},hN=(i,e)=>i.isLoading&&i.isFetching&&!e,fN=(i,e)=>i?.suspense&&e.isPending,Yx=(i,e,t)=>e.fetchOptimistic(i).catch(()=>{t.clearReset()});function mN(i,e,t){const s=nN(),a=oN(),l=Ct(),c=l.defaultQueryOptions(i);l.getDefaultOptions().queries?._experimental_beforeQuery?.(c),c._optimisticResults=s?"isRestoring":"optimistic",dN(c),lN(c,a),cN(a);const u=!l.getQueryCache().get(c.queryHash),[f]=K.useState(()=>new e(l,c)),d=f.getOptimisticResult(c),m=!s&&i.subscribed!==!1;if(K.useSyncExternalStore(K.useCallback(g=>{const y=m?f.subscribe(ks.batchCalls(g)):ti;return f.updateResult(),y},[f,m]),()=>f.getCurrentResult(),()=>f.getCurrentResult()),K.useEffect(()=>{f.setOptions(c)},[c,f]),fN(c,d))throw Yx(c,f,a);if(uN({result:d,errorResetBoundary:a,throwOnError:c.throwOnError,query:l.getQueryCache().get(c.queryHash),suspense:c.suspense}))throw d.error;return l.getDefaultOptions().queries?._experimental_afterQuery?.(c,d),c.experimental_prefetchInRender&&!mr&&hN(d,s)&&(u?Yx(c,f,a):l.getQueryCache().get(c.queryHash)?.promise)?.catch(ti).finally(()=>{f.updateResult()}),c.notifyOnChangeProps?d:f.trackResult(d)}function it(i,e){return mN(i,Yw)}function Ze(i,e){const t=Ct(),[s]=K.useState(()=>new eN(t,i));K.useEffect(()=>{s.setOptions(i)},[s,i]);const a=K.useSyncExternalStore(K.useCallback(c=>s.subscribe(ks.batchCalls(c)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),l=K.useCallback((c,u)=>{s.mutate(c,u).catch(ti)},[s]);if(a.error&&cb(s.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:l,mutateAsync:a.mutate}}const gN=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),pN=i=>i.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()),Wx=i=>{const e=pN(i);return e.charAt(0).toUpperCase()+e.slice(1)},yb=(...i)=>i.filter((e,t,s)=>!!e&&e.trim()!==""&&s.indexOf(e)===t).join(" ").trim(),yN=i=>{for(const e in i)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};var xN={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const vN=K.forwardRef(({color:i="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:s,className:a="",children:l,iconNode:c,...u},f)=>K.createElement("svg",{ref:f,...xN,width:e,height:e,stroke:i,strokeWidth:s?Number(t)*24/Number(e):t,className:yb("lucide",a),...!l&&!yN(u)&&{"aria-hidden":"true"},...u},[...c.map(([d,m])=>K.createElement(d,m)),...Array.isArray(l)?l:[l]]));const $e=(i,e)=>{const t=K.forwardRef(({className:s,...a},l)=>K.createElement(vN,{ref:l,iconNode:e,className:yb(`lucide-${gN(Wx(i))}`,`lucide-${i}`,s),...a}));return t.displayName=Wx(i),t};const _N=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],xb=$e("activity",_N);const bN=[["path",{d:"M12 6.528V3a1 1 0 0 1 1-1h0",key:"11qiee"}],["path",{d:"M18.237 21A15 15 0 0 0 22 11a6 6 0 0 0-10-4.472A6 6 0 0 0 2 11a15.1 15.1 0 0 0 3.763 10 3 3 0 0 0 3.648.648 5.5 5.5 0 0 1 5.178 0A3 3 0 0 0 18.237 21",key:"110c12"}]],xm=$e("apple",bN);const SN=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],EN=$e("archive",SN);const TN=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],vb=$e("arrow-down",TN);const AN=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],wN=$e("arrow-up",AN);const NN=[["path",{d:"M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5",key:"1u7htd"}],["path",{d:"M15 12h.01",key:"1k8ypt"}],["path",{d:"M19.38 6.813A9 9 0 0 1 20.8 10.2a2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1",key:"11xh7x"}],["path",{d:"M9 12h.01",key:"157uk2"}]],_b=$e("baby",NN);const RN=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],CN=$e("calendar-days",RN);const LN=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],bn=$e("calendar",LN);const DN=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Ys=$e("check",DN);const IN=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],fd=$e("chevron-down",IN);const kN=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],MN=$e("chevron-left",kN);const jN=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],md=$e("chevron-right",jN);const ON=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],ag=$e("chevron-up",ON);const PN=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Ns=$e("circle-alert",PN);const BN=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Zn=$e("circle-check-big",BN);const UN=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Ca=$e("circle-check",UN);const FN=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]],pr=$e("circle-dot",FN);const GN=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],$N=$e("circle-play",GN);const VN=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],rg=$e("circle-x",VN);const HN=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],vo=$e("circle",HN);const KN=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Li=$e("clock",KN);const zN=[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]],qN=$e("cloud-download",zN);const YN=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],jl=$e("cpu",YN);const WN=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Ri=$e("download",WN);const XN=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M15.033 13.44a.647.647 0 0 1 0 1.12l-4.065 2.352a.645.645 0 0 1-.968-.56v-4.704a.645.645 0 0 1 .967-.56z",key:"1tzo1f"}]],QN=$e("file-play",XN);const ZN=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Xn=$e("file-text",ZN);const JN=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]],eR=$e("file",JN);const tR=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]],Ki=$e("film",tR);const sR=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],yr=$e("folder-open",sR);const iR=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],bb=$e("folder-plus",iR);const nR=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],aR=$e("folder",nR);const rR=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],xr=$e("hard-drive",rR);const oR=[["path",{d:"M10.5 4.893a5.5 5.5 0 0 1 1.091.931.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 1.872-1.002 3.356-2.187 4.655",key:"1inpfl"}],["path",{d:"m16.967 16.967-3.459 3.346a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5a5.5 5.5 0 0 1 2.747-4.761",key:"vbc6x7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],lR=$e("heart-off",oR);const cR=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],uR=$e("heart",cR);const dR=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],hR=$e("house",dR);const fR=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],mR=$e("image",fR);const gR=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],og=$e("layers",gR);const pR=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],yR=$e("layout-dashboard",pR);const xR=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],fu=$e("link-2",xR);const vR=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Yn=$e("loader-circle",vR);const _R=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],ii=$e("loader",_R);const bR=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],SR=$e("log-out",bR);const ER=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],TR=$e("map-pin",ER);const AR=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],lg=$e("maximize",AR);const wR=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],NR=$e("menu",wR);const RR=[["path",{d:"M18 8V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h8",key:"10dyio"}],["path",{d:"M10 19v-3.96 3.15",key:"1irgej"}],["path",{d:"M7 19h5",key:"qswx4l"}],["rect",{width:"6",height:"10",x:"16",y:"12",rx:"2",key:"1egngj"}]],CR=$e("monitor-smartphone",RR);const LR=[["path",{d:"M15.033 9.44a.647.647 0 0 1 0 1.12l-4.065 2.352a.645.645 0 0 1-.968-.56V7.648a.645.645 0 0 1 .967-.56z",key:"vbtd3f"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"M8 21h8",key:"1ev6f3"}],["rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",key:"x3v2xh"}]],vm=$e("monitor-play",LR);const DR=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],Sb=$e("monitor",DR);const IR=[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]],kR=$e("music",IR);const MR=[["path",{d:"M15 18h-5",key:"95g1m2"}],["path",{d:"M18 14h-8",key:"sponae"}],["path",{d:"M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-4 0v-9a2 2 0 0 1 2-2h2",key:"39pd36"}],["rect",{width:"8",height:"4",x:"10",y:"6",rx:"1",key:"aywv1n"}]],Eb=$e("newspaper",MR);const jR=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],cg=$e("pause",jR);const OR=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],PR=$e("pen",OR);const BR=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Sn=$e("play",BR);const UR=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Hi=$e("plus",UR);const FR=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],Xx=$e("power",FR);const GR=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],$R=$e("qr-code",GR);const VR=[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],vr=$e("radio",VR);const HR=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],vs=$e("refresh-cw",HR);const KR=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],zR=$e("repeat",KR);const qR=[["path",{d:"M12 6a2 2 0 0 0-3.414-1.414l-6 6a2 2 0 0 0 0 2.828l6 6A2 2 0 0 0 12 18z",key:"2a1g8i"}],["path",{d:"M22 6a2 2 0 0 0-3.414-1.414l-6 6a2 2 0 0 0 0 2.828l6 6A2 2 0 0 0 22 18z",key:"rg3s36"}]],Tb=$e("rewind",qR);const YR=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Ab=$e("save",YR);const WR=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]],XR=$e("scan-line",WR);const QR=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Xs=$e("search",QR);const ZR=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],JR=$e("server",ZR);const e2=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],t2=$e("settings-2",e2);const s2=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ug=$e("settings",s2);const i2=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]],n2=$e("shield-off",i2);const a2=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],r2=$e("shield",a2);const o2=[["path",{d:"M17.971 4.285A2 2 0 0 1 21 6v12a2 2 0 0 1-3.029 1.715l-9.997-5.998a2 2 0 0 1-.003-3.432z",key:"15892j"}],["path",{d:"M3 20V4",key:"1ptbpl"}]],wb=$e("skip-back",o2);const l2=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],dg=$e("skip-forward",l2);const c2=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],ju=$e("smartphone",c2);const u2=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],d2=$e("sparkles",u2);const h2=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],f2=$e("square-check-big",h2);const m2=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],dr=$e("square-pen",m2);const g2=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],p2=$e("square",g2);const y2=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Nb=$e("star",y2);const x2=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],Qx=$e("timer",x2);const v2=[["circle",{cx:"9",cy:"12",r:"3",key:"u3jwor"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],_2=$e("toggle-left",v2);const b2=[["circle",{cx:"15",cy:"12",r:"3",key:"1afu0r"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],S2=$e("toggle-right",b2);const E2=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],an=$e("trash-2",E2);const T2=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Rb=$e("triangle-alert",T2);const A2=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],Da=$e("trophy",A2);const w2=[["path",{d:"M7 21h10",key:"1b0cd5"}],["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}]],Zx=$e("tv-minimal",w2);const N2=[["path",{d:"m17 2-5 5-5-5",key:"16satq"}],["rect",{width:"20",height:"15",x:"2",y:"7",rx:"2",key:"1e6viu"}]],Qs=$e("tv",N2);const R2=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Cb=$e("upload",R2);const C2=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],hg=$e("users",C2);const L2=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],Ao=$e("video",L2);const D2=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],fg=$e("volume-2",D2);const I2=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],mg=$e("volume-x",I2);const k2=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],Qu=$e("wand-sparkles",k2);const M2=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],j2=$e("wifi-off",M2);const O2=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],P2=$e("wifi",O2);const B2=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],jt=$e("x",B2);const U2=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],_r=$e("zap",U2);function Lb(i,e){return function(){return i.apply(e,arguments)}}const{toString:F2}=Object.prototype,{getPrototypeOf:gg}=Object,{iterator:gd,toStringTag:Db}=Symbol,pd=(i=>e=>{const t=F2.call(e);return i[t]||(i[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),on=i=>(i=i.toLowerCase(),e=>pd(e)===i),yd=i=>e=>typeof e===i,{isArray:ko}=Array,wo=yd("undefined");function Ql(i){return i!==null&&!wo(i)&&i.constructor!==null&&!wo(i.constructor)&&hi(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const Ib=on("ArrayBuffer");function G2(i){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(i):e=i&&i.buffer&&Ib(i.buffer),e}const $2=yd("string"),hi=yd("function"),kb=yd("number"),Zl=i=>i!==null&&typeof i=="object",V2=i=>i===!0||i===!1,Ou=i=>{if(pd(i)!=="object")return!1;const e=gg(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Db in i)&&!(gd in i)},H2=i=>{if(!Zl(i)||Ql(i))return!1;try{return Object.keys(i).length===0&&Object.getPrototypeOf(i)===Object.prototype}catch{return!1}},K2=on("Date"),z2=on("File"),q2=on("Blob"),Y2=on("FileList"),W2=i=>Zl(i)&&hi(i.pipe),X2=i=>{let e;return i&&(typeof FormData=="function"&&i instanceof FormData||hi(i.append)&&((e=pd(i))==="formdata"||e==="object"&&hi(i.toString)&&i.toString()==="[object FormData]"))},Q2=on("URLSearchParams"),[Z2,J2,eC,tC]=["ReadableStream","Request","Response","Headers"].map(on),sC=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Jl(i,e,{allOwnKeys:t=!1}={}){if(i===null||typeof i>"u")return;let s,a;if(typeof i!="object"&&(i=[i]),ko(i))for(s=0,a=i.length;s<a;s++)e.call(null,i[s],s,i);else{if(Ql(i))return;const l=t?Object.getOwnPropertyNames(i):Object.keys(i),c=l.length;let u;for(s=0;s<c;s++)u=l[s],e.call(null,i[u],u,i)}}function Mb(i,e){if(Ql(i))return null;e=e.toLowerCase();const t=Object.keys(i);let s=t.length,a;for(;s-- >0;)if(a=t[s],e===a.toLowerCase())return a;return null}const cr=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,jb=i=>!wo(i)&&i!==cr;function _m(){const{caseless:i,skipUndefined:e}=jb(this)&&this||{},t={},s=(a,l)=>{const c=i&&Mb(t,l)||l;Ou(t[c])&&Ou(a)?t[c]=_m(t[c],a):Ou(a)?t[c]=_m({},a):ko(a)?t[c]=a.slice():(!e||!wo(a))&&(t[c]=a)};for(let a=0,l=arguments.length;a<l;a++)arguments[a]&&Jl(arguments[a],s);return t}const iC=(i,e,t,{allOwnKeys:s}={})=>(Jl(e,(a,l)=>{t&&hi(a)?i[l]=Lb(a,t):i[l]=a},{allOwnKeys:s}),i),nC=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),aC=(i,e,t,s)=>{i.prototype=Object.create(e.prototype,s),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:e.prototype}),t&&Object.assign(i.prototype,t)},rC=(i,e,t,s)=>{let a,l,c;const u={};if(e=e||{},i==null)return e;do{for(a=Object.getOwnPropertyNames(i),l=a.length;l-- >0;)c=a[l],(!s||s(c,i,e))&&!u[c]&&(e[c]=i[c],u[c]=!0);i=t!==!1&&gg(i)}while(i&&(!t||t(i,e))&&i!==Object.prototype);return e},oC=(i,e,t)=>{i=String(i),(t===void 0||t>i.length)&&(t=i.length),t-=e.length;const s=i.indexOf(e,t);return s!==-1&&s===t},lC=i=>{if(!i)return null;if(ko(i))return i;let e=i.length;if(!kb(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=i[e];return t},cC=(i=>e=>i&&e instanceof i)(typeof Uint8Array<"u"&&gg(Uint8Array)),uC=(i,e)=>{const s=(i&&i[gd]).call(i);let a;for(;(a=s.next())&&!a.done;){const l=a.value;e.call(i,l[0],l[1])}},dC=(i,e)=>{let t;const s=[];for(;(t=i.exec(e))!==null;)s.push(t);return s},hC=on("HTMLFormElement"),fC=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,a){return s.toUpperCase()+a}),Jx=(({hasOwnProperty:i})=>(e,t)=>i.call(e,t))(Object.prototype),mC=on("RegExp"),Ob=(i,e)=>{const t=Object.getOwnPropertyDescriptors(i),s={};Jl(t,(a,l)=>{let c;(c=e(a,l,i))!==!1&&(s[l]=c||a)}),Object.defineProperties(i,s)},gC=i=>{Ob(i,(e,t)=>{if(hi(i)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const s=i[t];if(hi(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},pC=(i,e)=>{const t={},s=a=>{a.forEach(l=>{t[l]=!0})};return ko(i)?s(i):s(String(i).split(e)),t},yC=()=>{},xC=(i,e)=>i!=null&&Number.isFinite(i=+i)?i:e;function vC(i){return!!(i&&hi(i.append)&&i[Db]==="FormData"&&i[gd])}const _C=i=>{const e=new Array(10),t=(s,a)=>{if(Zl(s)){if(e.indexOf(s)>=0)return;if(Ql(s))return s;if(!("toJSON"in s)){e[a]=s;const l=ko(s)?[]:{};return Jl(s,(c,u)=>{const f=t(c,a+1);!wo(f)&&(l[u]=f)}),e[a]=void 0,l}}return s};return t(i,0)},bC=on("AsyncFunction"),SC=i=>i&&(Zl(i)||hi(i))&&hi(i.then)&&hi(i.catch),Pb=((i,e)=>i?setImmediate:e?((t,s)=>(cr.addEventListener("message",({source:a,data:l})=>{a===cr&&l===t&&s.length&&s.shift()()},!1),a=>{s.push(a),cr.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",hi(cr.postMessage)),EC=typeof queueMicrotask<"u"?queueMicrotask.bind(cr):typeof process<"u"&&process.nextTick||Pb,TC=i=>i!=null&&hi(i[gd]),Re={isArray:ko,isArrayBuffer:Ib,isBuffer:Ql,isFormData:X2,isArrayBufferView:G2,isString:$2,isNumber:kb,isBoolean:V2,isObject:Zl,isPlainObject:Ou,isEmptyObject:H2,isReadableStream:Z2,isRequest:J2,isResponse:eC,isHeaders:tC,isUndefined:wo,isDate:K2,isFile:z2,isBlob:q2,isRegExp:mC,isFunction:hi,isStream:W2,isURLSearchParams:Q2,isTypedArray:cC,isFileList:Y2,forEach:Jl,merge:_m,extend:iC,trim:sC,stripBOM:nC,inherits:aC,toFlatObject:rC,kindOf:pd,kindOfTest:on,endsWith:oC,toArray:lC,forEachEntry:uC,matchAll:dC,isHTMLForm:hC,hasOwnProperty:Jx,hasOwnProp:Jx,reduceDescriptors:Ob,freezeMethods:gC,toObjectSet:pC,toCamelCase:fC,noop:yC,toFiniteNumber:xC,findKey:Mb,global:cr,isContextDefined:jb,isSpecCompliantForm:vC,toJSONObject:_C,isAsyncFn:bC,isThenable:SC,setImmediate:Pb,asap:EC,isIterable:TC};function St(i,e,t,s,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),s&&(this.request=s),a&&(this.response=a,this.status=a.status?a.status:null)}Re.inherits(St,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Re.toJSONObject(this.config),code:this.code,status:this.status}}});const Bb=St.prototype,Ub={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{Ub[i]={value:i}});Object.defineProperties(St,Ub);Object.defineProperty(Bb,"isAxiosError",{value:!0});St.from=(i,e,t,s,a,l)=>{const c=Object.create(Bb);Re.toFlatObject(i,c,function(m){return m!==Error.prototype},d=>d!=="isAxiosError");const u=i&&i.message?i.message:"Error",f=e==null&&i?i.code:e;return St.call(c,u,f,t,s,a),i&&c.cause==null&&Object.defineProperty(c,"cause",{value:i,configurable:!0}),c.name=i&&i.name||"Error",l&&Object.assign(c,l),c};const AC=null;function bm(i){return Re.isPlainObject(i)||Re.isArray(i)}function Fb(i){return Re.endsWith(i,"[]")?i.slice(0,-2):i}function ev(i,e,t){return i?i.concat(e).map(function(a,l){return a=Fb(a),!t&&l?"["+a+"]":a}).join(t?".":""):e}function wC(i){return Re.isArray(i)&&!i.some(bm)}const NC=Re.toFlatObject(Re,{},null,function(e){return/^is[A-Z]/.test(e)});function xd(i,e,t){if(!Re.isObject(i))throw new TypeError("target must be an object");e=e||new FormData,t=Re.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(E,A){return!Re.isUndefined(A[E])});const s=t.metaTokens,a=t.visitor||m,l=t.dots,c=t.indexes,f=(t.Blob||typeof Blob<"u"&&Blob)&&Re.isSpecCompliantForm(e);if(!Re.isFunction(a))throw new TypeError("visitor must be a function");function d(v){if(v===null)return"";if(Re.isDate(v))return v.toISOString();if(Re.isBoolean(v))return v.toString();if(!f&&Re.isBlob(v))throw new St("Blob is not supported. Use a Buffer instead.");return Re.isArrayBuffer(v)||Re.isTypedArray(v)?f&&typeof Blob=="function"?new Blob([v]):Buffer.from(v):v}function m(v,E,A){let R=v;if(v&&!A&&typeof v=="object"){if(Re.endsWith(E,"{}"))E=s?E:E.slice(0,-2),v=JSON.stringify(v);else if(Re.isArray(v)&&wC(v)||(Re.isFileList(v)||Re.endsWith(E,"[]"))&&(R=Re.toArray(v)))return E=Fb(E),R.forEach(function(L,O){!(Re.isUndefined(L)||L===null)&&e.append(c===!0?ev([E],O,l):c===null?E:E+"[]",d(L))}),!1}return bm(v)?!0:(e.append(ev(A,E,l),d(v)),!1)}const g=[],y=Object.assign(NC,{defaultVisitor:m,convertValue:d,isVisitable:bm});function x(v,E){if(!Re.isUndefined(v)){if(g.indexOf(v)!==-1)throw Error("Circular reference detected in "+E.join("."));g.push(v),Re.forEach(v,function(R,D){(!(Re.isUndefined(R)||R===null)&&a.call(e,R,Re.isString(D)?D.trim():D,E,y))===!0&&x(R,E?E.concat(D):[D])}),g.pop()}}if(!Re.isObject(i))throw new TypeError("data must be an object");return x(i),e}function tv(i){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function pg(i,e){this._pairs=[],i&&xd(i,this,e)}const Gb=pg.prototype;Gb.append=function(e,t){this._pairs.push([e,t])};Gb.toString=function(e){const t=e?function(s){return e.call(this,s,tv)}:tv;return this._pairs.map(function(a){return t(a[0])+"="+t(a[1])},"").join("&")};function RC(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function $b(i,e,t){if(!e)return i;const s=t&&t.encode||RC;Re.isFunction(t)&&(t={serialize:t});const a=t&&t.serialize;let l;if(a?l=a(e,t):l=Re.isURLSearchParams(e)?e.toString():new pg(e,t).toString(s),l){const c=i.indexOf("#");c!==-1&&(i=i.slice(0,c)),i+=(i.indexOf("?")===-1?"?":"&")+l}return i}class sv{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Re.forEach(this.handlers,function(s){s!==null&&e(s)})}}const Vb={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},CC=typeof URLSearchParams<"u"?URLSearchParams:pg,LC=typeof FormData<"u"?FormData:null,DC=typeof Blob<"u"?Blob:null,IC={isBrowser:!0,classes:{URLSearchParams:CC,FormData:LC,Blob:DC},protocols:["http","https","file","blob","url","data"]},yg=typeof window<"u"&&typeof document<"u",Sm=typeof navigator=="object"&&navigator||void 0,kC=yg&&(!Sm||["ReactNative","NativeScript","NS"].indexOf(Sm.product)<0),MC=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",jC=yg&&window.location.href||"http://localhost",OC=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:yg,hasStandardBrowserEnv:kC,hasStandardBrowserWebWorkerEnv:MC,navigator:Sm,origin:jC},Symbol.toStringTag,{value:"Module"})),Ws={...OC,...IC};function PC(i,e){return xd(i,new Ws.classes.URLSearchParams,{visitor:function(t,s,a,l){return Ws.isNode&&Re.isBuffer(t)?(this.append(s,t.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)},...e})}function BC(i){return Re.matchAll(/\w+|\[(\w*)]/g,i).map(e=>e[0]==="[]"?"":e[1]||e[0])}function UC(i){const e={},t=Object.keys(i);let s;const a=t.length;let l;for(s=0;s<a;s++)l=t[s],e[l]=i[l];return e}function Hb(i){function e(t,s,a,l){let c=t[l++];if(c==="__proto__")return!0;const u=Number.isFinite(+c),f=l>=t.length;return c=!c&&Re.isArray(a)?a.length:c,f?(Re.hasOwnProp(a,c)?a[c]=[a[c],s]:a[c]=s,!u):((!a[c]||!Re.isObject(a[c]))&&(a[c]=[]),e(t,s,a[c],l)&&Re.isArray(a[c])&&(a[c]=UC(a[c])),!u)}if(Re.isFormData(i)&&Re.isFunction(i.entries)){const t={};return Re.forEachEntry(i,(s,a)=>{e(BC(s),a,t,0)}),t}return null}function FC(i,e,t){if(Re.isString(i))try{return(e||JSON.parse)(i),Re.trim(i)}catch(s){if(s.name!=="SyntaxError")throw s}return(t||JSON.stringify)(i)}const ec={transitional:Vb,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",a=s.indexOf("application/json")>-1,l=Re.isObject(e);if(l&&Re.isHTMLForm(e)&&(e=new FormData(e)),Re.isFormData(e))return a?JSON.stringify(Hb(e)):e;if(Re.isArrayBuffer(e)||Re.isBuffer(e)||Re.isStream(e)||Re.isFile(e)||Re.isBlob(e)||Re.isReadableStream(e))return e;if(Re.isArrayBufferView(e))return e.buffer;if(Re.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(l){if(s.indexOf("application/x-www-form-urlencoded")>-1)return PC(e,this.formSerializer).toString();if((u=Re.isFileList(e))||s.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return xd(u?{"files[]":e}:e,f&&new f,this.formSerializer)}}return l||a?(t.setContentType("application/json",!1),FC(e)):e}],transformResponse:[function(e){const t=this.transitional||ec.transitional,s=t&&t.forcedJSONParsing,a=this.responseType==="json";if(Re.isResponse(e)||Re.isReadableStream(e))return e;if(e&&Re.isString(e)&&(s&&!this.responseType||a)){const c=!(t&&t.silentJSONParsing)&&a;try{return JSON.parse(e,this.parseReviver)}catch(u){if(c)throw u.name==="SyntaxError"?St.from(u,St.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ws.classes.FormData,Blob:Ws.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Re.forEach(["delete","get","head","post","put","patch"],i=>{ec.headers[i]={}});const GC=Re.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),$C=i=>{const e={};let t,s,a;return i&&i.split(`
`).forEach(function(c){a=c.indexOf(":"),t=c.substring(0,a).trim().toLowerCase(),s=c.substring(a+1).trim(),!(!t||e[t]&&GC[t])&&(t==="set-cookie"?e[t]?e[t].push(s):e[t]=[s]:e[t]=e[t]?e[t]+", "+s:s)}),e},iv=Symbol("internals");function Ll(i){return i&&String(i).trim().toLowerCase()}function Pu(i){return i===!1||i==null?i:Re.isArray(i)?i.map(Pu):String(i)}function VC(i){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=t.exec(i);)e[s[1]]=s[2];return e}const HC=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function kf(i,e,t,s,a){if(Re.isFunction(s))return s.call(this,e,t);if(a&&(e=t),!!Re.isString(e)){if(Re.isString(s))return e.indexOf(s)!==-1;if(Re.isRegExp(s))return s.test(e)}}function KC(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}function zC(i,e){const t=Re.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(i,s+t,{value:function(a,l,c){return this[s].call(this,e,a,l,c)},configurable:!0})})}let fi=class{constructor(e){e&&this.set(e)}set(e,t,s){const a=this;function l(u,f,d){const m=Ll(f);if(!m)throw new Error("header name must be a non-empty string");const g=Re.findKey(a,m);(!g||a[g]===void 0||d===!0||d===void 0&&a[g]!==!1)&&(a[g||f]=Pu(u))}const c=(u,f)=>Re.forEach(u,(d,m)=>l(d,m,f));if(Re.isPlainObject(e)||e instanceof this.constructor)c(e,t);else if(Re.isString(e)&&(e=e.trim())&&!HC(e))c($C(e),t);else if(Re.isObject(e)&&Re.isIterable(e)){let u={},f,d;for(const m of e){if(!Re.isArray(m))throw TypeError("Object iterator must return a key-value pair");u[d=m[0]]=(f=u[d])?Re.isArray(f)?[...f,m[1]]:[f,m[1]]:m[1]}c(u,t)}else e!=null&&l(t,e,s);return this}get(e,t){if(e=Ll(e),e){const s=Re.findKey(this,e);if(s){const a=this[s];if(!t)return a;if(t===!0)return VC(a);if(Re.isFunction(t))return t.call(this,a,s);if(Re.isRegExp(t))return t.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ll(e),e){const s=Re.findKey(this,e);return!!(s&&this[s]!==void 0&&(!t||kf(this,this[s],s,t)))}return!1}delete(e,t){const s=this;let a=!1;function l(c){if(c=Ll(c),c){const u=Re.findKey(s,c);u&&(!t||kf(s,s[u],u,t))&&(delete s[u],a=!0)}}return Re.isArray(e)?e.forEach(l):l(e),a}clear(e){const t=Object.keys(this);let s=t.length,a=!1;for(;s--;){const l=t[s];(!e||kf(this,this[l],l,e,!0))&&(delete this[l],a=!0)}return a}normalize(e){const t=this,s={};return Re.forEach(this,(a,l)=>{const c=Re.findKey(s,l);if(c){t[c]=Pu(a),delete t[l];return}const u=e?KC(l):String(l).trim();u!==l&&delete t[l],t[u]=Pu(a),s[u]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Re.forEach(this,(s,a)=>{s!=null&&s!==!1&&(t[a]=e&&Re.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(a=>s.set(a)),s}static accessor(e){const s=(this[iv]=this[iv]={accessors:{}}).accessors,a=this.prototype;function l(c){const u=Ll(c);s[u]||(zC(a,c),s[u]=!0)}return Re.isArray(e)?e.forEach(l):l(e),this}};fi.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Re.reduceDescriptors(fi.prototype,({value:i},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>i,set(s){this[t]=s}}});Re.freezeMethods(fi);function Mf(i,e){const t=this||ec,s=e||t,a=fi.from(s.headers);let l=s.data;return Re.forEach(i,function(u){l=u.call(t,l,a.normalize(),e?e.status:void 0)}),a.normalize(),l}function Kb(i){return!!(i&&i.__CANCEL__)}function Mo(i,e,t){St.call(this,i??"canceled",St.ERR_CANCELED,e,t),this.name="CanceledError"}Re.inherits(Mo,St,{__CANCEL__:!0});function zb(i,e,t){const s=t.config.validateStatus;!t.status||!s||s(t.status)?i(t):e(new St("Request failed with status code "+t.status,[St.ERR_BAD_REQUEST,St.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function qC(i){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return e&&e[1]||""}function YC(i,e){i=i||10;const t=new Array(i),s=new Array(i);let a=0,l=0,c;return e=e!==void 0?e:1e3,function(f){const d=Date.now(),m=s[l];c||(c=d),t[a]=f,s[a]=d;let g=l,y=0;for(;g!==a;)y+=t[g++],g=g%i;if(a=(a+1)%i,a===l&&(l=(l+1)%i),d-c<e)return;const x=m&&d-m;return x?Math.round(y*1e3/x):void 0}}function WC(i,e){let t=0,s=1e3/e,a,l;const c=(d,m=Date.now())=>{t=m,a=null,l&&(clearTimeout(l),l=null),i(...d)};return[(...d)=>{const m=Date.now(),g=m-t;g>=s?c(d,m):(a=d,l||(l=setTimeout(()=>{l=null,c(a)},s-g)))},()=>a&&c(a)]}const Zu=(i,e,t=3)=>{let s=0;const a=YC(50,250);return WC(l=>{const c=l.loaded,u=l.lengthComputable?l.total:void 0,f=c-s,d=a(f),m=c<=u;s=c;const g={loaded:c,total:u,progress:u?c/u:void 0,bytes:f,rate:d||void 0,estimated:d&&u&&m?(u-c)/d:void 0,event:l,lengthComputable:u!=null,[e?"download":"upload"]:!0};i(g)},t)},nv=(i,e)=>{const t=i!=null;return[s=>e[0]({lengthComputable:t,total:i,loaded:s}),e[1]]},av=i=>(...e)=>Re.asap(()=>i(...e)),XC=Ws.hasStandardBrowserEnv?((i,e)=>t=>(t=new URL(t,Ws.origin),i.protocol===t.protocol&&i.host===t.host&&(e||i.port===t.port)))(new URL(Ws.origin),Ws.navigator&&/(msie|trident)/i.test(Ws.navigator.userAgent)):()=>!0,QC=Ws.hasStandardBrowserEnv?{write(i,e,t,s,a,l,c){if(typeof document>"u")return;const u=[`${i}=${encodeURIComponent(e)}`];Re.isNumber(t)&&u.push(`expires=${new Date(t).toUTCString()}`),Re.isString(s)&&u.push(`path=${s}`),Re.isString(a)&&u.push(`domain=${a}`),l===!0&&u.push("secure"),Re.isString(c)&&u.push(`SameSite=${c}`),document.cookie=u.join("; ")},read(i){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+i+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(i){this.write(i,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function ZC(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function JC(i,e){return e?i.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):i}function qb(i,e,t){let s=!ZC(e);return i&&(s||t==!1)?JC(i,e):e}const rv=i=>i instanceof fi?{...i}:i;function br(i,e){e=e||{};const t={};function s(d,m,g,y){return Re.isPlainObject(d)&&Re.isPlainObject(m)?Re.merge.call({caseless:y},d,m):Re.isPlainObject(m)?Re.merge({},m):Re.isArray(m)?m.slice():m}function a(d,m,g,y){if(Re.isUndefined(m)){if(!Re.isUndefined(d))return s(void 0,d,g,y)}else return s(d,m,g,y)}function l(d,m){if(!Re.isUndefined(m))return s(void 0,m)}function c(d,m){if(Re.isUndefined(m)){if(!Re.isUndefined(d))return s(void 0,d)}else return s(void 0,m)}function u(d,m,g){if(g in e)return s(d,m);if(g in i)return s(void 0,d)}const f={url:l,method:l,data:l,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:u,headers:(d,m,g)=>a(rv(d),rv(m),g,!0)};return Re.forEach(Object.keys({...i,...e}),function(m){const g=f[m]||a,y=g(i[m],e[m],m);Re.isUndefined(y)&&g!==u||(t[m]=y)}),t}const Yb=i=>{const e=br({},i);let{data:t,withXSRFToken:s,xsrfHeaderName:a,xsrfCookieName:l,headers:c,auth:u}=e;if(e.headers=c=fi.from(c),e.url=$b(qb(e.baseURL,e.url,e.allowAbsoluteUrls),i.params,i.paramsSerializer),u&&c.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):""))),Re.isFormData(t)){if(Ws.hasStandardBrowserEnv||Ws.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if(Re.isFunction(t.getHeaders)){const f=t.getHeaders(),d=["content-type","content-length"];Object.entries(f).forEach(([m,g])=>{d.includes(m.toLowerCase())&&c.set(m,g)})}}if(Ws.hasStandardBrowserEnv&&(s&&Re.isFunction(s)&&(s=s(e)),s||s!==!1&&XC(e.url))){const f=a&&l&&QC.read(l);f&&c.set(a,f)}return e},eL=typeof XMLHttpRequest<"u",tL=eL&&function(i){return new Promise(function(t,s){const a=Yb(i);let l=a.data;const c=fi.from(a.headers).normalize();let{responseType:u,onUploadProgress:f,onDownloadProgress:d}=a,m,g,y,x,v;function E(){x&&x(),v&&v(),a.cancelToken&&a.cancelToken.unsubscribe(m),a.signal&&a.signal.removeEventListener("abort",m)}let A=new XMLHttpRequest;A.open(a.method.toUpperCase(),a.url,!0),A.timeout=a.timeout;function R(){if(!A)return;const L=fi.from("getAllResponseHeaders"in A&&A.getAllResponseHeaders()),H={data:!u||u==="text"||u==="json"?A.responseText:A.response,status:A.status,statusText:A.statusText,headers:L,config:i,request:A};zb(function(U){t(U),E()},function(U){s(U),E()},H),A=null}"onloadend"in A?A.onloadend=R:A.onreadystatechange=function(){!A||A.readyState!==4||A.status===0&&!(A.responseURL&&A.responseURL.indexOf("file:")===0)||setTimeout(R)},A.onabort=function(){A&&(s(new St("Request aborted",St.ECONNABORTED,i,A)),A=null)},A.onerror=function(O){const H=O&&O.message?O.message:"Network Error",q=new St(H,St.ERR_NETWORK,i,A);q.event=O||null,s(q),A=null},A.ontimeout=function(){let O=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const H=a.transitional||Vb;a.timeoutErrorMessage&&(O=a.timeoutErrorMessage),s(new St(O,H.clarifyTimeoutError?St.ETIMEDOUT:St.ECONNABORTED,i,A)),A=null},l===void 0&&c.setContentType(null),"setRequestHeader"in A&&Re.forEach(c.toJSON(),function(O,H){A.setRequestHeader(H,O)}),Re.isUndefined(a.withCredentials)||(A.withCredentials=!!a.withCredentials),u&&u!=="json"&&(A.responseType=a.responseType),d&&([y,v]=Zu(d,!0),A.addEventListener("progress",y)),f&&A.upload&&([g,x]=Zu(f),A.upload.addEventListener("progress",g),A.upload.addEventListener("loadend",x)),(a.cancelToken||a.signal)&&(m=L=>{A&&(s(!L||L.type?new Mo(null,i,A):L),A.abort(),A=null)},a.cancelToken&&a.cancelToken.subscribe(m),a.signal&&(a.signal.aborted?m():a.signal.addEventListener("abort",m)));const D=qC(a.url);if(D&&Ws.protocols.indexOf(D)===-1){s(new St("Unsupported protocol "+D+":",St.ERR_BAD_REQUEST,i));return}A.send(l||null)})},sL=(i,e)=>{const{length:t}=i=i?i.filter(Boolean):[];if(e||t){let s=new AbortController,a;const l=function(d){if(!a){a=!0,u();const m=d instanceof Error?d:this.reason;s.abort(m instanceof St?m:new Mo(m instanceof Error?m.message:m))}};let c=e&&setTimeout(()=>{c=null,l(new St(`timeout ${e} of ms exceeded`,St.ETIMEDOUT))},e);const u=()=>{i&&(c&&clearTimeout(c),c=null,i.forEach(d=>{d.unsubscribe?d.unsubscribe(l):d.removeEventListener("abort",l)}),i=null)};i.forEach(d=>d.addEventListener("abort",l));const{signal:f}=s;return f.unsubscribe=()=>Re.asap(u),f}},iL=function*(i,e){let t=i.byteLength;if(t<e){yield i;return}let s=0,a;for(;s<t;)a=s+e,yield i.slice(s,a),s=a},nL=async function*(i,e){for await(const t of aL(i))yield*iL(t,e)},aL=async function*(i){if(i[Symbol.asyncIterator]){yield*i;return}const e=i.getReader();try{for(;;){const{done:t,value:s}=await e.read();if(t)break;yield s}}finally{await e.cancel()}},ov=(i,e,t,s)=>{const a=nL(i,e);let l=0,c,u=f=>{c||(c=!0,s&&s(f))};return new ReadableStream({async pull(f){try{const{done:d,value:m}=await a.next();if(d){u(),f.close();return}let g=m.byteLength;if(t){let y=l+=g;t(y)}f.enqueue(new Uint8Array(m))}catch(d){throw u(d),d}},cancel(f){return u(f),a.return()}},{highWaterMark:2})},lv=64*1024,{isFunction:mu}=Re,rL=(({Request:i,Response:e})=>({Request:i,Response:e}))(Re.global),{ReadableStream:cv,TextEncoder:uv}=Re.global,dv=(i,...e)=>{try{return!!i(...e)}catch{return!1}},oL=i=>{i=Re.merge.call({skipUndefined:!0},rL,i);const{fetch:e,Request:t,Response:s}=i,a=e?mu(e):typeof fetch=="function",l=mu(t),c=mu(s);if(!a)return!1;const u=a&&mu(cv),f=a&&(typeof uv=="function"?(v=>E=>v.encode(E))(new uv):async v=>new Uint8Array(await new t(v).arrayBuffer())),d=l&&u&&dv(()=>{let v=!1;const E=new t(Ws.origin,{body:new cv,method:"POST",get duplex(){return v=!0,"half"}}).headers.has("Content-Type");return v&&!E}),m=c&&u&&dv(()=>Re.isReadableStream(new s("").body)),g={stream:m&&(v=>v.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(v=>{!g[v]&&(g[v]=(E,A)=>{let R=E&&E[v];if(R)return R.call(E);throw new St(`Response type '${v}' is not supported`,St.ERR_NOT_SUPPORT,A)})});const y=async v=>{if(v==null)return 0;if(Re.isBlob(v))return v.size;if(Re.isSpecCompliantForm(v))return(await new t(Ws.origin,{method:"POST",body:v}).arrayBuffer()).byteLength;if(Re.isArrayBufferView(v)||Re.isArrayBuffer(v))return v.byteLength;if(Re.isURLSearchParams(v)&&(v=v+""),Re.isString(v))return(await f(v)).byteLength},x=async(v,E)=>{const A=Re.toFiniteNumber(v.getContentLength());return A??y(E)};return async v=>{let{url:E,method:A,data:R,signal:D,cancelToken:L,timeout:O,onDownloadProgress:H,onUploadProgress:q,responseType:U,headers:k,withCredentials:M="same-origin",fetchOptions:I}=Yb(v),j=e||fetch;U=U?(U+"").toLowerCase():"text";let Z=sL([D,L&&L.toAbortSignal()],O),ae=null;const ie=Z&&Z.unsubscribe&&(()=>{Z.unsubscribe()});let re;try{if(q&&d&&A!=="get"&&A!=="head"&&(re=await x(k,R))!==0){let $=new t(E,{method:"POST",body:R,duplex:"half"}),X;if(Re.isFormData(R)&&(X=$.headers.get("content-type"))&&k.setContentType(X),$.body){const[me,ve]=nv(re,Zu(av(q)));R=ov($.body,lv,me,ve)}}Re.isString(M)||(M=M?"include":"omit");const Q=l&&"credentials"in t.prototype,se={...I,signal:Z,method:A.toUpperCase(),headers:k.normalize().toJSON(),body:R,duplex:"half",credentials:Q?M:void 0};ae=l&&new t(E,se);let oe=await(l?j(ae,I):j(E,se));const Y=m&&(U==="stream"||U==="response");if(m&&(H||Y&&ie)){const $={};["status","statusText","headers"].forEach(pe=>{$[pe]=oe[pe]});const X=Re.toFiniteNumber(oe.headers.get("content-length")),[me,ve]=H&&nv(X,Zu(av(H),!0))||[];oe=new s(ov(oe.body,lv,me,()=>{ve&&ve(),ie&&ie()}),$)}U=U||"text";let V=await g[Re.findKey(g,U)||"text"](oe,v);return!Y&&ie&&ie(),await new Promise(($,X)=>{zb($,X,{data:V,headers:fi.from(oe.headers),status:oe.status,statusText:oe.statusText,config:v,request:ae})})}catch(Q){throw ie&&ie(),Q&&Q.name==="TypeError"&&/Load failed|fetch/i.test(Q.message)?Object.assign(new St("Network Error",St.ERR_NETWORK,v,ae),{cause:Q.cause||Q}):St.from(Q,Q&&Q.code,v,ae)}}},lL=new Map,Wb=i=>{let e=i&&i.env||{};const{fetch:t,Request:s,Response:a}=e,l=[s,a,t];let c=l.length,u=c,f,d,m=lL;for(;u--;)f=l[u],d=m.get(f),d===void 0&&m.set(f,d=u?new Map:oL(e)),m=d;return d};Wb();const xg={http:AC,xhr:tL,fetch:{get:Wb}};Re.forEach(xg,(i,e)=>{if(i){try{Object.defineProperty(i,"name",{value:e})}catch{}Object.defineProperty(i,"adapterName",{value:e})}});const hv=i=>`- ${i}`,cL=i=>Re.isFunction(i)||i===null||i===!1;function uL(i,e){i=Re.isArray(i)?i:[i];const{length:t}=i;let s,a;const l={};for(let c=0;c<t;c++){s=i[c];let u;if(a=s,!cL(s)&&(a=xg[(u=String(s)).toLowerCase()],a===void 0))throw new St(`Unknown adapter '${u}'`);if(a&&(Re.isFunction(a)||(a=a.get(e))))break;l[u||"#"+c]=a}if(!a){const c=Object.entries(l).map(([f,d])=>`adapter ${f} `+(d===!1?"is not supported by the environment":"is not available in the build"));let u=t?c.length>1?`since :
`+c.map(hv).join(`
`):" "+hv(c[0]):"as no adapter specified";throw new St("There is no suitable adapter to dispatch the request "+u,"ERR_NOT_SUPPORT")}return a}const Xb={getAdapter:uL,adapters:xg};function jf(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new Mo(null,i)}function fv(i){return jf(i),i.headers=fi.from(i.headers),i.data=Mf.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),Xb.getAdapter(i.adapter||ec.adapter,i)(i).then(function(s){return jf(i),s.data=Mf.call(i,i.transformResponse,s),s.headers=fi.from(s.headers),s},function(s){return Kb(s)||(jf(i),s&&s.response&&(s.response.data=Mf.call(i,i.transformResponse,s.response),s.response.headers=fi.from(s.response.headers))),Promise.reject(s)})}const Qb="1.13.2",vd={};["object","boolean","number","function","string","symbol"].forEach((i,e)=>{vd[i]=function(s){return typeof s===i||"a"+(e<1?"n ":" ")+i}});const mv={};vd.transitional=function(e,t,s){function a(l,c){return"[Axios v"+Qb+"] Transitional option '"+l+"'"+c+(s?". "+s:"")}return(l,c,u)=>{if(e===!1)throw new St(a(c," has been removed"+(t?" in "+t:"")),St.ERR_DEPRECATED);return t&&!mv[c]&&(mv[c]=!0,console.warn(a(c," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(l,c,u):!0}};vd.spelling=function(e){return(t,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};function dL(i,e,t){if(typeof i!="object")throw new St("options must be an object",St.ERR_BAD_OPTION_VALUE);const s=Object.keys(i);let a=s.length;for(;a-- >0;){const l=s[a],c=e[l];if(c){const u=i[l],f=u===void 0||c(u,l,i);if(f!==!0)throw new St("option "+l+" must be "+f,St.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new St("Unknown option "+l,St.ERR_BAD_OPTION)}}const Bu={assertOptions:dL,validators:vd},mn=Bu.validators;let hr=class{constructor(e){this.defaults=e||{},this.interceptors={request:new sv,response:new sv}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?l&&!String(s.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+l):s.stack=l}catch{}}throw s}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=br(this.defaults,t);const{transitional:s,paramsSerializer:a,headers:l}=t;s!==void 0&&Bu.assertOptions(s,{silentJSONParsing:mn.transitional(mn.boolean),forcedJSONParsing:mn.transitional(mn.boolean),clarifyTimeoutError:mn.transitional(mn.boolean)},!1),a!=null&&(Re.isFunction(a)?t.paramsSerializer={serialize:a}:Bu.assertOptions(a,{encode:mn.function,serialize:mn.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Bu.assertOptions(t,{baseUrl:mn.spelling("baseURL"),withXsrfToken:mn.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let c=l&&Re.merge(l.common,l[t.method]);l&&Re.forEach(["delete","get","head","post","put","patch","common"],v=>{delete l[v]}),t.headers=fi.concat(c,l);const u=[];let f=!0;this.interceptors.request.forEach(function(E){typeof E.runWhen=="function"&&E.runWhen(t)===!1||(f=f&&E.synchronous,u.unshift(E.fulfilled,E.rejected))});const d=[];this.interceptors.response.forEach(function(E){d.push(E.fulfilled,E.rejected)});let m,g=0,y;if(!f){const v=[fv.bind(this),void 0];for(v.unshift(...u),v.push(...d),y=v.length,m=Promise.resolve(t);g<y;)m=m.then(v[g++],v[g++]);return m}y=u.length;let x=t;for(;g<y;){const v=u[g++],E=u[g++];try{x=v(x)}catch(A){E.call(this,A);break}}try{m=fv.call(this,x)}catch(v){return Promise.reject(v)}for(g=0,y=d.length;g<y;)m=m.then(d[g++],d[g++]);return m}getUri(e){e=br(this.defaults,e);const t=qb(e.baseURL,e.url,e.allowAbsoluteUrls);return $b(t,e.params,e.paramsSerializer)}};Re.forEach(["delete","get","head","options"],function(e){hr.prototype[e]=function(t,s){return this.request(br(s||{},{method:e,url:t,data:(s||{}).data}))}});Re.forEach(["post","put","patch"],function(e){function t(s){return function(l,c,u){return this.request(br(u||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:l,data:c}))}}hr.prototype[e]=t(),hr.prototype[e+"Form"]=t(!0)});let hL=class Zb{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(l){t=l});const s=this;this.promise.then(a=>{if(!s._listeners)return;let l=s._listeners.length;for(;l-- >0;)s._listeners[l](a);s._listeners=null}),this.promise.then=a=>{let l;const c=new Promise(u=>{s.subscribe(u),l=u}).then(a);return c.cancel=function(){s.unsubscribe(l)},c},e(function(l,c,u){s.reason||(s.reason=new Mo(l,c,u),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=s=>{e.abort(s)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Zb(function(a){e=a}),cancel:e}}};function fL(i){return function(t){return i.apply(null,t)}}function mL(i){return Re.isObject(i)&&i.isAxiosError===!0}const Em={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Em).forEach(([i,e])=>{Em[e]=i});function Jb(i){const e=new hr(i),t=Lb(hr.prototype.request,e);return Re.extend(t,hr.prototype,e,{allOwnKeys:!0}),Re.extend(t,e,null,{allOwnKeys:!0}),t.create=function(a){return Jb(br(i,a))},t}const bs=Jb(ec);bs.Axios=hr;bs.CanceledError=Mo;bs.CancelToken=hL;bs.isCancel=Kb;bs.VERSION=Qb;bs.toFormData=xd;bs.AxiosError=St;bs.Cancel=bs.CanceledError;bs.all=function(e){return Promise.all(e)};bs.spread=fL;bs.isAxiosError=mL;bs.mergeConfig=br;bs.AxiosHeaders=fi;bs.formToJSON=i=>Hb(Re.isHTMLForm(i)?new FormData(i):i);bs.getAdapter=Xb.getAdapter;bs.HttpStatusCode=Em;bs.default=bs;const{Axios:TP,AxiosError:AP,CanceledError:wP,isCancel:NP,CancelToken:RP,VERSION:CP,all:LP,Cancel:DP,isAxiosError:IP,spread:kP,toFormData:MP,AxiosHeaders:jP,HttpStatusCode:OP,formToJSON:PP,getAdapter:BP,mergeConfig:UP}=bs,Of="openflix_token";class gL{client;constructor(){this.client=bs.create({baseURL:"",headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{const t=this.getToken();return t&&(e.headers["X-Plex-Token"]=t),e}),this.client.interceptors.response.use(e=>e,e=>(e.response?.status===401&&(this.clearToken(),window.location.href="/ui/login"),Promise.reject(e)))}getToken(){return localStorage.getItem(Of)}setToken(e){localStorage.setItem(Of,e)}clearToken(){localStorage.removeItem(Of)}isAuthenticated(){return!!this.getToken()}async login(e){const t=await this.client.post("/auth/login",e);return this.setToken(t.data.authToken),t.data}async register(e){return(await this.client.post("/auth/register",e)).data}async logout(){try{await this.client.post("/auth/logout")}finally{this.clearToken()}}async getCurrentUser(){return(await this.client.get("/auth/user")).data}async getUsers(){return(await this.client.get("/admin/users")).data.users||[]}async createUser(e){return(await this.client.post("/auth/register",e)).data}async updateUser(e,t){return(await this.client.put(`/admin/users/${e}`,t)).data}async deleteUser(e){await this.client.delete(`/admin/users/${e}`)}async getLibraries(){return(await this.client.get("/admin/libraries")).data.libraries||[]}async createLibrary(e){return(await this.client.post("/admin/libraries",e)).data}async updateLibrary(e,t){return(await this.client.put(`/admin/libraries/${e}`,t)).data}async deleteLibrary(e){await this.client.delete(`/admin/libraries/${e}`)}async scanLibrary(e){await this.client.post(`/admin/libraries/${e}/scan`)}async addLibraryPath(e,t){await this.client.post(`/admin/libraries/${e}/paths`,{path:t})}async removeLibraryPath(e,t){await this.client.delete(`/admin/libraries/${e}/paths/${t}`)}async getLibraryStats(e){return(await this.client.get(`/admin/libraries/${e}/stats`)).data}async browseFilesystem(e){return(await this.client.get("/admin/filesystem/browse",{params:e?{path:e}:void 0})).data}async getM3USources(){return(await this.client.get("/livetv/sources")).data.sources||[]}async createM3USource(e){return(await this.client.post("/livetv/sources",e)).data}async updateM3USource(e,t){return(await this.client.put(`/livetv/sources/${e}`,t)).data}async deleteM3USource(e){await this.client.delete(`/livetv/sources/${e}`)}async refreshM3USource(e){await this.client.post(`/livetv/sources/${e}/refresh`)}async mapChannelNumbers(e){return(await this.client.post("/livetv/channels/map-numbers",e)).data}async exportConfig(){return(await this.client.get("/config/export",{responseType:"blob"})).data}async getConfigStats(){return(await this.client.get("/config/stats")).data}async importConfig(e,t=!1){const s=t?"/config/import?preview=true":"/config/import";return(await this.client.post(s,e)).data}async getChannelGroups(){return(await this.client.get("/livetv/channel-groups")).data.groups||[]}async createChannelGroup(e){return(await this.client.post("/livetv/channel-groups",e)).data}async updateChannelGroup(e,t){return(await this.client.put(`/livetv/channel-groups/${e}`,t)).data}async deleteChannelGroup(e){await this.client.delete(`/livetv/channel-groups/${e}`)}async addChannelToGroup(e,t,s){return(await this.client.post(`/livetv/channel-groups/${e}/members`,{channelId:t,priority:s??0})).data}async updateGroupMemberPriority(e,t,s){return(await this.client.put(`/livetv/channel-groups/${e}/members/${t}`,{priority:s})).data}async removeChannelFromGroup(e,t){await this.client.delete(`/livetv/channel-groups/${e}/members/${t}`)}async autoDetectDuplicates(){return(await this.client.post("/livetv/channel-groups/auto-detect")).data}async getEPGSources(){return(await this.client.get("/livetv/epg/sources")).data.sources||[]}async previewEPGSource(e){return(await this.client.post("/livetv/epg/sources/preview",e)).data}async createEPGSource(e){return(await this.client.post("/livetv/epg/sources",e)).data}async deleteEPGSource(e){await this.client.delete(`/livetv/epg/sources/${e}`)}async updateEPGSource(e,t){return(await this.client.put(`/livetv/epg/sources/${e}`,t)).data}async refreshEPG(){await this.client.post("/livetv/epg/refresh")}async getGuide(){return(await this.client.get("/livetv/guide")).data}async getEPGPrograms(e){return(await this.client.get("/livetv/epg/programs",{params:e})).data}async getEPGChannels(e){return(await this.client.get("/livetv/epg/channels",{params:e?{epgSourceId:e}:void 0})).data.channels||[]}async discoverProviders(e){return(await this.client.get("/livetv/gracenote/providers",{params:{postalCode:e}})).data}async getXtreamSources(){return(await this.client.get("/livetv/xtream/sources")).data.sources||[]}async createXtreamSource(e){return(await this.client.post("/livetv/xtream/sources",e)).data}async updateXtreamSource(e,t){return(await this.client.put(`/livetv/xtream/sources/${e}`,t)).data}async deleteXtreamSource(e){await this.client.delete(`/livetv/xtream/sources/${e}`)}async testXtreamSource(e){return(await this.client.post(`/livetv/xtream/sources/${e}/test`)).data}async refreshXtreamSource(e){return(await this.client.post(`/livetv/xtream/sources/${e}/refresh`)).data}async parseXtreamFromM3U(e){return(await this.client.post("/livetv/xtream/parse-m3u",{url:e})).data}async importXtreamVOD(e){return(await this.client.post(`/livetv/xtream/sources/${e}/import-vod`)).data}async importXtreamSeries(e){return(await this.client.post(`/livetv/xtream/sources/${e}/import-series`)).data}async importAllXtreamContent(e){return(await this.client.post(`/livetv/xtream/sources/${e}/import-all`)).data}async getRecordings(){return(await this.client.get("/dvr/recordings")).data.recordings||[]}async deleteRecording(e){await this.client.delete(`/dvr/recordings/${e}`)}async getSeriesRules(){return(await this.client.get("/dvr/rules")).data.rules||[]}async createSeriesRule(e){return(await this.client.post("/dvr/rules",e)).data}async updateSeriesRule(e,t){return(await this.client.put(`/dvr/rules/${e}`,t)).data}async deleteSeriesRule(e){await this.client.delete(`/dvr/rules/${e}`)}async getRecordingConflicts(){return(await this.client.get("/dvr/conflicts")).data}async resolveConflict(e,t){await this.client.post("/dvr/conflicts/resolve",{keepRecordingId:e,cancelRecordingId:t})}async getRecordingStats(){return(await this.client.get("/dvr/recordings/stats")).data}async getRecordingCommercials(e){return(await this.client.get(`/dvr/recordings/${e}/commercials`)).data}async getCommercialDetectionStatus(){return(await this.client.get("/dvr/commercials/status")).data}async runCommercialDetection(e){await this.client.post(`/dvr/recordings/${e}/commercials/detect`)}async getRecordingStreamUrl(e){return(await this.client.get(`/dvr/recordings/${e}/stream`)).data.url}async updateRecordingProgress(e,t){await this.client.put(`/dvr/recordings/${e}/progress`,{viewOffset:t})}async getDVRSettings(){return(await this.client.get("/dvr/settings")).data.settings}async updateDVRSettings(e){return(await this.client.put("/dvr/settings",e)).data.settings}async getServerStatus(){return(await this.client.get("/api/status")).data}async getServerConfig(){return(await this.client.get("/admin/settings")).data.settings}async updateServerConfig(e){return(await this.client.put("/admin/settings",e)).data.settings}async getAdminMedia(e){return(await this.client.get("/admin/media",{params:e})).data}async refreshMediaMetadata(e){await this.client.post(`/admin/media/${e}/refresh`)}async updateMediaMetadata(e,t){return(await this.client.put(`/admin/media/${e}`,t)).data}async searchTMDB(e,t){return(await this.client.get("/admin/media/search-tmdb",{params:{query:e,media_type:t}})).data.results||[]}async applyMediaMatch(e,t,s){await this.client.post(`/admin/media/${e}/match`,{tmdb_id:t,media_type:s})}vod={testConnection:async e=>{const t=e?{url:e}:{};return(await this.client.get("/api/vod/test-connection",{params:t})).data},getProviders:async()=>(await this.client.get("/api/vod/providers")).data,getMovies:async e=>(await this.client.get(`/api/vod/${e}/movies`)).data,getShows:async e=>(await this.client.get(`/api/vod/${e}/shows`)).data,getGenres:async e=>(await this.client.get(`/api/vod/${e}/genres`)).data,getMovie:async(e,t)=>(await this.client.get(`/api/vod/${e}/movie/${t}`)).data,getShow:async(e,t)=>(await this.client.get(`/api/vod/${e}/show/${t}`)).data,startDownload:async(e,t,s)=>{await this.client.post(`/api/vod/${e}/download`,{contentId:t,type:s})},getQueue:async()=>(await this.client.get("/api/vod/queue")).data,cancelDownload:async e=>{await this.client.delete(`/api/vod/queue/${e}`)}}}const Le=new gL;function pL(){return it({queryKey:["currentUser"],queryFn:()=>Le.getCurrentUser(),enabled:Le.isAuthenticated(),retry:!1})}function yL(){const i=Ct();return Ze({mutationFn:e=>Le.login(e),onSuccess:()=>{i.invalidateQueries({queryKey:["currentUser"]})}})}function xL(){return Ze({mutationFn:i=>Le.register(i)})}function vL(){const i=Ct();return Ze({mutationFn:()=>Le.logout(),onSuccess:()=>{i.clear()}})}const _L=[{name:"Dashboard",href:"/ui",icon:yR},{name:"Users",href:"/ui/users",icon:hg},{name:"Libraries",href:"/ui/libraries",icon:yr},{name:"Media",href:"/ui/media",icon:Ki},{name:"Live TV",href:"/ui/livetv",icon:Qs},{name:"TV Guide",href:"/ui/tvguide",icon:CN},{name:"On Later",href:"/ui/onlater",icon:Li},{name:"Team Pass",href:"/ui/teampass",icon:Da},{name:"DVR",href:"/ui/dvr",icon:Ao},{name:"VOD",href:"/ui/vod",icon:qN},{name:"Transcode",href:"/ui/transcode",icon:jl},{name:"Logs",href:"/ui/logs",icon:Xn},{name:"Downloads",href:"/ui/downloads",icon:Ri},{name:"Settings",href:"/ui/settings",icon:ug}];function bL(){const i=Jn(),e=Wl(),{data:t}=pL(),s=vL(),[a,l]=K.useState(!1),c=async()=>{await s.mutateAsync(),e("/ui/login")};return r.jsxs("div",{className:"min-h-screen bg-gray-900",children:[a&&r.jsx("div",{className:"fixed inset-0 z-40 bg-black/50 lg:hidden",onClick:()=>l(!1)}),r.jsxs("aside",{className:`fixed inset-y-0 left-0 z-50 w-64 transform bg-gray-800 transition-transform duration-200 ease-in-out lg:translate-x-0 ${a?"translate-x-0":"-translate-x-full"}`,children:[r.jsxs("div",{className:"flex h-16 items-center justify-between px-6 border-b border-gray-700",children:[r.jsx("span",{className:"text-xl font-bold text-white",children:"OpenFlix"}),r.jsx("button",{className:"lg:hidden text-gray-400 hover:text-white",onClick:()=>l(!1),children:r.jsx(jt,{className:"h-6 w-6"})})]}),r.jsx("nav",{className:"mt-6 px-3",children:_L.map(u=>{const f=i.pathname===u.href;return r.jsxs(eg,{to:u.href,onClick:()=>l(!1),className:`flex items-center gap-3 px-3 py-2 mb-1 rounded-lg text-sm font-medium transition-colors ${f?"bg-indigo-600 text-white":"text-gray-300 hover:bg-gray-700 hover:text-white"}`,children:[r.jsx(u.icon,{className:"h-5 w-5"}),u.name]},u.name)})}),r.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4 border-t border-gray-700",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[r.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-600 flex items-center justify-center text-white font-medium",children:t?.username?.charAt(0).toUpperCase()||"U"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm font-medium text-white truncate",children:t?.title||t?.username}),r.jsx("p",{className:"text-xs text-gray-400",children:t?.admin?"Administrator":"User"})]})]}),r.jsxs("button",{onClick:c,className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors",children:[r.jsx(SR,{className:"h-4 w-4"}),"Sign out"]})]})]}),r.jsxs("div",{className:"lg:pl-64",children:[r.jsxs("header",{className:"sticky top-0 z-30 flex h-16 items-center gap-4 border-b border-gray-700 bg-gray-800 px-4 lg:hidden",children:[r.jsx("button",{className:"text-gray-400 hover:text-white",onClick:()=>l(!0),children:r.jsx(NR,{className:"h-6 w-6"})}),r.jsx("span",{className:"text-lg font-semibold text-white",children:"OpenFlix"})]}),r.jsx("main",{className:"p-6",children:r.jsx(JA,{})})]})]})}function SL(){const i=Wl(),e=yL(),t=xL(),[s,a]=K.useState(!1),[l,c]=K.useState(""),[u,f]=K.useState(""),[d,m]=K.useState(""),[g,y]=K.useState(""),[x,v]=K.useState(""),[E,A]=K.useState(""),R=async L=>{if(L.preventDefault(),v(""),A(""),s){if(d!==g){v("Passwords do not match");return}if(d.length<6){v("Password must be at least 6 characters");return}try{await t.mutateAsync({username:l,email:u,password:d}),A("Account created! You can now sign in."),a(!1),m(""),y(""),f("")}catch(O){v(O.response?.data?.error||"Failed to create account")}}else try{if(!(await e.mutateAsync({username:l,password:d})).user.admin){v("Admin access required");return}i("/ui")}catch{v("Invalid username or password")}},D=()=>{a(!s),v(""),A(""),m(""),y("")};return r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 px-4",children:r.jsxs("div",{className:"w-full max-w-md",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-indigo-600 mb-4",children:r.jsx(Qs,{className:"h-8 w-8 text-white"})}),r.jsx("h1",{className:"text-2xl font-bold text-white",children:"OpenFlix Admin"}),r.jsx("p",{className:"text-gray-400 mt-2",children:s?"Create your admin account":"Sign in to manage your server"})]}),r.jsxs("form",{onSubmit:R,className:"bg-gray-800 rounded-xl p-6 shadow-xl",children:[x&&r.jsx("div",{className:"mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20 text-red-400 text-sm",children:x}),E&&r.jsx("div",{className:"mb-4 p-3 rounded-lg bg-green-500/10 border border-green-500/20 text-green-400 text-sm",children:E}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-300 mb-2",children:"Username"}),r.jsx("input",{id:"username",type:"text",value:l,onChange:L=>c(L.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Enter your username",required:!0})]}),s&&r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300 mb-2",children:"Email"}),r.jsx("input",{id:"email",type:"email",value:u,onChange:L=>f(L.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Enter your email",required:!0})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300 mb-2",children:"Password"}),r.jsx("input",{id:"password",type:"password",value:d,onChange:L=>m(L.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Enter your password",required:!0})]}),s&&r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-300 mb-2",children:"Confirm Password"}),r.jsx("input",{id:"confirmPassword",type:"password",value:g,onChange:L=>y(L.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Confirm your password",required:!0})]}),r.jsx("button",{type:"submit",disabled:e.isPending||t.isPending,className:"w-full py-2 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors mb-4",children:e.isPending||t.isPending?s?"Creating account...":"Signing in...":s?"Create Account":"Sign in"}),r.jsx("div",{className:"text-center",children:r.jsx("button",{type:"button",onClick:D,className:"text-indigo-400 hover:text-indigo-300 text-sm transition-colors",children:s?"Already have an account? Sign in":"Don't have an account? Sign up"})})]})]})})}function eS(){return it({queryKey:["libraries"],queryFn:()=>Le.getLibraries()})}function EL(i){return it({queryKey:["library-stats",i],queryFn:()=>Le.getLibraryStats(i)})}function TL(){const i=Ct();return Ze({mutationFn:e=>Le.createLibrary(e),onSuccess:()=>{i.invalidateQueries({queryKey:["libraries"]})}})}function AL(){const i=Ct();return Ze({mutationFn:({id:e,data:t})=>Le.updateLibrary(e,t),onSuccess:()=>{i.invalidateQueries({queryKey:["libraries"]})}})}function wL(){const i=Ct();return Ze({mutationFn:e=>Le.deleteLibrary(e),onSuccess:()=>{i.invalidateQueries({queryKey:["libraries"]})}})}function NL(){const i=Ct();return Ze({mutationFn:e=>Le.scanLibrary(e),onSuccess:()=>{i.invalidateQueries({queryKey:["library-stats"]})}})}function RL(){const i=Ct();return Ze({mutationFn:({libraryId:e,path:t})=>Le.addLibraryPath(e,t),onSuccess:()=>{i.invalidateQueries({queryKey:["libraries"]})}})}function CL(){const i=Ct();return Ze({mutationFn:({libraryId:e,pathId:t})=>Le.removeLibraryPath(e,t),onSuccess:()=>{i.invalidateQueries({queryKey:["libraries"]})}})}function tS(){return it({queryKey:["m3uSources"],queryFn:()=>Le.getM3USources()})}function LL(){const i=Ct();return Ze({mutationFn:e=>Le.createM3USource(e),onSuccess:()=>{i.invalidateQueries({queryKey:["m3uSources"]})}})}function DL(){const i=Ct();return Ze({mutationFn:e=>Le.deleteM3USource(e),onSuccess:()=>{i.invalidateQueries({queryKey:["m3uSources"]})}})}function IL(){const i=Ct();return Ze({mutationFn:e=>Le.refreshM3USource(e),onSuccess:()=>{i.invalidateQueries({queryKey:["m3uSources"]})}})}function kL(){return it({queryKey:["epgSources"],queryFn:()=>Le.getEPGSources()})}function ML(){const i=Ct();return Ze({mutationFn:e=>Le.createEPGSource(e),onSuccess:()=>{i.invalidateQueries({queryKey:["epgSources"]})}})}function jL(){const i=Ct();return Ze({mutationFn:e=>Le.deleteEPGSource(e),onSuccess:()=>{i.invalidateQueries({queryKey:["epgSources"]})}})}function OL(){return Ze({mutationFn:()=>Le.refreshEPG()})}function sS(){return it({queryKey:["recordings"],queryFn:()=>Le.getRecordings()})}function PL(){const i=Ct();return Ze({mutationFn:e=>Le.deleteRecording(e),onSuccess:()=>{i.invalidateQueries({queryKey:["recordings"]})}})}function BL(){return it({queryKey:["seriesRules"],queryFn:()=>Le.getSeriesRules()})}function UL(){const i=Ct();return Ze({mutationFn:e=>Le.createSeriesRule(e),onSuccess:()=>{i.invalidateQueries({queryKey:["seriesRules"]})}})}function FL(){const i=Ct();return Ze({mutationFn:e=>Le.deleteSeriesRule(e),onSuccess:()=>{i.invalidateQueries({queryKey:["seriesRules"]})}})}function GL(){return it({queryKey:["recordingConflicts"],queryFn:()=>Le.getRecordingConflicts(),refetchInterval:6e4})}function $L(){const i=Ct();return Ze({mutationFn:({keepId:e,cancelId:t})=>Le.resolveConflict(e,t),onSuccess:()=>{i.invalidateQueries({queryKey:["recordings"]}),i.invalidateQueries({queryKey:["recordingConflicts"]})}})}function VL(){return it({queryKey:["recordingStats"],queryFn:()=>Le.getRecordingStats(),refetchInterval:5e3})}function HL(){return it({queryKey:["serverStatus"],queryFn:()=>Le.getServerStatus(),refetchInterval:1e4})}function gu({title:i,value:e,icon:t,color:s,subtitle:a}){return r.jsx("div",{className:"bg-gray-800 rounded-xl p-6",children:r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:`p-3 rounded-lg ${s}`,children:r.jsx(t,{className:"h-6 w-6 text-white"})}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-400",children:i}),r.jsx("p",{className:"text-2xl font-bold text-white",children:e}),a&&r.jsx("p",{className:"text-xs text-gray-500",children:a})]})]})})}function KL(){const{data:i}=HL(),{data:e}=eS(),{data:t}=tS(),{data:s}=sS(),a=t?.reduce((u,f)=>u+(f.channelCount||0),0)||0,l=s?.filter(u=>u.status==="scheduled").length||0,c=s?.filter(u=>u.status==="completed").length||0;return r.jsxs("div",{children:[r.jsxs("div",{className:"mb-8",children:[r.jsx("h1",{className:"text-2xl font-bold text-white",children:"Dashboard"}),r.jsx("p",{className:"text-gray-400 mt-1",children:"Overview of your OpenFlix server"})]}),i&&r.jsxs("div",{className:"bg-gray-800 rounded-xl p-4 mb-6 flex flex-wrap items-center gap-6 text-sm",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(JR,{className:"h-4 w-4 text-green-400"}),r.jsxs("span",{className:"text-gray-300",children:[i.server.name," v",i.server.version]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Li,{className:"h-4 w-4 text-blue-400"}),r.jsxs("span",{className:"text-gray-300",children:["Uptime: ",i.server.uptime]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(hg,{className:"h-4 w-4 text-purple-400"}),r.jsxs("span",{className:"text-gray-300",children:[i.sessions.active," active session",i.sessions.active!==1?"s":""]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(jl,{className:"h-4 w-4 text-orange-400"}),r.jsxs("span",{className:"text-gray-300",children:[i.system.memAllocMB," MB"]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Xn,{className:"h-4 w-4 text-yellow-400"}),r.jsxs("span",{className:"text-gray-300",children:["Log: ",i.logging.level]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[r.jsx(gu,{title:"Libraries",value:i?.libraries.count||e?.length||0,icon:yr,color:"bg-blue-600",subtitle:i?`${i.libraries.movies} movies, ${i.libraries.shows} shows`:void 0}),r.jsx(gu,{title:"Live TV Channels",value:i?.livetv.channels||a,icon:Qs,color:"bg-green-600",subtitle:i?.livetv.timeshiftEnabled?`${i.livetv.timeshiftChannels} buffering`:void 0}),r.jsx(gu,{title:"Scheduled Recordings",value:i?.dvr.scheduled||l,icon:Ao,color:"bg-orange-600",subtitle:i?.dvr.recording?`${i.dvr.recording} recording now`:void 0}),r.jsx(gu,{title:"Completed Recordings",value:i?.dvr.completed||c,icon:xr,color:"bg-purple-600",subtitle:i?.dvr.commercialDetect?"Commercial detect enabled":void 0})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[r.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[r.jsx(yr,{className:"h-5 w-5"}),"Libraries"]}),e?.length?r.jsx("div",{className:"space-y-3",children:e.map(u=>r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-700/50 rounded-lg",children:[r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-white",children:u.title}),r.jsx("p",{className:"text-sm text-gray-400 capitalize",children:u.type})]}),r.jsxs("span",{className:"text-xs text-gray-500",children:[u.paths?.length||0," paths"]})]},u.id))}):r.jsx("p",{className:"text-gray-400 text-sm",children:"No libraries configured"})]}),r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[r.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[r.jsx(Qs,{className:"h-5 w-5"}),"Live TV Sources"]}),t?.length?r.jsx("div",{className:"space-y-3",children:t.map(u=>r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-700/50 rounded-lg",children:[r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-white",children:u.name}),r.jsxs("p",{className:"text-sm text-gray-400",children:[u.channelCount," channels"]})]}),r.jsx("span",{className:"text-xs text-gray-500",children:u.lastRefresh?new Date(u.lastRefresh).toLocaleDateString():"Never refreshed"})]},u.id))}):r.jsx("p",{className:"text-gray-400 text-sm",children:"No M3U sources configured"})]}),r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 lg:col-span-2",children:[r.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[r.jsx(xb,{className:"h-5 w-5"}),"Upcoming Recordings"]}),s?.filter(u=>u.status==="scheduled").length?r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"text-left text-sm text-gray-400 border-b border-gray-700",children:[r.jsx("th",{className:"pb-3 font-medium",children:"Title"}),r.jsx("th",{className:"pb-3 font-medium",children:"Channel"}),r.jsx("th",{className:"pb-3 font-medium",children:"Start Time"}),r.jsx("th",{className:"pb-3 font-medium",children:"Duration"})]})}),r.jsx("tbody",{className:"text-sm",children:s.filter(u=>u.status==="scheduled").slice(0,5).map(u=>r.jsxs("tr",{className:"border-b border-gray-700/50",children:[r.jsx("td",{className:"py-3 text-white",children:u.title}),r.jsx("td",{className:"py-3 text-gray-300",children:u.channelName}),r.jsx("td",{className:"py-3 text-gray-300",children:new Date(u.startTime).toLocaleString()}),r.jsxs("td",{className:"py-3 text-gray-300",children:[u.duration," min"]})]},u.id))})]})}):r.jsx("p",{className:"text-gray-400 text-sm",children:"No upcoming recordings"})]})]})]})}function zL(){return it({queryKey:["users"],queryFn:()=>Le.getUsers()})}function qL({onClose:i}){const e=Ct(),[t,s]=K.useState(""),[a,l]=K.useState(""),[c,u]=K.useState(""),[f,d]=K.useState(!1),[m,g]=K.useState(""),y=Ze({mutationFn:v=>Le.createUser(v),onSuccess:()=>{e.invalidateQueries({queryKey:["users"]}),i()},onError:v=>{g(v.response?.data?.error||"Failed to create user")}}),x=async v=>{v.preventDefault(),g(""),y.mutate({username:t,email:a,password:c,isAdmin:f})};return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[r.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Create User"}),r.jsxs("form",{onSubmit:x,children:[m&&r.jsx("div",{className:"mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20 text-red-400 text-sm",children:m}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Username"}),r.jsx("input",{type:"text",value:t,onChange:v=>s(v.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email"}),r.jsx("input",{type:"email",value:a,onChange:v=>l(v.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Password"}),r.jsx("input",{type:"password",value:c,onChange:v=>u(v.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0,minLength:6})]}),r.jsx("div",{className:"mb-6",children:r.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300",children:[r.jsx("input",{type:"checkbox",checked:f,onChange:v=>d(v.target.checked),className:"rounded bg-gray-700 border-gray-600"}),"Administrator"]})}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{type:"button",onClick:i,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:y.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:y.isPending?"Creating...":"Create"})]})]})]})})}function YL(){const{data:i,isLoading:e}=zL(),t=Ct(),[s,a]=K.useState(!1),l=Ze({mutationFn:u=>Le.deleteUser(u),onSuccess:()=>{t.invalidateQueries({queryKey:["users"]})}}),c=async u=>{confirm(`Are you sure you want to delete ${u.username}?`)&&l.mutate(u.id)};return r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-8",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-white",children:"Users"}),r.jsx("p",{className:"text-gray-400 mt-1",children:"Manage server users"})]}),r.jsxs("button",{onClick:()=>a(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[r.jsx(Hi,{className:"h-4 w-4"}),"Add User"]})]}),e?r.jsx("div",{className:"text-gray-400",children:"Loading..."}):i?.length?r.jsx("div",{className:"bg-gray-800 rounded-xl divide-y divide-gray-700",children:i.map(u=>r.jsxs("div",{className:"p-4 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"h-10 w-10 rounded-full bg-indigo-600 flex items-center justify-center text-white font-medium",children:u.username.charAt(0).toUpperCase()}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("h3",{className:"font-medium text-white",children:u.title||u.username}),u.admin&&r.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-indigo-500/20 text-indigo-400 text-xs rounded-full",children:[r.jsx(r2,{className:"h-3 w-3"}),"Admin"]}),u.restricted&&r.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-orange-500/20 text-orange-400 text-xs rounded-full",children:[r.jsx(n2,{className:"h-3 w-3"}),"Restricted"]})]}),r.jsx("p",{className:"text-sm text-gray-400",children:u.email})]})]}),r.jsx("button",{onClick:()=>c(u),disabled:u.admin,className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",title:u.admin?"Can't delete admin":"Delete user",children:r.jsx(an,{className:"h-4 w-4"})})]},u.id))}):r.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[r.jsx(hg,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No users"}),r.jsx("p",{className:"text-gray-400 mb-4",children:"Add users to allow access to your server"}),r.jsxs("button",{onClick:()=>a(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[r.jsx(Hi,{className:"h-4 w-4"}),"Add User"]})]}),s&&r.jsx(qL,{onClose:()=>a(!1)})]})}function iS({onSelect:i,onCancel:e,initialPath:t}){const[s,a]=K.useState(t||""),[l,c]=K.useState(),[u,f]=K.useState([]),[d,m]=K.useState(!0),[g,y]=K.useState(null),[x,v]=K.useState(t||"");K.useEffect(()=>{E(s||void 0)},[s]);const E=async H=>{m(!0),y(null);try{const q=await Le.browseFilesystem(H);f(q.entries),c(q.parentPath),v(q.path)}catch(q){y("Failed to load directory"),console.error(q)}finally{m(!1)}},A=H=>{a(H)},R=()=>{l!==void 0&&a(l)},D=()=>{i(x||s)},L=H=>{H.preventDefault(),a(x)},O=H=>{if(!H)return"";const q=["B","KB","MB","GB","TB"];let U=0,k=H;for(;k>=1024&&U<q.length-1;)k/=1024,U++;return`${k.toFixed(1)} ${q[U]}`};return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:r.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[r.jsxs("div",{className:"p-4 border-b border-gray-700",children:[r.jsx("h2",{className:"text-lg font-semibold text-white mb-3",children:"Select Directory"}),r.jsxs("form",{onSubmit:L,className:"flex gap-2",children:[r.jsx("input",{type:"text",value:x,onChange:H=>v(H.target.value),className:"flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm font-mono",placeholder:"/path/to/media"}),r.jsx("button",{type:"submit",className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:"Go"})]})]}),r.jsxs("div",{className:"px-4 py-2 border-b border-gray-700 flex items-center gap-2",children:[r.jsx("button",{onClick:R,disabled:!l&&l!=="",className:"p-1.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Go up",children:r.jsx(ag,{className:"h-4 w-4"})}),r.jsx("span",{className:"text-sm text-gray-400 truncate",children:s||"Select a location"})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:d?r.jsx("div",{className:"flex items-center justify-center py-12",children:r.jsx(Yn,{className:"h-6 w-6 text-indigo-400 animate-spin"})}):g?r.jsxs("div",{className:"text-center py-12",children:[r.jsx("p",{className:"text-red-400",children:g}),r.jsx("button",{onClick:()=>E(s||void 0),className:"mt-2 text-sm text-indigo-400 hover:text-indigo-300",children:"Retry"})]}):u.length===0?r.jsx("div",{className:"text-center py-12 text-gray-500",children:"Empty directory"}):r.jsx("div",{className:"space-y-0.5",children:u.map(H=>r.jsxs("button",{onClick:()=>H.isDir&&A(H.path),disabled:!H.isDir,className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-colors ${H.isDir?"hover:bg-gray-700 cursor-pointer":"opacity-50 cursor-not-allowed"}`,children:[H.isDir?H.name==="Home"?r.jsx(hR,{className:"h-4 w-4 text-blue-400 flex-shrink-0"}):H.name==="Root"||H.path.match(/^[A-Z]:[\\/]?$/)?r.jsx(xr,{className:"h-4 w-4 text-gray-400 flex-shrink-0"}):r.jsx(aR,{className:"h-4 w-4 text-yellow-400 flex-shrink-0"}):r.jsx(eR,{className:"h-4 w-4 text-gray-500 flex-shrink-0"}),r.jsx("span",{className:"flex-1 text-sm text-white truncate",children:H.name}),!H.isDir&&H.size&&r.jsx("span",{className:"text-xs text-gray-500",children:O(H.size)}),H.isDir&&r.jsx(md,{className:"h-4 w-4 text-gray-600 flex-shrink-0"})]},H.path))})}),r.jsxs("div",{className:"p-4 border-t border-gray-700 flex gap-3",children:[r.jsx("button",{onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),r.jsx("button",{onClick:D,disabled:!x,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg",children:"Select This Directory"})]})]})})}const WL={movie:Ki,show:Qs,music:kR,photo:mR};function XL(i){if(i===0)return"0 B";const e=1024,t=["B","KB","MB","GB","TB"],s=Math.floor(Math.log(i)/Math.log(e));return`${parseFloat((i/Math.pow(e,s)).toFixed(1))} ${t[s]}`}function QL(i){const e=Math.floor(i/36e5),t=Math.floor(i%36e5/6e4);return e>0?`${e}h ${t}m`:`${t}m`}function ZL({libraryId:i,type:e}){const{data:t,isLoading:s}=EL(i);if(s||!t)return r.jsx("div",{className:"mt-4 pt-4 border-t border-gray-700",children:r.jsx("div",{className:"text-sm text-gray-500",children:"Loading stats..."})});const a=e==="movie"?t.movieCount:e==="show"?t.showCount:t.movieCount+t.showCount,l=t.fileCount===0,c=a>0&&l;return r.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[c&&r.jsxs("div",{className:"mb-4 flex items-start gap-2 px-4 py-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg",children:[r.jsx(Ns,{className:"h-5 w-5 text-yellow-500 flex-shrink-0 mt-0.5"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-yellow-500",children:"Library needs scanning"}),r.jsx("p",{className:"text-xs text-yellow-500/80 mt-1",children:'Media items exist but no files are indexed. Click "Scan" to index media files.'})]})]}),l&&a===0&&r.jsxs("div",{className:"mb-4 flex items-start gap-2 px-4 py-3 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:[r.jsx(Ns,{className:"h-5 w-5 text-blue-500 flex-shrink-0 mt-0.5"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-blue-500",children:"Library is empty"}),r.jsx("p",{className:"text-xs text-blue-500/80 mt-1",children:'Add media files to your library paths and click "Scan" to index them.'})]})]}),r.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(QN,{className:"h-4 w-4 text-gray-500"}),r.jsxs("div",{children:[r.jsx("div",{className:"text-sm font-medium text-white",children:e==="movie"?t.movieCount:e==="show"?t.showCount:a}),r.jsx("div",{className:"text-xs text-gray-500",children:e==="movie"?"Movies":e==="show"?"Shows":"Items"})]})]}),e==="show"&&t.episodeCount>0&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ki,{className:"h-4 w-4 text-gray-500"}),r.jsxs("div",{children:[r.jsx("div",{className:"text-sm font-medium text-white",children:t.episodeCount}),r.jsx("div",{className:"text-xs text-gray-500",children:"Episodes"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(xr,{className:"h-4 w-4 text-gray-500"}),r.jsxs("div",{children:[r.jsx("div",{className:"text-sm font-medium text-white",children:XL(t.totalSize)}),r.jsx("div",{className:"text-xs text-gray-500",children:"Total Size"})]})]}),t.totalDuration>0&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Li,{className:"h-4 w-4 text-gray-500"}),r.jsxs("div",{children:[r.jsx("div",{className:"text-sm font-medium text-white",children:QL(t.totalDuration)}),r.jsx("div",{className:"text-xs text-gray-500",children:"Duration"})]})]})]})]})}function JL({onClose:i}){const e=TL(),[t,s]=K.useState(""),[a,l]=K.useState("movie"),[c,u]=K.useState([]),[f,d]=K.useState(!1),m=async x=>{x.preventDefault(),c.length!==0&&(await e.mutateAsync({title:t,type:a,paths:c}),i())},g=x=>{c.includes(x)||u([...c,x]),d(!1)},y=x=>{u(c.filter(v=>v!==x))};return f?r.jsx(iS,{onSelect:g,onCancel:()=>d(!1)}):r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[r.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Create Library"}),r.jsxs("form",{onSubmit:m,children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),r.jsx("input",{type:"text",value:t,onChange:x=>s(x.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"My Movies",required:!0})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Type"}),r.jsxs("select",{value:a,onChange:x=>l(x.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:[r.jsx("option",{value:"movie",children:"Movies"}),r.jsx("option",{value:"show",children:"TV Shows"}),r.jsx("option",{value:"music",children:"Music"}),r.jsx("option",{value:"photo",children:"Photos"})]})]}),r.jsxs("div",{className:"mb-6",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Paths"}),r.jsx("div",{className:"space-y-2 mb-2",children:c.map(x=>r.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-700/50 rounded-lg",children:[r.jsx(yr,{className:"h-4 w-4 text-yellow-400 flex-shrink-0"}),r.jsx("code",{className:"flex-1 text-sm text-gray-300 truncate",children:x}),r.jsx("button",{type:"button",onClick:()=>y(x),className:"p-1 text-gray-400 hover:text-red-400",children:r.jsx(jt,{className:"h-4 w-4"})})]},x))}),r.jsxs("button",{type:"button",onClick:()=>d(!0),className:"w-full flex items-center justify-center gap-2 px-4 py-2 border-2 border-dashed border-gray-600 hover:border-gray-500 rounded-lg text-gray-400 hover:text-gray-300",children:[r.jsx(bb,{className:"h-4 w-4"}),"Browse for folder"]})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{type:"button",onClick:i,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:e.isPending||c.length===0,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg",children:e.isPending?"Creating...":"Create"})]})]})]})})}function eD({library:i,onClose:e}){const t=AL(),s=RL(),a=CL(),[l,c]=K.useState(i.title),[u,f]=K.useState(!1),d=async y=>{y.preventDefault(),l!==i.title&&await t.mutateAsync({id:i.id,data:{title:l}}),e()},m=async y=>{await s.mutateAsync({libraryId:i.id,path:y}),f(!1)},g=async y=>{if(i.paths.length<=1){alert("Library must have at least one path");return}await a.mutateAsync({libraryId:i.id,pathId:y})};return u?r.jsx(iS,{onSelect:m,onCancel:()=>f(!1)}):r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[r.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Edit Library"}),r.jsxs("form",{onSubmit:d,children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),r.jsx("input",{type:"text",value:l,onChange:y=>c(y.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Type"}),r.jsxs("div",{className:"px-4 py-2 bg-gray-700/50 border border-gray-600 rounded-lg text-gray-400 capitalize",children:[i.type,r.jsx("span",{className:"text-xs ml-2",children:"(cannot be changed)"})]})]}),r.jsxs("div",{className:"mb-6",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Paths"}),r.jsx("div",{className:"space-y-2 mb-2",children:i.paths.map(y=>r.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-700/50 rounded-lg",children:[r.jsx(yr,{className:"h-4 w-4 text-yellow-400 flex-shrink-0"}),r.jsx("code",{className:"flex-1 text-sm text-gray-300 truncate",children:y.path}),r.jsx("button",{type:"button",onClick:()=>g(y.id),disabled:a.isPending||i.paths.length<=1,className:"p-1 text-gray-400 hover:text-red-400 disabled:opacity-50",children:r.jsx(jt,{className:"h-4 w-4"})})]},y.id))}),r.jsxs("button",{type:"button",onClick:()=>f(!0),className:"w-full flex items-center justify-center gap-2 px-4 py-2 border-2 border-dashed border-gray-600 hover:border-gray-500 rounded-lg text-gray-400 hover:text-gray-300",children:[r.jsx(bb,{className:"h-4 w-4"}),"Add another folder"]})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:t.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:t.isPending?"Saving...":"Save"})]})]})]})})}function tD({library:i}){const e=wL(),t=NL(),[s,a]=K.useState(!1),[l,c]=K.useState(!1),u=WL[i.type]||yr,f=async()=>{confirm("Are you sure you want to delete this library? This will remove all associated metadata.")&&await e.mutateAsync(i.id)},d=async()=>{await t.mutateAsync(i.id)};return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"p-3 bg-gray-700 rounded-lg",children:r.jsx(u,{className:"h-6 w-6 text-indigo-400"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-white",children:i.title}),r.jsx("p",{className:"text-sm text-gray-400 capitalize",children:i.type})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>c(!0),className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:"Edit Library",children:r.jsx(PR,{className:"h-4 w-4"})}),r.jsx("button",{onClick:d,disabled:t.isPending,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:"Scan Library",children:r.jsx(vs,{className:`h-4 w-4 ${t.isPending?"animate-spin":""}`})}),r.jsx("button",{onClick:f,disabled:e.isPending,className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg",title:"Delete Library",children:r.jsx(an,{className:"h-4 w-4"})}),r.jsx("button",{onClick:()=>a(!s),className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:s?"Collapse":"Expand",children:s?r.jsx(ag,{className:"h-4 w-4"}):r.jsx(fd,{className:"h-4 w-4"})})]})]}),r.jsx(ZL,{libraryId:i.id,type:i.type}),s&&r.jsxs(r.Fragment,{children:[i.paths?.length>0&&r.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[r.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Paths:"}),r.jsx("div",{className:"space-y-1",children:i.paths.map(m=>r.jsx("code",{className:"block text-sm text-gray-300 bg-gray-700/50 px-3 py-1 rounded",children:m.path},m.id))})]}),i.scannedAt&&r.jsxs("p",{className:"mt-4 text-xs text-gray-500",children:["Last scanned: ",new Date(i.scannedAt).toLocaleString()]})]})]}),l&&r.jsx(eD,{library:i,onClose:()=>c(!1)})]})}function sD(){const{data:i,isLoading:e}=eS(),[t,s]=K.useState(!1);return r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-8",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-white",children:"Libraries"}),r.jsx("p",{className:"text-gray-400 mt-1",children:"Manage your media libraries"})]}),r.jsxs("button",{onClick:()=>s(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[r.jsx(Hi,{className:"h-4 w-4"}),"Add Library"]})]}),e?r.jsx("div",{className:"text-gray-400",children:"Loading..."}):i?.length?r.jsx("div",{className:"grid gap-4",children:i.map(a=>r.jsx(tD,{library:a},a.id))}):r.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[r.jsx(yr,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No libraries"}),r.jsx("p",{className:"text-gray-400 mb-4",children:"Get started by adding a media library"}),r.jsxs("button",{onClick:()=>s(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[r.jsx(Hi,{className:"h-4 w-4"}),"Add Library"]})]}),t&&r.jsx(JL,{onClose:()=>s(!1)})]})}function iD(){const i=Ct(),[e,t]=K.useState(""),[s,a]=K.useState(""),[l,c]=K.useState(""),[u,f]=K.useState(1),[d,m]=K.useState(null),[g,y]=K.useState(null),[x,v]=K.useState(null),[E,A]=K.useState(""),{data:R}=it({queryKey:["admin-libraries"],queryFn:()=>Le.getLibraries()}),{data:D,isLoading:L}=it({queryKey:["admin-media",e,s,l,u],queryFn:()=>Le.getAdminMedia({search:e,type:s,libraryId:l||void 0,page:u})}),{data:O,isLoading:H}=it({queryKey:["tmdb-search",x?.id,E],queryFn:()=>Le.searchTMDB(E,x?.type==="show"?"tv":"movie"),enabled:!!x&&E.length>2}),q=Ze({mutationFn:j=>Le.refreshMediaMetadata(j),onSuccess:()=>{i.invalidateQueries({queryKey:["admin-media"]})}}),U=Ze({mutationFn:({id:j,data:Z})=>Le.updateMediaMetadata(j,Z),onSuccess:()=>{i.invalidateQueries({queryKey:["admin-media"]}),y(null)}}),k=Ze({mutationFn:({id:j,tmdbId:Z,mediaType:ae})=>Le.applyMediaMatch(j,Z,ae),onSuccess:()=>{i.invalidateQueries({queryKey:["admin-media"]}),v(null),A("")}}),M=()=>{g&&U.mutate({id:g.id,data:{title:g.title,sort_title:g.sort_title,year:g.year,summary:g.summary,studio:g.studio,content_rating:g.content_rating}})},I=j=>{switch(j.toLowerCase()){case"movie":return r.jsx(Ki,{className:"h-4 w-4"});case"show":return r.jsx(Qs,{className:"h-4 w-4"});default:return r.jsx(Ki,{className:"h-4 w-4"})}};return r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-white",children:"Media"}),r.jsx("p",{className:"text-gray-400",children:"Manage your media library metadata"})]})}),r.jsxs("div",{className:"flex flex-wrap gap-4",children:[r.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[r.jsx(Xs,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Search media...",value:e,onChange:j=>{t(j.target.value),f(1)},className:"w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),r.jsxs("select",{value:s,onChange:j=>{a(j.target.value),f(1)},className:"px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[r.jsx("option",{value:"",children:"All Types"}),r.jsx("option",{value:"movie",children:"Movies"}),r.jsx("option",{value:"show",children:"TV Shows"})]}),r.jsxs("select",{value:l,onChange:j=>{c(j.target.value?Number(j.target.value):""),f(1)},className:"px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[r.jsx("option",{value:"",children:"All Libraries"}),R?.map(j=>r.jsx("option",{value:j.id,children:j.title},j.id))]})]}),r.jsxs("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:[L?r.jsx("div",{className:"p-8 text-center text-gray-400",children:"Loading..."}):D?.items?.length?r.jsx("div",{className:"divide-y divide-gray-700",children:D.items.map(j=>r.jsxs("div",{className:"p-4",children:[r.jsxs("div",{className:"flex items-center gap-4 cursor-pointer",onClick:()=>m(d===j.id?null:j.id),children:[r.jsx("div",{className:"w-16 h-24 bg-gray-700 rounded overflow-hidden flex-shrink-0",children:j.thumb?r.jsx("img",{src:j.thumb,alt:j.title,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full flex items-center justify-center",children:I(j.type)})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[I(j.type),r.jsx("h3",{className:"text-white font-medium truncate",children:j.title}),j.year&&r.jsxs("span",{className:"text-gray-400",children:["(",j.year,")"]})]}),r.jsxs("p",{className:"text-sm text-gray-400 truncate",children:[j.library_name,"  Added ",new Date(j.added_at).toLocaleDateString()]}),!j.thumb&&r.jsxs("p",{className:"text-sm text-yellow-500 flex items-center gap-1 mt-1",children:[r.jsx(Ns,{className:"h-3 w-3"}),"Missing metadata"]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:Z=>{Z.stopPropagation(),v(j),A(j.title)},className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded",title:"Fix Match",children:r.jsx(Xs,{className:"h-4 w-4"})}),r.jsx("button",{onClick:Z=>{Z.stopPropagation(),y({...j})},className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded",title:"Edit",children:r.jsx(dr,{className:"h-4 w-4"})}),r.jsx("button",{onClick:Z=>{Z.stopPropagation(),q.mutate(j.id)},disabled:q.isPending,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded disabled:opacity-50",title:"Refresh Metadata",children:r.jsx(vs,{className:`h-4 w-4 ${q.isPending?"animate-spin":""}`})}),d===j.id?r.jsx(ag,{className:"h-5 w-5 text-gray-400"}):r.jsx(fd,{className:"h-5 w-5 text-gray-400"})]})]}),d===j.id&&r.jsxs("div",{className:"mt-4 pl-20 grid grid-cols-2 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-400",children:"Original Title:"}),r.jsx("span",{className:"ml-2 text-white",children:j.original_title||"-"})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-400",children:"Sort Title:"}),r.jsx("span",{className:"ml-2 text-white",children:j.sort_title})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-400",children:"Studio:"}),r.jsx("span",{className:"ml-2 text-white",children:j.studio||"-"})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-400",children:"Rating:"}),r.jsx("span",{className:"ml-2 text-white",children:j.content_rating||"-"})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-400",children:"TMDB ID:"}),r.jsx("span",{className:"ml-2 text-white",children:j.tmdb_id||"Not matched"})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-400",children:"Score:"}),r.jsx("span",{className:"ml-2 text-white",children:j.rating?.toFixed(1)||"-"})]}),j.summary&&r.jsxs("div",{className:"col-span-2",children:[r.jsx("span",{className:"text-gray-400",children:"Summary:"}),r.jsx("p",{className:"mt-1 text-white text-sm",children:j.summary})]})]})]},j.id))}):r.jsx("div",{className:"p-8 text-center text-gray-400",children:"No media found"}),D&&D.total>D.page_size&&r.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-700",children:[r.jsxs("p",{className:"text-sm text-gray-400",children:["Showing ",(u-1)*D.page_size+1," to"," ",Math.min(u*D.page_size,D.total)," of ",D.total]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>f(u-1),disabled:u===1,className:"px-3 py-1 bg-gray-700 text-white rounded disabled:opacity-50",children:"Previous"}),r.jsx("button",{onClick:()=>f(u+1),disabled:u*D.page_size>=D.total,className:"px-3 py-1 bg-gray-700 text-white rounded disabled:opacity-50",children:"Next"})]})]})]}),g&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:r.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-lg",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h2",{className:"text-xl font-bold text-white",children:"Edit Metadata"}),r.jsx("button",{onClick:()=>y(null),className:"text-gray-400 hover:text-white",children:r.jsx(jt,{className:"h-5 w-5"})})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Title"}),r.jsx("input",{type:"text",value:g.title,onChange:j=>y({...g,title:j.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Sort Title"}),r.jsx("input",{type:"text",value:g.sort_title,onChange:j=>y({...g,sort_title:j.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Year"}),r.jsx("input",{type:"number",value:g.year||"",onChange:j=>y({...g,year:Number(j.target.value)||void 0}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Studio"}),r.jsx("input",{type:"text",value:g.studio||"",onChange:j=>y({...g,studio:j.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Content Rating"}),r.jsx("input",{type:"text",value:g.content_rating||"",onChange:j=>y({...g,content_rating:j.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Summary"}),r.jsx("textarea",{value:g.summary||"",onChange:j=>y({...g,summary:j.target.value}),rows:4,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]})]}),r.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[r.jsx("button",{onClick:()=>y(null),className:"px-4 py-2 text-gray-400 hover:text-white",children:"Cancel"}),r.jsx("button",{onClick:M,disabled:U.isPending,className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50",children:U.isPending?"Saving...":"Save"})]})]})}),x&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:r.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-2xl max-h-[80vh] overflow-hidden flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("h2",{className:"text-xl font-bold text-white",children:["Fix Match: ",x.title]}),r.jsx("button",{onClick:()=>{v(null),A("")},className:"text-gray-400 hover:text-white",children:r.jsx(jt,{className:"h-5 w-5"})})]}),r.jsx("div",{className:"mb-4",children:r.jsxs("div",{className:"relative",children:[r.jsx(Xs,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Search TMDB...",value:E,onChange:j=>A(j.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:H?r.jsx("div",{className:"p-8 text-center text-gray-400",children:"Searching..."}):O?.length?r.jsx("div",{className:"space-y-2",children:O.map(j=>r.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-700 rounded hover:bg-gray-600 cursor-pointer",onClick:()=>k.mutate({id:x.id,tmdbId:j.id,mediaType:j.media_type}),children:[r.jsx("div",{className:"w-12 h-18 bg-gray-600 rounded overflow-hidden flex-shrink-0",children:j.poster_path?r.jsx("img",{src:`https://image.tmdb.org/t/p/w92${j.poster_path}`,alt:j.title,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full flex items-center justify-center",children:r.jsx(Ki,{className:"h-4 w-4 text-gray-400"})})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("h4",{className:"text-white font-medium truncate",children:j.title}),r.jsxs("span",{className:"text-gray-400 text-sm",children:["(",(j.release_date||j.first_air_date||"").substring(0,4),")"]})]}),r.jsx("p",{className:"text-sm text-gray-400 line-clamp-2",children:j.overview}),r.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["TMDB ID: ",j.id,"  Rating: ",j.vote_average?.toFixed(1)]})]}),r.jsx(Ys,{className:"h-5 w-5 text-green-500 flex-shrink-0"})]},j.id))}):r.jsx("div",{className:"p-8 text-center text-gray-400",children:E.length>2?"No results found":"Type to search"})})]})})]})}const pu=43200,gv=1440,pv=Symbol.for("constructDateFrom");function vg(i,e){return typeof i=="function"?i(e):i&&typeof i=="object"&&pv in i?i[pv](e):i instanceof Date?new i.constructor(e):new Date(e)}function ka(i,e){return vg(i,i)}let nD={};function aD(){return nD}function yv(i){const e=ka(i),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+i-+t}function _g(i,...e){const t=vg.bind(null,i||e.find(s=>typeof s=="object"));return e.map(t)}function Uu(i,e){const t=+ka(i)-+ka(e);return t<0?-1:t>0?1:t}function rD(i){return vg(i,Date.now())}function oD(i,e,t){const[s,a]=_g(t?.in,i,e),l=s.getFullYear()-a.getFullYear(),c=s.getMonth()-a.getMonth();return l*12+c}function lD(i){return e=>{const s=(i?Math[i]:Math.trunc)(e);return s===0?0:s}}function cD(i,e){return+ka(i)-+ka(e)}function uD(i,e){const t=ka(i);return t.setHours(23,59,59,999),t}function dD(i,e){const t=ka(i),s=t.getMonth();return t.setFullYear(t.getFullYear(),s+1,0),t.setHours(23,59,59,999),t}function hD(i,e){const t=ka(i);return+uD(t)==+dD(t)}function fD(i,e,t){const[s,a,l]=_g(t?.in,i,i,e),c=Uu(a,l),u=Math.abs(oD(a,l));if(u<1)return 0;a.getMonth()===1&&a.getDate()>27&&a.setDate(30),a.setMonth(a.getMonth()-c*u);let f=Uu(a,l)===-c;hD(s)&&u===1&&Uu(s,l)===1&&(f=!1);const d=c*(u-+f);return d===0?0:d}function mD(i,e,t){const s=cD(i,e)/1e3;return lD(t?.roundingMethod)(s)}const gD={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},pD=(i,e,t)=>{let s;const a=gD[i];return typeof a=="string"?s=a:e===1?s=a.one:s=a.other.replace("{{count}}",e.toString()),t?.addSuffix?t.comparison&&t.comparison>0?"in "+s:s+" ago":s};function Pf(i){return(e={})=>{const t=e.width?String(e.width):i.defaultWidth;return i.formats[t]||i.formats[i.defaultWidth]}}const yD={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},xD={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},vD={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},_D={date:Pf({formats:yD,defaultWidth:"full"}),time:Pf({formats:xD,defaultWidth:"full"}),dateTime:Pf({formats:vD,defaultWidth:"full"})},bD={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},SD=(i,e,t,s)=>bD[i];function Dl(i){return(e,t)=>{const s=t?.context?String(t.context):"standalone";let a;if(s==="formatting"&&i.formattingValues){const c=i.defaultFormattingWidth||i.defaultWidth,u=t?.width?String(t.width):c;a=i.formattingValues[u]||i.formattingValues[c]}else{const c=i.defaultWidth,u=t?.width?String(t.width):i.defaultWidth;a=i.values[u]||i.values[c]}const l=i.argumentCallback?i.argumentCallback(e):e;return a[l]}}const ED={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},TD={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},AD={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},wD={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},ND={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},RD={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},CD=(i,e)=>{const t=Number(i),s=t%100;if(s>20||s<10)switch(s%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},LD={ordinalNumber:CD,era:Dl({values:ED,defaultWidth:"wide"}),quarter:Dl({values:TD,defaultWidth:"wide",argumentCallback:i=>i-1}),month:Dl({values:AD,defaultWidth:"wide"}),day:Dl({values:wD,defaultWidth:"wide"}),dayPeriod:Dl({values:ND,defaultWidth:"wide",formattingValues:RD,defaultFormattingWidth:"wide"})};function Il(i){return(e,t={})=>{const s=t.width,a=s&&i.matchPatterns[s]||i.matchPatterns[i.defaultMatchWidth],l=e.match(a);if(!l)return null;const c=l[0],u=s&&i.parsePatterns[s]||i.parsePatterns[i.defaultParseWidth],f=Array.isArray(u)?ID(u,g=>g.test(c)):DD(u,g=>g.test(c));let d;d=i.valueCallback?i.valueCallback(f):f,d=t.valueCallback?t.valueCallback(d):d;const m=e.slice(c.length);return{value:d,rest:m}}}function DD(i,e){for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)&&e(i[t]))return t}function ID(i,e){for(let t=0;t<i.length;t++)if(e(i[t]))return t}function kD(i){return(e,t={})=>{const s=e.match(i.matchPattern);if(!s)return null;const a=s[0],l=e.match(i.parsePattern);if(!l)return null;let c=i.valueCallback?i.valueCallback(l[0]):l[0];c=t.valueCallback?t.valueCallback(c):c;const u=e.slice(a.length);return{value:c,rest:u}}}const MD=/^(\d+)(th|st|nd|rd)?/i,jD=/\d+/i,OD={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},PD={any:[/^b/i,/^(a|c)/i]},BD={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},UD={any:[/1/i,/2/i,/3/i,/4/i]},FD={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},GD={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},$D={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},VD={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},HD={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},KD={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},zD={ordinalNumber:kD({matchPattern:MD,parsePattern:jD,valueCallback:i=>parseInt(i,10)}),era:Il({matchPatterns:OD,defaultMatchWidth:"wide",parsePatterns:PD,defaultParseWidth:"any"}),quarter:Il({matchPatterns:BD,defaultMatchWidth:"wide",parsePatterns:UD,defaultParseWidth:"any",valueCallback:i=>i+1}),month:Il({matchPatterns:FD,defaultMatchWidth:"wide",parsePatterns:GD,defaultParseWidth:"any"}),day:Il({matchPatterns:$D,defaultMatchWidth:"wide",parsePatterns:VD,defaultParseWidth:"any"}),dayPeriod:Il({matchPatterns:HD,defaultMatchWidth:"any",parsePatterns:KD,defaultParseWidth:"any"})},qD={code:"en-US",formatDistance:pD,formatLong:_D,formatRelative:SD,localize:LD,match:zD,options:{weekStartsOn:0,firstWeekContainsDate:1}};function YD(i,e,t){const s=aD(),a=t?.locale??s.locale??qD,l=2520,c=Uu(i,e);if(isNaN(c))throw new RangeError("Invalid time value");const u=Object.assign({},t,{addSuffix:t?.addSuffix,comparison:c}),[f,d]=_g(t?.in,...c>0?[e,i]:[i,e]),m=mD(d,f),g=(yv(d)-yv(f))/1e3,y=Math.round((m-g)/60);let x;if(y<2)return t?.includeSeconds?m<5?a.formatDistance("lessThanXSeconds",5,u):m<10?a.formatDistance("lessThanXSeconds",10,u):m<20?a.formatDistance("lessThanXSeconds",20,u):m<40?a.formatDistance("halfAMinute",0,u):m<60?a.formatDistance("lessThanXMinutes",1,u):a.formatDistance("xMinutes",1,u):y===0?a.formatDistance("lessThanXMinutes",1,u):a.formatDistance("xMinutes",y,u);if(y<45)return a.formatDistance("xMinutes",y,u);if(y<90)return a.formatDistance("aboutXHours",1,u);if(y<gv){const v=Math.round(y/60);return a.formatDistance("aboutXHours",v,u)}else{if(y<l)return a.formatDistance("xDays",1,u);if(y<pu){const v=Math.round(y/gv);return a.formatDistance("xDays",v,u)}else if(y<pu*2)return x=Math.round(y/pu),a.formatDistance("aboutXMonths",x,u)}if(x=fD(d,f),x<12){const v=Math.round(y/pu);return a.formatDistance("xMonths",v,u)}else{const v=x%12,E=Math.trunc(x/12);return v<3?a.formatDistance("aboutXYears",E,u):v<9?a.formatDistance("overXYears",E,u):a.formatDistance("almostXYears",E+1,u)}}function WD(i,e){return YD(i,rD(i),e)}function XD({source:i,onRefresh:e,onDelete:t,onEdit:s,isRefreshing:a}){const l=()=>a?"border-blue-500 bg-blue-500/10":i.lastError?"border-red-500 bg-red-500/5":i.lastFetched?"border-green-500 bg-green-500/5":"border-gray-600 bg-gray-800",c=()=>a?r.jsx(vs,{className:"h-5 w-5 text-blue-400 animate-spin"}):i.lastError?r.jsx(Ns,{className:"h-5 w-5 text-red-400"}):i.lastFetched?r.jsx(Zn,{className:"h-5 w-5 text-green-400"}):r.jsx(Li,{className:"h-5 w-5 text-gray-400"}),u=()=>a?"Refreshing...":i.lastError?"Error":i.lastFetched?"Active":"Never fetched",f=()=>{if(!i.lastFetched)return"Never";try{return WD(new Date(i.lastFetched),{addSuffix:!0})}catch{return"Unknown"}};return r.jsxs("div",{className:`rounded-lg border-2 ${l()} p-4 transition-colors`,children:[r.jsxs("div",{className:"flex items-start justify-between mb-3",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("h3",{className:"font-semibold text-white text-lg",children:i.name}),r.jsx("span",{className:"px-2 py-0.5 bg-indigo-600 text-white text-xs rounded uppercase font-medium",children:i.providerType})]}),r.jsx("p",{className:"text-sm text-gray-400",children:i.providerType==="gracenote"?`${i.gracenoteAffiliate}  ${i.gracenotePostalCode}`:i.url})]}),r.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[c(),r.jsx("span",{className:`text-sm font-medium ${a?"text-blue-400":i.lastError?"text-red-400":i.lastFetched?"text-green-400":"text-gray-400"}`,children:u()})]})]}),r.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[r.jsxs("div",{className:"bg-gray-700/50 rounded p-2",children:[r.jsxs("div",{className:"flex items-center gap-1.5 text-gray-400 mb-1",children:[r.jsx(Qs,{className:"h-3.5 w-3.5"}),r.jsx("span",{className:"text-xs",children:"Channels"})]}),r.jsx("p",{className:"text-lg font-semibold text-white",children:(i.channelCount||0).toLocaleString()})]}),r.jsxs("div",{className:"bg-gray-700/50 rounded p-2",children:[r.jsxs("div",{className:"flex items-center gap-1.5 text-gray-400 mb-1",children:[r.jsx(Xn,{className:"h-3.5 w-3.5"}),r.jsx("span",{className:"text-xs",children:"Programs"})]}),r.jsx("p",{className:"text-lg font-semibold text-white",children:(i.programCount||0).toLocaleString()})]}),r.jsxs("div",{className:"bg-gray-700/50 rounded p-2",children:[r.jsxs("div",{className:"flex items-center gap-1.5 text-gray-400 mb-1",children:[r.jsx(Li,{className:"h-3.5 w-3.5"}),r.jsx("span",{className:"text-xs",children:"Updated"})]}),r.jsx("p",{className:"text-xs font-medium text-white truncate",children:f()})]})]}),i.lastError&&r.jsx("div",{className:"mb-3 p-2 bg-red-900/20 border border-red-800 rounded",children:r.jsx("p",{className:"text-xs text-red-300",children:i.lastError})}),r.jsxs("div",{className:"flex gap-2",children:[s&&r.jsx("button",{onClick:()=>s(i),disabled:a,className:"px-3 py-1.5 bg-gray-600 hover:bg-gray-500 disabled:bg-gray-700 disabled:cursor-not-allowed text-white text-sm rounded flex items-center justify-center gap-1.5",title:"Edit",children:r.jsx(dr,{className:"h-4 w-4"})}),r.jsxs("button",{onClick:()=>e(i.id),disabled:a,className:"flex-1 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white text-sm rounded flex items-center justify-center gap-1.5",children:[r.jsx(vs,{className:`h-4 w-4 ${a?"animate-spin":""}`}),a?"Refreshing...":"Refresh"]}),r.jsx("button",{onClick:()=>t(i.id),disabled:a,className:"px-3 py-1.5 bg-red-600 hover:bg-red-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white text-sm rounded",children:"Delete"})]})]})}function xv({type:i,onClose:e}){const t=LL(),s=ML(),[a,l]=K.useState(""),[c,u]=K.useState(""),[f,d]=K.useState("xmltv"),[m,g]=K.useState(""),[y,x]=K.useState(""),[v,E]=K.useState(6),[A,R]=K.useState(null),[D,L]=K.useState(!1),[O,H]=K.useState(""),[q,U]=K.useState([]),[k,M]=K.useState(null),[I,j]=K.useState(!1),Z=async()=>{if(!y||y.length<5){H("Please enter a valid 5-digit ZIP code");return}j(!0),H(""),U([]),M(null),R(null);try{const se=await Le.discoverProviders(y);U(se.grouped);const oe=se.grouped.find(Y=>Y.type==="Cable");if(oe&&oe.providers.length>0){const Y=oe.providers[0];M(Y),g(Y.headendId),l(Y.name+" - "+Y.location)}}catch(se){H(se.response?.data?.error||se.message||"Failed to discover providers")}finally{j(!1)}},ae=se=>{M(se),g(se.headendId),l(se.name+" - "+se.location),R(null)},ie=async()=>{if(!m){H("Please select a provider first");return}L(!0),H("");try{const se=await Le.previewEPGSource({postalCode:y,affiliate:m,hours:v});R(se)}catch(se){H(se.message||"Failed to preview EPG data"),R(null)}finally{L(!1)}},re=async se=>{if(se.preventDefault(),i==="m3u")await t.mutateAsync({name:a,url:c});else if(f==="xmltv")await s.mutateAsync({name:a,providerType:"xmltv",url:c});else{if(!m){H("Please select a TV provider");return}await s.mutateAsync({name:a,providerType:"gracenote",gracenoteAffiliate:m,gracenotePostalCode:y,gracenoteHours:v})}e()},Q=t.isPending||s.isPending;return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[r.jsxs("h2",{className:"text-lg font-semibold text-white mb-4",children:["Add ",i==="m3u"?"M3U Playlist":"EPG Source"]}),r.jsxs("form",{onSubmit:re,children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),r.jsx("input",{type:"text",value:a,onChange:se=>l(se.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:i==="m3u"?"My IPTV":"TV Guide",required:!0})]}),i==="epg"&&r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Provider"}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{type:"button",onClick:()=>d("xmltv"),className:`flex-1 py-2 px-4 rounded-lg border transition-colors ${f==="xmltv"?"bg-indigo-600 border-indigo-600 text-white":"bg-gray-700 border-gray-600 text-gray-300 hover:border-gray-500"}`,children:"XMLTV"}),r.jsx("button",{type:"button",onClick:()=>d("gracenote"),className:`flex-1 py-2 px-4 rounded-lg border transition-colors ${f==="gracenote"?"bg-indigo-600 border-indigo-600 text-white":"bg-gray-700 border-gray-600 text-gray-300 hover:border-gray-500"}`,children:"Gracenote"})]})]}),i==="m3u"&&r.jsxs("div",{className:"mb-6",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"URL"}),r.jsx("input",{type:"url",value:c,onChange:se=>u(se.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://example.com/playlist.m3u",required:!0})]}),i==="epg"&&f==="xmltv"&&r.jsxs("div",{className:"mb-6",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"XMLTV URL"}),r.jsx("input",{type:"url",value:c,onChange:se=>u(se.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://example.com/guide.xml",required:!0})]}),i==="epg"&&f==="gracenote"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"mb-4",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["ZIP Code ",r.jsx("span",{className:"text-red-400",children:"*"})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{type:"text",value:y,onChange:se=>x(se.target.value.replace(/\D/g,"").slice(0,5)),className:"flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"10001",maxLength:5}),r.jsxs("button",{type:"button",onClick:Z,disabled:I||y.length<5,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg flex items-center gap-2",children:[I?r.jsx(vs,{className:"h-4 w-4 animate-spin"}):r.jsx(TR,{className:"h-4 w-4"}),"Find"]})]}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter your ZIP code to find available TV providers"})]}),O&&r.jsx("p",{className:"text-sm text-red-400 mb-4",children:O}),q.length>0&&r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Select Your TV Provider"}),r.jsx("div",{className:"space-y-3",children:q.map(se=>r.jsxs("div",{children:[r.jsxs("p",{className:"text-xs text-gray-500 mb-2 uppercase tracking-wide",children:[se.type==="Cable"&&" Cable",se.type==="Satellite"&&" Satellite",se.type==="Antenna"&&" Over-the-Air"]}),r.jsx("div",{className:"space-y-1",children:se.providers.map(oe=>r.jsx("button",{type:"button",onClick:()=>ae(oe),className:`w-full text-left px-4 py-3 rounded-lg border transition-colors ${k?.headendId===oe.headendId?"bg-indigo-600/20 border-indigo-500 text-white":"bg-gray-700/50 border-gray-600 text-gray-300 hover:border-gray-500 hover:bg-gray-700"}`,children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:oe.name}),oe.location&&r.jsxs("span",{className:"text-gray-400 ml-2 text-sm",children:[" ",oe.location]})]}),k?.headendId===oe.headendId&&r.jsx(Ys,{className:"h-4 w-4 text-indigo-400"})]})},oe.headendId))})]},se.type))})]}),k&&r.jsx("div",{className:"mb-4",children:r.jsx("button",{type:"button",onClick:ie,disabled:D,className:"w-full py-2 px-4 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg flex items-center justify-center gap-2",children:D?r.jsxs(r.Fragment,{children:[r.jsx(vs,{className:"h-4 w-4 animate-spin"}),"Loading Preview..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Xs,{className:"h-4 w-4"}),"Preview Channels (Optional)"]})})}),A&&r.jsxs("div",{className:"mb-4 p-4 bg-gray-700/50 rounded-lg border border-green-500/50",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[r.jsx(Ys,{className:"h-5 w-5 text-green-400"}),r.jsxs("h3",{className:"text-sm font-semibold text-white",children:["Found ",A.totalChannels," channels"]})]}),r.jsx("div",{className:"text-xs text-gray-400 mb-3",children:r.jsxs("p",{children:["Programs: ",A.totalPrograms]})}),r.jsxs("div",{className:"max-h-32 overflow-y-auto space-y-1",children:[r.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Sample channels:"}),A.previewChannels?.slice(0,5).map((se,oe)=>r.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-300 py-1",children:[r.jsx("span",{className:"font-medium text-white",children:se.callSign||se.channelId}),se.channelNo&&r.jsxs("span",{className:"text-gray-500",children:["Ch ",se.channelNo]})]},oe)),A.totalChannels>5&&r.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["... and ",A.totalChannels-5," more channels"]})]})]}),k&&r.jsx("div",{className:"mb-4 pt-4 border-t border-gray-700",children:r.jsxs("details",{className:"group",children:[r.jsxs("summary",{className:"text-sm font-medium text-gray-400 cursor-pointer hover:text-white flex items-center gap-2",children:[r.jsx(ug,{className:"h-4 w-4"}),"Advanced Settings"]}),r.jsxs("div",{className:"mt-3 space-y-3",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Provider ID"}),r.jsx("input",{type:"text",value:m,onChange:se=>g(se.target.value),className:"w-full px-3 py-1.5 bg-gray-700 border border-gray-600 rounded text-white text-sm font-mono",readOnly:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Hours of Guide Data"}),r.jsx("input",{type:"number",value:v,onChange:se=>E(parseInt(se.target.value)||6),min:"1",max:"12",className:"w-full px-3 py-1.5 bg-gray-700 border border-gray-600 rounded text-white text-sm"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"1-12 hours (default: 6). API limits longer requests."})]})]})]})})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:Q,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:Q?"Adding...":"Add"})]})]})]})})}function QD({channel:i,onClose:e,epgSources:t}){const s=Ct(),[a,l]=K.useState(i.name),[c,u]=K.useState(i.number),[f,d]=K.useState(i.logo||""),[m,g]=K.useState(i.group||""),[y,x]=K.useState(i.epgSourceId||null),[v,E]=K.useState(i.channelId||""),{data:A}=it({queryKey:["epgChannels",y],queryFn:()=>Le.getEPGChannels(y||void 0),enabled:!!y}),R=Ze({mutationFn:async L=>{const O=await fetch(`/livetv/channels/${i.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Plex-Token":Le.getToken()||""},body:JSON.stringify(L)});if(!O.ok)throw new Error("Failed to update channel");return O.json()},onSuccess:()=>{s.invalidateQueries({queryKey:["channels"]}),e()}}),D=L=>{L.preventDefault(),R.mutate({name:a,number:c,logo:f,group:m,epgSourceId:y??void 0,channelId:v||void 0})};return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h2",{className:"text-lg font-semibold text-white",children:"Edit Channel"}),r.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white",children:r.jsx(jt,{className:"h-5 w-5"})})]}),r.jsxs("form",{onSubmit:D,children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),r.jsx("input",{type:"text",value:a,onChange:L=>l(L.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Number"}),r.jsx("input",{type:"number",value:c,onChange:L=>u(parseInt(L.target.value)||0),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Logo URL"}),r.jsx("input",{type:"text",value:f,onChange:L=>d(L.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"https://..."})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Group"}),r.jsx("input",{type:"text",value:m,onChange:L=>g(L.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"Sports, News, etc."})]}),r.jsxs("div",{className:"mb-4 pt-4 border-t border-gray-700",children:[r.jsx("h3",{className:"text-sm font-semibold text-white mb-3",children:"EPG Mapping"}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"EPG Source"}),r.jsxs("select",{value:y||"",onChange:L=>{const O=L.target.value?parseInt(L.target.value):null;x(O),E("")},className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:[r.jsx("option",{value:"",children:"None"}),t.map(L=>r.jsx("option",{value:L.id,children:L.name},L.id))]}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select an EPG source to match program guide data"})]}),y&&r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"EPG Channel"}),r.jsxs("select",{value:v,onChange:L=>E(L.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:[r.jsx("option",{value:"",children:"Select EPG Channel..."}),A?.map(L=>r.jsxs("option",{value:L.channelId,children:[L.channelId," - ",L.sampleTitle]},L.channelId))]}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Match this channel to an EPG channel ID"})]})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:R.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:R.isPending?"Saving...":"Save"})]})]})]})})}function ZD({onClose:i}){const e=Ct(),[t,s]=K.useState(""),[a,l]=K.useState(""),[c,u]=K.useState("file"),[f,d]=K.useState(""),[m,g]=K.useState(null),[y,x]=K.useState(!1),[v,E]=K.useState(!1),[A,R]=K.useState(""),D=K.useRef(null),[L,O]=K.useState({}),[H,q]=K.useState({}),{data:U}=it({queryKey:["channels"],queryFn:async()=>(await(await fetch("/livetv/channels",{headers:{"X-Plex-Token":Le.getToken()||""}})).json()).channels||[]}),k=ae=>{const ie=ae.target.files?.[0];if(ie){d(ie.name);const re=new FileReader;re.onload=Q=>{const se=Q.target?.result;l(se)},re.onerror=()=>{R("Failed to read file")},re.readAsText(ie)}},M=async()=>{x(!0),R(""),g(null);try{const ae=c==="url"?{url:t,preview:!0}:{content:a,preview:!0},ie=await Le.mapChannelNumbers(ae);g(ie)}catch(ae){R(ae.response?.data?.error||ae.message||"Failed to parse M3U")}finally{x(!1)}},I=async()=>{E(!0),R("");try{const ae=Object.entries(L).map(([Q,se])=>{const oe=Z.find(Y=>Y.m3uName===Q);return{m3uName:Q,m3uNumber:oe?.m3uNumber||0,channelId:se}}),ie=c==="url"?{url:t,preview:!1,manualMappings:ae}:{content:a,preview:!1,manualMappings:ae},re=await Le.mapChannelNumbers(ie);g(re),O({}),e.invalidateQueries({queryKey:["channels"]})}catch(ae){R(ae.response?.data?.error||ae.message||"Failed to apply mappings")}finally{E(!1)}},j=m?.results?.filter(ae=>ae.matchType!=="none")||[],Z=m?.results?.filter(ae=>ae.matchType==="none")||[];return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h2",{className:"text-lg font-semibold text-white",children:"Import Channel Numbers from M3U"}),r.jsx("button",{onClick:i,className:"text-gray-400 hover:text-white",children:r.jsx(jt,{className:"h-5 w-5"})})]}),r.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Import channel numbers from an M3U file to apply to your existing channels. Only channel numbers will be updated - stream URLs will not be modified."}),r.jsxs("div",{className:"flex gap-2 mb-4",children:[r.jsx("button",{onClick:()=>u("file"),className:`px-4 py-2 rounded-lg text-sm ${c==="file"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Upload File"}),r.jsx("button",{onClick:()=>u("url"),className:`px-4 py-2 rounded-lg text-sm ${c==="url"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"URL"}),r.jsx("button",{onClick:()=>u("paste"),className:`px-4 py-2 rounded-lg text-sm ${c==="paste"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Paste Content"})]}),c==="file"?r.jsxs("div",{className:"mb-4",children:[r.jsx("input",{ref:D,type:"file",accept:".m3u,.m3u8,text/plain",onChange:k,className:"hidden"}),r.jsx("div",{onClick:()=>D.current?.click(),className:"w-full p-6 bg-gray-700 border-2 border-dashed border-gray-600 rounded-lg text-center cursor-pointer hover:border-indigo-500 hover:bg-gray-700/70 transition-colors",children:f?r.jsxs("div",{children:[r.jsx(Xn,{className:"h-8 w-8 text-indigo-400 mx-auto mb-2"}),r.jsx("p",{className:"text-white font-medium",children:f}),r.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Click to choose a different file"})]}):r.jsxs("div",{children:[r.jsx(Cb,{className:"h-8 w-8 text-gray-500 mx-auto mb-2"}),r.jsx("p",{className:"text-gray-300",children:"Click to select an M3U file"}),r.jsx("p",{className:"text-gray-500 text-sm mt-1",children:".m3u or .m3u8"})]})})]}):c==="url"?r.jsx("div",{className:"mb-4",children:r.jsx("input",{type:"url",value:t,onChange:ae=>s(ae.target.value),placeholder:"https://example.com/channels.m3u",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"})}):r.jsx("div",{className:"mb-4",children:r.jsx("textarea",{value:a,onChange:ae=>l(ae.target.value),placeholder:`#EXTM3U
#EXTINF:-1 tvg-chno="5",Channel Name
http://...`,className:"w-full h-32 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white font-mono text-sm"})}),A&&r.jsx("div",{className:"mb-4 p-3 bg-red-900/50 border border-red-500 rounded-lg text-red-300 text-sm",children:A}),!m&&r.jsx("button",{onClick:M,disabled:y||!t&&!a,className:"w-full mb-4 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg flex items-center justify-center gap-2",children:y?r.jsxs(r.Fragment,{children:[r.jsx(vs,{className:"h-4 w-4 animate-spin"}),"Parsing..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Xs,{className:"h-4 w-4"}),"Preview Matches"]})}),m&&r.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[r.jsxs("div",{className:"flex gap-4 mb-4",children:[r.jsxs("div",{className:"flex-1 p-3 bg-green-900/30 border border-green-500/50 rounded-lg",children:[r.jsx("div",{className:"text-green-400 text-lg font-semibold",children:m.matched}),r.jsx("div",{className:"text-green-300 text-xs",children:"Matched"})]}),r.jsxs("div",{className:"flex-1 p-3 bg-yellow-900/30 border border-yellow-500/50 rounded-lg",children:[r.jsx("div",{className:"text-yellow-400 text-lg font-semibold",children:m.unmatched}),r.jsx("div",{className:"text-yellow-300 text-xs",children:"Unmatched"})]})]}),r.jsxs("div",{className:"flex-1 overflow-y-auto mb-4",children:[j.length>0&&r.jsxs("div",{className:"mb-4",children:[r.jsx("h3",{className:"text-sm font-medium text-white mb-2",children:"Matched Channels"}),r.jsxs("div",{className:"space-y-1",children:[j.slice(0,50).map((ae,ie)=>r.jsxs("div",{className:"flex items-center justify-between text-sm bg-gray-700/50 p-2 rounded",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-indigo-400 font-mono w-12",children:ae.m3uNumber}),r.jsx("span",{className:"text-white",children:ae.m3uName})]}),r.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[r.jsx("span",{className:"text-xs bg-gray-600 px-1.5 py-0.5 rounded",children:ae.matchType}),r.jsxs("span",{children:[" ",ae.matchedName]}),ae.applied&&r.jsx(Ys,{className:"h-3 w-3 text-green-400"})]})]},ie)),j.length>50&&r.jsxs("div",{className:"text-xs text-gray-500 text-center py-2",children:["... and ",j.length-50," more"]})]})]}),Z.length>0&&r.jsxs("div",{children:[r.jsxs("h3",{className:"text-sm font-medium text-yellow-400 mb-2",children:["Unmatched (",Z.length,")",Object.keys(L).length>0&&r.jsxs("span",{className:"text-green-400 ml-2",children:["- ",Object.keys(L).length," manually matched"]})]}),r.jsx("div",{className:"space-y-1",children:Z.map((ae,ie)=>{const re=H[ae.m3uName]||"",Q=L[ae.m3uName]?U?.find(oe=>oe.id===L[ae.m3uName]):null,se=U?.filter(oe=>{if(!re)return!0;const Y=re.toLowerCase();return oe.name.toLowerCase().includes(Y)||oe.number.toString().includes(Y)})||[];return r.jsxs("div",{className:"flex items-center gap-2 text-sm p-2 bg-gray-700/30 rounded",children:[r.jsx("span",{className:"text-indigo-400 font-mono w-12 flex-shrink-0",children:ae.m3uNumber}),r.jsx("span",{className:"text-white flex-shrink-0 min-w-[120px]",children:ae.m3uName}),r.jsx("span",{className:"text-gray-500 mx-2",children:""}),r.jsxs("div",{className:"flex-1 relative",children:[r.jsx("input",{type:"text",value:Q?`${Q.number} - ${Q.name}`:re,onChange:oe=>{L[ae.m3uName]&&O(Y=>{const{[ae.m3uName]:V,...$}=Y;return $}),q(Y=>({...Y,[ae.m3uName]:oe.target.value}))},onFocus:()=>{Q&&(q(oe=>({...oe,[ae.m3uName]:""})),O(oe=>{const{[ae.m3uName]:Y,...V}=oe;return V}))},placeholder:"Type to search channels...",className:`w-full px-2 py-1 bg-gray-700 border rounded text-sm ${Q?"border-green-500 text-green-300":"border-gray-600 text-white"}`}),re&&!Q&&se.length>0&&r.jsxs("div",{className:"absolute z-10 w-full mt-1 max-h-48 overflow-y-auto bg-gray-800 border border-gray-600 rounded shadow-lg",children:[se.slice(0,20).map(oe=>r.jsxs("div",{onClick:()=>{O(Y=>({...Y,[ae.m3uName]:oe.id})),q(Y=>{const{[ae.m3uName]:V,...$}=Y;return $})},className:"px-2 py-1 hover:bg-gray-700 cursor-pointer text-gray-200",children:[oe.number," - ",oe.name]},oe.id)),se.length>20&&r.jsxs("div",{className:"px-2 py-1 text-gray-500 text-xs",children:["+",se.length-20," more results..."]})]})]}),Q&&r.jsx("button",{onClick:()=>{O(oe=>{const{[ae.m3uName]:Y,...V}=oe;return V})},className:"text-gray-400 hover:text-red-400",children:r.jsx(jt,{className:"h-4 w-4"})}),Q&&r.jsx(Ys,{className:"h-4 w-4 text-green-400 flex-shrink-0"})]},ie)})})]})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:()=>g(null),className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Back"}),r.jsx("button",{onClick:I,disabled:v||m.matched===0&&Object.keys(L).length===0,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg flex items-center justify-center gap-2",children:v?r.jsxs(r.Fragment,{children:[r.jsx(vs,{className:"h-4 w-4 animate-spin"}),"Applying..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Ys,{className:"h-4 w-4"}),"Apply ",m.matched+Object.keys(L).length," Mappings"]})})]})]})]})})}function JD({source:i,onClose:e}){const t=Ct(),[s,a]=K.useState(i.name),[l,c]=K.useState(i.url),[u,f]=K.useState(""),d=Ze({mutationFn:async g=>Le.updateM3USource(i.id,g),onSuccess:()=>{t.invalidateQueries({queryKey:["m3uSources"]}),t.invalidateQueries({queryKey:["channels"]}),e()},onError:g=>{f(g.response?.data?.error||g.message||"Failed to update source")}}),m=g=>{g.preventDefault(),f(""),d.mutate({name:s,url:l})};return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h2",{className:"text-lg font-semibold text-white",children:"Edit M3U Source"}),r.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white",children:r.jsx(jt,{className:"h-5 w-5"})})]}),r.jsxs("form",{onSubmit:m,children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),r.jsx("input",{type:"text",value:s,onChange:g=>a(g.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"URL"}),r.jsx("input",{type:"url",value:l,onChange:g=>c(g.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://example.com/playlist.m3u",required:!0}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Update the URL if your provider's IP address changed"})]}),u&&r.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg",children:r.jsxs("p",{className:"text-sm text-red-300 flex items-center gap-2",children:[r.jsx(Ns,{className:"h-4 w-4"}),u]})}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:d.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:d.isPending?"Saving...":"Save Changes"})]})]})]})})}function eI({source:i,onClose:e}){const t=Ct(),[s,a]=K.useState(i.name),[l,c]=K.useState(i.serverUrl),[u,f]=K.useState(i.username),[d,m]=K.useState(""),[g,y]=K.useState(i.importVod||!1),[x,v]=K.useState(i.importSeries||!1),[E,A]=K.useState(i.vodLibraryId||null),[R,D]=K.useState(i.seriesLibraryId||null),[L,O]=K.useState(""),{data:H}=it({queryKey:["libraries"],queryFn:()=>Le.getLibraries()}),q=H?.filter(I=>I.type==="movie")||[],U=H?.filter(I=>I.type==="show")||[],k=Ze({mutationFn:async I=>Le.updateXtreamSource(i.id,I),onSuccess:()=>{t.invalidateQueries({queryKey:["xtreamSources"]}),t.invalidateQueries({queryKey:["channels"]}),e()},onError:I=>{O(I.response?.data?.error||I.message||"Failed to update source")}}),M=I=>{I.preventDefault(),O("");const j={name:s,serverUrl:l,username:u,importVod:g,importSeries:x,vodLibraryId:E??void 0,seriesLibraryId:R??void 0};d&&(j.password=d),k.mutate(j)};return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[r.jsx(_r,{className:"h-5 w-5 text-yellow-400"}),"Edit Xtream Source"]}),r.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white",children:r.jsx(jt,{className:"h-5 w-5"})})]}),r.jsxs("form",{onSubmit:M,children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),r.jsx("input",{type:"text",value:s,onChange:I=>a(I.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Server URL"}),r.jsx("input",{type:"url",value:l,onChange:I=>c(I.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://server.com:8080",required:!0}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Update the URL if your provider's IP address changed"})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Username"}),r.jsx("input",{type:"text",value:u,onChange:I=>f(I.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),r.jsxs("div",{className:"mb-4",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Password ",r.jsx("span",{className:"text-gray-500",children:"(leave blank to keep current)"})]}),r.jsx("input",{type:"password",value:d,onChange:I=>m(I.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:""})]}),r.jsxs("div",{className:"mb-6 p-4 bg-gray-700/50 rounded-lg border border-gray-600",children:[r.jsx("h3",{className:"text-sm font-semibold text-white mb-3",children:"Content Import"}),r.jsxs("div",{className:"mb-4",children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:g,onChange:I=>y(I.target.checked),className:"rounded bg-gray-600 border-gray-500"}),"Import VOD Movies"]}),g&&r.jsx("div",{className:"mt-2 ml-6",children:r.jsxs("select",{value:E||"",onChange:I=>A(I.target.value?parseInt(I.target.value):null),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",children:[r.jsx("option",{value:"",children:"Select Movie Library..."}),q.map(I=>r.jsx("option",{value:I.id,children:I.title},I.id))]})})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:x,onChange:I=>v(I.target.checked),className:"rounded bg-gray-600 border-gray-500"}),"Import TV Series"]}),x&&r.jsx("div",{className:"mt-2 ml-6",children:r.jsxs("select",{value:R||"",onChange:I=>D(I.target.value?parseInt(I.target.value):null),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",children:[r.jsx("option",{value:"",children:"Select TV Library..."}),U.map(I=>r.jsx("option",{value:I.id,children:I.title},I.id))]})})]})]}),L&&r.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg",children:r.jsxs("p",{className:"text-sm text-red-300 flex items-center gap-2",children:[r.jsx(Ns,{className:"h-4 w-4"}),L]})}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:k.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:k.isPending?"Saving...":"Save Changes"})]})]})]})})}function tI({source:i,onClose:e}){const t=Ct(),[s,a]=K.useState(i.name),[l,c]=K.useState(i.url||""),[u,f]=K.useState(i.gracenoteAffiliate||""),[d,m]=K.useState(i.gracenotePostalCode||""),[g,y]=K.useState(i.gracenoteHours||6),[x,v]=K.useState(""),E=Ze({mutationFn:async R=>Le.updateEPGSource(i.id,R),onSuccess:()=>{t.invalidateQueries({queryKey:["epgSources"]}),e()},onError:R=>{v(R.response?.data?.error||R.message||"Failed to update source")}}),A=R=>{R.preventDefault(),v(""),i.providerType==="xmltv"?E.mutate({name:s,url:l}):E.mutate({name:s,gracenoteAffiliate:u,gracenotePostalCode:d,gracenoteHours:g})};return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h2",{className:"text-lg font-semibold text-white",children:"Edit EPG Source"}),r.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white",children:r.jsx(jt,{className:"h-5 w-5"})})]}),r.jsxs("form",{onSubmit:A,children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),r.jsx("input",{type:"text",value:s,onChange:R=>a(R.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),i.providerType==="xmltv"?r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"XMLTV URL"}),r.jsx("input",{type:"url",value:l,onChange:R=>c(R.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://example.com/guide.xml",required:!0}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Update the URL if your EPG provider's address changed"})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"ZIP Code"}),r.jsx("input",{type:"text",value:d,onChange:R=>m(R.target.value.replace(/\D/g,"").slice(0,5)),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"10001",maxLength:5})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Provider ID (Headend)"}),r.jsx("input",{type:"text",value:u,onChange:R=>f(R.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white font-mono"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Change if you switched TV providers"})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Hours of Guide Data"}),r.jsx("input",{type:"number",value:g,onChange:R=>y(parseInt(R.target.value)||6),min:"1",max:"12",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"})]})]}),x&&r.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg",children:r.jsxs("p",{className:"text-sm text-red-300 flex items-center gap-2",children:[r.jsx(Ns,{className:"h-4 w-4"}),x]})}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:E.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:E.isPending?"Saving...":"Save Changes"})]})]})]})})}function sI({onClose:i}){const e=Ct(),[t,s]=K.useState(""),[a,l]=K.useState(""),[c,u]=K.useState(""),[f,d]=K.useState(""),[m,g]=K.useState(""),[y,x]=K.useState(!1),[v,E]=K.useState(null),[A,R]=K.useState(""),[D,L]=K.useState(!1),[O,H]=K.useState(!1),[q,U]=K.useState(!1),[k,M]=K.useState(null),[I,j]=K.useState(null),{data:Z}=it({queryKey:["libraries"],queryFn:()=>Le.getLibraries()}),ae=Z?.filter(V=>V.type==="movie")||[],ie=Z?.filter(V=>V.type==="show")||[],[re,Q]=K.useState(""),se=Ze({mutationFn:async V=>Le.createXtreamSource(V),onSuccess:()=>{e.invalidateQueries({queryKey:["xtreamSources"]}),i()},onError:V=>{Q(V.response?.data?.error||V.message||"Failed to add source")}}),oe=async()=>{if(m){L(!0),R(""),E(null);try{const V=await Le.parseXtreamFromM3U(m);V.success?(E(V),l(V.serverUrl||""),u(V.username||""),d(V.password||""),s(V.name||"")):(R(V.error||"Failed to parse URL"),V.serverUrl&&l(V.serverUrl),V.username&&u(V.username))}catch(V){R(V.message||"Failed to parse URL")}finally{L(!1)}}},Y=async V=>{V.preventDefault(),Q(""),await se.mutateAsync({name:t,serverUrl:a,username:c,password:f,importVod:O,importSeries:q,vodLibraryId:k??void 0,seriesLibraryId:I??void 0})};return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[r.jsx(_r,{className:"h-5 w-5 text-yellow-400"}),"Add Xtream Source"]}),r.jsx("button",{onClick:i,className:"text-gray-400 hover:text-white",children:r.jsx(jt,{className:"h-5 w-5"})})]}),r.jsxs("div",{className:"mb-6 p-4 bg-gray-700/50 rounded-lg border border-gray-600",children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-300 mb-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:y,onChange:V=>x(V.target.checked),className:"rounded"}),"Auto-detect from M3U URL"]}),y&&r.jsxs("div",{className:"mt-3",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{type:"url",value:m,onChange:V=>g(V.target.value),className:"flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",placeholder:"http://server:port/get.php?username=...&password=..."}),r.jsx("button",{type:"button",onClick:oe,disabled:D||!m,className:"px-3 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 text-white rounded-lg text-sm",children:D?r.jsx(vs,{className:"h-4 w-4 animate-spin"}):"Parse"})]}),A&&r.jsxs("p",{className:"text-sm text-yellow-400 mt-2 flex items-center gap-1",children:[r.jsx(Ns,{className:"h-4 w-4"}),A]}),v&&v.success&&r.jsxs("div",{className:"mt-3 p-2 bg-green-500/20 border border-green-500/50 rounded text-sm text-green-300",children:[r.jsx(Ys,{className:"inline h-4 w-4 mr-1"}),"Credentials detected! Account status: ",v.userInfo?.status]})]})]}),r.jsxs("form",{onSubmit:Y,children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),r.jsx("input",{type:"text",value:t,onChange:V=>s(V.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"My IPTV Provider",required:!0})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Server URL"}),r.jsx("input",{type:"url",value:a,onChange:V=>l(V.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://server.com:8080",required:!0})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Username"}),r.jsx("input",{type:"text",value:c,onChange:V=>u(V.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Password"}),r.jsx("input",{type:"password",value:f,onChange:V=>d(V.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),r.jsxs("div",{className:"mb-6 p-4 bg-gray-700/50 rounded-lg border border-gray-600",children:[r.jsx("h3",{className:"text-sm font-semibold text-white mb-3",children:"Content Import"}),r.jsx("p",{className:"text-xs text-gray-400 mb-4",children:"Import VOD movies and series from this source into your media libraries"}),r.jsxs("div",{className:"mb-4",children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:O,onChange:V=>H(V.target.checked),className:"rounded bg-gray-600 border-gray-500"}),"Import VOD Movies"]}),O&&r.jsxs("div",{className:"mt-2 ml-6",children:[r.jsxs("select",{value:k||"",onChange:V=>M(V.target.value?parseInt(V.target.value):null),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",required:O,children:[r.jsx("option",{value:"",children:"Select Movie Library..."}),ae.map(V=>r.jsx("option",{value:V.id,children:V.title},V.id))]}),ae.length===0&&r.jsx("p",{className:"text-xs text-yellow-400 mt-1",children:"No movie libraries found. Create one first."})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:q,onChange:V=>U(V.target.checked),className:"rounded bg-gray-600 border-gray-500"}),"Import TV Series"]}),q&&r.jsxs("div",{className:"mt-2 ml-6",children:[r.jsxs("select",{value:I||"",onChange:V=>j(V.target.value?parseInt(V.target.value):null),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",required:q,children:[r.jsx("option",{value:"",children:"Select TV Library..."}),ie.map(V=>r.jsx("option",{value:V.id,children:V.title},V.id))]}),ie.length===0&&r.jsx("p",{className:"text-xs text-yellow-400 mt-1",children:"No TV show libraries found. Create one first."})]})]})]}),re&&r.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg",children:r.jsxs("p",{className:"text-sm text-red-300 flex items-center gap-2",children:[r.jsx(Ns,{className:"h-4 w-4"}),re]})}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{type:"button",onClick:i,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:se.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:se.isPending?"Adding...":"Add Source"})]})]})]})})}function iI({epgSources:i}){const[e,t]=K.useState(null),[s,a]=K.useState(1),l=50,{data:c,isLoading:u}=it({queryKey:["epgPrograms",e,s],queryFn:()=>Le.getEPGPrograms({page:s,limit:l,epgSourceId:e||void 0}),enabled:i.length>0}),f=i.reduce((d,m)=>d+(m.programCount||0),0);return r.jsx("div",{children:r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-white mb-1",children:"EPG Program Listings"}),r.jsxs("p",{className:"text-sm text-gray-400",children:["Total: ",f.toLocaleString()," programs across ",i.length," source(s)"]})]}),i.length>1&&r.jsxs("select",{value:e||"",onChange:d=>{t(d.target.value?parseInt(d.target.value):null),a(1)},className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",children:[r.jsx("option",{value:"",children:"All Sources"}),i.map(d=>r.jsxs("option",{value:d.id,children:[d.name," (",d.programCount," programs)"]},d.id))]})]}),r.jsx("div",{className:"mb-4 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:r.jsxs("p",{className:"text-sm text-blue-300",children:[r.jsx("strong",{children:"Note:"})," Channel names in gray are EPG channel IDs that haven't been mapped to your M3U channels yet. Go to the ",r.jsx("strong",{children:"Channels"})," tab to assign EPG sources to your channels for proper matching."]})}),u?r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto"}),r.jsx("p",{className:"text-gray-400 mt-4",children:"Loading programs..."})]}):c&&c.programs.length>0?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-700/50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-left p-3 text-gray-300 text-sm font-medium",children:"Channel"}),r.jsx("th",{className:"text-left p-3 text-gray-300 text-sm font-medium",children:"Program"}),r.jsx("th",{className:"text-left p-3 text-gray-300 text-sm font-medium",children:"Time"}),r.jsx("th",{className:"text-left p-3 text-gray-300 text-sm font-medium",children:"Category"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-700",children:c.programs.map(d=>{const m=new Date(d.start),g=new Date(d.end),y=Math.round((g.getTime()-m.getTime())/6e4),x=d.channelName||d.channelId?.replace(/^(fubo|gracenote)-/,"")||"Unknown",v=!d.channelName;return r.jsxs("tr",{className:"hover:bg-gray-700/30",children:[r.jsxs("td",{className:"p-3",children:[r.jsx("div",{className:`font-medium ${v?"text-gray-400":"text-white"}`,children:x}),v&&r.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["EPG ID: ",d.channelId]})]}),r.jsxs("td",{className:"p-3",children:[r.jsx("div",{className:"font-medium text-white",children:d.title}),d.description&&r.jsx("div",{className:"text-sm text-gray-400 mt-1 line-clamp-2",children:d.description}),d.episodeNum&&r.jsx("div",{className:"text-xs text-gray-500 mt-1",children:d.episodeNum})]}),r.jsxs("td",{className:"p-3",children:[r.jsxs("div",{className:"text-sm text-white",children:[m.toLocaleDateString()," ",m.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),r.jsxs("div",{className:"text-xs text-gray-400",children:[y," min"]})]}),r.jsx("td",{className:"p-3",children:d.category&&r.jsx("span",{className:"inline-block px-2 py-1 bg-gray-700 text-gray-300 text-xs rounded",children:d.category})})]},d.id)})})]})}),c.pages>1&&r.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t border-gray-700",children:[r.jsxs("div",{className:"text-sm text-gray-400",children:["Showing ",(s-1)*l+1," - ",Math.min(s*l,c.total)," of ",c.total.toLocaleString()]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>a(d=>Math.max(1,d-1)),disabled:s===1,className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),r.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,c.pages)},(d,m)=>{let g;return c.pages<=5||s<=3?g=m+1:s>=c.pages-2?g=c.pages-4+m:g=s-2+m,r.jsx("button",{onClick:()=>a(g),className:`px-3 py-1.5 text-sm rounded ${s===g?"bg-indigo-600 text-white":"bg-gray-700 hover:bg-gray-600 text-white"}`,children:g},g)})}),r.jsx("button",{onClick:()=>a(d=>Math.min(c.pages,d+1)),disabled:s===c.pages,className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]}):r.jsxs("div",{className:"text-center py-12",children:[r.jsx(Xn,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-400",children:i.length===0?"No EPG sources configured. Add an EPG source to see program listings.":"No programs found. Try refreshing your EPG sources."})]})]})})}function nI({group:i,channels:e,onEdit:t,onDelete:s,onAddMember:a,onUpdatePriority:l,onRemoveMember:c}){const[u,f]=K.useState(!1),[d,m]=K.useState(!1),[g,y]=K.useState(""),x=new Set(i.members?.map(A=>A.channelId)||[]),E=e.filter(A=>A.enabled&&!x.has(A.id)).filter(A=>A.name.toLowerCase().includes(g.toLowerCase()));return r.jsxs("div",{className:"bg-gray-800 rounded-xl overflow-hidden",children:[r.jsxs("div",{className:"p-4 flex items-center justify-between cursor-pointer hover:bg-gray-750",onClick:()=>f(!u),children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("button",{className:"text-gray-400",children:u?r.jsx(fd,{className:"h-5 w-5"}):r.jsx(md,{className:"h-5 w-5"})}),i.logo?r.jsx("img",{src:i.logo,alt:i.name,className:"w-10 h-10 object-contain bg-gray-700 rounded"}):r.jsx("div",{className:"w-10 h-10 bg-gray-700 rounded flex items-center justify-center",children:r.jsx(og,{className:"h-5 w-5 text-gray-500"})}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-white font-medium",children:i.name}),r.jsxs("span",{className:"text-gray-500 text-sm",children:["#",i.displayNumber]}),!i.enabled&&r.jsx("span",{className:"px-2 py-0.5 bg-gray-700 text-gray-400 text-xs rounded",children:"Disabled"})]}),r.jsxs("div",{className:"text-sm text-gray-400",children:[i.members?.length||0," source",(i.members?.length||0)!==1?"s":"",i.channelId&&`  EPG: ${i.channelId}`]})]})]}),r.jsxs("div",{className:"flex items-center gap-2",onClick:A=>A.stopPropagation(),children:[r.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded",title:"Edit group",children:r.jsx(dr,{className:"h-4 w-4"})}),r.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded",title:"Delete group",children:r.jsx(an,{className:"h-4 w-4"})})]})]}),u&&r.jsxs("div",{className:"border-t border-gray-700 p-4",children:[i.members?.length>0?r.jsxs("div",{className:"space-y-2 mb-4",children:[r.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-2",children:"Priority Order (failover from top to bottom)"}),i.members.sort((A,R)=>A.priority-R.priority).map((A,R)=>r.jsxs("div",{className:"flex items-center justify-between bg-gray-750 rounded-lg p-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("span",{className:"text-gray-500 text-sm font-mono w-6",children:[R+1,"."]}),A.channel?.logo?r.jsx("img",{src:A.channel.logo,alt:A.channel.name,className:"w-8 h-8 object-contain bg-gray-700 rounded"}):r.jsx("div",{className:"w-8 h-8 bg-gray-700 rounded flex items-center justify-center",children:r.jsx(vr,{className:"h-4 w-4 text-gray-500"})}),r.jsxs("div",{children:[r.jsx("div",{className:"text-white text-sm",children:A.channel?.name}),r.jsx("div",{className:"text-gray-500 text-xs",children:A.channel?.sourceName||"Unknown source"})]})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("button",{onClick:()=>l(A.channelId,Math.max(0,A.priority-1)),disabled:R===0,className:"p-1.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded disabled:opacity-30",title:"Move up",children:r.jsx(wN,{className:"h-4 w-4"})}),r.jsx("button",{onClick:()=>l(A.channelId,A.priority+1),disabled:R===(i.members?.length||0)-1,className:"p-1.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded disabled:opacity-30",title:"Move down",children:r.jsx(vb,{className:"h-4 w-4"})}),r.jsx("button",{onClick:()=>c(A.channelId),className:"p-1.5 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded",title:"Remove from group",children:r.jsx(jt,{className:"h-4 w-4"})})]})]},A.channelId))]}):r.jsx("div",{className:"text-center py-4 text-gray-400 mb-4",children:"No channels in this group. Add channels to enable failover."}),d?r.jsxs("div",{className:"bg-gray-750 rounded-lg p-3",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[r.jsx(Xs,{className:"h-4 w-4 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Search channels to add...",value:g,onChange:A=>y(A.target.value),className:"flex-1 bg-transparent text-white placeholder-gray-500 outline-none text-sm",autoFocus:!0}),r.jsx("button",{onClick:()=>{m(!1),y("")},className:"p-1 text-gray-400 hover:text-white",children:r.jsx(jt,{className:"h-4 w-4"})})]}),r.jsx("div",{className:"max-h-48 overflow-y-auto space-y-1",children:E.length>0?E.slice(0,20).map(A=>r.jsxs("button",{onClick:()=>{a(A.id,i.members?.length||0),y("")},className:"w-full flex items-center gap-3 p-2 hover:bg-gray-700 rounded text-left",children:[A.logo?r.jsx("img",{src:A.logo,alt:A.name,className:"w-6 h-6 object-contain bg-gray-700 rounded"}):r.jsx("div",{className:"w-6 h-6 bg-gray-700 rounded flex items-center justify-center",children:r.jsx(vr,{className:"h-3 w-3 text-gray-500"})}),r.jsx("span",{className:"text-sm text-white",children:A.name}),r.jsxs("span",{className:"text-xs text-gray-500",children:["#",A.number]})]},A.id)):r.jsx("div",{className:"text-center py-2 text-gray-500 text-sm",children:g?"No matching channels":"No available channels"})})]}):r.jsxs("button",{onClick:()=>m(!0),className:"w-full py-2 border border-dashed border-gray-600 rounded-lg text-gray-400 hover:text-white hover:border-gray-500 flex items-center justify-center gap-2",children:[r.jsx(Hi,{className:"h-4 w-4"}),"Add Channel Source"]})]})]})}function vv({group:i,onClose:e,onSave:t,isLoading:s}){const[a,l]=K.useState(i?.name||""),[c,u]=K.useState(i?.displayNumber?.toString()||""),[f,d]=K.useState(i?.logo||""),[m,g]=K.useState(i?.channelId||""),[y,x]=K.useState(i?.enabled??!0),v=E=>{E.preventDefault(),t({name:a,displayNumber:parseInt(c)||0,logo:f||void 0,channelId:m||void 0,enabled:y})};return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[r.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:i?"Edit Channel Group":"Create Channel Group"}),r.jsxs("form",{onSubmit:v,children:[r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Group Name"}),r.jsx("input",{type:"text",value:a,onChange:E=>l(E.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"ESPN",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Channel Number"}),r.jsx("input",{type:"number",value:c,onChange:E=>u(E.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"100",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Logo URL (optional)"}),r.jsx("input",{type:"url",value:f,onChange:E=>d(E.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"https://example.com/logo.png"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"EPG Channel ID (optional)"}),r.jsx("input",{type:"text",value:m,onChange:E=>g(E.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"ESPN.us"})]}),i&&r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("button",{type:"button",onClick:()=>x(!y),className:`w-5 h-5 rounded border flex items-center justify-center ${y?"bg-indigo-600 border-indigo-600":"border-gray-500 hover:border-gray-400"}`,children:y&&r.jsx(Ys,{className:"h-3 w-3 text-white"})}),r.jsx("span",{className:"text-sm text-gray-300",children:"Enabled"})]})]}),r.jsxs("div",{className:"mt-6 flex gap-3",children:[r.jsx("button",{type:"button",onClick:e,className:"flex-1 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:s||!a||!c,className:"flex-1 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 text-white rounded-lg",children:s?"Saving...":i?"Save Changes":"Create Group"})]})]})]})})}function aI({results:i,onClose:e,onCreateGroup:t,isCreating:s}){const[a,l]=K.useState(new Set);return!i||i.length===0?r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md text-center",children:[r.jsx(og,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),r.jsx("h2",{className:"text-lg font-semibold text-white mb-2",children:"No Duplicates Found"}),r.jsx("p",{className:"text-gray-400 mb-4",children:"No duplicate channels were detected across your sources."}),r.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Close"})]})}):r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-2xl max-h-[80vh] flex flex-col",children:[r.jsx("h2",{className:"text-lg font-semibold text-white mb-2",children:"Detected Duplicate Channels"}),r.jsxs("p",{className:"text-gray-400 text-sm mb-4",children:["Found ",i.length," channel",i.length!==1?"s":""," with duplicates across sources. Create groups to enable automatic failover."]}),r.jsx("div",{className:"flex-1 overflow-y-auto space-y-3",children:i.map((c,u)=>r.jsxs("div",{className:"bg-gray-750 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[c.channels[0]?.logo?r.jsx("img",{src:c.channels[0].logo,alt:c.name,className:"w-8 h-8 object-contain bg-gray-700 rounded"}):r.jsx("div",{className:"w-8 h-8 bg-gray-700 rounded flex items-center justify-center",children:r.jsx(vr,{className:"h-4 w-4 text-gray-500"})}),r.jsxs("div",{children:[r.jsx("div",{className:"text-white font-medium",children:c.name}),r.jsxs("div",{className:"text-gray-500 text-xs",children:[c.channels.length," sources found"]})]})]}),a.has(c.name)?r.jsx("span",{className:"px-3 py-1 bg-green-600/20 text-green-400 text-sm rounded-lg",children:"Created"}):r.jsx("button",{onClick:()=>{t(c),l(f=>new Set([...f,c.name]))},disabled:s,className:"px-3 py-1 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 text-white text-sm rounded-lg",children:"Create Group"})]}),r.jsx("div",{className:"space-y-1 pl-11",children:c.channels.map((f,d)=>r.jsxs("div",{className:"text-sm text-gray-400 flex items-center gap-2",children:[r.jsxs("span",{className:"text-gray-600",children:[d+1,"."]}),r.jsx("span",{children:f.name}),r.jsx("span",{className:"text-gray-600",children:""}),r.jsx("span",{className:"text-gray-500",children:f.sourceName||"Unknown"})]},f.id))})]},u))}),r.jsx("div",{className:"mt-4 pt-4 border-t border-gray-700 flex justify-end",children:r.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Done"})})]})})}function rI(){const i=Wl(),e=Ct(),{data:t,isLoading:s}=tS(),{data:a,isLoading:l}=kL(),c=DL(),u=IL(),f=jL(),d=OL(),[m,g]=K.useState(null),[y,x]=K.useState("sources"),[v,E]=K.useState(""),[A,R]=K.useState(null),[D,L]=K.useState(!1),[O,H]=K.useState(null),[q,U]=K.useState(null),[k,M]=K.useState(null),[I,j]=K.useState(null),[Z,ae]=K.useState(null),[ie,re]=K.useState(null),[Q,se]=K.useState(!1),[oe,Y]=K.useState(!1),{data:V,isLoading:$}=it({queryKey:["xtreamSources"],queryFn:()=>Le.getXtreamSources()}),X=Ze({mutationFn:Ae=>Le.deleteXtreamSource(Ae),onSuccess:()=>{e.invalidateQueries({queryKey:["xtreamSources"]}),e.invalidateQueries({queryKey:["channels"]})}}),me=Ze({mutationFn:Ae=>Le.refreshXtreamSource(Ae),onMutate:Ae=>ae(Ae),onSuccess:()=>{e.invalidateQueries({queryKey:["xtreamSources"]}),e.invalidateQueries({queryKey:["channels"]})},onSettled:()=>ae(null)}),[ve,pe]=K.useState(null),[ge,ee]=K.useState(null),ye=Ze({mutationFn:Ae=>Le.importXtreamVOD(Ae),onMutate:Ae=>pe(Ae),onSuccess:Ae=>{e.invalidateQueries({queryKey:["xtreamSources"]}),alert(`VOD Import: ${Ae.added} added, ${Ae.updated} updated`)},onSettled:()=>pe(null)}),Ie=Ze({mutationFn:Ae=>Le.importXtreamSeries(Ae),onMutate:Ae=>ee(Ae),onSuccess:()=>{e.invalidateQueries({queryKey:["xtreamSources"]}),e.invalidateQueries({queryKey:["libraryStats"]}),alert("Series import started in background. Check library stats for progress.")},onSettled:()=>ee(null)}),{data:Ue}=it({queryKey:["libraryStats"],queryFn:async()=>{const Ae={},ct=new Set;V?.forEach(Lt=>{Lt.vodLibraryId&&ct.add(Lt.vodLibraryId),Lt.seriesLibraryId&&ct.add(Lt.seriesLibraryId)});for(const Lt of ct)try{const ds=await Le.getLibraryStats(Lt);Ae[Lt]={movieCount:ds.movieCount,showCount:ds.showCount,episodeCount:ds.episodeCount}}catch{}return Ae},enabled:!!V?.length,refetchInterval:1e4}),qe=Ze({mutationFn:async Ae=>{const ct=await fetch(`/livetv/epg/sources/${Ae}/refresh`,{method:"POST",headers:{"X-Plex-Token":Le.getToken()||""}});if(!ct.ok)throw new Error("Failed to refresh EPG source");return ct.json()},onMutate:Ae=>{j(Ae)},onSuccess:()=>{e.invalidateQueries({queryKey:["epgSources"]})},onSettled:()=>{j(null)}}),{data:ue,isLoading:Be}=it({queryKey:["channels"],queryFn:async()=>(await(await fetch("/livetv/channels",{headers:{"X-Plex-Token":Le.getToken()||""}})).json()).channels,enabled:y==="channels"}),Ge=Ze({mutationFn:async({id:Ae,enabled:ct})=>{const Lt=await fetch(`/livetv/channels/${Ae}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Plex-Token":Le.getToken()||""},body:JSON.stringify({enabled:ct})});if(!Lt.ok)throw new Error("Failed to update channel");return Lt.json()},onSuccess:()=>{e.invalidateQueries({queryKey:["channels"]})}}),yt=Ze({mutationFn:async({id:Ae,enabled:ct})=>{const Lt=ct?`/livetv/channels/${Ae}/archive/enable`:`/livetv/channels/${Ae}/archive/disable`,ds=await fetch(Lt,{method:"POST",headers:{"Content-Type":"application/json","X-Plex-Token":Le.getToken()||""},body:ct?JSON.stringify({days:7}):void 0});if(!ds.ok)throw new Error("Failed to update channel archive");return ds.json()},onSuccess:()=>{e.invalidateQueries({queryKey:["channels"]})}}),{data:He,isLoading:dt}=it({queryKey:["channelGroups"],queryFn:()=>Le.getChannelGroups(),enabled:y==="groups"}),Ot=Ze({mutationFn:Ae=>Le.createChannelGroup(Ae),onSuccess:()=>{e.invalidateQueries({queryKey:["channelGroups"]}),se(!1)}}),ns=Ze({mutationFn:({id:Ae,data:ct})=>Le.updateChannelGroup(Ae,ct),onSuccess:()=>{e.invalidateQueries({queryKey:["channelGroups"]}),re(null)}}),os=Ze({mutationFn:Ae=>Le.deleteChannelGroup(Ae),onSuccess:()=>{e.invalidateQueries({queryKey:["channelGroups"]})}}),Se=Ze({mutationFn:({groupId:Ae,channelId:ct,priority:Lt})=>Le.addChannelToGroup(Ae,ct,Lt),onSuccess:()=>{e.invalidateQueries({queryKey:["channelGroups"]})}}),ze=Ze({mutationFn:({groupId:Ae,channelId:ct,priority:Lt})=>Le.updateGroupMemberPriority(Ae,ct,Lt),onSuccess:()=>{e.invalidateQueries({queryKey:["channelGroups"]})}}),ot=Ze({mutationFn:({groupId:Ae,channelId:ct})=>Le.removeChannelFromGroup(Ae,ct),onSuccess:()=>{e.invalidateQueries({queryKey:["channelGroups"]})}}),[vt,Zs]=K.useState(null),[Ms,Di]=K.useState(!1),mi=async()=>{Di(!0);try{const Ae=await Le.autoDetectDuplicates();Zs(Ae.duplicates),Y(!0)}catch(Ae){console.error("Failed to auto-detect duplicates:",Ae)}finally{Di(!1)}},Xi=ue?.filter(Ae=>Ae.name.toLowerCase().includes(v.toLowerCase())||Ae.channelId.toLowerCase().includes(v.toLowerCase())||Ae.group&&Ae.group.toLowerCase().includes(v.toLowerCase())),Qi=ue?.filter(Ae=>Ae.enabled).length||0,Js=ue?.length||0,Tr=ue?.filter(Ae=>Ae.archiveEnabled).length||0;return r.jsxs("div",{children:[r.jsxs("div",{className:"mb-8 flex items-start justify-between",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-white",children:"Live TV"}),r.jsx("p",{className:"text-gray-400 mt-1",children:"Manage your IPTV sources, channels, and program guide"})]}),r.jsxs("button",{onClick:()=>i("/ui/livetv/epg-editor"),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg",children:[r.jsx(ug,{className:"h-4 w-4"}),"EPG Editor"]})]}),r.jsxs("div",{className:"flex gap-4 mb-6 border-b border-gray-700",children:[r.jsx("button",{onClick:()=>x("sources"),className:`pb-3 px-1 text-sm font-medium border-b-2 transition-colors ${y==="sources"?"border-indigo-500 text-white":"border-transparent text-gray-400 hover:text-white"}`,children:"Sources"}),r.jsxs("button",{onClick:()=>x("channels"),className:`pb-3 px-1 text-sm font-medium border-b-2 transition-colors ${y==="channels"?"border-indigo-500 text-white":"border-transparent text-gray-400 hover:text-white"}`,children:["Channels ",Js>0&&`(${Qi}/${Js})`,Tr>0&&r.jsxs("span",{className:"ml-2 px-1.5 py-0.5 bg-purple-600 text-white text-xs rounded",children:[Tr," recording"]})]}),r.jsx("button",{onClick:()=>x("programs"),className:`pb-3 px-1 text-sm font-medium border-b-2 transition-colors ${y==="programs"?"border-indigo-500 text-white":"border-transparent text-gray-400 hover:text-white"}`,children:"EPG Programs"}),r.jsx("button",{onClick:()=>x("groups"),className:`pb-3 px-1 text-sm font-medium border-b-2 transition-colors ${y==="groups"?"border-indigo-500 text-white":"border-transparent text-gray-400 hover:text-white"}`,children:"Channel Groups"})]}),y==="sources"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"mb-8",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[r.jsx(Qs,{className:"h-5 w-5"}),"M3U Playlists"]}),r.jsxs("button",{onClick:()=>g("m3u"),className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-sm rounded-lg",children:[r.jsx(Hi,{className:"h-4 w-4"}),"Add Playlist"]})]}),s?r.jsx("div",{className:"text-gray-400",children:"Loading..."}):t?.length?r.jsx("div",{className:"bg-gray-800 rounded-xl divide-y divide-gray-700",children:t.map(Ae=>r.jsxs("div",{className:"p-4 flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-white",children:Ae.name}),r.jsxs("p",{className:"text-sm text-gray-400",children:[Ae.channelCount," channels",Ae.lastRefresh&&r.jsxs(r.Fragment,{children:["  Last updated: ",new Date(Ae.lastRefresh).toLocaleDateString()]})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>H(Ae),className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:"Edit",children:r.jsx(dr,{className:"h-4 w-4"})}),r.jsx("button",{onClick:()=>u.mutate(Ae.id),disabled:u.isPending,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:"Refresh",children:r.jsx(vs,{className:`h-4 w-4 ${u.isPending?"animate-spin":""}`})}),r.jsx("button",{onClick:()=>c.mutate(Ae.id),className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg",title:"Delete",children:r.jsx(an,{className:"h-4 w-4"})})]})]},Ae.id))}):r.jsxs("div",{className:"text-center py-8 bg-gray-800 rounded-xl",children:[r.jsx(Qs,{className:"h-10 w-10 text-gray-600 mx-auto mb-3"}),r.jsx("p",{className:"text-gray-400",children:"No M3U playlists configured"})]})]}),r.jsxs("div",{className:"mb-8",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[r.jsx(_r,{className:"h-5 w-5 text-yellow-400"}),"Xtream Codes API"]}),r.jsxs("button",{onClick:()=>g("xtream"),className:"flex items-center gap-2 px-3 py-1.5 bg-yellow-600 hover:bg-yellow-700 text-white text-sm rounded-lg",children:[r.jsx(Hi,{className:"h-4 w-4"}),"Add Xtream"]})]}),$?r.jsx("div",{className:"text-gray-400",children:"Loading..."}):V?.length?r.jsx("div",{className:"bg-gray-800 rounded-xl divide-y divide-gray-700",children:V.map(Ae=>r.jsxs("div",{className:"p-4",children:[r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("h3",{className:"font-medium text-white",children:Ae.name}),!Ae.enabled&&r.jsx("span",{className:"px-2 py-0.5 bg-gray-700 text-gray-400 text-xs rounded",children:"Disabled"})]}),r.jsxs("p",{className:"text-sm text-gray-400",children:[Ae.channelCount," channels  ",Ae.username,"@",Ae.serverUrl.replace(/^https?:\/\//,"")]}),Ae.expirationDate&&r.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Expires: ",new Date(Ae.expirationDate).toLocaleDateString()]}),Ae.lastError&&r.jsxs("p",{className:"text-xs text-red-400 mt-1 flex items-center gap-1",children:[r.jsx(Ns,{className:"h-3 w-3"}),Ae.lastError]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>U(Ae),className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:"Edit",children:r.jsx(dr,{className:"h-4 w-4"})}),r.jsx("button",{onClick:()=>me.mutate(Ae.id),disabled:Z===Ae.id,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:"Refresh Channels",children:r.jsx(vs,{className:`h-4 w-4 ${Z===Ae.id?"animate-spin":""}`})}),r.jsx("button",{onClick:()=>X.mutate(Ae.id),className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg",title:"Delete",children:r.jsx(an,{className:"h-4 w-4"})})]})]}),(Ae.importVod||Ae.importSeries)&&r.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-700 flex flex-wrap gap-3",children:[Ae.importVod&&Ae.vodLibraryId&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-400",children:[r.jsx(Ki,{className:"h-4 w-4"}),r.jsxs("span",{children:["VOD: ",Ue?.[Ae.vodLibraryId]?.movieCount??Ae.vodCount??0," movies"]})]}),r.jsxs("button",{onClick:()=>ye.mutate(Ae.id),disabled:ve===Ae.id,className:"px-2 py-1 text-xs bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white rounded flex items-center gap-1",title:"Import VOD Movies",children:[ve===Ae.id?r.jsx(vs,{className:"h-3 w-3 animate-spin"}):r.jsx(Ri,{className:"h-3 w-3"}),"Import"]})]}),Ae.importSeries&&Ae.seriesLibraryId&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-400",children:[r.jsx(Sb,{className:"h-4 w-4"}),r.jsxs("span",{children:["Series: ",Ue?.[Ae.seriesLibraryId]?.showCount??Ae.seriesCount??0," shows (",Ue?.[Ae.seriesLibraryId]?.episodeCount??0," episodes)"]})]}),r.jsxs("button",{onClick:()=>Ie.mutate(Ae.id),disabled:ge===Ae.id,className:"px-2 py-1 text-xs bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 text-white rounded flex items-center gap-1",title:"Import TV Series",children:[ge===Ae.id?r.jsx(vs,{className:"h-3 w-3 animate-spin"}):r.jsx(Ri,{className:"h-3 w-3"}),"Import"]})]})]})]},Ae.id))}):r.jsxs("div",{className:"text-center py-8 bg-gray-800 rounded-xl",children:[r.jsx(_r,{className:"h-10 w-10 text-gray-600 mx-auto mb-3"}),r.jsx("p",{className:"text-gray-400",children:"No Xtream Codes sources configured"}),r.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Add your Xtream provider to import channels via API"})]})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[r.jsx(Xn,{className:"h-5 w-5"}),"EPG Sources"]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("button",{onClick:()=>d.mutate(),disabled:d.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded-lg",children:[r.jsx(vs,{className:`h-4 w-4 ${d.isPending?"animate-spin":""}`}),"Refresh All"]}),r.jsxs("button",{onClick:()=>g("epg"),className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-sm rounded-lg",children:[r.jsx(Hi,{className:"h-4 w-4"}),"Add EPG"]})]})]}),l?r.jsx("div",{className:"text-gray-400",children:"Loading..."}):a?.length?r.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:a.map(Ae=>r.jsx(XD,{source:Ae,onRefresh:ct=>qe.mutate(ct),onDelete:ct=>f.mutate(ct),onEdit:ct=>M(ct),isRefreshing:I===Ae.id},Ae.id))}):r.jsxs("div",{className:"text-center py-8 bg-gray-800 rounded-xl",children:[r.jsx(Xn,{className:"h-10 w-10 text-gray-600 mx-auto mb-3"}),r.jsx("p",{className:"text-gray-400",children:"No EPG sources configured"})]})]})]}),y==="programs"&&r.jsx(iI,{epgSources:a||[]}),y==="channels"&&r.jsxs("div",{children:[r.jsxs("div",{className:"mb-4 flex gap-3",children:[r.jsxs("div",{className:"relative flex-1",children:[r.jsx(Xs,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Search channels...",value:v,onChange:Ae=>E(Ae.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400"})]}),r.jsxs("button",{onClick:()=>L(!0),className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg flex items-center gap-2 whitespace-nowrap",children:[r.jsx(Xn,{className:"h-4 w-4"}),"Import Numbers"]})]}),Be?r.jsx("div",{className:"text-gray-400",children:"Loading channels..."}):Xi?.length?r.jsx("div",{className:"bg-gray-800 rounded-xl overflow-hidden",children:r.jsx("div",{className:"max-h-[600px] overflow-y-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"sticky top-0 bg-gray-800 border-b border-gray-700",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium",children:"Enabled"}),r.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium",children:"#"}),r.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium",children:"Channel"}),r.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium",children:"Group"}),r.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium",children:r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(EN,{className:"h-3 w-3"}),"Catch-up"]})}),r.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium",children:"Actions"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-700",children:Xi.map(Ae=>r.jsxs("tr",{className:Ae.enabled?"":"opacity-50",children:[r.jsx("td",{className:"p-3",children:r.jsx("button",{onClick:()=>Ge.mutate({id:Ae.id,enabled:!Ae.enabled}),className:`w-5 h-5 rounded border flex items-center justify-center ${Ae.enabled?"bg-indigo-600 border-indigo-600":"border-gray-500 hover:border-gray-400"}`,children:Ae.enabled&&r.jsx(Ys,{className:"h-3 w-3 text-white"})})}),r.jsx("td",{className:"p-3 text-gray-400 text-sm",children:Ae.number}),r.jsx("td",{className:"p-3",children:r.jsxs("div",{className:"flex items-center gap-3",children:[Ae.logo?r.jsx("img",{src:Ae.logo,alt:Ae.name,className:"w-8 h-8 object-contain bg-gray-700 rounded"}):r.jsx("div",{className:"w-8 h-8 bg-gray-700 rounded flex items-center justify-center",children:r.jsx(vr,{className:"h-4 w-4 text-gray-500"})}),r.jsxs("div",{children:[r.jsx("div",{className:"text-white text-sm",children:Ae.name}),r.jsx("div",{className:"text-gray-500 text-xs",children:Ae.channelId})]})]})}),r.jsx("td",{className:"p-3 text-gray-400 text-sm",children:Ae.group||"-"}),r.jsx("td",{className:"p-3",children:r.jsxs("button",{onClick:()=>yt.mutate({id:Ae.id,enabled:!Ae.archiveEnabled}),disabled:!Ae.enabled,className:`px-2 py-1 rounded text-xs font-medium flex items-center gap-1 ${Ae.archiveEnabled?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-700 text-gray-400 hover:bg-gray-600 hover:text-white"} ${Ae.enabled?"":"opacity-50 cursor-not-allowed"}`,title:Ae.archiveEnabled?"Disable catch-up recording":"Enable catch-up recording (7 days)",children:[r.jsx(Li,{className:"h-3 w-3"}),Ae.archiveEnabled?`${Ae.archiveDays||7}d`:"Off"]})}),r.jsx("td",{className:"p-3",children:r.jsx("button",{onClick:()=>R(Ae),className:"p-1.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded",title:"Edit",children:r.jsx(dr,{className:"h-4 w-4"})})})]},Ae.id))})]})})}):r.jsxs("div",{className:"text-center py-8 bg-gray-800 rounded-xl",children:[r.jsx(vr,{className:"h-10 w-10 text-gray-600 mx-auto mb-3"}),r.jsx("p",{className:"text-gray-400",children:v?"No channels match your search":"No channels loaded"})]})]}),y==="groups"&&r.jsxs("div",{children:[r.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[r.jsxs("div",{className:"text-sm text-gray-400",children:[He?.length||0," channel group",He?.length!==1?"s":""]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("button",{onClick:mi,disabled:Ms,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 text-white rounded-lg flex items-center gap-2",children:[Ms?r.jsx(vs,{className:"h-4 w-4 animate-spin"}):r.jsx(Qu,{className:"h-4 w-4"}),"Auto-Detect Duplicates"]}),r.jsxs("button",{onClick:()=>se(!0),className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg flex items-center gap-2",children:[r.jsx(Hi,{className:"h-4 w-4"}),"Create Group"]})]})]}),dt?r.jsx("div",{className:"text-gray-400",children:"Loading channel groups..."}):He?.length?r.jsx("div",{className:"space-y-4",children:He.map(Ae=>r.jsx(nI,{group:Ae,channels:ue||[],onEdit:()=>re(Ae),onDelete:()=>{confirm(`Delete group "${Ae.name}"?`)&&os.mutate(Ae.id)},onAddMember:(ct,Lt)=>Se.mutate({groupId:Ae.id,channelId:ct,priority:Lt}),onUpdatePriority:(ct,Lt)=>ze.mutate({groupId:Ae.id,channelId:ct,priority:Lt}),onRemoveMember:ct=>ot.mutate({groupId:Ae.id,channelId:ct})},Ae.id))}):r.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[r.jsx(og,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No Channel Groups"}),r.jsx("p",{className:"text-gray-400 mb-4",children:"Create groups to combine duplicate channels from different sources with automatic failover."}),r.jsxs("button",{onClick:mi,disabled:Ms,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 text-white rounded-lg inline-flex items-center gap-2",children:[Ms?r.jsx(vs,{className:"h-4 w-4 animate-spin"}):r.jsx(Qu,{className:"h-4 w-4"}),"Auto-Detect Duplicates"]})]})]}),m==="m3u"&&r.jsx(xv,{type:"m3u",onClose:()=>g(null)}),m==="epg"&&r.jsx(xv,{type:"epg",onClose:()=>g(null)}),m==="xtream"&&r.jsx(sI,{onClose:()=>g(null)}),A&&r.jsx(QD,{channel:A,onClose:()=>R(null),epgSources:a||[]}),D&&r.jsx(ZD,{onClose:()=>L(!1)}),O&&r.jsx(JD,{source:O,onClose:()=>H(null)}),q&&r.jsx(eI,{source:q,onClose:()=>U(null)}),k&&r.jsx(tI,{source:k,onClose:()=>M(null)}),Q&&r.jsx(vv,{onClose:()=>se(!1),onSave:Ae=>Ot.mutate(Ae),isLoading:Ot.isPending}),ie&&r.jsx(vv,{group:ie,onClose:()=>re(null),onSave:Ae=>ns.mutate({id:ie.id,data:Ae}),isLoading:ns.isPending}),oe&&vt&&r.jsx(aI,{results:vt,onClose:()=>{Y(!1),Zs(null)},onCreateGroup:async Ae=>{const ct=await Le.createChannelGroup({name:Ae.name,displayNumber:Ae.channels[0]?.number||0,logo:Ae.channels[0]?.logo});for(let Lt=0;Lt<Ae.channels.length;Lt++)await Le.addChannelToGroup(ct.id,Ae.channels[Lt].id,Lt);e.invalidateQueries({queryKey:["channelGroups"]})},isCreating:!1})]})}function oI(){const i=Ct(),[e,t]=K.useState(""),[s,a]=K.useState(null),[l,c]=K.useState(null),[u,f]=K.useState(new Set),[d,m]=K.useState(null),[g,y]=K.useState(""),[x,v]=K.useState(""),E=K.useRef(null),{data:A}=it({queryKey:["channels"],queryFn:async()=>(await(await fetch("/livetv/channels",{headers:{"X-Plex-Token":Le.getToken()||""}})).json()).channels}),{data:R}=it({queryKey:["epgSources"],queryFn:async()=>await Le.getEPGSources()}),{data:D,isLoading:L}=it({queryKey:["allEPGPrograms",s],queryFn:()=>Le.getEPGPrograms({epgSourceId:s||void 0,limit:1e4}),enabled:!!s}),O=Ze({mutationFn:async ue=>{const Be=await fetch(`/livetv/channels/${ue.channelId}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Plex-Token":Le.getToken()||""},body:JSON.stringify({epgSourceId:ue.epgSourceId,channelId:ue.epgChannelId})});if(!Be.ok)throw new Error("Failed to update channel");return Be.json()},onSuccess:()=>{i.invalidateQueries({queryKey:["channels"]}),c(null)}}),H=Ze({mutationFn:async ue=>{const Be=await fetch("/livetv/channels/bulk-map",{method:"POST",headers:{"Content-Type":"application/json","X-Plex-Token":Le.getToken()||""},body:JSON.stringify({channelIds:ue.channelIds,epgSourceId:ue.epgSourceId,epgChannelId:ue.epgChannelId})});if(!Be.ok)throw new Error("Failed to bulk map channels");return Be.json()},onSuccess:()=>{i.invalidateQueries({queryKey:["channels"]}),f(new Set),m(null)}}),q=Ze({mutationFn:async ue=>{const Be=await fetch(`/livetv/channels/${ue}/epg-mapping`,{method:"DELETE",headers:{"X-Plex-Token":Le.getToken()||""}});if(!Be.ok)throw new Error("Failed to unmap channel");return Be.json()},onSuccess:()=>{i.invalidateQueries({queryKey:["channels"]})}}),U=new Map;D?.programs.forEach(ue=>{U.has(ue.channelId)||U.set(ue.channelId,[]),U.get(ue.channelId).push(ue)});const k=new Date,M=Array.from(U.entries()).map(([ue,Be])=>{const Ge=Be.find(dt=>new Date(dt.start)<=k&&new Date(dt.end)>k),yt=Be.find(dt=>new Date(dt.start)>k),He=Be.sort((dt,Ot)=>new Date(Ot.start).getTime()-new Date(dt.start).getTime())[0];return{channelId:ue,currentProgram:Ge||yt||He,programCount:Be.length}}).filter(ue=>ue.currentProgram),I=M.filter(ue=>ue.channelId.toLowerCase().includes(e.toLowerCase())||ue.currentProgram.callSign?.toLowerCase().includes(e.toLowerCase())||ue.currentProgram.channelNo?.toLowerCase().includes(e.toLowerCase())||ue.currentProgram.affiliateName?.toLowerCase().includes(e.toLowerCase())||ue.currentProgram.title.toLowerCase().includes(e.toLowerCase())||ue.currentProgram.description?.toLowerCase().includes(e.toLowerCase())),j=(ue,Be)=>{s&&O.mutate({channelId:Be,epgSourceId:s,epgChannelId:ue})},Z=ue=>A?.filter(Be=>Be.channelId===ue&&Be.epgSourceId===s)||[],ae=ue=>{const Be=new Set(u);Be.has(ue)?Be.delete(ue):Be.add(ue),f(Be)},ie=ue=>{!s||u.size===0||H.mutate({channelIds:Array.from(u),epgSourceId:s,epgChannelId:ue})},re={"NEW YORK":{CBS:"WCBS",NBC:"WNBC",ABC:"WABC",FOX:"WNYW",CW:"WPIX",PBS:"WNET"},"LOS ANGELES":{CBS:"KCBS",NBC:"KNBC",ABC:"KABC",FOX:"KTTV",CW:"KTLA",PBS:"KCET"},CHICAGO:{CBS:"WBBM",NBC:"WMAQ",ABC:"WLS",FOX:"WFLD",CW:"WGN",PBS:"WTTW"},PHILADELPHIA:{CBS:"KYW",NBC:"WCAU",ABC:"WPVI",FOX:"WTXF",CW:"WPHL",PBS:"WHYY"},DALLAS:{CBS:"KTVT",NBC:"KXAS",ABC:"WFAA",FOX:"KDFW",CW:"KDAF",PBS:"KERA"},"SAN FRANCISCO":{CBS:"KPIX",NBC:"KNTV",ABC:"KGO",FOX:"KTVU",CW:"KBCW",PBS:"KQED"},BOSTON:{CBS:"WBZ",NBC:"WBTS",ABC:"WCVB",FOX:"WFXT",CW:"WLVI",PBS:"WGBH"},ATLANTA:{CBS:"WGCL",NBC:"WXIA",ABC:"WSB",FOX:"WAGA",CW:"WPCH",PBS:"WGTV"},SEATTLE:{CBS:"KIRO",NBC:"KING",ABC:"KOMO",FOX:"KCPQ",CW:"KSTW",PBS:"KCTS"},HOUSTON:{CBS:"KHOU",NBC:"KPRC",ABC:"KTRK",FOX:"KRIV",CW:"KIAH",PBS:"KUHT"},DENVER:{CBS:"KCNC",NBC:"KUSA",ABC:"KMGH",FOX:"KDVR",CW:"KWGN",PBS:"KRMA"},PHOENIX:{CBS:"KPHO",NBC:"KPNX",ABC:"KNXV",FOX:"KSAZ",CW:"KASW",PBS:"KAET"},MINNEAPOLIS:{CBS:"WCCO",NBC:"KARE",ABC:"KSTP",FOX:"KMSP",CW:"WUCW",PBS:"TPT"},MIAMI:{CBS:"WFOR",NBC:"WTVJ",ABC:"WPLG",FOX:"WSVN",CW:"WSFL",PBS:"WPBT"},"WASHINGTON DC":{CBS:"WUSA",NBC:"WRC",ABC:"WJLA",FOX:"WTTG",CW:"WDCW",PBS:"WETA"},DETROIT:{CBS:"WWJ",NBC:"WDIV",ABC:"WXYZ",FOX:"WJBK",CW:"WKBD",PBS:"WTVS"}},Q=ue=>{const Be=ue.toUpperCase(),Ge={"NEW YORK":["NEW YORK","NY ","NYC","A3 NEW YORK","WCBS","WNBC","WABC","WNYW","WPIX"],"LOS ANGELES":["LOS ANGELES","LA ","L.A.","KCBS","KNBC","KABC","KTTV","KTLA"],CHICAGO:["CHICAGO","CHI","WBBM","WMAQ","WLS","WFLD","WGN"],PHILADELPHIA:["PHILADELPHIA","PHILLY","KYW","WCAU","WPVI"],DALLAS:["DALLAS","DFW","KTVT","KXAS","WFAA","KDFW"],"SAN FRANCISCO":["SAN FRANCISCO","SF ","BAY AREA","KPIX","KNTV","KGO","KTVU"],BOSTON:["BOSTON","WBZ","WBTS","WCVB","WFXT"],ATLANTA:["ATLANTA","ATL","WGCL","WXIA","WSB","WAGA"],SEATTLE:["SEATTLE","SEA","KIRO","KING","KOMO","KCPQ"],HOUSTON:["HOUSTON","KHOU","KPRC","KTRK","KRIV"],DENVER:["DENVER","KCNC","KUSA","KMGH","KDVR"],PHOENIX:["PHOENIX","PHX","KPHO","KPNX","KNXV","KSAZ"],MINNEAPOLIS:["MINNEAPOLIS","TWIN CITIES","WCCO","KARE","KSTP","KMSP"],MIAMI:["MIAMI","WFOR","WTVJ","WPLG","WSVN"],"WASHINGTON DC":["WASHINGTON","DC","WUSA","WRC","WJLA","WTTG"],DETROIT:["DETROIT","WWJ","WDIV","WXYZ","WJBK"]};for(const[yt,He]of Object.entries(Ge))if(He.some(dt=>Be.includes(dt)))return yt;return null},se=()=>{const ue=R?.find(yt=>yt.id===s);if(!ue?.gracenotePostalCode)return null;const Be=ue.gracenotePostalCode.substring(0,3);return{100:"NEW YORK",101:"NEW YORK",102:"NEW YORK",103:"NEW YORK",104:"NEW YORK",105:"NEW YORK",106:"NEW YORK",107:"NEW YORK",108:"NEW YORK",109:"NEW YORK",110:"NEW YORK",111:"NEW YORK",112:"NEW YORK",113:"NEW YORK",114:"NEW YORK",900:"LOS ANGELES",901:"LOS ANGELES",902:"LOS ANGELES",903:"LOS ANGELES",904:"LOS ANGELES",905:"LOS ANGELES",906:"LOS ANGELES",907:"LOS ANGELES",908:"LOS ANGELES",910:"LOS ANGELES",911:"LOS ANGELES",912:"LOS ANGELES",913:"LOS ANGELES",914:"LOS ANGELES",915:"LOS ANGELES",916:"LOS ANGELES",917:"LOS ANGELES",918:"LOS ANGELES",600:"CHICAGO",601:"CHICAGO",602:"CHICAGO",603:"CHICAGO",604:"CHICAGO",605:"CHICAGO",606:"CHICAGO",607:"CHICAGO",608:"CHICAGO",190:"PHILADELPHIA",191:"PHILADELPHIA",192:"PHILADELPHIA",193:"PHILADELPHIA",194:"PHILADELPHIA",750:"DALLAS",751:"DALLAS",752:"DALLAS",753:"DALLAS",754:"DALLAS",755:"DALLAS",940:"SAN FRANCISCO",941:"SAN FRANCISCO",942:"SAN FRANCISCO",943:"SAN FRANCISCO",944:"SAN FRANCISCO",945:"SAN FRANCISCO",946:"SAN FRANCISCO",947:"SAN FRANCISCO","021":"BOSTON","022":"BOSTON","023":"BOSTON","024":"BOSTON",300:"ATLANTA",301:"ATLANTA",302:"ATLANTA",303:"ATLANTA",304:"ATLANTA",305:"ATLANTA",306:"ATLANTA",307:"ATLANTA",308:"ATLANTA",309:"ATLANTA",310:"ATLANTA",311:"ATLANTA",312:"ATLANTA",313:"ATLANTA",314:"ATLANTA",315:"ATLANTA",316:"ATLANTA",317:"ATLANTA",318:"ATLANTA",319:"ATLANTA",980:"SEATTLE",981:"SEATTLE",982:"SEATTLE",983:"SEATTLE",984:"SEATTLE",770:"HOUSTON",771:"HOUSTON",772:"HOUSTON",773:"HOUSTON",774:"HOUSTON",775:"HOUSTON",776:"HOUSTON",777:"HOUSTON",778:"HOUSTON",779:"HOUSTON",800:"DENVER",801:"DENVER",802:"DENVER",803:"DENVER",804:"DENVER",805:"DENVER",850:"PHOENIX",851:"PHOENIX",852:"PHOENIX",853:"PHOENIX",550:"MINNEAPOLIS",551:"MINNEAPOLIS",553:"MINNEAPOLIS",554:"MINNEAPOLIS",555:"MINNEAPOLIS",330:"MIAMI",331:"MIAMI",332:"MIAMI",333:"MIAMI",334:"MIAMI",200:"WASHINGTON DC",201:"WASHINGTON DC",202:"WASHINGTON DC",203:"WASHINGTON DC",204:"WASHINGTON DC",205:"WASHINGTON DC",206:"WASHINGTON DC",207:"WASHINGTON DC",208:"WASHINGTON DC",209:"WASHINGTON DC",210:"WASHINGTON DC",211:"WASHINGTON DC",212:"WASHINGTON DC",220:"WASHINGTON DC",221:"WASHINGTON DC",222:"WASHINGTON DC",223:"WASHINGTON DC",480:"DETROIT",481:"DETROIT",482:"DETROIT",483:"DETROIT",484:"DETROIT"}[Be]||null},oe=ue=>{const Be=ue.toUpperCase();return Be.includes("CBS")?"CBS":Be.includes("NBC")?"NBC":Be.includes("ABC")?"ABC":Be.includes("FOX")?"FOX":Be.includes("PBS")?"PBS":Be.includes("CW")?"CW":null},V=(()=>{const ue=se();if(!ue||u.size===0)return null;const Be=[];return u.forEach(Ge=>{const yt=A?.find(dt=>dt.id===Ge);if(!yt)return;const He=Q(yt.name);if(He&&He!==ue){const dt=oe(yt.name),Ot=dt&&re[ue]?.[dt];Be.push({channel:yt,m3uMarket:He,network:dt,localEquivalent:Ot})}}),Be.length>0?{epgMarket:ue,mismatches:Be}:null})(),$=ue=>{const Be={CBS:["CBS","WCBS","KCBS","KIRO","WBBM","KDKA","KYW","WJZ","WCCO","WWJ","KCNC","KTVT","KHOU","KPIX","KCAL","CBS TELEVISION"],NBC:["NBC","WNBC","KNBC","KING","WMAQ","WCAU","WRC","WTVJ","KXAS","NATIONAL BROADCASTING"],ABC:["ABC","WABC","KABC","KOMO","WLS","WPVI","KGO","WTVD","AMERICAN BROADCASTING"],FOX:["FOX","WNYW","KTTV","KCPQ","WFLD","WTXF","WTTG","KRIV","FOX ENTERTAINMENT"],PBS:["PBS","WNET","WGBH","KCTS","KCET","WETA","PUBLIC BROADCASTING"],CW:["CW","WPIX","KTLA","KSTW"],ESPN:["ESPN","ESPN2","ESPNU","ESPNEWS"],CNN:["CNN","HLN"],MSNBC:["MSNBC"],HBO:["HBO"],SHOWTIME:["SHOWTIME","SHO"],DISCOVERY:["DISCOVERY","TLC","HGTV","FOOD NETWORK"],NICKELODEON:["NICKELODEON","NICK","NICKJR","NICKTOONS"],DISNEY:["DISNEY","DISN","DXD"],CARTOON:["CARTOON","TOON","BOOMERANG"],AMC:["AMC"],TNT:["TNT","TBS","TRUTV"],USA:["USA NETWORK","USA"],FX:["FX","FXX","FXM"],BRAVO:["BRAVO"],SYFY:["SYFY","SCI-FI"],HALLMARK:["HALLMARK"],LIFETIME:["LIFETIME","LMN"],HISTORY:["HISTORY","H2"],NATGEO:["NAT GEO","NATIONAL GEOGRAPHIC","NGWILD"],COMEDY:["COMEDY CENTRAL","COMEDY"],MTV:["MTV","VH1","CMT"],BET:["BET"],OXYGEN:["OXYGEN"],ANIMAL:["ANIMAL PLANET"]},Ge=ue.toUpperCase(),yt=[];for(const[He,dt]of Object.entries(Be))for(const Ot of dt)if(Ge.includes(Ot)){yt.push(He),yt.push(Ot);const ns=se();ns&&re[ns]?.[He]&&yt.push(re[ns][He]);break}return yt},X=()=>{if(u.size===0)return[];const ue=[];return u.forEach(Be=>{const Ge=A?.find(yt=>yt.id===Be);Ge&&ue.push(...$(Ge.name))}),[...new Set(ue)]},me=(ue,Be)=>{if(Be.length===0)return!1;const Ge=ue.currentProgram.callSign?.toUpperCase()||"",yt=ue.currentProgram.affiliateName?.toUpperCase()||"",He=ue.channelId.toUpperCase();return Be.some(dt=>Ge.includes(dt)||yt.includes(dt)||He.includes(dt))},ve=X(),pe=ve.length>0?I.filter(ue=>me(ue,ve)):[],ge=ve.length>0?I.filter(ue=>!me(ue,ve)):I,ee=K.useMemo(()=>{if(!A)return[];if(!g.trim())return A;const ue=g.toLowerCase();return A.filter(Be=>Be.name.toLowerCase().includes(ue)||Be.number.toString().includes(ue)||Be.group?.toLowerCase().includes(ue))},[A,g]),ye=K.useMemo(()=>{const ue={};return ee.forEach(Be=>{const Ge=Be.group||"Uncategorized";ue[Ge]||(ue[Ge]=[]),ue[Ge].push(Be)}),Object.entries(ue).sort((Be,Ge)=>Be[0].localeCompare(Ge[0]))},[ee]),Ie=K.useMemo(()=>{if(!A)return[];if(!x.trim())return A;const ue=x.toLowerCase();return A.filter(Be=>Be.name.toLowerCase().includes(ue)||Be.number.toString().includes(ue)||Be.group?.toLowerCase().includes(ue))},[A,x]),Ue=K.useMemo(()=>{const ue={};return Ie.forEach(Be=>{const Ge=Be.group||"Uncategorized";ue[Ge]||(ue[Ge]=[]),ue[Ge].push(Be)}),Object.entries(ue).sort((Be,Ge)=>Be[0].localeCompare(Ge[0]))},[Ie]);K.useEffect(()=>{l&&E.current&&E.current.focus()},[l]);const qe=()=>{c(null),y("")};return r.jsxs("div",{className:"h-screen flex flex-col bg-gray-900",children:[r.jsxs("div",{className:"p-6 border-b border-gray-700",children:[r.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"EPG Mapper - Simple Mode"}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Select EPG Source"}),r.jsxs("select",{value:s||"",onChange:ue=>a(ue.target.value?parseInt(ue.target.value):null),className:"w-full max-w-md px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white",children:[r.jsx("option",{value:"",children:"Choose an EPG source..."}),R?.map(ue=>r.jsxs("option",{value:ue.id,children:[ue.name," (",ue.channelCount," channels, ",ue.programCount," programs)"]},ue.id))]})]}),s&&r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("div",{className:"relative max-w-md flex-1",children:[r.jsx(Xs,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Search EPG channels or programs...",value:e,onChange:ue=>t(ue.target.value),className:"w-full pl-10 pr-10 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400"}),e&&r.jsx("button",{onClick:()=>t(""),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 hover:bg-gray-700 rounded",title:"Clear search",children:r.jsx(jt,{className:"h-4 w-4 text-gray-400"})})]}),e&&r.jsxs("button",{onClick:()=>t(""),className:"px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg text-sm font-medium",children:["Clear Filter - Show All ",M.length," Channels"]})]})]}),s&&r.jsxs("div",{className:"px-6 py-3 bg-gray-800 border-b border-gray-700 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Ys,{className:"h-5 w-5 text-indigo-400"}),r.jsx("span",{className:"text-white font-medium",children:u.size>0?`${u.size} M3U channel(s) selected`:"Select M3U channels to bulk map"})]}),r.jsxs("div",{className:"flex gap-2",children:[u.size>0&&r.jsx("button",{onClick:()=>f(new Set),className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded",children:"Clear Selection"}),r.jsxs("button",{onClick:()=>m("selecting"),className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-sm rounded flex items-center gap-1.5",children:[r.jsx(Ys,{className:"h-4 w-4"}),u.size>0?`Selected ${u.size} channels`:"Select M3U Channels..."]})]})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:s?L?r.jsxs("div",{className:"text-center py-12",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto"}),r.jsx("p",{className:"text-gray-400 mt-4",children:"Loading EPG channels..."})]}):r.jsxs("div",{className:"max-w-6xl mx-auto",children:[r.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[r.jsxs("span",{className:"text-sm text-gray-400",children:["Showing ",I.length," of ",M.length," EPG channels",e&&r.jsxs("span",{className:"ml-1 text-yellow-400",children:['(filtered by "',e,'")']})]}),ve.length>0&&pe.length>0&&r.jsxs("span",{className:"text-sm text-green-400",children:["(",pe.length," suggested matches)"]}),e&&r.jsx("button",{onClick:()=>t(""),className:"text-sm text-yellow-400 hover:text-yellow-300 underline",children:"Clear filter to see all channels"})]}),V&&r.jsx("div",{className:"mb-6 bg-yellow-900/30 border-2 border-yellow-600/50 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("span",{className:"text-2xl",children:""}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h3",{className:"font-bold text-yellow-400 text-lg mb-2",children:"Market Mismatch Detected"}),r.jsxs("p",{className:"text-yellow-200 mb-3",children:["Your EPG source is for ",r.jsx("span",{className:"font-bold",children:V.epgMarket}),", but some selected M3U channels appear to be from different markets:"]}),r.jsx("div",{className:"space-y-2 mb-4",children:V.mismatches.map(({channel:ue,m3uMarket:Be,network:Ge,localEquivalent:yt})=>r.jsxs("div",{className:"bg-yellow-900/30 rounded p-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-white font-medium",children:ue.name}),r.jsxs("span",{className:"text-yellow-300 ml-2",children:["(",Be,")"]})]}),yt&&r.jsxs("div",{className:"text-sm",children:[r.jsxs("span",{className:"text-gray-400",children:["Local ",Ge,": "]}),r.jsx("span",{className:"text-green-400 font-bold",children:yt})]})]}),yt&&r.jsxs("p",{className:"text-sm text-yellow-200/70 mt-1",children:[" Look for ",r.jsx("span",{className:"font-bold text-green-400",children:yt})," in the suggestions below - it's the ",V.epgMarket," ",Ge," affiliate"]})]},ue.id))}),r.jsx("p",{className:"text-sm text-yellow-200/70",children:"You can still map these channels, but the EPG data may not match. Consider adding an EPG source for the channel's market or use the local equivalent."})]})]})}),u.size>0&&pe.length>0&&r.jsxs("div",{className:"mb-6",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[r.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full animate-pulse"}),r.jsx("h2",{className:"text-lg font-semibold text-green-400",children:" Suggested Matches for Your Selection"})]}),r.jsxs("p",{className:"text-sm text-gray-400 mb-3",children:["Based on your selected M3U channel(s), these EPG channels are likely matches",se()&&r.jsxs("span",{className:"text-blue-400",children:[" in ",se()]}),":"]}),r.jsx("div",{className:"space-y-3",children:pe.map(ue=>{const Be=new Date(ue.currentProgram.start)<=k&&new Date(ue.currentProgram.end)>k;return r.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border-2 border-green-600/50 shadow-lg shadow-green-900/20",children:r.jsxs("div",{className:"flex items-start justify-between gap-4",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsxs("h3",{className:"font-semibold text-white text-lg",children:[ue.currentProgram.callSign||ue.channelId.replace(/^(gracenote|fubo)-/,""),ue.currentProgram.channelNo&&r.jsxs("span",{className:"ml-2 text-gray-400",children:["Ch ",ue.currentProgram.channelNo]})]}),ue.currentProgram.affiliateName&&r.jsx("span",{className:"px-3 py-1 bg-green-600 text-white text-sm rounded font-medium",children:ue.currentProgram.affiliateName}),Be&&r.jsx("span",{className:"px-2 py-0.5 bg-red-600 text-white text-xs rounded font-medium",children:"LIVE NOW"})]}),r.jsxs("div",{className:"mb-1",children:[r.jsx("p",{className:"text-white font-medium",children:ue.currentProgram.title}),ue.currentProgram.description&&r.jsx("p",{className:"text-sm text-gray-400 line-clamp-2 mt-1",children:ue.currentProgram.description})]}),Z(ue.channelId).length>0&&r.jsxs("div",{className:"mt-3 space-y-1.5",children:[r.jsx("p",{className:"text-xs text-gray-400 font-medium",children:"Mapped M3U Channels:"}),Z(ue.channelId).map(Ge=>r.jsxs("div",{className:"flex items-center gap-2 text-sm bg-gray-700/50 rounded px-2 py-1.5",children:[r.jsx(Ys,{className:"h-3.5 w-3.5 text-green-400 flex-shrink-0"}),r.jsxs("span",{className:"text-white flex-1",children:[Ge.name," (#",Ge.number,")"]}),r.jsx("button",{onClick:()=>q.mutate(Ge.id),className:"text-red-400 hover:text-red-300 text-xs px-2 py-0.5 hover:bg-red-900/20 rounded",children:"Unmap"})]},Ge.id))]})]}),r.jsx("div",{className:"flex-shrink-0",children:r.jsxs("button",{onClick:()=>ie(ue.channelId),className:"px-6 py-3 bg-green-600 hover:bg-green-700 text-white text-sm rounded-lg font-bold flex items-center gap-2 shadow-lg",children:[r.jsx(Ys,{className:"h-5 w-5"}),"Map ",u.size," Here"]})})]})},ue.channelId)})}),ge.length>0&&r.jsx("div",{className:"mt-6 mb-3",children:r.jsx("h2",{className:"text-lg font-semibold text-gray-400",children:"Other EPG Channels"})})]}),r.jsx("div",{className:"space-y-3",children:(u.size>0&&pe.length>0?ge:I).map(ue=>{const Be=new Date(ue.currentProgram.start)<=k&&new Date(ue.currentProgram.end)>k;return r.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:r.jsxs("div",{className:"flex items-start justify-between gap-4",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsxs("h3",{className:"font-semibold text-white",children:[ue.currentProgram.callSign||ue.channelId.replace(/^(gracenote|fubo)-/,""),ue.currentProgram.channelNo&&r.jsxs("span",{className:"ml-2 text-gray-400",children:["Ch ",ue.currentProgram.channelNo]})]}),ue.currentProgram.affiliateName&&r.jsx("span",{className:"px-2 py-0.5 bg-blue-600 text-white text-xs rounded",children:ue.currentProgram.affiliateName}),Be&&r.jsx("span",{className:"px-2 py-0.5 bg-red-600 text-white text-xs rounded font-medium",children:"LIVE NOW"}),r.jsxs("span",{className:"text-xs text-gray-500",children:[ue.programCount," programs"]})]}),r.jsxs("div",{className:"mb-1",children:[r.jsx("p",{className:"text-white font-medium",children:ue.currentProgram.title}),ue.currentProgram.description&&r.jsx("p",{className:"text-sm text-gray-400 line-clamp-2 mt-1",children:ue.currentProgram.description})]}),r.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[r.jsx("span",{children:new Date(ue.currentProgram.start).toLocaleString()}),ue.currentProgram.category&&r.jsx("span",{className:"px-2 py-1 bg-gray-700 rounded",children:ue.currentProgram.category})]}),Z(ue.channelId).length>0&&r.jsxs("div",{className:"mt-3 space-y-1.5",children:[r.jsx("p",{className:"text-xs text-gray-400 font-medium",children:"Mapped M3U Channels:"}),Z(ue.channelId).map(Ge=>r.jsxs("div",{className:"flex items-center gap-2 text-sm bg-gray-700/50 rounded px-2 py-1.5",children:[r.jsx(Ys,{className:"h-3.5 w-3.5 text-green-400 flex-shrink-0"}),r.jsxs("span",{className:"text-white flex-1",children:[Ge.name," (#",Ge.number,")"]}),r.jsx("button",{onClick:()=>q.mutate(Ge.id),className:"text-red-400 hover:text-red-300 text-xs px-2 py-0.5 hover:bg-red-900/20 rounded",title:"Remove mapping",children:"Unmap"})]},Ge.id))]})]}),r.jsxs("div",{className:"flex-shrink-0 flex flex-col gap-2",children:[u.size>0&&r.jsxs("button",{onClick:()=>ie(ue.channelId),className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm rounded font-medium flex items-center gap-1.5",children:[r.jsx(Ys,{className:"h-4 w-4"}),"Map ",u.size," Selected Here"]}),r.jsx("button",{onClick:()=>c(ue.channelId),className:`px-4 py-2 rounded text-sm font-medium ${Z(ue.channelId).length>0?"bg-gray-700 hover:bg-gray-600 text-white":"bg-indigo-600 hover:bg-indigo-700 text-white"}`,children:Z(ue.channelId).length>0?"Map Another":"Map Channel"})]})]})},ue.channelId)})})]}):r.jsx("div",{className:"text-center py-12 text-gray-400",children:r.jsx("p",{children:"Select an EPG source above to start mapping channels"})})}),d==="selecting"&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>{m(null),v("")},children:r.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] flex flex-col",onClick:ue=>ue.stopPropagation(),children:[r.jsxs("div",{className:"p-4 border-b border-gray-700",children:[r.jsx("h2",{className:"text-xl font-bold text-white",children:"Select M3U Channels to Map"}),r.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Choose the M3U channels you want to map to an EPG channel"}),r.jsxs("div",{className:"relative mt-3",children:[r.jsx(Xs,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Search channels by name, number, or group...",value:x,onChange:ue=>v(ue.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 text-sm",autoFocus:!0}),x&&r.jsx("button",{onClick:()=>v(""),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 hover:bg-gray-600 rounded",children:r.jsx(jt,{className:"h-4 w-4 text-gray-400"})})]}),r.jsxs("div",{className:"text-xs text-gray-400 mt-2",children:[Ie.length," channel",Ie.length!==1?"s":""," found",x&&` for "${x}"`]})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:!A||A.length===0?r.jsx("div",{className:"text-center py-8 text-gray-400",children:r.jsx("p",{children:"No M3U channels available"})}):Ie.length===0?r.jsx("div",{className:"text-center py-8 text-gray-400",children:r.jsx("p",{children:"No channels match your search"})}):Ue.length>1?r.jsx("div",{className:"space-y-4",children:Ue.map(([ue,Be])=>r.jsxs("div",{children:[r.jsxs("div",{className:"px-2 py-1.5 bg-gray-700 rounded text-sm font-semibold text-gray-300 mb-2 flex items-center justify-between",children:[r.jsx("span",{children:ue}),r.jsxs("span",{className:"text-xs text-gray-400",children:[Be.length," channels"]})]}),r.jsx("div",{className:"space-y-2",children:Be.map(Ge=>r.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors ${u.has(Ge.id)?"bg-indigo-900/40 border-2 border-indigo-600":"bg-gray-700/50 border-2 border-transparent hover:bg-gray-700"}`,children:[r.jsx("input",{type:"checkbox",checked:u.has(Ge.id),onChange:()=>ae(Ge.id),className:"w-4 h-4 rounded border-gray-500 bg-gray-600 text-indigo-600 focus:ring-indigo-500"}),Ge.logo&&r.jsx("img",{src:Ge.logo,alt:"",className:"w-8 h-8 rounded object-cover"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"text-white font-medium",children:Ge.name}),r.jsxs("div",{className:"text-xs text-gray-400",children:["Channel #",Ge.number]})]}),Ge.epgSourceId&&r.jsx("span",{className:"text-xs text-green-400",children:"Already mapped"})]},Ge.id))})]},ue))}):r.jsx("div",{className:"space-y-2",children:Ie.map(ue=>r.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors ${u.has(ue.id)?"bg-indigo-900/40 border-2 border-indigo-600":"bg-gray-700/50 border-2 border-transparent hover:bg-gray-700"}`,children:[r.jsx("input",{type:"checkbox",checked:u.has(ue.id),onChange:()=>ae(ue.id),className:"w-4 h-4 rounded border-gray-500 bg-gray-600 text-indigo-600 focus:ring-indigo-500"}),ue.logo&&r.jsx("img",{src:ue.logo,alt:"",className:"w-8 h-8 rounded object-cover"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"text-white font-medium",children:ue.name}),r.jsxs("div",{className:"text-xs text-gray-400",children:["Channel #",ue.number]})]}),ue.epgSourceId&&r.jsx("span",{className:"text-xs text-green-400",children:"Already mapped"})]},ue.id))})}),r.jsxs("div",{className:"p-4 border-t border-gray-700 flex items-center justify-between",children:[r.jsxs("span",{className:"text-sm text-gray-400",children:[u.size," channel(s) selected"]}),r.jsx("div",{className:"flex gap-2",children:r.jsx("button",{onClick:()=>{m(null),v("")},className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded",children:"Done"})})]})]})}),l&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:qe,children:r.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] flex flex-col",onClick:ue=>ue.stopPropagation(),children:[r.jsxs("div",{className:"p-4 border-b border-gray-700",children:[r.jsx("h2",{className:"text-xl font-bold text-white",children:"Map M3U Channel to EPG"}),r.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["Select an M3U channel to map to: ",r.jsx("span",{className:"text-indigo-400 font-medium",children:M.find(ue=>ue.channelId===l)?.currentProgram.callSign||l})]}),r.jsxs("div",{className:"relative mt-3",children:[r.jsx(Xs,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),r.jsx("input",{ref:E,type:"text",placeholder:"Search M3U channels by name, number, or group...",value:g,onChange:ue=>y(ue.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 text-sm",autoFocus:!0}),g&&r.jsx("button",{onClick:()=>y(""),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 hover:bg-gray-600 rounded",children:r.jsx(jt,{className:"h-4 w-4 text-gray-400"})})]}),r.jsxs("div",{className:"text-xs text-gray-400 mt-2",children:[ee.length," channel",ee.length!==1?"s":""," found",g&&` for "${g}"`]})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:!A||A.length===0?r.jsx("div",{className:"text-center py-8 text-gray-400",children:r.jsx("p",{children:"No M3U channels available"})}):ee.length===0?r.jsx("div",{className:"text-center py-8 text-gray-400",children:r.jsx("p",{children:"No channels match your search"})}):ye.length>1?r.jsx("div",{className:"space-y-4",children:ye.map(([ue,Be])=>r.jsxs("div",{children:[r.jsxs("div",{className:"px-2 py-1.5 bg-gray-700 rounded text-sm font-semibold text-gray-300 mb-2 flex items-center justify-between",children:[r.jsx("span",{children:ue}),r.jsxs("span",{className:"text-xs text-gray-400",children:[Be.length," channels"]})]}),r.jsx("div",{className:"space-y-1",children:Be.map(Ge=>r.jsxs("button",{onClick:()=>{j(l,Ge.id),qe()},className:"w-full flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors bg-gray-700/50 hover:bg-indigo-900/40 hover:border-indigo-600 border-2 border-transparent",children:[Ge.logo&&r.jsx("img",{src:Ge.logo,alt:"",className:"w-8 h-8 rounded object-cover"}),r.jsxs("div",{className:"flex-1 text-left",children:[r.jsx("div",{className:"text-white font-medium",children:Ge.name}),r.jsxs("div",{className:"text-xs text-gray-400",children:["Channel #",Ge.number]})]}),Ge.epgSourceId&&r.jsx("span",{className:"text-xs text-green-400",children:"Already mapped"})]},Ge.id))})]},ue))}):r.jsx("div",{className:"space-y-1",children:ee.map(ue=>r.jsxs("button",{onClick:()=>{j(l,ue.id),qe()},className:"w-full flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors bg-gray-700/50 hover:bg-indigo-900/40 hover:border-indigo-600 border-2 border-transparent",children:[ue.logo&&r.jsx("img",{src:ue.logo,alt:"",className:"w-8 h-8 rounded object-cover"}),r.jsxs("div",{className:"flex-1 text-left",children:[r.jsx("div",{className:"text-white font-medium",children:ue.name}),r.jsxs("div",{className:"text-xs text-gray-400",children:["Channel #",ue.number]})]}),ue.epgSourceId&&r.jsx("span",{className:"text-xs text-green-400",children:"Already mapped"})]},ue.id))})}),r.jsx("div",{className:"p-4 border-t border-gray-700 flex justify-end",children:r.jsx("button",{onClick:qe,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded",children:"Cancel"})})]})})]})}const We=Number.isFinite||function(i){return typeof i=="number"&&isFinite(i)},lI=Number.isSafeInteger||function(i){return typeof i=="number"&&Math.abs(i)<=cI},cI=Number.MAX_SAFE_INTEGER||9007199254740991;let et=(function(i){return i.NETWORK_ERROR="networkError",i.MEDIA_ERROR="mediaError",i.KEY_SYSTEM_ERROR="keySystemError",i.MUX_ERROR="muxError",i.OTHER_ERROR="otherError",i})({}),be=(function(i){return i.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",i.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",i.KEY_SYSTEM_NO_SESSION="keySystemNoSession",i.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",i.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",i.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",i.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",i.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",i.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",i.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",i.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",i.MANIFEST_LOAD_ERROR="manifestLoadError",i.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",i.MANIFEST_PARSING_ERROR="manifestParsingError",i.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",i.LEVEL_EMPTY_ERROR="levelEmptyError",i.LEVEL_LOAD_ERROR="levelLoadError",i.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",i.LEVEL_PARSING_ERROR="levelParsingError",i.LEVEL_SWITCH_ERROR="levelSwitchError",i.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",i.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",i.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",i.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",i.FRAG_LOAD_ERROR="fragLoadError",i.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",i.FRAG_DECRYPT_ERROR="fragDecryptError",i.FRAG_PARSING_ERROR="fragParsingError",i.FRAG_GAP="fragGap",i.REMUX_ALLOC_ERROR="remuxAllocError",i.KEY_LOAD_ERROR="keyLoadError",i.KEY_LOAD_TIMEOUT="keyLoadTimeOut",i.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",i.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",i.BUFFER_APPEND_ERROR="bufferAppendError",i.BUFFER_APPENDING_ERROR="bufferAppendingError",i.BUFFER_STALLED_ERROR="bufferStalledError",i.BUFFER_FULL_ERROR="bufferFullError",i.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",i.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",i.ASSET_LIST_LOAD_ERROR="assetListLoadError",i.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",i.ASSET_LIST_PARSING_ERROR="assetListParsingError",i.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",i.INTERNAL_EXCEPTION="internalException",i.INTERNAL_ABORTED="aborted",i.ATTACH_MEDIA_ERROR="attachMediaError",i.UNKNOWN="unknown",i})({}),B=(function(i){return i.MEDIA_ATTACHING="hlsMediaAttaching",i.MEDIA_ATTACHED="hlsMediaAttached",i.MEDIA_DETACHING="hlsMediaDetaching",i.MEDIA_DETACHED="hlsMediaDetached",i.MEDIA_ENDED="hlsMediaEnded",i.STALL_RESOLVED="hlsStallResolved",i.BUFFER_RESET="hlsBufferReset",i.BUFFER_CODECS="hlsBufferCodecs",i.BUFFER_CREATED="hlsBufferCreated",i.BUFFER_APPENDING="hlsBufferAppending",i.BUFFER_APPENDED="hlsBufferAppended",i.BUFFER_EOS="hlsBufferEos",i.BUFFERED_TO_END="hlsBufferedToEnd",i.BUFFER_FLUSHING="hlsBufferFlushing",i.BUFFER_FLUSHED="hlsBufferFlushed",i.MANIFEST_LOADING="hlsManifestLoading",i.MANIFEST_LOADED="hlsManifestLoaded",i.MANIFEST_PARSED="hlsManifestParsed",i.LEVEL_SWITCHING="hlsLevelSwitching",i.LEVEL_SWITCHED="hlsLevelSwitched",i.LEVEL_LOADING="hlsLevelLoading",i.LEVEL_LOADED="hlsLevelLoaded",i.LEVEL_UPDATED="hlsLevelUpdated",i.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",i.LEVELS_UPDATED="hlsLevelsUpdated",i.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",i.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",i.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",i.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",i.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",i.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",i.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",i.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",i.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",i.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",i.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",i.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",i.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",i.CUES_PARSED="hlsCuesParsed",i.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",i.INIT_PTS_FOUND="hlsInitPtsFound",i.FRAG_LOADING="hlsFragLoading",i.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",i.FRAG_LOADED="hlsFragLoaded",i.FRAG_DECRYPTED="hlsFragDecrypted",i.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",i.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",i.FRAG_PARSING_METADATA="hlsFragParsingMetadata",i.FRAG_PARSED="hlsFragParsed",i.FRAG_BUFFERED="hlsFragBuffered",i.FRAG_CHANGED="hlsFragChanged",i.FPS_DROP="hlsFpsDrop",i.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",i.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",i.ERROR="hlsError",i.DESTROYING="hlsDestroying",i.KEY_LOADING="hlsKeyLoading",i.KEY_LOADED="hlsKeyLoaded",i.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",i.BACK_BUFFER_REACHED="hlsBackBufferReached",i.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",i.ASSET_LIST_LOADING="hlsAssetListLoading",i.ASSET_LIST_LOADED="hlsAssetListLoaded",i.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",i.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",i.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",i.INTERSTITIAL_STARTED="hlsInterstitialStarted",i.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",i.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",i.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",i.INTERSTITIAL_ENDED="hlsInterstitialEnded",i.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",i.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",i.EVENT_CUE_ENTER="hlsEventCueEnter",i})({});var At={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Xe={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class co{constructor(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class uI{constructor(e,t,s,a=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new co(e),this.fast_=new co(t),this.defaultTTFB_=a,this.ttfb_=new co(e)}update(e,t){const{slow_:s,fast_:a,ttfb_:l}=this;s.halfLife!==e&&(this.slow_=new co(e,s.getEstimate(),s.getTotalWeight())),a.halfLife!==t&&(this.fast_=new co(t,a.getEstimate(),a.getTotalWeight())),l.halfLife!==e&&(this.ttfb_=new co(e,l.getEstimate(),l.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const s=8*t,a=e/1e3,l=s/a;this.fast_.sample(a,l),this.slow_.sample(a,l)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function dI(i,e,t){return(e=fI(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Xt(){return Xt=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(i[s]=t[s])}return i},Xt.apply(null,arguments)}function _v(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);e&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(i,a).enumerable})),t.push.apply(t,s)}return t}function Kt(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?_v(Object(t),!0).forEach(function(s){dI(i,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):_v(Object(t)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(t,s))})}return i}function hI(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function fI(i){var e=hI(i,"string");return typeof e=="symbol"?e:e+""}class Wi{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${e}]:`;this.trace=Na,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}}const Na=function(){},mI={trace:Na,debug:Na,log:Na,warn:Na,info:Na,error:Na};function Tm(){return Xt({},mI)}function gI(i,e){const t=self.console[i];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${i}] >`):Na}function bv(i,e,t){return e[i]?e[i].bind(e):gI(i,t)}const Am=Tm();function pI(i,e,t){const s=Tm();if(typeof console=="object"&&i===!0||typeof i=="object"){const a=["debug","log","info","warn","error"];a.forEach(l=>{s[l]=bv(l,i,t)});try{s.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return Tm()}a.forEach(l=>{Am[l]=bv(l,i)})}else Xt(Am,s);return s}const zt=Am;function Ma(i=!0){return typeof self>"u"?void 0:(i||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function yI(i){return typeof self<"u"&&i===self.ManagedMediaSource}function nS(i,e){const t=Object.keys(i),s=Object.keys(e),a=t.length,l=s.length;return!a||!l||a===l&&!t.some(c=>s.indexOf(c)===-1)}function Ci(i,e=!1){if(typeof TextDecoder<"u"){const d=new TextDecoder("utf-8").decode(i);if(e){const m=d.indexOf("\0");return m!==-1?d.substring(0,m):d}return d.replace(/\0/g,"")}const t=i.length;let s,a,l,c="",u=0;for(;u<t;){if(s=i[u++],s===0&&e)return c;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c+=String.fromCharCode(s);break;case 12:case 13:a=i[u++],c+=String.fromCharCode((s&31)<<6|a&63);break;case 14:a=i[u++],l=i[u++],c+=String.fromCharCode((s&15)<<12|(a&63)<<6|(l&63)<<0);break}}return c}function Hs(i){let e="";for(let t=0;t<i.length;t++){let s=i[t].toString(16);s.length<2&&(s="0"+s),e+=s}return e}function aS(i){return Uint8Array.from(i.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function xI(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Bf={exports:{}},Sv;function vI(){return Sv||(Sv=1,(function(i,e){(function(t){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,a=/^(?=([^\/?#]*))\1([^]*)$/,l=/(?:\/|^)\.(?=\/)/g,c=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,u={buildAbsoluteURL:function(f,d,m){if(m=m||{},f=f.trim(),d=d.trim(),!d){if(!m.alwaysNormalize)return f;var g=u.parseURL(f);if(!g)throw new Error("Error trying to parse base URL.");return g.path=u.normalizePath(g.path),u.buildURLFromParts(g)}var y=u.parseURL(d);if(!y)throw new Error("Error trying to parse relative URL.");if(y.scheme)return m.alwaysNormalize?(y.path=u.normalizePath(y.path),u.buildURLFromParts(y)):d;var x=u.parseURL(f);if(!x)throw new Error("Error trying to parse base URL.");if(!x.netLoc&&x.path&&x.path[0]!=="/"){var v=a.exec(x.path);x.netLoc=v[1],x.path=v[2]}x.netLoc&&!x.path&&(x.path="/");var E={scheme:x.scheme,netLoc:y.netLoc,path:null,params:y.params,query:y.query,fragment:y.fragment};if(!y.netLoc&&(E.netLoc=x.netLoc,y.path[0]!=="/"))if(!y.path)E.path=x.path,y.params||(E.params=x.params,y.query||(E.query=x.query));else{var A=x.path,R=A.substring(0,A.lastIndexOf("/")+1)+y.path;E.path=u.normalizePath(R)}return E.path===null&&(E.path=m.alwaysNormalize?u.normalizePath(y.path):y.path),u.buildURLFromParts(E)},parseURL:function(f){var d=s.exec(f);return d?{scheme:d[1]||"",netLoc:d[2]||"",path:d[3]||"",params:d[4]||"",query:d[5]||"",fragment:d[6]||""}:null},normalizePath:function(f){for(f=f.split("").reverse().join("").replace(l,"");f.length!==(f=f.replace(c,"")).length;);return f.split("").reverse().join("")},buildURLFromParts:function(f){return f.scheme+f.netLoc+f.path+f.params+f.query+f.fragment}};i.exports=u})()})(Bf)),Bf.exports}var bg=vI();class Sg{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Zt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class rS{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,bI(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let a;s.length===1?a=t?.byteRangeEndOffset||0:a=parseInt(s[1]),this._byteRange=[a,parseInt(s[0])+a]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Zt.AUDIO]:null,[Zt.VIDEO]:null,[Zt.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Sg),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=bg.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Zt.AUDIO]=null,e[Zt.VIDEO]=null,e[Zt.AUDIOVIDEO]=null}}function _s(i){return i.sn!=="initSegment"}class Uf extends rS{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(We(e)&&We(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const s=Object.keys(t);if(s.length===1){const a=this._decryptdata=t[s[0]]||null;a&&(this._decryptdata=a.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=We(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const s=Object.keys(this.levelkeys),a=s.length;if(a>1||a===1&&(t=this.levelkeys[s[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!We(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return _s(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var s;const a=t[e];a&&!((s=this._decryptdata)!=null&&s.keyId)&&(this._decryptdata=a.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,s,a,l,c=!1){const{elementaryStreams:u}=this,f=u[e];if(!f){u[e]={startPTS:t,endPTS:s,startDTS:a,endDTS:l,partial:c};return}f.startPTS=Math.min(f.startPTS,t),f.endPTS=Math.max(f.endPTS,s),f.startDTS=Math.min(f.startDTS,a),f.endDTS=Math.max(f.endDTS,l)}}class _I extends rS{constructor(e,t,s,a,l){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=a;const c=e.enumeratedString("BYTERANGE");c&&this.setByteRange(c,l),l&&(this.fragOffset=l.fragOffset+l.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function oS(i,e){const t=Object.getPrototypeOf(i);if(t){const s=Object.getOwnPropertyDescriptor(t,e);return s||oS(t,e)}}function bI(i,e){const t=oS(i,e);t&&(t.enumerable=!0,Object.defineProperty(i,e,t))}const Ev=Math.pow(2,32)-1,SI=[].push,lS={video:1,audio:2,id3:3,text:4};function Ls(i){return String.fromCharCode.apply(null,i)}function cS(i,e){const t=i[e]<<8|i[e+1];return t<0?65536+t:t}function mt(i,e){const t=uS(i,e);return t<0?4294967296+t:t}function Tv(i,e){let t=mt(i,e);return t*=Math.pow(2,32),t+=mt(i,e+4),t}function uS(i,e){return i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}function EI(i){const e=i.byteLength;for(let t=0;t<e;){const s=mt(i,t);if(s>8&&i[t+4]===109&&i[t+5]===111&&i[t+6]===111&&i[t+7]===102)return!0;t=s>1?t+s:e}return!1}function Tt(i,e){const t=[];if(!e.length)return t;const s=i.byteLength;for(let a=0;a<s;){const l=mt(i,a),c=Ls(i.subarray(a+4,a+8)),u=l>1?a+l:s;if(c===e[0])if(e.length===1)t.push(i.subarray(a+8,u));else{const f=Tt(i.subarray(a+8,u),e.slice(1));f.length&&SI.apply(t,f)}a=u}return t}function TI(i){const e=[],t=i[0];let s=8;const a=mt(i,s);s+=4;let l=0,c=0;t===0?(l=mt(i,s),c=mt(i,s+4),s+=8):(l=Tv(i,s),c=Tv(i,s+8),s+=16),s+=2;let u=i.length+c;const f=cS(i,s);s+=2;for(let d=0;d<f;d++){let m=s;const g=mt(i,m);m+=4;const y=g&2147483647;if((g&2147483648)>>>31===1)return zt.warn("SIDX has hierarchical references (not supported)"),null;const v=mt(i,m);m+=4,e.push({referenceSize:y,subsegmentDuration:v,info:{duration:v/a,start:u,end:u+y-1}}),u+=y,m+=4,s=m}return{earliestPresentationTime:l,timescale:a,version:t,referencesCount:f,references:e}}function dS(i){const e=[],t=Tt(i,["moov","trak"]);for(let a=0;a<t.length;a++){const l=t[a],c=Tt(l,["tkhd"])[0];if(c){let u=c[0];const f=mt(c,u===0?12:20),d=Tt(l,["mdia","mdhd"])[0];if(d){u=d[0];const m=mt(d,u===0?12:20),g=Tt(l,["mdia","hdlr"])[0];if(g){const y=Ls(g.subarray(8,12)),x={soun:Zt.AUDIO,vide:Zt.VIDEO}[y],v=Tt(l,["mdia","minf","stbl","stsd"])[0],E=AI(v);x?(e[f]={timescale:m,type:x,stsd:E},e[x]=Kt({timescale:m,id:f},E)):e[f]={timescale:m,type:y,stsd:E}}}}}return Tt(i,["moov","mvex","trex"]).forEach(a=>{const l=mt(a,4),c=e[l];c&&(c.default={duration:mt(a,12),flags:mt(a,20)})}),e}function AI(i){const e=i.subarray(8),t=e.subarray(86),s=Ls(e.subarray(4,8));let a=s,l;const c=s==="enca"||s==="encv";if(c){const d=Tt(e,[s])[0].subarray(s==="enca"?28:78);Tt(d,["sinf"]).forEach(g=>{const y=Tt(g,["schm"])[0];if(y){const x=Ls(y.subarray(4,8));if(x==="cbcs"||x==="cenc"){const v=Tt(g,["frma"])[0];v&&(a=Ls(v))}}})}const u=a;switch(a){case"avc1":case"avc2":case"avc3":case"avc4":{const f=Tt(t,["avcC"])[0];f&&f.length>3&&(a+="."+xu(f[1])+xu(f[2])+xu(f[3]),l=yu(u==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const f=Tt(e,[s])[0],d=Tt(f.subarray(28),["esds"])[0];if(d&&d.length>7){let m=4;if(d[m++]!==3)break;m=Ff(d,m),m+=2;const g=d[m++];if(g&128&&(m+=2),g&64&&(m+=d[m++]),d[m++]!==4)break;m=Ff(d,m);const y=d[m++];if(y===64)a+="."+xu(y);else break;if(m+=12,d[m++]!==5)break;m=Ff(d,m);const x=d[m++];let v=(x&248)>>3;v===31&&(v+=1+((x&7)<<3)+((d[m]&224)>>5)),a+="."+v}break}case"hvc1":case"hev1":{const f=Tt(t,["hvcC"])[0];if(f&&f.length>12){const d=f[1],m=["","A","B","C"][d>>6],g=d&31,y=mt(f,2),x=(d&32)>>5?"H":"L",v=f[12],E=f.subarray(6,12);a+="."+m+g,a+="."+wI(y).toString(16).toUpperCase(),a+="."+x+v;let A="";for(let R=E.length;R--;){const D=E[R];(D||A)&&(A="."+D.toString(16).toUpperCase()+A)}a+=A}l=yu(u=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{a=yu(a,t)||a;break}case"vp09":{const f=Tt(t,["vpcC"])[0];if(f&&f.length>6){const d=f[4],m=f[5],g=f[6]>>4&15;a+="."+yn(d)+"."+yn(m)+"."+yn(g)}break}case"av01":{const f=Tt(t,["av1C"])[0];if(f&&f.length>2){const d=f[1]>>>5,m=f[1]&31,g=f[2]>>>7?"H":"M",y=(f[2]&64)>>6,x=(f[2]&32)>>5,v=d===2&&y?x?12:10:y?10:8,E=(f[2]&16)>>4,A=(f[2]&8)>>3,R=(f[2]&4)>>2,D=f[2]&3;a+="."+d+"."+yn(m)+g+"."+yn(v)+"."+E+"."+A+R+D+"."+yn(1)+"."+yn(1)+"."+yn(1)+"."+0,l=yu("dav1",t)}break}}return{codec:a,encrypted:c,supplemental:l}}function yu(i,e){const t=Tt(e,["dvvC"]),s=t.length?t[0]:Tt(e,["dvcC"])[0];if(s){const a=s[2]>>1&127,l=s[2]<<5&32|s[3]>>3&31;return i+"."+yn(a)+"."+yn(l)}}function wI(i){let e=0;for(let t=0;t<32;t++)e|=(i>>t&1)<<31-t;return e>>>0}function Ff(i,e){const t=e+5;for(;i[e++]&128&&e<t;);return e}function xu(i){return("0"+i.toString(16).toUpperCase()).slice(-2)}function yn(i){return(i<10?"0":"")+i}function NI(i,e){if(!i||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&hS(i,(s,a)=>{const l=s.subarray(8,24);l.some(c=>c!==0)||(zt.log(`[eme] Patching keyId in 'enc${a?"a":"v"}>sinf>>tenc' box: ${Hs(l)} -> ${Hs(t)}`),s.set(t,8))})}function RI(i){const e=[];return hS(i,t=>e.push(t.subarray(8,24))),e}function hS(i,e){Tt(i,["moov","trak"]).forEach(s=>{const a=Tt(s,["mdia","minf","stbl","stsd"])[0];if(!a)return;const l=a.subarray(8);let c=Tt(l,["enca"]);const u=c.length>0;u||(c=Tt(l,["encv"])),c.forEach(f=>{const d=u?f.subarray(28):f.subarray(78);Tt(d,["sinf"]).forEach(g=>{const y=fS(g);y&&e(y,u)})})})}function fS(i){const e=Tt(i,["schm"])[0];if(e){const t=Ls(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const s=Tt(i,["schi","tenc"])[0];if(s)return s}}}function CI(i,e,t){const s={},a=Tt(i,["moof","traf"]);for(let l=0;l<a.length;l++){const c=a[l],u=Tt(c,["tfhd"])[0],f=mt(u,4),d=e[f];if(!d)continue;s[f]||(s[f]={start:NaN,duration:0,sampleCount:0,timescale:d.timescale,type:d.type});const m=s[f],g=Tt(c,["tfdt"])[0];if(g){const L=g[0];let O=mt(g,4);L===1&&(O===Ev?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(O*=Ev+1,O+=mt(g,8))),We(O)&&(!We(m.start)||O<m.start)&&(m.start=O)}const y=d.default,x=mt(u,0)|y?.flags;let v=y?.duration||0;x&8&&(x&2?v=mt(u,12):v=mt(u,8));const E=Tt(c,["trun"]);let A=m.start||0,R=0,D=v;for(let L=0;L<E.length;L++){const O=E[L],H=mt(O,4),q=m.sampleCount;m.sampleCount+=H;const U=O[3]&1,k=O[3]&4,M=O[2]&1,I=O[2]&2,j=O[2]&4,Z=O[2]&8;let ae=8,ie=H;for(U&&(ae+=4),k&&H&&(!(O[ae+1]&1)&&m.keyFrameIndex===void 0&&(m.keyFrameIndex=q),ae+=4,M?(D=mt(O,ae),ae+=4):D=v,I&&(ae+=4),Z&&(ae+=4),A+=D,R+=D,ie--);ie--;)M?(D=mt(O,ae),ae+=4):D=v,I&&(ae+=4),j&&(O[ae+1]&1||m.keyFrameIndex===void 0&&(m.keyFrameIndex=m.sampleCount-(ie+1),m.keyFrameStart=A),ae+=4),Z&&(ae+=4),A+=D,R+=D;!R&&v&&(R+=v*H)}m.duration+=R}if(!Object.keys(s).some(l=>s[l].duration)){let l=1/0,c=0;const u=Tt(i,["sidx"]);for(let f=0;f<u.length;f++){const d=TI(u[f]);if(d!=null&&d.references){l=Math.min(l,d.earliestPresentationTime/d.timescale);const m=d.references.reduce((g,y)=>g+y.info.duration||0,0);c=Math.max(c,m+d.earliestPresentationTime/d.timescale)}}c&&We(c)&&Object.keys(s).forEach(f=>{s[f].duration||(s[f].duration=c*s[f].timescale-s[f].start)})}return s}function LI(i){const e={valid:null,remainder:null},t=Tt(i,["moof"]);if(t.length<2)return e.remainder=i,e;const s=t[t.length-1];return e.valid=i.slice(0,s.byteOffset-8),e.remainder=i.slice(s.byteOffset-8),e}function qi(i,e){const t=new Uint8Array(i.length+e.length);return t.set(i),t.set(e,i.length),t}function Av(i,e){const t=[],s=e.samples,a=e.timescale,l=e.id;let c=!1;return Tt(s,["moof"]).map(f=>{const d=f.byteOffset-8;Tt(f,["traf"]).map(g=>{const y=Tt(g,["tfdt"]).map(x=>{const v=x[0];let E=mt(x,4);return v===1&&(E*=Math.pow(2,32),E+=mt(x,8)),E/a})[0];return y!==void 0&&(i=y),Tt(g,["tfhd"]).map(x=>{const v=mt(x,4),E=mt(x,0)&16777215,A=(E&1)!==0,R=(E&2)!==0,D=(E&8)!==0;let L=0;const O=(E&16)!==0;let H=0;const q=(E&32)!==0;let U=8;v===l&&(A&&(U+=8),R&&(U+=4),D&&(L=mt(x,U),U+=4),O&&(H=mt(x,U),U+=4),q&&(U+=4),e.type==="video"&&(c=_d(e.codec)),Tt(g,["trun"]).map(k=>{const M=k[0],I=mt(k,0)&16777215,j=(I&1)!==0;let Z=0;const ae=(I&4)!==0,ie=(I&256)!==0;let re=0;const Q=(I&512)!==0;let se=0;const oe=(I&1024)!==0,Y=(I&2048)!==0;let V=0;const $=mt(k,4);let X=8;j&&(Z=mt(k,X),X+=4),ae&&(X+=4);let me=Z+d;for(let ve=0;ve<$;ve++){if(ie?(re=mt(k,X),X+=4):re=L,Q?(se=mt(k,X),X+=4):se=H,oe&&(X+=4),Y&&(M===0?V=mt(k,X):V=uS(k,X),X+=4),e.type===Zt.VIDEO){let pe=0;for(;pe<se;){const ge=mt(s,me);if(me+=4,DI(c,s[me])){const ee=s.subarray(me,me+ge);Eg(ee,c?2:1,i+V/a,t)}me+=ge,pe+=ge+4}}i+=re/a}}))})})}),t}function _d(i){if(!i)return!1;const e=i.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function DI(i,e){if(i){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Eg(i,e,t,s){const a=mS(i);let l=0;l+=e;let c=0,u=0,f=0;for(;l<a.length;){c=0;do{if(l>=a.length)break;f=a[l++],c+=f}while(f===255);u=0;do{if(l>=a.length)break;f=a[l++],u+=f}while(f===255);const d=a.length-l;let m=l;if(u<d)l+=u;else if(u>d){zt.error(`Malformed SEI payload. ${u} is too small, only ${d} bytes left to parse.`);break}if(c===4){if(a[m++]===181){const y=cS(a,m);if(m+=2,y===49){const x=mt(a,m);if(m+=4,x===1195456820){const v=a[m++];if(v===3){const E=a[m++],A=31&E,R=64&E,D=R?2+A*3:0,L=new Uint8Array(D);if(R){L[0]=E;for(let O=1;O<D;O++)L[O]=a[m++]}s.push({type:v,payloadType:c,pts:t,bytes:L})}}}}}else if(c===5&&u>16){const g=[];for(let v=0;v<16;v++){const E=a[m++].toString(16);g.push(E.length==1?"0"+E:E),(v===3||v===5||v===7||v===9)&&g.push("-")}const y=u-16,x=new Uint8Array(y);for(let v=0;v<y;v++)x[v]=a[m++];s.push({payloadType:c,pts:t,uuid:g.join(""),userData:Ci(x),userDataBytes:x})}}}function mS(i){const e=i.byteLength,t=[];let s=1;for(;s<e-2;)i[s]===0&&i[s+1]===0&&i[s+2]===3?(t.push(s+2),s+=2):s++;if(t.length===0)return i;const a=e-t.length,l=new Uint8Array(a);let c=0;for(s=0;s<a;c++,s++)c===t[0]&&(c++,t.shift()),l[s]=i[c];return l}function II(i){const e=i[0];let t="",s="",a=0,l=0,c=0,u=0,f=0,d=0;if(e===0){for(;Ls(i.subarray(d,d+1))!=="\0";)t+=Ls(i.subarray(d,d+1)),d+=1;for(t+=Ls(i.subarray(d,d+1)),d+=1;Ls(i.subarray(d,d+1))!=="\0";)s+=Ls(i.subarray(d,d+1)),d+=1;s+=Ls(i.subarray(d,d+1)),d+=1,a=mt(i,12),l=mt(i,16),u=mt(i,20),f=mt(i,24),d=28}else if(e===1){d+=4,a=mt(i,d),d+=4;const g=mt(i,d);d+=4;const y=mt(i,d);for(d+=4,c=2**32*g+y,lI(c)||(c=Number.MAX_SAFE_INTEGER,zt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),u=mt(i,d),d+=4,f=mt(i,d),d+=4;Ls(i.subarray(d,d+1))!=="\0";)t+=Ls(i.subarray(d,d+1)),d+=1;for(t+=Ls(i.subarray(d,d+1)),d+=1;Ls(i.subarray(d,d+1))!=="\0";)s+=Ls(i.subarray(d,d+1)),d+=1;s+=Ls(i.subarray(d,d+1)),d+=1}const m=i.subarray(d,i.byteLength);return{schemeIdUri:t,value:s,timeScale:a,presentationTime:c,presentationTimeDelta:l,eventDuration:u,id:f,payload:m}}function kI(i,...e){const t=e.length;let s=8,a=t;for(;a--;)s+=e[a].byteLength;const l=new Uint8Array(s);for(l[0]=s>>24&255,l[1]=s>>16&255,l[2]=s>>8&255,l[3]=s&255,l.set(i,4),a=0,s=8;a<t;a++)l.set(e[a],s),s+=e[a].byteLength;return l}function MI(i,e,t){if(i.byteLength!==16)throw new RangeError("Invalid system id");let s,a;s=0,a=new Uint8Array;let l;s>0?(l=new Uint8Array(4),e.length>0&&new DataView(l.buffer).setUint32(0,e.length,!1)):l=new Uint8Array;const c=new Uint8Array(4);return t.byteLength>0&&new DataView(c.buffer).setUint32(0,t.byteLength,!1),kI([112,115,115,104],new Uint8Array([s,0,0,0]),i,l,a,c,t)}function jI(i){const e=[];if(i instanceof ArrayBuffer){const t=i.byteLength;let s=0;for(;s+32<t;){const a=new DataView(i,s),l=OI(a);e.push(l),s+=l.size}}return e}function OI(i){const e=i.getUint32(0),t=i.byteOffset,s=i.byteLength;if(s<e)return{offset:t,size:s};if(i.getUint32(4)!==1886614376)return{offset:t,size:e};const l=i.getUint32(8)>>>24;if(l!==0&&l!==1)return{offset:t,size:e};const c=i.buffer,u=Hs(new Uint8Array(c,t+12,16));let f=null,d=null,m=0;if(l===0)m=28;else{const y=i.getUint32(28);if(!y||s<32+y*16)return{offset:t,size:e};f=[];for(let x=0;x<y;x++)f.push(new Uint8Array(c,t+32+x*16,16));m=32+y*16}if(!m)return{offset:t,size:e};const g=i.getUint32(m);return e-32<g?{offset:t,size:e}:(d=new Uint8Array(c,t+m+4,g),{version:l,systemId:u,kids:f,data:d,offset:t,size:e})}const gS=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),No={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Tg(i,e){const t=No[e];return!!t&&!!t[i.slice(0,4)]}function Gl(i,e,t=!0){return!i.split(",").some(s=>!Ag(s,e,t))}function Ag(i,e,t=!0){var s;const a=Ma(t);return(s=a?.isTypeSupported($l(i,e)))!=null?s:!1}function $l(i,e){return`${e}/mp4;codecs=${i}`}function wv(i){if(i){const e=i.substring(0,4);return No.video[e]}return 2}function Ju(i){const e=gS();return i.split(",").reduce((t,s)=>{const l=e&&_d(s)?9:No.video[s];return l?(l*2+t)/(t?3:2):(No.audio[s]+t)/(t?2:1)},0)}const Gf={};function PI(i,e=!0){if(Gf[i])return Gf[i];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[i];for(let a=0;a<t.length;a++){var s;if(Ag(t[a],"audio",e))return Gf[i]=t[a],t[a];if(t[a]==="mp3"&&(s=Ma(e))!=null&&s.isTypeSupported("audio/mpeg"))return""}return i}const BI=/flac|opus|mp4a\.40\.34/i;function ed(i,e=!0){return i.replace(BI,t=>PI(t.toLowerCase(),e))}function UI(i,e){const t=[];if(i){const s=i.split(",");for(let a=0;a<s.length;a++)Tg(s[a],"video")||t.push(s[a])}return e&&t.push(e),t.join(",")}function Fu(i,e){if(i&&(i.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(i)!==-1)&&(Nv(i,"audio")||Nv(i,"video")))return i;if(e){const t=e.split(",");if(t.length>1){if(i){for(let s=t.length;s--;)if(t[s].substring(0,4)===i.substring(0,4))return t[s]}return t[0]}}return e||i}function Nv(i,e){return Tg(i,e)&&Ag(i,e)}function FI(i){const e=i.split(",");for(let t=0;t<e.length;t++){const s=e[t].split(".");s.length>2&&s[0]==="avc1"&&(e[t]=`avc1.${parseInt(s[1]).toString(16)}${("000"+parseInt(s[2]).toString(16)).slice(-4)}`)}return e.join(",")}function GI(i){if(i.startsWith("av01.")){const e=i.split("."),t=["0","111","01","01","01","0"];for(let s=e.length;s>4&&s<10;s++)e[s]=t[s-4];return e.join(".")}return i}function Rv(i){const e=Ma(i)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function wm(i){return i.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const $I={supported:!0,powerEfficient:!0,smooth:!0},VI={supported:!1,smooth:!1,powerEfficient:!1},pS={supported:!0,configurations:[],decodingInfoResults:[$I]};function yS(i,e){return{supported:!1,configurations:e,decodingInfoResults:[VI],error:i}}function HI(i,e,t,s,a,l){const c=i.videoCodec,u=i.audioCodec?i.audioGroups:null,f=l?.audioCodec,d=l?.channels,m=d?parseInt(d):f?1/0:2;let g=null;if(u!=null&&u.length)try{u.length===1&&u[0]?g=e.groups[u[0]].channels:g=u.reduce((y,x)=>{if(x){const v=e.groups[x];if(!v)throw new Error(`Audio track group ${x} not found`);Object.keys(v.channels).forEach(E=>{y[E]=(y[E]||0)+v.channels[E]})}return y},{2:0})}catch{return!0}return c!==void 0&&(c.split(",").some(y=>_d(y))||i.width>1920&&i.height>1088||i.height>1920&&i.width>1088||i.frameRate>Math.max(s,30)||i.videoRange!=="SDR"&&i.videoRange!==t||i.bitrate>Math.max(a,8e6))||!!g&&We(m)&&Object.keys(g).some(y=>parseInt(y)>m)}function xS(i,e,t,s={}){const a=i.videoCodec;if(!a&&!i.audioCodec||!t)return Promise.resolve(pS);const l=[],c=KI(i),u=c.length,f=zI(i,e,u>0),d=f.length;for(let m=u||1*d||1;m--;){const g={type:"media-source"};if(u&&(g.video=c[m%u]),d){g.audio=f[m%d];const y=g.audio.bitrate;g.video&&y&&(g.video.bitrate-=y)}l.push(g)}if(a){const m=navigator.userAgent;if(a.split(",").some(g=>_d(g))&&gS())return Promise.resolve(yS(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${m})`),l))}return Promise.all(l.map(m=>{const g=YI(m);return s[g]||(s[g]=t.decodingInfo(m))})).then(m=>({supported:!m.some(g=>!g.supported),configurations:l,decodingInfoResults:m})).catch(m=>({supported:!1,configurations:l,decodingInfoResults:[],error:m}))}function KI(i){var e;const t=(e=i.videoCodec)==null?void 0:e.split(","),s=vS(i),a=i.width||640,l=i.height||480,c=i.frameRate||30,u=i.videoRange.toLowerCase();return t?t.map(f=>{const d={contentType:$l(GI(f),"video"),width:a,height:l,bitrate:s,framerate:c};return u!=="sdr"&&(d.transferFunction=u),d}):[]}function zI(i,e,t){var s;const a=(s=i.audioCodec)==null?void 0:s.split(","),l=vS(i);return a&&i.audioGroups?i.audioGroups.reduce((c,u)=>{var f;const d=u?(f=e.groups[u])==null?void 0:f.tracks:null;return d?d.reduce((m,g)=>{if(g.groupId===u){const y=parseFloat(g.channels||"");a.forEach(x=>{const v={contentType:$l(x,"audio"),bitrate:t?qI(x,l):l};y&&(v.channels=""+y),m.push(v)})}return m},c):c},[]):[]}function qI(i,e){if(e<=1)return 1;let t=128e3;return i==="ec-3"?t=768e3:i==="ac-3"&&(t=64e4),Math.min(e/2,t)}function vS(i){return Math.ceil(Math.max(i.bitrate*.9,i.averageBitrate)/1e3)*1e3||1}function YI(i){let e="";const{audio:t,video:s}=i;if(s){const a=wm(s.contentType);e+=`${a}_r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${Math.ceil(s.bitrate/1e5)}`}if(t){const a=wm(t.contentType);e+=`${s?"_":""}${a}_c${t.channels}`}return e}const Nm=["NONE","TYPE-0","TYPE-1",null];function WI(i){return Nm.indexOf(i)>-1}const td=["SDR","PQ","HLG"];function XI(i){return!!i&&td.indexOf(i)>-1}var Gu={No:"",Yes:"YES",v2:"v2"};function Cv(i){const{canSkipUntil:e,canSkipDateRanges:t,age:s}=i,a=s<e/2;return e&&a?t?Gu.v2:Gu.Yes:Gu.No}class Lv{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Vl{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(s=>!!s).map(s=>s.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=(t=e.supplemental)==null?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Dv(this._audioGroups,e)}hasSubtitleGroup(e){return Dv(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let s=this._audioGroups;s||(s=this._audioGroups=[]),s.indexOf(t)===-1&&s.push(t)}else if(e==="text"){let s=this._subtitleGroups;s||(s=this._subtitleGroups=[]),s.indexOf(t)===-1&&s.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Dv(i,e){return!e||!i?!1:i.indexOf(e)!==-1}function QI(){if(typeof matchMedia=="function"){const i=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(i.media!==e.media)return i.matches===!0}return!1}function ZI(i,e){let t=!1,s=[];if(i&&(t=i!=="SDR",s=[i]),e){s=e.allowedVideoRanges||td.slice(0);const a=s.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:a&&QI(),t||(s=["SDR"])}return{preferHDR:t,allowedVideoRanges:s}}const JI=i=>{const e=new WeakSet;return(t,s)=>{if(i&&(s=i(t,s)),typeof s=="object"&&s!==null){if(e.has(s))return;e.add(s)}return s}},Jt=(i,e)=>JSON.stringify(i,JI(e));function ek(i,e,t,s,a){const l=Object.keys(i),c=s?.channels,u=s?.audioCodec,f=a?.videoCodec,d=c&&parseInt(c)===2;let m=!1,g=!1,y=1/0,x=1/0,v=1/0,E=1/0,A=0,R=[];const{preferHDR:D,allowedVideoRanges:L}=ZI(e,a);for(let k=l.length;k--;){const M=i[l[k]];m||(m=M.channels[2]>0),y=Math.min(y,M.minHeight),x=Math.min(x,M.minFramerate),v=Math.min(v,M.minBitrate),L.filter(j=>M.videoRanges[j]>0).length>0&&(g=!0)}y=We(y)?y:0,x=We(x)?x:0;const O=Math.max(1080,y),H=Math.max(30,x);v=We(v)?v:t,t=Math.max(v,t),g||(e=void 0);const q=l.length>1;return{codecSet:l.reduce((k,M)=>{const I=i[M];if(M===k)return k;if(R=g?L.filter(j=>I.videoRanges[j]>0):[],q){if(I.minBitrate>t)return gn(M,`min bitrate of ${I.minBitrate} > current estimate of ${t}`),k;if(!I.hasDefaultAudio)return gn(M,"no renditions with default or auto-select sound found"),k;if(u&&M.indexOf(u.substring(0,4))%5!==0)return gn(M,`audio codec preference "${u}" not found`),k;if(c&&!d){if(!I.channels[c])return gn(M,`no renditions with ${c} channel sound found (channels options: ${Object.keys(I.channels)})`),k}else if((!u||d)&&m&&I.channels[2]===0)return gn(M,"no renditions with stereo sound found"),k;if(I.minHeight>O)return gn(M,`min resolution of ${I.minHeight} > maximum of ${O}`),k;if(I.minFramerate>H)return gn(M,`min framerate of ${I.minFramerate} > maximum of ${H}`),k;if(!R.some(j=>I.videoRanges[j]>0))return gn(M,`no variants with VIDEO-RANGE of ${Jt(R)} found`),k;if(f&&M.indexOf(f.substring(0,4))%5!==0)return gn(M,`video codec preference "${f}" not found`),k;if(I.maxScore<A)return gn(M,`max score of ${I.maxScore} < selected max of ${A}`),k}return k&&(Ju(M)>=Ju(k)||I.fragmentError>i[k].fragmentError)?k:(E=I.minIndex,A=I.maxScore,M)},void 0),videoRanges:R,preferHDR:D,minFramerate:x,minBitrate:v,minIndex:E}}function gn(i,e){zt.log(`[abr] start candidates with "${i}" ignored because ${e}`)}function _S(i){return i.reduce((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const a=t.channels||"2";return s.channels[a]=(s.channels[a]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function tk(i,e,t,s){return i.slice(t,s+1).reduce((a,l,c)=>{if(!l.codecSet)return a;const u=l.audioGroups;let f=a[l.codecSet];f||(a[l.codecSet]=f={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:c,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!u,fragmentError:0}),f.minBitrate=Math.min(f.minBitrate,l.bitrate);const d=Math.min(l.height,l.width);return f.minHeight=Math.min(f.minHeight,d),f.minFramerate=Math.min(f.minFramerate,l.frameRate),f.minIndex=Math.min(f.minIndex,c),f.maxScore=Math.max(f.maxScore,l.score),f.fragmentError+=l.fragmentError,f.videoRanges[l.videoRange]=(f.videoRanges[l.videoRange]||0)+1,u&&u.forEach(m=>{if(!m)return;const g=e.groups[m];g&&(f.hasDefaultAudio=f.hasDefaultAudio||e.hasDefaultAudio?g.hasDefault:g.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(g.channels).forEach(y=>{f.channels[y]=(f.channels[y]||0)+g.channels[y]}))}),a},{})}function Iv(i){if(!i)return i;const{lang:e,assocLang:t,characteristics:s,channels:a,audioCodec:l}=i;return{lang:e,assocLang:t,characteristics:s,channels:a,audioCodec:l}}function vn(i,e,t){if("attrs"in i){const s=e.indexOf(i);if(s!==-1)return s}for(let s=0;s<e.length;s++){const a=e[s];if(fr(i,a,t))return s}return-1}function fr(i,e,t){const{groupId:s,name:a,lang:l,assocLang:c,default:u}=i,f=i.forced;return(s===void 0||e.groupId===s)&&(a===void 0||e.name===a)&&(l===void 0||sk(l,e.lang))&&(l===void 0||e.assocLang===c)&&(u===void 0||e.default===u)&&(f===void 0||e.forced===f)&&(!("characteristics"in i)||ik(i.characteristics||"",e.characteristics))&&(t===void 0||t(i,e))}function sk(i,e="--"){return i.length===e.length?i===e:i.startsWith(e)||e.startsWith(i)}function ik(i,e=""){const t=i.split(","),s=e.split(",");return t.length===s.length&&!t.some(a=>s.indexOf(a)===-1)}function or(i,e){const{audioCodec:t,channels:s}=i;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(s===void 0||s===(e.channels||"2"))}function nk(i,e,t,s,a){const l=e[s],u=e.reduce((y,x,v)=>{const E=x.uri;return(y[E]||(y[E]=[])).push(v),y},{})[l.uri];u.length>1&&(s=Math.max.apply(Math,u));const f=l.videoRange,d=l.frameRate,m=l.codecSet.substring(0,4),g=kv(e,s,y=>{if(y.videoRange!==f||y.frameRate!==d||y.codecSet.substring(0,4)!==m)return!1;const x=y.audioGroups,v=t.filter(E=>!x||x.indexOf(E.groupId)!==-1);return vn(i,v,a)>-1});return g>-1?g:kv(e,s,y=>{const x=y.audioGroups,v=t.filter(E=>!x||x.indexOf(E.groupId)!==-1);return vn(i,v,a)>-1})}function kv(i,e,t){for(let s=e;s>-1;s--)if(t(i[s]))return s;for(let s=e+1;s<i.length;s++)if(t(i[s]))return s;return-1}function sd(i,e){var t;return!!i&&i!==((t=e.loadLevelObj)==null?void 0:t.uri)}class ak extends Wi{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var s;const{fragCurrent:a,partCurrent:l,hls:c}=this,{autoLevelEnabled:u,media:f}=c;if(!a||!f)return;const d=performance.now(),m=l?l.stats:a.stats,g=l?l.duration:a.duration,y=d-m.loading.start,x=c.minAutoLevel,v=a.level,E=this._nextAutoLevel;if(m.aborted||m.loaded&&m.loaded===m.total||v<=x){this.clearTimer(),this._nextAutoLevel=-1;return}if(!u)return;const A=E>-1&&E!==v,R=!!t||A;if(!R&&(f.paused||!f.playbackRate||!f.readyState))return;const D=c.mainForwardBufferInfo;if(!R&&D===null)return;const L=this.bwEstimator.getEstimateTTFB(),O=Math.abs(f.playbackRate);if(y<=Math.max(L,1e3*(g/(O*2))))return;const H=D?D.len/O:0,q=m.loading.first?m.loading.first-m.loading.start:-1,U=m.loaded&&q>-1,k=this.getBwEstimate(),M=c.levels,I=M[v],j=Math.max(m.loaded,Math.round(g*(a.bitrate||I.averageBitrate)/8));let Z=U?y-q:y;Z<1&&U&&(Z=Math.min(y,m.loaded*8/k));const ae=U?m.loaded*1e3/Z:0,ie=L/1e3,re=ae?(j-m.loaded)/ae:j*8/k+ie;if(re<=H)return;const Q=ae?ae*8:k,se=((s=t?.details||this.hls.latestLevelDetails)==null?void 0:s.live)===!0,oe=this.hls.config.abrBandWidthUpFactor;let Y=Number.POSITIVE_INFINITY,V;for(V=v-1;V>x;V--){const ve=M[V].maxBitrate,pe=!M[V].details||se;if(Y=this.getTimeToLoadFrag(ie,Q,g*ve,pe),Y<Math.min(H,g+ie))break}if(Y>=re||Y>g*10)return;U?this.bwEstimator.sample(y-Math.min(L,q),m.loaded):this.bwEstimator.sampleTTFB(y);const $=M[V].maxBitrate;this.getBwEstimate()*oe>$&&this.resetEstimator($);const X=this.findBestLevel($,x,V,0,H,1,1);X>-1&&(V=X),this.warn(`Fragment ${a.sn}${l?" part "+l.index:""} of level ${v} is loading too slowly;
      Fragment duration: ${a.duration.toFixed(3)}
      Time to underbuffer: ${H.toFixed(3)} s
      Estimated load time for current fragment: ${re.toFixed(3)} s
      Estimated load time for down switch fragment: ${Y.toFixed(3)} s
      TTFB estimate: ${q|0} ms
      Current BW estimate: ${We(k)?k|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${V} @ ${$|0} bps`),c.nextLoadLevel=c.nextAutoLevel=V,this.clearTimer();const me=()=>{if(this.clearTimer(),this.fragCurrent===a&&this.hls.loadLevel===V&&V>0){const ve=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${V>0?"and switching down":""}
      Fragment duration: ${a.duration.toFixed(3)} s
      Time to underbuffer: ${ve.toFixed(3)} s`),a.abortRequests(),this.fragCurrent=this.partCurrent=null,V>x){let pe=this.findBestLevel(this.hls.levels[x].bitrate,x,V,0,ve,1,1);pe===-1&&(pe=x),this.hls.nextLoadLevel=this.hls.nextAutoLevel=pe,this.resetEstimator(this.hls.levels[pe].bitrate)}}};A||re>Y*2?me():this.timer=self.setInterval(me,Y*1e3),c.trigger(B.FRAG_LOAD_EMERGENCY_ABORTED,{frag:a,part:l,stats:m})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new uI(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(B.MANIFEST_LOADING,this.onManifestLoading,this),e.on(B.FRAG_LOADING,this.onFragLoading,this),e.on(B.FRAG_LOADED,this.onFragLoaded,this),e.on(B.FRAG_BUFFERED,this.onFragBuffered,this),e.on(B.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(B.LEVEL_LOADED,this.onLevelLoaded,this),e.on(B.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(B.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(B.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(B.MANIFEST_LOADING,this.onManifestLoading,this),e.off(B.FRAG_LOADING,this.onFragLoading,this),e.off(B.FRAG_LOADED,this.onFragLoaded,this),e.off(B.FRAG_BUFFERED,this.onFragBuffered,this),e.off(B.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(B.LEVEL_LOADED,this.onLevelLoaded,this),e.off(B.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(B.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(B.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;if(!this.ignoreFragment(s)){if(!s.bitrateTest){var a;this.fragCurrent=s,this.partCurrent=(a=t.part)!=null?a:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case be.BUFFER_ADD_CODEC_ERROR:case be.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case be.FRAG_LOAD_TIMEOUT:{const s=t.frag,{fragCurrent:a,partCurrent:l}=this;if(s&&a&&s.sn===a.sn&&s.level===a.level){const c=performance.now(),u=l?l.stats:s.stats,f=c-u.loading.start,d=u.loading.first?u.loading.first-u.loading.start:-1;if(u.loaded&&d>-1){const g=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(f-Math.min(g,d),u.loaded)}else this.bwEstimator.sampleTTFB(f)}break}}}getTimeToLoadFrag(e,t,s,a){const l=e+s/t,c=a?e+this.lastLevelLoadSec:0;return l+c}onLevelLoaded(e,t){const s=this.hls.config,{loading:a}=t.stats,l=a.end-a.first;We(l)&&(this.lastLevelLoadSec=l/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:s}){const a=s?s.stats:t.stats;if(t.type===Xe.MAIN&&this.bwEstimator.sampleTTFB(a.loading.first-a.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const l=s?s.duration:t.duration,c=this.hls.levels[t.level],u=(c.loaded?c.loaded.bytes:0)+a.loaded,f=(c.loaded?c.loaded.duration:0)+l;c.loaded={bytes:u,duration:f},c.realBitrate=Math.round(8*u/f)}if(t.bitrateTest){const l={stats:a,frag:t,part:s,id:t.type};this.onFragBuffered(B.FRAG_BUFFERED,l),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:s,part:a}=t,l=a!=null&&a.stats.loaded?a.stats:s.stats;if(l.aborted||this.ignoreFragment(s))return;const c=l.parsing.end-l.loading.start-Math.min(l.loading.first-l.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(c,l.loaded),l.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=c/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Xe.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),a=this.hls.config.maxStarvationDelay,l=this.findBestLevel(s,t,e,0,a,1,1);if(l>-1)return l;const c=this.hls.firstLevel,u=Math.min(Math.max(c,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${c} clamped to ${u}`),u}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,s=this.bwEstimator.canEstimate(),a=this.lastLoadedFragLevel>-1;if(e!==-1&&(!s||!a||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const l=s&&a?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const c=this.hls.levels;if(c.length>Math.max(e,l)&&c[e].loadError<=c[l].loadError)return e}return this._nextAutoLevel=l,this.nextAutoLevelKey=this.getAutoLevelKey(),l}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:a,config:l,minAutoLevel:c}=s,u=t?t.duration:e?e.duration:0,f=this.getBwEstimate(),d=this.getStarvationDelay();let m=l.abrBandWidthFactor,g=l.abrBandWidthUpFactor;if(d){const A=this.findBestLevel(f,c,a,d,0,m,g);if(A>=0)return this.rebufferNotice=-1,A}let y=u?Math.min(u,l.maxStarvationDelay):l.maxStarvationDelay;if(!d){const A=this.bitrateTestDelay;A&&(y=(u?Math.min(u,l.maxLoadingDelay):l.maxLoadingDelay)-A,this.info(`bitrate test took ${Math.round(1e3*A)}ms, set first fragment max fetchDuration to ${Math.round(1e3*y)} ms`),m=g=1)}const x=this.findBestLevel(f,c,a,d,y,m,g);if(this.rebufferNotice!==x&&(this.rebufferNotice=x,this.info(`${d?"rebuffering expected":"buffer is empty"}, optimal quality level ${x}`)),x>-1)return x;const v=s.levels[c],E=s.loadLevelObj;return E&&v?.bitrate<E.bitrate?c:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,a=e.mainForwardBufferInfo;return(a?a.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,a,l,c,u){var f;const d=a+l,m=this.lastLoadedFragLevel,g=m===-1?this.hls.firstLevel:m,{fragCurrent:y,partCurrent:x}=this,{levels:v,allAudioTracks:E,loadLevel:A,config:R}=this.hls;if(v.length===1)return 0;const D=v[g],L=!!((f=this.hls.latestLevelDetails)!=null&&f.live),O=A===-1||m===-1;let H,q="SDR",U=D?.frameRate||0;const{audioPreference:k,videoPreference:M}=R,I=this.audioTracksByGroup||(this.audioTracksByGroup=_S(E));let j=-1;if(O){if(this.firstSelection!==-1)return this.firstSelection;const Q=this.codecTiers||(this.codecTiers=tk(v,I,t,s)),se=ek(Q,q,e,k,M),{codecSet:oe,videoRanges:Y,minFramerate:V,minBitrate:$,minIndex:X,preferHDR:me}=se;j=X,H=oe,q=me?Y[Y.length-1]:Y[0],U=V,e=Math.max(e,$),this.log(`picked start tier ${Jt(se)}`)}else H=D?.codecSet,q=D?.videoRange;const Z=x?x.duration:y?y.duration:0,ae=this.bwEstimator.getEstimateTTFB()/1e3,ie=[];for(let Q=s;Q>=t;Q--){var re;const se=v[Q],oe=Q>g;if(!se)continue;if(R.useMediaCapabilities&&!se.supportedResult&&!se.supportedPromise){const pe=navigator.mediaCapabilities;typeof pe?.decodingInfo=="function"&&HI(se,I,q,U,e,k)?(se.supportedPromise=xS(se,I,pe,this.supportedCache),se.supportedPromise.then(ge=>{if(!this.hls)return;se.supportedResult=ge;const ee=this.hls.levels,ye=ee.indexOf(se);ge.error?this.warn(`MediaCapabilities decodingInfo error: "${ge.error}" for level ${ye} ${Jt(ge)}`):ge.supported?ge.decodingInfoResults.some(Ie=>Ie.smooth===!1||Ie.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${ye} not smooth or powerEfficient: ${Jt(ge)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${ye} ${Jt(ge)}`),ye>-1&&ee.length>1&&(this.log(`Removing unsupported level ${ye}`),this.hls.removeLevel(ye),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(ge=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${ge}`)})):se.supportedResult=pS}if((H&&se.codecSet!==H||q&&se.videoRange!==q||oe&&U>se.frameRate||!oe&&U>0&&U<se.frameRate||(re=se.supportedResult)!=null&&(re=re.decodingInfoResults)!=null&&re.some(pe=>pe.smooth===!1))&&(!O||Q!==j)){ie.push(Q);continue}const Y=se.details,V=(x?Y?.partTarget:Y?.averagetargetduration)||Z;let $;oe?$=u*e:$=c*e;const X=Z&&a>=Z*2&&l===0?se.averageBitrate:se.maxBitrate,me=this.getTimeToLoadFrag(ae,$,X*V,Y===void 0);if($>=X&&(Q===m||se.loadError===0&&se.fragmentError===0)&&(me<=ae||!We(me)||L&&!this.bitrateTestDelay||me<d)){const pe=this.forcedAutoLevel;return Q!==A&&(pe===-1||pe!==A)&&(ie.length&&this.trace(`Skipped level(s) ${ie.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${v[ie[0]].codecs}" ${v[ie[0]].videoRange}; not compatible with "${H}" ${q}`),this.info(`switch candidate:${g}->${Q} adjustedbw(${Math.round($)})-bitrate=${Math.round($-X)} ttfb:${ae.toFixed(1)} avgDuration:${V.toFixed(1)} maxFetchDuration:${d.toFixed(1)} fetchDuration:${me.toFixed(1)} firstSelection:${O} codecSet:${se.codecSet} videoRange:${se.videoRange} hls.loadLevel:${A}`)),O&&(this.firstSelection=Q),Q}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}}const bS={search:function(i,e){let t=0,s=i.length-1,a=null,l=null;for(;t<=s;){a=(t+s)/2|0,l=i[a];const c=e(l);if(c>0)t=a+1;else if(c<0)s=a-1;else return l}return null}};function rk(i,e,t){if(e===null||!Array.isArray(i)||!i.length||!We(e))return null;const s=i[0].programDateTime;if(e<(s||0))return null;const a=i[i.length-1].endProgramDateTime;if(e>=(a||0))return null;for(let l=0;l<i.length;++l){const c=i[l];if(lk(e,t,c))return c}return null}function Sr(i,e,t=0,s=0,a=.005){let l=null;if(i){l=e[1+i.sn-e[0].sn]||null;const u=i.endDTS-t;u>0&&u<15e-7&&(t+=15e-7),l&&i.level!==l.level&&l.end<=i.end&&(l=e[2+i.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(l=e[0]);if(l&&((!i||i.level===l.level)&&Mv(t,s,l)===0||ok(l,i,Math.min(a,s))))return l;const c=bS.search(e,Mv.bind(null,t,s));return c&&(c!==i||!l)?c:l}function ok(i,e,t){if(e&&e.start===0&&e.level<i.level&&(e.endPTS||0)>0){const s=e.tagList.reduce((a,l)=>(l[0]==="INF"&&(a+=parseFloat(l[1])),a),t);return i.start<=s}return!1}function Mv(i=0,e=0,t){if(t.start<=i&&t.start+t.duration>i)return 0;const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-s<=i?1:t.start-s>i&&t.start?-1:0}function lk(i,e,t){const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-s>i}function SS(i,e,t){if(i&&i.startCC<=e&&i.endCC>=e){let s=i.fragments;const{fragmentHint:a}=i;a&&(s=s.concat(a));let l;return bS.search(s,c=>c.cc<e?1:c.cc>e?-1:(l=c,c.end<=t?1:c.start>t?-1:0)),l||null}return null}function id(i){switch(i.details){case be.FRAG_LOAD_TIMEOUT:case be.KEY_LOAD_TIMEOUT:case be.LEVEL_LOAD_TIMEOUT:case be.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function ES(i){return i.details.startsWith("key")}function TS(i){return ES(i)&&!!i.frag&&!i.frag.decryptdata}function jv(i,e){const t=id(e);return i.default[`${t?"timeout":"error"}Retry`]}function wg(i,e){const t=i.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*i.retryDelayMs,i.maxRetryDelayMs)}function Ov(i){return Kt(Kt({},i),{errorRetry:null,timeoutRetry:null})}function nd(i,e,t,s){if(!i)return!1;const a=s?.code,l=e<i.maxNumRetry&&(ck(a)||!!t);return i.shouldRetry?i.shouldRetry(i,e,t,s,l):l}function ck(i){return Rm(i)||!!i&&(i<400||i>499)}function Rm(i){return i===0&&navigator.onLine===!1}var Vs={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Ai={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class uk extends Wi{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(B.ERROR,this.onError,this),e.on(B.MANIFEST_LOADING,this.onManifestLoading,this),e.on(B.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(B.ERROR,this.onError,this),e.off(B.ERROR,this.onErrorOut,this),e.off(B.MANIFEST_LOADING,this.onManifestLoading,this),e.off(B.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===Xe.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,s=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||s===-1?t.loadLevel:s}variantHasKey(e,t){if(e){var s;if((s=e.details)!=null&&s.hasKey(t))return!0;const a=e.audioGroups;if(a)return this.hls.allAudioTracks.filter(c=>a.indexOf(c.groupId)>=0).some(c=>{var u;return(u=c.details)==null?void 0:u.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const a=this.hls,l=t.context;switch(t.details){case be.FRAG_LOAD_ERROR:case be.FRAG_LOAD_TIMEOUT:case be.KEY_LOAD_ERROR:case be.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case be.FRAG_PARSING_ERROR:if((s=t.frag)!=null&&s.gap){t.errorAction=_o();return}case be.FRAG_GAP:case be.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Vs.SendAlternateToPenaltyBox;return}case be.LEVEL_EMPTY_ERROR:case be.LEVEL_PARSING_ERROR:{var c;const f=t.parent===Xe.MAIN?t.level:a.loadLevel;t.details===be.LEVEL_EMPTY_ERROR&&((c=t.context)!=null&&(c=c.levelDetails)!=null&&c.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,f):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,f))}return;case be.LEVEL_LOAD_ERROR:case be.LEVEL_LOAD_TIMEOUT:typeof l?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l.level));return;case be.AUDIO_TRACK_LOAD_ERROR:case be.AUDIO_TRACK_LOAD_TIMEOUT:case be.SUBTITLE_LOAD_ERROR:case be.SUBTITLE_TRACK_LOAD_TIMEOUT:if(l){const f=a.loadLevelObj;if(f&&(l.type===At.AUDIO_TRACK&&f.hasAudioGroup(l.groupId)||l.type===At.SUBTITLE_TRACK&&f.hasSubtitleGroup(l.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.loadLevel),t.errorAction.action=Vs.SendAlternateToPenaltyBox,t.errorAction.flags=Ai.MoveAllAlternatesMatchingHost;return}}return;case be.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Vs.SendAlternateToPenaltyBox,flags:Ai.MoveAllAlternatesMatchingHDCP};return;case be.KEY_SYSTEM_SESSION_UPDATE_FAILED:case be.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case be.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Vs.SendAlternateToPenaltyBox,flags:Ai.MoveAllAlternatesMatchingKey};return;case be.BUFFER_ADD_CODEC_ERROR:case be.REMUX_ALLOC_ERROR:case be.BUFFER_APPEND_ERROR:if(!t.errorAction){var u;t.errorAction=this.getLevelSwitchAction(t,(u=t.level)!=null?u:a.loadLevel)}return;case be.INTERNAL_EXCEPTION:case be.BUFFER_APPENDING_ERROR:case be.BUFFER_FULL_ERROR:case be.LEVEL_SWITCH_ERROR:case be.BUFFER_STALLED_ERROR:case be.BUFFER_SEEK_OVER_HOLE:case be.BUFFER_NUDGE_ON_STALL:t.errorAction=_o();return}t.type===et.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=_o())}getPlaylistRetryOrSwitchAction(e,t){const s=this.hls,a=jv(s.config.playlistLoadPolicy,e),l=this.playlistError++;if(nd(a,l,id(e),e.response))return{action:Vs.RetryRequest,flags:Ai.None,retryConfig:a,retryCount:l};const u=this.getLevelSwitchAction(e,t);return a&&(u.retryConfig=a,u.retryCount=l),u}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),a=t.levels[s],{fragLoadPolicy:l,keyLoadPolicy:c}=t.config,u=jv(ES(e)?c:l,e),f=t.levels.reduce((m,g)=>m+g.fragmentError,0);if(a&&(e.details!==be.FRAG_GAP&&a.fragmentError++,!TS(e)&&nd(u,f,id(e),e.response)))return{action:Vs.RetryRequest,flags:Ai.None,retryConfig:u,retryCount:f};const d=this.getLevelSwitchAction(e,s);return u&&(d.retryConfig=u,d.retryCount=f),d}getLevelSwitchAction(e,t){const s=this.hls;t==null&&(t=s.loadLevel);const a=this.hls.levels[t];if(a){var l,c;const d=e.details;a.loadError++,d===be.BUFFER_APPEND_ERROR&&a.fragmentError++;let m=-1;const{levels:g,loadLevel:y,minAutoLevel:x,maxAutoLevel:v}=s;!s.autoLevelEnabled&&!s.config.preserveManualLevelOnError&&(s.loadLevel=-1);const E=(l=e.frag)==null?void 0:l.type,R=(E===Xe.AUDIO&&d===be.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(d===be.BUFFER_ADD_CODEC_ERROR||d===be.BUFFER_APPEND_ERROR))&&g.some(({audioCodec:q})=>a.audioCodec!==q),L=e.sourceBufferName==="video"&&(d===be.BUFFER_ADD_CODEC_ERROR||d===be.BUFFER_APPEND_ERROR)&&g.some(({codecSet:q,audioCodec:U})=>a.codecSet!==q&&a.audioCodec===U),{type:O,groupId:H}=(c=e.context)!=null?c:{};for(let q=g.length;q--;){const U=(q+y)%g.length;if(U!==y&&U>=x&&U<=v&&g[U].loadError===0){var u,f;const k=g[U];if(d===be.FRAG_GAP&&E===Xe.MAIN&&e.frag){const M=g[U].details;if(M){const I=Sr(e.frag,M.fragments,e.frag.start);if(I!=null&&I.gap)continue}}else{if(O===At.AUDIO_TRACK&&k.hasAudioGroup(H)||O===At.SUBTITLE_TRACK&&k.hasSubtitleGroup(H))continue;if(E===Xe.AUDIO&&(u=a.audioGroups)!=null&&u.some(M=>k.hasAudioGroup(M))||E===Xe.SUBTITLE&&(f=a.subtitleGroups)!=null&&f.some(M=>k.hasSubtitleGroup(M))||R&&a.audioCodec===k.audioCodec||L&&a.codecSet===k.codecSet||!R&&a.codecSet!==k.codecSet)continue}m=U;break}}if(m>-1&&s.loadLevel!==m)return e.levelRetry=!0,this.playlistError=0,{action:Vs.SendAlternateToPenaltyBox,flags:Ai.None,nextAutoLevel:m}}return{action:Vs.SendAlternateToPenaltyBox,flags:Ai.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var s;switch((s=t.errorAction)==null?void 0:s.action){case Vs.DoNothing:break;case Vs.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==be.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:a}=s,l=s.nextAutoLevel;switch(a){case Ai.None:this.switchLevel(e,l);break;case Ai.MoveAllAlternatesMatchingHDCP:{const f=this.getVariantLevelIndex(e.frag),d=t.levels[f],m=d?.attrs["HDCP-LEVEL"];if(s.hdcpLevel=m,m==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(m){t.maxHdcpLevel=Nm[Nm.indexOf(m)-1],s.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Ai.MoveAllAlternatesMatchingKey:{const f=e.decryptdata;if(f){const d=this.hls.levels,m=d.length;for(let y=m;y--;)if(this.variantHasKey(d[y],f)){var c,u;this.log(`Banned key found in level ${y} (${d[y].bitrate}bps) or audio group "${(c=d[y].audioGroups)==null?void 0:c.join(",")}" (${(u=e.frag)==null?void 0:u.type} fragment) ${Hs(f.keyId||[])}`),d[y].fragmentError++,d[y].loadError++,this.log(`Removing level ${y} with key error (${e.error})`),this.hls.removeLevel(y)}const g=e.frag;if(this.hls.levels.length<m)s.resolved=!0;else if(g&&g.type!==Xe.MAIN){const y=g.decryptdata;y&&!f.matches(y)&&(s.resolved=!0)}}break}}s.resolved||this.switchLevel(e,l)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===be.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const s=wm(e.mimeType),a=this.hls.levels;for(let l=a.length;l--;)a[l][`${e.sourceBufferName}Codec`]===s&&(this.log(`Removing level ${l} for ${e.details} ("${s}" not supported)`),this.hls.removeLevel(l))}}}function _o(i){const e={action:Vs.DoNothing,flags:Ai.None};return i&&(e.resolved=!0),e}var Is={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class dk{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(B.MANIFEST_LOADING,this.onManifestLoading,this),e.on(B.BUFFER_APPENDED,this.onBufferAppended,this),e.on(B.FRAG_BUFFERED,this.onFragBuffered,this),e.on(B.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(B.MANIFEST_LOADING,this.onManifestLoading,this),e.off(B.BUFFER_APPENDED,this.onBufferAppended,this),e.off(B.FRAG_BUFFERED,this.onFragBuffered,this),e.off(B.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let a=s.length;a--;){const l=s[a];if(!l)break;if(l.start<=e&&e<=l.end&&l.loaded)return l}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:a}=this,l=Object.keys(a);for(let c=l.length;c--;){const u=a[l[c]];if(u?.body.type===t&&(!s||u.buffered)){const f=u.body;if(f.start<=e&&e<=f.end)return f}}return null}detectEvictedFragments(e,t,s,a,l){this.timeRanges&&(this.timeRanges[e]=t);const c=a?.fragment.sn||-1;Object.keys(this.fragments).forEach(u=>{const f=this.fragments[u];if(!f||c>=f.body.sn)return;if(!f.buffered&&(!f.loaded||l)){f.body.type===s&&this.removeFragment(f.body);return}const d=f.range[e];if(d){if(d.time.length===0){this.removeFragment(f.body);return}d.time.some(m=>{const g=!this.isTimeBuffered(m.startPTS,m.endPTS,t);return g&&this.removeFragment(f.body),g})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const s=e.frag,a=uo(s),l=this.fragments[a];if(!l||l.buffered&&s.gap)return;const c=!s.relurl;Object.keys(t).forEach(u=>{const f=s.elementaryStreams[u];if(!f)return;const d=t[u],m=c||f.partial===!0;l.range[u]=this.getBufferedTimes(s,e.part,m,d)}),l.loaded=null,Object.keys(l.range).length?(this.bufferedEnd(l,s),vu(l)||this.removeParts(s.sn-1,s.type)):this.removeFragment(l.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=Pv(s,a=>a.fragment.sn>=e))}fragBuffered(e,t){const s=uo(e);let a=this.fragments[s];!a&&t&&(a=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),a&&(a.loaded=null,this.bufferedEnd(a,e))}getBufferedTimes(e,t,s,a){const l={time:[],partial:s},c=e.start,u=e.end,f=e.minEndPTS||u,d=e.maxStartPTS||c;for(let m=0;m<a.length;m++){const g=a.start(m)-this.bufferPadding,y=a.end(m)+this.bufferPadding;if(d>=g&&f<=y){l.time.push({startPTS:Math.max(c,a.start(m)),endPTS:Math.min(u,a.end(m))});break}else if(c<y&&u>g){const x=Math.max(c,a.start(m)),v=Math.min(u,a.end(m));v>x&&(l.partial=!0,l.time.push({startPTS:x,endPTS:v}))}else if(u<=g)break}return l}getPartialFragment(e){let t=null,s,a,l,c=0;const{bufferPadding:u,fragments:f}=this;return Object.keys(f).forEach(d=>{const m=f[d];m&&vu(m)&&(a=m.body.start-u,l=m.body.end+u,e>=a&&e<=l&&(s=Math.min(e-a,l-e),c<=s&&(t=m.body,c=s)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||vu(t))}getState(e){const t=uo(e),s=this.fragments[t];return s?s.buffered?vu(s)?Is.PARTIAL:Is.OK:Is.APPENDING:Is.NOT_LOADED}isTimeBuffered(e,t,s){let a,l;for(let c=0;c<s.length;c++){if(a=s.start(c)-this.bufferPadding,l=s.end(c)+this.bufferPadding,e>=a&&t<=l)return!0;if(t<=a)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const s=t.frag,a=t.part?null:t,l=uo(s);this.fragments[l]={body:s,appendedPTS:null,loaded:a,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:a,timeRanges:l,type:c}=t;if(s.sn==="initSegment")return;const u=s.type;if(a){let d=this.activePartLists[u];d||(this.activePartLists[u]=d=[]),d.push(a)}this.timeRanges=l;const f=l[c];this.detectEvictedFragments(c,f,u,a)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=uo(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let a=s.length;a--;){const l=t[s[a]];if(l?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,s,a,l){a&&!this.hasGaps||Object.keys(this.fragments).forEach(c=>{const u=this.fragments[c];if(!u)return;const f=u.body;f.type!==s||a&&!f.gap||f.start<t&&f.end>e&&(u.buffered||l)&&this.removeFragment(f)})}removeFragment(e){const t=uo(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const a=e.sn;this.activePartLists[e.type]=Pv(s,l=>l.fragment.sn!==a)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(s=>s.clearElementaryStreamInfo())}}function vu(i){var e,t,s;return i.buffered&&!!(i.body.gap||(e=i.range.video)!=null&&e.partial||(t=i.range.audio)!=null&&t.partial||(s=i.range.audiovideo)!=null&&s.partial)}function uo(i){return`${i.type}_${i.level}_${i.sn}`}function Pv(i,e){return i.filter(t=>{const s=e(t);return s||t.clearElementaryStreamInfo(),s})}var ja={cbc:0,ctr:1};class hk{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case ja.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case ja.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function fk(i){const e=i.byteLength,t=e&&new DataView(i.buffer).getUint8(e-1);return t?i.slice(0,e-t):i}class mk{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let a=0;a<4;a++)s[a]=t.getUint32(a*4);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,a=s[0],l=s[1],c=s[2],u=s[3],f=this.invSubMix,d=f[0],m=f[1],g=f[2],y=f[3],x=new Uint32Array(256);let v=0,E=0,A=0;for(A=0;A<256;A++)A<128?x[A]=A<<1:x[A]=A<<1^283;for(A=0;A<256;A++){let R=E^E<<1^E<<2^E<<3^E<<4;R=R>>>8^R&255^99,e[v]=R,t[R]=v;const D=x[v],L=x[D],O=x[L];let H=x[R]*257^R*16843008;a[v]=H<<24|H>>>8,l[v]=H<<16|H>>>16,c[v]=H<<8|H>>>24,u[v]=H,H=O*16843009^L*65537^D*257^v*16843008,d[R]=H<<24|H>>>8,m[R]=H<<16|H>>>16,g[R]=H<<8|H>>>24,y[R]=H,v?(v=D^x[x[x[O^D]]],E^=x[x[E]]):v=E=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,a=0;for(;a<t.length&&s;)s=t[a]===this.key[a],a++;if(s)return;this.key=t;const l=this.keySize=t.length;if(l!==4&&l!==6&&l!==8)throw new Error("Invalid aes key size="+l);const c=this.ksRows=(l+6+1)*4;let u,f;const d=this.keySchedule=new Uint32Array(c),m=this.invKeySchedule=new Uint32Array(c),g=this.sBox,y=this.rcon,x=this.invSubMix,v=x[0],E=x[1],A=x[2],R=x[3];let D,L;for(u=0;u<c;u++){if(u<l){D=d[u]=t[u];continue}L=D,u%l===0?(L=L<<8|L>>>24,L=g[L>>>24]<<24|g[L>>>16&255]<<16|g[L>>>8&255]<<8|g[L&255],L^=y[u/l|0]<<24):l>6&&u%l===4&&(L=g[L>>>24]<<24|g[L>>>16&255]<<16|g[L>>>8&255]<<8|g[L&255]),d[u]=D=(d[u-l]^L)>>>0}for(f=0;f<c;f++)u=c-f,f&3?L=d[u]:L=d[u-4],f<4||u<=4?m[f]=L:m[f]=v[g[L>>>24]]^E[g[L>>>16&255]]^A[g[L>>>8&255]]^R[g[L&255]],m[f]=m[f]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,s){const a=this.keySize+6,l=this.invKeySchedule,c=this.invSBox,u=this.invSubMix,f=u[0],d=u[1],m=u[2],g=u[3],y=this.uint8ArrayToUint32Array_(s);let x=y[0],v=y[1],E=y[2],A=y[3];const R=new Int32Array(e),D=new Int32Array(R.length);let L,O,H,q,U,k,M,I,j,Z,ae,ie,re,Q;const se=this.networkToHostOrderSwap;for(;t<R.length;){for(j=se(R[t]),Z=se(R[t+1]),ae=se(R[t+2]),ie=se(R[t+3]),U=j^l[0],k=ie^l[1],M=ae^l[2],I=Z^l[3],re=4,Q=1;Q<a;Q++)L=f[U>>>24]^d[k>>16&255]^m[M>>8&255]^g[I&255]^l[re],O=f[k>>>24]^d[M>>16&255]^m[I>>8&255]^g[U&255]^l[re+1],H=f[M>>>24]^d[I>>16&255]^m[U>>8&255]^g[k&255]^l[re+2],q=f[I>>>24]^d[U>>16&255]^m[k>>8&255]^g[M&255]^l[re+3],U=L,k=O,M=H,I=q,re=re+4;L=c[U>>>24]<<24^c[k>>16&255]<<16^c[M>>8&255]<<8^c[I&255]^l[re],O=c[k>>>24]<<24^c[M>>16&255]<<16^c[I>>8&255]<<8^c[U&255]^l[re+1],H=c[M>>>24]<<24^c[I>>16&255]<<16^c[U>>8&255]<<8^c[k&255]^l[re+2],q=c[I>>>24]<<24^c[U>>16&255]<<16^c[k>>8&255]<<8^c[M&255]^l[re+3],D[t]=se(L^x),D[t+1]=se(q^v),D[t+2]=se(H^E),D[t+3]=se(O^A),x=j,v=Z,E=ae,A=ie,t=t+4}return D.buffer}}class gk{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=pk(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function pk(i){switch(i){case ja.cbc:return"AES-CBC";case ja.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${i}`)}}const yk=16;class Ng{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?fk(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,a){return this.useSoftware?new Promise((l,c)=>{const u=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(u,t,s,a);const f=this.flush();f?l(f.buffer):c(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,s,a)}softwareDecrypt(e,t,s,a){const{currentIV:l,currentResult:c,remainderData:u}=this;if(a!==ja.cbc||t.byteLength!==16)return zt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),u&&(e=qi(u,e),this.remainderData=null);const f=this.getValidChunk(e);if(!f.length)return null;l&&(s=l);let d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new mk),d.expandKey(t);const m=c;return this.currentResult=d.decrypt(f.buffer,0,s),this.currentIV=f.slice(-16).buffer,m||null}webCryptoDecrypt(e,t,s,a){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,a));this.key=t,this.fastAesKey=new gk(this.subtle,t,a)}return this.fastAesKey.expandKey().then(l=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new hk(this.subtle,new Uint8Array(s),a).decrypt(e.buffer,l)):Promise.reject(new Error("web crypto not initialized"))).catch(l=>(zt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${l.name}: ${l.message}`),this.onWebCryptoError(e,t,s,a)))}onWebCryptoError(e,t,s,a){const l=this.enableSoftwareAES;if(l){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,a);const c=this.flush();if(c)return c.buffer}throw new Error("WebCrypto"+(l?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%yk;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(zt.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Bv=Math.pow(2,17);class xk{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new zn({type:et.NETWORK_ERROR,details:be.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${s?"part list":"url"}`),networkDetails:null}));this.abort();const a=this.config,l=a.fLoader,c=a.loader;return new Promise((u,f)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(v=>v[0]==="GAP")){f(Fv(e));return}else e.gap=!1;const d=this.loader=l?new l(a):new c(a),m=Uv(e);e.loader=d;const g=Ov(a.fragLoadPolicy.default),y={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Bv};e.stats=d.stats;const x={onSuccess:(v,E,A,R)=>{this.resetLoader(e,d);let D=v.data;A.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(D.slice(0,16)),D=D.slice(16)),u({frag:e,part:null,payload:D,networkDetails:R})},onError:(v,E,A,R)=>{this.resetLoader(e,d),f(new zn({type:et.NETWORK_ERROR,details:be.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Kt({url:s,data:void 0},v),error:new Error(`HTTP Error ${v.code} ${v.text}`),networkDetails:A,stats:R}))},onAbort:(v,E,A)=>{this.resetLoader(e,d),f(new zn({type:et.NETWORK_ERROR,details:be.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:A,stats:v}))},onTimeout:(v,E,A)=>{this.resetLoader(e,d),f(new zn({type:et.NETWORK_ERROR,details:be.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${y.timeout}ms`),networkDetails:A,stats:v}))}};t&&(x.onProgress=(v,E,A,R)=>t({frag:e,part:null,payload:A,networkDetails:R})),d.load(m,y,x)})}loadPart(e,t,s){this.abort();const a=this.config,l=a.fLoader,c=a.loader;return new Promise((u,f)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){f(Fv(e,t));return}const d=this.loader=l?new l(a):new c(a),m=Uv(e,t);e.loader=d;const g=Ov(a.fragLoadPolicy.default),y={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Bv};t.stats=d.stats,d.load(m,y,{onSuccess:(x,v,E,A)=>{this.resetLoader(e,d),this.updateStatsFromPart(e,t);const R={frag:e,part:t,payload:x.data,networkDetails:A};s(R),u(R)},onError:(x,v,E,A)=>{this.resetLoader(e,d),f(new zn({type:et.NETWORK_ERROR,details:be.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Kt({url:m.url,data:void 0},x),error:new Error(`HTTP Error ${x.code} ${x.text}`),networkDetails:E,stats:A}))},onAbort:(x,v,E)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,d),f(new zn({type:et.NETWORK_ERROR,details:be.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:E,stats:x}))},onTimeout:(x,v,E)=>{this.resetLoader(e,d),f(new zn({type:et.NETWORK_ERROR,details:be.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${y.timeout}ms`),networkDetails:E,stats:x}))}})})}updateStatsFromPart(e,t){const s=e.stats,a=t.stats,l=a.total;if(s.loaded+=a.loaded,l){const f=Math.round(e.duration/t.duration),d=Math.min(Math.round(s.loaded/l),f),g=(f-d)*Math.round(s.loaded/d);s.total=s.loaded+g}else s.total=Math.max(s.loaded,s.total);const c=s.loading,u=a.loading;c.start?c.first+=u.first-u.start:(c.start=u.start,c.first=u.first),c.end=u.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Uv(i,e=null){const t=e||i,s={frag:i,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},a=t.byteRangeStartOffset,l=t.byteRangeEndOffset;if(We(a)&&We(l)){var c;let u=a,f=l;if(i.sn==="initSegment"&&vk((c=i.decryptdata)==null?void 0:c.method)){const d=l-a;d%16&&(f=l+(16-d%16)),a!==0&&(s.resetIV=!0,u=a-16)}s.rangeStart=u,s.rangeEnd=f}return s}function Fv(i,e){const t=new Error(`GAP ${i.gap?"tag":"attribute"} found`),s={type:et.MEDIA_ERROR,details:be.FRAG_GAP,fatal:!1,frag:i,error:t,networkDetails:null};return e&&(s.part=e),(e||i).stats.aborted=!0,new zn(s)}function vk(i){return i==="AES-128"||i==="AES-256"}class zn extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class AS extends Wi{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Rg{constructor(e,t,s,a=0,l=-1,c=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=_u(),this.buffering={audio:_u(),video:_u(),audiovideo:_u()},this.level=e,this.sn=t,this.id=s,this.size=a,this.part=l,this.partial=c}}function _u(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Gv={length:0,start:()=>0,end:()=>0};class pt{static isBuffered(e,t){if(e){const s=pt.getBuffered(e);for(let a=s.length;a--;)if(t>=s.start(a)&&t<=s.end(a))return!0}return!1}static bufferedRanges(e){if(e){const t=pt.getBuffered(e);return pt.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const a=pt.bufferedRanges(e);if(a.length)return pt.bufferedInfo(a,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort((m,g)=>m.start-g.start||g.end-m.end);let a=-1,l=[];if(s)for(let m=0;m<e.length;m++){t>=e[m].start&&t<=e[m].end&&(a=m);const g=l.length;if(g){const y=l[g-1].end;e[m].start-y<s?e[m].end>y&&(l[g-1].end=e[m].end):l.push(e[m])}else l.push(e[m])}else l=e;let c=0,u,f=t,d=t;for(let m=0;m<l.length;m++){const g=l[m].start,y=l[m].end;if(a===-1&&t>=g&&t<=y&&(a=m),t+s>=g&&t<y)f=g,d=y,c=d-t;else if(t+s<g){u=g;break}}return{len:c,start:f||0,end:d||0,nextStart:u,buffered:e,bufferedIndex:a}}static getBuffered(e){try{return e.buffered||Gv}catch(t){return zt.log("failed to get media.buffered",t),Gv}}}const wS=/\{\$([a-zA-Z0-9-_]+)\}/g;function $v(i){return wS.test(i)}function Cm(i,e){if(i.variableList!==null||i.hasVariableRefs){const t=i.variableList;return e.replace(wS,s=>{const a=s.substring(2,s.length-1),l=t?.[a];return l===void 0?(i.playlistParsingError||(i.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${a}"`)),s):l})}return e}function Vv(i,e,t){let s=i.variableList;s||(i.variableList=s={});let a,l;if("QUERYPARAM"in e){a=e.QUERYPARAM;try{const c=new self.URL(t).searchParams;if(c.has(a))l=c.get(a);else throw new Error(`"${a}" does not match any query parameter in URI: "${t}"`)}catch(c){i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${c.message}`))}}else a=e.NAME,l=e.VALUE;a in s?i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${a}"`)):s[a]=l||""}function _k(i,e,t){const s=e.IMPORT;if(t&&s in t){let a=i.variableList;a||(i.variableList=a={}),a[s]=t[s]}else i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${s}"`))}const bk=/^(\d+)x(\d+)$/,Hv=/(.+?)=(".*?"|.*?)(?:,|$)/g;class cs{constructor(e,t){typeof e=="string"&&(e=cs.parseAttrList(e,t)),Xt(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const s=new Uint8Array(t.length/2);for(let a=0;a<t.length/2;a++)s[a]=parseInt(t.slice(a*2,a*2+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce((a,l)=>(a[l.toLowerCase()]=!0,a),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=bk.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const a={};for(Hv.lastIndex=0;(s=Hv.exec(e))!==null;){const c=s[1].trim();let u=s[2];const f=u.indexOf('"')===0&&u.lastIndexOf('"')===u.length-1;let d=!1;if(f)u=u.slice(1,-1);else switch(c){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":d=!0}if(t&&(f||d))u=Cm(t,u);else if(!d&&!f)switch(c){case"CLOSED-CAPTIONS":if(u==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":zt.warn(`${e}: attribute ${c} is missing quotes`)}a[c]=u}return a}}const Sk="com.apple.hls.interstitial";function Ek(i){return i!=="ID"&&i!=="CLASS"&&i!=="CUE"&&i!=="START-DATE"&&i!=="DURATION"&&i!=="END-DATE"&&i!=="END-ON-NEXT"}function Tk(i){return i==="SCTE35-OUT"||i==="SCTE35-IN"||i==="SCTE35-CMD"}class NS{constructor(e,t,s=0){var a;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(a=t?.tagOrder)!=null?a:s,t){const l=t.attr;for(const c in l)if(Object.prototype.hasOwnProperty.call(e,c)&&e[c]!==l[c]){zt.warn(`DATERANGE tag attribute: "${c}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=c;break}e=Xt(new cs({}),l,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const l=t?.endDate||new Date(this.attr["END-DATE"]);We(l.getTime())&&(this._endDate=l)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(zt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(We(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===Sk}get isValid(){return!!this.id&&!this._badValueForSameId&&We(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const Ak=10;class wk{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&s>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let s=t.decryptdata;return s||(t.setKeyFormat(e.keyFormat),s=t.decryptdata),!!s&&e.matches(s)})}get hasProgramDateTime(){return this.fragments.length?We(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||Ak}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function ad(i,e){return i.length===e.length?!i.some((t,s)=>t!==e[s]):!1}function Kv(i,e){return!i&&!e?!0:!i||!e?!1:ad(i,e)}function bo(i){return i==="AES-128"||i==="AES-256"||i==="AES-256-CTR"}function Cg(i){switch(i){case"AES-128":case"AES-256":return ja.cbc;case"AES-256-CTR":return ja.ctr;default:throw new Error(`invalid full segment method ${i}`)}}function Lg(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0))}function Lm(i){return Uint8Array.from(unescape(encodeURIComponent(i)),e=>e.charCodeAt(0))}function Nk(i){const e=Lm(i).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function RS(i){const e=function(s,a,l){const c=s[a];s[a]=s[l],s[l]=c};e(i,0,3),e(i,1,2),e(i,4,5),e(i,6,7)}function CS(i){const e=i.split(":");let t=null;if(e[0]==="data"&&e.length===2){const s=e[1].split(";"),a=s[s.length-1].split(",");if(a.length===2){const l=a[0]==="base64",c=a[1];l?(s.splice(-1,1),t=Lg(c)):t=Nk(c)}}return t}const rd=typeof self<"u"?self:void 0;var us={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Ks={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function $u(i){switch(i){case Ks.FAIRPLAY:return us.FAIRPLAY;case Ks.PLAYREADY:return us.PLAYREADY;case Ks.WIDEVINE:return us.WIDEVINE;case Ks.CLEARKEY:return us.CLEARKEY}}function $f(i){switch(i){case us.FAIRPLAY:return Ks.FAIRPLAY;case us.PLAYREADY:return Ks.PLAYREADY;case us.WIDEVINE:return Ks.WIDEVINE;case us.CLEARKEY:return Ks.CLEARKEY}}function Ml(i){const{drmSystems:e,widevineLicenseUrl:t}=i,s=e?[us.FAIRPLAY,us.WIDEVINE,us.PLAYREADY,us.CLEARKEY].filter(a=>!!e[a]):[];return!s[us.WIDEVINE]&&t&&s.push(us.WIDEVINE),s}const LS=(function(i){return rd!=null&&(i=rd.navigator)!=null&&i.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function Rk(i,e,t,s){let a;switch(i){case us.FAIRPLAY:a=["cenc","sinf"];break;case us.WIDEVINE:case us.PLAYREADY:a=["cenc"];break;case us.CLEARKEY:a=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${i}`)}return Ck(a,e,t,s)}function Ck(i,e,t,s){return[{initDataTypes:i,persistentState:s.persistentState||"optional",distinctiveIdentifier:s.distinctiveIdentifier||"optional",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:e.map(l=>({contentType:`audio/mp4; codecs=${l}`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null})),videoCapabilities:t.map(l=>({contentType:`video/mp4; codecs=${l}`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}))}]}function Lk(i){var e;return!!i&&(i.sessionType==="persistent-license"||!!((e=i.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function DS(i){const e=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),s=t.substring(t.indexOf("<"),t.length),c=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(c){const u=c.childNodes[0]?c.childNodes[0].nodeValue:c.getAttribute("VALUE");if(u){const f=Lg(u).subarray(0,16);return RS(f),f}}return null}let ho={};class Ia{static clearKeyUriToKeyIdMap(){ho={}}static setKeyIdForUri(e,t){ho[e]=t}static addKeyIdForUri(e){const t=Object.keys(ho).length%Number.MAX_SAFE_INTEGER,s=new Uint8Array(16);return new DataView(s.buffer,12,4).setUint32(0,t),ho[e]=s,s}constructor(e,t,s,a=[1],l=null,c){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=a,this.iv=l,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!bo(e),c!=null&&c.startsWith("0x")&&(this.keyId=new Uint8Array(aS(c)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&ad(e.keyFormatVersions,this.keyFormatVersions)&&Kv(e.iv,this.iv)&&Kv(e.keyId,this.keyId)}isSupported(){if(this.method){if(bo(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Ks.FAIRPLAY:case Ks.WIDEVINE:case Ks.PLAYREADY:case Ks.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(bo(this.method)){let l=this.iv;return l||(typeof e!="number"&&(zt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),l=Ik(e)),new Ia(this.method,this.uri,"identity",this.keyFormatVersions,l)}if(this.keyId){const l=ho[this.uri];if(l&&!ad(this.keyId,l)&&Ia.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const s=CS(this.uri);if(s)switch(this.keyFormat){case Ks.WIDEVINE:if(this.pssh=s,!this.keyId){const l=jI(s.buffer);if(l.length){var a;const c=l[0];this.keyId=(a=c.kids)!=null&&a.length?c.kids[0]:null}}this.keyId||(this.keyId=zv(t));break;case Ks.PLAYREADY:{const l=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=MI(l,null,s),this.keyId=DS(s);break}default:{let l=s.subarray(0,16);if(l.length!==16){const c=new Uint8Array(16);c.set(l,16-l.length),l=c}this.keyId=l;break}}if(!this.keyId||this.keyId.byteLength!==16){let l;l=Dk(t),l||(l=zv(t),l||(l=ho[this.uri])),l&&(this.keyId=l,Ia.setKeyIdForUri(this.uri,l))}return this}}function Dk(i){const e=i?.[Ks.WIDEVINE];return e?e.keyId:null}function zv(i){const e=i?.[Ks.PLAYREADY];if(e){const t=CS(e.uri);if(t)return DS(t)}return null}function Ik(i){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=i>>8*(15-t)&255;return e}const qv=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Yv=/#EXT-X-MEDIA:(.*)/g,kk=/^#EXT(?:INF|-X-TARGETDURATION):/m,Vf=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Mk=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class _n{static findGroup(e,t){for(let s=0;s<e.length;s++){const a=e[s];if(a.id===t)return a}}static resolve(e,t){return bg.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return kk.test(e)}static parseMasterPlaylist(e,t){const s=$v(e),a={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:s},l=[];if(qv.lastIndex=0,!e.startsWith("#EXTM3U"))return a.playlistParsingError=new Error("no EXTM3U delimiter"),a;let c;for(;(c=qv.exec(e))!=null;)if(c[1]){var u;const d=new cs(c[1],a),m=Cm(a,c[2]),g={attrs:d,bitrate:d.decimalInteger("BANDWIDTH")||d.decimalInteger("AVERAGE-BANDWIDTH"),name:d.NAME,url:_n.resolve(m,t)},y=d.decimalResolution("RESOLUTION");y&&(g.width=y.width,g.height=y.height),Qv(d.CODECS,g);const x=d["SUPPLEMENTAL-CODECS"];x&&(g.supplemental={},Qv(x,g.supplemental)),(u=g.unknownCodecs)!=null&&u.length||l.push(g),a.levels.push(g)}else if(c[3]){const d=c[3],m=c[4];switch(d){case"SESSION-DATA":{const g=new cs(m,a),y=g["DATA-ID"];y&&(a.sessionData===null&&(a.sessionData={}),a.sessionData[y]=g);break}case"SESSION-KEY":{const g=Wv(m,t,a);g.encrypted&&g.isSupported()?(a.sessionKeys===null&&(a.sessionKeys=[]),a.sessionKeys.push(g)):zt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${m}"`);break}case"DEFINE":{{const g=new cs(m,a);Vv(a,g,t)}break}case"CONTENT-STEERING":{const g=new cs(m,a);a.contentSteering={uri:_n.resolve(g["SERVER-URI"],t),pathwayId:g["PATHWAY-ID"]||"."};break}case"START":{a.startTimeOffset=Xv(m);break}}}const f=l.length>0&&l.length<a.levels.length;return a.levels=f?l:a.levels,a.levels.length===0&&(a.playlistParsingError=new Error("no levels found in manifest")),a}static parseMasterPlaylistMedia(e,t,s){let a;const l={},c=s.levels,u={AUDIO:c.map(d=>({id:d.attrs.AUDIO,audioCodec:d.audioCodec})),SUBTITLES:c.map(d=>({id:d.attrs.SUBTITLES,textCodec:d.textCodec})),"CLOSED-CAPTIONS":[]};let f=0;for(Yv.lastIndex=0;(a=Yv.exec(e))!==null;){const d=new cs(a[1],s),m=d.TYPE;if(m){const g=u[m],y=l[m]||[];l[m]=y;const x=d.LANGUAGE,v=d["ASSOC-LANGUAGE"],E=d.CHANNELS,A=d.CHARACTERISTICS,R=d["INSTREAM-ID"],D={attrs:d,bitrate:0,id:f++,groupId:d["GROUP-ID"]||"",name:d.NAME||x||"",type:m,default:d.bool("DEFAULT"),autoselect:d.bool("AUTOSELECT"),forced:d.bool("FORCED"),lang:x,url:d.URI?_n.resolve(d.URI,t):""};if(v&&(D.assocLang=v),E&&(D.channels=E),A&&(D.characteristics=A),R&&(D.instreamId=R),g!=null&&g.length){const L=_n.findGroup(g,D.groupId)||g[0];Zv(D,L,"audioCodec"),Zv(D,L,"textCodec")}y.push(D)}}return l}static parseLevelPlaylist(e,t,s,a,l,c){var u;const f={url:t},d=new wk(t),m=d.fragments,g=[];let y=null,x=0,v=0,E=0,A=0,R=0,D=null,L=new Uf(a,f),O,H,q,U=-1,k=!1,M=null,I;if(Vf.lastIndex=0,d.m3u8=e,d.hasVariableRefs=$v(e),((u=Vf.exec(e))==null?void 0:u[0])!=="#EXTM3U")return d.playlistParsingError=new Error("Missing format identifier #EXTM3U"),d;for(;(O=Vf.exec(e))!==null;){k&&(k=!1,L=new Uf(a,f),L.playlistOffset=E,L.setStart(E),L.sn=x,L.cc=A,R&&(L.bitrate=R),L.level=s,y&&(L.initSegment=y,y.rawProgramDateTime&&(L.rawProgramDateTime=y.rawProgramDateTime,y.rawProgramDateTime=null),M&&(L.setByteRange(M),M=null)));const ie=O[1];if(ie){L.duration=parseFloat(ie);const re=(" "+O[2]).slice(1);L.title=re||null,L.tagList.push(re?["INF",ie,re]:["INF",ie])}else if(O[3]){if(We(L.duration)){L.playlistOffset=E,L.setStart(E),q&&e_(L,q,d),L.sn=x,L.level=s,L.cc=A,m.push(L);const re=(" "+O[3]).slice(1);L.relurl=Cm(d,re),Dm(L,D,g),D=L,E+=L.duration,x++,v=0,k=!0}}else{if(O=O[0].match(Mk),!O){zt.warn("No matches on slow regex match for level playlist!");continue}for(H=1;H<O.length&&O[H]===void 0;H++);const re=(" "+O[H]).slice(1),Q=(" "+O[H+1]).slice(1),se=O[H+2]?(" "+O[H+2]).slice(1):null;switch(re){case"BYTERANGE":D?L.setByteRange(Q,D):L.setByteRange(Q);break;case"PROGRAM-DATE-TIME":L.rawProgramDateTime=Q,L.tagList.push(["PROGRAM-DATE-TIME",Q]),U===-1&&(U=m.length);break;case"PLAYLIST-TYPE":d.type&&Hn(d,re,O),d.type=Q.toUpperCase();break;case"MEDIA-SEQUENCE":d.startSN!==0?Hn(d,re,O):m.length>0&&t_(d,re,O),x=d.startSN=parseInt(Q);break;case"SKIP":{d.skippedSegments&&Hn(d,re,O);const oe=new cs(Q,d),Y=oe.decimalInteger("SKIPPED-SEGMENTS");if(We(Y)){d.skippedSegments+=Y;for(let $=Y;$--;)m.push(null);x+=Y}const V=oe.enumeratedString("RECENTLY-REMOVED-DATERANGES");V&&(d.recentlyRemovedDateranges=(d.recentlyRemovedDateranges||[]).concat(V.split("	")));break}case"TARGETDURATION":d.targetduration!==0&&Hn(d,re,O),d.targetduration=Math.max(parseInt(Q),1);break;case"VERSION":d.version!==null&&Hn(d,re,O),d.version=parseInt(Q);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":d.live||Hn(d,re,O),d.live=!1;break;case"#":(Q||se)&&L.tagList.push(se?[Q,se]:[Q]);break;case"DISCONTINUITY":A++,L.tagList.push(["DIS"]);break;case"GAP":L.gap=!0,L.tagList.push([re]);break;case"BITRATE":L.tagList.push([re,Q]),R=parseInt(Q)*1e3,We(R)?L.bitrate=R:R=0;break;case"DATERANGE":{const oe=new cs(Q,d),Y=new NS(oe,d.dateRanges[oe.ID],d.dateRangeTagCount);d.dateRangeTagCount++,Y.isValid||d.skippedSegments?d.dateRanges[Y.id]=Y:zt.warn(`Ignoring invalid DATERANGE tag: "${Q}"`),L.tagList.push(["EXT-X-DATERANGE",Q]);break}case"DEFINE":{{const oe=new cs(Q,d);"IMPORT"in oe?_k(d,oe,c):Vv(d,oe,t)}break}case"DISCONTINUITY-SEQUENCE":d.startCC!==0?Hn(d,re,O):m.length>0&&t_(d,re,O),d.startCC=A=parseInt(Q);break;case"KEY":{const oe=Wv(Q,t,d);if(oe.isSupported()){if(oe.method==="NONE"){q=void 0;break}q||(q={});const Y=q[oe.keyFormat];Y!=null&&Y.matches(oe)||(Y&&(q=Xt({},q)),q[oe.keyFormat]=oe)}else zt.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${Q}"`);break}case"START":d.startTimeOffset=Xv(Q);break;case"MAP":{const oe=new cs(Q,d);if(L.duration){const Y=new Uf(a,f);Jv(Y,oe,s,q),y=Y,L.initSegment=y,y.rawProgramDateTime&&!L.rawProgramDateTime&&(L.rawProgramDateTime=y.rawProgramDateTime)}else{const Y=L.byteRangeEndOffset;if(Y){const V=L.byteRangeStartOffset;M=`${Y-V}@${V}`}else M=null;Jv(L,oe,s,q),y=L,k=!0}y.cc=A;break}case"SERVER-CONTROL":{I&&Hn(d,re,O),I=new cs(Q),d.canBlockReload=I.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=I.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&I.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=I.optionalFloat("PART-HOLD-BACK",0),d.holdBack=I.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{d.partTarget&&Hn(d,re,O);const oe=new cs(Q);d.partTarget=oe.decimalFloatingPoint("PART-TARGET");break}case"PART":{let oe=d.partList;oe||(oe=d.partList=[]);const Y=v>0?oe[oe.length-1]:void 0,V=v++,$=new cs(Q,d),X=new _I($,L,f,V,Y);oe.push(X),L.duration+=X.duration;break}case"PRELOAD-HINT":{const oe=new cs(Q,d);d.preloadHint=oe;break}case"RENDITION-REPORT":{const oe=new cs(Q,d);d.renditionReports=d.renditionReports||[],d.renditionReports.push(oe);break}default:zt.warn(`line parsed but not handled: ${O}`);break}}}D&&!D.relurl?(m.pop(),E-=D.duration,d.partList&&(d.fragmentHint=D)):d.partList&&(Dm(L,D,g),L.cc=A,d.fragmentHint=L,q&&e_(L,q,d)),d.targetduration||(d.playlistParsingError=new Error("Missing Target Duration"));const j=m.length,Z=m[0],ae=m[j-1];if(E+=d.skippedSegments*d.targetduration,E>0&&j&&ae){d.averagetargetduration=E/j;const ie=ae.sn;d.endSN=ie!=="initSegment"?ie:0,d.live||(ae.endList=!0),U>0&&(Ok(m,U),Z&&g.unshift(Z))}return d.fragmentHint&&(E+=d.fragmentHint.duration),d.totalduration=E,g.length&&d.dateRangeTagCount&&Z&&IS(g,d),d.endCC=A,d}}function IS(i,e){let t=i.length;if(!t)if(e.hasProgramDateTime){const u=e.fragments[e.fragments.length-1];i.push(u),t++}else return;const s=i[t-1],a=e.live?1/0:e.totalduration,l=Object.keys(e.dateRanges);for(let u=l.length;u--;){const f=e.dateRanges[l[u]],d=f.startDate.getTime();f.tagAnchor=s.ref;for(let m=t;m--;){var c;if(((c=i[m])==null?void 0:c.sn)<e.startSN)break;const g=jk(e,d,i,m,a);if(g!==-1){f.tagAnchor=e.fragments[g].ref;break}}}}function jk(i,e,t,s,a){const l=t[s];if(l){const u=l.programDateTime;if(e>=u||s===0){var c;const f=(((c=t[s+1])==null?void 0:c.start)||a)-l.start;if(e<=u+f*1e3){const d=t[s].sn-i.startSN;if(d<0)return-1;const m=i.fragments;if(m.length>t.length){const y=(t[s+1]||m[m.length-1]).sn-i.startSN;for(let x=y;x>d;x--){const v=m[x].programDateTime;if(e>=v&&e<v+m[x].duration*1e3)return x}}return d}}}return-1}function Wv(i,e,t){var s,a;const l=new cs(i,t),c=(s=l.METHOD)!=null?s:"",u=l.URI,f=l.hexadecimalInteger("IV"),d=l.KEYFORMATVERSIONS,m=(a=l.KEYFORMAT)!=null?a:"identity";u&&l.IV&&!f&&zt.error(`Invalid IV: ${l.IV}`);const g=u?_n.resolve(u,e):"",y=(d||"1").split("/").map(Number).filter(Number.isFinite);return new Ia(c,g,m,y,f,l.KEYID)}function Xv(i){const t=new cs(i).decimalFloatingPoint("TIME-OFFSET");return We(t)?t:null}function Qv(i,e){let t=(i||"").split(/[ ,]+/).filter(s=>s);["video","audio","text"].forEach(s=>{const a=t.filter(l=>Tg(l,s));a.length&&(e[`${s}Codec`]=a.map(l=>l.split("/")[0]).join(","),t=t.filter(l=>a.indexOf(l)===-1))}),e.unknownCodecs=t}function Zv(i,e,t){const s=e[t];s&&(i[t]=s)}function Ok(i,e){let t=i[e];for(let s=e;s--;){const a=i[s];if(!a)return;a.programDateTime=t.programDateTime-a.duration*1e3,t=a}}function Dm(i,e,t){i.rawProgramDateTime?t.push(i):e!=null&&e.programDateTime&&(i.programDateTime=e.endProgramDateTime)}function Jv(i,e,t,s){i.relurl=e.URI,e.BYTERANGE&&i.setByteRange(e.BYTERANGE),i.level=t,i.sn="initSegment",s&&(i.levelkeys=s),i.initSegment=null}function e_(i,e,t){i.levelkeys=e;const{encryptedFragments:s}=t;(!s.length||s[s.length-1].levelkeys!==e)&&Object.keys(e).some(a=>e[a].isCommonEncryption)&&s.push(i)}function Hn(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function t_(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Hf(i,e){const t=e.startPTS;if(We(t)){let s=0,a;e.sn>i.sn?(s=t-i.start,a=i):(s=i.start-t,a=e),a.duration!==s&&a.setDuration(s)}else e.sn>i.sn?i.cc===e.cc&&i.minEndPTS?e.setStart(i.start+(i.minEndPTS-i.start)):e.setStart(i.start+i.duration):e.setStart(Math.max(i.start-e.duration,0))}function kS(i,e,t,s,a,l,c){s-t<=0&&(c.warn("Fragment should have a positive duration",e),s=t+e.duration,l=a+e.duration);let f=t,d=s;const m=e.startPTS,g=e.endPTS;if(We(m)){const R=Math.abs(m-t);i&&R>i.totalduration?c.warn(`media timestamps and playlist times differ by ${R}s for level ${e.level} ${i.url}`):We(e.deltaPTS)?e.deltaPTS=Math.max(R,e.deltaPTS):e.deltaPTS=R,f=Math.max(t,m),t=Math.min(t,m),a=e.startDTS!==void 0?Math.min(a,e.startDTS):a,d=Math.min(s,g),s=Math.max(s,g),l=e.endDTS!==void 0?Math.max(l,e.endDTS):l}const y=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(s-e.start),e.startPTS=t,e.maxStartPTS=f,e.startDTS=a,e.endPTS=s,e.minEndPTS=d,e.endDTS=l;const x=e.sn;if(!i||x<i.startSN||x>i.endSN)return 0;let v;const E=x-i.startSN,A=i.fragments;for(A[E]=e,v=E;v>0;v--)Hf(A[v],A[v-1]);for(v=E;v<A.length-1;v++)Hf(A[v],A[v+1]);return i.fragmentHint&&Hf(A[A.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,y}function Pk(i,e,t){if(i===e)return;let s=null;const a=i.fragments;for(let m=a.length-1;m>=0;m--){const g=a[m].initSegment;if(g){s=g;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;let l;Fk(i,e,(m,g,y,x)=>{if((!e.startCC||e.skippedSegments)&&g.cc!==m.cc){const v=m.cc-g.cc;for(let E=y;E<x.length;E++)x[E].cc+=v;e.endCC=x[x.length-1].cc}We(m.startPTS)&&We(m.endPTS)&&(g.setStart(g.startPTS=m.startPTS),g.startDTS=m.startDTS,g.maxStartPTS=m.maxStartPTS,g.endPTS=m.endPTS,g.endDTS=m.endDTS,g.minEndPTS=m.minEndPTS,g.setDuration(m.endPTS-m.startPTS),g.duration&&(l=g),e.PTSKnown=e.alignedSliding=!0),m.hasStreams&&(g.elementaryStreams=m.elementaryStreams),g.loader=m.loader,m.hasStats&&(g.stats=m.stats),m.initSegment&&(g.initSegment=m.initSegment,s=m.initSegment)});const c=e.fragments,u=e.fragmentHint?c.concat(e.fragmentHint):c;if(s&&u.forEach(m=>{var g;m&&(!m.initSegment||m.initSegment.relurl===((g=s)==null?void 0:g.relurl))&&(m.initSegment=s)}),e.skippedSegments){if(e.deltaUpdateFailed=c.some(m=>!m),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let m=e.skippedSegments;m--;)c.shift();e.startSN=c[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=Bk(i.dateRanges,e,t));const m=i.fragments.filter(g=>g.rawProgramDateTime);if(i.hasProgramDateTime&&!e.hasProgramDateTime)for(let g=1;g<u.length;g++)u[g].programDateTime===null&&Dm(u[g],u[g-1],m);IS(m,e)}e.endCC=c[c.length-1].cc}if(!e.startCC){var f;const m=OS(i,e.startSN-1);e.startCC=(f=m?.cc)!=null?f:c[0].cc}Uk(i.partList,e.partList,(m,g)=>{g.elementaryStreams=m.elementaryStreams,g.stats=m.stats}),l?kS(e,l,l.startPTS,l.endPTS,l.startDTS,l.endDTS,t):MS(i,e),c.length&&(e.totalduration=e.edge-c[0].start),e.driftStartTime=i.driftStartTime,e.driftStart=i.driftStart;const d=e.advancedDateTime;if(e.advanced&&d){const m=e.edge;e.driftStart||(e.driftStartTime=d,e.driftStart=m),e.driftEndTime=d,e.driftEnd=m}else e.driftEndTime=i.driftEndTime,e.driftEnd=i.driftEnd,e.advancedDateTime=i.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=i.requestScheduled)}function Bk(i,e,t){const{dateRanges:s,recentlyRemovedDateranges:a}=e,l=Xt({},i);a&&a.forEach(f=>{delete l[f]});const u=Object.keys(l).length;return u?(Object.keys(s).forEach(f=>{const d=l[f],m=new NS(s[f].attr,d);m.isValid?(l[f]=m,d||(m.tagOrder+=u)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Jt(s[f].attr)}"`)}),l):s}function Uk(i,e,t){if(i&&e){let s=0;for(let a=0,l=i.length;a<=l;a++){const c=i[a],u=e[a+s];c&&u&&c.index===u.index&&c.fragment.sn===u.fragment.sn?t(c,u):s--}}}function Fk(i,e,t){const s=e.skippedSegments,a=Math.max(i.startSN,e.startSN)-e.startSN,l=(i.fragmentHint?1:0)+(s?e.endSN:Math.min(i.endSN,e.endSN))-e.startSN,c=e.startSN-i.startSN,u=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,f=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments;for(let d=a;d<=l;d++){const m=f[c+d];let g=u[d];if(s&&!g&&m&&(g=e.fragments[d]=m),m&&g){t(m,g,d,u);const y=m.relurl,x=g.relurl;if(y&&Gk(y,x)){e.playlistParsingError=s_(`media sequence mismatch ${g.sn}:`,i,e,m,g);return}else if(m.cc!==g.cc){e.playlistParsingError=s_(`discontinuity sequence mismatch (${m.cc}!=${g.cc})`,i,e,m,g);return}}}}function s_(i,e,t,s,a){return new Error(`${i} ${a.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function MS(i,e,t=!0){const s=e.startSN+e.skippedSegments-i.startSN,a=i.fragments,l=s>=0;let c=0;if(l&&s<a.length)c=a[s].start;else if(l&&e.startSN===i.endSN+1)c=i.fragmentEnd;else if(l&&t)c=i.fragmentStart+s*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)c=i.fragmentStart;else return;Im(e,c)}function Im(i,e){if(e){const t=i.fragments;for(let s=i.skippedSegments;s<t.length;s++)t[s].addStart(e);i.fragmentHint&&i.fragmentHint.addStart(e)}}function jS(i,e=1/0){let t=1e3*i.targetduration;if(i.updated){const s=i.fragments;if(s.length&&t*4>e){const l=s[s.length-1].duration*1e3;l<t&&(t=l)}}else t/=2;return Math.round(t)}function OS(i,e,t){if(!i)return null;let s=i.fragments[e-i.startSN];return s||(s=i.fragmentHint,s&&s.sn===e)?s:e<i.startSN&&t&&t.sn===e?t:null}function i_(i,e,t){return i?PS(i.partList,e,t):null}function PS(i,e,t){if(i)for(let s=i.length;s--;){const a=i[s];if(a.index===t&&a.fragment.sn===e)return a}return null}function BS(i){i.forEach((e,t)=>{var s;(s=e.details)==null||s.fragments.forEach(a=>{a.level=t,a.initSegment&&(a.initSegment.level=t)})})}function Gk(i,e){return i!==e&&e?n_(i)!==n_(e):!1}function n_(i){return i.replace(/\?[^?]*$/,"")}function Ol(i,e){for(let s=0,a=i.length;s<a;s++){var t;if(((t=i[s])==null?void 0:t.cc)===e)return i[s]}return null}function $k(i,e){return!!(i&&e.startCC<i.endCC&&e.endCC>i.startCC)}function a_(i,e){const t=i.start+e;i.startPTS=t,i.setStart(t),i.endPTS=t+i.duration}function US(i,e){const t=e.fragments;for(let s=0,a=t.length;s<a;s++)a_(t[s],i);e.fragmentHint&&a_(e.fragmentHint,i),e.alignedSliding=!0}function Vk(i,e){i&&(FS(e,i),e.alignedSliding||od(e,i),!e.alignedSliding&&!e.skippedSegments&&MS(i,e,!1))}function FS(i,e){if(!$k(e,i))return;const t=Math.min(e.endCC,i.endCC),s=Ol(e.fragments,t),a=Ol(i.fragments,t);if(!s||!a)return;zt.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const l=s.start-a.start;US(l,i)}function od(i,e){if(!i.hasProgramDateTime||!e.hasProgramDateTime)return;const t=i.fragments,s=e.fragments;if(!t.length||!s.length)return;let a,l;const c=Math.min(e.endCC,i.endCC);e.startCC<c&&i.startCC<c&&(a=Ol(s,c),l=Ol(t,c)),(!a||!l)&&(a=s[Math.floor(s.length/2)],l=Ol(t,a.cc)||t[Math.floor(t.length/2)]);const u=a.programDateTime,f=l.programDateTime;if(!u||!f)return;const d=(f-u)/1e3-(l.start-a.start);US(d,i)}function si(i,e,t){di(i,e,t),i.addEventListener(e,t)}function di(i,e,t){i.removeEventListener(e,t)}const Hk={toString:function(i){let e="";const t=i.length;for(let s=0;s<t;s++)e+=`[${i.start(s).toFixed(3)}-${i.end(s).toFixed(3)}]`;return e}},je={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Dg extends AS{constructor(e,t,s,a,l){super(a,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=je.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:c,fragCurrent:u,media:f,mediaBuffer:d,state:m}=this,g=f?f.currentTime:0,y=pt.bufferInfo(d||f,g,c.maxBufferHole),x=!y.len;if(this.log(`Media seeking to ${We(g)?g.toFixed(3):g}, state: ${m}, ${x?"out of":"in"} buffer`),this.state===je.ENDED)this.resetLoadingState();else if(u){const v=c.maxFragLookUpTolerance,E=u.start-v,A=u.start+u.duration+v;if(x||A<y.start||E>y.end){const R=g>A;(g<E||R)&&(R&&u.loader&&(this.log(`Cancelling fragment load for seek (sn: ${u.sn})`),u.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(f){this.fragmentTracker.removeFragmentsInRange(g,1/0,this.playlistType,!0);const v=this.lastCurrentTime;if(g>v&&(this.lastCurrentTime=g),!this.loadingParts){const E=Math.max(y.end,g),A=this.shouldLoadParts(this.getLevelDetails(),E);A&&(this.log(`LL-Part loading ON after seeking to ${g.toFixed(2)} with buffer @${E.toFixed(2)}`),this.loadingParts=A)}}this.hls.hasEnoughToStart||(this.log(`Setting ${x?"startPosition":"nextLoadPosition"} to ${g} for seek without enough to start`),this.nextLoadPosition=g,x&&(this.startPosition=g)),x&&this.state===je.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=l,this.hls=e,this.fragmentLoader=new xk(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Ng(e.config)}registerListeners(){const{hls:e}=this;e.on(B.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(B.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(B.MANIFEST_LOADING,this.onManifestLoading,this),e.on(B.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(B.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(B.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(B.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(B.MANIFEST_LOADING,this.onManifestLoading,this),e.off(B.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(B.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===je.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=je.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,a=this.config.timelineOffset||0;if(s<=a)return!1;const l=e.buffered;this.config.maxBufferHole&&l&&l.length>1&&(e=pt.bufferedInfo(l,e.start,0));const c=e.nextStart;if(c&&c>a&&c<t.edge||this.media.currentTime<e.start)return!1;const f=t.partList;if(f!=null&&f.length){const m=f[f.length-1];return pt.isBuffered(this.media,m.start+m.duration/2)}const d=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(d)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;si(s,"seeking",this.onMediaSeeking),si(s,"ended",this.onMediaEnded);const a=this.config;this.levels&&a.autoStartLoad&&this.state===je.STOPPED&&this.startLoad(a.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,a=this.media;if(a!==null){if(a.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),di(a,"seeking",this.onMediaSeeking),di(a,"ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=je.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){const a=l=>{const c=l.frag;if(this.fragContextChanged(c)){this.warn(`${c.type} sn: ${c.sn}${l.part?" part: "+l.part.index:""} of ${this.fragInfo(c,!1,l.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(c);return}c.stats.chunkCount++,this._handleFragmentLoadProgress(l)};this._doFragLoad(e,t,s,a).then(l=>{if(!l)return;const c=this.state,u=l.frag;if(this.fragContextChanged(u)){(c===je.FRAG_LOADING||!this.fragCurrent&&c===je.PARSING)&&(this.fragmentTracker.removeFragment(u),this.state=je.IDLE);return}"payload"in l&&(this.log(`Loaded ${u.type} sn: ${u.sn} of ${this.playlistLabel()} ${u.level}`),this.hls.trigger(B.FRAG_LOADED,l)),this._handleFragmentLoadComplete(l)}).catch(l=>{this.state===je.STOPPED||this.state===je.ERROR||(this.warn(`Frag error: ${l?.message||l}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===Is.APPENDING){const l=e.type,c=this.getFwdBufferInfo(this.mediaBuffer,l),u=Math.max(e.duration,c?c.len:this.config.maxBufferLength),f=this.backtrackFragment;((f?e.sn-f.sn:0)===1||this.reduceMaxBufferLength(u,e.duration))&&s.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===Is.PARTIAL&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,s=null){if(!(e-t))return;const a={startOffset:e,endOffset:t,type:s};this.hls.trigger(B.BUFFER_FLUSHING,a)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(s=>{const a=s?.frag;if(!a||this.fragContextChanged(a)||!this.levels)throw new Error("init load aborted");return s}).then(s=>{const{hls:a}=this,{frag:l,payload:c}=s,u=l.decryptdata;if(c&&c.byteLength>0&&u!=null&&u.key&&u.iv&&bo(u.method)){const f=self.performance.now();return this.decrypter.decrypt(new Uint8Array(c),u.key.buffer,u.iv.buffer,Cg(u.method)).catch(d=>{throw a.trigger(B.ERROR,{type:et.MEDIA_ERROR,details:be.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:l}),d}).then(d=>{const m=self.performance.now();return a.trigger(B.FRAG_DECRYPTED,{frag:l,payload:d,stats:{tstart:f,tdecrypt:m}}),s.payload=d,this.completeInitSegmentLoad(s)})}return this.completeInitSegmentLoad(s)}).catch(s=>{this.state===je.STOPPED||this.state===je.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==je.STOPPED&&(this.state=je.IDLE),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var s,a;const l=e.tracks;if(l&&!t.encrypted&&((s=l.audio)!=null&&s.encrypted||(a=l.video)!=null&&a.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const c=this.media,u=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${c?"attached mediaKeys: "+c.mediaKeys:"detached"})`);return this.warn(u.message),!c||c.mediaKeys?!1:(this.hls.trigger(B.ERROR,{type:et.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_NO_KEYS,fatal:!1,error:u,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${s?Hk.toString(pt.getBuffered(s)):"(detached)"})`),_s(e)){var a;if(e.type!==Xe.SUBTITLE){const c=e.elementaryStreams;if(!Object.keys(c).some(u=>!!c[u])){this.state=je.IDLE;return}}const l=(a=this.levels)==null?void 0:a[e.level];l!=null&&l.fragmentError&&(this.log(`Resetting level fragment error count of ${l.fragmentError} on frag buffered`),l.fragmentError=0)}this.state=je.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:a,partsLoaded:l}=e,c=!l||l.length===0||l.some(f=>!f),u=new Rg(s.level,s.sn,s.stats.chunkCount+1,0,a?a.index:-1,!c);t.flush(u)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,s=null,a){var l;this.fragCurrent=e;const c=t.details;if(!this.levels||!c)throw new Error(`frag load aborted, missing level${c?"":" detail"}s`);let u=null;if(e.encrypted&&!((l=e.decryptdata)!=null&&l.key)){if(this.log(`Loading key for ${e.sn} of [${c.startSN}-${c.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=je.KEY_LOADING,this.fragCurrent=e,u=this.keyLoader.load(e).then(y=>{if(!this.fragContextChanged(y.frag))return this.hls.trigger(B.KEY_LOADED,y),this.state===je.KEY_LOADING&&(this.state=je.IDLE),y}),this.hls.trigger(B.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(u=this.keyLoader.loadClear(e,c.encryptedFragments,this.startFragRequested),u&&this.log("[eme] blocking frag load until media-keys acquired"));const f=this.fragPrevious;if(_s(e)&&(!f||e.sn!==f.sn)){const y=this.shouldLoadParts(t.details,e.end);y!==this.loadingParts&&(this.log(`LL-Part loading ${y?"ON":"OFF"} loading sn ${f?.sn}->${e.sn}`),this.loadingParts=y)}if(s=Math.max(e.start,s||0),this.loadingParts&&_s(e)){const y=c.partList;if(y&&a){s>c.fragmentEnd&&c.fragmentHint&&(e=c.fragmentHint);const x=this.getNextPart(y,e,s);if(x>-1){const v=y[x];e=this.fragCurrent=v.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${v.index} (${x}/${y.length-1}) of ${this.fragInfo(e,!1,v)}) cc: ${e.cc} [${c.startSN}-${c.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=v.start+v.duration,this.state=je.FRAG_LOADING;let E;return u?E=u.then(A=>!A||this.fragContextChanged(A.frag)?null:this.doFragPartsLoad(e,v,t,a)).catch(A=>this.handleFragLoadError(A)):E=this.doFragPartsLoad(e,v,t,a).catch(A=>this.handleFragLoadError(A)),this.hls.trigger(B.FRAG_LOADING,{frag:e,part:v,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):E}else if(!e.url||this.loadedEndOfParts(y,s))return Promise.resolve(null)}}if(_s(e)&&this.loadingParts){var d;this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(d=c.partList)==null?void 0:d.filter(y=>y.loaded).map(y=>`[${y.start}-${y.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+c.startSN+"-"+c.endSN+"]"}, target: ${parseFloat(s.toFixed(3))}`),We(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=je.FRAG_LOADING;const m=this.config.progressive&&e.type!==Xe.SUBTITLE;let g;return m&&u?g=u.then(y=>!y||this.fragContextChanged(y.frag)?null:this.fragmentLoader.load(e,a)).catch(y=>this.handleFragLoadError(y)):g=Promise.all([this.fragmentLoader.load(e,m?a:void 0),u]).then(([y])=>(!m&&a&&a(y),y)).catch(y=>this.handleFragLoadError(y)),this.hls.trigger(B.FRAG_LOADING,{frag:e,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):g}doFragPartsLoad(e,t,s,a){return new Promise((l,c)=>{var u;const f=[],d=(u=s.details)==null?void 0:u.partList,m=g=>{this.fragmentLoader.loadPart(e,g,a).then(y=>{f[g.index]=y;const x=y.part;this.hls.trigger(B.FRAG_LOADED,y);const v=i_(s.details,e.sn,g.index+1)||PS(d,e.sn,g.index+1);if(v)m(v);else return l({frag:e,part:x,partsLoaded:f})}).catch(c)};m(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===be.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===et.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(B.ERROR,t)}else this.hls.trigger(B.ERROR,{type:et.OTHER_ERROR,details:be.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==je.PARSING){!this.fragCurrent&&this.state!==je.STOPPED&&this.state!==je.ERROR&&(this.state=je.IDLE);return}const{frag:s,part:a,level:l}=t,c=self.performance.now();s.stats.parsing.end=c,a&&(a.stats.parsing.end=c);const u=this.getLevelDetails(),d=u&&s.sn>u.endSN||this.shouldLoadParts(u,s.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=d),this.updateLevelTiming(s,a,l,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var s;const l=e.partList[0];if(l.fragment.type===Xe.SUBTITLE)return!1;const c=l.end+(((s=e.fragmentHint)==null?void 0:s.duration)||0);if(t>=c){var a;if((this.hls.hasEnoughToStart?((a=this.media)==null?void 0:a.currentTime)||this.lastCurrentTime:this.getLoadPosition())>l.start-l.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:a,sn:l,part:c}=e;if(!(t!=null&&t[a]))return this.warn(`Levels object was unset while buffering fragment ${l} of ${this.playlistLabel()} ${a}. The current chunk will not be buffered.`),null;const u=t[a],f=u.details,d=c>-1?i_(f,l,c):null,m=d?d.fragment:OS(f,l,s);return m?(s&&s!==m&&(m.stats=s.stats),{frag:m,part:d,level:u}):null}bufferFragmentData(e,t,s,a,l){if(this.state!==je.PARSING)return;const{data1:c,data2:u}=e;let f=c;if(u&&(f=qi(c,u)),!f.length)return;const d=this.initPTS[t.cc],m=d?-d.baseTime/d.timescale:void 0,g={type:e.type,frag:t,part:s,chunkMeta:a,offset:m,parent:t.type,data:f};if(this.hls.trigger(B.BUFFER_APPENDING,g),e.dropped&&e.independent&&!s){if(l)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!pt.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const s=t.currentTime,a=pt.bufferInfo(t,s,0),l=e.duration,c=Math.min(this.config.maxFragLookUpTolerance*2,l*.25),u=Math.max(Math.min(e.start-c,a.end-c),s+c);e.start-u>c&&this.flushMainBuffer(u,e.start)}getFwdBufferInfo(e,t){var s;const a=this.getLoadPosition();if(!We(a))return null;const c=this.lastCurrentTime>a||(s=this.media)!=null&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,a,t,c)}getFwdBufferInfoAtPos(e,t,s,a){const l=pt.bufferInfo(e,t,a);if(l.len===0&&l.nextStart!==void 0){const c=this.fragmentTracker.getBufferedFrag(t,s);if(c&&(l.nextStart<=c.end||c.gap)){const u=Math.max(Math.min(l.nextStart,c.end)-t,a);return pt.bufferInfo(e,t,u)}}return l}getMaxBufferLength(e){const{config:t}=this;let s;return e?s=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):s=t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,a=Math.max(Math.min(e-t,s.maxBufferLength),t),l=Math.max(e-t*3,s.maxMaxBufferLength/2,a);return l>=a?(s.maxMaxBufferLength=l,this.warn(`Reduce max buffer length to ${l}s`),!0):!1}getAppendedFrag(e,t=Xe.MAIN){const s=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return s&&"fragment"in s?s.fragment:s}getNextFragment(e,t){const s=t.fragments,a=s.length;if(!a)return null;const{config:l}=this,c=s[0].start,u=l.lowLatencyMode&&!!t.partList;let f=null;if(t.live){const g=l.initialLiveManifestSize;if(a<g)return this.warn(`Not enough fragments to start playback (have: ${a}, need: ${g})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<c){var d;u&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),f=this.getInitialLiveFragment(t);const y=this.hls.startPosition,x=this.hls.liveSyncPosition,v=f?(y!==-1&&y>=c?y:x)||f.start:e;this.log(`Setting startPosition to ${v} to match start frag at live edge. mainStart: ${y} liveSyncPosition: ${x} frag.start: ${(d=f)==null?void 0:d.start}`),this.startPosition=this.nextLoadPosition=v}}else e<=c&&(f=s[0]);if(!f){const g=this.loadingParts?t.partEnd:t.fragmentEnd;f=this.getFragmentAtPosition(e,g,t)}let m=this.filterReplacedPrimary(f,t);if(!m&&f){const g=f.sn-t.startSN;m=this.filterReplacedPrimary(s[g+1]||null,t)}return this.mapToInitFragWhenRequired(m)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===Is.OK||s===Is.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,a,l){let c=null;if(e.gap&&(c=this.getNextFragment(this.nextLoadPosition,t),c&&!c.gap&&s.nextStart)){const u=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,a,0);if(u!==null&&s.len+u.len>=l){const f=c.sn;return this.loopSn!==f&&(this.log(`buffer full after gaps in "${a}" playlist starting at sn: ${f}`),this.loopSn=f),null}}return this.loopSn=void 0,c}get primaryPrefetch(){if(r_(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(r_(this.config)&&e.type!==Xe.SUBTITLE){const s=this.hls.interstitialsManager,a=s?.bufferingItem;if(a){const c=a.event;if(c){if(c.appendInPlace||Math.abs(e.start-a.start)>1||a.start===0)return null}else if(e.end<=a.start&&t?.live===!1||e.start>a.end&&a.nextEvent&&(a.nextEvent.appendInPlace||e.start-a.end>1))return null}const l=s?.playerQueue;if(l)for(let c=l.length;c--;){const u=l[c].interstitial;if(u.appendInPlace&&e.start>=u.startTime&&e.end<=u.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,s){let a=-1,l=!1,c=!0;for(let u=0,f=e.length;u<f;u++){const d=e[u];if(c=c&&!d.independent,a>-1&&s<d.start)break;const m=d.loaded;m?a=-1:(l||(d.independent||c)&&d.fragment===t)&&(d.fragment!==t&&this.warn(`Need buffer at ${s} but next unloaded part starts at ${d.start}`),a=u),l=m}return a}loadedEndOfParts(e,t){let s;for(let a=e.length;a--;){if(s=e[a],!s.loaded)return!1;if(t>s.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,s=this.fragPrevious;let a=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),a=rk(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!a){const l=s.sn+1;if(l>=e.startSN&&l<=e.endSN){const c=t[l-e.startSN];s.cc===c.cc&&(a=c,this.log(`Live playlist, switching playlist, load frag with next SN: ${a.sn}`))}a||(a=SS(e,s.cc,s.end),a&&this.log(`Live playlist, switching playlist, load frag with same CC: ${a.sn}`))}}else{const l=this.hls.liveSyncPosition;l!==null&&(a=this.getFragmentAtPosition(l,this.bitrateTest?e.fragmentEnd:e.edge,e))}return a}getFragmentAtPosition(e,t,s){const{config:a}=this;let{fragPrevious:l}=this,{fragments:c,endSN:u}=s;const{fragmentHint:f}=s,{maxFragLookUpTolerance:d}=a,m=s.partList,g=!!(this.loadingParts&&m!=null&&m.length&&f);g&&!this.bitrateTest&&m[m.length-1].fragment.sn===f.sn&&(c=c.concat(f),u=f.sn);let y;if(e<t){var x;const E=e<this.lastCurrentTime||e>t-d||(x=this.media)!=null&&x.paused||!this.startFragRequested?0:d;y=Sr(l,c,e,E)}else y=c[c.length-1];if(y){const v=y.sn-s.startSN,E=this.fragmentTracker.getState(y);if((E===Is.OK||E===Is.PARTIAL&&y.gap)&&(l=y),l&&y.sn===l.sn&&(!g||m[0].fragment.sn>y.sn||!s.live)&&y.level===l.level){const R=c[v+1];y.sn<u&&this.fragmentTracker.getState(R)!==Is.OK?y=R:y=null}}return y}alignPlaylists(e,t,s){const a=e.fragments.length;if(!a)return this.warn("No fragments in live playlist"),0;const l=e.fragmentStart,c=!t,u=e.alignedSliding&&We(l);if(c||!u&&!l){Vk(s,e);const f=e.fragmentStart;return this.log(`Live playlist sliding: ${f.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${a}`),f}return l}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const a=this.timelineOffset;if(s===-1){const l=this.startTimeOffset!==null,c=l?this.startTimeOffset:e.startTimeOffset;c!==null&&We(c)?(s=t+c,c<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${c} found in ${l?"multivariant":"media"} playlist`),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+a}this.nextLoadPosition=s+a}getLoadPosition(){var e;const{media:t}=this;let s=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&_s(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==je.FRAG_LOADING_WAITING_RETRY)&&(this.state=je.IDLE)}onFragmentOrKeyLoadError(e,t){var s;if(t.chunkMeta&&!t.frag){const R=this.getCurrentContext(t.chunkMeta);R&&(t.frag=R.frag)}const a=t.frag;if(!a||a.type!==e||!this.levels)return;if(this.fragContextChanged(a)){var l;this.warn(`Frag load error must match current frag to retry ${a.url} > ${(l=this.fragCurrent)==null?void 0:l.url}`);return}const c=t.details===be.FRAG_GAP;c&&this.fragmentTracker.fragBuffered(a,!0);const u=t.errorAction;if(!u){this.state=je.ERROR;return}const{action:f,flags:d,retryCount:m=0,retryConfig:g}=u,y=!!g,x=y&&f===Vs.RetryRequest,v=y&&!u.resolved&&d===Ai.MoveAllAlternatesMatchingHost,E=(s=this.hls.latestLevelDetails)==null?void 0:s.live;if(!x&&v&&_s(a)&&!a.endList&&E&&!TS(t))this.resetFragmentErrors(e),this.treatAsGap(a),u.resolved=!0;else if((x||v)&&m<g.maxNumRetry){var A;const R=Rm((A=t.response)==null?void 0:A.code),D=wg(g,m);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+D,this.state=je.FRAG_LOADING_WAITING_RETRY,u.resolved=!0,R){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${a.sn} of ${e} ${a.level} errored with ${t.details}, retrying loading ${m+1}/${g.maxNumRetry} in ${D}ms`)}else if(g)if(this.resetFragmentErrors(e),m<g.maxNumRetry)!c&&f!==Vs.RemoveAlternatePermanently&&(u.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${m})`);return}else f===Vs.SendAlternateToPenaltyBox?this.state=je.WAITING_LEVEL:this.state=je.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,s=t===1/0;(!t||e>=t||s&&!Rm(0))&&(s&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=je.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===je.PARSING||this.state===je.PARSED){const t=e.frag,s=e.parent,a=this.getFwdBufferInfo(this.mediaBuffer,s),l=a&&a.len>.5;l&&this.reduceMaxBufferLength(a.len,t?.duration||10);const c=!l;return c&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),c}return!1}resetFragmentErrors(e){e===Xe.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==je.STOPPED&&(this.state=je.IDLE)}afterBufferFlushed(e,t,s){if(!e)return;const a=pt.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,a,s),this.state===je.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==je.STOPPED&&(this.state=je.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,a){const l=s.details;if(!l){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((f,d)=>{const m=e.elementaryStreams[d];if(m){const g=m.endPTS-m.startPTS;if(g<=0)return this.warn(`Could not parse fragment ${e.sn} ${d} duration reliably (${g})`),f||!1;const y=a?0:kS(l,e,m.startPTS,m.endPTS,m.startDTS,m.endDTS,this);return this.hls.trigger(B.LEVEL_PTS_UPDATED,{details:l,level:s,drift:y,type:d,frag:e,start:m.startPTS,end:m.endPTS}),!0}return f},!1)){var u;const f=((u=this.transmuxer)==null?void 0:u.error)===null;if((s.fragmentError===0||f&&(s.fragmentError<2||e.endList))&&this.treatAsGap(e,s),f){const d=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(d.message),this.hls.trigger(B.ERROR,{type:et.MEDIA_ERROR,details:be.FRAG_PARSING_ERROR,fatal:!1,error:d,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=je.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(B.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Xe.MAIN?"level":"track"}fragInfo(e,t=!0,s){var a,l;return`${this.playlistLabel()} ${e.level} (${s?"part":"frag"}:[${((a=t&&!s?e.startPTS:(s||e).start)!=null?a:NaN).toFixed(3)}-${((l=t&&!s?e.endPTS:(s||e).end)!=null?l:NaN).toFixed(3)}]${s&&e.type==="main"?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function r_(i){return!!i.interstitialsController&&i.enableInterstitialPlayback!==!1}class GS{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;if(e.length)e.length===1?s=e[0]:s=Kk(e,t);else return new Uint8Array(0);return this.reset(),s}reset(){this.chunks.length=0,this.dataLength=0}}function Kk(i,e){const t=new Uint8Array(e);let s=0;for(let a=0;a<i.length;a++){const l=i[a];t.set(l,s),s+=l.length}return t}var Kf={exports:{}},o_;function zk(){return o_||(o_=1,(function(i){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function a(f,d,m){this.fn=f,this.context=d,this.once=m||!1}function l(f,d,m,g,y){if(typeof m!="function")throw new TypeError("The listener must be a function");var x=new a(m,g||f,y),v=t?t+d:d;return f._events[v]?f._events[v].fn?f._events[v]=[f._events[v],x]:f._events[v].push(x):(f._events[v]=x,f._eventsCount++),f}function c(f,d){--f._eventsCount===0?f._events=new s:delete f._events[d]}function u(){this._events=new s,this._eventsCount=0}u.prototype.eventNames=function(){var d=[],m,g;if(this._eventsCount===0)return d;for(g in m=this._events)e.call(m,g)&&d.push(t?g.slice(1):g);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(m)):d},u.prototype.listeners=function(d){var m=t?t+d:d,g=this._events[m];if(!g)return[];if(g.fn)return[g.fn];for(var y=0,x=g.length,v=new Array(x);y<x;y++)v[y]=g[y].fn;return v},u.prototype.listenerCount=function(d){var m=t?t+d:d,g=this._events[m];return g?g.fn?1:g.length:0},u.prototype.emit=function(d,m,g,y,x,v){var E=t?t+d:d;if(!this._events[E])return!1;var A=this._events[E],R=arguments.length,D,L;if(A.fn){switch(A.once&&this.removeListener(d,A.fn,void 0,!0),R){case 1:return A.fn.call(A.context),!0;case 2:return A.fn.call(A.context,m),!0;case 3:return A.fn.call(A.context,m,g),!0;case 4:return A.fn.call(A.context,m,g,y),!0;case 5:return A.fn.call(A.context,m,g,y,x),!0;case 6:return A.fn.call(A.context,m,g,y,x,v),!0}for(L=1,D=new Array(R-1);L<R;L++)D[L-1]=arguments[L];A.fn.apply(A.context,D)}else{var O=A.length,H;for(L=0;L<O;L++)switch(A[L].once&&this.removeListener(d,A[L].fn,void 0,!0),R){case 1:A[L].fn.call(A[L].context);break;case 2:A[L].fn.call(A[L].context,m);break;case 3:A[L].fn.call(A[L].context,m,g);break;case 4:A[L].fn.call(A[L].context,m,g,y);break;default:if(!D)for(H=1,D=new Array(R-1);H<R;H++)D[H-1]=arguments[H];A[L].fn.apply(A[L].context,D)}}return!0},u.prototype.on=function(d,m,g){return l(this,d,m,g,!1)},u.prototype.once=function(d,m,g){return l(this,d,m,g,!0)},u.prototype.removeListener=function(d,m,g,y){var x=t?t+d:d;if(!this._events[x])return this;if(!m)return c(this,x),this;var v=this._events[x];if(v.fn)v.fn===m&&(!y||v.once)&&(!g||v.context===g)&&c(this,x);else{for(var E=0,A=[],R=v.length;E<R;E++)(v[E].fn!==m||y&&!v[E].once||g&&v[E].context!==g)&&A.push(v[E]);A.length?this._events[x]=A.length===1?A[0]:A:c(this,x)}return this},u.prototype.removeAllListeners=function(d){var m;return d?(m=t?t+d:d,this._events[m]&&c(this,m)):(this._events=new s,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=t,u.EventEmitter=u,i.exports=u})(Kf)),Kf.exports}var qk=zk(),Ig=xI(qk);const Hl="1.6.15",Ro={};function Yk(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Wk(){const i=Ro[Hl];if(i)return i.clientCount++,i;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),a={worker:new self.Worker(t),objectURL:t,clientCount:1};return Ro[Hl]=a,a}function Xk(i){const e=Ro[i];if(e)return e.clientCount++,e;const t=new self.URL(i,self.location.href).href,a={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Ro[i]=a,a}function Qk(i){const e=Ro[i||Hl];if(e&&e.clientCount--===1){const{worker:s,objectURL:a}=e;delete Ro[i||Hl],a&&self.URL.revokeObjectURL(a),s.terminate()}}function $S(i,e){return e+10<=i.length&&i[e]===51&&i[e+1]===68&&i[e+2]===73&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function kg(i,e){return e+10<=i.length&&i[e]===73&&i[e+1]===68&&i[e+2]===51&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function bd(i,e){let t=0;return t=(i[e]&127)<<21,t|=(i[e+1]&127)<<14,t|=(i[e+2]&127)<<7,t|=i[e+3]&127,t}function Kl(i,e){const t=e;let s=0;for(;kg(i,e);){s+=10;const a=bd(i,e+6);s+=a,$S(i,e+10)&&(s+=10),e+=s}if(s>0)return i.subarray(t,t+s)}function Zk(i,e,t,s){const a=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],l=e[t+2],c=l>>2&15;if(c>12){const x=new Error(`invalid ADTS sampling index:${c}`);i.emit(B.ERROR,B.ERROR,{type:et.MEDIA_ERROR,details:be.FRAG_PARSING_ERROR,fatal:!0,error:x,reason:x.message});return}const u=(l>>6&3)+1,f=e[t+3]>>6&3|(l&1)<<2,d="mp4a.40."+u,m=a[c];let g=c;(u===5||u===29)&&(g-=3);const y=[u<<3|(g&14)>>1,(g&1)<<7|f<<3];return zt.log(`manifest codec:${s}, parsed codec:${d}, channels:${f}, rate:${m} (ADTS object type:${u} sampling index:${c})`),{config:y,samplerate:m,channelCount:f,codec:d,parsedCodec:d,manifestCodec:s}}function VS(i,e){return i[e]===255&&(i[e+1]&246)===240}function HS(i,e){return i[e+1]&1?7:9}function Mg(i,e){return(i[e+3]&3)<<11|i[e+4]<<3|(i[e+5]&224)>>>5}function Jk(i,e){return e+5<i.length}function ld(i,e){return e+1<i.length&&VS(i,e)}function eM(i,e){return Jk(i,e)&&VS(i,e)&&Mg(i,e)<=i.length-e}function tM(i,e){if(ld(i,e)){const t=HS(i,e);if(e+t>=i.length)return!1;const s=Mg(i,e);if(s<=t)return!1;const a=e+s;return a===i.length||ld(i,a)}return!1}function KS(i,e,t,s,a){if(!i.samplerate){const l=Zk(e,t,s,a);if(!l)return;Xt(i,l)}}function zS(i){return 1024*9e4/i}function sM(i,e){const t=HS(i,e);if(e+t<=i.length){const s=Mg(i,e)-t;if(s>0)return{headerLength:t,frameLength:s}}}function qS(i,e,t,s,a){const l=zS(i.samplerate),c=s+a*l,u=sM(e,t);let f;if(u){const{frameLength:g,headerLength:y}=u,x=y+g,v=Math.max(0,t+x-e.length);v?(f=new Uint8Array(x-y),f.set(e.subarray(t+y,e.length),0)):f=e.subarray(t+y,t+x);const E={unit:f,pts:c};return v||i.samples.push(E),{sample:E,length:x,missing:v}}const d=e.length-t;return f=new Uint8Array(d),f.set(e.subarray(t,e.length),0),{sample:{unit:f,pts:c},length:d,missing:-1}}function iM(i,e){return kg(i,e)&&bd(i,e+6)+10<=i.length-e}function nM(i){return i instanceof ArrayBuffer?i:i.byteOffset==0&&i.byteLength==i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer}function zf(i,e=0,t=1/0){return aM(i,e,t,Uint8Array)}function aM(i,e,t,s){const a=rM(i);let l=1;"BYTES_PER_ELEMENT"in s&&(l=s.BYTES_PER_ELEMENT);const c=oM(i)?i.byteOffset:0,u=(c+i.byteLength)/l,f=(c+e)/l,d=Math.floor(Math.max(0,Math.min(f,u))),m=Math.floor(Math.min(d+Math.max(t,0),u));return new s(a,d,m-d)}function rM(i){return i instanceof ArrayBuffer?i:i.buffer}function oM(i){return i&&i.buffer instanceof ArrayBuffer&&i.byteLength!==void 0&&i.byteOffset!==void 0}function lM(i){const e={key:i.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(i.size<2)return;if(i.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const s=i.data.subarray(1).indexOf(0);if(s===-1)return;const a=Ci(zf(i.data,1,s)),l=i.data[2+s],c=i.data.subarray(3+s).indexOf(0);if(c===-1)return;const u=Ci(zf(i.data,3+s,c));let f;return a==="-->"?f=Ci(zf(i.data,4+s+c)):f=nM(i.data.subarray(4+s+c)),e.mimeType=a,e.pictureType=l,e.description=u,e.data=f,e}function cM(i){if(i.size<2)return;const e=Ci(i.data,!0),t=new Uint8Array(i.data.subarray(e.length+1));return{key:i.type,info:e,data:t.buffer}}function uM(i){if(i.size<2)return;if(i.type==="TXXX"){let t=1;const s=Ci(i.data.subarray(t),!0);t+=s.length+1;const a=Ci(i.data.subarray(t));return{key:i.type,info:s,data:a}}const e=Ci(i.data.subarray(1));return{key:i.type,info:"",data:e}}function dM(i){if(i.type==="WXXX"){if(i.size<2)return;let t=1;const s=Ci(i.data.subarray(t),!0);t+=s.length+1;const a=Ci(i.data.subarray(t));return{key:i.type,info:s,data:a}}const e=Ci(i.data);return{key:i.type,info:"",data:e}}function hM(i){return i.type==="PRIV"?cM(i):i.type[0]==="W"?dM(i):i.type==="APIC"?lM(i):uM(i)}function fM(i){const e=String.fromCharCode(i[0],i[1],i[2],i[3]),t=bd(i,4),s=10;return{type:e,size:t,data:i.subarray(s,s+t)}}const bu=10,mM=10;function YS(i){let e=0;const t=[];for(;kg(i,e);){const s=bd(i,e+6);i[e+5]>>6&1&&(e+=bu),e+=bu;const a=e+s;for(;e+mM<a;){const l=fM(i.subarray(e)),c=hM(l);c&&t.push(c),e+=l.size+bu}$S(i,e)&&(e+=bu)}return t}function WS(i){return i&&i.key==="PRIV"&&i.info==="com.apple.streaming.transportStreamTimestamp"}function gM(i){if(i.data.byteLength===8){const e=new Uint8Array(i.data),t=e[3]&1;let s=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return s/=45,t&&(s+=4772185884e-2),Math.round(s)}}function jg(i){const e=YS(i);for(let t=0;t<e.length;t++){const s=e[t];if(WS(s))return gM(s)}}let Ni=(function(i){return i.audioId3="org.id3",i.dateRange="com.apple.quicktime.HLS",i.emsg="https://aomedia.org/emsg/ID3",i.misbklv="urn:misb:KLV:bin:1910.1",i})({});function xn(i="",e=9e4){return{type:i,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Og{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,a){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=qi(this.cachedData,e),this.cachedData=null);let s=Kl(e,0),a=s?s.length:0,l;const c=this._audioTrack,u=this._id3Track,f=s?jg(s):void 0,d=e.length;for((this.basePTS===null||this.frameIndex===0&&We(f))&&(this.basePTS=pM(f,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),s&&s.length>0&&u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:Ni.audioId3,duration:Number.POSITIVE_INFINITY});a<d;){if(this.canParse(e,a)){const m=this.appendFrame(c,e,a);m?(this.frameIndex++,this.lastPTS=m.sample.pts,a+=m.length,l=a):a=d}else iM(e,a)?(s=Kl(e,a),u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:Ni.audioId3,duration:Number.POSITIVE_INFINITY}),a+=s.length,l=a):a++;if(a===d&&l!==d){const m=e.slice(l);this.cachedData?this.cachedData=qi(this.cachedData,m):this.cachedData=m}}return{audioTrack:c,videoTrack:xn(),id3Track:u,textTrack:xn()}}demuxSampleAes(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:xn(),id3Track:this._id3Track,textTrack:xn()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const pM=(i,e,t)=>{if(We(i))return i*90;const s=t?t.baseTime*9e4/t.timescale:0;return e*9e4+s};let Su=null;const yM=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],xM=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],vM=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],_M=[0,1,1,4];function XS(i,e,t,s,a){if(t+24>e.length)return;const l=QS(e,t);if(l&&t+l.frameLength<=e.length){const c=l.samplesPerFrame*9e4/l.sampleRate,u=s+a*c,f={unit:e.subarray(t,t+l.frameLength),pts:u,dts:u};return i.config=[],i.channelCount=l.channelCount,i.samplerate=l.sampleRate,i.samples.push(f),{sample:f,length:l.frameLength,missing:0}}}function QS(i,e){const t=i[e+1]>>3&3,s=i[e+1]>>1&3,a=i[e+2]>>4&15,l=i[e+2]>>2&3;if(t!==1&&a!==0&&a!==15&&l!==3){const c=i[e+2]>>1&1,u=i[e+3]>>6,f=t===3?3-s:s===3?3:4,d=yM[f*14+a-1]*1e3,g=xM[(t===3?0:t===2?1:2)*3+l],y=u===3?1:2,x=vM[t][s],v=_M[s],E=x*8*v,A=Math.floor(x*d/g+c)*v;if(Su===null){const L=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Su=L?parseInt(L[1]):0}return!!Su&&Su<=87&&s===2&&d>=224e3&&u===0&&(i[e+3]=i[e+3]|128),{sampleRate:g,channelCount:y,frameLength:A,samplesPerFrame:E}}}function Pg(i,e){return i[e]===255&&(i[e+1]&224)===224&&(i[e+1]&6)!==0}function ZS(i,e){return e+1<i.length&&Pg(i,e)}function bM(i,e){return Pg(i,e)&&4<=i.length-e}function JS(i,e){if(e+1<i.length&&Pg(i,e)){const s=QS(i,e);let a=4;s!=null&&s.frameLength&&(a=s.frameLength);const l=e+a;return l===i.length||ZS(i,l)}return!1}class SM extends Og{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,a){super.resetInitSegment(e,t,s,a),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:a,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=Kl(e,0);let a=s?.length||0;if(JS(e,a))return!1;for(let l=e.length;a<l;a++)if(tM(e,a))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return eM(e,t)}appendFrame(e,t,s){KS(e,this.observer,t,s,e.manifestCodec);const a=qS(e,t,s,this.basePTS,this.frameIndex);if(a&&a.missing===0)return a}}const eE=(i,e)=>{let t=0,s=5;e+=s;const a=new Uint32Array(1),l=new Uint32Array(1),c=new Uint8Array(1);for(;s>0;){c[0]=i[e];const u=Math.min(s,8),f=8-u;l[0]=4278190080>>>24+f<<f,a[0]=(c[0]&l[0])>>f,t=t?t<<u|a[0]:a[0],e+=1,s-=u}return t};class EM extends Og{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,a){super.resetInitSegment(e,t,s,a),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:a,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const a=tE(e,t,s,this.basePTS,this.frameIndex);if(a!==-1)return{sample:e.samples[e.samples.length-1],length:a,missing:0}}static probe(e){if(!e)return!1;const t=Kl(e,0);if(!t)return!1;const s=t.length;return e[s]===11&&e[s+1]===119&&jg(t)!==void 0&&eE(e,s)<16}}function tE(i,e,t,s,a){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const l=e[t+4]>>6;if(l>=3)return-1;const u=[48e3,44100,32e3][l],f=e[t+4]&63,m=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][f*3+l]*2;if(t+m>e.length)return-1;const g=e[t+6]>>5;let y=0;g===2?y+=2:(g&1&&g!==1&&(y+=2),g&4&&(y+=2));const x=(e[t+6]<<8|e[t+7])>>12-y&1,E=[2,1,2,3,3,4,4,5][g]+x,A=e[t+5]>>3,R=e[t+5]&7,D=new Uint8Array([l<<6|A<<1|R>>2,(R&3)<<6|g<<3|x<<2|f>>4,f<<4&224]),L=1536/u*9e4,O=s+a*L,H=e.subarray(t,t+m);return i.config=D,i.channelCount=E,i.samplerate=u,i.samples.push({unit:H,pts:O}),m}class TM extends Og{resetInitSegment(e,t,s,a){super.resetInitSegment(e,t,s,a),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:a,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Kl(e,0);let s=t?.length||0;if(t&&e[s]===11&&e[s+1]===119&&jg(t)!==void 0&&eE(e,s)<=16)return!1;for(let a=e.length;s<a;s++)if(JS(e,s))return zt.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return bM(e,t)}appendFrame(e,t,s){if(this.basePTS!==null)return XS(e,t,s,this.basePTS,this.frameIndex)}}const AM=/\/emsg[-/]ID3/i;class wM{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,a){const l=this.videoTrack=xn("video",1),c=this.audioTrack=xn("audio",1),u=this.txtTrack=xn("text",1);if(this.id3Track=xn("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const f=dS(e);if(f.video){const{id:d,timescale:m,codec:g,supplemental:y}=f.video;l.id=d,l.timescale=u.timescale=m,l.codec=g,l.supplemental=y}if(f.audio){const{id:d,timescale:m,codec:g}=f.audio;c.id=d,c.timescale=m,c.codec=g}u.id=lS.text,l.sampleDuration=0,l.duration=c.duration=a}resetContiguity(){this.remainderData=null}static probe(e){return EI(e)}demux(e,t){this.timeOffset=t;let s=e;const a=this.videoTrack,l=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=qi(this.remainderData,e));const u=LI(s);this.remainderData=u.remainder,a.samples=u.valid||new Uint8Array}else a.samples=s;const c=this.extractID3Track(a,t);return l.samples=Av(t,a),{videoTrack:a,audioTrack:this.audioTrack,id3Track:c,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const a=this.extractID3Track(t,this.timeOffset);return s.samples=Av(e,t),{videoTrack:t,audioTrack:xn(),id3Track:a,textTrack:xn()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const a=Tt(e.samples,["emsg"]);a&&a.forEach(l=>{const c=II(l);if(AM.test(c.schemeIdUri)){const u=l_(c,t);let f=c.eventDuration===4294967295?Number.POSITIVE_INFINITY:c.eventDuration/c.timeScale;f<=.001&&(f=Number.POSITIVE_INFINITY);const d=c.payload;s.samples.push({data:d,len:d.byteLength,dts:u,pts:u,type:Ni.emsg,duration:f})}else if(this.config.enableEmsgKLVMetadata&&c.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const u=l_(c,t);s.samples.push({data:c.payload,len:c.payload.byteLength,dts:u,pts:u,type:Ni.misbklv,duration:Number.POSITIVE_INFINITY})}})}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function l_(i,e){return We(i.presentationTime)?i.presentationTime/i.timeScale:e+i.presentationTimeDelta/i.timeScale}class NM{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new Ng(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,ja.cbc)}decryptAacSample(e,t,s){const a=e[t].unit;if(a.length<=16)return;const l=a.subarray(16,a.length-a.length%16),c=l.buffer.slice(l.byteOffset,l.byteOffset+l.length);this.decryptBuffer(c).then(u=>{const f=new Uint8Array(u);a.set(f,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)}).catch(s)}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length){s();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,s=new Int8Array(t);let a=0;for(let l=32;l<e.length-16;l+=160,a+=16)s.set(e.subarray(l,l+16),a);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let a=0;for(let l=32;l<e.length-16;l+=160,a+=16)e.set(s.subarray(a,a+16),l);return e}decryptAvcSample(e,t,s,a,l){const c=mS(l.data),u=this.getAvcEncryptedData(c);this.decryptBuffer(u.buffer).then(f=>{l.data=this.getAvcDecryptedUnit(c,f),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,a)}).catch(a)}decryptAvcSamples(e,t,s,a){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length){a();return}const l=e[t].units;for(;!(s>=l.length);s++){const c=l[s];if(!(c.data.length<=48||c.type!==1&&c.type!==5)&&(this.decryptAvcSample(e,t,s,a,c),!this.decrypter.isSync()))return}}}}class sE{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s=this.VideoSample,a;if((!s||s.units.length===0)&&(s=e[e.length-1]),(t=s)!=null&&t.units){const l=s.units;a=l[l.length-1]}return a}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const s=t.samples,a=s.length;if(a){const l=s[a-1];e.pts=l.pts,e.dts=l.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,s){const a=t.byteLength;let l=e.naluState||0;const c=l,u=[];let f=0,d,m,g,y=-1,x=0;for(l===-1&&(y=0,x=this.getNALuType(t,0),l=0,f=1);f<a;){if(d=t[f++],!l){l=d?0:1;continue}if(l===1){l=d?0:2;continue}if(!d)l=3;else if(d===1){if(m=f-l-1,y>=0){const v={data:t.subarray(y,m),type:x};u.push(v)}else{const v=this.getLastNalUnit(e.samples);v&&(c&&f<=4-c&&v.state&&(v.data=v.data.subarray(0,v.data.byteLength-c)),m>0&&(v.data=qi(v.data,t.subarray(0,m)),v.state=0))}f<a?(g=this.getNALuType(t,f),y=f,x=g,l=0):l=-1}else l=0}if(y>=0&&l>=0){const v={data:t.subarray(y,a),type:x,state:l};u.push(v)}if(u.length===0){const v=this.getLastNalUnit(e.samples);v&&(v.data=qi(v.data,t))}return e.naluState=l,u}}class Pl{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,a=new Uint8Array(4),l=Math.min(4,t);if(l===0)throw new Error("no bytes available");a.set(e.subarray(s,s+l)),this.word=new DataView(a.buffer).getUint32(0),this.bitsAvailable=l*8,this.bytesAvailable-=l}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&zt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class RM extends sE{parsePES(e,t,s,a){const l=this.parseNALu(e,s.data,a);let c=this.VideoSample,u,f=!1;s.data=null,c&&l.length&&!e.audFound&&(this.pushAccessUnit(c,e),c=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),l.forEach(d=>{var m,g;switch(d.type){case 1:{let E=!1;u=!0;const A=d.data;if(f&&A.length>4){const R=this.readSliceType(A);(R===2||R===4||R===7||R===9)&&(E=!0)}if(E){var y;(y=c)!=null&&y.frame&&!c.key&&(this.pushAccessUnit(c,e),c=this.VideoSample=null)}c||(c=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),c.frame=!0,c.key=E;break}case 5:u=!0,(m=c)!=null&&m.frame&&!c.key&&(this.pushAccessUnit(c,e),c=this.VideoSample=null),c||(c=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),c.key=!0,c.frame=!0;break;case 6:{u=!0,Eg(d.data,1,s.pts,t.samples);break}case 7:{var x,v;u=!0,f=!0;const E=d.data,A=this.readSPS(E);if(!e.sps||e.width!==A.width||e.height!==A.height||((x=e.pixelRatio)==null?void 0:x[0])!==A.pixelRatio[0]||((v=e.pixelRatio)==null?void 0:v[1])!==A.pixelRatio[1]){e.width=A.width,e.height=A.height,e.pixelRatio=A.pixelRatio,e.sps=[E];const R=E.subarray(1,4);let D="avc1.";for(let L=0;L<3;L++){let O=R[L].toString(16);O.length<2&&(O="0"+O),D+=O}e.codec=D}break}case 8:u=!0,e.pps=[d.data];break;case 9:u=!0,e.audFound=!0,(g=c)!=null&&g.frame&&(this.pushAccessUnit(c,e),c=null),c||(c=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:u=!0;break;default:u=!1;break}c&&u&&c.units.push(d)}),a&&c&&(this.pushAccessUnit(c,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Pl(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s=8,a=8,l;for(let c=0;c<e;c++)a!==0&&(l=t.readEG(),a=(s+l+256)%256),s=a===0?s:a}readSPS(e){const t=new Pl(e);let s=0,a=0,l=0,c=0,u,f,d;const m=t.readUByte.bind(t),g=t.readBits.bind(t),y=t.readUEG.bind(t),x=t.readBoolean.bind(t),v=t.skipBits.bind(t),E=t.skipEG.bind(t),A=t.skipUEG.bind(t),R=this.skipScalingList.bind(this);m();const D=m();if(g(5),v(3),m(),A(),D===100||D===110||D===122||D===244||D===44||D===83||D===86||D===118||D===128){const k=y();if(k===3&&v(1),A(),A(),v(1),x())for(f=k!==3?8:12,d=0;d<f;d++)x()&&(d<6?R(16,t):R(64,t))}A();const L=y();if(L===0)y();else if(L===1)for(v(1),E(),E(),u=y(),d=0;d<u;d++)E();A(),v(1);const O=y(),H=y(),q=g(1);q===0&&v(1),v(1),x()&&(s=y(),a=y(),l=y(),c=y());let U=[1,1];if(x()&&x())switch(m()){case 1:U=[1,1];break;case 2:U=[12,11];break;case 3:U=[10,11];break;case 4:U=[16,11];break;case 5:U=[40,33];break;case 6:U=[24,11];break;case 7:U=[20,11];break;case 8:U=[32,11];break;case 9:U=[80,33];break;case 10:U=[18,11];break;case 11:U=[15,11];break;case 12:U=[64,33];break;case 13:U=[160,99];break;case 14:U=[4,3];break;case 15:U=[3,2];break;case 16:U=[2,1];break;case 255:{U=[m()<<8|m(),m()<<8|m()];break}}return{width:Math.ceil((O+1)*16-s*2-a*2),height:(2-q)*(H+1)*16-(q?2:4)*(l+c),pixelRatio:U}}}class CM extends sE{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,s,a){const l=this.parseNALu(e,s.data,a);let c=this.VideoSample,u,f=!1;s.data=null,c&&l.length&&!e.audFound&&(this.pushAccessUnit(c,e),c=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),l.forEach(d=>{var m,g;switch(d.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:c||(c=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),c.frame=!0,u=!0;break;case 16:case 17:case 18:case 21:if(u=!0,f){var y;(y=c)!=null&&y.frame&&!c.key&&(this.pushAccessUnit(c,e),c=this.VideoSample=null)}c||(c=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),c.key=!0,c.frame=!0;break;case 19:case 20:u=!0,(m=c)!=null&&m.frame&&!c.key&&(this.pushAccessUnit(c,e),c=this.VideoSample=null),c||(c=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),c.key=!0,c.frame=!0;break;case 39:u=!0,Eg(d.data,2,s.pts,t.samples);break;case 32:u=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Xt(e.params,this.readVPS(d.data)),this.initVPS=d.data),e.vps=[d.data];break;case 33:if(u=!0,f=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],d.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const x=this.readSPS(d.data);e.width=x.width,e.height=x.height,e.pixelRatio=x.pixelRatio,e.codec=x.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const v in x.params)e.params[v]=x.params[v]}this.pushParameterSet(e.sps,d.data,e.vps),c||(c=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),c.key=!0;break;case 34:if(u=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const x=this.readPPS(d.data);for(const v in x)e.params[v]=x[v]}this.pushParameterSet(e.pps,d.data,e.vps)}break;case 35:u=!0,e.audFound=!0,(g=c)!=null&&g.frame&&(this.pushAccessUnit(c,e),c=null),c||(c=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:u=!1;break}c&&u&&c.units.push(d)}),a&&c&&(this.pushAccessUnit(c,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let a=0;a<e.byteLength;a++)a>=2&&e[a]===3&&e[a-1]===0&&e[a-2]===0||(t[s]=e[a],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Pl(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const s=t.readBits(3),a=t.readBoolean();return{numTemporalLayers:s+1,temporalIdNested:a}}readSPS(e){const t=new Pl(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const a=t.readBits(2),l=t.readBoolean(),c=t.readBits(5),u=t.readUByte(),f=t.readUByte(),d=t.readUByte(),m=t.readUByte(),g=t.readUByte(),y=t.readUByte(),x=t.readUByte(),v=t.readUByte(),E=t.readUByte(),A=t.readUByte(),R=t.readUByte(),D=[],L=[];for(let He=0;He<s;He++)D.push(t.readBoolean()),L.push(t.readBoolean());if(s>0)for(let He=s;He<8;He++)t.readBits(2);for(let He=0;He<s;He++)D[He]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),L[He]&&t.readUByte();t.readUEG();const O=t.readUEG();O==3&&t.skipBits(1);const H=t.readUEG(),q=t.readUEG(),U=t.readBoolean();let k=0,M=0,I=0,j=0;U&&(k+=t.readUEG(),M+=t.readUEG(),I+=t.readUEG(),j+=t.readUEG());const Z=t.readUEG(),ae=t.readUEG(),ie=t.readUEG(),re=t.readBoolean();for(let He=re?0:s;He<=s;He++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let dt=0;dt<4;dt++)for(let Ot=0;Ot<(dt===3?2:6);Ot++)if(!t.readBoolean())t.readUEG();else{const os=Math.min(64,1<<4+(dt<<1));dt>1&&t.readEG();for(let Se=0;Se<os;Se++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const oe=t.readUEG();let Y=0;for(let He=0;He<oe;He++){let dt=!1;if(He!==0&&(dt=t.readBoolean()),dt){He===oe&&t.readUEG(),t.readBoolean(),t.readUEG();let Ot=0;for(let ns=0;ns<=Y;ns++){const os=t.readBoolean();let Se=!1;os||(Se=t.readBoolean()),(os||Se)&&Ot++}Y=Ot}else{const Ot=t.readUEG(),ns=t.readUEG();Y=Ot+ns;for(let os=0;os<Ot;os++)t.readUEG(),t.readBoolean();for(let os=0;os<ns;os++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const He=t.readUEG();for(let dt=0;dt<He;dt++){for(let Ot=0;Ot<ie+4;Ot++)t.readBits(1);t.readBits(1)}}let $=0,X=1,me=1,ve=!0,pe=1,ge=0;t.readBoolean(),t.readBoolean();let ee=!1;if(t.readBoolean()){if(t.readBoolean()){const ze=t.readUByte(),ot=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],vt=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];ze>0&&ze<16?(X=ot[ze-1],me=vt[ze-1]):ze===255&&(X=t.readBits(16),me=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),ee=t.readBoolean(),ee&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(pe=t.readBits(32),ge=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const vt=t.readBoolean(),Zs=t.readBoolean();let Ms=!1;(vt||Zs)&&(Ms=t.readBoolean(),Ms&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Ms&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Di=0;Di<=s;Di++){ve=t.readBoolean();const mi=ve||t.readBoolean();let Xi=!1;mi?t.readEG():Xi=t.readBoolean();const Qi=Xi?1:t.readUEG()+1;if(vt)for(let Js=0;Js<Qi;Js++)t.readUEG(),t.readUEG(),Ms&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Zs)for(let Js=0;Js<Qi;Js++)t.readUEG(),t.readUEG(),Ms&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),$=t.readUEG())}let Ie=H,Ue=q;if(U){let He=1,dt=1;O===1?He=dt=2:O==2&&(He=2),Ie=H-He*M-He*k,Ue=q-dt*j-dt*I}const qe=a?["A","B","C"][a]:"",ue=u<<24|f<<16|d<<8|m;let Be=0;for(let He=0;He<32;He++)Be=(Be|(ue>>He&1)<<31-He)>>>0;let Ge=Be.toString(16);return c===1&&Ge==="2"&&(Ge="6"),{codecString:`hvc1.${qe}${c}.${Ge}.${l?"H":"L"}${R}.B0`,params:{general_tier_flag:l,general_profile_idc:c,general_profile_space:a,general_profile_compatibility_flags:[u,f,d,m],general_constraint_indicator_flags:[g,y,x,v,E,A],general_level_idc:R,bit_depth:Z+8,bit_depth_luma_minus8:Z,bit_depth_chroma_minus8:ae,min_spatial_segmentation_idc:$,chroma_format_idc:O,frame_rate:{fixed:ve,fps:ge/pe}},width:Ie,height:Ue,pixelRatio:[X,me]}}readPPS(e){const t=new Pl(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const a=t.readBoolean(),l=t.readBoolean();let c=1;return l&&a?c=0:l?c=3:a&&(c=2),{parallelismType:c}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Ps=188;class Ra{constructor(e,t,s,a){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=a,this.videoParser=null}static probe(e,t){const s=Ra.syncOffset(e);return s>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),s!==-1}static syncOffset(e){const t=e.length;let s=Math.min(Ps*5,t-Ps)+1,a=0;for(;a<s;){let l=!1,c=-1,u=0;for(let f=a;f<t;f+=Ps)if(e[f]===71&&(t-f===Ps||e[f+Ps]===71)){if(u++,c===-1&&(c=f,c!==0&&(s=Math.min(c+Ps*99,e.length-Ps)+1)),l||(l=km(e,f)===0),l&&u>1&&(c===0&&u>2||f+Ps>s))return c}else{if(u)return-1;break}a++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:lS[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,s,a){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Ra.createTrack("video"),this._videoTrack.duration=a,this._audioTrack=Ra.createTrack("audio",a),this._id3Track=Ra.createTrack("id3"),this._txtTrack=Ra.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,s=!1,a=!1){s||(this.sampleAes=null);let l;const c=this._videoTrack,u=this._audioTrack,f=this._id3Track,d=this._txtTrack;let m=c.pid,g=c.pesData,y=u.pid,x=f.pid,v=u.pesData,E=f.pesData,A=null,R=this.pmtParsed,D=this._pmtId,L=e.length;if(this.remainderData&&(e=qi(this.remainderData,e),L=e.length,this.remainderData=null),L<Ps&&!a)return this.remainderData=e,{audioTrack:u,videoTrack:c,id3Track:f,textTrack:d};const O=Math.max(0,Ra.syncOffset(e));L-=(L-O)%Ps,L<e.byteLength&&!a&&(this.remainderData=new Uint8Array(e.buffer,L,e.buffer.byteLength-L));let H=0;for(let U=O;U<L;U+=Ps)if(e[U]===71){const k=!!(e[U+1]&64),M=km(e,U),I=(e[U+3]&48)>>4;let j;if(I>1){if(j=U+5+e[U+4],j===U+Ps)continue}else j=U+4;switch(M){case m:k&&(g&&(l=fo(g,this.logger))&&(this.readyVideoParser(c.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(c,d,l,!1)),g={data:[],size:0}),g&&(g.data.push(e.subarray(j,U+Ps)),g.size+=U+Ps-j);break;case y:if(k){if(v&&(l=fo(v,this.logger)))switch(u.segmentCodec){case"aac":this.parseAACPES(u,l);break;case"mp3":this.parseMPEGPES(u,l);break;case"ac3":this.parseAC3PES(u,l);break}v={data:[],size:0}}v&&(v.data.push(e.subarray(j,U+Ps)),v.size+=U+Ps-j);break;case x:k&&(E&&(l=fo(E,this.logger))&&this.parseID3PES(f,l),E={data:[],size:0}),E&&(E.data.push(e.subarray(j,U+Ps)),E.size+=U+Ps-j);break;case 0:k&&(j+=e[j]+1),D=this._pmtId=LM(e,j);break;case D:{k&&(j+=e[j]+1);const Z=DM(e,j,this.typeSupported,s,this.observer,this.logger);m=Z.videoPid,m>0&&(c.pid=m,c.segmentCodec=Z.segmentVideoCodec),y=Z.audioPid,y>0&&(u.pid=y,u.segmentCodec=Z.segmentAudioCodec),x=Z.id3Pid,x>0&&(f.pid=x),A!==null&&!R&&(this.logger.warn(`MPEG-TS PMT found at ${U} after unknown PID '${A}'. Backtracking to sync byte @${O} to parse all TS packets.`),A=null,U=O-188),R=this.pmtParsed=!0;break}case 17:case 8191:break;default:A=M;break}}else H++;H>0&&Mm(this.observer,new Error(`Found ${H} TS packet/s that do not start with 0x47`),void 0,this.logger),c.pesData=g,u.pesData=v,f.pesData=E;const q={audioTrack:u,videoTrack:c,id3Track:f,textTrack:d};return a&&this.extractRemainingSamples(q),q}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:a,textTrack:l}=e,c=s.pesData,u=t.pesData,f=a.pesData;let d;if(c&&(d=fo(c,this.logger))?(this.readyVideoParser(s.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(s,l,d,!0),s.pesData=null)):s.pesData=c,u&&(d=fo(u,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,d);break;case"mp3":this.parseMPEGPES(t,d);break;case"ac3":this.parseAC3PES(t,d);break}t.pesData=null}else u!=null&&u.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=u;f&&(d=fo(f,this.logger))?(this.parseID3PES(a,d),a.pesData=null):a.pesData=f}demuxSampleAes(e,t,s){const a=this.demux(e,s,!0,!this.config.progressive),l=this.sampleAes=new NM(this.observer,this.config,t);return this.decrypt(a,l)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new RM:e==="hevc"&&(this.videoParser=new CM))}decrypt(e,t){return new Promise(s=>{const{audioTrack:a,videoTrack:l}=e;a.samples&&a.segmentCodec==="aac"?t.decryptAacSamples(a.samples,0,()=>{l.samples?t.decryptAvcSamples(l.samples,0,0,()=>{s(e)}):s(e)}):l.samples&&t.decryptAvcSamples(l.samples,0,0,()=>{s(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const a=this.aacOverFlow;let l=t.data;if(a){this.aacOverFlow=null;const g=a.missing,y=a.sample.unit.byteLength;if(g===-1)l=qi(a.sample.unit,l);else{const x=y-g;a.sample.unit.set(l.subarray(0,g),x),e.samples.push(a.sample),s=a.missing}}let c,u;for(c=s,u=l.length;c<u-1&&!ld(l,c);c++);if(c!==s){let g;const y=c<u-1;if(y?g=`AAC PES did not start with ADTS header,offset:${c}`:g="No ADTS header found in AAC PES",Mm(this.observer,new Error(g),y,this.logger),!y)return}KS(e,this.observer,l,c,this.audioCodec);let f;if(t.pts!==void 0)f=t.pts;else if(a){const g=zS(e.samplerate);f=a.sample.pts+g}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let d=0,m;for(;c<u;)if(m=qS(e,l,c,f,d),c+=m.length,m.missing){this.aacOverFlow=m;break}else for(d++;c<u-1&&!ld(l,c);c++);}parseMPEGPES(e,t){const s=t.data,a=s.length;let l=0,c=0;const u=t.pts;if(u===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;c<a;)if(ZS(s,c)){const f=XS(e,s,c,u,l);if(f)c+=f.length,l++;else break}else c++}parseAC3PES(e,t){{const s=t.data,a=t.pts;if(a===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const l=s.length;let c=0,u=0,f;for(;u<l&&(f=tE(e,s,u,a,c++))>0;)u+=f}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const s=Xt({},t,{type:this._videoTrack?Ni.emsg:Ni.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function km(i,e){return((i[e+1]&31)<<8)+i[e+2]}function LM(i,e){return(i[e+10]&31)<<8|i[e+11]}function DM(i,e,t,s,a,l){const c={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},u=(i[e+1]&15)<<8|i[e+2],f=e+3+u-4,d=(i[e+10]&15)<<8|i[e+11];for(e+=12+d;e<f;){const m=km(i,e),g=(i[e+3]&15)<<8|i[e+4];switch(i[e]){case 207:if(!s){qf("ADTS AAC",l);break}case 15:c.audioPid===-1&&(c.audioPid=m);break;case 21:c.id3Pid===-1&&(c.id3Pid=m);break;case 219:if(!s){qf("H.264",l);break}case 27:c.videoPid===-1&&(c.videoPid=m);break;case 3:case 4:!t.mpeg&&!t.mp3?l.log("MPEG audio found, not supported in this browser"):c.audioPid===-1&&(c.audioPid=m,c.segmentAudioCodec="mp3");break;case 193:if(!s){qf("AC-3",l);break}case 129:t.ac3?c.audioPid===-1&&(c.audioPid=m,c.segmentAudioCodec="ac3"):l.log("AC-3 audio found, not supported in this browser");break;case 6:if(c.audioPid===-1&&g>0){let y=e+5,x=g;for(;x>2;){switch(i[y]){case 106:t.ac3!==!0?l.log("AC-3 audio found, not supported in this browser for now"):(c.audioPid=m,c.segmentAudioCodec="ac3");break}const E=i[y+1]+2;y+=E,x-=E}}break;case 194:case 135:return Mm(a,new Error("Unsupported EC-3 in M2TS found"),void 0,l),c;case 36:c.videoPid===-1&&(c.videoPid=m,c.segmentVideoCodec="hevc",l.log("HEVC in M2TS found"));break}e+=g+5}return c}function Mm(i,e,t,s){s.warn(`parsing error: ${e.message}`),i.emit(B.ERROR,B.ERROR,{type:et.MEDIA_ERROR,details:be.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function qf(i,e){e.log(`${i} with AES-128-CBC encryption found in unencrypted stream`)}function fo(i,e){let t=0,s,a,l,c,u;const f=i.data;if(!i||i.size===0)return null;for(;f[0].length<19&&f.length>1;)f[0]=qi(f[0],f[1]),f.splice(1,1);if(s=f[0],(s[0]<<16)+(s[1]<<8)+s[2]===1){if(a=(s[4]<<8)+s[5],a&&a>i.size-6)return null;const m=s[7];m&192&&(c=(s[9]&14)*536870912+(s[10]&255)*4194304+(s[11]&254)*16384+(s[12]&255)*128+(s[13]&254)/2,m&64?(u=(s[14]&14)*536870912+(s[15]&255)*4194304+(s[16]&254)*16384+(s[17]&255)*128+(s[18]&254)/2,c-u>60*9e4&&(e.warn(`${Math.round((c-u)/9e4)}s delta between PTS and DTS, align them`),c=u)):u=c),l=s[8];let g=l+9;if(i.size<=g)return null;i.size-=g;const y=new Uint8Array(i.size);for(let x=0,v=f.length;x<v;x++){s=f[x];let E=s.byteLength;if(g)if(g>E){g-=E;continue}else s=s.subarray(g),E-=g,g=0;y.set(s,t),t+=E}return a&&(a-=l+3),{data:y,pts:c,dts:u,len:a}}return null}class IM{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Aa=Math.pow(2,32)-1;class _e{static init(){_e.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in _e.types)_e.types.hasOwnProperty(e)&&(_e.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);_e.HDLR_TYPES={video:t,audio:s};const a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),l=new Uint8Array([0,0,0,0,0,0,0,0]);_e.STTS=_e.STSC=_e.STCO=l,_e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),_e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),_e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),_e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const c=new Uint8Array([105,115,111,109]),u=new Uint8Array([97,118,99,49]),f=new Uint8Array([0,0,0,1]);_e.FTYP=_e.box(_e.types.ftyp,c,f,c,u),_e.DINF=_e.box(_e.types.dinf,_e.box(_e.types.dref,a))}static box(e,...t){let s=8,a=t.length;const l=a;for(;a--;)s+=t[a].byteLength;const c=new Uint8Array(s);for(c[0]=s>>24&255,c[1]=s>>16&255,c[2]=s>>8&255,c[3]=s&255,c.set(e,4),a=0,s=8;a<l;a++)c.set(t[a],s),s+=t[a].byteLength;return c}static hdlr(e){return _e.box(_e.types.hdlr,_e.HDLR_TYPES[e])}static mdat(e){return _e.box(_e.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(Aa+1)),a=Math.floor(t%(Aa+1));return _e.box(_e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,a>>24,a>>16&255,a>>8&255,a&255,85,196,0,0]))}static mdia(e){return _e.box(_e.types.mdia,_e.mdhd(e.timescale||0,e.duration||0),_e.hdlr(e.type),_e.minf(e))}static mfhd(e){return _e.box(_e.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?_e.box(_e.types.minf,_e.box(_e.types.smhd,_e.SMHD),_e.DINF,_e.stbl(e)):_e.box(_e.types.minf,_e.box(_e.types.vmhd,_e.VMHD),_e.DINF,_e.stbl(e))}static moof(e,t,s){return _e.box(_e.types.moof,_e.mfhd(e),_e.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=_e.trak(e[t]);return _e.box.apply(null,[_e.types.moov,_e.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(_e.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=_e.trex(e[t]);return _e.box.apply(null,[_e.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(Aa+1)),a=Math.floor(t%(Aa+1)),l=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,a>>24,a>>16&255,a>>8&255,a&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return _e.box(_e.types.mvhd,l)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let a,l;for(a=0;a<t.length;a++)l=t[a].flags,s[a+4]=l.dependsOn<<4|l.isDependedOn<<2|l.hasRedundancy;return _e.box(_e.types.sdtp,s)}static stbl(e){return _e.box(_e.types.stbl,_e.stsd(e),_e.box(_e.types.stts,_e.STTS),_e.box(_e.types.stsc,_e.STSC),_e.box(_e.types.stsz,_e.STSZ),_e.box(_e.types.stco,_e.STCO))}static avc1(e){let t=[],s=[],a,l,c;for(a=0;a<e.sps.length;a++)l=e.sps[a],c=l.byteLength,t.push(c>>>8&255),t.push(c&255),t=t.concat(Array.prototype.slice.call(l));for(a=0;a<e.pps.length;a++)l=e.pps[a],c=l.byteLength,s.push(c>>>8&255),s.push(c&255),s=s.concat(Array.prototype.slice.call(l));const u=_e.box(_e.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(s))),f=e.width,d=e.height,m=e.pixelRatio[0],g=e.pixelRatio[1];return _e.box(_e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,_e.box(_e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),_e.box(_e.types.pasp,new Uint8Array([m>>24,m>>16&255,m>>8&255,m&255,g>>24,g>>16&255,g>>8&255,g&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return _e.box(_e.types.mp4a,_e.audioStsd(e),_e.box(_e.types.esds,_e.esds(e)))}static mp3(e){return _e.box(_e.types[".mp3"],_e.audioStsd(e))}static ac3(e){return _e.box(_e.types["ac-3"],_e.audioStsd(e),_e.box(_e.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return _e.box(_e.types.stsd,_e.STSD,_e.mp4a(e));if(t==="ac3"&&e.config)return _e.box(_e.types.stsd,_e.STSD,_e.ac3(e));if(t==="mp3"&&e.codec==="mp3")return _e.box(_e.types.stsd,_e.STSD,_e.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return _e.box(_e.types.stsd,_e.STSD,_e.avc1(e));if(t==="hevc"&&e.vps)return _e.box(_e.types.stsd,_e.STSD,_e.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),a=e.width||0,l=e.height||0,c=Math.floor(s/(Aa+1)),u=Math.floor(s%(Aa+1));return _e.box(_e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,c>>24,c>>16&255,c>>8&255,c&255,u>>24,u>>16&255,u>>8&255,u&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,a&255,0,0,l>>8&255,l&255,0,0]))}static traf(e,t){const s=_e.sdtp(e),a=e.id,l=Math.floor(t/(Aa+1)),c=Math.floor(t%(Aa+1));return _e.box(_e.types.traf,_e.box(_e.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255])),_e.box(_e.types.tfdt,new Uint8Array([1,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,c>>24,c>>16&255,c>>8&255,c&255])),_e.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,_e.box(_e.types.trak,_e.tkhd(e),_e.mdia(e))}static trex(e){const t=e.id;return _e.box(_e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],a=s.length,l=12+16*a,c=new Uint8Array(l);let u,f,d,m,g,y;for(t+=8+l,c.set([e.type==="video"?1:0,0,15,1,a>>>24&255,a>>>16&255,a>>>8&255,a&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),u=0;u<a;u++)f=s[u],d=f.duration,m=f.size,g=f.flags,y=f.cts,c.set([d>>>24&255,d>>>16&255,d>>>8&255,d&255,m>>>24&255,m>>>16&255,m>>>8&255,m&255,g.isLeading<<2|g.dependsOn,g.isDependedOn<<6|g.hasRedundancy<<4|g.paddingValue<<1|g.isNonSync,g.degradPrio&61440,g.degradPrio&15,y>>>24&255,y>>>16&255,y>>>8&255,y&255],12+16*u);return _e.box(_e.types.trun,c)}static initSegment(e){_e.types||_e.init();const t=_e.moov(e);return qi(_e.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],a=4,l=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),a-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let c=l.length;for(let v=0;v<s.length;v+=1){c+=3;for(let E=0;E<s[v].length;E+=1)c+=2+s[v][E].length}const u=new Uint8Array(c);u.set(l,0),c=l.length;const f=s.length-1;for(let v=0;v<s.length;v+=1){u.set(new Uint8Array([32+v|(v===f?128:0),0,s[v].length]),c),c+=3;for(let E=0;E<s[v].length;E+=1)u.set(new Uint8Array([s[v][E].length>>8,s[v][E].length&255]),c),c+=2,u.set(s[v][E],c),c+=s[v][E].length}const d=_e.box(_e.types.hvcC,u),m=e.width,g=e.height,y=e.pixelRatio[0],x=e.pixelRatio[1];return _e.box(_e.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>8&255,m&255,g>>8&255,g&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,_e.box(_e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),_e.box(_e.types.pasp,new Uint8Array([y>>24,y>>16&255,y>>8&255,y&255,x>>24,x>>16&255,x>>8&255,x&255])))}}_e.types=void 0;_e.HDLR_TYPES=void 0;_e.STTS=void 0;_e.STSC=void 0;_e.STCO=void 0;_e.STSZ=void 0;_e.VMHD=void 0;_e.SMHD=void 0;_e.STSD=void 0;_e.FTYP=void 0;_e.DINF=void 0;const iE=9e4;function Bg(i,e,t=1,s=!1){const a=i*e*t;return s?Math.round(a):a}function kM(i,e,t=1,s=!1){return Bg(i,e,1/t,s)}function kl(i,e=!1){return Bg(i,1e3,1/iE,e)}function MM(i,e=1){return Bg(i,iE,1/e)}function c_(i){const{baseTime:e,timescale:t,trackId:s}=i;return`${e/t} (${e}/${t}) trackId: ${s}`}const jM=10*1e3,OM=1024,PM=1152,BM=1536;let mo=null,Yf=null;function u_(i,e,t,s){return{duration:e,size:t,cts:s,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:i?2:1,isNonSync:i?0:1}}}class Vu extends Wi{constructor(e,t,s,a){if(super("mp4-remuxer",a),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.ISGenerated=!1,mo===null){const c=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);mo=c?parseInt(c[1]):0}if(Yf===null){const l=navigator.userAgent.match(/Safari\/(\d+)/i);Yf=l?parseInt(l[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&c_(t)} > ${e&&c_(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,a=e.reduce((l,c)=>{let u=c.pts,f=u-l;return f<-4294967296&&(t=!0,u=wi(u,s),f=u-l),f>0?l:u},s);return t&&this.debug("PTS rollover detected"),a}remux(e,t,s,a,l,c,u,f){let d,m,g,y,x,v,E=l,A=l;const R=e.pid>-1,D=t.pid>-1,L=t.samples.length,O=e.samples.length>0,H=u&&L>0||L>1;if((!R||O)&&(!D||H)||this.ISGenerated||u){if(this.ISGenerated){var U,k,M,I;const ie=this.videoTrackConfig;(ie&&(t.width!==ie.width||t.height!==ie.height||((U=t.pixelRatio)==null?void 0:U[0])!==((k=ie.pixelRatio)==null?void 0:k[0])||((M=t.pixelRatio)==null?void 0:M[1])!==((I=ie.pixelRatio)==null?void 0:I[1]))||!ie&&H||this.nextAudioTs===null&&O)&&this.resetInitSegment()}this.ISGenerated||(g=this.generateIS(e,t,l,c));const j=this.isVideoContiguous;let Z=-1,ae;if(H&&(Z=UM(t.samples),!j&&this.config.forceKeyFrameOnDiscontinuity))if(v=!0,Z>0){this.warn(`Dropped ${Z} out of ${L} video samples due to a missing keyframe`);const ie=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(Z),t.dropped+=Z,A+=(t.samples[0].pts-ie)/t.inputTimeScale,ae=A}else Z===-1&&(this.warn(`No keyframe found out of ${L} video samples`),v=!1);if(this.ISGenerated){if(O&&H){const ie=this.getVideoStartPts(t.samples),Q=(wi(e.samples[0].pts,ie)-ie)/t.inputTimeScale;E+=Math.max(0,Q),A+=Math.max(0,-Q)}if(O){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),g=this.generateIS(e,t,l,c)),m=this.remuxAudio(e,E,this.isAudioContiguous,c,D||H||f===Xe.AUDIO?A:void 0),H){const ie=m?m.endPTS-m.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),g=this.generateIS(e,t,l,c)),d=this.remuxVideo(t,A,j,ie)}}else H&&(d=this.remuxVideo(t,A,j,0));d&&(d.firstKeyFrame=Z,d.independent=Z!==-1,d.firstKeyFramePTS=ae)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(x=nE(s,l,this._initPTS,this._initDTS)),a.samples.length&&(y=aE(a,l,this._initPTS))),{audio:m,video:d,initSegment:g,independent:v,text:y,id3:x}}computeInitPts(e,t,s,a){const l=Math.round(s*t);let c=wi(e,l);if(c<l+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(l-c)/t} ${a}`);c<l+t;)c+=8589934592;return c-l}generateIS(e,t,s,a){const l=e.samples,c=t.samples,u=this.typeSupported,f={},d=this._initPTS;let m=!d||a,g="audio/mp4",y,x,v,E=-1;if(m&&(y=x=1/0),e.config&&l.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":u.mpeg?(g="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}f.audio={id:"audio",container:g,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&u.mpeg?new Uint8Array(0):_e.initSegment([e]),metadata:{channelCount:e.channelCount}},m&&(E=e.id,v=e.inputTimeScale,!d||v!==d.timescale?y=x=this.computeInitPts(l[0].pts,v,s,"audio"):m=!1)}if(t.sps&&t.pps&&c.length){if(t.timescale=t.inputTimeScale,f.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:_e.initSegment([t]),metadata:{width:t.width,height:t.height}},m)if(E=t.id,v=t.inputTimeScale,!d||v!==d.timescale){const A=this.getVideoStartPts(c),R=wi(c[0].dts,A),D=this.computeInitPts(R,v,s,"video"),L=this.computeInitPts(A,v,s,"video");x=Math.min(x,D),y=Math.min(y,L)}else m=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(f).length)return this.ISGenerated=!0,m?(d&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${s} ${y/v} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${y/v} (${y}/${v}) trackId: ${E}`),this._initPTS={baseTime:y,timescale:v,trackId:E},this._initDTS={baseTime:x,timescale:v,trackId:E}):y=v=void 0,{tracks:f,initPTS:y,timescale:v,trackId:E}}remuxVideo(e,t,s,a){const l=e.inputTimeScale,c=e.samples,u=[],f=c.length,d=this._initPTS,m=d.baseTime*l/d.timescale;let g=this.nextVideoTs,y=8,x=this.videoSampleDuration,v,E,A=Number.POSITIVE_INFINITY,R=Number.NEGATIVE_INFINITY,D=!1;if(!s||g===null){const $=m+t*l,X=c[0].pts-wi(c[0].dts,c[0].pts);mo&&g!==null&&Math.abs($-X-(g+m))<15e3?s=!0:g=$-X-m}const L=g+m;for(let $=0;$<f;$++){const X=c[$];X.pts=wi(X.pts,L),X.dts=wi(X.dts,L),X.dts<c[$>0?$-1:$].dts&&(D=!0)}D&&c.sort(function($,X){const me=$.dts-X.dts,ve=$.pts-X.pts;return me||ve}),v=c[0].dts,E=c[c.length-1].dts;const O=E-v,H=O?Math.round(O/(f-1)):x||e.inputTimeScale/30;if(s){const $=v-L,X=$>H,me=$<-1;if((X||me)&&(X?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${kl($,!0)} ms (${$}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${kl(-$,!0)} ms (${$}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!me||L>=c[0].pts||mo)){v=L;const ve=c[0].pts-$;if(X)c[0].dts=v,c[0].pts=ve;else{let pe=!0;for(let ge=0;ge<c.length&&!(c[ge].dts>ve&&pe);ge++){const ee=c[ge].pts;if(c[ge].dts-=$,c[ge].pts-=$,ge<c.length-1){const ye=c[ge+1].pts,Ie=c[ge].pts,Ue=ye<=Ie,qe=ye<=ee;pe=Ue==qe}}}this.log(`Video: Initial PTS/DTS adjusted: ${kl(ve,!0)}/${kl(v,!0)}, delta: ${kl($,!0)} ms`)}}v=Math.max(0,v);let q=0,U=0,k=v;for(let $=0;$<f;$++){const X=c[$],me=X.units,ve=me.length;let pe=0;for(let ge=0;ge<ve;ge++)pe+=me[ge].data.length;U+=pe,q+=ve,X.length=pe,X.dts<k?(X.dts=k,k+=H/4|0||1):k=X.dts,A=Math.min(X.pts,A),R=Math.max(X.pts,R)}E=c[f-1].dts;const M=U+4*q+8;let I;try{I=new Uint8Array(M)}catch($){this.observer.emit(B.ERROR,B.ERROR,{type:et.MUX_ERROR,details:be.REMUX_ALLOC_ERROR,fatal:!1,error:$,bytes:M,reason:`fail allocating video mdat ${M}`});return}const j=new DataView(I.buffer);j.setUint32(0,M),I.set(_e.types.mdat,4);let Z=!1,ae=Number.POSITIVE_INFINITY,ie=Number.POSITIVE_INFINITY,re=Number.NEGATIVE_INFINITY,Q=Number.NEGATIVE_INFINITY;for(let $=0;$<f;$++){const X=c[$],me=X.units;let ve=0;for(let ee=0,ye=me.length;ee<ye;ee++){const Ie=me[ee],Ue=Ie.data,qe=Ie.data.byteLength;j.setUint32(y,qe),y+=4,I.set(Ue,y),y+=qe,ve+=4+qe}let pe;if($<f-1)x=c[$+1].dts-X.dts,pe=c[$+1].pts-X.pts;else{const ee=this.config,ye=$>0?X.dts-c[$-1].dts:H;if(pe=$>0?X.pts-c[$-1].pts:H,ee.stretchShortVideoTrack&&this.nextAudioTs!==null){const Ie=Math.floor(ee.maxBufferHole*l),Ue=(a?A+a*l:this.nextAudioTs+m)-X.pts;Ue>Ie?(x=Ue-ye,x<0?x=ye:Z=!0,this.log(`It is approximately ${Ue/90} ms to the next segment; using duration ${x/90} ms for the last video frame.`)):x=ye}else x=ye}const ge=Math.round(X.pts-X.dts);ae=Math.min(ae,x),re=Math.max(re,x),ie=Math.min(ie,pe),Q=Math.max(Q,pe),u.push(u_(X.key,x,ve,ge))}if(u.length){if(mo){if(mo<70){const $=u[0].flags;$.dependsOn=2,$.isNonSync=0}}else if(Yf&&Q-ie<re-ae&&H/re<.025&&u[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let $=v;for(let X=0,me=u.length;X<me;X++){const ve=$+u[X].duration,pe=$+u[X].cts;if(X<me-1){const ge=ve+u[X+1].cts;u[X].duration=ge-pe}else u[X].duration=X?u[X-1].duration:H;u[X].cts=0,$=ve}}}x=Z||!x?H:x;const se=E+x;this.nextVideoTs=g=se-m,this.videoSampleDuration=x,this.isVideoContiguous=!0;const V={data1:_e.moof(e.sequenceNumber++,v,Xt(e,{samples:u})),data2:I,startPTS:(A-m)/l,endPTS:(R+x-m)/l,startDTS:(v-m)/l,endDTS:g/l,type:"video",hasAudio:!1,hasVideo:!0,nb:u.length,dropped:e.dropped};return e.samples=[],e.dropped=0,V}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return PM;case"ac3":return BM;default:return OM}}remuxAudio(e,t,s,a,l){const c=e.inputTimeScale,u=e.samplerate?e.samplerate:c,f=c/u,d=this.getSamplesPerFrame(e),m=d*f,g=this._initPTS,y=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,x=[],v=l!==void 0;let E=e.samples,A=y?0:8,R=this.nextAudioTs||-1;const D=g.baseTime*c/g.timescale,L=D+t*c;if(this.isAudioContiguous=s=s||E.length&&R>0&&(a&&Math.abs(L-(R+D))<9e3||Math.abs(wi(E[0].pts,L)-(R+D))<20*m),E.forEach(function(Q){Q.pts=wi(Q.pts,L)}),!s||R<0){const Q=E.length;if(E=E.filter(se=>se.pts>=0),Q!==E.length&&this.warn(`Removed ${E.length-Q} of ${Q} samples (initPTS ${D} / ${c})`),!E.length)return;l===0?R=0:a&&!v?R=Math.max(0,L-D):R=E[0].pts-D}if(e.segmentCodec==="aac"){const Q=this.config.maxAudioFramesDrift;for(let se=0,oe=R+D;se<E.length;se++){const Y=E[se],V=Y.pts,$=V-oe,X=Math.abs(1e3*$/c);if($<=-Q*m&&v)se===0&&(this.warn(`Audio frame @ ${(V/c).toFixed(3)}s overlaps marker by ${Math.round(1e3*$/c)} ms.`),this.nextAudioTs=R=V-D,oe=V);else if($>=Q*m&&X<jM&&v){let me=Math.round($/m);for(oe=V-me*m;oe<0&&me&&m;)me--,oe+=m;se===0&&(this.nextAudioTs=R=oe-D),this.warn(`Injecting ${me} audio frames @ ${((oe-D)/c).toFixed(3)}s due to ${Math.round(1e3*$/c)} ms gap.`);for(let ve=0;ve<me;ve++){let pe=IM.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);pe||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),pe=Y.unit.subarray()),E.splice(se,0,{unit:pe,pts:oe}),oe+=m,se++}}Y.pts=oe,oe+=m}}let O=null,H=null,q,U=0,k=E.length;for(;k--;)U+=E[k].unit.byteLength;for(let Q=0,se=E.length;Q<se;Q++){const oe=E[Q],Y=oe.unit;let V=oe.pts;if(H!==null){const X=x[Q-1];X.duration=Math.round((V-H)/f)}else if(s&&e.segmentCodec==="aac"&&(V=R+D),O=V,U>0){U+=A;try{q=new Uint8Array(U)}catch(X){this.observer.emit(B.ERROR,B.ERROR,{type:et.MUX_ERROR,details:be.REMUX_ALLOC_ERROR,fatal:!1,error:X,bytes:U,reason:`fail allocating audio mdat ${U}`});return}y||(new DataView(q.buffer).setUint32(0,U),q.set(_e.types.mdat,4))}else return;q.set(Y,A);const $=Y.byteLength;A+=$,x.push(u_(!0,d,$,0)),H=V}const M=x.length;if(!M)return;const I=x[x.length-1];R=H-D,this.nextAudioTs=R+f*I.duration;const j=y?new Uint8Array(0):_e.moof(e.sequenceNumber++,O/f,Xt({},e,{samples:x}));e.samples=[];const Z=(O-D)/c,ae=this.nextAudioTs/c,re={data1:j,data2:q,startPTS:Z,endPTS:ae,startDTS:Z,endDTS:ae,type:"audio",hasAudio:!0,hasVideo:!1,nb:M};return this.isAudioContiguous=!0,re}}function wi(i,e){let t;if(e===null)return i;for(e<i?t=-8589934592:t=8589934592;Math.abs(i-e)>4294967296;)i+=t;return i}function UM(i){for(let e=0;e<i.length;e++)if(i[e].key)return e;return-1}function nE(i,e,t,s){const a=i.samples.length;if(!a)return;const l=i.inputTimeScale;for(let u=0;u<a;u++){const f=i.samples[u];f.pts=wi(f.pts-t.baseTime*l/t.timescale,e*l)/l,f.dts=wi(f.dts-s.baseTime*l/s.timescale,e*l)/l}const c=i.samples;return i.samples=[],{samples:c}}function aE(i,e,t){const s=i.samples.length;if(!s)return;const a=i.inputTimeScale;for(let c=0;c<s;c++){const u=i.samples[c];u.pts=wi(u.pts-t.baseTime*a/t.timescale,e*a)/a}i.samples.sort((c,u)=>c.pts-u.pts);const l=i.samples;return i.samples=[],{samples:l}}class FM extends Wi{constructor(e,t,s,a){super("passthrough-remuxer",a),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,s,a){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(e,a),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:s,videoCodec:a}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:l,video:c}=this.initData=dS(e);if(t)NI(e,t);else{const f=l||c;f!=null&&f.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${f.codec}")!`)}l&&(s=d_(l,Zt.AUDIO,this)),c&&(a=d_(c,Zt.VIDEO,this));const u={};l&&c?u.audiovideo={container:"video/mp4",codec:s+","+a,supplemental:c.supplemental,encrypted:c.encrypted,initSegment:e,id:"main"}:l?u.audio={container:"audio/mp4",codec:s,encrypted:l.encrypted,initSegment:e,id:"audio"}:c?u.video={container:"video/mp4",codec:a,supplemental:c.supplemental,encrypted:c.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=u}remux(e,t,s,a,l,c){var u,f;let{initPTS:d,lastEndTime:m}=this;const g={audio:void 0,video:void 0,text:a,id3:s,initSegment:void 0};We(m)||(m=this.lastEndTime=l||0);const y=t.samples;if(!y.length)return g;const x={initPTS:void 0,timescale:void 0,trackId:void 0};let v=this.initData;if((u=v)!=null&&u.length||(this.generateInitSegment(y),v=this.initData),!((f=v)!=null&&f.length))return this.warn("Failed to generate initSegment."),g;this.emitInitSegment&&(x.tracks=this.initTracks,this.emitInitSegment=!1);const E=CI(y,v,this),A=v.audio?E[v.audio.id]:null,R=v.video?E[v.video.id]:null,D=Eu(R,1/0),L=Eu(A,1/0),O=Eu(R,0,!0),H=Eu(A,0,!0);let q=l,U=0;const k=A&&(!R||!d&&L<D||d&&d.trackId===v.audio.id),M=k?A:R;if(M){const oe=M.timescale,Y=M.start-l*oe,V=k?v.audio.id:v.video.id;q=M.start/oe,U=k?H-L:O-D,(c||!d)&&(GM(d,q,l,U)||oe!==d.timescale)&&(d&&this.warn(`Timestamps at playlist time: ${c?"":"~"}${l} ${Y/oe} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${l} offset: ${q-l} (${Y}/${oe}) trackId: ${V}`),d=null,x.initPTS=Y,x.timescale=oe,x.trackId=V)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${l}`);d?(x.initPTS=d.baseTime,x.timescale=d.timescale,x.trackId=d.trackId):((!x.timescale||x.trackId===void 0||x.initPTS===void 0)&&(this.warn("Could not set initPTS"),x.initPTS=q,x.timescale=1,x.trackId=-1),this.initPTS=d={baseTime:x.initPTS,timescale:x.timescale,trackId:x.trackId});const I=q-d.baseTime/d.timescale,j=I+U;U>0?this.lastEndTime=j:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const Z=!!v.audio,ae=!!v.video;let ie="";Z&&(ie+="audio"),ae&&(ie+="video");const re=(v.audio?v.audio.encrypted:!1)||(v.video?v.video.encrypted:!1),Q={data1:y,startPTS:I,startDTS:I,endPTS:j,endDTS:j,type:ie,hasAudio:Z,hasVideo:ae,nb:1,dropped:0,encrypted:re};g.audio=Z&&!ae?Q:void 0,g.video=ae?Q:void 0;const se=R?.sampleCount;if(se){const oe=R.keyFrameIndex,Y=oe!==-1;Q.nb=se,Q.dropped=oe===0||this.isVideoContiguous?0:Y?oe:se,Q.independent=Y,Q.firstKeyFrame=oe,Y&&R.keyFrameStart&&(Q.firstKeyFramePTS=(R.keyFrameStart-d.baseTime)/d.timescale),this.isVideoContiguous||(g.independent=Y),this.isVideoContiguous||(this.isVideoContiguous=Y),Q.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${oe}/${se} dropped: ${Q.dropped} start: ${Q.firstKeyFramePTS||"NA"}`)}return g.initSegment=x,g.id3=nE(s,l,d,d),a.samples.length&&(g.text=aE(a,l,d)),g}}function Eu(i,e,t=!1){return i?.start!==void 0?(i.start+(t?i.duration:0))/i.timescale:e}function GM(i,e,t,s){if(i===null)return!0;const a=Math.max(s,1),l=e-i.baseTime/i.timescale;return Math.abs(l-t)>a}function d_(i,e,t){const s=i.codec;return s&&s.length>4?s:e===Zt.AUDIO?s==="ec-3"||s==="ac-3"||s==="alac"?s:s==="fLaC"||s==="Opus"?ed(s,!1):(t.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"):(t.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1")}let qn;try{qn=self.performance.now.bind(self.performance)}catch{qn=Date.now}const Hu=[{demux:wM,remux:FM},{demux:Ra,remux:Vu},{demux:SM,remux:Vu},{demux:TM,remux:Vu}];Hu.splice(2,0,{demux:EM,remux:Vu});class h_{constructor(e,t,s,a,l,c){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=l,this.logger=c}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,a){const l=s.transmuxing;l.executeStart=qn();let c=new Uint8Array(e);const{currentTransmuxState:u,transmuxConfig:f}=this;a&&(this.currentTransmuxState=a);const{contiguous:d,discontinuity:m,trackSwitch:g,accurateTimeOffset:y,timeOffset:x,initSegmentChange:v}=a||u,{audioCodec:E,videoCodec:A,defaultInitPts:R,duration:D,initSegmentData:L}=f,O=$M(c,t);if(O&&bo(O.method)){const k=this.getDecrypter(),M=Cg(O.method);if(k.isSync()){let I=k.softwareDecrypt(c,O.key.buffer,O.iv.buffer,M);if(s.part>-1){const Z=k.flush();I=Z&&Z.buffer}if(!I)return l.executeEnd=qn(),Wf(s);c=new Uint8Array(I)}else return this.asyncResult=!0,this.decryptionPromise=k.webCryptoDecrypt(c,O.key.buffer,O.iv.buffer,M).then(I=>{const j=this.push(I,null,s);return this.decryptionPromise=null,j}),this.decryptionPromise}const H=this.needsProbing(m,g);if(H){const k=this.configureTransmuxer(c);if(k)return this.logger.warn(`[transmuxer] ${k.message}`),this.observer.emit(B.ERROR,B.ERROR,{type:et.MEDIA_ERROR,details:be.FRAG_PARSING_ERROR,fatal:!1,error:k,reason:k.message}),l.executeEnd=qn(),Wf(s)}(m||g||v||H)&&this.resetInitSegment(L,E,A,D,t),(m||v||H)&&this.resetInitialTimestamp(R),d||this.resetContiguity();const q=this.transmux(c,O,x,y,s);this.asyncResult=zl(q);const U=this.currentTransmuxState;return U.contiguous=!0,U.discontinuity=!1,U.trackSwitch=!1,l.executeEnd=qn(),q}flush(e){const t=e.transmuxing;t.executeStart=qn();const{decrypter:s,currentTransmuxState:a,decryptionPromise:l}=this;if(l)return this.asyncResult=!0,l.then(()=>this.flush(e));const c=[],{timeOffset:u}=a;if(s){const g=s.flush();g&&c.push(this.push(g.buffer,null,e))}const{demuxer:f,remuxer:d}=this;if(!f||!d){t.executeEnd=qn();const g=[Wf(e)];return this.asyncResult?Promise.resolve(g):g}const m=f.flush(u);return zl(m)?(this.asyncResult=!0,m.then(g=>(this.flushRemux(c,g,e),c))):(this.flushRemux(c,m,e),this.asyncResult?Promise.resolve(c):c)}flushRemux(e,t,s){const{audioTrack:a,videoTrack:l,id3Track:c,textTrack:u}=t,{accurateTimeOffset:f,timeOffset:d}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===Xe.MAIN?"level":"track"} ${s.level}`);const m=this.remuxer.remux(a,l,c,u,d,f,!0,this.id);e.push({remuxResult:m,chunkMeta:s}),s.transmuxing.executeEnd=qn()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;!t||!s||(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,a,l){const{demuxer:c,remuxer:u}=this;!c||!u||(c.resetInitSegment(e,t,s,a),u.resetInitSegment(e,t,s,l))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,a,l){let c;return t&&t.method==="SAMPLE-AES"?c=this.transmuxSampleAes(e,t,s,a,l):c=this.transmuxUnencrypted(e,s,a,l),c}transmuxUnencrypted(e,t,s,a){const{audioTrack:l,videoTrack:c,id3Track:u,textTrack:f}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(l,c,u,f,t,s,!1,this.id),chunkMeta:a}}transmuxSampleAes(e,t,s,a,l){return this.demuxer.demuxSampleAes(e,t,s).then(c=>({remuxResult:this.remuxer.remux(c.audioTrack,c.videoTrack,c.id3Track,c.textTrack,s,a,!1,this.id),chunkMeta:l}))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:a}=this;let l;for(let g=0,y=Hu.length;g<y;g++){var c;if((c=Hu[g].demux)!=null&&c.probe(e,this.logger)){l=Hu[g];break}}if(!l)return new Error("Failed to find demuxer by probing fragment data");const u=this.demuxer,f=this.remuxer,d=l.remux,m=l.demux;(!f||!(f instanceof d))&&(this.remuxer=new d(s,t,a,this.logger)),(!u||!(u instanceof m))&&(this.demuxer=new m(s,t,a,this.logger),this.probe=m.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Ng(this.config)),e}}function $M(i,e){let t=null;return i.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Wf=i=>({remuxResult:{},chunkMeta:i});function zl(i){return"then"in i&&i.then instanceof Function}class VM{constructor(e,t,s,a,l){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=a,this.defaultInitPts=l||null}}class HM{constructor(e,t,s,a,l,c){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=a,this.timeOffset=l,this.initSegmentChange=c}}let f_=0;class rE{constructor(e,t,s,a){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=f_++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=f=>{const d=f.data,m=this.hls;if(!(!m||!(d!=null&&d.event)||d.instanceNo!==this.instanceNo))switch(d.event){case"init":{var g;const y=(g=this.workerContext)==null?void 0:g.objectURL;y&&self.URL.revokeObjectURL(y);break}case"transmuxComplete":{this.handleTransmuxComplete(d.data);break}case"flush":{this.onFlush(d.data);break}case"workerLog":{m.logger[d.data.logType]&&m.logger[d.data.logType](d.data.message);break}default:{d.data=d.data||{},d.data.frag=this.frag,d.data.part=this.part,d.data.id=this.id,m.trigger(d.event,d.data);break}}},this.onWorkerError=f=>{if(!this.hls)return;const d=new Error(`${f.message}  (${f.filename}:${f.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(B.ERROR,{type:et.OTHER_ERROR,details:be.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:d})};const l=e.config;this.hls=e,this.id=t,this.useWorker=!!l.enableWorker,this.onTransmuxComplete=s,this.onFlush=a;const c=(f,d)=>{d=d||{},d.frag=this.frag||void 0,f===B.ERROR&&(d=d,d.parent=this.id,d.part=this.part,this.error=d.error),this.hls.trigger(f,d)};this.observer=new Ig,this.observer.on(B.FRAG_DECRYPTED,c),this.observer.on(B.ERROR,c);const u=Rv(l.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const f=this.hls.logger;if(l.workerPath||Yk()){try{l.workerPath?(f.log(`loading Web Worker ${l.workerPath} for "${t}"`),this.workerContext=Xk(l.workerPath)):(f.log(`injecting Web Worker for "${t}"`),this.workerContext=Wk());const{worker:m}=this.workerContext;m.addEventListener("message",this.onWorkerMessage),m.addEventListener("error",this.onWorkerError),m.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:u,id:t,config:Jt(l)})}catch(m){f.warn(`Error setting up "${t}" Web Worker, fallback to inline`,m),this.terminateWorker(),this.error=null,this.transmuxer=new h_(this.observer,u,l,"",t,e.logger)}return}}this.transmuxer=new h_(this.observer,u,l,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=f_++;const t=this.hls.config,s=Rv(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:Jt(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),Qk(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,a,l,c,u,f,d,m){var g,y;d.transmuxing.start=self.performance.now();const{instanceNo:x,transmuxer:v}=this,E=c?c.start:l.start,A=l.decryptdata,R=this.frag,D=!(R&&l.cc===R.cc),L=!(R&&d.level===R.level),O=R?d.sn-R.sn:-1,H=this.part?d.part-this.part.index:-1,q=O===0&&d.id>1&&d.id===R?.stats.chunkCount,U=!L&&(O===1||O===0&&(H===1||q&&H<=0)),k=self.performance.now();(L||O||l.stats.parsing.start===0)&&(l.stats.parsing.start=k),c&&(H||!U)&&(c.stats.parsing.start=k);const M=!(R&&((g=l.initSegment)==null?void 0:g.url)===((y=R.initSegment)==null?void 0:y.url)),I=new HM(D,U,f,L,E,M);if(!U||D||M){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${l.type} sn: ${d.sn}${d.part>-1?" part: "+d.part:""} ${this.id===Xe.MAIN?"level":"track"}: ${d.level} id: ${d.id}
        discontinuity: ${D}
        trackSwitch: ${L}
        contiguous: ${U}
        accurateTimeOffset: ${f}
        timeOffset: ${E}
        initSegmentChange: ${M}`);const j=new VM(s,a,t,u,m);this.configureTransmuxer(j)}if(this.frag=l,this.part=c,this.workerContext)this.workerContext.worker.postMessage({instanceNo:x,cmd:"demux",data:e,decryptdata:A,chunkMeta:d,state:I},e instanceof ArrayBuffer?[e]:[]);else if(v){const j=v.push(e,A,d,I);zl(j)?j.then(Z=>{this.handleTransmuxComplete(Z)}).catch(Z=>{this.transmuxerError(Z,d,"transmuxer-interface push error")}):this.handleTransmuxComplete(j)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const a=s.flush(e);zl(a)?a.then(l=>{this.handleFlushResult(l,e)}).catch(l=>{this.transmuxerError(l,e,"transmuxer-interface flush error")}):this.handleFlushResult(a,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(B.ERROR,{type:et.MEDIA_ERROR,details:be.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach(s=>{this.handleTransmuxComplete(s)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const m_=100;class KM extends Dg{constructor(e,t,s){super(e,t,s,"audio-stream-controller",Xe.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(B.LEVEL_LOADED,this.onLevelLoaded,this),e.on(B.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(B.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(B.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(B.BUFFER_RESET,this.onBufferReset,this),e.on(B.BUFFER_CREATED,this.onBufferCreated,this),e.on(B.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(B.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(B.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(B.FRAG_LOADING,this.onFragLoading,this),e.on(B.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(B.LEVEL_LOADED,this.onLevelLoaded,this),e.off(B.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(B.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(B.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(B.BUFFER_RESET,this.onBufferReset,this),e.off(B.BUFFER_CREATED,this.onBufferCreated,this),e.off(B.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(B.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(B.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(B.FRAG_LOADING,this.onFragLoading,this),e.off(B.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:s,initPTS:a,timescale:l,trackId:c}){if(s===Xe.MAIN){const u=t.cc,f=this.fragCurrent;if(this.initPTS[u]={baseTime:a,timescale:l,trackId:c},this.log(`InitPTS for cc: ${u} found from main: ${a/l} (${a}/${l}) trackId: ${c}`),this.mainAnchor=t,this.state===je.WAITING_INIT_PTS){const d=this.waitingData;(!d&&!this.loadingParts||d&&d.frag.cc!==u)&&this.syncWithAnchor(t,d?.frag)}else!this.hls.hasEnoughToStart&&f&&f.cc!==u?(f.abortRequests(),this.syncWithAnchor(t,f)):this.state===je.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var s;const a=((s=this.mainFragLoading)==null?void 0:s.frag)||null;if(t&&a?.cc===t.cc)return;const l=(a||e).cc,c=this.getLevelDetails(),u=this.getLoadPosition(),f=SS(c,l,u);f&&(this.log(`Syncing with main frag at ${f.start} cc ${f.cc}`),this.startFragRequested=!1,this.nextLoadPosition=f.start,this.resetLoadingState(),this.state===je.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=je.STOPPED;return}const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(m_),s>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s,this.state=je.IDLE):this.state=je.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case je.IDLE:this.doTickIdle();break;case je.WAITING_TRACK:{const{levels:e,trackId:t}=this,s=e?.[t],a=s?.details;if(a&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(a))break;this.state=je.WAITING_INIT_PTS}break}case je.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case je.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:s,cache:a,complete:l}=e,c=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=je.FRAG_LOADING;const u=a.flush().buffer,f={frag:t,part:s,payload:u,networkDetails:null};this._handleFragmentLoadProgress(f),l&&super._handleFragmentLoadComplete(f)}else c&&c.cc!==e.frag.cc&&this.syncWithAnchor(c,e.frag)}else this.state=je.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:a,trackId:l}=this,c=t.config;if(!this.buffering||!a&&!this.primaryPrefetch&&(this.startFragRequested||!c.startFragPrefetch)||!(s!=null&&s[l]))return;const u=s[l],f=u.details;if(!f||this.waitForLive(u)||this.waitForCdnTuneIn(f)){this.state=je.WAITING_TRACK,this.startFragRequested=!1;return}const d=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&d&&(this.bufferFlushed=!1,this.afterBufferFlushed(d,Zt.AUDIO,Xe.AUDIO));const m=this.getFwdBufferInfo(d,Xe.AUDIO);if(m===null)return;if(!this.switchingTrack&&this._streamEnded(m,f)){t.trigger(B.BUFFER_EOS,{type:"audio"}),this.state=je.ENDED;return}const g=m.len,y=t.maxBufferLength,x=f.fragments,v=x[0].start,E=this.getLoadPosition(),A=this.flushing?E:m.end;if(this.switchingTrack&&a){const L=E;f.PTSKnown&&L<v&&(m.end>v||m.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),a.currentTime=v+.05)}if(g>=y&&!this.switchingTrack&&A<x[x.length-1].start)return;let R=this.getNextFragment(A,f);if(R&&this.isLoopLoading(R,A)&&(R=this.getNextFragmentLoopLoading(R,f,m,Xe.MAIN,y)),!R){this.bufferFlushed=!0;return}let D=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&D&&_s(R)&&!R.endList&&(!f.live||!this.loadingParts&&A<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(D)===Is.OK&&(this.mainFragLoading=D=null),D&&_s(D))){if(R.start>D.end){const O=this.fragmentTracker.getFragAtPos(A,Xe.MAIN);O&&O.end>D.end&&(D=O,this.mainFragLoading={frag:O,targetBufferTime:null})}if(R.start>D.end)return}this.loadFragment(R,u,A)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(s=>new Vl(s))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:a}=this;a&&(a.abortRequests(),this.removeUnbufferedFrags(a.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==je.STOPPED&&(this.setInterval(m_),this.state=je.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(B.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:a}=this,{details:l,id:c,groupId:u,track:f}=t;if(!a){this.warn(`Audio tracks reset while loading track ${c} "${f.name}" of "${u}"`);return}const d=this.mainDetails;if(!d||l.endCC>d.endCC||d.expired){this.cachedTrackLoadedData=t,this.state!==je.STOPPED&&(this.state=je.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${c} "${f.name}" of "${u}" loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""},duration:${l.totalduration}`);const m=a[c];let g=0;if(l.live||(s=m.details)!=null&&s.live){if(this.checkLiveUpdate(l),l.deltaUpdateFailed)return;if(m.details){var y;g=this.alignPlaylists(l,m.details,(y=this.levelLastLoaded)==null?void 0:y.details)}l.alignedSliding||(FS(l,d),l.alignedSliding||od(l,d),g=l.fragmentStart)}m.details=l,this.levelLastLoaded=m,this.startFragRequested||this.setStartPosition(d,g),this.hls.trigger(B.AUDIO_TRACK_UPDATED,{details:l,id:c,groupId:t.groupId}),this.state===je.WAITING_TRACK&&!this.waitForCdnTuneIn(l)&&(this.state=je.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:a,payload:l}=e,{config:c,trackId:u,levels:f}=this;if(!f){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const d=f[u];if(!d){this.warn("Audio track is undefined on fragment load progress");return}const m=d.details;if(!m){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(s.start);return}const g=c.defaultAudioCodec||d.audioCodec||"mp4a.40.2";let y=this.transmuxer;y||(y=this.transmuxer=new rE(this.hls,Xe.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const x=this.initPTS[s.cc],v=(t=s.initSegment)==null?void 0:t.data;if(x!==void 0){const A=a?a.index:-1,R=A!==-1,D=new Rg(s.level,s.sn,s.stats.chunkCount,l.byteLength,A,R);y.push(l,v,g,"",s,a,m.totalduration,!1,D,x)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${m.startSN} ,${m.endSN}],track ${u}`);const{cache:E}=this.waitingData=this.waitingData||{frag:s,part:a,cache:new GS,complete:!1};E.push(new Uint8Array(l)),this.state!==je.STOPPED&&(this.state=je.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Xe.MAIN&&_s(t.frag)&&(this.mainFragLoading=t,this.state===je.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:s,part:a}=t;if(s.type!==Xe.AUDIO){!this.audioOnly&&s.type===Xe.MAIN&&!s.elementaryStreams.video&&!s.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${a?" p: "+a.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(_s(s)){this.fragPrevious=s;const l=this.switchingTrack;l&&(this.bufferedTrack=l,this.switchingTrack=null,this.hls.trigger(B.AUDIO_TRACK_SWITCHED,Kt({},l)))}this.fragBufferedComplete(s,a),this.media&&this.tick()}onError(e,t){var s;if(t.fatal){this.state=je.ERROR;return}switch(t.details){case be.FRAG_GAP:case be.FRAG_PARSING_ERROR:case be.FRAG_DECRYPT_ERROR:case be.FRAG_LOAD_ERROR:case be.FRAG_LOAD_TIMEOUT:case be.KEY_LOAD_ERROR:case be.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Xe.AUDIO,t);break;case be.AUDIO_TRACK_LOAD_ERROR:case be.AUDIO_TRACK_LOAD_TIMEOUT:case be.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===je.WAITING_TRACK&&((s=t.context)==null?void 0:s.type)===At.AUDIO_TRACK&&(this.state=je.IDLE);break;case be.BUFFER_ADD_CODEC_ERROR:case be.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case be.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case be.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Zt.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Zt.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===je.ENDED&&(this.state=je.IDLE);const s=this.mediaBuffer||this.media;s&&(this.afterBufferFlushed(s,t,Xe.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:a}=this,{remuxResult:l,chunkMeta:c}=e,u=this.getCurrentContext(c);if(!u){this.resetWhenMissingContext(c);return}const{frag:f,part:d,level:m}=u,{details:g}=m,{audio:y,text:x,id3:v,initSegment:E}=l;if(this.fragContextChanged(f)||!g){this.fragmentTracker.removeFragment(f);return}if(this.state=je.PARSING,this.switchingTrack&&y&&this.completeAudioSwitch(this.switchingTrack),E!=null&&E.tracks){const A=f.initSegment||f;if(this.unhandledEncryptionError(E,f))return;this._bufferInitSegment(m,E.tracks,A,c),a.trigger(B.FRAG_PARSING_INIT_SEGMENT,{frag:A,id:s,tracks:E.tracks})}if(y){const{startPTS:A,endPTS:R,startDTS:D,endDTS:L}=y;d&&(d.elementaryStreams[Zt.AUDIO]={startPTS:A,endPTS:R,startDTS:D,endDTS:L}),f.setElementaryStreamInfo(Zt.AUDIO,A,R,D,L),this.bufferFragmentData(y,f,d,c)}if(v!=null&&(t=v.samples)!=null&&t.length){const A=Xt({id:s,frag:f,details:g},v);a.trigger(B.FRAG_PARSING_METADATA,A)}if(x){const A=Xt({id:s,frag:f,details:g},x);a.trigger(B.FRAG_PARSING_USERDATA,A)}}_bufferInitSegment(e,t,s,a){if(this.state!==je.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const l=t.audio;l.id=Xe.AUDIO;const c=e.audioCodec;this.log(`Init audio buffer, container:${l.container}, codecs[level/parsed]=[${c}/${l.codec}]`),c&&c.split(",").length===1&&(l.levelCodec=c),this.hls.trigger(B.BUFFER_CODECS,t);const u=l.initSegment;if(u!=null&&u.byteLength){const f={type:"audio",frag:s,part:null,chunkMeta:a,parent:s.type,data:u};this.hls.trigger(B.BUFFER_APPENDING,f)}this.tickImmediate()}loadFragment(e,t,s){const a=this.fragmentTracker.getState(e);if(this.switchingTrack||a===Is.NOT_LOADED||a===Is.PARTIAL){var l;if(!_s(e))this._loadInitSegment(e,t);else if((l=t.details)!=null&&l.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=je.WAITING_INIT_PTS;const c=this.mainDetails;c&&c.fragmentStart!==t.details.fragmentStart&&od(t.details,c)}else super.loadFragment(e,t,s)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:a,characteristics:l,audioCodec:c,channels:u}=this.bufferedTrack;fr({name:t,lang:s,assocLang:a,characteristics:l,audioCodec:c,channels:u},e,or)||(sd(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(B.AUDIO_TRACK_SWITCHED,Kt({},e))}}class Ug extends Wi{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const a=t?.renditionReports;if(a){let l=-1;for(let c=0;c<a.length;c++){const u=a[c];let f;try{f=new self.URL(u.URI,t.url).href}catch(d){this.warn(`Could not construct new URL for Rendition Report: ${d}`),f=u.URI||""}if(f===e){l=c;break}else f===e.substring(0,f.length)&&(l=c)}if(l!==-1){const c=a[l],u=parseInt(c["LAST-MSN"])||t.lastPartSn;let f=parseInt(c["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const m=Math.min(t.age-t.partTarget,t.targetduration);f>=0&&m>t.partTarget&&(f+=1)}const d=s&&Cv(s);return new Lv(u,f>=0?f:void 0,d)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return e}playlistLoaded(e,t,s){const{details:a,stats:l}=t,c=self.performance.now(),u=l.loading.first?Math.max(0,c-l.loading.first):0;a.advancedDateTime=Date.now()-u;const f=this.hls.config.timelineOffset;if(f!==a.appliedTimelineOffset){const m=Math.max(f||0,0);a.appliedTimelineOffset=m,a.fragments.forEach(g=>{g.setStart(g.playlistOffset+m)})}if(a.live||s!=null&&s.live){const m="levelInfo"in t?t.levelInfo:t.track;if(a.reloaded(s),s&&a.fragments.length>0){Pk(s,a,this);const D=a.playlistParsingError;if(D){this.warn(D);const L=this.hls;if(!L.config.ignorePlaylistParsingErrors){var d;const{networkDetails:O}=t;L.trigger(B.ERROR,{type:et.NETWORK_ERROR,details:be.LEVEL_PARSING_ERROR,fatal:!1,url:a.url,error:D,reason:D.message,level:t.level||void 0,parent:(d=a.fragments[0])==null?void 0:d.type,networkDetails:O,stats:l});return}a.playlistParsingError=null}}a.requestScheduled===-1&&(a.requestScheduled=l.loading.start);const g=this.hls.mainForwardBufferInfo,y=g?g.end-g.len:0,x=(a.edge-y)*1e3,v=jS(a,x);if(a.requestScheduled+v<c?a.requestScheduled=c:a.requestScheduled+=v,this.log(`live playlist ${e} ${a.advanced?"REFRESHED "+a.lastPartSn+"-"+a.lastPartIndex:a.updated?"UPDATED":"MISSED"}`),!this.canLoad||!a.live)return;let E,A,R;if(a.canBlockReload&&a.endSN&&a.advanced){const D=this.hls.config.lowLatencyMode,L=a.lastPartSn,O=a.endSN,H=a.lastPartIndex,q=H!==-1,U=L===O;q?U?(A=O+1,R=D?0:H):(A=L,R=D?H+1:a.maxPartIndex):A=O+1;const k=a.age,M=k+a.ageHeader;let I=Math.min(M-a.partTarget,a.targetduration*1.5);if(I>0){if(M>a.targetduration*3)this.log(`Playlist last advanced ${k.toFixed(2)}s ago. Omitting segment and part directives.`),A=void 0,R=void 0;else if(s!=null&&s.tuneInGoal&&M-a.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${I} with playlist age: ${a.age}`),I=0;else{const j=Math.floor(I/a.targetduration);if(A+=j,R!==void 0){const Z=Math.round(I%a.targetduration/a.partTarget);R+=Z}this.log(`CDN Tune-in age: ${a.ageHeader}s last advanced ${k.toFixed(2)}s goal: ${I} skip sn ${j} to part ${R}`)}a.tuneInGoal=I}if(E=this.getDeliveryDirectives(a,t.deliveryDirectives,A,R),D||!U){a.requestScheduled=c,this.loadingPlaylist(m,E);return}}else(a.canBlockReload||a.canSkipUntil)&&(E=this.getDeliveryDirectives(a,t.deliveryDirectives,A,R));E&&A!==void 0&&a.canBlockReload&&(a.requestScheduled=l.loading.first+Math.max(v-u*2,v/2)),this.scheduleLoading(m,E,a)}else this.clearTimer()}scheduleLoading(e,t,s){const a=s||e.details;if(!a){this.loadingPlaylist(e,t);return}const l=self.performance.now(),c=a.requestScheduled;if(l>=c){this.loadingPlaylist(e,t);return}const u=c-l;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(u)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),u)}getDeliveryDirectives(e,t,s,a){let l=Cv(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,a=t.part,l=Gu.No),new Lv(s,a,l)}checkRetry(e){const t=e.details,s=id(e),a=e.errorAction,{action:l,retryCount:c=0,retryConfig:u}=a||{},f=!!a&&!!u&&(l===Vs.RetryRequest||!a.resolved&&l===Vs.SendAlternateToPenaltyBox);if(f){var d;if(c>=u.maxNumRetry)return!1;if(s&&(d=e.context)!=null&&d.deliveryDirectives)this.warn(`Retrying playlist loading ${c+1}/${u.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const m=wg(u,c);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),m),this.warn(`Retrying playlist loading ${c+1}/${u.maxNumRetry} after "${t}" in ${m}ms`)}e.levelRetry=!0,a.resolved=!0}return f}}function oE(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(!ql(i[t].attrs,e[t].attrs))return!1;return!0}function ql(i,e,t){const s=i["STABLE-RENDITION-ID"];return s&&!t?s===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(a=>i[a]!==e[a])}function jm(i,e){return e.label.toLowerCase()===i.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(i.lang||"").toLowerCase())}class zM extends Ug{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(B.MANIFEST_LOADING,this.onManifestLoading,this),e.on(B.MANIFEST_PARSED,this.onManifestParsed,this),e.on(B.LEVEL_LOADING,this.onLevelLoading,this),e.on(B.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(B.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(B.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(B.MANIFEST_LOADING,this.onManifestLoading,this),e.off(B.MANIFEST_PARSED,this.onManifestParsed,this),e.off(B.LEVEL_LOADING,this.onLevelLoading,this),e.off(B.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(B.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(B.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:a,details:l}=t,c=this.tracksInGroup[s];if(!c||c.groupId!==a){this.warn(`Audio track with id:${s} and group:${a} not found in active group ${c?.groupId}`);return}const u=c.details;c.details=t.details,this.log(`Audio track ${s} "${c.name}" lang:${c.lang} group:${a} loaded [${l.startSN}-${l.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,a=this.groupIds;let l=this.currentTrack;if(!s||a?.length!==s?.length||s!=null&&s.some(u=>a?.indexOf(u)===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const u=this.tracks.filter(y=>!s||s.indexOf(y.groupId)!==-1);if(u.length)this.selectDefaultTrack&&!u.some(y=>y.default)&&(this.selectDefaultTrack=!1),u.forEach((y,x)=>{y.id=x});else if(!l&&!this.tracksInGroup.length)return;this.tracksInGroup=u;const f=this.hls.config.audioPreference;if(!l&&f){const y=vn(f,u,or);if(y>-1)l=u[y];else{const x=vn(f,this.tracks);l=this.tracks[x]}}let d=this.findTrackId(l);d===-1&&l&&(d=this.findTrackId(null));const m={audioTracks:u};this.log(`Updating audio tracks, ${u.length} track(s) found in group(s): ${s?.join(",")}`),this.hls.trigger(B.AUDIO_TRACKS_UPDATED,m);const g=this.trackId;if(d!==-1&&g===-1)this.setAudioTrack(d);else if(u.length&&g===-1){var c;const y=new Error(`No audio track selected for current audio group-ID(s): ${(c=this.groupIds)==null?void 0:c.join(",")} track count: ${u.length}`);this.warn(y.message),this.hls.trigger(B.ERROR,{type:et.MEDIA_ERROR,details:be.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:y})}}}onError(e,t){t.fatal||!t.context||t.context.type===At.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const a=this.currentTrack;if(a&&fr(e,a,or))return a;const l=vn(e,this.tracksInGroup,or);if(l>-1){const c=this.tracksInGroup[l];return this.setAudioTrack(l),c}else if(a){let c=t.loadLevel;c===-1&&(c=t.firstAutoLevel);const u=nk(e,t.levels,s,c,or);if(u===-1)return null;t.nextLoadLevel=u}if(e.channels||e.audioCodec){const c=vn(e,s);if(c>-1)return s[c]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,a=t[e],l=a.details&&!a.details.live;if(e===this.trackId&&a===s&&l||(this.log(`Switching to audio-track ${e} "${a.name}" lang:${a.lang} group:${a.groupId} channels:${a.channels}`),this.trackId=e,this.currentTrack=a,this.hls.trigger(B.AUDIO_TRACK_SWITCHING,Kt({},a)),l))return;const c=this.switchParams(a.url,s?.details,a.details);this.loadPlaylist(c)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const a=t[s];if(!(this.selectDefaultTrack&&!a.default)&&(!e||fr(e,a,or)))return s}if(e){const{name:s,lang:a,assocLang:l,characteristics:c,audioCodec:u,channels:f}=e;for(let d=0;d<t.length;d++){const m=t[d];if(fr({name:s,lang:a,assocLang:l,characteristics:c,audioCodec:u,channels:f},m,or))return d}for(let d=0;d<t.length;d++){const m=t[d];if(ql(e.attrs,m.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return d}for(let d=0;d<t.length;d++){const m=t[d];if(ql(e.attrs,m.attrs,["LANGUAGE"]))return d}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&sd(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,a=e.groupId,l=this.getUrlWithDirectives(e.url,t),c=e.details,u=c?.age;this.log(`Loading audio-track ${s} "${e.name}" lang:${e.lang} group:${a}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&c.live?" age "+u.toFixed(1)+(c.type&&" "+c.type||""):""} ${l}`),this.hls.trigger(B.AUDIO_TRACK_LOADING,{url:l,id:s,groupId:a,deliveryDirectives:t||null,track:e})}}class qM{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(this.queues===null||this.tracks===null)return;const a=this.queues[t];a.push(e),a.length===1&&!s&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const s=(t=e[0])==null?void 0:t.label;(s==="async-blocker"||s==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const a=t[0];try{a.execute()}catch(l){var s;if(a.onError(l),this.queues===null||this.tracks===null)return;const c=(s=this.tracks[e])==null?void 0:s.buffer;c!=null&&c.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,s;return(t=this.queues)!=null&&t[e]||(s=this.tracks)!=null&&s[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const s=(t=this.tracks)==null?void 0:t[e],a=s?.buffer;return a?`SourceBuffer${a.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(s=>s.label).join(", "))||""}}const g_=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,lE="HlsJsTrackRemovedError";class YM extends Error{constructor(e){super(e),this.name=lE}}class WM extends Wi{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=s=>{var a;this.hls&&((a=this.mediaSource)==null?void 0:a.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=s=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=s=>{const{media:a,mediaSource:l}=this;s&&this.log("Media source opened"),!(!a||!l)&&(l.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(B.MEDIA_ATTACHED,{media:a,mediaSource:l}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:s,_objectUrl:a}=this;s!==a&&this.error(`Media element src was set while attaching MediaSource (${a} > ${s})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=yI(Ma(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(B.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(B.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(B.MANIFEST_LOADING,this.onManifestLoading,this),e.on(B.MANIFEST_PARSED,this.onManifestParsed,this),e.on(B.BUFFER_RESET,this.onBufferReset,this),e.on(B.BUFFER_APPENDING,this.onBufferAppending,this),e.on(B.BUFFER_CODECS,this.onBufferCodecs,this),e.on(B.BUFFER_EOS,this.onBufferEos,this),e.on(B.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(B.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(B.FRAG_PARSED,this.onFragParsed,this),e.on(B.FRAG_CHANGED,this.onFragChanged,this),e.on(B.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(B.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(B.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(B.MANIFEST_LOADING,this.onManifestLoading,this),e.off(B.MANIFEST_PARSED,this.onManifestParsed,this),e.off(B.BUFFER_RESET,this.onBufferReset,this),e.off(B.BUFFER_APPENDING,this.onBufferAppending,this),e.off(B.BUFFER_CODECS,this.onBufferCodecs,this),e.off(B.BUFFER_EOS,this.onBufferEos,this),e.off(B.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(B.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(B.FRAG_PARSED,this.onFragParsed,this),e.off(B.FRAG_CHANGED,this.onFragChanged,this),e.off(B.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const l=this.isUpdating();l||this.operationQueue.removeBlockers();const c=this.isQueued();(l||c)&&this.warn(`Transfering MediaSource with${c?" operations in queue":""}${l?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const a=this.transferData;return!this.sourceBufferCount&&a&&a.mediaSource===t?Xt(s,a.tracks):this.sourceBuffers.forEach(l=>{const[c]=l;c&&(s[c]=Xt({},this.tracks[c]),this.removeBuffer(c)),l[0]=l[1]=null}),{media:e,mediaSource:t,tracks:s}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let a=2;(t.audio&&!t.video||!t.altAudio)&&(a=1),this.bufferCodecEventsTotal=a,this.log(`${a} bufferCodec event(s) expected.`),(s=this.transferData)!=null&&s.mediaSource&&this.sourceBufferCount&&a&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media;this.transferData=this.overrides=void 0;const a=Ma(this.appendSource);if(a){const l=!!t.mediaSource;(l||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const c=this.mediaSource=t.mediaSource||new a;if(this.assignMediaSource(c),l)this._objectUrl=s.src,this.attachTransferred();else{const u=this._objectUrl=self.URL.createObjectURL(c);if(this.appendSource)try{s.removeAttribute("src");const f=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||f&&c instanceof f,p_(s),XM(s,u),s.load()}catch{s.src=u}else s.src=u}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(s=e.constructor)==null?void 0:s.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,a=t.tracks,l=a?Object.keys(a):null,c=l?l.length:0,u=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(a&&l&&c){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Jt(s,(f,d)=>f==="initSegment"?void 0:d)};
transfer tracks: ${Jt(a,(f,d)=>f==="initSegment"?void 0:d)}}`),!nS(a,s)){t.mediaSource=null,t.tracks=void 0;const f=e.currentTime,d=this.details,m=Math.max(f,d?.fragments[0].start||0);if(m-f>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${f} -> ${m}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(a)}"->"${Object.keys(s)}") start time: ${m} currentTime: ${f}`),this.onMediaDetaching(B.MEDIA_DETACHING,{}),this.onMediaAttaching(B.MEDIA_ATTACHING,t),e.currentTime=m;return}this.transferData=void 0,l.forEach(f=>{const d=f,m=a[d];if(m){const g=m.buffer;if(g){const y=this.fragmentTracker,x=m.id;if(y.hasFragments(x)||y.hasParts(x)){const A=pt.getBuffered(g);y.detectEvictedFragments(d,A,x,null,!0)}const v=Xf(d),E=[d,g];this.sourceBuffers[v]=E,g.updating&&this.operationQueue&&this.operationQueue.prependBlocker(d),this.trackSourceBuffer(d,m)}}}),u(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),u()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:a,mediaSource:l,_objectUrl:c}=this;if(l){if(this.log(`media source ${s?"transferring":"detaching"}`),s)this.sourceBuffers.forEach(([u])=>{u&&this.removeBuffer(u)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const u=l.readyState==="open";try{const f=l.sourceBuffers;for(let d=f.length;d--;)u&&f[d].abort(),l.removeSourceBuffer(f[d]);u&&l.endOfStream()}catch(f){this.warn(`onMediaDetaching: ${f.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}l.removeEventListener("sourceopen",this._onMediaSourceOpen),l.removeEventListener("sourceended",this._onMediaSourceEnded),l.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(l.removeEventListener("startstreaming",this._onStartStreaming),l.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}a&&(a.removeEventListener("emptied",this._onMediaEmptied),s||(c&&self.URL.revokeObjectURL(c),this.mediaSrc===c?(a.removeAttribute("src"),this.appendSource&&p_(a),a.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(B.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const s=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),s)try{var a;(a=this.mediaSource)!=null&&a.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(l){this.warn(`onBufferReset ${e}`,l)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Xf(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new qM(this.tracks)}onBufferCodecs(e,t){var s;const a=this.tracks,l=Object.keys(t);this.log(`BUFFER_CODECS: "${l}" (current SB count ${this.sourceBufferCount})`);const c="audiovideo"in t&&(a.audio||a.video)||a.audiovideo&&("audio"in t||"video"in t),u=!c&&this.sourceBufferCount&&this.media&&l.some(f=>!a[f]);if(c||u){this.warn(`Unsupported transition between "${Object.keys(a)}" and "${l}" SourceBuffers`);return}l.forEach(f=>{var d,m;const g=t[f],{id:y,codec:x,levelCodec:v,container:E,metadata:A,supplemental:R}=g;let D=a[f];const L=(d=this.transferData)==null||(d=d.tracks)==null?void 0:d[f],O=L!=null&&L.buffer?L:D,H=O?.pendingCodec||O?.codec,q=O?.levelCodec;D||(D=a[f]={buffer:void 0,listeners:[],codec:x,supplemental:R,container:E,levelCodec:v,metadata:A,id:y});const U=Fu(H,q),k=U?.replace(g_,"$1");let M=Fu(x,v);const I=(m=M)==null?void 0:m.replace(g_,"$1");M&&U&&k!==I&&(f.slice(0,5)==="audio"&&(M=ed(M,this.appendSource)),this.log(`switching codec ${H} to ${M}`),M!==(D.pendingCodec||D.codec)&&(D.pendingCodec=M),D.container=E,this.appendChangeType(f,E,M))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((s=t.audio)==null?void 0:s.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e},{})}appendChangeType(e,t,s){const a=`${t};codecs=${s}`,l={label:`change-type=${a}`,execute:()=>{const c=this.tracks[e];if(c){const u=c.buffer;u!=null&&u.changeType&&(this.log(`changing ${e} sourceBuffer type to ${a}`),u.changeType(a),c.codec=s,c.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:c=>{this.warn(`Failed to change ${e} SourceBuffer type`,c)}};this.append(l,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,a=s+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(s,Xe.MAIN))==null?void 0:t.gap)===!0)return;const c={label:"block-audio",execute:()=>{var u;const f=this.tracks.video;(this.lastVideoAppendEnd>a||f!=null&&f.buffer&&pt.isBuffered(f.buffer,a)||((u=this.fragmentTracker.getAppendedFrag(a,Xe.MAIN))==null?void 0:u.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:u=>{this.warn("Error executing block-audio operation",u)}};this.blockedAudioAppend={op:c,frag:e},this.append(c,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:a,type:l,parent:c,frag:u,part:f,chunkMeta:d,offset:m}=t,g=d.buffering[l],{sn:y,cc:x}=u,v=self.performance.now();g.start=v;const E=u.stats.buffering,A=f?f.stats.buffering:null;E.start===0&&(E.start=v),A&&A.start===0&&(A.start=v);const R=s.audio;let D=!1;l==="audio"&&R?.container==="audio/mpeg"&&(D=!this.lastMpegAudioChunk||d.id===1||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);const L=s.video,O=L?.buffer;if(O&&y!=="initSegment"){const U=f||u,k=this.blockedAudioAppend;if(l==="audio"&&c!=="main"&&!this.blockedAudioAppend&&!(L.ending||L.ended)){const I=U.start+U.duration*.05,j=O.buffered,Z=this.currentOp("video");!j.length&&!Z?this.blockAudio(U):!Z&&!pt.isBuffered(O,I)&&this.lastVideoAppendEnd<I&&this.blockAudio(U)}else if(l==="video"){const M=U.end;if(k){const I=k.frag.start;(M>I||M<this.lastVideoAppendEnd||pt.isBuffered(O,I))&&this.unblockAudio()}this.lastVideoAppendEnd=M}}const H=(f||u).start,q={label:`append-${l}`,execute:()=>{var U;g.executeStart=self.performance.now();const k=(U=this.tracks[l])==null?void 0:U.buffer;k&&(D?this.updateTimestampOffset(k,H,.1,l,y,x):m!==void 0&&We(m)&&this.updateTimestampOffset(k,m,1e-6,l,y,x)),this.appendExecutor(a,l)},onStart:()=>{},onComplete:()=>{const U=self.performance.now();g.executeEnd=g.end=U,E.first===0&&(E.first=U),A&&A.first===0&&(A.first=U);const k={};this.sourceBuffers.forEach(([M,I])=>{M&&(k[M]=pt.getBuffered(I))}),this.appendErrors[l]=0,l==="audio"||l==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(B.BUFFER_APPENDED,{type:l,frag:u,part:f,chunkMeta:d,parent:u.type,timeRanges:k})},onError:U=>{var k;const M={type:et.MEDIA_ERROR,parent:u.type,details:be.BUFFER_APPEND_ERROR,sourceBufferName:l,frag:u,part:f,chunkMeta:d,error:U,err:U,fatal:!1},I=(k=this.media)==null?void 0:k.error;if(U.code===DOMException.QUOTA_EXCEEDED_ERR||U.name=="QuotaExceededError"||"quota"in U)M.details=be.BUFFER_FULL_ERROR;else if(U.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!I)M.errorAction=_o(!0);else if(U.name===lE&&this.sourceBufferCount===0)M.errorAction=_o(!0);else{const j=++this.appendErrors[l];this.warn(`Failed ${j}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${l}" sourceBuffer (${I||"no media error"})`),(j>=this.hls.config.appendErrorMaxRetry||I)&&(M.fatal=!0)}this.hls.trigger(B.ERROR,M)}};this.log(`queuing "${l}" append sn: ${y}${f?" p: "+f.index:""} of ${u.type===Xe.MAIN?"level":"track"} ${u.level} cc: ${x}`),this.append(q,l,this.isPending(this.tracks[l]))}getFlushOp(e,t,s){return this.log(`queuing "${e}" remove ${t}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(B.BUFFER_FLUSHED,{type:e})},onError:a=>{this.warn(`Failed to remove ${t}-${s} from "${e}" SourceBuffer`,a)}}}onBufferFlushing(e,t){const{type:s,startOffset:a,endOffset:l}=t;s?this.append(this.getFlushOp(s,a,l),s):this.sourceBuffers.forEach(([c])=>{c&&this.append(this.getFlushOp(c,a,l),c)})}onFragParsed(e,t){const{frag:s,part:a}=t,l=[],c=a?a.elementaryStreams:s.elementaryStreams;c[Zt.AUDIOVIDEO]?l.push("audiovideo"):(c[Zt.AUDIO]&&l.push("audio"),c[Zt.VIDEO]&&l.push("video"));const u=()=>{const f=self.performance.now();s.stats.buffering.end=f,a&&(a.stats.buffering.end=f);const d=a?a.stats:s.stats;this.hls.trigger(B.FRAG_BUFFERED,{frag:s,part:a,stats:d,id:s.type})};l.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers(u,l).catch(f=>{this.warn(`Fragment buffered callback ${f}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var s;this.sourceBuffers.forEach(([c])=>{if(c){const u=this.tracks[c];(!t.type||t.type===c)&&(u.ending=!0,u.ended||(u.ended=!0,this.log(`${c} buffer reached EOS`)))}});const a=((s=this.overrides)==null?void 0:s.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([c])=>{var u;return c&&!((u=this.tracks[c])!=null&&u.ended)})?a?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:c}=this;if(!c||c.readyState!=="open"){c&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${c.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),c.endOfStream(),this.hls.trigger(B.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(B.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===be.BUFFER_APPEND_ERROR&&t.frag){var s;const a=(s=t.errorAction)==null?void 0:s.nextAutoLevel;We(a)&&a!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||t===null||!this.sourceBufferCount)return;const a=e.config,l=s.currentTime,c=t.levelTargetDuration,u=t.live&&a.liveBackBufferLength!==null?a.liveBackBufferLength:a.backBufferLength;if(We(u)&&u>=0){const d=Math.max(u,c),m=Math.floor(l/c)*c-d;this.flushBackBuffer(l,c,m)}const f=a.frontBufferFlushThreshold;if(We(f)&&f>0){const d=Math.max(a.maxBufferLength,f),m=Math.max(d,c),g=Math.floor(l/c)*c+m;this.flushFrontBuffer(l,c,g)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach(([a,l])=>{if(l){const u=pt.getBuffered(l);if(u.length>0&&s>u.start(0)){var c;this.hls.trigger(B.BACK_BUFFER_REACHED,{bufferEnd:s});const f=this.tracks[a];if((c=this.details)!=null&&c.live)this.hls.trigger(B.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(f!=null&&f.ended){this.log(`Cannot flush ${a} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(B.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:a})}}})}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach(([a,l])=>{if(l){const c=pt.getBuffered(l),u=c.length;if(u<2)return;const f=c.start(u-1),d=c.end(u-1);if(s>f||e>=f&&e<=d)return;this.hls.trigger(B.BUFFER_FLUSHING,{startOffset:f,endOffset:1/0,type:a})}})}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||s?.readyState!=="open")return null;const a=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&s.setLiveSeekableRange){const d=Math.max(0,t.fragmentStart),m=Math.max(d,a);return{duration:1/0,start:d,end:m}}return{duration:1/0}}const l=(e=this.overrides)==null?void 0:e.duration;if(l)return We(l)?{duration:l}:null;const c=this.media.duration,u=We(s.duration)?s.duration:0;return a>u&&a>c||!We(c)?{duration:a}:null}updateMediaSource({duration:e,start:t,end:s}){const a=this.mediaSource;!this.media||!a||a.readyState!=="open"||(a.duration!==e&&(We(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),a.duration=e),t!==void 0&&s!==void 0&&(this.log(`MediaSource duration is set to ${a.duration}. Setting seekable range to ${t}-${s}.`),a.setLiveSeekableRange(t,s)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Jt(s)}`),this.tracksReady){var a;const l=(a=this.transferData)==null?void 0:a.tracks;l&&Object.keys(l).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,s])=>{if(t){const a=this.tracks[t];e[t]={buffer:s,container:a.container,codec:a.codec,supplemental:a.supplemental,levelCodec:a.levelCodec,id:a.id,metadata:a.metadata}}}),this.hls.trigger(B.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(B.ERROR,{type:et.MEDIA_ERROR,details:be.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const l in e){const c=l,u=e[c];if(this.isPending(u)){const f=this.getTrackCodec(u,c),d=`${u.container};codecs=${f}`;u.codec=f,this.log(`creating sourceBuffer(${d})${this.currentOp(c)?" Queued":""} ${Jt(u)}`);try{const m=s.addSourceBuffer(d),g=Xf(c),y=[c,m];t[g]=y,u.buffer=m}catch(m){var a;this.error(`error while trying to add sourceBuffer: ${m.message}`),this.shiftAndExecuteNext(c),(a=this.operationQueue)==null||a.removeBlockers(),delete this.tracks[c],this.hls.trigger(B.ERROR,{type:et.MEDIA_ERROR,details:be.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:m,sourceBufferName:c,mimeType:d,parent:u.id});return}this.trackSourceBuffer(c,u)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let a=e.codec;s&&(t==="video"||t==="audiovideo")&&Gl(s,"video")&&(a=UI(a,s));const l=Fu(a,e.levelCodec);return l?t.slice(0,5)==="audio"?ed(l,this.appendSource):l:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const a=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:a,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(l,c)=>{const u=c.removedRanges;u!=null&&u.length&&this.hls.trigger(B.BUFFER_FLUSHED,{type:l})})}get mediaSrc(){var e,t;const s=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return s?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const a=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(s=this.mediaSource)==null?void 0:s.readyState}`);this.error(`${a}`,t),this.hls.trigger(B.ERROR,{type:et.MEDIA_ERROR,details:be.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:a,fatal:!1});const l=this.currentOp(e);l&&l.onError(a)}updateTimestampOffset(e,t,s,a,l,c){const u=t-e.timestampOffset;Math.abs(u)>=s&&(this.log(`Updating ${a} SourceBuffer timestampOffset to ${t} (sn: ${l} cc: ${c})`),e.timestampOffset=t)}removeExecutor(e,t,s){const{media:a,mediaSource:l}=this,c=this.tracks[e],u=c?.buffer;if(!a||!l||!u){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const f=We(a.duration)?a.duration:1/0,d=We(l.duration)?l.duration:1/0,m=Math.max(0,t),g=Math.min(s,f,d);g>m&&(!c.ending||c.ended)?(c.ended=!1,this.log(`Removing [${m},${g}] from the ${e} SourceBuffer`),u.remove(m,g)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],a=s?.buffer;if(!a)throw new YM(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,a.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,a=t.map(c=>this.appendBlocker(c));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(a).then(c=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var s;const a=(s=this.tracks[t])==null?void 0:s.buffer;!a||a.updating||this.shiftAndExecuteNext(t)})}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,s){const a=this.tracks[e];if(!a)return;const l=a.buffer;if(!l)return;const c=s.bind(this,e);a.listeners.push({event:t,listener:c}),l.addEventListener(t,c)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach(a=>{s.removeEventListener(a.event,a.listener)}),t.listeners.length=0)}}function p_(i){const e=i.querySelectorAll("source");[].slice.call(e).forEach(t=>{i.removeChild(t)})}function XM(i,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,i.appendChild(t)}function Xf(i){return i==="audio"?1:0}class Fg{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(B.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(B.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(B.MANIFEST_PARSED,this.onManifestParsed,this),e.on(B.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(B.BUFFER_CODECS,this.onBufferCodecs,this),e.on(B.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(B.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(B.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(B.MANIFEST_PARSED,this.onManifestParsed,this),e.off(B.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(B.BUFFER_CODECS,this.onBufferCodecs,this),e.off(B.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&We(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter((a,l)=>this.isLevelAllowed(a)&&l<=e);return this.clientRect=null,Fg.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,!t.width&&!t.height&&(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(s=>e.bitrate===s.bitrate&&e.width===s.width&&e.height===s.height)}static getMaxLevelByMediaSize(e,t,s){if(!(e!=null&&e.length))return-1;const a=(u,f)=>f?u.width!==f.width||u.height!==f.height:!0;let l=e.length-1;const c=Math.max(t,s);for(let u=0;u<e.length;u+=1){const f=e[u];if((f.width>=c||f.height>=c)&&a(f,e[u+1])){l=u;break}}return l}}const QM={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},ui=QM,ZM={HLS:"h"},JM=ZM;class En{constructor(e,t){Array.isArray(e)&&(e=e.map(s=>s instanceof En?s:new En(s))),this.value=e,this.params=t}}const ej="Dict";function tj(i){return Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":typeof i=="object"?JSON.stringify(i):String(i)}function sj(i,e,t,s){return new Error(`failed to ${i} "${tj(e)}" as ${t}`,{cause:s})}function Tn(i,e,t){return sj("serialize",i,e,t)}class cE{constructor(e){this.description=e}}const y_="Bare Item",ij="Boolean";function nj(i){if(typeof i!="boolean")throw Tn(i,ij);return i?"?1":"?0"}function aj(i){return btoa(String.fromCharCode(...i))}const rj="Byte Sequence";function oj(i){if(ArrayBuffer.isView(i)===!1)throw Tn(i,rj);return`:${aj(i)}:`}const lj="Integer";function cj(i){return i<-999999999999999||999999999999999<i}function uE(i){if(cj(i))throw Tn(i,lj);return i.toString()}function uj(i){return`@${uE(i.getTime()/1e3)}`}function dE(i,e){if(i<0)return-dE(-i,e);const t=Math.pow(10,e);if(Math.abs(i*t%1-.5)<Number.EPSILON){const a=Math.floor(i*t);return(a%2===0?a:a+1)/t}else return Math.round(i*t)/t}const dj="Decimal";function hj(i){const e=dE(i,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Tn(i,dj);const t=e.toString();return t.includes(".")?t:`${t}.0`}const fj="String",mj=/[\x00-\x1f\x7f]+/;function gj(i){if(mj.test(i))throw Tn(i,fj);return`"${i.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function pj(i){return i.description||i.toString().slice(7,-1)}const yj="Token";function x_(i){const e=pj(i);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Tn(e,yj);return e}function Om(i){switch(typeof i){case"number":if(!We(i))throw Tn(i,y_);return Number.isInteger(i)?uE(i):hj(i);case"string":return gj(i);case"symbol":return x_(i);case"boolean":return nj(i);case"object":if(i instanceof Date)return uj(i);if(i instanceof Uint8Array)return oj(i);if(i instanceof cE)return x_(i);default:throw Tn(i,y_)}}const xj="Key";function Pm(i){if(/^[a-z*][a-z0-9\-_.*]*$/.test(i)===!1)throw Tn(i,xj);return i}function Gg(i){return i==null?"":Object.entries(i).map(([e,t])=>t===!0?`;${Pm(e)}`:`;${Pm(e)}=${Om(t)}`).join("")}function hE(i){return i instanceof En?`${Om(i.value)}${Gg(i.params)}`:Om(i)}function vj(i){return`(${i.value.map(hE).join(" ")})${Gg(i.params)}`}function _j(i,e={whitespace:!0}){if(typeof i!="object"||i==null)throw Tn(i,ej);const t=i instanceof Map?i.entries():Object.entries(i),s=e?.whitespace?" ":"";return Array.from(t).map(([a,l])=>{l instanceof En||(l=new En(l));let c=Pm(a);return l.value===!0?c+=Gg(l.params):(c+="=",Array.isArray(l.value)?c+=vj(l):c+=hE(l)),c}).join(`,${s}`)}function fE(i,e){return _j(i,e)}const pn="CMCD-Object",gs="CMCD-Request",nr="CMCD-Session",wa="CMCD-Status",bj={br:pn,ab:pn,d:pn,ot:pn,tb:pn,tpb:pn,lb:pn,tab:pn,lab:pn,url:pn,pb:gs,bl:gs,tbl:gs,dl:gs,ltc:gs,mtp:gs,nor:gs,nrr:gs,rc:gs,sn:gs,sta:gs,su:gs,ttfb:gs,ttfbb:gs,ttlb:gs,cmsdd:gs,cmsds:gs,smrt:gs,df:gs,cs:gs,ts:gs,cid:nr,pr:nr,sf:nr,sid:nr,st:nr,v:nr,msd:nr,bs:wa,bsd:wa,cdn:wa,rtp:wa,bg:wa,pt:wa,ec:wa,e:wa},Sj={REQUEST:gs};function Ej(i){return Object.keys(i).reduce((e,t)=>{var s;return(s=i[t])===null||s===void 0||s.forEach(a=>e[a]=t),e},{})}function Tj(i,e){const t={};if(!i)return t;const s=Object.keys(i),a=e?Ej(e):{};return s.reduce((l,c)=>{var u;const f=bj[c]||a[c]||Sj.REQUEST,d=(u=l[f])!==null&&u!==void 0?u:l[f]={};return d[c]=i[c],l},t)}function Aj(i){return["ot","sf","st","e","sta"].includes(i)}function wj(i){return typeof i=="number"?We(i):i!=null&&i!==""&&i!==!1}const mE="event";function Nj(i,e){const t=new URL(i),s=new URL(e);if(t.origin!==s.origin)return i;const a=t.pathname.split("/").slice(1),l=s.pathname.split("/").slice(1,-1);for(;a[0]===l[0];)a.shift(),l.shift();for(;l.length;)l.shift(),a.unshift("..");return a.join("/")+t.search+t.hash}const Ku=i=>Math.round(i),Bm=(i,e)=>Array.isArray(i)?i.map(t=>Bm(t,e)):i instanceof En&&typeof i.value=="string"?new En(Bm(i.value,e),i.params):(e.baseUrl&&(i=Nj(i,e.baseUrl)),e.version===1?encodeURIComponent(i):i),Tu=i=>Ku(i/100)*100,Rj=(i,e)=>{let t=i;return e.version>=2&&(i instanceof En&&typeof i.value=="string"?t=new En([i]):typeof i=="string"&&(t=[i])),Bm(t,e)},Cj={br:Ku,d:Ku,bl:Tu,dl:Tu,mtp:Tu,nor:Rj,rtp:Tu,tb:Ku},gE="request",pE="response",$g=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],Lj=["e"],Dj=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Sd(i){return Dj.test(i)}function Ij(i){return $g.includes(i)||Lj.includes(i)||Sd(i)}const yE=["d","dl","nor","ot","rtp","su"];function kj(i){return $g.includes(i)||yE.includes(i)||Sd(i)}const Mj=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function jj(i){return $g.includes(i)||yE.includes(i)||Mj.includes(i)||Sd(i)}const Oj=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function Pj(i){return Oj.includes(i)||Sd(i)}const Bj={[pE]:jj,[mE]:Ij,[gE]:kj};function xE(i,e={}){const t={};if(i==null||typeof i!="object")return t;const s=e.version||i.v||1,a=e.reportingMode||gE,l=s===1?Pj:Bj[a];let c=Object.keys(i).filter(l);const u=e.filter;typeof u=="function"&&(c=c.filter(u));const f=a===pE||a===mE;f&&!c.includes("ts")&&c.push("ts"),s>1&&!c.includes("v")&&c.push("v");const d=Xt({},Cj,e.formatters),m={version:s,reportingMode:a,baseUrl:e.baseUrl};return c.sort().forEach(g=>{let y=i[g];const x=d[g];if(typeof x=="function"&&(y=x(y,m)),g==="v"){if(s===1)return;y=s}g=="pr"&&y===1||(f&&g==="ts"&&!We(y)&&(y=Date.now()),wj(y)&&(Aj(g)&&typeof y=="string"&&(y=new cE(y)),t[g]=y))}),t}function Uj(i,e={}){const t={};if(!i)return t;const s=xE(i,e),a=Tj(s,e?.customHeaderMap);return Object.entries(a).reduce((l,[c,u])=>{const f=fE(u,{whitespace:!1});return f&&(l[c]=f),l},t)}function Fj(i,e,t){return Xt(i,Uj(e,t))}const Gj="CMCD";function $j(i,e={}){return i?fE(xE(i,e),{whitespace:!1}):""}function Vj(i,e={}){if(!i)return"";const t=$j(i,e);return encodeURIComponent(t)}function Hj(i,e={}){if(!i)return"";const t=Vj(i,e);return`${Gj}=${t}`}const v_=/CMCD=[^&#]+/;function Kj(i,e,t){const s=Hj(e,t);if(!s)return i;if(v_.test(i))return i.replace(v_,s);const a=i.includes("?")?"&":"?";return`${i}${a}${s}`}class zj{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=a=>{try{this.apply(a,{ot:ui.MANIFEST,su:!this.initialized})}catch(l){this.hls.logger.warn("Could not generate manifest CMCD data.",l)}},this.applyFragmentData=a=>{try{const{frag:l,part:c}=a,u=this.hls.levels[l.level],f=this.getObjectType(l),d={d:(c||l).duration*1e3,ot:f};(f===ui.VIDEO||f===ui.AUDIO||f==ui.MUXED)&&(d.br=u.bitrate/1e3,d.tb=this.getTopBandwidth(f)/1e3,d.bl=this.getBufferLength(f));const m=c?this.getNextPart(c):this.getNextFrag(l);m!=null&&m.url&&m.url!==l.url&&(d.nor=m.url),this.apply(a,d)}catch(l){this.hls.logger.warn("Could not generate segment CMCD data.",l)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;s!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=s.useHeaders===!0,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(B.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(B.MEDIA_DETACHED,this.onMediaDetached,this),e.on(B.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(B.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(B.MEDIA_DETACHED,this.onMediaDetached,this),e.off(B.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,a;this.audioBuffer=(s=t.tracks.audio)==null?void 0:s.buffer,this.videoBuffer=(a=t.tracks.video)==null?void 0:a.buffer}createData(){var e;return{v:1,sf:JM.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Xt(t,this.createData());const s=t.ot===ui.INIT||t.ot===ui.VIDEO||t.ot===ui.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:a}=this;a&&(t=Object.keys(t).reduce((c,u)=>(a.includes(u)&&(c[u]=t[u]),c),{}));const l={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),Fj(e.headers,t,l)):e.url=Kj(e.url,t,l)}getNextFrag(e){var t;const s=(t=this.hls.levels[e.level])==null?void 0:t.details;if(s){const a=e.sn-s.startSN;return s.fragments[a+1]}}getNextPart(e){var t;const{index:s,fragment:a}=e,l=(t=this.hls.levels[a.level])==null||(t=t.details)==null?void 0:t.partList;if(l){const{sn:c}=a;for(let u=l.length-1;u>=0;u--){const f=l[u];if(f.index===s&&f.fragment.sn===c)return l[u+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return ui.TIMED_TEXT;if(e.sn==="initSegment")return ui.INIT;if(t==="audio")return ui.AUDIO;if(t==="main")return this.hls.audioTracks.length?ui.VIDEO:ui.MUXED}getTopBandwidth(e){let t=0,s;const a=this.hls;if(e===ui.AUDIO)s=a.audioTracks;else{const l=a.maxAutoLevel,c=l>-1?l+1:a.levels.length;s=a.levels.slice(0,c)}return s.forEach(l=>{l.bitrate>t&&(t=l.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,s=e===ui.AUDIO?this.audioBuffer:this.videoBuffer;return!s||!t?NaN:pt.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(l){this.loader=void 0,this.loader=new s(l)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(l,c,u){t(l),this.loader.load(l,c,u)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(l){this.loader=void 0,this.loader=new s(l)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(l,c,u){t(l),this.loader.load(l,c,u)}}}}const qj=3e5;class Yj extends Wi{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(B.MANIFEST_LOADING,this.onManifestLoading,this),e.on(B.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(B.MANIFEST_PARSED,this.onManifestParsed,this),e.on(B.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(B.MANIFEST_LOADING,this.onManifestLoading,this),e.off(B.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(B.MANIFEST_PARSED,this.onManifestParsed,this),e.off(B.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(s=>s!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;s!==null&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if(s?.action===Vs.SendAlternateToPenaltyBox&&s.flags===Ai.MoveAllAlternatesMatchingHost){const a=this.levels;let l=this._pathwayPriority,c=this.pathwayId;if(t.context){const{groupId:u,pathwayId:f,type:d}=t.context;u&&a?c=this.getPathwayForGroupId(u,d,c):f&&(c=f)}c in this.penalizedPathways||(this.penalizedPathways[c]=performance.now()),!l&&a&&(l=this.pathways()),l&&l.length>1&&(this.updatePathwayPriority(l),s.resolved=this.pathwayId!==c),t.details===be.BUFFER_APPEND_ERROR&&!t.fatal?s.resolved=!0:s.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${c} levels: ${a&&a.length} priorities: ${Jt(l)} penalized: ${Jt(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const s=this.penalizedPathways,a=performance.now();Object.keys(s).forEach(l=>{a-s[l]>qj&&delete s[l]});for(let l=0;l<e.length;l++){const c=e[l];if(c in s)continue;if(c===this.pathwayId)return;const u=this.hls.nextLoadLevel,f=this.hls.levels[u];if(t=this.getLevelsForPathway(c),t.length>0){this.log(`Setting Pathway to "${c}"`),this.pathwayId=c,BS(t),this.hls.trigger(B.LEVELS_UPDATED,{levels:t});const d=this.hls.levels[u];f&&d&&this.levels&&(d.attrs["STABLE-VARIANT-ID"]!==f.attrs["STABLE-VARIANT-ID"]&&d.bitrate!==f.bitrate&&this.log(`Unstable Pathways change from bitrate ${f.bitrate} to ${d.bitrate}`),this.hls.nextLoadLevel=u);break}}}getPathwayForGroupId(e,t,s){const a=this.getLevelsForPathway(s).concat(this.levels||[]);for(let l=0;l<a.length;l++)if(t===At.AUDIO_TRACK&&a[l].hasAudioGroup(e)||t===At.SUBTITLE_TRACK&&a[l].hasSubtitleGroup(e))return a[l].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},a={};e.forEach(l=>{const{ID:c,"BASE-ID":u,"URI-REPLACEMENT":f}=l;if(t.some(m=>m.pathwayId===c))return;const d=this.getLevelsForPathway(u).map(m=>{const g=new cs(m.attrs);g["PATHWAY-ID"]=c;const y=g.AUDIO&&`${g.AUDIO}_clone_${c}`,x=g.SUBTITLES&&`${g.SUBTITLES}_clone_${c}`;y&&(s[g.AUDIO]=y,g.AUDIO=y),x&&(a[g.SUBTITLES]=x,g.SUBTITLES=x);const v=vE(m.uri,g["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",f),E=new Vl({attrs:g,audioCodec:m.audioCodec,bitrate:m.bitrate,height:m.height,name:m.name,url:v,videoCodec:m.videoCodec,width:m.width});if(m.audioGroups)for(let A=1;A<m.audioGroups.length;A++)E.addGroupId("audio",`${m.audioGroups[A]}_clone_${c}`);if(m.subtitleGroups)for(let A=1;A<m.subtitleGroups.length;A++)E.addGroupId("text",`${m.subtitleGroups[A]}_clone_${c}`);return E});t.push(...d),__(this.audioTracks,s,f,c),__(this.subtitleTracks,a,f,c)})}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;this.loader&&this.loader.destroy(),this.loader=new s(t);let a;try{a=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(a.protocol!=="data:"){const m=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;a.searchParams.set("_HLS_pathway",this.pathwayId),a.searchParams.set("_HLS_throughput",""+m)}const l={responseType:"json",url:a.href},c=t.steeringManifestLoadPolicy.default,u=c.errorRetry||c.timeoutRetry||{},f={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:u.maxNumRetry||0,retryDelay:u.retryDelayMs||0,maxRetryDelay:u.maxRetryDelayMs||0},d={onSuccess:(m,g,y,x)=>{this.log(`Loaded steering manifest: "${a}"`);const v=m.data;if(v?.VERSION!==1){this.log(`Steering VERSION ${v.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=v.TTL;const{"RELOAD-URI":E,"PATHWAY-CLONES":A,"PATHWAY-PRIORITY":R}=v;if(E)try{this.uri=new self.URL(E,a).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${E}`);return}this.scheduleRefresh(this.uri||y.url),A&&this.clonePathways(A);const D={steeringManifest:v,url:a.toString()};this.hls.trigger(B.STEERING_MANIFEST_LOADED,D),R&&this.updatePathwayPriority(R)},onError:(m,g,y,x)=>{if(this.log(`Error loading steering manifest: ${m.code} ${m.text} (${g.url})`),this.stopLoad(),m.code===410){this.enabled=!1,this.log(`Steering manifest ${g.url} no longer available`);return}let v=this.timeToLoad*1e3;if(m.code===429){const E=this.loader;if(typeof E?.getResponseHeader=="function"){const A=E.getResponseHeader("Retry-After");A&&(v=parseFloat(A)*1e3)}this.log(`Steering manifest ${g.url} rate limited`);return}this.scheduleRefresh(this.uri||g.url,v)},onTimeout:(m,g,y)=>{this.log(`Timeout loading steering manifest (${g.url})`),this.scheduleRefresh(this.uri||g.url)}};this.log(`Requesting steering manifest: ${a}`),this.loader.load(l,f,d)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var s;const a=(s=this.hls)==null?void 0:s.media;if(a&&!a.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function __(i,e,t,s){i&&Object.keys(e).forEach(a=>{const l=i.filter(c=>c.groupId===a).map(c=>{const u=Xt({},c);return u.details=void 0,u.attrs=new cs(u.attrs),u.url=u.attrs.URI=vE(c.url,c.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),u.groupId=u.attrs["GROUP-ID"]=e[a],u.attrs["PATHWAY-ID"]=s,u});i.push(...l)})}function vE(i,e,t,s){const{HOST:a,PARAMS:l,[t]:c}=s;let u;e&&(u=c?.[e],u&&(i=u));const f=new self.URL(i);return a&&!u&&(f.host=a),l&&Object.keys(l).sort().forEach(d=>{d&&f.searchParams.set(d,l[d])}),f.href}class So extends Wi{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=So.CDMCleanupPromise?[So.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:s,initData:a}=t,l=`"${t.type}" event: init data type: "${s}"`;if(this.debug(l),a!==null){if(!this.keyFormatPromise){let c=Object.keys(this.keySystemAccessPromises);c.length||(c=Ml(this.config));const u=c.map($f).filter(f=>!!f);this.keyFormatPromise=this.getKeyFormatPromise(u)}this.keyFormatPromise.then(c=>{const u=$u(c);if(s!=="sinf"||u!==us.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${s}" for selected key-system ${u}`);return}let f;try{const x=Ls(new Uint8Array(a)),v=Lg(JSON.parse(x).sinf),E=fS(v);if(!E)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");f=new Uint8Array(E.subarray(8,24))}catch(x){this.warn(`${l} Failed to parse sinf: ${x}`);return}const d=Hs(f),{keyIdToKeySessionPromise:m,mediaKeySessions:g}=this;let y=m[d];for(let x=0;x<g.length;x++){const v=g[x],E=v.decryptdata;if(!E.keyId)continue;const A=Hs(E.keyId);if(ad(f,E.keyId)||E.uri.replace(/-/g,"").indexOf(d)!==-1){if(y=m[A],!y)continue;if(E.pssh)break;delete m[A],E.pssh=new Uint8Array(a),E.keyId=f,y=m[d]=y.then(()=>this.generateRequestWithPreferredKeySession(v,s,a,"encrypted-event-key-match")),y.catch(R=>this.handleError(R));break}}y||this.handleError(new Error(`Key ID ${d} not encountered in playlist. Key-system sessions ${g.length}.`))}).catch(c=>this.handleError(c))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(B.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(B.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(B.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(B.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(B.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(B.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(B.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(B.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(B.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(B.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,a=t?.[e];if(a)return a.licenseUrl;if(e===us.WIDEVINE&&s)return s}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=t?.[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,s=(c,u,f)=>!!c&&f.indexOf(c)===u,a=t.map(c=>c.audioCodec).filter(s),l=t.map(c=>c.videoCodec).filter(s);return a.length+l.length===0&&l.push("avc1.42e01e"),new Promise((c,u)=>{const f=d=>{const m=d.shift();this.getMediaKeysPromise(m,a,l).then(g=>c({keySystem:m,mediaKeys:g})).catch(g=>{d.length?f(d):g instanceof Ti?u(g):u(new Ti({type:et.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_NO_ACCESS,error:g,fatal:!0},g.message))})};f(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if(typeof s!="function"){let a=`Configured requestMediaKeySystemAccess is not a function ${s}`;return LS===null&&self.location.protocol==="http:"&&(a=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(a))}return s(e,t)}getMediaKeysPromise(e,t,s){var a;const l=Rk(e,t,s,this.config.drmSystemOptions||{});let c=this.keySystemAccessPromises[e],u=(a=c)==null?void 0:a.keySystemAccess;if(!u){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Jt(l)}`),u=this.requestMediaKeySystemAccess(e,l);const f=c=this.keySystemAccessPromises[e]={keySystemAccess:u};return u.catch(d=>{this.log(`Failed to obtain access to key-system "${e}": ${d}`)}),u.then(d=>{this.log(`Access for key-system "${d.keySystem}" obtained`);const m=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const g=f.mediaKeys=d.createMediaKeys().then(y=>(this.log(`Media-keys created for "${e}"`),f.hasMediaKeys=!0,m.then(x=>x?this.setMediaKeysServerCertificate(y,e,x):y)));return g.catch(y=>{this.error(`Failed to create media-keys for "${e}"}: ${y}`)}),g})}return u.then(()=>c.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:s}){this.log(`Creating key-system session "${t}" keyId: ${Hs(e.keyId||[])} keyUri: ${e.uri}`);const a=s.createSession(),l={decryptdata:e,keySystem:t,mediaKeys:s,mediaKeysSession:a,keyStatus:"status-pending"};return this.mediaKeySessions.push(l),l}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),a=Au(t),l="cenc";this.keyIdToKeySessionPromise[a]=this.generateRequestWithPreferredKeySession(s,l,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyId ${Hs(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),s.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>$f(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:s})=>this.attemptSetMediaKeys(t,s))}selectKeySystem(e){return new Promise((t,s)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:a})=>{const l=$f(a);l?t(l):s(new Error(`Unable to find format for key-system "${a}"`))}).catch(s)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Ml(this.config),s=e.map($u).filter(a=>!!a&&t.indexOf(a)!==-1);return this.selectKeySystem(s)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let s=0;s<t.length;s++){const a=Wj(e,t[s]);if(a)return a}}loadKey(e){const t=e.keyInfo.decryptdata,s=Au(t),a=this.bannedKeyIds[s];if(a||this.getKeyStatus(t)==="internal-error"){const u=b_(a||"internal-error",t);return this.handleError(u,e.frag),Promise.reject(u)}const l=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${l}`);const c=this.keyIdToKeySessionPromise[s];if(!c){const u=this.getKeySystemForKeyPromise(t).then(({keySystem:f,mediaKeys:d})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${l}`),this.attemptSetMediaKeys(f,d).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:f,mediaKeys:d,decryptdata:t}))))).then(f=>{const d="cenc",m=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(f,d,m,"playlist-key")});return u.catch(f=>this.handleError(f,e.frag)),this.keyIdToKeySessionPromise[s]=u,u}return c.catch(u=>{if(u instanceof Ti){const f=Kt({},u.data);this.getKeyStatus(t)==="internal-error"&&(f.decryptdata=t);const d=new Ti(f,u.message);this.handleError(d,e.frag)}}),c}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Ti){t&&(e.data.frag=t);const s=e.data.decryptdata;this.error(`${e.message}${s?` (${Hs(s.keyId||[])})`:""}`),this.hls.trigger(B.ERROR,e.data)}else this.error(e.message),this.hls.trigger(B.ERROR,{type:et.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Au(e),s=this.keyIdToKeySessionPromise[t];if(!s){const a=$u(e.keyFormat),l=a?[a]:Ml(this.config);return this.attemptKeySystemAccess(l)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=Ml(this.config)),e.length===0)throw new Ti({type:et.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Jt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const a=Promise.all(s).then(()=>this.media?this.media.setMediaKeys(t):new Promise((l,c)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return c(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(l).catch(c)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(a),a.then(()=>{this.log(`Media-keys set for "${e}"`),s.push(a),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(l=>s.indexOf(l)===-1)})}generateRequestWithPreferredKeySession(e,t,s,a){var l;const c=(l=this.config.drmSystems)==null||(l=l[e.keySystem])==null?void 0:l.generateRequest;if(c)try{const v=c.call(this.hls,t,s,e);if(!v)throw new Error("Invalid response from configured generateRequest filter");t=v.initDataType,s=v.initData?v.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(v){if(this.warn(v.message),this.hls&&this.hls.config.debug)throw v}if(s===null)return this.log(`Skipping key-session request for "${a}" (no initData)`),Promise.resolve(e);const u=Au(e.decryptdata),f=e.decryptdata.uri;this.log(`Generating key-session request for "${a}" keyId: ${u} URI: ${f} (init data type: ${t} length: ${s.byteLength})`);const d=new Ig,m=e._onmessage=v=>{const E=e.mediaKeysSession;if(!E){d.emit("error",new Error("invalid state"));return}const{messageType:A,message:R}=v;this.log(`"${A}" message event for session "${E.sessionId}" message size: ${R.byteLength}`),A==="license-request"||A==="license-renewal"?this.renewLicense(e,R).catch(D=>{d.eventNames().length?d.emit("error",D):this.handleError(D)}):A==="license-release"?e.keySystem===us.FAIRPLAY&&this.updateKeySession(e,Lm("acknowledged")).then(()=>this.removeSession(e)).catch(D=>this.handleError(D)):this.warn(`unhandled media key message type "${A}"`)},g=(v,E)=>{E.keyStatus=v;let A;v.startsWith("usable")?d.emit("resolved"):v==="internal-error"||v==="output-restricted"||v==="output-downscaled"?A=b_(v,E.decryptdata):v==="expired"?A=new Error(`key expired (keyId: ${u})`):v==="released"?A=new Error("key released"):v==="status-pending"||this.warn(`unhandled key status change "${v}" (keyId: ${u})`),A&&(d.eventNames().length?d.emit("error",A):this.handleError(A))},y=e._onkeystatuseschange=v=>{if(!e.mediaKeysSession){d.emit("error",new Error("invalid state"));return}const A=this.getKeyStatuses(e);if(!Object.keys(A).some(O=>A[O]!=="status-pending"))return;if(A[u]==="expired"){this.log(`Expired key ${Jt(A)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let D=A[u];if(D)g(D,e);else{var L;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(L=e.keyStatusTimeouts)[u]||(L[u]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const H=this.getKeyStatus(e.decryptdata);if(H&&H!=="status-pending")return this.log(`No status for keyId ${u} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${H} from other session.`),g(H,e);this.log(`key status for ${u} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),D="internal-error",g(D,e)},1e3)),this.log(`No status for keyId ${u} (${Jt(A)}).`)}};si(e.mediaKeysSession,"message",m),si(e.mediaKeysSession,"keystatuseschange",y);const x=new Promise((v,E)=>{d.on("error",E),d.on("resolved",v)});return e.mediaKeysSession.generateRequest(t,s).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${u} URI: ${f}`)}).catch(v=>{throw new Ti({type:et.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_NO_SESSION,error:v,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${v}`)}).then(()=>x).catch(v=>(d.removeAllListeners(),this.removeSession(e).then(()=>{throw v}))).then(()=>(d.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((s,a)=>{if(typeof a=="string"&&typeof s=="object"){const u=a;a=s,s=u}const l="buffer"in a?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):new Uint8Array(a);if(e.keySystem===us.PLAYREADY&&l.length===16){const u=Hs(l);t[u]=s,RS(l)}const c=Hs(l);s==="internal-error"&&(this.bannedKeyIds[c]=s),this.log(`key status change "${s}" for keyStatuses keyId: ${c} key-session "${e.mediaKeysSession.sessionId}"`),t[c]=s}),t}fetchServerCertificate(e){const t=this.config,s=t.loader,a=new s(t),l=this.getServerCertificateUrl(e);return l?(this.log(`Fetching server certificate for "${e}"`),new Promise((c,u)=>{const f={responseType:"arraybuffer",url:l},d=t.certLoadPolicy.default,m={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(y,x,v,E)=>{c(y.data)},onError:(y,x,v,E)=>{u(new Ti({type:et.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:Kt({url:f.url,data:void 0},y)},`"${e}" certificate request failed (${l}). Status: ${y.code} (${y.text})`))},onTimeout:(y,x,v)=>{u(new Ti({type:et.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:{url:f.url,data:void 0}},`"${e}" certificate request timed out (${l})`))},onAbort:(y,x,v)=>{u(new Error("aborted"))}};a.load(f,m,g)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise((a,l)=>{e.setServerCertificate(s).then(c=>{this.log(`setServerCertificate ${c?"success":"not supported by CDM"} (${s.byteLength}) on "${t}"`),a(e)}).catch(c=>{l(new Ti({type:et.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:c,fatal:!0},c.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(s=>this.updateKeySession(e,new Uint8Array(s)).catch(a=>{throw new Ti({type:et.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:a,fatal:!1},a.message)}))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const a=new DOMParser().parseFromString(s,"application/xml"),l=a.querySelectorAll("HttpHeader");if(l.length>0){let m;for(let g=0,y=l.length;g<y;g++){var c,u;m=l[g];const x=(c=m.querySelector("name"))==null?void 0:c.textContent,v=(u=m.querySelector("value"))==null?void 0:u.textContent;x&&v&&e.setRequestHeader(x,v)}}const f=a.querySelector("Challenge"),d=f?.textContent;if(!d)throw new Error("Cannot find <Challenge> in key message");return Lm(atob(d))}setupLicenseXHR(e,t,s,a){const l=this.config.licenseXhrSetup;return l?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return l.call(this.hls,e,t,s,a)}).catch(c=>{if(!s.decryptdata)throw c;return e.open("POST",t,!0),l.call(this.hls,e,t,s,a)}).then(c=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:c||a})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:a}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise((a,l)=>{const c=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${c}`);const u=new XMLHttpRequest;u.responseType="arraybuffer",u.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return l(new Error("invalid state"));if(u.readyState===4)if(u.status===200){this._requestLicenseFailureCount=0;let f=u.response;this.log(`License received ${f instanceof ArrayBuffer?f.byteLength:f}`);const d=this.config.licenseResponseCallback;if(d)try{f=d.call(this.hls,u,c,e)}catch(m){this.error(m)}a(f)}else{const f=s.errorRetry,d=f?f.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>d||u.status>=400&&u.status<500)l(new Ti({type:et.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:u,response:{url:c,data:void 0,code:u.status,text:u.statusText}},`License Request XHR failed (${c}). Status: ${u.status} (${u.statusText})`));else{const m=d-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${m} attempts left`),this.requestLicense(e,t).then(a,l)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=u,this.setupLicenseXHR(u,c,e,t).then(({xhr:f,licenseChallenge:d})=>{e.keySystem==us.PLAYREADY&&(d=this.unpackPlayReadyKeyMessage(f,d)),f.send(d)}).catch(l)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,si(s,"encrypted",this.onMediaEncrypted),si(s,"waitingforkey",this.onWaitingForKey);const a=this.mediaResolved;a?a():this.mediaKeys=s.mediaKeys}onMediaDetached(){const e=this.media;e&&(di(e,"encrypted",this.onMediaEncrypted),di(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const s=this.media,a=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Ia.clearKeyUriToKeyIdMap();const l=a.length;So.CDMCleanupPromise=Promise.all(a.map(c=>this.removeSession(c)).concat((s==null||(e=s.setMediaKeys(null))==null?void 0:e.catch(c=>{this.log(`Could not clear media keys: ${c}`),this.hls&&this.hls.trigger(B.ERROR,{type:et.OTHER_ERROR,details:be.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${c}`)})}))||Promise.resolve())).catch(c=>{this.log(`Could not close sessions and clear media keys: ${c}`),this.hls&&this.hls.trigger(B.ERROR,{type:et.OTHER_ERROR,details:be.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${c}`)})}).then(()=>{l&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const s=t.reduce((a,l)=>(a.indexOf(l.keyFormat)===-1&&a.push(l.keyFormat),a),[]);this.log(`Selecting key-system from session-keys ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s,decryptdata:a}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Hs(a?.keyId||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const l=this.mediaKeySessions.indexOf(e);l>-1&&this.mediaKeySessions.splice(l,1);const{keyStatusTimeouts:c}=e;c&&Object.keys(c).forEach(d=>self.clearTimeout(c[d]));const{drmSystemOptions:u}=this.config;return(Lk(u)?new Promise((d,m)=>{self.setTimeout(()=>m(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(d).catch(m)}):Promise.resolve()).catch(d=>{this.log(`Could not remove session: ${d}`),this.hls&&this.hls.trigger(B.ERROR,{type:et.OTHER_ERROR,details:be.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${d}`)})}).then(()=>t.close()).catch(d=>{this.log(`Could not close session: ${d}`),this.hls&&this.hls.trigger(B.ERROR,{type:et.OTHER_ERROR,details:be.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${d}`)})})}return Promise.resolve()}}So.CDMCleanupPromise=void 0;function Au(i){if(!i)throw new Error("Could not read keyId of undefined decryptdata");if(i.keyId===null)throw new Error("keyId is null");return Hs(i.keyId)}function Wj(i,e){if(i.keyId&&e.mediaKeysSession.keyStatuses.has(i.keyId))return e.mediaKeysSession.keyStatuses.get(i.keyId);if(i.matches(e.decryptdata))return e.keyStatus}class Ti extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function b_(i,e){const t=i==="output-restricted",s=t?be.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:be.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Ti({type:et.KEY_SYSTEM_ERROR,details:s,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${i}"`)}class Xj{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(B.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(B.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(B.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(B.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const a=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=a,a&&typeof a.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const a=performance.now();if(t){if(this.lastTime){const l=a-this.lastTime,c=s-this.lastDroppedFrames,u=t-this.lastDecodedFrames,f=1e3*c/l,d=this.hls;if(d.trigger(B.FPS_DROP,{currentDropped:c,currentDecoded:u,totalDroppedFrames:s}),f>0&&c>d.config.fpsDroppedMonitoringThreshold*u){let m=d.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+m),m>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=m)&&(m=m-1,d.trigger(B.FPS_DROP_LEVEL_CAPPING,{level:m,droppedLevel:d.currentLevel}),d.autoLevelCapping=m,this.streamController.nextLevelSwitch())}}this.lastTime=a,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function _E(i,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=i,e.dispatchEvent(t)}function bE(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues&&!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(s){zt.debug(`[texttrack-utils]: ${s}`);try{const a=new self.TextTrackCue(e.startTime,e.endTime,e.text);a.id=e.id,i.addCue(a)}catch(a){zt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${a}`)}}t==="disabled"&&(i.mode=t)}function po(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues)for(let s=i.cues.length;s--;)e&&i.cues[s].removeEventListener("enter",e),i.removeCue(i.cues[s]);t==="disabled"&&(i.mode=t)}function Um(i,e,t,s){const a=i.mode;if(a==="disabled"&&(i.mode="hidden"),i.cues&&i.cues.length>0){const l=Zj(i.cues,e,t);for(let c=0;c<l.length;c++)(!s||s(l[c]))&&i.removeCue(l[c])}a==="disabled"&&(i.mode=a)}function Qj(i,e){if(e<=i[0].startTime)return 0;const t=i.length-1;if(e>i[t].endTime)return-1;let s=0,a=t,l;for(;s<=a;)if(l=Math.floor((a+s)/2),e<i[l].startTime)a=l-1;else if(e>i[l].startTime&&s<t)s=l+1;else return l;return i[s].startTime-e<e-i[a].startTime?s:a}function Zj(i,e,t){const s=[],a=Qj(i,e);if(a>-1)for(let l=a,c=i.length;l<c;l++){const u=i[l];if(u.startTime>=e&&u.endTime<=t)s.push(u);else if(u.startTime>t)return s}return s}function zu(i){const e=[];for(let t=0;t<i.length;t++){const s=i[t];(s.kind==="subtitles"||s.kind==="captions")&&s.label&&e.push(i[t])}return e}class Jj extends Ug{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const s=zu(this.media.textTracks);for(let l=0;l<s.length;l++)if(s[l].mode==="hidden")t=s[l];else if(s[l].mode==="showing"){t=s[l];break}const a=this.findTrackForTextTrack(t);this.subtitleTrack!==a&&this.setSubtitleTrack(a)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(B.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(B.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(B.MANIFEST_LOADING,this.onManifestLoading,this),e.on(B.MANIFEST_PARSED,this.onManifestParsed,this),e.on(B.LEVEL_LOADING,this.onLevelLoading,this),e.on(B.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(B.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(B.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(B.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(B.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(B.MANIFEST_LOADING,this.onManifestLoading,this),e.off(B.MANIFEST_PARSED,this.onManifestParsed,this),e.off(B.LEVEL_LOADING,this.onLevelLoading,this),e.off(B.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(B.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(B.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const a=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,a)return;zu(s.textTracks).forEach(c=>{po(c)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:a,details:l}=t,c=this.tracksInGroup[s];if(!c||c.groupId!==a){this.warn(`Subtitle track with id:${s} and group:${a} not found in active group ${c?.groupId}`);return}const u=c.details;c.details=t.details,this.log(`Subtitle track ${s} "${c.name}" lang:${c.lang} group:${a} loaded [${l.startSN}-${l.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,a=this.groupIds;let l=this.currentTrack;if(!s||a?.length!==s?.length||s!=null&&s.some(c=>a?.indexOf(c)===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const c=this.tracks.filter(m=>!s||s.indexOf(m.groupId)!==-1);if(c.length)this.selectDefaultTrack&&!c.some(m=>m.default)&&(this.selectDefaultTrack=!1),c.forEach((m,g)=>{m.id=g});else if(!l&&!this.tracksInGroup.length)return;this.tracksInGroup=c;const u=this.hls.config.subtitlePreference;if(!l&&u){this.selectDefaultTrack=!1;const m=vn(u,c);if(m>-1)l=c[m];else{const g=vn(u,this.tracks);l=this.tracks[g]}}let f=this.findTrackId(l);f===-1&&l&&(f=this.findTrackId(null));const d={subtitleTracks:c};this.log(`Updating subtitle tracks, ${c.length} track(s) found in "${s?.join(",")}" group-id`),this.hls.trigger(B.SUBTITLE_TRACKS_UPDATED,d),f!==-1&&this.trackId===-1&&this.setSubtitleTrack(f)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let a=0;a<t.length;a++){const l=t[a];if(!(s&&!l.default||!s&&!e)&&(!e||fr(l,e)))return a}if(e){for(let a=0;a<t.length;a++){const l=t[a];if(ql(e.attrs,l.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return a}for(let a=0;a<t.length;a++){const l=t[a];if(ql(e.attrs,l.attrs,["LANGUAGE"]))return a}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const a=t[s];if(jm(a,e))return s}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===At.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&fr(e,s))return s;const a=vn(e,this.tracksInGroup);if(a>-1){const l=this.tracksInGroup[a];return this.setSubtitleTrack(a),l}else{if(s)return null;{const l=vn(e,t);if(l>-1)return t[l]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,a=e.groupId,l=this.getUrlWithDirectives(e.url,t),c=e.details,u=c?.age;this.log(`Loading subtitle ${s} "${e.name}" lang:${e.lang} group:${a}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&c.live?" age "+u.toFixed(1)+(c.type&&" "+c.type||""):""} ${l}`),this.hls.trigger(B.SUBTITLE_TRACK_LOADING,{url:l,id:s,groupId:a,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=zu(e.textTracks),s=this.currentTrack;let a;if(s&&(a=t.filter(l=>jm(s,l))[0],a||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach(l=>{l.mode!=="disabled"&&l!==a&&(l.mode="disabled")}),a){const l=this.subtitleDisplay?"showing":"hidden";a.mode!==l&&(a.mode=l)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!We(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,a=t[e]||null;if(this.trackId=e,this.currentTrack=a,this.toggleTrackModes(),!a){this.hls.trigger(B.SUBTITLE_TRACK_SWITCH,{id:e});return}const l=!!a.details&&!a.details.live;if(e===this.trackId&&a===s&&l)return;this.log(`Switching to subtitle-track ${e}`+(a?` "${a.name}" lang:${a.lang} group:${a.groupId}`:""));const{id:c,groupId:u="",name:f,type:d,url:m}=a;this.hls.trigger(B.SUBTITLE_TRACK_SWITCH,{id:c,groupId:u,name:f,type:d,url:m});const g=this.switchParams(a.url,s?.details,a.details);this.loadPlaylist(g)}}function eO(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,a=>{const l=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(a=="x"?l:l&3|8).toString(16)})}}}function Bl(i){let e=5381,t=i.length;for(;t;)e=e*33^i.charCodeAt(--t);return(e>>>0).toString()}const Eo=.025;let cd=(function(i){return i[i.Point=0]="Point",i[i.Range=1]="Range",i})({});function tO(i,e,t){return`${i.identifier}-${t+1}-${Bl(e)}`}class sO{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const s=this.playoutLimit;return e<=0||isNaN(s)?!1:s===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>s}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Qf(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,s=Qf(t,e);return t-s<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=We(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Qf(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Eo))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?cd.Range:cd.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return iO(this)}}function Qf(i,e){return i-e.start<e.duration/2&&!(Math.abs(i-(e.start+e.duration))<Eo)?e.start:e.start+e.duration}function SE(i,e,t){const s=new self.URL(i,t);return s.protocol!=="data:"&&s.searchParams.set("_HLS_primary_id",e),s}function Zf(i,e){for(;(t=i.assetList[++e])!=null&&t.error;)var t;return e}function iO(i){return`["${i.identifier}" ${i.cue.pre?"<pre>":i.cue.post?"<post>":""}${i.timelineStart.toFixed(2)}-${i.resumeTime.toFixed(2)}]`}function go(i){const e=i.timelineStart,t=i.duration||0;return`["${i.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class nO{constructor(e,t,s,a){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(B.PLAYOUT_LIMIT_REACHED,{})};const l=this.hls=new e(t);this.interstitial=s,this.assetItem=a;const c=()=>{this.hasDetails=!0};l.once(B.LEVEL_LOADED,c),l.once(B.AUDIO_TRACK_LOADED,c),l.once(B.SUBTITLE_TRACK_LOADED,c),l.on(B.MEDIA_ATTACHING,(u,{media:f})=>{this.removeMediaListeners(),this.mediaAttached=f,this.interstitial.playoutLimit&&(f.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&l.on(B.BUFFER_APPENDED,()=>{const m=this.bufferedEnd;this.reachedPlayout(m)&&(this._bufferedEosTime=m,l.trigger(B.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=SE(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const s=Math.min(this._bufferedEosTime||1/0,this.duration),a=this.timelineOffset,l=pt.bufferInfo(e,a,0);return this.getAssetTime(l.end)>=s-.02}reachedPlayout(e){const s=this.interstitial.playoutLimit;return this.startOffset+e>=s}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=pt.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const s=t-this.startOffset;if(s>0&&s<e)return s}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=s=>delete s.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,s){var a;(a=this.hls)==null||a.on(e,t)}once(e,t,s){var a;(a=this.hls)==null||a.once(e,t)}off(e,t,s){var a;(a=this.hls)==null||a.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${go(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const S_=.033;class aO extends Wi{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((s,a)=>e<=a.startOffset&&t>a.startOffset?(delete a.error,s+1):s,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const a=this.items;if(a)for(a[s]||(t===void 0&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&(l=a[s])!=null&&l.event;){var l;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let a=0;a<s.length;a++){let l=s[a];if(t&&t!=="primary"&&(l=l[t]),e===l.start||e>l.start&&e<l.end)return a}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let a=e;a<=t&&s[a];a++){const l=s[a].event;if(l!=null&&l.restrictions.jump&&!l.appendInPlace)return a}return-1}findEventIndex(e){const t=this.items;if(t)for(let a=t.length;a--;){var s;if(((s=t[a].event)==null?void 0:s.identifier)===e)return a}return-1}findAssetIndex(e,t){const s=e.assetList,a=s.length;if(a>1)for(let l=0;l<a;l++){const c=s[l];if(!c.error){const u=c.timelineStart;if(t===u||t>u&&(t<u+(c.duration||0)||l===a-1))return l}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const s=t.assetList,a=s[s.length-1];if(a)return a.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:a}=s,l=this.events,c=this.parseDateRanges(a,{url:s.url},t),u=Object.keys(a),f=l?l.filter(d=>!u.includes(d.identifier)):[];c.length&&c.sort((d,m)=>{const g=d.cue.pre,y=d.cue.post,x=m.cue.pre,v=m.cue.post;if(g&&!x)return-1;if(x&&!g||y&&!v)return 1;if(v&&!y)return-1;if(!g&&!x&&!y&&!v){const E=d.startTime,A=m.startTime;if(E!==A)return E-A}return d.dateRange.tagOrder-m.dateRange.tagOrder}),this.events=c,f.forEach(d=>{this.removeEvent(d)}),this.updateSchedule(e,f)}updateSchedule(e,t=[],s=!1){const a=this.events||[];if(a.length||t.length||this.length<2){const l=this.items,c=this.parseSchedule(a,e);(s||t.length||l?.length!==c.length||c.some((f,d)=>Math.abs(f.playout.start-l[d].playout.start)>.005||Math.abs(f.playout.end-l[d].playout.end)>.005))&&(this.items=c,this.onScheduleUpdate(t,l))}}parseDateRanges(e,t,s){const a=[],l=Object.keys(e);for(let c=0;c<l.length;c++){const u=l[c],f=e[u];if(f.isInterstitial){let d=this.eventMap[u];d?d.setDateRange(f):(d=new sO(f,t),this.eventMap[u]=d,s===!1&&(d.appendInPlace=s)),a.push(d)}}return a}parseSchedule(e,t){const s=[],a=t.main.details,l=a.live?1/0:a.edge;let c=0;if(e=e.filter(f=>!f.error&&!(f.cue.once&&f.hasPlayed)),e.length){this.resolveOffsets(e,t);let f=0,d=0;if(e.forEach((m,g)=>{const y=m.cue.pre,x=m.cue.post,v=e[g-1]||null,E=m.appendInPlace,A=x?l:m.startOffset,R=m.duration,D=m.timelineOccupancy===cd.Range?R:0,L=m.resumptionOffset,O=v?.startTime===A,H=A+m.cumulativeDuration;let q=E?H+R:A+L;if(y||!x&&A<=0){const k=d;d+=D,m.timelineStart=H;const M=c;c+=R,s.push({event:m,start:H,end:q,playout:{start:M,end:c},integrated:{start:k,end:d}})}else if(A<=l){if(!O){const I=A-f;if(I>S_){const j=f,Z=d;d+=I;const ae=c;c+=I;const ie={previousEvent:e[g-1]||null,nextEvent:m,start:j,end:j+I,playout:{start:ae,end:c},integrated:{start:Z,end:d}};s.push(ie)}else I>0&&v&&(v.cumulativeDuration+=I,s[s.length-1].end=A)}x&&(q=H),m.timelineStart=H;const k=d;d+=D;const M=c;c+=R,s.push({event:m,start:H,end:q,playout:{start:M,end:c},integrated:{start:k,end:d}})}else return;const U=m.resumeTime;x||U>l?f=l:f=U}),f<l){var u;const m=f,g=d,y=l-f;d+=y;const x=c;c+=y,s.push({previousEvent:((u=s[s.length-1])==null?void 0:u.event)||null,nextEvent:null,start:f,end:m+y,playout:{start:x,end:c},integrated:{start:g,end:d}})}this.setDurations(l,c,d)}else s.push({previousEvent:null,nextEvent:null,start:0,end:l,playout:{start:0,end:l},integrated:{start:0,end:l}}),this.setDurations(l,l,l);return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,a=s.live?1/0:s.edge;let l=0,c=-1;e.forEach((u,f)=>{const d=u.cue.pre,m=u.cue.post,g=d?0:m?a:u.startTime;this.updateAssetDurations(u),c===g?u.cumulativeDuration=l:(l=0,c=g),!m&&u.snapOptions.in&&(u.resumeAnchor=Sr(null,s.fragments,u.startOffset+u.resumptionOffset,0,0)||void 0),u.appendInPlace&&!u.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(u,t)||(u.appendInPlace=!1)),!u.appendInPlace&&f+1<e.length&&e[f+1].startTime-e[f].resumeTime<S_&&(e[f+1].appendInPlace=!1,e[f+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${u}`));const x=We(u.resumeOffset)?u.resumeOffset:u.duration;l+=x})}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,a=e.startTime+e.resumptionOffset;return Math.abs(s-a)>Eo?(this.log(`"${e.identifier}" resumption ${s} not aligned with estimated timeline end ${a}`),!1):!Object.keys(t).some(c=>{const u=t[c].details,f=u.edge;if(s>=f)return this.log(`"${e.identifier}" resumption ${s} past ${c} playlist end ${f}`),!1;const d=Sr(null,u.fragments,s);if(!d)return this.log(`"${e.identifier}" resumption ${s} does not align with any fragments in ${c} playlist (${u.fragStart}-${u.fragmentEnd})`),!0;const m=c==="audio"?.175:0;return Math.abs(d.start-s)<Eo+m||Math.abs(d.end-s)<Eo+m?!1:(this.log(`"${e.identifier}" resumption ${s} not aligned with ${c} fragment bounds (${d.start}-${d.end} sn: ${d.sn} cc: ${d.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,a=!1,l=!1;for(let c=0;c<e.assetList.length;c++){const u=e.assetList[c],f=t+s;u.startOffset=s,u.timelineStart=f,a||(a=u.duration===null),l||(l=!!u.error);const d=u.error?0:u.duration||0;s+=d}a&&!l?e.duration=Math.max(s,e.duration):e.duration=s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function sn(i){return`[${i.event?'"'+i.event.identifier+'"':"primary"}: ${i.start.toFixed(2)}-${i.end.toFixed(2)}]`}class rO{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let a;try{a=SE(s,this.hls.sessionId,e.baseUrl)}catch(y){const x=this.assignAssetListError(e,be.ASSET_LIST_LOAD_ERROR,y,s);this.hls.trigger(B.ERROR,x);return}t&&a.protocol!=="data:"&&a.searchParams.set("_HLS_start_offset",""+t);const l=this.hls.config,c=l.loader,u=new c(l),f={responseType:"json",url:a.href},d=l.interstitialAssetListLoadPolicy.default,m={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(y,x,v,E)=>{const A=y.data,R=A?.ASSETS;if(!Array.isArray(R)){const D=this.assignAssetListError(e,be.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),v.url,x,E);this.hls.trigger(B.ERROR,D);return}e.assetListResponse=A,this.hls.trigger(B.ASSET_LIST_LOADED,{event:e,assetListResponse:A,networkDetails:E})},onError:(y,x,v,E)=>{const A=this.assignAssetListError(e,be.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${y.code} ${y.text} (${x.url})`),x.url,E,v);this.hls.trigger(B.ERROR,A)},onTimeout:(y,x,v)=>{const E=this.assignAssetListError(e,be.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${x.url})`),x.url,y,v);this.hls.trigger(B.ERROR,E)}};return u.load(f,m,g),this.hls.trigger(B.ASSET_LIST_LOADING,{event:e}),u}assignAssetListError(e,t,s,a,l,c){return e.error=s,{type:et.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:a,error:s,networkDetails:c,stats:l}}}function E_(i){var e;i==null||(e=i.play())==null||e.catch(()=>{})}function wu(i,e){return`[${i}] Advancing timeline position to ${e}`}class oO extends Wi{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled||!this.schedule)return;const a=s-this.timelinePos;if(Math.abs(a)<1/7056e5)return;const c=a<=-.01;this.timelinePos=s,this.bufferedPos=s;const u=this.playingItem;if(!u){this.checkBuffer();return}if(c&&this.schedule.resetErrorsInRange(s,s-a)&&this.updateSchedule(!0),this.checkBuffer(),c&&s<u.start||s>=u.end){var f;const x=this.findItemIndex(u);let v=this.schedule.findItemIndexAtTime(s);if(v===-1&&(v=x+(c?-1:1),this.log(`seeked ${c?"back ":""}to position not covered by schedule ${s} (resolving from ${x} to ${v})`)),!this.isInterstitial(u)&&(f=this.media)!=null&&f.paused&&(this.shouldPlay=!1),!c&&v>x){const E=this.schedule.findJumpRestrictedIndex(x+1,v);if(E>x){this.setSchedulePosition(E);return}}this.setSchedulePosition(v);return}const d=this.playingAsset;if(!d){if(this.playingLastItem&&this.isInterstitial(u)){const x=u.event.assetList[0];x&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(s,x))}return}const m=d.timelineStart,g=d.duration||0;if(c&&s<m||s>=m+g){var y;(y=u.event)!=null&&y.appendInPlace&&(this.clearAssetPlayers(u.event,u),this.flushFrontBuffer(s)),this.setScheduleToAssetAtTime(s,d)}},this.onTimeupdate=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled)return;if(s>this.timelinePos)this.timelinePos=s,s>this.bufferedPos&&this.checkBuffer();else return;const a=this.playingItem;if(!a||this.playingLastItem)return;if(s>=a.end){this.timelinePos=a.end;const u=this.findItemIndex(a);this.setSchedulePosition(u+1)}const l=this.playingAsset;if(!l)return;const c=l.timelineStart+(l.duration||0);s>=c&&this.setScheduleToAssetAtTime(s,l)},this.onScheduleUpdate=(s,a)=>{const l=this.schedule;if(!l)return;const c=this.playingItem,u=l.events||[],f=l.items||[],d=l.durations,m=s.map(E=>E.identifier),g=!!(u.length||m.length);(g||a)&&this.log(`INTERSTITIALS_UPDATED (${u.length}): ${u}
Schedule: ${f.map(E=>sn(E))} pos: ${this.timelinePos}`),m.length&&this.log(`Removed events ${m}`);let y=null,x=null;c&&(y=this.updateItem(c,this.timelinePos),this.itemsMatch(c,y)?this.playingItem=y:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const v=this.bufferingItem;if(v&&(x=this.updateItem(v,this.bufferedPos),this.itemsMatch(v,x)?this.bufferingItem=x:v.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(v.event,null))),s.forEach(E=>{E.assetList.forEach(A=>{this.clearAssetPlayer(A.identifier,null)})}),this.playerQueue.forEach(E=>{if(E.interstitial.appendInPlace){const A=E.assetItem.timelineStart,R=E.timelineOffset-A;if(R)try{E.timelineOffset=A}catch(D){Math.abs(R)>Eo&&this.warn(`${D} ("${E.assetId}" ${E.timelineOffset}->${A})`)}}}),g||a){if(this.hls.trigger(B.INTERSTITIALS_UPDATED,{events:u.slice(0),schedule:f.slice(0),durations:d,removedIds:m}),this.isInterstitial(c)&&m.includes(c.event.identifier)){this.warn(`Interstitial "${c.event.identifier}" removed while playing`),this.primaryFallback(c.event);return}c&&this.trimInPlace(y,c),v&&x!==y&&this.trimInPlace(x,v),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new rO(e),this.schedule=new aO(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(B.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(B.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(B.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(B.MANIFEST_LOADING,this.onManifestLoading,this),e.on(B.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(B.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(B.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(B.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(B.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(B.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(B.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(B.BUFFER_APPENDED,this.onBufferAppended,this),e.on(B.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(B.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(B.MEDIA_ENDED,this.onMediaEnded,this),e.on(B.ERROR,this.onError,this),e.on(B.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(B.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(B.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(B.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(B.MANIFEST_LOADING,this.onManifestLoading,this),e.off(B.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(B.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(B.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(B.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(B.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(B.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(B.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(B.BUFFER_CODECS,this.onBufferCodecs,this),e.off(B.BUFFER_APPENDED,this.onBufferAppended,this),e.off(B.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(B.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(B.MEDIA_ENDED,this.onMediaEnded,this),e.off(B.ERROR,this.onError,this),e.off(B.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){di(e,"play",this.onPlay),di(e,"pause",this.onPause),di(e,"seeking",this.onSeeking),di(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;si(s,"seeking",this.onSeeking),si(s,"timeupdate",this.onTimeupdate),si(s,"play",this.onPlay),si(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,a=this.detachedData;if(this.detachedData=null,s===null)this.checkStart();else if(!a){this.clearScheduleState();const l=this.findItemIndex(s);this.setSchedulePosition(l)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,a=this.media;if(this.media=null,!s&&(a&&this.removeMediaListeners(a),this.detachedData)){const l=this.getBufferingPlayer();l&&(this.log(`Removing schedule state for detachedData and ${l}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,l.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=g=>g&&e.getAssetPlayer(g.identifier),a=(g,y,x,v,E)=>{if(g){let A=g[y].start;const R=g.event;if(R){if(y==="playout"||R.timelineOccupancy!==cd.Point){const D=s(x);D?.interstitial===R&&(A+=D.assetItem.startOffset+D[E])}}else{const D=v==="bufferedPos"?c():e[v];A+=D-g.start}return A}return 0},l=(g,y)=>{var x;if(g!==0&&y!=="primary"&&(x=e.schedule)!=null&&x.length){var v;const E=e.schedule.findItemIndexAtTime(g),A=(v=e.schedule.items)==null?void 0:v[E];if(A){const R=A[y].start-A.start;return g+R}}return g},c=()=>{const g=e.bufferedPos;return g===Number.MAX_VALUE?u("primary"):Math.max(g,0)},u=g=>{var y,x;return(y=e.primaryDetails)!=null&&y.live?e.primaryDetails.edge:((x=e.schedule)==null?void 0:x.durations[g])||0},f=(g,y)=>{var x,v;const E=e.effectivePlayingItem;if(E!=null&&(x=E.event)!=null&&x.restrictions.skip||!e.schedule)return;e.log(`seek to ${g} "${y}"`);const A=e.effectivePlayingItem,R=e.schedule.findItemIndexAtTime(g,y),D=(v=e.schedule.items)==null?void 0:v[R],L=e.getBufferingPlayer(),O=L?.interstitial,H=O?.appendInPlace,q=A&&e.itemsMatch(A,D);if(A&&(H||q)){const U=s(e.playingAsset),k=U?.media||e.primaryMedia;if(k){const M=y==="primary"?k.currentTime:a(A,y,e.playingAsset,"timelinePos","currentTime"),I=g-M,j=(H?M:k.currentTime)+I;if(j>=0&&(!U||H||j<=U.duration)){k.currentTime=j;return}}}if(D){let U=g;if(y!=="primary"){const M=D[y].start,I=g-M;U=D.start+I}const k=!e.isInterstitial(D);if((!e.isInterstitial(A)||A.event.appendInPlace)&&(k||D.event.appendInPlace)){const M=e.media||(H?L?.media:null);M&&(M.currentTime=U)}else if(A){const M=e.findItemIndex(A);if(R>M){const j=e.schedule.findJumpRestrictedIndex(M+1,R);if(j>M){e.setSchedulePosition(j);return}}let I=0;if(k)e.timelinePos=U,e.checkBuffer();else{const j=D.event.assetList,Z=g-(D[y]||D).start;for(let ae=j.length;ae--;){const ie=j[ae];if(ie.duration&&Z>=ie.startOffset&&Z<ie.startOffset+ie.duration){I=ae;break}}}e.setSchedulePosition(R,I)}}},d=()=>{const g=e.effectivePlayingItem;if(e.isInterstitial(g))return g;const y=t();return e.isInterstitial(y)?y:null},m={get bufferedEnd(){const g=t(),y=e.bufferingItem;if(y&&y===g){var x;return a(y,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-y.playout.start||((x=e.bufferingAsset)==null?void 0:x.startOffset)||0}return 0},get currentTime(){const g=d(),y=e.effectivePlayingItem;return y&&y===g?a(y,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-y.playout.start:0},set currentTime(g){const y=d(),x=e.effectivePlayingItem;x&&x===y&&f(g+x.playout.start,"playout")},get duration(){const g=d();return g?g.playout.end-g.playout.start:0},get assetPlayers(){var g;const y=(g=d())==null?void 0:g.event.assetList;return y?y.map(x=>e.getAssetPlayer(x.identifier)):[]},get playingIndex(){var g;const y=(g=d())==null?void 0:g.event;return y&&e.effectivePlayingAsset?y.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return d()}};return this.manager={get events(){var g;return((g=e.schedule)==null||(g=g.events)==null?void 0:g.slice(0))||[]},get schedule(){var g;return((g=e.schedule)==null||(g=g.items)==null?void 0:g.slice(0))||[]},get interstitialPlayer(){return d()?m:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const g=t();return e.findItemIndex(g)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const g=e.effectivePlayingItem;return e.findItemIndex(g)},primary:{get bufferedEnd(){return c()},get currentTime(){const g=e.timelinePos;return g>0?g:0},set currentTime(g){f(g,"primary")},get duration(){return u("primary")},get seekableStart(){var g;return((g=e.primaryDetails)==null?void 0:g.fragmentStart)||0}},integrated:{get bufferedEnd(){return a(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return a(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(g){f(g,"integrated")},get duration(){return u("integrated")},get seekableStart(){var g;return l(((g=e.primaryDetails)==null?void 0:g.fragmentStart)||0,"integrated")}},skip:()=>{const g=e.effectivePlayingItem,y=g?.event;if(y&&!y.restrictions.skip){const x=e.findItemIndex(g);if(y.appendInPlace){const v=g.playout.start+g.event.duration;f(v+.001,"playout")}else e.advanceAfterAssetEnded(y,x,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!s?!1:this.findItemIndex(t)===s.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let a=this.media;!a&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(a=this.primaryMedia);const l=(t=a)==null?void 0:t.currentTime;if(!(l===void 0||!We(l)))return l}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,a=e.media;if(s&&a===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&a){this.detachedData={media:a};return}const l=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Jt(l)}`),this.detachedData=l}else t&&a&&(this.shouldPlay||(this.shouldPlay=!a.paused))}transferMediaTo(e,t){var s,a;if(e.media===t)return;let l=null;const c=this.hls,u=e!==c,f=u&&e.interstitial.appendInPlace,d=(s=this.detachedData)==null?void 0:s.mediaSource;let m;if(c.media)f&&(l=c.transferMedia(),this.detachedData=l),m="Primary";else if(d){const v=this.getBufferingPlayer();v?(l=v.transferMedia(),m=`${v}`):m="detached MediaSource"}else m="detached media";if(!l){if(d)l=this.detachedData,this.log(`using detachedData: MediaSource ${Jt(l)}`);else if(!this.detachedData||c.media===t){const v=this.playerQueue;v.length>1&&v.forEach(E=>{if(u&&E.interstitial.appendInPlace!==f){const A=E.interstitial;this.clearInterstitial(E.interstitial,null),A.appendInPlace=!1,A.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${A}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const g=l&&"mediaSource"in l&&((a=l.mediaSource)==null?void 0:a.readyState)!=="closed",y=g&&l?l:t;this.log(`${g?"transfering MediaSource":"attaching media"} to ${u?e:"Primary"} from ${m} (media.currentTime: ${t.currentTime})`);const x=this.schedule;if(y===l&&x){const v=u&&e.assetId===x.assetIdAtEnd;y.overrides={duration:x.duration,endOfStream:!u||v,cueRemoval:!u}}e.attachMedia(y)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const s=this.timelinePos,a=this.effectivePlayingItem;if(s===-1){const l=this.hls.startPosition;if(this.log(wu("checkStart",l)),this.timelinePos=l,t.length&&t[0].cue.pre){const c=e.findEventIndex(t[0].identifier);this.setSchedulePosition(c)}else if(l>=0||!this.primaryLive){const c=this.timelinePos=l>0?l:0,u=e.findItemIndexAtTime(c);this.setSchedulePosition(u)}}else if(a&&!this.playingItem){const l=e.findItemIndex(a);this.setSchedulePosition(l)}}advanceAssetBuffering(e,t){const s=e.event,a=s.findAssetIndex(t),l=Zf(s,a);if(!s.isAssetPastPlayoutLimit(l))this.bufferedToEvent(e,l);else if(this.schedule){var c;const u=(c=this.schedule.items)==null?void 0:c[this.findItemIndex(e)+1];u&&this.bufferedToItem(u)}}advanceAfterAssetEnded(e,t,s){const a=Zf(e,s);if(e.isAssetPastPlayoutLimit(a)){if(this.schedule){const l=this.schedule.items;if(l){const c=t+1,u=l.length;if(c>=u){this.setSchedulePosition(-1);return}const f=e.resumeTime;this.timelinePos<f&&(this.log(wu("advanceAfterAssetEnded",f)),this.timelinePos=f,e.appendInPlace&&this.advanceInPlace(f),this.checkBuffer(this.bufferedPos<f)),this.setSchedulePosition(c)}}}else{if(e.appendInPlace){const l=e.assetList[a];l&&this.advanceInPlace(l.timelineStart)}this.setSchedulePosition(t,a)}}setScheduleToAssetAtTime(e,t){const s=this.schedule;if(!s)return;const a=t.parentIdentifier,l=s.getEvent(a);if(l){const c=s.findEventIndex(a),u=s.findAssetIndex(l,e);this.advanceAfterAssetEnded(l,c,u-1)}}setSchedulePosition(e,t){var s;const a=(s=this.schedule)==null?void 0:s.items;if(!a||this.playbackDisabled)return;const l=e>=0?a[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${l&&sn(l)}) pos: ${this.timelinePos}`);const c=this.waitingItem||this.playingItem,u=this.playingLastItem;if(this.isInterstitial(c)){const m=c.event,g=this.playingAsset,y=g?.identifier,x=y?this.getAssetPlayer(y):null;if(x&&y&&(!this.eventItemsMatch(c,l)||t!==void 0&&y!==m.assetList[t].identifier)){var f;const v=m.findAssetIndex(g);if(this.log(`INTERSTITIAL_ASSET_ENDED ${v+1}/${m.assetList.length} ${go(g)}`),this.endedAsset=g,this.playingAsset=null,this.hls.trigger(B.INTERSTITIAL_ASSET_ENDED,{asset:g,assetListIndex:v,event:m,schedule:a.slice(0),scheduleIndex:e,player:x}),c!==this.playingItem){this.itemsMatch(c,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(m,this.findItemIndex(this.playingItem),v);return}this.retreiveMediaSource(y,l),x.media&&!((f=this.detachedData)!=null&&f.mediaSource)&&x.detachMedia()}if(!this.eventItemsMatch(c,l)&&(this.endedItem=c,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${m} ${sn(c)}`),m.hasPlayed=!0,this.hls.trigger(B.INTERSTITIAL_ENDED,{event:m,schedule:a.slice(0),scheduleIndex:e}),m.cue.once)){var d;this.updateSchedule();const v=(d=this.schedule)==null?void 0:d.items;if(l&&v){const E=this.findItemIndex(l);this.advanceSchedule(E,v,t,c,u)}return}}this.advanceSchedule(e,a,t,c,u)}advanceSchedule(e,t,s,a,l){const c=this.schedule;if(!c)return;const u=t[e]||null,f=this.primaryMedia,d=this.playerQueue;if(d.length&&d.forEach(m=>{const g=m.interstitial,y=c.findEventIndex(g.identifier);(y<e||y>e+1)&&this.clearInterstitial(g,u)}),this.isInterstitial(u)){this.timelinePos=Math.min(Math.max(this.timelinePos,u.start),u.end);const m=u.event;if(s===void 0){s=c.findAssetIndex(m,this.timelinePos);const v=Zf(m,s-1);if(m.isAssetPastPlayoutLimit(v)||m.appendInPlace&&this.timelinePos===u.end){this.advanceAfterAssetEnded(m,e,s);return}s=v}const g=this.waitingItem;this.assetsBuffered(u,f)||this.setBufferingItem(u);let y=this.preloadAssets(m,s);if(this.eventItemsMatch(u,g||a)||(this.waitingItem=u,this.log(`INTERSTITIAL_STARTED ${sn(u)} ${m.appendInPlace?"append in place":""}`),this.hls.trigger(B.INTERSTITIAL_STARTED,{event:m,schedule:t.slice(0),scheduleIndex:e})),!m.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${m}`);return}if(m.assetListLoader&&(m.assetListLoader.destroy(),m.assetListLoader=void 0),!f){this.log(`Waiting for attachMedia to start Interstitial ${m}`);return}this.waitingItem=this.endedItem=null,this.playingItem=u;const x=m.assetList[s];if(!x){this.advanceAfterAssetEnded(m,e,s||0);return}if(y||(y=this.getAssetPlayer(x.identifier)),y===null||y.destroyed){const v=m.assetList.length;this.warn(`asset ${s+1}/${v} player destroyed ${m}`),y=this.createAssetPlayer(m,x,s),y.loadSource()}if(!this.eventItemsMatch(u,this.bufferingItem)&&m.appendInPlace&&this.isAssetBuffered(x))return;this.startAssetPlayer(y,s,t,e,f),this.shouldPlay&&E_(y.media)}else u?(this.resumePrimary(u,e,a),this.shouldPlay&&E_(this.hls.media)):l&&this.isInterstitial(a)&&(this.endedItem=null,this.playingItem=a,a.event.appendInPlace||this.attachPrimary(c.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,s){var a,l;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${sn(e)}`),!((a=this.detachedData)!=null&&a.mediaSource)){let u=this.timelinePos;(u<e.start||u>=e.end)&&(u=this.getPrimaryResumption(e,t),this.log(wu("resumePrimary",u)),this.timelinePos=u),this.attachPrimary(u,e)}if(!s)return;const c=(l=this.schedule)==null?void 0:l.items;c&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${sn(e)}`),this.hls.trigger(B.INTERSTITIALS_PRIMARY_RESUMED,{schedule:c.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const a=this.primaryDetails;if(t===0)return this.hls.startPosition;if(a&&(s<a.fragmentStart||s>a.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:pt.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const a=this.primaryMedia;if(!a)return;const l=this.hls;l.media?this.checkBuffer():(this.transferMediaTo(l,a),s&&this.startLoadingPrimaryAt(e,s)),s||(this.log(wu("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const a=this.hls;!a.loadingEnabled||!a.media||Math.abs((((s=a.mainForwardBufferInfo)==null?void 0:s.start)||a.media.currentTime)-e)>.5?a.startLoad(e,t):a.bufferingEnabled||a.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(B.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(B.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const s=this.hls.levels[t.level];if(!s.details)return;const a=Kt(Kt({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=a,this.schedule.parseInterstitialDateRanges(a,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],a=this.mediaSelection;if(!a){this.altSelection=Kt(Kt({},this.altSelection),{},{audio:s});return}const l=Kt(Kt({},a),{},{audio:s});this.mediaSelection=l}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],a=this.mediaSelection;if(!a){this.altSelection=Kt(Kt({},this.altSelection),{},{subtitles:s});return}const l=Kt(Kt({},a),{},{subtitles:s});this.mediaSelection=l}onAudioTrackSwitching(e,t){const s=Iv(t);this.playerQueue.forEach(({hls:a})=>a&&(a.setAudioOption(t)||a.setAudioOption(s)))}onSubtitleTrackSwitch(e,t){const s=Iv(t);this.playerQueue.forEach(({hls:a})=>a&&(a.setSubtitleOption(t)||t.id!==-1&&a.setSubtitleOption(s)))}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const a=this.timelinePos;this.bufferedPos=a,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let a=0;a<t.length;a++){const l=t[a];if(l.cue.post){var s;const c=this.schedule.findEventIndex(l.identifier),u=(s=this.schedule.items)==null?void 0:s[c];this.isInterstitial(u)&&this.eventItemsMatch(u,this.bufferingItem)&&this.bufferedToItem(u,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const s=this.findItemIndex(t);this.setSchedulePosition(s+1)}else this.shouldPlay=!1}updateItem(e,t){var s;const a=(s=this.schedule)==null?void 0:s.items;if(e&&a){const l=this.findItemIndex(e,t);return a[l]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((l,c)=>{e.event.isAssetPastPlayoutLimit(c)&&this.clearAssetPlayer(l.identifier,null)});const s=e.end+.25,a=pt.bufferInfo(this.primaryMedia,s,0);(a.end>s||(a.nextStart||0)>s)&&(this.log(`trim buffered interstitial ${sn(e)} (was ${sn(t)})`),this.attachPrimary(s,null,!0),this.flushFrontBuffer(s))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===((s=t.event)==null?void 0:s.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const s=this.mediaSelection;s&&((t=this.schedule)==null||t.updateSchedule(s,[],e))}checkBuffer(e){var t;const s=(t=this.schedule)==null?void 0:t.items;if(!s)return;const a=pt.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=a.len<1),this.updateBufferedPos(a.end,s,e)}updateBufferedPos(e,t,s){const a=this.schedule,l=this.bufferingItem;if(this.bufferedPos>e||!a)return;if(t.length===1&&this.itemsMatch(t[0],l)){this.bufferedPos=e;return}const c=this.playingItem,u=this.findItemIndex(c);let f=a.findItemIndexAtTime(e);if(this.bufferedPos<e){var d;const m=this.findItemIndex(l),g=Math.min(m+1,t.length-1),y=t[g];if((f===-1&&l&&e>=l.end||(d=y.event)!=null&&d.appendInPlace&&e+.01>=y.start)&&(f=g),this.isInterstitial(l)){const x=l.event;if(g-u>1&&x.appendInPlace===!1||x.assetList.length===0&&x.assetListLoader)return}if(this.bufferedPos=e,f>m&&f>u)this.bufferedToItem(y);else{const x=this.primaryDetails;this.primaryLive&&x&&e>x.edge-x.targetduration&&y.start<x.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(y)&&this.preloadAssets(y.event,0)}}else s&&c&&!this.itemsMatch(c,l)&&(f===u?this.bufferedToItem(c):f===u+1&&this.bufferedToItem(t[f]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(a=>{const l=this.getAssetPlayer(a.identifier);return!(l!=null&&l.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(!this.itemsMatch(e,t)&&s){const{items:a,events:l}=s;if(!a||!l)return t;const c=this.isInterstitial(e),u=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const f=u?u.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${sn(e)}`+(t?` (${f.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(c){const d=s.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((m,g)=>{const y=this.getAssetPlayer(m.identifier);y&&(g===d&&y.loadSource(),y.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(d=>d.pauseBuffering());this.hls.trigger(B.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:l.slice(0),schedule:a.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const s=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(s!==null){this.bufferingAsset=null;const a=this.detachedData;a?a.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,a=s.assetList.length===0&&!s.assetListLoader,l=s.cue.once;if(a||!l){const c=this.preloadAssets(s,t);if(c!=null&&c.interstitial.appendInPlace){const u=this.primaryMedia;u&&this.bufferAssetPlayer(c,u)}}}preloadAssets(e,t){const s=e.assetUrl,a=e.assetList.length,l=a===0&&!e.assetListLoader,c=e.cue.once;if(l){const f=e.timelineStart;if(e.appendInPlace){var u;const y=this.playingItem;!this.isInterstitial(y)&&(y==null||(u=y.nextEvent)==null?void 0:u.identifier)===e.identifier&&this.flushFrontBuffer(f+.25)}let d,m=0;if(!this.playingItem&&this.primaryLive&&(m=this.hls.startPosition,m===-1&&(m=this.hls.liveSyncPosition||0)),m&&!(e.cue.pre||e.cue.post)){const y=m-f;y>0&&(d=Math.round(y*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${s?1:a} ${e}${d?` live-start: ${m} start-offset: ${d}`:""}`),s)return this.createAsset(e,0,0,f,e.duration,s);const g=this.assetListLoader.loadAssetList(e,d);g&&(e.assetListLoader=g)}else if(!c&&a){for(let d=t;d<a;d++){const m=e.assetList[d],g=this.getAssetPlayerQueueIndex(m.identifier);(g===-1||this.playerQueue[g].destroyed)&&!m.error&&this.createAssetPlayer(e,m,d)}const f=e.assetList[t];if(f){const d=this.getAssetPlayer(f.identifier);return d&&d.loadSource(),d}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(a=>{this.hls.trigger(B.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:a})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s]}return null}createAsset(e,t,s,a,l,c){const u={parentIdentifier:e.identifier,identifier:tO(e,c,t),duration:l,startOffset:s,timelineStart:a,uri:c};return this.createAssetPlayer(e,u,t)}createAssetPlayer(e,t,s){const a=this.hls,l=a.userConfig;let c=l.videoPreference;const u=a.loadLevelObj||a.levels[a.currentLevel];(c||u)&&(c=Xt({},c),u.videoCodec&&(c.videoCodec=u.videoCodec),u.videoRange&&(c.allowedVideoRanges=[u.videoRange]));const f=a.audioTracks[a.audioTrack],d=a.subtitleTracks[a.subtitleTrack];let m=0;if(this.primaryLive||e.appendInPlace){const O=this.timelinePos-t.timelineStart;if(O>1){const H=t.duration;H&&O<H&&(m=O)}}const g=t.identifier,y=Kt(Kt({},l),{},{maxMaxBufferLength:Math.min(180,a.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:a.sessionId,assetPlayerId:g,abrEwmaDefaultEstimate:a.bandwidthEstimate,interstitialsController:void 0,startPosition:m,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:c,audioPreference:f||l.audioPreference,subtitlePreference:d||l.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(y.timelineOffset=t.timelineStart));const x=y.cmcd;x!=null&&x.sessionId&&x.contentId&&(y.cmcd=Xt({},x,{contentId:Bl(t.uri)})),this.getAssetPlayer(g)&&this.warn(`Duplicate date range identifier ${e} and asset ${g}`);const v=new nO(this.HlsPlayerClass,y,e,t);this.playerQueue.push(v),e.assetList[s]=t;let E=!0;const A=O=>{if(O.live){var H;const k=new Error(`Interstitials MUST be VOD assets ${e}`),M={fatal:!0,type:et.OTHER_ERROR,details:be.INTERSTITIAL_ASSET_ITEM_ERROR,error:k},I=((H=this.schedule)==null?void 0:H.findEventIndex(e.identifier))||-1;this.handleAssetItemError(M,e,I,s,k.message);return}const q=O.edge-O.fragmentStart,U=t.duration;(E||U===null||q>U)&&(E=!1,this.log(`Interstitial asset "${g}" duration change ${U} > ${q}`),t.duration=q,this.updateSchedule())};v.on(B.LEVEL_UPDATED,(O,{details:H})=>A(H)),v.on(B.LEVEL_PTS_UPDATED,(O,{details:H})=>A(H)),v.on(B.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const R=(O,H)=>{const q=this.getAssetPlayer(g);if(q&&H.tracks){q.off(B.BUFFER_CODECS,R),q.tracks=H.tracks;const U=this.primaryMedia;this.bufferingAsset===q.assetItem&&U&&!q.media&&this.bufferAssetPlayer(q,U)}};v.on(B.BUFFER_CODECS,R);const D=()=>{var O;const H=this.getAssetPlayer(g);if(this.log(`buffered to end of asset ${H}`),!H||!this.schedule)return;const q=this.schedule.findEventIndex(e.identifier),U=(O=this.schedule.items)==null?void 0:O[q];this.isInterstitial(U)&&this.advanceAssetBuffering(U,t)};v.on(B.BUFFERED_TO_END,D);const L=O=>()=>{if(!this.getAssetPlayer(g)||!this.schedule)return;this.shouldPlay=!0;const q=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,q,O)};return v.once(B.MEDIA_ENDED,L(s)),v.once(B.PLAYOUT_LIMIT_REACHED,L(1/0)),v.on(B.ERROR,(O,H)=>{if(!this.schedule)return;const q=this.getAssetPlayer(g);if(H.details===be.BUFFER_STALLED_ERROR){if(q!=null&&q.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(H,e,this.schedule.findEventIndex(e.identifier),s,`Asset player error ${H.error} ${e}`)}),v.on(B.DESTROYING,()=>{if(!this.getAssetPlayer(g)||!this.schedule)return;const H=new Error(`Asset player destroyed unexpectedly ${g}`),q={fatal:!0,type:et.OTHER_ERROR,details:be.INTERSTITIAL_ASSET_ITEM_ERROR,error:H};this.handleAssetItemError(q,e,this.schedule.findEventIndex(e.identifier),s,H.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${go(t)}`),this.hls.trigger(B.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:v}),v}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(s=>{this.clearAssetPlayer(s.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const s=this.playerQueue[t];this.transferMediaFromPlayer(s,null),s.resetDetails()}}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(s!==-1){const a=this.playerQueue[s];this.log(`clear ${a} toSegment: ${t&&sn(t)}`),this.transferMediaFromPlayer(a,t),this.playerQueue.splice(s,1),a.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,a,l){const{interstitial:c,assetItem:u,assetId:f}=e,d=c.assetList.length,m=this.playingAsset;this.endedAsset=null,this.playingAsset=u,(!m||m.identifier!==f)&&(m&&(this.clearAssetPlayer(m.identifier,s[a]),delete m.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${d} ${go(u)}`),this.hls.trigger(B.INTERSTITIAL_ASSET_STARTED,{asset:u,assetListIndex:t,event:c,schedule:s.slice(0),scheduleIndex:a,player:e})),this.bufferAssetPlayer(e,l)}bufferAssetPlayer(e,t){var s,a;if(!this.schedule)return;const{interstitial:l,assetItem:c}=e,u=this.schedule.findEventIndex(l.identifier),f=(s=this.schedule.items)==null?void 0:s[u];if(!f)return;e.loadSource(),this.setBufferingItem(f),this.bufferingAsset=c;const d=this.getBufferingPlayer();if(d===e)return;const m=l.appendInPlace;if(m&&d?.interstitial.appendInPlace===!1)return;const g=d?.tracks||((a=this.detachedData)==null?void 0:a.tracks)||this.requiredTracks;if(m&&c!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(g&&!nS(g,e.tracks)){const y=new Error(`Asset ${go(c)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(g)}')`),x={fatal:!0,type:et.OTHER_ERROR,details:be.INTERSTITIAL_ASSET_ITEM_ERROR,error:y},v=l.findAssetIndex(c);this.handleAssetItemError(x,l,u,v,y.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,s=this.primaryMedia;if(!t||!s)return;const a=s.currentTime,l=t.findAssetIndex(e,a),c=e.assetList[l];if(c){const u=this.getAssetPlayer(c.identifier);if(u){const f=u.currentTime||a-c.timelineStart,d=u.duration-f;if(this.warn(`Stalled at ${f} of ${f+d} in ${u} ${e} (media.currentTime: ${a})`),f&&(d/s.playbackRate<.5||u.bufferedInPlaceToEnd(s))&&u.hls){const m=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,m,l)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,s,a,l){if(e.details===be.BUFFER_STALLED_ERROR)return;const c=t.assetList[a]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${c&&go(c)} ${e.error}`),!this.schedule)return;const u=c?.identifier||"",f=this.getAssetPlayerQueueIndex(u),d=this.playerQueue[f]||null,m=this.schedule.items,g=Xt({},e,{fatal:!1,errorAction:_o(!0),asset:c,assetListIndex:a,event:t,schedule:m,scheduleIndex:s,player:d});if(this.hls.trigger(B.INTERSTITIAL_ASSET_ERROR,g),!e.fatal)return;const y=this.playingAsset,x=this.bufferingAsset,v=new Error(l);if(c&&(this.clearAssetPlayer(u,null),c.error=v),!t.assetList.some(E=>!E.error))t.error=v;else for(let E=a;E<t.assetList.length;E++)this.resetAssetPlayer(t.assetList[E].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):y&&y.identifier===u?this.advanceAfterAssetEnded(t,s,a):x&&x.identifier===u&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,x)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;let a=this.timelinePos;if(s){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${a} playing: ${sn(s)} error: ${e.error}`),a===-1&&(a=this.hls.startPosition);const c=this.updateItem(s,a);this.itemsMatch(s,c)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(a===-1){this.checkStart();return}if(!this.schedule)return;const l=this.schedule.findItemIndexAtTime(a);this.setSchedulePosition(l)}onAssetListLoaded(e,t){var s,a;const l=t.event,c=l.identifier,u=t.assetListResponse.ASSETS;if(!((s=this.schedule)!=null&&s.hasEvent(c)))return;const f=l.timelineStart,d=l.duration;let m=0;u.forEach((E,A)=>{const R=parseFloat(E.DURATION);this.createAsset(l,A,m,f+m,R,E.URI),m+=R}),l.duration=m,this.log(`Loaded asset-list with duration: ${m} (was: ${d}) ${l}`);const g=this.waitingItem,y=g?.event.identifier===c;this.updateSchedule();const x=(a=this.bufferingItem)==null?void 0:a.event;if(y){var v;const E=this.schedule.findEventIndex(c),A=(v=this.schedule.items)==null?void 0:v[E];if(A){if(!this.playingItem&&this.timelinePos>A.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==E){l.error=new Error(`Interstitial ${u.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${l}`),this.log(l.error.message),this.updateSchedule(!0),this.primaryFallback(l);return}this.setBufferingItem(A)}this.setSchedulePosition(E)}else if(x?.identifier===c){const E=l.assetList[0];if(E){const A=this.getAssetPlayer(E.identifier);if(x.appendInPlace){const R=this.primaryMedia;A&&R&&this.bufferAssetPlayer(A,R)}else A&&A.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case be.ASSET_LIST_PARSING_ERROR:case be.ASSET_LIST_LOAD_ERROR:case be.ASSET_LIST_LOAD_TIMEOUT:{const s=t.interstitial;s&&(this.updateSchedule(!0),this.primaryFallback(s));break}case be.BUFFER_STALLED_ERROR:{const s=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&s.event.appendInPlace){this.handleInPlaceStall(s.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const T_=500;class lO extends Dg{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",Xe.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(B.LEVEL_LOADED,this.onLevelLoaded,this),e.on(B.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(B.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(B.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(B.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(B.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(B.LEVEL_LOADED,this.onLevelLoaded,this),e.off(B.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(B.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(B.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(B.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(B.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=je.IDLE,this.setInterval(T_),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:a}=t;if(this.fragContextChanged(s)||(_s(s)&&(this.fragPrevious=s),this.state=je.IDLE),!a)return;const l=this.tracksBuffered[this.currentTrackId];if(!l)return;let c;const u=s.start;for(let d=0;d<l.length;d++)if(u>=l[d].start&&u<=l[d].end){c=l[d];break}const f=s.start+s.duration;c?c.end=f:(c={start:u,end:f},l.push(c)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:a}=t;if(s===0&&a!==Number.POSITIVE_INFINITY){const l=a-1;if(l<=0)return;t.endOffsetSubtitles=Math.max(0,l),this.tracksBuffered.forEach(c=>{for(let u=0;u<c.length;){if(c[u].end<=l){c.shift();continue}else if(c[u].start<l)c[u].start=l;else break;u++}}),this.fragmentTracker.removeFragmentsInRange(s,l,Xe.SUBTITLE)}}onError(e,t){const s=t.frag;s?.type===Xe.SUBTITLE&&(t.details===be.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==je.STOPPED&&(this.state=je.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&oE(this.levels,t)){this.levels=t.map(s=>new Vl(s));return}this.tracksBuffered=[],this.levels=t.map(s=>{const a=new Vl(s);return this.tracksBuffered[a.id]=[],a}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Xe.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,!((s=this.levels)!=null&&s.length)||this.currentTrackId===-1){this.clearInterval();return}const a=this.levels[this.currentTrackId];a!=null&&a.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,a&&this.state!==je.STOPPED&&this.setInterval(T_)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:a,levels:l}=this,{details:c,id:u}=t;if(!l){this.warn(`Subtitle tracks were reset while loading level ${u}`);return}const f=l[u];if(u>=l.length||!f)return;this.log(`Subtitle track ${u} loaded [${c.startSN},${c.endSN}]${c.lastPartSn?`[part-${c.lastPartSn}-${c.lastPartIndex}]`:""},duration:${c.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let d=0;if(c.live||(s=f.details)!=null&&s.live){if(c.deltaUpdateFailed)return;const g=this.mainDetails;if(!g){this.startFragRequested=!1;return}const y=g.fragments[0];if(!f.details)c.hasProgramDateTime&&g.hasProgramDateTime?(od(c,g),d=c.fragmentStart):y&&(d=y.start,Im(c,d));else{var m;d=this.alignPlaylists(c,f.details,(m=this.levelLastLoaded)==null?void 0:m.details),d===0&&y&&(d=y.start,Im(c,d))}g&&!this.startFragRequested&&this.setStartPosition(g,d)}f.details=c,this.levelLastLoaded=f,u===a&&(this.hls.trigger(B.SUBTITLE_TRACK_UPDATED,{details:c,id:u,groupId:t.groupId}),this.tick(),c.live&&!this.fragCurrent&&this.media&&this.state===je.IDLE&&(Sr(null,c.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),f.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,a=t.decryptdata,l=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&a!=null&&a.key&&a.iv&&bo(a.method)){const c=performance.now();this.decrypter.decrypt(new Uint8Array(s),a.key.buffer,a.iv.buffer,Cg(a.method)).catch(u=>{throw l.trigger(B.ERROR,{type:et.MEDIA_ERROR,details:be.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:t}),u}).then(u=>{const f=performance.now();l.trigger(B.FRAG_DECRYPTED,{frag:t,payload:u,stats:{tstart:c,tdecrypt:f}})}).catch(u=>{this.warn(`${u.name}: ${u.message}`),this.state=je.IDLE})}}doTick(){if(!this.media){this.state=je.IDLE;return}if(this.state===je.IDLE){const{currentTrackId:e,levels:t}=this,s=t?.[e];if(!s||!t.length||!s.details||this.waitForLive(s))return;const{config:a}=this,l=this.getLoadPosition(),c=pt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],l,a.maxBufferHole),{end:u,len:f}=c,d=s.details,m=this.hls.maxBufferLength+d.levelTargetDuration;if(f>m)return;const g=d.fragments,y=g.length,x=d.edge;let v=null;const E=this.fragPrevious;if(u<x){const D=a.maxFragLookUpTolerance,L=u>x-D?0:D;v=Sr(E,g,Math.max(g[0].start,u),L),!v&&E&&E.start<g[0].start&&(v=g[0])}else v=g[y-1];if(v=this.filterReplacedPrimary(v,s.details),!v)return;const A=v.sn-d.startSN,R=g[A-1];if(R&&R.cc===v.cc&&this.fragmentTracker.getState(R)===Is.NOT_LOADED&&(v=R),this.fragmentTracker.getState(v)===Is.NOT_LOADED){const D=this.mapToInitFragWhenRequired(v);D&&this.loadFragment(D,s,u)}}}loadFragment(e,t,s){_s(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new cO(this.tracksBuffered[this.currentTrackId]||[])}}class cO{constructor(e){this.buffered=void 0;const t=(s,a,l)=>{if(a=a>>>0,a>l-1)throw new DOMException(`Failed to execute '${s}' on 'TimeRanges': The index provided (${a}) is greater than the maximum bound (${l})`);return e[a][s]};this.buffered={get length(){return e.length},end(s){return t("end",s,e.length)},start(s){return t("start",s,e.length)}}}}const uO={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},EE=i=>String.fromCharCode(uO[i]||i),nn=15,Kn=100,dO={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},hO={17:2,18:4,21:6,22:8,23:10,19:13,20:15},fO={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},mO={25:2,26:4,29:6,30:8,31:10,27:13,28:15},gO=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class pO{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s=typeof t=="function"?t():t;zt.log(`${this.time} [${e}] ${s}`)}}}const ar=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class TE{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const a=t[s];e.hasOwnProperty(a)&&(this[a]=e[a])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class yO{constructor(){this.uchar=" ",this.penState=new TE}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class xO{constructor(e){this.chars=[],this.pos=0,this.currPenState=new TE,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Kn;t++)this.chars.push(new yO);this.logger=e}equals(e){for(let t=0;t<Kn;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Kn;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Kn;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Kn&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Kn)}moveCursor(e){const t=this.pos+e;if(e>1)for(let s=this.pos+1;s<t+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=EE(e);if(this.pos>=Kn){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Kn;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<Kn;s++){const a=this.chars[s].uchar;a!==" "&&(t=!1),e.push(a)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Jf{constructor(e){this.rows=[],this.currRow=nn-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<nn;t++)this.rows.push(new xO(e));this.logger=e}reset(){for(let e=0;e<nn;e++)this.rows[e].clear();this.currRow=nn-1}equals(e){let t=!0;for(let s=0;s<nn;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<nn;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<nn;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Jt(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let u=0;u<nn;u++)this.rows[u].clear();const l=this.currRow+1-this.nrRollUpRows,c=this.lastOutputScreen;if(c){const u=c.rows[l].cueStartTime,f=this.logger.time;if(u!==null&&f!==null&&u<f)for(let d=0;d<this.nrRollUpRows;d++)this.rows[t-this.nrRollUpRows+d+1].copy(c.rows[l+d])}}this.currRow=t;const s=this.rows[this.currRow];if(e.indent!==null){const l=e.indent,c=Math.max(l-1,0);s.setCursor(e.indent),e.color=s.chars[c].penState.foreground}const a={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(a)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Jt(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",a=-1;for(let l=0;l<nn;l++){const c=this.rows[l].getTextString();c&&(a=l+1,e?t.push("Row "+a+": '"+c+"'"):t.push(c.trim()))}return t.length>0&&(e?s="["+t.join(" | ")+"]":s=t.join(`
`)),s}getTextAndFormat(){return this.rows}}class A_{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Jf(s),this.nonDisplayedMemory=new Jf(s),this.lastOutputScreen=new Jf(s),this.currRollUpRow=this.displayedMemory.rows[nn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[nn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let s=0;s<e.length;s++)this.writeScreen.insertChar(e[s]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,a=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=a[s]}this.logger.log(2,"MIDROW: "+Jt(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class w_{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=_O(),this.logger=void 0;const a=this.logger=new pO;this.channels=[null,new A_(e,t,a),new A_(e+1,s,a)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let s=0;s<t.length;s+=2){const a=t[s]&127,l=t[s+1]&127;let c=!1,u=null;if(a===0&&l===0)continue;this.logger.log(3,()=>"["+ar([t[s],t[s+1]])+"] -> ("+ar([a,l])+")");const f=this.cmdHistory;if(a>=16&&a<=31){if(vO(a,l,f)){Nu(null,null,f),this.logger.log(3,()=>"Repeated command ("+ar([a,l])+") is dropped");continue}Nu(a,l,this.cmdHistory),c=this.parseCmd(a,l),c||(c=this.parseMidrow(a,l)),c||(c=this.parsePAC(a,l)),c||(c=this.parseBackgroundAttributes(a,l))}else Nu(null,null,f);if(!c&&(u=this.parseChars(a,l),u)){const m=this.currentChannel;m&&m>0?this.channels[m].insertChars(u):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!c&&!u&&this.logger.log(2,()=>"Couldn't parse cleaned data "+ar([a,l])+" orig: "+ar([t[s],t[s+1]]))}}parseCmd(e,t){const s=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,a=(e===23||e===31)&&t>=33&&t<=35;if(!(s||a))return!1;const l=e===20||e===21||e===23?1:2,c=this.channels[l];return e===20||e===21||e===28||e===29?t===32?c.ccRCL():t===33?c.ccBS():t===34?c.ccAOF():t===35?c.ccAON():t===36?c.ccDER():t===37?c.ccRU(2):t===38?c.ccRU(3):t===39?c.ccRU(4):t===40?c.ccFON():t===41?c.ccRDC():t===42?c.ccTR():t===43?c.ccRTD():t===44?c.ccEDM():t===45?c.ccCR():t===46?c.ccENM():t===47&&c.ccEOC():c.ccTO(t-32),this.currentChannel=l,!0}parseMidrow(e,t){let s=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?s=1:s=2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const a=this.channels[s];return a?(a.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+ar([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let s;const a=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,l=(e===16||e===24)&&t>=64&&t<=95;if(!(a||l))return!1;const c=e<=23?1:2;t>=64&&t<=95?s=c===1?dO[e]:fO[e]:s=c===1?hO[e]:mO[e];const u=this.channels[c];return u?(u.setPAC(this.interpretPAC(s,t)),this.currentChannel=c,!0):!1}interpretPAC(e,t){let s;const a={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?s=t-96:s=t-64,a.underline=(s&1)===1,s<=13?a.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(a.italics=!0,a.color="white"):a.indent=Math.floor((s-16)/2)*4,a}parseChars(e,t){let s,a=null,l=null;if(e>=25?(s=2,l=e-8):(s=1,l=e),l>=17&&l<=19){let c;l===17?c=t+80:l===18?c=t+112:c=t+144,this.logger.log(2,()=>"Special char '"+EE(c)+"' in channel "+s),a=[c]}else e>=32&&e<=127&&(a=t===0?[e]:[e,t]);return a&&this.logger.log(3,()=>"Char codes =  "+ar(a).join(",")),a}parseBackgroundAttributes(e,t){const s=(e===16||e===24)&&t>=32&&t<=47,a=(e===23||e===31)&&t>=45&&t<=47;if(!(s||a))return!1;let l;const c={};e===16||e===24?(l=Math.floor((t-32)/2),c.background=gO[l],t%2===1&&(c.background=c.background+"_semi")):t===45?c.background="transparent":(c.foreground="black",t===47&&(c.underline=!0));const u=e<=23?1:2;return this.channels[u].setBkgData(c),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Nu(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function Nu(i,e,t){t.a=i,t.b=e}function vO(i,e,t){return t.a===i&&t.b===e}function _O(){return{a:null,b:null}}var Vg=(function(){if(rd!=null&&rd.VTTCue)return self.VTTCue;const i=["","lr","rl"],e=["start","middle","end","left","right"];function t(u,f){if(typeof f!="string"||!Array.isArray(u))return!1;const d=f.toLowerCase();return~u.indexOf(d)?d:!1}function s(u){return t(i,u)}function a(u){return t(e,u)}function l(u,...f){let d=1;for(;d<arguments.length;d++){const m=arguments[d];for(const g in m)u[g]=m[g]}return u}function c(u,f,d){const m=this,g={enumerable:!0};m.hasBeenReset=!1;let y="",x=!1,v=u,E=f,A=d,R=null,D="",L=!0,O="auto",H="start",q=50,U="middle",k=50,M="middle";Object.defineProperty(m,"id",l({},g,{get:function(){return y},set:function(I){y=""+I}})),Object.defineProperty(m,"pauseOnExit",l({},g,{get:function(){return x},set:function(I){x=!!I}})),Object.defineProperty(m,"startTime",l({},g,{get:function(){return v},set:function(I){if(typeof I!="number")throw new TypeError("Start time must be set to a number.");v=I,this.hasBeenReset=!0}})),Object.defineProperty(m,"endTime",l({},g,{get:function(){return E},set:function(I){if(typeof I!="number")throw new TypeError("End time must be set to a number.");E=I,this.hasBeenReset=!0}})),Object.defineProperty(m,"text",l({},g,{get:function(){return A},set:function(I){A=""+I,this.hasBeenReset=!0}})),Object.defineProperty(m,"region",l({},g,{get:function(){return R},set:function(I){R=I,this.hasBeenReset=!0}})),Object.defineProperty(m,"vertical",l({},g,{get:function(){return D},set:function(I){const j=s(I);if(j===!1)throw new SyntaxError("An invalid or illegal string was specified.");D=j,this.hasBeenReset=!0}})),Object.defineProperty(m,"snapToLines",l({},g,{get:function(){return L},set:function(I){L=!!I,this.hasBeenReset=!0}})),Object.defineProperty(m,"line",l({},g,{get:function(){return O},set:function(I){if(typeof I!="number"&&I!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");O=I,this.hasBeenReset=!0}})),Object.defineProperty(m,"lineAlign",l({},g,{get:function(){return H},set:function(I){const j=a(I);if(!j)throw new SyntaxError("An invalid or illegal string was specified.");H=j,this.hasBeenReset=!0}})),Object.defineProperty(m,"position",l({},g,{get:function(){return q},set:function(I){if(I<0||I>100)throw new Error("Position must be between 0 and 100.");q=I,this.hasBeenReset=!0}})),Object.defineProperty(m,"positionAlign",l({},g,{get:function(){return U},set:function(I){const j=a(I);if(!j)throw new SyntaxError("An invalid or illegal string was specified.");U=j,this.hasBeenReset=!0}})),Object.defineProperty(m,"size",l({},g,{get:function(){return k},set:function(I){if(I<0||I>100)throw new Error("Size must be between 0 and 100.");k=I,this.hasBeenReset=!0}})),Object.defineProperty(m,"align",l({},g,{get:function(){return M},set:function(I){const j=a(I);if(!j)throw new SyntaxError("An invalid or illegal string was specified.");M=j,this.hasBeenReset=!0}})),m.displayState=void 0}return c.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},c})();class bO{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function AE(i){function e(s,a,l,c){return(s|0)*3600+(a|0)*60+(l|0)+parseFloat(c||0)}const t=i.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class SO{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let a=0;a<s.length;++a)if(t===s[a]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function wE(i,e,t,s){const a=s?i.split(s):[i];for(const l in a){if(typeof a[l]!="string")continue;const c=a[l].split(t);if(c.length!==2)continue;const u=c[0],f=c[1];e(u,f)}}const Fm=new Vg(0,0,""),Ru=Fm.align==="middle"?"middle":"center";function EO(i,e,t){const s=i;function a(){const u=AE(i);if(u===null)throw new Error("Malformed timestamp: "+s);return i=i.replace(/^[^\sa-zA-Z-]+/,""),u}function l(u,f){const d=new SO;wE(u,function(y,x){let v;switch(y){case"region":for(let E=t.length-1;E>=0;E--)if(t[E].id===x){d.set(y,t[E].region);break}break;case"vertical":d.alt(y,x,["rl","lr"]);break;case"line":v=x.split(","),d.integer(y,v[0]),d.percent(y,v[0])&&d.set("snapToLines",!1),d.alt(y,v[0],["auto"]),v.length===2&&d.alt("lineAlign",v[1],["start",Ru,"end"]);break;case"position":v=x.split(","),d.percent(y,v[0]),v.length===2&&d.alt("positionAlign",v[1],["start",Ru,"end","line-left","line-right","auto"]);break;case"size":d.percent(y,x);break;case"align":d.alt(y,x,["start",Ru,"end","left","right"]);break}},/:/,/\s/),f.region=d.get("region",null),f.vertical=d.get("vertical","");let m=d.get("line","auto");m==="auto"&&Fm.line===-1&&(m=-1),f.line=m,f.lineAlign=d.get("lineAlign","start"),f.snapToLines=d.get("snapToLines",!0),f.size=d.get("size",100),f.align=d.get("align",Ru);let g=d.get("position","auto");g==="auto"&&Fm.position===50&&(g=f.align==="start"||f.align==="left"?0:f.align==="end"||f.align==="right"?100:50),f.position=g}function c(){i=i.replace(/^\s+/,"")}if(c(),e.startTime=a(),c(),i.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+s);i=i.slice(3),c(),e.endTime=a(),c(),l(i,e)}function NE(i){return i.replace(/<br(?: \/)?>/gi,`
`)}class TO{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new bO,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function s(){let l=t.buffer,c=0;for(l=NE(l);c<l.length&&l[c]!=="\r"&&l[c]!==`
`;)++c;const u=l.slice(0,c);return l[c]==="\r"&&++c,l[c]===`
`&&++c,t.buffer=l.slice(c),u}function a(l){wE(l,function(c,u){},/:/)}try{let l="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;l=s();const u=l.match(/^()?WEBVTT([ \t].*)?$/);if(!(u!=null&&u[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let c=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(c?c=!1:l=s(),t.state){case"HEADER":/:/.test(l)?a(l):l||(t.state="ID");continue;case"NOTE":l||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(l)){t.state="NOTE";break}if(!l)continue;if(t.cue=new Vg(0,0,""),t.state="CUE",l.indexOf("-->")===-1){t.cue.id=l;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{EO(l,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const u=l.indexOf("-->")!==-1;if(!l||u&&(c=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=l}continue;case"BADCUE":l||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const AO=/\r\n|\n\r|\n|\r/g,em=function(e,t,s=0){return e.slice(s,s+t.length)===t},wO=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),a=parseInt(e.slice(-9,-7)),l=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!We(t)||!We(s)||!We(a)||!We(l))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=60*1e3*a,t+=3600*1e3*l,t};function Hg(i,e,t){return Bl(i.toString())+Bl(e.toString())+Bl(t)}const NO=function(e,t,s){let a=e[t],l=e[a.prevCC];if(!l||!l.new&&a.new){e.ccOffset=e.presentationOffset=a.start,a.new=!1;return}for(;(c=l)!=null&&c.new;){var c;e.ccOffset+=a.start-l.start,a.new=!1,a=l,l=e[a.prevCC]}e.presentationOffset=s};function RO(i,e,t,s,a,l,c){const u=new TO,f=Ci(new Uint8Array(i)).trim().replace(AO,`
`).split(`
`),d=[],m=e?MM(e.baseTime,e.timescale):0;let g="00:00.000",y=0,x=0,v,E=!0;u.oncue=function(A){const R=t[s];let D=t.ccOffset;const L=(y-m)/9e4;if(R!=null&&R.new&&(x!==void 0?D=t.ccOffset=R.start:NO(t,s,L)),L){if(!e){v=new Error("Missing initPTS for VTT MPEGTS");return}D=L-t.presentationOffset}const O=A.endTime-A.startTime,H=wi((A.startTime+D-x)*9e4,a*9e4)/9e4;A.startTime=Math.max(H,0),A.endTime=Math.max(H+O,0);const q=A.text.trim();A.text=decodeURIComponent(encodeURIComponent(q)),A.id||(A.id=Hg(A.startTime,A.endTime,q)),A.endTime>0&&d.push(A)},u.onparsingerror=function(A){v=A},u.onflush=function(){if(v){c(v);return}l(d)},f.forEach(A=>{if(E)if(em(A,"X-TIMESTAMP-MAP=")){E=!1,A.slice(16).split(",").forEach(R=>{em(R,"LOCAL:")?g=R.slice(6):em(R,"MPEGTS:")&&(y=parseInt(R.slice(7)))});try{x=wO(g)/1e3}catch(R){v=R}return}else A===""&&(E=!1);u.parse(A+`
`)}),u.flush()}const tm="stpp.ttml.im1t",RE=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,CE=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,CO={left:"start",center:"center",right:"end",start:"start",end:"end"};function N_(i,e,t,s){const a=Tt(new Uint8Array(i),["mdat"]);if(a.length===0){s(new Error("Could not parse IMSC1 mdat"));return}const l=a.map(u=>Ci(u)),c=kM(e.baseTime,1,e.timescale);try{l.forEach(u=>t(LO(u,c)))}catch(u){s(u)}}function LO(i,e){const a=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("tt")[0];if(!a)throw new Error("Invalid ttml");const l={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},c=Object.keys(l).reduce((g,y)=>(g[y]=a.getAttribute(`ttp:${y}`)||l[y],g),{}),u=a.getAttribute("xml:space")!=="preserve",f=R_(sm(a,"styling","style")),d=R_(sm(a,"layout","region")),m=sm(a,"body","[begin]");return[].map.call(m,g=>{const y=LE(g,u);if(!y||!g.hasAttribute("begin"))return null;const x=nm(g.getAttribute("begin"),c),v=nm(g.getAttribute("dur"),c);let E=nm(g.getAttribute("end"),c);if(x===null)throw C_(g);if(E===null){if(v===null)throw C_(g);E=x+v}const A=new Vg(x-e,E-e,y);A.id=Hg(A.startTime,A.endTime,A.text);const R=d[g.getAttribute("region")],D=f[g.getAttribute("style")],L=DO(R,D,f),{textAlign:O}=L;if(O){const H=CO[O];H&&(A.lineAlign=H),A.align=O}return Xt(A,L),A}).filter(g=>g!==null)}function sm(i,e,t){const s=i.getElementsByTagName(e)[0];return s?[].slice.call(s.querySelectorAll(t)):[]}function R_(i){return i.reduce((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e},{})}function LE(i,e){return[].slice.call(i.childNodes).reduce((t,s,a)=>{var l;return s.nodeName==="br"&&a?t+`
`:(l=s.childNodes)!=null&&l.length?LE(s,e):e?t+s.textContent.trim().replace(/\s+/g," "):t+s.textContent},"")}function DO(i,e,t){const s="http://www.w3.org/ns/ttml#styling";let a=null;const l=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],c=i!=null&&i.hasAttribute("style")?i.getAttribute("style"):null;return c&&t.hasOwnProperty(c)&&(a=t[c]),l.reduce((u,f)=>{const d=im(e,s,f)||im(i,s,f)||im(a,s,f);return d&&(u[f]=d),u},{})}function im(i,e,t){return i&&i.hasAttributeNS(e,t)?i.getAttributeNS(e,t):null}function C_(i){return new Error(`Could not parse ttml timestamp ${i}`)}function nm(i,e){if(!i)return null;let t=AE(i);return t===null&&(RE.test(i)?t=IO(i,e):CE.test(i)&&(t=kO(i,e))),t}function IO(i,e){const t=RE.exec(i),s=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+s/e.frameRate}function kO(i,e){const t=CE.exec(i),s=Number(t[1]);switch(t[2]){case"h":return s*3600;case"m":return s*60;case"ms":return s*1e3;case"f":return s/e.frameRate;case"t":return s/e.tickRate}return s}class Cu{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class MO{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=D_(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(B.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(B.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(B.MANIFEST_LOADING,this.onManifestLoading,this),e.on(B.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(B.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(B.FRAG_LOADING,this.onFragLoading,this),e.on(B.FRAG_LOADED,this.onFragLoaded,this),e.on(B.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(B.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(B.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(B.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(B.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(B.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(B.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(B.MANIFEST_LOADING,this.onManifestLoading,this),e.off(B.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(B.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(B.FRAG_LOADING,this.onFragLoading,this),e.off(B.FRAG_LOADED,this.onFragLoaded,this),e.off(B.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(B.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(B.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(B.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(B.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Cu(this,"textTrack1"),t=new Cu(this,"textTrack2"),s=new Cu(this,"textTrack3"),a=new Cu(this,"textTrack4");this.cea608Parser1=new w_(1,e,t),this.cea608Parser2=new w_(3,s,a)}addCues(e,t,s,a,l){let c=!1;for(let u=l.length;u--;){const f=l[u],d=jO(f[0],f[1],t,s);if(d>=0&&(f[0]=Math.min(f[0],t),f[1]=Math.max(f[1],s),c=!0,d/(s-t)>.5))return}if(c||l.push([t,s]),this.config.renderTextTracksNatively){const u=this.captionsTracks[e];this.Cues.newCue(u,t,s,a)}else{const u=this.Cues.newCue(null,t,s,a);this.hls.trigger(B.CUES_PARSED,{type:"captions",cues:u,track:e})}}onInitPtsFound(e,{frag:t,id:s,initPTS:a,timescale:l,trackId:c}){const{unparsedVttFrags:u}=this;s===Xe.MAIN&&(this.initPTS[t.cc]={baseTime:a,timescale:l,trackId:c}),u.length&&(this.unparsedVttFrags=[],u.forEach(f=>{this.initPTS[f.frag.cc]?this.onFragLoaded(B.FRAG_LOADED,f):this.hls.trigger(B.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:f.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let a=0;a<s.textTracks.length;a++){const l=s.textTracks[a];if(L_(l,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return l}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:a}=this,{label:l,languageCode:c}=t[e],u=this.getExistingTrack(l,c);if(u)s[e]=u,po(s[e]),_E(s[e],a);else{const f=this.createTextTrack("captions",l,c);f&&(f[e]=!0,s[e]=f)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s=t.label,a={_id:e,label:s,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=a,this.hls.trigger(B.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[a]})}createTextTrack(e,t,s){const a=this.media;if(a)return a.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:a}=this;Object.keys(a).forEach(l=>{po(a[l]),delete a[l]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=D_(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let s=0;s<t.length;s++)po(t[s])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],a=s.some(l=>l.textCodec===tm);if(this.config.enableWebVTT||a&&this.config.enableIMSC1){if(oE(this.tracks,s)){this.tracks=s;return}if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const c=this.media,u=c?zu(c.textTracks):null;if(this.tracks.forEach((f,d)=>{let m;if(u){let g=null;for(let y=0;y<u.length;y++)if(u[y]&&L_(u[y],f)){g=u[y],u[y]=null;break}g&&(m=g)}if(m)po(m);else{const g=DE(f);m=this.createTextTrack(g,f.name,f.lang),m&&(m.mode="disabled")}m&&this.textTracks.push(m)}),u!=null&&u.length){const f=u.filter(d=>d!==null).map(d=>d.label);f.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${f.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const c=this.tracks.map(u=>({label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}));this.hls.trigger(B.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:c})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(s=>{const a=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(!a)return;const l=`textTrack${a[1]}`,c=this.captionsProperties[l];c&&(c.label=s.name,s.lang&&(c.languageCode=s.lang),c.media=s)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Xe.MAIN){var s,a;const{cea608Parser1:l,cea608Parser2:c,lastSn:u}=this,{cc:f,sn:d}=t.frag,m=(s=(a=t.part)==null?void 0:a.index)!=null?s:-1;l&&c&&(d!==u+1||d===u&&m!==this.lastPartIndex+1||f!==this.lastCc)&&(l.reset(),c.reset()),this.lastCc=f,this.lastSn=d,this.lastPartIndex=m}}onFragLoaded(e,t){const{frag:s,payload:a}=t;if(s.type===Xe.SUBTITLE)if(a.byteLength){const l=s.decryptdata,c="stats"in t;if(l==null||!l.encrypted||c){const u=this.tracks[s.level],f=this.vttCCs;f[s.cc]||(f[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),u&&u.textCodec===tm?this._parseIMSC1(s,a):this._parseVTTs(t)}}else this.hls.trigger(B.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;N_(t,this.initPTS[e.cc],a=>{this._appendCues(a,e.level),s.trigger(B.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},a=>{s.logger.log(`Failed to parse IMSC1: ${a}`),s.trigger(B.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:a})})}_parseVTTs(e){var t;const{frag:s,payload:a}=e,{initPTS:l,unparsedVttFrags:c}=this,u=l.length-1;if(!l[s.cc]&&u===-1){c.push(e);return}const f=this.hls,d=(t=s.initSegment)!=null&&t.data?qi(s.initSegment.data,new Uint8Array(a)).buffer:a;RO(d,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,m=>{this._appendCues(m,s.level),f.trigger(B.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},m=>{const g=m.message==="Missing initPTS for VTT MPEGTS";g?c.push(e):this._fallbackToIMSC1(s,a),f.logger.log(`Failed to parse VTT cue: ${m}`),!(g&&u>s.cc)&&f.trigger(B.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:m})})}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||N_(t,this.initPTS[e.cc],()=>{s.textCodec=tm,this._parseIMSC1(e,t)},()=>{s.textCodec="wvtt"})}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const a=this.textTracks[t];if(!a||a.mode==="disabled")return;e.forEach(l=>bE(a,l))}else{const a=this.tracks[t];if(!a)return;const l=a.default?"default":"subtitles"+t;s.trigger(B.CUES_PARSED,{type:"subtitles",cues:e,track:l})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===Xe.SUBTITLE&&this.onFragLoaded(B.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:a}=t;if(!(s.type===Xe.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let l=0;l<a.length;l++){const c=a[l].bytes;if(c){this.cea608Parser1||this.initCea608Parsers();const u=this.extractCea608Data(c);this.cea608Parser1.addData(a[l].pts,u[0]),this.cea608Parser2.addData(a[l].pts,u[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:s,endOffsetSubtitles:a,type:l}){const{media:c}=this;if(!(!c||c.currentTime<s)){if(!l||l==="video"){const{captionsTracks:u}=this;Object.keys(u).forEach(f=>Um(u[f],t,s))}if(this.config.renderTextTracksNatively&&t===0&&a!==void 0){const{textTracks:u}=this;Object.keys(u).forEach(f=>Um(u[f],t,a))}}}extractCea608Data(e){const t=[[],[]],s=e[0]&31;let a=2;for(let l=0;l<s;l++){const c=e[a++],u=127&e[a++],f=127&e[a++];if(u===0&&f===0)continue;if((4&c)!==0){const m=3&c;(m===0||m===1)&&(t[m].push(u),t[m].push(f))}}return t}}function DE(i){return i.characteristics&&/transcribes-spoken-dialog/gi.test(i.characteristics)&&/describes-music-and-sound/gi.test(i.characteristics)?"captions":"subtitles"}function L_(i,e){return!!i&&i.kind===DE(e)&&jm(e,i)}function jO(i,e,t,s){return Math.min(e,s)-Math.max(i,t)}function D_(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const OO=/\s/,PO={newCue(i,e,t,s){const a=[];let l,c,u,f,d;const m=self.VTTCue||self.TextTrackCue;for(let y=0;y<s.rows.length;y++)if(l=s.rows[y],u=!0,f=0,d="",!l.isEmpty()){var g;for(let E=0;E<l.chars.length;E++)OO.test(l.chars[E].uchar)&&u?f++:(d+=l.chars[E].uchar,u=!1);l.cueStartTime=e,e===t&&(t+=1e-4),f>=16?f--:f++;const x=NE(d.trim()),v=Hg(e,t,x);i!=null&&(g=i.cues)!=null&&g.getCueById(v)||(c=new m(e,t,x),c.id=v,c.line=y+1,c.align="left",c.position=10+Math.min(80,Math.floor(f*8/32)*10),a.push(c))}return i&&a.length&&(a.sort((y,x)=>y.line==="auto"||x.line==="auto"?0:y.line>8&&x.line>8?x.line-y.line:y.line-x.line),a.forEach(y=>bE(i,y))),a}};function BO(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const UO=/(\d+)-(\d+)\/(\d+)/;class I_{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||VO,this.controller=new self.AbortController,this.stats=new Sg}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();const l=FO(e,this.controller.signal),c=e.responseType==="arraybuffer",u=c?"byteLength":"length",{maxTimeToFirstByteMs:f,maxLoadTimeMs:d}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,l),self.clearTimeout(this.requestTimeout),t.timeout=f&&We(f)?f:d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(a,e,this.response))},t.timeout),(zl(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(g=>{var y;this.response=this.loader=g;const x=Math.max(self.performance.now(),a.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(a,e,this.response))},d-(x-a.loading.start)),!g.ok){const{status:E,statusText:A}=g;throw new HO(A||"fetch, bad network response",E,g)}a.loading.first=x,a.total=$O(g.headers)||a.total;const v=(y=this.callbacks)==null?void 0:y.onProgress;return v&&We(t.highWaterMark)?this.loadProgressively(g,a,e,t.highWaterMark,v):c?g.arrayBuffer():e.responseType==="json"?g.json():g.text()}).then(g=>{var y,x;const v=this.response;if(!v)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first);const E=g[u];E&&(a.loaded=a.total=E);const A={url:v.url,data:g,code:v.status},R=(y=this.callbacks)==null?void 0:y.onProgress;R&&!We(t.highWaterMark)&&R(a,e,g,v),(x=this.callbacks)==null||x.onSuccess(A,a,e,v)}).catch(g=>{var y;if(self.clearTimeout(this.requestTimeout),a.aborted)return;const x=g&&g.code||0,v=g?g.message:null;(y=this.callbacks)==null||y.onError({code:x,text:v},e,g?g.details:null,a)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s,a=0,l){const c=new GS,u=e.body.getReader(),f=()=>u.read().then(d=>{if(d.done)return c.dataLength&&l(t,s,c.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const m=d.value,g=m.length;return t.loaded+=g,g<a||c.dataLength?(c.push(m),c.dataLength>=a&&l(t,s,c.flush().buffer,e)):l(t,s,m.buffer,e),f()}).catch(()=>Promise.reject());return f()}}function FO(i,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Xt({},i.headers))};return i.rangeEnd&&t.headers.set("Range","bytes="+i.rangeStart+"-"+String(i.rangeEnd-1)),t}function GO(i){const e=UO.exec(i);if(e)return parseInt(e[2])-parseInt(e[1])+1}function $O(i){const e=i.get("Content-Range");if(e){const s=GO(e);if(We(s))return s}const t=i.get("Content-Length");if(t)return parseInt(t)}function VO(i,e){return new self.Request(i.url,e)}class HO extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const KO=/^age:\s*[\d.]+\s*$/im;class IE{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Sg,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,a=this.stats;a.loading.first=0,a.loaded=0,a.aborted=!1;const l=this.xhrSetup;l?Promise.resolve().then(()=>{if(!(this.loader!==s||this.stats.aborted))return l(s,t.url)}).catch(c=>{if(!(this.loader!==s||this.stats.aborted))return s.open("GET",t.url,!0),l(s,t.url)}).then(()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)}).catch(c=>{var u;(u=this.callbacks)==null||u.onError({code:s.status,text:c.message},t,s,a)}):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const a=t.headers,{maxTimeToFirstByteMs:l,maxLoadTimeMs:c}=s.loadPolicy;if(a)for(const u in a)e.setRequestHeader(u,a[u]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=l&&We(l)?l:c,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const a=t.readyState,l=this.config;if(!s.aborted&&a>=2&&(s.loading.first===0&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),l.timeout!==l.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),l.timeout=l.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),l.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),a===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const d=t.status,m=t.responseType==="text"?t.responseText:null;if(d>=200&&d<300){const v=m??t.response;if(v!=null){var c,u;s.loading.end=Math.max(self.performance.now(),s.loading.first);const E=t.responseType==="arraybuffer"?v.byteLength:v.length;s.loaded=s.total=E,s.bwEstimate=s.total*8e3/(s.loading.end-s.loading.first);const A=(c=this.callbacks)==null?void 0:c.onProgress;A&&A(s,e,v,t);const R={url:t.responseURL,data:v,code:d};(u=this.callbacks)==null||u.onSuccess(R,s,e,t);return}}const g=l.loadPolicy.errorRetry,y=s.retry,x={url:e.url,data:void 0,code:d};if(nd(g,y,!1,x))this.retry(g);else{var f;zt.error(`${d} while loading ${e.url}`),(f=this.callbacks)==null||f.onError({code:d,text:t.statusText},e,t,s)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(nd(e,t,!0))this.retry(e);else{var s;zt.warn(`timeout while loading ${(s=this.context)==null?void 0:s.url}`);const a=this.callbacks;a&&(this.abortInternal(),a.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=wg(e,s.retry),s.retry++,zt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&KO.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const zO={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},qO=Kt(Kt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:IE,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:ak,bufferController:WM,capLevelController:Fg,errorController:uk,fpsController:Xj,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:LS,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:zO},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},YO()),{},{subtitleStreamController:lO,subtitleTrackController:Jj,timelineController:MO,audioStreamController:KM,audioTrackController:zM,emeController:So,cmcdController:zj,contentSteeringController:Yj,interstitialsController:oO});function YO(){return{cueHandler:PO,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function WO(i,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const s=Gm(i),a=["manifest","level","frag"],l=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return a.forEach(c=>{const u=`${c==="level"?"playlist":c}LoadPolicy`,f=e[u]===void 0,d=[];l.forEach(m=>{const g=`${c}Loading${m}`,y=e[g];if(y!==void 0&&f){d.push(g);const x=s[u].default;switch(e[u]={default:x},m){case"TimeOut":x.maxLoadTimeMs=y,x.maxTimeToFirstByteMs=y;break;case"MaxRetry":x.errorRetry.maxNumRetry=y,x.timeoutRetry.maxNumRetry=y;break;case"RetryDelay":x.errorRetry.retryDelayMs=y,x.timeoutRetry.retryDelayMs=y;break;case"MaxRetryTimeout":x.errorRetry.maxRetryDelayMs=y,x.timeoutRetry.maxRetryDelayMs=y;break}}}),d.length&&t.warn(`hls.js config: "${d.join('", "')}" setting(s) are deprecated, use "${u}": ${Jt(e[u])}`)}),Kt(Kt({},s),e)}function Gm(i){return i&&typeof i=="object"?Array.isArray(i)?i.map(Gm):Object.keys(i).reduce((e,t)=>(e[t]=Gm(i[t]),e),{}):i}function XO(i,e){const t=i.loader;t!==I_&&t!==IE?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),i.progressive=!1):BO()&&(i.loader=I_,i.progressive=!0,i.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const qu=2,QO=.1,ZO=.05,JO=100;class e4 extends AS{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var s;(s=this.media)!=null&&s.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var s;this.ended=((s=this.media)==null?void 0:s.currentTime)||1,this.hls.trigger(B.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(B.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(B.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(B.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(B.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(B.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(B.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(JO),this.mediaSource=t.mediaSource;const s=this.media=t.media;si(s,"playing",this.onMediaPlaying),si(s,"waiting",this.onMediaWaiting),si(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&(di(s,"playing",this.onMediaPlaying),di(s,"waiting",this.onMediaWaiting),di(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,a;const l=(s=this.hls)==null?void 0:s.config;if(!l)return;const c=this.media;if(!c)return;const{seeking:u}=c,f=this.seeking&&!u,d=!this.seeking&&u,m=c.paused&&!u||c.ended||c.playbackRate===0;if(this.seeking=u,e!==t){t&&(this.ended=0),this.moved=!0,u||(this.nudgeRetry=0,l.nudgeOnVideoHole&&!m&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(d||f){f&&this.stallResolved(e);return}if(m){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&c.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(B.MEDIA_ENDED,{stalled:!1}));return}if(!pt.getBuffered(c).length){this.nudgeRetry=0;return}const g=pt.bufferInfo(c,e,0),y=g.nextStart||0,x=this.fragmentTracker;if(u&&x&&this.hls){const q=k_(this.hls.inFlightFragments,e),U=g.len>qu,k=!y||q||y-e>qu&&!x.getPartialFragment(e);if(U||k)return;this.moved=!1}const v=(a=this.hls)==null?void 0:a.latestLevelDetails;if(!this.moved&&this.stalled!==null&&x){if(!(g.len>0)&&!y)return;const U=Math.max(y,g.start||0)-e,M=!!(v!=null&&v.live)?v.targetduration*2:qu,I=Lu(e,x);if(U>0&&(U<=M||I)){c.paused||this._trySkipBufferHole(I);return}}const E=l.detectStallWithCurrentTimeMs,A=self.performance.now(),R=this.waiting;let D=this.stalled;if(D===null)if(R>0&&A-R<E)D=this.stalled=R;else{this.stalled=A;return}const L=A-D;if(!u&&(L>=E||R)&&this.hls){var O;if(((O=this.mediaSource)==null?void 0:O.readyState)==="ended"&&!(v!=null&&v.live)&&Math.abs(e-(v?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(B.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(g),!this.media||!this.hls)return}const H=pt.bufferInfo(c,e,l.maxBufferHole);this._tryFixBufferStall(H,L,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(B.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const a=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(s=this.buffered.audio)!=null&&s.length&&a&&a.length>1&&e>a.end(0)){const l=pt.bufferedInfo(pt.timeRangesToArray(this.buffered.audio),e,0);if(l.len>1&&t>=l.start){const c=pt.timeRangesToArray(a),u=pt.bufferedInfo(c,t,0).bufferedIndex;if(u>-1&&u<c.length-1){const f=pt.bufferedInfo(c,e,0).bufferedIndex,d=c[u].end,m=c[u+1].start;if((f===-1||f>u)&&m-d<1&&e-d<2){const g=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${d} -> ${m} buffered index: ${f}`);this.warn(g.message),this.media.currentTime+=1e-6;let y=Lu(e,this.fragmentTracker);y&&"fragment"in y?y=y.fragment:y||(y=void 0);const x=pt.bufferInfo(this.media,e,0);this.hls.trigger(B.ERROR,{type:et.MEDIA_ERROR,details:be.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,frag:y,buffer:x.len,bufferInfo:x})}}}}}_tryFixBufferStall(e,t,s){var a,l;const{fragmentTracker:c,media:u}=this,f=(a=this.hls)==null?void 0:a.config;if(!u||!c||!f)return;const d=(l=this.hls)==null?void 0:l.latestLevelDetails,m=Lu(s,c);if((m||d!=null&&d.live&&s<d.fragmentStart)&&(this._trySkipBufferHole(m)||!this.media))return;const g=e.buffered,y=this.adjacentTraversal(e,s);(g&&g.length>1&&e.len>f.maxBufferHole||e.nextStart&&(e.nextStart-s<f.maxBufferHole||y))&&(t>f.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const s=this.fragmentTracker,a=e.nextStart;if(s&&a){const l=s.getFragAtPos(t,Xe.MAIN),c=s.getFragAtPos(a,Xe.MAIN);if(l&&c)return c.sn-l.sn<2}return!1}_reportStall(e){const{hls:t,media:s,stallReported:a,stalled:l}=this;if(!a&&l!==null&&s&&t){this.stallReported=!0;const c=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${Jt(e)})`);this.warn(c.message),t.trigger(B.ERROR,{type:et.MEDIA_ERROR,details:be.BUFFER_STALLED_ERROR,fatal:!1,error:c,buffer:e.len,bufferInfo:e,stalled:{start:l}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:a}=this,l=(t=this.hls)==null?void 0:t.config;if(!a||!s||!l)return 0;const c=a.currentTime,u=pt.bufferInfo(a,c,0),f=c<u.start?u.start:u.nextStart;if(f&&this.hls){const m=u.len<=l.maxBufferHole,g=u.len>0&&u.len<1&&a.readyState<3,y=f-c;if(y>0&&(m||g)){if(y>l.maxBufferHole){let v=!1;if(c===0){const E=s.getAppendedFrag(0,Xe.MAIN);E&&f<E.end&&(v=!0)}if(!v&&e){var d;if(!((d=this.hls.loadLevelObj)!=null&&d.details)||k_(this.hls.inFlightFragments,f))return 0;let A=!1,R=e.end;for(;R<f;){const D=Lu(R,s);if(D)R+=D.duration;else{A=!0;break}}if(A)return 0}}const x=Math.max(f+ZO,c+QO);if(this.warn(`skipping hole, adjusting currentTime from ${c} to ${x}`),this.moved=!0,a.currentTime=x,!(e!=null&&e.gap)){const v=new Error(`fragment loaded with buffer holes, seeking from ${c} to ${x}`),E={type:et.MEDIA_ERROR,details:be.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:v,reason:v.message,buffer:u.len,bufferInfo:u};e&&("fragment"in e?E.part=e:E.frag=e),this.hls.trigger(B.ERROR,E)}return x}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:a}=this,l=t?.config;if(!s||!l)return 0;const c=s.currentTime;if(this.nudgeRetry++,a<l.nudgeMaxRetry){const u=c+(a+1)*l.nudgeOffset,f=new Error(`Nudging 'currentTime' from ${c} to ${u}`);this.warn(f.message),s.currentTime=u,t.trigger(B.ERROR,{type:et.MEDIA_ERROR,details:be.BUFFER_NUDGE_ON_STALL,error:f,fatal:!1,buffer:e.len,bufferInfo:e})}else{const u=new Error(`Playhead still not moving while enough data buffered @${c} after ${l.nudgeMaxRetry} nudges`);this.error(u.message),t.trigger(B.ERROR,{type:et.MEDIA_ERROR,details:be.BUFFER_STALLED_ERROR,error:u,fatal:!0,buffer:e.len,bufferInfo:e})}}}function k_(i,e){const t=M_(i.main);if(t&&t.start<=e)return t;const s=M_(i.audio);return s&&s.start<=e?s:null}function M_(i){if(!i)return null;switch(i.state){case je.IDLE:case je.STOPPED:case je.ENDED:case je.ERROR:return null}return i.frag}function Lu(i,e){return e.getAppendedFrag(i,Xe.MAIN)||e.getPartialFragment(i)}const t4=.25;function $m(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function am(i,e,t,s,a){let l=new i(e,t,"");try{l.value=s,a&&(l.type=a)}catch{l=new i(e,t,Jt(a?Kt({type:a},s):s))}return l}const Du=(()=>{const i=$m();try{i&&new i(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class s4{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(B.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(B.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(B.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(B.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(B.MANIFEST_LOADING,this.onManifestLoading,this),e.on(B.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(B.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(B.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(B.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(B.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(B.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(B.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(B.MANIFEST_LOADING,this.onManifestLoading,this),e.off(B.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(B.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(B.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(B.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var s;this.media=t.media,((s=t.overrides)==null?void 0:s.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&po(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if(s.kind==="metadata"&&s.label==="id3")return _E(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:s,enableID3MetadataCues:a}=this.hls.config;if(!s&&!a)return;const{samples:l}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const c=$m();if(c)for(let u=0;u<l.length;u++){const f=l[u].type;if(f===Ni.emsg&&!s||!a)continue;const d=YS(l[u].data),m=l[u].pts;let g=m+l[u].duration;g>Du&&(g=Du),g-m<=0&&(g=m+t4);for(let x=0;x<d.length;x++){const v=d[x];if(!WS(v)){this.updateId3CueEnds(m,f);const E=am(c,m,g,v,f);E&&this.id3Track.addCue(E)}}}}updateId3CueEnds(e,t){var s;const a=(s=this.id3Track)==null?void 0:s.cues;if(a)for(let l=a.length;l--;){const c=a[l];c.type===t&&c.startTime<e&&c.endTime===Du&&(c.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:s,type:a}){const{id3Track:l,hls:c}=this;if(!c)return;const{config:{enableEmsgMetadataCues:u,enableID3MetadataCues:f}}=c;if(l&&(u||f)){let d;a==="audio"?d=m=>m.type===Ni.audioId3&&f:a==="video"?d=m=>m.type===Ni.emsg&&u:d=m=>m.type===Ni.audioId3&&f||m.type===Ni.emsg&&u,Um(l,t,s,d)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:s,timelineOffset:a,enableDateRangeMetadataCues:l,interstitialsController:c}=this.hls.config;if(!l)return;const u=$m();if(s&&a&&!c){const{fragmentStart:E,fragmentEnd:A}=e;let R=this.assetCue;R?(R.startTime=E,R.endTime=A):u&&(R=this.assetCue=am(u,E,A,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),R&&(R.id=s,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(R),R.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:f}=this,{dateRanges:d}=e,m=Object.keys(d);let g=this.dateRangeCuesAppended;if(f&&t){var y;if((y=f.cues)!=null&&y.length){const E=Object.keys(g).filter(A=>!m.includes(A));for(let A=E.length;A--;){var x;const R=E[A],D=(x=g[R])==null?void 0:x.cues;delete g[R],D&&Object.keys(D).forEach(L=>{const O=D[L];if(O){O.removeEventListener("enter",this.onEventCueEnter);try{f.removeCue(O)}catch{}}})}}else g=this.dateRangeCuesAppended={}}const v=e.fragments[e.fragments.length-1];if(!(m.length===0||!We(v?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let E=0;E<m.length;E++){const A=m[E],R=d[A],D=R.startTime,L=g[A],O=L?.cues||{};let H=L?.durationKnown||!1,q=Du;const{duration:U,endDate:k}=R;if(k&&U!==null)q=D+U,H=!0;else if(R.endOnNext&&!H){const I=m.reduce((j,Z)=>{if(Z!==R.id){const ae=d[Z];if(ae.class===R.class&&ae.startDate>R.startDate&&(!j||R.startDate<j.startDate))return ae}return j},null);I&&(q=I.startTime,H=!0)}const M=Object.keys(R.attr);for(let I=0;I<M.length;I++){const j=M[I];if(!Ek(j))continue;const Z=O[j];if(Z)H&&!(L!=null&&L.durationKnown)?Z.endTime=q:Math.abs(Z.startTime-D)>.01&&(Z.startTime=D,Z.endTime=q);else if(u){let ae=R.attr[j];Tk(j)&&(ae=aS(ae));const re=am(u,D,q,{key:j,data:ae},Ni.dateRange);re&&(re.id=A,this.id3Track.addCue(re),O[j]=re,c&&(j==="X-ASSET-LIST"||j==="X-ASSET-URL")&&re.addEventListener("enter",this.onEventCueEnter))}}g[A]={cues:O,dateRange:R,durationKnown:H}}}}}class i4{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,s=this.levelDetails;if(!t||!s)return;this.currentTime=t.currentTime;const a=this.computeLatency();if(a===null)return;this._latency=a;const{lowLatencyMode:l,maxLiveSyncPlaybackRate:c}=this.config;if(!l||c===1||!s.live)return;const u=this.targetLatency;if(u===null)return;const f=a-u,d=Math.min(this.maxLatency,u+s.targetduration);if(f<d&&f>.05&&this.forwardBufferLength>1){const g=Math.min(2,Math.max(1,c)),y=Math.round(2/(1+Math.exp(-.75*f-this.edgeStalled))*20)/20,x=Math.min(g,Math.max(1,y));this.changeMediaPlaybackRate(t,x)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:s,targetduration:a}=e,{liveSyncDuration:l,liveSyncDurationCount:c,lowLatencyMode:u}=this.config,f=this.hls.userConfig;let d=u&&s||t;(this._targetLatencyUpdated||f.liveSyncDuration||f.liveSyncDurationCount||d===0)&&(d=l!==void 0?l:c*a);const m=a;return d+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,m)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const s=this.levelDetails;if(s===null)return null;const a=s.edge,l=e-t-this.edgeStalled,c=a-s.totalduration,u=a-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(c,l),u)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(B.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(B.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(B.MANIFEST_LOADING,this.onManifestLoading,this),e.on(B.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(B.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(B.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(B.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(B.MANIFEST_LOADING,this.onManifestLoading,this),e.off(B.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(B.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===be.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(s=this.levelDetails)!=null&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,a;e.playbackRate!==t&&((s=this.hls)==null||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(a=this.targetLatency)==null?void 0:a.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class n4 extends Ug{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(B.MANIFEST_LOADING,this.onManifestLoading,this),e.on(B.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(B.LEVEL_LOADED,this.onLevelLoaded,this),e.on(B.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(B.FRAG_BUFFERED,this.onFragBuffered,this),e.on(B.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(B.MANIFEST_LOADING,this.onManifestLoading,this),e.off(B.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(B.LEVEL_LOADED,this.onLevelLoaded,this),e.off(B.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(B.FRAG_BUFFERED,this.onFragBuffered,this),e.off(B.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,a=[],l={},c={};let u=!1,f=!1,d=!1;t.levels.forEach(m=>{const g=m.attrs;let{audioCodec:y,videoCodec:x}=m;y&&(m.audioCodec=y=ed(y,s)||void 0),x&&(x=m.videoCodec=FI(x));const{width:v,height:E,unknownCodecs:A}=m,R=A?.length||0;if(u||(u=!!(v&&E)),f||(f=!!x),d||(d=!!y),R||y&&!this.isAudioSupported(y)||x&&!this.isVideoSupported(x)){this.log(`Some or all CODECS not supported "${g.CODECS}"`);return}const{CODECS:D,"FRAME-RATE":L,"HDCP-LEVEL":O,"PATHWAY-ID":H,RESOLUTION:q,"VIDEO-RANGE":U}=g,M=`${`${H||"."}-`}${m.bitrate}-${q}-${L}-${D}-${U}-${O}`;if(l[M])if(l[M].uri!==m.url&&!m.attrs["PATHWAY-ID"]){const I=c[M]+=1;m.attrs["PATHWAY-ID"]=new Array(I+1).join(".");const j=this.createLevel(m);l[M]=j,a.push(j)}else l[M].addGroupId("audio",g.AUDIO),l[M].addGroupId("text",g.SUBTITLES);else{const I=this.createLevel(m);l[M]=I,c[M]=1,a.push(I)}}),this.filterAndSortMediaOptions(a,t,u,f,d)}createLevel(e){const t=new Vl(e),s=e.supplemental;if(s!=null&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const a=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(a.message),t.supportedResult=yS(a,[])}return t}isAudioSupported(e){return Gl(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Gl(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,a,l){var c;let u=[],f=[],d=e;const m=((c=t.stats)==null?void 0:c.parsing)||{};if((s||a)&&l&&(d=d.filter(({videoCodec:D,videoRange:L,width:O,height:H})=>(!!D||!!(O&&H))&&XI(L))),d.length===0){Promise.resolve().then(()=>{if(this.hls){let D="no level with compatible codecs found in manifest",L=D;t.levels.length&&(L=`one or more CODECS in variant not supported: ${Jt(t.levels.map(H=>H.attrs.CODECS).filter((H,q,U)=>U.indexOf(H)===q))}`,this.warn(L),D+=` (${L})`);const O=new Error(D);this.hls.trigger(B.ERROR,{type:et.MEDIA_ERROR,details:be.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:O,reason:L})}}),m.end=performance.now();return}t.audioTracks&&(u=t.audioTracks.filter(D=>!D.audioCodec||this.isAudioSupported(D.audioCodec)),j_(u)),t.subtitles&&(f=t.subtitles,j_(f));const g=d.slice(0);d.sort((D,L)=>{if(D.attrs["HDCP-LEVEL"]!==L.attrs["HDCP-LEVEL"])return(D.attrs["HDCP-LEVEL"]||"")>(L.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&D.height!==L.height)return D.height-L.height;if(D.frameRate!==L.frameRate)return D.frameRate-L.frameRate;if(D.videoRange!==L.videoRange)return td.indexOf(D.videoRange)-td.indexOf(L.videoRange);if(D.videoCodec!==L.videoCodec){const O=wv(D.videoCodec),H=wv(L.videoCodec);if(O!==H)return H-O}if(D.uri===L.uri&&D.codecSet!==L.codecSet){const O=Ju(D.codecSet),H=Ju(L.codecSet);if(O!==H)return H-O}return D.averageBitrate!==L.averageBitrate?D.averageBitrate-L.averageBitrate:0});let y=g[0];if(this.steering&&(d=this.steering.filterParsedLevels(d),d.length!==g.length)){for(let D=0;D<g.length;D++)if(g[D].pathwayId===d[0].pathwayId){y=g[D];break}}this._levels=d;for(let D=0;D<d.length;D++)if(d[D]===y){var x;this._firstLevel=D;const L=y.bitrate,O=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${d.length} level(s) found, first bitrate: ${L}`),((x=this.hls.userConfig)==null?void 0:x.abrEwmaDefaultEstimate)===void 0){const H=Math.min(L,this.hls.config.abrEwmaDefaultEstimateMax);H>O&&O===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=H)}break}const v=l&&!a,E=this.hls.config,A=!!(E.audioStreamController&&E.audioTrackController),R={levels:d,audioTracks:u,subtitleTracks:f,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:l,video:a,altAudio:A&&!v&&u.some(D=>!!D.url)};m.end=performance.now(),this.hls.trigger(B.MANIFEST_PARSED,R)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const m=new Error("invalid level idx"),g=e<0;if(this.hls.trigger(B.ERROR,{type:et.OTHER_ERROR,details:be.LEVEL_SWITCH_ERROR,level:e,fatal:g,error:m,reason:m.message}),g)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,a=this.currentLevel,l=a?a.attrs["PATHWAY-ID"]:void 0,c=t[e],u=c.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=c,s===e&&a&&l===u)return;this.log(`Switching to level ${e} (${c.height?c.height+"p ":""}${c.videoRange?c.videoRange+" ":""}${c.codecSet?c.codecSet+" ":""}@${c.bitrate})${u?" with Pathway "+u:""} from level ${s}${l?" with Pathway "+l:""}`);const f={level:e,attrs:c.attrs,details:c.details,bitrate:c.bitrate,averageBitrate:c.averageBitrate,maxBitrate:c.maxBitrate,realBitrate:c.realBitrate,width:c.width,height:c.height,codecSet:c.codecSet,audioCodec:c.audioCodec,videoCodec:c.videoCodec,audioGroups:c.audioGroups,subtitleGroups:c.subtitleGroups,loaded:c.loaded,loadError:c.loadError,fragmentError:c.fragmentError,name:c.name,id:c.id,uri:c.uri,url:c.url,urlId:0,audioGroupIds:c.audioGroupIds,textGroupIds:c.textGroupIds};this.hls.trigger(B.LEVEL_SWITCHING,f);const d=c.details;if(!d||d.live){const m=this.switchParams(c.uri,a?.details,d);this.loadPlaylist(m)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter(a=>t.indexOf(a)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=s}}onError(e,t){t.fatal||!t.context||t.context.type===At.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===Xe.MAIN){const s=t.elementaryStreams;if(!Object.keys(s).some(l=>!!s[l]))return;const a=this._levels[t.level];a!=null&&a.loadError&&(this.log(`Resetting level error count of ${a.loadError} on frag buffered`),a.loadError=0)}}onLevelLoaded(e,t){var s;const{level:a,details:l}=t,c=t.levelInfo;if(!c){var u;this.warn(`Invalid level index ${a}`),(u=t.deliveryDirectives)!=null&&u.skip&&(l.deltaUpdateFailed=!0);return}if(c===this.currentLevel||t.withoutMultiVariant){c.fragmentError===0&&(c.loadError=0);let f=c.details;f===t.details&&f.advanced&&(f=void 0),this.playlistLoaded(a,t,f)}else(s=t.deliveryDirectives)!=null&&s.skip&&(l.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),a=this.currentLevelIndex,l=e.attrs["PATHWAY-ID"],c=e.details,u=c?.age;this.log(`Loading level index ${a}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${l?" Pathway "+l:""}${u&&c.live?" age "+u.toFixed(1)+(c.type&&" "+c.type||""):""} ${s}`),this.hls.trigger(B.LEVEL_LOADING,{url:s,level:a,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const s=this._levels.filter((l,c)=>c!==e?!0:(this.steering&&this.steering.removeLevel(l),l===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,l.details&&l.details.fragments.forEach(u=>u.level=-1)),!1));BS(s),this._levels=s,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const a=s.length-1;this._firstLevel=Math.min(this._firstLevel,a),this._startLevel&&(this._startLevel=Math.min(this._startLevel,a)),this.hls.trigger(B.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(B.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function j_(i){const e={};i.forEach(t=>{const s=t.groupId||"";t.id=e[s]=e[s]||0,e[s]++})}function kE(){return self.SourceBuffer||self.WebKitSourceBuffer}function ME(){if(!Ma())return!1;const e=kE();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function a4(){if(!ME())return!1;const i=Ma();return typeof i?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>i.isTypeSupported($l(e,"video")))||["mp4a.40.2","fLaC"].some(e=>i.isTypeSupported($l(e,"audio"))))}function r4(){var i;const e=kE();return typeof(e==null||(i=e.prototype)==null?void 0:i.changeType)=="function"}const o4=100;class l4 extends Dg{constructor(e,t,s){super(e,t,s,"stream-controller",Xe.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const a=this.media,l=a?a.currentTime:null;if(l===null||!We(l)||(this.log(`Media seeked to ${l.toFixed(3)}`),!this.getBufferedFrag(l)))return;const c=this.getFwdBufferInfoAtPos(a,l,Xe.MAIN,0);if(c===null||c.len===0){this.warn(`Main forward buffer length at ${l} on "seeked" event ${c?c.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(B.MANIFEST_PARSED,this.onManifestParsed,this),e.on(B.LEVEL_LOADING,this.onLevelLoading,this),e.on(B.LEVEL_LOADED,this.onLevelLoaded,this),e.on(B.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(B.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(B.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(B.BUFFER_CREATED,this.onBufferCreated,this),e.on(B.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(B.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(B.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(B.MANIFEST_PARSED,this.onManifestParsed,this),e.off(B.LEVEL_LOADED,this.onLevelLoaded,this),e.off(B.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(B.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(B.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(B.BUFFER_CREATED,this.onBufferCreated,this),e.off(B.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(B.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(B.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:a}=this;if(this.stopLoad(),this.setInterval(o4),this.level=-1,!this.startFragRequested){let l=a.startLevel;l===-1&&(a.config.testBandwidth&&this.levels.length>1?(l=0,this.bitrateTest=!0):l=a.firstAutoLevel),a.nextLoadLevel=l,this.level=a.loadLevel,this._hasEnoughToStart=!!t}s>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s),this.state=je.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=je.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case je.WAITING_LEVEL:{const{levels:e,level:t}=this,s=e?.[t],a=s?.details;if(a&&(!a.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(a))break;this.state=je.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=je.IDLE;break}break}case je.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===je.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:a}=this;if(t===null||!a&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const l=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(s!=null&&s[l]))return;const c=s[l],u=this.getMainFwdBufferInfo();if(u===null)return;const f=this.getLevelDetails();if(f&&this._streamEnded(u,f)){const E={};this.altAudio===2&&(E.type="video"),this.hls.trigger(B.BUFFER_EOS,E),this.state=je.ENDED;return}if(!this.buffering)return;e.loadLevel!==l&&e.manualLevel===-1&&this.log(`Adapting to level ${l} from level ${this.level}`),this.level=e.nextLoadLevel=l;const d=c.details;if(!d||this.state===je.WAITING_LEVEL||this.waitForLive(c)){this.level=l,this.state=je.WAITING_LEVEL,this.startFragRequested=!1;return}const m=u.len,g=this.getMaxBufferLength(c.maxBitrate);if(m>=g)return;this.backtrackFragment&&this.backtrackFragment.start>u.end&&(this.backtrackFragment=null);const y=this.backtrackFragment?this.backtrackFragment.start:u.end;let x=this.getNextFragment(y,d);if(this.couldBacktrack&&!this.fragPrevious&&x&&_s(x)&&this.fragmentTracker.getState(x)!==Is.OK){var v;const A=((v=this.backtrackFragment)!=null?v:x).sn-d.startSN,R=d.fragments[A-1];R&&x.cc===R.cc&&(x=R,this.fragmentTracker.removeFragment(R))}else this.backtrackFragment&&u.len&&(this.backtrackFragment=null);if(x&&this.isLoopLoading(x,y)){if(!x.gap){const A=this.audioOnly&&!this.altAudio?Zt.AUDIO:Zt.VIDEO,R=(A===Zt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;R&&this.afterBufferFlushed(R,A,Xe.MAIN)}x=this.getNextFragmentLoopLoading(x,d,u,Xe.MAIN,g)}x&&(x.initSegment&&!x.initSegment.data&&!this.bitrateTest&&(x=x.initSegment),this.loadFragment(x,c,y))}loadFragment(e,t,s){const a=this.fragmentTracker.getState(e);a===Is.NOT_LOADED||a===Is.PARTIAL?_s(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Xe.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let s;const a=this.getAppendedFrag(t.currentTime);a&&a.start>1&&this.flushMainBuffer(0,a.start-1);const l=this.getLevelDetails();if(l!=null&&l.live){const u=this.getMainFwdBufferInfo();if(!u||u.len<l.targetduration*2)return}if(!t.paused&&e){const u=this.hls.nextLoadLevel,f=e[u],d=this.fragLastKbps;d&&this.fragCurrent?s=this.fragCurrent.duration*f.maxBitrate/(1e3*d)+1:s=0}else s=0;const c=this.getBufferedFrag(t.currentTime+s);if(c){const u=this.followingBufferedFrag(c);if(u){this.abortCurrentFrag();const f=u.maxStartPTS?u.maxStartPTS:u.start,d=u.duration,m=Math.max(c.end,f+Math.min(Math.max(d-this.config.maxFragLookUpTolerance,d*(this.couldBacktrack?.5:.125)),d*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(m,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case je.KEY_LOADING:case je.FRAG_LOADING:case je.FRAG_LOADING_WAITING_RETRY:case je.PARSING:case je.PARSED:this.state=je.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;si(s,"playing",this.onMediaPlaying),si(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&(di(s,"playing",this.onMediaPlaying),di(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(B.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,a=!1;for(let l=0;l<t.levels.length;l++){const c=t.levels[l].audioCodec;c&&(s=s||c.indexOf("mp4a.40.2")!==-1,a=a||c.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=s&&a&&!r4(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==je.IDLE)return;const a=t.levelInfo;(!a.details||a.details.live&&(this.levelLastLoaded!==a||a.details.expired)||this.waitForCdnTuneIn(a.details))&&(this.state=je.WAITING_LEVEL)}onLevelLoaded(e,t){var s;const{levels:a,startFragRequested:l}=this,c=t.level,u=t.details,f=u.totalduration;if(!a){this.warn(`Levels were reset while loading level ${c}`);return}this.log(`Level ${c} loaded [${u.startSN},${u.endSN}]${u.lastPartSn?`[part-${u.lastPartSn}-${u.lastPartIndex}]`:""}, cc [${u.startCC}, ${u.endCC}] duration:${f}`);const d=t.levelInfo,m=this.fragCurrent;m&&(this.state===je.FRAG_LOADING||this.state===je.FRAG_LOADING_WAITING_RETRY)&&m.level!==t.level&&m.loader&&this.abortCurrentFrag();let g=0;if(u.live||(s=d.details)!=null&&s.live){var y;if(this.checkLiveUpdate(u),u.deltaUpdateFailed)return;g=this.alignPlaylists(u,d.details,(y=this.levelLastLoaded)==null?void 0:y.details)}if(d.details=u,this.levelLastLoaded=d,l||this.setStartPosition(u,g),this.hls.trigger(B.LEVEL_UPDATED,{details:u,level:c}),this.state===je.WAITING_LEVEL){if(this.waitForCdnTuneIn(u))return;this.state=je.IDLE}l&&u.live&&this.synchronizeToLiveEdge(u),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const a=this.hls.liveSyncPosition,l=this.getLoadPosition(),c=e.fragmentStart,u=e.edge,f=l>=c-t.maxFragLookUpTolerance&&l<=u;if(a!==null&&s.duration>a&&(l<a||!f)){const m=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!f&&s.readyState<4||l<u-m)&&(this._hasEnoughToStart||(this.nextLoadPosition=a),s.readyState))if(this.warn(`Playback: ${l.toFixed(3)} is located too far from the end of live sliding playlist: ${u}, reset currentTime to : ${a.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var d;const g=pt.bufferInfo(s,a,0);if(!((d=g.buffered)!=null&&d.length)){s.currentTime=a;return}if(g.start<=l){s.currentTime=a;return}const{nextStart:x}=pt.bufferedInfo(g.buffered,l,0);x&&(s.currentTime=x)}else s.currentTime=a}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:a,payload:l}=e,{levels:c}=this;if(!c){this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const u=c[s.level];if(!u){this.warn(`Level ${s.level} not found on progress`);return}const f=u.details;if(!f){this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),this.fragmentTracker.removeFragment(s);return}const d=u.videoCodec,m=f.PTSKnown||!f.live,g=(t=s.initSegment)==null?void 0:t.data,y=this._getAudioCodec(u),x=this.transmuxer=this.transmuxer||new rE(this.hls,Xe.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),v=a?a.index:-1,E=v!==-1,A=new Rg(s.level,s.sn,s.stats.chunkCount,l.byteLength,v,E),R=this.initPTS[s.cc];x.push(l,g,y,d,s,a,f.totalduration,m,A,R)}onAudioTrackSwitching(e,t){const s=this.hls,a=this.altAudio!==0;if(sd(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const c=this.fragCurrent;c&&(this.log("Switching to main audio track, cancel main fragment load"),c.abortRequests(),this.fragmentTracker.removeFragment(c)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(a){this.altAudio=0,this.fragmentTracker.removeAllFragments(),s.once(B.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(B.AUDIO_TRACK_SWITCHED,t)}),s.trigger(B.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}s.trigger(B.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=sd(t.url,this.hls);if(s){const a=this.videoBuffer;a&&this.mediaBuffer!==a&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=a)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let a,l,c=!1;for(const u in s){const f=s[u];if(f.id==="main"){if(l=u,a=f,u==="video"){const d=s[u];d&&(this.videoBuffer=d.buffer)}}else c=!0}c&&a?(this.log(`Alternate track found, use ${l}.buffered to schedule main fragment loading`),this.mediaBuffer=a.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:a}=t,l=s.type===Xe.MAIN;if(l){if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${a?" p: "+a.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),this.state===je.PARSED&&(this.state=je.IDLE);return}const u=a?a.stats:s.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first)),_s(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,a)}const c=this.media;c&&(!this._hasEnoughToStart&&pt.getBuffered(c).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),l&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal){this.state=je.ERROR;return}switch(t.details){case be.FRAG_GAP:case be.FRAG_PARSING_ERROR:case be.FRAG_DECRYPT_ERROR:case be.FRAG_LOAD_ERROR:case be.FRAG_LOAD_TIMEOUT:case be.KEY_LOAD_ERROR:case be.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Xe.MAIN,t);break;case be.LEVEL_LOAD_ERROR:case be.LEVEL_LOAD_TIMEOUT:case be.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===je.WAITING_LEVEL&&((s=t.context)==null?void 0:s.type)===At.LEVEL&&(this.state=je.IDLE);break;case be.BUFFER_ADD_CODEC_ERROR:case be.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case be.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case be.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=je.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Zt.AUDIO||!this.altAudio){const s=(t===Zt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;s&&(this.afterBufferFlushed(s,t,Xe.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking){this.log(`could not seek to ${s}, already seeking at ${t}`);return}const a=this.timelineOffset;a&&s&&(s+=a);const l=this.getLevelDetails(),c=pt.getBuffered(e),u=c.length?c.start(0):0,f=u-s,d=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||f>0&&(f<d||this.loadingParts&&f<2*(l?.partTarget||0)))&&(this.log(`adjusting start position by ${f} to match buffer start`),s+=f,this.startPosition=s),t<s&&(this.log(`seek to target start position ${s} from current time ${t} buffer start ${u}`),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(s=>{const{hls:a}=this,l=s?.frag;if(!l||this.fragContextChanged(l))return;t.fragmentError=0,this.state=je.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const c=l.stats;c.parsing.start=c.parsing.end=c.buffering.start=c.buffering.end=self.performance.now(),a.trigger(B.FRAG_LOADED,s),l.bitrateTest=!1}).catch(s=>{this.state===je.STOPPED||this.state===je.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:s}=this,{remuxResult:a,chunkMeta:l}=e,c=this.getCurrentContext(l);if(!c){this.resetWhenMissingContext(l);return}const{frag:u,part:f,level:d}=c,{video:m,text:g,id3:y,initSegment:x}=a,{details:v}=d,E=this.altAudio?void 0:a.audio;if(this.fragContextChanged(u)){this.fragmentTracker.removeFragment(u);return}if(this.state=je.PARSING,x){const A=x.tracks;if(A){const O=u.initSegment||u;if(this.unhandledEncryptionError(x,u))return;this._bufferInitSegment(d,A,O,l),s.trigger(B.FRAG_PARSING_INIT_SEGMENT,{frag:O,id:t,tracks:A})}const R=x.initPTS,D=x.timescale,L=this.initPTS[u.cc];if(We(R)&&(!L||L.baseTime!==R||L.timescale!==D)){const O=x.trackId;this.initPTS[u.cc]={baseTime:R,timescale:D,trackId:O},s.trigger(B.INIT_PTS_FOUND,{frag:u,id:t,initPTS:R,timescale:D,trackId:O})}}if(m&&v){E&&m.type==="audiovideo"&&this.logMuxedErr(u);const A=v.fragments[u.sn-1-v.startSN],R=u.sn===v.startSN,D=!A||u.cc>A.cc;if(a.independent!==!1){const{startPTS:L,endPTS:O,startDTS:H,endDTS:q}=m;if(f)f.elementaryStreams[m.type]={startPTS:L,endPTS:O,startDTS:H,endDTS:q};else if(m.firstKeyFrame&&m.independent&&l.id===1&&!D&&(this.couldBacktrack=!0),m.dropped&&m.independent){const U=this.getMainFwdBufferInfo(),k=(U?U.end:this.getLoadPosition())+this.config.maxBufferHole,M=m.firstKeyFramePTS?m.firstKeyFramePTS:L;if(!R&&k<M-this.config.maxBufferHole&&!D){this.backtrack(u);return}else D&&(u.gap=!0);u.setElementaryStreamInfo(m.type,u.start,O,u.start,q,!0)}else R&&L-(v.appliedTimelineOffset||0)>qu&&(u.gap=!0);u.setElementaryStreamInfo(m.type,L,O,H,q),this.backtrackFragment&&(this.backtrackFragment=u),this.bufferFragmentData(m,u,f,l,R||D)}else if(R||D)u.gap=!0;else{this.backtrack(u);return}}if(E){const{startPTS:A,endPTS:R,startDTS:D,endDTS:L}=E;f&&(f.elementaryStreams[Zt.AUDIO]={startPTS:A,endPTS:R,startDTS:D,endDTS:L}),u.setElementaryStreamInfo(Zt.AUDIO,A,R,D,L),this.bufferFragmentData(E,u,f,l)}if(v&&y!=null&&y.samples.length){const A={id:t,frag:u,details:v,samples:y.samples};s.trigger(B.FRAG_PARSING_METADATA,A)}if(v&&g){const A={id:t,frag:u,details:v,samples:g.samples};s.trigger(B.FRAG_PARSING_USERDATA,A)}}logMuxedErr(e){this.warn(`${_s(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,s,a){if(this.state!==je.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:l,video:c,audiovideo:u}=t;if(l){const d=e.audioCodec;let m=Fu(l.codec,d);m==="mp4a"&&(m="mp4a.40.5");const g=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){m&&(m.indexOf("mp4a.40.5")!==-1?m="mp4a.40.2":m="mp4a.40.5");const y=l.metadata;y&&"channelCount"in y&&(y.channelCount||1)!==1&&g.indexOf("firefox")===-1&&(m="mp4a.40.5")}m&&m.indexOf("mp4a.40.5")!==-1&&g.indexOf("android")!==-1&&l.container!=="audio/mpeg"&&(m="mp4a.40.2",this.log(`Android: force audio codec to ${m}`)),d&&d!==m&&this.log(`Swapping manifest audio codec "${d}" for "${m}"`),l.levelCodec=m,l.id=Xe.MAIN,this.log(`Init audio buffer, container:${l.container}, codecs[selected/level/parsed]=[${m||""}/${d||""}/${l.codec}]`),delete t.audiovideo}if(c){c.levelCodec=e.videoCodec,c.id=Xe.MAIN;const d=c.codec;if(d?.length===4)switch(d){case"hvc1":case"hev1":c.codec="hvc1.1.6.L120.90";break;case"av01":c.codec="av01.0.04M.08";break;case"avc1":c.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${c.container}, codecs[level/parsed]=[${e.videoCodec||""}/${d}]${c.codec!==d?" parsed-corrected="+c.codec:""}${c.supplemental?" supplemental="+c.supplemental:""}`),delete t.audiovideo}u&&(this.log(`Init audiovideo buffer, container:${u.container}, codecs[level/parsed]=[${e.codecs}/${u.codec}]`),delete t.video,delete t.audio);const f=Object.keys(t);if(f.length){if(this.hls.trigger(B.BUFFER_CODECS,t),!this.hls)return;f.forEach(d=>{const g=t[d].initSegment;g!=null&&g.byteLength&&this.hls.trigger(B.BUFFER_APPENDING,{type:d,data:g,frag:s,part:null,chunkMeta:a,parent:s.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Xe.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,s=e?.[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=je.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const s=e.currentTime;if(pt.isBuffered(e,s)?t=this.getAppendedFrag(s):pt.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const a=this.fragPlaying,l=t.level;(!a||t.sn!==a.sn||a.level!==l)&&(this.fragPlaying=t,this.hls.trigger(B.FRAG_CHANGED,{frag:t}),(!a||a.level!==l)&&this.hls.trigger(B.LEVEL_SWITCHED,{level:l}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return We(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(We(t)){const s=this.getLevelDetails(),a=this.currentFrag||(s?Sr(null,s.fragments,t):null);if(a){const l=a.programDateTime;if(l!==null){const c=l+(t-a.start)*1e3;return new Date(c)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class c4 extends Wi{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyIdToKeyInfo){const a=this.keyIdToKeyInfo[s].loader;if(a){var t;if(e&&e!==((t=a.context)==null?void 0:t.frag.type))return;a.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=be.KEY_LOAD_ERROR,s,a,l){return new zn({type:et.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:l,error:s,networkDetails:a})}loadClear(e,t,s){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let a=0,l=t.length;a<l;a++){const c=t[a];if(e.cc<=c.cc&&(!_s(e)||!_s(c)||e.sn<c.sn)||!s&&a==l-1)return this.emeController.selectKeySystemFormat(c).then(u=>{if(!this.emeController)return;c.setKeyFormat(u);const f=$u(u);if(f)return this.emeController.getKeySystemAccess([f])})}if(this.config.requireKeySystemAccessOnStart){const a=Ml(this.config);if(a.length)return this.emeController.getKeySystemAccess(a)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var s,a;t&&e.setKeyFormat(t);const l=e.decryptdata;if(!l){const d=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,be.KEY_LOAD_ERROR,d))}const c=l.uri;if(!c)return Promise.reject(this.createKeyLoadError(e,be.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${c}"`)));const u=rm(l);let f=this.keyIdToKeyInfo[u];if((s=f)!=null&&s.decryptdata.key)return l.key=f.decryptdata.key,Promise.resolve({frag:e,keyInfo:f});if(this.emeController&&(a=f)!=null&&a.keyLoadPromise)switch(this.emeController.getKeyStatus(f.decryptdata)){case"usable":case"usable-in-future":return f.keyLoadPromise.then(m=>{const{keyInfo:g}=m;return l.key=g.decryptdata.key,{frag:e,keyInfo:g}})}switch(this.log(`${this.keyIdToKeyInfo[u]?"Rel":"L"}oading${l.keyId?" keyId: "+Hs(l.keyId):""} URI: ${l.uri} from ${e.type} ${e.level}`),f=this.keyIdToKeyInfo[u]={decryptdata:l,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},l.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return l.keyFormat==="identity"?this.loadKeyHTTP(f,e):this.loadKeyEME(f,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(f,e);default:return Promise.reject(this.createKeyLoadError(e,be.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${l.method}"`)))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var a;if(!e.decryptdata.keyId&&(a=t.initSegment)!=null&&a.data){const c=RI(t.initSegment.data);if(c.length){let u=c[0];u.some(f=>f!==0)?(this.log(`Using keyId found in init segment ${Hs(u)}`),Ia.setKeyIdForUri(e.decryptdata.uri,u)):(u=Ia.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Hs(u)}`)),e.decryptdata.keyId=u}}if(!e.decryptdata.keyId&&!_s(t))return Promise.resolve(s);const l=this.emeController.loadKey(s);return(e.keyLoadPromise=l.then(c=>(e.mediaKeySessionContext=c,s))).catch(c=>{throw e.keyLoadPromise=null,"data"in c&&(c.data.frag=t),c})}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,a=s.loader,l=new a(s);return t.keyLoader=e.loader=l,e.keyLoadPromise=new Promise((c,u)=>{const f={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},d=s.keyLoadPolicy.default,m={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(y,x,v,E)=>{const{frag:A,keyInfo:R}=v,D=rm(R.decryptdata);if(!A.decryptdata||R!==this.keyIdToKeyInfo[D])return u(this.createKeyLoadError(A,be.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),E));R.decryptdata.key=A.decryptdata.key=new Uint8Array(y.data),A.keyLoader=null,R.loader=null,c({frag:A,keyInfo:R})},onError:(y,x,v,E)=>{this.resetLoader(x),u(this.createKeyLoadError(t,be.KEY_LOAD_ERROR,new Error(`HTTP Error ${y.code} loading key ${y.text}`),v,Kt({url:f.url,data:void 0},y)))},onTimeout:(y,x,v)=>{this.resetLoader(x),u(this.createKeyLoadError(t,be.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),v))},onAbort:(y,x,v)=>{this.resetLoader(x),u(this.createKeyLoadError(t,be.INTERNAL_ABORTED,new Error("key loading aborted"),v))}};l.load(f,m,g)})}resetLoader(e){const{frag:t,keyInfo:s,url:a}=e,l=s.loader;t.keyLoader===l&&(t.keyLoader=null,s.loader=null);const c=rm(s.decryptdata)||a;delete this.keyIdToKeyInfo[c],l&&l.destroy()}}function rm(i){if(i.keyFormat!==Ks.FAIRPLAY){const e=i.keyId;if(e)return Hs(e)}return i.uri}function O_(i){const{type:e}=i;switch(e){case At.AUDIO_TRACK:return Xe.AUDIO;case At.SUBTITLE_TRACK:return Xe.SUBTITLE;default:return Xe.MAIN}}function om(i,e){let t=i.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class u4{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(B.MANIFEST_LOADING,this.onManifestLoading,this),e.on(B.LEVEL_LOADING,this.onLevelLoading,this),e.on(B.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(B.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(B.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(B.MANIFEST_LOADING,this.onManifestLoading,this),e.off(B.LEVEL_LOADING,this.onLevelLoading,this),e.off(B.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(B.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(B.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,a=t.loader,l=s||a,c=new l(t);return this.loaders[e.type]=c,c}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:At.MANIFEST,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:a,pathwayId:l,url:c,deliveryDirectives:u,levelInfo:f}=t;this.load({id:s,level:a,pathwayId:l,responseType:"text",type:At.LEVEL,url:c,deliveryDirectives:u,levelOrTrack:f})}onAudioTrackLoading(e,t){const{id:s,groupId:a,url:l,deliveryDirectives:c,track:u}=t;this.load({id:s,groupId:a,level:null,responseType:"text",type:At.AUDIO_TRACK,url:l,deliveryDirectives:c,levelOrTrack:u})}onSubtitleTrackLoading(e,t){const{id:s,groupId:a,url:l,deliveryDirectives:c,track:u}=t;this.load({id:s,groupId:a,level:null,responseType:"text",type:At.SUBTITLE_TRACK,url:l,deliveryDirectives:c,levelOrTrack:u})}onLevelsUpdated(e,t){const s=this.loaders[At.LEVEL];if(s){const a=s.context;a&&!t.levels.some(l=>l===a.levelOrTrack)&&(s.abort(),delete this.loaders[At.LEVEL])}}load(e){var t;const s=this.hls.config;let a=this.getInternalLoader(e);if(a){const d=this.hls.logger,m=a.context;if(m&&m.levelOrTrack===e.levelOrTrack&&(m.url===e.url||m.deliveryDirectives&&!e.deliveryDirectives)){m.url===e.url?d.log(`[playlist-loader]: ignore ${e.url} ongoing request`):d.log(`[playlist-loader]: ignore ${e.url} in favor of ${m.url}`);return}d.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),a.abort()}let l;if(e.type===At.MANIFEST?l=s.manifestLoadPolicy.default:l=Xt({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),a=this.createInternalLoader(e),We((t=e.deliveryDirectives)==null?void 0:t.part)){let d;if(e.type===At.LEVEL&&e.level!==null?d=this.hls.levels[e.level].details:e.type===At.AUDIO_TRACK&&e.id!==null?d=this.hls.audioTracks[e.id].details:e.type===At.SUBTITLE_TRACK&&e.id!==null&&(d=this.hls.subtitleTracks[e.id].details),d){const m=d.partTarget,g=d.targetduration;if(m&&g){const y=Math.max(m*3,g*.8)*1e3;l=Xt({},l,{maxTimeToFirstByteMs:Math.min(y,l.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(y,l.maxTimeToFirstByteMs)})}}}const c=l.errorRetry||l.timeoutRetry||{},u={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},f={onSuccess:(d,m,g,y)=>{const x=this.getInternalLoader(g);this.resetInternalLoader(g.type);const v=d.data;m.parsing.start=performance.now(),_n.isMediaPlaylist(v)||g.type!==At.MANIFEST?this.handleTrackOrLevelPlaylist(d,m,g,y||null,x):this.handleMasterPlaylist(d,m,g,y)},onError:(d,m,g,y)=>{this.handleNetworkError(m,g,!1,d,y)},onTimeout:(d,m,g)=>{this.handleNetworkError(m,g,!0,void 0,d)}};a.load(e,u,f)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,a){const l=this.hls,c=e.data,u=om(e,s),f=_n.parseMasterPlaylist(c,u);if(f.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,s,f.playlistParsingError,a,t);return}const{contentSteering:d,levels:m,sessionData:g,sessionKeys:y,startTimeOffset:x,variableList:v}=f;this.variableList=v,m.forEach(D=>{const{unknownCodecs:L}=D;if(L){const{preferManagedMediaSource:O}=this.hls.config;let{audioCodec:H,videoCodec:q}=D;for(let U=L.length;U--;){const k=L[U];Gl(k,"audio",O)?(D.audioCodec=H=H?`${H},${k}`:k,No.audio[H.substring(0,4)]=2,L.splice(U,1)):Gl(k,"video",O)&&(D.videoCodec=q=q?`${q},${k}`:k,No.video[q.substring(0,4)]=2,L.splice(U,1))}}});const{AUDIO:E=[],SUBTITLES:A,"CLOSED-CAPTIONS":R}=_n.parseMasterPlaylistMedia(c,u,f);E.length&&!E.some(L=>!L.url)&&m[0].audioCodec&&!m[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),E.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new cs({}),bitrate:0,url:""})),l.trigger(B.MANIFEST_LOADED,{levels:m,audioTracks:E,subtitles:A,captions:R,contentSteering:d,url:u,stats:t,networkDetails:a,sessionData:g,sessionKeys:y,startTimeOffset:x,variableList:v})}handleTrackOrLevelPlaylist(e,t,s,a,l){const c=this.hls,{id:u,level:f,type:d}=s,m=om(e,s),g=We(f)?f:We(u)?u:0,y=O_(s),x=_n.parseLevelPlaylist(e.data,m,g,y,0,this.variableList);if(d===At.MANIFEST){const v={attrs:new cs({}),bitrate:0,details:x,name:"",url:m};x.requestScheduled=t.loading.start+jS(x,0),c.trigger(B.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:m,stats:t,networkDetails:a,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=x,this.handlePlaylistLoaded(x,e,t,s,a,l)}handleManifestParsingError(e,t,s,a,l){this.hls.trigger(B.ERROR,{type:et.NETWORK_ERROR,details:be.MANIFEST_PARSING_ERROR,fatal:t.type===At.MANIFEST,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:a,stats:l})}handleNetworkError(e,t,s=!1,a,l){let c=`A network ${s?"timeout":"error"+(a?" (status "+a.code+")":"")} occurred while loading ${e.type}`;e.type===At.LEVEL?c+=`: ${e.level} id: ${e.id}`:(e.type===At.AUDIO_TRACK||e.type===At.SUBTITLE_TRACK)&&(c+=` id: ${e.id} group-id: "${e.groupId}"`);const u=new Error(c);this.hls.logger.warn(`[playlist-loader]: ${c}`);let f=be.UNKNOWN,d=!1;const m=this.getInternalLoader(e);switch(e.type){case At.MANIFEST:f=s?be.MANIFEST_LOAD_TIMEOUT:be.MANIFEST_LOAD_ERROR,d=!0;break;case At.LEVEL:f=s?be.LEVEL_LOAD_TIMEOUT:be.LEVEL_LOAD_ERROR,d=!1;break;case At.AUDIO_TRACK:f=s?be.AUDIO_TRACK_LOAD_TIMEOUT:be.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case At.SUBTITLE_TRACK:f=s?be.SUBTITLE_TRACK_LOAD_TIMEOUT:be.SUBTITLE_LOAD_ERROR,d=!1;break}m&&this.resetInternalLoader(e.type);const g={type:et.NETWORK_ERROR,details:f,fatal:d,url:e.url,loader:m,context:e,error:u,networkDetails:t,stats:l};if(a){const y=t?.url||e.url;g.response=Kt({url:y,data:void 0},a)}this.hls.trigger(B.ERROR,g)}handlePlaylistLoaded(e,t,s,a,l,c){const u=this.hls,{type:f,level:d,levelOrTrack:m,id:g,groupId:y,deliveryDirectives:x}=a,v=om(t,a),E=O_(a);let A=typeof a.level=="number"&&E===Xe.MAIN?d:void 0;const R=e.playlistParsingError;if(R){if(this.hls.logger.warn(`${R} ${e.url}`),!u.config.ignorePlaylistParsingErrors){u.trigger(B.ERROR,{type:et.NETWORK_ERROR,details:be.LEVEL_PARSING_ERROR,fatal:!1,url:v,error:R,reason:R.message,response:t,context:a,level:A,parent:E,networkDetails:l,stats:s});return}e.playlistParsingError=null}if(!e.fragments.length){const D=e.playlistParsingError=new Error("No Segments found in Playlist");u.trigger(B.ERROR,{type:et.NETWORK_ERROR,details:be.LEVEL_EMPTY_ERROR,fatal:!1,url:v,error:D,reason:D.message,response:t,context:a,level:A,parent:E,networkDetails:l,stats:s});return}switch(e.live&&c&&(c.getCacheAge&&(e.ageHeader=c.getCacheAge()||0),(!c.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),f){case At.MANIFEST:case At.LEVEL:if(A){if(!m)A=0;else if(m!==u.levels[A]){const D=u.levels.indexOf(m);D>-1&&(A=D)}}u.trigger(B.LEVEL_LOADED,{details:e,levelInfo:m||u.levels[0],level:A||0,id:g||0,stats:s,networkDetails:l,deliveryDirectives:x,withoutMultiVariant:f===At.MANIFEST});break;case At.AUDIO_TRACK:u.trigger(B.AUDIO_TRACK_LOADED,{details:e,track:m,id:g||0,groupId:y||"",stats:s,networkDetails:l,deliveryDirectives:x});break;case At.SUBTITLE_TRACK:u.trigger(B.SUBTITLE_TRACK_LOADED,{details:e,track:m,id:g||0,groupId:y||"",stats:s,networkDetails:l,deliveryDirectives:x});break}}}class is{static get version(){return Hl}static isMSESupported(){return ME()}static isSupported(){return a4()}static getMediaSource(){return Ma()}static get Events(){return B}static get MetadataSchema(){return Ni}static get ErrorTypes(){return et}static get ErrorDetails(){return be}static get DefaultConfig(){return is.defaultConfig?is.defaultConfig:qO}static set DefaultConfig(e){is.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Ig,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=pI(e.debug||!1,"Hls instance",e.assetPlayerId),s=this.config=WO(is.DefaultConfig,e,t);this.userConfig=e,s.progressive&&XO(s,t);const{abrController:a,bufferController:l,capLevelController:c,errorController:u,fpsController:f}=s,d=new u(this),m=this.abrController=new a(this),g=new dk(this),y=s.interstitialsController,x=y?this.interstitialsController=new y(this,is):null,v=this.bufferController=new l(this,g),E=this.capLevelController=new c(this),A=new f(this),R=new u4(this),D=s.contentSteeringController,L=D?new D(this):null,O=this.levelController=new n4(this,L),H=new s4(this),q=new c4(this.config,this.logger),U=this.streamController=new l4(this,g,q),k=this.gapController=new e4(this,g);E.setStreamController(U),A.setStreamController(U);const M=[R,O,U];x&&M.splice(1,0,x),L&&M.splice(1,0,L),this.networkControllers=M;const I=[m,v,k,E,A,H,g];this.audioTrackController=this.createController(s.audioTrackController,M);const j=s.audioStreamController;j&&M.push(this.audioStreamController=new j(this,g,q)),this.subtitleTrackController=this.createController(s.subtitleTrackController,M);const Z=s.subtitleStreamController;Z&&M.push(this.subtititleStreamController=new Z(this,g,q)),this.createController(s.timelineController,I),q.emeController=this.emeController=this.createController(s.emeController,I),this.cmcdController=this.createController(s.cmcdController,I),this.latencyController=this.createController(i4,I),this.coreComponents=I,M.push(d);const ae=d.onErrorOut;typeof ae=="function"&&this.on(B.ERROR,ae,d),this.on(B.MANIFEST_LOADED,R.onManifestLoaded,R)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t,s=this){this._emitter.on(e,t,s)}once(e,t,s=this){this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,s=this,a){this._emitter.off(e,t,s,a)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(s){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const a=e===B.ERROR;this.trigger(B.ERROR,{type:et.OTHER_ERROR,details:be.INTERNAL_EXCEPTION,fatal:a,event:e,error:s}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(B.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const l=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(B.ERROR,{type:et.OTHER_ERROR,details:be.ATTACH_MEDIA_ERROR,fatal:!0,error:l});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,a=t?e:{media:s};this._media=s,this.trigger(B.MEDIA_ATTACHING,a)}detachMedia(){this.logger.log("detachMedia"),this.trigger(B.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(B.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,a=this._url=bg.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${a}`),t&&s&&(s!==a||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(B.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),!(!this.started||!this.networkControllers));s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[Xe.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Xe.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Xe.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=eO()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){WI(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let a=0;a<s;a++)if(e[a].maxBitrate>=t)return a;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let a;if(t===-1&&e!=null&&e.length?a=e.length-1:a=t,s)for(let l=a;l--;){const c=e[l].attrs["HDCP-LEVEL"];if(c&&c<=s)return l}return a}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const s=_S(t);return xS(e,s,navigator.mediaCapabilities)}}is.defaultConfig=void 0;var lm={exports:{}},P_;function d4(){return P_||(P_=1,(function(i,e){(function(t,s){i.exports=s()})(window,(function(){return(function(t){var s={};function a(l){if(s[l])return s[l].exports;var c=s[l]={i:l,l:!1,exports:{}};return t[l].call(c.exports,c,c.exports,a),c.l=!0,c.exports}return a.m=t,a.c=s,a.d=function(l,c,u){a.o(l,c)||Object.defineProperty(l,c,{enumerable:!0,get:u})},a.r=function(l){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},a.t=function(l,c){if(1&c&&(l=a(l)),8&c||4&c&&typeof l=="object"&&l&&l.__esModule)return l;var u=Object.create(null);if(a.r(u),Object.defineProperty(u,"default",{enumerable:!0,value:l}),2&c&&typeof l!="string")for(var f in l)a.d(u,f,(function(d){return l[d]}).bind(null,f));return u},a.n=function(l){var c=l&&l.__esModule?function(){return l.default}:function(){return l};return a.d(c,"a",c),c},a.o=function(l,c){return Object.prototype.hasOwnProperty.call(l,c)},a.p="",a(a.s=20)})([function(t,s,a){var l=a(9),c=a.n(l),u=(function(){function f(){}return f.e=function(d,m){d&&!f.FORCE_GLOBAL_TAG||(d=f.GLOBAL_TAG);var g="[".concat(d,"] > ").concat(m);f.ENABLE_CALLBACK&&f.emitter.emit("log","error",g),f.ENABLE_ERROR&&(console.error?console.error(g):console.warn?console.warn(g):console.log(g))},f.i=function(d,m){d&&!f.FORCE_GLOBAL_TAG||(d=f.GLOBAL_TAG);var g="[".concat(d,"] > ").concat(m);f.ENABLE_CALLBACK&&f.emitter.emit("log","info",g),f.ENABLE_INFO&&(console.info?console.info(g):console.log(g))},f.w=function(d,m){d&&!f.FORCE_GLOBAL_TAG||(d=f.GLOBAL_TAG);var g="[".concat(d,"] > ").concat(m);f.ENABLE_CALLBACK&&f.emitter.emit("log","warn",g),f.ENABLE_WARN&&(console.warn?console.warn(g):console.log(g))},f.d=function(d,m){d&&!f.FORCE_GLOBAL_TAG||(d=f.GLOBAL_TAG);var g="[".concat(d,"] > ").concat(m);f.ENABLE_CALLBACK&&f.emitter.emit("log","debug",g),f.ENABLE_DEBUG&&(console.debug?console.debug(g):console.log(g))},f.v=function(d,m){d&&!f.FORCE_GLOBAL_TAG||(d=f.GLOBAL_TAG);var g="[".concat(d,"] > ").concat(m);f.ENABLE_CALLBACK&&f.emitter.emit("log","verbose",g),f.ENABLE_VERBOSE&&console.log(g)},f})();u.GLOBAL_TAG="mpegts.js",u.FORCE_GLOBAL_TAG=!1,u.ENABLE_ERROR=!0,u.ENABLE_INFO=!0,u.ENABLE_WARN=!0,u.ENABLE_DEBUG=!0,u.ENABLE_VERBOSE=!0,u.ENABLE_CALLBACK=!1,u.emitter=new c.a,s.a=u},function(t,s,a){var l;(function(c){c.IO_ERROR="io_error",c.DEMUX_ERROR="demux_error",c.INIT_SEGMENT="init_segment",c.MEDIA_SEGMENT="media_segment",c.LOADING_COMPLETE="loading_complete",c.RECOVERED_EARLY_EOF="recovered_early_eof",c.MEDIA_INFO="media_info",c.METADATA_ARRIVED="metadata_arrived",c.SCRIPTDATA_ARRIVED="scriptdata_arrived",c.TIMED_ID3_METADATA_ARRIVED="timed_id3_metadata_arrived",c.SYNCHRONOUS_KLV_METADATA_ARRIVED="synchronous_klv_metadata_arrived",c.ASYNCHRONOUS_KLV_METADATA_ARRIVED="asynchronous_klv_metadata_arrived",c.SMPTE2038_METADATA_ARRIVED="smpte2038_metadata_arrived",c.SCTE35_METADATA_ARRIVED="scte35_metadata_arrived",c.PES_PRIVATE_DATA_DESCRIPTOR="pes_private_data_descriptor",c.PES_PRIVATE_DATA_ARRIVED="pes_private_data_arrived",c.STATISTICS_INFO="statistics_info",c.RECOMMEND_SEEKPOINT="recommend_seekpoint"})(l||(l={})),s.a=l},function(t,s,a){a.d(s,"c",(function(){return c})),a.d(s,"b",(function(){return u})),a.d(s,"a",(function(){return f}));var l=a(3),c={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},u={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},f=(function(){function d(m){this._type=m||"undefined",this._status=c.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return d.prototype.destroy=function(){this._status=c.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},d.prototype.isWorking=function(){return this._status===c.kConnecting||this._status===c.kBuffering},Object.defineProperty(d.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(m){this._onContentLengthKnown=m},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(m){this._onURLRedirect=m},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(m){this._onDataArrival=m},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onError",{get:function(){return this._onError},set:function(m){this._onError=m},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onComplete",{get:function(){return this._onComplete},set:function(m){this._onComplete=m},enumerable:!1,configurable:!0}),d.prototype.open=function(m,g){throw new l.c("Unimplemented abstract function!")},d.prototype.abort=function(){throw new l.c("Unimplemented abstract function!")},d})()},function(t,s,a){a.d(s,"d",(function(){return u})),a.d(s,"a",(function(){return f})),a.d(s,"b",(function(){return d})),a.d(s,"c",(function(){return m}));var l,c=(l=function(g,y){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,v){x.__proto__=v}||function(x,v){for(var E in v)Object.prototype.hasOwnProperty.call(v,E)&&(x[E]=v[E])})(g,y)},function(g,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function x(){this.constructor=g}l(g,y),g.prototype=y===null?Object.create(y):(x.prototype=y.prototype,new x)}),u=(function(){function g(y){this._message=y}return Object.defineProperty(g.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),g.prototype.toString=function(){return this.name+": "+this.message},g})(),f=(function(g){function y(x){return g.call(this,x)||this}return c(y,g),Object.defineProperty(y.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),y})(u),d=(function(g){function y(x){return g.call(this,x)||this}return c(y,g),Object.defineProperty(y.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),y})(u),m=(function(g){function y(x){return g.call(this,x)||this}return c(y,g),Object.defineProperty(y.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),y})(u)},function(t,s,a){var l;(function(c){c.ERROR="error",c.LOADING_COMPLETE="loading_complete",c.RECOVERED_EARLY_EOF="recovered_early_eof",c.MEDIA_INFO="media_info",c.METADATA_ARRIVED="metadata_arrived",c.SCRIPTDATA_ARRIVED="scriptdata_arrived",c.TIMED_ID3_METADATA_ARRIVED="timed_id3_metadata_arrived",c.SYNCHRONOUS_KLV_METADATA_ARRIVED="synchronous_klv_metadata_arrived",c.ASYNCHRONOUS_KLV_METADATA_ARRIVED="asynchronous_klv_metadata_arrived",c.SMPTE2038_METADATA_ARRIVED="smpte2038_metadata_arrived",c.SCTE35_METADATA_ARRIVED="scte35_metadata_arrived",c.PES_PRIVATE_DATA_DESCRIPTOR="pes_private_data_descriptor",c.PES_PRIVATE_DATA_ARRIVED="pes_private_data_arrived",c.STATISTICS_INFO="statistics_info",c.DESTROYING="destroying"})(l||(l={})),s.a=l},function(t,s,a){var l={};(function(){var c=self.navigator.userAgent.toLowerCase(),u=/(edge)\/([\w.]+)/.exec(c)||/(opr)[\/]([\w.]+)/.exec(c)||/(chrome)[ \/]([\w.]+)/.exec(c)||/(iemobile)[\/]([\w.]+)/.exec(c)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(c)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(c)||/(webkit)[ \/]([\w.]+)/.exec(c)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(c)||/(msie) ([\w.]+)/.exec(c)||c.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(c)||c.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(c)||[],f=/(ipad)/.exec(c)||/(ipod)/.exec(c)||/(windows phone)/.exec(c)||/(iphone)/.exec(c)||/(kindle)/.exec(c)||/(android)/.exec(c)||/(windows)/.exec(c)||/(mac)/.exec(c)||/(linux)/.exec(c)||/(cros)/.exec(c)||[],d={browser:u[5]||u[3]||u[1]||"",version:u[2]||u[4]||"0",majorVersion:u[4]||u[2]||"0",platform:f[0]||""},m={};if(d.browser){m[d.browser]=!0;var g=d.majorVersion.split(".");m.version={major:parseInt(d.majorVersion,10),string:d.version},g.length>1&&(m.version.minor=parseInt(g[1],10)),g.length>2&&(m.version.build=parseInt(g[2],10))}d.platform&&(m[d.platform]=!0),(m.chrome||m.opr||m.safari)&&(m.webkit=!0),(m.rv||m.iemobile)&&(m.rv&&delete m.rv,d.browser="msie",m.msie=!0),m.edge&&(delete m.edge,d.browser="msedge",m.msedge=!0),m.opr&&(d.browser="opera",m.opera=!0),m.safari&&m.android&&(d.browser="android",m.android=!0);for(var y in m.name=d.browser,m.platform=d.platform,l)l.hasOwnProperty(y)&&delete l[y];Object.assign(l,m)})(),s.a=l},function(t,s,a){s.a={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"}},function(t,s,a){var l;(function(c){c.ERROR="error",c.SOURCE_OPEN="source_open",c.UPDATE_END="update_end",c.BUFFER_FULL="buffer_full",c.START_STREAMING="start_streaming",c.END_STREAMING="end_streaming"})(l||(l={})),s.a=l},function(t,s,a){var l=a(9),c=a.n(l),u=a(0),f=(function(){function d(){}return Object.defineProperty(d,"forceGlobalTag",{get:function(){return u.a.FORCE_GLOBAL_TAG},set:function(m){u.a.FORCE_GLOBAL_TAG=m,d._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(d,"globalTag",{get:function(){return u.a.GLOBAL_TAG},set:function(m){u.a.GLOBAL_TAG=m,d._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(d,"enableAll",{get:function(){return u.a.ENABLE_VERBOSE&&u.a.ENABLE_DEBUG&&u.a.ENABLE_INFO&&u.a.ENABLE_WARN&&u.a.ENABLE_ERROR},set:function(m){u.a.ENABLE_VERBOSE=m,u.a.ENABLE_DEBUG=m,u.a.ENABLE_INFO=m,u.a.ENABLE_WARN=m,u.a.ENABLE_ERROR=m,d._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(d,"enableDebug",{get:function(){return u.a.ENABLE_DEBUG},set:function(m){u.a.ENABLE_DEBUG=m,d._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(d,"enableVerbose",{get:function(){return u.a.ENABLE_VERBOSE},set:function(m){u.a.ENABLE_VERBOSE=m,d._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(d,"enableInfo",{get:function(){return u.a.ENABLE_INFO},set:function(m){u.a.ENABLE_INFO=m,d._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(d,"enableWarn",{get:function(){return u.a.ENABLE_WARN},set:function(m){u.a.ENABLE_WARN=m,d._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(d,"enableError",{get:function(){return u.a.ENABLE_ERROR},set:function(m){u.a.ENABLE_ERROR=m,d._notifyChange()},enumerable:!1,configurable:!0}),d.getConfig=function(){return{globalTag:u.a.GLOBAL_TAG,forceGlobalTag:u.a.FORCE_GLOBAL_TAG,enableVerbose:u.a.ENABLE_VERBOSE,enableDebug:u.a.ENABLE_DEBUG,enableInfo:u.a.ENABLE_INFO,enableWarn:u.a.ENABLE_WARN,enableError:u.a.ENABLE_ERROR,enableCallback:u.a.ENABLE_CALLBACK}},d.applyConfig=function(m){u.a.GLOBAL_TAG=m.globalTag,u.a.FORCE_GLOBAL_TAG=m.forceGlobalTag,u.a.ENABLE_VERBOSE=m.enableVerbose,u.a.ENABLE_DEBUG=m.enableDebug,u.a.ENABLE_INFO=m.enableInfo,u.a.ENABLE_WARN=m.enableWarn,u.a.ENABLE_ERROR=m.enableError,u.a.ENABLE_CALLBACK=m.enableCallback},d._notifyChange=function(){var m=d.emitter;if(m.listenerCount("change")>0){var g=d.getConfig();m.emit("change",g)}},d.registerListener=function(m){d.emitter.addListener("change",m)},d.removeListener=function(m){d.emitter.removeListener("change",m)},d.addLogListener=function(m){u.a.emitter.addListener("log",m),u.a.emitter.listenerCount("log")>0&&(u.a.ENABLE_CALLBACK=!0,d._notifyChange())},d.removeLogListener=function(m){u.a.emitter.removeListener("log",m),u.a.emitter.listenerCount("log")===0&&(u.a.ENABLE_CALLBACK=!1,d._notifyChange())},d})();f.emitter=new c.a,s.a=f},function(t,s,a){var l,c=typeof Reflect=="object"?Reflect:null,u=c&&typeof c.apply=="function"?c.apply:function(O,H,q){return Function.prototype.apply.call(O,H,q)};l=c&&typeof c.ownKeys=="function"?c.ownKeys:Object.getOwnPropertySymbols?function(O){return Object.getOwnPropertyNames(O).concat(Object.getOwnPropertySymbols(O))}:function(O){return Object.getOwnPropertyNames(O)};var f=Number.isNaN||function(O){return O!=O};function d(){d.init.call(this)}t.exports=d,t.exports.once=function(O,H){return new Promise((function(q,U){function k(I){O.removeListener(H,M),U(I)}function M(){typeof O.removeListener=="function"&&O.removeListener("error",k),q([].slice.call(arguments))}L(O,H,M,{once:!0}),H!=="error"&&(function(I,j,Z){typeof I.on=="function"&&L(I,"error",j,Z)})(O,k,{once:!0})}))},d.EventEmitter=d,d.prototype._events=void 0,d.prototype._eventsCount=0,d.prototype._maxListeners=void 0;var m=10;function g(O){if(typeof O!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof O)}function y(O){return O._maxListeners===void 0?d.defaultMaxListeners:O._maxListeners}function x(O,H,q,U){var k,M,I,j;if(g(q),(M=O._events)===void 0?(M=O._events=Object.create(null),O._eventsCount=0):(M.newListener!==void 0&&(O.emit("newListener",H,q.listener?q.listener:q),M=O._events),I=M[H]),I===void 0)I=M[H]=q,++O._eventsCount;else if(typeof I=="function"?I=M[H]=U?[q,I]:[I,q]:U?I.unshift(q):I.push(q),(k=y(O))>0&&I.length>k&&!I.warned){I.warned=!0;var Z=new Error("Possible EventEmitter memory leak detected. "+I.length+" "+String(H)+" listeners added. Use emitter.setMaxListeners() to increase limit");Z.name="MaxListenersExceededWarning",Z.emitter=O,Z.type=H,Z.count=I.length,j=Z,console&&console.warn&&console.warn(j)}return O}function v(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function E(O,H,q){var U={fired:!1,wrapFn:void 0,target:O,type:H,listener:q},k=v.bind(U);return k.listener=q,U.wrapFn=k,k}function A(O,H,q){var U=O._events;if(U===void 0)return[];var k=U[H];return k===void 0?[]:typeof k=="function"?q?[k.listener||k]:[k]:q?(function(M){for(var I=new Array(M.length),j=0;j<I.length;++j)I[j]=M[j].listener||M[j];return I})(k):D(k,k.length)}function R(O){var H=this._events;if(H!==void 0){var q=H[O];if(typeof q=="function")return 1;if(q!==void 0)return q.length}return 0}function D(O,H){for(var q=new Array(H),U=0;U<H;++U)q[U]=O[U];return q}function L(O,H,q,U){if(typeof O.on=="function")U.once?O.once(H,q):O.on(H,q);else{if(typeof O.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof O);O.addEventListener(H,(function k(M){U.once&&O.removeEventListener(H,k),q(M)}))}}Object.defineProperty(d,"defaultMaxListeners",{enumerable:!0,get:function(){return m},set:function(O){if(typeof O!="number"||O<0||f(O))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+O+".");m=O}}),d.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},d.prototype.setMaxListeners=function(O){if(typeof O!="number"||O<0||f(O))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+O+".");return this._maxListeners=O,this},d.prototype.getMaxListeners=function(){return y(this)},d.prototype.emit=function(O){for(var H=[],q=1;q<arguments.length;q++)H.push(arguments[q]);var U=O==="error",k=this._events;if(k!==void 0)U=U&&k.error===void 0;else if(!U)return!1;if(U){var M;if(H.length>0&&(M=H[0]),M instanceof Error)throw M;var I=new Error("Unhandled error."+(M?" ("+M.message+")":""));throw I.context=M,I}var j=k[O];if(j===void 0)return!1;if(typeof j=="function")u(j,this,H);else{var Z=j.length,ae=D(j,Z);for(q=0;q<Z;++q)u(ae[q],this,H)}return!0},d.prototype.addListener=function(O,H){return x(this,O,H,!1)},d.prototype.on=d.prototype.addListener,d.prototype.prependListener=function(O,H){return x(this,O,H,!0)},d.prototype.once=function(O,H){return g(H),this.on(O,E(this,O,H)),this},d.prototype.prependOnceListener=function(O,H){return g(H),this.prependListener(O,E(this,O,H)),this},d.prototype.removeListener=function(O,H){var q,U,k,M,I;if(g(H),(U=this._events)===void 0)return this;if((q=U[O])===void 0)return this;if(q===H||q.listener===H)--this._eventsCount==0?this._events=Object.create(null):(delete U[O],U.removeListener&&this.emit("removeListener",O,q.listener||H));else if(typeof q!="function"){for(k=-1,M=q.length-1;M>=0;M--)if(q[M]===H||q[M].listener===H){I=q[M].listener,k=M;break}if(k<0)return this;k===0?q.shift():(function(j,Z){for(;Z+1<j.length;Z++)j[Z]=j[Z+1];j.pop()})(q,k),q.length===1&&(U[O]=q[0]),U.removeListener!==void 0&&this.emit("removeListener",O,I||H)}return this},d.prototype.off=d.prototype.removeListener,d.prototype.removeAllListeners=function(O){var H,q,U;if((q=this._events)===void 0)return this;if(q.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):q[O]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete q[O]),this;if(arguments.length===0){var k,M=Object.keys(q);for(U=0;U<M.length;++U)(k=M[U])!=="removeListener"&&this.removeAllListeners(k);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(H=q[O])=="function")this.removeListener(O,H);else if(H!==void 0)for(U=H.length-1;U>=0;U--)this.removeListener(O,H[U]);return this},d.prototype.listeners=function(O){return A(this,O,!0)},d.prototype.rawListeners=function(O){return A(this,O,!1)},d.listenerCount=function(O,H){return typeof O.listenerCount=="function"?O.listenerCount(H):R.call(O,H)},d.prototype.listenerCount=R,d.prototype.eventNames=function(){return this._eventsCount>0?l(this._events):[]}},function(t,s,a){a.d(s,"b",(function(){return u})),a.d(s,"a",(function(){return f}));var l=a(2),c=a(6),u={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},f={NETWORK_EXCEPTION:l.b.EXCEPTION,NETWORK_STATUS_CODE_INVALID:l.b.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:l.b.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:l.b.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:c.a.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:c.a.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:c.a.CODEC_UNSUPPORTED}},function(t,s,a){a.d(s,"d",(function(){return l})),a.d(s,"b",(function(){return c})),a.d(s,"a",(function(){return u})),a.d(s,"c",(function(){return f}));var l=function(d,m,g,y,x){this.dts=d,this.pts=m,this.duration=g,this.originalDts=y,this.isSyncPoint=x,this.fileposition=null},c=(function(){function d(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return d.prototype.appendSyncPoint=function(m){m.isSyncPoint=!0,this.syncPoints.push(m)},d})(),u=(function(){function d(){this._list=[]}return d.prototype.clear=function(){this._list=[]},d.prototype.appendArray=function(m){var g=this._list;m.length!==0&&(g.length>0&&m[0].originalDts<g[g.length-1].originalDts&&this.clear(),Array.prototype.push.apply(g,m))},d.prototype.getLastSyncPointBeforeDts=function(m){if(this._list.length==0)return null;var g=this._list,y=0,x=g.length-1,v=0,E=0,A=x;for(m<g[0].dts&&(y=0,E=A+1);E<=A;){if((v=E+Math.floor((A-E)/2))===x||m>=g[v].dts&&m<g[v+1].dts){y=v;break}g[v].dts<m?E=v+1:A=v-1}return this._list[y]},d})(),f=(function(){function d(m){this._type=m,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(d.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),d.prototype.isEmpty=function(){return this._list.length===0},d.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},d.prototype._searchNearestSegmentBefore=function(m){var g=this._list;if(g.length===0)return-2;var y=g.length-1,x=0,v=0,E=y,A=0;if(m<g[0].originalBeginDts)return A=-1;for(;v<=E;){if((x=v+Math.floor((E-v)/2))===y||m>g[x].lastSample.originalDts&&m<g[x+1].originalBeginDts){A=x;break}g[x].originalBeginDts<m?v=x+1:E=x-1}return A},d.prototype._searchNearestSegmentAfter=function(m){return this._searchNearestSegmentBefore(m)+1},d.prototype.append=function(m){var g=this._list,y=m,x=this._lastAppendLocation,v=0;x!==-1&&x<g.length&&y.originalBeginDts>=g[x].lastSample.originalDts&&(x===g.length-1||x<g.length-1&&y.originalBeginDts<g[x+1].originalBeginDts)?v=x+1:g.length>0&&(v=this._searchNearestSegmentBefore(y.originalBeginDts)+1),this._lastAppendLocation=v,this._list.splice(v,0,y)},d.prototype.getLastSegmentBefore=function(m){var g=this._searchNearestSegmentBefore(m);return g>=0?this._list[g]:null},d.prototype.getLastSampleBefore=function(m){var g=this.getLastSegmentBefore(m);return g!=null?g.lastSample:null},d.prototype.getLastSyncPointBefore=function(m){for(var g=this._searchNearestSegmentBefore(m),y=this._list[g].syncPoints;y.length===0&&g>0;)g--,y=this._list[g].syncPoints;return y.length>0?y[y.length-1]:null},d})()},function(t,s,a){var l=(function(){function c(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return c.prototype.isComplete=function(){var u=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,f=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&u&&f},c.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},c.prototype.getNearestKeyframe=function(u){if(this.keyframesIndex==null)return null;var f=this.keyframesIndex,d=this._search(f.times,u);return{index:d,milliseconds:f.times[d],fileposition:f.filepositions[d]}},c.prototype._search=function(u,f){var d=0,m=u.length-1,g=0,y=0,x=m;for(f<u[0]&&(d=0,y=x+1);y<=x;){if((g=y+Math.floor((x-y)/2))===m||f>=u[g]&&f<u[g+1]){d=g;break}u[g]<f?y=g+1:x=g-1}return d},c})();s.a=l},function(t,s,a){var l=a(9),c=a.n(l),u=a(0),f=a(5),d=a(12);function m(N,w,S){var _=N;if(w+S<_.length){for(;S--;)if((192&_[++w])!=128)return!1;return!0}return!1}var g,y=function(N){for(var w=[],S=N,_=0,C=N.length;_<C;)if(S[_]<128)w.push(String.fromCharCode(S[_])),++_;else{if(!(S[_]<192)){if(S[_]<224){if(m(S,_,1)&&(F=(31&S[_])<<6|63&S[_+1])>=128){w.push(String.fromCharCode(65535&F)),_+=2;continue}}else if(S[_]<240){if(m(S,_,2)&&(F=(15&S[_])<<12|(63&S[_+1])<<6|63&S[_+2])>=2048&&(63488&F)!=55296){w.push(String.fromCharCode(65535&F)),_+=3;continue}}else if(S[_]<248){var F;if(m(S,_,3)&&(F=(7&S[_])<<18|(63&S[_+1])<<12|(63&S[_+2])<<6|63&S[_+3])>65536&&F<1114112){F-=65536,w.push(String.fromCharCode(F>>>10|55296)),w.push(String.fromCharCode(1023&F|56320)),_+=4;continue}}}w.push(""),++_}return w.join("")},x=a(3),v=(g=new ArrayBuffer(2),new DataView(g).setInt16(0,256,!0),new Int16Array(g)[0]===256),E=(function(){function N(){}return N.parseScriptData=function(w,S,_){var C={};try{var F=N.parseValue(w,S,_),G=N.parseValue(w,S+F.size,_-F.size);C[F.data]=G.data}catch(z){u.a.e("AMF",z.toString())}return C},N.parseObject=function(w,S,_){if(_<3)throw new x.a("Data not enough when parse ScriptDataObject");var C=N.parseString(w,S,_),F=N.parseValue(w,S+C.size,_-C.size),G=F.objectEnd;return{data:{name:C.data,value:F.data},size:C.size+F.size,objectEnd:G}},N.parseVariable=function(w,S,_){return N.parseObject(w,S,_)},N.parseString=function(w,S,_){if(_<2)throw new x.a("Data not enough when parse String");var C=new DataView(w,S,_).getUint16(0,!v);return{data:C>0?y(new Uint8Array(w,S+2,C)):"",size:2+C}},N.parseLongString=function(w,S,_){if(_<4)throw new x.a("Data not enough when parse LongString");var C=new DataView(w,S,_).getUint32(0,!v);return{data:C>0?y(new Uint8Array(w,S+4,C)):"",size:4+C}},N.parseDate=function(w,S,_){if(_<10)throw new x.a("Data size invalid when parse Date");var C=new DataView(w,S,_),F=C.getFloat64(0,!v),G=C.getInt16(8,!v);return{data:new Date(F+=60*G*1e3),size:10}},N.parseValue=function(w,S,_){if(_<1)throw new x.a("Data not enough when parse Value");var C,F=new DataView(w,S,_),G=1,z=F.getUint8(0),te=!1;try{switch(z){case 0:C=F.getFloat64(1,!v),G+=8;break;case 1:C=!!F.getUint8(1),G+=1;break;case 2:var J=N.parseString(w,S+1,_-1);C=J.data,G+=J.size;break;case 3:C={};var ne=0;for((16777215&F.getUint32(_-4,!v))==9&&(ne=3);G<_-4;){var de=N.parseObject(w,S+G,_-G-ne);if(de.objectEnd)break;C[de.data.name]=de.data.value,G+=de.size}G<=_-3&&(16777215&F.getUint32(G-1,!v))===9&&(G+=3);break;case 8:for(C={},G+=4,ne=0,(16777215&F.getUint32(_-4,!v))==9&&(ne=3);G<_-8;){var le=N.parseVariable(w,S+G,_-G-ne);if(le.objectEnd)break;C[le.data.name]=le.data.value,G+=le.size}G<=_-3&&(16777215&F.getUint32(G-1,!v))===9&&(G+=3);break;case 9:C=void 0,G=1,te=!0;break;case 10:C=[];var he=F.getUint32(1,!v);G+=4;for(var we=0;we<he;we++){var ke=N.parseValue(w,S+G,_-G);C.push(ke.data),G+=ke.size}break;case 11:var De=N.parseDate(w,S+1,_-1);C=De.data,G+=De.size;break;case 12:var Ye=N.parseString(w,S+1,_-1);C=Ye.data,G+=Ye.size;break;default:G=_,u.a.w("AMF","Unsupported AMF value type "+z)}}catch(Ve){u.a.e("AMF",Ve.toString())}return{data:C,size:G,objectEnd:te}},N})(),A=(function(){function N(w){this.TAG="ExpGolomb",this._buffer=w,this._buffer_index=0,this._total_bytes=w.byteLength,this._total_bits=8*w.byteLength,this._current_word=0,this._current_word_bits_left=0}return N.prototype.destroy=function(){this._buffer=null},N.prototype._fillCurrentWord=function(){var w=this._total_bytes-this._buffer_index;if(w<=0)throw new x.a("ExpGolomb: _fillCurrentWord() but no bytes available");var S=Math.min(4,w),_=new Uint8Array(4);_.set(this._buffer.subarray(this._buffer_index,this._buffer_index+S)),this._current_word=new DataView(_.buffer).getUint32(0,!1),this._buffer_index+=S,this._current_word_bits_left=8*S},N.prototype.readBits=function(w){if(w>32)throw new x.b("ExpGolomb: readBits() bits exceeded max 32bits!");if(w<=this._current_word_bits_left){var S=this._current_word>>>32-w;return this._current_word<<=w,this._current_word_bits_left-=w,S}var _=this._current_word_bits_left?this._current_word:0;_>>>=32-this._current_word_bits_left;var C=w-this._current_word_bits_left;this._fillCurrentWord();var F=Math.min(C,this._current_word_bits_left),G=this._current_word>>>32-F;return this._current_word<<=F,this._current_word_bits_left-=F,_=_<<F|G},N.prototype.readBool=function(){return this.readBits(1)===1},N.prototype.readByte=function(){return this.readBits(8)},N.prototype._skipLeadingZero=function(){var w;for(w=0;w<this._current_word_bits_left;w++)if((this._current_word&2147483648>>>w)!=0)return this._current_word<<=w,this._current_word_bits_left-=w,w;return this._fillCurrentWord(),w+this._skipLeadingZero()},N.prototype.readUEG=function(){var w=this._skipLeadingZero();return this.readBits(w+1)-1},N.prototype.readSEG=function(){var w=this.readUEG();return 1&w?w+1>>>1:-1*(w>>>1)},N})(),R=(function(){function N(){}return N._ebsp2rbsp=function(w){for(var S=w,_=S.byteLength,C=new Uint8Array(_),F=0,G=0;G<_;G++)G>=2&&S[G]===3&&S[G-1]===0&&S[G-2]===0||(C[F]=S[G],F++);return new Uint8Array(C.buffer,0,F)},N.parseSPS=function(w){for(var S=w.subarray(1,4),_="avc1.",C=0;C<3;C++){var F=S[C].toString(16);F.length<2&&(F="0"+F),_+=F}var G=N._ebsp2rbsp(w),z=new A(G);z.readByte();var te=z.readByte();z.readByte();var J=z.readByte();z.readUEG();var ne=N.getProfileString(te),de=N.getLevelString(J),le=1,he=420,we=8,ke=8;if((te===100||te===110||te===122||te===244||te===44||te===83||te===86||te===118||te===128||te===138||te===144)&&((le=z.readUEG())===3&&z.readBits(1),le<=3&&(he=[0,420,422,444][le]),we=z.readUEG()+8,ke=z.readUEG()+8,z.readBits(1),z.readBool()))for(var De=le!==3?8:12,Ye=0;Ye<De;Ye++)z.readBool()&&(Ye<6?N._skipScalingList(z,16):N._skipScalingList(z,64));z.readUEG();var Ve=z.readUEG();if(Ve===0)z.readUEG();else if(Ve===1){z.readBits(1),z.readSEG(),z.readSEG();var Fe=z.readUEG();for(Ye=0;Ye<Fe;Ye++)z.readSEG()}var at=z.readUEG();z.readBits(1);var gt=z.readUEG(),Ke=z.readUEG(),tt=z.readBits(1);tt===0&&z.readBits(1),z.readBits(1);var ht=0,nt=0,st=0,ft=0;z.readBool()&&(ht=z.readUEG(),nt=z.readUEG(),st=z.readUEG(),ft=z.readUEG());var Pt=1,ut=1,_t=0,Ft=!0,es=0,gi=0;if(z.readBool()){if(z.readBool()){var $t=z.readByte();$t>0&&$t<16?(Pt=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][$t-1],ut=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][$t-1]):$t===255&&(Pt=z.readByte()<<8|z.readByte(),ut=z.readByte()<<8|z.readByte())}if(z.readBool()&&z.readBool(),z.readBool()&&(z.readBits(4),z.readBool()&&z.readBits(24)),z.readBool()&&(z.readUEG(),z.readUEG()),z.readBool()){var Bs=z.readBits(32),js=z.readBits(32);Ft=z.readBool(),_t=(es=js)/(gi=2*Bs)}}var Ss=1;Pt===1&&ut===1||(Ss=Pt/ut);var hs=0,kt=0;le===0?(hs=1,kt=2-tt):(hs=le===3?1:2,kt=(le===1?2:1)*(2-tt));var ki=16*(gt+1),zs=16*(Ke+1)*(2-tt);ki-=(ht+nt)*hs,zs-=(st+ft)*kt;var Lr=Math.ceil(ki*Ss);return z.destroy(),z=null,{codec_mimetype:_,profile_idc:te,level_idc:J,profile_string:ne,level_string:de,chroma_format_idc:le,bit_depth:we,bit_depth_luma:we,bit_depth_chroma:ke,ref_frames:at,chroma_format:he,chroma_format_string:N.getChromaFormatString(he),frame_rate:{fixed:Ft,fps:_t,fps_den:gi,fps_num:es},sar_ratio:{width:Pt,height:ut},codec_size:{width:ki,height:zs},present_size:{width:Lr,height:zs}}},N._skipScalingList=function(w,S){for(var _=8,C=8,F=0;F<S;F++)C!==0&&(C=(_+w.readSEG()+256)%256),_=C===0?_:C},N.getProfileString=function(w){switch(w){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},N.getLevelString=function(w){return(w/10).toFixed(1)},N.getChromaFormatString=function(w){switch(w){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},N})(),D=a(6),L=(function(){function N(){}return N._ebsp2rbsp=function(w){for(var S=w,_=S.byteLength,C=new Uint8Array(_),F=0,G=0;G<_;G++)G>=2&&S[G]===3&&S[G-1]===0&&S[G-2]===0||(C[F]=S[G],F++);return new Uint8Array(C.buffer,0,F)},N.parseVPS=function(w){var S=N._ebsp2rbsp(w),_=new A(S);return _.readByte(),_.readByte(),_.readBits(4),_.readBits(2),_.readBits(6),{num_temporal_layers:_.readBits(3)+1,temporal_id_nested:_.readBool()}},N.parseSPS=function(w){var S=N._ebsp2rbsp(w),_=new A(S);_.readByte(),_.readByte();for(var C=0,F=0,G=0,z=0,te=(_.readBits(4),_.readBits(3)),J=(_.readBool(),_.readBits(2)),ne=_.readBool(),de=_.readBits(5),le=_.readByte(),he=_.readByte(),we=_.readByte(),ke=_.readByte(),De=_.readByte(),Ye=_.readByte(),Ve=_.readByte(),Fe=_.readByte(),at=_.readByte(),gt=_.readByte(),Ke=_.readByte(),tt=[],ht=[],nt=0;nt<te;nt++)tt.push(_.readBool()),ht.push(_.readBool());if(te>0)for(nt=te;nt<8;nt++)_.readBits(2);for(nt=0;nt<te;nt++)tt[nt]&&(_.readByte(),_.readByte(),_.readByte(),_.readByte(),_.readByte(),_.readByte(),_.readByte(),_.readByte(),_.readByte(),_.readByte(),_.readByte()),ht[nt]&&_.readByte();_.readUEG();var st=_.readUEG();st==3&&_.readBits(1);var ft=_.readUEG(),Pt=_.readUEG();_.readBool()&&(C+=_.readUEG(),F+=_.readUEG(),G+=_.readUEG(),z+=_.readUEG());var ut=_.readUEG(),_t=_.readUEG(),Ft=_.readUEG();for(nt=_.readBool()?0:te;nt<=te;nt++)_.readUEG(),_.readUEG(),_.readUEG();if(_.readUEG(),_.readUEG(),_.readUEG(),_.readUEG(),_.readUEG(),_.readUEG(),_.readBool()&&_.readBool())for(var es=0;es<4;es++)for(var gi=0;gi<(es===3?2:6);gi++)if(_.readBool()){var $t=Math.min(64,1<<4+(es<<1));for(es>1&&_.readSEG(),nt=0;nt<$t;nt++)_.readSEG()}else _.readUEG();_.readBool(),_.readBool(),_.readBool()&&(_.readByte(),_.readUEG(),_.readUEG(),_.readBool());var Bs=_.readUEG(),js=0;for(nt=0;nt<Bs;nt++){var Ss=!1;if(nt!==0&&(Ss=_.readBool()),Ss){nt===Bs&&_.readUEG(),_.readBool(),_.readUEG();for(var hs=0,kt=0;kt<=js;kt++){var ki=_.readBool(),zs=!1;ki||(zs=_.readBool()),(ki||zs)&&hs++}js=hs}else{var Lr=_.readUEG(),Uo=_.readUEG();for(js=Lr+Uo,kt=0;kt<Lr;kt++)_.readUEG(),_.readBool();for(kt=0;kt<Uo;kt++)_.readUEG(),_.readBool()}}if(_.readBool()){var sc=_.readUEG();for(nt=0;nt<sc;nt++){for(kt=0;kt<Ft+4;kt++)_.readBits(1);_.readBits(1)}}var Dr=0,Pa=1,Ba=1,Ua=!1,pi=1,Fa=1;if(_.readBool(),_.readBool(),_.readBool()){if(_.readBool()){var Nn=_.readByte();Nn>0&&Nn<=16?(Pa=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][Nn-1],Ba=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][Nn-1]):Nn===255&&(Pa=_.readBits(16),Ba=_.readBits(16))}if(_.readBool()&&_.readBool(),_.readBool()&&(_.readBits(3),_.readBool(),_.readBool()&&(_.readByte(),_.readByte(),_.readByte())),_.readBool()&&(_.readUEG(),_.readUEG()),_.readBool(),_.readBool(),_.readBool(),_.readBool()&&(_.readUEG(),_.readUEG(),_.readUEG(),_.readUEG()),_.readBool()&&(pi=_.readBits(32),Fa=_.readBits(32),_.readBool()&&_.readUEG(),_.readBool())){var ln=!1,cn=!1,Ga=!1;for(ln=_.readBool(),cn=_.readBool(),(ln||cn)&&((Ga=_.readBool())&&(_.readByte(),_.readBits(5),_.readBool(),_.readBits(5)),_.readBits(4),_.readBits(4),Ga&&_.readBits(4),_.readBits(5),_.readBits(5),_.readBits(5)),nt=0;nt<=te;nt++){var Ir=_.readBool();Ua=Ir;var Fo=!0,Rn=1;Ir||(Fo=_.readBool());var Mi=!1;if(Fo?_.readUEG():Mi=_.readBool(),Mi||(Rn=_.readUEG()+1),ln){for(kt=0;kt<Rn;kt++)_.readUEG(),_.readUEG(),Ga&&(_.readUEG(),_.readUEG());_.readBool()}if(cn){for(kt=0;kt<Rn;kt++)_.readUEG(),_.readUEG(),Ga&&(_.readUEG(),_.readUEG());_.readBool()}}}_.readBool()&&(_.readBool(),_.readBool(),_.readBool(),Dr=_.readUEG(),_.readUEG(),_.readUEG(),_.readUEG(),_.readUEG())}_.readBool();var Go="hvc1.".concat(de,".1.L").concat(Ke,".B0"),sa=ft-(C+F)*(st===1||st===2?2:1),Zi=Pt-(G+z)*(st===1?2:1),kr=1;return Pa!==1&&Ba!==1&&(kr=Pa/Ba),_.destroy(),_=null,{codec_mimetype:Go,profile_string:N.getProfileString(de),level_string:N.getLevelString(Ke),profile_idc:de,bit_depth:ut+8,ref_frames:1,chroma_format:st,chroma_format_string:N.getChromaFormatString(st),general_level_idc:Ke,general_profile_space:J,general_tier_flag:ne,general_profile_idc:de,general_profile_compatibility_flags_1:le,general_profile_compatibility_flags_2:he,general_profile_compatibility_flags_3:we,general_profile_compatibility_flags_4:ke,general_constraint_indicator_flags_1:De,general_constraint_indicator_flags_2:Ye,general_constraint_indicator_flags_3:Ve,general_constraint_indicator_flags_4:Fe,general_constraint_indicator_flags_5:at,general_constraint_indicator_flags_6:gt,min_spatial_segmentation_idc:Dr,constant_frame_rate:0,chroma_format_idc:st,bit_depth_luma_minus8:ut,bit_depth_chroma_minus8:_t,frame_rate:{fixed:Ua,fps:Fa/pi,fps_den:pi,fps_num:Fa},sar_ratio:{width:Pa,height:Ba},codec_size:{width:sa,height:Zi},present_size:{width:sa*kr,height:Zi}}},N.parsePPS=function(w){var S=N._ebsp2rbsp(w),_=new A(S);_.readByte(),_.readByte(),_.readUEG(),_.readUEG(),_.readBool(),_.readBool(),_.readBits(3),_.readBool(),_.readBool(),_.readUEG(),_.readUEG(),_.readSEG(),_.readBool(),_.readBool(),_.readBool()&&_.readUEG(),_.readSEG(),_.readSEG(),_.readBool(),_.readBool(),_.readBool(),_.readBool();var C=_.readBool(),F=_.readBool(),G=1;return F&&C?G=0:F?G=3:C&&(G=2),{parallelismType:G}},N.getChromaFormatString=function(w){switch(w){case 0:return"4:0:0";case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}},N.getProfileString=function(w){switch(w){case 1:return"Main";case 2:return"Main10";case 3:return"MainSP";case 4:return"Rext";case 9:return"SCC";default:return"Unknown"}},N.getLevelString=function(w){return(w/30).toFixed(1)},N})();function O(N){return N.byteOffset%2==0&&N.byteLength%2==0}function H(N){return N.byteOffset%4==0&&N.byteLength%4==0}function q(N,w){for(var S=0;S<N.length;S++)if(N[S]!==w[S])return!1;return!0}var U=function(N,w){return N.byteLength===w.byteLength&&(H(N)&&H(w)?(function(S,_){return q(new Uint32Array(S.buffer,S.byteOffset,S.byteLength/4),new Uint32Array(_.buffer,_.byteOffset,_.byteLength/4))})(N,w):O(N)&&O(w)?(function(S,_){return q(new Uint16Array(S.buffer,S.byteOffset,S.byteLength/2),new Uint16Array(_.buffer,_.byteOffset,_.byteLength/2))})(N,w):(function(S,_){return q(S,_)})(N,w))},k=function(){return(k=Object.assign||function(N){for(var w,S=1,_=arguments.length;S<_;S++)for(var C in w=arguments[S])Object.prototype.hasOwnProperty.call(w,C)&&(N[C]=w[C]);return N}).apply(this,arguments)},M=(function(){function N(){}return N.parseOBUs=function(w,S){for(var _=0;_<w.byteLength;){var C=_,F=(w[_],(120&w[_])>>3),G=(4&w[_])!=0,z=(2&w[_])!=0;w[_],_+=1,G&&(_+=1);var te=Number.POSITIVE_INFINITY;if(z){te=0;for(var J=0;;J++){var ne=w[_++];if(te|=(127&ne)<<7*J,(128&ne)==0)break}}console.log(F),F===1?S=k(k({},N.parseSeuqneceHeader(w.subarray(_,_+te))),{sequence_header_data:w.subarray(C,_+te)}):(F==3&&S||F==6&&S)&&(S=N.parseOBUFrameHeader(w.subarray(_,_+te),0,0,S)),_+=te}return S},N.parseSeuqneceHeader=function(w){var S=new A(w),_=S.readBits(3),C=(S.readBool(),S.readBool()),F=!0,G=0,z=1,te=void 0,J=[];if(C)J.push({operating_point_idc:0,level:S.readBits(5),tier:0});else{if(S.readBool()){var ne=S.readBits(32),de=S.readBits(32),le=S.readBool();if(le){for(var he=0;S.readBits(1)===0;)he+=1;he>=32||(1<<he)-1+S.readBits(he)}(G=de)/(z=ne),F=le,S.readBool()&&(S.readBits(5),S.readBits(32),te=S.readBits(5),S.readBits(5))}for(var we=S.readBool(),ke=S.readBits(5),De=0;De<=ke;De++){var Ye=S.readBits(12),Ve=S.readBits(5),Fe=Ve>7?S.readBits(1):0;J.push({operating_point_idc:Ye,level:Ve,tier:Fe}),we&&S.readBool()&&S.readBits(4)}}var at=J[0],gt=at.level,Ke=at.tier,tt=S.readBits(4),ht=S.readBits(4),nt=S.readBits(tt+1)+1,st=S.readBits(ht+1)+1,ft=!1;C||(ft=S.readBool()),ft&&(S.readBits(4),S.readBits(4)),S.readBool(),S.readBool(),S.readBool();var Pt=!1,ut=2,_t=2,Ft=0;C||(S.readBool(),S.readBool(),S.readBool(),S.readBool(),(Pt=S.readBool())&&(S.readBool(),S.readBool()),(ut=S.readBool()?2:S.readBits(1))?_t=S.readBool()?2:S.readBits(1):_t=2,Pt?Ft=S.readBits(3)+1:Ft=0);var es=S.readBool(),gi=(S.readBool(),S.readBool(),S.readBool()),$t=8;_===2&&gi?$t=S.readBool()?12:10:$t=gi?10:8;var Bs=!1;_!==1&&(Bs=S.readBool()),S.readBool()&&(S.readBits(8),S.readBits(8),S.readBits(8));var js=1,Ss=1;return Bs?(S.readBits(1),js=1,Ss=1):(S.readBits(1),_==0?(js=1,Ss=1):_==1?(js=0,Ss=0):$t==12?S.readBits(1)&&S.readBits(1):(js=1,Ss=0),js&&Ss&&S.readBits(2),S.readBits(1)),S.readBool(),S.destroy(),S=null,{codec_mimetype:"av01.".concat(_,".").concat(N.getLevelString(gt,Ke),".").concat($t.toString(10).padStart(2,"0")),level:gt,tier:Ke,level_string:N.getLevelString(gt,Ke),profile_idc:_,profile_string:"".concat(_),bit_depth:$t,ref_frames:1,chroma_format:N.getChromaFormat(Bs,js,Ss),chroma_format_string:N.getChromaFormatString(Bs,js,Ss),sequence_header:{frame_id_numbers_present_flag:ft,additional_frame_id_length_minus_1:void 0,delta_frame_id_length_minus_2:void 0,reduced_still_picture_header:C,decoder_model_info_present_flag:!1,operating_points:J,buffer_removal_time_length_minus_1:te,equal_picture_interval:F,seq_force_screen_content_tools:ut,seq_force_integer_mv:_t,enable_order_hint:Pt,order_hint_bits:Ft,enable_superres:es,frame_width_bit:tt+1,frame_height_bit:ht+1,max_frame_width:nt,max_frame_height:st},keyframe:void 0,frame_rate:{fixed:F,fps:G/z,fps_den:z,fps_num:G}}},N.parseOBUFrameHeader=function(w,S,_,C){var F=C.sequence_header,G=new A(w),z=(F.max_frame_width,F.max_frame_height,0);F.frame_id_numbers_present_flag&&(z=F.additional_frame_id_length_minus_1+F.delta_frame_id_length_minus_2+3);var te=0,J=!0,ne=!0,de=!1;if(!F.reduced_still_picture_header){if(G.readBool())return C;J=(te=G.readBits(2))===2||te===0,(ne=G.readBool())&&F.decoder_model_info_present_flag&&F.equal_picture_interval,ne&&G.readBool(),de=!!(te===3||te===0&&ne)||G.readBool()}C.keyframe=J,G.readBool();var le=F.seq_force_screen_content_tools;F.seq_force_screen_content_tools===2&&(le=G.readBits(1)),le&&(F.seq_force_integer_mv,F.seq_force_integer_mv==2&&G.readBits(1)),F.frame_id_numbers_present_flag&&G.readBits(z);var he=!1;if(he=te==3||!F.reduced_still_picture_header&&G.readBool(),G.readBits(F.order_hint_bits),J||de||G.readBits(3),F.decoder_model_info_present_flag&&G.readBool()){for(var we=0;we<=F.operating_points_cnt_minus_1;we++)if(F.operating_points[we].decoder_model_present_for_this_op[we]){var ke=F.operating_points[we].operating_point_idc;(ke===0||ke>>S&1&&ke>>_+8&1)&&G.readBits(F.buffer_removal_time_length_minus_1+1)}}var De=255;if(te===3||te==0&&ne||(De=G.readBits(8)),(J||De!==255)&&de&&F.enable_order_hint)for(var Ye=0;Ye<8;Ye++)G.readBits(F.order_hint_bits);if(J){var Ve=N.frameSizeAndRenderSize(G,he,F);C.codec_size={width:Ve.FrameWidth,height:Ve.FrameHeight},C.present_size={width:Ve.RenderWidth,height:Ve.RenderHeight},C.sar_ratio={width:Ve.RenderWidth/Ve.FrameWidth,height:Ve.RenderHeight/Ve.FrameHeight}}return G.destroy(),G=null,C},N.frameSizeAndRenderSize=function(w,S,_){var C=_.max_frame_width,F=_.max_frame_height;S&&(C=w.readBits(_.frame_width_bit)+1,F=w.readBits(_.frame_height_bit)+1);var G=!1;_.enable_superres&&(G=w.readBool());var z=8;G&&(z=w.readBits(3)+9);var te=C;C=Math.floor((8*te+z/2)/z);var J=te,ne=F;if(w.readBool()){var de=w.readBits(16)+1,le=w.readBits(16)+1;J=w.readBits(de)+1,ne=w.readBits(le)+1}return{UpscaledWidth:te,FrameWidth:C,FrameHeight:F,RenderWidth:J,RenderHeight:ne}},N.getLevelString=function(w,S){return"".concat(w.toString(10).padStart(2,"0")).concat(S===0?"M":"H")},N.getChromaFormat=function(w,S,_){return w?0:S===0&&_===0?3:S===1&&_===0?2:S===1&&_===1?1:Number.NaN},N.getChromaFormatString=function(w,S,_){return w?"4:0:0":S===0&&_===0?"4:4:4":S===1&&_===0?"4:2:2":S===1&&_===1?"4:2:0":"Unknown"},N})(),I,j=(function(){function N(w,S){this.TAG="FLVDemuxer",this._config=S,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=w.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=w.hasAudioTrack,this._hasVideo=w.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new d.a,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=(function(){var _=new ArrayBuffer(2);return new DataView(_).setInt16(0,256,!0),new Int16Array(_)[0]===256})()}return N.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},N.probe=function(w){var S=new Uint8Array(w);if(S.byteLength<9)return{needMoreData:!0};var _={match:!1};if(S[0]!==70||S[1]!==76||S[2]!==86||S[3]!==1)return _;var C,F,G=(4&S[4])>>>2!=0,z=(1&S[4])!=0,te=(C=S)[F=5]<<24|C[F+1]<<16|C[F+2]<<8|C[F+3];return te<9?_:{match:!0,consumed:te,dataOffset:te,hasAudioTrack:G,hasVideoTrack:z}},N.prototype.bindDataSource=function(w){return w.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(N.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(w){this._onTrackMetadata=w},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(w){this._onMediaInfo=w},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(w){this._onMetaDataArrived=w},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(w){this._onScriptDataArrived=w},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"onError",{get:function(){return this._onError},set:function(w){this._onError=w},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(w){this._onDataAvailable=w},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(w){this._timestampBase=w},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"overridedDuration",{get:function(){return this._duration},set:function(w){this._durationOverrided=!0,this._duration=w,this._mediaInfo.duration=w},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"overridedHasAudio",{set:function(w){this._hasAudioFlagOverrided=!0,this._hasAudio=w,this._mediaInfo.hasAudio=w},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"overridedHasVideo",{set:function(w){this._hasVideoFlagOverrided=!0,this._hasVideo=w,this._mediaInfo.hasVideo=w},enumerable:!1,configurable:!0}),N.prototype.resetMediaInfo=function(){this._mediaInfo=new d.a},N.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched},N.prototype.parseChunks=function(w,S){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new x.a("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var _=0,C=this._littleEndian;if(S===0){if(!(w.byteLength>13))return 0;_=N.probe(w).dataOffset}for(this._firstParse&&(this._firstParse=!1,S+_!==this._dataOffset&&u.a.w(this.TAG,"First time parsing but chunk byteStart invalid!"),(F=new DataView(w,_)).getUint32(0,!C)!==0&&u.a.w(this.TAG,"PrevTagSize0 !== 0 !!!"),_+=4);_<w.byteLength;){this._dispatch=!0;var F=new DataView(w,_);if(_+11+4>w.byteLength)break;var G=F.getUint8(0),z=16777215&F.getUint32(0,!C);if(_+11+z+4>w.byteLength)break;if(G===8||G===9||G===18){var te=F.getUint8(4),J=F.getUint8(5),ne=F.getUint8(6)|J<<8|te<<16|F.getUint8(7)<<24;(16777215&F.getUint32(7,!C))!==0&&u.a.w(this.TAG,"Meet tag which has StreamID != 0!");var de=_+11;switch(G){case 8:this._parseAudioData(w,de,z,ne);break;case 9:this._parseVideoData(w,de,z,ne,S+_);break;case 18:this._parseScriptData(w,de,z)}var le=F.getUint32(11+z,!C);le!==11+z&&u.a.w(this.TAG,"Invalid PrevTagSize ".concat(le)),_+=11+z+4}else u.a.w(this.TAG,"Unsupported tag type ".concat(G,", skipped")),_+=11+z+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),_},N.prototype._parseScriptData=function(w,S,_){var C=E.parseScriptData(w,S,_);if(C.hasOwnProperty("onMetaData")){if(C.onMetaData==null||typeof C.onMetaData!="object")return void u.a.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&u.a.w(this.TAG,"Found another onMetaData tag!"),this._metadata=C;var F=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},F)),typeof F.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=F.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof F.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=F.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof F.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=F.audiodatarate),typeof F.videodatarate=="number"&&(this._mediaInfo.videoDataRate=F.videodatarate),typeof F.width=="number"&&(this._mediaInfo.width=F.width),typeof F.height=="number"&&(this._mediaInfo.height=F.height),typeof F.duration=="number"){if(!this._durationOverrided){var G=Math.floor(F.duration*this._timescale);this._duration=G,this._mediaInfo.duration=G}}else this._mediaInfo.duration=0;if(typeof F.framerate=="number"){var z=Math.floor(1e3*F.framerate);if(z>0){var te=z/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=te,this._referenceFrameRate.fps_num=z,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=te}}if(typeof F.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var J=F.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(J),F.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=F,u.a.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(C).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},C))},N.prototype._parseKeyframesIndex=function(w){for(var S=[],_=[],C=1;C<w.times.length;C++){var F=this._timestampBase+Math.floor(1e3*w.times[C]);S.push(F),_.push(w.filepositions[C])}return{times:S,filepositions:_}},N.prototype._parseAudioData=function(w,S,_,C){if(_<=1)u.a.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else if(this._hasAudioFlagOverrided!==!0||this._hasAudio!==!1){this._littleEndian;var F=new DataView(w,S,_).getUint8(0),G=F>>>4;if(G!==9)if(G===2||G===10){var z=0,te=(12&F)>>>2;if(te>=0&&te<=4){z=this._flvSoundRateTable[te];var J=1&F,ne=this._audioMetadata,de=this._audioTrack;if(ne||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(ne=this._audioMetadata={}).type="audio",ne.id=de.id,ne.timescale=this._timescale,ne.duration=this._duration,ne.audioSampleRate=z,ne.channelCount=J===0?1:2),G===10){var le=this._parseAACAudioData(w,S+1,_-1);if(le==null)return;if(le.packetType===0){if(ne.config){if(U(le.data.config,ne.config))return;u.a.w(this.TAG,"AudioSpecificConfig has been changed, re-generate initialization segment")}var he=le.data;ne.audioSampleRate=he.samplingRate,ne.channelCount=he.channelCount,ne.codec=he.codec,ne.originalCodec=he.originalCodec,ne.config=he.config,ne.refSampleDuration=1024/ne.audioSampleRate*ne.timescale,u.a.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",ne),(De=this._mediaInfo).audioCodec=ne.originalCodec,De.audioSampleRate=ne.audioSampleRate,De.audioChannelCount=ne.channelCount,De.hasVideo?De.videoCodec!=null&&(De.mimeType='video/x-flv; codecs="'+De.videoCodec+","+De.audioCodec+'"'):De.mimeType='video/x-flv; codecs="'+De.audioCodec+'"',De.isComplete()&&this._onMediaInfo(De)}else if(le.packetType===1){var we=this._timestampBase+C,ke={unit:le.data,length:le.data.byteLength,dts:we,pts:we};de.samples.push(ke),de.length+=le.data.length}else u.a.e(this.TAG,"Flv: Unsupported AAC data type ".concat(le.packetType))}else if(G===2){if(!ne.codec){var De;if((he=this._parseMP3AudioData(w,S+1,_-1,!0))==null)return;ne.audioSampleRate=he.samplingRate,ne.channelCount=he.channelCount,ne.codec=he.codec,ne.originalCodec=he.originalCodec,ne.refSampleDuration=1152/ne.audioSampleRate*ne.timescale,u.a.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",ne),(De=this._mediaInfo).audioCodec=ne.codec,De.audioSampleRate=ne.audioSampleRate,De.audioChannelCount=ne.channelCount,De.audioDataRate=he.bitRate,De.hasVideo?De.videoCodec!=null&&(De.mimeType='video/x-flv; codecs="'+De.videoCodec+","+De.audioCodec+'"'):De.mimeType='video/x-flv; codecs="'+De.audioCodec+'"',De.isComplete()&&this._onMediaInfo(De)}var Ye=this._parseMP3AudioData(w,S+1,_-1,!1);if(Ye==null)return;we=this._timestampBase+C;var Ve={unit:Ye,length:Ye.byteLength,dts:we,pts:we};de.samples.push(Ve),de.length+=Ye.length}}else this._onError(D.a.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+te)}else this._onError(D.a.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+G);else{if(_<=5)return void u.a.w(this.TAG,"Flv: Invalid audio packet, missing AudioFourCC in Ehnanced FLV payload!");var Fe=15&F,at=String.fromCharCode.apply(String,new Uint8Array(w,S,_).slice(1,5));switch(at){case"Opus":this._parseOpusAudioPacket(w,S+5,_-5,C,Fe);break;case"fLaC":this._parseFlacAudioPacket(w,S+5,_-5,C,Fe);break;default:this._onError(D.a.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec: "+at)}}}},N.prototype._parseAACAudioData=function(w,S,_){if(!(_<=1)){var C={},F=new Uint8Array(w,S,_);return C.packetType=F[0],F[0]===0?C.data=this._parseAACAudioSpecificConfig(w,S+1,_-1):C.data=F.subarray(1),C}u.a.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")},N.prototype._parseAACAudioSpecificConfig=function(w,S,_){var C,F,G=new Uint8Array(w,S,_),z=null,te=0,J=null;if(te=C=G[0]>>>3,(F=(7&G[0])<<1|G[1]>>>7)<0||F>=this._mpegSamplingRates.length)this._onError(D.a.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var ne=this._mpegSamplingRates[F],de=(120&G[1])>>>3;if(!(de<0||de>=8)){te===5&&(J=(7&G[1])<<1|G[2]>>>7,(124&G[2])>>>2);var le=self.navigator.userAgent.toLowerCase();return le.indexOf("firefox")!==-1?F>=6?(te=5,z=new Array(4),J=F-3):(te=2,z=new Array(2),J=F):le.indexOf("android")!==-1?(te=2,z=new Array(2),J=F):(te=5,J=F,z=new Array(4),F>=6?J=F-3:de===1&&(te=2,z=new Array(2),J=F)),z[0]=te<<3,z[0]|=(15&F)>>>1,z[1]=(15&F)<<7,z[1]|=(15&de)<<3,te===5&&(z[1]|=(15&J)>>>1,z[2]=(1&J)<<7,z[2]|=8,z[3]=0),{config:z,samplingRate:ne,channelCount:de,codec:"mp4a.40."+te,originalCodec:"mp4a.40."+C}}this._onError(D.a.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}},N.prototype._parseMP3AudioData=function(w,S,_,C){if(!(_<4)){this._littleEndian;var F=new Uint8Array(w,S,_),G=null;if(C){if(F[0]!==255)return;var z=F[1]>>>3&3,te=(6&F[1])>>1,J=(240&F[2])>>>4,ne=(12&F[2])>>>2,de=(F[3]>>>6&3)!==3?2:1,le=0,he=0;switch(z){case 0:le=this._mpegAudioV25SampleRateTable[ne];break;case 2:le=this._mpegAudioV20SampleRateTable[ne];break;case 3:le=this._mpegAudioV10SampleRateTable[ne]}switch(te){case 1:J<this._mpegAudioL3BitRateTable.length&&(he=this._mpegAudioL3BitRateTable[J]);break;case 2:J<this._mpegAudioL2BitRateTable.length&&(he=this._mpegAudioL2BitRateTable[J]);break;case 3:J<this._mpegAudioL1BitRateTable.length&&(he=this._mpegAudioL1BitRateTable[J])}G={bitRate:he,samplingRate:le,channelCount:de,codec:"mp3",originalCodec:"mp3"}}else G=F;return G}u.a.w(this.TAG,"Flv: Invalid MP3 packet, header missing!")},N.prototype._parseOpusAudioPacket=function(w,S,_,C,F){if(F===0)this._parseOpusSequenceHeader(w,S,_);else if(F===1)this._parseOpusAudioData(w,S,_,C);else if(F!==2)return void this._onError(D.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(F))},N.prototype._parseOpusSequenceHeader=function(w,S,_){if(_<=16)u.a.w(this.TAG,"Flv: Invalid OpusSequenceHeader, lack of data!");else{var C=this._audioMetadata,F=this._audioTrack;C||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(C=this._audioMetadata={}).type="audio",C.id=F.id,C.timescale=this._timescale,C.duration=this._duration);var G=new DataView(w,S,_);G.setUint8(8,0);var z=G.getUint8(9);G.setUint16(10,G.getUint16(10,!0),!1);var te=G.getUint32(12,!0);G.setUint32(12,G.getUint32(12,!0),!1);var J={config:new Uint8Array(w,S+8,_-8),channelCount:z,samplingFrequence:te,codec:"opus",originalCodec:"opus"};if(C.config){if(U(J.config,C.config))return;u.a.w(this.TAG,"OpusSequenceHeader has been changed, re-generate initialization segment")}C.audioSampleRate=J.samplingFrequence,C.channelCount=J.channelCount,C.codec=J.codec,C.originalCodec=J.originalCodec,C.config=J.config,C.refSampleDuration=20,u.a.v(this.TAG,"Parsed OpusSequenceHeader"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",C);var ne=this._mediaInfo;ne.audioCodec=C.originalCodec,ne.audioSampleRate=C.audioSampleRate,ne.audioChannelCount=C.channelCount,ne.hasVideo?ne.videoCodec!=null&&(ne.mimeType='video/x-flv; codecs="'+ne.videoCodec+","+ne.audioCodec+'"'):ne.mimeType='video/x-flv; codecs="'+ne.audioCodec+'"',ne.isComplete()&&this._onMediaInfo(ne)}},N.prototype._parseOpusAudioData=function(w,S,_,C){var F=this._audioTrack,G=new Uint8Array(w,S,_),z=this._timestampBase+C,te={unit:G,length:G.byteLength,dts:z,pts:z};F.samples.push(te),F.length+=G.length},N.prototype._parseFlacAudioPacket=function(w,S,_,C,F){if(F===0)this._parseFlacSequenceHeader(w,S,_);else if(F===1)this._parseFlacAudioData(w,S,_,C);else if(F!==2)return void this._onError(D.a.FORMAT_ERROR,"Flv: Invalid Flac audio packet type ".concat(F))},N.prototype._parseFlacSequenceHeader=function(w,S,_){var C=this._audioMetadata,F=this._audioTrack;C||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(C=this._audioMetadata={}).type="audio",C.id=F.id,C.timescale=this._timescale,C.duration=this._duration);var G=new Uint8Array(w,S+4,_-4),z=new A(G),te=z.readBits(16),J=z.readBits(16),ne=J===te?J:null;z.readBits(24),z.readBits(24);var de=z.readBits(20),le=z.readBits(3)+1,he=z.readBits(5)+1;z.destroy();var we=new Uint8Array(G.byteLength+4);we.set(G,4),we[0]=128,we[1]=G.byteLength>>>16&255,we[2]=G.byteLength>>>8&255,we[3]=G.byteLength>>>0&255;var ke={config:we,channelCount:le,samplingFrequence:de,sampleSize:he,codec:"flac",originalCodec:"flac"};if(C.config){if(U(ke.config,C.config))return;u.a.w(this.TAG,"FlacSequenceHeader has been changed, re-generate initialization segment")}C.audioSampleRate=ke.samplingFrequence,C.channelCount=ke.channelCount,C.sampleSize=ke.sampleSize,C.codec=ke.codec,C.originalCodec=ke.originalCodec,C.config=ke.config,C.refSampleDuration=ne!=null?1e3*ne/ke.samplingFrequence:null,u.a.v(this.TAG,"Parsed FlacSequenceHeader"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",C);var De=this._mediaInfo;De.audioCodec=C.originalCodec,De.audioSampleRate=C.audioSampleRate,De.audioChannelCount=C.channelCount,De.hasVideo?De.videoCodec!=null&&(De.mimeType='video/x-flv; codecs="'+De.videoCodec+","+De.audioCodec+'"'):De.mimeType='video/x-flv; codecs="'+De.audioCodec+'"',De.isComplete()&&this._onMediaInfo(De)},N.prototype._parseFlacAudioData=function(w,S,_,C){var F=this._audioTrack,G=new Uint8Array(w,S,_),z=this._timestampBase+C,te={unit:G,length:G.byteLength,dts:z,pts:z};F.samples.push(te),F.length+=G.length},N.prototype._parseVideoData=function(w,S,_,C,F){if(_<=1)u.a.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else if(this._hasVideoFlagOverrided!==!0||this._hasVideo!==!1){var G=new Uint8Array(w,S,_)[0],z=(112&G)>>>4;if((128&G)!=0){var te=15&G,J=String.fromCharCode.apply(String,new Uint8Array(w,S,_).slice(1,5));if(J==="hvc1")this._parseEnhancedHEVCVideoPacket(w,S+5,_-5,C,F,z,te);else{if(J!=="av01")return void this._onError(D.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: ".concat(J));this._parseEnhancedAV1VideoPacket(w,S+5,_-5,C,F,z,te)}}else{var ne=15&G;if(ne===7)this._parseAVCVideoPacket(w,S+1,_-1,C,F,z);else{if(ne!==12)return void this._onError(D.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: ".concat(ne));this._parseHEVCVideoPacket(w,S+1,_-1,C,F,z)}}}},N.prototype._parseAVCVideoPacket=function(w,S,_,C,F,G){if(_<4)u.a.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var z=this._littleEndian,te=new DataView(w,S,_),J=te.getUint8(0),ne=(16777215&te.getUint32(0,!z))<<8>>8;if(J===0)this._parseAVCDecoderConfigurationRecord(w,S+4,_-4);else if(J===1)this._parseAVCVideoData(w,S+4,_-4,C,F,G,ne);else if(J!==2)return void this._onError(D.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(J))}},N.prototype._parseHEVCVideoPacket=function(w,S,_,C,F,G){if(_<4)u.a.w(this.TAG,"Flv: Invalid HEVC packet, missing HEVCPacketType or/and CompositionTime");else{var z=this._littleEndian,te=new DataView(w,S,_),J=te.getUint8(0),ne=(16777215&te.getUint32(0,!z))<<8>>8;if(J===0)this._parseHEVCDecoderConfigurationRecord(w,S+4,_-4);else if(J===1)this._parseHEVCVideoData(w,S+4,_-4,C,F,G,ne);else if(J!==2)return void this._onError(D.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(J))}},N.prototype._parseEnhancedHEVCVideoPacket=function(w,S,_,C,F,G,z){var te=this._littleEndian,J=new DataView(w,S,_);if(z===0)this._parseHEVCDecoderConfigurationRecord(w,S,_);else if(z===1){var ne=(4294967040&J.getUint32(0,!te))>>8;this._parseHEVCVideoData(w,S+3,_-3,C,F,G,ne)}else if(z===3)this._parseHEVCVideoData(w,S,_,C,F,G,0);else if(z!==2)return void this._onError(D.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(z))},N.prototype._parseEnhancedAV1VideoPacket=function(w,S,_,C,F,G,z){if(this._littleEndian,z===0)this._parseAV1CodecConfigurationRecord(w,S,_);else if(z===1)this._parseAV1VideoData(w,S,_,C,F,G,0);else{if(z===5)return void this._onError(D.a.FORMAT_ERROR,"Flv: Not Supported MP2T AV1 video packet type ".concat(z));if(z!==2)return void this._onError(D.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(z))}},N.prototype._parseAVCDecoderConfigurationRecord=function(w,S,_){if(_<7)u.a.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var C=this._videoMetadata,F=this._videoTrack,G=this._littleEndian,z=new DataView(w,S,_);if(C){if(C.avcc!==void 0){var te=new Uint8Array(w,S,_);if(U(te,C.avcc))return;u.a.w(this.TAG,"AVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(C=this._videoMetadata={}).type="video",C.id=F.id,C.timescale=this._timescale,C.duration=this._duration;var J=z.getUint8(0),ne=z.getUint8(1);if(z.getUint8(2),z.getUint8(3),J===1&&ne!==0)if(this._naluLengthSize=1+(3&z.getUint8(4)),this._naluLengthSize===3||this._naluLengthSize===4){var de=31&z.getUint8(5);if(de!==0){de>1&&u.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = ".concat(de));for(var le=6,he=0;he<de;he++){var we=z.getUint16(le,!G);if(le+=2,we!==0){var ke=new Uint8Array(w,S+le,we);le+=we;var De=R.parseSPS(ke);if(he===0){C.codecWidth=De.codec_size.width,C.codecHeight=De.codec_size.height,C.presentWidth=De.present_size.width,C.presentHeight=De.present_size.height,C.profile=De.profile_string,C.level=De.level_string,C.bitDepth=De.bit_depth,C.chromaFormat=De.chroma_format,C.sarRatio=De.sar_ratio,C.frameRate=De.frame_rate,De.frame_rate.fixed!==!1&&De.frame_rate.fps_num!==0&&De.frame_rate.fps_den!==0||(C.frameRate=this._referenceFrameRate);var Ye=C.frameRate.fps_den,Ve=C.frameRate.fps_num;C.refSampleDuration=C.timescale*(Ye/Ve);for(var Fe=ke.subarray(1,4),at="avc1.",gt=0;gt<3;gt++){var Ke=Fe[gt].toString(16);Ke.length<2&&(Ke="0"+Ke),at+=Ke}C.codec=at;var tt=this._mediaInfo;tt.width=C.codecWidth,tt.height=C.codecHeight,tt.fps=C.frameRate.fps,tt.profile=C.profile,tt.level=C.level,tt.refFrames=De.ref_frames,tt.chromaFormat=De.chroma_format_string,tt.sarNum=C.sarRatio.width,tt.sarDen=C.sarRatio.height,tt.videoCodec=at,tt.hasAudio?tt.audioCodec!=null&&(tt.mimeType='video/x-flv; codecs="'+tt.videoCodec+","+tt.audioCodec+'"'):tt.mimeType='video/x-flv; codecs="'+tt.videoCodec+'"',tt.isComplete()&&this._onMediaInfo(tt)}}}var ht=z.getUint8(le);if(ht!==0){for(ht>1&&u.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = ".concat(ht)),le++,he=0;he<ht;he++)we=z.getUint16(le,!G),le+=2,we!==0&&(le+=we);C.avcc=new Uint8Array(_),C.avcc.set(new Uint8Array(w,S,_),0),u.a.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",C)}else this._onError(D.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else this._onError(D.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else this._onError(D.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: ".concat(this._naluLengthSize-1));else this._onError(D.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}},N.prototype._parseHEVCDecoderConfigurationRecord=function(w,S,_){if(_<22)u.a.w(this.TAG,"Flv: Invalid HEVCDecoderConfigurationRecord, lack of data!");else{var C=this._videoMetadata,F=this._videoTrack,G=this._littleEndian,z=new DataView(w,S,_);if(C){if(C.hvcc!==void 0){var te=new Uint8Array(w,S,_);if(U(te,C.hvcc))return;u.a.w(this.TAG,"HEVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(C=this._videoMetadata={}).type="video",C.id=F.id,C.timescale=this._timescale,C.duration=this._duration;var J=z.getUint8(0),ne=31&z.getUint8(1);if(J!==0&&J!==1||ne===0)this._onError(D.a.FORMAT_ERROR,"Flv: Invalid HEVCDecoderConfigurationRecord");else if(this._naluLengthSize=1+(3&z.getUint8(21)),this._naluLengthSize===3||this._naluLengthSize===4){for(var de=z.getUint8(22),le=0,he=23;le<de;le++){var we=63&z.getUint8(he+0),ke=z.getUint16(he+1,!G);he+=3;for(var De=0;De<ke;De++){var Ye=z.getUint16(he+0,!G);if(De===0)if(we===33){he+=2;var Ve=new Uint8Array(w,S+he,Ye),Fe=L.parseSPS(Ve);C.codecWidth=Fe.codec_size.width,C.codecHeight=Fe.codec_size.height,C.presentWidth=Fe.present_size.width,C.presentHeight=Fe.present_size.height,C.profile=Fe.profile_string,C.level=Fe.level_string,C.bitDepth=Fe.bit_depth,C.chromaFormat=Fe.chroma_format,C.sarRatio=Fe.sar_ratio,C.frameRate=Fe.frame_rate,Fe.frame_rate.fixed!==!1&&Fe.frame_rate.fps_num!==0&&Fe.frame_rate.fps_den!==0||(C.frameRate=this._referenceFrameRate);var at=C.frameRate.fps_den,gt=C.frameRate.fps_num;C.refSampleDuration=C.timescale*(at/gt),C.codec=Fe.codec_mimetype;var Ke=this._mediaInfo;Ke.width=C.codecWidth,Ke.height=C.codecHeight,Ke.fps=C.frameRate.fps,Ke.profile=C.profile,Ke.level=C.level,Ke.refFrames=Fe.ref_frames,Ke.chromaFormat=Fe.chroma_format_string,Ke.sarNum=C.sarRatio.width,Ke.sarDen=C.sarRatio.height,Ke.videoCodec=Fe.codec_mimetype,Ke.hasAudio?Ke.audioCodec!=null&&(Ke.mimeType='video/x-flv; codecs="'+Ke.videoCodec+","+Ke.audioCodec+'"'):Ke.mimeType='video/x-flv; codecs="'+Ke.videoCodec+'"',Ke.isComplete()&&this._onMediaInfo(Ke),he+=Ye}else he+=2+Ye;else he+=2+Ye}}C.hvcc=new Uint8Array(_),C.hvcc.set(new Uint8Array(w,S,_),0),u.a.v(this.TAG,"Parsed HEVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",C)}else this._onError(D.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: ".concat(this._naluLengthSize-1))}},N.prototype._parseAV1CodecConfigurationRecord=function(w,S,_){if(_<4)u.a.w(this.TAG,"Flv: Invalid AV1CodecConfigurationRecord, lack of data!");else{var C=this._videoMetadata,F=this._videoTrack,G=(this._littleEndian,new DataView(w,S,_));C?C.av1c!==void 0&&u.a.w(this.TAG,"Found another AV1CodecConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(C=this._videoMetadata={}).type="video",C.id=F.id,C.timescale=this._timescale,C.duration=this._duration);var z=127&G.getUint8(0);if(G.getUint8(1),G.getUint8(1),G.getUint8(2),z===1){var te=M.parseOBUs(new Uint8Array(w,S+4,_-4));if(te!=null){C.profile=te.profile_string,C.level=te.level_string,C.bitDepth=te.bit_depth,C.chromaFormat=te.chroma_format,C.frameRate=te.frame_rate,te.frame_rate.fixed!==!1&&te.frame_rate.fps_num!==0&&te.frame_rate.fps_den!==0||(C.frameRate=this._referenceFrameRate);var J=C.frameRate.fps_den,ne=C.frameRate.fps_num;C.refSampleDuration=C.timescale*(J/ne),C.codec=te.codec_mimetype,C.extra=te;var de=this._mediaInfo;de.fps=C.frameRate.fps,de.profile=C.profile,de.level=C.level,de.refFrames=te.ref_frames,de.chromaFormat=te.chroma_format_string,de.videoCodec=te.codec_mimetype,de.hasAudio?de.audioCodec!=null&&(de.mimeType='video/x-flv; codecs="'+de.videoCodec+","+de.audioCodec+'"'):de.mimeType='video/x-flv; codecs="'+de.videoCodec+'"',de.isComplete()&&this._onMediaInfo(de),C.av1c=new Uint8Array(_),C.av1c.set(new Uint8Array(w,S,_),0),u.a.v(this.TAG,"Preparing AV1CodecConfigurationRecord")}else this._onError(D.a.FORMAT_ERROR,"Flv: Invalid AV1CodecConfigurationRecord")}else this._onError(D.a.FORMAT_ERROR,"Flv: Invalid AV1CodecConfigurationRecord")}},N.prototype._parseAVCVideoData=function(w,S,_,C,F,G,z){for(var te=this._littleEndian,J=new DataView(w,S,_),ne=[],de=0,le=0,he=this._naluLengthSize,we=this._timestampBase+C,ke=G===1;le<_;){if(le+4>=_){u.a.w(this.TAG,"Malformed Nalu near timestamp ".concat(we,", offset = ").concat(le,", dataSize = ").concat(_));break}var De=J.getUint32(le,!te);if(he===3&&(De>>>=8),De>_-he)return void u.a.w(this.TAG,"Malformed Nalus near timestamp ".concat(we,", NaluSize > DataSize!"));var Ye=31&J.getUint8(le+he);Ye===5&&(ke=!0);var Ve=new Uint8Array(w,S+le,he+De),Fe={type:Ye,data:Ve};ne.push(Fe),de+=Ve.byteLength,le+=he+De}if(ne.length){var at=this._videoTrack,gt={units:ne,length:de,isKeyframe:ke,dts:we,cts:z,pts:we+z};ke&&(gt.fileposition=F),at.samples.push(gt),at.length+=de}},N.prototype._parseHEVCVideoData=function(w,S,_,C,F,G,z){for(var te=this._littleEndian,J=new DataView(w,S,_),ne=[],de=0,le=0,he=this._naluLengthSize,we=this._timestampBase+C,ke=G===1;le<_;){if(le+4>=_){u.a.w(this.TAG,"Malformed Nalu near timestamp ".concat(we,", offset = ").concat(le,", dataSize = ").concat(_));break}var De=J.getUint32(le,!te);if(he===3&&(De>>>=8),De>_-he)return void u.a.w(this.TAG,"Malformed Nalus near timestamp ".concat(we,", NaluSize > DataSize!"));var Ye=J.getUint8(le+he)>>1&63;Ye!==19&&Ye!==20&&Ye!==21||(ke=!0);var Ve=new Uint8Array(w,S+le,he+De),Fe={type:Ye,data:Ve};ne.push(Fe),de+=Ve.byteLength,le+=he+De}if(ne.length){var at=this._videoTrack,gt={units:ne,length:de,isKeyframe:ke,dts:we,cts:z,pts:we+z};ke&&(gt.fileposition=F),at.samples.push(gt),at.length+=de}},N.prototype._parseAV1VideoData=function(w,S,_,C,F,G,z){this._littleEndian;var te,J=[],ne=this._timestampBase+C,de=G===1;if(de){var le=this._videoMetadata,he=M.parseOBUs(new Uint8Array(w,S,_),le.extra);if(he==null)return void this._onError(D.a.FORMAT_ERROR,"Flv: Invalid AV1 VideoData");console.log(he),le.codecWidth=he.codec_size.width,le.codecHeight=he.codec_size.height,le.presentWidth=he.present_size.width,le.presentHeight=he.present_size.height,le.sarRatio=he.sar_ratio;var we=this._mediaInfo;we.width=le.codecWidth,we.height=le.codecHeight,we.sarNum=le.sarRatio.width,we.sarDen=le.sarRatio.height,u.a.v(this.TAG,"Parsed AV1DecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",le)}if(te=_,J.push({unitType:0,data:new Uint8Array(w,S+0,_)}),J.length){var ke=this._videoTrack,De={units:J,length:te,isKeyframe:de,dts:ne,cts:z,pts:ne+z};de&&(De.fileposition=F),ke.samples.push(De),ke.length+=te}},N})(),Z=(function(){function N(){}return N.prototype.destroy=function(){this.onError=null,this.onMediaInfo=null,this.onMetaDataArrived=null,this.onTrackMetadata=null,this.onDataAvailable=null,this.onTimedID3Metadata=null,this.onSynchronousKLVMetadata=null,this.onAsynchronousKLVMetadata=null,this.onSMPTE2038Metadata=null,this.onSCTE35Metadata=null,this.onPESPrivateData=null,this.onPESPrivateDataDescriptor=null},N})(),ae=function(){this.program_pmt_pid={}};(function(N){N[N.kMPEG1Audio=3]="kMPEG1Audio",N[N.kMPEG2Audio=4]="kMPEG2Audio",N[N.kPESPrivateData=6]="kPESPrivateData",N[N.kADTSAAC=15]="kADTSAAC",N[N.kLOASAAC=17]="kLOASAAC",N[N.kAC3=129]="kAC3",N[N.kEAC3=135]="kEAC3",N[N.kMetadata=21]="kMetadata",N[N.kSCTE35=134]="kSCTE35",N[N.kH264=27]="kH264",N[N.kH265=36]="kH265"})(I||(I={}));var ie,re=function(){this.pid_stream_type={},this.common_pids={h264:void 0,h265:void 0,av1:void 0,adts_aac:void 0,loas_aac:void 0,opus:void 0,ac3:void 0,eac3:void 0,mp3:void 0},this.pes_private_data_pids={},this.timed_id3_pids={},this.synchronous_klv_pids={},this.asynchronous_klv_pids={},this.scte_35_pids={},this.smpte2038_pids={}},Q=function(){},se=function(){},oe=function(){this.slices=[],this.total_length=0,this.expected_length=0,this.file_position=0};(function(N){N[N.kUnspecified=0]="kUnspecified",N[N.kSliceNonIDR=1]="kSliceNonIDR",N[N.kSliceDPA=2]="kSliceDPA",N[N.kSliceDPB=3]="kSliceDPB",N[N.kSliceDPC=4]="kSliceDPC",N[N.kSliceIDR=5]="kSliceIDR",N[N.kSliceSEI=6]="kSliceSEI",N[N.kSliceSPS=7]="kSliceSPS",N[N.kSlicePPS=8]="kSlicePPS",N[N.kSliceAUD=9]="kSliceAUD",N[N.kEndOfSequence=10]="kEndOfSequence",N[N.kEndOfStream=11]="kEndOfStream",N[N.kFiller=12]="kFiller",N[N.kSPSExt=13]="kSPSExt",N[N.kReserved0=14]="kReserved0"})(ie||(ie={}));var Y,V,$=function(){},X=function(N){var w=N.data.byteLength;this.type=N.type,this.data=new Uint8Array(4+w),new DataView(this.data.buffer).setUint32(0,w),this.data.set(N.data,4)},me=(function(){function N(w){this.TAG="H264AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=w,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&u.a.e(this.TAG,"Could not find H264 startcode until payload end!")}return N.prototype.findNextStartCodeOffset=function(w){for(var S=w,_=this.data_;;){if(S+3>=_.byteLength)return this.eof_flag_=!0,_.byteLength;var C=_[S+0]<<24|_[S+1]<<16|_[S+2]<<8|_[S+3],F=_[S+0]<<16|_[S+1]<<8|_[S+2];if(C===1||F===1)return S;S++}},N.prototype.readNextNaluPayload=function(){for(var w=this.data_,S=null;S==null&&!this.eof_flag_;){var _=this.current_startcode_offset_,C=31&w[_+=(w[_]<<24|w[_+1]<<16|w[_+2]<<8|w[_+3])===1?4:3],F=(128&w[_])>>>7,G=this.findNextStartCodeOffset(_);if(this.current_startcode_offset_=G,!(C>=ie.kReserved0)&&F===0){var z=w.subarray(_,G);(S=new $).type=C,S.data=z}}return S},N})(),ve=(function(){function N(w,S,_){var C=8+w.byteLength+1+2+S.byteLength,F=!1;w[3]!==66&&w[3]!==77&&w[3]!==88&&(F=!0,C+=4);var G=this.data=new Uint8Array(C);G[0]=1,G[1]=w[1],G[2]=w[2],G[3]=w[3],G[4]=255,G[5]=225;var z=w.byteLength;G[6]=z>>>8,G[7]=255&z;var te=8;G.set(w,8),G[te+=z]=1;var J=S.byteLength;G[te+1]=J>>>8,G[te+2]=255&J,G.set(S,te+3),te+=3+J,F&&(G[te]=252|_.chroma_format_idc,G[te+1]=248|_.bit_depth_luma-8,G[te+2]=248|_.bit_depth_chroma-8,G[te+3]=0,te+=4)}return N.prototype.getData=function(){return this.data},N})();(function(N){N[N.kNull=0]="kNull",N[N.kAACMain=1]="kAACMain",N[N.kAAC_LC=2]="kAAC_LC",N[N.kAAC_SSR=3]="kAAC_SSR",N[N.kAAC_LTP=4]="kAAC_LTP",N[N.kAAC_SBR=5]="kAAC_SBR",N[N.kAAC_Scalable=6]="kAAC_Scalable",N[N.kLayer1=32]="kLayer1",N[N.kLayer2=33]="kLayer2",N[N.kLayer3=34]="kLayer3"})(Y||(Y={})),(function(N){N[N.k96000Hz=0]="k96000Hz",N[N.k88200Hz=1]="k88200Hz",N[N.k64000Hz=2]="k64000Hz",N[N.k48000Hz=3]="k48000Hz",N[N.k44100Hz=4]="k44100Hz",N[N.k32000Hz=5]="k32000Hz",N[N.k24000Hz=6]="k24000Hz",N[N.k22050Hz=7]="k22050Hz",N[N.k16000Hz=8]="k16000Hz",N[N.k12000Hz=9]="k12000Hz",N[N.k11025Hz=10]="k11025Hz",N[N.k8000Hz=11]="k8000Hz",N[N.k7350Hz=12]="k7350Hz"})(V||(V={}));var pe,ge,ee=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],ye=(pe=function(N,w){return(pe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,_){S.__proto__=_}||function(S,_){for(var C in _)Object.prototype.hasOwnProperty.call(_,C)&&(S[C]=_[C])})(N,w)},function(N,w){if(typeof w!="function"&&w!==null)throw new TypeError("Class extends value "+String(w)+" is not a constructor or null");function S(){this.constructor=N}pe(N,w),N.prototype=w===null?Object.create(w):(S.prototype=w.prototype,new S)}),Ie=function(){},Ue=(function(N){function w(){return N!==null&&N.apply(this,arguments)||this}return ye(w,N),w})(Ie),qe=(function(){function N(w){this.TAG="AACADTSParser",this.data_=w,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&u.a.e(this.TAG,"Could not found ADTS syncword until payload end")}return N.prototype.findNextSyncwordOffset=function(w){for(var S=w,_=this.data_;;){if(S+7>=_.byteLength)return this.eof_flag_=!0,_.byteLength;if((_[S+0]<<8|_[S+1])>>>4===4095)return S;S++}},N.prototype.readNextAACFrame=function(){for(var w=this.data_,S=null;S==null&&!this.eof_flag_;){var _=this.current_syncword_offset_,C=(8&w[_+1])>>>3,F=(6&w[_+1])>>>1,G=1&w[_+1],z=(192&w[_+2])>>>6,te=(60&w[_+2])>>>2,J=(1&w[_+2])<<2|(192&w[_+3])>>>6,ne=(3&w[_+3])<<11|w[_+4]<<3|(224&w[_+5])>>>5;if(w[_+6],_+ne>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var de=G===1?7:9,le=ne-de;_+=de;var he=this.findNextSyncwordOffset(_+le);if(this.current_syncword_offset_=he,(C===0||C===1)&&F===0){var we=w.subarray(_,_+le);(S=new Ie).audio_object_type=z+1,S.sampling_freq_index=te,S.sampling_frequency=ee[te],S.channel_config=J,S.data=we}}return S},N.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},N.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},N})(),ue=(function(){function N(w){this.TAG="AACLOASParser",this.data_=w,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&u.a.e(this.TAG,"Could not found LOAS syncword until payload end")}return N.prototype.findNextSyncwordOffset=function(w){for(var S=w,_=this.data_;;){if(S+1>=_.byteLength)return this.eof_flag_=!0,_.byteLength;if((_[S+0]<<3|_[S+1]>>>5)===695)return S;S++}},N.prototype.getLATMValue=function(w){for(var S=w.readBits(2),_=0,C=0;C<=S;C++)_<<=8,_|=w.readByte();return _},N.prototype.readNextAACFrame=function(w){for(var S=this.data_,_=null;_==null&&!this.eof_flag_;){var C=this.current_syncword_offset_,F=(31&S[C+1])<<8|S[C+2];if(C+3+F>=this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var G=new A(S.subarray(C+3,C+3+F)),z=null;if(G.readBool()){if(w==null){u.a.w(this.TAG,"StreamMuxConfig Missing"),this.current_syncword_offset_=this.findNextSyncwordOffset(C+3+F),G.destroy();continue}z=w}else{var te=G.readBool();if(te&&G.readBool()){u.a.e(this.TAG,"audioMuxVersionA is Not Supported"),G.destroy();break}if(te&&this.getLATMValue(G),!G.readBool()){u.a.e(this.TAG,"allStreamsSameTimeFraming zero is Not Supported"),G.destroy();break}if(G.readBits(6)!==0){u.a.e(this.TAG,"more than 2 numSubFrames Not Supported"),G.destroy();break}if(G.readBits(4)!==0){u.a.e(this.TAG,"more than 2 numProgram Not Supported"),G.destroy();break}if(G.readBits(3)!==0){u.a.e(this.TAG,"more than 2 numLayer Not Supported"),G.destroy();break}var J=te?this.getLATMValue(G):0,ne=G.readBits(5);J-=5;var de=G.readBits(4);J-=4;var le=G.readBits(4);J-=4,G.readBits(3),(J-=3)>0&&G.readBits(J);var he=G.readBits(3);if(he!==0){u.a.e(this.TAG,"frameLengthType = ".concat(he,". Only frameLengthType = 0 Supported")),G.destroy();break}G.readByte();var we=G.readBool();if(we)if(te)this.getLATMValue(G);else{for(var ke=0;;){ke<<=8;var De=G.readBool();if(ke+=G.readByte(),!De)break}console.log(ke)}G.readBool()&&G.readByte(),(z=new Ue).audio_object_type=ne,z.sampling_freq_index=de,z.sampling_frequency=ee[z.sampling_freq_index],z.channel_config=le,z.other_data_present=we}for(var Ye=0;;){var Ve=G.readByte();if(Ye+=Ve,Ve!==255)break}for(var Fe=new Uint8Array(Ye),at=0;at<Ye;at++)Fe[at]=G.readByte();(_=new Ue).audio_object_type=z.audio_object_type,_.sampling_freq_index=z.sampling_freq_index,_.sampling_frequency=ee[z.sampling_freq_index],_.channel_config=z.channel_config,_.other_data_present=z.other_data_present,_.data=Fe,this.current_syncword_offset_=this.findNextSyncwordOffset(C+3+F)}return _},N.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},N.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},N})(),Be=function(N){var w=null,S=N.audio_object_type,_=N.audio_object_type,C=N.sampling_freq_index,F=N.channel_config,G=0,z=navigator.userAgent.toLowerCase();z.indexOf("firefox")!==-1?C>=6?(_=5,w=new Array(4),G=C-3):(_=2,w=new Array(2),G=C):z.indexOf("android")!==-1?(_=2,w=new Array(2),G=C):(_=5,G=C,w=new Array(4),C>=6?G=C-3:F===1&&(_=2,w=new Array(2),G=C)),w[0]=_<<3,w[0]|=(15&C)>>>1,w[1]=(15&C)<<7,w[1]|=(15&F)<<3,_===5&&(w[1]|=(15&G)>>>1,w[2]=(1&G)<<7,w[2]|=8,w[3]=0),this.config=w,this.sampling_rate=ee[C],this.channel_count=F,this.codec_mimetype="mp4a.40."+_,this.original_codec_mimetype="mp4a.40."+S},Ge=function(){},yt=function(){};(function(N){N[N.kSpliceNull=0]="kSpliceNull",N[N.kSpliceSchedule=4]="kSpliceSchedule",N[N.kSpliceInsert=5]="kSpliceInsert",N[N.kTimeSignal=6]="kTimeSignal",N[N.kBandwidthReservation=7]="kBandwidthReservation",N[N.kPrivateCommand=255]="kPrivateCommand"})(ge||(ge={}));var He,dt=function(N){var w=N.readBool();return w?(N.readBits(6),{time_specified_flag:w,pts_time:4*N.readBits(31)+N.readBits(2)}):(N.readBits(7),{time_specified_flag:w})},Ot=function(N){var w=N.readBool();return N.readBits(6),{auto_return:w,duration:4*N.readBits(31)+N.readBits(2)}},ns=function(N,w){var S=w.readBits(8);return N?{component_tag:S}:{component_tag:S,splice_time:dt(w)}},os=function(N){return{component_tag:N.readBits(8),utc_splice_time:N.readBits(32)}},Se=function(N){var w=N.readBits(32),S=N.readBool();N.readBits(7);var _={splice_event_id:w,splice_event_cancel_indicator:S};if(S)return _;if(_.out_of_network_indicator=N.readBool(),_.program_splice_flag=N.readBool(),_.duration_flag=N.readBool(),N.readBits(5),_.program_splice_flag)_.utc_splice_time=N.readBits(32);else{_.component_count=N.readBits(8),_.components=[];for(var C=0;C<_.component_count;C++)_.components.push(os(N))}return _.duration_flag&&(_.break_duration=Ot(N)),_.unique_program_id=N.readBits(16),_.avail_num=N.readBits(8),_.avails_expected=N.readBits(8),_},ze=function(N,w,S,_){return{descriptor_tag:N,descriptor_length:w,identifier:S,provider_avail_id:_.readBits(32)}},ot=function(N,w,S,_){var C=_.readBits(8),F=_.readBits(3);_.readBits(5);for(var G="",z=0;z<F;z++)G+=String.fromCharCode(_.readBits(8));return{descriptor_tag:N,descriptor_length:w,identifier:S,preroll:C,dtmf_count:F,DTMF_char:G}},vt=function(N){var w=N.readBits(8);return N.readBits(7),{component_tag:w,pts_offset:4*N.readBits(31)+N.readBits(2)}},Zs=function(N,w,S,_){var C=_.readBits(32),F=_.readBool();_.readBits(7);var G={descriptor_tag:N,descriptor_length:w,identifier:S,segmentation_event_id:C,segmentation_event_cancel_indicator:F};if(F)return G;if(G.program_segmentation_flag=_.readBool(),G.segmentation_duration_flag=_.readBool(),G.delivery_not_restricted_flag=_.readBool(),G.delivery_not_restricted_flag?_.readBits(5):(G.web_delivery_allowed_flag=_.readBool(),G.no_regional_blackout_flag=_.readBool(),G.archive_allowed_flag=_.readBool(),G.device_restrictions=_.readBits(2)),!G.program_segmentation_flag){G.component_count=_.readBits(8),G.components=[];for(var z=0;z<G.component_count;z++)G.components.push(vt(_))}G.segmentation_duration_flag&&(G.segmentation_duration=_.readBits(40)),G.segmentation_upid_type=_.readBits(8),G.segmentation_upid_length=_.readBits(8);var te=new Uint8Array(G.segmentation_upid_length);for(z=0;z<G.segmentation_upid_length;z++)te[z]=_.readBits(8);return G.segmentation_upid=te.buffer,G.segmentation_type_id=_.readBits(8),G.segment_num=_.readBits(8),G.segments_expected=_.readBits(8),G.segmentation_type_id!==52&&G.segmentation_type_id!==54&&G.segmentation_type_id!==56&&G.segmentation_type_id!==58||(G.sub_segment_num=_.readBits(8),G.sub_segments_expected=_.readBits(8)),G},Ms=function(N,w,S,_){return{descriptor_tag:N,descriptor_length:w,identifier:S,TAI_seconds:_.readBits(48),TAI_ns:_.readBits(32),UTC_offset:_.readBits(16)}},Di=function(N){return{component_tag:N.readBits(8),ISO_code:String.fromCharCode(N.readBits(8),N.readBits(8),N.readBits(8)),Bit_Stream_Mode:N.readBits(3),Num_Channels:N.readBits(4),Full_Srvc_Audio:N.readBool()}},mi=function(N,w,S,_){for(var C=_.readBits(4),F=[],G=0;G<C;G++)F.push(Di(_));return{descriptor_tag:N,descriptor_length:w,identifier:S,audio_count:C,components:F}},Xi=function(N){var w=new A(N),S=w.readBits(8),_=w.readBool(),C=w.readBool();w.readBits(2);var F=w.readBits(12),G=w.readBits(8),z=w.readBool(),te=w.readBits(6),J=4*w.readBits(31)+w.readBits(2),ne=w.readBits(8),de=w.readBits(12),le=w.readBits(12),he=w.readBits(8),we=null;he===ge.kSpliceNull?we={}:he===ge.kSpliceSchedule?we=(function(st){for(var ft=st.readBits(8),Pt=[],ut=0;ut<ft;ut++)Pt.push(Se(st));return{splice_count:ft,events:Pt}})(w):he===ge.kSpliceInsert?we=(function(st){var ft=st.readBits(32),Pt=st.readBool();st.readBits(7);var ut={splice_event_id:ft,splice_event_cancel_indicator:Pt};if(Pt)return ut;if(ut.out_of_network_indicator=st.readBool(),ut.program_splice_flag=st.readBool(),ut.duration_flag=st.readBool(),ut.splice_immediate_flag=st.readBool(),st.readBits(4),ut.program_splice_flag&&!ut.splice_immediate_flag&&(ut.splice_time=dt(st)),!ut.program_splice_flag){ut.component_count=st.readBits(8),ut.components=[];for(var _t=0;_t<ut.component_count;_t++)ut.components.push(ns(ut.splice_immediate_flag,st))}return ut.duration_flag&&(ut.break_duration=Ot(st)),ut.unique_program_id=st.readBits(16),ut.avail_num=st.readBits(8),ut.avails_expected=st.readBits(8),ut})(w):he===ge.kTimeSignal?we=(function(st){return{splice_time:dt(st)}})(w):he===ge.kBandwidthReservation?we={}:he===ge.kPrivateCommand?we=(function(st,ft){for(var Pt=String.fromCharCode(ft.readBits(8),ft.readBits(8),ft.readBits(8),ft.readBits(8)),ut=new Uint8Array(st-4),_t=0;_t<st-4;_t++)ut[_t]=ft.readBits(8);return{identifier:Pt,private_data:ut.buffer}})(le,w):w.readBits(8*le);for(var ke=[],De=w.readBits(16),Ye=0;Ye<De;){var Ve=w.readBits(8),Fe=w.readBits(8),at=String.fromCharCode(w.readBits(8),w.readBits(8),w.readBits(8),w.readBits(8));Ve===0?ke.push(ze(Ve,Fe,at,w)):Ve===1?ke.push(ot(Ve,Fe,at,w)):Ve===2?ke.push(Zs(Ve,Fe,at,w)):Ve===3?ke.push(Ms(Ve,Fe,at,w)):Ve===4?ke.push(mi(Ve,Fe,at,w)):w.readBits(8*(Fe-4)),Ye+=2+Fe}var gt={table_id:S,section_syntax_indicator:_,private_indicator:C,section_length:F,protocol_version:G,encrypted_packet:z,encryption_algorithm:te,pts_adjustment:J,cw_index:ne,tier:de,splice_command_length:le,splice_command_type:he,splice_command:we,descriptor_loop_length:De,splice_descriptors:ke,E_CRC32:z?w.readBits(32):void 0,CRC32:w.readBits(32)};if(he===ge.kSpliceInsert){var Ke=we;if(Ke.splice_event_cancel_indicator)return{splice_command_type:he,detail:gt,data:N};if(Ke.program_splice_flag&&!Ke.splice_immediate_flag){var tt=Ke.duration_flag?Ke.break_duration.auto_return:void 0,ht=Ke.duration_flag?Ke.break_duration.duration/90:void 0;return Ke.splice_time.time_specified_flag?{splice_command_type:he,pts:(J+Ke.splice_time.pts_time)%Math.pow(2,33),auto_return:tt,duraiton:ht,detail:gt,data:N}:{splice_command_type:he,auto_return:tt,duraiton:ht,detail:gt,data:N}}return{splice_command_type:he,auto_return:tt=Ke.duration_flag?Ke.break_duration.auto_return:void 0,duraiton:ht=Ke.duration_flag?Ke.break_duration.duration/90:void 0,detail:gt,data:N}}if(he===ge.kTimeSignal){var nt=we;return nt.splice_time.time_specified_flag?{splice_command_type:he,pts:(J+nt.splice_time.pts_time)%Math.pow(2,33),detail:gt,data:N}:{splice_command_type:he,detail:gt,data:N}}return{splice_command_type:he,detail:gt,data:N}};(function(N){N[N.kSliceIDR_W_RADL=19]="kSliceIDR_W_RADL",N[N.kSliceIDR_N_LP=20]="kSliceIDR_N_LP",N[N.kSliceCRA_NUT=21]="kSliceCRA_NUT",N[N.kSliceVPS=32]="kSliceVPS",N[N.kSliceSPS=33]="kSliceSPS",N[N.kSlicePPS=34]="kSlicePPS",N[N.kSliceAUD=35]="kSliceAUD"})(He||(He={}));var Qi=function(){},Js=function(N){var w=N.data.byteLength;this.type=N.type,this.data=new Uint8Array(4+w),new DataView(this.data.buffer).setUint32(0,w),this.data.set(N.data,4)},Tr=(function(){function N(w){this.TAG="H265AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=w,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&u.a.e(this.TAG,"Could not find H265 startcode until payload end!")}return N.prototype.findNextStartCodeOffset=function(w){for(var S=w,_=this.data_;;){if(S+3>=_.byteLength)return this.eof_flag_=!0,_.byteLength;var C=_[S+0]<<24|_[S+1]<<16|_[S+2]<<8|_[S+3],F=_[S+0]<<16|_[S+1]<<8|_[S+2];if(C===1||F===1)return S;S++}},N.prototype.readNextNaluPayload=function(){for(var w=this.data_,S=null;S==null&&!this.eof_flag_;){var _=this.current_startcode_offset_,C=w[_+=(w[_]<<24|w[_+1]<<16|w[_+2]<<8|w[_+3])===1?4:3]>>1&63,F=(128&w[_])>>>7,G=this.findNextStartCodeOffset(_);if(this.current_startcode_offset_=G,F===0){var z=w.subarray(_,G);(S=new Qi).type=C,S.data=z}}return S},N})(),Ae=(function(){function N(w,S,_,C){var F=23+(5+w.byteLength)+(5+S.byteLength)+(5+_.byteLength),G=this.data=new Uint8Array(F);G[0]=1,G[1]=(3&C.general_profile_space)<<6|(C.general_tier_flag?1:0)<<5|31&C.general_profile_idc,G[2]=C.general_profile_compatibility_flags_1,G[3]=C.general_profile_compatibility_flags_2,G[4]=C.general_profile_compatibility_flags_3,G[5]=C.general_profile_compatibility_flags_4,G[6]=C.general_constraint_indicator_flags_1,G[7]=C.general_constraint_indicator_flags_2,G[8]=C.general_constraint_indicator_flags_3,G[9]=C.general_constraint_indicator_flags_4,G[10]=C.general_constraint_indicator_flags_5,G[11]=C.general_constraint_indicator_flags_6,G[12]=C.general_level_idc,G[13]=240|(3840&C.min_spatial_segmentation_idc)>>8,G[14]=255&C.min_spatial_segmentation_idc,G[15]=252|3&C.parallelismType,G[16]=252|3&C.chroma_format_idc,G[17]=248|7&C.bit_depth_luma_minus8,G[18]=248|7&C.bit_depth_chroma_minus8,G[19]=0,G[20]=0,G[21]=(3&C.constant_frame_rate)<<6|(7&C.num_temporal_layers)<<3|(C.temporal_id_nested?1:0)<<2|3,G[22]=3,G[23]=128|He.kSliceVPS,G[24]=0,G[25]=1,G[26]=(65280&w.byteLength)>>8,G[27]=(255&w.byteLength)>>0,G.set(w,28),G[23+(5+w.byteLength)+0]=128|He.kSliceSPS,G[23+(5+w.byteLength)+1]=0,G[23+(5+w.byteLength)+2]=1,G[23+(5+w.byteLength)+3]=(65280&S.byteLength)>>8,G[23+(5+w.byteLength)+4]=(255&S.byteLength)>>0,G.set(S,23+(5+w.byteLength)+5),G[23+(5+w.byteLength+5+S.byteLength)+0]=128|He.kSlicePPS,G[23+(5+w.byteLength+5+S.byteLength)+1]=0,G[23+(5+w.byteLength+5+S.byteLength)+2]=1,G[23+(5+w.byteLength+5+S.byteLength)+3]=(65280&_.byteLength)>>8,G[23+(5+w.byteLength+5+S.byteLength)+4]=(255&_.byteLength)>>0,G.set(_,23+(5+w.byteLength+5+S.byteLength)+5)}return N.prototype.getData=function(){return this.data},N})(),ct=function(){},Lt=function(){},ds=function(){},Ed=[[64,64,80,80,96,96,112,112,128,128,160,160,192,192,224,224,256,256,320,320,384,384,448,448,512,512,640,640,768,768,896,896,1024,1024,1152,1152,1280,1280],[69,70,87,88,104,105,121,122,139,140,174,175,208,209,243,244,278,279,348,349,417,418,487,488,557,558,696,697,835,836,975,976,1114,1115,1253,1254,1393,1394],[96,96,120,120,144,144,168,168,192,192,240,240,288,288,336,336,384,384,480,480,576,576,672,672,768,768,960,960,1152,1152,1344,1344,1536,1536,1728,1728,1920,1920]],Td=(function(){function N(w){this.TAG="AC3Parser",this.data_=w,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&u.a.e(this.TAG,"Could not found AC3 syncword until payload end")}return N.prototype.findNextSyncwordOffset=function(w){for(var S=w,_=this.data_;;){if(S+7>=_.byteLength)return this.eof_flag_=!0,_.byteLength;if((_[S+0]<<8|_[S+1]<<0)===2935)return S;S++}},N.prototype.readNextAC3Frame=function(){for(var w=this.data_,S=null;S==null&&!this.eof_flag_;){var _=this.current_syncword_offset_,C=w[_+4]>>6,F=[48e3,44200,33e3][C],G=63&w[_+4],z=2*Ed[C][G];if(isNaN(z)||_+z>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var te=this.findNextSyncwordOffset(_+z);this.current_syncword_offset_=te;var J=w[_+5]>>3,ne=7&w[_+5],de=w[_+6]>>5,le=0;(1&de)!=0&&de!==1&&(le+=2),(4&de)!=0&&(le+=2),de===2&&(le+=2);var he=(w[_+6]<<8|w[_+7]<<0)>>12-le&1,we=[2,1,2,3,3,4,4,5][de]+he;(S=new ds).sampling_frequency=F,S.channel_count=we,S.channel_mode=de,S.bit_stream_identification=J,S.low_frequency_effects_channel_on=he,S.bit_stream_mode=ne,S.frame_size_code=G,S.data=w.subarray(_,_+z)}return S},N.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},N.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},N})(),Ad=function(N){var w;w=[N.sampling_rate_code<<6|N.bit_stream_identification<<1|N.bit_stream_mode>>2,(3&N.bit_stream_mode)<<6|N.channel_mode<<3|N.low_frequency_effects_channel_on<<2|N.frame_size_code>>4,N.frame_size_code<<4&224],this.config=w,this.sampling_rate=N.sampling_frequency,this.bit_stream_identification=N.bit_stream_identification,this.bit_stream_mode=N.bit_stream_mode,this.low_frequency_effects_channel_on=N.low_frequency_effects_channel_on,this.channel_count=N.channel_count,this.channel_mode=N.channel_mode,this.codec_mimetype="ac-3",this.original_codec_mimetype="ac-3"},Ar=function(){},wr=(function(){function N(w){this.TAG="EAC3Parser",this.data_=w,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&u.a.e(this.TAG,"Could not found AC3 syncword until payload end")}return N.prototype.findNextSyncwordOffset=function(w){for(var S=w,_=this.data_;;){if(S+7>=_.byteLength)return this.eof_flag_=!0,_.byteLength;if((_[S+0]<<8|_[S+1]<<0)===2935)return S;S++}},N.prototype.readNextEAC3Frame=function(){for(var w=this.data_,S=null;S==null&&!this.eof_flag_;){var _=this.current_syncword_offset_,C=new A(w.subarray(_+2)),F=(C.readBits(2),C.readBits(3),C.readBits(11)+1<<1),G=C.readBits(2),z=null,te=null;G===3?(z=[24e3,22060,16e3][G=C.readBits(2)],te=3):(z=[48e3,44100,32e3][G],te=C.readBits(2));var J=C.readBits(3),ne=C.readBits(1),de=C.readBits(5);if(_+F>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var le=this.findNextSyncwordOffset(_+F);this.current_syncword_offset_=le;var he=[2,1,2,3,3,4,4,5][J]+ne;C.destroy(),(S=new Ar).sampling_frequency=z,S.channel_count=he,S.channel_mode=J,S.bit_stream_identification=de,S.low_frequency_effects_channel_on=ne,S.frame_size=F,S.num_blks=[1,2,3,6][te],S.data=w.subarray(_,_+F)}return S},N.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},N.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},N})(),Nr=function(N){var w,S=Math.floor(N.frame_size*N.sampling_frequency/(16*N.num_blks));w=[255&S,248&S,N.sampling_rate_code<<6|N.bit_stream_identification<<1|0,0|N.channel_mode<<1|N.low_frequency_effects_channel_on<<0,0],this.config=w,this.sampling_rate=N.sampling_frequency,this.bit_stream_identification=N.bit_stream_identification,this.num_blks=N.num_blks,this.low_frequency_effects_channel_on=N.low_frequency_effects_channel_on,this.channel_count=N.channel_count,this.channel_mode=N.channel_mode,this.codec_mimetype="ec-3",this.original_codec_mimetype="ec-3"},An=function(){},Rr=(function(){function N(w){this.TAG="AV1OBUInMpegTsParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=w,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&u.a.e(this.TAG,"Could not find AV1 startcode until payload end!")}return N._ebsp2rbsp=function(w){for(var S=w,_=S.byteLength,C=new Uint8Array(_),F=0,G=0;G<_;G++)G>=2&&S[G]===3&&S[G-1]===0&&S[G-2]===0||(C[F]=S[G],F++);return new Uint8Array(C.buffer,0,F)},N.prototype.findNextStartCodeOffset=function(w){for(var S=w,_=this.data_;;){if(S+2>=_.byteLength)return this.eof_flag_=!0,_.byteLength;if((_[S+0]<<16|_[S+1]<<8|_[S+2])===1)return S;S++}},N.prototype.readNextOBUPayload=function(){for(var w=this.data_,S=null;S==null&&!this.eof_flag_;){var _=this.current_startcode_offset_+3,C=this.findNextStartCodeOffset(_);this.current_startcode_offset_=C,S=N._ebsp2rbsp(w.subarray(_,C))}return S},N})(),Oa=(function(){var N=function(w,S){return(N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,C){_.__proto__=C}||function(_,C){for(var F in C)Object.prototype.hasOwnProperty.call(C,F)&&(_[F]=C[F])})(w,S)};return function(w,S){if(typeof S!="function"&&S!==null)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function _(){this.constructor=w}N(w,S),w.prototype=S===null?Object.create(S):(_.prototype=S.prototype,new _)}})(),wn=function(){return(wn=Object.assign||function(N){for(var w,S=1,_=arguments.length;S<_;S++)for(var C in w=arguments[S])Object.prototype.hasOwnProperty.call(w,C)&&(N[C]=w[C]);return N}).apply(this,arguments)},jo=(function(N){function w(S,_){var C=N.call(this)||this;return C.TAG="TSDemuxer",C.first_parse_=!0,C.media_info_=new d.a,C.timescale_=90,C.duration_=0,C.current_pmt_pid_=-1,C.program_pmt_map_={},C.pes_slice_queues_={},C.section_slice_queues_={},C.video_metadata_={vps:void 0,sps:void 0,pps:void 0,av1c:void 0,details:void 0},C.audio_metadata_={codec:void 0,audio_object_type:void 0,sampling_freq_index:void 0,sampling_frequency:void 0,channel_config:void 0},C.last_pcr_base_=NaN,C.timestamp_offset_=0,C.audio_last_sample_pts_=void 0,C.aac_last_incomplete_data_=null,C.has_video_=!1,C.has_audio_=!1,C.video_init_segment_dispatched_=!1,C.audio_init_segment_dispatched_=!1,C.video_metadata_changed_=!1,C.audio_metadata_changed_=!1,C.loas_previous_frame=null,C.video_track_={type:"video",id:1,sequenceNumber:0,samples:[],length:0},C.audio_track_={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},C.ts_packet_size_=S.ts_packet_size,C.sync_offset_=S.sync_offset,C.config_=_,C}return Oa(w,N),w.prototype.destroy=function(){this.media_info_=null,this.pes_slice_queues_=null,this.section_slice_queues_=null,this.video_metadata_=null,this.audio_metadata_=null,this.aac_last_incomplete_data_=null,this.video_track_=null,this.audio_track_=null,N.prototype.destroy.call(this)},w.probe=function(S){var _=new Uint8Array(S),C=-1,F=188;if(_.byteLength<=3*F)return{needMoreData:!0};for(;C===-1;){for(var G=Math.min(1e3,_.byteLength-3*F),z=0;z<G;){if(_[z]===71&&_[z+F]===71&&_[z+2*F]===71){C=z;break}z++}if(C===-1)if(F===188)F=192;else{if(F!==192)break;F=204}}return C===-1?{match:!1}:(F===192&&C>=4?(u.a.v("TSDemuxer","ts_packet_size = 192, m2ts mode"),C-=4):F===204&&u.a.v("TSDemuxer","ts_packet_size = 204, RS encoded MPEG2-TS stream"),{match:!0,consumed:0,ts_packet_size:F,sync_offset:C})},w.prototype.bindDataSource=function(S){return S.onDataArrival=this.parseChunks.bind(this),this},w.prototype.resetMediaInfo=function(){this.media_info_=new d.a},w.prototype.parseChunks=function(S,_){if(!(this.onError&&this.onMediaInfo&&this.onTrackMetadata&&this.onDataAvailable))throw new x.a("onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var C=0;for(this.first_parse_&&(this.first_parse_=!1,C=this.sync_offset_);C+this.ts_packet_size_<=S.byteLength;){var F=_+C;this.ts_packet_size_===192&&(C+=4);var G=new Uint8Array(S,C,188),z=G[0];if(z!==71){u.a.e(this.TAG,"sync_byte = ".concat(z,", not 0x47"));break}var te=(64&G[1])>>>6,J=(G[1],(31&G[1])<<8|G[2]),ne=(48&G[3])>>>4,de=15&G[3],le=!(!this.pmt_||this.pmt_.pcr_pid!==J),he={},we=4;if(ne==2||ne==3){var ke=G[4];if(ke>0&&(le||ne==3)&&(he.discontinuity_indicator=(128&G[5])>>>7,he.random_access_indicator=(64&G[5])>>>6,he.elementary_stream_priority_indicator=(32&G[5])>>>5,(16&G[5])>>>4)){var De=300*this.getPcrBase(G)+((1&G[10])<<8|G[11]);this.last_pcr_=De}if(ne==2||5+ke===188){C+=188,this.ts_packet_size_===204&&(C+=16);continue}we=5+ke}if(ne==1||ne==3){if(J===0||J===this.current_pmt_pid_||this.pmt_!=null&&this.pmt_.pid_stream_type[J]===I.kSCTE35){var Ye=188-we;this.handleSectionSlice(S,C+we,Ye,{pid:J,file_position:F,payload_unit_start_indicator:te,continuity_conunter:de,random_access_indicator:he.random_access_indicator})}else if(this.pmt_!=null&&this.pmt_.pid_stream_type[J]!=null){Ye=188-we;var Ve=this.pmt_.pid_stream_type[J];J!==this.pmt_.common_pids.h264&&J!==this.pmt_.common_pids.h265&&J!==this.pmt_.common_pids.av1&&J!==this.pmt_.common_pids.adts_aac&&J!==this.pmt_.common_pids.loas_aac&&J!==this.pmt_.common_pids.ac3&&J!==this.pmt_.common_pids.eac3&&J!==this.pmt_.common_pids.opus&&J!==this.pmt_.common_pids.mp3&&this.pmt_.pes_private_data_pids[J]!==!0&&this.pmt_.timed_id3_pids[J]!==!0&&this.pmt_.synchronous_klv_pids[J]!==!0&&this.pmt_.asynchronous_klv_pids[J]!==!0||this.handlePESSlice(S,C+we,Ye,{pid:J,stream_type:Ve,file_position:F,payload_unit_start_indicator:te,continuity_conunter:de,random_access_indicator:he.random_access_indicator})}}C+=188,this.ts_packet_size_===204&&(C+=16)}return this.dispatchAudioVideoMediaSegment(),C},w.prototype.handleSectionSlice=function(S,_,C,F){var G=new Uint8Array(S,_,C),z=this.section_slice_queues_[F.pid];if(F.payload_unit_start_indicator){var te=G[0];if(z!=null&&z.total_length!==0){var J=new Uint8Array(S,_+1,Math.min(C,te));z.slices.push(J),z.total_length+=J.byteLength,z.total_length===z.expected_length?this.emitSectionSlices(z,F):this.clearSlices(z,F)}for(var ne=1+te;ne<G.byteLength&&G[ne+0]!==255;){var de=(15&G[ne+1])<<8|G[ne+2];this.section_slice_queues_[F.pid]=new oe,(z=this.section_slice_queues_[F.pid]).expected_length=de+3,z.file_position=F.file_position,z.random_access_indicator=F.random_access_indicator,J=new Uint8Array(S,_+ne,Math.min(C-ne,z.expected_length-z.total_length)),z.slices.push(J),z.total_length+=J.byteLength,z.total_length===z.expected_length?this.emitSectionSlices(z,F):z.total_length>=z.expected_length&&this.clearSlices(z,F),ne+=J.byteLength}}else z!=null&&z.total_length!==0&&(J=new Uint8Array(S,_,Math.min(C,z.expected_length-z.total_length)),z.slices.push(J),z.total_length+=J.byteLength,z.total_length===z.expected_length?this.emitSectionSlices(z,F):z.total_length>=z.expected_length&&this.clearSlices(z,F))},w.prototype.handlePESSlice=function(S,_,C,F){var G=new Uint8Array(S,_,C),z=G[0]<<16|G[1]<<8|G[2],te=(G[3],G[4]<<8|G[5]);if(F.payload_unit_start_indicator){if(z!==1)return void u.a.e(this.TAG,"handlePESSlice: packet_start_code_prefix should be 1 but with value ".concat(z));var J=this.pes_slice_queues_[F.pid];J&&(J.expected_length===0||J.expected_length===J.total_length?this.emitPESSlices(J,F):this.clearSlices(J,F)),this.pes_slice_queues_[F.pid]=new oe,this.pes_slice_queues_[F.pid].file_position=F.file_position,this.pes_slice_queues_[F.pid].random_access_indicator=F.random_access_indicator}if(this.pes_slice_queues_[F.pid]!=null){var ne=this.pes_slice_queues_[F.pid];ne.slices.push(G),F.payload_unit_start_indicator&&(ne.expected_length=te===0?0:te+6),ne.total_length+=G.byteLength,ne.expected_length>0&&ne.expected_length===ne.total_length?this.emitPESSlices(ne,F):ne.expected_length>0&&ne.expected_length<ne.total_length&&this.clearSlices(ne,F)}},w.prototype.emitSectionSlices=function(S,_){for(var C=new Uint8Array(S.total_length),F=0,G=0;F<S.slices.length;F++){var z=S.slices[F];C.set(z,G),G+=z.byteLength}S.slices=[],S.expected_length=-1,S.total_length=0;var te=new se;te.pid=_.pid,te.data=C,te.file_position=S.file_position,te.random_access_indicator=S.random_access_indicator,this.parseSection(te)},w.prototype.emitPESSlices=function(S,_){for(var C=new Uint8Array(S.total_length),F=0,G=0;F<S.slices.length;F++){var z=S.slices[F];C.set(z,G),G+=z.byteLength}S.slices=[],S.expected_length=-1,S.total_length=0;var te=new Q;te.pid=_.pid,te.data=C,te.stream_type=_.stream_type,te.file_position=S.file_position,te.random_access_indicator=S.random_access_indicator,this.parsePES(te)},w.prototype.clearSlices=function(S,_){S.slices=[],S.expected_length=-1,S.total_length=0},w.prototype.parseSection=function(S){var _=S.data,C=S.pid;C===0?this.parsePAT(_):C===this.current_pmt_pid_?this.parsePMT(_):this.pmt_!=null&&this.pmt_.scte_35_pids[C]&&this.parseSCTE35(_)},w.prototype.parsePES=function(S){var _=S.data,C=_[0]<<16|_[1]<<8|_[2],F=_[3],G=_[4]<<8|_[5];if(C===1)if(F!==188&&F!==190&&F!==191&&F!==240&&F!==241&&F!==255&&F!==242&&F!==248){_[6];var z=(192&_[7])>>>6,te=_[8],J=void 0,ne=void 0;z!==2&&z!==3||(J=this.getTimestamp(_,9),ne=z===3?this.getTimestamp(_,14):J);var de=9+te,le=void 0;if(G!==0){if(G<3+te)return void u.a.v(this.TAG,"Malformed PES: PES_packet_length < 3 + PES_header_data_length");le=G-3-te}else le=_.byteLength-de;var he=_.subarray(de,de+le);switch(S.stream_type){case I.kMPEG1Audio:case I.kMPEG2Audio:this.parseMP3Payload(he,J);break;case I.kPESPrivateData:this.pmt_.common_pids.av1===S.pid?this.parseAV1Payload(he,J,ne,S.file_position,S.random_access_indicator):this.pmt_.common_pids.opus===S.pid?this.parseOpusPayload(he,J):this.pmt_.common_pids.ac3===S.pid?this.parseAC3Payload(he,J):this.pmt_.common_pids.eac3===S.pid?this.parseEAC3Payload(he,J):this.pmt_.asynchronous_klv_pids[S.pid]?this.parseAsynchronousKLVMetadataPayload(he,S.pid,F):this.pmt_.smpte2038_pids[S.pid]?this.parseSMPTE2038MetadataPayload(he,J,ne,S.pid,F):this.parsePESPrivateDataPayload(he,J,ne,S.pid,F);break;case I.kADTSAAC:this.parseADTSAACPayload(he,J);break;case I.kLOASAAC:this.parseLOASAACPayload(he,J);break;case I.kAC3:this.parseAC3Payload(he,J);break;case I.kEAC3:this.parseEAC3Payload(he,J);break;case I.kMetadata:this.pmt_.timed_id3_pids[S.pid]?this.parseTimedID3MetadataPayload(he,J,ne,S.pid,F):this.pmt_.synchronous_klv_pids[S.pid]&&this.parseSynchronousKLVMetadataPayload(he,J,ne,S.pid,F);break;case I.kH264:this.parseH264Payload(he,J,ne,S.file_position,S.random_access_indicator);break;case I.kH265:this.parseH265Payload(he,J,ne,S.file_position,S.random_access_indicator)}}else(F===188||F===191||F===240||F===241||F===255||F===242||F===248)&&S.stream_type===I.kPESPrivateData&&(de=6,le=void 0,le=G!==0?G:_.byteLength-de,he=_.subarray(de,de+le),this.parsePESPrivateDataPayload(he,void 0,void 0,S.pid,F));else u.a.e(this.TAG,"parsePES: packet_start_code_prefix should be 1 but with value ".concat(C))},w.prototype.parsePAT=function(S){var _=S[0];if(_===0){var C=(15&S[1])<<8|S[2],F=(S[3],S[4],(62&S[5])>>>1),G=1&S[5],z=S[6],te=(S[7],null);if(G===1&&z===0)(te=new ae).version_number=F;else if((te=this.pat_)==null)return;for(var J=C-5-4,ne=-1,de=-1,le=8;le<8+J;le+=4){var he=S[le]<<8|S[le+1],we=(31&S[le+2])<<8|S[le+3];he===0?te.network_pid=we:(te.program_pmt_pid[he]=we,ne===-1&&(ne=he),de===-1&&(de=we))}G===1&&z===0&&(this.pat_==null&&u.a.v(this.TAG,"Parsed first PAT: ".concat(JSON.stringify(te))),this.pat_=te,this.current_program_=ne,this.current_pmt_pid_=de)}else u.a.e(this.TAG,"parsePAT: table_id ".concat(_," is not corresponded to PAT!"))},w.prototype.parsePMT=function(S){var _=S[0];if(_===2){var C=(15&S[1])<<8|S[2],F=S[3]<<8|S[4],G=(62&S[5])>>>1,z=1&S[5],te=S[6],J=(S[7],null);if(z===1&&te===0)(J=new re).program_number=F,J.version_number=G,this.program_pmt_map_[F]=J;else if((J=this.program_pmt_map_[F])==null)return;J.pcr_pid=(31&S[8])<<8|S[9];for(var ne=(15&S[10])<<8|S[11],de=12+ne,le=C-9-ne-4,he=de;he<de+le;){var we=S[he],ke=(31&S[he+1])<<8|S[he+2],De=(15&S[he+3])<<8|S[he+4];J.pid_stream_type[ke]=we;var Ye=J.common_pids.h264||J.common_pids.h265,Ve=J.common_pids.adts_aac||J.common_pids.loas_aac||J.common_pids.ac3||J.common_pids.eac3||J.common_pids.opus||J.common_pids.mp3;if(we!==I.kH264||Ye)if(we!==I.kH265||Ye)if(we!==I.kADTSAAC||Ve)if(we!==I.kLOASAAC||Ve)if(we!==I.kAC3||Ve)if(we!==I.kEAC3||Ve)if(we!==I.kMPEG1Audio&&we!==I.kMPEG2Audio||Ve)if(we===I.kPESPrivateData){if(J.pes_private_data_pids[ke]=!0,De>0){for(var Fe=he+5;Fe<he+5+De;){var at=S[Fe+0],gt=S[Fe+1];if(at===5){var Ke=String.fromCharCode.apply(String,Array.from(S.subarray(Fe+2,Fe+2+gt)));Ke==="VANC"?J.smpte2038_pids[ke]=!0:Ke==="AV01"?J.common_pids.av1=ke:Ke==="Opus"?J.common_pids.opus=ke:Ke==="KLVA"&&(J.asynchronous_klv_pids[ke]=!0)}else if(at===127){if(ke===J.common_pids.opus){var tt=null;if(S[Fe+2]===128&&(tt=S[Fe+3]),tt==null){u.a.e(this.TAG,"Not Supported Opus channel count.");continue}var ht={codec:"opus",channel_count:(15&tt)==0?2:15&tt,channel_config_code:tt,sample_rate:48e3},nt={codec:"opus",meta:ht};this.audio_init_segment_dispatched_==0?(this.audio_metadata_=ht,this.dispatchAudioInitSegment(nt)):this.detectAudioMetadataChange(nt)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(nt))}}else at===128&&ke===J.common_pids.av1&&(this.video_metadata_.av1c=S.subarray(Fe+2,Fe+2+gt));Fe+=2+gt}var st=S.subarray(he+5,he+5+De);this.dispatchPESPrivateDataDescriptor(ke,we,st)}}else if(we===I.kMetadata){if(De>0)for(Fe=he+5;Fe<he+5+De;){at=S[Fe+0];var ft=S[Fe+1];if(at===38){var Pt=S[Fe+2]<<8|S[Fe+3]<<0,ut=null;Pt===65535&&(ut=String.fromCharCode.apply(String,Array.from(S.subarray(Fe+4,Fe+4+4))));var _t=null;if(S[Fe+4+(Pt===65535?4:0)]===255){var Ft=4+(Pt===65535?4:0)+1;_t=String.fromCharCode.apply(String,Array.from(S.subarray(Fe+Ft,Fe+Ft+4)))}ut==="ID3 "&&_t==="ID3 "?J.timed_id3_pids[ke]=!0:_t==="KLVA"&&(J.synchronous_klv_pids[ke]=!0)}Fe+=2+ft}}else we===I.kSCTE35&&(J.scte_35_pids[ke]=!0);else J.common_pids.mp3=ke;else J.common_pids.eac3=ke;else J.common_pids.ac3=ke;else J.common_pids.loas_aac=ke;else J.common_pids.adts_aac=ke;else J.common_pids.h265=ke;else J.common_pids.h264=ke;he+=5+De}F===this.current_program_&&(this.pmt_==null&&u.a.v(this.TAG,"Parsed first PMT: ".concat(JSON.stringify(J))),this.pmt_=J,(J.common_pids.h264||J.common_pids.h265||J.common_pids.av1)&&(this.has_video_=!0),(J.common_pids.adts_aac||J.common_pids.loas_aac||J.common_pids.ac3||J.common_pids.opus||J.common_pids.mp3)&&(this.has_audio_=!0))}else u.a.e(this.TAG,"parsePMT: table_id ".concat(_," is not corresponded to PMT!"))},w.prototype.parseSCTE35=function(S){var _=Xi(S);if(_.pts!=null){var C=Math.floor(_.pts/this.timescale_);_.pts=C}else _.nearest_pts=this.getNearestTimestampMilliseconds();this.onSCTE35Metadata&&this.onSCTE35Metadata(_)},w.prototype.parseAV1Payload=function(S,_,C,F,G){for(var z=new Rr(S),te=null,J=[],ne=0,de=!1,le=null;(te=z.readNextOBUPayload())!=null;){if((le=M.parseOBUs(te,this.video_metadata_.details))&&le.keyframe===!0)if(this.video_init_segment_dispatched_){if(this.detectVideoMetadataChange(null,le)===!0){var he;this.video_metadata_changed_=!0,this.dispatchVideoMediaSegment(),(he=new Uint8Array(new ArrayBuffer(this.video_metadata_.av1c.byteLength+le.sequence_header_data.byteLength))).set(this.video_metadata_.av1c,0),he.set(le.sequence_header_data,this.video_metadata_.av1c.byteLength),le.av1c=he,this.dispatchVideoInitSegment()}}else(he=new Uint8Array(new ArrayBuffer(this.video_metadata_.av1c.byteLength+le.sequence_header_data.byteLength))).set(this.video_metadata_.av1c,0),he.set(le.sequence_header_data,this.video_metadata_.av1c.byteLength),le.av1c=he,this.video_metadata_.details=le,this.dispatchVideoInitSegment();this.video_metadata_.details=le,de||(de=le.keyframe),J.push({data:te}),ne+=te.byteLength}var we=Math.floor(_/this.timescale_),ke=Math.floor(C/this.timescale_);if(J.length){var De=this.video_track_,Ye={units:J,length:ne,isKeyframe:de,dts:ke,pts:we,cts:we-ke,file_position:F};De.samples.push(Ye),De.length+=ne}},w.prototype.parseH264Payload=function(S,_,C,F,G){for(var z=new me(S),te=null,J=[],ne=0,de=!1;(te=z.readNextNaluPayload())!=null;){var le=new X(te);if(le.type===ie.kSliceSPS){var he=R.parseSPS(te.data);this.video_init_segment_dispatched_?this.detectVideoMetadataChange(le,he)===!0&&(u.a.v(this.TAG,"H264: Critical h264 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:le,pps:void 0,av1c:void 0,details:he}):(this.video_metadata_.sps=le,this.video_metadata_.details=he)}else le.type===ie.kSlicePPS?this.video_init_segment_dispatched_&&!this.video_metadata_changed_||(this.video_metadata_.pps=le,this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):(le.type===ie.kSliceIDR||le.type===ie.kSliceNonIDR&&G===1)&&(de=!0);this.video_init_segment_dispatched_&&(J.push(le),ne+=le.data.byteLength)}var we=Math.floor(_/this.timescale_),ke=Math.floor(C/this.timescale_);if(J.length){var De=this.video_track_,Ye={units:J,length:ne,isKeyframe:de,dts:ke,pts:we,cts:we-ke,file_position:F};De.samples.push(Ye),De.length+=ne}},w.prototype.parseH265Payload=function(S,_,C,F,G){for(var z=new Tr(S),te=null,J=[],ne=0,de=!1;(te=z.readNextNaluPayload())!=null;){var le=new Js(te);if(le.type===He.kSliceVPS){if(!this.video_init_segment_dispatched_){var he=L.parseVPS(te.data);this.video_metadata_.vps=le,this.video_metadata_.details=wn(wn({},this.video_metadata_.details),he)}}else le.type===He.kSliceSPS?(he=L.parseSPS(te.data),this.video_init_segment_dispatched_?this.detectVideoMetadataChange(le,he)===!0&&(u.a.v(this.TAG,"H265: Critical h265 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:le,pps:void 0,av1c:void 0,details:he}):(this.video_metadata_.sps=le,this.video_metadata_.details=wn(wn({},this.video_metadata_.details),he))):le.type===He.kSlicePPS?(!this.video_init_segment_dispatched_||this.video_metadata_changed_)&&(he=L.parsePPS(te.data),this.video_metadata_.pps=le,this.video_metadata_.details=wn(wn({},this.video_metadata_.details),he),this.video_metadata_.vps&&this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):le.type!==He.kSliceIDR_W_RADL&&le.type!==He.kSliceIDR_N_LP&&le.type!==He.kSliceCRA_NUT||(de=!0);this.video_init_segment_dispatched_&&(J.push(le),ne+=le.data.byteLength)}var we=Math.floor(_/this.timescale_),ke=Math.floor(C/this.timescale_);if(J.length){var De=this.video_track_,Ye={units:J,length:ne,isKeyframe:de,dts:ke,pts:we,cts:we-ke,file_position:F};De.samples.push(Ye),De.length+=ne}},w.prototype.detectVideoMetadataChange=function(S,_){if(_.codec_mimetype!==this.video_metadata_.details.codec_mimetype)return u.a.v(this.TAG,"Video: Codec mimeType changed from "+"".concat(this.video_metadata_.details.codec_mimetype," to ").concat(_.codec_mimetype)),!0;if(_.codec_size.width!==this.video_metadata_.details.codec_size.width||_.codec_size.height!==this.video_metadata_.details.codec_size.height){var C=this.video_metadata_.details.codec_size,F=_.codec_size;return u.a.v(this.TAG,"Video: Coded Resolution changed from "+"".concat(C.width,"x").concat(C.height," to ").concat(F.width,"x").concat(F.height)),!0}return _.present_size.width!==this.video_metadata_.details.present_size.width&&(u.a.v(this.TAG,"Video: Present resolution width changed from "+"".concat(this.video_metadata_.details.present_size.width," to ").concat(_.present_size.width)),!0)},w.prototype.isInitSegmentDispatched=function(){return this.has_video_&&this.has_audio_?this.video_init_segment_dispatched_&&this.audio_init_segment_dispatched_:this.has_video_&&!this.has_audio_?this.video_init_segment_dispatched_:!(this.has_video_||!this.has_audio_)&&this.audio_init_segment_dispatched_},w.prototype.dispatchVideoInitSegment=function(){var S=this.video_metadata_.details,_={type:"video"};_.id=this.video_track_.id,_.timescale=1e3,_.duration=this.duration_,_.codecWidth=S.codec_size.width,_.codecHeight=S.codec_size.height,_.presentWidth=S.present_size.width,_.presentHeight=S.present_size.height,_.profile=S.profile_string,_.level=S.level_string,_.bitDepth=S.bit_depth,_.chromaFormat=S.chroma_format,_.sarRatio=S.sar_ratio,_.frameRate=S.frame_rate;var C=_.frameRate.fps_den,F=_.frameRate.fps_num;if(_.refSampleDuration=C/F*1e3,_.codec=S.codec_mimetype,this.video_metadata_.av1c)_.av1c=this.video_metadata_.av1c,this.video_init_segment_dispatched_==0&&u.a.v(this.TAG,"Generated first AV1 for mimeType: ".concat(_.codec));else if(this.video_metadata_.vps){var G=this.video_metadata_.vps.data.subarray(4),z=this.video_metadata_.sps.data.subarray(4),te=this.video_metadata_.pps.data.subarray(4),J=new Ae(G,z,te,S);_.hvcc=J.getData(),this.video_init_segment_dispatched_==0&&u.a.v(this.TAG,"Generated first HEVCDecoderConfigurationRecord for mimeType: ".concat(_.codec))}else{z=this.video_metadata_.sps.data.subarray(4),te=this.video_metadata_.pps.data.subarray(4);var ne=new ve(z,te,S);_.avcc=ne.getData(),this.video_init_segment_dispatched_==0&&u.a.v(this.TAG,"Generated first AVCDecoderConfigurationRecord for mimeType: ".concat(_.codec))}this.onTrackMetadata("video",_),this.video_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var de=this.media_info_;de.hasVideo=!0,de.width=_.codecWidth,de.height=_.codecHeight,de.fps=_.frameRate.fps,de.profile=_.profile,de.level=_.level,de.refFrames=S.ref_frames,de.chromaFormat=S.chroma_format_string,de.sarNum=_.sarRatio.width,de.sarDen=_.sarRatio.height,de.videoCodec=_.codec,de.hasAudio&&de.audioCodec?de.mimeType='video/mp2t; codecs="'.concat(de.videoCodec,",").concat(de.audioCodec,'"'):de.mimeType='video/mp2t; codecs="'.concat(de.videoCodec,'"'),de.isComplete()&&this.onMediaInfo(de)},w.prototype.dispatchVideoMediaSegment=function(){this.isInitSegmentDispatched()&&this.video_track_.length&&this.onDataAvailable(null,this.video_track_)},w.prototype.dispatchAudioMediaSegment=function(){this.isInitSegmentDispatched()&&this.audio_track_.length&&this.onDataAvailable(this.audio_track_,null)},w.prototype.dispatchAudioVideoMediaSegment=function(){this.isInitSegmentDispatched()&&(this.audio_track_.length||this.video_track_.length)&&this.onDataAvailable(this.audio_track_,this.video_track_)},w.prototype.parseADTSAACPayload=function(S,_){if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var C=new Uint8Array(S.byteLength+this.aac_last_incomplete_data_.byteLength);C.set(this.aac_last_incomplete_data_,0),C.set(S,this.aac_last_incomplete_data_.byteLength),S=C}var F,G;if(_!=null&&(G=_/this.timescale_),this.audio_metadata_.codec==="aac"){if(_==null&&this.audio_last_sample_pts_!=null)F=1024/this.audio_metadata_.sampling_frequency*1e3,G=this.audio_last_sample_pts_+F;else if(_==null)return void u.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.audio_last_sample_pts_){F=1024/this.audio_metadata_.sampling_frequency*1e3;var z=this.audio_last_sample_pts_+F;Math.abs(z-G)>1&&(u.a.w(this.TAG,"AAC: Detected pts overlapped, "+"expected: ".concat(z,"ms, PES pts: ").concat(G,"ms")),G=z)}}for(var te,J=new qe(S),ne=null,de=G;(ne=J.readNextAACFrame())!=null;){F=1024/ne.sampling_frequency*1e3;var le={codec:"aac",data:ne};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"aac",audio_object_type:ne.audio_object_type,sampling_freq_index:ne.sampling_freq_index,sampling_frequency:ne.sampling_frequency,channel_config:ne.channel_config},this.dispatchAudioInitSegment(le)):this.detectAudioMetadataChange(le)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(le)),te=de;var he=Math.floor(de),we={unit:ne.data,length:ne.data.byteLength,pts:he,dts:he};this.audio_track_.samples.push(we),this.audio_track_.length+=ne.data.byteLength,de+=F}J.hasIncompleteData()&&(this.aac_last_incomplete_data_=J.getIncompleteData()),te&&(this.audio_last_sample_pts_=te)}},w.prototype.parseLOASAACPayload=function(S,_){var C;if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var F=new Uint8Array(S.byteLength+this.aac_last_incomplete_data_.byteLength);F.set(this.aac_last_incomplete_data_,0),F.set(S,this.aac_last_incomplete_data_.byteLength),S=F}var G,z;if(_!=null&&(z=_/this.timescale_),this.audio_metadata_.codec==="aac"){if(_==null&&this.audio_last_sample_pts_!=null)G=1024/this.audio_metadata_.sampling_frequency*1e3,z=this.audio_last_sample_pts_+G;else if(_==null)return void u.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.audio_last_sample_pts_){G=1024/this.audio_metadata_.sampling_frequency*1e3;var te=this.audio_last_sample_pts_+G;Math.abs(te-z)>1&&(u.a.w(this.TAG,"AAC: Detected pts overlapped, "+"expected: ".concat(te,"ms, PES pts: ").concat(z,"ms")),z=te)}}for(var J,ne=new ue(S),de=null,le=z;(de=ne.readNextAACFrame((C=this.loas_previous_frame)!==null&&C!==void 0?C:void 0))!=null;){this.loas_previous_frame=de,G=1024/de.sampling_frequency*1e3;var he={codec:"aac",data:de};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"aac",audio_object_type:de.audio_object_type,sampling_freq_index:de.sampling_freq_index,sampling_frequency:de.sampling_frequency,channel_config:de.channel_config},this.dispatchAudioInitSegment(he)):this.detectAudioMetadataChange(he)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(he)),J=le;var we=Math.floor(le),ke={unit:de.data,length:de.data.byteLength,pts:we,dts:we};this.audio_track_.samples.push(ke),this.audio_track_.length+=de.data.byteLength,le+=G}ne.hasIncompleteData()&&(this.aac_last_incomplete_data_=ne.getIncompleteData()),J&&(this.audio_last_sample_pts_=J)}},w.prototype.parseAC3Payload=function(S,_){if(!this.has_video_||this.video_init_segment_dispatched_){var C,F;if(_!=null&&(F=_/this.timescale_),this.audio_metadata_.codec==="ac-3"){if(_==null&&this.audio_last_sample_pts_!=null)C=1536/this.audio_metadata_.sampling_frequency*1e3,F=this.audio_last_sample_pts_+C;else if(_==null)return void u.a.w(this.TAG,"AC3: Unknown pts")}for(var G,z=new Td(S),te=null,J=F;(te=z.readNextAC3Frame())!=null;){C=1536/te.sampling_frequency*1e3;var ne={codec:"ac-3",data:te};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"ac-3",sampling_frequency:te.sampling_frequency,bit_stream_identification:te.bit_stream_identification,bit_stream_mode:te.bit_stream_mode,low_frequency_effects_channel_on:te.low_frequency_effects_channel_on,channel_mode:te.channel_mode},this.dispatchAudioInitSegment(ne)):this.detectAudioMetadataChange(ne)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(ne)),G=J;var de=Math.floor(J),le={unit:te.data,length:te.data.byteLength,pts:de,dts:de};this.audio_track_.samples.push(le),this.audio_track_.length+=te.data.byteLength,J+=C}G&&(this.audio_last_sample_pts_=G)}},w.prototype.parseEAC3Payload=function(S,_){if(!this.has_video_||this.video_init_segment_dispatched_){var C,F;if(_!=null&&(F=_/this.timescale_),this.audio_metadata_.codec==="ec-3"){if(_==null&&this.audio_last_sample_pts_!=null)C=256*this.audio_metadata_.num_blks/this.audio_metadata_.sampling_frequency*1e3,F=this.audio_last_sample_pts_+C;else if(_==null)return void u.a.w(this.TAG,"EAC3: Unknown pts")}for(var G,z=new wr(S),te=null,J=F;(te=z.readNextEAC3Frame())!=null;){C=1536/te.sampling_frequency*1e3;var ne={codec:"ec-3",data:te};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"ec-3",sampling_frequency:te.sampling_frequency,bit_stream_identification:te.bit_stream_identification,low_frequency_effects_channel_on:te.low_frequency_effects_channel_on,num_blks:te.num_blks,channel_mode:te.channel_mode},this.dispatchAudioInitSegment(ne)):this.detectAudioMetadataChange(ne)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(ne)),G=J;var de=Math.floor(J),le={unit:te.data,length:te.data.byteLength,pts:de,dts:de};this.audio_track_.samples.push(le),this.audio_track_.length+=te.data.byteLength,J+=C}G&&(this.audio_last_sample_pts_=G)}},w.prototype.parseOpusPayload=function(S,_){if(!this.has_video_||this.video_init_segment_dispatched_){var C,F;if(_!=null&&(F=_/this.timescale_),this.audio_metadata_.codec==="opus"){if(_==null&&this.audio_last_sample_pts_!=null)C=20,F=this.audio_last_sample_pts_+C;else if(_==null)return void u.a.w(this.TAG,"Opus: Unknown pts")}for(var G,z=F,te=0;te<S.length;){C=20;for(var J=(16&S[te+1])!=0,ne=(8&S[te+1])!=0,de=te+2,le=0;S[de]===255;)le+=255,de+=1;le+=S[de],de+=1,de+=J?2:0,de+=ne?2:0,G=z;var he=Math.floor(z),we=S.slice(de,de+le),ke={unit:we,length:we.byteLength,pts:he,dts:he};this.audio_track_.samples.push(ke),this.audio_track_.length+=we.byteLength,z+=C,te=de+le}G&&(this.audio_last_sample_pts_=G)}},w.prototype.parseMP3Payload=function(S,_){if(!this.has_video_||this.video_init_segment_dispatched_){var C=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],F=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],G=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],z=S[1]>>>3&3,te=(6&S[1])>>1,J=(240&S[2])>>>4,ne=(12&S[2])>>>2,de=(S[3]>>>6&3)!==3?2:1,le=0,he=34;switch(z){case 0:le=[11025,12e3,8e3,0][ne];break;case 2:le=[22050,24e3,16e3,0][ne];break;case 3:le=[44100,48e3,32e3,0][ne]}switch(te){case 1:he=34,J<G.length&&G[J];break;case 2:he=33,J<F.length&&F[J];break;case 3:he=32,J<C.length&&C[J]}var we=new Lt;we.object_type=he,we.sample_rate=le,we.channel_count=de,we.data=S;var ke={codec:"mp3",data:we};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"mp3",object_type:he,sample_rate:le,channel_count:de},this.dispatchAudioInitSegment(ke)):this.detectAudioMetadataChange(ke)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(ke));var De={unit:S,length:S.byteLength,pts:_/this.timescale_,dts:_/this.timescale_};this.audio_track_.samples.push(De),this.audio_track_.length+=S.byteLength}},w.prototype.detectAudioMetadataChange=function(S){if(S.codec!==this.audio_metadata_.codec)return u.a.v(this.TAG,"Audio: Audio Codecs changed from "+"".concat(this.audio_metadata_.codec," to ").concat(S.codec)),!0;if(S.codec==="aac"&&this.audio_metadata_.codec==="aac"){if((_=S.data).audio_object_type!==this.audio_metadata_.audio_object_type)return u.a.v(this.TAG,"AAC: AudioObjectType changed from "+"".concat(this.audio_metadata_.audio_object_type," to ").concat(_.audio_object_type)),!0;if(_.sampling_freq_index!==this.audio_metadata_.sampling_freq_index)return u.a.v(this.TAG,"AAC: SamplingFrequencyIndex changed from "+"".concat(this.audio_metadata_.sampling_freq_index," to ").concat(_.sampling_freq_index)),!0;if(_.channel_config!==this.audio_metadata_.channel_config)return u.a.v(this.TAG,"AAC: Channel configuration changed from "+"".concat(this.audio_metadata_.channel_config," to ").concat(_.channel_config)),!0}else if(S.codec==="ac-3"&&this.audio_metadata_.codec==="ac-3"){var _;if((_=S.data).sampling_frequency!==this.audio_metadata_.sampling_frequency)return u.a.v(this.TAG,"AC3: Sampling Frequency changed from "+"".concat(this.audio_metadata_.sampling_frequency," to ").concat(_.sampling_frequency)),!0;if(_.bit_stream_identification!==this.audio_metadata_.bit_stream_identification)return u.a.v(this.TAG,"AC3: Bit Stream Identification changed from "+"".concat(this.audio_metadata_.bit_stream_identification," to ").concat(_.bit_stream_identification)),!0;if(_.bit_stream_mode!==this.audio_metadata_.bit_stream_mode)return u.a.v(this.TAG,"AC3: BitStream Mode changed from "+"".concat(this.audio_metadata_.bit_stream_mode," to ").concat(_.bit_stream_mode)),!0;if(_.channel_mode!==this.audio_metadata_.channel_mode)return u.a.v(this.TAG,"AC3: Channel Mode changed from "+"".concat(this.audio_metadata_.channel_mode," to ").concat(_.channel_mode)),!0;if(_.low_frequency_effects_channel_on!==this.audio_metadata_.low_frequency_effects_channel_on)return u.a.v(this.TAG,"AC3: Low Frequency Effects Channel On changed from "+"".concat(this.audio_metadata_.low_frequency_effects_channel_on," to ").concat(_.low_frequency_effects_channel_on)),!0}else if(S.codec==="opus"&&this.audio_metadata_.codec==="opus"){if((C=S.meta).sample_rate!==this.audio_metadata_.sample_rate)return u.a.v(this.TAG,"Opus: SamplingFrequencyIndex changed from "+"".concat(this.audio_metadata_.sample_rate," to ").concat(C.sample_rate)),!0;if(C.channel_count!==this.audio_metadata_.channel_count)return u.a.v(this.TAG,"Opus: Channel count changed from "+"".concat(this.audio_metadata_.channel_count," to ").concat(C.channel_count)),!0}else if(S.codec==="mp3"&&this.audio_metadata_.codec==="mp3"){var C;if((C=S.data).object_type!==this.audio_metadata_.object_type)return u.a.v(this.TAG,"MP3: AudioObjectType changed from "+"".concat(this.audio_metadata_.object_type," to ").concat(C.object_type)),!0;if(C.sample_rate!==this.audio_metadata_.sample_rate)return u.a.v(this.TAG,"MP3: SamplingFrequencyIndex changed from "+"".concat(this.audio_metadata_.sample_rate," to ").concat(C.sample_rate)),!0;if(C.channel_count!==this.audio_metadata_.channel_count)return u.a.v(this.TAG,"MP3: Channel count changed from "+"".concat(this.audio_metadata_.channel_count," to ").concat(C.channel_count)),!0}return!1},w.prototype.dispatchAudioInitSegment=function(S){var _={type:"audio"};if(_.id=this.audio_track_.id,_.timescale=1e3,_.duration=this.duration_,this.audio_metadata_.codec==="aac"){var C=S.codec==="aac"?S.data:null,F=new Be(C);_.audioSampleRate=F.sampling_rate,_.channelCount=F.channel_count,_.codec=F.codec_mimetype,_.originalCodec=F.original_codec_mimetype,_.config=F.config,_.refSampleDuration=1024/_.audioSampleRate*_.timescale}else if(this.audio_metadata_.codec==="ac-3"){var G=S.codec==="ac-3"?S.data:null,z=new Ad(G);_.audioSampleRate=z.sampling_rate,_.channelCount=z.channel_count,_.codec=z.codec_mimetype,_.originalCodec=z.original_codec_mimetype,_.config=z.config,_.refSampleDuration=1536/_.audioSampleRate*_.timescale}else if(this.audio_metadata_.codec==="ec-3"){var te=S.codec==="ec-3"?S.data:null,J=new Nr(te);_.audioSampleRate=J.sampling_rate,_.channelCount=J.channel_count,_.codec=J.codec_mimetype,_.originalCodec=J.original_codec_mimetype,_.config=J.config,_.refSampleDuration=256*J.num_blks/_.audioSampleRate*_.timescale}else this.audio_metadata_.codec==="opus"?(_.audioSampleRate=this.audio_metadata_.sample_rate,_.channelCount=this.audio_metadata_.channel_count,_.channelConfigCode=this.audio_metadata_.channel_config_code,_.codec="opus",_.originalCodec="opus",_.config=void 0,_.refSampleDuration=20):this.audio_metadata_.codec==="mp3"&&(_.audioSampleRate=this.audio_metadata_.sample_rate,_.channelCount=this.audio_metadata_.channel_count,_.codec="mp3",_.originalCodec="mp3",_.config=void 0);this.audio_init_segment_dispatched_==0&&u.a.v(this.TAG,"Generated first AudioSpecificConfig for mimeType: ".concat(_.codec)),this.onTrackMetadata("audio",_),this.audio_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var ne=this.media_info_;ne.hasAudio=!0,ne.audioCodec=_.originalCodec,ne.audioSampleRate=_.audioSampleRate,ne.audioChannelCount=_.channelCount,ne.hasVideo&&ne.videoCodec?ne.mimeType='video/mp2t; codecs="'.concat(ne.videoCodec,",").concat(ne.audioCodec,'"'):ne.mimeType='video/mp2t; codecs="'.concat(ne.audioCodec,'"'),ne.isComplete()&&this.onMediaInfo(ne)},w.prototype.dispatchPESPrivateDataDescriptor=function(S,_,C){var F=new yt;F.pid=S,F.stream_type=_,F.descriptor=C,this.onPESPrivateDataDescriptor&&this.onPESPrivateDataDescriptor(F)},w.prototype.parsePESPrivateDataPayload=function(S,_,C,F,G){var z=new Ge;if(z.pid=F,z.stream_id=G,z.len=S.byteLength,z.data=S,_!=null){var te=Math.floor(_/this.timescale_);z.pts=te}else z.nearest_pts=this.getNearestTimestampMilliseconds();if(C!=null){var J=Math.floor(C/this.timescale_);z.dts=J}this.onPESPrivateData&&this.onPESPrivateData(z)},w.prototype.parseTimedID3MetadataPayload=function(S,_,C,F,G){var z=new Ge;if(z.pid=F,z.stream_id=G,z.len=S.byteLength,z.data=S,_!=null){var te=Math.floor(_/this.timescale_);z.pts=te}if(C!=null){var J=Math.floor(C/this.timescale_);z.dts=J}this.onTimedID3Metadata&&this.onTimedID3Metadata(z)},w.prototype.parseSynchronousKLVMetadataPayload=function(S,_,C,F,G){var z=new An;if(z.pid=F,z.stream_id=G,z.len=S.byteLength,z.data=S,_!=null){var te=Math.floor(_/this.timescale_);z.pts=te}if(C!=null){var J=Math.floor(C/this.timescale_);z.dts=J}z.access_units=(function(ne){for(var de=[],le=0;le+5<ne.byteLength;){var he=ne[le+0],we=ne[le+1],ke=ne[le+2],De=ne[le+3]<<8|ne[le+4]<<0,Ye=ne.slice(le+5,le+5+De);de.push({service_id:he,sequence_number:we,flags:ke,data:Ye}),le+=5+De}return de})(S),this.onSynchronousKLVMetadata&&this.onSynchronousKLVMetadata(z)},w.prototype.parseAsynchronousKLVMetadataPayload=function(S,_,C){var F=new Ge;F.pid=_,F.stream_id=C,F.len=S.byteLength,F.data=S,this.onAsynchronousKLVMetadata&&this.onAsynchronousKLVMetadata(F)},w.prototype.parseSMPTE2038MetadataPayload=function(S,_,C,F,G){var z=new ct;if(z.pid=F,z.stream_id=G,z.len=S.byteLength,z.data=S,_!=null){var te=Math.floor(_/this.timescale_);z.pts=te}if(z.nearest_pts=this.getNearestTimestampMilliseconds(),C!=null){var J=Math.floor(C/this.timescale_);z.dts=J}z.ancillaries=(function(ne){for(var de=new A(ne),le=0,he=[];le+=6,de.readBits(6)===0;){var we=de.readBool();le+=1;var ke=de.readBits(11);le+=11;var De=de.readBits(12);le+=12;var Ye=255&de.readBits(10);le+=10;var Ve=255&de.readBits(10);le+=10;var Fe=255&de.readBits(10);le+=10;for(var at=new Uint8Array(Fe),gt=0;gt<Fe;gt++){var Ke=255&de.readBits(10);le+=10,at[gt]=Ke}de.readBits(10),le+=10;var tt="User Defined";Ye===65?Ve===7&&(tt="SCTE-104"):Ye===95?Ve===220?tt="ARIB STD-B37 (1SEG)":Ve===221?tt="ARIB STD-B37 (ANALOG)":Ve===222?tt="ARIB STD-B37 (SD)":Ve===223&&(tt="ARIB STD-B37 (HD)"):Ye===97&&(Ve===1?tt="EIA-708":Ve===2&&(tt="EIA-608")),he.push({yc_indicator:we,line_number:ke,horizontal_offset:De,did:Ye,sdid:Ve,user_data:at,description:tt,information:{}}),de.readBits(8-(le-Math.floor(le/8))%8),le+=(8-(le-Math.floor(le/8)))%8}return de.destroy(),de=null,he})(S),this.onSMPTE2038Metadata&&this.onSMPTE2038Metadata(z)},w.prototype.getNearestTimestampMilliseconds=function(){return this.audio_last_sample_pts_!=null?Math.floor(this.audio_last_sample_pts_):this.last_pcr_!=null?Math.floor(this.last_pcr_/300/this.timescale_):void 0},w.prototype.getPcrBase=function(S){var _=33554432*S[6]+131072*S[7]+512*S[8]+2*S[9]+(128&S[10])/128+this.timestamp_offset_;return _+4294967296<this.last_pcr_base_&&(_+=8589934592,this.timestamp_offset_+=8589934592),this.last_pcr_base_=_,_},w.prototype.getTimestamp=function(S,_){var C=536870912*(14&S[_])+4194304*(255&S[_+1])+16384*(254&S[_+2])+128*(255&S[_+3])+(254&S[_+4])/2+this.timestamp_offset_;return C+4294967296<this.last_pcr_base_&&(C+=8589934592),C},w})(Z),Cr=function(N,w,S){for(var _,C=0,F=w.length;C<F;C++)!_&&C in w||(_||(_=Array.prototype.slice.call(w,0,C)),_[C]=w[C]);return N.concat(_||Array.prototype.slice.call(w))},ea=(function(){function N(){}return N.init=function(){for(var w in N.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],hvc1:[],hvcC:[],av01:[],av1C:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[],Opus:[],dOps:[],"ac-3":[],dac3:[],"ec-3":[],dec3:[],fLaC:[],dfLa:[]},N.types)N.types.hasOwnProperty(w)&&(N.types[w]=[w.charCodeAt(0),w.charCodeAt(1),w.charCodeAt(2),w.charCodeAt(3)]);var S=N.constants={};S.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),S.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),S.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),S.STSC=S.STCO=S.STTS,S.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),S.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),S.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),S.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),S.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),S.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},N.box=function(w){for(var S=8,_=null,C=Array.prototype.slice.call(arguments,1),F=C.length,G=0;G<F;G++)S+=C[G].byteLength;(_=new Uint8Array(S))[0]=S>>>24&255,_[1]=S>>>16&255,_[2]=S>>>8&255,_[3]=255&S,_.set(w,4);var z=8;for(G=0;G<F;G++)_.set(C[G],z),z+=C[G].byteLength;return _},N.generateInitSegment=function(w){var S=N.box(N.types.ftyp,N.constants.FTYP),_=N.moov(w),C=new Uint8Array(S.byteLength+_.byteLength);return C.set(S,0),C.set(_,S.byteLength),C},N.moov=function(w){var S=N.mvhd(w.timescale,w.duration),_=N.trak(w),C=N.mvex(w);return N.box(N.types.moov,S,_,C)},N.mvhd=function(w,S){return N.box(N.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,w>>>24&255,w>>>16&255,w>>>8&255,255&w,S>>>24&255,S>>>16&255,S>>>8&255,255&S,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},N.trak=function(w){return N.box(N.types.trak,N.tkhd(w),N.mdia(w))},N.tkhd=function(w){var S=w.id,_=w.duration,C=w.presentWidth,F=w.presentHeight;return N.box(N.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,S>>>24&255,S>>>16&255,S>>>8&255,255&S,0,0,0,0,_>>>24&255,_>>>16&255,_>>>8&255,255&_,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,C>>>8&255,255&C,0,0,F>>>8&255,255&F,0,0]))},N.mdia=function(w){return N.box(N.types.mdia,N.mdhd(w),N.hdlr(w),N.minf(w))},N.mdhd=function(w){var S=w.timescale,_=w.duration;return N.box(N.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,S>>>24&255,S>>>16&255,S>>>8&255,255&S,_>>>24&255,_>>>16&255,_>>>8&255,255&_,85,196,0,0]))},N.hdlr=function(w){var S=null;return S=w.type==="audio"?N.constants.HDLR_AUDIO:N.constants.HDLR_VIDEO,N.box(N.types.hdlr,S)},N.minf=function(w){var S=null;return S=w.type==="audio"?N.box(N.types.smhd,N.constants.SMHD):N.box(N.types.vmhd,N.constants.VMHD),N.box(N.types.minf,S,N.dinf(),N.stbl(w))},N.dinf=function(){return N.box(N.types.dinf,N.box(N.types.dref,N.constants.DREF))},N.stbl=function(w){return N.box(N.types.stbl,N.stsd(w),N.box(N.types.stts,N.constants.STTS),N.box(N.types.stsc,N.constants.STSC),N.box(N.types.stsz,N.constants.STSZ),N.box(N.types.stco,N.constants.STCO))},N.stsd=function(w){return w.type==="audio"?w.codec==="mp3"?N.box(N.types.stsd,N.constants.STSD_PREFIX,N.mp3(w)):w.codec==="ac-3"?N.box(N.types.stsd,N.constants.STSD_PREFIX,N.ac3(w)):w.codec==="ec-3"?N.box(N.types.stsd,N.constants.STSD_PREFIX,N.ec3(w)):w.codec==="opus"?N.box(N.types.stsd,N.constants.STSD_PREFIX,N.Opus(w)):w.codec=="flac"?N.box(N.types.stsd,N.constants.STSD_PREFIX,N.fLaC(w)):N.box(N.types.stsd,N.constants.STSD_PREFIX,N.mp4a(w)):w.type==="video"&&w.codec.startsWith("hvc1")?N.box(N.types.stsd,N.constants.STSD_PREFIX,N.hvc1(w)):w.type==="video"&&w.codec.startsWith("av01")?N.box(N.types.stsd,N.constants.STSD_PREFIX,N.av01(w)):N.box(N.types.stsd,N.constants.STSD_PREFIX,N.avc1(w))},N.mp3=function(w){var S=w.channelCount,_=w.audioSampleRate,C=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,S,0,16,0,0,0,0,_>>>8&255,255&_,0,0]);return N.box(N.types[".mp3"],C)},N.mp4a=function(w){var S=w.channelCount,_=w.audioSampleRate,C=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,S,0,16,0,0,0,0,_>>>8&255,255&_,0,0]);return N.box(N.types.mp4a,C,N.esds(w))},N.ac3=function(w){var S=w.channelCount,_=w.audioSampleRate,C=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,S,0,16,0,0,0,0,_>>>8&255,255&_,0,0]);return N.box(N.types["ac-3"],C,N.box(N.types.dac3,new Uint8Array(w.config)))},N.ec3=function(w){var S=w.channelCount,_=w.audioSampleRate,C=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,S,0,16,0,0,0,0,_>>>8&255,255&_,0,0]);return N.box(N.types["ec-3"],C,N.box(N.types.dec3,new Uint8Array(w.config)))},N.esds=function(w){var S=w.config||[],_=S.length,C=new Uint8Array([0,0,0,0,3,23+_,0,1,0,4,15+_,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([_]).concat(S).concat([6,1,2]));return N.box(N.types.esds,C)},N.Opus=function(w){var S=w.channelCount,_=w.audioSampleRate,C=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,S,0,16,0,0,0,0,_>>>8&255,255&_,0,0]);return N.box(N.types.Opus,C,N.dOps(w))},N.dOps=function(w){var S=w.channelCount,_=w.channelConfigCode,C=w.audioSampleRate;if(w.config)return N.box(N.types.dOps,w.config);var F=[];switch(_){case 1:case 2:F=[0];break;case 0:F=[255,1,1,0,1];break;case 128:F=[255,2,0,0,1];break;case 3:F=[1,2,1,0,2,1];break;case 4:F=[1,2,2,0,1,2,3];break;case 5:F=[1,3,2,0,4,1,2,3];break;case 6:F=[1,4,2,0,4,1,2,3,5];break;case 7:F=[1,4,2,0,4,1,2,3,5,6];break;case 8:F=[1,5,3,0,6,1,2,3,4,5,7];break;case 130:F=[1,1,2,0,1];break;case 131:F=[1,1,3,0,1,2];break;case 132:F=[1,1,4,0,1,2,3];break;case 133:F=[1,1,5,0,1,2,3,4];break;case 134:F=[1,1,6,0,1,2,3,4,5];break;case 135:F=[1,1,7,0,1,2,3,4,5,6];break;case 136:F=[1,1,8,0,1,2,3,4,5,6,7]}var G=new Uint8Array(Cr([0,S,0,0,C>>>24&255,C>>>17&255,C>>>8&255,C>>>0&255,0,0],F));return N.box(N.types.dOps,G)},N.fLaC=function(w){var S=w.channelCount,_=Math.min(w.audioSampleRate,65535),C=w.sampleSize,F=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,S,0,C,0,0,0,0,_>>>8&255,255&_,0,0]);return N.box(N.types.fLaC,F,N.dfLa(w))},N.dfLa=function(w){var S=new Uint8Array(Cr([0,0,0,0],w.config));return N.box(N.types.dfLa,S)},N.avc1=function(w){var S=w.avcc,_=w.codecWidth,C=w.codecHeight,F=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,_>>>8&255,255&_,C>>>8&255,255&C,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return N.box(N.types.avc1,F,N.box(N.types.avcC,S))},N.hvc1=function(w){var S=w.hvcc,_=w.codecWidth,C=w.codecHeight,F=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,_>>>8&255,255&_,C>>>8&255,255&C,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return N.box(N.types.hvc1,F,N.box(N.types.hvcC,S))},N.av01=function(w){var S=w.av1c,_=w.codecWidth||192,C=w.codecHeight||108,F=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,_>>>8&255,255&_,C>>>8&255,255&C,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return N.box(N.types.av01,F,N.box(N.types.av1C,S))},N.mvex=function(w){return N.box(N.types.mvex,N.trex(w))},N.trex=function(w){var S=w.id,_=new Uint8Array([0,0,0,0,S>>>24&255,S>>>16&255,S>>>8&255,255&S,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return N.box(N.types.trex,_)},N.moof=function(w,S){return N.box(N.types.moof,N.mfhd(w.sequenceNumber),N.traf(w,S))},N.mfhd=function(w){var S=new Uint8Array([0,0,0,0,w>>>24&255,w>>>16&255,w>>>8&255,255&w]);return N.box(N.types.mfhd,S)},N.traf=function(w,S){var _=w.id,C=N.box(N.types.tfhd,new Uint8Array([0,0,0,0,_>>>24&255,_>>>16&255,_>>>8&255,255&_])),F=N.box(N.types.tfdt,new Uint8Array([0,0,0,0,S>>>24&255,S>>>16&255,S>>>8&255,255&S])),G=N.sdtp(w),z=N.trun(w,G.byteLength+16+16+8+16+8+8);return N.box(N.types.traf,C,F,z,G)},N.sdtp=function(w){for(var S=w.samples||[],_=S.length,C=new Uint8Array(4+_),F=0;F<_;F++){var G=S[F].flags;C[F+4]=G.isLeading<<6|G.dependsOn<<4|G.isDependedOn<<2|G.hasRedundancy}return N.box(N.types.sdtp,C)},N.trun=function(w,S){var _=w.samples||[],C=_.length,F=12+16*C,G=new Uint8Array(F);S+=8+F,G.set([0,0,15,1,C>>>24&255,C>>>16&255,C>>>8&255,255&C,S>>>24&255,S>>>16&255,S>>>8&255,255&S],0);for(var z=0;z<C;z++){var te=_[z].duration,J=_[z].size,ne=_[z].flags,de=_[z].cts;G.set([te>>>24&255,te>>>16&255,te>>>8&255,255&te,J>>>24&255,J>>>16&255,J>>>8&255,255&J,ne.isLeading<<2|ne.dependsOn,ne.isDependedOn<<6|ne.hasRedundancy<<4|ne.isNonSync,0,0,de>>>24&255,de>>>16&255,de>>>8&255,255&de],12+16*z)}return N.box(N.types.trun,G)},N.mdat=function(w){return N.box(N.types.mdat,w)},N})();ea.init();var ta=ea,Oo=(function(){function N(){}return N.getSilentFrame=function(w,S){if(w==="mp4a.40.2"){if(S===1)return new Uint8Array([0,200,0,128,35,128]);if(S===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(S===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(S===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(S===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(S===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(S===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(S===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(S===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},N})(),Ii=a(11),Po=(function(){function N(w){this.TAG="MP4Remuxer",this._config=w,this._isLive=w.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new Ii.c("audio"),this._videoSegmentInfoList=new Ii.c("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!f.a.chrome||!(f.a.version.major<50||f.a.version.major===50&&f.a.version.build<2661)),this._fillSilentAfterSeek=f.a.msedge||f.a.msie,this._mp3UseMpegAudio=!f.a.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return N.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},N.prototype.bindDataSource=function(w){return w.onDataAvailable=this.remux.bind(this),w.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(N.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(w){this._onInitSegment=w},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(w){this._onMediaSegment=w},enumerable:!1,configurable:!0}),N.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},N.prototype.seek=function(w){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},N.prototype.remux=function(w,S){if(!this._onMediaSegment)throw new x.a("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(w,S),S&&this._remuxVideo(S),w&&this._remuxAudio(w)},N.prototype._onTrackMetadataReceived=function(w,S){var _=null,C="mp4",F=S.codec;if(w==="audio")this._audioMeta=S,S.codec==="mp3"&&this._mp3UseMpegAudio?(C="mpeg",F="",_=new Uint8Array):_=ta.generateInitSegment(S);else{if(w!=="video")return;this._videoMeta=S,_=ta.generateInitSegment(S)}if(!this._onInitSegment)throw new x.a("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(w,{type:w,data:_.buffer,codec:F,container:"".concat(w,"/").concat(C),mediaDuration:S.duration})},N.prototype._calculateDtsBase=function(w,S){this._dtsBaseInited||(w&&w.samples&&w.samples.length&&(this._audioDtsBase=w.samples[0].dts),S&&S.samples&&S.samples.length&&(this._videoDtsBase=S.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},N.prototype.getTimestampBase=function(){if(this._dtsBaseInited)return this._dtsBase},N.prototype.flushStashedSamples=function(){var w=this._videoStashedLastSample,S=this._audioStashedLastSample,_={type:"video",id:1,sequenceNumber:0,samples:[],length:0};w!=null&&(_.samples.push(w),_.length=w.length);var C={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};S!=null&&(C.samples.push(S),C.length=S.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(_,!0),this._remuxAudio(C,!0)},N.prototype._remuxAudio=function(w,S){if(this._audioMeta!=null){var _,C=w,F=C.samples,G=void 0,z=-1,te=this._audioMeta.refSampleDuration,J=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,ne=this._dtsBaseInited&&this._audioNextDts===void 0,de=!1;if(F&&F.length!==0&&(F.length!==1||S)){var le=0,he=null,we=0;J?(le=0,we=C.length):(le=8,we=8+C.length);var ke=null;if(F.length>1&&(we-=(ke=F.pop()).length),this._audioStashedLastSample!=null){var De=this._audioStashedLastSample;this._audioStashedLastSample=null,F.unshift(De),we+=De.length}ke!=null&&(this._audioStashedLastSample=ke);var Ye=F[0].dts-this._dtsBase;if(this._audioNextDts)G=Ye-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())G=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(de=!0);else{var Ve=this._audioSegmentInfoList.getLastSampleBefore(Ye);if(Ve!=null){var Fe=Ye-(Ve.originalDts+Ve.duration);Fe<=3&&(Fe=0),G=Ye-(Ve.dts+Ve.duration+Fe)}else G=0}if(de){var at=Ye-G,gt=this._videoSegmentInfoList.getLastSegmentBefore(Ye);if(gt!=null&&gt.beginDts<at){if(es=Oo.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount)){var Ke=gt.beginDts,tt=at-gt.beginDts;u.a.v(this.TAG,"InsertPrefixSilentAudio: dts: ".concat(Ke,", duration: ").concat(tt)),F.unshift({unit:es,dts:Ke,pts:Ke}),we+=es.byteLength}}else de=!1}for(var ht=[],nt=0;nt<F.length;nt++){var st=(De=F[nt]).unit,ft=De.dts-this._dtsBase,Pt=(Ke=ft,!1),ut=null,_t=0;if(!(ft<-.001)){if(this._audioMeta.codec!=="mp3"&&te!=null){var Ft=ft;if(this._audioNextDts&&(Ft=this._audioNextDts),(G=ft-Ft)<=-3*te){u.a.w(this.TAG,"Dropping 1 audio frame (originalDts: ".concat(ft," ms ,curRefDts: ").concat(Ft," ms)  due to dtsCorrection: ").concat(G," ms overlap."));continue}if(G>=3*te&&this._fillAudioTimestampGap&&!f.a.safari){Pt=!0;var es,gi=Math.floor(G/te);u.a.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+"originalDts: ".concat(ft," ms, curRefDts: ").concat(Ft," ms, ")+"dtsCorrection: ".concat(Math.round(G)," ms, generate: ").concat(gi," frames")),Ke=Math.floor(Ft),_t=Math.floor(Ft+te)-Ke,(es=Oo.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount))==null&&(u.a.w(this.TAG,"Unable to generate silent frame for "+"".concat(this._audioMeta.originalCodec," with ").concat(this._audioMeta.channelCount," channels, repeat last frame")),es=st),ut=[];for(var $t=0;$t<gi;$t++){Ft+=te;var Bs=Math.floor(Ft),js=Math.floor(Ft+te)-Bs,Ss={dts:Bs,pts:Bs,cts:0,unit:es,size:es.byteLength,duration:js,originalDts:ft,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};ut.push(Ss),we+=Ss.size}this._audioNextDts=Ft+te}else Ke=Math.floor(Ft),_t=Math.floor(Ft+te)-Ke,this._audioNextDts=Ft+te}else Ke=ft-G,nt!==F.length-1?_t=F[nt+1].dts-this._dtsBase-G-Ke:ke!=null?_t=ke.dts-this._dtsBase-G-Ke:_t=ht.length>=1?ht[ht.length-1].duration:Math.floor(te),this._audioNextDts=Ke+_t;z===-1&&(z=Ke),ht.push({dts:Ke,pts:Ke,cts:0,unit:De.unit,size:De.unit.byteLength,duration:_t,originalDts:ft,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),Pt&&ht.push.apply(ht,ut)}}if(ht.length===0)return C.samples=[],void(C.length=0);for(J?he=new Uint8Array(we):((he=new Uint8Array(we))[0]=we>>>24&255,he[1]=we>>>16&255,he[2]=we>>>8&255,he[3]=255&we,he.set(ta.types.mdat,4)),nt=0;nt<ht.length;nt++)st=ht[nt].unit,he.set(st,le),le+=st.byteLength;var hs=ht[ht.length-1];_=hs.dts+hs.duration;var kt=new Ii.b;kt.beginDts=z,kt.endDts=_,kt.beginPts=z,kt.endPts=_,kt.originalBeginDts=ht[0].originalDts,kt.originalEndDts=hs.originalDts+hs.duration,kt.firstSample=new Ii.d(ht[0].dts,ht[0].pts,ht[0].duration,ht[0].originalDts,!1),kt.lastSample=new Ii.d(hs.dts,hs.pts,hs.duration,hs.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(kt),C.samples=ht,C.sequenceNumber++;var ki=null;ki=J?new Uint8Array:ta.moof(C,z),C.samples=[],C.length=0;var zs={type:"audio",data:this._mergeBoxes(ki,he).buffer,sampleCount:ht.length,info:kt};J&&ne&&(zs.timestampOffset=z),this._onMediaSegment("audio",zs)}}},N.prototype._remuxVideo=function(w,S){if(this._videoMeta!=null){var _,C,F=w,G=F.samples,z=void 0,te=-1,J=-1;if(G&&G.length!==0&&(G.length!==1||S)){var ne=8,de=null,le=8+w.length,he=null;if(G.length>1&&(le-=(he=G.pop()).length),this._videoStashedLastSample!=null){var we=this._videoStashedLastSample;this._videoStashedLastSample=null,G.unshift(we),le+=we.length}he!=null&&(this._videoStashedLastSample=he);var ke=G[0].dts-this._dtsBase;if(this._videoNextDts)z=ke-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())z=0;else{var De=this._videoSegmentInfoList.getLastSampleBefore(ke);if(De!=null){var Ye=ke-(De.originalDts+De.duration);Ye<=3&&(Ye=0),z=ke-(De.dts+De.duration+Ye)}else z=0}for(var Ve=new Ii.b,Fe=[],at=0;at<G.length;at++){var gt=(we=G[at]).dts-this._dtsBase,Ke=we.isKeyframe,tt=gt-z,ht=we.cts,nt=tt+ht;te===-1&&(te=tt,J=nt);var st=0;if(at!==G.length-1?st=G[at+1].dts-this._dtsBase-z-tt:he!=null?st=he.dts-this._dtsBase-z-tt:st=Fe.length>=1?Fe[Fe.length-1].duration:Math.floor(this._videoMeta.refSampleDuration),Ke){var ft=new Ii.d(tt,nt,st,we.dts,!0);ft.fileposition=we.fileposition,Ve.appendSyncPoint(ft)}Fe.push({dts:tt,pts:nt,cts:ht,units:we.units,size:we.length,isKeyframe:Ke,duration:st,originalDts:gt,flags:{isLeading:0,dependsOn:Ke?2:1,isDependedOn:Ke?1:0,hasRedundancy:0,isNonSync:Ke?0:1}})}for((de=new Uint8Array(le))[0]=le>>>24&255,de[1]=le>>>16&255,de[2]=le>>>8&255,de[3]=255&le,de.set(ta.types.mdat,4),at=0;at<Fe.length;at++)for(var Pt=Fe[at].units;Pt.length;){var ut=Pt.shift().data;de.set(ut,ne),ne+=ut.byteLength}var _t=Fe[Fe.length-1];if(_=_t.dts+_t.duration,C=_t.pts+_t.duration,this._videoNextDts=_,Ve.beginDts=te,Ve.endDts=_,Ve.beginPts=J,Ve.endPts=C,Ve.originalBeginDts=Fe[0].originalDts,Ve.originalEndDts=_t.originalDts+_t.duration,Ve.firstSample=new Ii.d(Fe[0].dts,Fe[0].pts,Fe[0].duration,Fe[0].originalDts,Fe[0].isKeyframe),Ve.lastSample=new Ii.d(_t.dts,_t.pts,_t.duration,_t.originalDts,_t.isKeyframe),this._isLive||this._videoSegmentInfoList.append(Ve),F.samples=Fe,F.sequenceNumber++,this._forceFirstIDR){var Ft=Fe[0].flags;Ft.dependsOn=2,Ft.isNonSync=0}var es=ta.moof(F,te);F.samples=[],F.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(es,de).buffer,sampleCount:Fe.length,info:Ve})}}},N.prototype._mergeBoxes=function(w,S){var _=new Uint8Array(w.byteLength+S.byteLength);return _.set(w,0),_.set(S,w.byteLength),_},N})(),Bo=a(14),ls=a(1),tc=(a(2),(function(){function N(w,S){this.TAG="TransmuxingController",this._emitter=new c.a,this._config=S,w.segments||(w.segments=[{duration:w.duration,filesize:w.filesize,url:w.url}]),typeof w.cors!="boolean"&&(w.cors=!0),typeof w.withCredentials!="boolean"&&(w.withCredentials=!1),this._mediaDataSource=w,this._currentSegmentIndex=0;var _=0;this._mediaDataSource.segments.forEach((function(C){C.timestampBase=_,_+=C.duration,C.cors=w.cors,C.withCredentials=w.withCredentials,S.referrerPolicy&&(C.referrerPolicy=S.referrerPolicy)})),isNaN(_)||this._mediaDataSource.duration===_||(this._mediaDataSource.duration=_),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return N.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},N.prototype.on=function(w,S){this._emitter.addListener(w,S)},N.prototype.off=function(w,S){this._emitter.removeListener(w,S)},N.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},N.prototype._loadSegment=function(w,S){this._currentSegmentIndex=w;var _=this._mediaDataSource.segments[w],C=this._ioctl=new Bo.a(_,this._config,w);C.onError=this._onIOException.bind(this),C.onSeeked=this._onIOSeeked.bind(this),C.onComplete=this._onIOComplete.bind(this),C.onRedirect=this._onIORedirect.bind(this),C.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),S?this._demuxer.bindDataSource(this._ioctl):C.onDataArrival=this._onInitChunkArrival.bind(this),C.open(S)},N.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},N.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},N.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},N.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},N.prototype.seek=function(w){if(this._mediaInfo!=null&&this._mediaInfo.isSeekable()){var S=this._searchSegmentIndexContains(w);if(S===this._currentSegmentIndex){var _=this._mediaInfo.segments[S];if(_==null)this._pendingSeekTime=w;else{var C=_.getNearestKeyframe(w);this._remuxer.seek(C.milliseconds),this._ioctl.seek(C.fileposition),this._pendingResolveSeekPoint=C.milliseconds}}else{var F=this._mediaInfo.segments[S];F==null?(this._pendingSeekTime=w,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(S)):(C=F.getNearestKeyframe(w),this._internalAbort(),this._remuxer.seek(w),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[S].timestampBase,this._loadSegment(S,C.fileposition),this._pendingResolveSeekPoint=C.milliseconds,this._reportSegmentMediaInfo(S))}this._enableStatisticsReporter()}},N.prototype._searchSegmentIndexContains=function(w){for(var S=this._mediaDataSource.segments,_=S.length-1,C=0;C<S.length;C++)if(w<S[C].timestampBase){_=C-1;break}return _},N.prototype._onInitChunkArrival=function(w,S){var _=this,C=0;if(S>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,C=this._demuxer.parseChunks(w,S);else{var F=null;(F=j.probe(w)).match&&(this._setupFLVDemuxerRemuxer(F),C=this._demuxer.parseChunks(w,S)),F.match||F.needMoreData||(F=jo.probe(w)).match&&(this._setupTSDemuxerRemuxer(F),C=this._demuxer.parseChunks(w,S)),F.match||F.needMoreData||(F=null,u.a.e(this.TAG,"Non MPEG-TS/FLV, Unsupported media type!"),Promise.resolve().then((function(){_._internalAbort()})),this._emitter.emit(ls.a.DEMUX_ERROR,D.a.FORMAT_UNSUPPORTED,"Non MPEG-TS/FLV, Unsupported media type!"))}return C},N.prototype._setupFLVDemuxerRemuxer=function(w){this._demuxer=new j(w,this._config),this._remuxer||(this._remuxer=new Po(this._config));var S=this._mediaDataSource;S.duration==null||isNaN(S.duration)||(this._demuxer.overridedDuration=S.duration),typeof S.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=S.hasAudio),typeof S.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=S.hasVideo),this._demuxer.timestampBase=S.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},N.prototype._setupTSDemuxerRemuxer=function(w){var S=this._demuxer=new jo(w,this._config);this._remuxer||(this._remuxer=new Po(this._config)),S.onError=this._onDemuxException.bind(this),S.onMediaInfo=this._onMediaInfo.bind(this),S.onMetaDataArrived=this._onMetaDataArrived.bind(this),S.onTimedID3Metadata=this._onTimedID3Metadata.bind(this),S.onSynchronousKLVMetadata=this._onSynchronousKLVMetadata.bind(this),S.onAsynchronousKLVMetadata=this._onAsynchronousKLVMetadata.bind(this),S.onSMPTE2038Metadata=this._onSMPTE2038Metadata.bind(this),S.onSCTE35Metadata=this._onSCTE35Metadata.bind(this),S.onPESPrivateDataDescriptor=this._onPESPrivateDataDescriptor.bind(this),S.onPESPrivateData=this._onPESPrivateData.bind(this),this._remuxer.bindDataSource(this._demuxer),this._demuxer.bindDataSource(this._ioctl),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},N.prototype._onMediaInfo=function(w){var S=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},w),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,d.a.prototype));var _=Object.assign({},w);Object.setPrototypeOf(_,d.a.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=_,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then((function(){var C=S._pendingSeekTime;S._pendingSeekTime=null,S.seek(C)}))},N.prototype._onMetaDataArrived=function(w){this._emitter.emit(ls.a.METADATA_ARRIVED,w)},N.prototype._onScriptDataArrived=function(w){this._emitter.emit(ls.a.SCRIPTDATA_ARRIVED,w)},N.prototype._onTimedID3Metadata=function(w){var S=this._remuxer.getTimestampBase();S!=null&&(w.pts!=null&&(w.pts-=S),w.dts!=null&&(w.dts-=S),this._emitter.emit(ls.a.TIMED_ID3_METADATA_ARRIVED,w))},N.prototype._onSynchronousKLVMetadata=function(w){var S=this._remuxer.getTimestampBase();S!=null&&(w.pts!=null&&(w.pts-=S),w.dts!=null&&(w.dts-=S),this._emitter.emit(ls.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,w))},N.prototype._onAsynchronousKLVMetadata=function(w){this._emitter.emit(ls.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,w)},N.prototype._onSMPTE2038Metadata=function(w){var S=this._remuxer.getTimestampBase();S!=null&&(w.pts!=null&&(w.pts-=S),w.dts!=null&&(w.dts-=S),w.nearest_pts!=null&&(w.nearest_pts-=S),this._emitter.emit(ls.a.SMPTE2038_METADATA_ARRIVED,w))},N.prototype._onSCTE35Metadata=function(w){var S=this._remuxer.getTimestampBase();S!=null&&(w.pts!=null&&(w.pts-=S),w.nearest_pts!=null&&(w.nearest_pts-=S),this._emitter.emit(ls.a.SCTE35_METADATA_ARRIVED,w))},N.prototype._onPESPrivateDataDescriptor=function(w){this._emitter.emit(ls.a.PES_PRIVATE_DATA_DESCRIPTOR,w)},N.prototype._onPESPrivateData=function(w){var S=this._remuxer.getTimestampBase();S!=null&&(w.pts!=null&&(w.pts-=S),w.nearest_pts!=null&&(w.nearest_pts-=S),w.dts!=null&&(w.dts-=S),this._emitter.emit(ls.a.PES_PRIVATE_DATA_ARRIVED,w))},N.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},N.prototype._onIOComplete=function(w){var S=w+1;S<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer&&this._remuxer.flushStashedSamples(),this._loadSegment(S)):(this._remuxer&&this._remuxer.flushStashedSamples(),this._emitter.emit(ls.a.LOADING_COMPLETE),this._disableStatisticsReporter())},N.prototype._onIORedirect=function(w){var S=this._ioctl.extraData;this._mediaDataSource.segments[S].redirectedURL=w},N.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(ls.a.RECOVERED_EARLY_EOF)},N.prototype._onIOException=function(w,S){u.a.e(this.TAG,"IOException: type = ".concat(w,", code = ").concat(S.code,", msg = ").concat(S.msg)),this._emitter.emit(ls.a.IO_ERROR,w,S),this._disableStatisticsReporter()},N.prototype._onDemuxException=function(w,S){u.a.e(this.TAG,"DemuxException: type = ".concat(w,", info = ").concat(S)),this._emitter.emit(ls.a.DEMUX_ERROR,w,S)},N.prototype._onRemuxerInitSegmentArrival=function(w,S){this._emitter.emit(ls.a.INIT_SEGMENT,w,S)},N.prototype._onRemuxerMediaSegmentArrival=function(w,S){if(this._pendingSeekTime==null&&(this._emitter.emit(ls.a.MEDIA_SEGMENT,w,S),this._pendingResolveSeekPoint!=null&&w==="video")){var _=S.info.syncPoints,C=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,f.a.safari&&_.length>0&&_[0].originalDts===C&&(C=_[0].pts),this._emitter.emit(ls.a.RECOMMEND_SEEKPOINT,C)}},N.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},N.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},N.prototype._reportSegmentMediaInfo=function(w){var S=this._mediaInfo.segments[w],_=Object.assign({},S);_.duration=this._mediaInfo.duration,_.segmentCount=this._mediaInfo.segmentCount,delete _.segments,delete _.keyframesIndex,this._emitter.emit(ls.a.MEDIA_INFO,_)},N.prototype._reportStatisticsInfo=function(){var w={};w.url=this._ioctl.currentURL,w.hasRedirect=this._ioctl.hasRedirect,w.hasRedirect&&(w.redirectedURL=this._ioctl.currentRedirectedURL),w.speed=this._ioctl.currentSpeed,w.loaderType=this._ioctl.loaderType,w.currentSegmentIndex=this._currentSegmentIndex,w.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(ls.a.STATISTICS_INFO,w)},N})());s.a=tc},function(t,s,a){var l,c=a(0),u=(function(){function U(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return U.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},U.prototype.addBytes=function(k){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=k,this._totalBytes+=k):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=k,this._totalBytes+=k):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=k,this._totalBytes+=k,this._lastCheckpoint=this._now())},Object.defineProperty(U.prototype,"currentKBps",{get:function(){this.addBytes(0);var k=(this._now()-this._lastCheckpoint)/1e3;return k==0&&(k=1),this._intervalBytes/k/1024},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"averageKBps",{get:function(){var k=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/k/1024},enumerable:!1,configurable:!0}),U})(),f=a(2),d=a(5),m=a(3),g=(l=function(U,k){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(M,I){M.__proto__=I}||function(M,I){for(var j in I)Object.prototype.hasOwnProperty.call(I,j)&&(M[j]=I[j])})(U,k)},function(U,k){if(typeof k!="function"&&k!==null)throw new TypeError("Class extends value "+String(k)+" is not a constructor or null");function M(){this.constructor=U}l(U,k),U.prototype=k===null?Object.create(k):(M.prototype=k.prototype,new M)}),y=(function(U){function k(M,I){var j=U.call(this,"fetch-stream-loader")||this;return j.TAG="FetchStreamLoader",j._seekHandler=M,j._config=I,j._needStash=!0,j._requestAbort=!1,j._abortController=null,j._contentLength=null,j._receivedLength=0,j}return g(k,U),k.isSupported=function(){try{var M=d.a.msedge&&d.a.version.minor>=15048,I=!d.a.msedge||M;return self.fetch&&self.ReadableStream&&I}catch{return!1}},k.prototype.destroy=function(){this.isWorking()&&this.abort(),U.prototype.destroy.call(this)},k.prototype.open=function(M,I){var j=this;this._dataSource=M,this._range=I;var Z=M.url;this._config.reuseRedirectedURL&&M.redirectedURL!=null&&(Z=M.redirectedURL);var ae=this._seekHandler.getConfig(Z,I),ie=new self.Headers;if(typeof ae.headers=="object"){var re=ae.headers;for(var Q in re)re.hasOwnProperty(Q)&&ie.append(Q,re[Q])}var se={method:"GET",headers:ie,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var Q in this._config.headers)ie.append(Q,this._config.headers[Q]);M.cors===!1&&(se.mode="same-origin"),M.withCredentials&&(se.credentials="include"),M.referrerPolicy&&(se.referrerPolicy=M.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,se.signal=this._abortController.signal),this._status=f.c.kConnecting,self.fetch(ae.url,se).then((function(oe){if(j._requestAbort)return j._status=f.c.kIdle,void oe.body.cancel();if(oe.ok&&oe.status>=200&&oe.status<=299){if(oe.url!==ae.url&&j._onURLRedirect){var Y=j._seekHandler.removeURLParameters(oe.url);j._onURLRedirect(Y)}var V=oe.headers.get("Content-Length");return V!=null&&(j._contentLength=parseInt(V),j._contentLength!==0&&j._onContentLengthKnown&&j._onContentLengthKnown(j._contentLength)),j._pump.call(j,oe.body.getReader())}if(j._status=f.c.kError,!j._onError)throw new m.d("FetchStreamLoader: Http code invalid, "+oe.status+" "+oe.statusText);j._onError(f.b.HTTP_STATUS_CODE_INVALID,{code:oe.status,msg:oe.statusText})})).catch((function(oe){if(!j._abortController||!j._abortController.signal.aborted){if(j._status=f.c.kError,!j._onError)throw oe;j._onError(f.b.EXCEPTION,{code:-1,msg:oe.message})}}))},k.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==f.c.kBuffering||!d.a.chrome)&&this._abortController)try{this._abortController.abort()}catch{}},k.prototype._pump=function(M){var I=this;return M.read().then((function(j){if(j.done)if(I._contentLength!==null&&I._receivedLength<I._contentLength){I._status=f.c.kError;var Z=f.b.EARLY_EOF,ae={code:-1,msg:"Fetch stream meet Early-EOF"};if(!I._onError)throw new m.d(ae.msg);I._onError(Z,ae)}else I._status=f.c.kComplete,I._onComplete&&I._onComplete(I._range.from,I._range.from+I._receivedLength-1);else{if(I._abortController&&I._abortController.signal.aborted)return void(I._status=f.c.kComplete);if(I._requestAbort===!0)return I._status=f.c.kComplete,M.cancel();I._status=f.c.kBuffering;var ie=j.value.buffer,re=I._range.from+I._receivedLength;I._receivedLength+=ie.byteLength,I._onDataArrival&&I._onDataArrival(ie,re,I._receivedLength),I._pump(M)}})).catch((function(j){if(I._abortController&&I._abortController.signal.aborted)I._status=f.c.kComplete;else if(j.code!==11||!d.a.msedge){I._status=f.c.kError;var Z=0,ae=null;if(j.code!==19&&j.message!=="network error"||!(I._contentLength===null||I._contentLength!==null&&I._receivedLength<I._contentLength)?(Z=f.b.EXCEPTION,ae={code:j.code,msg:j.message}):(Z=f.b.EARLY_EOF,ae={code:j.code,msg:"Fetch stream meet Early-EOF"}),!I._onError)throw new m.d(ae.msg);I._onError(Z,ae)}}))},k})(f.a),x=(function(){var U=function(k,M){return(U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,j){I.__proto__=j}||function(I,j){for(var Z in j)Object.prototype.hasOwnProperty.call(j,Z)&&(I[Z]=j[Z])})(k,M)};return function(k,M){if(typeof M!="function"&&M!==null)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");function I(){this.constructor=k}U(k,M),k.prototype=M===null?Object.create(M):(I.prototype=M.prototype,new I)}})(),v=(function(U){function k(M,I){var j=U.call(this,"xhr-moz-chunked-loader")||this;return j.TAG="MozChunkedLoader",j._seekHandler=M,j._config=I,j._needStash=!0,j._xhr=null,j._requestAbort=!1,j._contentLength=null,j._receivedLength=0,j}return x(k,U),k.isSupported=function(){try{var M=new XMLHttpRequest;return M.open("GET","https://example.com",!0),M.responseType="moz-chunked-arraybuffer",M.responseType==="moz-chunked-arraybuffer"}catch(I){return c.a.w("MozChunkedLoader",I.message),!1}},k.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),U.prototype.destroy.call(this)},k.prototype.open=function(M,I){this._dataSource=M,this._range=I;var j=M.url;this._config.reuseRedirectedURL&&M.redirectedURL!=null&&(j=M.redirectedURL);var Z=this._seekHandler.getConfig(j,I);this._requestURL=Z.url;var ae=this._xhr=new XMLHttpRequest;if(ae.open("GET",Z.url,!0),ae.responseType="moz-chunked-arraybuffer",ae.onreadystatechange=this._onReadyStateChange.bind(this),ae.onprogress=this._onProgress.bind(this),ae.onloadend=this._onLoadEnd.bind(this),ae.onerror=this._onXhrError.bind(this),M.withCredentials&&(ae.withCredentials=!0),typeof Z.headers=="object"){var ie=Z.headers;for(var re in ie)ie.hasOwnProperty(re)&&ae.setRequestHeader(re,ie[re])}if(typeof this._config.headers=="object"){ie=this._config.headers;for(var re in ie)ie.hasOwnProperty(re)&&ae.setRequestHeader(re,ie[re])}this._status=f.c.kConnecting,ae.send()},k.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=f.c.kComplete},k.prototype._onReadyStateChange=function(M){var I=M.target;if(I.readyState===2){if(I.responseURL!=null&&I.responseURL!==this._requestURL&&this._onURLRedirect){var j=this._seekHandler.removeURLParameters(I.responseURL);this._onURLRedirect(j)}if(I.status!==0&&(I.status<200||I.status>299)){if(this._status=f.c.kError,!this._onError)throw new m.d("MozChunkedLoader: Http code invalid, "+I.status+" "+I.statusText);this._onError(f.b.HTTP_STATUS_CODE_INVALID,{code:I.status,msg:I.statusText})}else this._status=f.c.kBuffering}},k.prototype._onProgress=function(M){if(this._status!==f.c.kError){this._contentLength===null&&M.total!==null&&M.total!==0&&(this._contentLength=M.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var I=M.target.response,j=this._range.from+this._receivedLength;this._receivedLength+=I.byteLength,this._onDataArrival&&this._onDataArrival(I,j,this._receivedLength)}},k.prototype._onLoadEnd=function(M){this._requestAbort!==!0?this._status!==f.c.kError&&(this._status=f.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1},k.prototype._onXhrError=function(M){this._status=f.c.kError;var I=0,j=null;if(this._contentLength&&M.loaded<this._contentLength?(I=f.b.EARLY_EOF,j={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(I=f.b.EXCEPTION,j={code:-1,msg:M.constructor.name+" "+M.type}),!this._onError)throw new m.d(j.msg);this._onError(I,j)},k})(f.a),E=(function(){var U=function(k,M){return(U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,j){I.__proto__=j}||function(I,j){for(var Z in j)Object.prototype.hasOwnProperty.call(j,Z)&&(I[Z]=j[Z])})(k,M)};return function(k,M){if(typeof M!="function"&&M!==null)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");function I(){this.constructor=k}U(k,M),k.prototype=M===null?Object.create(M):(I.prototype=M.prototype,new I)}})(),A=((function(U){function k(M,I){var j=U.call(this,"xhr-msstream-loader")||this;return j.TAG="MSStreamLoader",j._seekHandler=M,j._config=I,j._needStash=!0,j._xhr=null,j._reader=null,j._totalRange=null,j._currentRange=null,j._currentRequestURL=null,j._currentRedirectedURL=null,j._contentLength=null,j._receivedLength=0,j._bufferLimit=16777216,j._lastTimeBufferSize=0,j._isReconnecting=!1,j}E(k,U),k.isSupported=function(){try{if(self.MSStream===void 0||self.MSStreamReader===void 0)return!1;var M=new XMLHttpRequest;return M.open("GET","https://example.com",!0),M.responseType="ms-stream",M.responseType==="ms-stream"}catch(I){return c.a.w("MSStreamLoader",I.message),!1}},k.prototype.destroy=function(){this.isWorking()&&this.abort(),this._reader&&(this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr=null),U.prototype.destroy.call(this)},k.prototype.open=function(M,I){this._internalOpen(M,I,!1)},k.prototype._internalOpen=function(M,I,j){this._dataSource=M,j?this._currentRange=I:this._totalRange=I;var Z=M.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?Z=this._currentRedirectedURL:M.redirectedURL!=null&&(Z=M.redirectedURL));var ae=this._seekHandler.getConfig(Z,I);this._currentRequestURL=ae.url;var ie=this._reader=new self.MSStreamReader;ie.onprogress=this._msrOnProgress.bind(this),ie.onload=this._msrOnLoad.bind(this),ie.onerror=this._msrOnError.bind(this);var re=this._xhr=new XMLHttpRequest;if(re.open("GET",ae.url,!0),re.responseType="ms-stream",re.onreadystatechange=this._xhrOnReadyStateChange.bind(this),re.onerror=this._xhrOnError.bind(this),M.withCredentials&&(re.withCredentials=!0),typeof ae.headers=="object"){var Q=ae.headers;for(var se in Q)Q.hasOwnProperty(se)&&re.setRequestHeader(se,Q[se])}if(typeof this._config.headers=="object"){Q=this._config.headers;for(var se in Q)Q.hasOwnProperty(se)&&re.setRequestHeader(se,Q[se])}this._isReconnecting?this._isReconnecting=!1:this._status=f.c.kConnecting,re.send()},k.prototype.abort=function(){this._internalAbort(),this._status=f.c.kComplete},k.prototype._internalAbort=function(){this._reader&&(this._reader.readyState===1&&this._reader.abort(),this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.abort(),this._xhr.onreadystatechange=null,this._xhr=null)},k.prototype._xhrOnReadyStateChange=function(M){var I=M.target;if(I.readyState===2)if(I.status>=200&&I.status<=299){if(this._status=f.c.kBuffering,I.responseURL!=null){var j=this._seekHandler.removeURLParameters(I.responseURL);I.responseURL!==this._currentRequestURL&&j!==this._currentRedirectedURL&&(this._currentRedirectedURL=j,this._onURLRedirect&&this._onURLRedirect(j))}var Z=I.getResponseHeader("Content-Length");if(Z!=null&&this._contentLength==null){var ae=parseInt(Z);ae>0&&(this._contentLength=ae,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength))}}else{if(this._status=f.c.kError,!this._onError)throw new m.d("MSStreamLoader: Http code invalid, "+I.status+" "+I.statusText);this._onError(f.b.HTTP_STATUS_CODE_INVALID,{code:I.status,msg:I.statusText})}else if(I.readyState===3&&I.status>=200&&I.status<=299){this._status=f.c.kBuffering;var ie=I.response;this._reader.readAsArrayBuffer(ie)}},k.prototype._xhrOnError=function(M){this._status=f.c.kError;var I=f.b.EXCEPTION,j={code:-1,msg:M.constructor.name+" "+M.type};if(!this._onError)throw new m.d(j.msg);this._onError(I,j)},k.prototype._msrOnProgress=function(M){var I=M.target.result;if(I!=null){var j=I.slice(this._lastTimeBufferSize);this._lastTimeBufferSize=I.byteLength;var Z=this._totalRange.from+this._receivedLength;this._receivedLength+=j.byteLength,this._onDataArrival&&this._onDataArrival(j,Z,this._receivedLength),I.byteLength>=this._bufferLimit&&(c.a.v(this.TAG,"MSStream buffer exceeded max size near ".concat(Z+j.byteLength,", reconnecting...")),this._doReconnectIfNeeded())}else this._doReconnectIfNeeded()},k.prototype._doReconnectIfNeeded=function(){if(this._contentLength==null||this._receivedLength<this._contentLength){this._isReconnecting=!0,this._lastTimeBufferSize=0,this._internalAbort();var M={from:this._totalRange.from+this._receivedLength,to:-1};this._internalOpen(this._dataSource,M,!0)}},k.prototype._msrOnLoad=function(M){this._status=f.c.kComplete,this._onComplete&&this._onComplete(this._totalRange.from,this._totalRange.from+this._receivedLength-1)},k.prototype._msrOnError=function(M){this._status=f.c.kError;var I=0,j=null;if(this._contentLength&&this._receivedLength<this._contentLength?(I=f.b.EARLY_EOF,j={code:-1,msg:"MSStream meet Early-Eof"}):(I=f.b.EARLY_EOF,j={code:-1,msg:M.constructor.name+" "+M.type}),!this._onError)throw new m.d(j.msg);this._onError(I,j)}})(f.a),(function(){var U=function(k,M){return(U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,j){I.__proto__=j}||function(I,j){for(var Z in j)Object.prototype.hasOwnProperty.call(j,Z)&&(I[Z]=j[Z])})(k,M)};return function(k,M){if(typeof M!="function"&&M!==null)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");function I(){this.constructor=k}U(k,M),k.prototype=M===null?Object.create(M):(I.prototype=M.prototype,new I)}})()),R=(function(U){function k(M,I){var j=U.call(this,"xhr-range-loader")||this;return j.TAG="RangeLoader",j._seekHandler=M,j._config=I,j._needStash=!1,j._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],j._currentChunkSizeKB=384,j._currentSpeedNormalized=0,j._zeroSpeedChunkCount=0,j._xhr=null,j._speedSampler=new u,j._requestAbort=!1,j._waitForTotalLength=!1,j._totalLengthReceived=!1,j._currentRequestURL=null,j._currentRedirectedURL=null,j._currentRequestRange=null,j._totalLength=null,j._contentLength=null,j._receivedLength=0,j._lastTimeLoaded=0,j}return A(k,U),k.isSupported=function(){try{var M=new XMLHttpRequest;return M.open("GET","https://example.com",!0),M.responseType="arraybuffer",M.responseType==="arraybuffer"}catch(I){return c.a.w("RangeLoader",I.message),!1}},k.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),U.prototype.destroy.call(this)},Object.defineProperty(k.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),k.prototype.open=function(M,I){this._dataSource=M,this._range=I,this._status=f.c.kConnecting;var j=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(j=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||j?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))},k.prototype._openSubRange=function(){var M=1024*this._currentChunkSizeKB,I=this._range.from+this._receivedLength,j=I+M;this._contentLength!=null&&j-this._range.from>=this._contentLength&&(j=this._range.from+this._contentLength-1),this._currentRequestRange={from:I,to:j},this._internalOpen(this._dataSource,this._currentRequestRange)},k.prototype._internalOpen=function(M,I){this._lastTimeLoaded=0;var j=M.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?j=this._currentRedirectedURL:M.redirectedURL!=null&&(j=M.redirectedURL));var Z=this._seekHandler.getConfig(j,I);this._currentRequestURL=Z.url;var ae=this._xhr=new XMLHttpRequest;if(ae.open("GET",Z.url,!0),ae.responseType="arraybuffer",ae.onreadystatechange=this._onReadyStateChange.bind(this),ae.onprogress=this._onProgress.bind(this),ae.onload=this._onLoad.bind(this),ae.onerror=this._onXhrError.bind(this),M.withCredentials&&(ae.withCredentials=!0),typeof Z.headers=="object"){var ie=Z.headers;for(var re in ie)ie.hasOwnProperty(re)&&ae.setRequestHeader(re,ie[re])}if(typeof this._config.headers=="object"){ie=this._config.headers;for(var re in ie)ie.hasOwnProperty(re)&&ae.setRequestHeader(re,ie[re])}ae.send()},k.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=f.c.kComplete},k.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},k.prototype._onReadyStateChange=function(M){var I=M.target;if(I.readyState===2){if(I.responseURL!=null){var j=this._seekHandler.removeURLParameters(I.responseURL);I.responseURL!==this._currentRequestURL&&j!==this._currentRedirectedURL&&(this._currentRedirectedURL=j,this._onURLRedirect&&this._onURLRedirect(j))}if(I.status>=200&&I.status<=299){if(this._waitForTotalLength)return;this._status=f.c.kBuffering}else{if(this._status=f.c.kError,!this._onError)throw new m.d("RangeLoader: Http code invalid, "+I.status+" "+I.statusText);this._onError(f.b.HTTP_STATUS_CODE_INVALID,{code:I.status,msg:I.statusText})}}},k.prototype._onProgress=function(M){if(this._status!==f.c.kError){if(this._contentLength===null){var I=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,I=!0;var j=M.total;this._internalAbort(),j!=null&j!==0&&(this._totalLength=j)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,I)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var Z=M.loaded-this._lastTimeLoaded;this._lastTimeLoaded=M.loaded,this._speedSampler.addBytes(Z)}},k.prototype._normalizeSpeed=function(M){var I=this._chunkSizeKBList,j=I.length-1,Z=0,ae=0,ie=j;if(M<I[0])return I[0];for(;ae<=ie;){if((Z=ae+Math.floor((ie-ae)/2))===j||M>=I[Z]&&M<I[Z+1])return I[Z];I[Z]<M?ae=Z+1:ie=Z-1}},k.prototype._onLoad=function(M){if(this._status!==f.c.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var I=this._speedSampler.lastSecondKBps;if(I===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(I=this._speedSampler.currentKBps)),I!==0){var j=this._normalizeSpeed(I);this._currentSpeedNormalized!==j&&(this._currentSpeedNormalized=j,this._currentChunkSizeKB=j)}var Z=M.target.response,ae=this._range.from+this._receivedLength;this._receivedLength+=Z.byteLength;var ie=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():ie=!0,this._onDataArrival&&this._onDataArrival(Z,ae,this._receivedLength),ie&&(this._status=f.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},k.prototype._onXhrError=function(M){this._status=f.c.kError;var I=0,j=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(I=f.b.EARLY_EOF,j={code:-1,msg:"RangeLoader meet Early-Eof"}):(I=f.b.EXCEPTION,j={code:-1,msg:M.constructor.name+" "+M.type}),!this._onError)throw new m.d(j.msg);this._onError(I,j)},k})(f.a),D=(function(){var U=function(k,M){return(U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,j){I.__proto__=j}||function(I,j){for(var Z in j)Object.prototype.hasOwnProperty.call(j,Z)&&(I[Z]=j[Z])})(k,M)};return function(k,M){if(typeof M!="function"&&M!==null)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");function I(){this.constructor=k}U(k,M),k.prototype=M===null?Object.create(M):(I.prototype=M.prototype,new I)}})(),L=(function(U){function k(){var M=U.call(this,"websocket-loader")||this;return M.TAG="WebSocketLoader",M._needStash=!0,M._ws=null,M._requestAbort=!1,M._receivedLength=0,M}return D(k,U),k.isSupported=function(){try{return self.WebSocket!==void 0}catch{return!1}},k.prototype.destroy=function(){this._ws&&this.abort(),U.prototype.destroy.call(this)},k.prototype.open=function(M){try{var I=this._ws=new self.WebSocket(M.url);I.binaryType="arraybuffer",I.onopen=this._onWebSocketOpen.bind(this),I.onclose=this._onWebSocketClose.bind(this),I.onmessage=this._onWebSocketMessage.bind(this),I.onerror=this._onWebSocketError.bind(this),this._status=f.c.kConnecting}catch(Z){this._status=f.c.kError;var j={code:Z.code,msg:Z.message};if(!this._onError)throw new m.d(j.msg);this._onError(f.b.EXCEPTION,j)}},k.prototype.abort=function(){var M=this._ws;!M||M.readyState!==0&&M.readyState!==1||(this._requestAbort=!0,M.close()),this._ws=null,this._status=f.c.kComplete},k.prototype._onWebSocketOpen=function(M){this._status=f.c.kBuffering},k.prototype._onWebSocketClose=function(M){this._requestAbort!==!0?(this._status=f.c.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1},k.prototype._onWebSocketMessage=function(M){var I=this;if(M.data instanceof ArrayBuffer)this._dispatchArrayBuffer(M.data);else if(M.data instanceof Blob){var j=new FileReader;j.onload=function(){I._dispatchArrayBuffer(j.result)},j.readAsArrayBuffer(M.data)}else{this._status=f.c.kError;var Z={code:-1,msg:"Unsupported WebSocket message type: "+M.data.constructor.name};if(!this._onError)throw new m.d(Z.msg);this._onError(f.b.EXCEPTION,Z)}},k.prototype._dispatchArrayBuffer=function(M){var I=M,j=this._receivedLength;this._receivedLength+=I.byteLength,this._onDataArrival&&this._onDataArrival(I,j,this._receivedLength)},k.prototype._onWebSocketError=function(M){this._status=f.c.kError;var I={code:M.code,msg:M.message};if(!this._onError)throw new m.d(I.msg);this._onError(f.b.EXCEPTION,I)},k})(f.a),O=(function(){function U(k){this._zeroStart=k||!1}return U.prototype.getConfig=function(k,M){var I={};if(M.from!==0||M.to!==-1){var j=void 0;j=M.to!==-1?"bytes=".concat(M.from.toString(),"-").concat(M.to.toString()):"bytes=".concat(M.from.toString(),"-"),I.Range=j}else this._zeroStart&&(I.Range="bytes=0-");return{url:k,headers:I}},U.prototype.removeURLParameters=function(k){return k},U})(),H=(function(){function U(k,M){this._startName=k,this._endName=M}return U.prototype.getConfig=function(k,M){var I=k;if(M.from!==0||M.to!==-1){var j=!0;I.indexOf("?")===-1&&(I+="?",j=!1),j&&(I+="&"),I+="".concat(this._startName,"=").concat(M.from.toString()),M.to!==-1&&(I+="&".concat(this._endName,"=").concat(M.to.toString()))}return{url:I,headers:{}}},U.prototype.removeURLParameters=function(k){var M=k.split("?")[0],I=void 0,j=k.indexOf("?");j!==-1&&(I=k.substring(j+1));var Z="";if(I!=null&&I.length>0)for(var ae=I.split("&"),ie=0;ie<ae.length;ie++){var re=ae[ie].split("="),Q=ie>0;re[0]!==this._startName&&re[0]!==this._endName&&(Q&&(Z+="&"),Z+=ae[ie])}return Z.length===0?M:M+"?"+Z},U})(),q=(function(){function U(k,M,I){this.TAG="IOController",this._config=M,this._extraData=I,this._stashInitialSize=65536,M.stashInitialSize!=null&&M.stashInitialSize>0&&(this._stashInitialSize=M.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=Math.max(this._stashSize,3145728),this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,M.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=k,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(k.url),this._refTotalLength=k.filesize?k.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new u,this._speedNormalizeList=[32,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return U.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},U.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},U.prototype.isPaused=function(){return this._paused},Object.defineProperty(U.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"extraData",{get:function(){return this._extraData},set:function(k){this._extraData=k},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(k){this._onDataArrival=k},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(k){this._onSeeked=k},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"onError",{get:function(){return this._onError},set:function(k){this._onError=k},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"onComplete",{get:function(){return this._onComplete},set:function(k){this._onComplete=k},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(k){this._onRedirect=k},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(k){this._onRecoveredEarlyEof=k},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"currentSpeed",{get:function(){return this._loaderClass===R?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),U.prototype._selectSeekHandler=function(){var k=this._config;if(k.seekType==="range")this._seekHandler=new O(this._config.rangeLoadZeroStart);else if(k.seekType==="param"){var M=k.seekParamStart||"bstart",I=k.seekParamEnd||"bend";this._seekHandler=new H(M,I)}else{if(k.seekType!=="custom")throw new m.b("Invalid seekType in config: ".concat(k.seekType));if(typeof k.customSeekHandler!="function")throw new m.b("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new k.customSeekHandler}},U.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=L;else if(y.isSupported())this._loaderClass=y;else if(v.isSupported())this._loaderClass=v;else{if(!R.isSupported())throw new m.d("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=R}},U.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},U.prototype.open=function(k){this._currentRange={from:0,to:-1},k&&(this._currentRange.from=k),this._speedSampler.reset(),k||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},U.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},U.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},U.prototype.resume=function(){if(this._paused){this._paused=!1;var k=this._resumeFrom;this._resumeFrom=0,this._internalSeek(k,!0)}},U.prototype.seek=function(k){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(k,!0)},U.prototype._internalSeek=function(k,M){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(M),this._loader.destroy(),this._loader=null;var I={from:k,to:-1};this._currentRange={from:I.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,I),this._onSeeked&&this._onSeeked()},U.prototype.updateUrl=function(k){if(!k||typeof k!="string"||k.length===0)throw new m.b("Url must be a non-empty string!");this._dataSource.url=k},U.prototype._expandBuffer=function(k){for(var M=this._stashSize;M+1048576<k;)M*=2;if((M+=1048576)!==this._bufferSize){var I=new ArrayBuffer(M);if(this._stashUsed>0){var j=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(I,0,M).set(j,0)}this._stashBuffer=I,this._bufferSize=M}},U.prototype._normalizeSpeed=function(k){var M=this._speedNormalizeList,I=M.length-1,j=0,Z=0,ae=I;if(k<M[0])return M[0];for(;Z<=ae;){if((j=Z+Math.floor((ae-Z)/2))===I||k>=M[j]&&k<M[j+1])return M[j];M[j]<k?Z=j+1:ae=j-1}},U.prototype._adjustStashSize=function(k){var M=0;(M=this._config.isLive?k/8:k<512?k:k>=512&&k<=1024?Math.floor(1.5*k):2*k)>8192&&(M=8192);var I=1024*M+1048576;this._bufferSize<I&&this._expandBuffer(I),this._stashSize=1024*M},U.prototype._dispatchChunks=function(k,M){return this._currentRange.to=M+k.byteLength-1,this._onDataArrival(k,M)},U.prototype._onURLRedirect=function(k){this._redirectedURL=k,this._onRedirect&&this._onRedirect(k)},U.prototype._onContentLengthKnown=function(k){k&&this._fullRequestFlag&&(this._totalLength=k,this._fullRequestFlag=!1)},U.prototype._onLoaderChunkArrival=function(k,M,I){if(!this._onDataArrival)throw new m.a("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(k.byteLength);var j=this._speedSampler.lastSecondKBps;if(j!==0){var Z=this._normalizeSpeed(j);this._speedNormalized!==Z&&(this._speedNormalized=Z,this._adjustStashSize(Z))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=M),this._stashUsed+k.byteLength<=this._stashSize)(re=new Uint8Array(this._stashBuffer,0,this._stashSize)).set(new Uint8Array(k),this._stashUsed),this._stashUsed+=k.byteLength;else if(re=new Uint8Array(this._stashBuffer,0,this._bufferSize),this._stashUsed>0){var ae=this._stashBuffer.slice(0,this._stashUsed);(Q=this._dispatchChunks(ae,this._stashByteStart))<ae.byteLength?Q>0&&(se=new Uint8Array(ae,Q),re.set(se,0),this._stashUsed=se.byteLength,this._stashByteStart+=Q):(this._stashUsed=0,this._stashByteStart+=Q),this._stashUsed+k.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+k.byteLength),re=new Uint8Array(this._stashBuffer,0,this._bufferSize)),re.set(new Uint8Array(k),this._stashUsed),this._stashUsed+=k.byteLength}else(Q=this._dispatchChunks(k,M))<k.byteLength&&((ie=k.byteLength-Q)>this._bufferSize&&(this._expandBuffer(ie),re=new Uint8Array(this._stashBuffer,0,this._bufferSize)),re.set(new Uint8Array(k,Q),0),this._stashUsed+=ie,this._stashByteStart=M+Q);else if(this._stashUsed===0){var ie;(Q=this._dispatchChunks(k,M))<k.byteLength&&((ie=k.byteLength-Q)>this._bufferSize&&this._expandBuffer(ie),(re=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(k,Q),0),this._stashUsed+=ie,this._stashByteStart=M+Q)}else{var re,Q;if(this._stashUsed+k.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+k.byteLength),(re=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(k),this._stashUsed),this._stashUsed+=k.byteLength,(Q=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart))<this._stashUsed&&Q>0){var se=new Uint8Array(this._stashBuffer,Q);re.set(se,0)}this._stashUsed-=Q,this._stashByteStart+=Q}}},U.prototype._flushStashBuffer=function(k){if(this._stashUsed>0){var M=this._stashBuffer.slice(0,this._stashUsed),I=this._dispatchChunks(M,this._stashByteStart),j=M.byteLength-I;if(I<M.byteLength){if(!k){if(I>0){var Z=new Uint8Array(this._stashBuffer,0,this._bufferSize),ae=new Uint8Array(M,I);Z.set(ae,0),this._stashUsed=ae.byteLength,this._stashByteStart+=I}return 0}c.a.w(this.TAG,"".concat(j," bytes unconsumed data remain when flush buffer, dropped"))}return this._stashUsed=0,this._stashByteStart=0,j}return 0},U.prototype._onLoaderComplete=function(k,M){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},U.prototype._onLoaderError=function(k,M){switch(c.a.e(this.TAG,"Loader error, code = ".concat(M.code,", msg = ").concat(M.msg)),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,k=f.b.UNRECOVERABLE_EARLY_EOF),k){case f.b.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var I=this._currentRange.to+1;return void(I<this._totalLength&&(c.a.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(I,!1)))}k=f.b.UNRECOVERABLE_EARLY_EOF;break;case f.b.UNRECOVERABLE_EARLY_EOF:case f.b.CONNECTING_TIMEOUT:case f.b.HTTP_STATUS_CODE_INVALID:case f.b.EXCEPTION:}if(!this._onError)throw new m.d("IOException: "+M.msg);this._onError(k,M)},U})();s.a=q},function(t,s,a){var l=(function(){function c(){}return c.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(u,f){return u.__proto__=f,u},Object.assign=Object.assign||function(u){if(u==null)throw new TypeError("Cannot convert undefined or null to object");for(var f=Object(u),d=1;d<arguments.length;d++){var m=arguments[d];if(m!=null)for(var g in m)m.hasOwnProperty(g)&&(f[g]=m[g])}return f},String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(u,f){var d=f>0?0|f:0;return this.substring(d,d+u.length)===u}}),typeof self.Promise!="function"&&a(21).polyfill()},c})();l.install(),s.a=l},function(t,s,a){var l=a(9),c=a.n(l),u=a(0),f=a(5),d=a(7),m=a(3),g=(function(){function y(x){this.TAG="MSEController",this._config=x,this._emitter=new c.a,this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onStartStreaming:this._onStartStreaming.bind(this),onEndStreaming:this._onEndStreaming.bind(this),onQualityChange:this._onQualityChange.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._useManagedMediaSource="ManagedMediaSource"in self&&!("MediaSource"in self),this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElementProxy=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]}}return y.prototype.destroy=function(){this._mediaSource&&this.shutdown(),this._mediaSourceObjectURL&&this.revokeObjectURL(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},y.prototype.on=function(x,v){this._emitter.addListener(x,v)},y.prototype.off=function(x,v){this._emitter.removeListener(x,v)},y.prototype.initialize=function(x){if(this._mediaSource)throw new m.a("MediaSource has been attached to an HTMLMediaElement!");this._useManagedMediaSource&&u.a.v(this.TAG,"Using ManagedMediaSource");var v=this._mediaSource=this._useManagedMediaSource?new self.ManagedMediaSource:new self.MediaSource;v.addEventListener("sourceopen",this.e.onSourceOpen),v.addEventListener("sourceended",this.e.onSourceEnded),v.addEventListener("sourceclose",this.e.onSourceClose),this._useManagedMediaSource&&(v.addEventListener("startstreaming",this.e.onStartStreaming),v.addEventListener("endstreaming",this.e.onEndStreaming),v.addEventListener("qualitychange",this.e.onQualityChange)),this._mediaElementProxy=x},y.prototype.shutdown=function(){if(this._mediaSource){var x=this._mediaSource;for(var v in this._sourceBuffers){var E=this._pendingSegments[v];E.splice(0,E.length),this._pendingSegments[v]=null,this._pendingRemoveRanges[v]=null,this._lastInitSegments[v]=null;var A=this._sourceBuffers[v];if(A){if(x.readyState!=="closed"){try{x.removeSourceBuffer(A)}catch(R){u.a.e(this.TAG,R.message)}A.removeEventListener("error",this.e.onSourceBufferError),A.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[v]=null,this._sourceBuffers[v]=null}}if(x.readyState==="open")try{x.endOfStream()}catch(R){u.a.e(this.TAG,R.message)}this._mediaElementProxy=null,x.removeEventListener("sourceopen",this.e.onSourceOpen),x.removeEventListener("sourceended",this.e.onSourceEnded),x.removeEventListener("sourceclose",this.e.onSourceClose),this._useManagedMediaSource&&(x.removeEventListener("startstreaming",this.e.onStartStreaming),x.removeEventListener("endstreaming",this.e.onEndStreaming),x.removeEventListener("qualitychange",this.e.onQualityChange)),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._mediaSource=null}},y.prototype.isManagedMediaSource=function(){return this._useManagedMediaSource},y.prototype.getObject=function(){if(!this._mediaSource)throw new m.a("MediaSource has not been initialized yet!");return this._mediaSource},y.prototype.getHandle=function(){if(!this._mediaSource)throw new m.a("MediaSource has not been initialized yet!");return this._mediaSource.handle},y.prototype.getObjectURL=function(){if(!this._mediaSource)throw new m.a("MediaSource has not been initialized yet!");return this._mediaSourceObjectURL==null&&(this._mediaSourceObjectURL=URL.createObjectURL(this._mediaSource)),this._mediaSourceObjectURL},y.prototype.revokeObjectURL=function(){this._mediaSourceObjectURL&&(URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},y.prototype.appendInitSegment=function(x,v){if(v===void 0&&(v=void 0),!this._mediaSource||this._mediaSource.readyState!=="open"||this._mediaSource.streaming===!1)return this._pendingSourceBufferInit.push(x),void this._pendingSegments[x.type].push(x);var E=x,A="".concat(E.container);E.codec&&E.codec.length>0&&(E.codec==="opus"&&f.a.safari&&(E.codec="Opus"),A+=";codecs=".concat(E.codec));var R=!1;if(u.a.v(this.TAG,"Received Initialization Segment, mimeType: "+A),this._lastInitSegments[E.type]=E,A!==this._mimeTypes[E.type]){if(this._mimeTypes[E.type])u.a.v(this.TAG,"Notice: ".concat(E.type," mimeType changed, origin: ").concat(this._mimeTypes[E.type],", target: ").concat(A));else{R=!0;try{var D=this._sourceBuffers[E.type]=this._mediaSource.addSourceBuffer(A);D.addEventListener("error",this.e.onSourceBufferError),D.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(L){return u.a.e(this.TAG,L.message),void this._emitter.emit(d.a.ERROR,{code:L.code,msg:L.message})}}this._mimeTypes[E.type]=A}v||this._pendingSegments[E.type].push(E),R||this._sourceBuffers[E.type]&&!this._sourceBuffers[E.type].updating&&this._doAppendSegments(),f.a.safari&&E.container==="audio/mpeg"&&E.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=E.mediaDuration/1e3,this._updateMediaSourceDuration())},y.prototype.appendMediaSegment=function(x){var v=x;this._pendingSegments[v.type].push(v),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var E=this._sourceBuffers[v.type];!E||E.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()},y.prototype.flush=function(){for(var x in this._sourceBuffers)if(this._sourceBuffers[x]){var v=this._sourceBuffers[x];if(this._mediaSource.readyState==="open")try{v.abort()}catch(O){u.a.e(this.TAG,O.message)}var E=this._pendingSegments[x];if(E.splice(0,E.length),this._mediaSource.readyState!=="closed"){for(var A=0;A<v.buffered.length;A++){var R=v.buffered.start(A),D=v.buffered.end(A);this._pendingRemoveRanges[x].push({start:R,end:D})}if(v.updating||this._doRemoveRanges(),f.a.safari){var L=this._lastInitSegments[x];L&&(this._pendingSegments[x].push(L),v.updating||this._doAppendSegments())}}}},y.prototype.endOfStream=function(){var x=this._mediaSource,v=this._sourceBuffers;x&&x.readyState==="open"?v.video&&v.video.updating||v.audio&&v.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,x.endOfStream()):x&&x.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0)},y.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var x=this._mediaElementProxy.getCurrentTime();for(var v in this._sourceBuffers){var E=this._sourceBuffers[v];if(E){var A=E.buffered;if(A.length>=1&&x-A.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},y.prototype._doCleanupSourceBuffer=function(){var x=this._mediaElementProxy.getCurrentTime();for(var v in this._sourceBuffers){var E=this._sourceBuffers[v];if(E){for(var A=E.buffered,R=!1,D=0;D<A.length;D++){var L=A.start(D),O=A.end(D);if(L<=x&&x<O+3){if(x-L>=this._config.autoCleanupMaxBackwardDuration){R=!0;var H=x-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[v].push({start:L,end:H})}}else O<x&&(R=!0,this._pendingRemoveRanges[v].push({start:L,end:O}))}R&&!E.updating&&this._doRemoveRanges()}}},y.prototype._updateMediaSourceDuration=function(){var x=this._sourceBuffers;if(this._mediaElementProxy.getReadyState()!==0&&this._mediaSource.readyState==="open"&&!(x.video&&x.video.updating||x.audio&&x.audio.updating)){var v=this._mediaSource.duration,E=this._pendingMediaDuration;E>0&&(isNaN(v)||E>v)&&(u.a.v(this.TAG,"Update MediaSource duration from ".concat(v," to ").concat(E)),this._mediaSource.duration=E),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},y.prototype._doRemoveRanges=function(){for(var x in this._pendingRemoveRanges)if(this._sourceBuffers[x]&&!this._sourceBuffers[x].updating)for(var v=this._sourceBuffers[x],E=this._pendingRemoveRanges[x];E.length&&!v.updating;){var A=E.shift();v.remove(A.start,A.end)}},y.prototype._doAppendSegments=function(){var x=this._pendingSegments;for(var v in x)if(this._sourceBuffers[v]&&!this._sourceBuffers[v].updating&&this._mediaSource.streaming!==!1&&x[v].length>0){var E=x[v].shift();if(typeof E.timestampOffset=="number"&&isFinite(E.timestampOffset)){var A=this._sourceBuffers[v].timestampOffset,R=E.timestampOffset/1e3;Math.abs(A-R)>.1&&(u.a.v(this.TAG,"Update MPEG audio timestampOffset from ".concat(A," to ").concat(R)),this._sourceBuffers[v].timestampOffset=R),delete E.timestampOffset}if(!E.data||E.data.byteLength===0)continue;try{this._sourceBuffers[v].appendBuffer(E.data),this._isBufferFull=!1}catch(D){this._pendingSegments[v].unshift(E),D.code===22?(this._isBufferFull||this._emitter.emit(d.a.BUFFER_FULL),this._isBufferFull=!0):(u.a.e(this.TAG,D.message),this._emitter.emit(d.a.ERROR,{code:D.code,msg:D.message}))}}},y.prototype._onSourceOpen=function(){if(u.a.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var x=this._pendingSourceBufferInit;x.length;){var v=x.shift();this.appendInitSegment(v,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(d.a.SOURCE_OPEN)},y.prototype._onStartStreaming=function(){u.a.v(this.TAG,"ManagedMediaSource onStartStreaming"),this._emitter.emit(d.a.START_STREAMING)},y.prototype._onEndStreaming=function(){u.a.v(this.TAG,"ManagedMediaSource onEndStreaming"),this._emitter.emit(d.a.END_STREAMING)},y.prototype._onQualityChange=function(){u.a.v(this.TAG,"ManagedMediaSource onQualityChange")},y.prototype._onSourceEnded=function(){u.a.v(this.TAG,"MediaSource onSourceEnded")},y.prototype._onSourceClose=function(){u.a.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose),this._useManagedMediaSource&&(this._mediaSource.removeEventListener("startstreaming",this.e.onStartStreaming),this._mediaSource.removeEventListener("endstreaming",this.e.onEndStreaming),this._mediaSource.removeEventListener("qualitychange",this.e.onQualityChange)))},y.prototype._hasPendingSegments=function(){var x=this._pendingSegments;return x.video.length>0||x.audio.length>0},y.prototype._hasPendingRemoveRanges=function(){var x=this._pendingRemoveRanges;return x.video.length>0||x.audio.length>0},y.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(d.a.UPDATE_END)},y.prototype._onSourceBufferError=function(x){u.a.e(this.TAG,"SourceBuffer Error: ".concat(x))},y})();s.a=g},function(t,s,a){var l=a(9),c=a.n(l),u=a(18),f=a.n(u),d=a(0),m=a(8),g=a(13),y=a(1),x=(a(19),a(12)),v=(function(){function E(A,R){if(this.TAG="Transmuxer",this._emitter=new c.a,R.enableWorker&&typeof Worker<"u")try{this._worker=f()(19),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[A,R]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},m.a.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:m.a.getConfig()})}catch{d.a.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new g.a(A,R)}else this._controller=new g.a(A,R);if(this._controller){var D=this._controller;D.on(y.a.IO_ERROR,this._onIOError.bind(this)),D.on(y.a.DEMUX_ERROR,this._onDemuxError.bind(this)),D.on(y.a.INIT_SEGMENT,this._onInitSegment.bind(this)),D.on(y.a.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),D.on(y.a.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),D.on(y.a.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),D.on(y.a.MEDIA_INFO,this._onMediaInfo.bind(this)),D.on(y.a.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),D.on(y.a.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),D.on(y.a.TIMED_ID3_METADATA_ARRIVED,this._onTimedID3MetadataArrived.bind(this)),D.on(y.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,this._onSynchronousKLVMetadataArrived.bind(this)),D.on(y.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,this._onAsynchronousKLVMetadataArrived.bind(this)),D.on(y.a.SMPTE2038_METADATA_ARRIVED,this._onSMPTE2038MetadataArrived.bind(this)),D.on(y.a.SCTE35_METADATA_ARRIVED,this._onSCTE35MetadataArrived.bind(this)),D.on(y.a.PES_PRIVATE_DATA_DESCRIPTOR,this._onPESPrivateDataDescriptor.bind(this)),D.on(y.a.PES_PRIVATE_DATA_ARRIVED,this._onPESPrivateDataArrived.bind(this)),D.on(y.a.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),D.on(y.a.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return E.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),m.a.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},E.prototype.on=function(A,R){this._emitter.addListener(A,R)},E.prototype.off=function(A,R){this._emitter.removeListener(A,R)},E.prototype.hasWorker=function(){return this._worker!=null},E.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},E.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},E.prototype.seek=function(A){this._worker?this._worker.postMessage({cmd:"seek",param:A}):this._controller.seek(A)},E.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},E.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},E.prototype._onInitSegment=function(A,R){var D=this;Promise.resolve().then((function(){D._emitter.emit(y.a.INIT_SEGMENT,A,R)}))},E.prototype._onMediaSegment=function(A,R){var D=this;Promise.resolve().then((function(){D._emitter.emit(y.a.MEDIA_SEGMENT,A,R)}))},E.prototype._onLoadingComplete=function(){var A=this;Promise.resolve().then((function(){A._emitter.emit(y.a.LOADING_COMPLETE)}))},E.prototype._onRecoveredEarlyEof=function(){var A=this;Promise.resolve().then((function(){A._emitter.emit(y.a.RECOVERED_EARLY_EOF)}))},E.prototype._onMediaInfo=function(A){var R=this;Promise.resolve().then((function(){R._emitter.emit(y.a.MEDIA_INFO,A)}))},E.prototype._onMetaDataArrived=function(A){var R=this;Promise.resolve().then((function(){R._emitter.emit(y.a.METADATA_ARRIVED,A)}))},E.prototype._onScriptDataArrived=function(A){var R=this;Promise.resolve().then((function(){R._emitter.emit(y.a.SCRIPTDATA_ARRIVED,A)}))},E.prototype._onTimedID3MetadataArrived=function(A){var R=this;Promise.resolve().then((function(){R._emitter.emit(y.a.TIMED_ID3_METADATA_ARRIVED,A)}))},E.prototype._onSynchronousKLVMetadataArrived=function(A){var R=this;Promise.resolve().then((function(){R._emitter.emit(y.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,A)}))},E.prototype._onAsynchronousKLVMetadataArrived=function(A){var R=this;Promise.resolve().then((function(){R._emitter.emit(y.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,A)}))},E.prototype._onSMPTE2038MetadataArrived=function(A){var R=this;Promise.resolve().then((function(){R._emitter.emit(y.a.SMPTE2038_METADATA_ARRIVED,A)}))},E.prototype._onSCTE35MetadataArrived=function(A){var R=this;Promise.resolve().then((function(){R._emitter.emit(y.a.SCTE35_METADATA_ARRIVED,A)}))},E.prototype._onPESPrivateDataDescriptor=function(A){var R=this;Promise.resolve().then((function(){R._emitter.emit(y.a.PES_PRIVATE_DATA_DESCRIPTOR,A)}))},E.prototype._onPESPrivateDataArrived=function(A){var R=this;Promise.resolve().then((function(){R._emitter.emit(y.a.PES_PRIVATE_DATA_ARRIVED,A)}))},E.prototype._onStatisticsInfo=function(A){var R=this;Promise.resolve().then((function(){R._emitter.emit(y.a.STATISTICS_INFO,A)}))},E.prototype._onIOError=function(A,R){var D=this;Promise.resolve().then((function(){D._emitter.emit(y.a.IO_ERROR,A,R)}))},E.prototype._onDemuxError=function(A,R){var D=this;Promise.resolve().then((function(){D._emitter.emit(y.a.DEMUX_ERROR,A,R)}))},E.prototype._onRecommendSeekpoint=function(A){var R=this;Promise.resolve().then((function(){R._emitter.emit(y.a.RECOMMEND_SEEKPOINT,A)}))},E.prototype._onLoggingConfigChanged=function(A){this._worker&&this._worker.postMessage({cmd:"logging_config",param:A})},E.prototype._onWorkerMessage=function(A){var R=A.data,D=R.data;if(R.msg==="destroyed"||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(R.msg){case y.a.INIT_SEGMENT:case y.a.MEDIA_SEGMENT:this._emitter.emit(R.msg,D.type,D.data);break;case y.a.LOADING_COMPLETE:case y.a.RECOVERED_EARLY_EOF:this._emitter.emit(R.msg);break;case y.a.MEDIA_INFO:Object.setPrototypeOf(D,x.a.prototype),this._emitter.emit(R.msg,D);break;case y.a.METADATA_ARRIVED:case y.a.SCRIPTDATA_ARRIVED:case y.a.TIMED_ID3_METADATA_ARRIVED:case y.a.SYNCHRONOUS_KLV_METADATA_ARRIVED:case y.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED:case y.a.SMPTE2038_METADATA_ARRIVED:case y.a.SCTE35_METADATA_ARRIVED:case y.a.PES_PRIVATE_DATA_DESCRIPTOR:case y.a.PES_PRIVATE_DATA_ARRIVED:case y.a.STATISTICS_INFO:this._emitter.emit(R.msg,D);break;case y.a.IO_ERROR:case y.a.DEMUX_ERROR:this._emitter.emit(R.msg,D.type,D.info);break;case y.a.RECOMMEND_SEEKPOINT:this._emitter.emit(R.msg,D);break;case"logcat_callback":d.a.emitter.emit("log",D.type,D.logcat)}},E})();s.a=v},function(t,s,a){function l(d){var m={};function g(x){if(m[x])return m[x].exports;var v=m[x]={i:x,l:!1,exports:{}};return d[x].call(v.exports,v,v.exports,g),v.l=!0,v.exports}g.m=d,g.c=m,g.i=function(x){return x},g.d=function(x,v,E){g.o(x,v)||Object.defineProperty(x,v,{configurable:!1,enumerable:!0,get:E})},g.r=function(x){Object.defineProperty(x,"__esModule",{value:!0})},g.n=function(x){var v=x&&x.__esModule?function(){return x.default}:function(){return x};return g.d(v,"a",v),v},g.o=function(x,v){return Object.prototype.hasOwnProperty.call(x,v)},g.p="/",g.oe=function(x){throw console.error(x),x};var y=g(g.s=ENTRY_MODULE);return y.default||y}function c(d){return(d+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function u(d,m,g){var y={};y[g]=[];var x=m.toString(),v=x.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!v)return y;for(var E,A=v[1],R=new RegExp("(\\\\n|\\W)"+c(A)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");E=R.exec(x);)E[3]!=="dll-reference"&&y[g].push(E[3]);for(R=new RegExp("\\("+c(A)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");E=R.exec(x);)d[E[2]]||(y[g].push(E[1]),d[E[2]]=a(E[1]).m),y[E[2]]=y[E[2]]||[],y[E[2]].push(E[4]);for(var D,L=Object.keys(y),O=0;O<L.length;O++)for(var H=0;H<y[L[O]].length;H++)D=y[L[O]][H],isNaN(1*D)||(y[L[O]][H]=1*y[L[O]][H]);return y}function f(d){return Object.keys(d).reduce((function(m,g){return m||d[g].length>0}),!1)}t.exports=function(d,m){m=m||{};var g={main:a.m},y=m.all?{main:Object.keys(g.main)}:(function(R,D){for(var L={main:[D]},O={main:[]},H={main:{}};f(L);)for(var q=Object.keys(L),U=0;U<q.length;U++){var k=q[U],M=L[k].pop();if(H[k]=H[k]||{},!H[k][M]&&R[k][M]){H[k][M]=!0,O[k]=O[k]||[],O[k].push(M);for(var I=u(R,R[k][M],k),j=Object.keys(I),Z=0;Z<j.length;Z++)L[j[Z]]=L[j[Z]]||[],L[j[Z]]=L[j[Z]].concat(I[j[Z]])}}return O})(g,d),x="";Object.keys(y).filter((function(R){return R!=="main"})).forEach((function(R){for(var D=0;y[R][D];)D++;y[R].push(D),g[R][D]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",x=x+"var "+R+" = ("+l.toString().replace("ENTRY_MODULE",JSON.stringify(D))+")({"+y[R].map((function(L){return JSON.stringify(L)+": "+g[R][L].toString()})).join(",")+`});
`})),x=x+"new (("+l.toString().replace("ENTRY_MODULE",JSON.stringify(d))+")({"+y.main.map((function(R){return JSON.stringify(R)+": "+g.main[R].toString()})).join(",")+"}))(self);";var v=new self.Blob([x],{type:"text/javascript"});if(m.bare)return v;var E=(self.URL||self.webkitURL||self.mozURL||self.msURL).createObjectURL(v),A=new self.Worker(E);return A.objectURL=E,A}},function(t,s,a){a.r(s),a(0);var l=a(8),c=a(15),u=a(13),f=a(1);s.default=function(d){var m=null,g=(function(ie,re){d.postMessage({msg:"logcat_callback",data:{type:ie,logcat:re}})}).bind(this);function y(ie,re){var Q={msg:f.a.INIT_SEGMENT,data:{type:ie,data:re}};d.postMessage(Q,[re.data])}function x(ie,re){var Q={msg:f.a.MEDIA_SEGMENT,data:{type:ie,data:re}};d.postMessage(Q,[re.data])}function v(){var ie={msg:f.a.LOADING_COMPLETE};d.postMessage(ie)}function E(){var ie={msg:f.a.RECOVERED_EARLY_EOF};d.postMessage(ie)}function A(ie){var re={msg:f.a.MEDIA_INFO,data:ie};d.postMessage(re)}function R(ie){var re={msg:f.a.METADATA_ARRIVED,data:ie};d.postMessage(re)}function D(ie){var re={msg:f.a.SCRIPTDATA_ARRIVED,data:ie};d.postMessage(re)}function L(ie){var re={msg:f.a.TIMED_ID3_METADATA_ARRIVED,data:ie};d.postMessage(re)}function O(ie){var re={msg:f.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,data:ie};d.postMessage(re)}function H(ie){var re={msg:f.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,data:ie};d.postMessage(re)}function q(ie){var re={msg:f.a.SMPTE2038_METADATA_ARRIVED,data:ie};d.postMessage(re)}function U(ie){var re={msg:f.a.SCTE35_METADATA_ARRIVED,data:ie};d.postMessage(re)}function k(ie){var re={msg:f.a.PES_PRIVATE_DATA_DESCRIPTOR,data:ie};d.postMessage(re)}function M(ie){var re={msg:f.a.PES_PRIVATE_DATA_ARRIVED,data:ie};d.postMessage(re)}function I(ie){var re={msg:f.a.STATISTICS_INFO,data:ie};d.postMessage(re)}function j(ie,re){d.postMessage({msg:f.a.IO_ERROR,data:{type:ie,info:re}})}function Z(ie,re){d.postMessage({msg:f.a.DEMUX_ERROR,data:{type:ie,info:re}})}function ae(ie){d.postMessage({msg:f.a.RECOMMEND_SEEKPOINT,data:ie})}c.a.install(),d.addEventListener("message",(function(ie){switch(ie.data.cmd){case"init":(m=new u.a(ie.data.param[0],ie.data.param[1])).on(f.a.IO_ERROR,j.bind(this)),m.on(f.a.DEMUX_ERROR,Z.bind(this)),m.on(f.a.INIT_SEGMENT,y.bind(this)),m.on(f.a.MEDIA_SEGMENT,x.bind(this)),m.on(f.a.LOADING_COMPLETE,v.bind(this)),m.on(f.a.RECOVERED_EARLY_EOF,E.bind(this)),m.on(f.a.MEDIA_INFO,A.bind(this)),m.on(f.a.METADATA_ARRIVED,R.bind(this)),m.on(f.a.SCRIPTDATA_ARRIVED,D.bind(this)),m.on(f.a.TIMED_ID3_METADATA_ARRIVED,L.bind(this)),m.on(f.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,O.bind(this)),m.on(f.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,H.bind(this)),m.on(f.a.SMPTE2038_METADATA_ARRIVED,q.bind(this)),m.on(f.a.SCTE35_METADATA_ARRIVED,U.bind(this)),m.on(f.a.PES_PRIVATE_DATA_DESCRIPTOR,k.bind(this)),m.on(f.a.PES_PRIVATE_DATA_ARRIVED,M.bind(this)),m.on(f.a.STATISTICS_INFO,I.bind(this)),m.on(f.a.RECOMMEND_SEEKPOINT,ae.bind(this));break;case"destroy":m&&(m.destroy(),m=null),d.postMessage({msg:"destroyed"});break;case"start":m.start();break;case"stop":m.stop();break;case"seek":m.seek(ie.data.param);break;case"pause":m.pause();break;case"resume":m.resume();break;case"logging_config":var re=ie.data.param;l.a.applyConfig(re),re.enableCallback===!0?l.a.addLogListener(g):l.a.removeLogListener(g)}}))}},function(t,s,a){t.exports=a(25).default},function(t,s,a){(function(l,c){var u;u=function(){function f(ee){return typeof ee=="function"}var d=Array.isArray?Array.isArray:function(ee){return Object.prototype.toString.call(ee)==="[object Array]"},m=0,g=void 0,y=void 0,x=function(ee,ye){O[m]=ee,O[m+1]=ye,(m+=2)===2&&(y?y(H):I())},v=typeof window<"u"?window:void 0,E=v||{},A=E.MutationObserver||E.WebKitMutationObserver,R=typeof self>"u"&&l!==void 0&&{}.toString.call(l)==="[object process]",D=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function L(){var ee=setTimeout;return function(){return ee(H,1)}}var O=new Array(1e3);function H(){for(var ee=0;ee<m;ee+=2)(0,O[ee])(O[ee+1]),O[ee]=void 0,O[ee+1]=void 0;m=0}var q,U,k,M,I=void 0;function j(ee,ye){var Ie=this,Ue=new this.constructor(ie);Ue[ae]===void 0&&ve(Ue);var qe=Ie._state;if(qe){var ue=arguments[qe-1];x((function(){return X(qe,Ue,ue,Ie._result)}))}else V(Ie,Ue,ee,ye);return Ue}function Z(ee){if(ee&&typeof ee=="object"&&ee.constructor===this)return ee;var ye=new this(ie);return Q(ye,ee),ye}R?I=function(){return l.nextTick(H)}:A?(U=0,k=new A(H),M=document.createTextNode(""),k.observe(M,{characterData:!0}),I=function(){M.data=U=++U%2}):D?((q=new MessageChannel).port1.onmessage=H,I=function(){return q.port2.postMessage(0)}):I=v===void 0?(function(){try{var ee=Function("return this")().require("vertx");return(g=ee.runOnLoop||ee.runOnContext)!==void 0?function(){g(H)}:L()}catch{return L()}})():L();var ae=Math.random().toString(36).substring(2);function ie(){}function re(ee,ye,Ie){ye.constructor===ee.constructor&&Ie===j&&ye.constructor.resolve===Z?(function(Ue,qe){qe._state===1?oe(Ue,qe._result):qe._state===2?Y(Ue,qe._result):V(qe,void 0,(function(ue){return Q(Ue,ue)}),(function(ue){return Y(Ue,ue)}))})(ee,ye):Ie===void 0?oe(ee,ye):f(Ie)?(function(Ue,qe,ue){x((function(Be){var Ge=!1,yt=(function(He,dt,Ot,ns){try{He.call(dt,Ot,ns)}catch(os){return os}})(ue,qe,(function(He){Ge||(Ge=!0,qe!==He?Q(Be,He):oe(Be,He))}),(function(He){Ge||(Ge=!0,Y(Be,He))}),Be._label);!Ge&&yt&&(Ge=!0,Y(Be,yt))}),Ue)})(ee,ye,Ie):oe(ee,ye)}function Q(ee,ye){if(ee===ye)Y(ee,new TypeError("You cannot resolve a promise with itself"));else if(qe=typeof(Ue=ye),Ue===null||qe!=="object"&&qe!=="function")oe(ee,ye);else{var Ie=void 0;try{Ie=ye.then}catch(ue){return void Y(ee,ue)}re(ee,ye,Ie)}var Ue,qe}function se(ee){ee._onerror&&ee._onerror(ee._result),$(ee)}function oe(ee,ye){ee._state===void 0&&(ee._result=ye,ee._state=1,ee._subscribers.length!==0&&x($,ee))}function Y(ee,ye){ee._state===void 0&&(ee._state=2,ee._result=ye,x(se,ee))}function V(ee,ye,Ie,Ue){var qe=ee._subscribers,ue=qe.length;ee._onerror=null,qe[ue]=ye,qe[ue+1]=Ie,qe[ue+2]=Ue,ue===0&&ee._state&&x($,ee)}function $(ee){var ye=ee._subscribers,Ie=ee._state;if(ye.length!==0){for(var Ue=void 0,qe=void 0,ue=ee._result,Be=0;Be<ye.length;Be+=3)Ue=ye[Be],qe=ye[Be+Ie],Ue?X(Ie,Ue,qe,ue):qe(ue);ee._subscribers.length=0}}function X(ee,ye,Ie,Ue){var qe=f(Ie),ue=void 0,Be=void 0,Ge=!0;if(qe){try{ue=Ie(Ue)}catch(yt){Ge=!1,Be=yt}if(ye===ue)return void Y(ye,new TypeError("A promises callback cannot return that same promise."))}else ue=Ue;ye._state!==void 0||(qe&&Ge?Q(ye,ue):Ge===!1?Y(ye,Be):ee===1?oe(ye,ue):ee===2&&Y(ye,ue))}var me=0;function ve(ee){ee[ae]=me++,ee._state=void 0,ee._result=void 0,ee._subscribers=[]}var pe=(function(){function ee(ye,Ie){this._instanceConstructor=ye,this.promise=new ye(ie),this.promise[ae]||ve(this.promise),d(Ie)?(this.length=Ie.length,this._remaining=Ie.length,this._result=new Array(this.length),this.length===0?oe(this.promise,this._result):(this.length=this.length||0,this._enumerate(Ie),this._remaining===0&&oe(this.promise,this._result))):Y(this.promise,new Error("Array Methods must be provided an Array"))}return ee.prototype._enumerate=function(ye){for(var Ie=0;this._state===void 0&&Ie<ye.length;Ie++)this._eachEntry(ye[Ie],Ie)},ee.prototype._eachEntry=function(ye,Ie){var Ue=this._instanceConstructor,qe=Ue.resolve;if(qe===Z){var ue=void 0,Be=void 0,Ge=!1;try{ue=ye.then}catch(He){Ge=!0,Be=He}if(ue===j&&ye._state!==void 0)this._settledAt(ye._state,Ie,ye._result);else if(typeof ue!="function")this._remaining--,this._result[Ie]=ye;else if(Ue===ge){var yt=new Ue(ie);Ge?Y(yt,Be):re(yt,ye,ue),this._willSettleAt(yt,Ie)}else this._willSettleAt(new Ue((function(He){return He(ye)})),Ie)}else this._willSettleAt(qe(ye),Ie)},ee.prototype._settledAt=function(ye,Ie,Ue){var qe=this.promise;qe._state===void 0&&(this._remaining--,ye===2?Y(qe,Ue):this._result[Ie]=Ue),this._remaining===0&&oe(qe,this._result)},ee.prototype._willSettleAt=function(ye,Ie){var Ue=this;V(ye,void 0,(function(qe){return Ue._settledAt(1,Ie,qe)}),(function(qe){return Ue._settledAt(2,Ie,qe)}))},ee})(),ge=(function(){function ee(ye){this[ae]=me++,this._result=this._state=void 0,this._subscribers=[],ie!==ye&&(typeof ye!="function"&&(function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")})(),this instanceof ee?(function(Ie,Ue){try{Ue((function(qe){Q(Ie,qe)}),(function(qe){Y(Ie,qe)}))}catch(qe){Y(Ie,qe)}})(this,ye):(function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")})())}return ee.prototype.catch=function(ye){return this.then(null,ye)},ee.prototype.finally=function(ye){var Ie=this.constructor;return f(ye)?this.then((function(Ue){return Ie.resolve(ye()).then((function(){return Ue}))}),(function(Ue){return Ie.resolve(ye()).then((function(){throw Ue}))})):this.then(ye,ye)},ee})();return ge.prototype.then=j,ge.all=function(ee){return new pe(this,ee).promise},ge.race=function(ee){var ye=this;return d(ee)?new ye((function(Ie,Ue){for(var qe=ee.length,ue=0;ue<qe;ue++)ye.resolve(ee[ue]).then(Ie,Ue)})):new ye((function(Ie,Ue){return Ue(new TypeError("You must pass an array to race."))}))},ge.resolve=Z,ge.reject=function(ee){var ye=new this(ie);return Y(ye,ee),ye},ge._setScheduler=function(ee){y=ee},ge._setAsap=function(ee){x=ee},ge._asap=x,ge.polyfill=function(){var ee=void 0;if(c!==void 0)ee=c;else if(typeof self<"u")ee=self;else try{ee=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var ye=ee.Promise;if(ye){var Ie=null;try{Ie=Object.prototype.toString.call(ye.resolve())}catch{}if(Ie==="[object Promise]"&&!ye.cast)return}ee.Promise=ge},ge.Promise=ge,ge},t.exports=u()}).call(this,a(22),a(23))},function(t,s){var a,l,c=t.exports={};function u(){throw new Error("setTimeout has not been defined")}function f(){throw new Error("clearTimeout has not been defined")}function d(D){if(a===setTimeout)return setTimeout(D,0);if((a===u||!a)&&setTimeout)return a=setTimeout,setTimeout(D,0);try{return a(D,0)}catch{try{return a.call(null,D,0)}catch{return a.call(this,D,0)}}}(function(){try{a=typeof setTimeout=="function"?setTimeout:u}catch{a=u}try{l=typeof clearTimeout=="function"?clearTimeout:f}catch{l=f}})();var m,g=[],y=!1,x=-1;function v(){y&&m&&(y=!1,m.length?g=m.concat(g):x=-1,g.length&&E())}function E(){if(!y){var D=d(v);y=!0;for(var L=g.length;L;){for(m=g,g=[];++x<L;)m&&m[x].run();x=-1,L=g.length}m=null,y=!1,(function(O){if(l===clearTimeout)return clearTimeout(O);if((l===f||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(O);try{l(O)}catch{try{return l.call(null,O)}catch{return l.call(this,O)}}})(D)}}function A(D,L){this.fun=D,this.array=L}function R(){}c.nextTick=function(D){var L=new Array(arguments.length-1);if(arguments.length>1)for(var O=1;O<arguments.length;O++)L[O-1]=arguments[O];g.push(new A(D,L)),g.length!==1||y||d(E)},A.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=R,c.addListener=R,c.once=R,c.off=R,c.removeListener=R,c.removeAllListeners=R,c.emit=R,c.prependListener=R,c.prependOnceListener=R,c.listeners=function(D){return[]},c.binding=function(D){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(D){throw new Error("process.chdir is not supported")},c.umask=function(){return 0}},function(t,s){var a;a=(function(){return this})();try{a=a||new Function("return this")()}catch{typeof window=="object"&&(a=window)}t.exports=a},function(t,s,a){a.r(s);var l=a(0),c=a(8),u=a(3),f=a(7),d=a(16),m=a(17),g=a(1),y=a(4),x=a(10);s.default=function(v){var E="PlayerEngineWorker",A=(function(Y,V){v.postMessage({msg:"logcat_callback",type:Y,logcat:V})}).bind(void 0),R=null,D=null,L=null,O=null,H=!1,q=!1,U=0,k=0,M=!1;function I(){L&&(L.shutdown(),L.destroy(),L=null)}function j(){if(R==null||D==null)throw new u.a("Worker not initialized");if(O)throw new u.a("Transmuxer has been initialized");q||(!D.deferLoadAfterSourceOpen||H?((O=new m.a(R,D)).on(g.a.INIT_SEGMENT,(function(Y,V){L.appendInitSegment(V)})),O.on(g.a.MEDIA_SEGMENT,(function(Y,V){L.appendMediaSegment(V),v.postMessage({msg:"buffered_position_changed",buffered_position_milliseconds:V.info.endDts})})),O.on(g.a.LOADING_COMPLETE,(function(){L.endOfStream(),v.postMessage({msg:"player_event",event:y.a.LOADING_COMPLETE})})),O.on(g.a.RECOVERED_EARLY_EOF,(function(){v.postMessage({msg:"player_event",event:y.a.RECOVERED_EARLY_EOF})})),O.on(g.a.IO_ERROR,(function(Y,V){v.postMessage({msg:"player_event",event:y.a.ERROR,error_type:x.b.NETWORK_ERROR,error_detail:Y,info:V})})),O.on(g.a.DEMUX_ERROR,(function(Y,V){v.postMessage({msg:"player_event",event:y.a.ERROR,error_type:x.b.MEDIA_ERROR,error_detail:Y,info:V})})),O.on(g.a.MEDIA_INFO,(function(Y){se(g.a.MEDIA_INFO,Y)})),O.on(g.a.STATISTICS_INFO,(function(Y){se(g.a.STATISTICS_INFO,Y)})),O.on(g.a.RECOMMEND_SEEKPOINT,(function(Y){(function(V){v.postMessage({msg:"transmuxing_event",event:g.a.RECOMMEND_SEEKPOINT,milliseconds:V})})(Y)})),O.on(g.a.METADATA_ARRIVED,(function(Y){oe(y.a.METADATA_ARRIVED,Y)})),O.on(g.a.SCRIPTDATA_ARRIVED,(function(Y){oe(y.a.SCRIPTDATA_ARRIVED,Y)})),O.on(g.a.TIMED_ID3_METADATA_ARRIVED,(function(Y){oe(y.a.TIMED_ID3_METADATA_ARRIVED,Y)})),O.on(g.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,(function(Y){oe(y.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,Y)})),O.on(g.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,(function(Y){oe(y.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,Y)})),O.on(g.a.SMPTE2038_METADATA_ARRIVED,(function(Y){oe(y.a.SMPTE2038_METADATA_ARRIVED,Y)})),O.on(g.a.SCTE35_METADATA_ARRIVED,(function(Y){oe(y.a.SCTE35_METADATA_ARRIVED,Y)})),O.on(g.a.PES_PRIVATE_DATA_DESCRIPTOR,(function(Y){oe(y.a.PES_PRIVATE_DATA_DESCRIPTOR,Y)})),O.on(g.a.PES_PRIVATE_DATA_ARRIVED,(function(Y){oe(y.a.PES_PRIVATE_DATA_ARRIVED,Y)})),O.open()):q=!0)}function Z(){L&&L.flush(),O&&(O.close(),O.destroy(),O=null)}function ae(){H=!0,q&&(q=!1,j())}function ie(){v.postMessage({msg:"mse_event",event:f.a.UPDATE_END})}function re(){l.a.v(E,"MSE SourceBuffer is full, report to main thread"),v.postMessage({msg:"mse_event",event:f.a.BUFFER_FULL})}function Q(Y){v.postMessage({msg:"player_event",event:y.a.ERROR,error_type:x.b.MEDIA_ERROR,error_detail:x.b.MEDIA_MSE_ERROR,info:Y})}function se(Y,V){v.postMessage({msg:"transmuxing_event",event:Y,info:V})}function oe(Y,V){v.postMessage({msg:"player_event",event:Y,extraData:V})}v.addEventListener("message",(function(Y){if(!M){var V=Y.data;switch(V.cmd){case"logging_config":var $=V;c.a.applyConfig($.logging_config),$.logging_config.enableCallback===!0?c.a.addLogListener(A):c.a.removeLogListener(A);break;case"init":R=($=V).media_data_source,D=$.config;break;case"destroy":(function(){O&&Z(),L&&I(),M=!0,v.postMessage({msg:"destroyed"})})();break;case"initialize_mse":(function(){l.a.v(E,"Initializing MediaSource in DedicatedWorker"),(L=new d.a(D)).on(f.a.SOURCE_OPEN,ae.bind(this)),L.on(f.a.UPDATE_END,ie.bind(this)),L.on(f.a.BUFFER_FULL,re.bind(this)),L.on(f.a.ERROR,Q.bind(this)),L.initialize({getCurrentTime:function(){return U},getReadyState:function(){return k}});var X=L.getHandle();v.postMessage({msg:"mse_init",handle:X},[X])})();break;case"shutdown_mse":I();break;case"load":j();break;case"unload":Z();break;case"unbuffered_seek":$=V,L.flush(),O.seek($.milliseconds);break;case"timeupdate":U=($=V).current_time;break;case"readystatechange":k=($=V).ready_state;break;case"pause_transmuxer":O.pause();break;case"resume_transmuxer":O.resume()}}}))}},function(t,s,a){a.r(s);var l=a(15),c=a(14),u={enableWorker:!1,enableWorkerForMSE:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,liveBufferLatencyChasing:!1,liveBufferLatencyChasingOnPaused:!1,liveBufferLatencyMaxLatency:1.5,liveBufferLatencyMinRemain:.5,liveSync:!1,liveSyncMaxLatency:1.2,liveSyncTargetLatency:.8,liveSyncPlaybackRate:1.2,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function f(){return Object.assign({},u)}var d=(function(){function Y(){}return Y.supportMSEH264Playback=function(){var V=self.MediaSource&&self.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),$=self.ManagedMediaSource&&self.ManagedMediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');return V||$},Y.supportMSEH265Playback=function(){var V=self.MediaSource&&self.MediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"'),$=self.ManagedMediaSource&&self.ManagedMediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"');return V||$},Y.supportNetworkStreamIO=function(){var V=new c.a({},f()),$=V.loaderType;return V.destroy(),$=="fetch-stream-loader"||$=="xhr-moz-chunked-loader"},Y.getNetworkLoaderTypeName=function(){var V=new c.a({},f()),$=V.loaderType;return V.destroy(),$},Y.supportNativeMediaPlayback=function(V){Y.videoElement==null&&(Y.videoElement=window.document.createElement("video"));var $=Y.videoElement.canPlayType(V);return $==="probably"||$=="maybe"},Y.getFeatureList=function(){var V={msePlayback:!1,mseLivePlayback:!1,mseH265Playback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeMP4H265Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return V.msePlayback=Y.supportMSEH264Playback(),V.networkStreamIO=Y.supportNetworkStreamIO(),V.networkLoaderName=Y.getNetworkLoaderTypeName(),V.mseLivePlayback=V.msePlayback&&V.networkStreamIO,V.mseH265Playback=Y.supportMSEH265Playback(),V.nativeMP4H264Playback=Y.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),V.nativeMP4H265Playback=Y.supportNativeMediaPlayback('video/mp4; codecs="hvc1.1.6.L93.B0"'),V.nativeWebmVP8Playback=Y.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),V.nativeWebmVP9Playback=Y.supportNativeMediaPlayback('video/webm; codecs="vp9"'),V},Y})(),m=a(2),g=a(0),y=a(9),x=a.n(y),v=a(16),E=a(4),A=a(17),R=a(7),D=a(10),L=a(3),O=a(1),H=a(5),q=a(11),U=(function(){function Y(V,$,X){this.TAG="SeekingHandler",this._config=null,this._media_element=null,this._always_seek_keyframe=!1,this._on_unbuffered_seek=null,this._request_set_current_time=!1,this._seek_request_record_clocktime=null,this._idr_sample_list=new q.a,this.e=null,this._config=V,this._media_element=$,this._on_unbuffered_seek=X,this.e={onMediaSeeking:this._onMediaSeeking.bind(this)};var me=H.a.chrome&&(H.a.version.major<50||H.a.version.major===50&&H.a.version.build<2661);this._always_seek_keyframe=!!(me||H.a.msedge||H.a.msie),this._always_seek_keyframe&&(this._config.accurateSeek=!1),this._media_element.addEventListener("seeking",this.e.onMediaSeeking)}return Y.prototype.destroy=function(){this._idr_sample_list.clear(),this._idr_sample_list=null,this._media_element.removeEventListener("seeking",this.e.onMediaSeeking),this._media_element=null,this._on_unbuffered_seek=null},Y.prototype.seek=function(V){var $=this._isPositionBuffered(V),X=!1;if(V<1&&this._media_element.buffered.length>0){var me=this._media_element.buffered.start(0);(me<1&&V<me||H.a.safari)&&(X=!0,V=H.a.safari?.1:me)}if(X)this.directSeek(V);else if($)if(this._always_seek_keyframe){var ve=this._getNearestKeyframe(Math.floor(1e3*V));ve!=null&&(V=ve.dts/1e3),this.directSeek(V)}else this.directSeek(V);else this._idr_sample_list.clear(),this._on_unbuffered_seek(Math.floor(1e3*V)),this._config.accurateSeek&&this.directSeek(V)},Y.prototype.directSeek=function(V){this._request_set_current_time=!0,this._media_element.currentTime=V},Y.prototype.appendSyncPoints=function(V){this._idr_sample_list.appendArray(V)},Y.prototype._onMediaSeeking=function(V){if(this._request_set_current_time)this._request_set_current_time=!1;else{var $=this._media_element.currentTime,X=this._media_element.buffered;if($<1&&X.length>0){var me=X.start(0);if(me<1&&$<me||H.a.safari){var ve=H.a.safari?.1:me;return void this.directSeek(ve)}}if(this._isPositionBuffered($)){if(this._always_seek_keyframe){var pe=this._getNearestKeyframe(Math.floor(1e3*$));pe!=null&&($=pe.dts/1e3,this.directSeek($))}}else this._seek_request_record_clocktime=Y._getClockTime(),window.setTimeout(this._pollAndApplyUnbufferedSeek.bind(this),50)}},Y.prototype._pollAndApplyUnbufferedSeek=function(){if(this._seek_request_record_clocktime!=null)if(this._seek_request_record_clocktime<=Y._getClockTime()-100){var V=this._media_element.currentTime;this._seek_request_record_clocktime=null,this._isPositionBuffered(V)||(this._idr_sample_list.clear(),this._on_unbuffered_seek(Math.floor(1e3*V)),this._config.accurateSeek&&this.directSeek(V))}else window.setTimeout(this._pollAndApplyUnbufferedSeek.bind(this),50)},Y.prototype._isPositionBuffered=function(V){for(var $=this._media_element.buffered,X=0;X<$.length;X++){var me=$.start(X),ve=$.end(X);if(V>=me&&V<ve)return!0}return!1},Y.prototype._getNearestKeyframe=function(V){return this._idr_sample_list.getLastSyncPointBeforeDts(V)},Y._getClockTime=function(){return self.performance&&self.performance.now?self.performance.now():Date.now()},Y})(),k=(function(){function Y(V,$,X,me){this.TAG="LoadingController",this._config=null,this._media_element=null,this._on_pause_transmuxer=null,this._on_resume_transmuxer=null,this._paused=!1,this.e=null,this._config=V,this._media_element=$,this._on_pause_transmuxer=X,this._on_resume_transmuxer=me,this.e={onMediaTimeUpdate:this._onMediaTimeUpdate.bind(this)}}return Y.prototype.destroy=function(){this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate),this.e=null,this._media_element=null,this._config=null,this._on_pause_transmuxer=null,this._on_resume_transmuxer=null},Y.prototype.notifyBufferedPositionChanged=function(V){!this._config.isLive&&this._config.lazyLoad&&(V==null?this._suspendTransmuxerIfNeeded():this._suspendTransmuxerIfBufferedPositionExceeded(V))},Y.prototype._onMediaTimeUpdate=function(V){this._paused&&this._resumeTransmuxerIfNeeded()},Y.prototype._suspendTransmuxerIfNeeded=function(){for(var V=this._media_element.buffered,$=this._media_element.currentTime,X=0,me=0;me<V.length;me++){var ve=V.start(me),pe=V.end(me);if(ve<=$&&$<pe){X=pe;break}}X>0&&this._suspendTransmuxerIfBufferedPositionExceeded(X)},Y.prototype._suspendTransmuxerIfBufferedPositionExceeded=function(V){V>=this._media_element.currentTime+this._config.lazyLoadMaxDuration&&!this._paused&&(g.a.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this.suspendTransmuxer(),this._media_element.addEventListener("timeupdate",this.e.onMediaTimeUpdate))},Y.prototype.suspendTransmuxer=function(){this._paused=!0,this._on_pause_transmuxer()},Y.prototype._resumeTransmuxerIfNeeded=function(){for(var V=this._media_element.buffered,$=this._media_element.currentTime,X=this._config.lazyLoadRecoverDuration,me=!1,ve=0;ve<V.length;ve++){var pe=V.start(ve),ge=V.end(ve);if($>=pe&&$<ge){$>=ge-X&&(me=!0);break}}me&&(g.a.v(this.TAG,"Continue loading from paused position"),this.resumeTransmuxer(),this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate))},Y.prototype.resumeTransmuxer=function(){this._paused=!1,this._on_resume_transmuxer()},Y})(),M=(function(){function Y(V,$){this.TAG="StartupStallJumper",this._media_element=null,this._on_direct_seek=null,this._canplay_received=!1,this.e=null,this._media_element=V,this._on_direct_seek=$,this.e={onMediaCanPlay:this._onMediaCanPlay.bind(this),onMediaStalled:this._onMediaStalled.bind(this),onMediaProgress:this._onMediaProgress.bind(this)},this._media_element.addEventListener("canplay",this.e.onMediaCanPlay),this._media_element.addEventListener("stalled",this.e.onMediaStalled),this._media_element.addEventListener("progress",this.e.onMediaProgress)}return Y.prototype.destroy=function(){this._media_element.removeEventListener("canplay",this.e.onMediaCanPlay),this._media_element.removeEventListener("stalled",this.e.onMediaStalled),this._media_element.removeEventListener("progress",this.e.onMediaProgress),this._media_element=null,this._on_direct_seek=null},Y.prototype._onMediaCanPlay=function(V){this._canplay_received=!0,this._media_element.removeEventListener("canplay",this.e.onMediaCanPlay)},Y.prototype._onMediaStalled=function(V){this._detectAndFixStuckPlayback(!0)},Y.prototype._onMediaProgress=function(V){this._detectAndFixStuckPlayback()},Y.prototype._detectAndFixStuckPlayback=function(V){var $=this._media_element,X=$.buffered;V||!this._canplay_received||$.readyState<2?X.length>0&&$.currentTime<X.start(0)&&(g.a.w(this.TAG,"Playback seems stuck at ".concat($.currentTime,", seek to ").concat(X.start(0))),this._on_direct_seek(X.start(0)),this._media_element.removeEventListener("progress",this.e.onMediaProgress)):this._media_element.removeEventListener("progress",this.e.onMediaProgress)},Y})(),I=(function(){function Y(V,$,X){this._config=null,this._media_element=null,this._on_direct_seek=null,this._config=V,this._media_element=$,this._on_direct_seek=X}return Y.prototype.destroy=function(){this._on_direct_seek=null,this._media_element=null,this._config=null},Y.prototype.notifyBufferedRangeUpdate=function(){this._chaseLiveLatency()},Y.prototype._chaseLiveLatency=function(){var V=this._media_element.buffered,$=this._media_element.currentTime,X=this._media_element.paused;if(this._config.isLive&&this._config.liveBufferLatencyChasing&&V.length!=0&&(this._config.liveBufferLatencyChasingOnPaused||!X)){var me=V.end(V.length-1);if(me>this._config.liveBufferLatencyMaxLatency&&me-$>this._config.liveBufferLatencyMaxLatency){var ve=me-this._config.liveBufferLatencyMinRemain;this._on_direct_seek(ve)}}},Y})(),j=(function(){function Y(V,$){this._config=null,this._media_element=null,this.e=null,this._config=V,this._media_element=$,this.e={onMediaTimeUpdate:this._onMediaTimeUpdate.bind(this)},this._media_element.addEventListener("timeupdate",this.e.onMediaTimeUpdate)}return Y.prototype.destroy=function(){this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate),this._media_element=null,this._config=null},Y.prototype._onMediaTimeUpdate=function(V){if(this._config.isLive&&this._config.liveSync){var $=this._getCurrentLatency();if($>this._config.liveSyncMaxLatency){var X=Math.min(2,Math.max(1,this._config.liveSyncPlaybackRate));this._media_element.playbackRate=X}else $>this._config.liveSyncTargetLatency||this._media_element.playbackRate!==1&&this._media_element.playbackRate!==0&&(this._media_element.playbackRate=1)}},Y.prototype._getCurrentLatency=function(){if(!this._media_element)return 0;var V=this._media_element.buffered,$=this._media_element.currentTime;return V.length==0?0:V.end(V.length-1)-$},Y})(),Z=(function(){function Y(V,$){this.TAG="PlayerEngineMainThread",this._emitter=new y,this._media_element=null,this._mse_controller=null,this._transmuxer=null,this._pending_seek_time=null,this._seeking_handler=null,this._loading_controller=null,this._startup_stall_jumper=null,this._live_latency_chaser=null,this._live_latency_synchronizer=null,this._mse_source_opened=!1,this._has_pending_load=!1,this._loaded_metadata_received=!1,this._media_info=null,this._statistics_info=null,this.e=null,this._media_data_source=V,this._config=f(),typeof $=="object"&&Object.assign(this._config,$),V.isLive===!0&&(this._config.isLive=!0),this.e={onMediaLoadedMetadata:this._onMediaLoadedMetadata.bind(this)}}return Y.prototype.destroy=function(){this._emitter.emit(E.a.DESTROYING),this._transmuxer&&this.unload(),this._media_element&&this.detachMediaElement(),this.e=null,this._media_data_source=null,this._emitter.removeAllListeners(),this._emitter=null},Y.prototype.on=function(V,$){var X=this;this._emitter.addListener(V,$),V===E.a.MEDIA_INFO&&this._media_info?Promise.resolve().then((function(){return X._emitter.emit(E.a.MEDIA_INFO,X.mediaInfo)})):V==E.a.STATISTICS_INFO&&this._statistics_info&&Promise.resolve().then((function(){return X._emitter.emit(E.a.STATISTICS_INFO,X.statisticsInfo)}))},Y.prototype.off=function(V,$){this._emitter.removeListener(V,$)},Y.prototype.attachMediaElement=function(V){var $=this;this._media_element=V,V.src="",V.removeAttribute("src"),V.srcObject=null,V.load(),V.addEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._mse_controller=new v.a(this._config),this._mse_controller.on(R.a.UPDATE_END,this._onMSEUpdateEnd.bind(this)),this._mse_controller.on(R.a.BUFFER_FULL,this._onMSEBufferFull.bind(this)),this._mse_controller.on(R.a.SOURCE_OPEN,this._onMSESourceOpen.bind(this)),this._mse_controller.on(R.a.ERROR,this._onMSEError.bind(this)),this._mse_controller.on(R.a.START_STREAMING,this._onMSEStartStreaming.bind(this)),this._mse_controller.on(R.a.END_STREAMING,this._onMSEEndStreaming.bind(this)),this._mse_controller.initialize({getCurrentTime:function(){return $._media_element.currentTime},getReadyState:function(){return $._media_element.readyState}}),this._mse_controller.isManagedMediaSource()?(V.disableRemotePlayback=!0,V.srcObject=this._mse_controller.getObject()):V.src=this._mse_controller.getObjectURL()},Y.prototype.detachMediaElement=function(){this._media_element&&(this._mse_controller.shutdown(),this._media_element.removeEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._media_element.src="",this._media_element.removeAttribute("src"),this._media_element.srcObject=null,this._media_element.load(),this._media_element=null,this._mse_controller.revokeObjectURL()),this._mse_controller&&(this._mse_controller.destroy(),this._mse_controller=null)},Y.prototype.load=function(){var V=this;if(!this._media_element)throw new L.a("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new L.a("load() has been called, please call unload() first!");this._has_pending_load||(!this._config.deferLoadAfterSourceOpen||this._mse_source_opened?(this._transmuxer=new A.a(this._media_data_source,this._config),this._transmuxer.on(O.a.INIT_SEGMENT,(function($,X){V._mse_controller.appendInitSegment(X)})),this._transmuxer.on(O.a.MEDIA_SEGMENT,(function($,X){V._mse_controller.appendMediaSegment(X),!V._config.isLive&&$==="video"&&X.data&&X.data.byteLength>0&&"info"in X&&V._seeking_handler.appendSyncPoints(X.info.syncPoints),V._loading_controller.notifyBufferedPositionChanged(X.info.endDts/1e3)})),this._transmuxer.on(O.a.LOADING_COMPLETE,(function(){V._mse_controller.endOfStream(),V._emitter.emit(E.a.LOADING_COMPLETE)})),this._transmuxer.on(O.a.RECOVERED_EARLY_EOF,(function(){V._emitter.emit(E.a.RECOVERED_EARLY_EOF)})),this._transmuxer.on(O.a.IO_ERROR,(function($,X){V._emitter.emit(E.a.ERROR,D.b.NETWORK_ERROR,$,X)})),this._transmuxer.on(O.a.DEMUX_ERROR,(function($,X){V._emitter.emit(E.a.ERROR,D.b.MEDIA_ERROR,$,X)})),this._transmuxer.on(O.a.MEDIA_INFO,(function($){V._media_info=$,V._emitter.emit(E.a.MEDIA_INFO,Object.assign({},$))})),this._transmuxer.on(O.a.STATISTICS_INFO,(function($){V._statistics_info=V._fillStatisticsInfo($),V._emitter.emit(E.a.STATISTICS_INFO,Object.assign({},$))})),this._transmuxer.on(O.a.RECOMMEND_SEEKPOINT,(function($){V._media_element&&!V._config.accurateSeek&&V._seeking_handler.directSeek($/1e3)})),this._transmuxer.on(O.a.METADATA_ARRIVED,(function($){V._emitter.emit(E.a.METADATA_ARRIVED,$)})),this._transmuxer.on(O.a.SCRIPTDATA_ARRIVED,(function($){V._emitter.emit(E.a.SCRIPTDATA_ARRIVED,$)})),this._transmuxer.on(O.a.TIMED_ID3_METADATA_ARRIVED,(function($){V._emitter.emit(E.a.TIMED_ID3_METADATA_ARRIVED,$)})),this._transmuxer.on(O.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,(function($){V._emitter.emit(E.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,$)})),this._transmuxer.on(O.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,(function($){V._emitter.emit(E.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,$)})),this._transmuxer.on(O.a.SMPTE2038_METADATA_ARRIVED,(function($){V._emitter.emit(E.a.SMPTE2038_METADATA_ARRIVED,$)})),this._transmuxer.on(O.a.SCTE35_METADATA_ARRIVED,(function($){V._emitter.emit(E.a.SCTE35_METADATA_ARRIVED,$)})),this._transmuxer.on(O.a.PES_PRIVATE_DATA_DESCRIPTOR,(function($){V._emitter.emit(E.a.PES_PRIVATE_DATA_DESCRIPTOR,$)})),this._transmuxer.on(O.a.PES_PRIVATE_DATA_ARRIVED,(function($){V._emitter.emit(E.a.PES_PRIVATE_DATA_ARRIVED,$)})),this._seeking_handler=new U(this._config,this._media_element,this._onRequiredUnbufferedSeek.bind(this)),this._loading_controller=new k(this._config,this._media_element,this._onRequestPauseTransmuxer.bind(this),this._onRequestResumeTransmuxer.bind(this)),this._startup_stall_jumper=new M(this._media_element,this._onRequestDirectSeek.bind(this)),this._config.isLive&&this._config.liveBufferLatencyChasing&&(this._live_latency_chaser=new I(this._config,this._media_element,this._onRequestDirectSeek.bind(this))),this._config.isLive&&this._config.liveSync&&(this._live_latency_synchronizer=new j(this._config,this._media_element)),this._media_element.readyState>0&&this._seeking_handler.directSeek(0),this._transmuxer.open()):this._has_pending_load=!0)},Y.prototype.unload=function(){var V,$,X,me,ve,pe,ge,ee,ye;(V=this._media_element)===null||V===void 0||V.pause(),($=this._live_latency_synchronizer)===null||$===void 0||$.destroy(),this._live_latency_synchronizer=null,(X=this._live_latency_chaser)===null||X===void 0||X.destroy(),this._live_latency_chaser=null,(me=this._startup_stall_jumper)===null||me===void 0||me.destroy(),this._startup_stall_jumper=null,(ve=this._loading_controller)===null||ve===void 0||ve.destroy(),this._loading_controller=null,(pe=this._seeking_handler)===null||pe===void 0||pe.destroy(),this._seeking_handler=null,(ge=this._mse_controller)===null||ge===void 0||ge.flush(),(ee=this._transmuxer)===null||ee===void 0||ee.close(),(ye=this._transmuxer)===null||ye===void 0||ye.destroy(),this._transmuxer=null},Y.prototype.play=function(){return this._media_element.play()},Y.prototype.pause=function(){this._media_element.pause()},Y.prototype.seek=function(V){this._media_element&&this._seeking_handler?this._seeking_handler.seek(V):this._pending_seek_time=V},Object.defineProperty(Y.prototype,"mediaInfo",{get:function(){return Object.assign({},this._media_info)},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"statisticsInfo",{get:function(){return Object.assign({},this._statistics_info)},enumerable:!1,configurable:!0}),Y.prototype._onMSESourceOpen=function(){this._mse_source_opened=!0,this._has_pending_load&&(this._has_pending_load=!1,this.load())},Y.prototype._onMSEUpdateEnd=function(){this._config.isLive&&this._config.liveBufferLatencyChasing&&this._live_latency_chaser&&this._live_latency_chaser.notifyBufferedRangeUpdate(),this._loading_controller.notifyBufferedPositionChanged()},Y.prototype._onMSEBufferFull=function(){g.a.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._loading_controller.suspendTransmuxer()},Y.prototype._onMSEError=function(V){this._emitter.emit(E.a.ERROR,D.b.MEDIA_ERROR,D.a.MEDIA_MSE_ERROR,V)},Y.prototype._onMSEStartStreaming=function(){this._loaded_metadata_received&&(this._config.isLive||(g.a.v(this.TAG,"Resume transmuxing task due to ManagedMediaSource onStartStreaming"),this._loading_controller.resumeTransmuxer()))},Y.prototype._onMSEEndStreaming=function(){this._config.isLive||(g.a.v(this.TAG,"Suspend transmuxing task due to ManagedMediaSource onEndStreaming"),this._loading_controller.suspendTransmuxer())},Y.prototype._onMediaLoadedMetadata=function(V){this._loaded_metadata_received=!0,this._pending_seek_time!=null&&(this._seeking_handler.seek(this._pending_seek_time),this._pending_seek_time=null)},Y.prototype._onRequestDirectSeek=function(V){this._seeking_handler.directSeek(V)},Y.prototype._onRequiredUnbufferedSeek=function(V){this._mse_controller.flush(),this._transmuxer.seek(V)},Y.prototype._onRequestPauseTransmuxer=function(){this._transmuxer.pause()},Y.prototype._onRequestResumeTransmuxer=function(){this._transmuxer.resume()},Y.prototype._fillStatisticsInfo=function(V){if(V.playerType="MSEPlayer",!(this._media_element instanceof HTMLVideoElement))return V;var $=!0,X=0,me=0;if(this._media_element.getVideoPlaybackQuality){var ve=this._media_element.getVideoPlaybackQuality();X=ve.totalVideoFrames,me=ve.droppedVideoFrames}else this._media_element.webkitDecodedFrameCount!=null?(X=this._media_element.webkitDecodedFrameCount,me=this._media_element.webkitDroppedFrameCount):$=!1;return $&&(V.decodedFrames=X,V.droppedFrames=me),V},Y})(),ae=a(18),ie=a(8),re=(function(){function Y(V,$){this.TAG="PlayerEngineDedicatedThread",this._emitter=new y,this._media_element=null,this._worker_destroying=!1,this._seeking_handler=null,this._loading_controller=null,this._startup_stall_jumper=null,this._live_latency_chaser=null,this._live_latency_synchronizer=null,this._pending_seek_time=null,this._media_info=null,this._statistics_info=null,this.e=null,this._media_data_source=V,this._config=f(),typeof $=="object"&&Object.assign(this._config,$),V.isLive===!0&&(this._config.isLive=!0),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this),onMediaLoadedMetadata:this._onMediaLoadedMetadata.bind(this),onMediaTimeUpdate:this._onMediaTimeUpdate.bind(this),onMediaReadyStateChanged:this._onMediaReadyStateChange.bind(this)},ie.a.registerListener(this.e.onLoggingConfigChanged),this._worker=ae(24,{all:!0}),this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",media_data_source:this._media_data_source,config:this._config}),this._worker.postMessage({cmd:"logging_config",logging_config:ie.a.getConfig()})}return Y.isSupported=function(){return!!self.Worker&&(!(!self.MediaSource||!("canConstructInDedicatedWorker"in self.MediaSource)||self.MediaSource.canConstructInDedicatedWorker!==!0)||!(!self.ManagedMediaSource||!("canConstructInDedicatedWorker"in self.ManagedMediaSource)||self.ManagedMediaSource.canConstructInDedicatedWorker!==!0))},Y.prototype.destroy=function(){this._emitter.emit(E.a.DESTROYING),this.unload(),this.detachMediaElement(),this._worker_destroying=!0,this._worker.postMessage({cmd:"destroy"}),ie.a.removeListener(this.e.onLoggingConfigChanged),this.e=null,this._media_data_source=null,this._emitter.removeAllListeners(),this._emitter=null},Y.prototype.on=function(V,$){var X=this;this._emitter.addListener(V,$),V===E.a.MEDIA_INFO&&this._media_info?Promise.resolve().then((function(){return X._emitter.emit(E.a.MEDIA_INFO,X.mediaInfo)})):V==E.a.STATISTICS_INFO&&this._statistics_info&&Promise.resolve().then((function(){return X._emitter.emit(E.a.STATISTICS_INFO,X.statisticsInfo)}))},Y.prototype.off=function(V,$){this._emitter.removeListener(V,$)},Y.prototype.attachMediaElement=function(V){this._media_element=V,this._media_element.src="",this._media_element.removeAttribute("src"),this._media_element.srcObject=null,this._media_element.load(),this._media_element.addEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._media_element.addEventListener("timeupdate",this.e.onMediaTimeUpdate),this._media_element.addEventListener("readystatechange",this.e.onMediaReadyStateChanged),this._worker.postMessage({cmd:"initialize_mse"})},Y.prototype.detachMediaElement=function(){this._worker.postMessage({cmd:"shutdown_mse"}),this._media_element&&(this._media_element.removeEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate),this._media_element.removeEventListener("readystatechange",this.e.onMediaReadyStateChanged),this._media_element.src="",this._media_element.removeAttribute("src"),this._media_element.srcObject=null,this._media_element.load(),this._media_element=null)},Y.prototype.load=function(){this._worker.postMessage({cmd:"load"}),this._seeking_handler=new U(this._config,this._media_element,this._onRequiredUnbufferedSeek.bind(this)),this._loading_controller=new k(this._config,this._media_element,this._onRequestPauseTransmuxer.bind(this),this._onRequestResumeTransmuxer.bind(this)),this._startup_stall_jumper=new M(this._media_element,this._onRequestDirectSeek.bind(this)),this._config.isLive&&this._config.liveBufferLatencyChasing&&(this._live_latency_chaser=new I(this._config,this._media_element,this._onRequestDirectSeek.bind(this))),this._config.isLive&&this._config.liveSync&&(this._live_latency_synchronizer=new j(this._config,this._media_element)),this._media_element.readyState>0&&this._seeking_handler.directSeek(0)},Y.prototype.unload=function(){var V,$,X,me,ve,pe;(V=this._media_element)===null||V===void 0||V.pause(),this._worker.postMessage({cmd:"unload"}),($=this._live_latency_synchronizer)===null||$===void 0||$.destroy(),this._live_latency_synchronizer=null,(X=this._live_latency_chaser)===null||X===void 0||X.destroy(),this._live_latency_chaser=null,(me=this._startup_stall_jumper)===null||me===void 0||me.destroy(),this._startup_stall_jumper=null,(ve=this._loading_controller)===null||ve===void 0||ve.destroy(),this._loading_controller=null,(pe=this._seeking_handler)===null||pe===void 0||pe.destroy(),this._seeking_handler=null},Y.prototype.play=function(){return this._media_element.play()},Y.prototype.pause=function(){this._media_element.pause()},Y.prototype.seek=function(V){this._media_element&&this._seeking_handler?this._seeking_handler.seek(V):this._pending_seek_time=V},Object.defineProperty(Y.prototype,"mediaInfo",{get:function(){return Object.assign({},this._media_info)},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"statisticsInfo",{get:function(){return Object.assign({},this._statistics_info)},enumerable:!1,configurable:!0}),Y.prototype._onLoggingConfigChanged=function(V){var $;($=this._worker)===null||$===void 0||$.postMessage({cmd:"logging_config",logging_config:V})},Y.prototype._onMSEUpdateEnd=function(){this._config.isLive&&this._config.liveBufferLatencyChasing&&this._live_latency_chaser&&this._live_latency_chaser.notifyBufferedRangeUpdate(),this._loading_controller.notifyBufferedPositionChanged()},Y.prototype._onMSEBufferFull=function(){g.a.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._loading_controller.suspendTransmuxer()},Y.prototype._onMediaLoadedMetadata=function(V){this._pending_seek_time!=null&&(this._seeking_handler.seek(this._pending_seek_time),this._pending_seek_time=null)},Y.prototype._onRequestDirectSeek=function(V){this._seeking_handler.directSeek(V)},Y.prototype._onRequiredUnbufferedSeek=function(V){this._worker.postMessage({cmd:"unbuffered_seek",milliseconds:V})},Y.prototype._onRequestPauseTransmuxer=function(){this._worker.postMessage({cmd:"pause_transmuxer"})},Y.prototype._onRequestResumeTransmuxer=function(){this._worker.postMessage({cmd:"resume_transmuxer"})},Y.prototype._onMediaTimeUpdate=function(V){this._worker.postMessage({cmd:"timeupdate",current_time:V.target.currentTime})},Y.prototype._onMediaReadyStateChange=function(V){this._worker.postMessage({cmd:"readystatechange",ready_state:V.target.readyState})},Y.prototype._onWorkerMessage=function(V){var $,X=V.data,me=X.msg;if(me=="destroyed"||this._worker_destroying)return this._worker_destroying=!1,($=this._worker)===null||$===void 0||$.terminate(),void(this._worker=null);switch(me){case"mse_init":var ve=X;"ManagedMediaSource"in self&&!("MediaSource"in self)&&(this._media_element.disableRemotePlayback=!0),this._media_element.srcObject=ve.handle;break;case"mse_event":(ve=X).event==R.a.UPDATE_END?this._onMSEUpdateEnd():ve.event==R.a.BUFFER_FULL&&this._onMSEBufferFull();break;case"transmuxing_event":if((ve=X).event==O.a.MEDIA_INFO){var pe=X;this._media_info=pe.info,this._emitter.emit(E.a.MEDIA_INFO,Object.assign({},pe.info))}else if(ve.event==O.a.STATISTICS_INFO){var ge=X;this._statistics_info=this._fillStatisticsInfo(ge.info),this._emitter.emit(E.a.STATISTICS_INFO,Object.assign({},ge.info))}else if(ve.event==O.a.RECOMMEND_SEEKPOINT){var ee=X;this._media_element&&!this._config.accurateSeek&&this._seeking_handler.directSeek(ee.milliseconds/1e3)}break;case"player_event":if((ve=X).event==E.a.ERROR){var ye=X;this._emitter.emit(E.a.ERROR,ye.error_type,ye.error_detail,ye.info)}else if("extraData"in ve){var Ie=X;this._emitter.emit(Ie.event,Ie.extraData)}break;case"logcat_callback":ve=X,g.a.emitter.emit("log",ve.type,ve.logcat);break;case"buffered_position_changed":ve=X,this._loading_controller.notifyBufferedPositionChanged(ve.buffered_position_milliseconds/1e3)}},Y.prototype._fillStatisticsInfo=function(V){if(V.playerType="MSEPlayer",!(this._media_element instanceof HTMLVideoElement))return V;var $=!0,X=0,me=0;if(this._media_element.getVideoPlaybackQuality){var ve=this._media_element.getVideoPlaybackQuality();X=ve.totalVideoFrames,me=ve.droppedVideoFrames}else this._media_element.webkitDecodedFrameCount!=null?(X=this._media_element.webkitDecodedFrameCount,me=this._media_element.webkitDroppedFrameCount):$=!1;return $&&(V.decodedFrames=X,V.droppedFrames=me),V},Y})(),Q=(function(){function Y(V,$){this.TAG="MSEPlayer",this._type="MSEPlayer",this._media_element=null,this._player_engine=null;var X=V.type.toLowerCase();if(X!=="mse"&&X!=="mpegts"&&X!=="m2ts"&&X!=="flv")throw new L.b("MSEPlayer requires an mpegts/m2ts/flv MediaDataSource input!");if($&&$.enableWorkerForMSE&&re.isSupported())try{this._player_engine=new re(V,$)}catch{g.a.e(this.TAG,"Error while initializing PlayerEngineDedicatedThread, fallback to PlayerEngineMainThread"),this._player_engine=new Z(V,$)}else this._player_engine=new Z(V,$)}return Y.prototype.destroy=function(){this._player_engine.destroy(),this._player_engine=null,this._media_element=null},Y.prototype.on=function(V,$){this._player_engine.on(V,$)},Y.prototype.off=function(V,$){this._player_engine.off(V,$)},Y.prototype.attachMediaElement=function(V){this._media_element=V,this._player_engine.attachMediaElement(V)},Y.prototype.detachMediaElement=function(){this._media_element=null,this._player_engine.detachMediaElement()},Y.prototype.load=function(){this._player_engine.load()},Y.prototype.unload=function(){this._player_engine.unload()},Y.prototype.play=function(){return this._player_engine.play()},Y.prototype.pause=function(){this._player_engine.pause()},Object.defineProperty(Y.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"buffered",{get:function(){return this._media_element.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"duration",{get:function(){return this._media_element.duration},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"volume",{get:function(){return this._media_element.volume},set:function(V){this._media_element.volume=V},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"muted",{get:function(){return this._media_element.muted},set:function(V){this._media_element.muted=V},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"currentTime",{get:function(){return this._media_element?this._media_element.currentTime:0},set:function(V){this._player_engine.seek(V)},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"mediaInfo",{get:function(){return this._player_engine.mediaInfo},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"statisticsInfo",{get:function(){return this._player_engine.statisticsInfo},enumerable:!1,configurable:!0}),Y})(),se=(function(){function Y(V,$){this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new x.a,this._config=f(),typeof $=="object"&&Object.assign(this._config,$);var X=V.type.toLowerCase();if(X==="mse"||X==="mpegts"||X==="m2ts"||X==="flv")throw new L.b("NativePlayer does't support mse/mpegts/m2ts/flv MediaDataSource input!");if(V.hasOwnProperty("segments"))throw new L.b("NativePlayer(".concat(V.type,") doesn't support multipart playback!"));this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=V,this._mediaElement=null}return Y.prototype.destroy=function(){this._emitter.emit(E.a.DESTROYING),this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},Y.prototype.on=function(V,$){var X=this;V===E.a.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then((function(){X._emitter.emit(E.a.MEDIA_INFO,X.mediaInfo)})):V===E.a.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then((function(){X._emitter.emit(E.a.STATISTICS_INFO,X.statisticsInfo)})),this._emitter.addListener(V,$)},Y.prototype.off=function(V,$){this._emitter.removeListener(V,$)},Y.prototype.attachMediaElement=function(V){if(this._mediaElement=V,V.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{V.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},Y.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},Y.prototype.load=function(){if(!this._mediaElement)throw new L.a("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},Y.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},Y.prototype.play=function(){return this._mediaElement.play()},Y.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(Y.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(V){this._mediaElement.volume=V},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(V){this._mediaElement.muted=V},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(V){this._mediaElement?this._mediaElement.currentTime=V:this._pendingSeekTime=V},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"mediaInfo",{get:function(){var V={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&(V.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(V.width=this._mediaElement.videoWidth,V.height=this._mediaElement.videoHeight)),V},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"statisticsInfo",{get:function(){var V={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return V;var $=!0,X=0,me=0;if(this._mediaElement.getVideoPlaybackQuality){var ve=this._mediaElement.getVideoPlaybackQuality();X=ve.totalVideoFrames,me=ve.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(X=this._mediaElement.webkitDecodedFrameCount,me=this._mediaElement.webkitDroppedFrameCount):$=!1;return $&&(V.decodedFrames=X,V.droppedFrames=me),V},enumerable:!1,configurable:!0}),Y.prototype._onvLoadedMetadata=function(V){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(E.a.MEDIA_INFO,this.mediaInfo)},Y.prototype._reportStatisticsInfo=function(){this._emitter.emit(E.a.STATISTICS_INFO,this.statisticsInfo)},Y})();l.a.install();var oe={createPlayer:function(Y,V){var $=Y;if($==null||typeof $!="object")throw new L.b("MediaDataSource must be an javascript object!");if(!$.hasOwnProperty("type"))throw new L.b("MediaDataSource must has type field to indicate video file type!");switch($.type){case"mse":case"mpegts":case"m2ts":case"flv":return new Q($,V);default:return new se($,V)}},isSupported:function(){return d.supportMSEH264Playback()},getFeatureList:function(){return d.getFeatureList()}};oe.BaseLoader=m.a,oe.LoaderStatus=m.c,oe.LoaderErrors=m.b,oe.Events=E.a,oe.ErrorTypes=D.b,oe.ErrorDetails=D.a,oe.MSEPlayer=Q,oe.NativePlayer=se,oe.LoggingControl=ie.a,Object.defineProperty(oe,"version",{enumerable:!0,get:function(){return"1.8.0"}}),s.default=oe}])}))})(lm)),lm.exports}var h4=d4();const Iu=H_(h4),B_=220,cm=70,U_=50,rr=3,Kg={Movies:"bg-purple-600",TVShow:"bg-blue-600",Sports:"bg-green-600",News:"bg-red-600",Kids:"bg-orange-500",Documentary:"bg-teal-600"};function ur(i){return i.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function f4({program:i,startOffset:e,width:t,onClick:s,isNow:a,isScheduled:l,isRecording:c}){const u=Kg[i.category||""]||"bg-gray-600",f=60;return t<20?null:r.jsxs("div",{onClick:s,className:`absolute top-1 bottom-1 rounded-md cursor-pointer overflow-hidden transition-all hover:z-20 hover:ring-2 hover:ring-white/80 hover:brightness-110 ${u} ${a?"ring-1 ring-yellow-400/70 shadow-[0_0_4px_rgba(250,204,21,0.3)]":""}`,style:{left:`${e}px`,width:`${Math.max(t-4,f)}px`},title:`${i.title}
${ur(new Date(i.start))} - ${ur(new Date(i.end))}${l?`
 Scheduled to record`:""}`,children:[(l||c)&&r.jsx("div",{className:"absolute top-1 right-1 z-10",children:r.jsx("div",{className:`w-3 h-3 rounded-full flex items-center justify-center ${c?"bg-red-600 animate-pulse":"bg-red-500"}`,children:r.jsx(vo,{className:"w-2 h-2 text-white fill-current"})})}),(()=>{const d=i.isSports&&!i.isLive,m=i.isNew&&!d,g=i.isPremiere&&!d,y=i.isLive,x=i.isFinale;return!m&&!g&&!x&&!y?null:r.jsxs("div",{className:"absolute top-1 left-1 z-10 flex gap-1",children:[y&&r.jsx("span",{className:"px-1 py-0.5 bg-red-500 text-white text-[9px] font-bold rounded uppercase animate-pulse",children:"Live"}),g&&r.jsx("span",{className:"px-1 py-0.5 bg-yellow-500 text-black text-[9px] font-bold rounded uppercase",children:"Premiere"}),m&&!g&&r.jsx("span",{className:"px-1 py-0.5 bg-green-500 text-white text-[9px] font-bold rounded uppercase",children:"New"}),x&&r.jsx("span",{className:"px-1 py-0.5 bg-purple-500 text-white text-[9px] font-bold rounded uppercase",children:"Finale"})]})})(),r.jsxs("div",{className:"p-2 h-full flex flex-col justify-center",children:[r.jsx("div",{className:"font-semibold text-white text-sm leading-tight truncate",children:i.title}),t>120&&r.jsxs("div",{className:"text-xs text-white/80 mt-1 truncate",children:[ur(new Date(i.start))," - ",ur(new Date(i.end))]}),t>200&&i.description&&r.jsx("div",{className:"text-xs text-white/60 mt-1 line-clamp-1",children:i.description})]})]})}function m4({program:i,channel:e,onClose:t,onRecord:s,onWatchNow:a,isRecording:l,scheduledStatus:c,onCancelRecording:u}){const f=new Date(i.start),d=new Date(i.end),m=Math.round((d.getTime()-f.getTime())/6e4),g=new Date>=f&&new Date<d,y=new Date<f,x=Kg[i.category||""]||"bg-gray-600",v=c==="scheduled"||c==="recording";return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4",onClick:t,children:r.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-lg overflow-hidden shadow-2xl",onClick:E=>E.stopPropagation(),children:[r.jsxs("div",{className:`relative h-28 ${x} flex items-end p-4`,children:[r.jsx("button",{onClick:t,className:"absolute top-3 right-3 p-1.5 bg-black/30 hover:bg-black/50 rounded-full transition-colors",children:r.jsx(jt,{className:"h-5 w-5 text-white"})}),c==="recording"?r.jsxs("span",{className:"absolute top-3 left-3 flex items-center gap-1.5 px-2.5 py-1 bg-red-600 text-white text-xs font-bold rounded-full",children:[r.jsx(vo,{className:"h-2 w-2 fill-current animate-pulse"}),"RECORDING"]}):c==="scheduled"?r.jsxs("span",{className:"absolute top-3 left-3 flex items-center gap-1.5 px-2.5 py-1 bg-red-500 text-white text-xs font-bold rounded-full",children:[r.jsx(vo,{className:"h-2 w-2 fill-current"}),"SCHEDULED"]}):g&&r.jsxs("span",{className:"absolute top-3 left-3 flex items-center gap-1.5 px-2.5 py-1 bg-red-600 text-white text-xs font-bold rounded-full",children:[r.jsx(vo,{className:"h-2 w-2 fill-current animate-pulse"}),"LIVE NOW"]}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold text-white drop-shadow-lg",children:i.title}),e&&r.jsxs("p",{className:"text-white/90 text-sm mt-1",children:["Ch ",e.number,"  ",e.name]})]})]}),r.jsxs("div",{className:"p-5",children:[r.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-gray-400 mb-4",children:[r.jsxs("div",{className:"flex items-center gap-1.5 bg-gray-700/50 px-2.5 py-1 rounded",children:[r.jsx(bn,{className:"h-4 w-4"}),f.toLocaleDateString()]}),r.jsxs("div",{className:"flex items-center gap-1.5 bg-gray-700/50 px-2.5 py-1 rounded",children:[r.jsx(Li,{className:"h-4 w-4"}),ur(f)," - ",ur(d)," (",m," min)"]}),i.category&&r.jsx("span",{className:`px-2.5 py-1 rounded text-xs font-semibold text-white ${x}`,children:i.category}),(()=>{const E=i.isSports&&!i.isLive;return r.jsxs(r.Fragment,{children:[i.isPremiere&&!E&&r.jsx("span",{className:"px-2.5 py-1 bg-yellow-500 text-black text-xs font-bold rounded uppercase",children:"Premiere"}),i.isNew&&!i.isPremiere&&!E&&r.jsx("span",{className:"px-2.5 py-1 bg-green-500 text-white text-xs font-bold rounded uppercase",children:"New Episode"}),i.isFinale&&r.jsx("span",{className:"px-2.5 py-1 bg-purple-500 text-white text-xs font-bold rounded uppercase",children:"Finale"}),i.isLive&&r.jsx("span",{className:"px-2.5 py-1 bg-red-500 text-white text-xs font-bold rounded uppercase animate-pulse",children:"Live"})]})})()]}),i.description&&r.jsx("p",{className:"text-gray-300 text-sm leading-relaxed mb-4",children:i.description}),i.episodeNum&&r.jsx("p",{className:"text-gray-500 text-xs mb-4",children:i.episodeNum}),r.jsxs("div",{className:"flex gap-3 mt-6 pt-4 border-t border-gray-700",children:[g&&e?.streamUrl&&r.jsxs("button",{onClick:a,className:"flex-1 flex items-center justify-center gap-2 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold transition-colors",children:[r.jsx(Ao,{className:"h-5 w-5"}),"Watch Now"]}),(g||y)&&!v&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:()=>s(!1),disabled:l,className:"flex-1 py-3 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 text-white rounded-lg font-semibold transition-colors",children:l?"Recording...":"Record"}),r.jsx("button",{onClick:()=>s(!0),disabled:l,className:"flex-1 py-3 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 text-white rounded-lg font-semibold transition-colors",children:"Record Series"})]}),v&&u&&r.jsx("button",{onClick:u,className:"flex-1 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold transition-colors",children:c==="recording"?"Stop Recording":"Cancel Recording"})]})]})]})})}function g4({channel:i,program:e,onClose:t}){const s=K.useRef(null),a=K.useRef(null),l=K.useRef(null),[c,u]=K.useState(!0),[f,d]=K.useState(null),[m,g]=K.useState(!1),[y,x]=K.useState(!0),[v,E]=K.useState(!0),[A,R]=K.useState(0),D=K.useRef(null),L=K.useRef(null),O=()=>{const M=s.current;M&&(M.paused?(M.play().catch(()=>{}),x(!0)):(M.pause(),x(!1)))},H=()=>{const M=s.current;M&&(M.currentTime=Math.max(0,M.currentTime-10))},q=()=>{const M=s.current;M&&(M.currentTime=M.currentTime+10)};K.useEffect(()=>{const M=s.current;if(!M)return;if(!i.streamUrl){d("No stream URL available for this channel"),u(!1);return}u(!0),d(null);const I=`${window.location.origin}/livetv/channels/${i.id}/stream`;if(console.log("[LiveTVPlayer] Loading stream:",I,"Original URL:",i.streamUrl),Iu.isSupported()){console.log("[LiveTVPlayer] Trying mpegts.js first (most live TV is MPEG-TS)");let j=!1;const Z=Iu.createPlayer({type:"mpegts",isLive:!0,url:I},{enableWorker:!1,lazyLoad:!1,autoCleanupSourceBuffer:!0,autoCleanupMaxBackwardDuration:60,autoCleanupMinBackwardDuration:30,stashInitialSize:512*1024,enableStashBuffer:!0,liveBufferLatencyChasing:!1,liveBufferLatencyMaxLatency:10,liveBufferLatencyMinRemain:3});l.current=Z,Z.attachMediaElement(M),Z.load(),Z.on(Iu.Events.MEDIA_INFO,()=>{console.log("[LiveTVPlayer] mpegts media info received - stream is MPEG-TS"),j=!0,L.current&&(clearTimeout(L.current),L.current=null),u(!1),M.play().catch(ae=>console.error("[LiveTVPlayer] Play error:",ae))}),Z.on(Iu.Events.ERROR,(ae,ie)=>{if(console.error("[LiveTVPlayer] mpegts error:",ae,ie),j)d(`Stream error: ${ae} - ${ie}`),u(!1);else if(console.log("[LiveTVPlayer] mpegts failed, trying HLS.js..."),Z.destroy(),l.current=null,is.isSupported()){const re=new is({enableWorker:!0,lowLatencyMode:!0});a.current=re,re.on(is.Events.MANIFEST_PARSED,()=>{console.log("[LiveTVPlayer] HLS manifest parsed successfully"),L.current&&(clearTimeout(L.current),L.current=null),u(!1),M.play().catch(Q=>console.error("[LiveTVPlayer] Play error:",Q))}),re.on(is.Events.ERROR,(Q,se)=>{console.error("[LiveTVPlayer] HLS error:",se.type,se.details),se.fatal&&(d(`Stream error: ${se.details}`),u(!1))}),re.loadSource(I),re.attachMedia(M)}else d(`Stream error: ${ae} - ${ie}`),u(!1)})}else if(is.isSupported()){console.log("[LiveTVPlayer] Using HLS.js (mpegts not supported)");const j=new is({enableWorker:!0,lowLatencyMode:!0});a.current=j,j.on(is.Events.MANIFEST_PARSED,()=>{console.log("[LiveTVPlayer] HLS manifest parsed successfully"),L.current&&(clearTimeout(L.current),L.current=null),u(!1),M.play().catch(Z=>console.error("[LiveTVPlayer] Play error:",Z))}),j.on(is.Events.ERROR,(Z,ae)=>{console.error("[LiveTVPlayer] HLS error:",ae.type,ae.details),ae.fatal&&(d(`Stream error: ${ae.details}`),u(!1))}),j.loadSource(I),j.attachMedia(M)}else M.canPlayType("application/vnd.apple.mpegurl")?(console.log("[LiveTVPlayer] Using native HLS (Safari)"),M.src=I,M.addEventListener("loadedmetadata",()=>{console.log("[LiveTVPlayer] Native HLS loaded"),L.current&&(clearTimeout(L.current),L.current=null),u(!1),M.play().catch(j=>console.error("[LiveTVPlayer] Play error:",j))}),M.addEventListener("error",()=>{console.error("[LiveTVPlayer] Native HLS error:",M.error),d(`Video error: ${M.error?.message||"Unknown error"}`),u(!1)})):(d("Your browser does not support video playback"),u(!1));return L.current=window.setTimeout(()=>{console.error("[LiveTVPlayer] Loading timeout - stream failed to load within 30 seconds"),d("Stream failed to load. Please check if the channel is available."),u(!1),L.current=null},3e4),()=>{L.current&&(clearTimeout(L.current),L.current=null),a.current&&(a.current.destroy(),a.current=null),l.current&&(l.current.destroy(),l.current=null)}},[i.id,i.streamUrl,A]),K.useEffect(()=>(v&&(D.current&&clearTimeout(D.current),D.current=window.setTimeout(()=>{E(!1)},3e3)),()=>{D.current&&clearTimeout(D.current)}),[v]);const U=()=>E(!0),k=()=>{const M=document.getElementById("livetv-player-container");M&&(document.fullscreenElement?document.exitFullscreen():M.requestFullscreen())};return r.jsx("div",{className:"fixed inset-0 z-50 bg-black",children:r.jsxs("div",{id:"livetv-player-container",className:"relative w-full h-full",onMouseMove:U,onClick:U,children:[c&&r.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsx(ii,{className:"w-12 h-12 text-white animate-spin"})}),f?r.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsxs("div",{className:"text-center max-w-md px-4",children:[r.jsx("p",{className:"text-red-400 text-lg mb-4",children:f}),r.jsxs("div",{className:"flex gap-3 justify-center",children:[r.jsxs("button",{onClick:()=>{d(null),u(!0),R(M=>M+1)},className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg flex items-center gap-2",children:[r.jsx(vs,{className:"w-4 h-4"}),"Retry"]}),r.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Close"})]})]})}):r.jsx("video",{ref:s,className:"w-full h-full object-contain",muted:m,playsInline:!0}),r.jsxs("div",{className:`absolute inset-0 transition-opacity duration-300 ${v?"opacity-100":"opacity-0 pointer-events-none"}`,children:[r.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/80 to-transparent",children:r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("button",{onClick:t,className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",children:r.jsx(jt,{className:"w-6 h-6"})}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("h2",{className:"text-xl font-semibold text-white",children:["Ch ",i.number," - ",i.name]}),r.jsxs("span",{className:"flex items-center gap-1.5 px-2.5 py-1 bg-red-600 text-white text-xs font-bold rounded-full",children:[r.jsx(vo,{className:"h-2 w-2 fill-current animate-pulse"}),"LIVE"]})]}),e&&r.jsx("p",{className:"text-gray-300 mt-1",children:e.title})]})]})})}),r.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("div",{className:"flex items-center gap-2",children:r.jsx("button",{onClick:()=>g(!m),className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",title:m?"Unmute":"Mute",children:m?r.jsx(mg,{className:"w-6 h-6"}):r.jsx(fg,{className:"w-6 h-6"})})}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:H,className:"p-3 text-white hover:bg-white/20 rounded-full transition-colors",title:"Rewind 10s",children:r.jsx(wb,{className:"w-6 h-6"})}),r.jsx("button",{onClick:O,className:"p-4 text-white bg-white/20 hover:bg-white/30 rounded-full transition-colors",title:y?"Pause":"Play",children:y?r.jsx(cg,{className:"w-8 h-8"}):r.jsx(Sn,{className:"w-8 h-8"})}),r.jsx("button",{onClick:q,className:"p-3 text-white hover:bg-white/20 rounded-full transition-colors",title:"Forward 10s",children:r.jsx(dg,{className:"w-6 h-6"})})]}),r.jsx("button",{onClick:k,className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",title:"Fullscreen",children:r.jsx(lg,{className:"w-6 h-6"})})]})})]})]})})}function p4(){const i=Ct(),e=K.useRef(null),t=K.useRef(null),[s,a]=K.useState(null),[l,c]=K.useState(null),[u,f]=K.useState(0),[d,m]=K.useState("all"),[g,y]=K.useState(!1),[x,v]=K.useState(null),[E,A]=K.useState(null),[R,D]=K.useState(""),{startTime:L,endTime:O}=K.useMemo(()=>{const Se=new Date,ze=new Date(Se);ze.setMinutes(0,0,0),ze.setHours(ze.getHours()+u-1);const ot=new Date(ze);return ot.setHours(ot.getHours()+6),{startTime:ze,endTime:ot}},[u]),H=new Date,q=K.useMemo(()=>{const Se=[],ze=new Date(L);for(;ze<O;)Se.push(new Date(ze)),ze.setMinutes(ze.getMinutes()+30);return Se},[L,O]),{data:U,isLoading:k}=it({queryKey:["channels"],queryFn:async()=>(await(await fetch("/livetv/channels",{headers:{"X-Plex-Token":Le.getToken()||""}})).json()).channels.filter(ot=>ot.enabled!==!1).sort((ot,vt)=>ot.number-vt.number)}),{data:M,isLoading:I}=it({queryKey:["guide"],queryFn:()=>Le.getGuide(),staleTime:300*1e3}),{data:j}=it({queryKey:["scheduled-recordings"],queryFn:()=>Le.getRecordings(),staleTime:30*1e3}),Z=K.useMemo(()=>{const Se=new Map;return j&&j.filter(ze=>ze.status==="scheduled"||ze.status==="recording").forEach(ze=>{const ot=`${ze.channelId}-${ze.startTime}`;Se.set(ot,{status:ze.status,recordingId:ze.id})}),Se},[j]),ae=K.useCallback((Se,ze)=>{const ot=`${Se}-${ze}`;return Z.get(ot)?.status||null},[Z]),ie=K.useCallback((Se,ze)=>{const ot=`${Se}-${ze}`;return Z.get(ot)?.recordingId||null},[Z]),re=K.useMemo(()=>M?.programs?M.programs:{},[M]),Q=K.useMemo(()=>{if(!U)return[];const Se=new Set;return U.forEach(ze=>{ze.group&&Se.add(ze.group)}),Array.from(Se).sort()},[U]),se=K.useCallback(Se=>(re[Se.channelId]||[]).length>0,[re]),oe=K.useCallback(Se=>{const ze=re[Se.channelId]||[],ot=new Date;return ze.find(vt=>new Date(vt.start)<=ot&&new Date(vt.end)>ot)},[re]),Y=K.useMemo(()=>U?U.filter(Se=>!(d!=="all"&&Se.group!==d||g&&se(Se))):[],[U,d,g,se]),V=K.useMemo(()=>{if(!U)return{};const Se={all:0};return U.forEach(ze=>{se(ze)||(Se.all++,ze.group&&(Se[ze.group]=(Se[ze.group]||0)+1))}),Se},[U,se]),$=Ze({mutationFn:async({channelId:Se,programId:ze,seriesRecord:ot})=>{const vt=await fetch("/dvr/recordings/from-program",{method:"POST",headers:{"Content-Type":"application/json","X-Plex-Token":Le.getToken()||""},body:JSON.stringify({channelId:Se,programId:ze,seriesRecord:ot})});if(!vt.ok)throw new Error("Failed to create recording");return vt.json()},onSuccess:()=>{i.invalidateQueries({queryKey:["recordings"]}),i.invalidateQueries({queryKey:["scheduled-recordings"]}),a(null)}}),X=Ze({mutationFn:async Se=>{await Le.deleteRecording(Se)},onSuccess:()=>{i.invalidateQueries({queryKey:["recordings"]}),i.invalidateQueries({queryKey:["scheduled-recordings"]}),a(null)}}),{data:me}=it({queryKey:["epgSources"],queryFn:async()=>await Le.getEPGSources()}),{data:ve}=it({queryKey:["epgChannels",E],queryFn:async()=>(await(await fetch(`/livetv/epg/channels?epgSourceId=${E}`,{headers:{"X-Plex-Token":Le.getToken()||""}})).json()).channels,enabled:!!E&&!!x}),pe=K.useMemo(()=>{if(!ve)return[];if(!R.trim())return ve;const Se=R.toLowerCase();return ve.filter(ze=>ze.callSign?.toLowerCase().includes(Se)||ze.channelNo?.toLowerCase().includes(Se)||ze.channelId.toLowerCase().includes(Se)||ze.sampleTitle?.toLowerCase().includes(Se))},[ve,R]),ge=Ze({mutationFn:async({channelId:Se,epgSourceId:ze,epgChannelId:ot})=>{const vt=await fetch(`/livetv/channels/${Se}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Plex-Token":Le.getToken()||""},body:JSON.stringify({epgSourceId:ze,channelId:ot})});if(!vt.ok)throw new Error("Failed to map channel");return vt.json()},onSuccess:async()=>{await i.refetchQueries({queryKey:["channels"]}),await i.refetchQueries({queryKey:["guide"]}),v(null),D("")}}),ee=Ze({mutationFn:async Se=>{const ze=await fetch(`/livetv/channels/${Se}/epg-mapping`,{method:"DELETE",headers:{"X-Plex-Token":Le.getToken()||""}});if(!ze.ok)throw new Error("Failed to unmap channel");return ze.json()},onSuccess:async()=>{await i.refetchQueries({queryKey:["channels"]}),await i.refetchQueries({queryKey:["guide"]}),v(null)}}),[ye,Ie]=K.useState(null),Ue=Ze({mutationFn:async()=>{const Se=await fetch("/livetv/channels/auto-detect?apply=true&unmappedOnly=true",{method:"POST",headers:{"X-Plex-Token":Le.getToken()||""}});if(!Se.ok)throw new Error("Failed to auto-detect EPG mappings");return Se.json()},onSuccess:async Se=>{await i.refetchQueries({queryKey:["channels"]}),await i.refetchQueries({queryKey:["guide"]}),Ie(Se)}});K.useEffect(()=>{x&&me&&me.length>0&&!E&&A(me[0].id)},[x,me,E]);const qe=K.useCallback(()=>{e.current&&t.current&&(t.current.scrollTop=e.current.scrollTop)},[]);K.useEffect(()=>{if(e.current&&u===0){const ze=(H.getTime()-L.getTime())/6e4*rr-100;e.current.scrollLeft=Math.max(0,ze)}},[L,u]);const ue=(O.getTime()-L.getTime())/6e4*rr,Be=(H.getTime()-L.getTime())/6e4*rr,Ge=Y,yt=k||I,He=U?.length||0,dt=Se=>{s&&$.mutate({channelId:s.channel?.id||0,programId:s.program.id,seriesRecord:Se})},Ot=()=>f(Se=>Se-3),ns=()=>f(Se=>Se+3),os=()=>f(0);return r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-white",children:"TV Guide"}),r.jsx("p",{className:"text-gray-400 mt-1",children:"Browse the program schedule and record shows"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>{i.refetchQueries({queryKey:["channels"]}),i.refetchQueries({queryKey:["guide"]})},className:"p-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors",title:"Refresh EPG data",children:r.jsx(vs,{className:`h-5 w-5 ${k||I?"animate-spin":""}`})}),r.jsx("div",{className:"h-6 w-px bg-gray-600"}),r.jsx("button",{onClick:Ot,className:"p-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors",children:r.jsx(MN,{className:"h-5 w-5"})}),r.jsx("button",{onClick:os,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors",children:"Now"}),r.jsx("button",{onClick:ns,className:"p-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors",children:r.jsx(md,{className:"h-5 w-5"})})]})]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("label",{className:"text-sm text-gray-400",children:"Provider:"}),r.jsxs("select",{value:d,onChange:Se=>m(Se.target.value),className:"px-3 py-1.5 bg-gray-700 border border-gray-600 rounded text-white text-sm min-w-[180px]",children:[r.jsxs("option",{value:"all",children:["All Groups (",He," channels)"]}),Q.map(Se=>r.jsxs("option",{value:Se,children:[Se," (",U?.filter(ze=>ze.group===Se).length||0,")",V[Se]>0&&` - ${V[Se]} need EPG`]},Se))]})]}),r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:g,onChange:Se=>y(Se.target.checked),className:"w-4 h-4 rounded border-gray-500 bg-gray-600 text-red-600 focus:ring-red-500"}),r.jsxs("span",{className:"text-sm text-gray-400",children:["Show only channels without EPG",V.all>0&&r.jsxs("span",{className:"ml-1 text-red-400",children:["(",V.all,")"]})]})]}),V.all>0&&r.jsxs("button",{onClick:()=>Ue.mutate(),disabled:Ue.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 text-white text-sm font-medium rounded-lg transition-colors",children:[r.jsx(Qu,{className:`h-4 w-4 ${Ue.isPending?"animate-spin":""}`}),Ue.isPending?"Detecting...":"Auto-Detect EPG"]}),r.jsx("div",{className:"h-6 w-px bg-gray-700"}),Object.entries(Kg).map(([Se,ze])=>r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:`w-4 h-4 rounded ${ze}`}),r.jsx("span",{className:"text-sm text-gray-400",children:Se})]},Se))]}),yt?r.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-800 rounded-xl",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-500 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-400",children:"Loading TV Guide..."})]})}):r.jsxs("div",{className:"flex-1 bg-gray-800 rounded-xl overflow-hidden flex flex-col min-h-0",children:[r.jsxs("div",{className:"flex flex-shrink-0 border-b border-gray-700",children:[r.jsxs("div",{className:"flex-shrink-0 bg-gray-900 border-r border-gray-700 flex items-center justify-center flex-col",style:{width:B_,height:U_},children:[r.jsxs("span",{className:"text-sm font-semibold text-gray-400",children:[Ge.length," Channels"]}),Ge.length!==He&&r.jsxs("span",{className:"text-xs text-gray-500",children:["of ",He]})]}),r.jsx("div",{className:"flex-1 overflow-hidden",children:r.jsxs("div",{className:"relative bg-gray-900",style:{width:ue,height:U_},children:[q.map((Se,ze)=>r.jsx("div",{className:"absolute top-0 bottom-0 border-l border-gray-700 flex items-center px-3",style:{left:(Se.getTime()-L.getTime())/6e4*rr},children:r.jsx("span",{className:"text-sm font-medium text-gray-300",children:ur(Se)})},ze)),Be>0&&Be<ue&&r.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-red-500 z-20",style:{left:Be},children:r.jsx("div",{className:"absolute -top-0 left-1/2 -translate-x-1/2 w-3 h-3 bg-red-500 rounded-full"})})]})})]}),r.jsxs("div",{className:"flex flex-1 min-h-0",children:[r.jsx("div",{ref:t,className:"flex-shrink-0 overflow-hidden border-r border-gray-700",style:{width:B_},children:r.jsx("div",{children:Ge.map(Se=>{const ze=se(Se);return r.jsxs("div",{className:`flex items-center gap-2 px-3 border-b border-gray-700/50 hover:bg-gray-750 cursor-pointer group ${ze?"bg-gray-800":"bg-red-900/20"}`,style:{height:cm},onClick:()=>{Se.streamUrl&&c({channel:Se,program:oe(Se)})},children:[r.jsx("button",{onClick:ot=>{ot.stopPropagation(),Se.streamUrl&&c({channel:Se,program:oe(Se)})},className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 transition-all ${Se.streamUrl?"bg-green-600 hover:bg-green-500 text-white opacity-70 group-hover:opacity-100":"bg-gray-700 text-gray-500 cursor-not-allowed"}`,title:Se.streamUrl?"Watch Now":"No stream available",disabled:!Se.streamUrl,children:r.jsx(Sn,{className:"h-4 w-4 ml-0.5"})}),Se.logo?r.jsx("img",{src:Se.logo,alt:Se.name,className:"w-10 h-7 object-contain bg-gray-700 rounded flex-shrink-0",onError:ot=>{ot.target.style.display="none"}}):r.jsx("div",{className:"w-10 h-7 bg-gray-700 rounded flex items-center justify-center text-xs text-gray-400 flex-shrink-0",children:Se.number}),r.jsxs("div",{className:"min-w-0 flex-1",children:[r.jsx("div",{className:"text-sm font-medium text-white truncate",children:Se.name}),r.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1 flex-wrap",children:["Ch ",Se.number,Se.sourceName&&r.jsxs("span",{className:"text-indigo-400",children:[" ",Se.sourceName]}),ze?r.jsxs("button",{onClick:ot=>{ot.stopPropagation(),v(Se)},className:"ml-1 px-1.5 py-0.5 bg-gray-600 hover:bg-gray-500 text-white text-xs rounded transition-colors flex items-center gap-0.5 opacity-60 hover:opacity-100",title:"Change EPG mapping",children:[r.jsx(fu,{className:"h-3 w-3"}),"Re-map"]}):r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"text-red-400 font-medium",children:" No EPG"}),r.jsxs("button",{onClick:ot=>{ot.stopPropagation(),v(Se)},className:"ml-1 px-1.5 py-0.5 bg-indigo-600 hover:bg-indigo-700 text-white text-xs rounded transition-colors flex items-center gap-0.5",title:"Map to EPG channel",children:[r.jsx(fu,{className:"h-3 w-3"}),"Map"]})]})]})]})]},Se.id)})})}),r.jsx("div",{ref:e,className:"flex-1 overflow-auto",onScroll:qe,children:r.jsxs("div",{className:"relative",style:{width:ue,minWidth:"100%"},children:[Be>0&&Be<ue&&r.jsx("div",{className:"absolute w-0.5 bg-red-500 z-10 pointer-events-none",style:{left:Be,top:0,height:Ge.length*cm}}),Ge.map(Se=>{const ze=re[Se.channelId]||[];return r.jsxs("div",{className:"relative border-b border-gray-700/50",style:{height:cm},children:[q.map((ot,vt)=>r.jsx("div",{className:"absolute top-0 bottom-0 border-l border-gray-700/30",style:{left:(ot.getTime()-L.getTime())/6e4*rr}},vt)),ze.map(ot=>{const vt=new Date(ot.start),Zs=new Date(ot.end);if(Zs<=L||vt>=O)return null;const Ms=vt<L?L:vt,Di=Zs>O?O:Zs,mi=(Ms.getTime()-L.getTime())/6e4*rr,Xi=(Di.getTime()-Ms.getTime())/6e4*rr,Qi=H>=vt&&H<Zs,Js=ae(Se.id,ot.start);return r.jsx(f4,{program:ot,startOffset:mi,width:Xi,isNow:Qi,isScheduled:Js==="scheduled",isRecording:Js==="recording",onClick:()=>a({program:ot,channel:Se})},ot.id)}),ze.filter(ot=>{const vt=new Date(ot.start);return!(new Date(ot.end)<=L||vt>=O)}).length===0&&r.jsx("div",{className:"absolute inset-1 flex items-center justify-center",children:r.jsx("span",{className:"text-xs text-gray-600",children:"No program info"})})]},Se.id)})]})})]})]}),s&&r.jsx(m4,{program:s.program,channel:s.channel,onClose:()=>a(null),onRecord:dt,onWatchNow:()=>{s.channel?.streamUrl&&c({channel:s.channel,program:s.program}),a(null)},isRecording:$.isPending,scheduledStatus:s.channel?ae(s.channel.id,s.program.start):null,onCancelRecording:()=>{if(s.channel){const Se=ie(s.channel.id,s.program.start);Se&&X.mutate(Se)}}}),l&&r.jsx(g4,{channel:l.channel,program:l.program,onClose:()=>c(null)}),x&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4",onClick:()=>v(null),children:r.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl flex flex-col",onClick:Se=>Se.stopPropagation(),children:[r.jsxs("div",{className:"p-4 border-b border-gray-700 flex-shrink-0",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[r.jsx(fu,{className:"h-5 w-5"}),"Map EPG Channel"]}),r.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["Map ",r.jsxs("span",{className:"text-indigo-400 font-medium",children:["Ch ",x.number," - ",x.name]})," to an EPG channel"]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[se(x)&&r.jsxs("button",{onClick:()=>ee.mutate(x.id),disabled:ee.isPending,className:"px-3 py-1.5 bg-red-600 hover:bg-red-700 disabled:opacity-50 text-white text-sm rounded-lg transition-colors flex items-center gap-1.5",children:[r.jsx(jt,{className:"h-4 w-4"}),ee.isPending?"Removing...":"Remove Mapping"]}),r.jsx("button",{onClick:()=>v(null),className:"p-1.5 bg-gray-700 hover:bg-gray-600 rounded-full transition-colors",children:r.jsx(jt,{className:"h-5 w-5 text-white"})})]})]}),me&&me.length>0&&r.jsxs("div",{className:"mt-3",children:[r.jsx("label",{className:"text-sm text-gray-400 mb-1 block",children:"EPG Source:"}),r.jsx("select",{value:E||"",onChange:Se=>{A(parseInt(Se.target.value)),D("")},className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white text-sm",children:me.map(Se=>r.jsxs("option",{value:Se.id,children:[Se.name," (",Se.channelCount," channels)"]},Se.id))})]}),r.jsxs("div",{className:"relative mt-3",children:[r.jsx(Xs,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Search by call sign, channel number, or title...",value:R,onChange:Se=>D(Se.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 text-sm",autoFocus:!0})]}),r.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:[pe.length," channel",pe.length!==1?"s":""," found",R&&` for "${R}"`]})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:ve?pe.length===0?r.jsx("div",{className:"text-center py-8 text-gray-400",children:r.jsx("p",{children:"No channels match your search"})}):r.jsxs("div",{className:"space-y-2",children:[pe.slice(0,100).map(Se=>r.jsx("button",{onClick:()=>{E&&ge.mutate({channelId:x.id,epgSourceId:E,epgChannelId:Se.channelId})},disabled:ge.isPending,className:"w-full p-3 bg-gray-700 hover:bg-gray-600 rounded-lg text-left transition-colors disabled:opacity-50",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"min-w-0 flex-1",children:[r.jsxs("div",{className:"text-white font-medium",children:[Se.callSign||Se.channelId,Se.channelNo&&r.jsxs("span",{className:"text-gray-400 font-normal ml-2",children:["Ch ",Se.channelNo]})]}),r.jsx("div",{className:"text-sm text-gray-400 truncate",children:Se.sampleTitle})]}),r.jsx(fu,{className:"h-4 w-4 text-gray-500 flex-shrink-0 ml-2"})]})},Se.channelId)),pe.length>100&&r.jsx("p",{className:"text-center text-sm text-gray-500 py-2",children:"Showing first 100 results. Use search to narrow down."})]}):r.jsxs("div",{className:"text-center py-8 text-gray-400",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto mb-3"}),r.jsx("p",{children:"Loading EPG channels..."})]})})]})}),ye&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4",onClick:()=>Ie(null),children:r.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl flex flex-col",onClick:Se=>Se.stopPropagation(),children:[r.jsxs("div",{className:"p-4 border-b border-gray-700 flex-shrink-0",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[r.jsx(Qu,{className:"h-5 w-5 text-indigo-400"}),"Auto-Detect Results"]}),r.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"EPG channel mapping completed"})]}),r.jsx("button",{onClick:()=>Ie(null),className:"p-1.5 bg-gray-700 hover:bg-gray-600 rounded-full transition-colors",children:r.jsx(jt,{className:"h-5 w-5 text-white"})})]}),r.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mt-4",children:[r.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-3 text-center",children:[r.jsx("div",{className:"text-2xl font-bold text-white",children:ye.summary.totalChannels}),r.jsx("div",{className:"text-xs text-gray-400",children:"Scanned"})]}),r.jsxs("div",{className:"bg-green-600/20 rounded-lg p-3 text-center",children:[r.jsx("div",{className:"text-2xl font-bold text-green-400",children:ye.summary.newMappings}),r.jsx("div",{className:"text-xs text-gray-400",children:"New Mappings"})]}),r.jsxs("div",{className:"bg-blue-600/20 rounded-lg p-3 text-center",children:[r.jsx("div",{className:"text-2xl font-bold text-blue-400",children:ye.summary.alreadyMapped}),r.jsx("div",{className:"text-xs text-gray-400",children:"Already Mapped"})]}),r.jsxs("div",{className:"bg-yellow-600/20 rounded-lg p-3 text-center",children:[r.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:ye.summary.noMatchFound}),r.jsx("div",{className:"text-xs text-gray-400",children:"No Match"})]})]})]}),r.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[ye.results.filter(Se=>Se.autoMapped).length>0&&r.jsxs(r.Fragment,{children:[r.jsx("h3",{className:"text-sm font-semibold text-green-400 mb-2",children:"Successfully Mapped"}),r.jsx("div",{className:"space-y-2 mb-4",children:ye.results.filter(Se=>Se.autoMapped).map(Se=>r.jsxs("div",{className:"p-3 bg-green-600/10 border border-green-600/30 rounded-lg",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-white font-medium",children:Se.channelName}),Se.bestMatch&&r.jsxs("span",{className:"text-green-400 ml-2",children:[" ",Se.bestMatch.epgCallSign||Se.bestMatch.epgName]})]}),Se.bestMatch&&r.jsxs("span",{className:"text-xs bg-green-600/30 text-green-300 px-2 py-1 rounded",children:[Math.round(Se.bestMatch.confidence*100),"%  ",Se.bestMatch.matchStrategy]})]}),Se.bestMatch?.matchReason&&r.jsx("div",{className:"text-xs text-gray-400 mt-1",children:Se.bestMatch.matchReason})]},Se.channelId))})]}),ye.results.filter(Se=>!Se.autoMapped&&!Se.currentMapping).length>0&&r.jsxs(r.Fragment,{children:[r.jsx("h3",{className:"text-sm font-semibold text-yellow-400 mb-2",children:"No Match Found"}),r.jsx("div",{className:"space-y-2",children:ye.results.filter(Se=>!Se.autoMapped&&!Se.currentMapping).map(Se=>r.jsx("div",{className:"p-3 bg-yellow-600/10 border border-yellow-600/30 rounded-lg",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-white",children:Se.channelName}),r.jsx("button",{onClick:()=>{const ze=U?.find(ot=>ot.id===Se.channelId);ze&&(Ie(null),v(ze))},className:"text-xs bg-gray-600 hover:bg-gray-500 text-white px-2 py-1 rounded transition-colors",children:"Map Manually"})]})},Se.channelId))})]})]}),r.jsx("div",{className:"p-4 border-t border-gray-700 flex-shrink-0",children:r.jsx("button",{onClick:()=>Ie(null),className:"w-full py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition-colors",children:"Done"})})]})})]})}const y4=[{id:"tonight",name:"Tonight",icon:Li,color:"bg-indigo-600"},{id:"movies",name:"Movies",icon:Ki,color:"bg-purple-600"},{id:"sports",name:"Sports",icon:Da,color:"bg-green-600"},{id:"kids",name:"Kids",icon:_b,color:"bg-orange-500"},{id:"news",name:"News",icon:Eb,color:"bg-red-600"},{id:"premieres",name:"Premieres",icon:Nb,color:"bg-yellow-500"},{id:"week",name:"This Week",icon:bn,color:"bg-blue-600"}];function x4(i){return new Date(i).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function v4(i){const e=new Date(i),t=new Date,s=new Date(t);return s.setDate(s.getDate()+1),e.toDateString()===t.toDateString()?"Today":e.toDateString()===s.toDateString()?"Tomorrow":e.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"})}function _4(i,e){const t=new Date(i),s=new Date(e),a=Math.round((s.getTime()-t.getTime())/6e4),l=Math.floor(a/60),c=a%60;return l>0?c>0?`${l}h ${c}m`:`${l}h`:`${c}m`}function b4({item:i,onRecord:e,isRecording:t}){const{program:s,channel:a,hasRecording:l}=i,c=u=>{u.stopPropagation(),!l&&a&&e()};return r.jsxs("div",{className:"bg-gray-800 rounded-lg overflow-hidden hover:ring-2 hover:ring-indigo-500 transition-all cursor-pointer",children:[r.jsxs("div",{className:"relative aspect-video bg-gray-700",children:[s.icon||s.art?r.jsx("img",{src:s.icon||s.art,alt:s.title,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full flex items-center justify-center",children:r.jsx(Qs,{className:"w-12 h-12 text-gray-600"})}),r.jsxs("div",{className:"absolute top-2 left-2 flex gap-1",children:[s.isLive&&r.jsxs("span",{className:"px-2 py-0.5 bg-red-600 text-white text-xs font-medium rounded flex items-center gap-1",children:[r.jsx(vo,{className:"w-2 h-2 fill-current"}),"LIVE"]}),s.isNew&&r.jsx("span",{className:"px-2 py-0.5 bg-green-600 text-white text-xs font-medium rounded",children:"NEW"}),s.isPremiere&&r.jsx("span",{className:"px-2 py-0.5 bg-yellow-500 text-black text-xs font-medium rounded",children:"PREMIERE"})]}),l&&r.jsx("div",{className:"absolute top-2 right-2",children:r.jsxs("span",{className:"px-2 py-0.5 bg-red-600 text-white text-xs font-medium rounded flex items-center gap-1",children:[r.jsx(pr,{className:"w-3 h-3"}),"REC"]})}),r.jsx("div",{className:"absolute bottom-2 right-2",children:r.jsx("span",{className:"px-2 py-0.5 bg-black/70 text-white text-xs rounded",children:_4(s.start,s.end)})})]}),r.jsxs("div",{className:"p-3",children:[r.jsxs("div",{className:"flex items-start justify-between gap-2",children:[r.jsx("h3",{className:"font-medium text-white truncate flex-1",children:s.title}),a&&r.jsx("button",{onClick:c,disabled:l||t,className:`flex-shrink-0 p-1.5 rounded-full transition-colors ${l?"bg-red-600 text-white cursor-default":t?"bg-gray-600 text-gray-400":"bg-gray-700 text-gray-300 hover:bg-red-600 hover:text-white"}`,title:l?"Recording scheduled":"Record this program",children:t?r.jsx(Yn,{className:"w-4 h-4 animate-spin"}):l?r.jsx(Ys,{className:"w-4 h-4"}):r.jsx(pr,{className:"w-4 h-4"})})]}),s.subtitle&&r.jsx("p",{className:"text-sm text-gray-400 truncate",children:s.subtitle}),r.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-gray-400",children:[r.jsxs("span",{className:"font-medium text-indigo-400",children:[v4(s.start)," ",x4(s.start)]}),a&&r.jsxs(r.Fragment,{children:[r.jsx("span",{children:""}),r.jsx("span",{className:"truncate",children:a.name})]})]}),r.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[s.category&&r.jsx("span",{className:"px-2 py-0.5 bg-gray-700 text-gray-300 text-xs rounded",children:s.category}),s.league&&r.jsx("span",{className:"px-2 py-0.5 bg-green-900 text-green-300 text-xs rounded",children:s.league}),s.rating&&r.jsx("span",{className:"px-2 py-0.5 bg-gray-700 text-gray-300 text-xs rounded",children:s.rating})]}),s.teams&&r.jsx("p",{className:"mt-1 text-xs text-gray-500 truncate",children:s.teams})]})]})}function S4(){const i=Ct(),[e,t]=K.useState("tonight"),[s,a]=K.useState(""),[l,c]=K.useState(""),[u,f]=K.useState(null),d=Ze({mutationFn:async()=>(await fetch("/api/onlater/enrich?limit=200",{method:"POST",headers:{"X-Plex-Token":Le.getToken()||""}})).json(),onSuccess:()=>{setTimeout(()=>{i.invalidateQueries({queryKey:["onlater"]})},5e3)}}),[m,g]=K.useState(null),y=Ze({mutationFn:async({programId:q,channelId:U,seriesRecord:k})=>{f(q);const M=await fetch("/api/dvr/recordings/from-program",{method:"POST",headers:{"Content-Type":"application/json","X-Plex-Token":Le.getToken()||""},body:JSON.stringify({programId:q,channelId:U,seriesRecord:k||!1})});if(!M.ok)throw new Error("Failed to schedule recording");return M.json()},onSuccess:()=>{i.invalidateQueries({queryKey:["onlater"]}),i.invalidateQueries({queryKey:["onlater-search"]}),f(null),g(null)},onError:()=>{f(null)}}),x=(q,U,k)=>{y.mutate({programId:q,channelId:U,seriesRecord:k})},v=q=>{g(q)},{data:E}=it({queryKey:["onlater-stats"],queryFn:async()=>(await fetch("/api/onlater/stats",{headers:{"X-Plex-Token":Le.getToken()||""}})).json()}),{data:A,isLoading:R}=it({queryKey:["onlater",e,l],queryFn:async()=>{let q=`/api/onlater/${e}`;const U=new URLSearchParams;e==="sports"&&l&&U.set("league",l);const k=U.toString()?`${q}?${U}`:q;return(await fetch(k,{headers:{"X-Plex-Token":Le.getToken()||""}})).json()}}),{data:D,isLoading:L}=it({queryKey:["onlater-search",s],queryFn:async()=>(await fetch(`/api/onlater/search?q=${encodeURIComponent(s)}`,{headers:{"X-Plex-Token":Le.getToken()||""}})).json(),enabled:s.length>2}),{data:O}=it({queryKey:["onlater-leagues"],queryFn:async()=>(await fetch("/api/onlater/leagues",{headers:{"X-Plex-Token":Le.getToken()||""}})).json()}),H=s.length>2?D?.items:A?.items;return r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-white",children:"On Later"}),r.jsx("p",{className:"text-gray-400",children:"Browse upcoming content from your EPG"})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("button",{onClick:()=>d.mutate(),disabled:d.isPending,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-500 transition-colors disabled:opacity-50",title:"Fetch artwork from TMDB for programs missing images",children:[d.isPending?r.jsx(Yn,{className:"w-4 h-4 animate-spin"}):r.jsx(d2,{className:"w-4 h-4"}),"Enrich Artwork"]}),r.jsxs("div",{className:"relative",children:[r.jsx(Xs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Search upcoming...",value:s,onChange:q=>a(q.target.value),className:"pl-9 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 w-64"})]})]})]}),E&&r.jsxs("div",{className:"grid grid-cols-5 gap-4 mb-6",children:[r.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 text-purple-400",children:[r.jsx(Ki,{className:"w-5 h-5"}),r.jsx("span",{className:"text-2xl font-bold",children:E.movies})]}),r.jsx("p",{className:"text-sm text-gray-400",children:"Movies"})]}),r.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 text-green-400",children:[r.jsx(Da,{className:"w-5 h-5"}),r.jsx("span",{className:"text-2xl font-bold",children:E.sports})]}),r.jsx("p",{className:"text-sm text-gray-400",children:"Sports"})]}),r.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 text-orange-400",children:[r.jsx(_b,{className:"w-5 h-5"}),r.jsx("span",{className:"text-2xl font-bold",children:E.kids})]}),r.jsx("p",{className:"text-sm text-gray-400",children:"Kids"})]}),r.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 text-red-400",children:[r.jsx(Eb,{className:"w-5 h-5"}),r.jsx("span",{className:"text-2xl font-bold",children:E.news})]}),r.jsx("p",{className:"text-sm text-gray-400",children:"News"})]}),r.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 text-yellow-400",children:[r.jsx(Nb,{className:"w-5 h-5"}),r.jsx("span",{className:"text-2xl font-bold",children:E.premieres})]}),r.jsx("p",{className:"text-sm text-gray-400",children:"Premieres"})]})]}),r.jsx("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:y4.map(q=>r.jsxs("button",{onClick:()=>{t(q.id),a("")},className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${e===q.id?`${q.color} text-white`:"bg-gray-800 text-gray-300 hover:bg-gray-700"}`,children:[r.jsx(q.icon,{className:"w-4 h-4"}),q.name]},q.id))}),e==="sports"&&O?.leagues&&r.jsxs("div",{className:"flex gap-2 mb-6",children:[r.jsx("button",{onClick:()=>c(""),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${l?"bg-gray-800 text-gray-300 hover:bg-gray-700":"bg-green-600 text-white"}`,children:"All Leagues"}),O.leagues.map(q=>r.jsx("button",{onClick:()=>c(q),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${l===q?"bg-green-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"}`,children:q},q))]}),R||L?r.jsx("div",{className:"flex items-center justify-center py-12",children:r.jsx(Yn,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):H&&H.length>0?r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:H.map(q=>r.jsx(b4,{item:q,onRecord:()=>v(q),isRecording:u===q.program.id},q.program.id))}):r.jsxs("div",{className:"text-center py-12",children:[r.jsx(Qs,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No upcoming content"}),r.jsx("p",{className:"text-gray-400",children:s?`No results found for "${s}"`:"Check back later or try a different category"})]}),H&&H.length>0&&r.jsxs("div",{className:"mt-6 text-center text-sm text-gray-400",children:["Showing ",H.length," programs"]}),m&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md mx-4 shadow-2xl",children:[r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-lg font-semibold text-white",children:"Record Program"}),r.jsx("p",{className:"text-gray-400 text-sm mt-1",children:m.program.title})]}),r.jsx("button",{onClick:()=>g(null),className:"p-1 text-gray-400 hover:text-white hover:bg-gray-700 rounded",children:r.jsx(jt,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("button",{onClick:()=>{m.channel&&x(m.program.id,m.channel.id,!1)},disabled:y.isPending,className:"w-full flex items-center gap-4 p-4 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors text-left",children:[r.jsx("div",{className:"flex-shrink-0 p-2 bg-indigo-600 rounded-lg",children:r.jsx(pr,{className:"w-5 h-5 text-white"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"font-medium text-white",children:"Record This Episode"}),r.jsx("p",{className:"text-sm text-gray-400",children:"Record only this airing"})]}),y.isPending&&r.jsx(Yn,{className:"w-5 h-5 text-indigo-400 animate-spin"})]}),r.jsxs("button",{onClick:()=>{m.channel&&x(m.program.id,m.channel.id,!0)},disabled:y.isPending,className:"w-full flex items-center gap-4 p-4 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors text-left",children:[r.jsx("div",{className:"flex-shrink-0 p-2 bg-purple-600 rounded-lg",children:r.jsx(zR,{className:"w-5 h-5 text-white"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"font-medium text-white",children:"Record Series"}),r.jsx("p",{className:"text-sm text-gray-400",children:"Record all future episodes with this title"})]}),y.isPending&&r.jsx(Yn,{className:"w-5 h-5 text-purple-400 animate-spin"})]})]}),r.jsx("button",{onClick:()=>g(null),className:"w-full mt-4 py-2 text-gray-400 hover:text-white transition-colors",children:"Cancel"})]})})]})}const E4=["NFL","NBA","MLB","NHL","MLS"];function T4(){const i=Ct(),[e,t]=K.useState(!1),[s,a]=K.useState(null),[l,c]=K.useState(null),[u,f]=K.useState(""),[d,m]=K.useState("NFL"),{data:g,isLoading:y}=it({queryKey:["teamPasses"],queryFn:async()=>(await fetch("/api/teampass",{headers:{"X-Plex-Token":Le.getToken()||""}})).json()}),{data:x}=it({queryKey:["teamPassStats"],queryFn:async()=>(await fetch("/api/teampass/stats",{headers:{"X-Plex-Token":Le.getToken()||""}})).json()}),{data:v}=it({queryKey:["leagueTeams",d],queryFn:async()=>(await fetch(`/api/teampass/leagues/${d}/teams`,{headers:{"X-Plex-Token":Le.getToken()||""}})).json(),enabled:e||s!==null}),{data:E}=it({queryKey:["teamSearch",u],queryFn:async()=>(await fetch(`/api/teampass/teams/search?q=${encodeURIComponent(u)}`,{headers:{"X-Plex-Token":Le.getToken()||""}})).json(),enabled:u.length>=2}),{data:A}=it({queryKey:["teamPassUpcoming",l?.id],queryFn:async()=>(await fetch(`/api/teampass/${l.id}/upcoming`,{headers:{"X-Plex-Token":Le.getToken()||""}})).json(),enabled:l!==null}),R=Ze({mutationFn:async k=>(await fetch("/api/teampass",{method:"POST",headers:{"Content-Type":"application/json","X-Plex-Token":Le.getToken()||""},body:JSON.stringify(k)})).json(),onSuccess:()=>{i.invalidateQueries({queryKey:["teamPasses"]}),i.invalidateQueries({queryKey:["teamPassStats"]}),t(!1)}}),D=Ze({mutationFn:async({id:k,data:M})=>(await fetch(`/api/teampass/${k}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Plex-Token":Le.getToken()||""},body:JSON.stringify(M)})).json(),onSuccess:()=>{i.invalidateQueries({queryKey:["teamPasses"]}),a(null)}}),L=Ze({mutationFn:async k=>{await fetch(`/api/teampass/${k}`,{method:"DELETE",headers:{"X-Plex-Token":Le.getToken()||""}})},onSuccess:()=>{i.invalidateQueries({queryKey:["teamPasses"]}),i.invalidateQueries({queryKey:["teamPassStats"]})}}),O=Ze({mutationFn:async k=>(await fetch(`/api/teampass/${k}/toggle`,{method:"PUT",headers:{"X-Plex-Token":Le.getToken()||""}})).json(),onSuccess:()=>{i.invalidateQueries({queryKey:["teamPasses"]})}}),H=Ze({mutationFn:async()=>(await fetch("/api/teampass/process",{method:"POST",headers:{"X-Plex-Token":Le.getToken()||""}})).json(),onSuccess:()=>{i.invalidateQueries({queryKey:["teamPassStats"]})}}),q=g?.teamPasses||[],U=u.length>=2?E?.teams||[]:v?.teams||[];return r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-white",children:"Team Pass"}),r.jsx("p",{className:"text-gray-400",children:"Auto-record games for your favorite sports teams"})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsxs("button",{onClick:()=>H.mutate(),disabled:H.isPending,className:"flex items-center gap-2 px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors",children:[H.isPending?r.jsx(Yn,{className:"w-4 h-4 animate-spin"}):r.jsx(bn,{className:"w-4 h-4"}),"Process Now"]}),r.jsxs("button",{onClick:()=>t(!0),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500 transition-colors",children:[r.jsx(Hi,{className:"w-4 h-4"}),"Add Team"]})]})]}),x&&r.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[r.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 text-orange-400",children:[r.jsx(Da,{className:"w-5 h-5"}),r.jsx("span",{className:"text-2xl font-bold",children:x.totalPasses})]}),r.jsx("p",{className:"text-sm text-gray-400",children:"Team Passes"})]}),r.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 text-green-400",children:[r.jsx(Xx,{className:"w-5 h-5"}),r.jsx("span",{className:"text-2xl font-bold",children:x.activePasses})]}),r.jsx("p",{className:"text-sm text-gray-400",children:"Active"})]}),r.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 text-blue-400",children:[r.jsx(bn,{className:"w-5 h-5"}),r.jsx("span",{className:"text-2xl font-bold",children:x.upcomingGames})]}),r.jsx("p",{className:"text-sm text-gray-400",children:"Upcoming Games"})]}),r.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 text-red-400",children:[r.jsx(Li,{className:"w-5 h-5"}),r.jsx("span",{className:"text-2xl font-bold",children:x.scheduledRecordings})]}),r.jsx("p",{className:"text-sm text-gray-400",children:"Scheduled"})]})]}),y?r.jsx("div",{className:"flex items-center justify-center py-12",children:r.jsx(Yn,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):q.length===0?r.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-lg",children:[r.jsx(Da,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No Team Passes"}),r.jsx("p",{className:"text-gray-400 mb-4",children:"Add your favorite teams to automatically record their games"}),r.jsx("button",{onClick:()=>t(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500",children:"Add Your First Team"})]}):r.jsx("div",{className:"grid gap-4",children:q.map(k=>r.jsxs("div",{className:`bg-gray-800 rounded-lg p-4 border-l-4 ${k.enabled?"border-green-500":"border-gray-600"}`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:`w-12 h-12 rounded-lg ${To(k.league)} flex items-center justify-center overflow-hidden`,children:k.logoUrl?r.jsx("img",{src:k.logoUrl,alt:k.teamName,className:"w-10 h-10 object-contain"}):r.jsx(Da,{className:"w-6 h-6 text-white"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-white",children:k.teamName}),r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[r.jsx("span",{className:`px-2 py-0.5 rounded ${To(k.league)} text-white text-xs`,children:k.league}),k.upcomingCount!==void 0&&k.upcomingCount>0&&r.jsxs("span",{className:"text-blue-400",children:[k.upcomingCount," upcoming game",k.upcomingCount!==1?"s":""]})]})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>c(k),className:"p-2 text-gray-400 hover:text-blue-400 transition-colors",title:"View upcoming games",children:r.jsx(bn,{className:"w-5 h-5"})}),r.jsx("button",{onClick:()=>O.mutate(k.id),className:`p-2 transition-colors ${k.enabled?"text-green-400 hover:text-green-300":"text-gray-500 hover:text-gray-400"}`,title:k.enabled?"Disable":"Enable",children:r.jsx(Xx,{className:"w-5 h-5"})}),r.jsx("button",{onClick:()=>a(k),className:"p-2 text-gray-400 hover:text-white transition-colors",title:"Edit",children:r.jsx(dr,{className:"w-5 h-5"})}),r.jsx("button",{onClick:()=>{confirm(`Delete team pass for ${k.teamName}?`)&&L.mutate(k.id)},className:"p-2 text-gray-400 hover:text-red-400 transition-colors",title:"Delete",children:r.jsx(an,{className:"w-5 h-5"})})]})]}),r.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-700 flex gap-6 text-sm text-gray-400",children:[r.jsxs("span",{children:["Pre-padding: ",k.prePadding,"m"]}),r.jsxs("span",{children:["Post-padding: ",k.postPadding,"m"]}),k.keepCount>0&&r.jsxs("span",{children:["Keep: ",k.keepCount," recordings"]})]})]},k.id))}),(e||s)&&r.jsx(A4,{pass:s,teams:U,selectedLeague:d,onLeagueChange:m,teamSearch:u,onTeamSearchChange:f,onClose:()=>{t(!1),a(null),f("")},onSave:k=>{s?D.mutate({id:s.id,data:k}):R.mutate(k)},isLoading:R.isPending||D.isPending}),l&&A&&r.jsx(w4,{teamPass:l,games:A.games||[],onClose:()=>c(null)})]})}function A4({pass:i,teams:e,selectedLeague:t,onLeagueChange:s,teamSearch:a,onTeamSearchChange:l,onClose:c,onSave:u,isLoading:f}){const[d,m]=K.useState({teamName:i?.teamName||"",league:i?.league||t,logoUrl:i?.logoUrl||"",prePadding:i?.prePadding??5,postPadding:i?.postPadding??60,keepCount:i?.keepCount??0,priority:i?.priority??0,enabled:i?.enabled??!0}),g=x=>{x.preventDefault(),u(d)},y=x=>{m({...d,teamName:x.name,league:x.league,logoUrl:x.logoUrl||""}),l("")};return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",children:r.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-lg p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsx("h2",{className:"text-xl font-bold text-white",children:i?"Edit Team Pass":"Add Team Pass"}),r.jsx("button",{onClick:c,className:"text-gray-400 hover:text-white",children:r.jsx(jt,{className:"w-6 h-6"})})]}),r.jsxs("form",{onSubmit:g,className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Team"}),d.teamName?r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-700 rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`w-10 h-10 rounded ${To(d.league)} flex items-center justify-center overflow-hidden`,children:d.logoUrl?r.jsx("img",{src:d.logoUrl,alt:d.teamName,className:"w-8 h-8 object-contain"}):r.jsx(Da,{className:"w-5 h-5 text-white"})}),r.jsxs("div",{children:[r.jsx("p",{className:"text-white font-medium",children:d.teamName}),r.jsx("p",{className:"text-sm text-gray-400",children:d.league})]})]}),r.jsx("button",{type:"button",onClick:()=>m({...d,teamName:"",league:t,logoUrl:""}),className:"text-gray-400 hover:text-white",children:r.jsx(jt,{className:"w-5 h-5"})})]}):r.jsxs("div",{children:[r.jsx("div",{className:"flex gap-2 mb-3",children:E4.map(x=>r.jsx("button",{type:"button",onClick:()=>{s(x),m({...d,league:x})},className:`px-3 py-1.5 rounded text-sm font-medium transition-colors ${t===x?To(x)+" text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:x},x))}),r.jsxs("div",{className:"relative mb-3",children:[r.jsx(Xs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"text",value:a,onChange:x=>l(x.target.value),placeholder:"Search teams...",className:"w-full pl-9 pr-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500"})]}),r.jsx("div",{className:"max-h-48 overflow-y-auto grid grid-cols-2 gap-2",children:e.map(x=>r.jsxs("button",{type:"button",onClick:()=>y(x),className:"p-2 bg-gray-700 rounded hover:bg-gray-600 text-left transition-colors flex items-center gap-2",children:[r.jsx("div",{className:`w-8 h-8 rounded ${To(x.league)} flex items-center justify-center overflow-hidden flex-shrink-0`,children:x.logoUrl?r.jsx("img",{src:x.logoUrl,alt:x.name,className:"w-6 h-6 object-contain"}):r.jsx(Da,{className:"w-4 h-4 text-white"})}),r.jsxs("div",{className:"min-w-0",children:[r.jsx("p",{className:"text-white text-sm font-medium truncate",children:x.name}),r.jsx("p",{className:"text-xs text-gray-400 truncate",children:x.city})]})]},x.name))})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Start Early (minutes)"}),r.jsx("input",{type:"number",value:d.prePadding,onChange:x=>m({...d,prePadding:parseInt(x.target.value)||0}),min:0,max:60,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Extend (minutes)"}),r.jsx("input",{type:"number",value:d.postPadding,onChange:x=>m({...d,postPadding:parseInt(x.target.value)||0}),min:0,max:120,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Extra time for overtime"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Keep Last N Recordings (0 = unlimited)"}),r.jsx("input",{type:"number",value:d.keepCount,onChange:x=>m({...d,keepCount:parseInt(x.target.value)||0}),min:0,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500"})]}),r.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[r.jsx("button",{type:"button",onClick:c,className:"px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600",children:"Cancel"}),r.jsxs("button",{type:"submit",disabled:!d.teamName||f,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[f&&r.jsx(Yn,{className:"w-4 h-4 animate-spin"}),i?"Save Changes":"Add Team Pass"]})]})]})]})})}function w4({teamPass:i,games:e,onClose:t}){return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",children:r.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-2xl max-h-[80vh] flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-700",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold text-white",children:i.teamName}),r.jsx("p",{className:"text-sm text-gray-400",children:"Upcoming Games"})]}),r.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white",children:r.jsx(jt,{className:"w-6 h-6"})})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.length===0?r.jsxs("div",{className:"text-center py-8",children:[r.jsx(bn,{className:"w-12 h-12 text-gray-600 mx-auto mb-3"}),r.jsx("p",{className:"text-gray-400",children:"No upcoming games found"})]}):r.jsx("div",{className:"space-y-3",children:e.map((s,a)=>r.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-white",children:s.program.title}),s.program.teams&&r.jsx("p",{className:"text-sm text-gray-300",children:s.program.teams})]}),s.program.league&&r.jsx("span",{className:`px-2 py-0.5 rounded text-xs text-white ${To(s.program.league)}`,children:s.program.league})]}),r.jsxs("div",{className:"mt-2 flex items-center gap-4 text-sm text-gray-400",children:[r.jsx("span",{className:"text-blue-400",children:N4(s.program.start)}),s.channel&&r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(Qs,{className:"w-3 h-3"}),s.channel.name]})]})]},a))})})]})})}function To(i){switch(i?.toUpperCase()){case"NFL":return"bg-blue-600";case"NBA":return"bg-orange-600";case"MLB":return"bg-red-600";case"NHL":return"bg-gray-600";case"MLS":return"bg-green-600";default:return"bg-purple-600"}}function N4(i){const e=new Date(i),t=new Date,s=new Date(t);s.setDate(s.getDate()+1);const a=e.toDateString()===t.toDateString(),l=e.toDateString()===s.toDateString(),c=e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return a?`Today ${c}`:l?`Tomorrow ${c}`:e.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"})+` ${c}`}const Vm={scheduled:{icon:Li,color:"text-blue-400",bgColor:"bg-blue-500/10",borderColor:"border-blue-500/30",label:"Scheduled"},recording:{icon:pr,color:"text-red-400 animate-pulse",bgColor:"bg-red-500/10",borderColor:"border-red-500/30",label:"Recording"},completed:{icon:Zn,color:"text-green-400",bgColor:"bg-green-500/10",borderColor:"border-green-500/30",label:"Completed"},failed:{icon:Ns,color:"text-red-400",bgColor:"bg-red-500/10",borderColor:"border-red-500/30",label:"Failed"}};function R4(i){if(!i)return"";const e=i/(1024*1024*1024);return e>=1?`${e.toFixed(1)} GB`:`${(i/(1024*1024)).toFixed(0)} MB`}function C4(i){if(!i)return"";const e=Math.floor(i/60),t=i%60;return e>0?t>0?`${e}h ${t}m`:`${e}h`:`${t}m`}function jE(i,e){const t=new Date(i),s=new Date(e),a={hour:"numeric",minute:"2-digit"};return`${t.toLocaleTimeString([],a)} - ${s.toLocaleTimeString([],a)}`}function OE(i){const e=new Date(i),t=new Date,s=new Date(t);return s.setDate(s.getDate()+1),e.toDateString()===t.toDateString()?"Today":e.toDateString()===s.toDateString()?"Tomorrow":e.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"})}function L4({onClose:i}){const e=UL(),[t,s]=K.useState(""),[a,l]=K.useState(!0),[c,u]=K.useState(5),f=async d=>{d.preventDefault(),await e.mutateAsync({title:t,anyChannel:a,anyTime:!0,keepCount:c,priority:0,prePadding:2,postPadding:5,enabled:!0}),i()};return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[r.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Create Series Rule"}),r.jsxs("form",{onSubmit:f,children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Series Title (keyword match)"}),r.jsx("input",{type:"text",value:t,onChange:d=>s(d.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"Game of Thrones",required:!0})]}),r.jsx("div",{className:"mb-4",children:r.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300",children:[r.jsx("input",{type:"checkbox",checked:a,onChange:d=>l(d.target.checked),className:"rounded bg-gray-700 border-gray-600"}),"Record from any channel"]})}),r.jsxs("div",{className:"mb-6",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Keep last"}),r.jsxs("select",{value:c,onChange:d=>u(Number(d.target.value)),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:[r.jsx("option",{value:0,children:"All recordings"}),r.jsx("option",{value:3,children:"3 recordings"}),r.jsx("option",{value:5,children:"5 recordings"}),r.jsx("option",{value:10,children:"10 recordings"}),r.jsx("option",{value:20,children:"20 recordings"})]})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{type:"button",onClick:i,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:e.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:e.isPending?"Creating...":"Create"})]})]})]})})}function D4({conflict:i,onClose:e,onResolve:t,isResolving:s}){const[a,l]=K.useState(null),c=()=>{if(a===null)return;const u=i.recordings.filter(f=>f.id!==a).map(f=>f.id);u.length>0&&t(a,u[0])};return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-lg",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Rb,{className:"w-5 h-5 text-amber-400"}),r.jsx("h2",{className:"text-lg font-semibold text-white",children:"Recording Conflict"})]}),r.jsx("button",{onClick:e,className:"p-1 text-gray-400 hover:text-white",children:r.jsx(jt,{className:"w-5 h-5"})})]}),r.jsx("p",{className:"text-gray-400 mb-4",children:"These recordings overlap in time. Select which one to keep:"}),r.jsx("div",{className:"space-y-3 mb-6",children:i.recordings.map(u=>r.jsx("button",{onClick:()=>l(u.id),className:`w-full p-4 rounded-lg border text-left transition-colors ${a===u.id?"border-indigo-500 bg-indigo-500/10":"border-gray-600 bg-gray-700 hover:border-gray-500"}`,children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-white",children:u.title}),u.channelName&&r.jsx("p",{className:"text-sm text-gray-400",children:u.channelName}),r.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[OE(u.startTime)," ",jE(u.startTime,u.endTime)]})]}),a===u.id&&r.jsx(Zn,{className:"w-5 h-5 text-indigo-400 flex-shrink-0"})]})},u.id))}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),r.jsx("button",{onClick:c,disabled:a===null||s,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg",children:s?"Resolving...":"Keep Selected"})]})]})})}function I4({recording:i,onClose:e,onSelect:t}){return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(pr,{className:"w-5 h-5 text-red-400 animate-pulse"}),r.jsx("h2",{className:"text-lg font-semibold text-white",children:"Now Recording"})]}),r.jsx("button",{onClick:e,className:"p-1 text-gray-400 hover:text-white",children:r.jsx(jt,{className:"w-5 h-5"})})]}),r.jsx("p",{className:"text-gray-300 mb-2",children:i.title}),r.jsx("p",{className:"text-gray-500 text-sm mb-6",children:"This recording is currently in progress. How would you like to watch it?"}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("button",{onClick:()=>t("start"),className:"w-full p-4 rounded-lg border border-gray-600 bg-gray-700 hover:border-indigo-500 hover:bg-gray-600 transition-colors text-left",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-indigo-500/20 rounded-lg",children:r.jsx(Tb,{className:"w-5 h-5 text-indigo-400"})}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-white",children:"Watch from Start"}),r.jsx("p",{className:"text-sm text-gray-400",children:"Begin playback from the beginning"})]})]})}),r.jsx("button",{onClick:()=>t("live"),className:"w-full p-4 rounded-lg border border-gray-600 bg-gray-700 hover:border-red-500 hover:bg-gray-600 transition-colors text-left",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-red-500/20 rounded-lg",children:r.jsx(vr,{className:"w-5 h-5 text-red-400"})}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-white",children:"Watch Live"}),r.jsx("p",{className:"text-sm text-gray-400",children:"Jump to the current live position"})]})]})})]}),r.jsx("button",{onClick:e,className:"w-full mt-4 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg",children:"Cancel"})]})})}function k4({recording:i,onResume:e,onStartOver:t}){const s=a=>{const l=Math.floor(a/1e3),c=Math.floor(l/3600),u=Math.floor(l%3600/60),f=l%60;return c>0?`${c}:${u.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`:`${u}:${f.toString().padStart(2,"0")}`};return r.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/70",children:r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[r.jsx(Sn,{className:"w-6 h-6 text-indigo-400"}),r.jsx("h2",{className:"text-lg font-semibold text-white",children:"Resume Playback?"})]}),r.jsx("p",{className:"text-gray-300 mb-2",children:i.title}),r.jsxs("p",{className:"text-gray-500 text-sm mb-6",children:["You were watching at ",s(i.viewOffset||0),". Would you like to continue?"]}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("button",{onClick:e,className:"w-full p-4 rounded-lg border border-indigo-500 bg-indigo-500/20 hover:bg-indigo-500/30 transition-colors text-left",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-indigo-500/30 rounded-lg",children:r.jsx(Sn,{className:"w-5 h-5 text-indigo-400"})}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-white",children:"Resume"}),r.jsxs("p",{className:"text-sm text-gray-400",children:["Continue from ",s(i.viewOffset||0)]})]})]})}),r.jsx("button",{onClick:t,className:"w-full p-4 rounded-lg border border-gray-600 bg-gray-700 hover:border-gray-500 hover:bg-gray-600 transition-colors text-left",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-gray-600 rounded-lg",children:r.jsx(Tb,{className:"w-5 h-5 text-gray-400"})}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-white",children:"Start Over"}),r.jsx("p",{className:"text-sm text-gray-400",children:"Watch from the beginning"})]})]})})]})]})})}function M4({recording:i,onClose:e,startLive:t=!1}){const s=K.useRef(null),a=K.useRef(null),[l,c]=K.useState(!1),[u,f]=K.useState(0),[d,m]=K.useState(0),[g,y]=K.useState(!1),[x,v]=K.useState(!0),[E,A]=K.useState(null),[R,D]=K.useState(new Set),[L,O]=K.useState(!0),H=K.useRef(null),[q,U]=K.useState(!1),[k,M]=K.useState(null),I=K.useRef(null),j=K.useRef(0),{data:Z,isLoading:ae}=it({queryKey:["recording-stream",i.id],queryFn:()=>Le.getRecordingStreamUrl(i.id)}),{data:ie}=it({queryKey:["recording-commercials",i.id],queryFn:()=>Le.getRecordingCommercials(i.id)}),re=ie?.segments||[];K.useEffect(()=>{i.viewOffset&&i.viewOffset>1e4&&!t&&i.status==="completed"&&U(!0)},[i.viewOffset,t,i.status]),K.useEffect(()=>{const pe=()=>{const ge=s.current;if(!ge||i.status!=="completed")return;const ee=Math.floor(ge.currentTime*1e3);Math.abs(ee-j.current)>5e3&&(j.current=ee,Le.updateRecordingProgress(i.id,ee).catch(()=>{}))};return I.current=window.setInterval(pe,15e3),()=>{const ge=s.current;if(ge&&i.status==="completed"){const ee=Math.floor(ge.currentTime*1e3);Le.updateRecordingProgress(i.id,ee).catch(()=>{})}I.current&&clearInterval(I.current)}},[i.id,i.status]),K.useEffect(()=>{const pe=s.current;pe&&k!==null&&d>0&&(pe.currentTime=k,M(null))},[k,d]),K.useEffect(()=>{const pe=s.current;if(!pe||!Z)return;const ge=localStorage.getItem("token");if(Z.includes(".m3u8"))if(is.isSupported()){const ee=new is({enableWorker:!0,lowLatencyMode:!1,xhrSetup:ye=>{ge&&ye.setRequestHeader("Authorization",`Bearer ${ge}`)}});a.current=ee,ee.loadSource(Z),ee.attachMedia(pe),ee.on(is.Events.MANIFEST_PARSED,()=>{pe.play().catch(()=>{})}),ee.on(is.Events.ERROR,(ye,Ie)=>{Ie.fatal&&(console.error("HLS fatal error:",Ie.type,Ie.details),Ie.type===is.ErrorTypes.NETWORK_ERROR?ee.startLoad():Ie.type===is.ErrorTypes.MEDIA_ERROR&&ee.recoverMediaError())})}else pe.canPlayType("application/vnd.apple.mpegurl")&&(pe.src=Z,pe.play().catch(()=>{}));else pe.src=Z,pe.play().catch(()=>{});return()=>{a.current&&(a.current.destroy(),a.current=null)}},[Z]);const Q=K.useCallback(pe=>re.find(ge=>pe>=ge.startTime&&pe<ge.endTime)||null,[re]);K.useEffect(()=>{const pe=s.current;if(!pe)return;const ge=()=>{const Ue=pe.currentTime;f(Ue);const qe=Q(Ue);A(qe),qe&&x&&!R.has(qe.id)&&(D(ue=>new Set(ue).add(qe.id)),pe.currentTime=qe.endTime)},ee=()=>m(pe.duration),ye=()=>c(!0),Ie=()=>c(!1);return pe.addEventListener("timeupdate",ge),pe.addEventListener("durationchange",ee),pe.addEventListener("play",ye),pe.addEventListener("pause",Ie),()=>{pe.removeEventListener("timeupdate",ge),pe.removeEventListener("durationchange",ee),pe.removeEventListener("play",ye),pe.removeEventListener("pause",Ie)}},[x,R,Q]),K.useEffect(()=>(L&&l&&(H.current&&clearTimeout(H.current),H.current=window.setTimeout(()=>{O(!1)},3e3)),()=>{H.current&&clearTimeout(H.current)}),[L,l]),K.useEffect(()=>{if(t&&d>0&&s.current){const pe=Math.max(0,d-10);s.current.currentTime=pe}},[t,d]);const se=i.status==="recording",oe=()=>{s.current&&d>0&&(s.current.currentTime=Math.max(0,d-5))},Y=()=>{O(!0)},V=()=>{const pe=s.current;pe&&(l?pe.pause():pe.play())},$=()=>{E&&s.current&&(D(pe=>new Set(pe).add(E.id)),s.current.currentTime=E.endTime)},X=pe=>{s.current&&(s.current.currentTime=pe,D(new Set))},me=pe=>{const ge=Math.floor(pe/3600),ee=Math.floor(pe%3600/60),ye=Math.floor(pe%60);return ge>0?`${ge}:${ee.toString().padStart(2,"0")}:${ye.toString().padStart(2,"0")}`:`${ee}:${ye.toString().padStart(2,"0")}`},ve=()=>{const pe=document.getElementById("dvr-player-container");pe&&(document.fullscreenElement?document.exitFullscreen():pe.requestFullscreen())};return r.jsxs("div",{className:"fixed inset-0 z-50 bg-black",children:[r.jsxs("div",{id:"dvr-player-container",className:"relative w-full h-full",onMouseMove:Y,onClick:Y,children:[ae?r.jsx("div",{className:"flex items-center justify-center h-full",children:r.jsx(ii,{className:"w-12 h-12 text-white animate-spin"})}):Z?r.jsx("video",{ref:s,className:"w-full h-full object-contain",muted:g}):r.jsx("div",{className:"flex items-center justify-center h-full",children:r.jsx("p",{className:"text-red-400",children:"Failed to load video"})}),E&&!x&&r.jsxs("button",{onClick:$,className:"absolute bottom-32 right-8 px-6 py-3 bg-yellow-500 hover:bg-yellow-400 text-black font-semibold rounded-lg flex items-center gap-2 transition-colors",children:[r.jsx(dg,{className:"w-5 h-5"}),r.jsxs("div",{children:[r.jsx("div",{children:"Skip Ad"}),r.jsxs("div",{className:"text-xs opacity-75",children:[Math.ceil(E.endTime-u),"s remaining"]})]})]}),E&&x&&r.jsx("div",{className:"absolute bottom-32 right-8 px-4 py-2 bg-indigo-600 text-white rounded-lg",children:"Skipping commercial..."}),r.jsxs("div",{className:`absolute inset-0 transition-opacity duration-300 ${L?"opacity-100":"opacity-0 pointer-events-none"}`,children:[r.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/80 to-transparent",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("button",{onClick:e,className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",children:r.jsx(jt,{className:"w-6 h-6"})}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("h2",{className:"text-xl font-semibold text-white",children:i.title}),se&&r.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 bg-red-500 text-white text-xs font-bold rounded animate-pulse",children:[r.jsx(pr,{className:"w-3 h-3"}),"LIVE"]})]}),i.episodeNum&&r.jsx("p",{className:"text-sm text-gray-300",children:i.episodeNum})]})]}),re.length>0&&r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("span",{className:"text-sm text-yellow-400",children:[re.length," commercial break",re.length>1?"s":""," detected"]}),r.jsxs("button",{onClick:()=>v(!x),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${x?"bg-green-500/20 text-green-400 hover:bg-green-500/30":"bg-gray-500/20 text-gray-400 hover:bg-gray-500/30"}`,children:[x?r.jsx(S2,{className:"w-4 h-4"}):r.jsx(_2,{className:"w-4 h-4"}),"Auto-Skip ",x?"ON":"OFF"]})]})]})}),r.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent",children:[r.jsx("div",{className:"relative mb-4",children:r.jsxs("div",{className:"relative h-2 bg-white/30 rounded-full cursor-pointer group",onClick:pe=>{const ge=pe.currentTarget.getBoundingClientRect(),ee=(pe.clientX-ge.left)/ge.width;X(ee*d)},children:[re.map(pe=>{const ge=pe.startTime/d*100,ee=(pe.endTime-pe.startTime)/d*100;return r.jsx("div",{className:"absolute top-0 h-full bg-yellow-500/80",style:{left:`${ge}%`,width:`${Math.max(ee,.5)}%`}},pe.id)}),r.jsx("div",{className:"absolute top-0 left-0 h-full bg-indigo-500 rounded-full",style:{width:`${u/d*100}%`}}),r.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 w-4 h-4 bg-white rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",style:{left:`calc(${u/d*100}% - 8px)`}})]})}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("button",{onClick:V,className:"p-3 bg-white/20 hover:bg-white/30 rounded-full transition-colors",children:l?r.jsx(cg,{className:"w-6 h-6 text-white"}):r.jsx(Sn,{className:"w-6 h-6 text-white"})}),r.jsx("button",{onClick:()=>y(!g),className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",children:g?r.jsx(mg,{className:"w-5 h-5"}):r.jsx(fg,{className:"w-5 h-5"})}),r.jsxs("span",{className:"text-sm text-white",children:[me(u)," / ",me(d)]}),se&&r.jsxs("button",{onClick:oe,className:"flex items-center gap-1.5 px-3 py-1.5 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-lg text-sm font-medium transition-colors",children:[r.jsx(vr,{className:"w-4 h-4"}),"LIVE"]})]}),r.jsx("button",{onClick:ve,className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",children:r.jsx(lg,{className:"w-5 h-5"})})]})]})]})]}),q&&r.jsx(k4,{recording:i,onResume:()=>{U(!1),i.viewOffset&&M(i.viewOffset/1e3)},onStartOver:()=>{U(!1),Le.updateRecordingProgress(i.id,0).catch(()=>{})}})]})}function j4({recording:i,onDelete:e,onPlay:t,onDetectCommercials:s,isDetecting:a,liveStats:l,isSelected:c,onToggleSelect:u,selectionMode:f}){const d=Vm[i.status],m=d.icon,g=i.status==="recording",y=i.thumb||i.art||i.channelLogo,x=i.art||i.thumb;return r.jsxs("div",{className:`bg-gray-800 rounded-xl overflow-hidden border ${d.borderColor} hover:border-gray-600 transition-colors`,children:[g&&l&&r.jsx("div",{className:"h-1 bg-gray-700",children:r.jsx("div",{className:`h-full transition-all duration-1000 ${l.isFailed?"bg-red-600":"bg-green-500"}`,style:{width:`${l.isFailed?100:l.progressPercent}%`}})}),r.jsx("div",{className:"p-4",children:r.jsxs("div",{className:"flex items-start gap-4",children:[f&&u&&r.jsx("button",{onClick:v=>{v.stopPropagation(),u()},className:"flex-shrink-0 p-1 -ml-1 mt-1",children:c?r.jsx(f2,{className:"w-5 h-5 text-indigo-400"}):r.jsx(p2,{className:"w-5 h-5 text-gray-500 hover:text-gray-300"})}),r.jsxs("div",{className:`flex-shrink-0 relative ${i.isMovie?"w-24 h-36":"w-40 h-24"} rounded-lg overflow-hidden bg-gray-700`,children:[y?r.jsx("img",{src:i.isMovie?y:x||y,alt:i.title,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full flex items-center justify-center",children:r.jsx(Ao,{className:"w-8 h-8 text-gray-600"})}),i.channelLogo&&!i.isMovie&&r.jsx("div",{className:"absolute bottom-1 right-1 w-8 h-8 bg-black/70 rounded p-1",children:r.jsx("img",{src:i.channelLogo,alt:i.channelName||"",className:"w-full h-full object-contain"})}),r.jsx("div",{className:`absolute top-1 left-1 p-1.5 rounded ${d.bgColor}`,children:r.jsx(m,{className:`w-3.5 h-3.5 ${d.color}`})}),i.status==="completed"&&i.viewOffset&&i.duration&&r.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-black/60",children:r.jsx("div",{className:"h-full bg-indigo-500",style:{width:`${Math.min(100,i.viewOffset/(i.duration*6e4)*100)}%`}})})]}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-start justify-between gap-2",children:[r.jsxs("div",{className:"min-w-0",children:[r.jsx("h4",{className:"font-medium text-white truncate",children:i.title}),i.episodeNum&&r.jsx("p",{className:"text-sm text-gray-400",children:i.episodeNum})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[g&&l&&r.jsx("span",{title:l.isHealthy?"Recording healthy":"Recording may have issues",children:l.isHealthy?r.jsx(uR,{className:"w-4 h-4 text-green-400"}):r.jsx(lR,{className:"w-4 h-4 text-red-400"})}),r.jsx("span",{className:`flex-shrink-0 px-2 py-0.5 text-xs font-medium rounded ${d.bgColor} ${d.color}`,children:d.label})]})]}),r.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-sm",children:[i.year&&r.jsx("span",{className:"text-gray-400",children:i.year}),i.contentRating&&r.jsx("span",{className:"px-1.5 py-0.5 text-xs border border-gray-600 text-gray-400 rounded",children:i.contentRating}),i.rating&&i.rating>0&&r.jsxs("span",{className:"flex items-center gap-1 text-gray-400",children:[r.jsx("span",{className:"text-yellow-400",children:""}),i.rating.toFixed(1)]}),i.isMovie&&r.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-indigo-500/20 text-indigo-400 rounded",children:"MOVIE"}),i.isLive&&r.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-red-500 text-white font-bold rounded animate-pulse",children:"LIVE"})]}),g&&l&&r.jsx("div",{className:`mt-3 p-3 rounded-lg border ${l.isFailed?"bg-red-900/30 border-red-500/40":"bg-gray-900/50 border-red-500/20"}`,children:l.isFailed?r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Ns,{className:"w-5 h-5 text-red-400 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-red-400 font-medium",children:"Recording Failed"}),r.jsx("p",{className:"text-sm text-gray-400",children:l.failureReason})]})]}):r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(xr,{className:"w-4 h-4 text-red-400"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-white font-medium",children:l.fileSizeFormatted}),r.jsx("p",{className:"text-xs text-gray-500",children:"File Size"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Qx,{className:"w-4 h-4 text-red-400"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-white font-medium",children:l.elapsedFormatted}),r.jsx("p",{className:"text-xs text-gray-500",children:"Elapsed"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(xb,{className:"w-4 h-4 text-red-400"}),r.jsxs("div",{children:[r.jsxs("p",{className:"text-white font-medium",children:[Math.round(l.progressPercent),"%"]}),r.jsx("p",{className:"text-xs text-gray-500",children:"Progress"})]})]}),l.bitrate&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(_r,{className:"w-4 h-4 text-red-400"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-white font-medium",children:l.bitrate}),r.jsx("p",{className:"text-xs text-gray-500",children:"Bitrate"})]})]})]})}),r.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-gray-400",children:[i.channelName&&!i.channelLogo&&r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(Qs,{className:"w-3.5 h-3.5"}),i.channelName]}),r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(bn,{className:"w-3.5 h-3.5"}),OE(i.startTime)]}),r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(Li,{className:"w-3.5 h-3.5"}),jE(i.startTime,i.endTime)]}),i.duration&&r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(Qx,{className:"w-3.5 h-3.5"}),C4(i.duration)]}),!g&&i.fileSize&&r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(xr,{className:"w-3.5 h-3.5"}),R4(i.fileSize)]})]}),i.genres&&r.jsx("p",{className:"mt-1 text-xs text-gray-500 truncate",children:i.genres}),(i.summary||i.description)&&r.jsx("p",{className:"mt-2 text-sm text-gray-500 line-clamp-2",children:i.summary||i.description}),r.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[i.status==="completed"&&i.duration&&(()=>{const v=i.duration*6e4,E=i.viewOffset?i.viewOffset/v*100:0;return E>=90?r.jsxs("span",{className:"px-2 py-0.5 text-xs bg-green-500/20 text-green-400 rounded flex items-center gap-1",children:[r.jsx(Zn,{className:"w-3 h-3"}),"Watched"]}):E>5?r.jsxs("span",{className:"px-2 py-0.5 text-xs bg-blue-500/20 text-blue-400 rounded",children:[Math.round(E),"% watched"]}):r.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-600/50 text-gray-400 rounded",children:"Unwatched"})})(),i.category&&!i.isMovie&&r.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-700 text-gray-300 rounded",children:i.category}),i.seriesRecord&&r.jsx("span",{className:"px-2 py-0.5 text-xs bg-indigo-500/20 text-indigo-400 rounded",children:"Series Recording"})]})]}),r.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1",children:[(i.status==="completed"||i.status==="recording")&&t&&r.jsx("button",{onClick:t,className:`p-2 hover:bg-gray-700 rounded-lg transition-colors ${i.status==="recording"?"text-red-400 hover:text-red-300":"text-gray-400 hover:text-green-400"}`,title:i.status==="recording"?"Watch":"Play",children:r.jsx(Sn,{className:"w-4 h-4"})}),i.status==="completed"&&s&&r.jsx("button",{onClick:s,disabled:a,className:"p-2 text-gray-400 hover:text-indigo-400 hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50",title:"Detect Commercials",children:a?r.jsx(ii,{className:"w-4 h-4 animate-spin"}):r.jsx(XR,{className:"w-4 h-4"})}),r.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Delete",children:r.jsx(an,{className:"w-4 h-4"})})]})]})})]})}function O4({recordings:i}){const e=K.useMemo(()=>{const u=new Date,f=new Date(u.getTime()+10080*60*1e3);return i.filter(d=>d.status==="scheduled"||d.status==="recording").filter(d=>{const m=new Date(d.startTime);return(d.endTime?new Date(d.endTime):new Date(m.getTime()+3600*1e3))>=u&&m<=f}).sort((d,m)=>new Date(d.startTime).getTime()-new Date(m.startTime).getTime())},[i]),t=K.useMemo(()=>{const u=new Map;return e.forEach(f=>{const d=new Date(f.startTime).toDateString(),m=u.get(d)||[];m.push(f),u.set(d,m)}),u},[e]),s=K.useMemo(()=>{const u=[],f=new Date;for(let d=0;d<7;d++){const m=new Date(f);m.setDate(f.getDate()+d),m.setHours(0,0,0,0),u.push(m)}return u},[]),a=u=>{const f=new Date,d=new Date(f);return d.setDate(d.getDate()+1),u.toDateString()===f.toDateString()?"Today":u.toDateString()===d.toDateString()?"Tomorrow":u.toLocaleDateString([],{weekday:"short"})},l=u=>u.toLocaleDateString([],{month:"short",day:"numeric"}),c=u=>new Date(u).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx(bn,{className:"w-5 h-5 text-indigo-400"}),r.jsx("h3",{className:"font-semibold text-white",children:"Upcoming Recordings (Next 7 Days)"})]}),e.length===0?r.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[r.jsx(bn,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No upcoming recordings"}),r.jsx("p",{className:"text-gray-400",children:"Schedule recordings from the TV Guide"})]}):r.jsx("div",{className:"grid grid-cols-7 gap-2",children:s.map(u=>{const f=u.toDateString(),d=t.get(f)||[],m=u.toDateString()===new Date().toDateString();return r.jsxs("div",{className:`bg-gray-800 rounded-xl p-3 min-h-[200px] ${m?"border border-indigo-500/50":""}`,children:[r.jsxs("div",{className:`text-center mb-3 pb-2 border-b border-gray-700 ${m?"text-indigo-400":"text-gray-400"}`,children:[r.jsx("div",{className:"font-medium",children:a(u)}),r.jsx("div",{className:"text-sm",children:l(u)})]}),r.jsxs("div",{className:"space-y-2",children:[d.map(g=>r.jsxs("div",{className:`p-2 rounded-lg text-xs ${g.status==="recording"?"bg-red-500/20 border border-red-500/40":"bg-blue-500/10 border border-blue-500/30"}`,children:[r.jsx("div",{className:`font-medium truncate ${g.status==="recording"?"text-red-300":"text-white"}`,children:g.title}),r.jsxs("div",{className:"text-gray-400 mt-0.5 flex items-center gap-1",children:[r.jsx(Li,{className:"w-3 h-3"}),c(g.startTime)]}),g.channelName&&r.jsx("div",{className:"text-gray-500 truncate",children:g.channelName}),g.status==="recording"&&r.jsxs("div",{className:"flex items-center gap-1 text-red-400 mt-1",children:[r.jsx(pr,{className:"w-3 h-3 animate-pulse"}),"Recording"]})]},g.id)),d.length===0&&r.jsx("div",{className:"text-center text-gray-600 text-xs py-4",children:"No recordings"})]})]},f)})})]})}function P4({recordings:i}){const e=K.useMemo(()=>{const s=i.filter(d=>d.status==="completed"),a=s.reduce((d,m)=>d+(m.fileSize||0),0),l=s.filter(d=>{if(!d.viewOffset||!d.duration)return!1;const m=d.duration*6e4;return d.viewOffset/m>=.9}).length,c=s.length-l,u=new Map;s.forEach(d=>{const m=d.title,g=u.get(m)||{count:0,size:0};g.count++,g.size+=d.fileSize||0,u.set(m,g)});const f=Array.from(u.entries()).sort((d,m)=>m[1].size-d[1].size).slice(0,5);return{totalSize:a,totalCount:s.length,watchedCount:l,unwatchedCount:c,topTitles:f}},[i]),t=s=>{if(s===0)return"0 B";const a=s/(1024*1024*1024);if(a>=1)return`${a.toFixed(1)} GB`;const l=s/(1024*1024);return l>=1?`${l.toFixed(0)} MB`:`${(s/1024).toFixed(0)} KB`};return r.jsxs("div",{className:"bg-gray-800 rounded-xl p-5 mb-6",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx(xr,{className:"w-5 h-5 text-indigo-400"}),r.jsx("h3",{className:"font-semibold text-white",children:"Storage"})]}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[r.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-3",children:[r.jsx("p",{className:"text-2xl font-bold text-white",children:t(e.totalSize)}),r.jsx("p",{className:"text-sm text-gray-400",children:"Total Used"})]}),r.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-3",children:[r.jsx("p",{className:"text-2xl font-bold text-white",children:e.totalCount}),r.jsx("p",{className:"text-sm text-gray-400",children:"Recordings"})]}),r.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-3",children:[r.jsx("p",{className:"text-2xl font-bold text-green-400",children:e.watchedCount}),r.jsx("p",{className:"text-sm text-gray-400",children:"Watched"})]}),r.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-3",children:[r.jsx("p",{className:"text-2xl font-bold text-blue-400",children:e.unwatchedCount}),r.jsx("p",{className:"text-sm text-gray-400",children:"Unwatched"})]})]}),e.topTitles.length>0&&r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Storage by Series"}),r.jsx("div",{className:"space-y-2",children:e.topTitles.map(([s,a])=>{const l=e.totalSize>0?a.size/e.totalSize*100:0;return r.jsx("div",{className:"flex items-center gap-3",children:r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("span",{className:"text-sm text-white truncate",children:s}),r.jsxs("span",{className:"text-xs text-gray-400 ml-2",children:[a.count," rec  ",t(a.size)]})]}),r.jsx("div",{className:"h-1.5 bg-gray-700 rounded-full overflow-hidden",children:r.jsx("div",{className:"h-full bg-indigo-500 rounded-full",style:{width:`${l}%`}})})]})},s)})})]})]})}function B4(){const{data:i,isLoading:e}=sS(),{data:t,isLoading:s}=BL(),{data:a}=GL(),{data:l}=VL(),{data:c}=it({queryKey:["dvrSettings"],queryFn:()=>Le.getDVRSettings()}),u=PL(),f=FL(),d=$L(),[m,g]=K.useState(!1),[y,x]=K.useState("recordings"),[v,E]=K.useState(null),A=c?.maxConcurrentRecordings!==void 0&&c.maxConcurrentRecordings>0,[R,D]=K.useState(null),[L,O]=K.useState(!1),[H,q]=K.useState(null),[U,k]=K.useState(""),[M,I]=K.useState(new Set),[j,Z]=K.useState(!1),[ae,ie]=K.useState(null),{data:re}=it({queryKey:["commercialDetectionStatus"],queryFn:()=>Le.getCommercialDetectionStatus()}),Q=async ge=>{ie(ge);try{await Le.runCommercialDetection(ge)}catch(ee){console.error("Commercial detection failed:",ee)}finally{ie(null)}},se=K.useMemo(()=>{if(!i||!U.trim())return i;const ge=U.toLowerCase();return i.filter(ee=>ee.title?.toLowerCase().includes(ge)||ee.description?.toLowerCase().includes(ge)||ee.summary?.toLowerCase().includes(ge)||ee.channelName?.toLowerCase().includes(ge)||ee.genres?.toLowerCase().includes(ge)||ee.episodeNum?.toLowerCase().includes(ge))},[i,U]),oe=M.size>0,Y=ge=>{I(ee=>{const ye=new Set(ee);return ye.has(ge)?ye.delete(ge):ye.add(ge),ye})},V=ge=>{const ee=se?.filter(ye=>ye.status===ge)||[];I(ye=>{const Ie=new Set(ye);return ee.forEach(Ue=>Ie.add(Ue.id)),Ie})},$=()=>{I(new Set)},X=async()=>{if(M.size===0)return;const ge=`Are you sure you want to delete ${M.size} recording${M.size>1?"s":""}?`;if(!confirm(ge))return;Z(!0);const ee=Array.from(M);for(const ye of ee)try{await u.mutateAsync(ye)}catch{}I(new Set),Z(!1)},me=new Map;l?.stats?.forEach(ge=>{me.set(ge.id,ge)});const ve=se?.reduce((ge,ee)=>(ge[ee.status]=ge[ee.status]||[],ge[ee.status].push(ee),ge),{}),pe=(ge,ee)=>{d.mutate({keepId:ge,cancelId:ee},{onSuccess:()=>{E(null)}})};return r.jsxs("div",{children:[r.jsxs("div",{className:"mb-8",children:[r.jsx("h1",{className:"text-2xl font-bold text-white",children:"DVR"}),r.jsx("p",{className:"text-gray-400 mt-1",children:"Manage recordings and series rules"})]}),A&&a?.hasConflicts&&r.jsx("div",{className:"mb-6 p-4 bg-amber-500/10 border border-amber-500/30 rounded-xl",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(Rb,{className:"w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5"}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("h3",{className:"font-medium text-amber-400",children:[a.totalCount," Recording Conflict",a.totalCount>1?"s":""," Detected"]}),r.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["Some of your scheduled recordings overlap in time. Only ",c?.maxConcurrentRecordings," can be recorded at a time."]}),r.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:a.conflicts.map((ge,ee)=>r.jsx("button",{onClick:()=>E(ge),className:"px-3 py-1.5 text-sm bg-amber-500/20 hover:bg-amber-500/30 text-amber-300 rounded-lg transition-colors",children:ge.recordings.map(ye=>ye.title).join(" vs ")},ee))})]})]})}),r.jsxs("div",{className:"flex gap-2 mb-6",children:[r.jsx("button",{onClick:()=>x("recordings"),className:`px-4 py-2 rounded-lg font-medium ${y==="recordings"?"bg-indigo-600 text-white":"bg-gray-800 text-gray-400 hover:text-white"}`,children:"Recordings"}),r.jsx("button",{onClick:()=>x("rules"),className:`px-4 py-2 rounded-lg font-medium ${y==="rules"?"bg-indigo-600 text-white":"bg-gray-800 text-gray-400 hover:text-white"}`,children:"Series Rules"}),r.jsxs("button",{onClick:()=>x("calendar"),className:`px-4 py-2 rounded-lg font-medium flex items-center gap-2 ${y==="calendar"?"bg-indigo-600 text-white":"bg-gray-800 text-gray-400 hover:text-white"}`,children:[r.jsx(bn,{className:"w-4 h-4"}),"Calendar"]})]}),y==="recordings"&&r.jsxs("div",{children:[r.jsx("div",{className:"mb-6 flex flex-col sm:flex-row gap-4",children:r.jsxs("div",{className:"relative flex-1",children:[r.jsx(Xs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Search recordings by title, channel, description...",value:U,onChange:ge=>k(ge.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"}),U&&r.jsx("button",{onClick:()=>k(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-white",children:r.jsx(jt,{className:"w-4 h-4"})})]})}),oe&&r.jsxs("div",{className:"mb-4 p-3 bg-indigo-600/20 border border-indigo-500/30 rounded-lg flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("span",{className:"text-indigo-300 font-medium",children:[M.size," selected"]}),r.jsx("button",{onClick:$,className:"text-sm text-gray-400 hover:text-white",children:"Clear selection"})]}),r.jsxs("button",{onClick:X,disabled:j,className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 disabled:opacity-50 text-white rounded-lg font-medium",children:[j?r.jsx(ii,{className:"w-4 h-4 animate-spin"}):r.jsx(an,{className:"w-4 h-4"}),"Delete Selected"]})]}),e?r.jsx("div",{className:"flex items-center justify-center py-12",children:r.jsx(ii,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):i?.length?r.jsxs("div",{className:"space-y-8",children:[r.jsx("div",{className:"grid grid-cols-4 gap-4",children:["scheduled","recording","completed","failed"].map(ge=>{const ee=ve?.[ge]?.length||0,ye=Vm[ge],Ie=ye.icon;return r.jsx("div",{className:`p-4 rounded-xl border ${ye.borderColor} ${ye.bgColor}`,children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Ie,{className:`w-5 h-5 ${ye.color}`}),r.jsxs("div",{children:[r.jsx("p",{className:"text-2xl font-bold text-white",children:ee}),r.jsx("p",{className:"text-sm text-gray-400",children:ye.label})]})]})},ge)})}),r.jsx(P4,{recordings:i}),["recording","scheduled","completed","failed"].map(ge=>{const ee=ve?.[ge];if(!ee?.length)return null;const ye=Vm[ge],Ie=ye.icon;return r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("h3",{className:"text-sm font-medium text-gray-400 uppercase tracking-wider flex items-center gap-2",children:[r.jsx(Ie,{className:`h-4 w-4 ${ye.color}`}),ye.label," (",ee.length,")"]}),ee.length>0&&r.jsxs("button",{onClick:()=>V(ge),className:"text-xs text-indigo-400 hover:text-indigo-300",children:["Select all ",ye.label.toLowerCase()]})]}),r.jsx("div",{className:"space-y-3",children:ee.map(Ue=>r.jsx(j4,{recording:Ue,onDelete:()=>u.mutate(Ue.id),onPlay:Ue.status==="completed"||Ue.status==="recording"?()=>{Ue.status==="recording"?q(Ue):(O(!1),D(Ue))}:void 0,onDetectCommercials:re?.enabled?()=>Q(Ue.id):void 0,isDetecting:ae===Ue.id,liveStats:me.get(Ue.id),isSelected:M.has(Ue.id),onToggleSelect:()=>Y(Ue.id),selectionMode:!0},Ue.id))})]},ge)})]}):U&&i?.length?r.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[r.jsx(Xs,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No matches found"}),r.jsxs("p",{className:"text-gray-400",children:['No recordings match "',U,'"']}),r.jsx("button",{onClick:()=>k(""),className:"mt-4 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Clear search"})]}):r.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[r.jsx(Ao,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No recordings"}),r.jsx("p",{className:"text-gray-400",children:"Schedule recordings from On Later or the EPG Guide"})]})]}),y==="rules"&&r.jsxs("div",{children:[r.jsx("div",{className:"flex justify-end mb-4",children:r.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[r.jsx(Hi,{className:"h-4 w-4"}),"Add Series Rule"]})}),s?r.jsx("div",{className:"text-gray-400",children:"Loading..."}):t?.length?r.jsx("div",{className:"bg-gray-800 rounded-xl divide-y divide-gray-700",children:t.map(ge=>r.jsxs("div",{className:"p-4 flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-white",children:ge.title}),r.jsxs("p",{className:"text-sm text-gray-400",children:[ge.anyChannel?"Any channel":"Specific channel","  Keep ",ge.keepCount===0?"all":`last ${ge.keepCount}`,"  ",ge.enabled?r.jsx("span",{className:"text-green-400",children:"Enabled"}):r.jsx("span",{className:"text-gray-500",children:"Disabled"})]})]}),r.jsx("button",{onClick:()=>f.mutate(ge.id),className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg",title:"Delete",children:r.jsx(an,{className:"h-4 w-4"})})]},ge.id))}):r.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[r.jsx(Ao,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No series rules"}),r.jsx("p",{className:"text-gray-400 mb-4",children:"Create rules to automatically record shows"}),r.jsxs("button",{onClick:()=>g(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[r.jsx(Hi,{className:"h-4 w-4"}),"Add Series Rule"]})]})]}),y==="calendar"&&i&&r.jsx(O4,{recordings:i}),m&&r.jsx(L4,{onClose:()=>g(!1)}),v&&r.jsx(D4,{conflict:v,onClose:()=>E(null),onResolve:pe,isResolving:d.isPending}),H&&r.jsx(I4,{recording:H,onClose:()=>q(null),onSelect:ge=>{O(ge==="live"),D(H),q(null)}}),R&&r.jsx(M4,{recording:R,onClose:()=>{D(null),O(!1)},startLive:L})]})}function U4({title:i,streamUrl:e,onClose:t}){const s=K.useRef(null),a=K.useRef(null),[l,c]=K.useState(!0),[u,f]=K.useState(null),[d,m]=K.useState(!1),[g,y]=K.useState(!0),[x,v]=K.useState(!0),[E,A]=K.useState(0),[R,D]=K.useState(0),L=K.useRef(null),O=()=>{const j=s.current;j&&(j.paused?(j.play().catch(()=>{}),y(!0)):(j.pause(),y(!1)))},H=()=>{const j=s.current;j&&(j.currentTime=Math.max(0,j.currentTime-10))},q=()=>{const j=s.current;j&&(j.currentTime=j.currentTime+10)},U=j=>{const Z=s.current;Z&&(Z.currentTime=parseFloat(j.target.value))},k=j=>{const Z=Math.floor(j/3600),ae=Math.floor(j%3600/60),ie=Math.floor(j%60);return Z>0?`${Z}:${ae.toString().padStart(2,"0")}:${ie.toString().padStart(2,"0")}`:`${ae}:${ie.toString().padStart(2,"0")}`};K.useEffect(()=>{const j=s.current;if(!j||!e)return;c(!0),f(null);const Z=()=>{A(j.currentTime)},ae=()=>{D(j.duration)},ie=()=>{y(!1)};if(j.addEventListener("timeupdate",Z),j.addEventListener("loadedmetadata",ae),j.addEventListener("ended",ie),is.isSupported()){const re=new is({enableWorker:!0,lowLatencyMode:!1});a.current=re,re.on(is.Events.MANIFEST_PARSED,()=>{c(!1),j.play().catch(()=>{})}),re.on(is.Events.ERROR,(Q,se)=>{se.fatal&&(console.error("HLS error:",se),re.destroy(),a.current=null,j.src=e,j.play().catch(oe=>{f(`Playback error: ${oe.message}`),c(!1)}))}),re.loadSource(e),re.attachMedia(j)}else j.canPlayType("application/vnd.apple.mpegurl")?(j.src=e,j.addEventListener("loadedmetadata",()=>{c(!1),j.play().catch(()=>{})})):(j.src=e,j.addEventListener("canplay",()=>{c(!1),j.play().catch(()=>{})}),j.addEventListener("error",()=>{f("Unable to play this video format"),c(!1)}));return()=>{j.removeEventListener("timeupdate",Z),j.removeEventListener("loadedmetadata",ae),j.removeEventListener("ended",ie),a.current&&(a.current.destroy(),a.current=null)}},[e]),K.useEffect(()=>(x&&(L.current&&clearTimeout(L.current),L.current=window.setTimeout(()=>{v(!1)},3e3)),()=>{L.current&&clearTimeout(L.current)}),[x]);const M=()=>v(!0),I=()=>{const j=document.getElementById("vod-player-container");j&&(document.fullscreenElement?document.exitFullscreen():j.requestFullscreen())};return r.jsx("div",{className:"fixed inset-0 z-50 bg-black",children:r.jsxs("div",{id:"vod-player-container",className:"relative w-full h-full",onMouseMove:M,onClick:M,children:[l&&r.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsx(ii,{className:"w-12 h-12 text-white animate-spin"})}),u?r.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-red-400 text-lg mb-4",children:u}),r.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Close"})]})}):r.jsx("video",{ref:s,className:"w-full h-full object-contain",muted:d,playsInline:!0}),r.jsxs("div",{className:`absolute inset-0 transition-opacity duration-300 ${x?"opacity-100":"opacity-0 pointer-events-none"}`,children:[r.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/80 to-transparent",children:r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("button",{onClick:t,className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",children:r.jsx(jt,{className:"w-6 h-6"})}),r.jsx("div",{children:r.jsx("h2",{className:"text-xl font-semibold text-white",children:i})})]})})}),r.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent",children:[R>0&&r.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[r.jsx("span",{className:"text-white text-sm",children:k(E)}),r.jsx("input",{type:"range",min:"0",max:R,value:E,onChange:U,className:"flex-1 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-white"}),r.jsx("span",{className:"text-white text-sm",children:k(R)})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("div",{className:"flex items-center gap-2",children:r.jsx("button",{onClick:()=>m(!d),className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",title:d?"Unmute":"Mute",children:d?r.jsx(mg,{className:"w-6 h-6"}):r.jsx(fg,{className:"w-6 h-6"})})}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:H,className:"p-3 text-white hover:bg-white/20 rounded-full transition-colors",title:"Rewind 10s",children:r.jsx(wb,{className:"w-6 h-6"})}),r.jsx("button",{onClick:O,className:"p-4 text-white bg-white/20 hover:bg-white/30 rounded-full transition-colors",title:g?"Pause":"Play",children:g?r.jsx(cg,{className:"w-8 h-8"}):r.jsx(Sn,{className:"w-8 h-8"})}),r.jsx("button",{onClick:q,className:"p-3 text-white hover:bg-white/20 rounded-full transition-colors",title:"Forward 10s",children:r.jsx(dg,{className:"w-6 h-6"})})]}),r.jsx("button",{onClick:I,className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",title:"Fullscreen",children:r.jsx(lg,{className:"w-6 h-6"})})]})]})]})]})})}function F4({movie:i,onClose:e,onDownload:t,onPlay:s,isDownloading:a}){return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",children:r.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[r.jsxs("div",{className:"relative",children:[i.poster&&r.jsx("div",{className:"h-48 bg-gradient-to-b from-gray-700 to-gray-800 overflow-hidden",children:r.jsx("img",{src:i.poster,alt:i.title,className:"w-full h-full object-cover opacity-30"})}),r.jsx("button",{onClick:e,className:"absolute top-4 right-4 p-2 bg-black/50 hover:bg-black/70 rounded-full text-white",children:r.jsx(jt,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"flex gap-6",children:[i.poster&&r.jsx("div",{className:"flex-shrink-0 w-32",children:r.jsx("img",{src:i.poster,alt:i.title,className:"w-full rounded-lg shadow-lg"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h2",{className:"text-2xl font-bold text-white",children:i.title}),r.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-2 text-sm text-gray-400",children:[i.year&&r.jsx("span",{children:i.year}),i.runtime&&r.jsx("span",{children:i.runtime}),i.rating&&r.jsx("span",{className:"px-2 py-0.5 border border-gray-600 rounded",children:i.rating})]}),i.genres&&i.genres.length>0&&r.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:i.genres.map(l=>r.jsx("span",{className:"px-2 py-1 text-xs bg-gray-700 text-gray-300 rounded",children:l},l))})]})]}),i.description&&r.jsx("p",{className:"mt-4 text-gray-300 text-sm leading-relaxed",children:i.description}),r.jsxs("div",{className:"mt-6 flex gap-3",children:[i.downloadUrl&&r.jsxs("button",{onClick:s,className:"flex items-center gap-2 px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium",children:[r.jsx(Sn,{className:"w-5 h-5"}),"Play"]}),r.jsxs("button",{onClick:t,disabled:a,className:"flex items-center gap-2 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg font-medium",children:[a?r.jsx(ii,{className:"w-5 h-5 animate-spin"}):r.jsx(Ri,{className:"w-5 h-5"}),a?"Starting Download...":"Download"]}),r.jsx("button",{onClick:e,className:"px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Close"})]})]})]})})}function G4({showId:i,provider:e,onClose:t,onDownload:s,onPlay:a,isDownloading:l}){const[c,u]=K.useState([1]),{data:f,isLoading:d}=it({queryKey:["vod-show",e,i],queryFn:()=>Le.vod.getShow(e,i)}),m=g=>{u(y=>y.includes(g)?y.filter(x=>x!==g):[...y,g])};return d?r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",children:r.jsx(ii,{className:"w-12 h-12 text-white animate-spin"})}):f?r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",children:r.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[r.jsxs("div",{className:"relative",children:[f.poster&&r.jsx("div",{className:"h-48 bg-gradient-to-b from-gray-700 to-gray-800 overflow-hidden",children:r.jsx("img",{src:f.poster,alt:f.title,className:"w-full h-full object-cover opacity-30"})}),r.jsx("button",{onClick:t,className:"absolute top-4 right-4 p-2 bg-black/50 hover:bg-black/70 rounded-full text-white",children:r.jsx(jt,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"flex gap-6",children:[f.poster&&r.jsx("div",{className:"flex-shrink-0 w-32",children:r.jsx("img",{src:f.poster,alt:f.title,className:"w-full rounded-lg shadow-lg"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h2",{className:"text-2xl font-bold text-white",children:f.title}),r.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-2 text-sm text-gray-400",children:[f.year&&r.jsx("span",{children:f.year}),f.seasonCount&&r.jsxs("span",{children:[f.seasonCount," Season",f.seasonCount>1?"s":""]}),f.rating&&r.jsx("span",{className:"px-2 py-0.5 border border-gray-600 rounded",children:f.rating})]}),f.genres&&f.genres.length>0&&r.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:f.genres.map(g=>r.jsx("span",{className:"px-2 py-1 text-xs bg-gray-700 text-gray-300 rounded",children:g},g))})]})]}),f.description&&r.jsx("p",{className:"mt-4 text-gray-300 text-sm leading-relaxed",children:f.description}),f.seasons&&f.seasons.length>0&&r.jsxs("div",{className:"mt-6 space-y-2",children:[r.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Episodes"}),f.seasons.map(g=>r.jsxs("div",{className:"border border-gray-700 rounded-lg overflow-hidden",children:[r.jsxs("button",{onClick:()=>m(g.seasonNumber),className:"w-full flex items-center justify-between p-4 bg-gray-700/50 hover:bg-gray-700 text-white",children:[r.jsxs("span",{className:"font-medium",children:["Season ",g.seasonNumber]}),c.includes(g.seasonNumber)?r.jsx(fd,{className:"w-5 h-5"}):r.jsx(md,{className:"w-5 h-5"})]}),c.includes(g.seasonNumber)&&g.episodes&&r.jsx("div",{className:"divide-y divide-gray-700",children:g.episodes.map(y=>r.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-gray-700/30",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("span",{className:"text-gray-500 text-sm",children:["E",y.episodeNumber]}),r.jsx("span",{className:"text-white font-medium truncate",children:y.title})]}),y.runtime&&r.jsxs("span",{className:"text-xs text-gray-500",children:[y.runtime," min"]})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[y.downloadUrl&&r.jsx("button",{onClick:()=>a({id:y.id,title:y.title,downloadUrl:y.downloadUrl}),className:"flex-shrink-0 p-2 text-gray-400 hover:text-green-400 hover:bg-gray-700 rounded-lg",title:"Play",children:r.jsx(Sn,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>s(y.id),disabled:l===y.id,className:"flex-shrink-0 p-2 text-gray-400 hover:text-indigo-400 hover:bg-gray-700 rounded-lg disabled:opacity-50",title:"Download",children:l===y.id?r.jsx(ii,{className:"w-4 h-4 animate-spin"}):r.jsx(Ri,{className:"w-4 h-4"})})]})]},y.id))})]},g.seasonNumber))]}),r.jsx("div",{className:"mt-6 flex justify-end",children:r.jsx("button",{onClick:t,className:"px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Close"})})]})]})}):null}function F_({title:i,year:e,poster:t,rating:s,onClick:a}){return r.jsxs("button",{onClick:a,className:"group relative bg-gray-800 rounded-lg overflow-hidden hover:ring-2 hover:ring-indigo-500 transition-all",children:[r.jsx("div",{className:"aspect-[2/3] bg-gray-700",children:t?r.jsx("img",{src:t,alt:i,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}):r.jsx("div",{className:"w-full h-full flex items-center justify-center",children:r.jsx(Ki,{className:"w-12 h-12 text-gray-600"})})}),r.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),r.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-3",children:[r.jsx("h4",{className:"font-medium text-white text-sm truncate",children:i}),r.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-400",children:[e&&r.jsx("span",{children:e}),s&&r.jsx("span",{className:"px-1 border border-gray-600 rounded",children:s})]})]}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:r.jsx("div",{className:"p-3 bg-indigo-600 rounded-full",children:r.jsx(Sn,{className:"w-6 h-6 text-white"})})})]})}function $4({queue:i,onCancel:e,onRefresh:t,isRefreshing:s}){return i.length?r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("span",{className:"text-sm text-gray-400",children:[i.length," download",i.length>1?"s":""]}),r.jsx("button",{onClick:t,disabled:s,className:"p-1 text-gray-400 hover:text-white",children:r.jsx(vs,{className:`w-4 h-4 ${s?"animate-spin":""}`})})]}),i.map(a=>r.jsxs("div",{className:"bg-gray-700 rounded-lg p-3",children:[r.jsxs("div",{className:"flex items-start justify-between gap-2",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("h4",{className:"font-medium text-white text-sm truncate",children:a.title}),r.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[a.status==="queued"&&r.jsxs("span",{className:"flex items-center gap-1 text-xs text-blue-400",children:[r.jsx(Li,{className:"w-3 h-3"}),"Queued"]}),a.status==="downloading"&&r.jsxs("span",{className:"flex items-center gap-1 text-xs text-indigo-400",children:[r.jsx(ii,{className:"w-3 h-3 animate-spin"}),a.progress.toFixed(0),"%"]}),a.status==="completed"&&r.jsxs("span",{className:"flex items-center gap-1 text-xs text-green-400",children:[r.jsx(Zn,{className:"w-3 h-3"}),"Completed"]}),a.status==="failed"&&r.jsxs("span",{className:"flex items-center gap-1 text-xs text-red-400",children:[r.jsx(Ns,{className:"w-3 h-3"}),"Failed"]})]})]}),(a.status==="queued"||a.status==="downloading")&&r.jsx("button",{onClick:()=>e(a.id),className:"p-1 text-gray-400 hover:text-red-400",children:r.jsx(an,{className:"w-4 h-4"})})]}),a.status==="downloading"&&r.jsx("div",{className:"mt-2 h-1.5 bg-gray-600 rounded-full overflow-hidden",children:r.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300",style:{width:`${a.progress}%`}})}),a.error&&r.jsx("p",{className:"mt-2 text-xs text-red-400",children:a.error})]},a.id))]}):r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx(Ri,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),r.jsx("p",{children:"No active downloads"})]})}function V4(){const i=Ct(),[e,t]=K.useState(null),[s,a]=K.useState("movies"),[l,c]=K.useState(""),[u,f]=K.useState(null),[d,m]=K.useState(null),[g,y]=K.useState(null),[x,v]=K.useState(null),[E,A]=K.useState(!1),[R,D]=K.useState(null),{data:L}=it({queryKey:["serverConfig"],queryFn:()=>Le.getServerConfig(),retry:!1}),O=L?.vod_api_url||"",{data:H}=it({queryKey:["vod-connection"],queryFn:()=>Le.vod.testConnection(),refetchInterval:3e4}),{data:q,isLoading:U}=it({queryKey:["vod-providers"],queryFn:()=>Le.vod.getProviders(),enabled:H?.connected===!0});K.useEffect(()=>{q?.length&&!e&&t(q[0].id)},[q,e]);const{data:k,isLoading:M}=it({queryKey:["vod-movies",e],queryFn:()=>Le.vod.getMovies(e),enabled:!!e&&s==="movies"}),{data:I,isLoading:j}=it({queryKey:["vod-shows",e],queryFn:()=>Le.vod.getShows(e),enabled:!!e&&s==="shows"}),{data:Z}=it({queryKey:["vod-genres",e],queryFn:()=>Le.vod.getGenres(e),enabled:!!e}),{data:ae,refetch:ie,isRefetching:re}=it({queryKey:["vod-queue"],queryFn:()=>Le.vod.getQueue(),refetchInterval:5e3,enabled:H?.connected===!0}),Q=Ze({mutationFn:({contentId:ee,type:ye})=>Le.vod.startDownload(e,ee,ye),onSuccess:()=>{i.invalidateQueries({queryKey:["vod-queue"]})}}),se=Ze({mutationFn:ee=>Le.vod.cancelDownload(ee),onSuccess:()=>{i.invalidateQueries({queryKey:["vod-queue"]})}}),oe=()=>{d&&e&&Q.mutate({contentId:d.id,type:"movie"},{onSuccess:()=>{m(null)}})},Y=ee=>{e&&(v(ee),Q.mutate({contentId:ee,type:"episode"},{onSettled:()=>{v(null)}}))},V=()=>{if(d?.downloadUrl&&O){const ee=`${O}${d.downloadUrl}`;D({title:d.title,streamUrl:ee}),m(null)}},$=ee=>{if(ee.downloadUrl&&O){const ye=`${O}${ee.downloadUrl}`;D({title:ee.title||"Episode",streamUrl:ye}),y(null)}},X=k?.filter(ee=>{const ye=!l||ee.title.toLowerCase().includes(l.toLowerCase()),Ie=!u||ee.genres?.includes(u);return ye&&Ie}),me=I?.filter(ee=>{const ye=!l||ee.title.toLowerCase().includes(l.toLowerCase()),Ie=!u||ee.genres?.includes(u);return ye&&Ie}),ve=U||(s==="movies"?M:j),pe=ae?.items||[],ge=pe.filter(ee=>ee.status==="queued"||ee.status==="downloading").length;return H?.connected===!1?r.jsxs("div",{children:[r.jsxs("div",{className:"mb-8",children:[r.jsx("h1",{className:"text-2xl font-bold text-white",children:"VOD Downloads"}),r.jsx("p",{className:"text-gray-400 mt-1",children:"Browse and download Disney+ content"})]}),r.jsxs("div",{className:"bg-gray-800 rounded-xl p-8 text-center",children:[r.jsx(j2,{className:"w-16 h-16 text-red-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"VOD Service Not Available"}),r.jsx("p",{className:"text-gray-400 mb-4",children:H?.error||"Could not connect to VOD API"}),r.jsxs("p",{className:"text-sm text-gray-500",children:["Configure the VOD API URL in ",r.jsx("a",{href:"/ui/settings",className:"text-indigo-400 hover:underline",children:"Settings"})]})]})]}):r.jsxs("div",{children:[r.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-white",children:"VOD Downloads"}),r.jsx("p",{className:"text-gray-400 mt-1",children:"Browse and download Disney+ content"})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[H?.connected&&r.jsxs("span",{className:"flex items-center gap-1.5 text-sm text-green-400",children:[r.jsx(P2,{className:"w-4 h-4"}),"Connected"]}),r.jsxs("button",{onClick:()=>A(!E),className:`relative flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${E?"bg-indigo-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"}`,children:[r.jsx(Ri,{className:"w-4 h-4"}),"Queue",ge>0&&r.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 flex items-center justify-center text-xs bg-red-500 text-white rounded-full",children:ge})]})]})]}),r.jsxs("div",{className:"flex gap-6",children:[r.jsxs("div",{className:"flex-1",children:[q&&q.length>0&&r.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[r.jsx("label",{className:"text-sm text-gray-400",children:"Provider:"}),r.jsx("select",{value:e||"",onChange:ee=>t(ee.target.value),className:"px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-indigo-500 min-w-[200px]",children:q.map(ee=>r.jsx("option",{value:ee.id,children:ee.name},ee.id))})]}),r.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[r.jsxs("div",{className:"flex bg-gray-800 rounded-lg p-1",children:[r.jsxs("button",{onClick:()=>a("movies"),className:`flex items-center gap-2 px-4 py-2 rounded-md font-medium transition-colors ${s==="movies"?"bg-gray-700 text-white":"text-gray-400 hover:text-white"}`,children:[r.jsx(Ki,{className:"w-4 h-4"}),"Movies"]}),r.jsxs("button",{onClick:()=>a("shows"),className:`flex items-center gap-2 px-4 py-2 rounded-md font-medium transition-colors ${s==="shows"?"bg-gray-700 text-white":"text-gray-400 hover:text-white"}`,children:[r.jsx(Zx,{className:"w-4 h-4"}),"TV Shows"]})]}),r.jsxs("div",{className:"flex-1 relative",children:[r.jsx(Xs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),r.jsx("input",{type:"text",value:l,onChange:ee=>c(ee.target.value),placeholder:"Search...",className:"w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),Z&&Z.length>0&&r.jsxs("select",{value:u||"",onChange:ee=>f(ee.target.value||null),className:"px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-indigo-500",children:[r.jsx("option",{value:"",children:"All Genres"}),Z.map(ee=>r.jsx("option",{value:ee,children:ee},ee))]})]}),ve?r.jsx("div",{className:"flex items-center justify-center py-12",children:r.jsx(ii,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):s==="movies"?X?.length?r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:X.map(ee=>r.jsx(F_,{title:ee.title,year:ee.year,poster:ee.poster,rating:ee.rating,onClick:()=>m(ee)},ee.id))}):r.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[r.jsx(Ki,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No movies found"}),r.jsx("p",{className:"text-gray-400",children:"Try adjusting your search or filters"})]}):me?.length?r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:me.map(ee=>r.jsx(F_,{title:ee.title,year:ee.year,poster:ee.poster,rating:ee.rating,onClick:()=>y(ee.id)},ee.id))}):r.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[r.jsx(Zx,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No TV shows found"}),r.jsx("p",{className:"text-gray-400",children:"Try adjusting your search or filters"})]})]}),E&&r.jsx("div",{className:"w-80 flex-shrink-0",children:r.jsxs("div",{className:"sticky top-6 bg-gray-800 rounded-xl p-4",children:[r.jsx("h3",{className:"font-semibold text-white mb-4",children:"Download Queue"}),r.jsx($4,{queue:pe,onCancel:ee=>se.mutate(ee),onRefresh:()=>ie(),isRefreshing:re})]})})]}),d&&e&&r.jsx(F4,{movie:d,onClose:()=>m(null),onDownload:oe,onPlay:V,isDownloading:Q.isPending}),g&&e&&r.jsx(G4,{showId:g,provider:e,onClose:()=>y(null),onDownload:Y,onPlay:$,isDownloading:x}),R&&r.jsx(U4,{title:R.title,streamUrl:R.streamUrl,onClose:()=>D(null)})]})}function H4(){return it({queryKey:["transcodeInfo"],queryFn:async()=>{const i=await fetch("/api/transcode",{headers:{"X-Plex-Token":localStorage.getItem("openflix_token")||""}});if(!i.ok)throw new Error("Failed to fetch transcode info");return i.json()},refetchInterval:1e4})}function K4({hardware:i}){const e=i.detectedGpus&&i.detectedGpus.length>0,t=()=>{if(!i.available&&e)return r.jsx(Ns,{className:"h-8 w-8 text-yellow-400"});if(!i.available)return r.jsx(jl,{className:"h-8 w-8 text-gray-400"});switch(i.type){case"nvenc":return r.jsx(_r,{className:"h-8 w-8 text-green-400"});case"qsv":return r.jsx(jl,{className:"h-8 w-8 text-blue-400"});case"videotoolbox":return r.jsx(vm,{className:"h-8 w-8 text-purple-400"});case"vaapi":return r.jsx(xr,{className:"h-8 w-8 text-orange-400"});default:return r.jsx(jl,{className:"h-8 w-8 text-gray-400"})}};return r.jsx("div",{className:"bg-gray-800 rounded-xl p-6",children:r.jsxs("div",{className:"flex items-start gap-4",children:[r.jsx("div",{className:"p-3 bg-gray-700 rounded-lg",children:t()}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("h3",{className:"text-lg font-semibold text-white",children:i.name}),i.available?r.jsxs("span",{className:"flex items-center gap-1 text-xs bg-green-500/20 text-green-400 px-2 py-0.5 rounded-full",children:[r.jsx(Ca,{className:"h-3 w-3"})," Available"]}):e?r.jsxs("span",{className:"flex items-center gap-1 text-xs bg-yellow-500/20 text-yellow-400 px-2 py-0.5 rounded-full",children:[r.jsx(Ns,{className:"h-3 w-3"})," GPU Detected - Not Usable"]}):r.jsxs("span",{className:"flex items-center gap-1 text-xs bg-gray-500/20 text-gray-400 px-2 py-0.5 rounded-full",children:[r.jsx(Ns,{className:"h-3 w-3"})," Software Only"]})]}),i.gpuInfo&&r.jsx("p",{className:"text-sm text-gray-400 mb-3",children:i.gpuInfo}),!i.available&&e&&r.jsxs("div",{className:"mb-3",children:[r.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase mb-1",children:"Detected GPUs"}),r.jsx("div",{className:"space-y-1",children:i.detectedGpus.map((s,a)=>r.jsx("p",{className:"text-sm text-yellow-400",children:s},a))})]}),i.missingSupport&&r.jsx("div",{className:"mb-3 p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg",children:r.jsx("p",{className:"text-sm text-yellow-300",children:i.missingSupport})}),r.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase mb-2",children:"Encoders"}),r.jsx("div",{className:"flex flex-wrap gap-1",children:i.encoders.map(s=>r.jsx("span",{className:"text-xs bg-gray-700 text-gray-300 px-2 py-1 rounded",children:s},s))})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase mb-2",children:"Decoders"}),r.jsx("div",{className:"flex flex-wrap gap-1",children:i.decoders.map(s=>r.jsx("span",{className:"text-xs bg-gray-700 text-gray-300 px-2 py-1 rounded",children:s},s))})]})]}),r.jsxs("div",{className:"flex gap-4 mt-4 pt-4 border-t border-gray-700",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-xs text-gray-500",children:"HEVC"}),i.supportsHevc?r.jsx(Ca,{className:"h-4 w-4 text-green-400"}):r.jsx(Ns,{className:"h-4 w-4 text-gray-500"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-xs text-gray-500",children:"AV1"}),i.supportsAv1?r.jsx(Ca,{className:"h-4 w-4 text-green-400"}):r.jsx(Ns,{className:"h-4 w-4 text-gray-500"})]}),i.maxResolution&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-xs text-gray-500",children:"Max Resolution"}),r.jsx("span",{className:"text-xs text-white font-medium",children:i.maxResolution})]})]})]})]})})}function z4({modes:i,recommended:e}){return r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[r.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[r.jsx($N,{className:"h-5 w-5"}),"Playback Modes"]}),r.jsx("div",{className:"space-y-3",children:i.map(t=>r.jsxs("div",{className:`p-4 rounded-lg border ${t.id===e?"border-indigo-500 bg-indigo-500/10":"border-gray-700 bg-gray-700/50"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("span",{className:"font-medium text-white",children:t.name}),t.id===e&&r.jsx("span",{className:"text-xs bg-indigo-500 text-white px-2 py-0.5 rounded",children:"Recommended"})]}),r.jsx("p",{className:"text-sm text-gray-400",children:t.description})]},t.id))})]})}function q4({config:i}){return r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[r.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[r.jsx(t2,{className:"h-5 w-5"}),"Configuration"]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-700",children:[r.jsx("span",{className:"text-gray-400",children:"Transcoding Enabled"}),r.jsx("span",{className:i.enabled?"text-green-400":"text-red-400",children:i.enabled?"Yes":"No"})]}),r.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-700",children:[r.jsx("span",{className:"text-gray-400",children:"FFmpeg Path"}),r.jsx("span",{className:"text-white font-mono text-sm",children:i.ffmpegPath})]}),r.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-700",children:[r.jsx("span",{className:"text-gray-400",children:"Hardware Acceleration"}),r.jsx("span",{className:"text-white capitalize",children:i.hwAccel})]}),r.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-700",children:[r.jsx("span",{className:"text-gray-400",children:"Temp Directory"}),r.jsx("span",{className:"text-white font-mono text-sm truncate max-w-xs",children:i.tempDir})]}),r.jsxs("div",{className:"flex justify-between items-center py-2",children:[r.jsx("span",{className:"text-gray-400",children:"Max Sessions"}),r.jsx("span",{className:"text-white",children:i.maxSessions})]})]})]})}function Y4({sessions:i}){return r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[r.jsx(vm,{className:"h-5 w-5"}),"Active Sessions"]}),r.jsxs("span",{className:"text-sm text-gray-400",children:[i.active," / ",i.max]})]}),r.jsx("div",{className:"h-2 bg-gray-700 rounded-full mb-4",children:r.jsx("div",{className:`h-full rounded-full transition-all ${i.active>=i.max?"bg-red-500":"bg-indigo-500"}`,style:{width:`${Math.min(i.active/i.max*100,100)}%`}})}),i.details.length===0?r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx(vm,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),r.jsx("p",{children:"No active transcoding sessions"})]}):r.jsx("div",{className:"space-y-2",children:i.details.map(e=>r.jsx("div",{className:"p-3 bg-gray-700 rounded-lg",children:r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsxs("div",{children:[r.jsxs("p",{className:"text-white font-mono text-sm truncate",children:[e.id.slice(0,8),"..."]}),r.jsxs("p",{className:"text-xs text-gray-400",children:["Quality: ",e.quality]})]}),r.jsx("span",{className:"text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded",children:"Active"})]})},e.id))})]})}function W4(){const{data:i,isLoading:e,refetch:t}=H4();return e?r.jsx("div",{className:"flex items-center justify-center h-64",children:r.jsx(vs,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):i?r.jsxs("div",{children:[r.jsxs("div",{className:"mb-6",children:[r.jsx("h1",{className:"text-2xl font-bold text-white",children:"Transcoding"}),r.jsx("p",{className:"text-gray-400 mt-1",children:"Hardware acceleration and transcoding settings"})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[r.jsx(K4,{hardware:i.hardware}),r.jsx(q4,{config:i.config}),r.jsx(z4,{modes:i.playbackModes,recommended:i.hardware.recommendedMode}),r.jsx(Y4,{sessions:i.sessions})]}),r.jsxs("div",{className:"mt-6 bg-gray-800 rounded-xl p-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Playback Strategy"}),r.jsxs("div",{className:"prose prose-invert prose-sm max-w-none",children:[r.jsx("p",{className:"text-gray-300",children:"OpenFlix supports multiple playback strategies to optimize quality and performance:"}),r.jsxs("ul",{className:"text-gray-300 mt-3 space-y-2",children:[r.jsxs("li",{children:[r.jsx("strong",{className:"text-white",children:"Direct Play:"})," The client device decodes the original file directly. This provides the best quality and requires no server resources. Most modern devices (Android, iOS, Smart TVs) support hardware decoding for H.264 and often HEVC."]}),r.jsxs("li",{children:[r.jsx("strong",{className:"text-white",children:"Direct Stream:"})," The server remuxes the file (changes container format) without re-encoding. Useful when the client supports the codec but not the container format."]}),r.jsxs("li",{children:[r.jsx("strong",{className:"text-white",children:"Server Transcode:"})," The server re-encodes the video to a compatible format. Uses server CPU or GPU resources. Enable hardware acceleration (NVENC, QSV, VideoToolbox) for better performance."]})]}),r.jsx("p",{className:"text-gray-400 mt-4 text-sm",children:i.hardware.available?`Your server has hardware acceleration available (${i.hardware.name}). Server transcoding will use the GPU for efficient encoding.`:"Your server will use software (CPU) transcoding. Consider using Direct Play when possible to reduce server load."})]})]}),r.jsx("div",{className:"mt-6 bg-gradient-to-br from-indigo-900/50 to-purple-900/50 rounded-xl p-6 border border-indigo-500/30",children:r.jsxs("div",{className:"flex items-start gap-4",children:[r.jsx("div",{className:"p-3 bg-indigo-500/20 rounded-lg",children:r.jsx(_r,{className:"h-6 w-6 text-indigo-400"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Smart Playback Selection"}),r.jsx("p",{className:"text-gray-300 text-sm mb-3",children:"OpenFlix automatically analyzes each media file and your device's capabilities to choose the optimal playback mode:"}),r.jsxs("ul",{className:"text-gray-400 text-sm space-y-1",children:[r.jsxs("li",{className:"flex items-center gap-2",children:[r.jsx(Ca,{className:"h-4 w-4 text-green-400"}),r.jsx("span",{children:"Analyzes video codec, audio codec, container format, and resolution"})]}),r.jsxs("li",{className:"flex items-center gap-2",children:[r.jsx(Ca,{className:"h-4 w-4 text-green-400"}),r.jsx("span",{children:"Detects HDR, Dolby Vision, and Atmos compatibility"})]}),r.jsxs("li",{className:"flex items-center gap-2",children:[r.jsx(Ca,{className:"h-4 w-4 text-green-400"}),r.jsx("span",{children:"Considers network bandwidth and client device capabilities"})]}),r.jsxs("li",{className:"flex items-center gap-2",children:[r.jsx(Ca,{className:"h-4 w-4 text-green-400"}),r.jsx("span",{children:"Prioritizes Direct Play for best quality, falls back to transcoding when needed"})]})]}),r.jsx("p",{className:"text-indigo-300 text-xs mt-3",children:"API: GET /api/playback/decide/:fileId  Returns recommended playback mode for any media file"})]})]})})]}):r.jsxs("div",{className:"text-center py-12",children:[r.jsx(Ns,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-white",children:"Failed to load transcoding info"}),r.jsx("button",{onClick:()=>t(),className:"mt-4 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:"Retry"})]})}function X4(i){return it({queryKey:["serverLogs"],queryFn:async()=>{const e=await fetch("/api/logs?lines=1000",{headers:{"X-Plex-Token":localStorage.getItem("openflix_token")||""}});if(!e.ok)throw new Error("Failed to fetch logs");return e.json()},refetchInterval:i?5e3:!1})}function Q4(){const i=Ct();return Ze({mutationFn:async()=>{const e=await fetch("/api/logs",{method:"DELETE",headers:{"X-Plex-Token":localStorage.getItem("openflix_token")||""}});if(!e.ok)throw new Error("Failed to clear logs");return e.json()},onSuccess:()=>{i.invalidateQueries({queryKey:["serverLogs"]})}})}function G_(i){return i.includes("level=debug")||i.includes('"level":"debug"')?"debug":i.includes("level=info")||i.includes('"level":"info"')?"info":i.includes("level=warning")||i.includes('"level":"warning"')?"warn":i.includes("level=error")||i.includes('"level":"error"')?"error":null}const Z4={debug:"text-gray-400",info:"text-blue-400",warn:"text-yellow-400",error:"text-red-400"};function J4(){const[i,e]=K.useState(!0),[t,s]=K.useState("all"),[a,l]=K.useState(""),{data:c,isLoading:u,refetch:f}=X4(i),d=Q4(),m=K.useRef(null),[g,y]=K.useState(!0);K.useEffect(()=>{g&&m.current&&m.current.scrollIntoView({behavior:"smooth"})},[c?.lines,g]);const x=c?.lines.filter(E=>!(t!=="all"&&G_(E)!==t||a&&!E.toLowerCase().includes(a.toLowerCase())))||[],v=()=>{if(!c?.lines)return;const E=c.lines.join(`
`),A=new Blob([E],{type:"text/plain"}),R=URL.createObjectURL(A),D=document.createElement("a");D.href=R,D.download=`openflix-logs-${new Date().toISOString().split("T")[0]}.log`,D.click(),URL.revokeObjectURL(R)};return r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("h1",{className:"text-2xl font-bold text-white",children:"Server Logs"}),r.jsx("p",{className:"text-gray-400 mt-1",children:c?.path?`Log file: ${c.path}`:"View server logs in real-time"})]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[r.jsx("input",{type:"text",placeholder:"Search logs...",value:a,onChange:E=>l(E.target.value),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm w-64"}),r.jsxs("select",{value:t,onChange:E=>s(E.target.value),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",children:[r.jsx("option",{value:"all",children:"All Levels"}),r.jsx("option",{value:"debug",children:"Debug"}),r.jsx("option",{value:"info",children:"Info"}),r.jsx("option",{value:"warn",children:"Warning"}),r.jsx("option",{value:"error",children:"Error"})]}),r.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:i,onChange:E=>e(E.target.checked),className:"rounded bg-gray-700 border-gray-600"}),"Auto-refresh"]}),r.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:g,onChange:E=>y(E.target.checked),className:"rounded bg-gray-700 border-gray-600"}),"Auto-scroll"]}),r.jsx("div",{className:"flex-1"}),r.jsxs("button",{onClick:()=>f(),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:[r.jsx(vs,{className:"h-4 w-4"}),"Refresh"]}),r.jsxs("button",{onClick:v,disabled:!c?.lines.length,className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 text-white rounded-lg text-sm",children:[r.jsx(Ri,{className:"h-4 w-4"}),"Download"]}),r.jsxs("button",{onClick:()=>{confirm("Are you sure you want to clear all logs?")&&d.mutate()},disabled:d.isPending,className:"flex items-center gap-2 px-3 py-2 bg-red-600 hover:bg-red-700 disabled:opacity-50 text-white rounded-lg text-sm",children:[r.jsx(an,{className:"h-4 w-4"}),"Clear"]})]}),r.jsxs("div",{className:"text-sm text-gray-400 mb-2",children:["Showing ",x.length," of ",c?.count||0," log entries",c?.level&&r.jsxs("span",{className:"ml-2",children:["(Log level: ",c.level,")"]})]}),r.jsx("div",{className:"flex-1 bg-gray-900 rounded-xl overflow-hidden",children:u?r.jsx("div",{className:"p-4 text-gray-400",children:"Loading logs..."}):x.length===0?r.jsxs("div",{className:"p-8 text-center",children:[r.jsx(Xn,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No logs found"}),r.jsx("p",{className:"text-gray-400",children:a||t!=="all"?"Try adjusting your filters":"Logs will appear here as they are generated"})]}):r.jsxs("div",{className:"h-full overflow-auto p-4 font-mono text-xs leading-relaxed",children:[x.map((E,A)=>{const R=G_(E);return r.jsx("div",{className:`${R?Z4[R]:"text-gray-300"} hover:bg-gray-800 px-1 -mx-1 rounded`,children:E},A)}),r.jsx("div",{ref:m})]})}),!g&&r.jsx("button",{onClick:()=>m.current?.scrollIntoView({behavior:"smooth"}),className:"fixed bottom-8 right-8 p-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full shadow-lg",children:r.jsx(vb,{className:"h-5 w-5"})})]})}function eP(){return it({queryKey:["serverConfig"],queryFn:()=>Le.getServerConfig(),retry:!1})}function tP({title:i,children:e}){return r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[r.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:i}),r.jsx("div",{className:"space-y-4",children:e})]})}function yo({label:i,description:e,children:t}){return r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:i}),e&&r.jsx("p",{className:"text-xs text-gray-500 mb-2",children:e}),t]})}function sP(){const i=Ct(),[e,t]=K.useState(!1),{data:s,isLoading:a,error:l}=it({queryKey:["dvrSettings"],queryFn:()=>Le.getDVRSettings(),retry:1}),{data:c}=it({queryKey:["commercialDetectionStatus"],queryFn:()=>Le.getCommercialDetectionStatus(),retry:1}),[u,f]=K.useState(0);K.useEffect(()=>{s&&f(s.maxConcurrentRecordings)},[s]);const d=Ze({mutationFn:g=>Le.updateDVRSettings(g),onSuccess:()=>{i.invalidateQueries({queryKey:["dvrSettings"]}),t(!0),setTimeout(()=>t(!1),3e3)}}),m=()=>{d.mutate({maxConcurrentRecordings:u})};return a?r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[r.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"DVR Settings"}),r.jsx("div",{className:"text-gray-400",children:"Loading..."})]}):l?r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[r.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"DVR Settings"}),r.jsx("div",{className:"text-red-400 text-sm",children:"Failed to load DVR settings"})]}):r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h2",{className:"text-lg font-semibold text-white",children:"DVR Settings"}),r.jsxs("button",{onClick:m,disabled:d.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white text-sm rounded-lg",children:[r.jsx(Ab,{className:"h-3.5 w-3.5"}),d.isPending?"Saving...":e?"Saved!":"Save"]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsx(yo,{label:"Max Concurrent Recordings",description:"Maximum number of recordings that can run at the same time. Set to 0 for unlimited.",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("input",{type:"number",min:"0",value:u,onChange:g=>f(Number(g.target.value)),className:"w-32 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"}),r.jsx("span",{className:"text-gray-400 text-sm",children:u===0?"(Unlimited)":`(Max ${u} at once)`})]})}),r.jsx("p",{className:"text-xs text-gray-500",children:"If you have limited tuners or bandwidth, you may want to set a limit. When conflicts occur, higher priority recordings will be preferred."}),r.jsxs("div",{className:"pt-4 border-t border-gray-700",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"Commercial Detection"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Automatically detect and skip commercials in recordings using Comskip"})]}),r.jsx("div",{className:"flex items-center gap-2",children:c?.enabled?r.jsxs(r.Fragment,{children:[r.jsx(Zn,{className:"h-4 w-4 text-green-400"}),r.jsx("span",{className:"text-sm text-green-400",children:"Enabled"})]}):r.jsxs(r.Fragment,{children:[r.jsx(rg,{className:"h-4 w-4 text-gray-500"}),r.jsx("span",{className:"text-sm text-gray-500",children:"Not Available"})]})})]}),!c?.enabled&&r.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Comskip is not installed. Commercial detection will be enabled automatically when Comskip is available."})]})]})]})}function iP({vodApiUrl:i,onUrlChange:e}){const[t,s]=K.useState(null),[a,l]=K.useState(!1),c=async()=>{if(!i){s({connected:!1,error:"Please enter a VOD API URL"});return}l(!0),s(null);try{const u=await Le.vod.testConnection(i);s(u)}catch(u){s({connected:!1,error:u.message||"Connection failed"})}finally{l(!1)}};return r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[r.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"VOD Downloads"}),r.jsxs("div",{className:"space-y-4",children:[r.jsx(yo,{label:"VOD API URL",description:"URL of the external VOD download service (e.g., http://192.168.1.82:7070)",children:r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{type:"text",value:i,onChange:u=>{e(u.target.value),s(null)},className:"flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://192.168.1.82:7070"}),r.jsx("button",{onClick:c,disabled:a,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 text-white rounded-lg whitespace-nowrap",children:a?r.jsx(ii,{className:"w-4 h-4 animate-spin"}):"Test Connection"})]})}),t&&r.jsx("div",{className:`flex items-center gap-2 p-3 rounded-lg ${t.connected?"bg-green-500/10 border border-green-500/30":"bg-red-500/10 border border-red-500/30"}`,children:t.connected?r.jsxs(r.Fragment,{children:[r.jsx(Zn,{className:"w-4 h-4 text-green-400"}),r.jsx("span",{className:"text-green-400 text-sm",children:"Connection successful"})]}):r.jsxs(r.Fragment,{children:[r.jsx(rg,{className:"w-4 h-4 text-red-400"}),r.jsx("span",{className:"text-red-400 text-sm",children:t.error||"Connection failed"})]})}),r.jsx("p",{className:"text-xs text-gray-500",children:"The VOD service provides access to Disney+ and other streaming content for download. Downloads will be saved to your configured movie and TV show library paths."})]})]})}function nP(){const i=K.useRef(null),[e,t]=K.useState(!1),[s,a]=K.useState(!1),[l,c]=K.useState(null),[u,f]=K.useState(null),[d,m]=K.useState(null),{data:g,isLoading:y}=it({queryKey:["configStats"],queryFn:()=>Le.getConfigStats(),retry:1}),x=async()=>{t(!0),m(null);try{const R=await Le.exportConfig(),D=window.URL.createObjectURL(R),L=document.createElement("a");L.href=D,L.download=`openflix-config-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(L),L.click(),window.URL.revokeObjectURL(D),document.body.removeChild(L)}catch(R){m(R.message||"Failed to export configuration")}finally{t(!1)}},v=async R=>{const D=R.target.files?.[0];if(D){m(null),c(null),a(!0);try{const L=await D.text(),O=JSON.parse(L),H=await Le.importConfig(O,!0);c(H),f(O)}catch(L){m(L.message||"Failed to parse configuration file")}finally{a(!1),i.current&&(i.current.value="")}}},E=async()=>{if(u){a(!0),m(null);try{const R=await Le.importConfig(u,!1);c(R),f(null)}catch(R){m(R.message||"Failed to import configuration")}finally{a(!1)}}},A=()=>{f(null),c(null)};return r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[r.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Configuration Backup"}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("p",{className:"text-sm text-gray-400",children:"Export your entire OpenFlix configuration including channels, sources, EPG, libraries, users, playlists, and more."}),!y&&g&&r.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 p-4 bg-gray-900 rounded-lg",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-xl font-semibold text-white",children:g.channels}),r.jsx("div",{className:"text-xs text-gray-500",children:"Channels"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-xl font-semibold text-white",children:g.m3uSources+g.xtreamSources}),r.jsx("div",{className:"text-xs text-gray-500",children:"Sources"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-xl font-semibold text-white",children:g.epgSources}),r.jsx("div",{className:"text-xs text-gray-500",children:"EPG Sources"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-xl font-semibold text-white",children:g.libraries}),r.jsx("div",{className:"text-xs text-gray-500",children:"Libraries"})]})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsxs("button",{onClick:x,disabled:e,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg",children:[e?r.jsx(ii,{className:"h-4 w-4 animate-spin"}):r.jsx(Ri,{className:"h-4 w-4"}),e?"Exporting...":"Export Configuration"]}),r.jsx("input",{ref:i,type:"file",accept:".json",onChange:v,className:"hidden"}),r.jsxs("button",{onClick:()=>i.current?.click(),disabled:s,className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 text-white rounded-lg",children:[s?r.jsx(ii,{className:"h-4 w-4 animate-spin"}):r.jsx(Cb,{className:"h-4 w-4"}),s?"Processing...":"Import Configuration"]})]}),d&&r.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:[r.jsx(rg,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),r.jsx("span",{className:"text-red-400 text-sm",children:d})]}),l&&u!==null&&r.jsxs("div",{className:"p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg",children:[r.jsxs("div",{className:"flex items-start gap-2 mb-3",children:[r.jsx(Ns,{className:"h-5 w-5 text-yellow-400 flex-shrink-0 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-yellow-400",children:"Import Preview"}),r.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"This will import the following items. Existing items with the same ID will be updated."})]})]}),l.version&&r.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:["Export version: ",l.version," | Exported: ",l.exportedAt?new Date(l.exportedAt).toLocaleString():"Unknown"]}),r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 mb-4",children:l.counts&&Object.entries(l.counts).map(([R,D])=>D>0?r.jsxs("div",{className:"text-center p-2 bg-gray-800 rounded",children:[r.jsx("div",{className:"text-lg font-semibold text-white",children:D}),r.jsx("div",{className:"text-xs text-gray-500 capitalize",children:R.replace(/([A-Z])/g," $1").trim()})]},R):null)}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("button",{onClick:E,disabled:s,className:"flex items-center gap-2 px-4 py-2 bg-yellow-600 hover:bg-yellow-700 disabled:bg-yellow-800 text-white rounded-lg",children:[s?r.jsx(ii,{className:"h-4 w-4 animate-spin"}):r.jsx(Zn,{className:"h-4 w-4"}),s?"Importing...":"Confirm Import"]}),r.jsx("button",{onClick:A,disabled:s,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"})]})]}),l&&l.success&&u===null&&r.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-500/10 border border-green-500/30 rounded-lg",children:[r.jsx(Zn,{className:"h-4 w-4 text-green-400 flex-shrink-0"}),r.jsxs("span",{className:"text-green-400 text-sm",children:["Configuration imported successfully!",l.imported&&r.jsxs("span",{className:"text-gray-400 ml-2",children:["(",Object.entries(l.imported).filter(([,R])=>R>0).map(([R,D])=>`${D} ${R}`).join(", "),")"]})]})]}),r.jsx("p",{className:"text-xs text-gray-500",children:"Note: Passwords and sensitive credentials are not included in exports for security."})]})]})}function aP(){const{data:i,isLoading:e,error:t}=eP(),s=Ct(),[a,l]=K.useState({}),[c,u]=K.useState(!1);K.useEffect(()=>{i&&l(i)},[i]);const f=Ze({mutationFn:g=>Le.updateServerConfig(g),onSuccess:()=>{s.invalidateQueries({queryKey:["serverConfig"]}),u(!0),setTimeout(()=>u(!1),3e3)}}),d=()=>{f.mutate(a)},m=(g,y)=>{l(x=>({...x,[g]:y}))};return e?r.jsx("div",{className:"text-gray-400",children:"Loading settings..."}):t?r.jsxs("div",{children:[r.jsxs("div",{className:"mb-8",children:[r.jsx("h1",{className:"text-2xl font-bold text-white",children:"Settings"}),r.jsx("p",{className:"text-gray-400 mt-1",children:"Server configuration"})]}),r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[r.jsx("p",{className:"text-yellow-400 mb-4",children:"Settings API not available. Configure via config.yaml file."}),r.jsx("pre",{className:"text-sm text-gray-300 bg-gray-900 p-4 rounded-lg overflow-x-auto",children:`# ~/.openflix/config.yaml or ./config.yaml

server:
  host: "0.0.0.0"
  port: 32400

auth:
  jwt_secret: "change-me-in-production"
  token_expiry: 720
  allow_signup: true

library:
  scan_interval: 60
  metadata_lang: "en"
  tmdb_api_key: ""

livetv:
  enabled: true
  epg_interval: 12

dvr:
  enabled: true
  recording_dir: "~/.openflix/recordings"
  pre_padding: 2
  post_padding: 5

transcode:
  enabled: true
  ffmpeg_path: "ffmpeg"
  hardware_accel: "auto"
  max_sessions: 3`})]})]}):r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-8",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-white",children:"Settings"}),r.jsx("p",{className:"text-gray-400 mt-1",children:"Configure your OpenFlix server"})]}),r.jsxs("button",{onClick:d,disabled:f.isPending,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg",children:[r.jsx(Ab,{className:"h-4 w-4"}),f.isPending?"Saving...":c?"Saved!":"Save Changes"]})]}),r.jsxs(tP,{title:"Metadata",children:[r.jsx(yo,{label:"TMDB API Key",description:"For movie and TV show metadata (get yours at themoviedb.org)",children:r.jsx("input",{type:"password",value:a.tmdb_api_key||"",onChange:g=>m("tmdb_api_key",g.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"Enter your TMDB API key"})}),r.jsx(yo,{label:"TVDB API Key",description:"For additional TV show metadata (optional)",children:r.jsx("input",{type:"password",value:a.tvdb_api_key||"",onChange:g=>m("tvdb_api_key",g.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"Enter your TVDB API key"})}),r.jsx(yo,{label:"Metadata Language",description:"Preferred language for metadata",children:r.jsxs("select",{value:a.metadata_lang||"en",onChange:g=>m("metadata_lang",g.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:[r.jsx("option",{value:"en",children:"English"}),r.jsx("option",{value:"es",children:"Spanish"}),r.jsx("option",{value:"fr",children:"French"}),r.jsx("option",{value:"de",children:"German"}),r.jsx("option",{value:"it",children:"Italian"}),r.jsx("option",{value:"pt",children:"Portuguese"}),r.jsx("option",{value:"ja",children:"Japanese"}),r.jsx("option",{value:"ko",children:"Korean"}),r.jsx("option",{value:"zh",children:"Chinese"})]})}),r.jsx(yo,{label:"Scan Interval",description:"Minutes between automatic library scans",children:r.jsx("input",{type:"number",value:a.scan_interval||60,onChange:g=>m("scan_interval",Number(g.target.value)),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"})})]}),r.jsx(sP,{}),r.jsx(iP,{vodApiUrl:a.vod_api_url||"",onUrlChange:g=>m("vod_api_url",g)}),r.jsx(nP,{}),r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[r.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Other Settings"}),r.jsxs("p",{className:"text-gray-400 text-sm",children:["Additional server settings (Live TV, Transcoding) can be configured via the ",r.jsx("code",{className:"bg-gray-700 px-2 py-1 rounded",children:"config.yaml"})," file."]}),r.jsxs("p",{className:"text-gray-500 text-sm mt-2",children:["Location: ",r.jsx("code",{className:"bg-gray-700 px-2 py-1 rounded",children:"~/.openflix/config.yaml"})]})]})]})}var rP=Object.defineProperty,ud=Object.getOwnPropertySymbols,PE=Object.prototype.hasOwnProperty,BE=Object.prototype.propertyIsEnumerable,$_=(i,e,t)=>e in i?rP(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Hm=(i,e)=>{for(var t in e||(e={}))PE.call(e,t)&&$_(i,t,e[t]);if(ud)for(var t of ud(e))BE.call(e,t)&&$_(i,t,e[t]);return i},Km=(i,e)=>{var t={};for(var s in i)PE.call(i,s)&&e.indexOf(s)<0&&(t[s]=i[s]);if(i!=null&&ud)for(var s of ud(i))e.indexOf(s)<0&&BE.call(i,s)&&(t[s]=i[s]);return t};var Er;(i=>{const e=class Rt{constructor(f,d,m,g){if(this.version=f,this.errorCorrectionLevel=d,this.modules=[],this.isFunction=[],f<Rt.MIN_VERSION||f>Rt.MAX_VERSION)throw new RangeError("Version value out of range");if(g<-1||g>7)throw new RangeError("Mask value out of range");this.size=f*4+17;let y=[];for(let v=0;v<this.size;v++)y.push(!1);for(let v=0;v<this.size;v++)this.modules.push(y.slice()),this.isFunction.push(y.slice());this.drawFunctionPatterns();const x=this.addEccAndInterleave(m);if(this.drawCodewords(x),g==-1){let v=1e9;for(let E=0;E<8;E++){this.applyMask(E),this.drawFormatBits(E);const A=this.getPenaltyScore();A<v&&(g=E,v=A),this.applyMask(E)}}a(0<=g&&g<=7),this.mask=g,this.applyMask(g),this.drawFormatBits(g),this.isFunction=[]}static encodeText(f,d){const m=i.QrSegment.makeSegments(f);return Rt.encodeSegments(m,d)}static encodeBinary(f,d){const m=i.QrSegment.makeBytes(f);return Rt.encodeSegments([m],d)}static encodeSegments(f,d,m=1,g=40,y=-1,x=!0){if(!(Rt.MIN_VERSION<=m&&m<=g&&g<=Rt.MAX_VERSION)||y<-1||y>7)throw new RangeError("Invalid value");let v,E;for(v=m;;v++){const L=Rt.getNumDataCodewords(v,d)*8,O=c.getTotalBits(f,v);if(O<=L){E=O;break}if(v>=g)throw new RangeError("Data too long")}for(const L of[Rt.Ecc.MEDIUM,Rt.Ecc.QUARTILE,Rt.Ecc.HIGH])x&&E<=Rt.getNumDataCodewords(v,L)*8&&(d=L);let A=[];for(const L of f){t(L.mode.modeBits,4,A),t(L.numChars,L.mode.numCharCountBits(v),A);for(const O of L.getData())A.push(O)}a(A.length==E);const R=Rt.getNumDataCodewords(v,d)*8;a(A.length<=R),t(0,Math.min(4,R-A.length),A),t(0,(8-A.length%8)%8,A),a(A.length%8==0);for(let L=236;A.length<R;L^=253)t(L,8,A);let D=[];for(;D.length*8<A.length;)D.push(0);return A.forEach((L,O)=>D[O>>>3]|=L<<7-(O&7)),new Rt(v,d,D,y)}getModule(f,d){return 0<=f&&f<this.size&&0<=d&&d<this.size&&this.modules[d][f]}getModules(){return this.modules}drawFunctionPatterns(){for(let m=0;m<this.size;m++)this.setFunctionModule(6,m,m%2==0),this.setFunctionModule(m,6,m%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const f=this.getAlignmentPatternPositions(),d=f.length;for(let m=0;m<d;m++)for(let g=0;g<d;g++)m==0&&g==0||m==0&&g==d-1||m==d-1&&g==0||this.drawAlignmentPattern(f[m],f[g]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(f){const d=this.errorCorrectionLevel.formatBits<<3|f;let m=d;for(let y=0;y<10;y++)m=m<<1^(m>>>9)*1335;const g=(d<<10|m)^21522;a(g>>>15==0);for(let y=0;y<=5;y++)this.setFunctionModule(8,y,s(g,y));this.setFunctionModule(8,7,s(g,6)),this.setFunctionModule(8,8,s(g,7)),this.setFunctionModule(7,8,s(g,8));for(let y=9;y<15;y++)this.setFunctionModule(14-y,8,s(g,y));for(let y=0;y<8;y++)this.setFunctionModule(this.size-1-y,8,s(g,y));for(let y=8;y<15;y++)this.setFunctionModule(8,this.size-15+y,s(g,y));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let f=this.version;for(let m=0;m<12;m++)f=f<<1^(f>>>11)*7973;const d=this.version<<12|f;a(d>>>18==0);for(let m=0;m<18;m++){const g=s(d,m),y=this.size-11+m%3,x=Math.floor(m/3);this.setFunctionModule(y,x,g),this.setFunctionModule(x,y,g)}}drawFinderPattern(f,d){for(let m=-4;m<=4;m++)for(let g=-4;g<=4;g++){const y=Math.max(Math.abs(g),Math.abs(m)),x=f+g,v=d+m;0<=x&&x<this.size&&0<=v&&v<this.size&&this.setFunctionModule(x,v,y!=2&&y!=4)}}drawAlignmentPattern(f,d){for(let m=-2;m<=2;m++)for(let g=-2;g<=2;g++)this.setFunctionModule(f+g,d+m,Math.max(Math.abs(g),Math.abs(m))!=1)}setFunctionModule(f,d,m){this.modules[d][f]=m,this.isFunction[d][f]=!0}addEccAndInterleave(f){const d=this.version,m=this.errorCorrectionLevel;if(f.length!=Rt.getNumDataCodewords(d,m))throw new RangeError("Invalid argument");const g=Rt.NUM_ERROR_CORRECTION_BLOCKS[m.ordinal][d],y=Rt.ECC_CODEWORDS_PER_BLOCK[m.ordinal][d],x=Math.floor(Rt.getNumRawDataModules(d)/8),v=g-x%g,E=Math.floor(x/g);let A=[];const R=Rt.reedSolomonComputeDivisor(y);for(let L=0,O=0;L<g;L++){let H=f.slice(O,O+E-y+(L<v?0:1));O+=H.length;const q=Rt.reedSolomonComputeRemainder(H,R);L<v&&H.push(0),A.push(H.concat(q))}let D=[];for(let L=0;L<A[0].length;L++)A.forEach((O,H)=>{(L!=E-y||H>=v)&&D.push(O[L])});return a(D.length==x),D}drawCodewords(f){if(f.length!=Math.floor(Rt.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let d=0;for(let m=this.size-1;m>=1;m-=2){m==6&&(m=5);for(let g=0;g<this.size;g++)for(let y=0;y<2;y++){const x=m-y,E=(m+1&2)==0?this.size-1-g:g;!this.isFunction[E][x]&&d<f.length*8&&(this.modules[E][x]=s(f[d>>>3],7-(d&7)),d++)}}a(d==f.length*8)}applyMask(f){if(f<0||f>7)throw new RangeError("Mask value out of range");for(let d=0;d<this.size;d++)for(let m=0;m<this.size;m++){let g;switch(f){case 0:g=(m+d)%2==0;break;case 1:g=d%2==0;break;case 2:g=m%3==0;break;case 3:g=(m+d)%3==0;break;case 4:g=(Math.floor(m/3)+Math.floor(d/2))%2==0;break;case 5:g=m*d%2+m*d%3==0;break;case 6:g=(m*d%2+m*d%3)%2==0;break;case 7:g=((m+d)%2+m*d%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[d][m]&&g&&(this.modules[d][m]=!this.modules[d][m])}}getPenaltyScore(){let f=0;for(let y=0;y<this.size;y++){let x=!1,v=0,E=[0,0,0,0,0,0,0];for(let A=0;A<this.size;A++)this.modules[y][A]==x?(v++,v==5?f+=Rt.PENALTY_N1:v>5&&f++):(this.finderPenaltyAddHistory(v,E),x||(f+=this.finderPenaltyCountPatterns(E)*Rt.PENALTY_N3),x=this.modules[y][A],v=1);f+=this.finderPenaltyTerminateAndCount(x,v,E)*Rt.PENALTY_N3}for(let y=0;y<this.size;y++){let x=!1,v=0,E=[0,0,0,0,0,0,0];for(let A=0;A<this.size;A++)this.modules[A][y]==x?(v++,v==5?f+=Rt.PENALTY_N1:v>5&&f++):(this.finderPenaltyAddHistory(v,E),x||(f+=this.finderPenaltyCountPatterns(E)*Rt.PENALTY_N3),x=this.modules[A][y],v=1);f+=this.finderPenaltyTerminateAndCount(x,v,E)*Rt.PENALTY_N3}for(let y=0;y<this.size-1;y++)for(let x=0;x<this.size-1;x++){const v=this.modules[y][x];v==this.modules[y][x+1]&&v==this.modules[y+1][x]&&v==this.modules[y+1][x+1]&&(f+=Rt.PENALTY_N2)}let d=0;for(const y of this.modules)d=y.reduce((x,v)=>x+(v?1:0),d);const m=this.size*this.size,g=Math.ceil(Math.abs(d*20-m*10)/m)-1;return a(0<=g&&g<=9),f+=g*Rt.PENALTY_N4,a(0<=f&&f<=2568888),f}getAlignmentPatternPositions(){if(this.version==1)return[];{const f=Math.floor(this.version/7)+2,d=this.version==32?26:Math.ceil((this.version*4+4)/(f*2-2))*2;let m=[6];for(let g=this.size-7;m.length<f;g-=d)m.splice(1,0,g);return m}}static getNumRawDataModules(f){if(f<Rt.MIN_VERSION||f>Rt.MAX_VERSION)throw new RangeError("Version number out of range");let d=(16*f+128)*f+64;if(f>=2){const m=Math.floor(f/7)+2;d-=(25*m-10)*m-55,f>=7&&(d-=36)}return a(208<=d&&d<=29648),d}static getNumDataCodewords(f,d){return Math.floor(Rt.getNumRawDataModules(f)/8)-Rt.ECC_CODEWORDS_PER_BLOCK[d.ordinal][f]*Rt.NUM_ERROR_CORRECTION_BLOCKS[d.ordinal][f]}static reedSolomonComputeDivisor(f){if(f<1||f>255)throw new RangeError("Degree out of range");let d=[];for(let g=0;g<f-1;g++)d.push(0);d.push(1);let m=1;for(let g=0;g<f;g++){for(let y=0;y<d.length;y++)d[y]=Rt.reedSolomonMultiply(d[y],m),y+1<d.length&&(d[y]^=d[y+1]);m=Rt.reedSolomonMultiply(m,2)}return d}static reedSolomonComputeRemainder(f,d){let m=d.map(g=>0);for(const g of f){const y=g^m.shift();m.push(0),d.forEach((x,v)=>m[v]^=Rt.reedSolomonMultiply(x,y))}return m}static reedSolomonMultiply(f,d){if(f>>>8||d>>>8)throw new RangeError("Byte out of range");let m=0;for(let g=7;g>=0;g--)m=m<<1^(m>>>7)*285,m^=(d>>>g&1)*f;return a(m>>>8==0),m}finderPenaltyCountPatterns(f){const d=f[1];a(d<=this.size*3);const m=d>0&&f[2]==d&&f[3]==d*3&&f[4]==d&&f[5]==d;return(m&&f[0]>=d*4&&f[6]>=d?1:0)+(m&&f[6]>=d*4&&f[0]>=d?1:0)}finderPenaltyTerminateAndCount(f,d,m){return f&&(this.finderPenaltyAddHistory(d,m),d=0),d+=this.size,this.finderPenaltyAddHistory(d,m),this.finderPenaltyCountPatterns(m)}finderPenaltyAddHistory(f,d){d[0]==0&&(f+=this.size),d.pop(),d.unshift(f)}};e.MIN_VERSION=1,e.MAX_VERSION=40,e.PENALTY_N1=3,e.PENALTY_N2=3,e.PENALTY_N3=40,e.PENALTY_N4=10,e.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],e.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],i.QrCode=e;function t(u,f,d){if(f<0||f>31||u>>>f)throw new RangeError("Value out of range");for(let m=f-1;m>=0;m--)d.push(u>>>m&1)}function s(u,f){return(u>>>f&1)!=0}function a(u){if(!u)throw new Error("Assertion error")}const l=class ps{constructor(f,d,m){if(this.mode=f,this.numChars=d,this.bitData=m,d<0)throw new RangeError("Invalid argument");this.bitData=m.slice()}static makeBytes(f){let d=[];for(const m of f)t(m,8,d);return new ps(ps.Mode.BYTE,f.length,d)}static makeNumeric(f){if(!ps.isNumeric(f))throw new RangeError("String contains non-numeric characters");let d=[];for(let m=0;m<f.length;){const g=Math.min(f.length-m,3);t(parseInt(f.substring(m,m+g),10),g*3+1,d),m+=g}return new ps(ps.Mode.NUMERIC,f.length,d)}static makeAlphanumeric(f){if(!ps.isAlphanumeric(f))throw new RangeError("String contains unencodable characters in alphanumeric mode");let d=[],m;for(m=0;m+2<=f.length;m+=2){let g=ps.ALPHANUMERIC_CHARSET.indexOf(f.charAt(m))*45;g+=ps.ALPHANUMERIC_CHARSET.indexOf(f.charAt(m+1)),t(g,11,d)}return m<f.length&&t(ps.ALPHANUMERIC_CHARSET.indexOf(f.charAt(m)),6,d),new ps(ps.Mode.ALPHANUMERIC,f.length,d)}static makeSegments(f){return f==""?[]:ps.isNumeric(f)?[ps.makeNumeric(f)]:ps.isAlphanumeric(f)?[ps.makeAlphanumeric(f)]:[ps.makeBytes(ps.toUtf8ByteArray(f))]}static makeEci(f){let d=[];if(f<0)throw new RangeError("ECI assignment value out of range");if(f<128)t(f,8,d);else if(f<16384)t(2,2,d),t(f,14,d);else if(f<1e6)t(6,3,d),t(f,21,d);else throw new RangeError("ECI assignment value out of range");return new ps(ps.Mode.ECI,0,d)}static isNumeric(f){return ps.NUMERIC_REGEX.test(f)}static isAlphanumeric(f){return ps.ALPHANUMERIC_REGEX.test(f)}getData(){return this.bitData.slice()}static getTotalBits(f,d){let m=0;for(const g of f){const y=g.mode.numCharCountBits(d);if(g.numChars>=1<<y)return 1/0;m+=4+y+g.bitData.length}return m}static toUtf8ByteArray(f){f=encodeURI(f);let d=[];for(let m=0;m<f.length;m++)f.charAt(m)!="%"?d.push(f.charCodeAt(m)):(d.push(parseInt(f.substring(m+1,m+3),16)),m+=2);return d}};l.NUMERIC_REGEX=/^[0-9]*$/,l.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,l.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let c=l;i.QrSegment=l})(Er||(Er={}));(i=>{(e=>{const t=class{constructor(a,l){this.ordinal=a,this.formatBits=l}};t.LOW=new t(0,1),t.MEDIUM=new t(1,0),t.QUARTILE=new t(2,3),t.HIGH=new t(3,2),e.Ecc=t})(i.QrCode||(i.QrCode={}))})(Er||(Er={}));(i=>{(e=>{const t=class{constructor(a,l){this.modeBits=a,this.numBitsCharCount=l}numCharCountBits(a){return this.numBitsCharCount[Math.floor((a+7)/17)]}};t.NUMERIC=new t(1,[10,12,14]),t.ALPHANUMERIC=new t(2,[9,11,13]),t.BYTE=new t(4,[8,16,16]),t.KANJI=new t(8,[8,10,12]),t.ECI=new t(7,[0,0,0]),e.Mode=t})(i.QrSegment||(i.QrSegment={}))})(Er||(Er={}));var xo=Er;var oP={L:xo.QrCode.Ecc.LOW,M:xo.QrCode.Ecc.MEDIUM,Q:xo.QrCode.Ecc.QUARTILE,H:xo.QrCode.Ecc.HIGH},UE=128,FE="L",GE="#FFFFFF",$E="#000000",VE=!1,HE=1,lP=4,cP=0,uP=.1;function KE(i,e=0){const t=[];return i.forEach(function(s,a){let l=null;s.forEach(function(c,u){if(!c&&l!==null){t.push(`M${l+e} ${a+e}h${u-l}v1H${l+e}z`),l=null;return}if(u===s.length-1){if(!c)return;l===null?t.push(`M${u+e},${a+e} h1v1H${u+e}z`):t.push(`M${l+e},${a+e} h${u+1-l}v1H${l+e}z`);return}c&&l===null&&(l=u)})}),t.join("")}function zE(i,e){return i.slice().map((t,s)=>s<e.y||s>=e.y+e.h?t:t.map((a,l)=>l<e.x||l>=e.x+e.w?a:!1))}function dP(i,e,t,s){if(s==null)return null;const a=i.length+t*2,l=Math.floor(e*uP),c=a/e,u=(s.width||l)*c,f=(s.height||l)*c,d=s.x==null?i.length/2-u/2:s.x*c,m=s.y==null?i.length/2-f/2:s.y*c,g=s.opacity==null?1:s.opacity;let y=null;if(s.excavate){let v=Math.floor(d),E=Math.floor(m),A=Math.ceil(u+d-v),R=Math.ceil(f+m-E);y={x:v,y:E,w:A,h:R}}const x=s.crossOrigin;return{x:d,y:m,h:f,w:u,excavation:y,opacity:g,crossOrigin:x}}function hP(i,e){return e!=null?Math.max(Math.floor(e),0):i?lP:cP}function qE({value:i,level:e,minVersion:t,includeMargin:s,marginSize:a,imageSettings:l,size:c,boostLevel:u}){let f=Ds.useMemo(()=>{const v=(Array.isArray(i)?i:[i]).reduce((E,A)=>(E.push(...xo.QrSegment.makeSegments(A)),E),[]);return xo.QrCode.encodeSegments(v,oP[e],t,void 0,void 0,u)},[i,e,t,u]);const{cells:d,margin:m,numCells:g,calculatedImageSettings:y}=Ds.useMemo(()=>{let x=f.getModules();const v=hP(s,a),E=x.length+v*2,A=dP(x,c,v,l);return{cells:x,margin:v,numCells:E,calculatedImageSettings:A}},[f,c,l,s,a]);return{qrcode:f,margin:m,cells:d,numCells:g,calculatedImageSettings:y}}var fP=(function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0})(),mP=Ds.forwardRef(function(e,t){const s=e,{value:a,size:l=UE,level:c=FE,bgColor:u=GE,fgColor:f=$E,includeMargin:d=VE,minVersion:m=HE,boostLevel:g,marginSize:y,imageSettings:x}=s,E=Km(s,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:A}=E,R=Km(E,["style"]),D=x?.src,L=Ds.useRef(null),O=Ds.useRef(null),H=Ds.useCallback(ie=>{L.current=ie,typeof t=="function"?t(ie):t&&(t.current=ie)},[t]),[q,U]=Ds.useState(!1),{margin:k,cells:M,numCells:I,calculatedImageSettings:j}=qE({value:a,level:c,minVersion:m,boostLevel:g,includeMargin:d,marginSize:y,imageSettings:x,size:l});Ds.useEffect(()=>{if(L.current!=null){const ie=L.current,re=ie.getContext("2d");if(!re)return;let Q=M;const se=O.current,oe=j!=null&&se!==null&&se.complete&&se.naturalHeight!==0&&se.naturalWidth!==0;oe&&j.excavation!=null&&(Q=zE(M,j.excavation));const Y=window.devicePixelRatio||1;ie.height=ie.width=l*Y;const V=l/I*Y;re.scale(V,V),re.fillStyle=u,re.fillRect(0,0,I,I),re.fillStyle=f,fP?re.fill(new Path2D(KE(Q,k))):M.forEach(function($,X){$.forEach(function(me,ve){me&&re.fillRect(ve+k,X+k,1,1)})}),j&&(re.globalAlpha=j.opacity),oe&&re.drawImage(se,j.x+k,j.y+k,j.w,j.h)}}),Ds.useEffect(()=>{U(!1)},[D]);const Z=Hm({height:l,width:l},A);let ae=null;return D!=null&&(ae=Ds.createElement("img",{src:D,key:D,style:{display:"none"},onLoad:()=>{U(!0)},ref:O,crossOrigin:j?.crossOrigin})),Ds.createElement(Ds.Fragment,null,Ds.createElement("canvas",Hm({style:Z,height:l,width:l,ref:H,role:"img"},R)),ae)});mP.displayName="QRCodeCanvas";var YE=Ds.forwardRef(function(e,t){const s=e,{value:a,size:l=UE,level:c=FE,bgColor:u=GE,fgColor:f=$E,includeMargin:d=VE,minVersion:m=HE,boostLevel:g,title:y,marginSize:x,imageSettings:v}=s,E=Km(s,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:A,cells:R,numCells:D,calculatedImageSettings:L}=qE({value:a,level:c,minVersion:m,boostLevel:g,includeMargin:d,marginSize:x,imageSettings:v,size:l});let O=R,H=null;v!=null&&L!=null&&(L.excavation!=null&&(O=zE(R,L.excavation)),H=Ds.createElement("image",{href:v.src,height:L.h,width:L.w,x:L.x+A,y:L.y+A,preserveAspectRatio:"none",opacity:L.opacity,crossOrigin:L.crossOrigin}));const q=KE(O,A);return Ds.createElement("svg",Hm({height:l,width:l,viewBox:`0 0 ${D} ${D}`,ref:t,role:"img"},E),!!y&&Ds.createElement("title",null,y),Ds.createElement("path",{fill:u,d:`M0,0 h${D}v${D}H0z`,shapeRendering:"crispEdges"}),Ds.createElement("path",{fill:f,d:q,shapeRendering:"crispEdges"}),H)});YE.displayName="QRCodeSVG";function gP(i){if(i===0)return"0 Bytes";const e=1024,t=["Bytes","KB","MB","GB"],s=Math.floor(Math.log(i)/Math.log(e));return parseFloat((i/Math.pow(e,s)).toFixed(2))+" "+t[s]}function pP(i){switch(i){case"android":return r.jsx(ju,{className:"h-8 w-8"});case"android-tv":return r.jsx(Qs,{className:"h-8 w-8"});case"ios":return r.jsx(xm,{className:"h-8 w-8"});case"macos":return r.jsx(xm,{className:"h-8 w-8"});case"windows":return r.jsx(Sb,{className:"h-8 w-8"});case"linux":return r.jsx(CR,{className:"h-8 w-8"});default:return r.jsx(Ri,{className:"h-8 w-8"})}}function V_(i){switch(i){case"android":case"android-tv":return"bg-green-500/20 text-green-400 border-green-500/30";case"ios":case"macos":return"bg-gray-500/20 text-gray-300 border-gray-500/30";case"windows":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"linux":return"bg-orange-500/20 text-orange-400 border-orange-500/30";default:return"bg-purple-500/20 text-purple-400 border-purple-500/30"}}function yP(){const[i,e]=K.useState(!1),[t,s]=K.useState(null),{data:a,isLoading:l,error:c}=it({queryKey:["downloads"],queryFn:async()=>{const d=await fetch("/downloads");if(!d.ok)throw new Error("Failed to fetch downloads");return d.json()}}),u=typeof window<"u"?window.location.origin:"",f=d=>{s(d),e(!0)};return r.jsxs("div",{children:[r.jsxs("div",{className:"mb-8",children:[r.jsx("h1",{className:"text-2xl font-bold text-white",children:"Download Apps"}),r.jsx("p",{className:"text-gray-400 mt-1",children:"Download OpenFlix apps for your devices to stream your media library"})]}),l&&r.jsx("div",{className:"flex items-center justify-center py-12",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"})}),c&&r.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-4 text-red-400",children:"Failed to load downloads. Please try again later."}),a&&a.downloads.length===0&&r.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[r.jsx(Ri,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No Apps Available"}),r.jsx("p",{className:"text-gray-400",children:"No app downloads are currently available. Check back later."})]}),a&&a.downloads.length>0&&r.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:a.downloads.map(d=>r.jsxs("div",{className:`bg-gray-800 rounded-xl p-6 border ${V_(d.platform)} hover:border-opacity-60 transition-colors`,children:[r.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[r.jsx("div",{className:`p-3 rounded-lg ${V_(d.platform)}`,children:pP(d.platform)}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("h3",{className:"text-lg font-semibold text-white truncate",children:d.name}),r.jsxs("p",{className:"text-sm text-gray-400",children:["Version ",d.version]})]})]}),r.jsx("p",{className:"text-sm text-gray-300 mb-4",children:d.description}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-sm text-gray-500",children:gP(d.size)}),r.jsxs("div",{className:"flex gap-2",children:[(d.platform==="android"||d.platform==="android-tv")&&r.jsxs("button",{onClick:()=>f(d),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white text-sm font-medium rounded-lg transition-colors",title:"Send to TV",children:[r.jsx($R,{className:"h-4 w-4"}),r.jsx("span",{className:"hidden sm:inline",children:"Send to TV"})]}),r.jsxs("a",{href:d.downloadUrl,download:!0,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium rounded-lg transition-colors",children:[r.jsx(Ri,{className:"h-4 w-4"}),"Download"]})]})]})]},d.filename))}),r.jsxs("div",{className:"mt-12",children:[r.jsx("h2",{className:"text-xl font-semibold text-white mb-6",children:"Installation Instructions"}),r.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[r.jsx(Qs,{className:"h-6 w-6 text-green-400"}),r.jsx("h3",{className:"text-lg font-medium text-white",children:"Android TV / Fire TV"})]}),r.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-sm text-gray-300",children:[r.jsx("li",{children:"Download the APK file to a USB drive or use a file manager app"}),r.jsxs("li",{children:['Enable "Install from unknown sources" in Settings ',">"," Security"]}),r.jsx("li",{children:"Use a file manager to locate and install the APK"}),r.jsx("li",{children:"Launch OpenFlix from your apps"})]})]}),r.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[r.jsx(ju,{className:"h-6 w-6 text-green-400"}),r.jsx("h3",{className:"text-lg font-medium text-white",children:"Android Phone / Tablet"})]}),r.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-sm text-gray-300",children:[r.jsx("li",{children:"Download the APK file directly on your device"}),r.jsx("li",{children:"Open the downloaded file from your notifications or Downloads app"}),r.jsx("li",{children:"Allow installation from this source if prompted"}),r.jsx("li",{children:"Tap Install and wait for completion"})]})]})]})]}),r.jsxs("div",{className:"mt-8 bg-gray-800 rounded-xl p-6",children:[r.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"Quick Setup"}),r.jsx("p",{className:"text-sm text-gray-300 mb-4",children:"After installing the app, open it and enter your server address to connect:"}),r.jsx("div",{className:"bg-gray-900 rounded-lg p-4 font-mono text-indigo-400",children:u||"http://your-server:32400"})]}),i&&t&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",onClick:()=>e(!1),children:r.jsxs("div",{className:"bg-gray-800 rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto",onClick:d=>d.stopPropagation(),children:[r.jsxs("div",{className:"p-6 border-b border-gray-700",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h2",{className:"text-xl font-bold text-white",children:"Send App to Your TV"}),r.jsx("button",{onClick:()=>e(!1),className:"text-gray-400 hover:text-white p-1",children:r.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),r.jsxs("p",{className:"text-gray-400 text-sm mt-1",children:["Follow these easy steps to install ",t.name]})]}),r.jsxs("div",{className:"p-6 flex flex-col items-center border-b border-gray-700",children:[r.jsx("div",{className:"bg-white p-4 rounded-xl",children:r.jsx(YE,{value:t.downloadUrl,size:180,level:"M"})}),r.jsx("p",{className:"text-gray-400 text-sm mt-3 text-center",children:"Scan with your phone to download the app"})]}),r.jsxs("div",{className:"p-6",children:[r.jsxs("h3",{className:"text-white font-semibold mb-4 flex items-center gap-2",children:[r.jsx(ju,{className:"h-5 w-5 text-indigo-400"}),"Easy 3-Step Setup"]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex gap-4",children:[r.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center text-white font-bold text-sm",children:"1"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"text-white font-medium",children:"Scan QR Code with your phone"}),r.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Use your phone's camera app to scan the QR code above. The APK will download to your phone."})]})]}),r.jsxs("div",{className:"flex gap-4",children:[r.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center text-white font-bold text-sm",children:"2"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"text-white font-medium",children:'Install "Send Files to TV" app'}),r.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Get this free app on both your phone AND your TV from their app stores."}),r.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[r.jsxs("a",{href:"https://play.google.com/store/apps/details?id=com.yablio.sendfilestotv",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xs bg-green-700 hover:bg-green-600 text-white px-3 py-1.5 rounded-lg transition-colors",children:[r.jsx(ju,{className:"h-3 w-3"}),"Android Phone"]}),r.jsxs("a",{href:"https://apps.apple.com/app/send-files-to-android-tv/id6723898949",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xs bg-gray-600 hover:bg-gray-500 text-white px-3 py-1.5 rounded-lg transition-colors",children:[r.jsx(xm,{className:"h-3 w-3"}),"iPhone"]}),r.jsxs("a",{href:"https://play.google.com/store/apps/details?id=com.yablio.sendfilestotv",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xs bg-indigo-700 hover:bg-indigo-600 text-white px-3 py-1.5 rounded-lg transition-colors",children:[r.jsx(Qs,{className:"h-3 w-3"}),"Android TV"]})]})]})]}),r.jsxs("div",{className:"flex gap-4",children:[r.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center text-white font-bold text-sm",children:"3"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"text-white font-medium",children:"Send the APK to your TV"}),r.jsx("p",{className:"text-gray-400 text-sm mt-1",children:'Open "Send Files to TV" on your phone, select the downloaded APK, and send it to your TV. Then install it on your TV!'})]})]})]}),r.jsx("div",{className:"mt-6 p-4 bg-green-500/10 border border-green-500/30 rounded-lg",children:r.jsxs("div",{className:"flex gap-3",children:[r.jsx(Ca,{className:"h-5 w-5 text-green-400 flex-shrink-0 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-green-400 font-medium text-sm",children:"After Installation"}),r.jsx("p",{className:"text-gray-300 text-sm mt-1",children:"Open OpenFlix on your TV and enter this server address:"}),r.jsx("code",{className:"block mt-2 text-indigo-400 bg-gray-900 px-3 py-2 rounded text-sm",children:u})]})]})})]}),r.jsxs("div",{className:"p-4 border-t border-gray-700 flex justify-between items-center",children:[r.jsxs("a",{href:t.downloadUrl,download:!0,className:"text-sm text-gray-400 hover:text-white flex items-center gap-1",children:[r.jsx(Ri,{className:"h-4 w-4"}),"Direct download instead"]}),r.jsx("button",{onClick:()=>e(!1),className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium rounded-lg transition-colors",children:"Done"})]})]})})]})}const xP=new sN({defaultOptions:{queries:{staleTime:3e4,retry:1}}});function vP({children:i}){return Le.isAuthenticated()?r.jsx(r.Fragment,{children:i}):r.jsx(eb,{to:"/ui/login",replace:!0})}function _P(){return r.jsx(iN,{client:xP,children:r.jsx(Tw,{children:r.jsxs(tw,{children:[r.jsx(Cs,{path:"/ui/login",element:r.jsx(SL,{})}),r.jsxs(Cs,{path:"/ui",element:r.jsx(vP,{children:r.jsx(bL,{})}),children:[r.jsx(Cs,{index:!0,element:r.jsx(KL,{})}),r.jsx(Cs,{path:"users",element:r.jsx(YL,{})}),r.jsx(Cs,{path:"libraries",element:r.jsx(sD,{})}),r.jsx(Cs,{path:"media",element:r.jsx(iD,{})}),r.jsx(Cs,{path:"livetv",element:r.jsx(rI,{})}),r.jsx(Cs,{path:"livetv/epg-editor",element:r.jsx(oI,{})}),r.jsx(Cs,{path:"tvguide",element:r.jsx(p4,{})}),r.jsx(Cs,{path:"onlater",element:r.jsx(S4,{})}),r.jsx(Cs,{path:"teampass",element:r.jsx(T4,{})}),r.jsx(Cs,{path:"dvr",element:r.jsx(B4,{})}),r.jsx(Cs,{path:"vod",element:r.jsx(V4,{})}),r.jsx(Cs,{path:"transcode",element:r.jsx(W4,{})}),r.jsx(Cs,{path:"logs",element:r.jsx(J4,{})}),r.jsx(Cs,{path:"settings",element:r.jsx(aP,{})}),r.jsx(Cs,{path:"downloads",element:r.jsx(yP,{})})]}),r.jsx(Cs,{path:"*",element:r.jsx(eb,{to:"/ui",replace:!0})})]})})})}rA.createRoot(document.getElementById("root")).render(r.jsx(K.StrictMode,{children:r.jsx(_P,{})}));
