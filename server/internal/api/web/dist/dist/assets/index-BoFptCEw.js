(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function s(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=s(i);fetch(i.href,l)}})();function m1(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var sg={exports:{}},wc={};var wv;function R2(){if(wv)return wc;wv=1;var a=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function s(n,i,l){var o=null;if(l!==void 0&&(o=""+l),i.key!==void 0&&(o=""+i.key),"key"in i){l={};for(var d in i)d!=="key"&&(l[d]=i[d])}else l=i;return i=l.ref,{$$typeof:a,type:n,key:o,ref:i!==void 0?i:null,props:l}}return wc.Fragment=e,wc.jsx=s,wc.jsxs=s,wc}var Sv;function L2(){return Sv||(Sv=1,sg.exports=R2()),sg.exports}var t=L2(),ag={exports:{}},Et={};var jv;function D2(){if(jv)return Et;jv=1;var a=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),o=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),p=Symbol.iterator;function b(q){return q===null||typeof q!="object"?null:(q=p&&q[p]||q["@@iterator"],typeof q=="function"?q:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,_={};function N(q,J,oe){this.props=q,this.context=J,this.refs=_,this.updater=oe||y}N.prototype.isReactComponent={},N.prototype.setState=function(q,J){if(typeof q!="object"&&typeof q!="function"&&q!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,q,J,"setState")},N.prototype.forceUpdate=function(q){this.updater.enqueueForceUpdate(this,q,"forceUpdate")};function C(){}C.prototype=N.prototype;function T(q,J,oe){this.props=q,this.context=J,this.refs=_,this.updater=oe||y}var L=T.prototype=new C;L.constructor=T,v(L,N.prototype),L.isPureReactComponent=!0;var F=Array.isArray;function H(){}var B={H:null,A:null,T:null,S:null},P=Object.prototype.hasOwnProperty;function I(q,J,oe){var be=oe.ref;return{$$typeof:a,type:q,key:J,ref:be!==void 0?be:null,props:oe}}function D(q,J){return I(q.type,J,q.props)}function O(q){return typeof q=="object"&&q!==null&&q.$$typeof===a}function ee(q){var J={"=":"=0",":":"=2"};return"$"+q.replace(/[=:]/g,function(oe){return J[oe]})}var ie=/\/+/g;function Z(q,J){return typeof q=="object"&&q!==null&&q.key!=null?ee(""+q.key):J.toString(36)}function z(q){switch(q.status){case"fulfilled":return q.value;case"rejected":throw q.reason;default:switch(typeof q.status=="string"?q.then(H,H):(q.status="pending",q.then(function(J){q.status==="pending"&&(q.status="fulfilled",q.value=J)},function(J){q.status==="pending"&&(q.status="rejected",q.reason=J)})),q.status){case"fulfilled":return q.value;case"rejected":throw q.reason}}throw q}function X(q,J,oe,be,ye){var Ee=typeof q;(Ee==="undefined"||Ee==="boolean")&&(q=null);var re=!1;if(q===null)re=!0;else switch(Ee){case"bigint":case"string":case"number":re=!0;break;case"object":switch(q.$$typeof){case a:case e:re=!0;break;case f:return re=q._init,X(re(q._payload),J,oe,be,ye)}}if(re)return ye=ye(q),re=be===""?"."+Z(q,0):be,F(ye)?(oe="",re!=null&&(oe=re.replace(ie,"$&/")+"/"),X(ye,J,oe,"",function(ze){return ze})):ye!=null&&(O(ye)&&(ye=D(ye,oe+(ye.key==null||q&&q.key===ye.key?"":(""+ye.key).replace(ie,"$&/")+"/")+re)),J.push(ye)),1;re=0;var fe=be===""?".":be+":";if(F(q))for(var Le=0;Le<q.length;Le++)be=q[Le],Ee=fe+Z(be,Le),re+=X(be,J,oe,Ee,ye);else if(Le=b(q),typeof Le=="function")for(q=Le.call(q),Le=0;!(be=q.next()).done;)be=be.value,Ee=fe+Z(be,Le++),re+=X(be,J,oe,Ee,ye);else if(Ee==="object"){if(typeof q.then=="function")return X(z(q),J,oe,be,ye);throw J=String(q),Error("Objects are not valid as a React child (found: "+(J==="[object Object]"?"object with keys {"+Object.keys(q).join(", ")+"}":J)+"). If you meant to render a collection of children, use an array instead.")}return re}function ae(q,J,oe){if(q==null)return q;var be=[],ye=0;return X(q,be,"","",function(Ee){return J.call(oe,Ee,ye++)}),be}function te(q){if(q._status===-1){var J=q._result;J=J(),J.then(function(oe){(q._status===0||q._status===-1)&&(q._status=1,q._result=oe)},function(oe){(q._status===0||q._status===-1)&&(q._status=2,q._result=oe)}),q._status===-1&&(q._status=0,q._result=J)}if(q._status===1)return q._result.default;throw q._result}var W=typeof reportError=="function"?reportError:function(q){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var J=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof q=="object"&&q!==null&&typeof q.message=="string"?String(q.message):String(q),error:q});if(!window.dispatchEvent(J))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",q);return}console.error(q)},K={map:ae,forEach:function(q,J,oe){ae(q,function(){J.apply(this,arguments)},oe)},count:function(q){var J=0;return ae(q,function(){J++}),J},toArray:function(q){return ae(q,function(J){return J})||[]},only:function(q){if(!O(q))throw Error("React.Children.only expected to receive a single React element child.");return q}};return Et.Activity=g,Et.Children=K,Et.Component=N,Et.Fragment=s,Et.Profiler=i,Et.PureComponent=T,Et.StrictMode=n,Et.Suspense=h,Et.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=B,Et.__COMPILER_RUNTIME={__proto__:null,c:function(q){return B.H.useMemoCache(q)}},Et.cache=function(q){return function(){return q.apply(null,arguments)}},Et.cacheSignal=function(){return null},Et.cloneElement=function(q,J,oe){if(q==null)throw Error("The argument must be a React element, but you passed "+q+".");var be=v({},q.props),ye=q.key;if(J!=null)for(Ee in J.key!==void 0&&(ye=""+J.key),J)!P.call(J,Ee)||Ee==="key"||Ee==="__self"||Ee==="__source"||Ee==="ref"&&J.ref===void 0||(be[Ee]=J[Ee]);var Ee=arguments.length-2;if(Ee===1)be.children=oe;else if(1<Ee){for(var re=Array(Ee),fe=0;fe<Ee;fe++)re[fe]=arguments[fe+2];be.children=re}return I(q.type,ye,be)},Et.createContext=function(q){return q={$$typeof:o,_currentValue:q,_currentValue2:q,_threadCount:0,Provider:null,Consumer:null},q.Provider=q,q.Consumer={$$typeof:l,_context:q},q},Et.createElement=function(q,J,oe){var be,ye={},Ee=null;if(J!=null)for(be in J.key!==void 0&&(Ee=""+J.key),J)P.call(J,be)&&be!=="key"&&be!=="__self"&&be!=="__source"&&(ye[be]=J[be]);var re=arguments.length-2;if(re===1)ye.children=oe;else if(1<re){for(var fe=Array(re),Le=0;Le<re;Le++)fe[Le]=arguments[Le+2];ye.children=fe}if(q&&q.defaultProps)for(be in re=q.defaultProps,re)ye[be]===void 0&&(ye[be]=re[be]);return I(q,Ee,ye)},Et.createRef=function(){return{current:null}},Et.forwardRef=function(q){return{$$typeof:d,render:q}},Et.isValidElement=O,Et.lazy=function(q){return{$$typeof:f,_payload:{_status:-1,_result:q},_init:te}},Et.memo=function(q,J){return{$$typeof:u,type:q,compare:J===void 0?null:J}},Et.startTransition=function(q){var J=B.T,oe={};B.T=oe;try{var be=q(),ye=B.S;ye!==null&&ye(oe,be),typeof be=="object"&&be!==null&&typeof be.then=="function"&&be.then(H,W)}catch(Ee){W(Ee)}finally{J!==null&&oe.types!==null&&(J.types=oe.types),B.T=J}},Et.unstable_useCacheRefresh=function(){return B.H.useCacheRefresh()},Et.use=function(q){return B.H.use(q)},Et.useActionState=function(q,J,oe){return B.H.useActionState(q,J,oe)},Et.useCallback=function(q,J){return B.H.useCallback(q,J)},Et.useContext=function(q){return B.H.useContext(q)},Et.useDebugValue=function(){},Et.useDeferredValue=function(q,J){return B.H.useDeferredValue(q,J)},Et.useEffect=function(q,J){return B.H.useEffect(q,J)},Et.useEffectEvent=function(q){return B.H.useEffectEvent(q)},Et.useId=function(){return B.H.useId()},Et.useImperativeHandle=function(q,J,oe){return B.H.useImperativeHandle(q,J,oe)},Et.useInsertionEffect=function(q,J){return B.H.useInsertionEffect(q,J)},Et.useLayoutEffect=function(q,J){return B.H.useLayoutEffect(q,J)},Et.useMemo=function(q,J){return B.H.useMemo(q,J)},Et.useOptimistic=function(q,J){return B.H.useOptimistic(q,J)},Et.useReducer=function(q,J,oe){return B.H.useReducer(q,J,oe)},Et.useRef=function(q){return B.H.useRef(q)},Et.useState=function(q){return B.H.useState(q)},Et.useSyncExternalStore=function(q,J,oe){return B.H.useSyncExternalStore(q,J,oe)},Et.useTransition=function(){return B.H.useTransition()},Et.version="19.2.3",Et}var Ev;function Q0(){return Ev||(Ev=1,ag.exports=D2()),ag.exports}var k=Q0();const Ys=m1(k);var ng={exports:{}},Sc={},ig={exports:{}},rg={};var Tv;function M2(){return Tv||(Tv=1,(function(a){function e(X,ae){var te=X.length;X.push(ae);e:for(;0<te;){var W=te-1>>>1,K=X[W];if(0<i(K,ae))X[W]=ae,X[te]=K,te=W;else break e}}function s(X){return X.length===0?null:X[0]}function n(X){if(X.length===0)return null;var ae=X[0],te=X.pop();if(te!==ae){X[0]=te;e:for(var W=0,K=X.length,q=K>>>1;W<q;){var J=2*(W+1)-1,oe=X[J],be=J+1,ye=X[be];if(0>i(oe,te))be<K&&0>i(ye,oe)?(X[W]=ye,X[be]=te,W=be):(X[W]=oe,X[J]=te,W=J);else if(be<K&&0>i(ye,te))X[W]=ye,X[be]=te,W=be;else break e}}return ae}function i(X,ae){var te=X.sortIndex-ae.sortIndex;return te!==0?te:X.id-ae.id}if(a.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;a.unstable_now=function(){return l.now()}}else{var o=Date,d=o.now();a.unstable_now=function(){return o.now()-d}}var h=[],u=[],f=1,g=null,p=3,b=!1,y=!1,v=!1,_=!1,N=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;function L(X){for(var ae=s(u);ae!==null;){if(ae.callback===null)n(u);else if(ae.startTime<=X)n(u),ae.sortIndex=ae.expirationTime,e(h,ae);else break;ae=s(u)}}function F(X){if(v=!1,L(X),!y)if(s(h)!==null)y=!0,H||(H=!0,ee());else{var ae=s(u);ae!==null&&z(F,ae.startTime-X)}}var H=!1,B=-1,P=5,I=-1;function D(){return _?!0:!(a.unstable_now()-I<P)}function O(){if(_=!1,H){var X=a.unstable_now();I=X;var ae=!0;try{e:{y=!1,v&&(v=!1,C(B),B=-1),b=!0;var te=p;try{t:{for(L(X),g=s(h);g!==null&&!(g.expirationTime>X&&D());){var W=g.callback;if(typeof W=="function"){g.callback=null,p=g.priorityLevel;var K=W(g.expirationTime<=X);if(X=a.unstable_now(),typeof K=="function"){g.callback=K,L(X),ae=!0;break t}g===s(h)&&n(h),L(X)}else n(h);g=s(h)}if(g!==null)ae=!0;else{var q=s(u);q!==null&&z(F,q.startTime-X),ae=!1}}break e}finally{g=null,p=te,b=!1}ae=void 0}}finally{ae?ee():H=!1}}}var ee;if(typeof T=="function")ee=function(){T(O)};else if(typeof MessageChannel<"u"){var ie=new MessageChannel,Z=ie.port2;ie.port1.onmessage=O,ee=function(){Z.postMessage(null)}}else ee=function(){N(O,0)};function z(X,ae){B=N(function(){X(a.unstable_now())},ae)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(X){X.callback=null},a.unstable_forceFrameRate=function(X){0>X||125<X?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<X?Math.floor(1e3/X):5},a.unstable_getCurrentPriorityLevel=function(){return p},a.unstable_next=function(X){switch(p){case 1:case 2:case 3:var ae=3;break;default:ae=p}var te=p;p=ae;try{return X()}finally{p=te}},a.unstable_requestPaint=function(){_=!0},a.unstable_runWithPriority=function(X,ae){switch(X){case 1:case 2:case 3:case 4:case 5:break;default:X=3}var te=p;p=X;try{return ae()}finally{p=te}},a.unstable_scheduleCallback=function(X,ae,te){var W=a.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?W+te:W):te=W,X){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=te+K,X={id:f++,callback:ae,priorityLevel:X,startTime:te,expirationTime:K,sortIndex:-1},te>W?(X.sortIndex=te,e(u,X),s(h)===null&&X===s(u)&&(v?(C(B),B=-1):v=!0,z(F,te-W))):(X.sortIndex=K,e(h,X),y||b||(y=!0,H||(H=!0,ee()))),X},a.unstable_shouldYield=D,a.unstable_wrapCallback=function(X){var ae=p;return function(){var te=p;p=ae;try{return X.apply(this,arguments)}finally{p=te}}}})(rg)),rg}var Av;function I2(){return Av||(Av=1,ig.exports=M2()),ig.exports}var lg={exports:{}},ma={};var Cv;function P2(){if(Cv)return ma;Cv=1;var a=Q0();function e(h){var u="https://react.dev/errors/"+h;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)u+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+h+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var n={d:{f:s,r:function(){throw Error(e(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},i=Symbol.for("react.portal");function l(h,u,f){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:h,containerInfo:u,implementation:f}}var o=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(h,u){if(h==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return ma.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,ma.createPortal=function(h,u){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(e(299));return l(h,u,null,f)},ma.flushSync=function(h){var u=o.T,f=n.p;try{if(o.T=null,n.p=2,h)return h()}finally{o.T=u,n.p=f,n.d.f()}},ma.preconnect=function(h,u){typeof h=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,n.d.C(h,u))},ma.prefetchDNS=function(h){typeof h=="string"&&n.d.D(h)},ma.preinit=function(h,u){if(typeof h=="string"&&u&&typeof u.as=="string"){var f=u.as,g=d(f,u.crossOrigin),p=typeof u.integrity=="string"?u.integrity:void 0,b=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;f==="style"?n.d.S(h,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:g,integrity:p,fetchPriority:b}):f==="script"&&n.d.X(h,{crossOrigin:g,integrity:p,fetchPriority:b,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},ma.preinitModule=function(h,u){if(typeof h=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var f=d(u.as,u.crossOrigin);n.d.M(h,{crossOrigin:f,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&n.d.M(h)},ma.preload=function(h,u){if(typeof h=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var f=u.as,g=d(f,u.crossOrigin);n.d.L(h,f,{crossOrigin:g,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},ma.preloadModule=function(h,u){if(typeof h=="string")if(u){var f=d(u.as,u.crossOrigin);n.d.m(h,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:f,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else n.d.m(h)},ma.requestFormReset=function(h){n.d.r(h)},ma.unstable_batchedUpdates=function(h,u){return h(u)},ma.useFormState=function(h,u,f){return o.H.useFormState(h,u,f)},ma.useFormStatus=function(){return o.H.useHostTransitionStatus()},ma.version="19.2.3",ma}var kv;function O2(){if(kv)return lg.exports;kv=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(e){console.error(e)}}return a(),lg.exports=P2(),lg.exports}var Rv;function F2(){if(Rv)return Sc;Rv=1;var a=I2(),e=Q0(),s=O2();function n(r){var c="https://react.dev/errors/"+r;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)c+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+r+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function l(r){var c=r,m=r;if(r.alternate)for(;c.return;)c=c.return;else{r=c;do c=r,(c.flags&4098)!==0&&(m=c.return),r=c.return;while(r)}return c.tag===3?m:null}function o(r){if(r.tag===13){var c=r.memoizedState;if(c===null&&(r=r.alternate,r!==null&&(c=r.memoizedState)),c!==null)return c.dehydrated}return null}function d(r){if(r.tag===31){var c=r.memoizedState;if(c===null&&(r=r.alternate,r!==null&&(c=r.memoizedState)),c!==null)return c.dehydrated}return null}function h(r){if(l(r)!==r)throw Error(n(188))}function u(r){var c=r.alternate;if(!c){if(c=l(r),c===null)throw Error(n(188));return c!==r?null:r}for(var m=r,x=c;;){var S=m.return;if(S===null)break;var E=S.alternate;if(E===null){if(x=S.return,x!==null){m=x;continue}break}if(S.child===E.child){for(E=S.child;E;){if(E===m)return h(S),r;if(E===x)return h(S),c;E=E.sibling}throw Error(n(188))}if(m.return!==x.return)m=S,x=E;else{for(var U=!1,Q=S.child;Q;){if(Q===m){U=!0,m=S,x=E;break}if(Q===x){U=!0,x=S,m=E;break}Q=Q.sibling}if(!U){for(Q=E.child;Q;){if(Q===m){U=!0,m=E,x=S;break}if(Q===x){U=!0,x=E,m=S;break}Q=Q.sibling}if(!U)throw Error(n(189))}}if(m.alternate!==x)throw Error(n(190))}if(m.tag!==3)throw Error(n(188));return m.stateNode.current===m?r:c}function f(r){var c=r.tag;if(c===5||c===26||c===27||c===6)return r;for(r=r.child;r!==null;){if(c=f(r),c!==null)return c;r=r.sibling}return null}var g=Object.assign,p=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),C=Symbol.for("react.consumer"),T=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),H=Symbol.for("react.suspense_list"),B=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),I=Symbol.for("react.activity"),D=Symbol.for("react.memo_cache_sentinel"),O=Symbol.iterator;function ee(r){return r===null||typeof r!="object"?null:(r=O&&r[O]||r["@@iterator"],typeof r=="function"?r:null)}var ie=Symbol.for("react.client.reference");function Z(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===ie?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case v:return"Fragment";case N:return"Profiler";case _:return"StrictMode";case F:return"Suspense";case H:return"SuspenseList";case I:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case y:return"Portal";case T:return r.displayName||"Context";case C:return(r._context.displayName||"Context")+".Consumer";case L:var c=r.render;return r=r.displayName,r||(r=c.displayName||c.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case B:return c=r.displayName||null,c!==null?c:Z(r.type)||"Memo";case P:c=r._payload,r=r._init;try{return Z(r(c))}catch{}}return null}var z=Array.isArray,X=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ae=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,te={pending:!1,data:null,method:null,action:null},W=[],K=-1;function q(r){return{current:r}}function J(r){0>K||(r.current=W[K],W[K]=null,K--)}function oe(r,c){K++,W[K]=r.current,r.current=c}var be=q(null),ye=q(null),Ee=q(null),re=q(null);function fe(r,c){switch(oe(Ee,c),oe(ye,r),oe(be,null),c.nodeType){case 9:case 11:r=(r=c.documentElement)&&(r=r.namespaceURI)?Hb(r):0;break;default:if(r=c.tagName,c=c.namespaceURI)c=Hb(c),r=zb(c,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}J(be),oe(be,r)}function Le(){J(be),J(ye),J(Ee)}function ze(r){r.memoizedState!==null&&oe(re,r);var c=be.current,m=zb(c,r.type);c!==m&&(oe(ye,r),oe(be,m))}function Xe(r){ye.current===r&&(J(be),J(ye)),re.current===r&&(J(re),bc._currentValue=te)}var ue,Ge;function Ve(r){if(ue===void 0)try{throw Error()}catch(m){var c=m.stack.trim().match(/\n( *(at )?)/);ue=c&&c[1]||"",Ge=-1<m.stack.indexOf(`
    at`)?" (<anonymous>)":-1<m.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ue+r+Ge}var bt=!1;function We(r,c){if(!r||bt)return"";bt=!0;var m=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var x={DetermineComponentFrameRoot:function(){try{if(c){var $e=function(){throw Error()};if(Object.defineProperty($e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct($e,[])}catch(Re){var Ae=Re}Reflect.construct(r,[],$e)}else{try{$e.call()}catch(Re){Ae=Re}r.call($e.prototype)}}else{try{throw Error()}catch(Re){Ae=Re}($e=r())&&typeof $e.catch=="function"&&$e.catch(function(){})}}catch(Re){if(Re&&Ae&&typeof Re.stack=="string")return[Re.stack,Ae.stack]}return[null,null]}};x.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var S=Object.getOwnPropertyDescriptor(x.DetermineComponentFrameRoot,"name");S&&S.configurable&&Object.defineProperty(x.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var E=x.DetermineComponentFrameRoot(),U=E[0],Q=E[1];if(U&&Q){var de=U.split(`
`),je=Q.split(`
`);for(S=x=0;x<de.length&&!de[x].includes("DetermineComponentFrameRoot");)x++;for(;S<je.length&&!je[S].includes("DetermineComponentFrameRoot");)S++;if(x===de.length||S===je.length)for(x=de.length-1,S=je.length-1;1<=x&&0<=S&&de[x]!==je[S];)S--;for(;1<=x&&0<=S;x--,S--)if(de[x]!==je[S]){if(x!==1||S!==1)do if(x--,S--,0>S||de[x]!==je[S]){var Oe=`
`+de[x].replace(" at new "," at ");return r.displayName&&Oe.includes("<anonymous>")&&(Oe=Oe.replace("<anonymous>",r.displayName)),Oe}while(1<=x&&0<=S);break}}}finally{bt=!1,Error.prepareStackTrace=m}return(m=r?r.displayName||r.name:"")?Ve(m):""}function ot(r,c){switch(r.tag){case 26:case 27:case 5:return Ve(r.type);case 16:return Ve("Lazy");case 13:return r.child!==c&&c!==null?Ve("Suspense Fallback"):Ve("Suspense");case 19:return Ve("SuspenseList");case 0:case 15:return We(r.type,!1);case 11:return We(r.type.render,!1);case 1:return We(r.type,!0);case 31:return Ve("Activity");default:return""}}function Ie(r){try{var c="",m=null;do c+=ot(r,m),m=r,r=r.return;while(r);return c}catch(x){return`
Error generating stack: `+x.message+`
`+x.stack}}var Lt=Object.prototype.hasOwnProperty,Ht=a.unstable_scheduleCallback,As=a.unstable_cancelCallback,Cs=a.unstable_shouldYield,Tn=a.unstable_requestPaint,ts=a.unstable_now,Bn=a.unstable_getCurrentPriorityLevel,ua=a.unstable_ImmediatePriority,rn=a.unstable_UserBlockingPriority,ya=a.unstable_NormalPriority,An=a.unstable_LowPriority,ln=a.unstable_IdlePriority,Sa=a.log,Un=a.unstable_setDisableYieldValue,on=null,Ps=null;function we(r){if(typeof Sa=="function"&&Un(r),Ps&&typeof Ps.setStrictMode=="function")try{Ps.setStrictMode(on,r)}catch{}}var gt=Math.clz32?Math.clz32:Mo,zt=Math.log,ja=Math.LN2;function Mo(r){return r>>>=0,r===0?32:31-(zt(r)/ja|0)|0}var Vi=256,xe=262144,He=4194304;function tt(r){var c=r&42;if(c!==0)return c;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Jt(r,c,m){var x=r.pendingLanes;if(x===0)return 0;var S=0,E=r.suspendedLanes,U=r.pingedLanes;r=r.warmLanes;var Q=x&134217727;return Q!==0?(x=Q&~E,x!==0?S=tt(x):(U&=Q,U!==0?S=tt(U):m||(m=Q&~r,m!==0&&(S=tt(m))))):(Q=x&~E,Q!==0?S=tt(Q):U!==0?S=tt(U):m||(m=x&~r,m!==0&&(S=tt(m)))),S===0?0:c!==0&&c!==S&&(c&E)===0&&(E=S&-S,m=c&-c,E>=m||E===32&&(m&4194048)!==0)?c:S}function ks(r,c){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&c)===0}function Ea(r,c){switch(r){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Cn(){var r=He;return He<<=1,(He&62914560)===0&&(He=4194304),r}function ha(r){for(var c=[],m=0;31>m;m++)c.push(r);return c}function ba(r,c){r.pendingLanes|=c,c!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function Ta(r,c,m,x,S,E){var U=r.pendingLanes;r.pendingLanes=m,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=m,r.entangledLanes&=m,r.errorRecoveryDisabledLanes&=m,r.shellSuspendCounter=0;var Q=r.entanglements,de=r.expirationTimes,je=r.hiddenUpdates;for(m=U&~m;0<m;){var Oe=31-gt(m),$e=1<<Oe;Q[Oe]=0,de[Oe]=-1;var Ae=je[Oe];if(Ae!==null)for(je[Oe]=null,Oe=0;Oe<Ae.length;Oe++){var Re=Ae[Oe];Re!==null&&(Re.lane&=-536870913)}m&=~$e}x!==0&&qi(r,x,0),E!==0&&S===0&&r.tag!==0&&(r.suspendedLanes|=E&~(U&~c))}function qi(r,c,m){r.pendingLanes|=c,r.suspendedLanes&=~c;var x=31-gt(c);r.entangledLanes|=c,r.entanglements[x]=r.entanglements[x]|1073741824|m&261930}function Aa(r,c){var m=r.entangledLanes|=c;for(r=r.entanglements;m;){var x=31-gt(m),S=1<<x;S&c|r[x]&c&&(r[x]|=c),m&=~S}}function kr(r,c){var m=c&-c;return m=(m&42)!==0?1:Rr(m),(m&(r.suspendedLanes|c))!==0?0:m}function Rr(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function ys(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function Lr(){var r=ae.p;return r!==0?r:(r=window.event,r===void 0?32:pv(r.type))}function R(r,c){var m=ae.p;try{return ae.p=r,c()}finally{ae.p=m}}var A=Math.random().toString(36).slice(2),j="__reactFiber$"+A,w="__reactProps$"+A,M="__reactContainer$"+A,G="__reactEvents$"+A,V="__reactListeners$"+A,Y="__reactHandles$"+A,ne="__reactResources$"+A,se="__reactMarker$"+A;function le(r){delete r[j],delete r[w],delete r[G],delete r[V],delete r[Y]}function he(r){var c=r[j];if(c)return c;for(var m=r.parentNode;m;){if(c=m[M]||m[j]){if(m=c.alternate,c.child!==null||m!==null&&m.child!==null)for(r=ev(r);r!==null;){if(m=r[j])return m;r=ev(r)}return c}r=m,m=r.parentNode}return null}function ce(r){if(r=r[j]||r[M]){var c=r.tag;if(c===5||c===6||c===13||c===31||c===26||c===27||c===3)return r}return null}function me(r){var c=r.tag;if(c===5||c===26||c===27||c===6)return r.stateNode;throw Error(n(33))}function Te(r){var c=r[ne];return c||(c=r[ne]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function Pe(r){r[se]=!0}var De=new Set,Je={};function Ye(r,c){qe(r,c),qe(r+"Capture",c)}function qe(r,c){for(Je[r]=c,r=0;r<c.length;r++)De.add(c[r])}var ht=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),wt={},Qe={};function lt(r){return Lt.call(Qe,r)?!0:Lt.call(wt,r)?!1:ht.test(r)?Qe[r]=!0:(wt[r]=!0,!1)}function vt(r,c,m){if(lt(c))if(m===null)r.removeAttribute(c);else{switch(typeof m){case"undefined":case"function":case"symbol":r.removeAttribute(c);return;case"boolean":var x=c.toLowerCase().slice(0,5);if(x!=="data-"&&x!=="aria-"){r.removeAttribute(c);return}}r.setAttribute(c,""+m)}}function dt(r,c,m){if(m===null)r.removeAttribute(c);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(c);return}r.setAttribute(c,""+m)}}function ct(r,c,m,x){if(x===null)r.removeAttribute(m);else{switch(typeof x){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(m);return}r.setAttributeNS(c,m,""+x)}}function _t(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Yt(r){var c=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function yt(r,c,m){var x=Object.getOwnPropertyDescriptor(r.constructor.prototype,c);if(!r.hasOwnProperty(c)&&typeof x<"u"&&typeof x.get=="function"&&typeof x.set=="function"){var S=x.get,E=x.set;return Object.defineProperty(r,c,{configurable:!0,get:function(){return S.call(this)},set:function(U){m=""+U,E.call(this,U)}}),Object.defineProperty(r,c,{enumerable:x.enumerable}),{getValue:function(){return m},setValue:function(U){m=""+U},stopTracking:function(){r._valueTracker=null,delete r[c]}}}}function Tt(r){if(!r._valueTracker){var c=Yt(r)?"checked":"value";r._valueTracker=yt(r,c,""+r[c])}}function Zt(r){if(!r)return!1;var c=r._valueTracker;if(!c)return!0;var m=c.getValue(),x="";return r&&(x=Yt(r)?r.checked?"true":"false":r.value),r=x,r!==m?(c.setValue(r),!0):!1}function bs(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var Ga=/[\n"\\]/g;function ss(r){return r.replace(Ga,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function aa(r,c,m,x,S,E,U,Q){r.name="",U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"?r.type=U:r.removeAttribute("type"),c!=null?U==="number"?(c===0&&r.value===""||r.value!=c)&&(r.value=""+_t(c)):r.value!==""+_t(c)&&(r.value=""+_t(c)):U!=="submit"&&U!=="reset"||r.removeAttribute("value"),c!=null?Vs(r,U,_t(c)):m!=null?Vs(r,U,_t(m)):x!=null&&r.removeAttribute("value"),S==null&&E!=null&&(r.defaultChecked=!!E),S!=null&&(r.checked=S&&typeof S!="function"&&typeof S!="symbol"),Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"?r.name=""+_t(Q):r.removeAttribute("name")}function Zs(r,c,m,x,S,E,U,Q){if(E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(r.type=E),c!=null||m!=null){if(!(E!=="submit"&&E!=="reset"||c!=null)){Tt(r);return}m=m!=null?""+_t(m):"",c=c!=null?""+_t(c):m,Q||c===r.value||(r.value=c),r.defaultValue=c}x=x??S,x=typeof x!="function"&&typeof x!="symbol"&&!!x,r.checked=Q?r.checked:!!x,r.defaultChecked=!!x,U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"&&(r.name=U),Tt(r)}function Vs(r,c,m){c==="number"&&bs(r.ownerDocument)===r||r.defaultValue===""+m||(r.defaultValue=""+m)}function Rs(r,c,m,x){if(r=r.options,c){c={};for(var S=0;S<m.length;S++)c["$"+m[S]]=!0;for(m=0;m<r.length;m++)S=c.hasOwnProperty("$"+r[m].value),r[m].selected!==S&&(r[m].selected=S),S&&x&&(r[m].defaultSelected=!0)}else{for(m=""+_t(m),c=null,S=0;S<r.length;S++){if(r[S].value===m){r[S].selected=!0,x&&(r[S].defaultSelected=!0);return}c!==null||r[S].disabled||(c=r[S])}c!==null&&(c.selected=!0)}}function Vt(r,c,m){if(c!=null&&(c=""+_t(c),c!==r.value&&(r.value=c),m==null)){r.defaultValue!==c&&(r.defaultValue=c);return}r.defaultValue=m!=null?""+_t(m):""}function cn(r,c,m,x){if(c==null){if(x!=null){if(m!=null)throw Error(n(92));if(z(x)){if(1<x.length)throw Error(n(93));x=x[0]}m=x}m==null&&(m=""),c=m}m=_t(c),r.defaultValue=m,x=r.textContent,x===m&&x!==""&&x!==null&&(r.value=x),Tt(r)}function fa(r,c){if(c){var m=r.firstChild;if(m&&m===r.lastChild&&m.nodeType===3){m.nodeValue=c;return}}r.textContent=c}var Nl=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Io(r,c,m){var x=c.indexOf("--")===0;m==null||typeof m=="boolean"||m===""?x?r.setProperty(c,""):c==="float"?r.cssFloat="":r[c]="":x?r.setProperty(c,m):typeof m!="number"||m===0||Nl.has(c)?c==="float"?r.cssFloat=m:r[c]=(""+m).trim():r[c]=m+"px"}function od(r,c,m){if(c!=null&&typeof c!="object")throw Error(n(62));if(r=r.style,m!=null){for(var x in m)!m.hasOwnProperty(x)||c!=null&&c.hasOwnProperty(x)||(x.indexOf("--")===0?r.setProperty(x,""):x==="float"?r.cssFloat="":r[x]="");for(var S in c)x=c[S],c.hasOwnProperty(S)&&m[S]!==x&&Io(r,S,x)}else for(var E in c)c.hasOwnProperty(E)&&Io(r,E,c[E])}function wl(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Dr=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Mr=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ir(r){return Mr.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Va(){}var Pr=null;function ri(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var $n=null,Gn=null;function Or(r){var c=ce(r);if(c&&(r=c.stateNode)){var m=r[w]||null;e:switch(r=c.stateNode,c.type){case"input":if(aa(r,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name),c=m.name,m.type==="radio"&&c!=null){for(m=r;m.parentNode;)m=m.parentNode;for(m=m.querySelectorAll('input[name="'+ss(""+c)+'"][type="radio"]'),c=0;c<m.length;c++){var x=m[c];if(x!==r&&x.form===r.form){var S=x[w]||null;if(!S)throw Error(n(90));aa(x,S.value,S.defaultValue,S.defaultValue,S.checked,S.defaultChecked,S.type,S.name)}}for(c=0;c<m.length;c++)x=m[c],x.form===r.form&&Zt(x)}break e;case"textarea":Vt(r,m.value,m.defaultValue);break e;case"select":c=m.value,c!=null&&Rs(r,!!m.multiple,c,!1)}}}var Sl=!1;function Po(r,c,m){if(Sl)return r(c,m);Sl=!0;try{var x=r(c);return x}finally{if(Sl=!1,($n!==null||Gn!==null)&&(Wd(),$n&&(c=$n,r=Gn,Gn=$n=null,Or(c),r)))for(c=0;c<r.length;c++)Or(r[c])}}function li(r,c){var m=r.stateNode;if(m===null)return null;var x=m[w]||null;if(x===null)return null;m=x[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(r=r.type,x=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!x;break e;default:r=!1}if(r)return null;if(m&&typeof m!="function")throw Error(n(231,c,typeof m));return m}var dn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Oo=!1;if(dn)try{var Ki={};Object.defineProperty(Ki,"passive",{get:function(){Oo=!0}}),window.addEventListener("test",Ki,Ki),window.removeEventListener("test",Ki,Ki)}catch{Oo=!1}var kn=null,jl=null,cd=null;function zp(){if(cd)return cd;var r,c=jl,m=c.length,x,S="value"in kn?kn.value:kn.textContent,E=S.length;for(r=0;r<m&&c[r]===S[r];r++);var U=m-r;for(x=1;x<=U&&c[m-x]===S[E-x];x++);return cd=S.slice(r,1<x?1-x:void 0)}function dd(r){var c=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&c===13&&(r=13)):r=c,r===10&&(r=13),32<=r||r===13?r:0}function ud(){return!0}function Yp(){return!1}function Ca(r){function c(m,x,S,E,U){this._reactName=m,this._targetInst=S,this.type=x,this.nativeEvent=E,this.target=U,this.currentTarget=null;for(var Q in r)r.hasOwnProperty(Q)&&(m=r[Q],this[Q]=m?m(E):E[Q]);return this.isDefaultPrevented=(E.defaultPrevented!=null?E.defaultPrevented:E.returnValue===!1)?ud:Yp,this.isPropagationStopped=Yp,this}return g(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var m=this.nativeEvent;m&&(m.preventDefault?m.preventDefault():typeof m.returnValue!="unknown"&&(m.returnValue=!1),this.isDefaultPrevented=ud)},stopPropagation:function(){var m=this.nativeEvent;m&&(m.stopPropagation?m.stopPropagation():typeof m.cancelBubble!="unknown"&&(m.cancelBubble=!0),this.isPropagationStopped=ud)},persist:function(){},isPersistent:ud}),c}var Fr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hd=Ca(Fr),Fo=g({},Fr,{view:0,detail:0}),Cj=Ca(Fo),af,nf,Bo,fd=g({},Fo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:lf,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Bo&&(Bo&&r.type==="mousemove"?(af=r.screenX-Bo.screenX,nf=r.screenY-Bo.screenY):nf=af=0,Bo=r),af)},movementY:function(r){return"movementY"in r?r.movementY:nf}}),Wp=Ca(fd),kj=g({},fd,{dataTransfer:0}),Rj=Ca(kj),Lj=g({},Fo,{relatedTarget:0}),rf=Ca(Lj),Dj=g({},Fr,{animationName:0,elapsedTime:0,pseudoElement:0}),Mj=Ca(Dj),Ij=g({},Fr,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Pj=Ca(Ij),Oj=g({},Fr,{data:0}),Qp=Ca(Oj),Fj={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Bj={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Uj={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $j(r){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(r):(r=Uj[r])?!!c[r]:!1}function lf(){return $j}var Gj=g({},Fo,{key:function(r){if(r.key){var c=Fj[r.key]||r.key;if(c!=="Unidentified")return c}return r.type==="keypress"?(r=dd(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?Bj[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:lf,charCode:function(r){return r.type==="keypress"?dd(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?dd(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Vj=Ca(Gj),qj=g({},fd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Xp=Ca(qj),Kj=g({},Fo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:lf}),Hj=Ca(Kj),zj=g({},Fr,{propertyName:0,elapsedTime:0,pseudoElement:0}),Yj=Ca(zj),Wj=g({},fd,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),Qj=Ca(Wj),Xj=g({},Fr,{newState:0,oldState:0}),Jj=Ca(Xj),Zj=[9,13,27,32],of=dn&&"CompositionEvent"in window,Uo=null;dn&&"documentMode"in document&&(Uo=document.documentMode);var eE=dn&&"TextEvent"in window&&!Uo,Jp=dn&&(!of||Uo&&8<Uo&&11>=Uo),Zp=" ",ex=!1;function tx(r,c){switch(r){case"keyup":return Zj.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function sx(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var El=!1;function tE(r,c){switch(r){case"compositionend":return sx(c);case"keypress":return c.which!==32?null:(ex=!0,Zp);case"textInput":return r=c.data,r===Zp&&ex?null:r;default:return null}}function sE(r,c){if(El)return r==="compositionend"||!of&&tx(r,c)?(r=zp(),cd=jl=kn=null,El=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return Jp&&c.locale!=="ko"?null:c.data;default:return null}}var aE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ax(r){var c=r&&r.nodeName&&r.nodeName.toLowerCase();return c==="input"?!!aE[r.type]:c==="textarea"}function nx(r,c,m,x){$n?Gn?Gn.push(x):Gn=[x]:$n=x,c=su(c,"onChange"),0<c.length&&(m=new hd("onChange","change",null,m,x),r.push({event:m,listeners:c}))}var $o=null,Go=null;function nE(r){Ub(r,0)}function md(r){var c=me(r);if(Zt(c))return r}function ix(r,c){if(r==="change")return c}var rx=!1;if(dn){var cf;if(dn){var df="oninput"in document;if(!df){var lx=document.createElement("div");lx.setAttribute("oninput","return;"),df=typeof lx.oninput=="function"}cf=df}else cf=!1;rx=cf&&(!document.documentMode||9<document.documentMode)}function ox(){$o&&($o.detachEvent("onpropertychange",cx),Go=$o=null)}function cx(r){if(r.propertyName==="value"&&md(Go)){var c=[];nx(c,Go,r,ri(r)),Po(nE,c)}}function iE(r,c,m){r==="focusin"?(ox(),$o=c,Go=m,$o.attachEvent("onpropertychange",cx)):r==="focusout"&&ox()}function rE(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return md(Go)}function lE(r,c){if(r==="click")return md(c)}function oE(r,c){if(r==="input"||r==="change")return md(c)}function cE(r,c){return r===c&&(r!==0||1/r===1/c)||r!==r&&c!==c}var qa=typeof Object.is=="function"?Object.is:cE;function Vo(r,c){if(qa(r,c))return!0;if(typeof r!="object"||r===null||typeof c!="object"||c===null)return!1;var m=Object.keys(r),x=Object.keys(c);if(m.length!==x.length)return!1;for(x=0;x<m.length;x++){var S=m[x];if(!Lt.call(c,S)||!qa(r[S],c[S]))return!1}return!0}function dx(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function ux(r,c){var m=dx(r);r=0;for(var x;m;){if(m.nodeType===3){if(x=r+m.textContent.length,r<=c&&x>=c)return{node:m,offset:c-r};r=x}e:{for(;m;){if(m.nextSibling){m=m.nextSibling;break e}m=m.parentNode}m=void 0}m=dx(m)}}function hx(r,c){return r&&c?r===c?!0:r&&r.nodeType===3?!1:c&&c.nodeType===3?hx(r,c.parentNode):"contains"in r?r.contains(c):r.compareDocumentPosition?!!(r.compareDocumentPosition(c)&16):!1:!1}function fx(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var c=bs(r.document);c instanceof r.HTMLIFrameElement;){try{var m=typeof c.contentWindow.location.href=="string"}catch{m=!1}if(m)r=c.contentWindow;else break;c=bs(r.document)}return c}function uf(r){var c=r&&r.nodeName&&r.nodeName.toLowerCase();return c&&(c==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||c==="textarea"||r.contentEditable==="true")}var dE=dn&&"documentMode"in document&&11>=document.documentMode,Tl=null,hf=null,qo=null,ff=!1;function mx(r,c,m){var x=m.window===m?m.document:m.nodeType===9?m:m.ownerDocument;ff||Tl==null||Tl!==bs(x)||(x=Tl,"selectionStart"in x&&uf(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),qo&&Vo(qo,x)||(qo=x,x=su(hf,"onSelect"),0<x.length&&(c=new hd("onSelect","select",null,c,m),r.push({event:c,listeners:x}),c.target=Tl)))}function Br(r,c){var m={};return m[r.toLowerCase()]=c.toLowerCase(),m["Webkit"+r]="webkit"+c,m["Moz"+r]="moz"+c,m}var Al={animationend:Br("Animation","AnimationEnd"),animationiteration:Br("Animation","AnimationIteration"),animationstart:Br("Animation","AnimationStart"),transitionrun:Br("Transition","TransitionRun"),transitionstart:Br("Transition","TransitionStart"),transitioncancel:Br("Transition","TransitionCancel"),transitionend:Br("Transition","TransitionEnd")},mf={},gx={};dn&&(gx=document.createElement("div").style,"AnimationEvent"in window||(delete Al.animationend.animation,delete Al.animationiteration.animation,delete Al.animationstart.animation),"TransitionEvent"in window||delete Al.transitionend.transition);function Ur(r){if(mf[r])return mf[r];if(!Al[r])return r;var c=Al[r],m;for(m in c)if(c.hasOwnProperty(m)&&m in gx)return mf[r]=c[m];return r}var px=Ur("animationend"),xx=Ur("animationiteration"),yx=Ur("animationstart"),uE=Ur("transitionrun"),hE=Ur("transitionstart"),fE=Ur("transitioncancel"),bx=Ur("transitionend"),vx=new Map,gf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");gf.push("scrollEnd");function Rn(r,c){vx.set(r,c),Ye(c,[r])}var gd=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},un=[],Cl=0,pf=0;function pd(){for(var r=Cl,c=pf=Cl=0;c<r;){var m=un[c];un[c++]=null;var x=un[c];un[c++]=null;var S=un[c];un[c++]=null;var E=un[c];if(un[c++]=null,x!==null&&S!==null){var U=x.pending;U===null?S.next=S:(S.next=U.next,U.next=S),x.pending=S}E!==0&&_x(m,S,E)}}function xd(r,c,m,x){un[Cl++]=r,un[Cl++]=c,un[Cl++]=m,un[Cl++]=x,pf|=x,r.lanes|=x,r=r.alternate,r!==null&&(r.lanes|=x)}function xf(r,c,m,x){return xd(r,c,m,x),yd(r)}function $r(r,c){return xd(r,null,null,c),yd(r)}function _x(r,c,m){r.lanes|=m;var x=r.alternate;x!==null&&(x.lanes|=m);for(var S=!1,E=r.return;E!==null;)E.childLanes|=m,x=E.alternate,x!==null&&(x.childLanes|=m),E.tag===22&&(r=E.stateNode,r===null||r._visibility&1||(S=!0)),r=E,E=E.return;return r.tag===3?(E=r.stateNode,S&&c!==null&&(S=31-gt(m),r=E.hiddenUpdates,x=r[S],x===null?r[S]=[c]:x.push(c),c.lane=m|536870912),E):null}function yd(r){if(50<hc)throw hc=0,Em=null,Error(n(185));for(var c=r.return;c!==null;)r=c,c=r.return;return r.tag===3?r.stateNode:null}var kl={};function mE(r,c,m,x){this.tag=r,this.key=m,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ka(r,c,m,x){return new mE(r,c,m,x)}function yf(r){return r=r.prototype,!(!r||!r.isReactComponent)}function oi(r,c){var m=r.alternate;return m===null?(m=Ka(r.tag,c,r.key,r.mode),m.elementType=r.elementType,m.type=r.type,m.stateNode=r.stateNode,m.alternate=r,r.alternate=m):(m.pendingProps=c,m.type=r.type,m.flags=0,m.subtreeFlags=0,m.deletions=null),m.flags=r.flags&65011712,m.childLanes=r.childLanes,m.lanes=r.lanes,m.child=r.child,m.memoizedProps=r.memoizedProps,m.memoizedState=r.memoizedState,m.updateQueue=r.updateQueue,c=r.dependencies,m.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},m.sibling=r.sibling,m.index=r.index,m.ref=r.ref,m.refCleanup=r.refCleanup,m}function Nx(r,c){r.flags&=65011714;var m=r.alternate;return m===null?(r.childLanes=0,r.lanes=c,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=m.childLanes,r.lanes=m.lanes,r.child=m.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=m.memoizedProps,r.memoizedState=m.memoizedState,r.updateQueue=m.updateQueue,r.type=m.type,c=m.dependencies,r.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),r}function bd(r,c,m,x,S,E){var U=0;if(x=r,typeof r=="function")yf(r)&&(U=1);else if(typeof r=="string")U=b2(r,m,be.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case I:return r=Ka(31,m,c,S),r.elementType=I,r.lanes=E,r;case v:return Gr(m.children,S,E,c);case _:U=8,S|=24;break;case N:return r=Ka(12,m,c,S|2),r.elementType=N,r.lanes=E,r;case F:return r=Ka(13,m,c,S),r.elementType=F,r.lanes=E,r;case H:return r=Ka(19,m,c,S),r.elementType=H,r.lanes=E,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case T:U=10;break e;case C:U=9;break e;case L:U=11;break e;case B:U=14;break e;case P:U=16,x=null;break e}U=29,m=Error(n(130,r===null?"null":typeof r,"")),x=null}return c=Ka(U,m,c,S),c.elementType=r,c.type=x,c.lanes=E,c}function Gr(r,c,m,x){return r=Ka(7,r,x,c),r.lanes=m,r}function bf(r,c,m){return r=Ka(6,r,null,c),r.lanes=m,r}function wx(r){var c=Ka(18,null,null,0);return c.stateNode=r,c}function vf(r,c,m){return c=Ka(4,r.children!==null?r.children:[],r.key,c),c.lanes=m,c.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},c}var Sx=new WeakMap;function hn(r,c){if(typeof r=="object"&&r!==null){var m=Sx.get(r);return m!==void 0?m:(c={value:r,source:c,stack:Ie(c)},Sx.set(r,c),c)}return{value:r,source:c,stack:Ie(c)}}var Rl=[],Ll=0,vd=null,Ko=0,fn=[],mn=0,Hi=null,Vn=1,qn="";function ci(r,c){Rl[Ll++]=Ko,Rl[Ll++]=vd,vd=r,Ko=c}function jx(r,c,m){fn[mn++]=Vn,fn[mn++]=qn,fn[mn++]=Hi,Hi=r;var x=Vn;r=qn;var S=32-gt(x)-1;x&=~(1<<S),m+=1;var E=32-gt(c)+S;if(30<E){var U=S-S%5;E=(x&(1<<U)-1).toString(32),x>>=U,S-=U,Vn=1<<32-gt(c)+S|m<<S|x,qn=E+r}else Vn=1<<E|m<<S|x,qn=r}function _f(r){r.return!==null&&(ci(r,1),jx(r,1,0))}function Nf(r){for(;r===vd;)vd=Rl[--Ll],Rl[Ll]=null,Ko=Rl[--Ll],Rl[Ll]=null;for(;r===Hi;)Hi=fn[--mn],fn[mn]=null,qn=fn[--mn],fn[mn]=null,Vn=fn[--mn],fn[mn]=null}function Ex(r,c){fn[mn++]=Vn,fn[mn++]=qn,fn[mn++]=Hi,Vn=c.id,qn=c.overflow,Hi=r}var na=null,vs=null,qt=!1,zi=null,gn=!1,wf=Error(n(519));function Yi(r){var c=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Ho(hn(c,r)),wf}function Tx(r){var c=r.stateNode,m=r.type,x=r.memoizedProps;switch(c[j]=r,c[w]=x,m){case"dialog":Ft("cancel",c),Ft("close",c);break;case"iframe":case"object":case"embed":Ft("load",c);break;case"video":case"audio":for(m=0;m<mc.length;m++)Ft(mc[m],c);break;case"source":Ft("error",c);break;case"img":case"image":case"link":Ft("error",c),Ft("load",c);break;case"details":Ft("toggle",c);break;case"input":Ft("invalid",c),Zs(c,x.value,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name,!0);break;case"select":Ft("invalid",c);break;case"textarea":Ft("invalid",c),cn(c,x.value,x.defaultValue,x.children)}m=x.children,typeof m!="string"&&typeof m!="number"&&typeof m!="bigint"||c.textContent===""+m||x.suppressHydrationWarning===!0||qb(c.textContent,m)?(x.popover!=null&&(Ft("beforetoggle",c),Ft("toggle",c)),x.onScroll!=null&&Ft("scroll",c),x.onScrollEnd!=null&&Ft("scrollend",c),x.onClick!=null&&(c.onclick=Va),c=!0):c=!1,c||Yi(r,!0)}function Ax(r){for(na=r.return;na;)switch(na.tag){case 5:case 31:case 13:gn=!1;return;case 27:case 3:gn=!0;return;default:na=na.return}}function Dl(r){if(r!==na)return!1;if(!qt)return Ax(r),qt=!0,!1;var c=r.tag,m;if((m=c!==3&&c!==27)&&((m=c===5)&&(m=r.type,m=!(m!=="form"&&m!=="button")||$m(r.type,r.memoizedProps)),m=!m),m&&vs&&Yi(r),Ax(r),c===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(n(317));vs=Zb(r)}else if(c===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(n(317));vs=Zb(r)}else c===27?(c=vs,or(r.type)?(r=Hm,Hm=null,vs=r):vs=c):vs=na?xn(r.stateNode.nextSibling):null;return!0}function Vr(){vs=na=null,qt=!1}function Sf(){var r=zi;return r!==null&&(Da===null?Da=r:Da.push.apply(Da,r),zi=null),r}function Ho(r){zi===null?zi=[r]:zi.push(r)}var jf=q(null),qr=null,di=null;function Wi(r,c,m){oe(jf,c._currentValue),c._currentValue=m}function ui(r){r._currentValue=jf.current,J(jf)}function Ef(r,c,m){for(;r!==null;){var x=r.alternate;if((r.childLanes&c)!==c?(r.childLanes|=c,x!==null&&(x.childLanes|=c)):x!==null&&(x.childLanes&c)!==c&&(x.childLanes|=c),r===m)break;r=r.return}}function Tf(r,c,m,x){var S=r.child;for(S!==null&&(S.return=r);S!==null;){var E=S.dependencies;if(E!==null){var U=S.child;E=E.firstContext;e:for(;E!==null;){var Q=E;E=S;for(var de=0;de<c.length;de++)if(Q.context===c[de]){E.lanes|=m,Q=E.alternate,Q!==null&&(Q.lanes|=m),Ef(E.return,m,r),x||(U=null);break e}E=Q.next}}else if(S.tag===18){if(U=S.return,U===null)throw Error(n(341));U.lanes|=m,E=U.alternate,E!==null&&(E.lanes|=m),Ef(U,m,r),U=null}else U=S.child;if(U!==null)U.return=S;else for(U=S;U!==null;){if(U===r){U=null;break}if(S=U.sibling,S!==null){S.return=U.return,U=S;break}U=U.return}S=U}}function Ml(r,c,m,x){r=null;for(var S=c,E=!1;S!==null;){if(!E){if((S.flags&524288)!==0)E=!0;else if((S.flags&262144)!==0)break}if(S.tag===10){var U=S.alternate;if(U===null)throw Error(n(387));if(U=U.memoizedProps,U!==null){var Q=S.type;qa(S.pendingProps.value,U.value)||(r!==null?r.push(Q):r=[Q])}}else if(S===re.current){if(U=S.alternate,U===null)throw Error(n(387));U.memoizedState.memoizedState!==S.memoizedState.memoizedState&&(r!==null?r.push(bc):r=[bc])}S=S.return}r!==null&&Tf(c,r,m,x),c.flags|=262144}function _d(r){for(r=r.firstContext;r!==null;){if(!qa(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Kr(r){qr=r,di=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function ia(r){return Cx(qr,r)}function Nd(r,c){return qr===null&&Kr(r),Cx(r,c)}function Cx(r,c){var m=c._currentValue;if(c={context:c,memoizedValue:m,next:null},di===null){if(r===null)throw Error(n(308));di=c,r.dependencies={lanes:0,firstContext:c},r.flags|=524288}else di=di.next=c;return m}var gE=typeof AbortController<"u"?AbortController:function(){var r=[],c=this.signal={aborted:!1,addEventListener:function(m,x){r.push(x)}};this.abort=function(){c.aborted=!0,r.forEach(function(m){return m()})}},pE=a.unstable_scheduleCallback,xE=a.unstable_NormalPriority,qs={$$typeof:T,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Af(){return{controller:new gE,data:new Map,refCount:0}}function zo(r){r.refCount--,r.refCount===0&&pE(xE,function(){r.controller.abort()})}var Yo=null,Cf=0,Il=0,Pl=null;function yE(r,c){if(Yo===null){var m=Yo=[];Cf=0,Il=Lm(),Pl={status:"pending",value:void 0,then:function(x){m.push(x)}}}return Cf++,c.then(kx,kx),c}function kx(){if(--Cf===0&&Yo!==null){Pl!==null&&(Pl.status="fulfilled");var r=Yo;Yo=null,Il=0,Pl=null;for(var c=0;c<r.length;c++)(0,r[c])()}}function bE(r,c){var m=[],x={status:"pending",value:null,reason:null,then:function(S){m.push(S)}};return r.then(function(){x.status="fulfilled",x.value=c;for(var S=0;S<m.length;S++)(0,m[S])(c)},function(S){for(x.status="rejected",x.reason=S,S=0;S<m.length;S++)(0,m[S])(void 0)}),x}var Rx=X.S;X.S=function(r,c){mb=ts(),typeof c=="object"&&c!==null&&typeof c.then=="function"&&yE(r,c),Rx!==null&&Rx(r,c)};var Hr=q(null);function kf(){var r=Hr.current;return r!==null?r:us.pooledCache}function wd(r,c){c===null?oe(Hr,Hr.current):oe(Hr,c.pool)}function Lx(){var r=kf();return r===null?null:{parent:qs._currentValue,pool:r}}var Ol=Error(n(460)),Rf=Error(n(474)),Sd=Error(n(542)),jd={then:function(){}};function Dx(r){return r=r.status,r==="fulfilled"||r==="rejected"}function Mx(r,c,m){switch(m=r[m],m===void 0?r.push(c):m!==c&&(c.then(Va,Va),c=m),c.status){case"fulfilled":return c.value;case"rejected":throw r=c.reason,Px(r),r;default:if(typeof c.status=="string")c.then(Va,Va);else{if(r=us,r!==null&&100<r.shellSuspendCounter)throw Error(n(482));r=c,r.status="pending",r.then(function(x){if(c.status==="pending"){var S=c;S.status="fulfilled",S.value=x}},function(x){if(c.status==="pending"){var S=c;S.status="rejected",S.reason=x}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw r=c.reason,Px(r),r}throw Yr=c,Ol}}function zr(r){try{var c=r._init;return c(r._payload)}catch(m){throw m!==null&&typeof m=="object"&&typeof m.then=="function"?(Yr=m,Ol):m}}var Yr=null;function Ix(){if(Yr===null)throw Error(n(459));var r=Yr;return Yr=null,r}function Px(r){if(r===Ol||r===Sd)throw Error(n(483))}var Fl=null,Wo=0;function Ed(r){var c=Wo;return Wo+=1,Fl===null&&(Fl=[]),Mx(Fl,r,c)}function Qo(r,c){c=c.props.ref,r.ref=c!==void 0?c:null}function Td(r,c){throw c.$$typeof===p?Error(n(525)):(r=Object.prototype.toString.call(c),Error(n(31,r==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":r)))}function Ox(r){function c(ve,ge){if(r){var Se=ve.deletions;Se===null?(ve.deletions=[ge],ve.flags|=16):Se.push(ge)}}function m(ve,ge){if(!r)return null;for(;ge!==null;)c(ve,ge),ge=ge.sibling;return null}function x(ve){for(var ge=new Map;ve!==null;)ve.key!==null?ge.set(ve.key,ve):ge.set(ve.index,ve),ve=ve.sibling;return ge}function S(ve,ge){return ve=oi(ve,ge),ve.index=0,ve.sibling=null,ve}function E(ve,ge,Se){return ve.index=Se,r?(Se=ve.alternate,Se!==null?(Se=Se.index,Se<ge?(ve.flags|=67108866,ge):Se):(ve.flags|=67108866,ge)):(ve.flags|=1048576,ge)}function U(ve){return r&&ve.alternate===null&&(ve.flags|=67108866),ve}function Q(ve,ge,Se,Ue){return ge===null||ge.tag!==6?(ge=bf(Se,ve.mode,Ue),ge.return=ve,ge):(ge=S(ge,Se),ge.return=ve,ge)}function de(ve,ge,Se,Ue){var ft=Se.type;return ft===v?Oe(ve,ge,Se.props.children,Ue,Se.key):ge!==null&&(ge.elementType===ft||typeof ft=="object"&&ft!==null&&ft.$$typeof===P&&zr(ft)===ge.type)?(ge=S(ge,Se.props),Qo(ge,Se),ge.return=ve,ge):(ge=bd(Se.type,Se.key,Se.props,null,ve.mode,Ue),Qo(ge,Se),ge.return=ve,ge)}function je(ve,ge,Se,Ue){return ge===null||ge.tag!==4||ge.stateNode.containerInfo!==Se.containerInfo||ge.stateNode.implementation!==Se.implementation?(ge=vf(Se,ve.mode,Ue),ge.return=ve,ge):(ge=S(ge,Se.children||[]),ge.return=ve,ge)}function Oe(ve,ge,Se,Ue,ft){return ge===null||ge.tag!==7?(ge=Gr(Se,ve.mode,Ue,ft),ge.return=ve,ge):(ge=S(ge,Se),ge.return=ve,ge)}function $e(ve,ge,Se){if(typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint")return ge=bf(""+ge,ve.mode,Se),ge.return=ve,ge;if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case b:return Se=bd(ge.type,ge.key,ge.props,null,ve.mode,Se),Qo(Se,ge),Se.return=ve,Se;case y:return ge=vf(ge,ve.mode,Se),ge.return=ve,ge;case P:return ge=zr(ge),$e(ve,ge,Se)}if(z(ge)||ee(ge))return ge=Gr(ge,ve.mode,Se,null),ge.return=ve,ge;if(typeof ge.then=="function")return $e(ve,Ed(ge),Se);if(ge.$$typeof===T)return $e(ve,Nd(ve,ge),Se);Td(ve,ge)}return null}function Ae(ve,ge,Se,Ue){var ft=ge!==null?ge.key:null;if(typeof Se=="string"&&Se!==""||typeof Se=="number"||typeof Se=="bigint")return ft!==null?null:Q(ve,ge,""+Se,Ue);if(typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case b:return Se.key===ft?de(ve,ge,Se,Ue):null;case y:return Se.key===ft?je(ve,ge,Se,Ue):null;case P:return Se=zr(Se),Ae(ve,ge,Se,Ue)}if(z(Se)||ee(Se))return ft!==null?null:Oe(ve,ge,Se,Ue,null);if(typeof Se.then=="function")return Ae(ve,ge,Ed(Se),Ue);if(Se.$$typeof===T)return Ae(ve,ge,Nd(ve,Se),Ue);Td(ve,Se)}return null}function Re(ve,ge,Se,Ue,ft){if(typeof Ue=="string"&&Ue!==""||typeof Ue=="number"||typeof Ue=="bigint")return ve=ve.get(Se)||null,Q(ge,ve,""+Ue,ft);if(typeof Ue=="object"&&Ue!==null){switch(Ue.$$typeof){case b:return ve=ve.get(Ue.key===null?Se:Ue.key)||null,de(ge,ve,Ue,ft);case y:return ve=ve.get(Ue.key===null?Se:Ue.key)||null,je(ge,ve,Ue,ft);case P:return Ue=zr(Ue),Re(ve,ge,Se,Ue,ft)}if(z(Ue)||ee(Ue))return ve=ve.get(Se)||null,Oe(ge,ve,Ue,ft,null);if(typeof Ue.then=="function")return Re(ve,ge,Se,Ed(Ue),ft);if(Ue.$$typeof===T)return Re(ve,ge,Se,Nd(ge,Ue),ft);Td(ge,Ue)}return null}function st(ve,ge,Se,Ue){for(var ft=null,Wt=null,it=ge,Rt=ge=0,$t=null;it!==null&&Rt<Se.length;Rt++){it.index>Rt?($t=it,it=null):$t=it.sibling;var Qt=Ae(ve,it,Se[Rt],Ue);if(Qt===null){it===null&&(it=$t);break}r&&it&&Qt.alternate===null&&c(ve,it),ge=E(Qt,ge,Rt),Wt===null?ft=Qt:Wt.sibling=Qt,Wt=Qt,it=$t}if(Rt===Se.length)return m(ve,it),qt&&ci(ve,Rt),ft;if(it===null){for(;Rt<Se.length;Rt++)it=$e(ve,Se[Rt],Ue),it!==null&&(ge=E(it,ge,Rt),Wt===null?ft=it:Wt.sibling=it,Wt=it);return qt&&ci(ve,Rt),ft}for(it=x(it);Rt<Se.length;Rt++)$t=Re(it,ve,Rt,Se[Rt],Ue),$t!==null&&(r&&$t.alternate!==null&&it.delete($t.key===null?Rt:$t.key),ge=E($t,ge,Rt),Wt===null?ft=$t:Wt.sibling=$t,Wt=$t);return r&&it.forEach(function(fr){return c(ve,fr)}),qt&&ci(ve,Rt),ft}function pt(ve,ge,Se,Ue){if(Se==null)throw Error(n(151));for(var ft=null,Wt=null,it=ge,Rt=ge=0,$t=null,Qt=Se.next();it!==null&&!Qt.done;Rt++,Qt=Se.next()){it.index>Rt?($t=it,it=null):$t=it.sibling;var fr=Ae(ve,it,Qt.value,Ue);if(fr===null){it===null&&(it=$t);break}r&&it&&fr.alternate===null&&c(ve,it),ge=E(fr,ge,Rt),Wt===null?ft=fr:Wt.sibling=fr,Wt=fr,it=$t}if(Qt.done)return m(ve,it),qt&&ci(ve,Rt),ft;if(it===null){for(;!Qt.done;Rt++,Qt=Se.next())Qt=$e(ve,Qt.value,Ue),Qt!==null&&(ge=E(Qt,ge,Rt),Wt===null?ft=Qt:Wt.sibling=Qt,Wt=Qt);return qt&&ci(ve,Rt),ft}for(it=x(it);!Qt.done;Rt++,Qt=Se.next())Qt=Re(it,ve,Rt,Qt.value,Ue),Qt!==null&&(r&&Qt.alternate!==null&&it.delete(Qt.key===null?Rt:Qt.key),ge=E(Qt,ge,Rt),Wt===null?ft=Qt:Wt.sibling=Qt,Wt=Qt);return r&&it.forEach(function(k2){return c(ve,k2)}),qt&&ci(ve,Rt),ft}function cs(ve,ge,Se,Ue){if(typeof Se=="object"&&Se!==null&&Se.type===v&&Se.key===null&&(Se=Se.props.children),typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case b:e:{for(var ft=Se.key;ge!==null;){if(ge.key===ft){if(ft=Se.type,ft===v){if(ge.tag===7){m(ve,ge.sibling),Ue=S(ge,Se.props.children),Ue.return=ve,ve=Ue;break e}}else if(ge.elementType===ft||typeof ft=="object"&&ft!==null&&ft.$$typeof===P&&zr(ft)===ge.type){m(ve,ge.sibling),Ue=S(ge,Se.props),Qo(Ue,Se),Ue.return=ve,ve=Ue;break e}m(ve,ge);break}else c(ve,ge);ge=ge.sibling}Se.type===v?(Ue=Gr(Se.props.children,ve.mode,Ue,Se.key),Ue.return=ve,ve=Ue):(Ue=bd(Se.type,Se.key,Se.props,null,ve.mode,Ue),Qo(Ue,Se),Ue.return=ve,ve=Ue)}return U(ve);case y:e:{for(ft=Se.key;ge!==null;){if(ge.key===ft)if(ge.tag===4&&ge.stateNode.containerInfo===Se.containerInfo&&ge.stateNode.implementation===Se.implementation){m(ve,ge.sibling),Ue=S(ge,Se.children||[]),Ue.return=ve,ve=Ue;break e}else{m(ve,ge);break}else c(ve,ge);ge=ge.sibling}Ue=vf(Se,ve.mode,Ue),Ue.return=ve,ve=Ue}return U(ve);case P:return Se=zr(Se),cs(ve,ge,Se,Ue)}if(z(Se))return st(ve,ge,Se,Ue);if(ee(Se)){if(ft=ee(Se),typeof ft!="function")throw Error(n(150));return Se=ft.call(Se),pt(ve,ge,Se,Ue)}if(typeof Se.then=="function")return cs(ve,ge,Ed(Se),Ue);if(Se.$$typeof===T)return cs(ve,ge,Nd(ve,Se),Ue);Td(ve,Se)}return typeof Se=="string"&&Se!==""||typeof Se=="number"||typeof Se=="bigint"?(Se=""+Se,ge!==null&&ge.tag===6?(m(ve,ge.sibling),Ue=S(ge,Se),Ue.return=ve,ve=Ue):(m(ve,ge),Ue=bf(Se,ve.mode,Ue),Ue.return=ve,ve=Ue),U(ve)):m(ve,ge)}return function(ve,ge,Se,Ue){try{Wo=0;var ft=cs(ve,ge,Se,Ue);return Fl=null,ft}catch(it){if(it===Ol||it===Sd)throw it;var Wt=Ka(29,it,null,ve.mode);return Wt.lanes=Ue,Wt.return=ve,Wt}finally{}}}var Wr=Ox(!0),Fx=Ox(!1),Qi=!1;function Lf(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Df(r,c){r=r.updateQueue,c.updateQueue===r&&(c.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Xi(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Ji(r,c,m){var x=r.updateQueue;if(x===null)return null;if(x=x.shared,(es&2)!==0){var S=x.pending;return S===null?c.next=c:(c.next=S.next,S.next=c),x.pending=c,c=yd(r),_x(r,null,m),c}return xd(r,x,c,m),yd(r)}function Xo(r,c,m){if(c=c.updateQueue,c!==null&&(c=c.shared,(m&4194048)!==0)){var x=c.lanes;x&=r.pendingLanes,m|=x,c.lanes=m,Aa(r,m)}}function Mf(r,c){var m=r.updateQueue,x=r.alternate;if(x!==null&&(x=x.updateQueue,m===x)){var S=null,E=null;if(m=m.firstBaseUpdate,m!==null){do{var U={lane:m.lane,tag:m.tag,payload:m.payload,callback:null,next:null};E===null?S=E=U:E=E.next=U,m=m.next}while(m!==null);E===null?S=E=c:E=E.next=c}else S=E=c;m={baseState:x.baseState,firstBaseUpdate:S,lastBaseUpdate:E,shared:x.shared,callbacks:x.callbacks},r.updateQueue=m;return}r=m.lastBaseUpdate,r===null?m.firstBaseUpdate=c:r.next=c,m.lastBaseUpdate=c}var If=!1;function Jo(){if(If){var r=Pl;if(r!==null)throw r}}function Zo(r,c,m,x){If=!1;var S=r.updateQueue;Qi=!1;var E=S.firstBaseUpdate,U=S.lastBaseUpdate,Q=S.shared.pending;if(Q!==null){S.shared.pending=null;var de=Q,je=de.next;de.next=null,U===null?E=je:U.next=je,U=de;var Oe=r.alternate;Oe!==null&&(Oe=Oe.updateQueue,Q=Oe.lastBaseUpdate,Q!==U&&(Q===null?Oe.firstBaseUpdate=je:Q.next=je,Oe.lastBaseUpdate=de))}if(E!==null){var $e=S.baseState;U=0,Oe=je=de=null,Q=E;do{var Ae=Q.lane&-536870913,Re=Ae!==Q.lane;if(Re?(Ut&Ae)===Ae:(x&Ae)===Ae){Ae!==0&&Ae===Il&&(If=!0),Oe!==null&&(Oe=Oe.next={lane:0,tag:Q.tag,payload:Q.payload,callback:null,next:null});e:{var st=r,pt=Q;Ae=c;var cs=m;switch(pt.tag){case 1:if(st=pt.payload,typeof st=="function"){$e=st.call(cs,$e,Ae);break e}$e=st;break e;case 3:st.flags=st.flags&-65537|128;case 0:if(st=pt.payload,Ae=typeof st=="function"?st.call(cs,$e,Ae):st,Ae==null)break e;$e=g({},$e,Ae);break e;case 2:Qi=!0}}Ae=Q.callback,Ae!==null&&(r.flags|=64,Re&&(r.flags|=8192),Re=S.callbacks,Re===null?S.callbacks=[Ae]:Re.push(Ae))}else Re={lane:Ae,tag:Q.tag,payload:Q.payload,callback:Q.callback,next:null},Oe===null?(je=Oe=Re,de=$e):Oe=Oe.next=Re,U|=Ae;if(Q=Q.next,Q===null){if(Q=S.shared.pending,Q===null)break;Re=Q,Q=Re.next,Re.next=null,S.lastBaseUpdate=Re,S.shared.pending=null}}while(!0);Oe===null&&(de=$e),S.baseState=de,S.firstBaseUpdate=je,S.lastBaseUpdate=Oe,E===null&&(S.shared.lanes=0),ar|=U,r.lanes=U,r.memoizedState=$e}}function Bx(r,c){if(typeof r!="function")throw Error(n(191,r));r.call(c)}function Ux(r,c){var m=r.callbacks;if(m!==null)for(r.callbacks=null,r=0;r<m.length;r++)Bx(m[r],c)}var Bl=q(null),Ad=q(0);function $x(r,c){r=vi,oe(Ad,r),oe(Bl,c),vi=r|c.baseLanes}function Pf(){oe(Ad,vi),oe(Bl,Bl.current)}function Of(){vi=Ad.current,J(Bl),J(Ad)}var Ha=q(null),pn=null;function Zi(r){var c=r.alternate;oe(Os,Os.current&1),oe(Ha,r),pn===null&&(c===null||Bl.current!==null||c.memoizedState!==null)&&(pn=r)}function Ff(r){oe(Os,Os.current),oe(Ha,r),pn===null&&(pn=r)}function Gx(r){r.tag===22?(oe(Os,Os.current),oe(Ha,r),pn===null&&(pn=r)):er()}function er(){oe(Os,Os.current),oe(Ha,Ha.current)}function za(r){J(Ha),pn===r&&(pn=null),J(Os)}var Os=q(0);function Cd(r){for(var c=r;c!==null;){if(c.tag===13){var m=c.memoizedState;if(m!==null&&(m=m.dehydrated,m===null||qm(m)||Km(m)))return c}else if(c.tag===19&&(c.memoizedProps.revealOrder==="forwards"||c.memoizedProps.revealOrder==="backwards"||c.memoizedProps.revealOrder==="unstable_legacy-backwards"||c.memoizedProps.revealOrder==="together")){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===r)break;for(;c.sibling===null;){if(c.return===null||c.return===r)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}var hi=0,At=null,ls=null,Ks=null,kd=!1,Ul=!1,Qr=!1,Rd=0,ec=0,$l=null,vE=0;function Ls(){throw Error(n(321))}function Bf(r,c){if(c===null)return!1;for(var m=0;m<c.length&&m<r.length;m++)if(!qa(r[m],c[m]))return!1;return!0}function Uf(r,c,m,x,S,E){return hi=E,At=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,X.H=r===null||r.memoizedState===null?jy:tm,Qr=!1,E=m(x,S),Qr=!1,Ul&&(E=qx(c,m,x,S)),Vx(r),E}function Vx(r){X.H=ac;var c=ls!==null&&ls.next!==null;if(hi=0,Ks=ls=At=null,kd=!1,ec=0,$l=null,c)throw Error(n(300));r===null||Hs||(r=r.dependencies,r!==null&&_d(r)&&(Hs=!0))}function qx(r,c,m,x){At=r;var S=0;do{if(Ul&&($l=null),ec=0,Ul=!1,25<=S)throw Error(n(301));if(S+=1,Ks=ls=null,r.updateQueue!=null){var E=r.updateQueue;E.lastEffect=null,E.events=null,E.stores=null,E.memoCache!=null&&(E.memoCache.index=0)}X.H=Ey,E=c(m,x)}while(Ul);return E}function _E(){var r=X.H,c=r.useState()[0];return c=typeof c.then=="function"?tc(c):c,r=r.useState()[0],(ls!==null?ls.memoizedState:null)!==r&&(At.flags|=1024),c}function $f(){var r=Rd!==0;return Rd=0,r}function Gf(r,c,m){c.updateQueue=r.updateQueue,c.flags&=-2053,r.lanes&=~m}function Vf(r){if(kd){for(r=r.memoizedState;r!==null;){var c=r.queue;c!==null&&(c.pending=null),r=r.next}kd=!1}hi=0,Ks=ls=At=null,Ul=!1,ec=Rd=0,$l=null}function va(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ks===null?At.memoizedState=Ks=r:Ks=Ks.next=r,Ks}function Fs(){if(ls===null){var r=At.alternate;r=r!==null?r.memoizedState:null}else r=ls.next;var c=Ks===null?At.memoizedState:Ks.next;if(c!==null)Ks=c,ls=r;else{if(r===null)throw At.alternate===null?Error(n(467)):Error(n(310));ls=r,r={memoizedState:ls.memoizedState,baseState:ls.baseState,baseQueue:ls.baseQueue,queue:ls.queue,next:null},Ks===null?At.memoizedState=Ks=r:Ks=Ks.next=r}return Ks}function Ld(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function tc(r){var c=ec;return ec+=1,$l===null&&($l=[]),r=Mx($l,r,c),c=At,(Ks===null?c.memoizedState:Ks.next)===null&&(c=c.alternate,X.H=c===null||c.memoizedState===null?jy:tm),r}function Dd(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return tc(r);if(r.$$typeof===T)return ia(r)}throw Error(n(438,String(r)))}function qf(r){var c=null,m=At.updateQueue;if(m!==null&&(c=m.memoCache),c==null){var x=At.alternate;x!==null&&(x=x.updateQueue,x!==null&&(x=x.memoCache,x!=null&&(c={data:x.data.map(function(S){return S.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),m===null&&(m=Ld(),At.updateQueue=m),m.memoCache=c,m=c.data[c.index],m===void 0)for(m=c.data[c.index]=Array(r),x=0;x<r;x++)m[x]=D;return c.index++,m}function fi(r,c){return typeof c=="function"?c(r):c}function Md(r){var c=Fs();return Kf(c,ls,r)}function Kf(r,c,m){var x=r.queue;if(x===null)throw Error(n(311));x.lastRenderedReducer=m;var S=r.baseQueue,E=x.pending;if(E!==null){if(S!==null){var U=S.next;S.next=E.next,E.next=U}c.baseQueue=S=E,x.pending=null}if(E=r.baseState,S===null)r.memoizedState=E;else{c=S.next;var Q=U=null,de=null,je=c,Oe=!1;do{var $e=je.lane&-536870913;if($e!==je.lane?(Ut&$e)===$e:(hi&$e)===$e){var Ae=je.revertLane;if(Ae===0)de!==null&&(de=de.next={lane:0,revertLane:0,gesture:null,action:je.action,hasEagerState:je.hasEagerState,eagerState:je.eagerState,next:null}),$e===Il&&(Oe=!0);else if((hi&Ae)===Ae){je=je.next,Ae===Il&&(Oe=!0);continue}else $e={lane:0,revertLane:je.revertLane,gesture:null,action:je.action,hasEagerState:je.hasEagerState,eagerState:je.eagerState,next:null},de===null?(Q=de=$e,U=E):de=de.next=$e,At.lanes|=Ae,ar|=Ae;$e=je.action,Qr&&m(E,$e),E=je.hasEagerState?je.eagerState:m(E,$e)}else Ae={lane:$e,revertLane:je.revertLane,gesture:je.gesture,action:je.action,hasEagerState:je.hasEagerState,eagerState:je.eagerState,next:null},de===null?(Q=de=Ae,U=E):de=de.next=Ae,At.lanes|=$e,ar|=$e;je=je.next}while(je!==null&&je!==c);if(de===null?U=E:de.next=Q,!qa(E,r.memoizedState)&&(Hs=!0,Oe&&(m=Pl,m!==null)))throw m;r.memoizedState=E,r.baseState=U,r.baseQueue=de,x.lastRenderedState=E}return S===null&&(x.lanes=0),[r.memoizedState,x.dispatch]}function Hf(r){var c=Fs(),m=c.queue;if(m===null)throw Error(n(311));m.lastRenderedReducer=r;var x=m.dispatch,S=m.pending,E=c.memoizedState;if(S!==null){m.pending=null;var U=S=S.next;do E=r(E,U.action),U=U.next;while(U!==S);qa(E,c.memoizedState)||(Hs=!0),c.memoizedState=E,c.baseQueue===null&&(c.baseState=E),m.lastRenderedState=E}return[E,x]}function Kx(r,c,m){var x=At,S=Fs(),E=qt;if(E){if(m===void 0)throw Error(n(407));m=m()}else m=c();var U=!qa((ls||S).memoizedState,m);if(U&&(S.memoizedState=m,Hs=!0),S=S.queue,Wf(Yx.bind(null,x,S,r),[r]),S.getSnapshot!==c||U||Ks!==null&&Ks.memoizedState.tag&1){if(x.flags|=2048,Gl(9,{destroy:void 0},zx.bind(null,x,S,m,c),null),us===null)throw Error(n(349));E||(hi&127)!==0||Hx(x,c,m)}return m}function Hx(r,c,m){r.flags|=16384,r={getSnapshot:c,value:m},c=At.updateQueue,c===null?(c=Ld(),At.updateQueue=c,c.stores=[r]):(m=c.stores,m===null?c.stores=[r]:m.push(r))}function zx(r,c,m,x){c.value=m,c.getSnapshot=x,Wx(c)&&Qx(r)}function Yx(r,c,m){return m(function(){Wx(c)&&Qx(r)})}function Wx(r){var c=r.getSnapshot;r=r.value;try{var m=c();return!qa(r,m)}catch{return!0}}function Qx(r){var c=$r(r,2);c!==null&&Ma(c,r,2)}function zf(r){var c=va();if(typeof r=="function"){var m=r;if(r=m(),Qr){we(!0);try{m()}finally{we(!1)}}}return c.memoizedState=c.baseState=r,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fi,lastRenderedState:r},c}function Xx(r,c,m,x){return r.baseState=m,Kf(r,ls,typeof x=="function"?x:fi)}function NE(r,c,m,x,S){if(Od(r))throw Error(n(485));if(r=c.action,r!==null){var E={payload:S,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(U){E.listeners.push(U)}};X.T!==null?m(!0):E.isTransition=!1,x(E),m=c.pending,m===null?(E.next=c.pending=E,Jx(c,E)):(E.next=m.next,c.pending=m.next=E)}}function Jx(r,c){var m=c.action,x=c.payload,S=r.state;if(c.isTransition){var E=X.T,U={};X.T=U;try{var Q=m(S,x),de=X.S;de!==null&&de(U,Q),Zx(r,c,Q)}catch(je){Yf(r,c,je)}finally{E!==null&&U.types!==null&&(E.types=U.types),X.T=E}}else try{E=m(S,x),Zx(r,c,E)}catch(je){Yf(r,c,je)}}function Zx(r,c,m){m!==null&&typeof m=="object"&&typeof m.then=="function"?m.then(function(x){ey(r,c,x)},function(x){return Yf(r,c,x)}):ey(r,c,m)}function ey(r,c,m){c.status="fulfilled",c.value=m,ty(c),r.state=m,c=r.pending,c!==null&&(m=c.next,m===c?r.pending=null:(m=m.next,c.next=m,Jx(r,m)))}function Yf(r,c,m){var x=r.pending;if(r.pending=null,x!==null){x=x.next;do c.status="rejected",c.reason=m,ty(c),c=c.next;while(c!==x)}r.action=null}function ty(r){r=r.listeners;for(var c=0;c<r.length;c++)(0,r[c])()}function sy(r,c){return c}function ay(r,c){if(qt){var m=us.formState;if(m!==null){e:{var x=At;if(qt){if(vs){t:{for(var S=vs,E=gn;S.nodeType!==8;){if(!E){S=null;break t}if(S=xn(S.nextSibling),S===null){S=null;break t}}E=S.data,S=E==="F!"||E==="F"?S:null}if(S){vs=xn(S.nextSibling),x=S.data==="F!";break e}}Yi(x)}x=!1}x&&(c=m[0])}}return m=va(),m.memoizedState=m.baseState=c,x={pending:null,lanes:0,dispatch:null,lastRenderedReducer:sy,lastRenderedState:c},m.queue=x,m=Ny.bind(null,At,x),x.dispatch=m,x=zf(!1),E=em.bind(null,At,!1,x.queue),x=va(),S={state:c,dispatch:null,action:r,pending:null},x.queue=S,m=NE.bind(null,At,S,E,m),S.dispatch=m,x.memoizedState=r,[c,m,!1]}function ny(r){var c=Fs();return iy(c,ls,r)}function iy(r,c,m){if(c=Kf(r,c,sy)[0],r=Md(fi)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var x=tc(c)}catch(U){throw U===Ol?Sd:U}else x=c;c=Fs();var S=c.queue,E=S.dispatch;return m!==c.memoizedState&&(At.flags|=2048,Gl(9,{destroy:void 0},wE.bind(null,S,m),null)),[x,E,r]}function wE(r,c){r.action=c}function ry(r){var c=Fs(),m=ls;if(m!==null)return iy(c,m,r);Fs(),c=c.memoizedState,m=Fs();var x=m.queue.dispatch;return m.memoizedState=r,[c,x,!1]}function Gl(r,c,m,x){return r={tag:r,create:m,deps:x,inst:c,next:null},c=At.updateQueue,c===null&&(c=Ld(),At.updateQueue=c),m=c.lastEffect,m===null?c.lastEffect=r.next=r:(x=m.next,m.next=r,r.next=x,c.lastEffect=r),r}function ly(){return Fs().memoizedState}function Id(r,c,m,x){var S=va();At.flags|=r,S.memoizedState=Gl(1|c,{destroy:void 0},m,x===void 0?null:x)}function Pd(r,c,m,x){var S=Fs();x=x===void 0?null:x;var E=S.memoizedState.inst;ls!==null&&x!==null&&Bf(x,ls.memoizedState.deps)?S.memoizedState=Gl(c,E,m,x):(At.flags|=r,S.memoizedState=Gl(1|c,E,m,x))}function oy(r,c){Id(8390656,8,r,c)}function Wf(r,c){Pd(2048,8,r,c)}function SE(r){At.flags|=4;var c=At.updateQueue;if(c===null)c=Ld(),At.updateQueue=c,c.events=[r];else{var m=c.events;m===null?c.events=[r]:m.push(r)}}function cy(r){var c=Fs().memoizedState;return SE({ref:c,nextImpl:r}),function(){if((es&2)!==0)throw Error(n(440));return c.impl.apply(void 0,arguments)}}function dy(r,c){return Pd(4,2,r,c)}function uy(r,c){return Pd(4,4,r,c)}function hy(r,c){if(typeof c=="function"){r=r();var m=c(r);return function(){typeof m=="function"?m():c(null)}}if(c!=null)return r=r(),c.current=r,function(){c.current=null}}function fy(r,c,m){m=m!=null?m.concat([r]):null,Pd(4,4,hy.bind(null,c,r),m)}function Qf(){}function my(r,c){var m=Fs();c=c===void 0?null:c;var x=m.memoizedState;return c!==null&&Bf(c,x[1])?x[0]:(m.memoizedState=[r,c],r)}function gy(r,c){var m=Fs();c=c===void 0?null:c;var x=m.memoizedState;if(c!==null&&Bf(c,x[1]))return x[0];if(x=r(),Qr){we(!0);try{r()}finally{we(!1)}}return m.memoizedState=[x,c],x}function Xf(r,c,m){return m===void 0||(hi&1073741824)!==0&&(Ut&261930)===0?r.memoizedState=c:(r.memoizedState=m,r=pb(),At.lanes|=r,ar|=r,m)}function py(r,c,m,x){return qa(m,c)?m:Bl.current!==null?(r=Xf(r,m,x),qa(r,c)||(Hs=!0),r):(hi&42)===0||(hi&1073741824)!==0&&(Ut&261930)===0?(Hs=!0,r.memoizedState=m):(r=pb(),At.lanes|=r,ar|=r,c)}function xy(r,c,m,x,S){var E=ae.p;ae.p=E!==0&&8>E?E:8;var U=X.T,Q={};X.T=Q,em(r,!1,c,m);try{var de=S(),je=X.S;if(je!==null&&je(Q,de),de!==null&&typeof de=="object"&&typeof de.then=="function"){var Oe=bE(de,x);sc(r,c,Oe,Qa(r))}else sc(r,c,x,Qa(r))}catch($e){sc(r,c,{then:function(){},status:"rejected",reason:$e},Qa())}finally{ae.p=E,U!==null&&Q.types!==null&&(U.types=Q.types),X.T=U}}function jE(){}function Jf(r,c,m,x){if(r.tag!==5)throw Error(n(476));var S=yy(r).queue;xy(r,S,c,te,m===null?jE:function(){return by(r),m(x)})}function yy(r){var c=r.memoizedState;if(c!==null)return c;c={memoizedState:te,baseState:te,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fi,lastRenderedState:te},next:null};var m={};return c.next={memoizedState:m,baseState:m,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fi,lastRenderedState:m},next:null},r.memoizedState=c,r=r.alternate,r!==null&&(r.memoizedState=c),c}function by(r){var c=yy(r);c.next===null&&(c=r.alternate.memoizedState),sc(r,c.next.queue,{},Qa())}function Zf(){return ia(bc)}function vy(){return Fs().memoizedState}function _y(){return Fs().memoizedState}function EE(r){for(var c=r.return;c!==null;){switch(c.tag){case 24:case 3:var m=Qa();r=Xi(m);var x=Ji(c,r,m);x!==null&&(Ma(x,c,m),Xo(x,c,m)),c={cache:Af()},r.payload=c;return}c=c.return}}function TE(r,c,m){var x=Qa();m={lane:x,revertLane:0,gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},Od(r)?wy(c,m):(m=xf(r,c,m,x),m!==null&&(Ma(m,r,x),Sy(m,c,x)))}function Ny(r,c,m){var x=Qa();sc(r,c,m,x)}function sc(r,c,m,x){var S={lane:x,revertLane:0,gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null};if(Od(r))wy(c,S);else{var E=r.alternate;if(r.lanes===0&&(E===null||E.lanes===0)&&(E=c.lastRenderedReducer,E!==null))try{var U=c.lastRenderedState,Q=E(U,m);if(S.hasEagerState=!0,S.eagerState=Q,qa(Q,U))return xd(r,c,S,0),us===null&&pd(),!1}catch{}finally{}if(m=xf(r,c,S,x),m!==null)return Ma(m,r,x),Sy(m,c,x),!0}return!1}function em(r,c,m,x){if(x={lane:2,revertLane:Lm(),gesture:null,action:x,hasEagerState:!1,eagerState:null,next:null},Od(r)){if(c)throw Error(n(479))}else c=xf(r,m,x,2),c!==null&&Ma(c,r,2)}function Od(r){var c=r.alternate;return r===At||c!==null&&c===At}function wy(r,c){Ul=kd=!0;var m=r.pending;m===null?c.next=c:(c.next=m.next,m.next=c),r.pending=c}function Sy(r,c,m){if((m&4194048)!==0){var x=c.lanes;x&=r.pendingLanes,m|=x,c.lanes=m,Aa(r,m)}}var ac={readContext:ia,use:Dd,useCallback:Ls,useContext:Ls,useEffect:Ls,useImperativeHandle:Ls,useLayoutEffect:Ls,useInsertionEffect:Ls,useMemo:Ls,useReducer:Ls,useRef:Ls,useState:Ls,useDebugValue:Ls,useDeferredValue:Ls,useTransition:Ls,useSyncExternalStore:Ls,useId:Ls,useHostTransitionStatus:Ls,useFormState:Ls,useActionState:Ls,useOptimistic:Ls,useMemoCache:Ls,useCacheRefresh:Ls};ac.useEffectEvent=Ls;var jy={readContext:ia,use:Dd,useCallback:function(r,c){return va().memoizedState=[r,c===void 0?null:c],r},useContext:ia,useEffect:oy,useImperativeHandle:function(r,c,m){m=m!=null?m.concat([r]):null,Id(4194308,4,hy.bind(null,c,r),m)},useLayoutEffect:function(r,c){return Id(4194308,4,r,c)},useInsertionEffect:function(r,c){Id(4,2,r,c)},useMemo:function(r,c){var m=va();c=c===void 0?null:c;var x=r();if(Qr){we(!0);try{r()}finally{we(!1)}}return m.memoizedState=[x,c],x},useReducer:function(r,c,m){var x=va();if(m!==void 0){var S=m(c);if(Qr){we(!0);try{m(c)}finally{we(!1)}}}else S=c;return x.memoizedState=x.baseState=S,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:S},x.queue=r,r=r.dispatch=TE.bind(null,At,r),[x.memoizedState,r]},useRef:function(r){var c=va();return r={current:r},c.memoizedState=r},useState:function(r){r=zf(r);var c=r.queue,m=Ny.bind(null,At,c);return c.dispatch=m,[r.memoizedState,m]},useDebugValue:Qf,useDeferredValue:function(r,c){var m=va();return Xf(m,r,c)},useTransition:function(){var r=zf(!1);return r=xy.bind(null,At,r.queue,!0,!1),va().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,c,m){var x=At,S=va();if(qt){if(m===void 0)throw Error(n(407));m=m()}else{if(m=c(),us===null)throw Error(n(349));(Ut&127)!==0||Hx(x,c,m)}S.memoizedState=m;var E={value:m,getSnapshot:c};return S.queue=E,oy(Yx.bind(null,x,E,r),[r]),x.flags|=2048,Gl(9,{destroy:void 0},zx.bind(null,x,E,m,c),null),m},useId:function(){var r=va(),c=us.identifierPrefix;if(qt){var m=qn,x=Vn;m=(x&~(1<<32-gt(x)-1)).toString(32)+m,c="_"+c+"R_"+m,m=Rd++,0<m&&(c+="H"+m.toString(32)),c+="_"}else m=vE++,c="_"+c+"r_"+m.toString(32)+"_";return r.memoizedState=c},useHostTransitionStatus:Zf,useFormState:ay,useActionState:ay,useOptimistic:function(r){var c=va();c.memoizedState=c.baseState=r;var m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=m,c=em.bind(null,At,!0,m),m.dispatch=c,[r,c]},useMemoCache:qf,useCacheRefresh:function(){return va().memoizedState=EE.bind(null,At)},useEffectEvent:function(r){var c=va(),m={impl:r};return c.memoizedState=m,function(){if((es&2)!==0)throw Error(n(440));return m.impl.apply(void 0,arguments)}}},tm={readContext:ia,use:Dd,useCallback:my,useContext:ia,useEffect:Wf,useImperativeHandle:fy,useInsertionEffect:dy,useLayoutEffect:uy,useMemo:gy,useReducer:Md,useRef:ly,useState:function(){return Md(fi)},useDebugValue:Qf,useDeferredValue:function(r,c){var m=Fs();return py(m,ls.memoizedState,r,c)},useTransition:function(){var r=Md(fi)[0],c=Fs().memoizedState;return[typeof r=="boolean"?r:tc(r),c]},useSyncExternalStore:Kx,useId:vy,useHostTransitionStatus:Zf,useFormState:ny,useActionState:ny,useOptimistic:function(r,c){var m=Fs();return Xx(m,ls,r,c)},useMemoCache:qf,useCacheRefresh:_y};tm.useEffectEvent=cy;var Ey={readContext:ia,use:Dd,useCallback:my,useContext:ia,useEffect:Wf,useImperativeHandle:fy,useInsertionEffect:dy,useLayoutEffect:uy,useMemo:gy,useReducer:Hf,useRef:ly,useState:function(){return Hf(fi)},useDebugValue:Qf,useDeferredValue:function(r,c){var m=Fs();return ls===null?Xf(m,r,c):py(m,ls.memoizedState,r,c)},useTransition:function(){var r=Hf(fi)[0],c=Fs().memoizedState;return[typeof r=="boolean"?r:tc(r),c]},useSyncExternalStore:Kx,useId:vy,useHostTransitionStatus:Zf,useFormState:ry,useActionState:ry,useOptimistic:function(r,c){var m=Fs();return ls!==null?Xx(m,ls,r,c):(m.baseState=r,[r,m.queue.dispatch])},useMemoCache:qf,useCacheRefresh:_y};Ey.useEffectEvent=cy;function sm(r,c,m,x){c=r.memoizedState,m=m(x,c),m=m==null?c:g({},c,m),r.memoizedState=m,r.lanes===0&&(r.updateQueue.baseState=m)}var am={enqueueSetState:function(r,c,m){r=r._reactInternals;var x=Qa(),S=Xi(x);S.payload=c,m!=null&&(S.callback=m),c=Ji(r,S,x),c!==null&&(Ma(c,r,x),Xo(c,r,x))},enqueueReplaceState:function(r,c,m){r=r._reactInternals;var x=Qa(),S=Xi(x);S.tag=1,S.payload=c,m!=null&&(S.callback=m),c=Ji(r,S,x),c!==null&&(Ma(c,r,x),Xo(c,r,x))},enqueueForceUpdate:function(r,c){r=r._reactInternals;var m=Qa(),x=Xi(m);x.tag=2,c!=null&&(x.callback=c),c=Ji(r,x,m),c!==null&&(Ma(c,r,m),Xo(c,r,m))}};function Ty(r,c,m,x,S,E,U){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(x,E,U):c.prototype&&c.prototype.isPureReactComponent?!Vo(m,x)||!Vo(S,E):!0}function Ay(r,c,m,x){r=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(m,x),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(m,x),c.state!==r&&am.enqueueReplaceState(c,c.state,null)}function Xr(r,c){var m=c;if("ref"in c){m={};for(var x in c)x!=="ref"&&(m[x]=c[x])}if(r=r.defaultProps){m===c&&(m=g({},m));for(var S in r)m[S]===void 0&&(m[S]=r[S])}return m}function Cy(r){gd(r)}function ky(r){console.error(r)}function Ry(r){gd(r)}function Fd(r,c){try{var m=r.onUncaughtError;m(c.value,{componentStack:c.stack})}catch(x){setTimeout(function(){throw x})}}function Ly(r,c,m){try{var x=r.onCaughtError;x(m.value,{componentStack:m.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(S){setTimeout(function(){throw S})}}function nm(r,c,m){return m=Xi(m),m.tag=3,m.payload={element:null},m.callback=function(){Fd(r,c)},m}function Dy(r){return r=Xi(r),r.tag=3,r}function My(r,c,m,x){var S=m.type.getDerivedStateFromError;if(typeof S=="function"){var E=x.value;r.payload=function(){return S(E)},r.callback=function(){Ly(c,m,x)}}var U=m.stateNode;U!==null&&typeof U.componentDidCatch=="function"&&(r.callback=function(){Ly(c,m,x),typeof S!="function"&&(nr===null?nr=new Set([this]):nr.add(this));var Q=x.stack;this.componentDidCatch(x.value,{componentStack:Q!==null?Q:""})})}function AE(r,c,m,x,S){if(m.flags|=32768,x!==null&&typeof x=="object"&&typeof x.then=="function"){if(c=m.alternate,c!==null&&Ml(c,m,S,!0),m=Ha.current,m!==null){switch(m.tag){case 31:case 13:return pn===null?Qd():m.alternate===null&&Ds===0&&(Ds=3),m.flags&=-257,m.flags|=65536,m.lanes=S,x===jd?m.flags|=16384:(c=m.updateQueue,c===null?m.updateQueue=new Set([x]):c.add(x),Cm(r,x,S)),!1;case 22:return m.flags|=65536,x===jd?m.flags|=16384:(c=m.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([x])},m.updateQueue=c):(m=c.retryQueue,m===null?c.retryQueue=new Set([x]):m.add(x)),Cm(r,x,S)),!1}throw Error(n(435,m.tag))}return Cm(r,x,S),Qd(),!1}if(qt)return c=Ha.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=S,x!==wf&&(r=Error(n(422),{cause:x}),Ho(hn(r,m)))):(x!==wf&&(c=Error(n(423),{cause:x}),Ho(hn(c,m))),r=r.current.alternate,r.flags|=65536,S&=-S,r.lanes|=S,x=hn(x,m),S=nm(r.stateNode,x,S),Mf(r,S),Ds!==4&&(Ds=2)),!1;var E=Error(n(520),{cause:x});if(E=hn(E,m),uc===null?uc=[E]:uc.push(E),Ds!==4&&(Ds=2),c===null)return!0;x=hn(x,m),m=c;do{switch(m.tag){case 3:return m.flags|=65536,r=S&-S,m.lanes|=r,r=nm(m.stateNode,x,r),Mf(m,r),!1;case 1:if(c=m.type,E=m.stateNode,(m.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(nr===null||!nr.has(E))))return m.flags|=65536,S&=-S,m.lanes|=S,S=Dy(S),My(S,r,m,x),Mf(m,S),!1}m=m.return}while(m!==null);return!1}var im=Error(n(461)),Hs=!1;function ra(r,c,m,x){c.child=r===null?Fx(c,null,m,x):Wr(c,r.child,m,x)}function Iy(r,c,m,x,S){m=m.render;var E=c.ref;if("ref"in x){var U={};for(var Q in x)Q!=="ref"&&(U[Q]=x[Q])}else U=x;return Kr(c),x=Uf(r,c,m,U,E,S),Q=$f(),r!==null&&!Hs?(Gf(r,c,S),mi(r,c,S)):(qt&&Q&&_f(c),c.flags|=1,ra(r,c,x,S),c.child)}function Py(r,c,m,x,S){if(r===null){var E=m.type;return typeof E=="function"&&!yf(E)&&E.defaultProps===void 0&&m.compare===null?(c.tag=15,c.type=E,Oy(r,c,E,x,S)):(r=bd(m.type,null,x,c,c.mode,S),r.ref=c.ref,r.return=c,c.child=r)}if(E=r.child,!fm(r,S)){var U=E.memoizedProps;if(m=m.compare,m=m!==null?m:Vo,m(U,x)&&r.ref===c.ref)return mi(r,c,S)}return c.flags|=1,r=oi(E,x),r.ref=c.ref,r.return=c,c.child=r}function Oy(r,c,m,x,S){if(r!==null){var E=r.memoizedProps;if(Vo(E,x)&&r.ref===c.ref)if(Hs=!1,c.pendingProps=x=E,fm(r,S))(r.flags&131072)!==0&&(Hs=!0);else return c.lanes=r.lanes,mi(r,c,S)}return rm(r,c,m,x,S)}function Fy(r,c,m,x){var S=x.children,E=r!==null?r.memoizedState:null;if(r===null&&c.stateNode===null&&(c.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),x.mode==="hidden"){if((c.flags&128)!==0){if(E=E!==null?E.baseLanes|m:m,r!==null){for(x=c.child=r.child,S=0;x!==null;)S=S|x.lanes|x.childLanes,x=x.sibling;x=S&~E}else x=0,c.child=null;return By(r,c,E,m,x)}if((m&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},r!==null&&wd(c,E!==null?E.cachePool:null),E!==null?$x(c,E):Pf(),Gx(c);else return x=c.lanes=536870912,By(r,c,E!==null?E.baseLanes|m:m,m,x)}else E!==null?(wd(c,E.cachePool),$x(c,E),er(),c.memoizedState=null):(r!==null&&wd(c,null),Pf(),er());return ra(r,c,S,m),c.child}function nc(r,c){return r!==null&&r.tag===22||c.stateNode!==null||(c.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.sibling}function By(r,c,m,x,S){var E=kf();return E=E===null?null:{parent:qs._currentValue,pool:E},c.memoizedState={baseLanes:m,cachePool:E},r!==null&&wd(c,null),Pf(),Gx(c),r!==null&&Ml(r,c,x,!0),c.childLanes=S,null}function Bd(r,c){return c=$d({mode:c.mode,children:c.children},r.mode),c.ref=r.ref,r.child=c,c.return=r,c}function Uy(r,c,m){return Wr(c,r.child,null,m),r=Bd(c,c.pendingProps),r.flags|=2,za(c),c.memoizedState=null,r}function CE(r,c,m){var x=c.pendingProps,S=(c.flags&128)!==0;if(c.flags&=-129,r===null){if(qt){if(x.mode==="hidden")return r=Bd(c,x),c.lanes=536870912,nc(null,r);if(Ff(c),(r=vs)?(r=Jb(r,gn),r=r!==null&&r.data==="&"?r:null,r!==null&&(c.memoizedState={dehydrated:r,treeContext:Hi!==null?{id:Vn,overflow:qn}:null,retryLane:536870912,hydrationErrors:null},m=wx(r),m.return=c,c.child=m,na=c,vs=null)):r=null,r===null)throw Yi(c);return c.lanes=536870912,null}return Bd(c,x)}var E=r.memoizedState;if(E!==null){var U=E.dehydrated;if(Ff(c),S)if(c.flags&256)c.flags&=-257,c=Uy(r,c,m);else if(c.memoizedState!==null)c.child=r.child,c.flags|=128,c=null;else throw Error(n(558));else if(Hs||Ml(r,c,m,!1),S=(m&r.childLanes)!==0,Hs||S){if(x=us,x!==null&&(U=kr(x,m),U!==0&&U!==E.retryLane))throw E.retryLane=U,$r(r,U),Ma(x,r,U),im;Qd(),c=Uy(r,c,m)}else r=E.treeContext,vs=xn(U.nextSibling),na=c,qt=!0,zi=null,gn=!1,r!==null&&Ex(c,r),c=Bd(c,x),c.flags|=4096;return c}return r=oi(r.child,{mode:x.mode,children:x.children}),r.ref=c.ref,c.child=r,r.return=c,r}function Ud(r,c){var m=c.ref;if(m===null)r!==null&&r.ref!==null&&(c.flags|=4194816);else{if(typeof m!="function"&&typeof m!="object")throw Error(n(284));(r===null||r.ref!==m)&&(c.flags|=4194816)}}function rm(r,c,m,x,S){return Kr(c),m=Uf(r,c,m,x,void 0,S),x=$f(),r!==null&&!Hs?(Gf(r,c,S),mi(r,c,S)):(qt&&x&&_f(c),c.flags|=1,ra(r,c,m,S),c.child)}function $y(r,c,m,x,S,E){return Kr(c),c.updateQueue=null,m=qx(c,x,m,S),Vx(r),x=$f(),r!==null&&!Hs?(Gf(r,c,E),mi(r,c,E)):(qt&&x&&_f(c),c.flags|=1,ra(r,c,m,E),c.child)}function Gy(r,c,m,x,S){if(Kr(c),c.stateNode===null){var E=kl,U=m.contextType;typeof U=="object"&&U!==null&&(E=ia(U)),E=new m(x,E),c.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,E.updater=am,c.stateNode=E,E._reactInternals=c,E=c.stateNode,E.props=x,E.state=c.memoizedState,E.refs={},Lf(c),U=m.contextType,E.context=typeof U=="object"&&U!==null?ia(U):kl,E.state=c.memoizedState,U=m.getDerivedStateFromProps,typeof U=="function"&&(sm(c,m,U,x),E.state=c.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(U=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),U!==E.state&&am.enqueueReplaceState(E,E.state,null),Zo(c,x,E,S),Jo(),E.state=c.memoizedState),typeof E.componentDidMount=="function"&&(c.flags|=4194308),x=!0}else if(r===null){E=c.stateNode;var Q=c.memoizedProps,de=Xr(m,Q);E.props=de;var je=E.context,Oe=m.contextType;U=kl,typeof Oe=="object"&&Oe!==null&&(U=ia(Oe));var $e=m.getDerivedStateFromProps;Oe=typeof $e=="function"||typeof E.getSnapshotBeforeUpdate=="function",Q=c.pendingProps!==Q,Oe||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(Q||je!==U)&&Ay(c,E,x,U),Qi=!1;var Ae=c.memoizedState;E.state=Ae,Zo(c,x,E,S),Jo(),je=c.memoizedState,Q||Ae!==je||Qi?(typeof $e=="function"&&(sm(c,m,$e,x),je=c.memoizedState),(de=Qi||Ty(c,m,de,x,Ae,je,U))?(Oe||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(c.flags|=4194308)):(typeof E.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=x,c.memoizedState=je),E.props=x,E.state=je,E.context=U,x=de):(typeof E.componentDidMount=="function"&&(c.flags|=4194308),x=!1)}else{E=c.stateNode,Df(r,c),U=c.memoizedProps,Oe=Xr(m,U),E.props=Oe,$e=c.pendingProps,Ae=E.context,je=m.contextType,de=kl,typeof je=="object"&&je!==null&&(de=ia(je)),Q=m.getDerivedStateFromProps,(je=typeof Q=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(U!==$e||Ae!==de)&&Ay(c,E,x,de),Qi=!1,Ae=c.memoizedState,E.state=Ae,Zo(c,x,E,S),Jo();var Re=c.memoizedState;U!==$e||Ae!==Re||Qi||r!==null&&r.dependencies!==null&&_d(r.dependencies)?(typeof Q=="function"&&(sm(c,m,Q,x),Re=c.memoizedState),(Oe=Qi||Ty(c,m,Oe,x,Ae,Re,de)||r!==null&&r.dependencies!==null&&_d(r.dependencies))?(je||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(x,Re,de),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(x,Re,de)),typeof E.componentDidUpdate=="function"&&(c.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof E.componentDidUpdate!="function"||U===r.memoizedProps&&Ae===r.memoizedState||(c.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||U===r.memoizedProps&&Ae===r.memoizedState||(c.flags|=1024),c.memoizedProps=x,c.memoizedState=Re),E.props=x,E.state=Re,E.context=de,x=Oe):(typeof E.componentDidUpdate!="function"||U===r.memoizedProps&&Ae===r.memoizedState||(c.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||U===r.memoizedProps&&Ae===r.memoizedState||(c.flags|=1024),x=!1)}return E=x,Ud(r,c),x=(c.flags&128)!==0,E||x?(E=c.stateNode,m=x&&typeof m.getDerivedStateFromError!="function"?null:E.render(),c.flags|=1,r!==null&&x?(c.child=Wr(c,r.child,null,S),c.child=Wr(c,null,m,S)):ra(r,c,m,S),c.memoizedState=E.state,r=c.child):r=mi(r,c,S),r}function Vy(r,c,m,x){return Vr(),c.flags|=256,ra(r,c,m,x),c.child}var lm={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function om(r){return{baseLanes:r,cachePool:Lx()}}function cm(r,c,m){return r=r!==null?r.childLanes&~m:0,c&&(r|=Wa),r}function qy(r,c,m){var x=c.pendingProps,S=!1,E=(c.flags&128)!==0,U;if((U=E)||(U=r!==null&&r.memoizedState===null?!1:(Os.current&2)!==0),U&&(S=!0,c.flags&=-129),U=(c.flags&32)!==0,c.flags&=-33,r===null){if(qt){if(S?Zi(c):er(),(r=vs)?(r=Jb(r,gn),r=r!==null&&r.data!=="&"?r:null,r!==null&&(c.memoizedState={dehydrated:r,treeContext:Hi!==null?{id:Vn,overflow:qn}:null,retryLane:536870912,hydrationErrors:null},m=wx(r),m.return=c,c.child=m,na=c,vs=null)):r=null,r===null)throw Yi(c);return Km(r)?c.lanes=32:c.lanes=536870912,null}var Q=x.children;return x=x.fallback,S?(er(),S=c.mode,Q=$d({mode:"hidden",children:Q},S),x=Gr(x,S,m,null),Q.return=c,x.return=c,Q.sibling=x,c.child=Q,x=c.child,x.memoizedState=om(m),x.childLanes=cm(r,U,m),c.memoizedState=lm,nc(null,x)):(Zi(c),dm(c,Q))}var de=r.memoizedState;if(de!==null&&(Q=de.dehydrated,Q!==null)){if(E)c.flags&256?(Zi(c),c.flags&=-257,c=um(r,c,m)):c.memoizedState!==null?(er(),c.child=r.child,c.flags|=128,c=null):(er(),Q=x.fallback,S=c.mode,x=$d({mode:"visible",children:x.children},S),Q=Gr(Q,S,m,null),Q.flags|=2,x.return=c,Q.return=c,x.sibling=Q,c.child=x,Wr(c,r.child,null,m),x=c.child,x.memoizedState=om(m),x.childLanes=cm(r,U,m),c.memoizedState=lm,c=nc(null,x));else if(Zi(c),Km(Q)){if(U=Q.nextSibling&&Q.nextSibling.dataset,U)var je=U.dgst;U=je,x=Error(n(419)),x.stack="",x.digest=U,Ho({value:x,source:null,stack:null}),c=um(r,c,m)}else if(Hs||Ml(r,c,m,!1),U=(m&r.childLanes)!==0,Hs||U){if(U=us,U!==null&&(x=kr(U,m),x!==0&&x!==de.retryLane))throw de.retryLane=x,$r(r,x),Ma(U,r,x),im;qm(Q)||Qd(),c=um(r,c,m)}else qm(Q)?(c.flags|=192,c.child=r.child,c=null):(r=de.treeContext,vs=xn(Q.nextSibling),na=c,qt=!0,zi=null,gn=!1,r!==null&&Ex(c,r),c=dm(c,x.children),c.flags|=4096);return c}return S?(er(),Q=x.fallback,S=c.mode,de=r.child,je=de.sibling,x=oi(de,{mode:"hidden",children:x.children}),x.subtreeFlags=de.subtreeFlags&65011712,je!==null?Q=oi(je,Q):(Q=Gr(Q,S,m,null),Q.flags|=2),Q.return=c,x.return=c,x.sibling=Q,c.child=x,nc(null,x),x=c.child,Q=r.child.memoizedState,Q===null?Q=om(m):(S=Q.cachePool,S!==null?(de=qs._currentValue,S=S.parent!==de?{parent:de,pool:de}:S):S=Lx(),Q={baseLanes:Q.baseLanes|m,cachePool:S}),x.memoizedState=Q,x.childLanes=cm(r,U,m),c.memoizedState=lm,nc(r.child,x)):(Zi(c),m=r.child,r=m.sibling,m=oi(m,{mode:"visible",children:x.children}),m.return=c,m.sibling=null,r!==null&&(U=c.deletions,U===null?(c.deletions=[r],c.flags|=16):U.push(r)),c.child=m,c.memoizedState=null,m)}function dm(r,c){return c=$d({mode:"visible",children:c},r.mode),c.return=r,r.child=c}function $d(r,c){return r=Ka(22,r,null,c),r.lanes=0,r}function um(r,c,m){return Wr(c,r.child,null,m),r=dm(c,c.pendingProps.children),r.flags|=2,c.memoizedState=null,r}function Ky(r,c,m){r.lanes|=c;var x=r.alternate;x!==null&&(x.lanes|=c),Ef(r.return,c,m)}function hm(r,c,m,x,S,E){var U=r.memoizedState;U===null?r.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:x,tail:m,tailMode:S,treeForkCount:E}:(U.isBackwards=c,U.rendering=null,U.renderingStartTime=0,U.last=x,U.tail=m,U.tailMode=S,U.treeForkCount=E)}function Hy(r,c,m){var x=c.pendingProps,S=x.revealOrder,E=x.tail;x=x.children;var U=Os.current,Q=(U&2)!==0;if(Q?(U=U&1|2,c.flags|=128):U&=1,oe(Os,U),ra(r,c,x,m),x=qt?Ko:0,!Q&&r!==null&&(r.flags&128)!==0)e:for(r=c.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&Ky(r,m,c);else if(r.tag===19)Ky(r,m,c);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===c)break e;for(;r.sibling===null;){if(r.return===null||r.return===c)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(S){case"forwards":for(m=c.child,S=null;m!==null;)r=m.alternate,r!==null&&Cd(r)===null&&(S=m),m=m.sibling;m=S,m===null?(S=c.child,c.child=null):(S=m.sibling,m.sibling=null),hm(c,!1,S,m,E,x);break;case"backwards":case"unstable_legacy-backwards":for(m=null,S=c.child,c.child=null;S!==null;){if(r=S.alternate,r!==null&&Cd(r)===null){c.child=S;break}r=S.sibling,S.sibling=m,m=S,S=r}hm(c,!0,m,null,E,x);break;case"together":hm(c,!1,null,null,void 0,x);break;default:c.memoizedState=null}return c.child}function mi(r,c,m){if(r!==null&&(c.dependencies=r.dependencies),ar|=c.lanes,(m&c.childLanes)===0)if(r!==null){if(Ml(r,c,m,!1),(m&c.childLanes)===0)return null}else return null;if(r!==null&&c.child!==r.child)throw Error(n(153));if(c.child!==null){for(r=c.child,m=oi(r,r.pendingProps),c.child=m,m.return=c;r.sibling!==null;)r=r.sibling,m=m.sibling=oi(r,r.pendingProps),m.return=c;m.sibling=null}return c.child}function fm(r,c){return(r.lanes&c)!==0?!0:(r=r.dependencies,!!(r!==null&&_d(r)))}function kE(r,c,m){switch(c.tag){case 3:fe(c,c.stateNode.containerInfo),Wi(c,qs,r.memoizedState.cache),Vr();break;case 27:case 5:ze(c);break;case 4:fe(c,c.stateNode.containerInfo);break;case 10:Wi(c,c.type,c.memoizedProps.value);break;case 31:if(c.memoizedState!==null)return c.flags|=128,Ff(c),null;break;case 13:var x=c.memoizedState;if(x!==null)return x.dehydrated!==null?(Zi(c),c.flags|=128,null):(m&c.child.childLanes)!==0?qy(r,c,m):(Zi(c),r=mi(r,c,m),r!==null?r.sibling:null);Zi(c);break;case 19:var S=(r.flags&128)!==0;if(x=(m&c.childLanes)!==0,x||(Ml(r,c,m,!1),x=(m&c.childLanes)!==0),S){if(x)return Hy(r,c,m);c.flags|=128}if(S=c.memoizedState,S!==null&&(S.rendering=null,S.tail=null,S.lastEffect=null),oe(Os,Os.current),x)break;return null;case 22:return c.lanes=0,Fy(r,c,m,c.pendingProps);case 24:Wi(c,qs,r.memoizedState.cache)}return mi(r,c,m)}function zy(r,c,m){if(r!==null)if(r.memoizedProps!==c.pendingProps)Hs=!0;else{if(!fm(r,m)&&(c.flags&128)===0)return Hs=!1,kE(r,c,m);Hs=(r.flags&131072)!==0}else Hs=!1,qt&&(c.flags&1048576)!==0&&jx(c,Ko,c.index);switch(c.lanes=0,c.tag){case 16:e:{var x=c.pendingProps;if(r=zr(c.elementType),c.type=r,typeof r=="function")yf(r)?(x=Xr(r,x),c.tag=1,c=Gy(null,c,r,x,m)):(c.tag=0,c=rm(null,c,r,x,m));else{if(r!=null){var S=r.$$typeof;if(S===L){c.tag=11,c=Iy(null,c,r,x,m);break e}else if(S===B){c.tag=14,c=Py(null,c,r,x,m);break e}}throw c=Z(r)||r,Error(n(306,c,""))}}return c;case 0:return rm(r,c,c.type,c.pendingProps,m);case 1:return x=c.type,S=Xr(x,c.pendingProps),Gy(r,c,x,S,m);case 3:e:{if(fe(c,c.stateNode.containerInfo),r===null)throw Error(n(387));x=c.pendingProps;var E=c.memoizedState;S=E.element,Df(r,c),Zo(c,x,null,m);var U=c.memoizedState;if(x=U.cache,Wi(c,qs,x),x!==E.cache&&Tf(c,[qs],m,!0),Jo(),x=U.element,E.isDehydrated)if(E={element:x,isDehydrated:!1,cache:U.cache},c.updateQueue.baseState=E,c.memoizedState=E,c.flags&256){c=Vy(r,c,x,m);break e}else if(x!==S){S=hn(Error(n(424)),c),Ho(S),c=Vy(r,c,x,m);break e}else{switch(r=c.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(vs=xn(r.firstChild),na=c,qt=!0,zi=null,gn=!0,m=Fx(c,null,x,m),c.child=m;m;)m.flags=m.flags&-3|4096,m=m.sibling}else{if(Vr(),x===S){c=mi(r,c,m);break e}ra(r,c,x,m)}c=c.child}return c;case 26:return Ud(r,c),r===null?(m=nv(c.type,null,c.pendingProps,null))?c.memoizedState=m:qt||(m=c.type,r=c.pendingProps,x=au(Ee.current).createElement(m),x[j]=c,x[w]=r,la(x,m,r),Pe(x),c.stateNode=x):c.memoizedState=nv(c.type,r.memoizedProps,c.pendingProps,r.memoizedState),null;case 27:return ze(c),r===null&&qt&&(x=c.stateNode=tv(c.type,c.pendingProps,Ee.current),na=c,gn=!0,S=vs,or(c.type)?(Hm=S,vs=xn(x.firstChild)):vs=S),ra(r,c,c.pendingProps.children,m),Ud(r,c),r===null&&(c.flags|=4194304),c.child;case 5:return r===null&&qt&&((S=x=vs)&&(x=r2(x,c.type,c.pendingProps,gn),x!==null?(c.stateNode=x,na=c,vs=xn(x.firstChild),gn=!1,S=!0):S=!1),S||Yi(c)),ze(c),S=c.type,E=c.pendingProps,U=r!==null?r.memoizedProps:null,x=E.children,$m(S,E)?x=null:U!==null&&$m(S,U)&&(c.flags|=32),c.memoizedState!==null&&(S=Uf(r,c,_E,null,null,m),bc._currentValue=S),Ud(r,c),ra(r,c,x,m),c.child;case 6:return r===null&&qt&&((r=m=vs)&&(m=l2(m,c.pendingProps,gn),m!==null?(c.stateNode=m,na=c,vs=null,r=!0):r=!1),r||Yi(c)),null;case 13:return qy(r,c,m);case 4:return fe(c,c.stateNode.containerInfo),x=c.pendingProps,r===null?c.child=Wr(c,null,x,m):ra(r,c,x,m),c.child;case 11:return Iy(r,c,c.type,c.pendingProps,m);case 7:return ra(r,c,c.pendingProps,m),c.child;case 8:return ra(r,c,c.pendingProps.children,m),c.child;case 12:return ra(r,c,c.pendingProps.children,m),c.child;case 10:return x=c.pendingProps,Wi(c,c.type,x.value),ra(r,c,x.children,m),c.child;case 9:return S=c.type._context,x=c.pendingProps.children,Kr(c),S=ia(S),x=x(S),c.flags|=1,ra(r,c,x,m),c.child;case 14:return Py(r,c,c.type,c.pendingProps,m);case 15:return Oy(r,c,c.type,c.pendingProps,m);case 19:return Hy(r,c,m);case 31:return CE(r,c,m);case 22:return Fy(r,c,m,c.pendingProps);case 24:return Kr(c),x=ia(qs),r===null?(S=kf(),S===null&&(S=us,E=Af(),S.pooledCache=E,E.refCount++,E!==null&&(S.pooledCacheLanes|=m),S=E),c.memoizedState={parent:x,cache:S},Lf(c),Wi(c,qs,S)):((r.lanes&m)!==0&&(Df(r,c),Zo(c,null,null,m),Jo()),S=r.memoizedState,E=c.memoizedState,S.parent!==x?(S={parent:x,cache:x},c.memoizedState=S,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=S),Wi(c,qs,x)):(x=E.cache,Wi(c,qs,x),x!==S.cache&&Tf(c,[qs],m,!0))),ra(r,c,c.pendingProps.children,m),c.child;case 29:throw c.pendingProps}throw Error(n(156,c.tag))}function gi(r){r.flags|=4}function mm(r,c,m,x,S){if((c=(r.mode&32)!==0)&&(c=!1),c){if(r.flags|=16777216,(S&335544128)===S)if(r.stateNode.complete)r.flags|=8192;else if(vb())r.flags|=8192;else throw Yr=jd,Rf}else r.flags&=-16777217}function Yy(r,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!cv(c))if(vb())r.flags|=8192;else throw Yr=jd,Rf}function Gd(r,c){c!==null&&(r.flags|=4),r.flags&16384&&(c=r.tag!==22?Cn():536870912,r.lanes|=c,Hl|=c)}function ic(r,c){if(!qt)switch(r.tailMode){case"hidden":c=r.tail;for(var m=null;c!==null;)c.alternate!==null&&(m=c),c=c.sibling;m===null?r.tail=null:m.sibling=null;break;case"collapsed":m=r.tail;for(var x=null;m!==null;)m.alternate!==null&&(x=m),m=m.sibling;x===null?c||r.tail===null?r.tail=null:r.tail.sibling=null:x.sibling=null}}function _s(r){var c=r.alternate!==null&&r.alternate.child===r.child,m=0,x=0;if(c)for(var S=r.child;S!==null;)m|=S.lanes|S.childLanes,x|=S.subtreeFlags&65011712,x|=S.flags&65011712,S.return=r,S=S.sibling;else for(S=r.child;S!==null;)m|=S.lanes|S.childLanes,x|=S.subtreeFlags,x|=S.flags,S.return=r,S=S.sibling;return r.subtreeFlags|=x,r.childLanes=m,c}function RE(r,c,m){var x=c.pendingProps;switch(Nf(c),c.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return _s(c),null;case 1:return _s(c),null;case 3:return m=c.stateNode,x=null,r!==null&&(x=r.memoizedState.cache),c.memoizedState.cache!==x&&(c.flags|=2048),ui(qs),Le(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(r===null||r.child===null)&&(Dl(c)?gi(c):r===null||r.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,Sf())),_s(c),null;case 26:var S=c.type,E=c.memoizedState;return r===null?(gi(c),E!==null?(_s(c),Yy(c,E)):(_s(c),mm(c,S,null,x,m))):E?E!==r.memoizedState?(gi(c),_s(c),Yy(c,E)):(_s(c),c.flags&=-16777217):(r=r.memoizedProps,r!==x&&gi(c),_s(c),mm(c,S,r,x,m)),null;case 27:if(Xe(c),m=Ee.current,S=c.type,r!==null&&c.stateNode!=null)r.memoizedProps!==x&&gi(c);else{if(!x){if(c.stateNode===null)throw Error(n(166));return _s(c),null}r=be.current,Dl(c)?Tx(c):(r=tv(S,x,m),c.stateNode=r,gi(c))}return _s(c),null;case 5:if(Xe(c),S=c.type,r!==null&&c.stateNode!=null)r.memoizedProps!==x&&gi(c);else{if(!x){if(c.stateNode===null)throw Error(n(166));return _s(c),null}if(E=be.current,Dl(c))Tx(c);else{var U=au(Ee.current);switch(E){case 1:E=U.createElementNS("http://www.w3.org/2000/svg",S);break;case 2:E=U.createElementNS("http://www.w3.org/1998/Math/MathML",S);break;default:switch(S){case"svg":E=U.createElementNS("http://www.w3.org/2000/svg",S);break;case"math":E=U.createElementNS("http://www.w3.org/1998/Math/MathML",S);break;case"script":E=U.createElement("div"),E.innerHTML="<script><\/script>",E=E.removeChild(E.firstChild);break;case"select":E=typeof x.is=="string"?U.createElement("select",{is:x.is}):U.createElement("select"),x.multiple?E.multiple=!0:x.size&&(E.size=x.size);break;default:E=typeof x.is=="string"?U.createElement(S,{is:x.is}):U.createElement(S)}}E[j]=c,E[w]=x;e:for(U=c.child;U!==null;){if(U.tag===5||U.tag===6)E.appendChild(U.stateNode);else if(U.tag!==4&&U.tag!==27&&U.child!==null){U.child.return=U,U=U.child;continue}if(U===c)break e;for(;U.sibling===null;){if(U.return===null||U.return===c)break e;U=U.return}U.sibling.return=U.return,U=U.sibling}c.stateNode=E;e:switch(la(E,S,x),S){case"button":case"input":case"select":case"textarea":x=!!x.autoFocus;break e;case"img":x=!0;break e;default:x=!1}x&&gi(c)}}return _s(c),mm(c,c.type,r===null?null:r.memoizedProps,c.pendingProps,m),null;case 6:if(r&&c.stateNode!=null)r.memoizedProps!==x&&gi(c);else{if(typeof x!="string"&&c.stateNode===null)throw Error(n(166));if(r=Ee.current,Dl(c)){if(r=c.stateNode,m=c.memoizedProps,x=null,S=na,S!==null)switch(S.tag){case 27:case 5:x=S.memoizedProps}r[j]=c,r=!!(r.nodeValue===m||x!==null&&x.suppressHydrationWarning===!0||qb(r.nodeValue,m)),r||Yi(c,!0)}else r=au(r).createTextNode(x),r[j]=c,c.stateNode=r}return _s(c),null;case 31:if(m=c.memoizedState,r===null||r.memoizedState!==null){if(x=Dl(c),m!==null){if(r===null){if(!x)throw Error(n(318));if(r=c.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(n(557));r[j]=c}else Vr(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;_s(c),r=!1}else m=Sf(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=m),r=!0;if(!r)return c.flags&256?(za(c),c):(za(c),null);if((c.flags&128)!==0)throw Error(n(558))}return _s(c),null;case 13:if(x=c.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(S=Dl(c),x!==null&&x.dehydrated!==null){if(r===null){if(!S)throw Error(n(318));if(S=c.memoizedState,S=S!==null?S.dehydrated:null,!S)throw Error(n(317));S[j]=c}else Vr(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;_s(c),S=!1}else S=Sf(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=S),S=!0;if(!S)return c.flags&256?(za(c),c):(za(c),null)}return za(c),(c.flags&128)!==0?(c.lanes=m,c):(m=x!==null,r=r!==null&&r.memoizedState!==null,m&&(x=c.child,S=null,x.alternate!==null&&x.alternate.memoizedState!==null&&x.alternate.memoizedState.cachePool!==null&&(S=x.alternate.memoizedState.cachePool.pool),E=null,x.memoizedState!==null&&x.memoizedState.cachePool!==null&&(E=x.memoizedState.cachePool.pool),E!==S&&(x.flags|=2048)),m!==r&&m&&(c.child.flags|=8192),Gd(c,c.updateQueue),_s(c),null);case 4:return Le(),r===null&&Pm(c.stateNode.containerInfo),_s(c),null;case 10:return ui(c.type),_s(c),null;case 19:if(J(Os),x=c.memoizedState,x===null)return _s(c),null;if(S=(c.flags&128)!==0,E=x.rendering,E===null)if(S)ic(x,!1);else{if(Ds!==0||r!==null&&(r.flags&128)!==0)for(r=c.child;r!==null;){if(E=Cd(r),E!==null){for(c.flags|=128,ic(x,!1),r=E.updateQueue,c.updateQueue=r,Gd(c,r),c.subtreeFlags=0,r=m,m=c.child;m!==null;)Nx(m,r),m=m.sibling;return oe(Os,Os.current&1|2),qt&&ci(c,x.treeForkCount),c.child}r=r.sibling}x.tail!==null&&ts()>zd&&(c.flags|=128,S=!0,ic(x,!1),c.lanes=4194304)}else{if(!S)if(r=Cd(E),r!==null){if(c.flags|=128,S=!0,r=r.updateQueue,c.updateQueue=r,Gd(c,r),ic(x,!0),x.tail===null&&x.tailMode==="hidden"&&!E.alternate&&!qt)return _s(c),null}else 2*ts()-x.renderingStartTime>zd&&m!==536870912&&(c.flags|=128,S=!0,ic(x,!1),c.lanes=4194304);x.isBackwards?(E.sibling=c.child,c.child=E):(r=x.last,r!==null?r.sibling=E:c.child=E,x.last=E)}return x.tail!==null?(r=x.tail,x.rendering=r,x.tail=r.sibling,x.renderingStartTime=ts(),r.sibling=null,m=Os.current,oe(Os,S?m&1|2:m&1),qt&&ci(c,x.treeForkCount),r):(_s(c),null);case 22:case 23:return za(c),Of(),x=c.memoizedState!==null,r!==null?r.memoizedState!==null!==x&&(c.flags|=8192):x&&(c.flags|=8192),x?(m&536870912)!==0&&(c.flags&128)===0&&(_s(c),c.subtreeFlags&6&&(c.flags|=8192)):_s(c),m=c.updateQueue,m!==null&&Gd(c,m.retryQueue),m=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(m=r.memoizedState.cachePool.pool),x=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(x=c.memoizedState.cachePool.pool),x!==m&&(c.flags|=2048),r!==null&&J(Hr),null;case 24:return m=null,r!==null&&(m=r.memoizedState.cache),c.memoizedState.cache!==m&&(c.flags|=2048),ui(qs),_s(c),null;case 25:return null;case 30:return null}throw Error(n(156,c.tag))}function LE(r,c){switch(Nf(c),c.tag){case 1:return r=c.flags,r&65536?(c.flags=r&-65537|128,c):null;case 3:return ui(qs),Le(),r=c.flags,(r&65536)!==0&&(r&128)===0?(c.flags=r&-65537|128,c):null;case 26:case 27:case 5:return Xe(c),null;case 31:if(c.memoizedState!==null){if(za(c),c.alternate===null)throw Error(n(340));Vr()}return r=c.flags,r&65536?(c.flags=r&-65537|128,c):null;case 13:if(za(c),r=c.memoizedState,r!==null&&r.dehydrated!==null){if(c.alternate===null)throw Error(n(340));Vr()}return r=c.flags,r&65536?(c.flags=r&-65537|128,c):null;case 19:return J(Os),null;case 4:return Le(),null;case 10:return ui(c.type),null;case 22:case 23:return za(c),Of(),r!==null&&J(Hr),r=c.flags,r&65536?(c.flags=r&-65537|128,c):null;case 24:return ui(qs),null;case 25:return null;default:return null}}function Wy(r,c){switch(Nf(c),c.tag){case 3:ui(qs),Le();break;case 26:case 27:case 5:Xe(c);break;case 4:Le();break;case 31:c.memoizedState!==null&&za(c);break;case 13:za(c);break;case 19:J(Os);break;case 10:ui(c.type);break;case 22:case 23:za(c),Of(),r!==null&&J(Hr);break;case 24:ui(qs)}}function rc(r,c){try{var m=c.updateQueue,x=m!==null?m.lastEffect:null;if(x!==null){var S=x.next;m=S;do{if((m.tag&r)===r){x=void 0;var E=m.create,U=m.inst;x=E(),U.destroy=x}m=m.next}while(m!==S)}}catch(Q){ns(c,c.return,Q)}}function tr(r,c,m){try{var x=c.updateQueue,S=x!==null?x.lastEffect:null;if(S!==null){var E=S.next;x=E;do{if((x.tag&r)===r){var U=x.inst,Q=U.destroy;if(Q!==void 0){U.destroy=void 0,S=c;var de=m,je=Q;try{je()}catch(Oe){ns(S,de,Oe)}}}x=x.next}while(x!==E)}}catch(Oe){ns(c,c.return,Oe)}}function Qy(r){var c=r.updateQueue;if(c!==null){var m=r.stateNode;try{Ux(c,m)}catch(x){ns(r,r.return,x)}}}function Xy(r,c,m){m.props=Xr(r.type,r.memoizedProps),m.state=r.memoizedState;try{m.componentWillUnmount()}catch(x){ns(r,c,x)}}function lc(r,c){try{var m=r.ref;if(m!==null){switch(r.tag){case 26:case 27:case 5:var x=r.stateNode;break;case 30:x=r.stateNode;break;default:x=r.stateNode}typeof m=="function"?r.refCleanup=m(x):m.current=x}}catch(S){ns(r,c,S)}}function Kn(r,c){var m=r.ref,x=r.refCleanup;if(m!==null)if(typeof x=="function")try{x()}catch(S){ns(r,c,S)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof m=="function")try{m(null)}catch(S){ns(r,c,S)}else m.current=null}function Jy(r){var c=r.type,m=r.memoizedProps,x=r.stateNode;try{e:switch(c){case"button":case"input":case"select":case"textarea":m.autoFocus&&x.focus();break e;case"img":m.src?x.src=m.src:m.srcSet&&(x.srcset=m.srcSet)}}catch(S){ns(r,r.return,S)}}function gm(r,c,m){try{var x=r.stateNode;e2(x,r.type,m,c),x[w]=c}catch(S){ns(r,r.return,S)}}function Zy(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&or(r.type)||r.tag===4}function pm(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Zy(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&or(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function xm(r,c,m){var x=r.tag;if(x===5||x===6)r=r.stateNode,c?(m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m).insertBefore(r,c):(c=m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m,c.appendChild(r),m=m._reactRootContainer,m!=null||c.onclick!==null||(c.onclick=Va));else if(x!==4&&(x===27&&or(r.type)&&(m=r.stateNode,c=null),r=r.child,r!==null))for(xm(r,c,m),r=r.sibling;r!==null;)xm(r,c,m),r=r.sibling}function Vd(r,c,m){var x=r.tag;if(x===5||x===6)r=r.stateNode,c?m.insertBefore(r,c):m.appendChild(r);else if(x!==4&&(x===27&&or(r.type)&&(m=r.stateNode),r=r.child,r!==null))for(Vd(r,c,m),r=r.sibling;r!==null;)Vd(r,c,m),r=r.sibling}function eb(r){var c=r.stateNode,m=r.memoizedProps;try{for(var x=r.type,S=c.attributes;S.length;)c.removeAttributeNode(S[0]);la(c,x,m),c[j]=r,c[w]=m}catch(E){ns(r,r.return,E)}}var pi=!1,zs=!1,ym=!1,tb=typeof WeakSet=="function"?WeakSet:Set,ea=null;function DE(r,c){if(r=r.containerInfo,Bm=du,r=fx(r),uf(r)){if("selectionStart"in r)var m={start:r.selectionStart,end:r.selectionEnd};else e:{m=(m=r.ownerDocument)&&m.defaultView||window;var x=m.getSelection&&m.getSelection();if(x&&x.rangeCount!==0){m=x.anchorNode;var S=x.anchorOffset,E=x.focusNode;x=x.focusOffset;try{m.nodeType,E.nodeType}catch{m=null;break e}var U=0,Q=-1,de=-1,je=0,Oe=0,$e=r,Ae=null;t:for(;;){for(var Re;$e!==m||S!==0&&$e.nodeType!==3||(Q=U+S),$e!==E||x!==0&&$e.nodeType!==3||(de=U+x),$e.nodeType===3&&(U+=$e.nodeValue.length),(Re=$e.firstChild)!==null;)Ae=$e,$e=Re;for(;;){if($e===r)break t;if(Ae===m&&++je===S&&(Q=U),Ae===E&&++Oe===x&&(de=U),(Re=$e.nextSibling)!==null)break;$e=Ae,Ae=$e.parentNode}$e=Re}m=Q===-1||de===-1?null:{start:Q,end:de}}else m=null}m=m||{start:0,end:0}}else m=null;for(Um={focusedElem:r,selectionRange:m},du=!1,ea=c;ea!==null;)if(c=ea,r=c.child,(c.subtreeFlags&1028)!==0&&r!==null)r.return=c,ea=r;else for(;ea!==null;){switch(c=ea,E=c.alternate,r=c.flags,c.tag){case 0:if((r&4)!==0&&(r=c.updateQueue,r=r!==null?r.events:null,r!==null))for(m=0;m<r.length;m++)S=r[m],S.ref.impl=S.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&E!==null){r=void 0,m=c,S=E.memoizedProps,E=E.memoizedState,x=m.stateNode;try{var st=Xr(m.type,S);r=x.getSnapshotBeforeUpdate(st,E),x.__reactInternalSnapshotBeforeUpdate=r}catch(pt){ns(m,m.return,pt)}}break;case 3:if((r&1024)!==0){if(r=c.stateNode.containerInfo,m=r.nodeType,m===9)Vm(r);else if(m===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":Vm(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(n(163))}if(r=c.sibling,r!==null){r.return=c.return,ea=r;break}ea=c.return}}function sb(r,c,m){var x=m.flags;switch(m.tag){case 0:case 11:case 15:yi(r,m),x&4&&rc(5,m);break;case 1:if(yi(r,m),x&4)if(r=m.stateNode,c===null)try{r.componentDidMount()}catch(U){ns(m,m.return,U)}else{var S=Xr(m.type,c.memoizedProps);c=c.memoizedState;try{r.componentDidUpdate(S,c,r.__reactInternalSnapshotBeforeUpdate)}catch(U){ns(m,m.return,U)}}x&64&&Qy(m),x&512&&lc(m,m.return);break;case 3:if(yi(r,m),x&64&&(r=m.updateQueue,r!==null)){if(c=null,m.child!==null)switch(m.child.tag){case 27:case 5:c=m.child.stateNode;break;case 1:c=m.child.stateNode}try{Ux(r,c)}catch(U){ns(m,m.return,U)}}break;case 27:c===null&&x&4&&eb(m);case 26:case 5:yi(r,m),c===null&&x&4&&Jy(m),x&512&&lc(m,m.return);break;case 12:yi(r,m);break;case 31:yi(r,m),x&4&&ib(r,m);break;case 13:yi(r,m),x&4&&rb(r,m),x&64&&(r=m.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(m=GE.bind(null,m),o2(r,m))));break;case 22:if(x=m.memoizedState!==null||pi,!x){c=c!==null&&c.memoizedState!==null||zs,S=pi;var E=zs;pi=x,(zs=c)&&!E?bi(r,m,(m.subtreeFlags&8772)!==0):yi(r,m),pi=S,zs=E}break;case 30:break;default:yi(r,m)}}function ab(r){var c=r.alternate;c!==null&&(r.alternate=null,ab(c)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(c=r.stateNode,c!==null&&le(c)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var ws=null,ka=!1;function xi(r,c,m){for(m=m.child;m!==null;)nb(r,c,m),m=m.sibling}function nb(r,c,m){if(Ps&&typeof Ps.onCommitFiberUnmount=="function")try{Ps.onCommitFiberUnmount(on,m)}catch{}switch(m.tag){case 26:zs||Kn(m,c),xi(r,c,m),m.memoizedState?m.memoizedState.count--:m.stateNode&&(m=m.stateNode,m.parentNode.removeChild(m));break;case 27:zs||Kn(m,c);var x=ws,S=ka;or(m.type)&&(ws=m.stateNode,ka=!1),xi(r,c,m),pc(m.stateNode),ws=x,ka=S;break;case 5:zs||Kn(m,c);case 6:if(x=ws,S=ka,ws=null,xi(r,c,m),ws=x,ka=S,ws!==null)if(ka)try{(ws.nodeType===9?ws.body:ws.nodeName==="HTML"?ws.ownerDocument.body:ws).removeChild(m.stateNode)}catch(E){ns(m,c,E)}else try{ws.removeChild(m.stateNode)}catch(E){ns(m,c,E)}break;case 18:ws!==null&&(ka?(r=ws,Qb(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,m.stateNode),eo(r)):Qb(ws,m.stateNode));break;case 4:x=ws,S=ka,ws=m.stateNode.containerInfo,ka=!0,xi(r,c,m),ws=x,ka=S;break;case 0:case 11:case 14:case 15:tr(2,m,c),zs||tr(4,m,c),xi(r,c,m);break;case 1:zs||(Kn(m,c),x=m.stateNode,typeof x.componentWillUnmount=="function"&&Xy(m,c,x)),xi(r,c,m);break;case 21:xi(r,c,m);break;case 22:zs=(x=zs)||m.memoizedState!==null,xi(r,c,m),zs=x;break;default:xi(r,c,m)}}function ib(r,c){if(c.memoizedState===null&&(r=c.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{eo(r)}catch(m){ns(c,c.return,m)}}}function rb(r,c){if(c.memoizedState===null&&(r=c.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{eo(r)}catch(m){ns(c,c.return,m)}}function ME(r){switch(r.tag){case 31:case 13:case 19:var c=r.stateNode;return c===null&&(c=r.stateNode=new tb),c;case 22:return r=r.stateNode,c=r._retryCache,c===null&&(c=r._retryCache=new tb),c;default:throw Error(n(435,r.tag))}}function qd(r,c){var m=ME(r);c.forEach(function(x){if(!m.has(x)){m.add(x);var S=VE.bind(null,r,x);x.then(S,S)}})}function Ra(r,c){var m=c.deletions;if(m!==null)for(var x=0;x<m.length;x++){var S=m[x],E=r,U=c,Q=U;e:for(;Q!==null;){switch(Q.tag){case 27:if(or(Q.type)){ws=Q.stateNode,ka=!1;break e}break;case 5:ws=Q.stateNode,ka=!1;break e;case 3:case 4:ws=Q.stateNode.containerInfo,ka=!0;break e}Q=Q.return}if(ws===null)throw Error(n(160));nb(E,U,S),ws=null,ka=!1,E=S.alternate,E!==null&&(E.return=null),S.return=null}if(c.subtreeFlags&13886)for(c=c.child;c!==null;)lb(c,r),c=c.sibling}var Ln=null;function lb(r,c){var m=r.alternate,x=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:Ra(c,r),La(r),x&4&&(tr(3,r,r.return),rc(3,r),tr(5,r,r.return));break;case 1:Ra(c,r),La(r),x&512&&(zs||m===null||Kn(m,m.return)),x&64&&pi&&(r=r.updateQueue,r!==null&&(x=r.callbacks,x!==null&&(m=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=m===null?x:m.concat(x))));break;case 26:var S=Ln;if(Ra(c,r),La(r),x&512&&(zs||m===null||Kn(m,m.return)),x&4){var E=m!==null?m.memoizedState:null;if(x=r.memoizedState,m===null)if(x===null)if(r.stateNode===null){e:{x=r.type,m=r.memoizedProps,S=S.ownerDocument||S;t:switch(x){case"title":E=S.getElementsByTagName("title")[0],(!E||E[se]||E[j]||E.namespaceURI==="http://www.w3.org/2000/svg"||E.hasAttribute("itemprop"))&&(E=S.createElement(x),S.head.insertBefore(E,S.querySelector("head > title"))),la(E,x,m),E[j]=r,Pe(E),x=E;break e;case"link":var U=lv("link","href",S).get(x+(m.href||""));if(U){for(var Q=0;Q<U.length;Q++)if(E=U[Q],E.getAttribute("href")===(m.href==null||m.href===""?null:m.href)&&E.getAttribute("rel")===(m.rel==null?null:m.rel)&&E.getAttribute("title")===(m.title==null?null:m.title)&&E.getAttribute("crossorigin")===(m.crossOrigin==null?null:m.crossOrigin)){U.splice(Q,1);break t}}E=S.createElement(x),la(E,x,m),S.head.appendChild(E);break;case"meta":if(U=lv("meta","content",S).get(x+(m.content||""))){for(Q=0;Q<U.length;Q++)if(E=U[Q],E.getAttribute("content")===(m.content==null?null:""+m.content)&&E.getAttribute("name")===(m.name==null?null:m.name)&&E.getAttribute("property")===(m.property==null?null:m.property)&&E.getAttribute("http-equiv")===(m.httpEquiv==null?null:m.httpEquiv)&&E.getAttribute("charset")===(m.charSet==null?null:m.charSet)){U.splice(Q,1);break t}}E=S.createElement(x),la(E,x,m),S.head.appendChild(E);break;default:throw Error(n(468,x))}E[j]=r,Pe(E),x=E}r.stateNode=x}else ov(S,r.type,r.stateNode);else r.stateNode=rv(S,x,r.memoizedProps);else E!==x?(E===null?m.stateNode!==null&&(m=m.stateNode,m.parentNode.removeChild(m)):E.count--,x===null?ov(S,r.type,r.stateNode):rv(S,x,r.memoizedProps)):x===null&&r.stateNode!==null&&gm(r,r.memoizedProps,m.memoizedProps)}break;case 27:Ra(c,r),La(r),x&512&&(zs||m===null||Kn(m,m.return)),m!==null&&x&4&&gm(r,r.memoizedProps,m.memoizedProps);break;case 5:if(Ra(c,r),La(r),x&512&&(zs||m===null||Kn(m,m.return)),r.flags&32){S=r.stateNode;try{fa(S,"")}catch(st){ns(r,r.return,st)}}x&4&&r.stateNode!=null&&(S=r.memoizedProps,gm(r,S,m!==null?m.memoizedProps:S)),x&1024&&(ym=!0);break;case 6:if(Ra(c,r),La(r),x&4){if(r.stateNode===null)throw Error(n(162));x=r.memoizedProps,m=r.stateNode;try{m.nodeValue=x}catch(st){ns(r,r.return,st)}}break;case 3:if(ru=null,S=Ln,Ln=nu(c.containerInfo),Ra(c,r),Ln=S,La(r),x&4&&m!==null&&m.memoizedState.isDehydrated)try{eo(c.containerInfo)}catch(st){ns(r,r.return,st)}ym&&(ym=!1,ob(r));break;case 4:x=Ln,Ln=nu(r.stateNode.containerInfo),Ra(c,r),La(r),Ln=x;break;case 12:Ra(c,r),La(r);break;case 31:Ra(c,r),La(r),x&4&&(x=r.updateQueue,x!==null&&(r.updateQueue=null,qd(r,x)));break;case 13:Ra(c,r),La(r),r.child.flags&8192&&r.memoizedState!==null!=(m!==null&&m.memoizedState!==null)&&(Hd=ts()),x&4&&(x=r.updateQueue,x!==null&&(r.updateQueue=null,qd(r,x)));break;case 22:S=r.memoizedState!==null;var de=m!==null&&m.memoizedState!==null,je=pi,Oe=zs;if(pi=je||S,zs=Oe||de,Ra(c,r),zs=Oe,pi=je,La(r),x&8192)e:for(c=r.stateNode,c._visibility=S?c._visibility&-2:c._visibility|1,S&&(m===null||de||pi||zs||Jr(r)),m=null,c=r;;){if(c.tag===5||c.tag===26){if(m===null){de=m=c;try{if(E=de.stateNode,S)U=E.style,typeof U.setProperty=="function"?U.setProperty("display","none","important"):U.display="none";else{Q=de.stateNode;var $e=de.memoizedProps.style,Ae=$e!=null&&$e.hasOwnProperty("display")?$e.display:null;Q.style.display=Ae==null||typeof Ae=="boolean"?"":(""+Ae).trim()}}catch(st){ns(de,de.return,st)}}}else if(c.tag===6){if(m===null){de=c;try{de.stateNode.nodeValue=S?"":de.memoizedProps}catch(st){ns(de,de.return,st)}}}else if(c.tag===18){if(m===null){de=c;try{var Re=de.stateNode;S?Xb(Re,!0):Xb(de.stateNode,!1)}catch(st){ns(de,de.return,st)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===r)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===r)break e;for(;c.sibling===null;){if(c.return===null||c.return===r)break e;m===c&&(m=null),c=c.return}m===c&&(m=null),c.sibling.return=c.return,c=c.sibling}x&4&&(x=r.updateQueue,x!==null&&(m=x.retryQueue,m!==null&&(x.retryQueue=null,qd(r,m))));break;case 19:Ra(c,r),La(r),x&4&&(x=r.updateQueue,x!==null&&(r.updateQueue=null,qd(r,x)));break;case 30:break;case 21:break;default:Ra(c,r),La(r)}}function La(r){var c=r.flags;if(c&2){try{for(var m,x=r.return;x!==null;){if(Zy(x)){m=x;break}x=x.return}if(m==null)throw Error(n(160));switch(m.tag){case 27:var S=m.stateNode,E=pm(r);Vd(r,E,S);break;case 5:var U=m.stateNode;m.flags&32&&(fa(U,""),m.flags&=-33);var Q=pm(r);Vd(r,Q,U);break;case 3:case 4:var de=m.stateNode.containerInfo,je=pm(r);xm(r,je,de);break;default:throw Error(n(161))}}catch(Oe){ns(r,r.return,Oe)}r.flags&=-3}c&4096&&(r.flags&=-4097)}function ob(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var c=r;ob(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),r=r.sibling}}function yi(r,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)sb(r,c.alternate,c),c=c.sibling}function Jr(r){for(r=r.child;r!==null;){var c=r;switch(c.tag){case 0:case 11:case 14:case 15:tr(4,c,c.return),Jr(c);break;case 1:Kn(c,c.return);var m=c.stateNode;typeof m.componentWillUnmount=="function"&&Xy(c,c.return,m),Jr(c);break;case 27:pc(c.stateNode);case 26:case 5:Kn(c,c.return),Jr(c);break;case 22:c.memoizedState===null&&Jr(c);break;case 30:Jr(c);break;default:Jr(c)}r=r.sibling}}function bi(r,c,m){for(m=m&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var x=c.alternate,S=r,E=c,U=E.flags;switch(E.tag){case 0:case 11:case 15:bi(S,E,m),rc(4,E);break;case 1:if(bi(S,E,m),x=E,S=x.stateNode,typeof S.componentDidMount=="function")try{S.componentDidMount()}catch(je){ns(x,x.return,je)}if(x=E,S=x.updateQueue,S!==null){var Q=x.stateNode;try{var de=S.shared.hiddenCallbacks;if(de!==null)for(S.shared.hiddenCallbacks=null,S=0;S<de.length;S++)Bx(de[S],Q)}catch(je){ns(x,x.return,je)}}m&&U&64&&Qy(E),lc(E,E.return);break;case 27:eb(E);case 26:case 5:bi(S,E,m),m&&x===null&&U&4&&Jy(E),lc(E,E.return);break;case 12:bi(S,E,m);break;case 31:bi(S,E,m),m&&U&4&&ib(S,E);break;case 13:bi(S,E,m),m&&U&4&&rb(S,E);break;case 22:E.memoizedState===null&&bi(S,E,m),lc(E,E.return);break;case 30:break;default:bi(S,E,m)}c=c.sibling}}function bm(r,c){var m=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(m=r.memoizedState.cachePool.pool),r=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(r=c.memoizedState.cachePool.pool),r!==m&&(r!=null&&r.refCount++,m!=null&&zo(m))}function vm(r,c){r=null,c.alternate!==null&&(r=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==r&&(c.refCount++,r!=null&&zo(r))}function Dn(r,c,m,x){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)cb(r,c,m,x),c=c.sibling}function cb(r,c,m,x){var S=c.flags;switch(c.tag){case 0:case 11:case 15:Dn(r,c,m,x),S&2048&&rc(9,c);break;case 1:Dn(r,c,m,x);break;case 3:Dn(r,c,m,x),S&2048&&(r=null,c.alternate!==null&&(r=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==r&&(c.refCount++,r!=null&&zo(r)));break;case 12:if(S&2048){Dn(r,c,m,x),r=c.stateNode;try{var E=c.memoizedProps,U=E.id,Q=E.onPostCommit;typeof Q=="function"&&Q(U,c.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(de){ns(c,c.return,de)}}else Dn(r,c,m,x);break;case 31:Dn(r,c,m,x);break;case 13:Dn(r,c,m,x);break;case 23:break;case 22:E=c.stateNode,U=c.alternate,c.memoizedState!==null?E._visibility&2?Dn(r,c,m,x):oc(r,c):E._visibility&2?Dn(r,c,m,x):(E._visibility|=2,Vl(r,c,m,x,(c.subtreeFlags&10256)!==0||!1)),S&2048&&bm(U,c);break;case 24:Dn(r,c,m,x),S&2048&&vm(c.alternate,c);break;default:Dn(r,c,m,x)}}function Vl(r,c,m,x,S){for(S=S&&((c.subtreeFlags&10256)!==0||!1),c=c.child;c!==null;){var E=r,U=c,Q=m,de=x,je=U.flags;switch(U.tag){case 0:case 11:case 15:Vl(E,U,Q,de,S),rc(8,U);break;case 23:break;case 22:var Oe=U.stateNode;U.memoizedState!==null?Oe._visibility&2?Vl(E,U,Q,de,S):oc(E,U):(Oe._visibility|=2,Vl(E,U,Q,de,S)),S&&je&2048&&bm(U.alternate,U);break;case 24:Vl(E,U,Q,de,S),S&&je&2048&&vm(U.alternate,U);break;default:Vl(E,U,Q,de,S)}c=c.sibling}}function oc(r,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var m=r,x=c,S=x.flags;switch(x.tag){case 22:oc(m,x),S&2048&&bm(x.alternate,x);break;case 24:oc(m,x),S&2048&&vm(x.alternate,x);break;default:oc(m,x)}c=c.sibling}}var cc=8192;function ql(r,c,m){if(r.subtreeFlags&cc)for(r=r.child;r!==null;)db(r,c,m),r=r.sibling}function db(r,c,m){switch(r.tag){case 26:ql(r,c,m),r.flags&cc&&r.memoizedState!==null&&v2(m,Ln,r.memoizedState,r.memoizedProps);break;case 5:ql(r,c,m);break;case 3:case 4:var x=Ln;Ln=nu(r.stateNode.containerInfo),ql(r,c,m),Ln=x;break;case 22:r.memoizedState===null&&(x=r.alternate,x!==null&&x.memoizedState!==null?(x=cc,cc=16777216,ql(r,c,m),cc=x):ql(r,c,m));break;default:ql(r,c,m)}}function ub(r){var c=r.alternate;if(c!==null&&(r=c.child,r!==null)){c.child=null;do c=r.sibling,r.sibling=null,r=c;while(r!==null)}}function dc(r){var c=r.deletions;if((r.flags&16)!==0){if(c!==null)for(var m=0;m<c.length;m++){var x=c[m];ea=x,fb(x,r)}ub(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)hb(r),r=r.sibling}function hb(r){switch(r.tag){case 0:case 11:case 15:dc(r),r.flags&2048&&tr(9,r,r.return);break;case 3:dc(r);break;case 12:dc(r);break;case 22:var c=r.stateNode;r.memoizedState!==null&&c._visibility&2&&(r.return===null||r.return.tag!==13)?(c._visibility&=-3,Kd(r)):dc(r);break;default:dc(r)}}function Kd(r){var c=r.deletions;if((r.flags&16)!==0){if(c!==null)for(var m=0;m<c.length;m++){var x=c[m];ea=x,fb(x,r)}ub(r)}for(r=r.child;r!==null;){switch(c=r,c.tag){case 0:case 11:case 15:tr(8,c,c.return),Kd(c);break;case 22:m=c.stateNode,m._visibility&2&&(m._visibility&=-3,Kd(c));break;default:Kd(c)}r=r.sibling}}function fb(r,c){for(;ea!==null;){var m=ea;switch(m.tag){case 0:case 11:case 15:tr(8,m,c);break;case 23:case 22:if(m.memoizedState!==null&&m.memoizedState.cachePool!==null){var x=m.memoizedState.cachePool.pool;x!=null&&x.refCount++}break;case 24:zo(m.memoizedState.cache)}if(x=m.child,x!==null)x.return=m,ea=x;else e:for(m=r;ea!==null;){x=ea;var S=x.sibling,E=x.return;if(ab(x),x===m){ea=null;break e}if(S!==null){S.return=E,ea=S;break e}ea=E}}}var IE={getCacheForType:function(r){var c=ia(qs),m=c.data.get(r);return m===void 0&&(m=r(),c.data.set(r,m)),m},cacheSignal:function(){return ia(qs).controller.signal}},PE=typeof WeakMap=="function"?WeakMap:Map,es=0,us=null,Ot=null,Ut=0,as=0,Ya=null,sr=!1,Kl=!1,_m=!1,vi=0,Ds=0,ar=0,Zr=0,Nm=0,Wa=0,Hl=0,uc=null,Da=null,wm=!1,Hd=0,mb=0,zd=1/0,Yd=null,nr=null,Ws=0,ir=null,zl=null,_i=0,Sm=0,jm=null,gb=null,hc=0,Em=null;function Qa(){return(es&2)!==0&&Ut!==0?Ut&-Ut:X.T!==null?Lm():Lr()}function pb(){if(Wa===0)if((Ut&536870912)===0||qt){var r=xe;xe<<=1,(xe&3932160)===0&&(xe=262144),Wa=r}else Wa=536870912;return r=Ha.current,r!==null&&(r.flags|=32),Wa}function Ma(r,c,m){(r===us&&(as===2||as===9)||r.cancelPendingCommit!==null)&&(Yl(r,0),rr(r,Ut,Wa,!1)),ba(r,m),((es&2)===0||r!==us)&&(r===us&&((es&2)===0&&(Zr|=m),Ds===4&&rr(r,Ut,Wa,!1)),Hn(r))}function xb(r,c,m){if((es&6)!==0)throw Error(n(327));var x=!m&&(c&127)===0&&(c&r.expiredLanes)===0||ks(r,c),S=x?BE(r,c):Am(r,c,!0),E=x;do{if(S===0){Kl&&!x&&rr(r,c,0,!1);break}else{if(m=r.current.alternate,E&&!OE(m)){S=Am(r,c,!1),E=!1;continue}if(S===2){if(E=c,r.errorRecoveryDisabledLanes&E)var U=0;else U=r.pendingLanes&-536870913,U=U!==0?U:U&536870912?536870912:0;if(U!==0){c=U;e:{var Q=r;S=uc;var de=Q.current.memoizedState.isDehydrated;if(de&&(Yl(Q,U).flags|=256),U=Am(Q,U,!1),U!==2){if(_m&&!de){Q.errorRecoveryDisabledLanes|=E,Zr|=E,S=4;break e}E=Da,Da=S,E!==null&&(Da===null?Da=E:Da.push.apply(Da,E))}S=U}if(E=!1,S!==2)continue}}if(S===1){Yl(r,0),rr(r,c,0,!0);break}e:{switch(x=r,E=S,E){case 0:case 1:throw Error(n(345));case 4:if((c&4194048)!==c)break;case 6:rr(x,c,Wa,!sr);break e;case 2:Da=null;break;case 3:case 5:break;default:throw Error(n(329))}if((c&62914560)===c&&(S=Hd+300-ts(),10<S)){if(rr(x,c,Wa,!sr),Jt(x,0,!0)!==0)break e;_i=c,x.timeoutHandle=Yb(yb.bind(null,x,m,Da,Yd,wm,c,Wa,Zr,Hl,sr,E,"Throttled",-0,0),S);break e}yb(x,m,Da,Yd,wm,c,Wa,Zr,Hl,sr,E,null,-0,0)}}break}while(!0);Hn(r)}function yb(r,c,m,x,S,E,U,Q,de,je,Oe,$e,Ae,Re){if(r.timeoutHandle=-1,$e=c.subtreeFlags,$e&8192||($e&16785408)===16785408){$e={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Va},db(c,E,$e);var st=(E&62914560)===E?Hd-ts():(E&4194048)===E?mb-ts():0;if(st=_2($e,st),st!==null){_i=E,r.cancelPendingCommit=st(Eb.bind(null,r,c,E,m,x,S,U,Q,de,Oe,$e,null,Ae,Re)),rr(r,E,U,!je);return}}Eb(r,c,E,m,x,S,U,Q,de)}function OE(r){for(var c=r;;){var m=c.tag;if((m===0||m===11||m===15)&&c.flags&16384&&(m=c.updateQueue,m!==null&&(m=m.stores,m!==null)))for(var x=0;x<m.length;x++){var S=m[x],E=S.getSnapshot;S=S.value;try{if(!qa(E(),S))return!1}catch{return!1}}if(m=c.child,c.subtreeFlags&16384&&m!==null)m.return=c,c=m;else{if(c===r)break;for(;c.sibling===null;){if(c.return===null||c.return===r)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function rr(r,c,m,x){c&=~Nm,c&=~Zr,r.suspendedLanes|=c,r.pingedLanes&=~c,x&&(r.warmLanes|=c),x=r.expirationTimes;for(var S=c;0<S;){var E=31-gt(S),U=1<<E;x[E]=-1,S&=~U}m!==0&&qi(r,m,c)}function Wd(){return(es&6)===0?(fc(0),!1):!0}function Tm(){if(Ot!==null){if(as===0)var r=Ot.return;else r=Ot,di=qr=null,Vf(r),Fl=null,Wo=0,r=Ot;for(;r!==null;)Wy(r.alternate,r),r=r.return;Ot=null}}function Yl(r,c){var m=r.timeoutHandle;m!==-1&&(r.timeoutHandle=-1,a2(m)),m=r.cancelPendingCommit,m!==null&&(r.cancelPendingCommit=null,m()),_i=0,Tm(),us=r,Ot=m=oi(r.current,null),Ut=c,as=0,Ya=null,sr=!1,Kl=ks(r,c),_m=!1,Hl=Wa=Nm=Zr=ar=Ds=0,Da=uc=null,wm=!1,(c&8)!==0&&(c|=c&32);var x=r.entangledLanes;if(x!==0)for(r=r.entanglements,x&=c;0<x;){var S=31-gt(x),E=1<<S;c|=r[S],x&=~E}return vi=c,pd(),m}function bb(r,c){At=null,X.H=ac,c===Ol||c===Sd?(c=Ix(),as=3):c===Rf?(c=Ix(),as=4):as=c===im?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,Ya=c,Ot===null&&(Ds=1,Fd(r,hn(c,r.current)))}function vb(){var r=Ha.current;return r===null?!0:(Ut&4194048)===Ut?pn===null:(Ut&62914560)===Ut||(Ut&536870912)!==0?r===pn:!1}function _b(){var r=X.H;return X.H=ac,r===null?ac:r}function Nb(){var r=X.A;return X.A=IE,r}function Qd(){Ds=4,sr||(Ut&4194048)!==Ut&&Ha.current!==null||(Kl=!0),(ar&134217727)===0&&(Zr&134217727)===0||us===null||rr(us,Ut,Wa,!1)}function Am(r,c,m){var x=es;es|=2;var S=_b(),E=Nb();(us!==r||Ut!==c)&&(Yd=null,Yl(r,c)),c=!1;var U=Ds;e:do try{if(as!==0&&Ot!==null){var Q=Ot,de=Ya;switch(as){case 8:Tm(),U=6;break e;case 3:case 2:case 9:case 6:Ha.current===null&&(c=!0);var je=as;if(as=0,Ya=null,Wl(r,Q,de,je),m&&Kl){U=0;break e}break;default:je=as,as=0,Ya=null,Wl(r,Q,de,je)}}FE(),U=Ds;break}catch(Oe){bb(r,Oe)}while(!0);return c&&r.shellSuspendCounter++,di=qr=null,es=x,X.H=S,X.A=E,Ot===null&&(us=null,Ut=0,pd()),U}function FE(){for(;Ot!==null;)wb(Ot)}function BE(r,c){var m=es;es|=2;var x=_b(),S=Nb();us!==r||Ut!==c?(Yd=null,zd=ts()+500,Yl(r,c)):Kl=ks(r,c);e:do try{if(as!==0&&Ot!==null){c=Ot;var E=Ya;t:switch(as){case 1:as=0,Ya=null,Wl(r,c,E,1);break;case 2:case 9:if(Dx(E)){as=0,Ya=null,Sb(c);break}c=function(){as!==2&&as!==9||us!==r||(as=7),Hn(r)},E.then(c,c);break e;case 3:as=7;break e;case 4:as=5;break e;case 7:Dx(E)?(as=0,Ya=null,Sb(c)):(as=0,Ya=null,Wl(r,c,E,7));break;case 5:var U=null;switch(Ot.tag){case 26:U=Ot.memoizedState;case 5:case 27:var Q=Ot;if(U?cv(U):Q.stateNode.complete){as=0,Ya=null;var de=Q.sibling;if(de!==null)Ot=de;else{var je=Q.return;je!==null?(Ot=je,Xd(je)):Ot=null}break t}}as=0,Ya=null,Wl(r,c,E,5);break;case 6:as=0,Ya=null,Wl(r,c,E,6);break;case 8:Tm(),Ds=6;break e;default:throw Error(n(462))}}UE();break}catch(Oe){bb(r,Oe)}while(!0);return di=qr=null,X.H=x,X.A=S,es=m,Ot!==null?0:(us=null,Ut=0,pd(),Ds)}function UE(){for(;Ot!==null&&!Cs();)wb(Ot)}function wb(r){var c=zy(r.alternate,r,vi);r.memoizedProps=r.pendingProps,c===null?Xd(r):Ot=c}function Sb(r){var c=r,m=c.alternate;switch(c.tag){case 15:case 0:c=$y(m,c,c.pendingProps,c.type,void 0,Ut);break;case 11:c=$y(m,c,c.pendingProps,c.type.render,c.ref,Ut);break;case 5:Vf(c);default:Wy(m,c),c=Ot=Nx(c,vi),c=zy(m,c,vi)}r.memoizedProps=r.pendingProps,c===null?Xd(r):Ot=c}function Wl(r,c,m,x){di=qr=null,Vf(c),Fl=null,Wo=0;var S=c.return;try{if(AE(r,S,c,m,Ut)){Ds=1,Fd(r,hn(m,r.current)),Ot=null;return}}catch(E){if(S!==null)throw Ot=S,E;Ds=1,Fd(r,hn(m,r.current)),Ot=null;return}c.flags&32768?(qt||x===1?r=!0:Kl||(Ut&536870912)!==0?r=!1:(sr=r=!0,(x===2||x===9||x===3||x===6)&&(x=Ha.current,x!==null&&x.tag===13&&(x.flags|=16384))),jb(c,r)):Xd(c)}function Xd(r){var c=r;do{if((c.flags&32768)!==0){jb(c,sr);return}r=c.return;var m=RE(c.alternate,c,vi);if(m!==null){Ot=m;return}if(c=c.sibling,c!==null){Ot=c;return}Ot=c=r}while(c!==null);Ds===0&&(Ds=5)}function jb(r,c){do{var m=LE(r.alternate,r);if(m!==null){m.flags&=32767,Ot=m;return}if(m=r.return,m!==null&&(m.flags|=32768,m.subtreeFlags=0,m.deletions=null),!c&&(r=r.sibling,r!==null)){Ot=r;return}Ot=r=m}while(r!==null);Ds=6,Ot=null}function Eb(r,c,m,x,S,E,U,Q,de){r.cancelPendingCommit=null;do Jd();while(Ws!==0);if((es&6)!==0)throw Error(n(327));if(c!==null){if(c===r.current)throw Error(n(177));if(E=c.lanes|c.childLanes,E|=pf,Ta(r,m,E,U,Q,de),r===us&&(Ot=us=null,Ut=0),zl=c,ir=r,_i=m,Sm=E,jm=S,gb=x,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,qE(ya,function(){return Rb(),null})):(r.callbackNode=null,r.callbackPriority=0),x=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||x){x=X.T,X.T=null,S=ae.p,ae.p=2,U=es,es|=4;try{DE(r,c,m)}finally{es=U,ae.p=S,X.T=x}}Ws=1,Tb(),Ab(),Cb()}}function Tb(){if(Ws===1){Ws=0;var r=ir,c=zl,m=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||m){m=X.T,X.T=null;var x=ae.p;ae.p=2;var S=es;es|=4;try{lb(c,r);var E=Um,U=fx(r.containerInfo),Q=E.focusedElem,de=E.selectionRange;if(U!==Q&&Q&&Q.ownerDocument&&hx(Q.ownerDocument.documentElement,Q)){if(de!==null&&uf(Q)){var je=de.start,Oe=de.end;if(Oe===void 0&&(Oe=je),"selectionStart"in Q)Q.selectionStart=je,Q.selectionEnd=Math.min(Oe,Q.value.length);else{var $e=Q.ownerDocument||document,Ae=$e&&$e.defaultView||window;if(Ae.getSelection){var Re=Ae.getSelection(),st=Q.textContent.length,pt=Math.min(de.start,st),cs=de.end===void 0?pt:Math.min(de.end,st);!Re.extend&&pt>cs&&(U=cs,cs=pt,pt=U);var ve=ux(Q,pt),ge=ux(Q,cs);if(ve&&ge&&(Re.rangeCount!==1||Re.anchorNode!==ve.node||Re.anchorOffset!==ve.offset||Re.focusNode!==ge.node||Re.focusOffset!==ge.offset)){var Se=$e.createRange();Se.setStart(ve.node,ve.offset),Re.removeAllRanges(),pt>cs?(Re.addRange(Se),Re.extend(ge.node,ge.offset)):(Se.setEnd(ge.node,ge.offset),Re.addRange(Se))}}}}for($e=[],Re=Q;Re=Re.parentNode;)Re.nodeType===1&&$e.push({element:Re,left:Re.scrollLeft,top:Re.scrollTop});for(typeof Q.focus=="function"&&Q.focus(),Q=0;Q<$e.length;Q++){var Ue=$e[Q];Ue.element.scrollLeft=Ue.left,Ue.element.scrollTop=Ue.top}}du=!!Bm,Um=Bm=null}finally{es=S,ae.p=x,X.T=m}}r.current=c,Ws=2}}function Ab(){if(Ws===2){Ws=0;var r=ir,c=zl,m=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||m){m=X.T,X.T=null;var x=ae.p;ae.p=2;var S=es;es|=4;try{sb(r,c.alternate,c)}finally{es=S,ae.p=x,X.T=m}}Ws=3}}function Cb(){if(Ws===4||Ws===3){Ws=0,Tn();var r=ir,c=zl,m=_i,x=gb;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?Ws=5:(Ws=0,zl=ir=null,kb(r,r.pendingLanes));var S=r.pendingLanes;if(S===0&&(nr=null),ys(m),c=c.stateNode,Ps&&typeof Ps.onCommitFiberRoot=="function")try{Ps.onCommitFiberRoot(on,c,void 0,(c.current.flags&128)===128)}catch{}if(x!==null){c=X.T,S=ae.p,ae.p=2,X.T=null;try{for(var E=r.onRecoverableError,U=0;U<x.length;U++){var Q=x[U];E(Q.value,{componentStack:Q.stack})}}finally{X.T=c,ae.p=S}}(_i&3)!==0&&Jd(),Hn(r),S=r.pendingLanes,(m&261930)!==0&&(S&42)!==0?r===Em?hc++:(hc=0,Em=r):hc=0,fc(0)}}function kb(r,c){(r.pooledCacheLanes&=c)===0&&(c=r.pooledCache,c!=null&&(r.pooledCache=null,zo(c)))}function Jd(){return Tb(),Ab(),Cb(),Rb()}function Rb(){if(Ws!==5)return!1;var r=ir,c=Sm;Sm=0;var m=ys(_i),x=X.T,S=ae.p;try{ae.p=32>m?32:m,X.T=null,m=jm,jm=null;var E=ir,U=_i;if(Ws=0,zl=ir=null,_i=0,(es&6)!==0)throw Error(n(331));var Q=es;if(es|=4,hb(E.current),cb(E,E.current,U,m),es=Q,fc(0,!1),Ps&&typeof Ps.onPostCommitFiberRoot=="function")try{Ps.onPostCommitFiberRoot(on,E)}catch{}return!0}finally{ae.p=S,X.T=x,kb(r,c)}}function Lb(r,c,m){c=hn(m,c),c=nm(r.stateNode,c,2),r=Ji(r,c,2),r!==null&&(ba(r,2),Hn(r))}function ns(r,c,m){if(r.tag===3)Lb(r,r,m);else for(;c!==null;){if(c.tag===3){Lb(c,r,m);break}else if(c.tag===1){var x=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(nr===null||!nr.has(x))){r=hn(m,r),m=Dy(2),x=Ji(c,m,2),x!==null&&(My(m,x,c,r),ba(x,2),Hn(x));break}}c=c.return}}function Cm(r,c,m){var x=r.pingCache;if(x===null){x=r.pingCache=new PE;var S=new Set;x.set(c,S)}else S=x.get(c),S===void 0&&(S=new Set,x.set(c,S));S.has(m)||(_m=!0,S.add(m),r=$E.bind(null,r,c,m),c.then(r,r))}function $E(r,c,m){var x=r.pingCache;x!==null&&x.delete(c),r.pingedLanes|=r.suspendedLanes&m,r.warmLanes&=~m,us===r&&(Ut&m)===m&&(Ds===4||Ds===3&&(Ut&62914560)===Ut&&300>ts()-Hd?(es&2)===0&&Yl(r,0):Nm|=m,Hl===Ut&&(Hl=0)),Hn(r)}function Db(r,c){c===0&&(c=Cn()),r=$r(r,c),r!==null&&(ba(r,c),Hn(r))}function GE(r){var c=r.memoizedState,m=0;c!==null&&(m=c.retryLane),Db(r,m)}function VE(r,c){var m=0;switch(r.tag){case 31:case 13:var x=r.stateNode,S=r.memoizedState;S!==null&&(m=S.retryLane);break;case 19:x=r.stateNode;break;case 22:x=r.stateNode._retryCache;break;default:throw Error(n(314))}x!==null&&x.delete(c),Db(r,m)}function qE(r,c){return Ht(r,c)}var Zd=null,Ql=null,km=!1,eu=!1,Rm=!1,lr=0;function Hn(r){r!==Ql&&r.next===null&&(Ql===null?Zd=Ql=r:Ql=Ql.next=r),eu=!0,km||(km=!0,HE())}function fc(r,c){if(!Rm&&eu){Rm=!0;do for(var m=!1,x=Zd;x!==null;){if(r!==0){var S=x.pendingLanes;if(S===0)var E=0;else{var U=x.suspendedLanes,Q=x.pingedLanes;E=(1<<31-gt(42|r)+1)-1,E&=S&~(U&~Q),E=E&201326741?E&201326741|1:E?E|2:0}E!==0&&(m=!0,Ob(x,E))}else E=Ut,E=Jt(x,x===us?E:0,x.cancelPendingCommit!==null||x.timeoutHandle!==-1),(E&3)===0||ks(x,E)||(m=!0,Ob(x,E));x=x.next}while(m);Rm=!1}}function KE(){Mb()}function Mb(){eu=km=!1;var r=0;lr!==0&&s2()&&(r=lr);for(var c=ts(),m=null,x=Zd;x!==null;){var S=x.next,E=Ib(x,c);E===0?(x.next=null,m===null?Zd=S:m.next=S,S===null&&(Ql=m)):(m=x,(r!==0||(E&3)!==0)&&(eu=!0)),x=S}Ws!==0&&Ws!==5||fc(r),lr!==0&&(lr=0)}function Ib(r,c){for(var m=r.suspendedLanes,x=r.pingedLanes,S=r.expirationTimes,E=r.pendingLanes&-62914561;0<E;){var U=31-gt(E),Q=1<<U,de=S[U];de===-1?((Q&m)===0||(Q&x)!==0)&&(S[U]=Ea(Q,c)):de<=c&&(r.expiredLanes|=Q),E&=~Q}if(c=us,m=Ut,m=Jt(r,r===c?m:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),x=r.callbackNode,m===0||r===c&&(as===2||as===9)||r.cancelPendingCommit!==null)return x!==null&&x!==null&&As(x),r.callbackNode=null,r.callbackPriority=0;if((m&3)===0||ks(r,m)){if(c=m&-m,c===r.callbackPriority)return c;switch(x!==null&&As(x),ys(m)){case 2:case 8:m=rn;break;case 32:m=ya;break;case 268435456:m=ln;break;default:m=ya}return x=Pb.bind(null,r),m=Ht(m,x),r.callbackPriority=c,r.callbackNode=m,c}return x!==null&&x!==null&&As(x),r.callbackPriority=2,r.callbackNode=null,2}function Pb(r,c){if(Ws!==0&&Ws!==5)return r.callbackNode=null,r.callbackPriority=0,null;var m=r.callbackNode;if(Jd()&&r.callbackNode!==m)return null;var x=Ut;return x=Jt(r,r===us?x:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),x===0?null:(xb(r,x,c),Ib(r,ts()),r.callbackNode!=null&&r.callbackNode===m?Pb.bind(null,r):null)}function Ob(r,c){if(Jd())return null;xb(r,c,!0)}function HE(){n2(function(){(es&6)!==0?Ht(ua,KE):Mb()})}function Lm(){if(lr===0){var r=Il;r===0&&(r=Vi,Vi<<=1,(Vi&261888)===0&&(Vi=256)),lr=r}return lr}function Fb(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:Ir(""+r)}function Bb(r,c){var m=c.ownerDocument.createElement("input");return m.name=c.name,m.value=c.value,r.id&&m.setAttribute("form",r.id),c.parentNode.insertBefore(m,c),r=new FormData(r),m.parentNode.removeChild(m),r}function zE(r,c,m,x,S){if(c==="submit"&&m&&m.stateNode===S){var E=Fb((S[w]||null).action),U=x.submitter;U&&(c=(c=U[w]||null)?Fb(c.formAction):U.getAttribute("formAction"),c!==null&&(E=c,U=null));var Q=new hd("action","action",null,x,S);r.push({event:Q,listeners:[{instance:null,listener:function(){if(x.defaultPrevented){if(lr!==0){var de=U?Bb(S,U):new FormData(S);Jf(m,{pending:!0,data:de,method:S.method,action:E},null,de)}}else typeof E=="function"&&(Q.preventDefault(),de=U?Bb(S,U):new FormData(S),Jf(m,{pending:!0,data:de,method:S.method,action:E},E,de))},currentTarget:S}]})}}for(var Dm=0;Dm<gf.length;Dm++){var Mm=gf[Dm],YE=Mm.toLowerCase(),WE=Mm[0].toUpperCase()+Mm.slice(1);Rn(YE,"on"+WE)}Rn(px,"onAnimationEnd"),Rn(xx,"onAnimationIteration"),Rn(yx,"onAnimationStart"),Rn("dblclick","onDoubleClick"),Rn("focusin","onFocus"),Rn("focusout","onBlur"),Rn(uE,"onTransitionRun"),Rn(hE,"onTransitionStart"),Rn(fE,"onTransitionCancel"),Rn(bx,"onTransitionEnd"),qe("onMouseEnter",["mouseout","mouseover"]),qe("onMouseLeave",["mouseout","mouseover"]),qe("onPointerEnter",["pointerout","pointerover"]),qe("onPointerLeave",["pointerout","pointerover"]),Ye("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ye("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ye("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ye("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ye("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ye("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var mc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),QE=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(mc));function Ub(r,c){c=(c&4)!==0;for(var m=0;m<r.length;m++){var x=r[m],S=x.event;x=x.listeners;e:{var E=void 0;if(c)for(var U=x.length-1;0<=U;U--){var Q=x[U],de=Q.instance,je=Q.currentTarget;if(Q=Q.listener,de!==E&&S.isPropagationStopped())break e;E=Q,S.currentTarget=je;try{E(S)}catch(Oe){gd(Oe)}S.currentTarget=null,E=de}else for(U=0;U<x.length;U++){if(Q=x[U],de=Q.instance,je=Q.currentTarget,Q=Q.listener,de!==E&&S.isPropagationStopped())break e;E=Q,S.currentTarget=je;try{E(S)}catch(Oe){gd(Oe)}S.currentTarget=null,E=de}}}}function Ft(r,c){var m=c[G];m===void 0&&(m=c[G]=new Set);var x=r+"__bubble";m.has(x)||($b(c,r,2,!1),m.add(x))}function Im(r,c,m){var x=0;c&&(x|=4),$b(m,r,x,c)}var tu="_reactListening"+Math.random().toString(36).slice(2);function Pm(r){if(!r[tu]){r[tu]=!0,De.forEach(function(m){m!=="selectionchange"&&(QE.has(m)||Im(m,!1,r),Im(m,!0,r))});var c=r.nodeType===9?r:r.ownerDocument;c===null||c[tu]||(c[tu]=!0,Im("selectionchange",!1,c))}}function $b(r,c,m,x){switch(pv(c)){case 2:var S=S2;break;case 8:S=j2;break;default:S=Xm}m=S.bind(null,c,m,r),S=void 0,!Oo||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(S=!0),x?S!==void 0?r.addEventListener(c,m,{capture:!0,passive:S}):r.addEventListener(c,m,!0):S!==void 0?r.addEventListener(c,m,{passive:S}):r.addEventListener(c,m,!1)}function Om(r,c,m,x,S){var E=x;if((c&1)===0&&(c&2)===0&&x!==null)e:for(;;){if(x===null)return;var U=x.tag;if(U===3||U===4){var Q=x.stateNode.containerInfo;if(Q===S)break;if(U===4)for(U=x.return;U!==null;){var de=U.tag;if((de===3||de===4)&&U.stateNode.containerInfo===S)return;U=U.return}for(;Q!==null;){if(U=he(Q),U===null)return;if(de=U.tag,de===5||de===6||de===26||de===27){x=E=U;continue e}Q=Q.parentNode}}x=x.return}Po(function(){var je=E,Oe=ri(m),$e=[];e:{var Ae=vx.get(r);if(Ae!==void 0){var Re=hd,st=r;switch(r){case"keypress":if(dd(m)===0)break e;case"keydown":case"keyup":Re=Vj;break;case"focusin":st="focus",Re=rf;break;case"focusout":st="blur",Re=rf;break;case"beforeblur":case"afterblur":Re=rf;break;case"click":if(m.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Re=Wp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Re=Rj;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Re=Hj;break;case px:case xx:case yx:Re=Mj;break;case bx:Re=Yj;break;case"scroll":case"scrollend":Re=Cj;break;case"wheel":Re=Qj;break;case"copy":case"cut":case"paste":Re=Pj;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Re=Xp;break;case"toggle":case"beforetoggle":Re=Jj}var pt=(c&4)!==0,cs=!pt&&(r==="scroll"||r==="scrollend"),ve=pt?Ae!==null?Ae+"Capture":null:Ae;pt=[];for(var ge=je,Se;ge!==null;){var Ue=ge;if(Se=Ue.stateNode,Ue=Ue.tag,Ue!==5&&Ue!==26&&Ue!==27||Se===null||ve===null||(Ue=li(ge,ve),Ue!=null&&pt.push(gc(ge,Ue,Se))),cs)break;ge=ge.return}0<pt.length&&(Ae=new Re(Ae,st,null,m,Oe),$e.push({event:Ae,listeners:pt}))}}if((c&7)===0){e:{if(Ae=r==="mouseover"||r==="pointerover",Re=r==="mouseout"||r==="pointerout",Ae&&m!==Pr&&(st=m.relatedTarget||m.fromElement)&&(he(st)||st[M]))break e;if((Re||Ae)&&(Ae=Oe.window===Oe?Oe:(Ae=Oe.ownerDocument)?Ae.defaultView||Ae.parentWindow:window,Re?(st=m.relatedTarget||m.toElement,Re=je,st=st?he(st):null,st!==null&&(cs=l(st),pt=st.tag,st!==cs||pt!==5&&pt!==27&&pt!==6)&&(st=null)):(Re=null,st=je),Re!==st)){if(pt=Wp,Ue="onMouseLeave",ve="onMouseEnter",ge="mouse",(r==="pointerout"||r==="pointerover")&&(pt=Xp,Ue="onPointerLeave",ve="onPointerEnter",ge="pointer"),cs=Re==null?Ae:me(Re),Se=st==null?Ae:me(st),Ae=new pt(Ue,ge+"leave",Re,m,Oe),Ae.target=cs,Ae.relatedTarget=Se,Ue=null,he(Oe)===je&&(pt=new pt(ve,ge+"enter",st,m,Oe),pt.target=Se,pt.relatedTarget=cs,Ue=pt),cs=Ue,Re&&st)t:{for(pt=XE,ve=Re,ge=st,Se=0,Ue=ve;Ue;Ue=pt(Ue))Se++;Ue=0;for(var ft=ge;ft;ft=pt(ft))Ue++;for(;0<Se-Ue;)ve=pt(ve),Se--;for(;0<Ue-Se;)ge=pt(ge),Ue--;for(;Se--;){if(ve===ge||ge!==null&&ve===ge.alternate){pt=ve;break t}ve=pt(ve),ge=pt(ge)}pt=null}else pt=null;Re!==null&&Gb($e,Ae,Re,pt,!1),st!==null&&cs!==null&&Gb($e,cs,st,pt,!0)}}e:{if(Ae=je?me(je):window,Re=Ae.nodeName&&Ae.nodeName.toLowerCase(),Re==="select"||Re==="input"&&Ae.type==="file")var Wt=ix;else if(ax(Ae))if(rx)Wt=oE;else{Wt=rE;var it=iE}else Re=Ae.nodeName,!Re||Re.toLowerCase()!=="input"||Ae.type!=="checkbox"&&Ae.type!=="radio"?je&&wl(je.elementType)&&(Wt=ix):Wt=lE;if(Wt&&(Wt=Wt(r,je))){nx($e,Wt,m,Oe);break e}it&&it(r,Ae,je),r==="focusout"&&je&&Ae.type==="number"&&je.memoizedProps.value!=null&&Vs(Ae,"number",Ae.value)}switch(it=je?me(je):window,r){case"focusin":(ax(it)||it.contentEditable==="true")&&(Tl=it,hf=je,qo=null);break;case"focusout":qo=hf=Tl=null;break;case"mousedown":ff=!0;break;case"contextmenu":case"mouseup":case"dragend":ff=!1,mx($e,m,Oe);break;case"selectionchange":if(dE)break;case"keydown":case"keyup":mx($e,m,Oe)}var Rt;if(of)e:{switch(r){case"compositionstart":var $t="onCompositionStart";break e;case"compositionend":$t="onCompositionEnd";break e;case"compositionupdate":$t="onCompositionUpdate";break e}$t=void 0}else El?tx(r,m)&&($t="onCompositionEnd"):r==="keydown"&&m.keyCode===229&&($t="onCompositionStart");$t&&(Jp&&m.locale!=="ko"&&(El||$t!=="onCompositionStart"?$t==="onCompositionEnd"&&El&&(Rt=zp()):(kn=Oe,jl="value"in kn?kn.value:kn.textContent,El=!0)),it=su(je,$t),0<it.length&&($t=new Qp($t,r,null,m,Oe),$e.push({event:$t,listeners:it}),Rt?$t.data=Rt:(Rt=sx(m),Rt!==null&&($t.data=Rt)))),(Rt=eE?tE(r,m):sE(r,m))&&($t=su(je,"onBeforeInput"),0<$t.length&&(it=new Qp("onBeforeInput","beforeinput",null,m,Oe),$e.push({event:it,listeners:$t}),it.data=Rt)),zE($e,r,je,m,Oe)}Ub($e,c)})}function gc(r,c,m){return{instance:r,listener:c,currentTarget:m}}function su(r,c){for(var m=c+"Capture",x=[];r!==null;){var S=r,E=S.stateNode;if(S=S.tag,S!==5&&S!==26&&S!==27||E===null||(S=li(r,m),S!=null&&x.unshift(gc(r,S,E)),S=li(r,c),S!=null&&x.push(gc(r,S,E))),r.tag===3)return x;r=r.return}return[]}function XE(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function Gb(r,c,m,x,S){for(var E=c._reactName,U=[];m!==null&&m!==x;){var Q=m,de=Q.alternate,je=Q.stateNode;if(Q=Q.tag,de!==null&&de===x)break;Q!==5&&Q!==26&&Q!==27||je===null||(de=je,S?(je=li(m,E),je!=null&&U.unshift(gc(m,je,de))):S||(je=li(m,E),je!=null&&U.push(gc(m,je,de)))),m=m.return}U.length!==0&&r.push({event:c,listeners:U})}var JE=/\r\n?/g,ZE=/\u0000|\uFFFD/g;function Vb(r){return(typeof r=="string"?r:""+r).replace(JE,`
`).replace(ZE,"")}function qb(r,c){return c=Vb(c),Vb(r)===c}function os(r,c,m,x,S,E){switch(m){case"children":typeof x=="string"?c==="body"||c==="textarea"&&x===""||fa(r,x):(typeof x=="number"||typeof x=="bigint")&&c!=="body"&&fa(r,""+x);break;case"className":dt(r,"class",x);break;case"tabIndex":dt(r,"tabindex",x);break;case"dir":case"role":case"viewBox":case"width":case"height":dt(r,m,x);break;case"style":od(r,x,E);break;case"data":if(c!=="object"){dt(r,"data",x);break}case"src":case"href":if(x===""&&(c!=="a"||m!=="href")){r.removeAttribute(m);break}if(x==null||typeof x=="function"||typeof x=="symbol"||typeof x=="boolean"){r.removeAttribute(m);break}x=Ir(""+x),r.setAttribute(m,x);break;case"action":case"formAction":if(typeof x=="function"){r.setAttribute(m,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof E=="function"&&(m==="formAction"?(c!=="input"&&os(r,c,"name",S.name,S,null),os(r,c,"formEncType",S.formEncType,S,null),os(r,c,"formMethod",S.formMethod,S,null),os(r,c,"formTarget",S.formTarget,S,null)):(os(r,c,"encType",S.encType,S,null),os(r,c,"method",S.method,S,null),os(r,c,"target",S.target,S,null)));if(x==null||typeof x=="symbol"||typeof x=="boolean"){r.removeAttribute(m);break}x=Ir(""+x),r.setAttribute(m,x);break;case"onClick":x!=null&&(r.onclick=Va);break;case"onScroll":x!=null&&Ft("scroll",r);break;case"onScrollEnd":x!=null&&Ft("scrollend",r);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(n(61));if(m=x.__html,m!=null){if(S.children!=null)throw Error(n(60));r.innerHTML=m}}break;case"multiple":r.multiple=x&&typeof x!="function"&&typeof x!="symbol";break;case"muted":r.muted=x&&typeof x!="function"&&typeof x!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(x==null||typeof x=="function"||typeof x=="boolean"||typeof x=="symbol"){r.removeAttribute("xlink:href");break}m=Ir(""+x),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",m);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":x!=null&&typeof x!="function"&&typeof x!="symbol"?r.setAttribute(m,""+x):r.removeAttribute(m);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":x&&typeof x!="function"&&typeof x!="symbol"?r.setAttribute(m,""):r.removeAttribute(m);break;case"capture":case"download":x===!0?r.setAttribute(m,""):x!==!1&&x!=null&&typeof x!="function"&&typeof x!="symbol"?r.setAttribute(m,x):r.removeAttribute(m);break;case"cols":case"rows":case"size":case"span":x!=null&&typeof x!="function"&&typeof x!="symbol"&&!isNaN(x)&&1<=x?r.setAttribute(m,x):r.removeAttribute(m);break;case"rowSpan":case"start":x==null||typeof x=="function"||typeof x=="symbol"||isNaN(x)?r.removeAttribute(m):r.setAttribute(m,x);break;case"popover":Ft("beforetoggle",r),Ft("toggle",r),vt(r,"popover",x);break;case"xlinkActuate":ct(r,"http://www.w3.org/1999/xlink","xlink:actuate",x);break;case"xlinkArcrole":ct(r,"http://www.w3.org/1999/xlink","xlink:arcrole",x);break;case"xlinkRole":ct(r,"http://www.w3.org/1999/xlink","xlink:role",x);break;case"xlinkShow":ct(r,"http://www.w3.org/1999/xlink","xlink:show",x);break;case"xlinkTitle":ct(r,"http://www.w3.org/1999/xlink","xlink:title",x);break;case"xlinkType":ct(r,"http://www.w3.org/1999/xlink","xlink:type",x);break;case"xmlBase":ct(r,"http://www.w3.org/XML/1998/namespace","xml:base",x);break;case"xmlLang":ct(r,"http://www.w3.org/XML/1998/namespace","xml:lang",x);break;case"xmlSpace":ct(r,"http://www.w3.org/XML/1998/namespace","xml:space",x);break;case"is":vt(r,"is",x);break;case"innerText":case"textContent":break;default:(!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(m=Dr.get(m)||m,vt(r,m,x))}}function Fm(r,c,m,x,S,E){switch(m){case"style":od(r,x,E);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(n(61));if(m=x.__html,m!=null){if(S.children!=null)throw Error(n(60));r.innerHTML=m}}break;case"children":typeof x=="string"?fa(r,x):(typeof x=="number"||typeof x=="bigint")&&fa(r,""+x);break;case"onScroll":x!=null&&Ft("scroll",r);break;case"onScrollEnd":x!=null&&Ft("scrollend",r);break;case"onClick":x!=null&&(r.onclick=Va);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Je.hasOwnProperty(m))e:{if(m[0]==="o"&&m[1]==="n"&&(S=m.endsWith("Capture"),c=m.slice(2,S?m.length-7:void 0),E=r[w]||null,E=E!=null?E[m]:null,typeof E=="function"&&r.removeEventListener(c,E,S),typeof x=="function")){typeof E!="function"&&E!==null&&(m in r?r[m]=null:r.hasAttribute(m)&&r.removeAttribute(m)),r.addEventListener(c,x,S);break e}m in r?r[m]=x:x===!0?r.setAttribute(m,""):vt(r,m,x)}}}function la(r,c,m){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ft("error",r),Ft("load",r);var x=!1,S=!1,E;for(E in m)if(m.hasOwnProperty(E)){var U=m[E];if(U!=null)switch(E){case"src":x=!0;break;case"srcSet":S=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,c));default:os(r,c,E,U,m,null)}}S&&os(r,c,"srcSet",m.srcSet,m,null),x&&os(r,c,"src",m.src,m,null);return;case"input":Ft("invalid",r);var Q=E=U=S=null,de=null,je=null;for(x in m)if(m.hasOwnProperty(x)){var Oe=m[x];if(Oe!=null)switch(x){case"name":S=Oe;break;case"type":U=Oe;break;case"checked":de=Oe;break;case"defaultChecked":je=Oe;break;case"value":E=Oe;break;case"defaultValue":Q=Oe;break;case"children":case"dangerouslySetInnerHTML":if(Oe!=null)throw Error(n(137,c));break;default:os(r,c,x,Oe,m,null)}}Zs(r,E,Q,de,je,U,S,!1);return;case"select":Ft("invalid",r),x=U=E=null;for(S in m)if(m.hasOwnProperty(S)&&(Q=m[S],Q!=null))switch(S){case"value":E=Q;break;case"defaultValue":U=Q;break;case"multiple":x=Q;default:os(r,c,S,Q,m,null)}c=E,m=U,r.multiple=!!x,c!=null?Rs(r,!!x,c,!1):m!=null&&Rs(r,!!x,m,!0);return;case"textarea":Ft("invalid",r),E=S=x=null;for(U in m)if(m.hasOwnProperty(U)&&(Q=m[U],Q!=null))switch(U){case"value":x=Q;break;case"defaultValue":S=Q;break;case"children":E=Q;break;case"dangerouslySetInnerHTML":if(Q!=null)throw Error(n(91));break;default:os(r,c,U,Q,m,null)}cn(r,x,S,E);return;case"option":for(de in m)if(m.hasOwnProperty(de)&&(x=m[de],x!=null))switch(de){case"selected":r.selected=x&&typeof x!="function"&&typeof x!="symbol";break;default:os(r,c,de,x,m,null)}return;case"dialog":Ft("beforetoggle",r),Ft("toggle",r),Ft("cancel",r),Ft("close",r);break;case"iframe":case"object":Ft("load",r);break;case"video":case"audio":for(x=0;x<mc.length;x++)Ft(mc[x],r);break;case"image":Ft("error",r),Ft("load",r);break;case"details":Ft("toggle",r);break;case"embed":case"source":case"link":Ft("error",r),Ft("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(je in m)if(m.hasOwnProperty(je)&&(x=m[je],x!=null))switch(je){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,c));default:os(r,c,je,x,m,null)}return;default:if(wl(c)){for(Oe in m)m.hasOwnProperty(Oe)&&(x=m[Oe],x!==void 0&&Fm(r,c,Oe,x,m,void 0));return}}for(Q in m)m.hasOwnProperty(Q)&&(x=m[Q],x!=null&&os(r,c,Q,x,m,null))}function e2(r,c,m,x){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var S=null,E=null,U=null,Q=null,de=null,je=null,Oe=null;for(Re in m){var $e=m[Re];if(m.hasOwnProperty(Re)&&$e!=null)switch(Re){case"checked":break;case"value":break;case"defaultValue":de=$e;default:x.hasOwnProperty(Re)||os(r,c,Re,null,x,$e)}}for(var Ae in x){var Re=x[Ae];if($e=m[Ae],x.hasOwnProperty(Ae)&&(Re!=null||$e!=null))switch(Ae){case"type":E=Re;break;case"name":S=Re;break;case"checked":je=Re;break;case"defaultChecked":Oe=Re;break;case"value":U=Re;break;case"defaultValue":Q=Re;break;case"children":case"dangerouslySetInnerHTML":if(Re!=null)throw Error(n(137,c));break;default:Re!==$e&&os(r,c,Ae,Re,x,$e)}}aa(r,U,Q,de,je,Oe,E,S);return;case"select":Re=U=Q=Ae=null;for(E in m)if(de=m[E],m.hasOwnProperty(E)&&de!=null)switch(E){case"value":break;case"multiple":Re=de;default:x.hasOwnProperty(E)||os(r,c,E,null,x,de)}for(S in x)if(E=x[S],de=m[S],x.hasOwnProperty(S)&&(E!=null||de!=null))switch(S){case"value":Ae=E;break;case"defaultValue":Q=E;break;case"multiple":U=E;default:E!==de&&os(r,c,S,E,x,de)}c=Q,m=U,x=Re,Ae!=null?Rs(r,!!m,Ae,!1):!!x!=!!m&&(c!=null?Rs(r,!!m,c,!0):Rs(r,!!m,m?[]:"",!1));return;case"textarea":Re=Ae=null;for(Q in m)if(S=m[Q],m.hasOwnProperty(Q)&&S!=null&&!x.hasOwnProperty(Q))switch(Q){case"value":break;case"children":break;default:os(r,c,Q,null,x,S)}for(U in x)if(S=x[U],E=m[U],x.hasOwnProperty(U)&&(S!=null||E!=null))switch(U){case"value":Ae=S;break;case"defaultValue":Re=S;break;case"children":break;case"dangerouslySetInnerHTML":if(S!=null)throw Error(n(91));break;default:S!==E&&os(r,c,U,S,x,E)}Vt(r,Ae,Re);return;case"option":for(var st in m)if(Ae=m[st],m.hasOwnProperty(st)&&Ae!=null&&!x.hasOwnProperty(st))switch(st){case"selected":r.selected=!1;break;default:os(r,c,st,null,x,Ae)}for(de in x)if(Ae=x[de],Re=m[de],x.hasOwnProperty(de)&&Ae!==Re&&(Ae!=null||Re!=null))switch(de){case"selected":r.selected=Ae&&typeof Ae!="function"&&typeof Ae!="symbol";break;default:os(r,c,de,Ae,x,Re)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var pt in m)Ae=m[pt],m.hasOwnProperty(pt)&&Ae!=null&&!x.hasOwnProperty(pt)&&os(r,c,pt,null,x,Ae);for(je in x)if(Ae=x[je],Re=m[je],x.hasOwnProperty(je)&&Ae!==Re&&(Ae!=null||Re!=null))switch(je){case"children":case"dangerouslySetInnerHTML":if(Ae!=null)throw Error(n(137,c));break;default:os(r,c,je,Ae,x,Re)}return;default:if(wl(c)){for(var cs in m)Ae=m[cs],m.hasOwnProperty(cs)&&Ae!==void 0&&!x.hasOwnProperty(cs)&&Fm(r,c,cs,void 0,x,Ae);for(Oe in x)Ae=x[Oe],Re=m[Oe],!x.hasOwnProperty(Oe)||Ae===Re||Ae===void 0&&Re===void 0||Fm(r,c,Oe,Ae,x,Re);return}}for(var ve in m)Ae=m[ve],m.hasOwnProperty(ve)&&Ae!=null&&!x.hasOwnProperty(ve)&&os(r,c,ve,null,x,Ae);for($e in x)Ae=x[$e],Re=m[$e],!x.hasOwnProperty($e)||Ae===Re||Ae==null&&Re==null||os(r,c,$e,Ae,x,Re)}function Kb(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function t2(){if(typeof performance.getEntriesByType=="function"){for(var r=0,c=0,m=performance.getEntriesByType("resource"),x=0;x<m.length;x++){var S=m[x],E=S.transferSize,U=S.initiatorType,Q=S.duration;if(E&&Q&&Kb(U)){for(U=0,Q=S.responseEnd,x+=1;x<m.length;x++){var de=m[x],je=de.startTime;if(je>Q)break;var Oe=de.transferSize,$e=de.initiatorType;Oe&&Kb($e)&&(de=de.responseEnd,U+=Oe*(de<Q?1:(Q-je)/(de-je)))}if(--x,c+=8*(E+U)/(S.duration/1e3),r++,10<r)break}}if(0<r)return c/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var Bm=null,Um=null;function au(r){return r.nodeType===9?r:r.ownerDocument}function Hb(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function zb(r,c){if(r===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&c==="foreignObject"?0:r}function $m(r,c){return r==="textarea"||r==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var Gm=null;function s2(){var r=window.event;return r&&r.type==="popstate"?r===Gm?!1:(Gm=r,!0):(Gm=null,!1)}var Yb=typeof setTimeout=="function"?setTimeout:void 0,a2=typeof clearTimeout=="function"?clearTimeout:void 0,Wb=typeof Promise=="function"?Promise:void 0,n2=typeof queueMicrotask=="function"?queueMicrotask:typeof Wb<"u"?function(r){return Wb.resolve(null).then(r).catch(i2)}:Yb;function i2(r){setTimeout(function(){throw r})}function or(r){return r==="head"}function Qb(r,c){var m=c,x=0;do{var S=m.nextSibling;if(r.removeChild(m),S&&S.nodeType===8)if(m=S.data,m==="/$"||m==="/&"){if(x===0){r.removeChild(S),eo(c);return}x--}else if(m==="$"||m==="$?"||m==="$~"||m==="$!"||m==="&")x++;else if(m==="html")pc(r.ownerDocument.documentElement);else if(m==="head"){m=r.ownerDocument.head,pc(m);for(var E=m.firstChild;E;){var U=E.nextSibling,Q=E.nodeName;E[se]||Q==="SCRIPT"||Q==="STYLE"||Q==="LINK"&&E.rel.toLowerCase()==="stylesheet"||m.removeChild(E),E=U}}else m==="body"&&pc(r.ownerDocument.body);m=S}while(m);eo(c)}function Xb(r,c){var m=r;r=0;do{var x=m.nextSibling;if(m.nodeType===1?c?(m._stashedDisplay=m.style.display,m.style.display="none"):(m.style.display=m._stashedDisplay||"",m.getAttribute("style")===""&&m.removeAttribute("style")):m.nodeType===3&&(c?(m._stashedText=m.nodeValue,m.nodeValue=""):m.nodeValue=m._stashedText||""),x&&x.nodeType===8)if(m=x.data,m==="/$"){if(r===0)break;r--}else m!=="$"&&m!=="$?"&&m!=="$~"&&m!=="$!"||r++;m=x}while(m)}function Vm(r){var c=r.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var m=c;switch(c=c.nextSibling,m.nodeName){case"HTML":case"HEAD":case"BODY":Vm(m),le(m);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(m.rel.toLowerCase()==="stylesheet")continue}r.removeChild(m)}}function r2(r,c,m,x){for(;r.nodeType===1;){var S=m;if(r.nodeName.toLowerCase()!==c.toLowerCase()){if(!x&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(x){if(!r[se])switch(c){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(E=r.getAttribute("rel"),E==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(E!==S.rel||r.getAttribute("href")!==(S.href==null||S.href===""?null:S.href)||r.getAttribute("crossorigin")!==(S.crossOrigin==null?null:S.crossOrigin)||r.getAttribute("title")!==(S.title==null?null:S.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(E=r.getAttribute("src"),(E!==(S.src==null?null:S.src)||r.getAttribute("type")!==(S.type==null?null:S.type)||r.getAttribute("crossorigin")!==(S.crossOrigin==null?null:S.crossOrigin))&&E&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(c==="input"&&r.type==="hidden"){var E=S.name==null?null:""+S.name;if(S.type==="hidden"&&r.getAttribute("name")===E)return r}else return r;if(r=xn(r.nextSibling),r===null)break}return null}function l2(r,c,m){if(c==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!m||(r=xn(r.nextSibling),r===null))return null;return r}function Jb(r,c){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!c||(r=xn(r.nextSibling),r===null))return null;return r}function qm(r){return r.data==="$?"||r.data==="$~"}function Km(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function o2(r,c){var m=r.ownerDocument;if(r.data==="$~")r._reactRetry=c;else if(r.data!=="$?"||m.readyState!=="loading")c();else{var x=function(){c(),m.removeEventListener("DOMContentLoaded",x)};m.addEventListener("DOMContentLoaded",x),r._reactRetry=x}}function xn(r){for(;r!=null;r=r.nextSibling){var c=r.nodeType;if(c===1||c===3)break;if(c===8){if(c=r.data,c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"||c==="F!"||c==="F")break;if(c==="/$"||c==="/&")return null}}return r}var Hm=null;function Zb(r){r=r.nextSibling;for(var c=0;r;){if(r.nodeType===8){var m=r.data;if(m==="/$"||m==="/&"){if(c===0)return xn(r.nextSibling);c--}else m!=="$"&&m!=="$!"&&m!=="$?"&&m!=="$~"&&m!=="&"||c++}r=r.nextSibling}return null}function ev(r){r=r.previousSibling;for(var c=0;r;){if(r.nodeType===8){var m=r.data;if(m==="$"||m==="$!"||m==="$?"||m==="$~"||m==="&"){if(c===0)return r;c--}else m!=="/$"&&m!=="/&"||c++}r=r.previousSibling}return null}function tv(r,c,m){switch(c=au(m),r){case"html":if(r=c.documentElement,!r)throw Error(n(452));return r;case"head":if(r=c.head,!r)throw Error(n(453));return r;case"body":if(r=c.body,!r)throw Error(n(454));return r;default:throw Error(n(451))}}function pc(r){for(var c=r.attributes;c.length;)r.removeAttributeNode(c[0]);le(r)}var yn=new Map,sv=new Set;function nu(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Ni=ae.d;ae.d={f:c2,r:d2,D:u2,C:h2,L:f2,m:m2,X:p2,S:g2,M:x2};function c2(){var r=Ni.f(),c=Wd();return r||c}function d2(r){var c=ce(r);c!==null&&c.tag===5&&c.type==="form"?by(c):Ni.r(r)}var Xl=typeof document>"u"?null:document;function av(r,c,m){var x=Xl;if(x&&typeof c=="string"&&c){var S=ss(c);S='link[rel="'+r+'"][href="'+S+'"]',typeof m=="string"&&(S+='[crossorigin="'+m+'"]'),sv.has(S)||(sv.add(S),r={rel:r,crossOrigin:m,href:c},x.querySelector(S)===null&&(c=x.createElement("link"),la(c,"link",r),Pe(c),x.head.appendChild(c)))}}function u2(r){Ni.D(r),av("dns-prefetch",r,null)}function h2(r,c){Ni.C(r,c),av("preconnect",r,c)}function f2(r,c,m){Ni.L(r,c,m);var x=Xl;if(x&&r&&c){var S='link[rel="preload"][as="'+ss(c)+'"]';c==="image"&&m&&m.imageSrcSet?(S+='[imagesrcset="'+ss(m.imageSrcSet)+'"]',typeof m.imageSizes=="string"&&(S+='[imagesizes="'+ss(m.imageSizes)+'"]')):S+='[href="'+ss(r)+'"]';var E=S;switch(c){case"style":E=Jl(r);break;case"script":E=Zl(r)}yn.has(E)||(r=g({rel:"preload",href:c==="image"&&m&&m.imageSrcSet?void 0:r,as:c},m),yn.set(E,r),x.querySelector(S)!==null||c==="style"&&x.querySelector(xc(E))||c==="script"&&x.querySelector(yc(E))||(c=x.createElement("link"),la(c,"link",r),Pe(c),x.head.appendChild(c)))}}function m2(r,c){Ni.m(r,c);var m=Xl;if(m&&r){var x=c&&typeof c.as=="string"?c.as:"script",S='link[rel="modulepreload"][as="'+ss(x)+'"][href="'+ss(r)+'"]',E=S;switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":E=Zl(r)}if(!yn.has(E)&&(r=g({rel:"modulepreload",href:r},c),yn.set(E,r),m.querySelector(S)===null)){switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(m.querySelector(yc(E)))return}x=m.createElement("link"),la(x,"link",r),Pe(x),m.head.appendChild(x)}}}function g2(r,c,m){Ni.S(r,c,m);var x=Xl;if(x&&r){var S=Te(x).hoistableStyles,E=Jl(r);c=c||"default";var U=S.get(E);if(!U){var Q={loading:0,preload:null};if(U=x.querySelector(xc(E)))Q.loading=5;else{r=g({rel:"stylesheet",href:r,"data-precedence":c},m),(m=yn.get(E))&&zm(r,m);var de=U=x.createElement("link");Pe(de),la(de,"link",r),de._p=new Promise(function(je,Oe){de.onload=je,de.onerror=Oe}),de.addEventListener("load",function(){Q.loading|=1}),de.addEventListener("error",function(){Q.loading|=2}),Q.loading|=4,iu(U,c,x)}U={type:"stylesheet",instance:U,count:1,state:Q},S.set(E,U)}}}function p2(r,c){Ni.X(r,c);var m=Xl;if(m&&r){var x=Te(m).hoistableScripts,S=Zl(r),E=x.get(S);E||(E=m.querySelector(yc(S)),E||(r=g({src:r,async:!0},c),(c=yn.get(S))&&Ym(r,c),E=m.createElement("script"),Pe(E),la(E,"link",r),m.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},x.set(S,E))}}function x2(r,c){Ni.M(r,c);var m=Xl;if(m&&r){var x=Te(m).hoistableScripts,S=Zl(r),E=x.get(S);E||(E=m.querySelector(yc(S)),E||(r=g({src:r,async:!0,type:"module"},c),(c=yn.get(S))&&Ym(r,c),E=m.createElement("script"),Pe(E),la(E,"link",r),m.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},x.set(S,E))}}function nv(r,c,m,x){var S=(S=Ee.current)?nu(S):null;if(!S)throw Error(n(446));switch(r){case"meta":case"title":return null;case"style":return typeof m.precedence=="string"&&typeof m.href=="string"?(c=Jl(m.href),m=Te(S).hoistableStyles,x=m.get(c),x||(x={type:"style",instance:null,count:0,state:null},m.set(c,x)),x):{type:"void",instance:null,count:0,state:null};case"link":if(m.rel==="stylesheet"&&typeof m.href=="string"&&typeof m.precedence=="string"){r=Jl(m.href);var E=Te(S).hoistableStyles,U=E.get(r);if(U||(S=S.ownerDocument||S,U={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},E.set(r,U),(E=S.querySelector(xc(r)))&&!E._p&&(U.instance=E,U.state.loading=5),yn.has(r)||(m={rel:"preload",as:"style",href:m.href,crossOrigin:m.crossOrigin,integrity:m.integrity,media:m.media,hrefLang:m.hrefLang,referrerPolicy:m.referrerPolicy},yn.set(r,m),E||y2(S,r,m,U.state))),c&&x===null)throw Error(n(528,""));return U}if(c&&x!==null)throw Error(n(529,""));return null;case"script":return c=m.async,m=m.src,typeof m=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=Zl(m),m=Te(S).hoistableScripts,x=m.get(c),x||(x={type:"script",instance:null,count:0,state:null},m.set(c,x)),x):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,r))}}function Jl(r){return'href="'+ss(r)+'"'}function xc(r){return'link[rel="stylesheet"]['+r+"]"}function iv(r){return g({},r,{"data-precedence":r.precedence,precedence:null})}function y2(r,c,m,x){r.querySelector('link[rel="preload"][as="style"]['+c+"]")?x.loading=1:(c=r.createElement("link"),x.preload=c,c.addEventListener("load",function(){return x.loading|=1}),c.addEventListener("error",function(){return x.loading|=2}),la(c,"link",m),Pe(c),r.head.appendChild(c))}function Zl(r){return'[src="'+ss(r)+'"]'}function yc(r){return"script[async]"+r}function rv(r,c,m){if(c.count++,c.instance===null)switch(c.type){case"style":var x=r.querySelector('style[data-href~="'+ss(m.href)+'"]');if(x)return c.instance=x,Pe(x),x;var S=g({},m,{"data-href":m.href,"data-precedence":m.precedence,href:null,precedence:null});return x=(r.ownerDocument||r).createElement("style"),Pe(x),la(x,"style",S),iu(x,m.precedence,r),c.instance=x;case"stylesheet":S=Jl(m.href);var E=r.querySelector(xc(S));if(E)return c.state.loading|=4,c.instance=E,Pe(E),E;x=iv(m),(S=yn.get(S))&&zm(x,S),E=(r.ownerDocument||r).createElement("link"),Pe(E);var U=E;return U._p=new Promise(function(Q,de){U.onload=Q,U.onerror=de}),la(E,"link",x),c.state.loading|=4,iu(E,m.precedence,r),c.instance=E;case"script":return E=Zl(m.src),(S=r.querySelector(yc(E)))?(c.instance=S,Pe(S),S):(x=m,(S=yn.get(E))&&(x=g({},m),Ym(x,S)),r=r.ownerDocument||r,S=r.createElement("script"),Pe(S),la(S,"link",x),r.head.appendChild(S),c.instance=S);case"void":return null;default:throw Error(n(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(x=c.instance,c.state.loading|=4,iu(x,m.precedence,r));return c.instance}function iu(r,c,m){for(var x=m.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),S=x.length?x[x.length-1]:null,E=S,U=0;U<x.length;U++){var Q=x[U];if(Q.dataset.precedence===c)E=Q;else if(E!==S)break}E?E.parentNode.insertBefore(r,E.nextSibling):(c=m.nodeType===9?m.head:m,c.insertBefore(r,c.firstChild))}function zm(r,c){r.crossOrigin==null&&(r.crossOrigin=c.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=c.referrerPolicy),r.title==null&&(r.title=c.title)}function Ym(r,c){r.crossOrigin==null&&(r.crossOrigin=c.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=c.referrerPolicy),r.integrity==null&&(r.integrity=c.integrity)}var ru=null;function lv(r,c,m){if(ru===null){var x=new Map,S=ru=new Map;S.set(m,x)}else S=ru,x=S.get(m),x||(x=new Map,S.set(m,x));if(x.has(r))return x;for(x.set(r,null),m=m.getElementsByTagName(r),S=0;S<m.length;S++){var E=m[S];if(!(E[se]||E[j]||r==="link"&&E.getAttribute("rel")==="stylesheet")&&E.namespaceURI!=="http://www.w3.org/2000/svg"){var U=E.getAttribute(c)||"";U=r+U;var Q=x.get(U);Q?Q.push(E):x.set(U,[E])}}return x}function ov(r,c,m){r=r.ownerDocument||r,r.head.insertBefore(m,c==="title"?r.querySelector("head > title"):null)}function b2(r,c,m){if(m===1||c.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;switch(c.rel){case"stylesheet":return r=c.disabled,typeof c.precedence=="string"&&r==null;default:return!0}case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function cv(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function v2(r,c,m,x){if(m.type==="stylesheet"&&(typeof x.media!="string"||matchMedia(x.media).matches!==!1)&&(m.state.loading&4)===0){if(m.instance===null){var S=Jl(x.href),E=c.querySelector(xc(S));if(E){c=E._p,c!==null&&typeof c=="object"&&typeof c.then=="function"&&(r.count++,r=lu.bind(r),c.then(r,r)),m.state.loading|=4,m.instance=E,Pe(E);return}E=c.ownerDocument||c,x=iv(x),(S=yn.get(S))&&zm(x,S),E=E.createElement("link"),Pe(E);var U=E;U._p=new Promise(function(Q,de){U.onload=Q,U.onerror=de}),la(E,"link",x),m.instance=E}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(m,c),(c=m.state.preload)&&(m.state.loading&3)===0&&(r.count++,m=lu.bind(r),c.addEventListener("load",m),c.addEventListener("error",m))}}var Wm=0;function _2(r,c){return r.stylesheets&&r.count===0&&cu(r,r.stylesheets),0<r.count||0<r.imgCount?function(m){var x=setTimeout(function(){if(r.stylesheets&&cu(r,r.stylesheets),r.unsuspend){var E=r.unsuspend;r.unsuspend=null,E()}},6e4+c);0<r.imgBytes&&Wm===0&&(Wm=62500*t2());var S=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&cu(r,r.stylesheets),r.unsuspend)){var E=r.unsuspend;r.unsuspend=null,E()}},(r.imgBytes>Wm?50:800)+c);return r.unsuspend=m,function(){r.unsuspend=null,clearTimeout(x),clearTimeout(S)}}:null}function lu(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)cu(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var ou=null;function cu(r,c){r.stylesheets=null,r.unsuspend!==null&&(r.count++,ou=new Map,c.forEach(N2,r),ou=null,lu.call(r))}function N2(r,c){if(!(c.state.loading&4)){var m=ou.get(r);if(m)var x=m.get(null);else{m=new Map,ou.set(r,m);for(var S=r.querySelectorAll("link[data-precedence],style[data-precedence]"),E=0;E<S.length;E++){var U=S[E];(U.nodeName==="LINK"||U.getAttribute("media")!=="not all")&&(m.set(U.dataset.precedence,U),x=U)}x&&m.set(null,x)}S=c.instance,U=S.getAttribute("data-precedence"),E=m.get(U)||x,E===x&&m.set(null,S),m.set(U,S),this.count++,x=lu.bind(this),S.addEventListener("load",x),S.addEventListener("error",x),E?E.parentNode.insertBefore(S,E.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(S,r.firstChild)),c.state.loading|=4}}var bc={$$typeof:T,Provider:null,Consumer:null,_currentValue:te,_currentValue2:te,_threadCount:0};function w2(r,c,m,x,S,E,U,Q,de){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ha(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ha(0),this.hiddenUpdates=ha(null),this.identifierPrefix=x,this.onUncaughtError=S,this.onCaughtError=E,this.onRecoverableError=U,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=de,this.incompleteTransitions=new Map}function dv(r,c,m,x,S,E,U,Q,de,je,Oe,$e){return r=new w2(r,c,m,U,de,je,Oe,$e,Q),c=1,E===!0&&(c|=24),E=Ka(3,null,null,c),r.current=E,E.stateNode=r,c=Af(),c.refCount++,r.pooledCache=c,c.refCount++,E.memoizedState={element:x,isDehydrated:m,cache:c},Lf(E),r}function uv(r){return r?(r=kl,r):kl}function hv(r,c,m,x,S,E){S=uv(S),x.context===null?x.context=S:x.pendingContext=S,x=Xi(c),x.payload={element:m},E=E===void 0?null:E,E!==null&&(x.callback=E),m=Ji(r,x,c),m!==null&&(Ma(m,r,c),Xo(m,r,c))}function fv(r,c){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var m=r.retryLane;r.retryLane=m!==0&&m<c?m:c}}function Qm(r,c){fv(r,c),(r=r.alternate)&&fv(r,c)}function mv(r){if(r.tag===13||r.tag===31){var c=$r(r,67108864);c!==null&&Ma(c,r,67108864),Qm(r,67108864)}}function gv(r){if(r.tag===13||r.tag===31){var c=Qa();c=Rr(c);var m=$r(r,c);m!==null&&Ma(m,r,c),Qm(r,c)}}var du=!0;function S2(r,c,m,x){var S=X.T;X.T=null;var E=ae.p;try{ae.p=2,Xm(r,c,m,x)}finally{ae.p=E,X.T=S}}function j2(r,c,m,x){var S=X.T;X.T=null;var E=ae.p;try{ae.p=8,Xm(r,c,m,x)}finally{ae.p=E,X.T=S}}function Xm(r,c,m,x){if(du){var S=Jm(x);if(S===null)Om(r,c,x,uu,m),xv(r,x);else if(T2(S,r,c,m,x))x.stopPropagation();else if(xv(r,x),c&4&&-1<E2.indexOf(r)){for(;S!==null;){var E=ce(S);if(E!==null)switch(E.tag){case 3:if(E=E.stateNode,E.current.memoizedState.isDehydrated){var U=tt(E.pendingLanes);if(U!==0){var Q=E;for(Q.pendingLanes|=2,Q.entangledLanes|=2;U;){var de=1<<31-gt(U);Q.entanglements[1]|=de,U&=~de}Hn(E),(es&6)===0&&(zd=ts()+500,fc(0))}}break;case 31:case 13:Q=$r(E,2),Q!==null&&Ma(Q,E,2),Wd(),Qm(E,2)}if(E=Jm(x),E===null&&Om(r,c,x,uu,m),E===S)break;S=E}S!==null&&x.stopPropagation()}else Om(r,c,x,null,m)}}function Jm(r){return r=ri(r),Zm(r)}var uu=null;function Zm(r){if(uu=null,r=he(r),r!==null){var c=l(r);if(c===null)r=null;else{var m=c.tag;if(m===13){if(r=o(c),r!==null)return r;r=null}else if(m===31){if(r=d(c),r!==null)return r;r=null}else if(m===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;r=null}else c!==r&&(r=null)}}return uu=r,null}function pv(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Bn()){case ua:return 2;case rn:return 8;case ya:case An:return 32;case ln:return 268435456;default:return 32}default:return 32}}var eg=!1,cr=null,dr=null,ur=null,vc=new Map,_c=new Map,hr=[],E2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function xv(r,c){switch(r){case"focusin":case"focusout":cr=null;break;case"dragenter":case"dragleave":dr=null;break;case"mouseover":case"mouseout":ur=null;break;case"pointerover":case"pointerout":vc.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":_c.delete(c.pointerId)}}function Nc(r,c,m,x,S,E){return r===null||r.nativeEvent!==E?(r={blockedOn:c,domEventName:m,eventSystemFlags:x,nativeEvent:E,targetContainers:[S]},c!==null&&(c=ce(c),c!==null&&mv(c)),r):(r.eventSystemFlags|=x,c=r.targetContainers,S!==null&&c.indexOf(S)===-1&&c.push(S),r)}function T2(r,c,m,x,S){switch(c){case"focusin":return cr=Nc(cr,r,c,m,x,S),!0;case"dragenter":return dr=Nc(dr,r,c,m,x,S),!0;case"mouseover":return ur=Nc(ur,r,c,m,x,S),!0;case"pointerover":var E=S.pointerId;return vc.set(E,Nc(vc.get(E)||null,r,c,m,x,S)),!0;case"gotpointercapture":return E=S.pointerId,_c.set(E,Nc(_c.get(E)||null,r,c,m,x,S)),!0}return!1}function yv(r){var c=he(r.target);if(c!==null){var m=l(c);if(m!==null){if(c=m.tag,c===13){if(c=o(m),c!==null){r.blockedOn=c,R(r.priority,function(){gv(m)});return}}else if(c===31){if(c=d(m),c!==null){r.blockedOn=c,R(r.priority,function(){gv(m)});return}}else if(c===3&&m.stateNode.current.memoizedState.isDehydrated){r.blockedOn=m.tag===3?m.stateNode.containerInfo:null;return}}}r.blockedOn=null}function hu(r){if(r.blockedOn!==null)return!1;for(var c=r.targetContainers;0<c.length;){var m=Jm(r.nativeEvent);if(m===null){m=r.nativeEvent;var x=new m.constructor(m.type,m);Pr=x,m.target.dispatchEvent(x),Pr=null}else return c=ce(m),c!==null&&mv(c),r.blockedOn=m,!1;c.shift()}return!0}function bv(r,c,m){hu(r)&&m.delete(c)}function A2(){eg=!1,cr!==null&&hu(cr)&&(cr=null),dr!==null&&hu(dr)&&(dr=null),ur!==null&&hu(ur)&&(ur=null),vc.forEach(bv),_c.forEach(bv)}function fu(r,c){r.blockedOn===c&&(r.blockedOn=null,eg||(eg=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,A2)))}var mu=null;function vv(r){mu!==r&&(mu=r,a.unstable_scheduleCallback(a.unstable_NormalPriority,function(){mu===r&&(mu=null);for(var c=0;c<r.length;c+=3){var m=r[c],x=r[c+1],S=r[c+2];if(typeof x!="function"){if(Zm(x||m)===null)continue;break}var E=ce(m);E!==null&&(r.splice(c,3),c-=3,Jf(E,{pending:!0,data:S,method:m.method,action:x},x,S))}}))}function eo(r){function c(de){return fu(de,r)}cr!==null&&fu(cr,r),dr!==null&&fu(dr,r),ur!==null&&fu(ur,r),vc.forEach(c),_c.forEach(c);for(var m=0;m<hr.length;m++){var x=hr[m];x.blockedOn===r&&(x.blockedOn=null)}for(;0<hr.length&&(m=hr[0],m.blockedOn===null);)yv(m),m.blockedOn===null&&hr.shift();if(m=(r.ownerDocument||r).$$reactFormReplay,m!=null)for(x=0;x<m.length;x+=3){var S=m[x],E=m[x+1],U=S[w]||null;if(typeof E=="function")U||vv(m);else if(U){var Q=null;if(E&&E.hasAttribute("formAction")){if(S=E,U=E[w]||null)Q=U.formAction;else if(Zm(S)!==null)continue}else Q=U.action;typeof Q=="function"?m[x+1]=Q:(m.splice(x,3),x-=3),vv(m)}}}function _v(){function r(E){E.canIntercept&&E.info==="react-transition"&&E.intercept({handler:function(){return new Promise(function(U){return S=U})},focusReset:"manual",scroll:"manual"})}function c(){S!==null&&(S(),S=null),x||setTimeout(m,20)}function m(){if(!x&&!navigation.transition){var E=navigation.currentEntry;E&&E.url!=null&&navigation.navigate(E.url,{state:E.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var x=!1,S=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",c),navigation.addEventListener("navigateerror",c),setTimeout(m,100),function(){x=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",c),navigation.removeEventListener("navigateerror",c),S!==null&&(S(),S=null)}}}function tg(r){this._internalRoot=r}gu.prototype.render=tg.prototype.render=function(r){var c=this._internalRoot;if(c===null)throw Error(n(409));var m=c.current,x=Qa();hv(m,x,r,c,null,null)},gu.prototype.unmount=tg.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var c=r.containerInfo;hv(r.current,2,null,r,null,null),Wd(),c[M]=null}};function gu(r){this._internalRoot=r}gu.prototype.unstable_scheduleHydration=function(r){if(r){var c=Lr();r={blockedOn:null,target:r,priority:c};for(var m=0;m<hr.length&&c!==0&&c<hr[m].priority;m++);hr.splice(m,0,r),m===0&&yv(r)}};var Nv=e.version;if(Nv!=="19.2.3")throw Error(n(527,Nv,"19.2.3"));ae.findDOMNode=function(r){var c=r._reactInternals;if(c===void 0)throw typeof r.render=="function"?Error(n(188)):(r=Object.keys(r).join(","),Error(n(268,r)));return r=u(c),r=r!==null?f(r):null,r=r===null?null:r.stateNode,r};var C2={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:X,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var pu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!pu.isDisabled&&pu.supportsFiber)try{on=pu.inject(C2),Ps=pu}catch{}}return Sc.createRoot=function(r,c){if(!i(r))throw Error(n(299));var m=!1,x="",S=Cy,E=ky,U=Ry;return c!=null&&(c.unstable_strictMode===!0&&(m=!0),c.identifierPrefix!==void 0&&(x=c.identifierPrefix),c.onUncaughtError!==void 0&&(S=c.onUncaughtError),c.onCaughtError!==void 0&&(E=c.onCaughtError),c.onRecoverableError!==void 0&&(U=c.onRecoverableError)),c=dv(r,1,!1,null,null,m,x,null,S,E,U,_v),r[M]=c.current,Pm(r),new tg(c)},Sc.hydrateRoot=function(r,c,m){if(!i(r))throw Error(n(299));var x=!1,S="",E=Cy,U=ky,Q=Ry,de=null;return m!=null&&(m.unstable_strictMode===!0&&(x=!0),m.identifierPrefix!==void 0&&(S=m.identifierPrefix),m.onUncaughtError!==void 0&&(E=m.onUncaughtError),m.onCaughtError!==void 0&&(U=m.onCaughtError),m.onRecoverableError!==void 0&&(Q=m.onRecoverableError),m.formState!==void 0&&(de=m.formState)),c=dv(r,1,!0,c,m??null,x,S,de,E,U,Q,_v),c.context=uv(null),m=c.current,x=Qa(),x=Rr(x),S=Xi(x),S.callback=null,Ji(m,S,x),m=x,c.current.lanes=m,ba(c,m),Hn(c),r[M]=c.current,Pm(r),new gu(c)},Sc.version="19.2.3",Sc}var Lv;function B2(){if(Lv)return ng.exports;Lv=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(e){console.error(e)}}return a(),ng.exports=F2(),ng.exports}var U2=B2();var Dv="popstate";function $2(a={}){function e(n,i){let{pathname:l,search:o,hash:d}=n.location;return Jg("",{pathname:l,search:o,hash:d},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function s(n,i){return typeof i=="string"?i:Uc(i)}return V2(e,s,null,a)}function js(a,e){if(a===!1||a===null||typeof a>"u")throw new Error(e)}function _n(a,e){if(!a){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function G2(){return Math.random().toString(36).substring(2,10)}function Mv(a,e){return{usr:a.state,key:a.key,idx:e}}function Jg(a,e,s=null,n){return{pathname:typeof a=="string"?a:a.pathname,search:"",hash:"",...typeof e=="string"?Eo(e):e,state:s,key:e&&e.key||n||G2()}}function Uc({pathname:a="/",search:e="",hash:s=""}){return e&&e!=="?"&&(a+=e.charAt(0)==="?"?e:"?"+e),s&&s!=="#"&&(a+=s.charAt(0)==="#"?s:"#"+s),a}function Eo(a){let e={};if(a){let s=a.indexOf("#");s>=0&&(e.hash=a.substring(s),a=a.substring(0,s));let n=a.indexOf("?");n>=0&&(e.search=a.substring(n),a=a.substring(0,n)),a&&(e.pathname=a)}return e}function V2(a,e,s,n={}){let{window:i=document.defaultView,v5Compat:l=!1}=n,o=i.history,d="POP",h=null,u=f();u==null&&(u=0,o.replaceState({...o.state,idx:u},""));function f(){return(o.state||{idx:null}).idx}function g(){d="POP";let _=f(),N=_==null?null:_-u;u=_,h&&h({action:d,location:v.location,delta:N})}function p(_,N){d="PUSH";let C=Jg(v.location,_,N);u=f()+1;let T=Mv(C,u),L=v.createHref(C);try{o.pushState(T,"",L)}catch(F){if(F instanceof DOMException&&F.name==="DataCloneError")throw F;i.location.assign(L)}l&&h&&h({action:d,location:v.location,delta:1})}function b(_,N){d="REPLACE";let C=Jg(v.location,_,N);u=f();let T=Mv(C,u),L=v.createHref(C);o.replaceState(T,"",L),l&&h&&h({action:d,location:v.location,delta:0})}function y(_){return q2(_)}let v={get action(){return d},get location(){return a(i,o)},listen(_){if(h)throw new Error("A history only accepts one active listener");return i.addEventListener(Dv,g),h=_,()=>{i.removeEventListener(Dv,g),h=null}},createHref(_){return e(i,_)},createURL:y,encodeLocation(_){let N=y(_);return{pathname:N.pathname,search:N.search,hash:N.hash}},push:p,replace:b,go(_){return o.go(_)}};return v}function q2(a,e=!1){let s="http://localhost";typeof window<"u"&&(s=window.location.origin!=="null"?window.location.origin:window.location.href),js(s,"No window.location.(origin|href) available to create URL");let n=typeof a=="string"?a:Uc(a);return n=n.replace(/ $/,"%20"),!e&&n.startsWith("//")&&(n=s+n),new URL(n,s)}function g1(a,e,s="/"){return K2(a,e,s,!1)}function K2(a,e,s,n){let i=typeof e=="string"?Eo(e):e,l=Ii(i.pathname||"/",s);if(l==null)return null;let o=p1(a);H2(o);let d=null;for(let h=0;d==null&&h<o.length;++h){let u=aT(l);d=tT(o[h],u,n)}return d}function p1(a,e=[],s=[],n="",i=!1){let l=(o,d,h=i,u)=>{let f={relativePath:u===void 0?o.path||"":u,caseSensitive:o.caseSensitive===!0,childrenIndex:d,route:o};if(f.relativePath.startsWith("/")){if(!f.relativePath.startsWith(n)&&h)return;js(f.relativePath.startsWith(n),`Absolute route path "${f.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),f.relativePath=f.relativePath.slice(n.length)}let g=Li([n,f.relativePath]),p=s.concat(f);o.children&&o.children.length>0&&(js(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),p1(o.children,e,p,g,h)),!(o.path==null&&!o.index)&&e.push({path:g,score:Z2(g,o.index),routesMeta:p})};return a.forEach((o,d)=>{if(o.path===""||!o.path?.includes("?"))l(o,d);else for(let h of x1(o.path))l(o,d,!0,h)}),e}function x1(a){let e=a.split("/");if(e.length===0)return[];let[s,...n]=e,i=s.endsWith("?"),l=s.replace(/\?$/,"");if(n.length===0)return i?[l,""]:[l];let o=x1(n.join("/")),d=[];return d.push(...o.map(h=>h===""?l:[l,h].join("/"))),i&&d.push(...o),d.map(h=>a.startsWith("/")&&h===""?"/":h)}function H2(a){a.sort((e,s)=>e.score!==s.score?s.score-e.score:eT(e.routesMeta.map(n=>n.childrenIndex),s.routesMeta.map(n=>n.childrenIndex)))}var z2=/^:[\w-]+$/,Y2=3,W2=2,Q2=1,X2=10,J2=-2,Iv=a=>a==="*";function Z2(a,e){let s=a.split("/"),n=s.length;return s.some(Iv)&&(n+=J2),e&&(n+=W2),s.filter(i=>!Iv(i)).reduce((i,l)=>i+(z2.test(l)?Y2:l===""?Q2:X2),n)}function eT(a,e){return a.length===e.length&&a.slice(0,-1).every((n,i)=>n===e[i])?a[a.length-1]-e[e.length-1]:0}function tT(a,e,s=!1){let{routesMeta:n}=a,i={},l="/",o=[];for(let d=0;d<n.length;++d){let h=n[d],u=d===n.length-1,f=l==="/"?e:e.slice(l.length)||"/",g=hh({path:h.relativePath,caseSensitive:h.caseSensitive,end:u},f),p=h.route;if(!g&&u&&s&&!n[n.length-1].route.index&&(g=hh({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},f)),!g)return null;Object.assign(i,g.params),o.push({params:i,pathname:Li([l,g.pathname]),pathnameBase:oT(Li([l,g.pathnameBase])),route:p}),g.pathnameBase!=="/"&&(l=Li([l,g.pathnameBase]))}return o}function hh(a,e){typeof a=="string"&&(a={path:a,caseSensitive:!1,end:!0});let[s,n]=sT(a.path,a.caseSensitive,a.end),i=e.match(s);if(!i)return null;let l=i[0],o=l.replace(/(.)\/+$/,"$1"),d=i.slice(1);return{params:n.reduce((u,{paramName:f,isOptional:g},p)=>{if(f==="*"){let y=d[p]||"";o=l.slice(0,l.length-y.length).replace(/(.)\/+$/,"$1")}const b=d[p];return g&&!b?u[f]=void 0:u[f]=(b||"").replace(/%2F/g,"/"),u},{}),pathname:l,pathnameBase:o,pattern:a}}function sT(a,e=!1,s=!0){_n(a==="*"||!a.endsWith("*")||a.endsWith("/*"),`Route path "${a}" will be treated as if it were "${a.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${a.replace(/\*$/,"/*")}".`);let n=[],i="^"+a.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,d,h)=>(n.push({paramName:d,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return a.endsWith("*")?(n.push({paramName:"*"}),i+=a==="*"||a==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?i+="\\/*$":a!==""&&a!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),n]}function aT(a){try{return a.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return _n(!1,`The URL path "${a}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),a}}function Ii(a,e){if(e==="/")return a;if(!a.toLowerCase().startsWith(e.toLowerCase()))return null;let s=e.endsWith("/")?e.length-1:e.length,n=a.charAt(s);return n&&n!=="/"?null:a.slice(s)||"/"}var nT=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,iT=a=>nT.test(a);function rT(a,e="/"){let{pathname:s,search:n="",hash:i=""}=typeof a=="string"?Eo(a):a,l;if(s)if(iT(s))l=s;else{if(s.includes("//")){let o=s;s=s.replace(/\/\/+/g,"/"),_n(!1,`Pathnames cannot have embedded double slashes - normalizing ${o} -> ${s}`)}s.startsWith("/")?l=Pv(s.substring(1),"/"):l=Pv(s,e)}else l=e;return{pathname:l,search:cT(n),hash:dT(i)}}function Pv(a,e){let s=e.replace(/\/+$/,"").split("/");return a.split("/").forEach(i=>{i===".."?s.length>1&&s.pop():i!=="."&&s.push(i)}),s.length>1?s.join("/"):"/"}function og(a,e,s,n){return`Cannot include a '${a}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${s}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function lT(a){return a.filter((e,s)=>s===0||e.route.path&&e.route.path.length>0)}function X0(a){let e=lT(a);return e.map((s,n)=>n===e.length-1?s.pathname:s.pathnameBase)}function J0(a,e,s,n=!1){let i;typeof a=="string"?i=Eo(a):(i={...a},js(!i.pathname||!i.pathname.includes("?"),og("?","pathname","search",i)),js(!i.pathname||!i.pathname.includes("#"),og("#","pathname","hash",i)),js(!i.search||!i.search.includes("#"),og("#","search","hash",i)));let l=a===""||i.pathname==="",o=l?"/":i.pathname,d;if(o==null)d=s;else{let g=e.length-1;if(!n&&o.startsWith("..")){let p=o.split("/");for(;p[0]==="..";)p.shift(),g-=1;i.pathname=p.join("/")}d=g>=0?e[g]:"/"}let h=rT(i,d),u=o&&o!=="/"&&o.endsWith("/"),f=(l||o===".")&&s.endsWith("/");return!h.pathname.endsWith("/")&&(u||f)&&(h.pathname+="/"),h}var Li=a=>a.join("/").replace(/\/\/+/g,"/"),oT=a=>a.replace(/\/+$/,"").replace(/^\/*/,"/"),cT=a=>!a||a==="?"?"":a.startsWith("?")?a:"?"+a,dT=a=>!a||a==="#"?"":a.startsWith("#")?a:"#"+a;function uT(a){return a!=null&&typeof a.status=="number"&&typeof a.statusText=="string"&&typeof a.internal=="boolean"&&"data"in a}function hT(a){return a.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var y1=["POST","PUT","PATCH","DELETE"];new Set(y1);var fT=["GET",...y1];new Set(fT);var To=k.createContext(null);To.displayName="DataRouter";var Fh=k.createContext(null);Fh.displayName="DataRouterState";k.createContext(!1);var b1=k.createContext({isTransitioning:!1});b1.displayName="ViewTransition";var mT=k.createContext(new Map);mT.displayName="Fetchers";var gT=k.createContext(null);gT.displayName="Await";var Sn=k.createContext(null);Sn.displayName="Navigation";var Xc=k.createContext(null);Xc.displayName="Location";var jn=k.createContext({outlet:null,matches:[],isDataRoute:!1});jn.displayName="Route";var Z0=k.createContext(null);Z0.displayName="RouteError";function pT(a,{relative:e}={}){js(Ao(),"useHref() may be used only in the context of a <Router> component.");let{basename:s,navigator:n}=k.useContext(Sn),{hash:i,pathname:l,search:o}=Zc(a,{relative:e}),d=l;return s!=="/"&&(d=l==="/"?s:Li([s,l])),n.createHref({pathname:d,search:o,hash:i})}function Ao(){return k.useContext(Xc)!=null}function Ui(){return js(Ao(),"useLocation() may be used only in the context of a <Router> component."),k.useContext(Xc).location}var v1="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function _1(a){k.useContext(Sn).static||k.useLayoutEffect(a)}function Jc(){let{isDataRoute:a}=k.useContext(jn);return a?RT():xT()}function xT(){js(Ao(),"useNavigate() may be used only in the context of a <Router> component.");let a=k.useContext(To),{basename:e,navigator:s}=k.useContext(Sn),{matches:n}=k.useContext(jn),{pathname:i}=Ui(),l=JSON.stringify(X0(n)),o=k.useRef(!1);return _1(()=>{o.current=!0}),k.useCallback((h,u={})=>{if(_n(o.current,v1),!o.current)return;if(typeof h=="number"){s.go(h);return}let f=J0(h,JSON.parse(l),i,u.relative==="path");a==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:Li([e,f.pathname])),(u.replace?s.replace:s.push)(f,u.state,u)},[e,s,l,i,a])}var yT=k.createContext(null);function bT(a){let e=k.useContext(jn).outlet;return k.useMemo(()=>e&&k.createElement(yT.Provider,{value:a},e),[e,a])}function N1(){let{matches:a}=k.useContext(jn),e=a[a.length-1];return e?e.params:{}}function Zc(a,{relative:e}={}){let{matches:s}=k.useContext(jn),{pathname:n}=Ui(),i=JSON.stringify(X0(s));return k.useMemo(()=>J0(a,JSON.parse(i),n,e==="path"),[a,i,n,e])}function vT(a,e){return w1(a,e)}function w1(a,e,s,n,i){js(Ao(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:l}=k.useContext(Sn),{matches:o}=k.useContext(jn),d=o[o.length-1],h=d?d.params:{},u=d?d.pathname:"/",f=d?d.pathnameBase:"/",g=d&&d.route;{let C=g&&g.path||"";S1(u,!g||C.endsWith("*")||C.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${C}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${C}"> to <Route path="${C==="/"?"*":`${C}/*`}">.`)}let p=Ui(),b;if(e){let C=typeof e=="string"?Eo(e):e;js(f==="/"||C.pathname?.startsWith(f),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${f}" but pathname "${C.pathname}" was given in the \`location\` prop.`),b=C}else b=p;let y=b.pathname||"/",v=y;if(f!=="/"){let C=f.replace(/^\//,"").split("/");v="/"+y.replace(/^\//,"").split("/").slice(C.length).join("/")}let _=g1(a,{pathname:v});_n(g||_!=null,`No routes matched location "${b.pathname}${b.search}${b.hash}" `),_n(_==null||_[_.length-1].route.element!==void 0||_[_.length-1].route.Component!==void 0||_[_.length-1].route.lazy!==void 0,`Matched leaf route at location "${b.pathname}${b.search}${b.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let N=jT(_&&_.map(C=>Object.assign({},C,{params:Object.assign({},h,C.params),pathname:Li([f,l.encodeLocation?l.encodeLocation(C.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:C.pathname]),pathnameBase:C.pathnameBase==="/"?f:Li([f,l.encodeLocation?l.encodeLocation(C.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:C.pathnameBase])})),o,s,n,i);return e&&N?k.createElement(Xc.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...b},navigationType:"POP"}},N):N}function _T(){let a=kT(),e=uT(a)?`${a.status} ${a.statusText}`:a instanceof Error?a.message:JSON.stringify(a),s=a instanceof Error?a.stack:null,n="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:n},l={padding:"2px 4px",backgroundColor:n},o=null;return console.error("Error handled by React Router default ErrorBoundary:",a),o=k.createElement(k.Fragment,null,k.createElement("p",null," Hey developer "),k.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",k.createElement("code",{style:l},"ErrorBoundary")," or"," ",k.createElement("code",{style:l},"errorElement")," prop on your route.")),k.createElement(k.Fragment,null,k.createElement("h2",null,"Unexpected Application Error!"),k.createElement("h3",{style:{fontStyle:"italic"}},e),s?k.createElement("pre",{style:i},s):null,o)}var NT=k.createElement(_T,null),wT=class extends k.Component{constructor(a){super(a),this.state={location:a.location,revalidation:a.revalidation,error:a.error}}static getDerivedStateFromError(a){return{error:a}}static getDerivedStateFromProps(a,e){return e.location!==a.location||e.revalidation!=="idle"&&a.revalidation==="idle"?{error:a.error,location:a.location,revalidation:a.revalidation}:{error:a.error!==void 0?a.error:e.error,location:e.location,revalidation:a.revalidation||e.revalidation}}componentDidCatch(a,e){this.props.onError?this.props.onError(a,e):console.error("React Router caught the following error during render",a)}render(){return this.state.error!==void 0?k.createElement(jn.Provider,{value:this.props.routeContext},k.createElement(Z0.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function ST({routeContext:a,match:e,children:s}){let n=k.useContext(To);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),k.createElement(jn.Provider,{value:a},s)}function jT(a,e=[],s=null,n=null,i=null){if(a==null){if(!s)return null;if(s.errors)a=s.matches;else if(e.length===0&&!s.initialized&&s.matches.length>0)a=s.matches;else return null}let l=a,o=s?.errors;if(o!=null){let f=l.findIndex(g=>g.route.id&&o?.[g.route.id]!==void 0);js(f>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),l=l.slice(0,Math.min(l.length,f+1))}let d=!1,h=-1;if(s)for(let f=0;f<l.length;f++){let g=l[f];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(h=f),g.route.id){let{loaderData:p,errors:b}=s,y=g.route.loader&&!p.hasOwnProperty(g.route.id)&&(!b||b[g.route.id]===void 0);if(g.route.lazy||y){d=!0,h>=0?l=l.slice(0,h+1):l=[l[0]];break}}}let u=s&&n?(f,g)=>{n(f,{location:s.location,params:s.matches?.[0]?.params??{},unstable_pattern:hT(s.matches),errorInfo:g})}:void 0;return l.reduceRight((f,g,p)=>{let b,y=!1,v=null,_=null;s&&(b=o&&g.route.id?o[g.route.id]:void 0,v=g.route.errorElement||NT,d&&(h<0&&p===0?(S1("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),y=!0,_=null):h===p&&(y=!0,_=g.route.hydrateFallbackElement||null)));let N=e.concat(l.slice(0,p+1)),C=()=>{let T;return b?T=v:y?T=_:g.route.Component?T=k.createElement(g.route.Component,null):g.route.element?T=g.route.element:T=f,k.createElement(ST,{match:g,routeContext:{outlet:f,matches:N,isDataRoute:s!=null},children:T})};return s&&(g.route.ErrorBoundary||g.route.errorElement||p===0)?k.createElement(wT,{location:s.location,revalidation:s.revalidation,component:v,error:b,children:C(),routeContext:{outlet:null,matches:N,isDataRoute:!0},onError:u}):C()},null)}function ep(a){return`${a} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function ET(a){let e=k.useContext(To);return js(e,ep(a)),e}function TT(a){let e=k.useContext(Fh);return js(e,ep(a)),e}function AT(a){let e=k.useContext(jn);return js(e,ep(a)),e}function tp(a){let e=AT(a),s=e.matches[e.matches.length-1];return js(s.route.id,`${a} can only be used on routes that contain a unique "id"`),s.route.id}function CT(){return tp("useRouteId")}function kT(){let a=k.useContext(Z0),e=TT("useRouteError"),s=tp("useRouteError");return a!==void 0?a:e.errors?.[s]}function RT(){let{router:a}=ET("useNavigate"),e=tp("useNavigate"),s=k.useRef(!1);return _1(()=>{s.current=!0}),k.useCallback(async(i,l={})=>{_n(s.current,v1),s.current&&(typeof i=="number"?await a.navigate(i):await a.navigate(i,{fromRouteId:e,...l}))},[a,e])}var Ov={};function S1(a,e,s){!e&&!Ov[a]&&(Ov[a]=!0,_n(!1,s))}k.memo(LT);function LT({routes:a,future:e,state:s,unstable_onError:n}){return w1(a,void 0,s,n,e)}function j1({to:a,replace:e,state:s,relative:n}){js(Ao(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=k.useContext(Sn);_n(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:l}=k.useContext(jn),{pathname:o}=Ui(),d=Jc(),h=J0(a,X0(l),o,n==="path"),u=JSON.stringify(h);return k.useEffect(()=>{d(JSON.parse(u),{replace:e,state:s,relative:n})},[d,u,n,e,s]),null}function DT(a){return bT(a.context)}function mt(a){js(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function MT({basename:a="/",children:e=null,location:s,navigationType:n="POP",navigator:i,static:l=!1,unstable_useTransitions:o}){js(!Ao(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let d=a.replace(/^\/*/,"/"),h=k.useMemo(()=>({basename:d,navigator:i,static:l,unstable_useTransitions:o,future:{}}),[d,i,l,o]);typeof s=="string"&&(s=Eo(s));let{pathname:u="/",search:f="",hash:g="",state:p=null,key:b="default"}=s,y=k.useMemo(()=>{let v=Ii(u,d);return v==null?null:{location:{pathname:v,search:f,hash:g,state:p,key:b},navigationType:n}},[d,u,f,g,p,b,n]);return _n(y!=null,`<Router basename="${d}"> is not able to match the URL "${u}${f}${g}" because it does not start with the basename, so the <Router> won't render anything.`),y==null?null:k.createElement(Sn.Provider,{value:h},k.createElement(Xc.Provider,{children:e,value:y}))}function IT({children:a,location:e}){return vT(Zg(a),e)}function Zg(a,e=[]){let s=[];return k.Children.forEach(a,(n,i)=>{if(!k.isValidElement(n))return;let l=[...e,i];if(n.type===k.Fragment){s.push.apply(s,Zg(n.props.children,l));return}js(n.type===mt,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),js(!n.props.index||!n.props.children,"An index route cannot have child routes.");let o={id:n.props.id||l.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,middleware:n.props.middleware,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=Zg(n.props.children,l)),s.push(o)}),s}var zu="get",Yu="application/x-www-form-urlencoded";function Bh(a){return typeof HTMLElement<"u"&&a instanceof HTMLElement}function PT(a){return Bh(a)&&a.tagName.toLowerCase()==="button"}function OT(a){return Bh(a)&&a.tagName.toLowerCase()==="form"}function FT(a){return Bh(a)&&a.tagName.toLowerCase()==="input"}function BT(a){return!!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)}function UT(a,e){return a.button===0&&(!e||e==="_self")&&!BT(a)}var xu=null;function $T(){if(xu===null)try{new FormData(document.createElement("form"),0),xu=!1}catch{xu=!0}return xu}var GT=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function cg(a){return a!=null&&!GT.has(a)?(_n(!1,`"${a}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Yu}"`),null):a}function VT(a,e){let s,n,i,l,o;if(OT(a)){let d=a.getAttribute("action");n=d?Ii(d,e):null,s=a.getAttribute("method")||zu,i=cg(a.getAttribute("enctype"))||Yu,l=new FormData(a)}else if(PT(a)||FT(a)&&(a.type==="submit"||a.type==="image")){let d=a.form;if(d==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=a.getAttribute("formaction")||d.getAttribute("action");if(n=h?Ii(h,e):null,s=a.getAttribute("formmethod")||d.getAttribute("method")||zu,i=cg(a.getAttribute("formenctype"))||cg(d.getAttribute("enctype"))||Yu,l=new FormData(d,a),!$T()){let{name:u,type:f,value:g}=a;if(f==="image"){let p=u?`${u}.`:"";l.append(`${p}x`,"0"),l.append(`${p}y`,"0")}else u&&l.append(u,g)}}else{if(Bh(a))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');s=zu,n=null,i=Yu,o=a}return l&&i==="text/plain"&&(o=l,l=void 0),{action:n,method:s.toLowerCase(),encType:i,formData:l,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function sp(a,e){if(a===!1||a===null||typeof a>"u")throw new Error(e)}function qT(a,e,s){let n=typeof a=="string"?new URL(a,typeof window>"u"?"server://singlefetch/":window.location.origin):a;return n.pathname==="/"?n.pathname=`_root.${s}`:e&&Ii(n.pathname,e)==="/"?n.pathname=`${e.replace(/\/$/,"")}/_root.${s}`:n.pathname=`${n.pathname.replace(/\/$/,"")}.${s}`,n}async function KT(a,e){if(a.id in e)return e[a.id];try{let s=await import(a.module);return e[a.id]=s,s}catch(s){return console.error(`Error loading route module \`${a.module}\`, reloading page...`),console.error(s),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function HT(a){return a==null?!1:a.href==null?a.rel==="preload"&&typeof a.imageSrcSet=="string"&&typeof a.imageSizes=="string":typeof a.rel=="string"&&typeof a.href=="string"}async function zT(a,e,s){let n=await Promise.all(a.map(async i=>{let l=e.routes[i.route.id];if(l){let o=await KT(l,s);return o.links?o.links():[]}return[]}));return XT(n.flat(1).filter(HT).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function Fv(a,e,s,n,i,l){let o=(h,u)=>s[u]?h.route.id!==s[u].route.id:!0,d=(h,u)=>s[u].pathname!==h.pathname||s[u].route.path?.endsWith("*")&&s[u].params["*"]!==h.params["*"];return l==="assets"?e.filter((h,u)=>o(h,u)||d(h,u)):l==="data"?e.filter((h,u)=>{let f=n.routes[h.route.id];if(!f||!f.hasLoader)return!1;if(o(h,u)||d(h,u))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:s[0]?.params||{},nextUrl:new URL(a,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function YT(a,e,{includeHydrateFallback:s}={}){return WT(a.map(n=>{let i=e.routes[n.route.id];if(!i)return[];let l=[i.module];return i.clientActionModule&&(l=l.concat(i.clientActionModule)),i.clientLoaderModule&&(l=l.concat(i.clientLoaderModule)),s&&i.hydrateFallbackModule&&(l=l.concat(i.hydrateFallbackModule)),i.imports&&(l=l.concat(i.imports)),l}).flat(1))}function WT(a){return[...new Set(a)]}function QT(a){let e={},s=Object.keys(a).sort();for(let n of s)e[n]=a[n];return e}function XT(a,e){let s=new Set;return new Set(e),a.reduce((n,i)=>{let l=JSON.stringify(QT(i));return s.has(l)||(s.add(l),n.push({key:l,link:i})),n},[])}function E1(){let a=k.useContext(To);return sp(a,"You must render this element inside a <DataRouterContext.Provider> element"),a}function JT(){let a=k.useContext(Fh);return sp(a,"You must render this element inside a <DataRouterStateContext.Provider> element"),a}var ap=k.createContext(void 0);ap.displayName="FrameworkContext";function T1(){let a=k.useContext(ap);return sp(a,"You must render this element inside a <HydratedRouter> element"),a}function ZT(a,e){let s=k.useContext(ap),[n,i]=k.useState(!1),[l,o]=k.useState(!1),{onFocus:d,onBlur:h,onMouseEnter:u,onMouseLeave:f,onTouchStart:g}=e,p=k.useRef(null);k.useEffect(()=>{if(a==="render"&&o(!0),a==="viewport"){let v=N=>{N.forEach(C=>{o(C.isIntersecting)})},_=new IntersectionObserver(v,{threshold:.5});return p.current&&_.observe(p.current),()=>{_.disconnect()}}},[a]),k.useEffect(()=>{if(n){let v=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(v)}}},[n]);let b=()=>{i(!0)},y=()=>{i(!1),o(!1)};return s?a!=="intent"?[l,p,{}]:[l,p,{onFocus:jc(d,b),onBlur:jc(h,y),onMouseEnter:jc(u,b),onMouseLeave:jc(f,y),onTouchStart:jc(g,b)}]:[!1,p,{}]}function jc(a,e){return s=>{a&&a(s),s.defaultPrevented||e(s)}}function eA({page:a,...e}){let{router:s}=E1(),n=k.useMemo(()=>g1(s.routes,a,s.basename),[s.routes,a,s.basename]);return n?k.createElement(sA,{page:a,matches:n,...e}):null}function tA(a){let{manifest:e,routeModules:s}=T1(),[n,i]=k.useState([]);return k.useEffect(()=>{let l=!1;return zT(a,e,s).then(o=>{l||i(o)}),()=>{l=!0}},[a,e,s]),n}function sA({page:a,matches:e,...s}){let n=Ui(),{manifest:i,routeModules:l}=T1(),{basename:o}=E1(),{loaderData:d,matches:h}=JT(),u=k.useMemo(()=>Fv(a,e,h,i,n,"data"),[a,e,h,i,n]),f=k.useMemo(()=>Fv(a,e,h,i,n,"assets"),[a,e,h,i,n]),g=k.useMemo(()=>{if(a===n.pathname+n.search+n.hash)return[];let y=new Set,v=!1;if(e.forEach(N=>{let C=i.routes[N.route.id];!C||!C.hasLoader||(!u.some(T=>T.route.id===N.route.id)&&N.route.id in d&&l[N.route.id]?.shouldRevalidate||C.hasClientLoader?v=!0:y.add(N.route.id))}),y.size===0)return[];let _=qT(a,o,"data");return v&&y.size>0&&_.searchParams.set("_routes",e.filter(N=>y.has(N.route.id)).map(N=>N.route.id).join(",")),[_.pathname+_.search]},[o,d,n,i,u,e,a,l]),p=k.useMemo(()=>YT(f,i),[f,i]),b=tA(f);return k.createElement(k.Fragment,null,g.map(y=>k.createElement("link",{key:y,rel:"prefetch",as:"fetch",href:y,...s})),p.map(y=>k.createElement("link",{key:y,rel:"modulepreload",href:y,...s})),b.map(({key:y,link:v})=>k.createElement("link",{key:y,nonce:s.nonce,...v})))}function aA(...a){return e=>{a.forEach(s=>{typeof s=="function"?s(e):s!=null&&(s.current=e)})}}var A1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{A1&&(window.__reactRouterVersion="7.10.1")}catch{}function nA({basename:a,children:e,unstable_useTransitions:s,window:n}){let i=k.useRef();i.current==null&&(i.current=$2({window:n,v5Compat:!0}));let l=i.current,[o,d]=k.useState({action:l.action,location:l.location}),h=k.useCallback(u=>{s===!1?d(u):k.startTransition(()=>d(u))},[s]);return k.useLayoutEffect(()=>l.listen(h),[l,h]),k.createElement(MT,{basename:a,children:e,location:o.location,navigationType:o.action,navigator:l,unstable_useTransitions:s===!0})}var C1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ss=k.forwardRef(function({onClick:e,discover:s="render",prefetch:n="none",relative:i,reloadDocument:l,replace:o,state:d,target:h,to:u,preventScrollReset:f,viewTransition:g,...p},b){let{basename:y,unstable_useTransitions:v}=k.useContext(Sn),_=typeof u=="string"&&C1.test(u),N,C=!1;if(typeof u=="string"&&_&&(N=u,A1))try{let D=new URL(window.location.href),O=u.startsWith("//")?new URL(D.protocol+u):new URL(u),ee=Ii(O.pathname,y);O.origin===D.origin&&ee!=null?u=ee+O.search+O.hash:C=!0}catch{_n(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let T=pT(u,{relative:i}),[L,F,H]=ZT(n,p),B=oA(u,{replace:o,state:d,target:h,preventScrollReset:f,relative:i,viewTransition:g,unstable_useTransitions:v});function P(D){e&&e(D),D.defaultPrevented||B(D)}let I=k.createElement("a",{...p,...H,href:N||T,onClick:C||l?e:P,ref:aA(b,F),target:h,"data-discover":!_&&s==="render"?"true":void 0});return L&&!_?k.createElement(k.Fragment,null,I,k.createElement(eA,{page:T})):I});Ss.displayName="Link";var iA=k.forwardRef(function({"aria-current":e="page",caseSensitive:s=!1,className:n="",end:i=!1,style:l,to:o,viewTransition:d,children:h,...u},f){let g=Zc(o,{relative:u.relative}),p=Ui(),b=k.useContext(Fh),{navigator:y,basename:v}=k.useContext(Sn),_=b!=null&&fA(g)&&d===!0,N=y.encodeLocation?y.encodeLocation(g).pathname:g.pathname,C=p.pathname,T=b&&b.navigation&&b.navigation.location?b.navigation.location.pathname:null;s||(C=C.toLowerCase(),T=T?T.toLowerCase():null,N=N.toLowerCase()),T&&v&&(T=Ii(T,v)||T);const L=N!=="/"&&N.endsWith("/")?N.length-1:N.length;let F=C===N||!i&&C.startsWith(N)&&C.charAt(L)==="/",H=T!=null&&(T===N||!i&&T.startsWith(N)&&T.charAt(N.length)==="/"),B={isActive:F,isPending:H,isTransitioning:_},P=F?e:void 0,I;typeof n=="function"?I=n(B):I=[n,F?"active":null,H?"pending":null,_?"transitioning":null].filter(Boolean).join(" ");let D=typeof l=="function"?l(B):l;return k.createElement(Ss,{...u,"aria-current":P,className:I,ref:f,style:D,to:o,viewTransition:d},typeof h=="function"?h(B):h)});iA.displayName="NavLink";var rA=k.forwardRef(({discover:a="render",fetcherKey:e,navigate:s,reloadDocument:n,replace:i,state:l,method:o=zu,action:d,onSubmit:h,relative:u,preventScrollReset:f,viewTransition:g,...p},b)=>{let{unstable_useTransitions:y}=k.useContext(Sn),v=uA(),_=hA(d,{relative:u}),N=o.toLowerCase()==="get"?"get":"post",C=typeof d=="string"&&C1.test(d),T=L=>{if(h&&h(L),L.defaultPrevented)return;L.preventDefault();let F=L.nativeEvent.submitter,H=F?.getAttribute("formmethod")||o,B=()=>v(F||L.currentTarget,{fetcherKey:e,method:H,navigate:s,replace:i,state:l,relative:u,preventScrollReset:f,viewTransition:g});y&&s!==!1?k.startTransition(()=>B()):B()};return k.createElement("form",{ref:b,method:N,action:_,onSubmit:n?h:T,...p,"data-discover":!C&&a==="render"?"true":void 0})});rA.displayName="Form";function lA(a){return`${a} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function k1(a){let e=k.useContext(To);return js(e,lA(a)),e}function oA(a,{target:e,replace:s,state:n,preventScrollReset:i,relative:l,viewTransition:o,unstable_useTransitions:d}={}){let h=Jc(),u=Ui(),f=Zc(a,{relative:l});return k.useCallback(g=>{if(UT(g,e)){g.preventDefault();let p=s!==void 0?s:Uc(u)===Uc(f),b=()=>h(a,{replace:p,state:n,preventScrollReset:i,relative:l,viewTransition:o});d?k.startTransition(()=>b()):b()}},[u,h,f,s,n,e,a,i,l,o,d])}var cA=0,dA=()=>`__${String(++cA)}__`;function uA(){let{router:a}=k1("useSubmit"),{basename:e}=k.useContext(Sn),s=CT(),n=a.fetch,i=a.navigate;return k.useCallback(async(l,o={})=>{let{action:d,method:h,encType:u,formData:f,body:g}=VT(l,e);if(o.navigate===!1){let p=o.fetcherKey||dA();await n(p,s,o.action||d,{preventScrollReset:o.preventScrollReset,formData:f,body:g,formMethod:o.method||h,formEncType:o.encType||u,flushSync:o.flushSync})}else await i(o.action||d,{preventScrollReset:o.preventScrollReset,formData:f,body:g,formMethod:o.method||h,formEncType:o.encType||u,replace:o.replace,state:o.state,fromRouteId:s,flushSync:o.flushSync,viewTransition:o.viewTransition})},[n,i,e,s])}function hA(a,{relative:e}={}){let{basename:s}=k.useContext(Sn),n=k.useContext(jn);js(n,"useFormAction must be used inside a RouteContext");let[i]=n.matches.slice(-1),l={...Zc(a||".",{relative:e})},o=Ui();if(a==null){l.search=o.search;let d=new URLSearchParams(l.search),h=d.getAll("index");if(h.some(f=>f==="")){d.delete("index"),h.filter(g=>g).forEach(g=>d.append("index",g));let f=d.toString();l.search=f?`?${f}`:""}}return(!a||a===".")&&i.route.index&&(l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index"),s!=="/"&&(l.pathname=l.pathname==="/"?s:Li([s,l.pathname])),Uc(l)}function fA(a,{relative:e}={}){let s=k.useContext(b1);js(s!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=k1("useViewTransitionState"),i=Zc(a,{relative:e});if(!s.isTransitioning)return!1;let l=Ii(s.currentLocation.pathname,n)||s.currentLocation.pathname,o=Ii(s.nextLocation.pathname,n)||s.nextLocation.pathname;return hh(i.pathname,o)!=null||hh(i.pathname,l)!=null}var Co=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(a){return this.listeners.add(a),this.onSubscribe(),()=>{this.listeners.delete(a),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},mA={setTimeout:(a,e)=>setTimeout(a,e),clearTimeout:a=>clearTimeout(a),setInterval:(a,e)=>setInterval(a,e),clearInterval:a=>clearInterval(a)},gA=class{#e=mA;#t=!1;setTimeoutProvider(a){this.#e=a}setTimeout(a,e){return this.#e.setTimeout(a,e)}clearTimeout(a){this.#e.clearTimeout(a)}setInterval(a,e){return this.#e.setInterval(a,e)}clearInterval(a){this.#e.clearInterval(a)}},ul=new gA;function pA(a){setTimeout(a,0)}var pl=typeof window>"u"||"Deno"in globalThis;function _a(){}function xA(a,e){return typeof a=="function"?a(e):a}function e0(a){return typeof a=="number"&&a>=0&&a!==1/0}function R1(a,e){return Math.max(a+(e||0)-Date.now(),0)}function _r(a,e){return typeof a=="function"?a(e):a}function bn(a,e){return typeof a=="function"?a(e):a}function Bv(a,e){const{type:s="all",exact:n,fetchStatus:i,predicate:l,queryKey:o,stale:d}=a;if(o){if(n){if(e.queryHash!==np(o,e.options))return!1}else if(!$c(e.queryKey,o))return!1}if(s!=="all"){const h=e.isActive();if(s==="active"&&!h||s==="inactive"&&h)return!1}return!(typeof d=="boolean"&&e.isStale()!==d||i&&i!==e.state.fetchStatus||l&&!l(e))}function Uv(a,e){const{exact:s,status:n,predicate:i,mutationKey:l}=a;if(l){if(!e.options.mutationKey)return!1;if(s){if(xl(e.options.mutationKey)!==xl(l))return!1}else if(!$c(e.options.mutationKey,l))return!1}return!(n&&e.state.status!==n||i&&!i(e))}function np(a,e){return(e?.queryKeyHashFn||xl)(a)}function xl(a){return JSON.stringify(a,(e,s)=>t0(s)?Object.keys(s).sort().reduce((n,i)=>(n[i]=s[i],n),{}):s)}function $c(a,e){return a===e?!0:typeof a!=typeof e?!1:a&&e&&typeof a=="object"&&typeof e=="object"?Object.keys(e).every(s=>$c(a[s],e[s])):!1}var yA=Object.prototype.hasOwnProperty;function L1(a,e){if(a===e)return a;const s=$v(a)&&$v(e);if(!s&&!(t0(a)&&t0(e)))return e;const i=(s?a:Object.keys(a)).length,l=s?e:Object.keys(e),o=l.length,d=s?new Array(o):{};let h=0;for(let u=0;u<o;u++){const f=s?u:l[u],g=a[f],p=e[f];if(g===p){d[f]=g,(s?u<i:yA.call(a,f))&&h++;continue}if(g===null||p===null||typeof g!="object"||typeof p!="object"){d[f]=p;continue}const b=L1(g,p);d[f]=b,b===g&&h++}return i===o&&h===i?a:d}function fh(a,e){if(!e||Object.keys(a).length!==Object.keys(e).length)return!1;for(const s in a)if(a[s]!==e[s])return!1;return!0}function $v(a){return Array.isArray(a)&&a.length===Object.keys(a).length}function t0(a){if(!Gv(a))return!1;const e=a.constructor;if(e===void 0)return!0;const s=e.prototype;return!(!Gv(s)||!s.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(a)!==Object.prototype)}function Gv(a){return Object.prototype.toString.call(a)==="[object Object]"}function bA(a){return new Promise(e=>{ul.setTimeout(e,a)})}function s0(a,e,s){return typeof s.structuralSharing=="function"?s.structuralSharing(a,e):s.structuralSharing!==!1?L1(a,e):e}function vA(a,e,s=0){const n=[...a,e];return s&&n.length>s?n.slice(1):n}function _A(a,e,s=0){const n=[e,...a];return s&&n.length>s?n.slice(0,-1):n}var ip=Symbol();function D1(a,e){return!a.queryFn&&e?.initialPromise?()=>e.initialPromise:!a.queryFn||a.queryFn===ip?()=>Promise.reject(new Error(`Missing queryFn: '${a.queryHash}'`)):a.queryFn}function M1(a,e){return typeof a=="function"?a(...e):!!a}var NA=class extends Co{#e;#t;#s;constructor(){super(),this.#s=a=>{if(!pl&&window.addEventListener){const e=()=>a();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(a){this.#s=a,this.#t?.(),this.#t=a(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(a){this.#e!==a&&(this.#e=a,this.onFocus())}onFocus(){const a=this.isFocused();this.listeners.forEach(e=>{e(a)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},rp=new NA;function a0(){let a,e;const s=new Promise((i,l)=>{a=i,e=l});s.status="pending",s.catch(()=>{});function n(i){Object.assign(s,i),delete s.resolve,delete s.reject}return s.resolve=i=>{n({status:"fulfilled",value:i}),a(i)},s.reject=i=>{n({status:"rejected",reason:i}),e(i)},s}var wA=pA;function SA(){let a=[],e=0,s=d=>{d()},n=d=>{d()},i=wA;const l=d=>{e?a.push(d):i(()=>{s(d)})},o=()=>{const d=a;a=[],d.length&&i(()=>{n(()=>{d.forEach(h=>{s(h)})})})};return{batch:d=>{let h;e++;try{h=d()}finally{e--,e||o()}return h},batchCalls:d=>(...h)=>{l(()=>{d(...h)})},schedule:l,setNotifyFunction:d=>{s=d},setBatchNotifyFunction:d=>{n=d},setScheduler:d=>{i=d}}}var Js=SA(),jA=class extends Co{#e=!0;#t;#s;constructor(){super(),this.#s=a=>{if(!pl&&window.addEventListener){const e=()=>a(!0),s=()=>a(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",s,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s)}}}}onSubscribe(){this.#t||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(a){this.#s=a,this.#t?.(),this.#t=a(this.setOnline.bind(this))}setOnline(a){this.#e!==a&&(this.#e=a,this.listeners.forEach(s=>{s(a)}))}isOnline(){return this.#e}},mh=new jA;function EA(a){return Math.min(1e3*2**a,3e4)}function I1(a){return(a??"online")==="online"?mh.isOnline():!0}var n0=class extends Error{constructor(a){super("CancelledError"),this.revert=a?.revert,this.silent=a?.silent}};function P1(a){let e=!1,s=0,n;const i=a0(),l=()=>i.status!=="pending",o=v=>{if(!l()){const _=new n0(v);p(_),a.onCancel?.(_)}},d=()=>{e=!0},h=()=>{e=!1},u=()=>rp.isFocused()&&(a.networkMode==="always"||mh.isOnline())&&a.canRun(),f=()=>I1(a.networkMode)&&a.canRun(),g=v=>{l()||(n?.(),i.resolve(v))},p=v=>{l()||(n?.(),i.reject(v))},b=()=>new Promise(v=>{n=_=>{(l()||u())&&v(_)},a.onPause?.()}).then(()=>{n=void 0,l()||a.onContinue?.()}),y=()=>{if(l())return;let v;const _=s===0?a.initialPromise:void 0;try{v=_??a.fn()}catch(N){v=Promise.reject(N)}Promise.resolve(v).then(g).catch(N=>{if(l())return;const C=a.retry??(pl?0:3),T=a.retryDelay??EA,L=typeof T=="function"?T(s,N):T,F=C===!0||typeof C=="number"&&s<C||typeof C=="function"&&C(s,N);if(e||!F){p(N);return}s++,a.onFail?.(s,N),bA(L).then(()=>u()?void 0:b()).then(()=>{e?p(N):y()})})};return{promise:i,status:()=>i.status,cancel:o,continue:()=>(n?.(),i),cancelRetry:d,continueRetry:h,canStart:f,start:()=>(f()?y():b().then(y),i)}}var O1=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),e0(this.gcTime)&&(this.#e=ul.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(a){this.gcTime=Math.max(this.gcTime||0,a??(pl?1/0:300*1e3))}clearGcTimeout(){this.#e&&(ul.clearTimeout(this.#e),this.#e=void 0)}},TA=class extends O1{#e;#t;#s;#n;#a;#r;#l;constructor(a){super(),this.#l=!1,this.#r=a.defaultOptions,this.setOptions(a.options),this.observers=[],this.#n=a.client,this.#s=this.#n.getQueryCache(),this.queryKey=a.queryKey,this.queryHash=a.queryHash,this.#e=qv(this.options),this.state=a.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#a?.promise}setOptions(a){if(this.options={...this.#r,...a},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const e=qv(this.options);e.data!==void 0&&(this.setState(Vv(e.data,e.dataUpdatedAt)),this.#e=e)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#s.remove(this)}setData(a,e){const s=s0(this.state.data,a,this.options);return this.#i({data:s,type:"success",dataUpdatedAt:e?.updatedAt,manual:e?.manual}),s}setState(a,e){this.#i({type:"setState",state:a,setStateOptions:e})}cancel(a){const e=this.#a?.promise;return this.#a?.cancel(a),e?e.then(_a).catch(_a):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(a=>bn(a.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===ip||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(a=>_r(a.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(a=>a.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(a=0){return this.state.data===void 0?!0:a==="static"?!1:this.state.isInvalidated?!0:!R1(this.state.dataUpdatedAt,a)}onFocus(){this.observers.find(e=>e.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#a?.continue()}onOnline(){this.observers.find(e=>e.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#a?.continue()}addObserver(a){this.observers.includes(a)||(this.observers.push(a),this.clearGcTimeout(),this.#s.notify({type:"observerAdded",query:this,observer:a}))}removeObserver(a){this.observers.includes(a)&&(this.observers=this.observers.filter(e=>e!==a),this.observers.length||(this.#a&&(this.#l?this.#a.cancel({revert:!0}):this.#a.cancelRetry()),this.scheduleGc()),this.#s.notify({type:"observerRemoved",query:this,observer:a}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}async fetch(a,e){if(this.state.fetchStatus!=="idle"&&this.#a?.status()!=="rejected"){if(this.state.data!==void 0&&e?.cancelRefetch)this.cancel({silent:!0});else if(this.#a)return this.#a.continueRetry(),this.#a.promise}if(a&&this.setOptions(a),!this.options.queryFn){const d=this.observers.find(h=>h.options.queryFn);d&&this.setOptions(d.options)}const s=new AbortController,n=d=>{Object.defineProperty(d,"signal",{enumerable:!0,get:()=>(this.#l=!0,s.signal)})},i=()=>{const d=D1(this.options,e),u=(()=>{const f={client:this.#n,queryKey:this.queryKey,meta:this.meta};return n(f),f})();return this.#l=!1,this.options.persister?this.options.persister(d,u,this):d(u)},o=(()=>{const d={fetchOptions:e,options:this.options,queryKey:this.queryKey,client:this.#n,state:this.state,fetchFn:i};return n(d),d})();this.options.behavior?.onFetch(o,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==o.fetchOptions?.meta)&&this.#i({type:"fetch",meta:o.fetchOptions?.meta}),this.#a=P1({initialPromise:e?.initialPromise,fn:o.fetchFn,onCancel:d=>{d instanceof n0&&d.revert&&this.setState({...this.#t,fetchStatus:"idle"}),s.abort()},onFail:(d,h)=>{this.#i({type:"failed",failureCount:d,error:h})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0});try{const d=await this.#a.start();if(d===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(d),this.#s.config.onSuccess?.(d,this),this.#s.config.onSettled?.(d,this.state.error,this),d}catch(d){if(d instanceof n0){if(d.silent)return this.#a.promise;if(d.revert){if(this.state.data===void 0)throw d;return this.state.data}}throw this.#i({type:"error",error:d}),this.#s.config.onError?.(d,this),this.#s.config.onSettled?.(this.state.data,d,this),d}finally{this.scheduleGc()}}#i(a){const e=s=>{switch(a.type){case"failed":return{...s,fetchFailureCount:a.failureCount,fetchFailureReason:a.error};case"pause":return{...s,fetchStatus:"paused"};case"continue":return{...s,fetchStatus:"fetching"};case"fetch":return{...s,...F1(s.data,this.options),fetchMeta:a.meta??null};case"success":const n={...s,...Vv(a.data,a.dataUpdatedAt),dataUpdateCount:s.dataUpdateCount+1,...!a.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=a.manual?n:void 0,n;case"error":const i=a.error;return{...s,error:i,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error"};case"invalidate":return{...s,isInvalidated:!0};case"setState":return{...s,...a.state}}};this.state=e(this.state),Js.batch(()=>{this.observers.forEach(s=>{s.onQueryUpdate()}),this.#s.notify({query:this,type:"updated",action:a})})}};function F1(a,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:I1(e.networkMode)?"fetching":"paused",...a===void 0&&{error:null,status:"pending"}}}function Vv(a,e){return{data:a,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function qv(a){const e=typeof a.initialData=="function"?a.initialData():a.initialData,s=e!==void 0,n=s?typeof a.initialDataUpdatedAt=="function"?a.initialDataUpdatedAt():a.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:s?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:s?"success":"pending",fetchStatus:"idle"}}var AA=class extends Co{constructor(a,e){super(),this.options=e,this.#e=a,this.#i=null,this.#l=a0(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#s=void 0;#n=void 0;#a;#r;#l;#i;#g;#h;#f;#c;#d;#o;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),Kv(this.#t,this.options)?this.#u():this.updateResult(),this.#b())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return i0(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return i0(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#_(),this.#t.removeObserver(this)}setOptions(a){const e=this.options,s=this.#t;if(this.options=this.#e.defaultQueryOptions(a),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof bn(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#N(),this.#t.setOptions(this.options),e._defaulted&&!fh(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const n=this.hasListeners();n&&Hv(this.#t,s,this.options,e)&&this.#u(),this.updateResult(),n&&(this.#t!==s||bn(this.options.enabled,this.#t)!==bn(e.enabled,this.#t)||_r(this.options.staleTime,this.#t)!==_r(e.staleTime,this.#t))&&this.#p();const i=this.#x();n&&(this.#t!==s||bn(this.options.enabled,this.#t)!==bn(e.enabled,this.#t)||i!==this.#o)&&this.#y(i)}getOptimisticResult(a){const e=this.#e.getQueryCache().build(this.#e,a),s=this.createResult(e,a);return kA(this,s)&&(this.#n=s,this.#r=this.options,this.#a=this.#t.state),s}getCurrentResult(){return this.#n}trackResult(a,e){return new Proxy(a,{get:(s,n)=>(this.trackProp(n),e?.(n),n==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#l.status==="pending"&&this.#l.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(s,n))})}trackProp(a){this.#m.add(a)}getCurrentQuery(){return this.#t}refetch({...a}={}){return this.fetch({...a})}fetchOptimistic(a){const e=this.#e.defaultQueryOptions(a),s=this.#e.getQueryCache().build(this.#e,e);return s.fetch().then(()=>this.createResult(s,e))}fetch(a){return this.#u({...a,cancelRefetch:a.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#n))}#u(a){this.#N();let e=this.#t.fetch(this.options,a);return a?.throwOnError||(e=e.catch(_a)),e}#p(){this.#v();const a=_r(this.options.staleTime,this.#t);if(pl||this.#n.isStale||!e0(a))return;const s=R1(this.#n.dataUpdatedAt,a)+1;this.#c=ul.setTimeout(()=>{this.#n.isStale||this.updateResult()},s)}#x(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#y(a){this.#_(),this.#o=a,!(pl||bn(this.options.enabled,this.#t)===!1||!e0(this.#o)||this.#o===0)&&(this.#d=ul.setInterval(()=>{(this.options.refetchIntervalInBackground||rp.isFocused())&&this.#u()},this.#o))}#b(){this.#p(),this.#y(this.#x())}#v(){this.#c&&(ul.clearTimeout(this.#c),this.#c=void 0)}#_(){this.#d&&(ul.clearInterval(this.#d),this.#d=void 0)}createResult(a,e){const s=this.#t,n=this.options,i=this.#n,l=this.#a,o=this.#r,h=a!==s?a.state:this.#s,{state:u}=a;let f={...u},g=!1,p;if(e._optimisticResults){const P=this.hasListeners(),I=!P&&Kv(a,e),D=P&&Hv(a,s,e,n);(I||D)&&(f={...f,...F1(u.data,a.options)}),e._optimisticResults==="isRestoring"&&(f.fetchStatus="idle")}let{error:b,errorUpdatedAt:y,status:v}=f;p=f.data;let _=!1;if(e.placeholderData!==void 0&&p===void 0&&v==="pending"){let P;i?.isPlaceholderData&&e.placeholderData===o?.placeholderData?(P=i.data,_=!0):P=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,P!==void 0&&(v="success",p=s0(i?.data,P,e),g=!0)}if(e.select&&p!==void 0&&!_)if(i&&p===l?.data&&e.select===this.#g)p=this.#h;else try{this.#g=e.select,p=e.select(p),p=s0(i?.data,p,e),this.#h=p,this.#i=null}catch(P){this.#i=P}this.#i&&(b=this.#i,p=this.#h,y=Date.now(),v="error");const N=f.fetchStatus==="fetching",C=v==="pending",T=v==="error",L=C&&N,F=p!==void 0,B={status:v,fetchStatus:f.fetchStatus,isPending:C,isSuccess:v==="success",isError:T,isInitialLoading:L,isLoading:L,data:p,dataUpdatedAt:f.dataUpdatedAt,error:b,errorUpdatedAt:y,failureCount:f.fetchFailureCount,failureReason:f.fetchFailureReason,errorUpdateCount:f.errorUpdateCount,isFetched:f.dataUpdateCount>0||f.errorUpdateCount>0,isFetchedAfterMount:f.dataUpdateCount>h.dataUpdateCount||f.errorUpdateCount>h.errorUpdateCount,isFetching:N,isRefetching:N&&!C,isLoadingError:T&&!F,isPaused:f.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:T&&F,isStale:lp(a,e),refetch:this.refetch,promise:this.#l,isEnabled:bn(e.enabled,a)!==!1};if(this.options.experimental_prefetchInRender){const P=O=>{B.status==="error"?O.reject(B.error):B.data!==void 0&&O.resolve(B.data)},I=()=>{const O=this.#l=B.promise=a0();P(O)},D=this.#l;switch(D.status){case"pending":a.queryHash===s.queryHash&&P(D);break;case"fulfilled":(B.status==="error"||B.data!==D.value)&&I();break;case"rejected":(B.status!=="error"||B.error!==D.reason)&&I();break}}return B}updateResult(){const a=this.#n,e=this.createResult(this.#t,this.options);if(this.#a=this.#t.state,this.#r=this.options,this.#a.data!==void 0&&(this.#f=this.#t),fh(e,a))return;this.#n=e;const s=()=>{if(!a)return!0;const{notifyOnChangeProps:n}=this.options,i=typeof n=="function"?n():n;if(i==="all"||!i&&!this.#m.size)return!0;const l=new Set(i??this.#m);return this.options.throwOnError&&l.add("error"),Object.keys(this.#n).some(o=>{const d=o;return this.#n[d]!==a[d]&&l.has(d)})};this.#w({listeners:s()})}#N(){const a=this.#e.getQueryCache().build(this.#e,this.options);if(a===this.#t)return;const e=this.#t;this.#t=a,this.#s=a.state,this.hasListeners()&&(e?.removeObserver(this),a.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#b()}#w(a){Js.batch(()=>{a.listeners&&this.listeners.forEach(e=>{e(this.#n)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function CA(a,e){return bn(e.enabled,a)!==!1&&a.state.data===void 0&&!(a.state.status==="error"&&e.retryOnMount===!1)}function Kv(a,e){return CA(a,e)||a.state.data!==void 0&&i0(a,e,e.refetchOnMount)}function i0(a,e,s){if(bn(e.enabled,a)!==!1&&_r(e.staleTime,a)!=="static"){const n=typeof s=="function"?s(a):s;return n==="always"||n!==!1&&lp(a,e)}return!1}function Hv(a,e,s,n){return(a!==e||bn(n.enabled,a)===!1)&&(!s.suspense||a.state.status!=="error")&&lp(a,s)}function lp(a,e){return bn(e.enabled,a)!==!1&&a.isStaleByTime(_r(e.staleTime,a))}function kA(a,e){return!fh(a.getCurrentResult(),e)}function zv(a){return{onFetch:(e,s)=>{const n=e.options,i=e.fetchOptions?.meta?.fetchMore?.direction,l=e.state.data?.pages||[],o=e.state.data?.pageParams||[];let d={pages:[],pageParams:[]},h=0;const u=async()=>{let f=!1;const g=y=>{Object.defineProperty(y,"signal",{enumerable:!0,get:()=>(e.signal.aborted?f=!0:e.signal.addEventListener("abort",()=>{f=!0}),e.signal)})},p=D1(e.options,e.fetchOptions),b=async(y,v,_)=>{if(f)return Promise.reject();if(v==null&&y.pages.length)return Promise.resolve(y);const C=(()=>{const H={client:e.client,queryKey:e.queryKey,pageParam:v,direction:_?"backward":"forward",meta:e.options.meta};return g(H),H})(),T=await p(C),{maxPages:L}=e.options,F=_?_A:vA;return{pages:F(y.pages,T,L),pageParams:F(y.pageParams,v,L)}};if(i&&l.length){const y=i==="backward",v=y?RA:Yv,_={pages:l,pageParams:o},N=v(n,_);d=await b(_,N,y)}else{const y=a??l.length;do{const v=h===0?o[0]??n.initialPageParam:Yv(n,d);if(h>0&&v==null)break;d=await b(d,v),h++}while(h<y)}return d};e.options.persister?e.fetchFn=()=>e.options.persister?.(u,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},s):e.fetchFn=u}}}function Yv(a,{pages:e,pageParams:s}){const n=e.length-1;return e.length>0?a.getNextPageParam(e[n],e,s[n],s):void 0}function RA(a,{pages:e,pageParams:s}){return e.length>0?a.getPreviousPageParam?.(e[0],e,s[0],s):void 0}var LA=class extends O1{#e;#t;#s;#n;constructor(a){super(),this.#e=a.client,this.mutationId=a.mutationId,this.#s=a.mutationCache,this.#t=[],this.state=a.state||B1(),this.setOptions(a.options),this.scheduleGc()}setOptions(a){this.options=a,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(a){this.#t.includes(a)||(this.#t.push(a),this.clearGcTimeout(),this.#s.notify({type:"observerAdded",mutation:this,observer:a}))}removeObserver(a){this.#t=this.#t.filter(e=>e!==a),this.scheduleGc(),this.#s.notify({type:"observerRemoved",mutation:this,observer:a})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#s.remove(this))}continue(){return this.#n?.continue()??this.execute(this.state.variables)}async execute(a){const e=()=>{this.#a({type:"continue"})},s={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#n=P1({fn:()=>this.options.mutationFn?this.options.mutationFn(a,s):Promise.reject(new Error("No mutationFn found")),onFail:(l,o)=>{this.#a({type:"failed",failureCount:l,error:o})},onPause:()=>{this.#a({type:"pause"})},onContinue:e,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#s.canRun(this)});const n=this.state.status==="pending",i=!this.#n.canStart();try{if(n)e();else{this.#a({type:"pending",variables:a,isPaused:i}),await this.#s.config.onMutate?.(a,this,s);const o=await this.options.onMutate?.(a,s);o!==this.state.context&&this.#a({type:"pending",context:o,variables:a,isPaused:i})}const l=await this.#n.start();return await this.#s.config.onSuccess?.(l,a,this.state.context,this,s),await this.options.onSuccess?.(l,a,this.state.context,s),await this.#s.config.onSettled?.(l,null,this.state.variables,this.state.context,this,s),await this.options.onSettled?.(l,null,a,this.state.context,s),this.#a({type:"success",data:l}),l}catch(l){try{throw await this.#s.config.onError?.(l,a,this.state.context,this,s),await this.options.onError?.(l,a,this.state.context,s),await this.#s.config.onSettled?.(void 0,l,this.state.variables,this.state.context,this,s),await this.options.onSettled?.(void 0,l,a,this.state.context,s),l}finally{this.#a({type:"error",error:l})}}finally{this.#s.runNext(this)}}#a(a){const e=s=>{switch(a.type){case"failed":return{...s,failureCount:a.failureCount,failureReason:a.error};case"pause":return{...s,isPaused:!0};case"continue":return{...s,isPaused:!1};case"pending":return{...s,context:a.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:a.isPaused,status:"pending",variables:a.variables,submittedAt:Date.now()};case"success":return{...s,data:a.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...s,data:void 0,error:a.error,failureCount:s.failureCount+1,failureReason:a.error,isPaused:!1,status:"error"}}};this.state=e(this.state),Js.batch(()=>{this.#t.forEach(s=>{s.onMutationUpdate(a)}),this.#s.notify({mutation:this,type:"updated",action:a})})}};function B1(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var DA=class extends Co{constructor(a={}){super(),this.config=a,this.#e=new Set,this.#t=new Map,this.#s=0}#e;#t;#s;build(a,e,s){const n=new LA({client:a,mutationCache:this,mutationId:++this.#s,options:a.defaultMutationOptions(e),state:s});return this.add(n),n}add(a){this.#e.add(a);const e=yu(a);if(typeof e=="string"){const s=this.#t.get(e);s?s.push(a):this.#t.set(e,[a])}this.notify({type:"added",mutation:a})}remove(a){if(this.#e.delete(a)){const e=yu(a);if(typeof e=="string"){const s=this.#t.get(e);if(s)if(s.length>1){const n=s.indexOf(a);n!==-1&&s.splice(n,1)}else s[0]===a&&this.#t.delete(e)}}this.notify({type:"removed",mutation:a})}canRun(a){const e=yu(a);if(typeof e=="string"){const n=this.#t.get(e)?.find(i=>i.state.status==="pending");return!n||n===a}else return!0}runNext(a){const e=yu(a);return typeof e=="string"?this.#t.get(e)?.find(n=>n!==a&&n.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){Js.batch(()=>{this.#e.forEach(a=>{this.notify({type:"removed",mutation:a})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(a){const e={exact:!0,...a};return this.getAll().find(s=>Uv(e,s))}findAll(a={}){return this.getAll().filter(e=>Uv(a,e))}notify(a){Js.batch(()=>{this.listeners.forEach(e=>{e(a)})})}resumePausedMutations(){const a=this.getAll().filter(e=>e.state.isPaused);return Js.batch(()=>Promise.all(a.map(e=>e.continue().catch(_a))))}};function yu(a){return a.options.scope?.id}var MA=class extends Co{#e;#t=void 0;#s;#n;constructor(e,s){super(),this.#e=e,this.setOptions(s),this.bindMethods(),this.#a()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const s=this.options;this.options=this.#e.defaultMutationOptions(e),fh(this.options,s)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#s,observer:this}),s?.mutationKey&&this.options.mutationKey&&xl(s.mutationKey)!==xl(this.options.mutationKey)?this.reset():this.#s?.state.status==="pending"&&this.#s.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#s?.removeObserver(this)}onMutationUpdate(e){this.#a(),this.#r(e)}getCurrentResult(){return this.#t}reset(){this.#s?.removeObserver(this),this.#s=void 0,this.#a(),this.#r()}mutate(e,s){return this.#n=s,this.#s?.removeObserver(this),this.#s=this.#e.getMutationCache().build(this.#e,this.options),this.#s.addObserver(this),this.#s.execute(e)}#a(){const e=this.#s?.state??B1();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#r(e){Js.batch(()=>{if(this.#n&&this.hasListeners()){const s=this.#t.variables,n=this.#t.context,i={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#n.onSuccess?.(e.data,s,n,i),this.#n.onSettled?.(e.data,null,s,n,i)):e?.type==="error"&&(this.#n.onError?.(e.error,s,n,i),this.#n.onSettled?.(void 0,e.error,s,n,i))}this.listeners.forEach(s=>{s(this.#t)})})}},IA=class extends Co{constructor(a={}){super(),this.config=a,this.#e=new Map}#e;build(a,e,s){const n=e.queryKey,i=e.queryHash??np(n,e);let l=this.get(i);return l||(l=new TA({client:a,queryKey:n,queryHash:i,options:a.defaultQueryOptions(e),state:s,defaultOptions:a.getQueryDefaults(n)}),this.add(l)),l}add(a){this.#e.has(a.queryHash)||(this.#e.set(a.queryHash,a),this.notify({type:"added",query:a}))}remove(a){const e=this.#e.get(a.queryHash);e&&(a.destroy(),e===a&&this.#e.delete(a.queryHash),this.notify({type:"removed",query:a}))}clear(){Js.batch(()=>{this.getAll().forEach(a=>{this.remove(a)})})}get(a){return this.#e.get(a)}getAll(){return[...this.#e.values()]}find(a){const e={exact:!0,...a};return this.getAll().find(s=>Bv(e,s))}findAll(a={}){const e=this.getAll();return Object.keys(a).length>0?e.filter(s=>Bv(a,s)):e}notify(a){Js.batch(()=>{this.listeners.forEach(e=>{e(a)})})}onFocus(){Js.batch(()=>{this.getAll().forEach(a=>{a.onFocus()})})}onOnline(){Js.batch(()=>{this.getAll().forEach(a=>{a.onOnline()})})}},PA=class{#e;#t;#s;#n;#a;#r;#l;#i;constructor(a={}){this.#e=a.queryCache||new IA,this.#t=a.mutationCache||new DA,this.#s=a.defaultOptions||{},this.#n=new Map,this.#a=new Map,this.#r=0}mount(){this.#r++,this.#r===1&&(this.#l=rp.subscribe(async a=>{a&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#i=mh.subscribe(async a=>{a&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#r--,this.#r===0&&(this.#l?.(),this.#l=void 0,this.#i?.(),this.#i=void 0)}isFetching(a){return this.#e.findAll({...a,fetchStatus:"fetching"}).length}isMutating(a){return this.#t.findAll({...a,status:"pending"}).length}getQueryData(a){const e=this.defaultQueryOptions({queryKey:a});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(a){const e=this.defaultQueryOptions(a),s=this.#e.build(this,e),n=s.state.data;return n===void 0?this.fetchQuery(a):(a.revalidateIfStale&&s.isStaleByTime(_r(e.staleTime,s))&&this.prefetchQuery(e),Promise.resolve(n))}getQueriesData(a){return this.#e.findAll(a).map(({queryKey:e,state:s})=>{const n=s.data;return[e,n]})}setQueryData(a,e,s){const n=this.defaultQueryOptions({queryKey:a}),l=this.#e.get(n.queryHash)?.state.data,o=xA(e,l);if(o!==void 0)return this.#e.build(this,n).setData(o,{...s,manual:!0})}setQueriesData(a,e,s){return Js.batch(()=>this.#e.findAll(a).map(({queryKey:n})=>[n,this.setQueryData(n,e,s)]))}getQueryState(a){const e=this.defaultQueryOptions({queryKey:a});return this.#e.get(e.queryHash)?.state}removeQueries(a){const e=this.#e;Js.batch(()=>{e.findAll(a).forEach(s=>{e.remove(s)})})}resetQueries(a,e){const s=this.#e;return Js.batch(()=>(s.findAll(a).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...a},e)))}cancelQueries(a,e={}){const s={revert:!0,...e},n=Js.batch(()=>this.#e.findAll(a).map(i=>i.cancel(s)));return Promise.all(n).then(_a).catch(_a)}invalidateQueries(a,e={}){return Js.batch(()=>(this.#e.findAll(a).forEach(s=>{s.invalidate()}),a?.refetchType==="none"?Promise.resolve():this.refetchQueries({...a,type:a?.refetchType??a?.type??"active"},e)))}refetchQueries(a,e={}){const s={...e,cancelRefetch:e.cancelRefetch??!0},n=Js.batch(()=>this.#e.findAll(a).filter(i=>!i.isDisabled()&&!i.isStatic()).map(i=>{let l=i.fetch(void 0,s);return s.throwOnError||(l=l.catch(_a)),i.state.fetchStatus==="paused"?Promise.resolve():l}));return Promise.all(n).then(_a)}fetchQuery(a){const e=this.defaultQueryOptions(a);e.retry===void 0&&(e.retry=!1);const s=this.#e.build(this,e);return s.isStaleByTime(_r(e.staleTime,s))?s.fetch(e):Promise.resolve(s.state.data)}prefetchQuery(a){return this.fetchQuery(a).then(_a).catch(_a)}fetchInfiniteQuery(a){return a.behavior=zv(a.pages),this.fetchQuery(a)}prefetchInfiniteQuery(a){return this.fetchInfiniteQuery(a).then(_a).catch(_a)}ensureInfiniteQueryData(a){return a.behavior=zv(a.pages),this.ensureQueryData(a)}resumePausedMutations(){return mh.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#s}setDefaultOptions(a){this.#s=a}setQueryDefaults(a,e){this.#n.set(xl(a),{queryKey:a,defaultOptions:e})}getQueryDefaults(a){const e=[...this.#n.values()],s={};return e.forEach(n=>{$c(a,n.queryKey)&&Object.assign(s,n.defaultOptions)}),s}setMutationDefaults(a,e){this.#a.set(xl(a),{mutationKey:a,defaultOptions:e})}getMutationDefaults(a){const e=[...this.#a.values()],s={};return e.forEach(n=>{$c(a,n.mutationKey)&&Object.assign(s,n.defaultOptions)}),s}defaultQueryOptions(a){if(a._defaulted)return a;const e={...this.#s.queries,...this.getQueryDefaults(a.queryKey),...a,_defaulted:!0};return e.queryHash||(e.queryHash=np(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===ip&&(e.enabled=!1),e}defaultMutationOptions(a){return a?._defaulted?a:{...this.#s.mutations,...a?.mutationKey&&this.getMutationDefaults(a.mutationKey),...a,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},U1=k.createContext(void 0),at=a=>{const e=k.useContext(U1);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},OA=({client:a,children:e})=>(k.useEffect(()=>(a.mount(),()=>{a.unmount()}),[a]),t.jsx(U1.Provider,{value:a,children:e})),$1=k.createContext(!1),FA=()=>k.useContext($1);$1.Provider;function BA(){let a=!1;return{clearReset:()=>{a=!1},reset:()=>{a=!0},isReset:()=>a}}var UA=k.createContext(BA()),$A=()=>k.useContext(UA),GA=(a,e)=>{(a.suspense||a.throwOnError||a.experimental_prefetchInRender)&&(e.isReset()||(a.retryOnMount=!1))},VA=a=>{k.useEffect(()=>{a.clearReset()},[a])},qA=({result:a,errorResetBoundary:e,throwOnError:s,query:n,suspense:i})=>a.isError&&!e.isReset()&&!a.isFetching&&n&&(i&&a.data===void 0||M1(s,[a.error,n])),KA=a=>{if(a.suspense){const s=i=>i==="static"?i:Math.max(i??1e3,1e3),n=a.staleTime;a.staleTime=typeof n=="function"?(...i)=>s(n(...i)):s(n),typeof a.gcTime=="number"&&(a.gcTime=Math.max(a.gcTime,1e3))}},HA=(a,e)=>a.isLoading&&a.isFetching&&!e,zA=(a,e)=>a?.suspense&&e.isPending,Wv=(a,e,s)=>e.fetchOptimistic(a).catch(()=>{s.clearReset()});function YA(a,e,s){const n=FA(),i=$A(),l=at(),o=l.defaultQueryOptions(a);l.getDefaultOptions().queries?._experimental_beforeQuery?.(o),o._optimisticResults=n?"isRestoring":"optimistic",KA(o),GA(o,i),VA(i);const d=!l.getQueryCache().get(o.queryHash),[h]=k.useState(()=>new e(l,o)),u=h.getOptimisticResult(o),f=!n&&a.subscribed!==!1;if(k.useSyncExternalStore(k.useCallback(g=>{const p=f?h.subscribe(Js.batchCalls(g)):_a;return h.updateResult(),p},[h,f]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),k.useEffect(()=>{h.setOptions(o)},[o,h]),zA(o,u))throw Wv(o,h,i);if(qA({result:u,errorResetBoundary:i,throwOnError:o.throwOnError,query:l.getQueryCache().get(o.queryHash),suspense:o.suspense}))throw u.error;return l.getDefaultOptions().queries?._experimental_afterQuery?.(o,u),o.experimental_prefetchInRender&&!pl&&HA(u,n)&&(d?Wv(o,h,i):l.getQueryCache().get(o.queryHash)?.promise)?.catch(_a).finally(()=>{h.updateResult()}),o.notifyOnChangeProps?u:h.trackResult(u)}function Fe(a,e){return YA(a,AA)}function Me(a,e){const s=at(),[n]=k.useState(()=>new MA(s,a));k.useEffect(()=>{n.setOptions(a)},[n,a]);const i=k.useSyncExternalStore(k.useCallback(o=>n.subscribe(Js.batchCalls(o)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),l=k.useCallback((o,d)=>{n.mutate(o,d).catch(_a)},[n]);if(i.error&&M1(n.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:l,mutateAsync:i.mutate}}const WA=a=>a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),QA=a=>a.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,s,n)=>n?n.toUpperCase():s.toLowerCase()),Qv=a=>{const e=QA(a);return e.charAt(0).toUpperCase()+e.slice(1)},G1=(...a)=>a.filter((e,s,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===s).join(" ").trim(),XA=a=>{for(const e in a)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};var JA={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const ZA=k.forwardRef(({color:a="currentColor",size:e=24,strokeWidth:s=2,absoluteStrokeWidth:n,className:i="",children:l,iconNode:o,...d},h)=>k.createElement("svg",{ref:h,...JA,width:e,height:e,stroke:a,strokeWidth:n?Number(s)*24/Number(e):s,className:G1("lucide",i),...!l&&!XA(d)&&{"aria-hidden":"true"},...d},[...o.map(([u,f])=>k.createElement(u,f)),...Array.isArray(l)?l:[l]]));const Ce=(a,e)=>{const s=k.forwardRef(({className:n,...i},l)=>k.createElement(ZA,{ref:l,iconNode:e,className:G1(`lucide-${WA(Qv(a))}`,`lucide-${a}`,n),...i}));return s.displayName=Qv(a),s};const eC=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Wu=Ce("activity",eC);const tC=[["path",{d:"M12 6.528V3a1 1 0 0 1 1-1h0",key:"11qiee"}],["path",{d:"M18.237 21A15 15 0 0 0 22 11a6 6 0 0 0-10-4.472A6 6 0 0 0 2 11a15.1 15.1 0 0 0 3.763 10 3 3 0 0 0 3.648.648 5.5 5.5 0 0 1 5.178 0A3 3 0 0 0 18.237 21",key:"110c12"}]],r0=Ce("apple",tC);const sC=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],aC=Ce("archive",sC);const nC=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],ed=Ce("arrow-down",nC);const iC=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Er=Ce("arrow-left",iC);const rC=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],l0=Ce("arrow-right",rC);const lC=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],V1=Ce("arrow-up-down",lC);const oC=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],Uh=Ce("arrow-up",oC);const cC=[["path",{d:"M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5",key:"1u7htd"}],["path",{d:"M15 12h.01",key:"1k8ypt"}],["path",{d:"M19.38 6.813A9 9 0 0 1 20.8 10.2a2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1",key:"11xh7x"}],["path",{d:"M9 12h.01",key:"157uk2"}]],Gc=Ce("baby",cC);const dC=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],q1=Ce("bell",dC);const uC=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],hC=Ce("bookmark",uC);const fC=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],o0=Ce("calendar-days",fC);const mC=[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M17 14h-6",key:"bkmgh3"}],["path",{d:"M13 18H7",key:"bb0bb7"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 18h.01",key:"1bdyru"}]],gC=Ce("calendar-range",mC);const pC=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],sn=Ce("calendar",pC);const xC=[["rect",{width:"18",height:"14",x:"3",y:"5",rx:"2",ry:"2",key:"12ruh7"}],["path",{d:"M7 15h4M15 15h2M7 11h2M13 11h4",key:"1ueiar"}]],c0=Ce("captions",xC);const yC=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Bs=Ce("check",yC);const bC=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Pn=Ce("chevron-down",bC);const vC=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],ko=Ce("chevron-left",vC);const _C=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Ba=Ce("chevron-right",_C);const NC=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],op=Ce("chevron-up",NC);const wC=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],kt=Ce("circle-alert",wC);const SC=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Xt=Ce("circle-check-big",SC);const jC=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],vn=Ce("circle-check",jC);const EC=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]],yl=Ce("circle-dot",EC);const TC=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]],AC=Ce("circle-pause",TC);const CC=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],kC=Ce("circle-play",CC);const RC=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]],LC=Ce("circle-stop",RC);const DC=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Ua=Ce("circle-x",DC);const MC=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],fl=Ce("circle",MC);const IC=[["path",{d:"M20.2 6 3 11l-.9-2.4c-.3-1.1.3-2.2 1.3-2.5l13.5-4c1.1-.3 2.2.3 2.5 1.3Z",key:"1tn4o7"}],["path",{d:"m6.2 5.3 3.1 3.9",key:"iuk76l"}],["path",{d:"m12.4 3.4 3.1 4",key:"6hsd6n"}],["path",{d:"M3 11h18v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Z",key:"ltgou9"}]],$h=Ce("clapperboard",IC);const PC=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Kt=Ce("clock",PC);const OC=[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]],Mc=Ce("cloud-download",OC);const FC=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],d0=Ce("copy",FC);const BC=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],Nr=Ce("cpu",BC);const UC=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 12a9 3 0 0 0 5 2.69",key:"1ui2ym"}],["path",{d:"M21 9.3V5",key:"6k6cib"}],["path",{d:"M3 5v14a9 3 0 0 0 6.47 2.88",key:"i62tjy"}],["path",{d:"M12 12v4h4",key:"1bxaet"}],["path",{d:"M13 20a5 5 0 0 0 9-3 4.5 4.5 0 0 0-4.5-4.5c-1.33 0-2.54.54-3.41 1.41L12 16",key:"1f4ei9"}]],$C=Ce("database-backup",UC);const GC=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],gh=Ce("database",GC);const VC=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],gs=Ce("download",VC);const qC=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],KC=Ce("ellipsis",qC);const HC=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],zC=Ce("external-link",HC);const YC=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],fo=Ce("eye-off",YC);const WC=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Pi=Ce("eye",WC);const QC=[["path",{d:"M12.659 22H18a2 2 0 0 0 2-2V8a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 14 2H6a2 2 0 0 0-2 2v9.34",key:"o6klzx"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10.378 12.622a1 1 0 0 1 3 3.003L8.36 20.637a2 2 0 0 1-.854.506l-2.867.837a.5.5 0 0 1-.62-.62l.836-2.869a2 2 0 0 1 .506-.853z",key:"zhnas1"}]],ph=Ce("file-pen",QC);const XC=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M15.033 13.44a.647.647 0 0 1 0 1.12l-4.065 2.352a.645.645 0 0 1-.968-.56v-4.704a.645.645 0 0 1 .967-.56z",key:"1tzo1f"}]],JC=Ce("file-play",XC);const ZC=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M12 17h.01",key:"p32p05"}],["path",{d:"M9.1 9a3 3 0 0 1 5.82 1c0 2-3 3-3 3",key:"mhlwft"}]],e4=Ce("file-question-mark",ZC);const t4=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],wa=Ce("file-text",t4);const s4=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]],K1=Ce("file",s4);const a4=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]],Gt=Ce("film",a4);const n4=[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]],i4=Ce("flask-conical",n4);const r4=[["path",{d:"M10.638 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v3.417",key:"10r6g4"}],["path",{d:"M14.62 18.8A2.25 2.25 0 1 1 18 15.836a2.25 2.25 0 1 1 3.38 2.966l-2.626 2.856a.998.998 0 0 1-1.507 0z",key:"15cy7q"}]],l4=Ce("folder-heart",r4);const o4=[["path",{d:"M2 9V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-1",key:"fm4g5t"}],["path",{d:"M2 13h10",key:"pgb2dq"}],["path",{d:"m9 16 3-3-3-3",key:"6m91ic"}]],co=Ce("folder-input",o4);const c4=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],sa=Ce("folder-open",c4);const d4=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],Gh=Ce("folder-plus",d4);const u4=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],h4=Ce("folder",u4);const f4=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],H1=Ce("funnel",f4);const m4=[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]],u0=Ce("gauge",m4);const g4=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],vo=Ce("globe",g4);const p4=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],cp=Ce("grip-vertical",p4);const x4=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],$a=Ce("hard-drive",x4);const y4=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],dp=Ce("hash",y4);const b4=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],v4=Ce("history",b4);const _4=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],N4=Ce("house",_4);const w4=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Oi=Ce("image",w4);const S4=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],j4=Ce("info",S4);const E4=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Fi=Ce("layers",E4);const T4=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],A4=Ce("layout-dashboard",T4);const C4=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],z1=Ce("layout-grid",C4);const k4=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]],Qu=Ce("layout-list",k4);const R4=[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]],L4=Ce("library",R4);const D4=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],bu=Ce("link-2",D4);const M4=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],I4=Ce("link",M4);const P4=[["path",{d:"M2 5h20",key:"1fs1ex"}],["path",{d:"M6 12h12",key:"8npq4p"}],["path",{d:"M9 19h6",key:"456am0"}]],Y1=Ce("list-filter",P4);const O4=[["path",{d:"M16 5H3",key:"m91uny"}],["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M11 19H3",key:"zflm78"}],["path",{d:"M21 16V5",key:"yxg4q8"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]],h0=Ce("list-music",O4);const F4=[["path",{d:"M11 5h10",key:"1cz7ny"}],["path",{d:"M11 12h10",key:"1438ji"}],["path",{d:"M11 19h10",key:"11t30w"}],["path",{d:"M4 4h1v5",key:"10yrso"}],["path",{d:"M4 9h2",key:"r1h2o0"}],["path",{d:"M6.5 20H3.4c0-1 2.6-1.925 2.6-3.5a1.5 1.5 0 0 0-2.6-1.02",key:"xtkcd5"}]],xh=Ce("list-ordered",F4);const B4=[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["rect",{x:"3",y:"4",width:"6",height:"6",rx:"1",key:"cif1o7"}]],f0=Ce("list-todo",B4);const U4=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],yh=Ce("list",U4);const $4=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],tn=Ce("loader-circle",$4);const G4=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],Ke=Ce("loader",G4);const V4=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Xu=Ce("lock",V4);const q4=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],K4=Ce("log-out",q4);const H4=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],z4=Ce("map-pin",H4);const Y4=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],up=Ce("maximize",Y4);const W4=[["path",{d:"M12 12v-2",key:"fwoke6"}],["path",{d:"M12 18v-2",key:"qj6yno"}],["path",{d:"M16 12v-2",key:"heuere"}],["path",{d:"M16 18v-2",key:"s1ct0w"}],["path",{d:"M2 11h1.5",key:"15p63e"}],["path",{d:"M20 18v-2",key:"12ehxp"}],["path",{d:"M20.5 11H22",key:"khsy7a"}],["path",{d:"M4 18v-2",key:"1c3oqr"}],["path",{d:"M8 12v-2",key:"1mwtfd"}],["path",{d:"M8 18v-2",key:"qcmpov"}],["rect",{x:"2",y:"6",width:"20",height:"10",rx:"2",key:"1qcswk"}]],W1=Ce("memory-stick",W4);const Q4=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],X4=Ce("menu",Q4);const J4=[["path",{d:"M18 8V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h8",key:"10dyio"}],["path",{d:"M10 19v-3.96 3.15",key:"1irgej"}],["path",{d:"M7 19h5",key:"qswx4l"}],["rect",{width:"6",height:"10",x:"16",y:"12",rx:"2",key:"1egngj"}]],Q1=Ce("monitor-smartphone",J4);const Z4=[["path",{d:"M15.033 9.44a.647.647 0 0 1 0 1.12l-4.065 2.352a.645.645 0 0 1-.968-.56V7.648a.645.645 0 0 1 .967-.56z",key:"vbtd3f"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"M8 21h8",key:"1ev6f3"}],["rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",key:"x3v2xh"}]],_o=Ce("monitor-play",Z4);const ek=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],wr=Ce("monitor",ek);const tk=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],sk=Ce("moon",tk);const ak=[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]],nk=Ce("music",ak);const ik=[["path",{d:"M15 18h-5",key:"95g1m2"}],["path",{d:"M18 14h-8",key:"sponae"}],["path",{d:"M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-4 0v-9a2 2 0 0 1 2-2h2",key:"39pd36"}],["rect",{width:"8",height:"4",x:"10",y:"6",rx:"1",key:"aywv1n"}]],X1=Ce("newspaper",ik);const rk=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],lk=Ce("package",rk);const ok=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],bh=Ce("palette",ok);const ck=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]],dk=Ce("panels-top-left",ck);const uk=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],Bi=Ce("pause",uk);const hk=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],fk=Ce("pen",hk);const mk=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],gk=Ce("pencil",mk);const pk=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],xs=Ce("play",pk);const xk=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Pt=Ce("plus",xk);const yk=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],m0=Ce("power",yk);const bk=[["path",{d:"M15.39 4.39a1 1 0 0 0 1.68-.474 2.5 2.5 0 1 1 3.014 3.015 1 1 0 0 0-.474 1.68l1.683 1.682a2.414 2.414 0 0 1 0 3.414L19.61 15.39a1 1 0 0 1-1.68-.474 2.5 2.5 0 1 0-3.014 3.015 1 1 0 0 1 .474 1.68l-1.683 1.682a2.414 2.414 0 0 1-3.414 0L8.61 19.61a1 1 0 0 0-1.68.474 2.5 2.5 0 1 1-3.014-3.015 1 1 0 0 0 .474-1.68l-1.683-1.682a2.414 2.414 0 0 1 0-3.414L4.39 8.61a1 1 0 0 1 1.68.474 2.5 2.5 0 1 0 3.014-3.015 1 1 0 0 1-.474-1.68l1.683-1.682a2.414 2.414 0 0 1 3.414 0z",key:"w46dr5"}]],vk=Ce("puzzle",bk);const _k=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],Nk=Ce("qr-code",_k);const wk=[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],$s=Ce("radio",wk);const Sk=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],ut=Ce("refresh-cw",Sk);const jk=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],hp=Ce("repeat",jk);const Ek=[["path",{d:"M12 6a2 2 0 0 0-3.414-1.414l-6 6a2 2 0 0 0 0 2.828l6 6A2 2 0 0 0 12 18z",key:"2a1g8i"}],["path",{d:"M22 6a2 2 0 0 0-3.414-1.414l-6 6a2 2 0 0 0 0 2.828l6 6A2 2 0 0 0 22 18z",key:"rg3s36"}]],J1=Ce("rewind",Ek);const Tk=[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]],Z1=Ce("rocket",Tk);const Ak=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],g0=Ce("rotate-ccw",Ak);const Ck=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],ii=Ce("save",Ck);const kk=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]],vu=Ce("scan-line",kk);const Rk=[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]],vh=Ce("scissors",Rk);const Lk=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],xt=Ce("search",Lk);const Dk=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],dg=Ce("send",Dk);const Mk=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],td=Ce("server",Mk);const Ik=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],Pk=Ce("settings-2",Ik);const Ok=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],si=Ce("settings",Ok);const Fk=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]],Bk=Ce("shield-off",Fk);const Uk=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],ew=Ce("shield",Uk);const $k=[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]],tw=Ce("shuffle",$k);const Gk=[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}],["path",{d:"M17 20V8",key:"1tkaf5"}],["path",{d:"M22 4v16",key:"sih9yq"}]],Vk=Ce("signal",Gk);const qk=[["path",{d:"M17.971 4.285A2 2 0 0 1 21 6v12a2 2 0 0 1-3.029 1.715l-9.997-5.998a2 2 0 0 1-.003-3.432z",key:"15892j"}],["path",{d:"M3 20V4",key:"1ptbpl"}]],sw=Ce("skip-back",qk);const Kk=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],Vh=Ce("skip-forward",Kk);const Hk=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],zk=Ce("sliders-horizontal",Hk);const Yk=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],ei=Ce("smartphone",Yk);const Wk=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],aw=Ce("sparkles",Wk);const Qk=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],nw=Ce("square-check-big",Qk);const Xk=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],an=Ce("square-pen",Xk);const Jk=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],iw=Ce("square",Jk);const Zk=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Di=Ce("star",Zk);const eR=[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]],tR=Ce("stethoscope",eR);const sR=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],aR=Ce("sun",sR);const nR=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],Vc=Ce("tag",nR);const iR=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],rw=Ce("timer",iR);const rR=[["circle",{cx:"9",cy:"12",r:"3",key:"u3jwor"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],Ic=Ce("toggle-left",rR);const lR=[["circle",{cx:"15",cy:"12",r:"3",key:"1afu0r"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],Pc=Ce("toggle-right",lR);const oR=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Dt=Ce("trash-2",oR);const cR=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ps=Ce("triangle-alert",cR);const dR=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],ti=Ce("trophy",dR);const uR=[["path",{d:"M7 21h10",key:"1b0cd5"}],["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}]],p0=Ce("tv-minimal",uR);const hR=[["path",{d:"m17 2-5 5-5-5",key:"16satq"}],["rect",{width:"20",height:"15",x:"2",y:"7",rx:"2",key:"1e6viu"}]],jt=Ce("tv",hR);const fR=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Mi=Ce("upload",fR);const mR=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],gR=Ce("user",mR);const pR=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],qh=Ce("users",pR);const xR=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],Nn=Ce("video",xR);const yR=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],fp=Ce("volume-2",yR);const bR=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],mp=Ce("volume-x",bR);const vR=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],Sr=Ce("wand-sparkles",vR);const _R=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],NR=Ce("wifi-off",_R);const wR=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],No=Ce("wifi",wR);const SR=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],nt=Ce("x",SR);const jR=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],xa=Ce("zap",jR);function lw(a,e){return function(){return a.apply(e,arguments)}}const{toString:ER}=Object.prototype,{getPrototypeOf:gp}=Object,{iterator:Kh,toStringTag:ow}=Symbol,Hh=(a=>e=>{const s=ER.call(e);return a[s]||(a[s]=s.slice(8,-1).toLowerCase())})(Object.create(null)),On=a=>(a=a.toLowerCase(),e=>Hh(e)===a),zh=a=>e=>typeof e===a,{isArray:Ro}=Array,wo=zh("undefined");function sd(a){return a!==null&&!wo(a)&&a.constructor!==null&&!wo(a.constructor)&&Oa(a.constructor.isBuffer)&&a.constructor.isBuffer(a)}const cw=On("ArrayBuffer");function TR(a){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(a):e=a&&a.buffer&&cw(a.buffer),e}const AR=zh("string"),Oa=zh("function"),dw=zh("number"),ad=a=>a!==null&&typeof a=="object",CR=a=>a===!0||a===!1,Ju=a=>{if(Hh(a)!=="object")return!1;const e=gp(a);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(ow in a)&&!(Kh in a)},kR=a=>{if(!ad(a)||sd(a))return!1;try{return Object.keys(a).length===0&&Object.getPrototypeOf(a)===Object.prototype}catch{return!1}},RR=On("Date"),LR=On("File"),DR=On("Blob"),MR=On("FileList"),IR=a=>ad(a)&&Oa(a.pipe),PR=a=>{let e;return a&&(typeof FormData=="function"&&a instanceof FormData||Oa(a.append)&&((e=Hh(a))==="formdata"||e==="object"&&Oa(a.toString)&&a.toString()==="[object FormData]"))},OR=On("URLSearchParams"),[FR,BR,UR,$R]=["ReadableStream","Request","Response","Headers"].map(On),GR=a=>a.trim?a.trim():a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function nd(a,e,{allOwnKeys:s=!1}={}){if(a===null||typeof a>"u")return;let n,i;if(typeof a!="object"&&(a=[a]),Ro(a))for(n=0,i=a.length;n<i;n++)e.call(null,a[n],n,a);else{if(sd(a))return;const l=s?Object.getOwnPropertyNames(a):Object.keys(a),o=l.length;let d;for(n=0;n<o;n++)d=l[n],e.call(null,a[d],d,a)}}function uw(a,e){if(sd(a))return null;e=e.toLowerCase();const s=Object.keys(a);let n=s.length,i;for(;n-- >0;)if(i=s[n],e===i.toLowerCase())return i;return null}const hl=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,hw=a=>!wo(a)&&a!==hl;function x0(){const{caseless:a,skipUndefined:e}=hw(this)&&this||{},s={},n=(i,l)=>{const o=a&&uw(s,l)||l;Ju(s[o])&&Ju(i)?s[o]=x0(s[o],i):Ju(i)?s[o]=x0({},i):Ro(i)?s[o]=i.slice():(!e||!wo(i))&&(s[o]=i)};for(let i=0,l=arguments.length;i<l;i++)arguments[i]&&nd(arguments[i],n);return s}const VR=(a,e,s,{allOwnKeys:n}={})=>(nd(e,(i,l)=>{s&&Oa(i)?a[l]=lw(i,s):a[l]=i},{allOwnKeys:n}),a),qR=a=>(a.charCodeAt(0)===65279&&(a=a.slice(1)),a),KR=(a,e,s,n)=>{a.prototype=Object.create(e.prototype,n),a.prototype.constructor=a,Object.defineProperty(a,"super",{value:e.prototype}),s&&Object.assign(a.prototype,s)},HR=(a,e,s,n)=>{let i,l,o;const d={};if(e=e||{},a==null)return e;do{for(i=Object.getOwnPropertyNames(a),l=i.length;l-- >0;)o=i[l],(!n||n(o,a,e))&&!d[o]&&(e[o]=a[o],d[o]=!0);a=s!==!1&&gp(a)}while(a&&(!s||s(a,e))&&a!==Object.prototype);return e},zR=(a,e,s)=>{a=String(a),(s===void 0||s>a.length)&&(s=a.length),s-=e.length;const n=a.indexOf(e,s);return n!==-1&&n===s},YR=a=>{if(!a)return null;if(Ro(a))return a;let e=a.length;if(!dw(e))return null;const s=new Array(e);for(;e-- >0;)s[e]=a[e];return s},WR=(a=>e=>a&&e instanceof a)(typeof Uint8Array<"u"&&gp(Uint8Array)),QR=(a,e)=>{const n=(a&&a[Kh]).call(a);let i;for(;(i=n.next())&&!i.done;){const l=i.value;e.call(a,l[0],l[1])}},XR=(a,e)=>{let s;const n=[];for(;(s=a.exec(e))!==null;)n.push(s);return n},JR=On("HTMLFormElement"),ZR=a=>a.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(s,n,i){return n.toUpperCase()+i}),Xv=(({hasOwnProperty:a})=>(e,s)=>a.call(e,s))(Object.prototype),eL=On("RegExp"),fw=(a,e)=>{const s=Object.getOwnPropertyDescriptors(a),n={};nd(s,(i,l)=>{let o;(o=e(i,l,a))!==!1&&(n[l]=o||i)}),Object.defineProperties(a,n)},tL=a=>{fw(a,(e,s)=>{if(Oa(a)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const n=a[s];if(Oa(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")})}})},sL=(a,e)=>{const s={},n=i=>{i.forEach(l=>{s[l]=!0})};return Ro(a)?n(a):n(String(a).split(e)),s},aL=()=>{},nL=(a,e)=>a!=null&&Number.isFinite(a=+a)?a:e;function iL(a){return!!(a&&Oa(a.append)&&a[ow]==="FormData"&&a[Kh])}const rL=a=>{const e=new Array(10),s=(n,i)=>{if(ad(n)){if(e.indexOf(n)>=0)return;if(sd(n))return n;if(!("toJSON"in n)){e[i]=n;const l=Ro(n)?[]:{};return nd(n,(o,d)=>{const h=s(o,i+1);!wo(h)&&(l[d]=h)}),e[i]=void 0,l}}return n};return s(a,0)},lL=On("AsyncFunction"),oL=a=>a&&(ad(a)||Oa(a))&&Oa(a.then)&&Oa(a.catch),mw=((a,e)=>a?setImmediate:e?((s,n)=>(hl.addEventListener("message",({source:i,data:l})=>{i===hl&&l===s&&n.length&&n.shift()()},!1),i=>{n.push(i),hl.postMessage(s,"*")}))(`axios@${Math.random()}`,[]):s=>setTimeout(s))(typeof setImmediate=="function",Oa(hl.postMessage)),cL=typeof queueMicrotask<"u"?queueMicrotask.bind(hl):typeof process<"u"&&process.nextTick||mw,dL=a=>a!=null&&Oa(a[Kh]),ke={isArray:Ro,isArrayBuffer:cw,isBuffer:sd,isFormData:PR,isArrayBufferView:TR,isString:AR,isNumber:dw,isBoolean:CR,isObject:ad,isPlainObject:Ju,isEmptyObject:kR,isReadableStream:FR,isRequest:BR,isResponse:UR,isHeaders:$R,isUndefined:wo,isDate:RR,isFile:LR,isBlob:DR,isRegExp:eL,isFunction:Oa,isStream:IR,isURLSearchParams:OR,isTypedArray:WR,isFileList:MR,forEach:nd,merge:x0,extend:VR,trim:GR,stripBOM:qR,inherits:KR,toFlatObject:HR,kindOf:Hh,kindOfTest:On,endsWith:zR,toArray:YR,forEachEntry:QR,matchAll:XR,isHTMLForm:JR,hasOwnProperty:Xv,hasOwnProp:Xv,reduceDescriptors:fw,freezeMethods:tL,toObjectSet:sL,toCamelCase:ZR,noop:aL,toFiniteNumber:nL,findKey:uw,global:hl,isContextDefined:hw,isSpecCompliantForm:iL,toJSONObject:rL,isAsyncFn:lL,isThenable:oL,setImmediate:mw,asap:cL,isIterable:dL};function Ct(a,e,s,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=a,this.name="AxiosError",e&&(this.code=e),s&&(this.config=s),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}ke.inherits(Ct,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ke.toJSONObject(this.config),code:this.code,status:this.status}}});const gw=Ct.prototype,pw={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(a=>{pw[a]={value:a}});Object.defineProperties(Ct,pw);Object.defineProperty(gw,"isAxiosError",{value:!0});Ct.from=(a,e,s,n,i,l)=>{const o=Object.create(gw);ke.toFlatObject(a,o,function(f){return f!==Error.prototype},u=>u!=="isAxiosError");const d=a&&a.message?a.message:"Error",h=e==null&&a?a.code:e;return Ct.call(o,d,h,s,n,i),a&&o.cause==null&&Object.defineProperty(o,"cause",{value:a,configurable:!0}),o.name=a&&a.name||"Error",l&&Object.assign(o,l),o};const uL=null;function y0(a){return ke.isPlainObject(a)||ke.isArray(a)}function xw(a){return ke.endsWith(a,"[]")?a.slice(0,-2):a}function Jv(a,e,s){return a?a.concat(e).map(function(i,l){return i=xw(i),!s&&l?"["+i+"]":i}).join(s?".":""):e}function hL(a){return ke.isArray(a)&&!a.some(y0)}const fL=ke.toFlatObject(ke,{},null,function(e){return/^is[A-Z]/.test(e)});function Yh(a,e,s){if(!ke.isObject(a))throw new TypeError("target must be an object");e=e||new FormData,s=ke.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(v,_){return!ke.isUndefined(_[v])});const n=s.metaTokens,i=s.visitor||f,l=s.dots,o=s.indexes,h=(s.Blob||typeof Blob<"u"&&Blob)&&ke.isSpecCompliantForm(e);if(!ke.isFunction(i))throw new TypeError("visitor must be a function");function u(y){if(y===null)return"";if(ke.isDate(y))return y.toISOString();if(ke.isBoolean(y))return y.toString();if(!h&&ke.isBlob(y))throw new Ct("Blob is not supported. Use a Buffer instead.");return ke.isArrayBuffer(y)||ke.isTypedArray(y)?h&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function f(y,v,_){let N=y;if(y&&!_&&typeof y=="object"){if(ke.endsWith(v,"{}"))v=n?v:v.slice(0,-2),y=JSON.stringify(y);else if(ke.isArray(y)&&hL(y)||(ke.isFileList(y)||ke.endsWith(v,"[]"))&&(N=ke.toArray(y)))return v=xw(v),N.forEach(function(T,L){!(ke.isUndefined(T)||T===null)&&e.append(o===!0?Jv([v],L,l):o===null?v:v+"[]",u(T))}),!1}return y0(y)?!0:(e.append(Jv(_,v,l),u(y)),!1)}const g=[],p=Object.assign(fL,{defaultVisitor:f,convertValue:u,isVisitable:y0});function b(y,v){if(!ke.isUndefined(y)){if(g.indexOf(y)!==-1)throw Error("Circular reference detected in "+v.join("."));g.push(y),ke.forEach(y,function(N,C){(!(ke.isUndefined(N)||N===null)&&i.call(e,N,ke.isString(C)?C.trim():C,v,p))===!0&&b(N,v?v.concat(C):[C])}),g.pop()}}if(!ke.isObject(a))throw new TypeError("data must be an object");return b(a),e}function Zv(a){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(a).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function pp(a,e){this._pairs=[],a&&Yh(a,this,e)}const yw=pp.prototype;yw.append=function(e,s){this._pairs.push([e,s])};yw.toString=function(e){const s=e?function(n){return e.call(this,n,Zv)}:Zv;return this._pairs.map(function(i){return s(i[0])+"="+s(i[1])},"").join("&")};function mL(a){return encodeURIComponent(a).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function bw(a,e,s){if(!e)return a;const n=s&&s.encode||mL;ke.isFunction(s)&&(s={serialize:s});const i=s&&s.serialize;let l;if(i?l=i(e,s):l=ke.isURLSearchParams(e)?e.toString():new pp(e,s).toString(n),l){const o=a.indexOf("#");o!==-1&&(a=a.slice(0,o)),a+=(a.indexOf("?")===-1?"?":"&")+l}return a}class e_{constructor(){this.handlers=[]}use(e,s,n){return this.handlers.push({fulfilled:e,rejected:s,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ke.forEach(this.handlers,function(n){n!==null&&e(n)})}}const vw={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},gL=typeof URLSearchParams<"u"?URLSearchParams:pp,pL=typeof FormData<"u"?FormData:null,xL=typeof Blob<"u"?Blob:null,yL={isBrowser:!0,classes:{URLSearchParams:gL,FormData:pL,Blob:xL},protocols:["http","https","file","blob","url","data"]},xp=typeof window<"u"&&typeof document<"u",b0=typeof navigator=="object"&&navigator||void 0,bL=xp&&(!b0||["ReactNative","NativeScript","NS"].indexOf(b0.product)<0),vL=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",_L=xp&&window.location.href||"http://localhost",NL=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:xp,hasStandardBrowserEnv:bL,hasStandardBrowserWebWorkerEnv:vL,navigator:b0,origin:_L},Symbol.toStringTag,{value:"Module"})),pa={...NL,...yL};function wL(a,e){return Yh(a,new pa.classes.URLSearchParams,{visitor:function(s,n,i,l){return pa.isNode&&ke.isBuffer(s)?(this.append(n,s.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)},...e})}function SL(a){return ke.matchAll(/\w+|\[(\w*)]/g,a).map(e=>e[0]==="[]"?"":e[1]||e[0])}function jL(a){const e={},s=Object.keys(a);let n;const i=s.length;let l;for(n=0;n<i;n++)l=s[n],e[l]=a[l];return e}function _w(a){function e(s,n,i,l){let o=s[l++];if(o==="__proto__")return!0;const d=Number.isFinite(+o),h=l>=s.length;return o=!o&&ke.isArray(i)?i.length:o,h?(ke.hasOwnProp(i,o)?i[o]=[i[o],n]:i[o]=n,!d):((!i[o]||!ke.isObject(i[o]))&&(i[o]=[]),e(s,n,i[o],l)&&ke.isArray(i[o])&&(i[o]=jL(i[o])),!d)}if(ke.isFormData(a)&&ke.isFunction(a.entries)){const s={};return ke.forEachEntry(a,(n,i)=>{e(SL(n),i,s,0)}),s}return null}function EL(a,e,s){if(ke.isString(a))try{return(e||JSON.parse)(a),ke.trim(a)}catch(n){if(n.name!=="SyntaxError")throw n}return(s||JSON.stringify)(a)}const id={transitional:vw,adapter:["xhr","http","fetch"],transformRequest:[function(e,s){const n=s.getContentType()||"",i=n.indexOf("application/json")>-1,l=ke.isObject(e);if(l&&ke.isHTMLForm(e)&&(e=new FormData(e)),ke.isFormData(e))return i?JSON.stringify(_w(e)):e;if(ke.isArrayBuffer(e)||ke.isBuffer(e)||ke.isStream(e)||ke.isFile(e)||ke.isBlob(e)||ke.isReadableStream(e))return e;if(ke.isArrayBufferView(e))return e.buffer;if(ke.isURLSearchParams(e))return s.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let d;if(l){if(n.indexOf("application/x-www-form-urlencoded")>-1)return wL(e,this.formSerializer).toString();if((d=ke.isFileList(e))||n.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return Yh(d?{"files[]":e}:e,h&&new h,this.formSerializer)}}return l||i?(s.setContentType("application/json",!1),EL(e)):e}],transformResponse:[function(e){const s=this.transitional||id.transitional,n=s&&s.forcedJSONParsing,i=this.responseType==="json";if(ke.isResponse(e)||ke.isReadableStream(e))return e;if(e&&ke.isString(e)&&(n&&!this.responseType||i)){const o=!(s&&s.silentJSONParsing)&&i;try{return JSON.parse(e,this.parseReviver)}catch(d){if(o)throw d.name==="SyntaxError"?Ct.from(d,Ct.ERR_BAD_RESPONSE,this,null,this.response):d}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:pa.classes.FormData,Blob:pa.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ke.forEach(["delete","get","head","post","put","patch"],a=>{id.headers[a]={}});const TL=ke.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),AL=a=>{const e={};let s,n,i;return a&&a.split(`
`).forEach(function(o){i=o.indexOf(":"),s=o.substring(0,i).trim().toLowerCase(),n=o.substring(i+1).trim(),!(!s||e[s]&&TL[s])&&(s==="set-cookie"?e[s]?e[s].push(n):e[s]=[n]:e[s]=e[s]?e[s]+", "+n:n)}),e},t_=Symbol("internals");function Ec(a){return a&&String(a).trim().toLowerCase()}function Zu(a){return a===!1||a==null?a:ke.isArray(a)?a.map(Zu):String(a)}function CL(a){const e=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=s.exec(a);)e[n[1]]=n[2];return e}const kL=a=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(a.trim());function ug(a,e,s,n,i){if(ke.isFunction(n))return n.call(this,e,s);if(i&&(e=s),!!ke.isString(e)){if(ke.isString(n))return e.indexOf(n)!==-1;if(ke.isRegExp(n))return n.test(e)}}function RL(a){return a.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,s,n)=>s.toUpperCase()+n)}function LL(a,e){const s=ke.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(a,n+s,{value:function(i,l,o){return this[n].call(this,e,i,l,o)},configurable:!0})})}let Fa=class{constructor(e){e&&this.set(e)}set(e,s,n){const i=this;function l(d,h,u){const f=Ec(h);if(!f)throw new Error("header name must be a non-empty string");const g=ke.findKey(i,f);(!g||i[g]===void 0||u===!0||u===void 0&&i[g]!==!1)&&(i[g||h]=Zu(d))}const o=(d,h)=>ke.forEach(d,(u,f)=>l(u,f,h));if(ke.isPlainObject(e)||e instanceof this.constructor)o(e,s);else if(ke.isString(e)&&(e=e.trim())&&!kL(e))o(AL(e),s);else if(ke.isObject(e)&&ke.isIterable(e)){let d={},h,u;for(const f of e){if(!ke.isArray(f))throw TypeError("Object iterator must return a key-value pair");d[u=f[0]]=(h=d[u])?ke.isArray(h)?[...h,f[1]]:[h,f[1]]:f[1]}o(d,s)}else e!=null&&l(s,e,n);return this}get(e,s){if(e=Ec(e),e){const n=ke.findKey(this,e);if(n){const i=this[n];if(!s)return i;if(s===!0)return CL(i);if(ke.isFunction(s))return s.call(this,i,n);if(ke.isRegExp(s))return s.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,s){if(e=Ec(e),e){const n=ke.findKey(this,e);return!!(n&&this[n]!==void 0&&(!s||ug(this,this[n],n,s)))}return!1}delete(e,s){const n=this;let i=!1;function l(o){if(o=Ec(o),o){const d=ke.findKey(n,o);d&&(!s||ug(n,n[d],d,s))&&(delete n[d],i=!0)}}return ke.isArray(e)?e.forEach(l):l(e),i}clear(e){const s=Object.keys(this);let n=s.length,i=!1;for(;n--;){const l=s[n];(!e||ug(this,this[l],l,e,!0))&&(delete this[l],i=!0)}return i}normalize(e){const s=this,n={};return ke.forEach(this,(i,l)=>{const o=ke.findKey(n,l);if(o){s[o]=Zu(i),delete s[l];return}const d=e?RL(l):String(l).trim();d!==l&&delete s[l],s[d]=Zu(i),n[d]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const s=Object.create(null);return ke.forEach(this,(n,i)=>{n!=null&&n!==!1&&(s[i]=e&&ke.isArray(n)?n.join(", "):n)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,s])=>e+": "+s).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...s){const n=new this(e);return s.forEach(i=>n.set(i)),n}static accessor(e){const n=(this[t_]=this[t_]={accessors:{}}).accessors,i=this.prototype;function l(o){const d=Ec(o);n[d]||(LL(i,o),n[d]=!0)}return ke.isArray(e)?e.forEach(l):l(e),this}};Fa.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ke.reduceDescriptors(Fa.prototype,({value:a},e)=>{let s=e[0].toUpperCase()+e.slice(1);return{get:()=>a,set(n){this[s]=n}}});ke.freezeMethods(Fa);function hg(a,e){const s=this||id,n=e||s,i=Fa.from(n.headers);let l=n.data;return ke.forEach(a,function(d){l=d.call(s,l,i.normalize(),e?e.status:void 0)}),i.normalize(),l}function Nw(a){return!!(a&&a.__CANCEL__)}function Lo(a,e,s){Ct.call(this,a??"canceled",Ct.ERR_CANCELED,e,s),this.name="CanceledError"}ke.inherits(Lo,Ct,{__CANCEL__:!0});function ww(a,e,s){const n=s.config.validateStatus;!s.status||!n||n(s.status)?a(s):e(new Ct("Request failed with status code "+s.status,[Ct.ERR_BAD_REQUEST,Ct.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s))}function DL(a){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return e&&e[1]||""}function ML(a,e){a=a||10;const s=new Array(a),n=new Array(a);let i=0,l=0,o;return e=e!==void 0?e:1e3,function(h){const u=Date.now(),f=n[l];o||(o=u),s[i]=h,n[i]=u;let g=l,p=0;for(;g!==i;)p+=s[g++],g=g%a;if(i=(i+1)%a,i===l&&(l=(l+1)%a),u-o<e)return;const b=f&&u-f;return b?Math.round(p*1e3/b):void 0}}function IL(a,e){let s=0,n=1e3/e,i,l;const o=(u,f=Date.now())=>{s=f,i=null,l&&(clearTimeout(l),l=null),a(...u)};return[(...u)=>{const f=Date.now(),g=f-s;g>=n?o(u,f):(i=u,l||(l=setTimeout(()=>{l=null,o(i)},n-g)))},()=>i&&o(i)]}const _h=(a,e,s=3)=>{let n=0;const i=ML(50,250);return IL(l=>{const o=l.loaded,d=l.lengthComputable?l.total:void 0,h=o-n,u=i(h),f=o<=d;n=o;const g={loaded:o,total:d,progress:d?o/d:void 0,bytes:h,rate:u||void 0,estimated:u&&d&&f?(d-o)/u:void 0,event:l,lengthComputable:d!=null,[e?"download":"upload"]:!0};a(g)},s)},s_=(a,e)=>{const s=a!=null;return[n=>e[0]({lengthComputable:s,total:a,loaded:n}),e[1]]},a_=a=>(...e)=>ke.asap(()=>a(...e)),PL=pa.hasStandardBrowserEnv?((a,e)=>s=>(s=new URL(s,pa.origin),a.protocol===s.protocol&&a.host===s.host&&(e||a.port===s.port)))(new URL(pa.origin),pa.navigator&&/(msie|trident)/i.test(pa.navigator.userAgent)):()=>!0,OL=pa.hasStandardBrowserEnv?{write(a,e,s,n,i,l,o){if(typeof document>"u")return;const d=[`${a}=${encodeURIComponent(e)}`];ke.isNumber(s)&&d.push(`expires=${new Date(s).toUTCString()}`),ke.isString(n)&&d.push(`path=${n}`),ke.isString(i)&&d.push(`domain=${i}`),l===!0&&d.push("secure"),ke.isString(o)&&d.push(`SameSite=${o}`),document.cookie=d.join("; ")},read(a){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+a+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(a){this.write(a,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function FL(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}function BL(a,e){return e?a.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):a}function Sw(a,e,s){let n=!FL(e);return a&&(n||s==!1)?BL(a,e):e}const n_=a=>a instanceof Fa?{...a}:a;function bl(a,e){e=e||{};const s={};function n(u,f,g,p){return ke.isPlainObject(u)&&ke.isPlainObject(f)?ke.merge.call({caseless:p},u,f):ke.isPlainObject(f)?ke.merge({},f):ke.isArray(f)?f.slice():f}function i(u,f,g,p){if(ke.isUndefined(f)){if(!ke.isUndefined(u))return n(void 0,u,g,p)}else return n(u,f,g,p)}function l(u,f){if(!ke.isUndefined(f))return n(void 0,f)}function o(u,f){if(ke.isUndefined(f)){if(!ke.isUndefined(u))return n(void 0,u)}else return n(void 0,f)}function d(u,f,g){if(g in e)return n(u,f);if(g in a)return n(void 0,u)}const h={url:l,method:l,data:l,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:d,headers:(u,f,g)=>i(n_(u),n_(f),g,!0)};return ke.forEach(Object.keys({...a,...e}),function(f){const g=h[f]||i,p=g(a[f],e[f],f);ke.isUndefined(p)&&g!==d||(s[f]=p)}),s}const jw=a=>{const e=bl({},a);let{data:s,withXSRFToken:n,xsrfHeaderName:i,xsrfCookieName:l,headers:o,auth:d}=e;if(e.headers=o=Fa.from(o),e.url=bw(Sw(e.baseURL,e.url,e.allowAbsoluteUrls),a.params,a.paramsSerializer),d&&o.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):""))),ke.isFormData(s)){if(pa.hasStandardBrowserEnv||pa.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(ke.isFunction(s.getHeaders)){const h=s.getHeaders(),u=["content-type","content-length"];Object.entries(h).forEach(([f,g])=>{u.includes(f.toLowerCase())&&o.set(f,g)})}}if(pa.hasStandardBrowserEnv&&(n&&ke.isFunction(n)&&(n=n(e)),n||n!==!1&&PL(e.url))){const h=i&&l&&OL.read(l);h&&o.set(i,h)}return e},UL=typeof XMLHttpRequest<"u",$L=UL&&function(a){return new Promise(function(s,n){const i=jw(a);let l=i.data;const o=Fa.from(i.headers).normalize();let{responseType:d,onUploadProgress:h,onDownloadProgress:u}=i,f,g,p,b,y;function v(){b&&b(),y&&y(),i.cancelToken&&i.cancelToken.unsubscribe(f),i.signal&&i.signal.removeEventListener("abort",f)}let _=new XMLHttpRequest;_.open(i.method.toUpperCase(),i.url,!0),_.timeout=i.timeout;function N(){if(!_)return;const T=Fa.from("getAllResponseHeaders"in _&&_.getAllResponseHeaders()),F={data:!d||d==="text"||d==="json"?_.responseText:_.response,status:_.status,statusText:_.statusText,headers:T,config:a,request:_};ww(function(B){s(B),v()},function(B){n(B),v()},F),_=null}"onloadend"in _?_.onloadend=N:_.onreadystatechange=function(){!_||_.readyState!==4||_.status===0&&!(_.responseURL&&_.responseURL.indexOf("file:")===0)||setTimeout(N)},_.onabort=function(){_&&(n(new Ct("Request aborted",Ct.ECONNABORTED,a,_)),_=null)},_.onerror=function(L){const F=L&&L.message?L.message:"Network Error",H=new Ct(F,Ct.ERR_NETWORK,a,_);H.event=L||null,n(H),_=null},_.ontimeout=function(){let L=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const F=i.transitional||vw;i.timeoutErrorMessage&&(L=i.timeoutErrorMessage),n(new Ct(L,F.clarifyTimeoutError?Ct.ETIMEDOUT:Ct.ECONNABORTED,a,_)),_=null},l===void 0&&o.setContentType(null),"setRequestHeader"in _&&ke.forEach(o.toJSON(),function(L,F){_.setRequestHeader(F,L)}),ke.isUndefined(i.withCredentials)||(_.withCredentials=!!i.withCredentials),d&&d!=="json"&&(_.responseType=i.responseType),u&&([p,y]=_h(u,!0),_.addEventListener("progress",p)),h&&_.upload&&([g,b]=_h(h),_.upload.addEventListener("progress",g),_.upload.addEventListener("loadend",b)),(i.cancelToken||i.signal)&&(f=T=>{_&&(n(!T||T.type?new Lo(null,a,_):T),_.abort(),_=null)},i.cancelToken&&i.cancelToken.subscribe(f),i.signal&&(i.signal.aborted?f():i.signal.addEventListener("abort",f)));const C=DL(i.url);if(C&&pa.protocols.indexOf(C)===-1){n(new Ct("Unsupported protocol "+C+":",Ct.ERR_BAD_REQUEST,a));return}_.send(l||null)})},GL=(a,e)=>{const{length:s}=a=a?a.filter(Boolean):[];if(e||s){let n=new AbortController,i;const l=function(u){if(!i){i=!0,d();const f=u instanceof Error?u:this.reason;n.abort(f instanceof Ct?f:new Lo(f instanceof Error?f.message:f))}};let o=e&&setTimeout(()=>{o=null,l(new Ct(`timeout ${e} of ms exceeded`,Ct.ETIMEDOUT))},e);const d=()=>{a&&(o&&clearTimeout(o),o=null,a.forEach(u=>{u.unsubscribe?u.unsubscribe(l):u.removeEventListener("abort",l)}),a=null)};a.forEach(u=>u.addEventListener("abort",l));const{signal:h}=n;return h.unsubscribe=()=>ke.asap(d),h}},VL=function*(a,e){let s=a.byteLength;if(s<e){yield a;return}let n=0,i;for(;n<s;)i=n+e,yield a.slice(n,i),n=i},qL=async function*(a,e){for await(const s of KL(a))yield*VL(s,e)},KL=async function*(a){if(a[Symbol.asyncIterator]){yield*a;return}const e=a.getReader();try{for(;;){const{done:s,value:n}=await e.read();if(s)break;yield n}}finally{await e.cancel()}},i_=(a,e,s,n)=>{const i=qL(a,e);let l=0,o,d=h=>{o||(o=!0,n&&n(h))};return new ReadableStream({async pull(h){try{const{done:u,value:f}=await i.next();if(u){d(),h.close();return}let g=f.byteLength;if(s){let p=l+=g;s(p)}h.enqueue(new Uint8Array(f))}catch(u){throw d(u),u}},cancel(h){return d(h),i.return()}},{highWaterMark:2})},r_=64*1024,{isFunction:_u}=ke,HL=(({Request:a,Response:e})=>({Request:a,Response:e}))(ke.global),{ReadableStream:l_,TextEncoder:o_}=ke.global,c_=(a,...e)=>{try{return!!a(...e)}catch{return!1}},zL=a=>{a=ke.merge.call({skipUndefined:!0},HL,a);const{fetch:e,Request:s,Response:n}=a,i=e?_u(e):typeof fetch=="function",l=_u(s),o=_u(n);if(!i)return!1;const d=i&&_u(l_),h=i&&(typeof o_=="function"?(y=>v=>y.encode(v))(new o_):async y=>new Uint8Array(await new s(y).arrayBuffer())),u=l&&d&&c_(()=>{let y=!1;const v=new s(pa.origin,{body:new l_,method:"POST",get duplex(){return y=!0,"half"}}).headers.has("Content-Type");return y&&!v}),f=o&&d&&c_(()=>ke.isReadableStream(new n("").body)),g={stream:f&&(y=>y.body)};i&&["text","arrayBuffer","blob","formData","stream"].forEach(y=>{!g[y]&&(g[y]=(v,_)=>{let N=v&&v[y];if(N)return N.call(v);throw new Ct(`Response type '${y}' is not supported`,Ct.ERR_NOT_SUPPORT,_)})});const p=async y=>{if(y==null)return 0;if(ke.isBlob(y))return y.size;if(ke.isSpecCompliantForm(y))return(await new s(pa.origin,{method:"POST",body:y}).arrayBuffer()).byteLength;if(ke.isArrayBufferView(y)||ke.isArrayBuffer(y))return y.byteLength;if(ke.isURLSearchParams(y)&&(y=y+""),ke.isString(y))return(await h(y)).byteLength},b=async(y,v)=>{const _=ke.toFiniteNumber(y.getContentLength());return _??p(v)};return async y=>{let{url:v,method:_,data:N,signal:C,cancelToken:T,timeout:L,onDownloadProgress:F,onUploadProgress:H,responseType:B,headers:P,withCredentials:I="same-origin",fetchOptions:D}=jw(y),O=e||fetch;B=B?(B+"").toLowerCase():"text";let ee=GL([C,T&&T.toAbortSignal()],L),ie=null;const Z=ee&&ee.unsubscribe&&(()=>{ee.unsubscribe()});let z;try{if(H&&u&&_!=="get"&&_!=="head"&&(z=await b(P,N))!==0){let q=new s(v,{method:"POST",body:N,duplex:"half"}),J;if(ke.isFormData(N)&&(J=q.headers.get("content-type"))&&P.setContentType(J),q.body){const[oe,be]=s_(z,_h(a_(H)));N=i_(q.body,r_,oe,be)}}ke.isString(I)||(I=I?"include":"omit");const X=l&&"credentials"in s.prototype,ae={...D,signal:ee,method:_.toUpperCase(),headers:P.normalize().toJSON(),body:N,duplex:"half",credentials:X?I:void 0};ie=l&&new s(v,ae);let te=await(l?O(ie,D):O(v,ae));const W=f&&(B==="stream"||B==="response");if(f&&(F||W&&Z)){const q={};["status","statusText","headers"].forEach(ye=>{q[ye]=te[ye]});const J=ke.toFiniteNumber(te.headers.get("content-length")),[oe,be]=F&&s_(J,_h(a_(F),!0))||[];te=new n(i_(te.body,r_,oe,()=>{be&&be(),Z&&Z()}),q)}B=B||"text";let K=await g[ke.findKey(g,B)||"text"](te,y);return!W&&Z&&Z(),await new Promise((q,J)=>{ww(q,J,{data:K,headers:Fa.from(te.headers),status:te.status,statusText:te.statusText,config:y,request:ie})})}catch(X){throw Z&&Z(),X&&X.name==="TypeError"&&/Load failed|fetch/i.test(X.message)?Object.assign(new Ct("Network Error",Ct.ERR_NETWORK,y,ie),{cause:X.cause||X}):Ct.from(X,X&&X.code,y,ie)}}},YL=new Map,Ew=a=>{let e=a&&a.env||{};const{fetch:s,Request:n,Response:i}=e,l=[n,i,s];let o=l.length,d=o,h,u,f=YL;for(;d--;)h=l[d],u=f.get(h),u===void 0&&f.set(h,u=d?new Map:zL(e)),f=u;return u};Ew();const yp={http:uL,xhr:$L,fetch:{get:Ew}};ke.forEach(yp,(a,e)=>{if(a){try{Object.defineProperty(a,"name",{value:e})}catch{}Object.defineProperty(a,"adapterName",{value:e})}});const d_=a=>`- ${a}`,WL=a=>ke.isFunction(a)||a===null||a===!1;function QL(a,e){a=ke.isArray(a)?a:[a];const{length:s}=a;let n,i;const l={};for(let o=0;o<s;o++){n=a[o];let d;if(i=n,!WL(n)&&(i=yp[(d=String(n)).toLowerCase()],i===void 0))throw new Ct(`Unknown adapter '${d}'`);if(i&&(ke.isFunction(i)||(i=i.get(e))))break;l[d||"#"+o]=i}if(!i){const o=Object.entries(l).map(([h,u])=>`adapter ${h} `+(u===!1?"is not supported by the environment":"is not available in the build"));let d=s?o.length>1?`since :
`+o.map(d_).join(`
`):" "+d_(o[0]):"as no adapter specified";throw new Ct("There is no suitable adapter to dispatch the request "+d,"ERR_NOT_SUPPORT")}return i}const Tw={getAdapter:QL,adapters:yp};function fg(a){if(a.cancelToken&&a.cancelToken.throwIfRequested(),a.signal&&a.signal.aborted)throw new Lo(null,a)}function u_(a){return fg(a),a.headers=Fa.from(a.headers),a.data=hg.call(a,a.transformRequest),["post","put","patch"].indexOf(a.method)!==-1&&a.headers.setContentType("application/x-www-form-urlencoded",!1),Tw.getAdapter(a.adapter||id.adapter,a)(a).then(function(n){return fg(a),n.data=hg.call(a,a.transformResponse,n),n.headers=Fa.from(n.headers),n},function(n){return Nw(n)||(fg(a),n&&n.response&&(n.response.data=hg.call(a,a.transformResponse,n.response),n.response.headers=Fa.from(n.response.headers))),Promise.reject(n)})}const Aw="1.13.2",Wh={};["object","boolean","number","function","string","symbol"].forEach((a,e)=>{Wh[a]=function(n){return typeof n===a||"a"+(e<1?"n ":" ")+a}});const h_={};Wh.transitional=function(e,s,n){function i(l,o){return"[Axios v"+Aw+"] Transitional option '"+l+"'"+o+(n?". "+n:"")}return(l,o,d)=>{if(e===!1)throw new Ct(i(o," has been removed"+(s?" in "+s:"")),Ct.ERR_DEPRECATED);return s&&!h_[o]&&(h_[o]=!0,console.warn(i(o," has been deprecated since v"+s+" and will be removed in the near future"))),e?e(l,o,d):!0}};Wh.spelling=function(e){return(s,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function XL(a,e,s){if(typeof a!="object")throw new Ct("options must be an object",Ct.ERR_BAD_OPTION_VALUE);const n=Object.keys(a);let i=n.length;for(;i-- >0;){const l=n[i],o=e[l];if(o){const d=a[l],h=d===void 0||o(d,l,a);if(h!==!0)throw new Ct("option "+l+" must be "+h,Ct.ERR_BAD_OPTION_VALUE);continue}if(s!==!0)throw new Ct("Unknown option "+l,Ct.ERR_BAD_OPTION)}}const eh={assertOptions:XL,validators:Wh},zn=eh.validators;let ml=class{constructor(e){this.defaults=e||{},this.interceptors={request:new e_,response:new e_}}async request(e,s){try{return await this._request(e,s)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const l=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?l&&!String(n.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+l):n.stack=l}catch{}}throw n}}_request(e,s){typeof e=="string"?(s=s||{},s.url=e):s=e||{},s=bl(this.defaults,s);const{transitional:n,paramsSerializer:i,headers:l}=s;n!==void 0&&eh.assertOptions(n,{silentJSONParsing:zn.transitional(zn.boolean),forcedJSONParsing:zn.transitional(zn.boolean),clarifyTimeoutError:zn.transitional(zn.boolean)},!1),i!=null&&(ke.isFunction(i)?s.paramsSerializer={serialize:i}:eh.assertOptions(i,{encode:zn.function,serialize:zn.function},!0)),s.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?s.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:s.allowAbsoluteUrls=!0),eh.assertOptions(s,{baseUrl:zn.spelling("baseURL"),withXsrfToken:zn.spelling("withXSRFToken")},!0),s.method=(s.method||this.defaults.method||"get").toLowerCase();let o=l&&ke.merge(l.common,l[s.method]);l&&ke.forEach(["delete","get","head","post","put","patch","common"],y=>{delete l[y]}),s.headers=Fa.concat(o,l);const d=[];let h=!0;this.interceptors.request.forEach(function(v){typeof v.runWhen=="function"&&v.runWhen(s)===!1||(h=h&&v.synchronous,d.unshift(v.fulfilled,v.rejected))});const u=[];this.interceptors.response.forEach(function(v){u.push(v.fulfilled,v.rejected)});let f,g=0,p;if(!h){const y=[u_.bind(this),void 0];for(y.unshift(...d),y.push(...u),p=y.length,f=Promise.resolve(s);g<p;)f=f.then(y[g++],y[g++]);return f}p=d.length;let b=s;for(;g<p;){const y=d[g++],v=d[g++];try{b=y(b)}catch(_){v.call(this,_);break}}try{f=u_.call(this,b)}catch(y){return Promise.reject(y)}for(g=0,p=u.length;g<p;)f=f.then(u[g++],u[g++]);return f}getUri(e){e=bl(this.defaults,e);const s=Sw(e.baseURL,e.url,e.allowAbsoluteUrls);return bw(s,e.params,e.paramsSerializer)}};ke.forEach(["delete","get","head","options"],function(e){ml.prototype[e]=function(s,n){return this.request(bl(n||{},{method:e,url:s,data:(n||{}).data}))}});ke.forEach(["post","put","patch"],function(e){function s(n){return function(l,o,d){return this.request(bl(d||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:l,data:o}))}}ml.prototype[e]=s(),ml.prototype[e+"Form"]=s(!0)});let JL=class Cw{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let s;this.promise=new Promise(function(l){s=l});const n=this;this.promise.then(i=>{if(!n._listeners)return;let l=n._listeners.length;for(;l-- >0;)n._listeners[l](i);n._listeners=null}),this.promise.then=i=>{let l;const o=new Promise(d=>{n.subscribe(d),l=d}).then(i);return o.cancel=function(){n.unsubscribe(l)},o},e(function(l,o,d){n.reason||(n.reason=new Lo(l,o,d),s(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const s=this._listeners.indexOf(e);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const e=new AbortController,s=n=>{e.abort(n)};return this.subscribe(s),e.signal.unsubscribe=()=>this.unsubscribe(s),e.signal}static source(){let e;return{token:new Cw(function(i){e=i}),cancel:e}}};function ZL(a){return function(s){return a.apply(null,s)}}function e3(a){return ke.isObject(a)&&a.isAxiosError===!0}const v0={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(v0).forEach(([a,e])=>{v0[e]=a});function kw(a){const e=new ml(a),s=lw(ml.prototype.request,e);return ke.extend(s,ml.prototype,e,{allOwnKeys:!0}),ke.extend(s,e,null,{allOwnKeys:!0}),s.create=function(i){return kw(bl(a,i))},s}const Gs=kw(id);Gs.Axios=ml;Gs.CanceledError=Lo;Gs.CancelToken=JL;Gs.isCancel=Nw;Gs.VERSION=Aw;Gs.toFormData=Yh;Gs.AxiosError=Ct;Gs.Cancel=Gs.CanceledError;Gs.all=function(e){return Promise.all(e)};Gs.spread=ZL;Gs.isAxiosError=e3;Gs.mergeConfig=bl;Gs.AxiosHeaders=Fa;Gs.formToJSON=a=>_w(ke.isHTMLForm(a)?new FormData(a):a);Gs.getAdapter=Tw.getAdapter;Gs.HttpStatusCode=v0;Gs.default=Gs;const{Axios:a$,AxiosError:n$,CanceledError:i$,isCancel:r$,CancelToken:l$,VERSION:o$,all:c$,Cancel:d$,isAxiosError:u$,spread:h$,toFormData:f$,AxiosHeaders:m$,HttpStatusCode:g$,formToJSON:p$,getAdapter:x$,mergeConfig:y$}=Gs,mg="openflix_token";class t3{client;constructor(){this.client=Gs.create({baseURL:"",headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{const s=this.getToken();return s&&(e.headers["X-Plex-Token"]=s),e}),this.client.interceptors.response.use(e=>e,e=>(e.response?.status===401&&(this.clearToken(),window.location.href="/ui/login"),Promise.reject(e)))}getToken(){return localStorage.getItem(mg)}setToken(e){localStorage.setItem(mg,e)}clearToken(){localStorage.removeItem(mg)}isAuthenticated(){return!!this.getToken()}async login(e){const s=await this.client.post("/auth/login",e);return this.setToken(s.data.authToken),s.data}async register(e){return(await this.client.post("/auth/register",e)).data}async logout(){try{await this.client.post("/auth/logout")}finally{this.clearToken()}}async getCurrentUser(){return(await this.client.get("/auth/user")).data}async getUsers(){return(await this.client.get("/admin/users")).data.users||[]}async createUser(e){return(await this.client.post("/auth/register",e)).data}async updateUser(e,s){return(await this.client.put(`/admin/users/${e}`,s)).data}async deleteUser(e){await this.client.delete(`/admin/users/${e}`)}async getProfiles(){return(await this.client.get("/profiles")).data.profiles||[]}async getUserProfiles(e){return(await this.client.get(`/admin/users/${e}/profiles`)).data.profiles||[]}async createProfile(e){return(await this.client.post("/profiles",e)).data}async deleteProfile(e){await this.client.delete(`/profiles/${e}`)}async getLibraries(){return(await this.client.get("/admin/libraries")).data.libraries||[]}async createLibrary(e){return(await this.client.post("/admin/libraries",e)).data}async updateLibrary(e,s){return(await this.client.put(`/admin/libraries/${e}`,s)).data}async deleteLibrary(e){await this.client.delete(`/admin/libraries/${e}`)}async scanLibrary(e){await this.client.post(`/admin/libraries/${e}/scan`)}async addLibraryPath(e,s){await this.client.post(`/admin/libraries/${e}/paths`,{path:s})}async removeLibraryPath(e,s){await this.client.delete(`/admin/libraries/${e}/paths/${s}`)}async getLibraryStats(e){return(await this.client.get(`/admin/libraries/${e}/stats`)).data}async browseFilesystem(e){return(await this.client.get("/admin/filesystem/browse",{params:e?{path:e}:void 0})).data}async getM3USources(){return(await this.client.get("/livetv/sources")).data.sources||[]}async createM3USource(e){return(await this.client.post("/livetv/sources",e)).data}async updateM3USource(e,s){return(await this.client.put(`/livetv/sources/${e}`,s)).data}async deleteM3USource(e){await this.client.delete(`/livetv/sources/${e}`)}async refreshM3USource(e){await this.client.post(`/livetv/sources/${e}/refresh`)}async importM3UVOD(e){return(await this.client.post(`/livetv/sources/${e}/import-vod`)).data}async importM3USeries(e){return(await this.client.post(`/livetv/sources/${e}/import-series`)).data}async mapChannelNumbers(e){return(await this.client.post("/livetv/channels/map-numbers",e)).data}async exportConfig(){return(await this.client.get("/config/export",{responseType:"blob"})).data}async getConfigStats(){return(await this.client.get("/config/stats")).data}async importConfig(e,s=!1){const n=s?"/config/import?preview=true":"/config/import";return(await this.client.post(n,e)).data}async getChannelGroups(){return(await this.client.get("/livetv/channel-groups")).data.groups||[]}async createChannelGroup(e){return(await this.client.post("/livetv/channel-groups",e)).data}async updateChannelGroup(e,s){return(await this.client.put(`/livetv/channel-groups/${e}`,s)).data}async deleteChannelGroup(e){await this.client.delete(`/livetv/channel-groups/${e}`)}async addChannelToGroup(e,s,n){return(await this.client.post(`/livetv/channel-groups/${e}/members`,{channelId:s,priority:n??0})).data}async updateGroupMemberPriority(e,s,n){return(await this.client.put(`/livetv/channel-groups/${e}/members/${s}`,{priority:n})).data}async removeChannelFromGroup(e,s){await this.client.delete(`/livetv/channel-groups/${e}/members/${s}`)}async autoDetectDuplicates(){return(await this.client.post("/livetv/channel-groups/auto-detect")).data}async getEPGSources(){return(await this.client.get("/livetv/epg/sources")).data.sources||[]}async previewEPGSource(e){return(await this.client.post("/livetv/epg/sources/preview",e)).data}async createEPGSource(e){return(await this.client.post("/livetv/epg/sources",e)).data}async deleteEPGSource(e){await this.client.delete(`/livetv/epg/sources/${e}`)}async updateEPGSource(e,s){return(await this.client.put(`/livetv/epg/sources/${e}`,s)).data}async refreshEPG(){await this.client.post("/livetv/epg/refresh")}async getGuide(){return(await this.client.get("/livetv/guide")).data}async getOnNow(){return(await this.client.get("/livetv/now")).data.channels||[]}async getEPGPrograms(e){return(await this.client.get("/livetv/epg/programs",{params:e})).data}async getEPGChannels(e){return(await this.client.get("/livetv/epg/channels",{params:e?{epgSourceId:e}:void 0})).data.channels||[]}async discoverProviders(e){return(await this.client.get("/livetv/gracenote/providers",{params:{postalCode:e}})).data}async getXtreamSources(){return(await this.client.get("/livetv/xtream/sources")).data.sources||[]}async createXtreamSource(e){return(await this.client.post("/livetv/xtream/sources",e)).data}async updateXtreamSource(e,s){return(await this.client.put(`/livetv/xtream/sources/${e}`,s)).data}async deleteXtreamSource(e){await this.client.delete(`/livetv/xtream/sources/${e}`)}async testXtreamSource(e){return(await this.client.post(`/livetv/xtream/sources/${e}/test`)).data}async refreshXtreamSource(e){return(await this.client.post(`/livetv/xtream/sources/${e}/refresh`)).data}async parseXtreamFromM3U(e){return(await this.client.post("/livetv/xtream/parse-m3u",{url:e})).data}async importXtreamVOD(e){return(await this.client.post(`/livetv/xtream/sources/${e}/import-vod`)).data}async importXtreamSeries(e){return(await this.client.post(`/livetv/xtream/sources/${e}/import-series`)).data}async importAllXtreamContent(e){return(await this.client.post(`/livetv/xtream/sources/${e}/import-all`)).data}async getRecordings(){return(await this.client.get("/dvr/recordings")).data.recordings||[]}async deleteRecording(e){await this.client.delete(`/dvr/recordings/${e}`)}async getSeriesRules(){return(await this.client.get("/dvr/rules")).data.rules||[]}async createSeriesRule(e){return(await this.client.post("/dvr/rules",e)).data}async updateSeriesRule(e,s){return(await this.client.put(`/dvr/rules/${e}`,s)).data}async deleteSeriesRule(e){await this.client.delete(`/dvr/rules/${e}`)}async getRecordingConflicts(){return(await this.client.get("/dvr/conflicts")).data}async resolveConflict(e,s){await this.client.post("/dvr/conflicts/resolve",{keepRecordingId:e,cancelRecordingId:s})}async getRecordingStats(){return(await this.client.get("/dvr/recordings/stats")).data}async getRecordingCommercials(e){return(await this.client.get(`/dvr/recordings/${e}/commercials`)).data}async getCommercialDetectionStatus(){return(await this.client.get("/dvr/commercials/status")).data}async runCommercialDetection(e){await this.client.post(`/dvr/recordings/${e}/commercials/detect`)}getRecordingEDLUrl(e,s="standard"){const n=localStorage.getItem("openflix_token")||"";return`${this.client.defaults.baseURL||""}/dvr/recordings/${e}/export.edl?format=${s}&X-Plex-Token=${n}`}getFileEDLUrl(e,s="standard",n="commercial"){const i=localStorage.getItem("openflix_token")||"";return`${this.client.defaults.baseURL||""}/dvr/v2/files/${e}/export.edl?format=${s}&types=${n}&X-Plex-Token=${i}`}async getRecordingStreamUrl(e){return(await this.client.get(`/dvr/recordings/${e}/stream`)).data.url}async updateRecordingProgress(e,s){await this.client.put(`/dvr/recordings/${e}/progress`,{viewOffset:s})}async getRecordingsManager(e){return(await this.client.get("/dvr/recordings/manager",{params:e})).data}async toggleRecordingWatched(e,s){return(await this.client.put(`/dvr/recordings/${e}/watched`,s!==void 0?{watched:s}:{})).data}async toggleRecordingFavorite(e,s){return(await this.client.put(`/dvr/recordings/${e}/favorite`,s!==void 0?{favorite:s}:{})).data}async toggleRecordingKeep(e,s){return(await this.client.put(`/dvr/recordings/${e}/keep`,s!==void 0?{keepForever:s}:{})).data}async trashRecording(e){await this.client.delete(`/dvr/recordings/${e}/trash`)}async bulkRecordingAction(e,s){return(await this.client.post("/dvr/recordings/bulk",{ids:e,action:s})).data}async getDVRPasses(){return(await this.client.get("/dvr/passes")).data.passes||[]}async pauseDVRPass(e,s){await this.client.put(`/dvr/passes/${e}/pause`,null,{params:{type:s}})}async resumeDVRPass(e,s){await this.client.put(`/dvr/passes/${e}/resume`,null,{params:{type:s}})}async getDVRSchedule(){return(await this.client.get("/dvr/schedule")).data}async getDVRCalendar(e){return(await this.client.get("/dvr/calendar",{params:e?{date:e}:void 0})).data}async getDVRSettings(){return(await this.client.get("/dvr/settings")).data.settings}async updateDVRSettings(e){return(await this.client.put("/dvr/settings",e)).data.settings}async getServerStatus(){return(await this.client.get("/api/status")).data}async getDashboardData(){return(await this.client.get("/api/dashboard")).data}async runHealthChecks(){return(await this.client.get("/api/diagnostics/health-check")).data}async getSystemStatus(){return(await this.client.get("/api/system/status")).data}async getServerConfig(){return(await this.client.get("/admin/settings")).data.settings}async updateServerConfig(e){return(await this.client.put("/admin/settings",e)).data.settings}async refreshGuideData(){return(await this.client.post("/api/guide/refresh")).data}async rebuildGuideData(){return(await this.client.post("/api/guide/rebuild")).data}async getGlobalClientSettings(){return(await this.client.get("/api/client-settings")).data.overrides||{}}async updateGlobalClientSetting(e,s){await this.client.put("/api/client-settings",{key:e,value:s})}async deleteGlobalClientSetting(e){await this.client.delete(`/api/client-settings/${e}`)}async getAdminMedia(e){return(await this.client.get("/admin/media",{params:e})).data}async refreshMediaMetadata(e){await this.client.post(`/admin/media/${e}/refresh`)}async updateMediaMetadata(e,s){return(await this.client.put(`/admin/media/${e}`,s)).data}async searchTMDB(e,s){return(await this.client.get("/admin/media/search-tmdb",{params:{query:e,media_type:s}})).data.results||[]}async applyMediaMatch(e,s,n){await this.client.post(`/admin/media/${e}/match`,{tmdb_id:s,media_type:n})}async applyRecordingMatch(e,s,n,i,l,o){await this.client.post(`/dvr/recordings/${e}/match`,{tmdb_id:s,media_type:n,title:i||"",poster:l||"",backdrop:o||""})}vod={testConnection:async e=>{const s=e?{url:e}:{};return(await this.client.get("/api/vod/test-connection",{params:s})).data},getProviders:async()=>(await this.client.get("/api/vod/providers")).data,getMovies:async e=>(await this.client.get(`/api/vod/${e}/movies`)).data,getShows:async e=>(await this.client.get(`/api/vod/${e}/shows`)).data,getGenres:async e=>(await this.client.get(`/api/vod/${e}/genres`)).data,getMovie:async(e,s)=>(await this.client.get(`/api/vod/${e}/movie/${s}`)).data,getShow:async(e,s)=>(await this.client.get(`/api/vod/${e}/show/${s}`)).data,startDownload:async(e,s,n)=>{await this.client.post(`/api/vod/${e}/download`,{contentId:s,type:n})},getQueue:async()=>(await this.client.get("/api/vod/queue")).data,cancelDownload:async e=>{await this.client.delete(`/api/vod/queue/${e}`)}};async getAdminPlaylists(){return(await this.client.get("/api/playlists")).data.playlists||[]}async createAdminPlaylist(e){return(await this.client.post("/api/playlists",e)).data}async getAdminPlaylist(e){return(await this.client.get(`/api/playlists/${e}`)).data}async updateAdminPlaylist(e,s){return(await this.client.put(`/api/playlists/${e}`,s)).data}async deleteAdminPlaylist(e){await this.client.delete(`/api/playlists/${e}`)}async addItemsToAdminPlaylist(e,s){return(await this.client.post(`/api/playlists/${e}/items`,{mediaIds:s})).data}async removeItemFromAdminPlaylist(e,s){await this.client.delete(`/api/playlists/${e}/items/${s}`)}async reorderAdminPlaylistItems(e,s){await this.client.put(`/api/playlists/${e}/items/reorder`,{itemIds:s})}async getPersonalSections(){return(await this.client.get("/api/sections")).data.sections||[]}async createPersonalSection(e){return(await this.client.post("/api/sections",e)).data}async getPersonalSection(e){return(await this.client.get(`/api/sections/${e}`)).data}async updatePersonalSection(e,s){return(await this.client.put(`/api/sections/${e}`,s)).data}async deletePersonalSection(e){await this.client.delete(`/api/sections/${e}`)}async addItemsToPersonalSection(e,s){return(await this.client.post(`/api/sections/${e}/items`,{mediaIds:s})).data}async removeItemFromPersonalSection(e,s){await this.client.delete(`/api/sections/${e}/items/${s}`)}async reorderPersonalSectionItems(e,s){await this.client.put(`/api/sections/${e}/reorder`,{itemIds:s})}async previewSmartFilter(e,s){return(await this.client.post("/api/sections/preview",{smartFilter:e,limit:s||50})).data}async getAvailableGenres(){return(await this.client.get("/api/sections/genres")).data.genres||[]}}const pe=new t3;function s3(){return Fe({queryKey:["currentUser"],queryFn:()=>pe.getCurrentUser(),enabled:pe.isAuthenticated(),retry:!1})}function a3(){const a=at();return Me({mutationFn:e=>pe.login(e),onSuccess:()=>{a.invalidateQueries({queryKey:["currentUser"]})}})}function n3(){return Me({mutationFn:a=>pe.register(a)})}function i3(){const a=at();return Me({mutationFn:()=>pe.logout(),onSuccess:()=>{a.clear()}})}const r3=[{label:"",items:[{name:"Dashboard",href:"/ui",icon:A4},{name:"Search",href:"/ui/search",icon:xt}]},{label:"Media",items:[{name:"Libraries",href:"/ui/libraries",icon:sa},{name:"Media",href:"/ui/media",icon:Gt},{name:"Collections",href:"/ui/collections",icon:l4},{name:"Artwork",href:"/ui/artwork",icon:Oi},{name:"Metadata",href:"/ui/metadata",icon:ph}]},{label:"Live TV",items:[{name:"Live TV",href:"/ui/livetv",icon:jt},{name:"TV Guide",href:"/ui/tvguide",icon:o0},{name:"On Now",href:"/ui/onnow",icon:_o},{name:"Tuners",href:"/ui/tuners",icon:$s},{name:"Channel Collections",href:"/ui/channel-collections",icon:Fi},{name:"Virtual Channels",href:"/ui/virtual-channels",icon:p0}]},{label:"DVR & Recording",items:[{name:"DVR",href:"/ui/dvr",icon:Nn},{name:"Passes",href:"/ui/dvr/passes",icon:Y1},{name:"Schedule",href:"/ui/dvr/schedule",icon:o0},{name:"Calendar",href:"/ui/dvr/calendar",icon:gC},{name:"On Later",href:"/ui/onlater",icon:Kt},{name:"Team Pass",href:"/ui/teampass",icon:ti},{name:"Comskip",href:"/ui/comskip",icon:zk},{name:"Segments",href:"/ui/segments",icon:vh},{name:"Labels",href:"/ui/labels",icon:Vc}]},{label:"Content",items:[{name:"Playlists",href:"/ui/playlists",icon:h0},{name:"Sections",href:"/ui/sections",icon:Qu},{name:"VOD",href:"/ui/vod",icon:Mc},{name:"Downloads",href:"/ui/downloads",icon:gs},{name:"Offline",href:"/ui/offline",icon:ei},{name:"Upload",href:"/ui/upload",icon:Mi}]},{label:"System",items:[{name:"Users",href:"/ui/users",icon:qh},{name:"Settings",href:"/ui/settings",icon:si},{name:"Transcode",href:"/ui/transcode",icon:Nr},{name:"Jobs",href:"/ui/jobs",icon:f0},{name:"Logs",href:"/ui/logs",icon:wa},{name:"Diagnostics",href:"/ui/diagnostics",icon:Wu},{name:"Connections",href:"/ui/connections",icon:Q1},{name:"Speed Test",href:"/ui/speedtest",icon:u0},{name:"Backups",href:"/ui/backups",icon:$C},{name:"Trash",href:"/ui/trash",icon:Dt},{name:"Updater",href:"/ui/updater",icon:ut},{name:"Notifications",href:"/ui/notifications",icon:q1},{name:"Subtitles",href:"/ui/subtitles",icon:c0},{name:"Scheduler",href:"/ui/scheduler",icon:rw},{name:"Devices",href:"/ui/devices",icon:ei}]}];function l3({group:a,location:e,onNavigate:s}){const n=a.items.some(o=>e.pathname===o.href),[i,l]=k.useState(a.label===""||n);return a.label?t.jsxs("div",{className:"mb-1",children:[t.jsxs("button",{onClick:()=>l(!i),className:"flex items-center justify-between w-full px-3 py-1.5 text-xs font-semibold uppercase tracking-wider text-gray-500 hover:text-gray-300 transition-colors",children:[a.label,t.jsx(Pn,{className:`h-3 w-3 transition-transform ${i?"":"-rotate-90"}`})]}),i&&t.jsx("div",{children:a.items.map(o=>{const d=e.pathname===o.href;return t.jsxs(Ss,{to:o.href,onClick:s,className:`flex items-center gap-3 px-3 py-1.5 mb-0.5 rounded-lg text-sm font-medium transition-colors ${d?"bg-indigo-600 text-white":"text-gray-300 hover:bg-gray-700 hover:text-white"}`,children:[t.jsx(o.icon,{className:"h-4 w-4"}),o.name]},o.name)})})]}):t.jsx("div",{className:"mb-1",children:a.items.map(o=>{const d=e.pathname===o.href;return t.jsxs(Ss,{to:o.href,onClick:s,className:`flex items-center gap-3 px-3 py-2 mb-0.5 rounded-lg text-sm font-medium transition-colors ${d?"bg-indigo-600 text-white":"text-gray-300 hover:bg-gray-700 hover:text-white"}`,children:[t.jsx(o.icon,{className:"h-4 w-4"}),o.name]},o.name)})})}function o3(){const a=Ui(),e=Jc(),{data:s}=s3(),n=i3(),[i,l]=k.useState(!1),o=async()=>{await n.mutateAsync(),e("/ui/login")};return t.jsxs("div",{className:"min-h-screen bg-gray-900",children:[i&&t.jsx("div",{className:"fixed inset-0 z-40 bg-black/50 lg:hidden",onClick:()=>l(!1)}),t.jsxs("aside",{className:`fixed inset-y-0 left-0 z-50 w-64 flex flex-col transform bg-gray-800 transition-transform duration-200 ease-in-out lg:translate-x-0 ${i?"translate-x-0":"-translate-x-full"}`,children:[t.jsxs("div",{className:"flex h-14 shrink-0 items-center justify-between px-6 border-b border-gray-700",children:[t.jsx("span",{className:"text-xl font-bold text-white",children:"OpenFlix"}),t.jsx("button",{className:"lg:hidden text-gray-400 hover:text-white",onClick:()=>l(!1),children:t.jsx(nt,{className:"h-6 w-6"})})]}),t.jsx("nav",{className:"flex-1 overflow-y-auto px-3 py-3 scrollbar-thin",children:r3.map(d=>t.jsx(l3,{group:d,location:a,onNavigate:()=>l(!1)},d.label||"_top"))}),t.jsxs("div",{className:"shrink-0 p-3 border-t border-gray-700",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-600 flex items-center justify-center text-white font-medium text-sm",children:s?.username?.charAt(0).toUpperCase()||"U"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium text-white truncate",children:s?.title||s?.username}),t.jsx("p",{className:"text-xs text-gray-400",children:s?.admin?"Administrator":"User"})]})]}),t.jsxs("button",{onClick:o,className:"flex items-center gap-2 w-full px-3 py-1.5 text-sm text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors",children:[t.jsx(K4,{className:"h-4 w-4"}),"Sign out"]})]})]}),t.jsxs("div",{className:"lg:pl-64",children:[t.jsxs("header",{className:"sticky top-0 z-30 flex h-16 items-center gap-4 border-b border-gray-700 bg-gray-800 px-4 lg:hidden",children:[t.jsx("button",{className:"text-gray-400 hover:text-white",onClick:()=>l(!0),children:t.jsx(X4,{className:"h-6 w-6"})}),t.jsx("span",{className:"text-lg font-semibold text-white",children:"OpenFlix"})]}),t.jsx("main",{className:"p-6",children:t.jsx(DT,{})})]})]})}function c3(){const a=Jc(),e=a3(),s=n3(),[n,i]=k.useState(!1),[l,o]=k.useState(""),[d,h]=k.useState(""),[u,f]=k.useState(""),[g,p]=k.useState(""),[b,y]=k.useState(""),[v,_]=k.useState(""),N=async T=>{if(T.preventDefault(),y(""),_(""),n){if(u!==g){y("Passwords do not match");return}if(u.length<6){y("Password must be at least 6 characters");return}try{await s.mutateAsync({username:l,email:d,password:u}),_("Account created! You can now sign in."),i(!1),f(""),p(""),h("")}catch(L){y(L.response?.data?.error||"Failed to create account")}}else try{if(!(await e.mutateAsync({username:l,password:u})).user.admin){y("Admin access required");return}a("/ui")}catch{y("Invalid username or password")}},C=()=>{i(!n),y(""),_(""),f(""),p("")};return t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 px-4",children:t.jsxs("div",{className:"w-full max-w-md",children:[t.jsxs("div",{className:"text-center mb-8",children:[t.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-indigo-600 mb-4",children:t.jsx(jt,{className:"h-8 w-8 text-white"})}),t.jsx("h1",{className:"text-2xl font-bold text-white",children:"OpenFlix Admin"}),t.jsx("p",{className:"text-gray-400 mt-2",children:n?"Create your admin account":"Sign in to manage your server"})]}),t.jsxs("form",{onSubmit:N,className:"bg-gray-800 rounded-xl p-6 shadow-xl",children:[b&&t.jsx("div",{className:"mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20 text-red-400 text-sm",children:b}),v&&t.jsx("div",{className:"mb-4 p-3 rounded-lg bg-green-500/10 border border-green-500/20 text-green-400 text-sm",children:v}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-300 mb-2",children:"Username"}),t.jsx("input",{id:"username",type:"text",value:l,onChange:T=>o(T.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Enter your username",required:!0})]}),n&&t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300 mb-2",children:"Email"}),t.jsx("input",{id:"email",type:"email",value:d,onChange:T=>h(T.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Enter your email",required:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300 mb-2",children:"Password"}),t.jsx("input",{id:"password",type:"password",value:u,onChange:T=>f(T.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Enter your password",required:!0})]}),n&&t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-300 mb-2",children:"Confirm Password"}),t.jsx("input",{id:"confirmPassword",type:"password",value:g,onChange:T=>p(T.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Confirm your password",required:!0})]}),t.jsx("button",{type:"submit",disabled:e.isPending||s.isPending,className:"w-full py-2 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors mb-4",children:e.isPending||s.isPending?n?"Creating account...":"Signing in...":n?"Create Account":"Sign in"}),t.jsx("div",{className:"text-center",children:t.jsx("button",{type:"button",onClick:C,className:"text-indigo-400 hover:text-indigo-300 text-sm transition-colors",children:n?"Already have an account? Sign in":"Don't have an account? Sign up"})})]})]})})}function Rw(){return Fe({queryKey:["libraries"],queryFn:()=>pe.getLibraries()})}function d3(a){return Fe({queryKey:["library-stats",a],queryFn:()=>pe.getLibraryStats(a)})}function u3(){const a=at();return Me({mutationFn:e=>pe.createLibrary(e),onSuccess:()=>{a.invalidateQueries({queryKey:["libraries"]})}})}function h3(){const a=at();return Me({mutationFn:({id:e,data:s})=>pe.updateLibrary(e,s),onSuccess:()=>{a.invalidateQueries({queryKey:["libraries"]})}})}function f3(){const a=at();return Me({mutationFn:e=>pe.deleteLibrary(e),onSuccess:()=>{a.invalidateQueries({queryKey:["libraries"]})}})}function m3(){const a=at();return Me({mutationFn:e=>pe.scanLibrary(e),onSuccess:()=>{a.invalidateQueries({queryKey:["library-stats"]})}})}function g3(){const a=at();return Me({mutationFn:({libraryId:e,path:s})=>pe.addLibraryPath(e,s),onSuccess:()=>{a.invalidateQueries({queryKey:["libraries"]})}})}function p3(){const a=at();return Me({mutationFn:({libraryId:e,pathId:s})=>pe.removeLibraryPath(e,s),onSuccess:()=>{a.invalidateQueries({queryKey:["libraries"]})}})}function Lw(){return Fe({queryKey:["m3uSources"],queryFn:()=>pe.getM3USources()})}function x3(){const a=at();return Me({mutationFn:e=>pe.createM3USource(e),onSuccess:()=>{a.invalidateQueries({queryKey:["m3uSources"]})}})}function y3(){const a=at();return Me({mutationFn:e=>pe.deleteM3USource(e),onSuccess:()=>{a.invalidateQueries({queryKey:["m3uSources"]})}})}function b3(){const a=at();return Me({mutationFn:e=>pe.refreshM3USource(e),onSuccess:()=>{a.invalidateQueries({queryKey:["m3uSources"]})}})}function v3(){return Fe({queryKey:["epgSources"],queryFn:()=>pe.getEPGSources()})}function _3(){const a=at();return Me({mutationFn:e=>pe.createEPGSource(e),onSuccess:()=>{a.invalidateQueries({queryKey:["epgSources"]})}})}function N3(){const a=at();return Me({mutationFn:e=>pe.deleteEPGSource(e),onSuccess:()=>{a.invalidateQueries({queryKey:["epgSources"]})}})}function w3(){return Me({mutationFn:()=>pe.refreshEPG()})}function S3(){return Fe({queryKey:["recordings"],queryFn:()=>pe.getRecordings()})}function j3(){return Fe({queryKey:["serverStatus"],queryFn:()=>pe.getServerStatus(),refetchInterval:1e4})}function E3(){return Fe({queryKey:["dashboardData"],queryFn:()=>pe.getDashboardData(),refetchInterval:6e4})}function Nu({icon:a,label:e,value:s,color:n}){return t.jsxs("div",{className:"flex items-center gap-3 bg-gray-800/60 rounded-lg px-4 py-3 min-w-[140px]",children:[t.jsx("div",{className:`p-2 rounded-md ${n}`,children:t.jsx(a,{className:"h-4 w-4 text-white"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 leading-none",children:e}),t.jsx("p",{className:"text-lg font-semibold text-white leading-tight",children:s})]})]})}function wu({title:a,icon:e,children:s,emptyMessage:n,isEmpty:i}){const l=k.useRef(null),o=k.useCallback(d=>{if(!l.current)return;const h=l.current.clientWidth*.75;l.current.scrollBy({left:d==="left"?-h:h,behavior:"smooth"})},[]);return t.jsxs("div",{className:"mb-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3 px-1",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[t.jsx(e,{className:"h-5 w-5 text-gray-400"}),a]}),!i&&t.jsxs("div",{className:"flex gap-1",children:[t.jsx("button",{onClick:()=>o("left"),className:"p-1.5 rounded-md bg-gray-700/50 hover:bg-gray-700 text-gray-400 hover:text-white transition-colors",children:t.jsx(ko,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>o("right"),className:"p-1.5 rounded-md bg-gray-700/50 hover:bg-gray-700 text-gray-400 hover:text-white transition-colors",children:t.jsx(Ba,{className:"h-4 w-4"})})]})]}),i?t.jsx("div",{className:"bg-gray-800/40 rounded-xl p-8 text-center",children:t.jsx("p",{className:"text-gray-500 text-sm",children:n})}):t.jsx("div",{ref:l,className:"flex gap-4 overflow-x-auto pb-2 scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:s})]})}function Qh({src:a,alt:e}){return a?t.jsx("img",{src:a,alt:e,className:"w-full h-full object-cover",loading:"lazy"}):t.jsx("div",{className:"w-full h-full bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center",children:t.jsx(Gt,{className:"h-8 w-8 text-gray-600"})})}function T3({item:a}){const e=a.duration&&a.duration>0?Math.min(100,Math.round(a.viewOffset/a.duration*100)):0,s=a.grandparentTitle||a.title,n=a.type==="episode"&&a.parentIndex&&a.index?`S${a.parentIndex} E${a.index}`:null,i=a.grandparentThumb||a.parentThumb||a.thumb;return t.jsxs(Ss,{to:"/ui/media",className:"flex-shrink-0 w-[160px] group cursor-pointer",children:[t.jsxs("div",{className:"relative aspect-[2/3] rounded-lg overflow-hidden bg-gray-800 mb-2",children:[t.jsx(Qh,{src:i,alt:s}),t.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:t.jsx("div",{className:"bg-white/20 backdrop-blur-sm rounded-full p-3",children:t.jsx(xs,{className:"h-6 w-6 text-white fill-white"})})}),e>0&&t.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gray-700",children:t.jsx("div",{className:"h-full bg-blue-500 transition-all",style:{width:`${e}%`}})})]}),t.jsxs("div",{className:"px-0.5",children:[t.jsx("p",{className:"text-sm text-white font-medium truncate leading-tight",children:s}),n&&t.jsxs("p",{className:"text-xs text-gray-400 truncate mt-0.5",children:[n,a.title!==s?`  ${a.title}`:""]}),!n&&a.year?t.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:a.year}):null]})]})}function A3({show:a}){return t.jsxs(Ss,{to:"/ui/media",className:"flex-shrink-0 w-[160px] group cursor-pointer",children:[t.jsxs("div",{className:"relative aspect-[2/3] rounded-lg overflow-hidden bg-gray-800 mb-2",children:[t.jsx(Qh,{src:a.thumb,alt:a.title}),a.leafCount!=null&&a.leafCount>0&&t.jsxs("div",{className:"absolute top-2 right-2 bg-blue-600 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-md shadow-lg",children:[a.leafCount," ep"]}),t.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity"})]}),t.jsxs("div",{className:"px-0.5",children:[t.jsx("p",{className:"text-sm text-white font-medium truncate leading-tight",children:a.title}),a.year?t.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:a.year}):null]})]})}function C3({movie:a}){return t.jsxs(Ss,{to:"/ui/media",className:"flex-shrink-0 w-[160px] group cursor-pointer",children:[t.jsxs("div",{className:"relative aspect-[2/3] rounded-lg overflow-hidden bg-gray-800 mb-2",children:[t.jsx(Qh,{src:a.thumb,alt:a.title}),a.rating!=null&&a.rating>0&&t.jsx("div",{className:"absolute top-2 left-2 bg-yellow-600/90 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-md shadow-lg",children:a.rating.toFixed(1)}),t.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-end",children:t.jsx("div",{className:"p-3 w-full",children:t.jsx("p",{className:"text-xs text-gray-200 line-clamp-3 opacity-0 group-hover:opacity-100 transition-opacity",children:a.summary||""})})})]}),t.jsxs("div",{className:"px-0.5",children:[t.jsx("p",{className:"text-sm text-white font-medium truncate leading-tight",children:a.title}),t.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[a.year||"",a.studio?`  ${a.studio}`:""]})]})]})}function k3({recording:a}){return t.jsxs(Ss,{to:"/ui/dvr",className:"flex-shrink-0 w-[160px] group cursor-pointer",children:[t.jsxs("div",{className:"relative aspect-[2/3] rounded-lg overflow-hidden bg-gray-800 mb-2",children:[t.jsx(Qh,{src:a.thumb,alt:a.title}),a.channelName&&t.jsx("div",{className:"absolute top-2 right-2 bg-gray-900/80 text-gray-200 text-[10px] font-medium px-1.5 py-0.5 rounded-md shadow-lg max-w-[100px] truncate",children:a.channelName}),t.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity"})]}),t.jsxs("div",{className:"px-0.5",children:[t.jsx("p",{className:"text-sm text-white font-medium truncate leading-tight",children:a.title}),t.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[a.year||"",a.duration?`  ${a.duration} min`:""]})]})]})}function R3(){const{data:a}=j3(),{data:e,isLoading:s}=E3(),{data:n}=Rw(),{data:i}=Lw(),{data:l}=S3(),o=i?.reduce((u,f)=>u+(f.channelCount||0),0)||0,d=l?.filter(u=>u.status==="scheduled").length||0,h=a?.sessions.active||0;return t.jsxs("div",{children:[t.jsx("div",{className:"mb-6",children:t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Home"})}),t.jsxs("div",{className:"flex gap-3 overflow-x-auto pb-2 mb-8",style:{scrollbarWidth:"none"},children:[t.jsx(Nu,{icon:sa,label:"Libraries",value:a?.libraries.count||n?.length||0,color:"bg-blue-600"}),t.jsx(Nu,{icon:jt,label:"Channels",value:a?.livetv.channels||o,color:"bg-green-600"}),t.jsx(Nu,{icon:Nn,label:"Recordings",value:(a?.dvr.scheduled||d)+(a?.dvr.completed||0),color:"bg-orange-600"}),t.jsx(Nu,{icon:$a,label:"Active Streams",value:h,color:"bg-purple-600"})]}),s&&t.jsx("div",{className:"flex items-center justify-center py-16",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-gray-600 border-t-blue-500"})}),e&&t.jsxs(t.Fragment,{children:[t.jsx(wu,{title:"Up Next",icon:xs,isEmpty:e.upNext.length===0,emptyMessage:"Nothing in progress. Start watching something to see it here.",children:e.upNext.map(u=>t.jsx(T3,{item:u},u.id))}),t.jsx(wu,{title:"Recently Updated Shows",icon:$h,isEmpty:e.recentShows.length===0,emptyMessage:"No TV shows in your library yet.",children:e.recentShows.map(u=>t.jsx(A3,{show:u},u.id))}),t.jsx(wu,{title:"Recently Added Movies",icon:Gt,isEmpty:e.recentMovies.length===0,emptyMessage:"No movies in your library yet.",children:e.recentMovies.map(u=>t.jsx(C3,{movie:u},u.id))}),t.jsx(wu,{title:"Recent Recordings",icon:Kt,isEmpty:e.recentRecordings.length===0,emptyMessage:"No completed recordings yet.",children:e.recentRecordings.map(u=>t.jsx(k3,{recording:u},u.id))})]})]})}function L3(){return Fe({queryKey:["users"],queryFn:()=>pe.getUsers()})}function D3({onClose:a}){const e=at(),[s,n]=k.useState(""),[i,l]=k.useState(""),[o,d]=k.useState(""),[h,u]=k.useState(!1),[f,g]=k.useState(""),p=Me({mutationFn:y=>pe.createUser(y),onSuccess:()=>{e.invalidateQueries({queryKey:["users"]}),a()},onError:y=>{g(y.response?.data?.error||"Failed to create user")}}),b=async y=>{y.preventDefault(),g(""),p.mutate({username:s,email:i,password:o,isAdmin:h})};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Create User"}),t.jsxs("form",{onSubmit:b,children:[f&&t.jsx("div",{className:"mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20 text-red-400 text-sm",children:f}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Username"}),t.jsx("input",{type:"text",value:s,onChange:y=>n(y.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email"}),t.jsx("input",{type:"email",value:i,onChange:y=>l(y.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Password"}),t.jsx("input",{type:"password",value:o,onChange:y=>d(y.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0,minLength:6})]}),t.jsx("div",{className:"mb-6",children:t.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300",children:[t.jsx("input",{type:"checkbox",checked:h,onChange:y=>u(y.target.checked),className:"rounded bg-gray-700 border-gray-600"}),"Administrator"]})}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{type:"button",onClick:a,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:p.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:p.isPending?"Creating...":"Create"})]})]})]})})}function M3({userId:a,onClose:e}){const s=at(),[n,i]=k.useState(""),[l,o]=k.useState(!1),[d,h]=k.useState(""),u=Me({mutationFn:g=>pe.createProfile(g),onSuccess:()=>{s.invalidateQueries({queryKey:["userProfiles",a]}),s.invalidateQueries({queryKey:["users"]}),e()},onError:g=>{h(g.response?.data?.error||"Failed to create profile")}}),f=async g=>{g.preventDefault(),h(""),u.mutate({name:n,isKid:l})};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Add Profile"}),t.jsxs("form",{onSubmit:f,children:[d&&t.jsx("div",{className:"mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20 text-red-400 text-sm",children:d}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Profile Name"}),t.jsx("input",{type:"text",value:n,onChange:g=>i(g.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"e.g. Dad, Kids, Guest",required:!0})]}),t.jsxs("div",{className:"mb-6",children:[t.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300",children:[t.jsx("input",{type:"checkbox",checked:l,onChange:g=>o(g.target.checked),className:"rounded bg-gray-700 border-gray-600"}),"Kid Profile"]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1 ml-6",children:"Kid profiles have content restrictions"})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:u.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:u.isPending?"Creating...":"Create"})]})]})]})})}function I3({user:a}){const e=at(),{data:s,isLoading:n}=Fe({queryKey:["userProfiles",a.id],queryFn:()=>pe.getUserProfiles(a.id)}),i=Me({mutationFn:d=>pe.deleteProfile(d),onSuccess:()=>{e.invalidateQueries({queryKey:["userProfiles",a.id]}),e.invalidateQueries({queryKey:["users"]})}}),[l,o]=k.useState(!1);return n?t.jsx("div",{className:"px-4 pb-4 pt-1",children:t.jsxs("div",{className:"flex items-center gap-2 text-gray-500 text-sm",children:[t.jsx(Ke,{className:"h-3.5 w-3.5 animate-spin"}),"Loading profiles..."]})}):t.jsxs("div",{className:"px-4 pb-4 pt-1",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-xs font-medium text-gray-400 uppercase tracking-wide",children:"Profiles"}),t.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-1 px-2 py-1 text-xs bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-md",children:[t.jsx(Pt,{className:"h-3 w-3"}),"Add"]})]}),s&&s.length>0?t.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(d=>t.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-gray-900 rounded-lg border border-gray-700",children:[t.jsx("div",{className:"h-6 w-6 rounded-full bg-purple-600 flex items-center justify-center text-white text-xs font-medium",children:d.name.charAt(0).toUpperCase()}),t.jsx("span",{className:"text-sm text-white",children:d.name}),d.isKid&&t.jsxs("span",{className:"inline-flex items-center gap-0.5 px-1.5 py-0.5 bg-green-500/20 text-green-400 text-xs rounded-full",children:[t.jsx(Gc,{className:"h-2.5 w-2.5"}),"Kid"]}),t.jsx("button",{onClick:()=>{confirm(`Delete profile "${d.name}"?`)&&i.mutate(d.id)},className:"p-0.5 text-gray-500 hover:text-red-400 rounded",title:"Delete profile",children:t.jsx(Dt,{className:"h-3 w-3"})})]},d.id))}):t.jsx("p",{className:"text-xs text-gray-500",children:"No profiles yet"}),l&&t.jsx(M3,{userId:a.id,onClose:()=>o(!1)})]})}function P3({user:a,onDelete:e}){const[s,n]=k.useState(!1);return t.jsxs("div",{children:[t.jsxs("div",{className:"p-4 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("button",{onClick:()=>n(!s),className:"p-1 text-gray-400 hover:text-white rounded",children:s?t.jsx(Pn,{className:"h-4 w-4"}):t.jsx(Ba,{className:"h-4 w-4"})}),t.jsx("div",{className:"h-10 w-10 rounded-full bg-indigo-600 flex items-center justify-center text-white font-medium",children:a.username.charAt(0).toUpperCase()}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h3",{className:"font-medium text-white",children:a.title||a.username}),a.admin&&t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-indigo-500/20 text-indigo-400 text-xs rounded-full",children:[t.jsx(ew,{className:"h-3 w-3"}),"Admin"]}),a.restricted&&t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-orange-500/20 text-orange-400 text-xs rounded-full",children:[t.jsx(Bk,{className:"h-3 w-3"}),"Restricted"]})]}),t.jsx("p",{className:"text-sm text-gray-400",children:a.email})]})]}),t.jsx("button",{onClick:e,disabled:a.admin,className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",title:a.admin?"Can't delete admin":"Delete user",children:t.jsx(Dt,{className:"h-4 w-4"})})]}),s&&t.jsx(I3,{user:a})]})}function O3(){const{data:a,isLoading:e}=L3(),s=at(),[n,i]=k.useState(!1),l=Me({mutationFn:d=>pe.deleteUser(d),onSuccess:()=>{s.invalidateQueries({queryKey:["users"]})}}),o=async d=>{confirm(`Are you sure you want to delete ${d.username}? This will also delete all their profiles.`)&&l.mutate(d.id)};return t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Users & Profiles"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Manage server users and their profiles"})]}),t.jsxs("button",{onClick:()=>i(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[t.jsx(Pt,{className:"h-4 w-4"}),"Add User"]})]}),e?t.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[t.jsx(Ke,{className:"h-5 w-5 animate-spin"}),"Loading users..."]}):a?.length?t.jsx("div",{className:"bg-gray-800 rounded-xl divide-y divide-gray-700",children:a.map(d=>t.jsx(P3,{user:d,onDelete:()=>o(d)},d.id))}):t.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[t.jsx(qh,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No users"}),t.jsx("p",{className:"text-gray-400 mb-4",children:"Add users to allow access to your server"}),t.jsxs("button",{onClick:()=>i(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[t.jsx(Pt,{className:"h-4 w-4"}),"Add User"]})]}),n&&t.jsx(D3,{onClose:()=>i(!1)})]})}function Dw({onSelect:a,onCancel:e,initialPath:s}){const[n,i]=k.useState(s||""),[l,o]=k.useState(),[d,h]=k.useState([]),[u,f]=k.useState(!0),[g,p]=k.useState(null),[b,y]=k.useState(s||"");k.useEffect(()=>{v(n||void 0)},[n]);const v=async F=>{f(!0),p(null);try{const H=await pe.browseFilesystem(F);h(H.entries),o(H.parentPath),y(H.path)}catch(H){p("Failed to load directory"),console.error(H)}finally{f(!1)}},_=F=>{i(F)},N=()=>{l!==void 0&&i(l)},C=()=>{a(b||n)},T=F=>{F.preventDefault(),i(b)},L=F=>{if(!F)return"";const H=["B","KB","MB","GB","TB"];let B=0,P=F;for(;P>=1024&&B<H.length-1;)P/=1024,B++;return`${P.toFixed(1)} ${H[B]}`};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[t.jsxs("div",{className:"p-4 border-b border-gray-700",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-3",children:"Select Directory"}),t.jsxs("form",{onSubmit:T,className:"flex gap-2",children:[t.jsx("input",{type:"text",value:b,onChange:F=>y(F.target.value),className:"flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm font-mono",placeholder:"/path/to/media"}),t.jsx("button",{type:"submit",className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:"Go"})]})]}),t.jsxs("div",{className:"px-4 py-2 border-b border-gray-700 flex items-center gap-2",children:[t.jsx("button",{onClick:N,disabled:!l&&l!=="",className:"p-1.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Go up",children:t.jsx(op,{className:"h-4 w-4"})}),t.jsx("span",{className:"text-sm text-gray-400 truncate",children:n||"Select a location"})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:u?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx(tn,{className:"h-6 w-6 text-indigo-400 animate-spin"})}):g?t.jsxs("div",{className:"text-center py-12",children:[t.jsx("p",{className:"text-red-400",children:g}),t.jsx("button",{onClick:()=>v(n||void 0),className:"mt-2 text-sm text-indigo-400 hover:text-indigo-300",children:"Retry"})]}):d.length===0?t.jsx("div",{className:"text-center py-12 text-gray-500",children:"Empty directory"}):t.jsx("div",{className:"space-y-0.5",children:d.map(F=>t.jsxs("button",{onClick:()=>F.isDir&&_(F.path),disabled:!F.isDir,className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-colors ${F.isDir?"hover:bg-gray-700 cursor-pointer":"opacity-50 cursor-not-allowed"}`,children:[F.isDir?F.name==="Home"?t.jsx(N4,{className:"h-4 w-4 text-blue-400 flex-shrink-0"}):F.name==="Root"||F.path.match(/^[A-Z]:[\\/]?$/)?t.jsx($a,{className:"h-4 w-4 text-gray-400 flex-shrink-0"}):t.jsx(h4,{className:"h-4 w-4 text-yellow-400 flex-shrink-0"}):t.jsx(K1,{className:"h-4 w-4 text-gray-500 flex-shrink-0"}),t.jsx("span",{className:"flex-1 text-sm text-white truncate",children:F.name}),!F.isDir&&F.size&&t.jsx("span",{className:"text-xs text-gray-500",children:L(F.size)}),F.isDir&&t.jsx(Ba,{className:"h-4 w-4 text-gray-600 flex-shrink-0"})]},F.path))})}),t.jsxs("div",{className:"p-4 border-t border-gray-700 flex gap-3",children:[t.jsx("button",{onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),t.jsx("button",{onClick:C,disabled:!b,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg",children:"Select This Directory"})]})]})})}const F3={movie:Gt,show:jt,music:nk,photo:Oi};function B3(a){if(a===0)return"0 B";const e=1024,s=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(a)/Math.log(e));return`${parseFloat((a/Math.pow(e,n)).toFixed(1))} ${s[n]}`}function U3(a){const e=Math.floor(a/36e5),s=Math.floor(a%36e5/6e4);return e>0?`${e}h ${s}m`:`${s}m`}function $3({libraryId:a,type:e}){const{data:s,isLoading:n}=d3(a);if(n||!s)return t.jsx("div",{className:"mt-4 pt-4 border-t border-gray-700",children:t.jsx("div",{className:"text-sm text-gray-500",children:"Loading stats..."})});const i=e==="movie"?s.movieCount:e==="show"?s.showCount:s.movieCount+s.showCount,l=s.fileCount===0,o=i>0&&l;return t.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[o&&t.jsxs("div",{className:"mb-4 flex items-start gap-2 px-4 py-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg",children:[t.jsx(kt,{className:"h-5 w-5 text-yellow-500 flex-shrink-0 mt-0.5"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-yellow-500",children:"Library needs scanning"}),t.jsx("p",{className:"text-xs text-yellow-500/80 mt-1",children:'Media items exist but no files are indexed. Click "Scan" to index media files.'})]})]}),l&&i===0&&t.jsxs("div",{className:"mb-4 flex items-start gap-2 px-4 py-3 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:[t.jsx(kt,{className:"h-5 w-5 text-blue-500 flex-shrink-0 mt-0.5"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-blue-500",children:"Library is empty"}),t.jsx("p",{className:"text-xs text-blue-500/80 mt-1",children:'Add media files to your library paths and click "Scan" to index them.'})]})]}),t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(JC,{className:"h-4 w-4 text-gray-500"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-white",children:e==="movie"?s.movieCount:e==="show"?s.showCount:i}),t.jsx("div",{className:"text-xs text-gray-500",children:e==="movie"?"Movies":e==="show"?"Shows":"Items"})]})]}),e==="show"&&s.episodeCount>0&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Gt,{className:"h-4 w-4 text-gray-500"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-white",children:s.episodeCount}),t.jsx("div",{className:"text-xs text-gray-500",children:"Episodes"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx($a,{className:"h-4 w-4 text-gray-500"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-white",children:B3(s.totalSize)}),t.jsx("div",{className:"text-xs text-gray-500",children:"Total Size"})]})]}),s.totalDuration>0&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Kt,{className:"h-4 w-4 text-gray-500"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-white",children:U3(s.totalDuration)}),t.jsx("div",{className:"text-xs text-gray-500",children:"Duration"})]})]})]})]})}function G3({onClose:a}){const e=u3(),[s,n]=k.useState(""),[i,l]=k.useState("movie"),[o,d]=k.useState([]),[h,u]=k.useState(!1),f=async b=>{b.preventDefault(),o.length!==0&&(await e.mutateAsync({title:s,type:i,paths:o}),a())},g=b=>{o.includes(b)||d([...o,b]),u(!1)},p=b=>{d(o.filter(y=>y!==b))};return h?t.jsx(Dw,{onSelect:g,onCancel:()=>u(!1)}):t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Create Library"}),t.jsxs("form",{onSubmit:f,children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),t.jsx("input",{type:"text",value:s,onChange:b=>n(b.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"My Movies",required:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Type"}),t.jsxs("select",{value:i,onChange:b=>l(b.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:[t.jsx("option",{value:"movie",children:"Movies"}),t.jsx("option",{value:"show",children:"TV Shows"}),t.jsx("option",{value:"music",children:"Music"}),t.jsx("option",{value:"photo",children:"Photos"})]})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Paths"}),t.jsx("div",{className:"space-y-2 mb-2",children:o.map(b=>t.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-700/50 rounded-lg",children:[t.jsx(sa,{className:"h-4 w-4 text-yellow-400 flex-shrink-0"}),t.jsx("code",{className:"flex-1 text-sm text-gray-300 truncate",children:b}),t.jsx("button",{type:"button",onClick:()=>p(b),className:"p-1 text-gray-400 hover:text-red-400",children:t.jsx(nt,{className:"h-4 w-4"})})]},b))}),t.jsxs("button",{type:"button",onClick:()=>u(!0),className:"w-full flex items-center justify-center gap-2 px-4 py-2 border-2 border-dashed border-gray-600 hover:border-gray-500 rounded-lg text-gray-400 hover:text-gray-300",children:[t.jsx(Gh,{className:"h-4 w-4"}),"Browse for folder"]})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{type:"button",onClick:a,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:e.isPending||o.length===0,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg",children:e.isPending?"Creating...":"Create"})]})]})]})})}function V3({library:a,onClose:e}){const s=h3(),n=g3(),i=p3(),[l,o]=k.useState(a.title),[d,h]=k.useState(!1),u=async p=>{p.preventDefault(),l!==a.title&&await s.mutateAsync({id:a.id,data:{title:l}}),e()},f=async p=>{await n.mutateAsync({libraryId:a.id,path:p}),h(!1)},g=async p=>{if(a.paths.length<=1){alert("Library must have at least one path");return}await i.mutateAsync({libraryId:a.id,pathId:p})};return d?t.jsx(Dw,{onSelect:f,onCancel:()=>h(!1)}):t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Edit Library"}),t.jsxs("form",{onSubmit:u,children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),t.jsx("input",{type:"text",value:l,onChange:p=>o(p.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Type"}),t.jsxs("div",{className:"px-4 py-2 bg-gray-700/50 border border-gray-600 rounded-lg text-gray-400 capitalize",children:[a.type,t.jsx("span",{className:"text-xs ml-2",children:"(cannot be changed)"})]})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Paths"}),t.jsx("div",{className:"space-y-2 mb-2",children:a.paths.map(p=>t.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-700/50 rounded-lg",children:[t.jsx(sa,{className:"h-4 w-4 text-yellow-400 flex-shrink-0"}),t.jsx("code",{className:"flex-1 text-sm text-gray-300 truncate",children:p.path}),t.jsx("button",{type:"button",onClick:()=>g(p.id),disabled:i.isPending||a.paths.length<=1,className:"p-1 text-gray-400 hover:text-red-400 disabled:opacity-50",children:t.jsx(nt,{className:"h-4 w-4"})})]},p.id))}),t.jsxs("button",{type:"button",onClick:()=>h(!0),className:"w-full flex items-center justify-center gap-2 px-4 py-2 border-2 border-dashed border-gray-600 hover:border-gray-500 rounded-lg text-gray-400 hover:text-gray-300",children:[t.jsx(Gh,{className:"h-4 w-4"}),"Add another folder"]})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:s.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:s.isPending?"Saving...":"Save"})]})]})]})})}function q3({library:a}){const e=f3(),s=m3(),[n,i]=k.useState(!1),[l,o]=k.useState(!1),d=F3[a.type]||sa,h=async()=>{confirm("Are you sure you want to delete this library? This will remove all associated metadata.")&&await e.mutateAsync(a.id)},u=async()=>{await s.mutateAsync(a.id)};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"p-3 bg-gray-700 rounded-lg",children:t.jsx(d,{className:"h-6 w-6 text-indigo-400"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-white",children:a.title}),t.jsx("p",{className:"text-sm text-gray-400 capitalize",children:a.type})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>o(!0),className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:"Edit Library",children:t.jsx(fk,{className:"h-4 w-4"})}),t.jsx("button",{onClick:u,disabled:s.isPending,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:"Scan Library",children:t.jsx(ut,{className:`h-4 w-4 ${s.isPending?"animate-spin":""}`})}),t.jsx("button",{onClick:h,disabled:e.isPending,className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg",title:"Delete Library",children:t.jsx(Dt,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>i(!n),className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:n?"Collapse":"Expand",children:n?t.jsx(op,{className:"h-4 w-4"}):t.jsx(Pn,{className:"h-4 w-4"})})]})]}),t.jsx($3,{libraryId:a.id,type:a.type}),n&&t.jsxs(t.Fragment,{children:[a.paths?.length>0&&t.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[t.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Paths:"}),t.jsx("div",{className:"space-y-1",children:a.paths.map(f=>t.jsx("code",{className:"block text-sm text-gray-300 bg-gray-700/50 px-3 py-1 rounded",children:f.path},f.id))})]}),a.scannedAt&&t.jsxs("p",{className:"mt-4 text-xs text-gray-500",children:["Last scanned: ",new Date(a.scannedAt).toLocaleString()]})]})]}),l&&t.jsx(V3,{library:a,onClose:()=>o(!1)})]})}function K3(){const{data:a,isLoading:e}=Rw(),[s,n]=k.useState(!1);return t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Libraries"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Manage your media libraries"})]}),t.jsxs("button",{onClick:()=>n(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[t.jsx(Pt,{className:"h-4 w-4"}),"Add Library"]})]}),e?t.jsx("div",{className:"text-gray-400",children:"Loading..."}):a?.length?t.jsx("div",{className:"grid gap-4",children:a.map(i=>t.jsx(q3,{library:i},i.id))}):t.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[t.jsx(sa,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No libraries"}),t.jsx("p",{className:"text-gray-400 mb-4",children:"Get started by adding a media library"}),t.jsxs("button",{onClick:()=>n(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[t.jsx(Pt,{className:"h-4 w-4"}),"Add Library"]})]}),s&&t.jsx(G3,{onClose:()=>n(!1)})]})}function H3(){const a=at(),[e,s]=k.useState(""),[n,i]=k.useState(""),[l,o]=k.useState(""),[d,h]=k.useState(""),[u,f]=k.useState(!1),[g,p]=k.useState(1),[b,y]=k.useState(null),[v,_]=k.useState(null),[N,C]=k.useState(null),[T,L]=k.useState(""),{data:F}=Fe({queryKey:["admin-libraries"],queryFn:()=>pe.getLibraries()}),{data:H,isLoading:B}=Fe({queryKey:["admin-media",e,n,l,d,u,g],queryFn:()=>pe.getAdminMedia({search:e,type:n,libraryId:l||void 0,page:g,resolution:d||void 0,unmatched:u||void 0})}),{data:P,isLoading:I}=Fe({queryKey:["tmdb-search",N?.id,T],queryFn:()=>pe.searchTMDB(T,N?.type==="show"?"tv":"movie"),enabled:!!N&&T.length>2}),D=Me({mutationFn:z=>pe.refreshMediaMetadata(z),onSuccess:()=>{a.invalidateQueries({queryKey:["admin-media"]})}}),O=Me({mutationFn:({id:z,data:X})=>pe.updateMediaMetadata(z,X),onSuccess:()=>{a.invalidateQueries({queryKey:["admin-media"]}),_(null)}}),ee=Me({mutationFn:({id:z,tmdbId:X,mediaType:ae})=>pe.applyMediaMatch(z,X,ae),onSuccess:()=>{a.invalidateQueries({queryKey:["admin-media"]}),C(null),L("")}}),ie=()=>{v&&O.mutate({id:v.id,data:{title:v.title,sort_title:v.sort_title,year:v.year,summary:v.summary,studio:v.studio,content_rating:v.content_rating}})},Z=z=>{switch(z.toLowerCase()){case"movie":return t.jsx(Gt,{className:"h-4 w-4"});case"show":return t.jsx(jt,{className:"h-4 w-4"});default:return t.jsx(Gt,{className:"h-4 w-4"})}};return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Media"}),t.jsx("p",{className:"text-gray-400",children:"Manage your media library metadata"})]})}),t.jsxs("div",{className:"flex flex-wrap gap-4",children:[t.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search media...",value:e,onChange:z=>{s(z.target.value),p(1)},className:"w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),t.jsxs("select",{value:n,onChange:z=>{i(z.target.value),p(1)},className:"px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[t.jsx("option",{value:"",children:"All Types"}),t.jsx("option",{value:"movie",children:"Movies"}),t.jsx("option",{value:"show",children:"TV Shows"})]}),t.jsxs("select",{value:l,onChange:z=>{o(z.target.value?Number(z.target.value):""),p(1)},className:"px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[t.jsx("option",{value:"",children:"All Libraries"}),F?.map(z=>t.jsx("option",{value:z.id,children:z.title},z.id))]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>{h(d==="4k"?"":"4k"),p(1)},className:`px-3 py-2 text-sm font-semibold rounded-lg border transition-colors ${d==="4k"?"bg-indigo-600 border-indigo-500 text-white":"bg-gray-800 border-gray-700 text-gray-400 hover:text-white hover:border-gray-500"}`,children:"4K"}),t.jsx("button",{onClick:()=>{h(d==="hd"?"":"hd"),p(1)},className:`px-3 py-2 text-sm font-semibold rounded-lg border transition-colors ${d==="hd"?"bg-indigo-600 border-indigo-500 text-white":"bg-gray-800 border-gray-700 text-gray-400 hover:text-white hover:border-gray-500"}`,children:"HD"})]}),t.jsxs("button",{onClick:()=>{f(!u),p(1)},className:`flex items-center gap-1.5 px-3 py-2 text-sm rounded-lg border transition-colors ${u?"bg-yellow-600/20 border-yellow-500 text-yellow-400":"bg-gray-800 border-gray-700 text-gray-400 hover:text-white hover:border-gray-500"}`,children:[t.jsx(kt,{className:"h-3.5 w-3.5"}),"Unmatched"]})]}),t.jsxs("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:[B?t.jsx("div",{className:"p-8 text-center text-gray-400",children:"Loading..."}):H?.items?.length?t.jsx("div",{className:"divide-y divide-gray-700",children:H.items.map(z=>t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-center gap-4 cursor-pointer",onClick:()=>y(b===z.id?null:z.id),children:[t.jsx("div",{className:"w-16 h-24 bg-gray-700 rounded overflow-hidden flex-shrink-0",children:z.thumb?t.jsx("img",{src:z.thumb,alt:z.title,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:Z(z.type)})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[Z(z.type),t.jsx("h3",{className:"text-white font-medium truncate",children:z.title}),z.year&&t.jsxs("span",{className:"text-gray-400",children:["(",z.year,")"]})]}),t.jsxs("p",{className:"text-sm text-gray-400 truncate",children:[z.library_name,"  Added ",new Date(z.added_at).toLocaleDateString()]}),!z.thumb&&t.jsxs("p",{className:"text-sm text-yellow-500 flex items-center gap-1 mt-1",children:[t.jsx(kt,{className:"h-3 w-3"}),"Missing metadata"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:X=>{X.stopPropagation(),C(z),L(z.title)},className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded",title:"Fix Match",children:t.jsx(xt,{className:"h-4 w-4"})}),t.jsx("button",{onClick:X=>{X.stopPropagation(),_({...z})},className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded",title:"Edit",children:t.jsx(an,{className:"h-4 w-4"})}),t.jsx("button",{onClick:X=>{X.stopPropagation(),D.mutate(z.id)},disabled:D.isPending,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded disabled:opacity-50",title:"Refresh Metadata",children:t.jsx(ut,{className:`h-4 w-4 ${D.isPending?"animate-spin":""}`})}),b===z.id?t.jsx(op,{className:"h-5 w-5 text-gray-400"}):t.jsx(Pn,{className:"h-5 w-5 text-gray-400"})]})]}),b===z.id&&t.jsxs("div",{className:"mt-4 pl-20 grid grid-cols-2 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-400",children:"Original Title:"}),t.jsx("span",{className:"ml-2 text-white",children:z.original_title||"-"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-400",children:"Sort Title:"}),t.jsx("span",{className:"ml-2 text-white",children:z.sort_title})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-400",children:"Studio:"}),t.jsx("span",{className:"ml-2 text-white",children:z.studio||"-"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-400",children:"Rating:"}),t.jsx("span",{className:"ml-2 text-white",children:z.content_rating||"-"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-400",children:"TMDB ID:"}),t.jsx("span",{className:"ml-2 text-white",children:z.tmdb_id||"Not matched"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-400",children:"Score:"}),t.jsx("span",{className:"ml-2 text-white",children:z.rating?.toFixed(1)||"-"})]}),z.summary&&t.jsxs("div",{className:"col-span-2",children:[t.jsx("span",{className:"text-gray-400",children:"Summary:"}),t.jsx("p",{className:"mt-1 text-white text-sm",children:z.summary})]})]})]},z.id))}):t.jsx("div",{className:"p-8 text-center text-gray-400",children:"No media found"}),H&&H.total>H.page_size&&t.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-700",children:[t.jsxs("p",{className:"text-sm text-gray-400",children:["Showing ",(g-1)*H.page_size+1," to"," ",Math.min(g*H.page_size,H.total)," of ",H.total]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>p(g-1),disabled:g===1,className:"px-3 py-1 bg-gray-700 text-white rounded disabled:opacity-50",children:"Previous"}),t.jsx("button",{onClick:()=>p(g+1),disabled:g*H.page_size>=H.total,className:"px-3 py-1 bg-gray-700 text-white rounded disabled:opacity-50",children:"Next"})]})]})]}),v&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:t.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-xl font-bold text-white",children:"Edit Metadata"}),t.jsx("button",{onClick:()=>_(null),className:"text-gray-400 hover:text-white",children:t.jsx(nt,{className:"h-5 w-5"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Title"}),t.jsx("input",{type:"text",value:v.title,onChange:z=>_({...v,title:z.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Sort Title"}),t.jsx("input",{type:"text",value:v.sort_title,onChange:z=>_({...v,sort_title:z.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Year"}),t.jsx("input",{type:"number",value:v.year||"",onChange:z=>_({...v,year:Number(z.target.value)||void 0}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Studio"}),t.jsx("input",{type:"text",value:v.studio||"",onChange:z=>_({...v,studio:z.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Content Rating"}),t.jsx("input",{type:"text",value:v.content_rating||"",onChange:z=>_({...v,content_rating:z.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Summary"}),t.jsx("textarea",{value:v.summary||"",onChange:z=>_({...v,summary:z.target.value}),rows:4,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]})]}),t.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[t.jsx("button",{onClick:()=>_(null),className:"px-4 py-2 text-gray-400 hover:text-white",children:"Cancel"}),t.jsx("button",{onClick:ie,disabled:O.isPending,className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50",children:O.isPending?"Saving...":"Save"})]})]})}),N&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:t.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-2xl max-h-[80vh] overflow-hidden flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"text-xl font-bold text-white",children:["Fix Match: ",N.title]}),t.jsx("button",{onClick:()=>{C(null),L("")},className:"text-gray-400 hover:text-white",children:t.jsx(nt,{className:"h-5 w-5"})})]}),t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"relative",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search TMDB...",value:T,onChange:z=>L(z.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto",children:I?t.jsx("div",{className:"p-8 text-center text-gray-400",children:"Searching..."}):P?.length?t.jsx("div",{className:"space-y-2",children:P.map(z=>t.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-700 rounded hover:bg-gray-600 cursor-pointer",onClick:()=>ee.mutate({id:N.id,tmdbId:z.id,mediaType:z.media_type}),children:[t.jsx("div",{className:"w-12 h-18 bg-gray-600 rounded overflow-hidden flex-shrink-0",children:z.poster_path?t.jsx("img",{src:`https://image.tmdb.org/t/p/w92${z.poster_path}`,alt:z.title,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx(Gt,{className:"h-4 w-4 text-gray-400"})})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h4",{className:"text-white font-medium truncate",children:z.title}),t.jsxs("span",{className:"text-gray-400 text-sm",children:["(",(z.release_date||z.first_air_date||"").substring(0,4),")"]})]}),t.jsx("p",{className:"text-sm text-gray-400 line-clamp-2",children:z.overview}),t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["TMDB ID: ",z.id,"  Rating: ",z.vote_average?.toFixed(1)]})]}),t.jsx(Bs,{className:"h-5 w-5 text-green-500 flex-shrink-0"})]},z.id))}):t.jsx("div",{className:"p-8 text-center text-gray-400",children:T.length>2?"No results found":"Type to search"})})]})})]})}const Su=43200,f_=1440,m_=Symbol.for("constructDateFrom");function bp(a,e){return typeof a=="function"?a(e):a&&typeof a=="object"&&m_ in a?a[m_](e):a instanceof Date?new a.constructor(e):new Date(e)}function Tr(a,e){return bp(a,a)}let z3={};function Y3(){return z3}function g_(a){const e=Tr(a),s=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return s.setUTCFullYear(e.getFullYear()),+a-+s}function vp(a,...e){const s=bp.bind(null,a||e.find(n=>typeof n=="object"));return e.map(s)}function th(a,e){const s=+Tr(a)-+Tr(e);return s<0?-1:s>0?1:s}function W3(a){return bp(a,Date.now())}function Q3(a,e,s){const[n,i]=vp(s?.in,a,e),l=n.getFullYear()-i.getFullYear(),o=n.getMonth()-i.getMonth();return l*12+o}function X3(a){return e=>{const n=(a?Math[a]:Math.trunc)(e);return n===0?0:n}}function J3(a,e){return+Tr(a)-+Tr(e)}function Z3(a,e){const s=Tr(a);return s.setHours(23,59,59,999),s}function eD(a,e){const s=Tr(a),n=s.getMonth();return s.setFullYear(s.getFullYear(),n+1,0),s.setHours(23,59,59,999),s}function tD(a,e){const s=Tr(a);return+Z3(s)==+eD(s)}function sD(a,e,s){const[n,i,l]=vp(s?.in,a,a,e),o=th(i,l),d=Math.abs(Q3(i,l));if(d<1)return 0;i.getMonth()===1&&i.getDate()>27&&i.setDate(30),i.setMonth(i.getMonth()-o*d);let h=th(i,l)===-o;tD(n)&&d===1&&th(n,l)===1&&(h=!1);const u=o*(d-+h);return u===0?0:u}function aD(a,e,s){const n=J3(a,e)/1e3;return X3(s?.roundingMethod)(n)}const nD={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},iD=(a,e,s)=>{let n;const i=nD[a];return typeof i=="string"?n=i:e===1?n=i.one:n=i.other.replace("{{count}}",e.toString()),s?.addSuffix?s.comparison&&s.comparison>0?"in "+n:n+" ago":n};function gg(a){return(e={})=>{const s=e.width?String(e.width):a.defaultWidth;return a.formats[s]||a.formats[a.defaultWidth]}}const rD={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},lD={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},oD={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},cD={date:gg({formats:rD,defaultWidth:"full"}),time:gg({formats:lD,defaultWidth:"full"}),dateTime:gg({formats:oD,defaultWidth:"full"})},dD={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},uD=(a,e,s,n)=>dD[a];function Tc(a){return(e,s)=>{const n=s?.context?String(s.context):"standalone";let i;if(n==="formatting"&&a.formattingValues){const o=a.defaultFormattingWidth||a.defaultWidth,d=s?.width?String(s.width):o;i=a.formattingValues[d]||a.formattingValues[o]}else{const o=a.defaultWidth,d=s?.width?String(s.width):a.defaultWidth;i=a.values[d]||a.values[o]}const l=a.argumentCallback?a.argumentCallback(e):e;return i[l]}}const hD={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},fD={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},mD={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},gD={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},pD={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},xD={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},yD=(a,e)=>{const s=Number(a),n=s%100;if(n>20||n<10)switch(n%10){case 1:return s+"st";case 2:return s+"nd";case 3:return s+"rd"}return s+"th"},bD={ordinalNumber:yD,era:Tc({values:hD,defaultWidth:"wide"}),quarter:Tc({values:fD,defaultWidth:"wide",argumentCallback:a=>a-1}),month:Tc({values:mD,defaultWidth:"wide"}),day:Tc({values:gD,defaultWidth:"wide"}),dayPeriod:Tc({values:pD,defaultWidth:"wide",formattingValues:xD,defaultFormattingWidth:"wide"})};function Ac(a){return(e,s={})=>{const n=s.width,i=n&&a.matchPatterns[n]||a.matchPatterns[a.defaultMatchWidth],l=e.match(i);if(!l)return null;const o=l[0],d=n&&a.parsePatterns[n]||a.parsePatterns[a.defaultParseWidth],h=Array.isArray(d)?_D(d,g=>g.test(o)):vD(d,g=>g.test(o));let u;u=a.valueCallback?a.valueCallback(h):h,u=s.valueCallback?s.valueCallback(u):u;const f=e.slice(o.length);return{value:u,rest:f}}}function vD(a,e){for(const s in a)if(Object.prototype.hasOwnProperty.call(a,s)&&e(a[s]))return s}function _D(a,e){for(let s=0;s<a.length;s++)if(e(a[s]))return s}function ND(a){return(e,s={})=>{const n=e.match(a.matchPattern);if(!n)return null;const i=n[0],l=e.match(a.parsePattern);if(!l)return null;let o=a.valueCallback?a.valueCallback(l[0]):l[0];o=s.valueCallback?s.valueCallback(o):o;const d=e.slice(i.length);return{value:o,rest:d}}}const wD=/^(\d+)(th|st|nd|rd)?/i,SD=/\d+/i,jD={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},ED={any:[/^b/i,/^(a|c)/i]},TD={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},AD={any:[/1/i,/2/i,/3/i,/4/i]},CD={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},kD={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},RD={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},LD={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},DD={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},MD={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},ID={ordinalNumber:ND({matchPattern:wD,parsePattern:SD,valueCallback:a=>parseInt(a,10)}),era:Ac({matchPatterns:jD,defaultMatchWidth:"wide",parsePatterns:ED,defaultParseWidth:"any"}),quarter:Ac({matchPatterns:TD,defaultMatchWidth:"wide",parsePatterns:AD,defaultParseWidth:"any",valueCallback:a=>a+1}),month:Ac({matchPatterns:CD,defaultMatchWidth:"wide",parsePatterns:kD,defaultParseWidth:"any"}),day:Ac({matchPatterns:RD,defaultMatchWidth:"wide",parsePatterns:LD,defaultParseWidth:"any"}),dayPeriod:Ac({matchPatterns:DD,defaultMatchWidth:"any",parsePatterns:MD,defaultParseWidth:"any"})},PD={code:"en-US",formatDistance:iD,formatLong:cD,formatRelative:uD,localize:bD,match:ID,options:{weekStartsOn:0,firstWeekContainsDate:1}};function OD(a,e,s){const n=Y3(),i=s?.locale??n.locale??PD,l=2520,o=th(a,e);if(isNaN(o))throw new RangeError("Invalid time value");const d=Object.assign({},s,{addSuffix:s?.addSuffix,comparison:o}),[h,u]=vp(s?.in,...o>0?[e,a]:[a,e]),f=aD(u,h),g=(g_(u)-g_(h))/1e3,p=Math.round((f-g)/60);let b;if(p<2)return s?.includeSeconds?f<5?i.formatDistance("lessThanXSeconds",5,d):f<10?i.formatDistance("lessThanXSeconds",10,d):f<20?i.formatDistance("lessThanXSeconds",20,d):f<40?i.formatDistance("halfAMinute",0,d):f<60?i.formatDistance("lessThanXMinutes",1,d):i.formatDistance("xMinutes",1,d):p===0?i.formatDistance("lessThanXMinutes",1,d):i.formatDistance("xMinutes",p,d);if(p<45)return i.formatDistance("xMinutes",p,d);if(p<90)return i.formatDistance("aboutXHours",1,d);if(p<f_){const y=Math.round(p/60);return i.formatDistance("aboutXHours",y,d)}else{if(p<l)return i.formatDistance("xDays",1,d);if(p<Su){const y=Math.round(p/f_);return i.formatDistance("xDays",y,d)}else if(p<Su*2)return b=Math.round(p/Su),i.formatDistance("aboutXMonths",b,d)}if(b=sD(u,h),b<12){const y=Math.round(p/Su);return i.formatDistance("xMonths",y,d)}else{const y=b%12,v=Math.trunc(b/12);return y<3?i.formatDistance("aboutXYears",v,d):y<9?i.formatDistance("overXYears",v,d):i.formatDistance("almostXYears",v+1,d)}}function FD(a,e){return OD(a,W3(a),e)}function BD({source:a,onRefresh:e,onDelete:s,onEdit:n,isRefreshing:i}){const l=()=>i?"border-blue-500 bg-blue-500/10":a.lastError?"border-red-500 bg-red-500/5":a.lastFetched?"border-green-500 bg-green-500/5":"border-gray-600 bg-gray-800",o=()=>i?t.jsx(ut,{className:"h-5 w-5 text-blue-400 animate-spin"}):a.lastError?t.jsx(kt,{className:"h-5 w-5 text-red-400"}):a.lastFetched?t.jsx(Xt,{className:"h-5 w-5 text-green-400"}):t.jsx(Kt,{className:"h-5 w-5 text-gray-400"}),d=()=>i?"Refreshing...":a.lastError?"Error":a.lastFetched?"Active":"Never fetched",h=()=>{if(!a.lastFetched)return"Never";try{return FD(new Date(a.lastFetched),{addSuffix:!0})}catch{return"Unknown"}};return t.jsxs("div",{className:`rounded-lg border-2 ${l()} p-4 transition-colors`,children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("h3",{className:"font-semibold text-white text-lg",children:a.name}),t.jsx("span",{className:"px-2 py-0.5 bg-indigo-600 text-white text-xs rounded uppercase font-medium",children:a.providerType})]}),t.jsx("p",{className:"text-sm text-gray-400",children:a.providerType==="gracenote"?`${a.gracenoteAffiliate}  ${a.gracenotePostalCode}`:a.url})]}),t.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[o(),t.jsx("span",{className:`text-sm font-medium ${i?"text-blue-400":a.lastError?"text-red-400":a.lastFetched?"text-green-400":"text-gray-400"}`,children:d()})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[t.jsxs("div",{className:"bg-gray-700/50 rounded p-2",children:[t.jsxs("div",{className:"flex items-center gap-1.5 text-gray-400 mb-1",children:[t.jsx(jt,{className:"h-3.5 w-3.5"}),t.jsx("span",{className:"text-xs",children:"Channels"})]}),t.jsx("p",{className:"text-lg font-semibold text-white",children:(a.channelCount||0).toLocaleString()})]}),t.jsxs("div",{className:"bg-gray-700/50 rounded p-2",children:[t.jsxs("div",{className:"flex items-center gap-1.5 text-gray-400 mb-1",children:[t.jsx(wa,{className:"h-3.5 w-3.5"}),t.jsx("span",{className:"text-xs",children:"Programs"})]}),t.jsx("p",{className:"text-lg font-semibold text-white",children:(a.programCount||0).toLocaleString()})]}),t.jsxs("div",{className:"bg-gray-700/50 rounded p-2",children:[t.jsxs("div",{className:"flex items-center gap-1.5 text-gray-400 mb-1",children:[t.jsx(Kt,{className:"h-3.5 w-3.5"}),t.jsx("span",{className:"text-xs",children:"Updated"})]}),t.jsx("p",{className:"text-xs font-medium text-white truncate",children:h()})]})]}),a.lastError&&t.jsx("div",{className:"mb-3 p-2 bg-red-900/20 border border-red-800 rounded",children:t.jsx("p",{className:"text-xs text-red-300",children:a.lastError})}),t.jsxs("div",{className:"flex gap-2",children:[n&&t.jsx("button",{onClick:()=>n(a),disabled:i,className:"px-3 py-1.5 bg-gray-600 hover:bg-gray-500 disabled:bg-gray-700 disabled:cursor-not-allowed text-white text-sm rounded flex items-center justify-center gap-1.5",title:"Edit",children:t.jsx(an,{className:"h-4 w-4"})}),t.jsxs("button",{onClick:()=>e(a.id),disabled:i,className:"flex-1 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white text-sm rounded flex items-center justify-center gap-1.5",children:[t.jsx(ut,{className:`h-4 w-4 ${i?"animate-spin":""}`}),i?"Refreshing...":"Refresh"]}),t.jsx("button",{onClick:()=>s(a.id),disabled:i,className:"px-3 py-1.5 bg-red-600 hover:bg-red-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white text-sm rounded",children:"Delete"})]})]})}const mo=a=>a?/^https?:\/\//i.test(a):!1;function p_({type:a,onClose:e}){const s=x3(),n=_3(),[i,l]=k.useState(""),[o,d]=k.useState(""),[h,u]=k.useState("xmltv"),[f,g]=k.useState(""),[p,b]=k.useState(""),[y,v]=k.useState(6),[_,N]=k.useState(null),[C,T]=k.useState(!1),[L,F]=k.useState(""),[H,B]=k.useState(!1),[P,I]=k.useState(!1),[D,O]=k.useState(null),[ee,ie]=k.useState(null),{data:Z}=Fe({queryKey:["libraries"],queryFn:()=>pe.getLibraries(),enabled:a==="m3u"}),z=Z?.filter(fe=>fe.type==="movie")||[],X=Z?.filter(fe=>fe.type==="show")||[],[ae,te]=k.useState([]),[W,K]=k.useState(null),[q,J]=k.useState(!1),oe=async()=>{if(!p||p.length<5){F("Please enter a valid 5-digit ZIP code");return}J(!0),F(""),te([]),K(null),N(null);try{const fe=await pe.discoverProviders(p);te(fe.grouped);const Le=fe.grouped.find(ze=>ze.type==="Cable");if(Le&&Le.providers.length>0){const ze=Le.providers[0];K(ze),g(ze.headendId),l(ze.name+" - "+ze.location)}}catch(fe){F(fe.response?.data?.error||fe.message||"Failed to discover providers")}finally{J(!1)}},be=fe=>{K(fe),g(fe.headendId),l(fe.name+" - "+fe.location),N(null)},ye=async()=>{if(!f){F("Please select a provider first");return}T(!0),F("");try{const fe=await pe.previewEPGSource({postalCode:p,affiliate:f,hours:y});N(fe)}catch(fe){F(fe.message||"Failed to preview EPG data"),N(null)}finally{T(!1)}},Ee=async fe=>{if(fe.preventDefault(),a==="m3u")await s.mutateAsync({name:i,url:o,importVod:H,importSeries:P,vodLibraryId:D??void 0,seriesLibraryId:ee??void 0});else if(h==="xmltv")await n.mutateAsync({name:i,providerType:"xmltv",url:o});else{if(!f){F("Please select a TV provider");return}await n.mutateAsync({name:i,providerType:"gracenote",gracenoteAffiliate:f,gracenotePostalCode:p,gracenoteHours:y})}e()},re=s.isPending||n.isPending;return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white mb-4",children:["Add ",a==="m3u"?"M3U Playlist":"EPG Source"]}),t.jsxs("form",{onSubmit:Ee,children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),t.jsx("input",{type:"text",value:i,onChange:fe=>l(fe.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:a==="m3u"?"My IPTV":"TV Guide",required:!0})]}),a==="epg"&&t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Provider"}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{type:"button",onClick:()=>u("xmltv"),className:`flex-1 py-2 px-4 rounded-lg border transition-colors ${h==="xmltv"?"bg-indigo-600 border-indigo-600 text-white":"bg-gray-700 border-gray-600 text-gray-300 hover:border-gray-500"}`,children:"XMLTV"}),t.jsx("button",{type:"button",onClick:()=>u("gracenote"),className:`flex-1 py-2 px-4 rounded-lg border transition-colors ${h==="gracenote"?"bg-indigo-600 border-indigo-600 text-white":"bg-gray-700 border-gray-600 text-gray-300 hover:border-gray-500"}`,children:"Gracenote"})]})]}),a==="m3u"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"URL"}),t.jsx("input",{type:"url",value:o,onChange:fe=>d(fe.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://example.com/playlist.m3u",required:!0})]}),t.jsxs("div",{className:"mb-6 p-4 bg-gray-700/50 rounded-lg border border-gray-600",children:[t.jsx("h3",{className:"text-sm font-semibold text-white mb-3",children:"Content Import"}),t.jsx("p",{className:"text-xs text-gray-400 mb-3",children:"Choose what to import from this M3U. Live channels are always imported."}),t.jsxs("div",{className:"mb-4",children:[t.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:H,onChange:fe=>B(fe.target.checked),className:"rounded bg-gray-600 border-gray-500"}),"Import VOD Movies"]}),H&&t.jsx("div",{className:"mt-2 ml-6",children:t.jsxs("select",{value:D||"",onChange:fe=>O(fe.target.value?parseInt(fe.target.value):null),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",children:[t.jsx("option",{value:"",children:"Select Movie Library..."}),z.map(fe=>t.jsx("option",{value:fe.id,children:fe.title},fe.id))]})})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:P,onChange:fe=>I(fe.target.checked),className:"rounded bg-gray-600 border-gray-500"}),"Import TV Series"]}),P&&t.jsx("div",{className:"mt-2 ml-6",children:t.jsxs("select",{value:ee||"",onChange:fe=>ie(fe.target.value?parseInt(fe.target.value):null),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",children:[t.jsx("option",{value:"",children:"Select TV Library..."}),X.map(fe=>t.jsx("option",{value:fe.id,children:fe.title},fe.id))]})})]})]})]}),a==="epg"&&h==="xmltv"&&t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"XMLTV URL"}),t.jsx("input",{type:"url",value:o,onChange:fe=>d(fe.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://example.com/guide.xml",required:!0})]}),a==="epg"&&h==="gracenote"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-4",children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["ZIP Code ",t.jsx("span",{className:"text-red-400",children:"*"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:p,onChange:fe=>b(fe.target.value.replace(/\D/g,"").slice(0,5)),className:"flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"10001",maxLength:5}),t.jsxs("button",{type:"button",onClick:oe,disabled:q||p.length<5,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg flex items-center gap-2",children:[q?t.jsx(ut,{className:"h-4 w-4 animate-spin"}):t.jsx(z4,{className:"h-4 w-4"}),"Find"]})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter your ZIP code to find available TV providers"})]}),L&&t.jsx("p",{className:"text-sm text-red-400 mb-4",children:L}),ae.length>0&&t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Select Your TV Provider"}),t.jsx("div",{className:"space-y-3",children:ae.map(fe=>t.jsxs("div",{children:[t.jsxs("p",{className:"text-xs text-gray-500 mb-2 uppercase tracking-wide",children:[fe.type==="Cable"&&" Cable",fe.type==="Satellite"&&" Satellite",fe.type==="Antenna"&&" Over-the-Air"]}),t.jsx("div",{className:"space-y-1",children:fe.providers.map(Le=>t.jsx("button",{type:"button",onClick:()=>be(Le),className:`w-full text-left px-4 py-3 rounded-lg border transition-colors ${W?.headendId===Le.headendId?"bg-indigo-600/20 border-indigo-500 text-white":"bg-gray-700/50 border-gray-600 text-gray-300 hover:border-gray-500 hover:bg-gray-700"}`,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:Le.name}),Le.location&&t.jsxs("span",{className:"text-gray-400 ml-2 text-sm",children:[" ",Le.location]})]}),W?.headendId===Le.headendId&&t.jsx(Bs,{className:"h-4 w-4 text-indigo-400"})]})},Le.headendId))})]},fe.type))})]}),W&&t.jsx("div",{className:"mb-4",children:t.jsx("button",{type:"button",onClick:ye,disabled:C,className:"w-full py-2 px-4 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg flex items-center justify-center gap-2",children:C?t.jsxs(t.Fragment,{children:[t.jsx(ut,{className:"h-4 w-4 animate-spin"}),"Loading Preview..."]}):t.jsxs(t.Fragment,{children:[t.jsx(xt,{className:"h-4 w-4"}),"Preview Channels (Optional)"]})})}),_&&t.jsxs("div",{className:"mb-4 p-4 bg-gray-700/50 rounded-lg border border-green-500/50",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(Bs,{className:"h-5 w-5 text-green-400"}),t.jsxs("h3",{className:"text-sm font-semibold text-white",children:["Found ",_.totalChannels," channels"]})]}),t.jsx("div",{className:"text-xs text-gray-400 mb-3",children:t.jsxs("p",{children:["Programs: ",_.totalPrograms]})}),t.jsxs("div",{className:"max-h-32 overflow-y-auto space-y-1",children:[t.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Sample channels:"}),_.previewChannels?.slice(0,5).map((fe,Le)=>t.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-300 py-1",children:[t.jsx("span",{className:"font-medium text-white",children:fe.callSign||fe.channelId}),fe.channelNo&&t.jsxs("span",{className:"text-gray-500",children:["Ch ",fe.channelNo]})]},Le)),_.totalChannels>5&&t.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["... and ",_.totalChannels-5," more channels"]})]})]}),W&&t.jsx("div",{className:"mb-4 pt-4 border-t border-gray-700",children:t.jsxs("details",{className:"group",children:[t.jsxs("summary",{className:"text-sm font-medium text-gray-400 cursor-pointer hover:text-white flex items-center gap-2",children:[t.jsx(si,{className:"h-4 w-4"}),"Advanced Settings"]}),t.jsxs("div",{className:"mt-3 space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Provider ID"}),t.jsx("input",{type:"text",value:f,onChange:fe=>g(fe.target.value),className:"w-full px-3 py-1.5 bg-gray-700 border border-gray-600 rounded text-white text-sm font-mono",readOnly:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Hours of Guide Data"}),t.jsx("input",{type:"number",value:y,onChange:fe=>v(parseInt(fe.target.value)||6),min:"1",max:"12",className:"w-full px-3 py-1.5 bg-gray-700 border border-gray-600 rounded text-white text-sm"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"1-12 hours (default: 6). API limits longer requests."})]})]})]})})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:re,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:re?"Adding...":"Add"})]})]})]})})}function UD({channel:a,onClose:e,epgSources:s}){const n=at(),[i,l]=k.useState(a.name),[o,d]=k.useState(a.number),[h,u]=k.useState(a.logo||""),[f,g]=k.useState(a.group||""),[p,b]=k.useState(a.epgSourceId||null),[y,v]=k.useState(a.channelId||""),{data:_}=Fe({queryKey:["epgChannels",p],queryFn:()=>pe.getEPGChannels(p||void 0),enabled:!!p}),N=Me({mutationFn:async T=>{const L=await fetch(`/livetv/channels/${a.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Plex-Token":pe.getToken()||""},body:JSON.stringify(T)});if(!L.ok)throw new Error("Failed to update channel");return L.json()},onSuccess:()=>{n.invalidateQueries({queryKey:["channels"]}),e()}}),C=T=>{T.preventDefault(),N.mutate({name:i,number:o,logo:h,group:f,epgSourceId:p??void 0,channelId:y||void 0})};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Edit Channel"}),t.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white",children:t.jsx(nt,{className:"h-5 w-5"})})]}),t.jsxs("form",{onSubmit:C,children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),t.jsx("input",{type:"text",value:i,onChange:T=>l(T.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Number"}),t.jsx("input",{type:"number",value:o,onChange:T=>d(parseInt(T.target.value)||0),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Logo URL"}),t.jsx("input",{type:"text",value:h,onChange:T=>u(T.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"https://..."})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Group"}),t.jsx("input",{type:"text",value:f,onChange:T=>g(T.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"Sports, News, etc."})]}),t.jsxs("div",{className:"mb-4 pt-4 border-t border-gray-700",children:[t.jsx("h3",{className:"text-sm font-semibold text-white mb-3",children:"EPG Mapping"}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"EPG Source"}),t.jsxs("select",{value:p||"",onChange:T=>{const L=T.target.value?parseInt(T.target.value):null;b(L),v("")},className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:[t.jsx("option",{value:"",children:"None"}),s.map(T=>t.jsx("option",{value:T.id,children:T.name},T.id))]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select an EPG source to match program guide data"})]}),p&&t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"EPG Channel"}),t.jsxs("select",{value:y,onChange:T=>v(T.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:[t.jsx("option",{value:"",children:"Select EPG Channel..."}),_?.map(T=>t.jsxs("option",{value:T.channelId,children:[T.callSign||T.channelId,T.channelNo?` (${T.channelNo})`:""," - ",T.sampleTitle]},T.channelId))]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Match this channel to an EPG channel ID"})]})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:N.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:N.isPending?"Saving...":"Save"})]})]})]})})}function $D({onClose:a}){const e=at(),[s,n]=k.useState(""),[i,l]=k.useState(""),[o,d]=k.useState("file"),[h,u]=k.useState(""),[f,g]=k.useState(null),[p,b]=k.useState(!1),[y,v]=k.useState(!1),[_,N]=k.useState(""),C=k.useRef(null),[T,L]=k.useState({}),[F,H]=k.useState({}),{data:B}=Fe({queryKey:["channels"],queryFn:async()=>(await(await fetch("/livetv/channels",{headers:{"X-Plex-Token":pe.getToken()||""}})).json()).channels||[]}),P=ie=>{const Z=ie.target.files?.[0];if(Z){u(Z.name);const z=new FileReader;z.onload=X=>{const ae=X.target?.result;l(ae)},z.onerror=()=>{N("Failed to read file")},z.readAsText(Z)}},I=async()=>{b(!0),N(""),g(null);try{const ie=o==="url"?{url:s,preview:!0}:{content:i,preview:!0},Z=await pe.mapChannelNumbers(ie);g(Z)}catch(ie){N(ie.response?.data?.error||ie.message||"Failed to parse M3U")}finally{b(!1)}},D=async()=>{v(!0),N("");try{const ie=Object.entries(T).map(([X,ae])=>{const te=ee.find(W=>W.m3uName===X);return{m3uName:X,m3uNumber:te?.m3uNumber||0,channelId:ae}}),Z=o==="url"?{url:s,preview:!1,manualMappings:ie}:{content:i,preview:!1,manualMappings:ie},z=await pe.mapChannelNumbers(Z);g(z),L({}),e.invalidateQueries({queryKey:["channels"]})}catch(ie){N(ie.response?.data?.error||ie.message||"Failed to apply mappings")}finally{v(!1)}},O=f?.results?.filter(ie=>ie.matchType!=="none")||[],ee=f?.results?.filter(ie=>ie.matchType==="none")||[];return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Import Channel Numbers from M3U"}),t.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white",children:t.jsx(nt,{className:"h-5 w-5"})})]}),t.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Import channel numbers from an M3U file to apply to your existing channels. Only channel numbers will be updated - stream URLs will not be modified."}),t.jsxs("div",{className:"flex gap-2 mb-4",children:[t.jsx("button",{onClick:()=>d("file"),className:`px-4 py-2 rounded-lg text-sm ${o==="file"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Upload File"}),t.jsx("button",{onClick:()=>d("url"),className:`px-4 py-2 rounded-lg text-sm ${o==="url"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"URL"}),t.jsx("button",{onClick:()=>d("paste"),className:`px-4 py-2 rounded-lg text-sm ${o==="paste"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Paste Content"})]}),o==="file"?t.jsxs("div",{className:"mb-4",children:[t.jsx("input",{ref:C,type:"file",accept:".m3u,.m3u8,text/plain",onChange:P,className:"hidden"}),t.jsx("div",{onClick:()=>C.current?.click(),className:"w-full p-6 bg-gray-700 border-2 border-dashed border-gray-600 rounded-lg text-center cursor-pointer hover:border-indigo-500 hover:bg-gray-700/70 transition-colors",children:h?t.jsxs("div",{children:[t.jsx(wa,{className:"h-8 w-8 text-indigo-400 mx-auto mb-2"}),t.jsx("p",{className:"text-white font-medium",children:h}),t.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Click to choose a different file"})]}):t.jsxs("div",{children:[t.jsx(Mi,{className:"h-8 w-8 text-gray-500 mx-auto mb-2"}),t.jsx("p",{className:"text-gray-300",children:"Click to select an M3U file"}),t.jsx("p",{className:"text-gray-500 text-sm mt-1",children:".m3u or .m3u8"})]})})]}):o==="url"?t.jsx("div",{className:"mb-4",children:t.jsx("input",{type:"url",value:s,onChange:ie=>n(ie.target.value),placeholder:"https://example.com/channels.m3u",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"})}):t.jsx("div",{className:"mb-4",children:t.jsx("textarea",{value:i,onChange:ie=>l(ie.target.value),placeholder:`#EXTM3U
#EXTINF:-1 tvg-chno="5",Channel Name
http://...`,className:"w-full h-32 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white font-mono text-sm"})}),_&&t.jsx("div",{className:"mb-4 p-3 bg-red-900/50 border border-red-500 rounded-lg text-red-300 text-sm",children:_}),!f&&t.jsx("button",{onClick:I,disabled:p||!s&&!i,className:"w-full mb-4 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg flex items-center justify-center gap-2",children:p?t.jsxs(t.Fragment,{children:[t.jsx(ut,{className:"h-4 w-4 animate-spin"}),"Parsing..."]}):t.jsxs(t.Fragment,{children:[t.jsx(xt,{className:"h-4 w-4"}),"Preview Matches"]})}),f&&t.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[t.jsxs("div",{className:"flex gap-4 mb-4",children:[t.jsxs("div",{className:"flex-1 p-3 bg-green-900/30 border border-green-500/50 rounded-lg",children:[t.jsx("div",{className:"text-green-400 text-lg font-semibold",children:f.matched}),t.jsx("div",{className:"text-green-300 text-xs",children:"Matched"})]}),t.jsxs("div",{className:"flex-1 p-3 bg-yellow-900/30 border border-yellow-500/50 rounded-lg",children:[t.jsx("div",{className:"text-yellow-400 text-lg font-semibold",children:f.unmatched}),t.jsx("div",{className:"text-yellow-300 text-xs",children:"Unmatched"})]})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto mb-4",children:[O.length>0&&t.jsxs("div",{className:"mb-4",children:[t.jsx("h3",{className:"text-sm font-medium text-white mb-2",children:"Matched Channels"}),t.jsxs("div",{className:"space-y-1",children:[O.slice(0,50).map((ie,Z)=>t.jsxs("div",{className:"flex items-center justify-between text-sm bg-gray-700/50 p-2 rounded",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-indigo-400 font-mono w-12",children:ie.m3uNumber}),t.jsx("span",{className:"text-white",children:ie.m3uName})]}),t.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[t.jsx("span",{className:"text-xs bg-gray-600 px-1.5 py-0.5 rounded",children:ie.matchType}),t.jsxs("span",{children:[" ",ie.matchedName]}),ie.applied&&t.jsx(Bs,{className:"h-3 w-3 text-green-400"})]})]},Z)),O.length>50&&t.jsxs("div",{className:"text-xs text-gray-500 text-center py-2",children:["... and ",O.length-50," more"]})]})]}),ee.length>0&&t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-medium text-yellow-400 mb-2",children:["Unmatched (",ee.length,")",Object.keys(T).length>0&&t.jsxs("span",{className:"text-green-400 ml-2",children:["- ",Object.keys(T).length," manually matched"]})]}),t.jsx("div",{className:"space-y-1",children:ee.map((ie,Z)=>{const z=F[ie.m3uName]||"",X=T[ie.m3uName]?B?.find(te=>te.id===T[ie.m3uName]):null,ae=B?.filter(te=>{if(!z)return!0;const W=z.toLowerCase();return te.name.toLowerCase().includes(W)||te.number.toString().includes(W)})||[];return t.jsxs("div",{className:"flex items-center gap-2 text-sm p-2 bg-gray-700/30 rounded",children:[t.jsx("span",{className:"text-indigo-400 font-mono w-12 flex-shrink-0",children:ie.m3uNumber}),t.jsx("span",{className:"text-white flex-shrink-0 min-w-[120px]",children:ie.m3uName}),t.jsx("span",{className:"text-gray-500 mx-2",children:""}),t.jsxs("div",{className:"flex-1 relative",children:[t.jsx("input",{type:"text",value:X?`${X.number} - ${X.name}`:z,onChange:te=>{T[ie.m3uName]&&L(W=>{const{[ie.m3uName]:K,...q}=W;return q}),H(W=>({...W,[ie.m3uName]:te.target.value}))},onFocus:()=>{X&&(H(te=>({...te,[ie.m3uName]:""})),L(te=>{const{[ie.m3uName]:W,...K}=te;return K}))},placeholder:"Type to search channels...",className:`w-full px-2 py-1 bg-gray-700 border rounded text-sm ${X?"border-green-500 text-green-300":"border-gray-600 text-white"}`}),z&&!X&&ae.length>0&&t.jsxs("div",{className:"absolute z-10 w-full mt-1 max-h-48 overflow-y-auto bg-gray-800 border border-gray-600 rounded shadow-lg",children:[ae.slice(0,20).map(te=>t.jsxs("div",{onClick:()=>{L(W=>({...W,[ie.m3uName]:te.id})),H(W=>{const{[ie.m3uName]:K,...q}=W;return q})},className:"px-2 py-1 hover:bg-gray-700 cursor-pointer text-gray-200",children:[te.number," - ",te.name]},te.id)),ae.length>20&&t.jsxs("div",{className:"px-2 py-1 text-gray-500 text-xs",children:["+",ae.length-20," more results..."]})]})]}),X&&t.jsx("button",{onClick:()=>{L(te=>{const{[ie.m3uName]:W,...K}=te;return K})},className:"text-gray-400 hover:text-red-400",children:t.jsx(nt,{className:"h-4 w-4"})}),X&&t.jsx(Bs,{className:"h-4 w-4 text-green-400 flex-shrink-0"})]},Z)})})]})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:()=>g(null),className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Back"}),t.jsx("button",{onClick:D,disabled:y||f.matched===0&&Object.keys(T).length===0,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg flex items-center justify-center gap-2",children:y?t.jsxs(t.Fragment,{children:[t.jsx(ut,{className:"h-4 w-4 animate-spin"}),"Applying..."]}):t.jsxs(t.Fragment,{children:[t.jsx(Bs,{className:"h-4 w-4"}),"Apply ",f.matched+Object.keys(T).length," Mappings"]})})]})]})]})})}function GD({source:a,onClose:e}){const s=at(),[n,i]=k.useState(a.name),[l,o]=k.useState(a.url),[d,h]=k.useState(a.importVod||!1),[u,f]=k.useState(a.importSeries||!1),[g,p]=k.useState(a.vodLibraryId||null),[b,y]=k.useState(a.seriesLibraryId||null),[v,_]=k.useState(""),[N,C]=k.useState(null),{data:T}=Fe({queryKey:["libraries"],queryFn:()=>pe.getLibraries()}),L=T?.filter(D=>D.type==="movie")||[],F=T?.filter(D=>D.type==="show")||[],H=Me({mutationFn:async D=>pe.updateM3USource(a.id,D),onSuccess:()=>{s.invalidateQueries({queryKey:["m3uSources"]}),s.invalidateQueries({queryKey:["channels"]}),e()},onError:D=>{_(D.response?.data?.error||D.message||"Failed to update source")}}),B=Me({mutationFn:async()=>pe.importM3UVOD(a.id),onSuccess:D=>{C(`VOD import complete: ${D.added} added, ${D.updated} updated`),s.invalidateQueries({queryKey:["m3uSources"]})},onError:D=>{_(D.response?.data?.error||D.message||"Failed to import VOD")}}),P=Me({mutationFn:async()=>pe.importM3USeries(a.id),onSuccess:D=>{C(D.message),s.invalidateQueries({queryKey:["m3uSources"]})},onError:D=>{_(D.response?.data?.error||D.message||"Failed to import series")}}),I=D=>{D.preventDefault(),_(""),H.mutate({name:n,url:l,importVod:d,importSeries:u,vodLibraryId:g??void 0,seriesLibraryId:b??void 0})};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Edit M3U Source"}),t.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white",children:t.jsx(nt,{className:"h-5 w-5"})})]}),t.jsxs("form",{onSubmit:I,children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),t.jsx("input",{type:"text",value:n,onChange:D=>i(D.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"URL"}),t.jsx("input",{type:"url",value:l,onChange:D=>o(D.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://example.com/playlist.m3u",required:!0}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Update the URL if your provider's IP address changed"})]}),t.jsxs("div",{className:"mb-4 pt-4 border-t border-gray-700",children:[t.jsxs("h3",{className:"text-sm font-semibold text-white mb-3 flex items-center gap-2",children:[t.jsx(Gt,{className:"h-4 w-4 text-purple-400"}),"VOD Import Settings"]}),t.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Import movies and series from VOD entries in the M3U playlist"}),t.jsxs("div",{className:"mb-4",children:[t.jsxs("label",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"checkbox",checked:d,onChange:D=>h(D.target.checked),className:"w-4 h-4 rounded bg-gray-700 border-gray-600 text-indigo-500"}),t.jsx("span",{className:"text-sm text-gray-300",children:"Import Movies (VOD)"})]}),d&&t.jsx("div",{className:"mt-2 ml-7",children:t.jsxs("select",{value:g||"",onChange:D=>p(D.target.value?parseInt(D.target.value):null),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white",children:[t.jsx("option",{value:"",children:"Select Movie Library..."}),L.map(D=>t.jsx("option",{value:D.id,children:D.title},D.id))]})})]}),t.jsxs("div",{className:"mb-4",children:[t.jsxs("label",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"checkbox",checked:u,onChange:D=>f(D.target.checked),className:"w-4 h-4 rounded bg-gray-700 border-gray-600 text-indigo-500"}),t.jsx("span",{className:"text-sm text-gray-300",children:"Import TV Series"})]}),u&&t.jsx("div",{className:"mt-2 ml-7",children:t.jsxs("select",{value:b||"",onChange:D=>y(D.target.value?parseInt(D.target.value):null),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white",children:[t.jsx("option",{value:"",children:"Select TV Library..."}),F.map(D=>t.jsx("option",{value:D.id,children:D.title},D.id))]})})]}),(d||u)&&t.jsxs("div",{className:"flex gap-2 mt-3",children:[d&&g&&t.jsxs("button",{type:"button",onClick:()=>B.mutate(),disabled:B.isPending,className:"flex-1 py-2 px-3 bg-purple-600 hover:bg-purple-700 text-white text-sm rounded-lg flex items-center justify-center gap-2",children:[B.isPending?t.jsx(ut,{className:"h-4 w-4 animate-spin"}):t.jsx(gs,{className:"h-4 w-4"}),"Import Movies"]}),u&&b&&t.jsxs("button",{type:"button",onClick:()=>P.mutate(),disabled:P.isPending,className:"flex-1 py-2 px-3 bg-purple-600 hover:bg-purple-700 text-white text-sm rounded-lg flex items-center justify-center gap-2",children:[P.isPending?t.jsx(ut,{className:"h-4 w-4 animate-spin"}):t.jsx(gs,{className:"h-4 w-4"}),"Import Series"]})]})]}),N&&t.jsx("div",{className:"mb-4 p-3 bg-green-500/20 border border-green-500/50 rounded-lg",children:t.jsxs("p",{className:"text-sm text-green-300 flex items-center gap-2",children:[t.jsx(Bs,{className:"h-4 w-4"}),N]})}),v&&t.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg",children:t.jsxs("p",{className:"text-sm text-red-300 flex items-center gap-2",children:[t.jsx(kt,{className:"h-4 w-4"}),v]})}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:H.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:H.isPending?"Saving...":"Save Changes"})]})]})]})})}function VD({source:a,onClose:e}){const s=at(),[n,i]=k.useState(a.name),[l,o]=k.useState(a.serverUrl),[d,h]=k.useState(a.username),[u,f]=k.useState(""),[g,p]=k.useState(a.importVod||!1),[b,y]=k.useState(a.importSeries||!1),[v,_]=k.useState(a.vodLibraryId||null),[N,C]=k.useState(a.seriesLibraryId||null),[T,L]=k.useState(""),{data:F}=Fe({queryKey:["libraries"],queryFn:()=>pe.getLibraries()}),H=F?.filter(D=>D.type==="movie")||[],B=F?.filter(D=>D.type==="show")||[],P=Me({mutationFn:async D=>pe.updateXtreamSource(a.id,D),onSuccess:()=>{s.invalidateQueries({queryKey:["xtreamSources"]}),s.invalidateQueries({queryKey:["channels"]}),e()},onError:D=>{L(D.response?.data?.error||D.message||"Failed to update source")}}),I=D=>{D.preventDefault(),L("");const O={name:n,serverUrl:l,username:d,importVod:g,importSeries:b,vodLibraryId:v??void 0,seriesLibraryId:N??void 0};u&&(O.password=u),P.mutate(O)};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[t.jsx(xa,{className:"h-5 w-5 text-yellow-400"}),"Edit Xtream Source"]}),t.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white",children:t.jsx(nt,{className:"h-5 w-5"})})]}),t.jsxs("form",{onSubmit:I,children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),t.jsx("input",{type:"text",value:n,onChange:D=>i(D.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Server URL"}),t.jsx("input",{type:"url",value:l,onChange:D=>o(D.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://server.com:8080",required:!0}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Update the URL if your provider's IP address changed"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Username"}),t.jsx("input",{type:"text",value:d,onChange:D=>h(D.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Password ",t.jsx("span",{className:"text-gray-500",children:"(leave blank to keep current)"})]}),t.jsx("input",{type:"password",value:u,onChange:D=>f(D.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:""})]}),t.jsxs("div",{className:"mb-6 p-4 bg-gray-700/50 rounded-lg border border-gray-600",children:[t.jsx("h3",{className:"text-sm font-semibold text-white mb-3",children:"Content Import"}),t.jsxs("div",{className:"mb-4",children:[t.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:g,onChange:D=>p(D.target.checked),className:"rounded bg-gray-600 border-gray-500"}),"Import VOD Movies"]}),g&&t.jsx("div",{className:"mt-2 ml-6",children:t.jsxs("select",{value:v||"",onChange:D=>_(D.target.value?parseInt(D.target.value):null),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",children:[t.jsx("option",{value:"",children:"Select Movie Library..."}),H.map(D=>t.jsx("option",{value:D.id,children:D.title},D.id))]})})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:b,onChange:D=>y(D.target.checked),className:"rounded bg-gray-600 border-gray-500"}),"Import TV Series"]}),b&&t.jsx("div",{className:"mt-2 ml-6",children:t.jsxs("select",{value:N||"",onChange:D=>C(D.target.value?parseInt(D.target.value):null),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",children:[t.jsx("option",{value:"",children:"Select TV Library..."}),B.map(D=>t.jsx("option",{value:D.id,children:D.title},D.id))]})})]})]}),T&&t.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg",children:t.jsxs("p",{className:"text-sm text-red-300 flex items-center gap-2",children:[t.jsx(kt,{className:"h-4 w-4"}),T]})}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:P.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:P.isPending?"Saving...":"Save Changes"})]})]})]})})}function qD({source:a,onClose:e}){const s=at(),[n,i]=k.useState(a.name),[l,o]=k.useState(a.url||""),[d,h]=k.useState(a.gracenoteAffiliate||""),[u,f]=k.useState(a.gracenotePostalCode||""),[g,p]=k.useState(a.gracenoteHours||6),[b,y]=k.useState(""),v=Me({mutationFn:async N=>pe.updateEPGSource(a.id,N),onSuccess:()=>{s.invalidateQueries({queryKey:["epgSources"]}),e()},onError:N=>{y(N.response?.data?.error||N.message||"Failed to update source")}}),_=N=>{N.preventDefault(),y(""),a.providerType==="xmltv"?v.mutate({name:n,url:l}):v.mutate({name:n,gracenoteAffiliate:d,gracenotePostalCode:u,gracenoteHours:g})};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Edit EPG Source"}),t.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white",children:t.jsx(nt,{className:"h-5 w-5"})})]}),t.jsxs("form",{onSubmit:_,children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),t.jsx("input",{type:"text",value:n,onChange:N=>i(N.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),a.providerType==="xmltv"?t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"XMLTV URL"}),t.jsx("input",{type:"url",value:l,onChange:N=>o(N.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://example.com/guide.xml",required:!0}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Update the URL if your EPG provider's address changed"})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"ZIP Code"}),t.jsx("input",{type:"text",value:u,onChange:N=>f(N.target.value.replace(/\D/g,"").slice(0,5)),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"10001",maxLength:5})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Provider ID (Headend)"}),t.jsx("input",{type:"text",value:d,onChange:N=>h(N.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white font-mono"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Change if you switched TV providers"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Hours of Guide Data"}),t.jsx("input",{type:"number",value:g,onChange:N=>p(parseInt(N.target.value)||6),min:"1",max:"12",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"})]})]}),b&&t.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg",children:t.jsxs("p",{className:"text-sm text-red-300 flex items-center gap-2",children:[t.jsx(kt,{className:"h-4 w-4"}),b]})}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:v.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:v.isPending?"Saving...":"Save Changes"})]})]})]})})}function KD({onClose:a}){const e=at(),[s,n]=k.useState(""),[i,l]=k.useState(""),[o,d]=k.useState(""),[h,u]=k.useState(""),[f,g]=k.useState(""),[p,b]=k.useState(!1),[y,v]=k.useState(null),[_,N]=k.useState(""),[C,T]=k.useState(!1),[L,F]=k.useState(!1),[H,B]=k.useState(!1),[P,I]=k.useState(null),[D,O]=k.useState(null),{data:ee}=Fe({queryKey:["libraries"],queryFn:()=>pe.getLibraries()}),ie=ee?.filter(K=>K.type==="movie")||[],Z=ee?.filter(K=>K.type==="show")||[],[z,X]=k.useState(""),ae=Me({mutationFn:async K=>pe.createXtreamSource(K),onSuccess:()=>{e.invalidateQueries({queryKey:["xtreamSources"]}),a()},onError:K=>{X(K.response?.data?.error||K.message||"Failed to add source")}}),te=async()=>{if(f){T(!0),N(""),v(null);try{const K=await pe.parseXtreamFromM3U(f);K.success?(v(K),l(K.serverUrl||""),d(K.username||""),u(K.password||""),n(K.name||"")):(N(K.error||"Failed to parse URL"),K.serverUrl&&l(K.serverUrl),K.username&&d(K.username))}catch(K){N(K.message||"Failed to parse URL")}finally{T(!1)}}},W=async K=>{K.preventDefault(),X(""),await ae.mutateAsync({name:s,serverUrl:i,username:o,password:h,importVod:L,importSeries:H,vodLibraryId:P??void 0,seriesLibraryId:D??void 0})};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[t.jsx(xa,{className:"h-5 w-5 text-yellow-400"}),"Add Xtream Source"]}),t.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white",children:t.jsx(nt,{className:"h-5 w-5"})})]}),t.jsxs("div",{className:"mb-6 p-4 bg-gray-700/50 rounded-lg border border-gray-600",children:[t.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-300 mb-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:p,onChange:K=>b(K.target.checked),className:"rounded"}),"Auto-detect from M3U URL"]}),p&&t.jsxs("div",{className:"mt-3",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"url",value:f,onChange:K=>g(K.target.value),className:"flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",placeholder:"http://server:port/get.php?username=...&password=..."}),t.jsx("button",{type:"button",onClick:te,disabled:C||!f,className:"px-3 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 text-white rounded-lg text-sm",children:C?t.jsx(ut,{className:"h-4 w-4 animate-spin"}):"Parse"})]}),_&&t.jsxs("p",{className:"text-sm text-yellow-400 mt-2 flex items-center gap-1",children:[t.jsx(kt,{className:"h-4 w-4"}),_]}),y&&y.success&&t.jsxs("div",{className:"mt-3 p-2 bg-green-500/20 border border-green-500/50 rounded text-sm text-green-300",children:[t.jsx(Bs,{className:"inline h-4 w-4 mr-1"}),"Credentials detected! Account status: ",y.userInfo?.status]})]})]}),t.jsxs("form",{onSubmit:W,children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),t.jsx("input",{type:"text",value:s,onChange:K=>n(K.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"My IPTV Provider",required:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Server URL"}),t.jsx("input",{type:"url",value:i,onChange:K=>l(K.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://server.com:8080",required:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Username"}),t.jsx("input",{type:"text",value:o,onChange:K=>d(K.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Password"}),t.jsx("input",{type:"password",value:h,onChange:K=>u(K.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",required:!0})]}),t.jsxs("div",{className:"mb-6 p-4 bg-gray-700/50 rounded-lg border border-gray-600",children:[t.jsx("h3",{className:"text-sm font-semibold text-white mb-3",children:"Content Import"}),t.jsx("p",{className:"text-xs text-gray-400 mb-4",children:"Import VOD movies and series from this source into your media libraries"}),t.jsxs("div",{className:"mb-4",children:[t.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:L,onChange:K=>F(K.target.checked),className:"rounded bg-gray-600 border-gray-500"}),"Import VOD Movies"]}),L&&t.jsxs("div",{className:"mt-2 ml-6",children:[t.jsxs("select",{value:P||"",onChange:K=>I(K.target.value?parseInt(K.target.value):null),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",required:L,children:[t.jsx("option",{value:"",children:"Select Movie Library..."}),ie.map(K=>t.jsx("option",{value:K.id,children:K.title},K.id))]}),ie.length===0&&t.jsx("p",{className:"text-xs text-yellow-400 mt-1",children:"No movie libraries found. Create one first."})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:H,onChange:K=>B(K.target.checked),className:"rounded bg-gray-600 border-gray-500"}),"Import TV Series"]}),H&&t.jsxs("div",{className:"mt-2 ml-6",children:[t.jsxs("select",{value:D||"",onChange:K=>O(K.target.value?parseInt(K.target.value):null),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",required:H,children:[t.jsx("option",{value:"",children:"Select TV Library..."}),Z.map(K=>t.jsx("option",{value:K.id,children:K.title},K.id))]}),Z.length===0&&t.jsx("p",{className:"text-xs text-yellow-400 mt-1",children:"No TV show libraries found. Create one first."})]})]})]}),z&&t.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg",children:t.jsxs("p",{className:"text-sm text-red-300 flex items-center gap-2",children:[t.jsx(kt,{className:"h-4 w-4"}),z]})}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{type:"button",onClick:a,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:ae.isPending,className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:ae.isPending?"Adding...":"Add Source"})]})]})]})})}function HD({epgSources:a}){const[e,s]=k.useState(null),[n,i]=k.useState(1),l=50,{data:o,isLoading:d}=Fe({queryKey:["epgPrograms",e,n],queryFn:()=>pe.getEPGPrograms({page:n,limit:l,epgSourceId:e||void 0}),enabled:a.length>0}),h=a.reduce((u,f)=>u+(f.programCount||0),0);return t.jsx("div",{children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-white mb-1",children:"EPG Program Listings"}),t.jsxs("p",{className:"text-sm text-gray-400",children:["Total: ",h.toLocaleString()," programs across ",a.length," source(s)"]})]}),a.length>1&&t.jsxs("select",{value:e||"",onChange:u=>{s(u.target.value?parseInt(u.target.value):null),i(1)},className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",children:[t.jsx("option",{value:"",children:"All Sources"}),a.map(u=>t.jsxs("option",{value:u.id,children:[u.name," (",u.programCount," programs)"]},u.id))]})]}),t.jsx("div",{className:"mb-4 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:t.jsxs("p",{className:"text-sm text-blue-300",children:[t.jsx("strong",{children:"Note:"})," Channel names in gray are EPG channel IDs that haven't been mapped to your M3U channels yet. Go to the ",t.jsx("strong",{children:"Channels"})," tab to assign EPG sources to your channels for proper matching."]})}),d?t.jsxs("div",{className:"text-center py-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto"}),t.jsx("p",{className:"text-gray-400 mt-4",children:"Loading programs..."})]}):o&&o.programs.length>0?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-gray-700/50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-left p-3 text-gray-300 text-sm font-medium",children:"Channel"}),t.jsx("th",{className:"text-left p-3 text-gray-300 text-sm font-medium",children:"Program"}),t.jsx("th",{className:"text-left p-3 text-gray-300 text-sm font-medium",children:"Time"}),t.jsx("th",{className:"text-left p-3 text-gray-300 text-sm font-medium",children:"Category"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-700",children:o.programs.map(u=>{const f=new Date(u.start),g=new Date(u.end),p=Math.round((g.getTime()-f.getTime())/6e4),b=u.channelName||u.channelId?.replace(/^(fubo|gracenote)-/,"")||"Unknown",y=!u.channelName;return t.jsxs("tr",{className:"hover:bg-gray-700/30",children:[t.jsxs("td",{className:"p-3",children:[t.jsx("div",{className:`font-medium ${y?"text-gray-400":"text-white"}`,children:b}),y&&t.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["EPG ID: ",u.channelId]})]}),t.jsxs("td",{className:"p-3",children:[t.jsx("div",{className:"font-medium text-white",children:u.title}),u.description&&t.jsx("div",{className:"text-sm text-gray-400 mt-1 line-clamp-2",children:u.description}),u.episodeNum&&t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:u.episodeNum})]}),t.jsxs("td",{className:"p-3",children:[t.jsxs("div",{className:"text-sm text-white",children:[f.toLocaleDateString()," ",f.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),t.jsxs("div",{className:"text-xs text-gray-400",children:[p," min"]})]}),t.jsx("td",{className:"p-3",children:u.category&&t.jsx("span",{className:"inline-block px-2 py-1 bg-gray-700 text-gray-300 text-xs rounded",children:u.category})})]},u.id)})})]})}),o.pages>1&&t.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t border-gray-700",children:[t.jsxs("div",{className:"text-sm text-gray-400",children:["Showing ",(n-1)*l+1," - ",Math.min(n*l,o.total)," of ",o.total.toLocaleString()]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>i(u=>Math.max(1,u-1)),disabled:n===1,className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),t.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,o.pages)},(u,f)=>{let g;return o.pages<=5||n<=3?g=f+1:n>=o.pages-2?g=o.pages-4+f:g=n-2+f,t.jsx("button",{onClick:()=>i(g),className:`px-3 py-1.5 text-sm rounded ${n===g?"bg-indigo-600 text-white":"bg-gray-700 hover:bg-gray-600 text-white"}`,children:g},g)})}),t.jsx("button",{onClick:()=>i(u=>Math.min(o.pages,u+1)),disabled:n===o.pages,className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx(wa,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-400",children:a.length===0?"No EPG sources configured. Add an EPG source to see program listings.":"No programs found. Try refreshing your EPG sources."})]})]})})}function zD({group:a,channels:e,onEdit:s,onDelete:n,onAddMember:i,onUpdatePriority:l,onRemoveMember:o}){const[d,h]=k.useState(!1),[u,f]=k.useState(!1),[g,p]=k.useState(""),b=new Set(a.members?.map(_=>_.channelId)||[]),v=e.filter(_=>_.enabled&&!b.has(_.id)).filter(_=>_.name.toLowerCase().includes(g.toLowerCase()));return t.jsxs("div",{className:"bg-gray-800 rounded-xl overflow-hidden",children:[t.jsxs("div",{className:"p-4 flex items-center justify-between cursor-pointer hover:bg-gray-750",onClick:()=>h(!d),children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("button",{className:"text-gray-400",children:d?t.jsx(Pn,{className:"h-5 w-5"}):t.jsx(Ba,{className:"h-5 w-5"})}),mo(a.logo)?t.jsx("img",{src:a.logo,alt:a.name,className:"w-10 h-10 object-contain bg-gray-700 rounded"}):t.jsx("div",{className:"w-10 h-10 bg-gray-700 rounded flex items-center justify-center",children:t.jsx(Fi,{className:"h-5 w-5 text-gray-500"})}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-white font-medium",children:a.name}),t.jsxs("span",{className:"text-gray-500 text-sm",children:["#",a.displayNumber]}),!a.enabled&&t.jsx("span",{className:"px-2 py-0.5 bg-gray-700 text-gray-400 text-xs rounded",children:"Disabled"})]}),t.jsxs("div",{className:"text-sm text-gray-400",children:[a.members?.length||0," source",(a.members?.length||0)!==1?"s":"",a.channelId&&`  EPG: ${a.channelId}`]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",onClick:_=>_.stopPropagation(),children:[t.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded",title:"Edit group",children:t.jsx(an,{className:"h-4 w-4"})}),t.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded",title:"Delete group",children:t.jsx(Dt,{className:"h-4 w-4"})})]})]}),d&&t.jsxs("div",{className:"border-t border-gray-700 p-4",children:[a.members?.length>0?t.jsxs("div",{className:"space-y-2 mb-4",children:[t.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-2",children:"Priority Order (failover from top to bottom)"}),a.members.sort((_,N)=>_.priority-N.priority).map((_,N)=>t.jsxs("div",{className:"flex items-center justify-between bg-gray-750 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("span",{className:"text-gray-500 text-sm font-mono w-6",children:[N+1,"."]}),mo(_.channel?.logo)?t.jsx("img",{src:_.channel.logo,alt:_.channel.name,className:"w-8 h-8 object-contain bg-gray-700 rounded"}):t.jsx("div",{className:"w-8 h-8 bg-gray-700 rounded flex items-center justify-center",children:t.jsx($s,{className:"h-4 w-4 text-gray-500"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-white text-sm",children:_.channel?.name}),t.jsx("div",{className:"text-gray-500 text-xs",children:_.channel?.sourceName||"Unknown source"})]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>l(_.channelId,Math.max(0,_.priority-1)),disabled:N===0,className:"p-1.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded disabled:opacity-30",title:"Move up",children:t.jsx(Uh,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>l(_.channelId,_.priority+1),disabled:N===(a.members?.length||0)-1,className:"p-1.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded disabled:opacity-30",title:"Move down",children:t.jsx(ed,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>o(_.channelId),className:"p-1.5 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded",title:"Remove from group",children:t.jsx(nt,{className:"h-4 w-4"})})]})]},_.channelId))]}):t.jsx("div",{className:"text-center py-4 text-gray-400 mb-4",children:"No channels in this group. Add channels to enable failover."}),u?t.jsxs("div",{className:"bg-gray-750 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(xt,{className:"h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search channels to add...",value:g,onChange:_=>p(_.target.value),className:"flex-1 bg-transparent text-white placeholder-gray-500 outline-none text-sm",autoFocus:!0}),t.jsx("button",{onClick:()=>{f(!1),p("")},className:"p-1 text-gray-400 hover:text-white",children:t.jsx(nt,{className:"h-4 w-4"})})]}),t.jsx("div",{className:"max-h-48 overflow-y-auto space-y-1",children:v.length>0?v.slice(0,20).map(_=>t.jsxs("button",{onClick:()=>{i(_.id,a.members?.length||0),p("")},className:"w-full flex items-center gap-3 p-2 hover:bg-gray-700 rounded text-left",children:[mo(_.logo)?t.jsx("img",{src:_.logo,alt:_.name,className:"w-6 h-6 object-contain bg-gray-700 rounded"}):t.jsx("div",{className:"w-6 h-6 bg-gray-700 rounded flex items-center justify-center",children:t.jsx($s,{className:"h-3 w-3 text-gray-500"})}),t.jsx("span",{className:"text-sm text-white",children:_.name}),t.jsxs("span",{className:"text-xs text-gray-500",children:["#",_.number]})]},_.id)):t.jsx("div",{className:"text-center py-2 text-gray-500 text-sm",children:g?"No matching channels":"No available channels"})})]}):t.jsxs("button",{onClick:()=>f(!0),className:"w-full py-2 border border-dashed border-gray-600 rounded-lg text-gray-400 hover:text-white hover:border-gray-500 flex items-center justify-center gap-2",children:[t.jsx(Pt,{className:"h-4 w-4"}),"Add Channel Source"]})]})]})}function x_({group:a,onClose:e,onSave:s,isLoading:n}){const[i,l]=k.useState(a?.name||""),[o,d]=k.useState(a?.displayNumber?.toString()||""),[h,u]=k.useState(a?.logo||""),[f,g]=k.useState(a?.channelId||""),[p,b]=k.useState(a?.enabled??!0),y=v=>{v.preventDefault(),s({name:i,displayNumber:parseInt(o)||0,logo:h||void 0,channelId:f||void 0,enabled:p})};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:a?"Edit Channel Group":"Create Channel Group"}),t.jsxs("form",{onSubmit:y,children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Group Name"}),t.jsx("input",{type:"text",value:i,onChange:v=>l(v.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"ESPN",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Channel Number"}),t.jsx("input",{type:"number",value:o,onChange:v=>d(v.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"100",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Logo URL (optional)"}),t.jsx("input",{type:"url",value:h,onChange:v=>u(v.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"https://example.com/logo.png"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"EPG Channel ID (optional)"}),t.jsx("input",{type:"text",value:f,onChange:v=>g(v.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"ESPN.us"})]}),a&&t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{type:"button",onClick:()=>b(!p),className:`w-5 h-5 rounded border flex items-center justify-center ${p?"bg-indigo-600 border-indigo-600":"border-gray-500 hover:border-gray-400"}`,children:p&&t.jsx(Bs,{className:"h-3 w-3 text-white"})}),t.jsx("span",{className:"text-sm text-gray-300",children:"Enabled"})]})]}),t.jsxs("div",{className:"mt-6 flex gap-3",children:[t.jsx("button",{type:"button",onClick:e,className:"flex-1 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:n||!i||!o,className:"flex-1 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 text-white rounded-lg",children:n?"Saving...":a?"Save Changes":"Create Group"})]})]})]})})}function YD({results:a,onClose:e,onCreateGroup:s,isCreating:n}){const[i,l]=k.useState(new Set);return!a||a.length===0?t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md text-center",children:[t.jsx(Fi,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),t.jsx("h2",{className:"text-lg font-semibold text-white mb-2",children:"No Duplicates Found"}),t.jsx("p",{className:"text-gray-400 mb-4",children:"No duplicate channels were detected across your sources."}),t.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Close"})]})}):t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-2xl max-h-[80vh] flex flex-col",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-2",children:"Detected Duplicate Channels"}),t.jsxs("p",{className:"text-gray-400 text-sm mb-4",children:["Found ",a.length," channel",a.length!==1?"s":""," with duplicates across sources. Create groups to enable automatic failover."]}),t.jsx("div",{className:"flex-1 overflow-y-auto space-y-3",children:a.map((o,d)=>t.jsxs("div",{className:"bg-gray-750 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[mo(o.channels[0]?.logo)?t.jsx("img",{src:o.channels[0].logo,alt:o.name,className:"w-8 h-8 object-contain bg-gray-700 rounded"}):t.jsx("div",{className:"w-8 h-8 bg-gray-700 rounded flex items-center justify-center",children:t.jsx($s,{className:"h-4 w-4 text-gray-500"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-white font-medium",children:o.name}),t.jsxs("div",{className:"text-gray-500 text-xs",children:[o.channels.length," sources found"]})]})]}),i.has(o.name)?t.jsx("span",{className:"px-3 py-1 bg-green-600/20 text-green-400 text-sm rounded-lg",children:"Created"}):t.jsx("button",{onClick:()=>{s(o),l(h=>new Set([...h,o.name]))},disabled:n,className:"px-3 py-1 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 text-white text-sm rounded-lg",children:"Create Group"})]}),t.jsx("div",{className:"space-y-1 pl-11",children:o.channels.map((h,u)=>t.jsxs("div",{className:"text-sm text-gray-400 flex items-center gap-2",children:[t.jsxs("span",{className:"text-gray-600",children:[u+1,"."]}),t.jsx("span",{children:h.name}),t.jsx("span",{className:"text-gray-600",children:""}),t.jsx("span",{className:"text-gray-500",children:h.sourceName||"Unknown"})]},h.id))})]},d))}),t.jsx("div",{className:"mt-4 pt-4 border-t border-gray-700 flex justify-end",children:t.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Done"})})]})})}function WD(){const[a,e]=k.useState(null),s=`${window.location.origin}/api/livetv/export.m3u?enabled=true`,n=`${window.location.origin}/api/livetv/export.xml`,i=async(l,o)=>{try{await navigator.clipboard.writeText(l),e(o),setTimeout(()=>e(null),2e3)}catch{const d=document.createElement("textarea");d.value=l,document.body.appendChild(d),d.select(),document.execCommand("copy"),document.body.removeChild(d),e(o),setTimeout(()=>e(null),2e3)}};return t.jsxs("div",{className:"mt-8",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2 mb-4",children:[t.jsx(gs,{className:"h-5 w-5 text-green-400"}),"Export URLs"]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Use these URLs in other apps to access your channel lineup and program guide."}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"M3U Playlist URL"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-300 text-sm font-mono truncate",children:s}),t.jsxs("button",{onClick:()=>i(s,"m3u"),className:"flex items-center gap-1.5 px-3 py-2 bg-gray-700 hover:bg-gray-600 border border-gray-600 text-white text-sm rounded-lg whitespace-nowrap",children:[t.jsx(d0,{className:"h-4 w-4"}),a==="m3u"?"Copied!":"Copy"]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"EPG Guide URL"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-300 text-sm font-mono truncate",children:n}),t.jsxs("button",{onClick:()=>i(n,"epg"),className:"flex items-center gap-1.5 px-3 py-2 bg-gray-700 hover:bg-gray-600 border border-gray-600 text-white text-sm rounded-lg whitespace-nowrap",children:[t.jsx(d0,{className:"h-4 w-4"}),a==="epg"?"Copied!":"Copy"]})]})]})]})]})}function QD({source:a,onClose:e}){const s=at(),[n,i]=k.useState(""),[l,o]=k.useState([]),[d,h]=k.useState({}),[u,f]=k.useState(!0),[g,p]=k.useState(!1),[b,y]=k.useState("");Ys.useEffect(()=>{(async()=>{f(!0);try{const H=await(await fetch(`/livetv/channels?sourceId=${a.id}`,{headers:{"X-Plex-Token":pe.getToken()||""}})).json();o(H.channels||[])}catch(F){y(F.message||"Failed to load channels")}finally{f(!1)}})()},[a.id]);const v=(L,F)=>{const H=d[L.id];return H&&F in H?H[F]:L[F]},_=(L,F,H)=>{h(B=>({...B,[L]:{...B[L],[F]:H}}))},N=l.filter(L=>{if(!n)return!0;const F=n.toLowerCase();return L.name.toLowerCase().includes(F)||L.channelId.toLowerCase().includes(F)||String(L.number).includes(F)}),C=async()=>{const L=Object.keys(d).map(Number);if(L.length===0){e();return}p(!0),y("");try{for(const F of L){const H=d[F];await fetch(`/livetv/channels/${F}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Plex-Token":pe.getToken()||""},body:JSON.stringify(H)})}s.invalidateQueries({queryKey:["channels"]}),s.invalidateQueries({queryKey:["m3uSources"]}),e()}catch(F){y(F.message||"Failed to save changes")}finally{p(!1)}},T=Object.keys(d).length;return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[t.jsxs("div",{className:"p-6 border-b border-gray-700",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[t.jsx(yh,{className:"h-5 w-5 text-indigo-400"}),"Manage Lineup  ",a.name]}),t.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",children:t.jsx(nt,{className:"h-5 w-5"})})]}),t.jsxs("div",{className:"relative",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by name, ID, or number...",value:n,onChange:L=>i(L.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400"})]})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[b&&t.jsx("div",{className:"mb-4 p-3 bg-red-900/30 border border-red-700 rounded-lg text-red-400 text-sm",children:b}),u?t.jsx("div",{className:"text-gray-400 text-center py-8",children:"Loading channels..."}):N.length===0?t.jsx("div",{className:"text-gray-400 text-center py-8",children:n?"No channels match your search":"No channels found for this source"}):t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"sticky top-0 bg-gray-800 border-b border-gray-700",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium w-20",children:"Enabled"}),t.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium w-24",children:"Source #"}),t.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium",children:"Channel"}),t.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium w-28",children:"Output #"}),t.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium w-20",children:"Favorite"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-700",children:N.map(L=>{const F=v(L,"enabled"),H=v(L,"number"),B=!!d[L.id];return t.jsxs("tr",{className:`${F?"":"opacity-50"} ${B?"bg-gray-750":""}`,children:[t.jsx("td",{className:"p-3",children:t.jsx("button",{onClick:()=>_(L.id,"enabled",!F),className:`w-5 h-5 rounded border flex items-center justify-center ${F?"bg-indigo-600 border-indigo-600":"border-gray-500 hover:border-gray-400"}`,children:F&&t.jsx(Bs,{className:"h-3 w-3 text-white"})})}),t.jsx("td",{className:"p-3 text-gray-400 text-sm font-mono",children:L.channelId}),t.jsx("td",{className:"p-3",children:t.jsxs("div",{className:"flex items-center gap-3",children:[mo(L.logo)?t.jsx("img",{src:L.logo,alt:L.name,className:"w-8 h-8 object-contain bg-gray-700 rounded flex-shrink-0"}):t.jsx("div",{className:"w-8 h-8 bg-gray-700 rounded flex items-center justify-center flex-shrink-0",children:t.jsx($s,{className:"h-4 w-4 text-gray-500"})}),t.jsx("span",{className:"text-white text-sm",children:L.name})]})}),t.jsx("td",{className:"p-3",children:t.jsx("input",{type:"number",value:H,onChange:P=>_(L.id,"number",parseInt(P.target.value)||0),className:"w-20 px-2 py-1 bg-gray-700 border border-gray-600 rounded text-white text-sm text-center"})}),t.jsx("td",{className:"p-3",children:t.jsx("button",{onClick:()=>{const I=v(L,"group")==="Favorites";_(L.id,"group",I?L.group==="Favorites"?"":L.group:"Favorites")},className:"p-1",children:t.jsx(Di,{className:`h-5 w-5 ${v(L,"group")==="Favorites"?"text-yellow-400 fill-yellow-400":"text-gray-500 hover:text-yellow-400"}`})})})]},L.id)})})]})]}),t.jsxs("div",{className:"p-6 border-t border-gray-700 flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm text-gray-400",children:[l.length," channels",T>0&&`  ${T} modified`]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),t.jsx("button",{onClick:C,disabled:g||T===0,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 disabled:text-gray-400 text-white rounded-lg flex items-center gap-2",children:g?t.jsxs(t.Fragment,{children:[t.jsx(ut,{className:"h-4 w-4 animate-spin"}),"Saving..."]}):`Save All${T>0?` (${T})`:""}`})]})]})]})})}function XD(){const a=Jc(),e=at(),{data:s,isLoading:n}=Lw(),{data:i,isLoading:l}=v3(),o=y3(),d=b3(),h=N3(),u=w3(),[f,g]=k.useState(null),[p,b]=k.useState("sources"),[y,v]=k.useState(""),[_,N]=k.useState(null),[C,T]=k.useState(!1),[L,F]=k.useState(null),[H,B]=k.useState(null),[P,I]=k.useState(null),[D,O]=k.useState(null),[ee,ie]=k.useState(null),[Z,z]=k.useState(null),[X,ae]=k.useState(null),[te,W]=k.useState(!1),[K,q]=k.useState(!1),{data:J,isLoading:oe}=Fe({queryKey:["xtreamSources"],queryFn:()=>pe.getXtreamSources()}),be=Me({mutationFn:we=>pe.deleteXtreamSource(we),onSuccess:()=>{e.invalidateQueries({queryKey:["xtreamSources"]}),e.invalidateQueries({queryKey:["channels"]})}}),ye=Me({mutationFn:we=>pe.refreshXtreamSource(we),onMutate:we=>z(we),onSuccess:()=>{e.invalidateQueries({queryKey:["xtreamSources"]}),e.invalidateQueries({queryKey:["channels"]})},onSettled:()=>z(null)}),[Ee,re]=k.useState(null),[fe,Le]=k.useState(null),ze=Me({mutationFn:we=>pe.importXtreamVOD(we),onMutate:we=>re(we),onSuccess:we=>{e.invalidateQueries({queryKey:["xtreamSources"]}),alert(`VOD Import: ${we.added} added, ${we.updated} updated`)},onSettled:()=>re(null)}),Xe=Me({mutationFn:we=>pe.importXtreamSeries(we),onMutate:we=>Le(we),onSuccess:()=>{e.invalidateQueries({queryKey:["xtreamSources"]}),e.invalidateQueries({queryKey:["libraryStats"]}),alert("Series import started in background. Check library stats for progress.")},onSettled:()=>Le(null)}),{data:ue}=Fe({queryKey:["libraryStats"],queryFn:async()=>{const we={},gt=new Set;J?.forEach(zt=>{zt.vodLibraryId&&gt.add(zt.vodLibraryId),zt.seriesLibraryId&&gt.add(zt.seriesLibraryId)});for(const zt of gt)try{const ja=await pe.getLibraryStats(zt);we[zt]={movieCount:ja.movieCount,showCount:ja.showCount,episodeCount:ja.episodeCount}}catch{}return we},enabled:!!J?.length,refetchInterval:1e4}),Ge=Me({mutationFn:async we=>{const gt=await fetch(`/livetv/epg/sources/${we}/refresh`,{method:"POST",headers:{"X-Plex-Token":pe.getToken()||""}});if(!gt.ok)throw new Error("Failed to refresh EPG source");return gt.json()},onMutate:we=>{ie(we)},onSuccess:()=>{e.invalidateQueries({queryKey:["epgSources"]})},onSettled:()=>{ie(null)}}),{data:Ve,isLoading:bt}=Fe({queryKey:["channels"],queryFn:async()=>(await(await fetch("/livetv/channels",{headers:{"X-Plex-Token":pe.getToken()||""}})).json()).channels,enabled:p==="channels"}),We=Me({mutationFn:async({id:we,enabled:gt})=>{const zt=await fetch(`/livetv/channels/${we}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Plex-Token":pe.getToken()||""},body:JSON.stringify({enabled:gt})});if(!zt.ok)throw new Error("Failed to update channel");return zt.json()},onSuccess:()=>{e.invalidateQueries({queryKey:["channels"]})}}),ot=Me({mutationFn:async({id:we,enabled:gt})=>{const zt=gt?`/livetv/channels/${we}/archive/enable`:`/livetv/channels/${we}/archive/disable`,ja=await fetch(zt,{method:"POST",headers:{"Content-Type":"application/json","X-Plex-Token":pe.getToken()||""},body:gt?JSON.stringify({days:7}):void 0});if(!ja.ok)throw new Error("Failed to update channel archive");return ja.json()},onSuccess:()=>{e.invalidateQueries({queryKey:["channels"]})}}),{data:Ie,isLoading:Lt}=Fe({queryKey:["channelGroups"],queryFn:()=>pe.getChannelGroups(),enabled:p==="groups"}),Ht=Me({mutationFn:we=>pe.createChannelGroup(we),onSuccess:()=>{e.invalidateQueries({queryKey:["channelGroups"]}),W(!1)}}),As=Me({mutationFn:({id:we,data:gt})=>pe.updateChannelGroup(we,gt),onSuccess:()=>{e.invalidateQueries({queryKey:["channelGroups"]}),ae(null)}}),Cs=Me({mutationFn:we=>pe.deleteChannelGroup(we),onSuccess:()=>{e.invalidateQueries({queryKey:["channelGroups"]})}}),Tn=Me({mutationFn:({groupId:we,channelId:gt,priority:zt})=>pe.addChannelToGroup(we,gt,zt),onSuccess:()=>{e.invalidateQueries({queryKey:["channelGroups"]})}}),ts=Me({mutationFn:({groupId:we,channelId:gt,priority:zt})=>pe.updateGroupMemberPriority(we,gt,zt),onSuccess:()=>{e.invalidateQueries({queryKey:["channelGroups"]})}}),Bn=Me({mutationFn:({groupId:we,channelId:gt})=>pe.removeChannelFromGroup(we,gt),onSuccess:()=>{e.invalidateQueries({queryKey:["channelGroups"]})}}),[ua,rn]=k.useState(null),[ya,An]=k.useState(!1),ln=async()=>{An(!0);try{const we=await pe.autoDetectDuplicates();rn(we.duplicates),q(!0)}catch(we){console.error("Failed to auto-detect duplicates:",we)}finally{An(!1)}},Sa=Ve?.filter(we=>we.name.toLowerCase().includes(y.toLowerCase())||we.channelId.toLowerCase().includes(y.toLowerCase())||we.group&&we.group.toLowerCase().includes(y.toLowerCase())),Un=Ve?.filter(we=>we.enabled).length||0,on=Ve?.length||0,Ps=Ve?.filter(we=>we.archiveEnabled).length||0;return t.jsxs("div",{children:[t.jsxs("div",{className:"mb-8 flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Live TV"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Manage your IPTV sources, channels, and program guide"})]}),t.jsxs("button",{onClick:()=>a("/ui/livetv/epg-editor"),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg",children:[t.jsx(si,{className:"h-4 w-4"}),"EPG Editor"]})]}),t.jsxs("div",{className:"flex gap-4 mb-6 border-b border-gray-700",children:[t.jsx("button",{onClick:()=>b("sources"),className:`pb-3 px-1 text-sm font-medium border-b-2 transition-colors ${p==="sources"?"border-indigo-500 text-white":"border-transparent text-gray-400 hover:text-white"}`,children:"Sources"}),t.jsxs("button",{onClick:()=>b("channels"),className:`pb-3 px-1 text-sm font-medium border-b-2 transition-colors ${p==="channels"?"border-indigo-500 text-white":"border-transparent text-gray-400 hover:text-white"}`,children:["Channels ",on>0&&`(${Un}/${on})`,Ps>0&&t.jsxs("span",{className:"ml-2 px-1.5 py-0.5 bg-purple-600 text-white text-xs rounded",children:[Ps," recording"]})]}),t.jsx("button",{onClick:()=>b("programs"),className:`pb-3 px-1 text-sm font-medium border-b-2 transition-colors ${p==="programs"?"border-indigo-500 text-white":"border-transparent text-gray-400 hover:text-white"}`,children:"EPG Programs"}),t.jsx("button",{onClick:()=>b("groups"),className:`pb-3 px-1 text-sm font-medium border-b-2 transition-colors ${p==="groups"?"border-indigo-500 text-white":"border-transparent text-gray-400 hover:text-white"}`,children:"Channel Groups"})]}),p==="sources"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[t.jsx(jt,{className:"h-5 w-5"}),"M3U Playlists"]}),t.jsxs("button",{onClick:()=>g("m3u"),className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-sm rounded-lg",children:[t.jsx(Pt,{className:"h-4 w-4"}),"Add Playlist"]})]}),n?t.jsx("div",{className:"text-gray-400",children:"Loading..."}):s?.length?t.jsx("div",{className:"bg-gray-800 rounded-xl divide-y divide-gray-700",children:s.map(we=>t.jsxs("div",{className:"p-4 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-white",children:we.name}),t.jsxs("p",{className:"text-sm text-gray-400",children:[we.channelCount," channels",we.lastRefresh&&t.jsxs(t.Fragment,{children:["  Last updated: ",new Date(we.lastRefresh).toLocaleDateString()]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>B({id:we.id,name:we.name}),className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:"Manage Lineup",children:t.jsx(yh,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>F(we),className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:"Edit",children:t.jsx(an,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>d.mutate(we.id),disabled:d.isPending,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:"Refresh",children:t.jsx(ut,{className:`h-4 w-4 ${d.isPending?"animate-spin":""}`})}),t.jsx("button",{onClick:()=>o.mutate(we.id),className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg",title:"Delete",children:t.jsx(Dt,{className:"h-4 w-4"})})]})]},we.id))}):t.jsxs("div",{className:"text-center py-8 bg-gray-800 rounded-xl",children:[t.jsx(jt,{className:"h-10 w-10 text-gray-600 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-400",children:"No M3U playlists configured"})]})]}),t.jsxs("div",{className:"mb-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[t.jsx(xa,{className:"h-5 w-5 text-yellow-400"}),"Xtream Codes API"]}),t.jsxs("button",{onClick:()=>g("xtream"),className:"flex items-center gap-2 px-3 py-1.5 bg-yellow-600 hover:bg-yellow-700 text-white text-sm rounded-lg",children:[t.jsx(Pt,{className:"h-4 w-4"}),"Add Xtream"]})]}),oe?t.jsx("div",{className:"text-gray-400",children:"Loading..."}):J?.length?t.jsx("div",{className:"bg-gray-800 rounded-xl divide-y divide-gray-700",children:J.map(we=>t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h3",{className:"font-medium text-white",children:we.name}),!we.enabled&&t.jsx("span",{className:"px-2 py-0.5 bg-gray-700 text-gray-400 text-xs rounded",children:"Disabled"})]}),t.jsxs("p",{className:"text-sm text-gray-400",children:[we.channelCount," channels  ",we.username,"@",we.serverUrl.replace(/^https?:\/\//,"")]}),we.expirationDate&&t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Expires: ",new Date(we.expirationDate).toLocaleDateString()]}),we.lastError&&t.jsxs("p",{className:"text-xs text-red-400 mt-1 flex items-center gap-1",children:[t.jsx(kt,{className:"h-3 w-3"}),we.lastError]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>B({id:we.id,name:we.name}),className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:"Manage Lineup",children:t.jsx(yh,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>I(we),className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:"Edit",children:t.jsx(an,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>ye.mutate(we.id),disabled:Z===we.id,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg",title:"Refresh Channels",children:t.jsx(ut,{className:`h-4 w-4 ${Z===we.id?"animate-spin":""}`})}),t.jsx("button",{onClick:()=>be.mutate(we.id),className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg",title:"Delete",children:t.jsx(Dt,{className:"h-4 w-4"})})]})]}),(we.importVod||we.importSeries)&&t.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-700 flex flex-wrap gap-3",children:[we.importVod&&we.vodLibraryId&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-400",children:[t.jsx(Gt,{className:"h-4 w-4"}),t.jsxs("span",{children:["VOD: ",ue?.[we.vodLibraryId]?.movieCount??we.vodCount??0," movies"]})]}),t.jsxs("button",{onClick:()=>ze.mutate(we.id),disabled:Ee===we.id,className:"px-2 py-1 text-xs bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white rounded flex items-center gap-1",title:"Import VOD Movies",children:[Ee===we.id?t.jsx(ut,{className:"h-3 w-3 animate-spin"}):t.jsx(gs,{className:"h-3 w-3"}),"Import"]})]}),we.importSeries&&we.seriesLibraryId&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-400",children:[t.jsx(wr,{className:"h-4 w-4"}),t.jsxs("span",{children:["Series: ",ue?.[we.seriesLibraryId]?.showCount??we.seriesCount??0," shows (",ue?.[we.seriesLibraryId]?.episodeCount??0," episodes)"]})]}),t.jsxs("button",{onClick:()=>Xe.mutate(we.id),disabled:fe===we.id,className:"px-2 py-1 text-xs bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 text-white rounded flex items-center gap-1",title:"Import TV Series",children:[fe===we.id?t.jsx(ut,{className:"h-3 w-3 animate-spin"}):t.jsx(gs,{className:"h-3 w-3"}),"Import"]})]})]})]},we.id))}):t.jsxs("div",{className:"text-center py-8 bg-gray-800 rounded-xl",children:[t.jsx(xa,{className:"h-10 w-10 text-gray-600 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-400",children:"No Xtream Codes sources configured"}),t.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Add your Xtream provider to import channels via API"})]})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[t.jsx(wa,{className:"h-5 w-5"}),"EPG Sources"]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>u.mutate(),disabled:u.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded-lg",children:[t.jsx(ut,{className:`h-4 w-4 ${u.isPending?"animate-spin":""}`}),"Refresh All"]}),t.jsxs("button",{onClick:()=>g("epg"),className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-sm rounded-lg",children:[t.jsx(Pt,{className:"h-4 w-4"}),"Add EPG"]})]})]}),l?t.jsx("div",{className:"text-gray-400",children:"Loading..."}):i?.length?t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:i.map(we=>t.jsx(BD,{source:we,onRefresh:gt=>Ge.mutate(gt),onDelete:gt=>h.mutate(gt),onEdit:gt=>O(gt),isRefreshing:ee===we.id},we.id))}):t.jsxs("div",{className:"text-center py-8 bg-gray-800 rounded-xl",children:[t.jsx(wa,{className:"h-10 w-10 text-gray-600 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-400",children:"No EPG sources configured"})]})]}),t.jsx(WD,{})]}),p==="programs"&&t.jsx(HD,{epgSources:i||[]}),p==="channels"&&t.jsxs("div",{children:[t.jsxs("div",{className:"mb-4 flex gap-3",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search channels...",value:y,onChange:we=>v(we.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400"})]}),t.jsxs("button",{onClick:()=>T(!0),className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg flex items-center gap-2 whitespace-nowrap",children:[t.jsx(wa,{className:"h-4 w-4"}),"Import Numbers"]})]}),bt?t.jsx("div",{className:"text-gray-400",children:"Loading channels..."}):Sa?.length?t.jsx("div",{className:"bg-gray-800 rounded-xl overflow-hidden",children:t.jsx("div",{className:"max-h-[600px] overflow-y-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"sticky top-0 bg-gray-800 border-b border-gray-700",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium",children:"Enabled"}),t.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium",children:"#"}),t.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium",children:"Channel"}),t.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium",children:"Group"}),t.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium",children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(aC,{className:"h-3 w-3"}),"Catch-up"]})}),t.jsx("th",{className:"text-left p-3 text-gray-400 text-sm font-medium",children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-700",children:Sa.map(we=>t.jsxs("tr",{className:we.enabled?"":"opacity-50",children:[t.jsx("td",{className:"p-3",children:t.jsx("button",{onClick:()=>We.mutate({id:we.id,enabled:!we.enabled}),className:`w-5 h-5 rounded border flex items-center justify-center ${we.enabled?"bg-indigo-600 border-indigo-600":"border-gray-500 hover:border-gray-400"}`,children:we.enabled&&t.jsx(Bs,{className:"h-3 w-3 text-white"})})}),t.jsx("td",{className:"p-3 text-gray-400 text-sm",children:we.number}),t.jsx("td",{className:"p-3",children:t.jsxs("div",{className:"flex items-center gap-3",children:[mo(we.logo)?t.jsx("img",{src:we.logo,alt:we.name,className:"w-8 h-8 object-contain bg-gray-700 rounded"}):t.jsx("div",{className:"w-8 h-8 bg-gray-700 rounded flex items-center justify-center",children:t.jsx($s,{className:"h-4 w-4 text-gray-500"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-white text-sm",children:we.name}),t.jsx("div",{className:"text-gray-500 text-xs",children:we.channelId})]})]})}),t.jsx("td",{className:"p-3 text-gray-400 text-sm",children:we.group||"-"}),t.jsx("td",{className:"p-3",children:t.jsxs("button",{onClick:()=>ot.mutate({id:we.id,enabled:!we.archiveEnabled}),disabled:!we.enabled,className:`px-2 py-1 rounded text-xs font-medium flex items-center gap-1 ${we.archiveEnabled?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-700 text-gray-400 hover:bg-gray-600 hover:text-white"} ${we.enabled?"":"opacity-50 cursor-not-allowed"}`,title:we.archiveEnabled?"Disable catch-up recording":"Enable catch-up recording (7 days)",children:[t.jsx(Kt,{className:"h-3 w-3"}),we.archiveEnabled?`${we.archiveDays||7}d`:"Off"]})}),t.jsx("td",{className:"p-3",children:t.jsx("button",{onClick:()=>N(we),className:"p-1.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded",title:"Edit",children:t.jsx(an,{className:"h-4 w-4"})})})]},we.id))})]})})}):t.jsxs("div",{className:"text-center py-8 bg-gray-800 rounded-xl",children:[t.jsx($s,{className:"h-10 w-10 text-gray-600 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-400",children:y?"No channels match your search":"No channels loaded"})]})]}),p==="groups"&&t.jsxs("div",{children:[t.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm text-gray-400",children:[Ie?.length||0," channel group",Ie?.length!==1?"s":""]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:ln,disabled:ya,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 text-white rounded-lg flex items-center gap-2",children:[ya?t.jsx(ut,{className:"h-4 w-4 animate-spin"}):t.jsx(Sr,{className:"h-4 w-4"}),"Auto-Detect Duplicates"]}),t.jsxs("button",{onClick:()=>W(!0),className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg flex items-center gap-2",children:[t.jsx(Pt,{className:"h-4 w-4"}),"Create Group"]})]})]}),Lt?t.jsx("div",{className:"text-gray-400",children:"Loading channel groups..."}):Ie?.length?t.jsx("div",{className:"space-y-4",children:Ie.map(we=>t.jsx(zD,{group:we,channels:Ve||[],onEdit:()=>ae(we),onDelete:()=>{confirm(`Delete group "${we.name}"?`)&&Cs.mutate(we.id)},onAddMember:(gt,zt)=>Tn.mutate({groupId:we.id,channelId:gt,priority:zt}),onUpdatePriority:(gt,zt)=>ts.mutate({groupId:we.id,channelId:gt,priority:zt}),onRemoveMember:gt=>Bn.mutate({groupId:we.id,channelId:gt})},we.id))}):t.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[t.jsx(Fi,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No Channel Groups"}),t.jsx("p",{className:"text-gray-400 mb-4",children:"Create groups to combine duplicate channels from different sources with automatic failover."}),t.jsxs("button",{onClick:ln,disabled:ya,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 text-white rounded-lg inline-flex items-center gap-2",children:[ya?t.jsx(ut,{className:"h-4 w-4 animate-spin"}):t.jsx(Sr,{className:"h-4 w-4"}),"Auto-Detect Duplicates"]})]})]}),f==="m3u"&&t.jsx(p_,{type:"m3u",onClose:()=>g(null)}),f==="epg"&&t.jsx(p_,{type:"epg",onClose:()=>g(null)}),f==="xtream"&&t.jsx(KD,{onClose:()=>g(null)}),_&&t.jsx(UD,{channel:_,onClose:()=>N(null),epgSources:i||[]}),C&&t.jsx($D,{onClose:()=>T(!1)}),L&&t.jsx(GD,{source:L,onClose:()=>F(null)}),H&&t.jsx(QD,{source:H,onClose:()=>B(null)}),P&&t.jsx(VD,{source:P,onClose:()=>I(null)}),D&&t.jsx(qD,{source:D,onClose:()=>O(null)}),te&&t.jsx(x_,{onClose:()=>W(!1),onSave:we=>Ht.mutate(we),isLoading:Ht.isPending}),X&&t.jsx(x_,{group:X,onClose:()=>ae(null),onSave:we=>As.mutate({id:X.id,data:we}),isLoading:As.isPending}),K&&ua&&t.jsx(YD,{results:ua,onClose:()=>{q(!1),rn(null)},onCreateGroup:async we=>{const gt=await pe.createChannelGroup({name:we.name,displayNumber:we.channels[0]?.number||0,logo:we.channels[0]?.logo});for(let zt=0;zt<we.channels.length;zt++)await pe.addChannelToGroup(gt.id,we.channels[zt].id,zt);e.invalidateQueries({queryKey:["channelGroups"]})},isCreating:!1})]})}const ju=a=>a?/^https?:\/\//i.test(a):!1;function JD(){const a=at(),[e,s]=k.useState(""),[n,i]=k.useState(null),[l,o]=k.useState(null),[d,h]=k.useState(new Set),[u,f]=k.useState(null),[g,p]=k.useState(""),[b,y]=k.useState(""),v=k.useRef(null),{data:_}=Fe({queryKey:["channels"],queryFn:async()=>(await(await fetch("/livetv/channels",{headers:{"X-Plex-Token":pe.getToken()||""}})).json()).channels}),{data:N}=Fe({queryKey:["epgSources"],queryFn:async()=>await pe.getEPGSources()}),{data:C,isLoading:T}=Fe({queryKey:["allEPGPrograms",n],queryFn:()=>pe.getEPGPrograms({epgSourceId:n||void 0,limit:1e4}),enabled:!!n}),L=Me({mutationFn:async ue=>{const Ge=await fetch(`/livetv/channels/${ue.channelId}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Plex-Token":pe.getToken()||""},body:JSON.stringify({epgSourceId:ue.epgSourceId,channelId:ue.epgChannelId})});if(!Ge.ok)throw new Error("Failed to update channel");return Ge.json()},onSuccess:()=>{a.invalidateQueries({queryKey:["channels"]}),o(null)}}),F=Me({mutationFn:async ue=>{const Ge=await fetch("/livetv/channels/bulk-map",{method:"POST",headers:{"Content-Type":"application/json","X-Plex-Token":pe.getToken()||""},body:JSON.stringify({channelIds:ue.channelIds,epgSourceId:ue.epgSourceId,epgChannelId:ue.epgChannelId})});if(!Ge.ok)throw new Error("Failed to bulk map channels");return Ge.json()},onSuccess:()=>{a.invalidateQueries({queryKey:["channels"]}),h(new Set),f(null)}}),H=Me({mutationFn:async ue=>{const Ge=await fetch(`/livetv/channels/${ue}/epg-mapping`,{method:"DELETE",headers:{"X-Plex-Token":pe.getToken()||""}});if(!Ge.ok)throw new Error("Failed to unmap channel");return Ge.json()},onSuccess:()=>{a.invalidateQueries({queryKey:["channels"]})}}),B=new Map;C?.programs.forEach(ue=>{B.has(ue.channelId)||B.set(ue.channelId,[]),B.get(ue.channelId).push(ue)});const P=new Date,I=Array.from(B.entries()).map(([ue,Ge])=>{const Ve=Ge.find(ot=>new Date(ot.start)<=P&&new Date(ot.end)>P),bt=Ge.find(ot=>new Date(ot.start)>P),We=Ge.sort((ot,Ie)=>new Date(Ie.start).getTime()-new Date(ot.start).getTime())[0];return{channelId:ue,currentProgram:Ve||bt||We,programCount:Ge.length}}).filter(ue=>ue.currentProgram),D=I.filter(ue=>ue.channelId.toLowerCase().includes(e.toLowerCase())||ue.currentProgram.callSign?.toLowerCase().includes(e.toLowerCase())||ue.currentProgram.channelNo?.toLowerCase().includes(e.toLowerCase())||ue.currentProgram.affiliateName?.toLowerCase().includes(e.toLowerCase())||ue.currentProgram.title.toLowerCase().includes(e.toLowerCase())||ue.currentProgram.description?.toLowerCase().includes(e.toLowerCase())),O=(ue,Ge)=>{n&&L.mutate({channelId:Ge,epgSourceId:n,epgChannelId:ue})},ee=ue=>_?.filter(Ge=>Ge.channelId===ue&&Ge.epgSourceId===n)||[],ie=ue=>{const Ge=new Set(d);Ge.has(ue)?Ge.delete(ue):Ge.add(ue),h(Ge)},Z=ue=>{!n||d.size===0||F.mutate({channelIds:Array.from(d),epgSourceId:n,epgChannelId:ue})},z={"NEW YORK":{CBS:"WCBS",NBC:"WNBC",ABC:"WABC",FOX:"WNYW",CW:"WPIX",PBS:"WNET"},"LOS ANGELES":{CBS:"KCBS",NBC:"KNBC",ABC:"KABC",FOX:"KTTV",CW:"KTLA",PBS:"KCET"},CHICAGO:{CBS:"WBBM",NBC:"WMAQ",ABC:"WLS",FOX:"WFLD",CW:"WGN",PBS:"WTTW"},PHILADELPHIA:{CBS:"KYW",NBC:"WCAU",ABC:"WPVI",FOX:"WTXF",CW:"WPHL",PBS:"WHYY"},DALLAS:{CBS:"KTVT",NBC:"KXAS",ABC:"WFAA",FOX:"KDFW",CW:"KDAF",PBS:"KERA"},"SAN FRANCISCO":{CBS:"KPIX",NBC:"KNTV",ABC:"KGO",FOX:"KTVU",CW:"KBCW",PBS:"KQED"},BOSTON:{CBS:"WBZ",NBC:"WBTS",ABC:"WCVB",FOX:"WFXT",CW:"WLVI",PBS:"WGBH"},ATLANTA:{CBS:"WGCL",NBC:"WXIA",ABC:"WSB",FOX:"WAGA",CW:"WPCH",PBS:"WGTV"},SEATTLE:{CBS:"KIRO",NBC:"KING",ABC:"KOMO",FOX:"KCPQ",CW:"KSTW",PBS:"KCTS"},HOUSTON:{CBS:"KHOU",NBC:"KPRC",ABC:"KTRK",FOX:"KRIV",CW:"KIAH",PBS:"KUHT"},DENVER:{CBS:"KCNC",NBC:"KUSA",ABC:"KMGH",FOX:"KDVR",CW:"KWGN",PBS:"KRMA"},PHOENIX:{CBS:"KPHO",NBC:"KPNX",ABC:"KNXV",FOX:"KSAZ",CW:"KASW",PBS:"KAET"},MINNEAPOLIS:{CBS:"WCCO",NBC:"KARE",ABC:"KSTP",FOX:"KMSP",CW:"WUCW",PBS:"TPT"},MIAMI:{CBS:"WFOR",NBC:"WTVJ",ABC:"WPLG",FOX:"WSVN",CW:"WSFL",PBS:"WPBT"},"WASHINGTON DC":{CBS:"WUSA",NBC:"WRC",ABC:"WJLA",FOX:"WTTG",CW:"WDCW",PBS:"WETA"},DETROIT:{CBS:"WWJ",NBC:"WDIV",ABC:"WXYZ",FOX:"WJBK",CW:"WKBD",PBS:"WTVS"}},X=ue=>{const Ge=ue.toUpperCase(),Ve={"NEW YORK":["NEW YORK","NY ","NYC","A3 NEW YORK","WCBS","WNBC","WABC","WNYW","WPIX"],"LOS ANGELES":["LOS ANGELES","LA ","L.A.","KCBS","KNBC","KABC","KTTV","KTLA"],CHICAGO:["CHICAGO","CHI","WBBM","WMAQ","WLS","WFLD","WGN"],PHILADELPHIA:["PHILADELPHIA","PHILLY","KYW","WCAU","WPVI"],DALLAS:["DALLAS","DFW","KTVT","KXAS","WFAA","KDFW"],"SAN FRANCISCO":["SAN FRANCISCO","SF ","BAY AREA","KPIX","KNTV","KGO","KTVU"],BOSTON:["BOSTON","WBZ","WBTS","WCVB","WFXT"],ATLANTA:["ATLANTA","ATL","WGCL","WXIA","WSB","WAGA"],SEATTLE:["SEATTLE","SEA","KIRO","KING","KOMO","KCPQ"],HOUSTON:["HOUSTON","KHOU","KPRC","KTRK","KRIV"],DENVER:["DENVER","KCNC","KUSA","KMGH","KDVR"],PHOENIX:["PHOENIX","PHX","KPHO","KPNX","KNXV","KSAZ"],MINNEAPOLIS:["MINNEAPOLIS","TWIN CITIES","WCCO","KARE","KSTP","KMSP"],MIAMI:["MIAMI","WFOR","WTVJ","WPLG","WSVN"],"WASHINGTON DC":["WASHINGTON","DC","WUSA","WRC","WJLA","WTTG"],DETROIT:["DETROIT","WWJ","WDIV","WXYZ","WJBK"]};for(const[bt,We]of Object.entries(Ve))if(We.some(ot=>Ge.includes(ot)))return bt;return null},ae=()=>{const ue=N?.find(bt=>bt.id===n);if(!ue?.gracenotePostalCode)return null;const Ge=ue.gracenotePostalCode.substring(0,3);return{100:"NEW YORK",101:"NEW YORK",102:"NEW YORK",103:"NEW YORK",104:"NEW YORK",105:"NEW YORK",106:"NEW YORK",107:"NEW YORK",108:"NEW YORK",109:"NEW YORK",110:"NEW YORK",111:"NEW YORK",112:"NEW YORK",113:"NEW YORK",114:"NEW YORK",900:"LOS ANGELES",901:"LOS ANGELES",902:"LOS ANGELES",903:"LOS ANGELES",904:"LOS ANGELES",905:"LOS ANGELES",906:"LOS ANGELES",907:"LOS ANGELES",908:"LOS ANGELES",910:"LOS ANGELES",911:"LOS ANGELES",912:"LOS ANGELES",913:"LOS ANGELES",914:"LOS ANGELES",915:"LOS ANGELES",916:"LOS ANGELES",917:"LOS ANGELES",918:"LOS ANGELES",600:"CHICAGO",601:"CHICAGO",602:"CHICAGO",603:"CHICAGO",604:"CHICAGO",605:"CHICAGO",606:"CHICAGO",607:"CHICAGO",608:"CHICAGO",190:"PHILADELPHIA",191:"PHILADELPHIA",192:"PHILADELPHIA",193:"PHILADELPHIA",194:"PHILADELPHIA",750:"DALLAS",751:"DALLAS",752:"DALLAS",753:"DALLAS",754:"DALLAS",755:"DALLAS",940:"SAN FRANCISCO",941:"SAN FRANCISCO",942:"SAN FRANCISCO",943:"SAN FRANCISCO",944:"SAN FRANCISCO",945:"SAN FRANCISCO",946:"SAN FRANCISCO",947:"SAN FRANCISCO","021":"BOSTON","022":"BOSTON","023":"BOSTON","024":"BOSTON",300:"ATLANTA",301:"ATLANTA",302:"ATLANTA",303:"ATLANTA",304:"ATLANTA",305:"ATLANTA",306:"ATLANTA",307:"ATLANTA",308:"ATLANTA",309:"ATLANTA",310:"ATLANTA",311:"ATLANTA",312:"ATLANTA",313:"ATLANTA",314:"ATLANTA",315:"ATLANTA",316:"ATLANTA",317:"ATLANTA",318:"ATLANTA",319:"ATLANTA",980:"SEATTLE",981:"SEATTLE",982:"SEATTLE",983:"SEATTLE",984:"SEATTLE",770:"HOUSTON",771:"HOUSTON",772:"HOUSTON",773:"HOUSTON",774:"HOUSTON",775:"HOUSTON",776:"HOUSTON",777:"HOUSTON",778:"HOUSTON",779:"HOUSTON",800:"DENVER",801:"DENVER",802:"DENVER",803:"DENVER",804:"DENVER",805:"DENVER",850:"PHOENIX",851:"PHOENIX",852:"PHOENIX",853:"PHOENIX",550:"MINNEAPOLIS",551:"MINNEAPOLIS",553:"MINNEAPOLIS",554:"MINNEAPOLIS",555:"MINNEAPOLIS",330:"MIAMI",331:"MIAMI",332:"MIAMI",333:"MIAMI",334:"MIAMI",200:"WASHINGTON DC",201:"WASHINGTON DC",202:"WASHINGTON DC",203:"WASHINGTON DC",204:"WASHINGTON DC",205:"WASHINGTON DC",206:"WASHINGTON DC",207:"WASHINGTON DC",208:"WASHINGTON DC",209:"WASHINGTON DC",210:"WASHINGTON DC",211:"WASHINGTON DC",212:"WASHINGTON DC",220:"WASHINGTON DC",221:"WASHINGTON DC",222:"WASHINGTON DC",223:"WASHINGTON DC",480:"DETROIT",481:"DETROIT",482:"DETROIT",483:"DETROIT",484:"DETROIT"}[Ge]||null},te=ue=>{const Ge=ue.toUpperCase();return Ge.includes("CBS")?"CBS":Ge.includes("NBC")?"NBC":Ge.includes("ABC")?"ABC":Ge.includes("FOX")?"FOX":Ge.includes("PBS")?"PBS":Ge.includes("CW")?"CW":null},K=(()=>{const ue=ae();if(!ue||d.size===0)return null;const Ge=[];return d.forEach(Ve=>{const bt=_?.find(ot=>ot.id===Ve);if(!bt)return;const We=X(bt.name);if(We&&We!==ue){const ot=te(bt.name),Ie=ot&&z[ue]?.[ot];Ge.push({channel:bt,m3uMarket:We,network:ot,localEquivalent:Ie})}}),Ge.length>0?{epgMarket:ue,mismatches:Ge}:null})(),q=ue=>{const Ge={CBS:["CBS","WCBS","KCBS","KIRO","WBBM","KDKA","KYW","WJZ","WCCO","WWJ","KCNC","KTVT","KHOU","KPIX","KCAL","CBS TELEVISION"],NBC:["NBC","WNBC","KNBC","KING","WMAQ","WCAU","WRC","WTVJ","KXAS","NATIONAL BROADCASTING"],ABC:["ABC","WABC","KABC","KOMO","WLS","WPVI","KGO","WTVD","AMERICAN BROADCASTING"],FOX:["FOX","WNYW","KTTV","KCPQ","WFLD","WTXF","WTTG","KRIV","FOX ENTERTAINMENT"],PBS:["PBS","WNET","WGBH","KCTS","KCET","WETA","PUBLIC BROADCASTING"],CW:["CW","WPIX","KTLA","KSTW"],ESPN:["ESPN","ESPN2","ESPNU","ESPNEWS"],CNN:["CNN","HLN"],MSNBC:["MSNBC"],HBO:["HBO"],SHOWTIME:["SHOWTIME","SHO"],DISCOVERY:["DISCOVERY","TLC","HGTV","FOOD NETWORK"],NICKELODEON:["NICKELODEON","NICK","NICKJR","NICKTOONS"],DISNEY:["DISNEY","DISN","DXD"],CARTOON:["CARTOON","TOON","BOOMERANG"],AMC:["AMC"],TNT:["TNT","TBS","TRUTV"],USA:["USA NETWORK","USA"],FX:["FX","FXX","FXM"],BRAVO:["BRAVO"],SYFY:["SYFY","SCI-FI"],HALLMARK:["HALLMARK"],LIFETIME:["LIFETIME","LMN"],HISTORY:["HISTORY","H2"],NATGEO:["NAT GEO","NATIONAL GEOGRAPHIC","NGWILD"],COMEDY:["COMEDY CENTRAL","COMEDY"],MTV:["MTV","VH1","CMT"],BET:["BET"],OXYGEN:["OXYGEN"],ANIMAL:["ANIMAL PLANET"]},Ve=ue.toUpperCase(),bt=[];for(const[We,ot]of Object.entries(Ge))for(const Ie of ot)if(Ve.includes(Ie)){bt.push(We),bt.push(Ie);const Lt=ae();Lt&&z[Lt]?.[We]&&bt.push(z[Lt][We]);break}return bt},J=()=>{if(d.size===0)return[];const ue=[];return d.forEach(Ge=>{const Ve=_?.find(bt=>bt.id===Ge);Ve&&ue.push(...q(Ve.name))}),[...new Set(ue)]},oe=(ue,Ge)=>{if(Ge.length===0)return!1;const Ve=ue.currentProgram.callSign?.toUpperCase()||"",bt=ue.currentProgram.affiliateName?.toUpperCase()||"",We=ue.channelId.toUpperCase();return Ge.some(ot=>Ve.includes(ot)||bt.includes(ot)||We.includes(ot))},be=J(),ye=be.length>0?D.filter(ue=>oe(ue,be)):[],Ee=be.length>0?D.filter(ue=>!oe(ue,be)):D,re=k.useMemo(()=>{if(!_)return[];if(!g.trim())return _;const ue=g.toLowerCase();return _.filter(Ge=>Ge.name.toLowerCase().includes(ue)||Ge.number.toString().includes(ue)||Ge.group?.toLowerCase().includes(ue))},[_,g]),fe=k.useMemo(()=>{const ue={};return re.forEach(Ge=>{const Ve=Ge.group||"Uncategorized";ue[Ve]||(ue[Ve]=[]),ue[Ve].push(Ge)}),Object.entries(ue).sort((Ge,Ve)=>Ge[0].localeCompare(Ve[0]))},[re]),Le=k.useMemo(()=>{if(!_)return[];if(!b.trim())return _;const ue=b.toLowerCase();return _.filter(Ge=>Ge.name.toLowerCase().includes(ue)||Ge.number.toString().includes(ue)||Ge.group?.toLowerCase().includes(ue))},[_,b]),ze=k.useMemo(()=>{const ue={};return Le.forEach(Ge=>{const Ve=Ge.group||"Uncategorized";ue[Ve]||(ue[Ve]=[]),ue[Ve].push(Ge)}),Object.entries(ue).sort((Ge,Ve)=>Ge[0].localeCompare(Ve[0]))},[Le]);k.useEffect(()=>{l&&v.current&&v.current.focus()},[l]);const Xe=()=>{o(null),p("")};return t.jsxs("div",{className:"h-screen flex flex-col bg-gray-900",children:[t.jsxs("div",{className:"p-6 border-b border-gray-700",children:[t.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"EPG Mapper - Simple Mode"}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Select EPG Source"}),t.jsxs("select",{value:n||"",onChange:ue=>i(ue.target.value?parseInt(ue.target.value):null),className:"w-full max-w-md px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white",children:[t.jsx("option",{value:"",children:"Choose an EPG source..."}),N?.map(ue=>t.jsxs("option",{value:ue.id,children:[ue.name," (",ue.channelCount," channels, ",ue.programCount," programs)"]},ue.id))]})]}),n&&t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"relative max-w-md flex-1",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search EPG channels or programs...",value:e,onChange:ue=>s(ue.target.value),className:"w-full pl-10 pr-10 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400"}),e&&t.jsx("button",{onClick:()=>s(""),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 hover:bg-gray-700 rounded",title:"Clear search",children:t.jsx(nt,{className:"h-4 w-4 text-gray-400"})})]}),e&&t.jsxs("button",{onClick:()=>s(""),className:"px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg text-sm font-medium",children:["Clear Filter - Show All ",I.length," Channels"]})]})]}),n&&t.jsxs("div",{className:"px-6 py-3 bg-gray-800 border-b border-gray-700 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Bs,{className:"h-5 w-5 text-indigo-400"}),t.jsx("span",{className:"text-white font-medium",children:d.size>0?`${d.size} M3U channel(s) selected`:"Select M3U channels to bulk map"})]}),t.jsxs("div",{className:"flex gap-2",children:[d.size>0&&t.jsx("button",{onClick:()=>h(new Set),className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded",children:"Clear Selection"}),t.jsxs("button",{onClick:()=>f("selecting"),className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-sm rounded flex items-center gap-1.5",children:[t.jsx(Bs,{className:"h-4 w-4"}),d.size>0?`Selected ${d.size} channels`:"Select M3U Channels..."]})]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:n?T?t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto"}),t.jsx("p",{className:"text-gray-400 mt-4",children:"Loading EPG channels..."})]}):t.jsxs("div",{className:"max-w-6xl mx-auto",children:[t.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[t.jsxs("span",{className:"text-sm text-gray-400",children:["Showing ",D.length," of ",I.length," EPG channels",e&&t.jsxs("span",{className:"ml-1 text-yellow-400",children:['(filtered by "',e,'")']})]}),be.length>0&&ye.length>0&&t.jsxs("span",{className:"text-sm text-green-400",children:["(",ye.length," suggested matches)"]}),e&&t.jsx("button",{onClick:()=>s(""),className:"text-sm text-yellow-400 hover:text-yellow-300 underline",children:"Clear filter to see all channels"})]}),K&&t.jsx("div",{className:"mb-6 bg-yellow-900/30 border-2 border-yellow-600/50 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{className:"text-2xl",children:""}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-bold text-yellow-400 text-lg mb-2",children:"Market Mismatch Detected"}),t.jsxs("p",{className:"text-yellow-200 mb-3",children:["Your EPG source is for ",t.jsx("span",{className:"font-bold",children:K.epgMarket}),", but some selected M3U channels appear to be from different markets:"]}),t.jsx("div",{className:"space-y-2 mb-4",children:K.mismatches.map(({channel:ue,m3uMarket:Ge,network:Ve,localEquivalent:bt})=>t.jsxs("div",{className:"bg-yellow-900/30 rounded p-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-white font-medium",children:ue.name}),t.jsxs("span",{className:"text-yellow-300 ml-2",children:["(",Ge,")"]})]}),bt&&t.jsxs("div",{className:"text-sm",children:[t.jsxs("span",{className:"text-gray-400",children:["Local ",Ve,": "]}),t.jsx("span",{className:"text-green-400 font-bold",children:bt})]})]}),bt&&t.jsxs("p",{className:"text-sm text-yellow-200/70 mt-1",children:[" Look for ",t.jsx("span",{className:"font-bold text-green-400",children:bt})," in the suggestions below - it's the ",K.epgMarket," ",Ve," affiliate"]})]},ue.id))}),t.jsx("p",{className:"text-sm text-yellow-200/70",children:"You can still map these channels, but the EPG data may not match. Consider adding an EPG source for the channel's market or use the local equivalent."})]})]})}),d.size>0&&ye.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full animate-pulse"}),t.jsx("h2",{className:"text-lg font-semibold text-green-400",children:" Suggested Matches for Your Selection"})]}),t.jsxs("p",{className:"text-sm text-gray-400 mb-3",children:["Based on your selected M3U channel(s), these EPG channels are likely matches",ae()&&t.jsxs("span",{className:"text-blue-400",children:[" in ",ae()]}),":"]}),t.jsx("div",{className:"space-y-3",children:ye.map(ue=>{const Ge=new Date(ue.currentProgram.start)<=P&&new Date(ue.currentProgram.end)>P;return t.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border-2 border-green-600/50 shadow-lg shadow-green-900/20",children:t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsxs("h3",{className:"font-semibold text-white text-lg",children:[ue.currentProgram.callSign||ue.channelId.replace(/^(gracenote|fubo)-/,""),ue.currentProgram.channelNo&&t.jsxs("span",{className:"ml-2 text-gray-400",children:["Ch ",ue.currentProgram.channelNo]})]}),ue.currentProgram.affiliateName&&t.jsx("span",{className:"px-3 py-1 bg-green-600 text-white text-sm rounded font-medium",children:ue.currentProgram.affiliateName}),Ge&&t.jsx("span",{className:"px-2 py-0.5 bg-red-600 text-white text-xs rounded font-medium",children:"LIVE NOW"})]}),t.jsxs("div",{className:"mb-1",children:[t.jsx("p",{className:"text-white font-medium",children:ue.currentProgram.title}),ue.currentProgram.description&&t.jsx("p",{className:"text-sm text-gray-400 line-clamp-2 mt-1",children:ue.currentProgram.description})]}),ee(ue.channelId).length>0&&t.jsxs("div",{className:"mt-3 space-y-1.5",children:[t.jsx("p",{className:"text-xs text-gray-400 font-medium",children:"Mapped M3U Channels:"}),ee(ue.channelId).map(Ve=>t.jsxs("div",{className:"flex items-center gap-2 text-sm bg-gray-700/50 rounded px-2 py-1.5",children:[t.jsx(Bs,{className:"h-3.5 w-3.5 text-green-400 flex-shrink-0"}),t.jsxs("span",{className:"text-white flex-1",children:[Ve.name," (#",Ve.number,")"]}),t.jsx("button",{onClick:()=>H.mutate(Ve.id),className:"text-red-400 hover:text-red-300 text-xs px-2 py-0.5 hover:bg-red-900/20 rounded",children:"Unmap"})]},Ve.id))]})]}),t.jsx("div",{className:"flex-shrink-0",children:t.jsxs("button",{onClick:()=>Z(ue.channelId),className:"px-6 py-3 bg-green-600 hover:bg-green-700 text-white text-sm rounded-lg font-bold flex items-center gap-2 shadow-lg",children:[t.jsx(Bs,{className:"h-5 w-5"}),"Map ",d.size," Here"]})})]})},ue.channelId)})}),Ee.length>0&&t.jsx("div",{className:"mt-6 mb-3",children:t.jsx("h2",{className:"text-lg font-semibold text-gray-400",children:"Other EPG Channels"})})]}),t.jsx("div",{className:"space-y-3",children:(d.size>0&&ye.length>0?Ee:D).map(ue=>{const Ge=new Date(ue.currentProgram.start)<=P&&new Date(ue.currentProgram.end)>P;return t.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsxs("h3",{className:"font-semibold text-white",children:[ue.currentProgram.callSign||ue.channelId.replace(/^(gracenote|fubo)-/,""),ue.currentProgram.channelNo&&t.jsxs("span",{className:"ml-2 text-gray-400",children:["Ch ",ue.currentProgram.channelNo]})]}),ue.currentProgram.affiliateName&&t.jsx("span",{className:"px-2 py-0.5 bg-blue-600 text-white text-xs rounded",children:ue.currentProgram.affiliateName}),Ge&&t.jsx("span",{className:"px-2 py-0.5 bg-red-600 text-white text-xs rounded font-medium",children:"LIVE NOW"}),t.jsxs("span",{className:"text-xs text-gray-500",children:[ue.programCount," programs"]})]}),t.jsxs("div",{className:"mb-1",children:[t.jsx("p",{className:"text-white font-medium",children:ue.currentProgram.title}),ue.currentProgram.description&&t.jsx("p",{className:"text-sm text-gray-400 line-clamp-2 mt-1",children:ue.currentProgram.description})]}),t.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[t.jsx("span",{children:new Date(ue.currentProgram.start).toLocaleString()}),ue.currentProgram.category&&t.jsx("span",{className:"px-2 py-1 bg-gray-700 rounded",children:ue.currentProgram.category})]}),ee(ue.channelId).length>0&&t.jsxs("div",{className:"mt-3 space-y-1.5",children:[t.jsx("p",{className:"text-xs text-gray-400 font-medium",children:"Mapped M3U Channels:"}),ee(ue.channelId).map(Ve=>t.jsxs("div",{className:"flex items-center gap-2 text-sm bg-gray-700/50 rounded px-2 py-1.5",children:[t.jsx(Bs,{className:"h-3.5 w-3.5 text-green-400 flex-shrink-0"}),t.jsxs("span",{className:"text-white flex-1",children:[Ve.name," (#",Ve.number,")"]}),t.jsx("button",{onClick:()=>H.mutate(Ve.id),className:"text-red-400 hover:text-red-300 text-xs px-2 py-0.5 hover:bg-red-900/20 rounded",title:"Remove mapping",children:"Unmap"})]},Ve.id))]})]}),t.jsxs("div",{className:"flex-shrink-0 flex flex-col gap-2",children:[d.size>0&&t.jsxs("button",{onClick:()=>Z(ue.channelId),className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm rounded font-medium flex items-center gap-1.5",children:[t.jsx(Bs,{className:"h-4 w-4"}),"Map ",d.size," Selected Here"]}),t.jsx("button",{onClick:()=>o(ue.channelId),className:`px-4 py-2 rounded text-sm font-medium ${ee(ue.channelId).length>0?"bg-gray-700 hover:bg-gray-600 text-white":"bg-indigo-600 hover:bg-indigo-700 text-white"}`,children:ee(ue.channelId).length>0?"Map Another":"Map Channel"})]})]})},ue.channelId)})})]}):t.jsx("div",{className:"text-center py-12 text-gray-400",children:t.jsx("p",{children:"Select an EPG source above to start mapping channels"})})}),u==="selecting"&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>{f(null),y("")},children:t.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] flex flex-col",onClick:ue=>ue.stopPropagation(),children:[t.jsxs("div",{className:"p-4 border-b border-gray-700",children:[t.jsx("h2",{className:"text-xl font-bold text-white",children:"Select M3U Channels to Map"}),t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Choose the M3U channels you want to map to an EPG channel"}),t.jsxs("div",{className:"relative mt-3",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search channels by name, number, or group...",value:b,onChange:ue=>y(ue.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 text-sm",autoFocus:!0}),b&&t.jsx("button",{onClick:()=>y(""),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 hover:bg-gray-600 rounded",children:t.jsx(nt,{className:"h-4 w-4 text-gray-400"})})]}),t.jsxs("div",{className:"text-xs text-gray-400 mt-2",children:[Le.length," channel",Le.length!==1?"s":""," found",b&&` for "${b}"`]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:!_||_.length===0?t.jsx("div",{className:"text-center py-8 text-gray-400",children:t.jsx("p",{children:"No M3U channels available"})}):Le.length===0?t.jsx("div",{className:"text-center py-8 text-gray-400",children:t.jsx("p",{children:"No channels match your search"})}):ze.length>1?t.jsx("div",{className:"space-y-4",children:ze.map(([ue,Ge])=>t.jsxs("div",{children:[t.jsxs("div",{className:"px-2 py-1.5 bg-gray-700 rounded text-sm font-semibold text-gray-300 mb-2 flex items-center justify-between",children:[t.jsx("span",{children:ue}),t.jsxs("span",{className:"text-xs text-gray-400",children:[Ge.length," channels"]})]}),t.jsx("div",{className:"space-y-2",children:Ge.map(Ve=>t.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors ${d.has(Ve.id)?"bg-indigo-900/40 border-2 border-indigo-600":"bg-gray-700/50 border-2 border-transparent hover:bg-gray-700"}`,children:[t.jsx("input",{type:"checkbox",checked:d.has(Ve.id),onChange:()=>ie(Ve.id),className:"w-4 h-4 rounded border-gray-500 bg-gray-600 text-indigo-600 focus:ring-indigo-500"}),ju(Ve.logo)&&t.jsx("img",{src:Ve.logo,alt:"",className:"w-8 h-8 rounded object-cover"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-white font-medium",children:Ve.name}),t.jsxs("div",{className:"text-xs text-gray-400",children:["Channel #",Ve.number]})]}),Ve.epgSourceId&&t.jsx("span",{className:"text-xs text-green-400",children:"Already mapped"})]},Ve.id))})]},ue))}):t.jsx("div",{className:"space-y-2",children:Le.map(ue=>t.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors ${d.has(ue.id)?"bg-indigo-900/40 border-2 border-indigo-600":"bg-gray-700/50 border-2 border-transparent hover:bg-gray-700"}`,children:[t.jsx("input",{type:"checkbox",checked:d.has(ue.id),onChange:()=>ie(ue.id),className:"w-4 h-4 rounded border-gray-500 bg-gray-600 text-indigo-600 focus:ring-indigo-500"}),ju(ue.logo)&&t.jsx("img",{src:ue.logo,alt:"",className:"w-8 h-8 rounded object-cover"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-white font-medium",children:ue.name}),t.jsxs("div",{className:"text-xs text-gray-400",children:["Channel #",ue.number]})]}),ue.epgSourceId&&t.jsx("span",{className:"text-xs text-green-400",children:"Already mapped"})]},ue.id))})}),t.jsxs("div",{className:"p-4 border-t border-gray-700 flex items-center justify-between",children:[t.jsxs("span",{className:"text-sm text-gray-400",children:[d.size," channel(s) selected"]}),t.jsx("div",{className:"flex gap-2",children:t.jsx("button",{onClick:()=>{f(null),y("")},className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded",children:"Done"})})]})]})}),l&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:Xe,children:t.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] flex flex-col",onClick:ue=>ue.stopPropagation(),children:[t.jsxs("div",{className:"p-4 border-b border-gray-700",children:[t.jsx("h2",{className:"text-xl font-bold text-white",children:"Map M3U Channel to EPG"}),t.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["Select an M3U channel to map to: ",t.jsx("span",{className:"text-indigo-400 font-medium",children:I.find(ue=>ue.channelId===l)?.currentProgram.callSign||l})]}),t.jsxs("div",{className:"relative mt-3",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{ref:v,type:"text",placeholder:"Search M3U channels by name, number, or group...",value:g,onChange:ue=>p(ue.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 text-sm",autoFocus:!0}),g&&t.jsx("button",{onClick:()=>p(""),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 hover:bg-gray-600 rounded",children:t.jsx(nt,{className:"h-4 w-4 text-gray-400"})})]}),t.jsxs("div",{className:"text-xs text-gray-400 mt-2",children:[re.length," channel",re.length!==1?"s":""," found",g&&` for "${g}"`]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:!_||_.length===0?t.jsx("div",{className:"text-center py-8 text-gray-400",children:t.jsx("p",{children:"No M3U channels available"})}):re.length===0?t.jsx("div",{className:"text-center py-8 text-gray-400",children:t.jsx("p",{children:"No channels match your search"})}):fe.length>1?t.jsx("div",{className:"space-y-4",children:fe.map(([ue,Ge])=>t.jsxs("div",{children:[t.jsxs("div",{className:"px-2 py-1.5 bg-gray-700 rounded text-sm font-semibold text-gray-300 mb-2 flex items-center justify-between",children:[t.jsx("span",{children:ue}),t.jsxs("span",{className:"text-xs text-gray-400",children:[Ge.length," channels"]})]}),t.jsx("div",{className:"space-y-1",children:Ge.map(Ve=>t.jsxs("button",{onClick:()=>{O(l,Ve.id),Xe()},className:"w-full flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors bg-gray-700/50 hover:bg-indigo-900/40 hover:border-indigo-600 border-2 border-transparent",children:[ju(Ve.logo)&&t.jsx("img",{src:Ve.logo,alt:"",className:"w-8 h-8 rounded object-cover"}),t.jsxs("div",{className:"flex-1 text-left",children:[t.jsx("div",{className:"text-white font-medium",children:Ve.name}),t.jsxs("div",{className:"text-xs text-gray-400",children:["Channel #",Ve.number]})]}),Ve.epgSourceId&&t.jsx("span",{className:"text-xs text-green-400",children:"Already mapped"})]},Ve.id))})]},ue))}):t.jsx("div",{className:"space-y-1",children:re.map(ue=>t.jsxs("button",{onClick:()=>{O(l,ue.id),Xe()},className:"w-full flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors bg-gray-700/50 hover:bg-indigo-900/40 hover:border-indigo-600 border-2 border-transparent",children:[ju(ue.logo)&&t.jsx("img",{src:ue.logo,alt:"",className:"w-8 h-8 rounded object-cover"}),t.jsxs("div",{className:"flex-1 text-left",children:[t.jsx("div",{className:"text-white font-medium",children:ue.name}),t.jsxs("div",{className:"text-xs text-gray-400",children:["Channel #",ue.number]})]}),ue.epgSourceId&&t.jsx("span",{className:"text-xs text-green-400",children:"Already mapped"})]},ue.id))})}),t.jsx("div",{className:"p-4 border-t border-gray-700 flex justify-end",children:t.jsx("button",{onClick:Xe,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded",children:"Cancel"})})]})})]})}const Ze=Number.isFinite||function(a){return typeof a=="number"&&isFinite(a)},ZD=Number.isSafeInteger||function(a){return typeof a=="number"&&Math.abs(a)<=e5},e5=Number.MAX_SAFE_INTEGER||9007199254740991;let rt=(function(a){return a.NETWORK_ERROR="networkError",a.MEDIA_ERROR="mediaError",a.KEY_SYSTEM_ERROR="keySystemError",a.MUX_ERROR="muxError",a.OTHER_ERROR="otherError",a})({}),Ne=(function(a){return a.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",a.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",a.KEY_SYSTEM_NO_SESSION="keySystemNoSession",a.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",a.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",a.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",a.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",a.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",a.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",a.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",a.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",a.MANIFEST_LOAD_ERROR="manifestLoadError",a.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",a.MANIFEST_PARSING_ERROR="manifestParsingError",a.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",a.LEVEL_EMPTY_ERROR="levelEmptyError",a.LEVEL_LOAD_ERROR="levelLoadError",a.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",a.LEVEL_PARSING_ERROR="levelParsingError",a.LEVEL_SWITCH_ERROR="levelSwitchError",a.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",a.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",a.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",a.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",a.FRAG_LOAD_ERROR="fragLoadError",a.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",a.FRAG_DECRYPT_ERROR="fragDecryptError",a.FRAG_PARSING_ERROR="fragParsingError",a.FRAG_GAP="fragGap",a.REMUX_ALLOC_ERROR="remuxAllocError",a.KEY_LOAD_ERROR="keyLoadError",a.KEY_LOAD_TIMEOUT="keyLoadTimeOut",a.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",a.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",a.BUFFER_APPEND_ERROR="bufferAppendError",a.BUFFER_APPENDING_ERROR="bufferAppendingError",a.BUFFER_STALLED_ERROR="bufferStalledError",a.BUFFER_FULL_ERROR="bufferFullError",a.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",a.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",a.ASSET_LIST_LOAD_ERROR="assetListLoadError",a.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",a.ASSET_LIST_PARSING_ERROR="assetListParsingError",a.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",a.INTERNAL_EXCEPTION="internalException",a.INTERNAL_ABORTED="aborted",a.ATTACH_MEDIA_ERROR="attachMediaError",a.UNKNOWN="unknown",a})({}),$=(function(a){return a.MEDIA_ATTACHING="hlsMediaAttaching",a.MEDIA_ATTACHED="hlsMediaAttached",a.MEDIA_DETACHING="hlsMediaDetaching",a.MEDIA_DETACHED="hlsMediaDetached",a.MEDIA_ENDED="hlsMediaEnded",a.STALL_RESOLVED="hlsStallResolved",a.BUFFER_RESET="hlsBufferReset",a.BUFFER_CODECS="hlsBufferCodecs",a.BUFFER_CREATED="hlsBufferCreated",a.BUFFER_APPENDING="hlsBufferAppending",a.BUFFER_APPENDED="hlsBufferAppended",a.BUFFER_EOS="hlsBufferEos",a.BUFFERED_TO_END="hlsBufferedToEnd",a.BUFFER_FLUSHING="hlsBufferFlushing",a.BUFFER_FLUSHED="hlsBufferFlushed",a.MANIFEST_LOADING="hlsManifestLoading",a.MANIFEST_LOADED="hlsManifestLoaded",a.MANIFEST_PARSED="hlsManifestParsed",a.LEVEL_SWITCHING="hlsLevelSwitching",a.LEVEL_SWITCHED="hlsLevelSwitched",a.LEVEL_LOADING="hlsLevelLoading",a.LEVEL_LOADED="hlsLevelLoaded",a.LEVEL_UPDATED="hlsLevelUpdated",a.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",a.LEVELS_UPDATED="hlsLevelsUpdated",a.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",a.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",a.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",a.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",a.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",a.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",a.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",a.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",a.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",a.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",a.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",a.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",a.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",a.CUES_PARSED="hlsCuesParsed",a.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",a.INIT_PTS_FOUND="hlsInitPtsFound",a.FRAG_LOADING="hlsFragLoading",a.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",a.FRAG_LOADED="hlsFragLoaded",a.FRAG_DECRYPTED="hlsFragDecrypted",a.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",a.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",a.FRAG_PARSING_METADATA="hlsFragParsingMetadata",a.FRAG_PARSED="hlsFragParsed",a.FRAG_BUFFERED="hlsFragBuffered",a.FRAG_CHANGED="hlsFragChanged",a.FPS_DROP="hlsFpsDrop",a.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",a.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",a.ERROR="hlsError",a.DESTROYING="hlsDestroying",a.KEY_LOADING="hlsKeyLoading",a.KEY_LOADED="hlsKeyLoaded",a.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",a.BACK_BUFFER_REACHED="hlsBackBufferReached",a.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",a.ASSET_LIST_LOADING="hlsAssetListLoading",a.ASSET_LIST_LOADED="hlsAssetListLoaded",a.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",a.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",a.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",a.INTERSTITIAL_STARTED="hlsInterstitialStarted",a.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",a.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",a.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",a.INTERSTITIAL_ENDED="hlsInterstitialEnded",a.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",a.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",a.EVENT_CUE_ENTER="hlsEventCueEnter",a})({});var It={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},et={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class to{constructor(e,s=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=s,this.totalWeight_=n}sample(e,s){const n=Math.pow(this.alpha_,e);this.estimate_=s*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class t5{constructor(e,s,n,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new to(e),this.fast_=new to(s),this.defaultTTFB_=i,this.ttfb_=new to(e)}update(e,s){const{slow_:n,fast_:i,ttfb_:l}=this;n.halfLife!==e&&(this.slow_=new to(e,n.getEstimate(),n.getTotalWeight())),i.halfLife!==s&&(this.fast_=new to(s,i.getEstimate(),i.getTotalWeight())),l.halfLife!==e&&(this.ttfb_=new to(e,l.getEstimate(),l.getTotalWeight()))}sample(e,s){e=Math.max(e,this.minDelayMs_);const n=8*s,i=e/1e3,l=n/i;this.fast_.sample(i,l),this.slow_.sample(i,l)}sampleTTFB(e){const s=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(s,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function s5(a,e,s){return(e=n5(e))in a?Object.defineProperty(a,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):a[e]=s,a}function ds(){return ds=Object.assign?Object.assign.bind():function(a){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)({}).hasOwnProperty.call(s,n)&&(a[n]=s[n])}return a},ds.apply(null,arguments)}function y_(a,e){var s=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(a,i).enumerable})),s.push.apply(s,n)}return s}function is(a){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?arguments[e]:{};e%2?y_(Object(s),!0).forEach(function(n){s5(a,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(s)):y_(Object(s)).forEach(function(n){Object.defineProperty(a,n,Object.getOwnPropertyDescriptor(s,n))})}return a}function a5(a,e){if(typeof a!="object"||!a)return a;var s=a[Symbol.toPrimitive];if(s!==void 0){var n=s.call(a,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(a)}function n5(a){var e=a5(a,"string");return typeof e=="symbol"?e:e+""}class En{constructor(e,s){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n=`[${e}]:`;this.trace=br,this.debug=s.debug.bind(null,n),this.log=s.log.bind(null,n),this.warn=s.warn.bind(null,n),this.info=s.info.bind(null,n),this.error=s.error.bind(null,n)}}const br=function(){},i5={trace:br,debug:br,log:br,warn:br,info:br,error:br};function _0(){return ds({},i5)}function r5(a,e){const s=self.console[a];return s?s.bind(self.console,`${e?"["+e+"] ":""}[${a}] >`):br}function b_(a,e,s){return e[a]?e[a].bind(e):r5(a,s)}const N0=_0();function l5(a,e,s){const n=_0();if(typeof console=="object"&&a===!0||typeof a=="object"){const i=["debug","log","info","warn","error"];i.forEach(l=>{n[l]=b_(l,a,s)});try{n.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return _0()}i.forEach(l=>{N0[l]=b_(l,a)})}else ds(N0,n);return n}const rs=N0;function Ar(a=!0){return typeof self>"u"?void 0:(a||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function o5(a){return typeof self<"u"&&a===self.ManagedMediaSource}function Mw(a,e){const s=Object.keys(a),n=Object.keys(e),i=s.length,l=n.length;return!i||!l||i===l&&!s.some(o=>n.indexOf(o)===-1)}function nn(a,e=!1){if(typeof TextDecoder<"u"){const u=new TextDecoder("utf-8").decode(a);if(e){const f=u.indexOf("\0");return f!==-1?u.substring(0,f):u}return u.replace(/\0/g,"")}const s=a.length;let n,i,l,o="",d=0;for(;d<s;){if(n=a[d++],n===0&&e)return o;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(n);break;case 12:case 13:i=a[d++],o+=String.fromCharCode((n&31)<<6|i&63);break;case 14:i=a[d++],l=a[d++],o+=String.fromCharCode((n&15)<<12|(i&63)<<6|(l&63)<<0);break}}return o}function ca(a){let e="";for(let s=0;s<a.length;s++){let n=a[s].toString(16);n.length<2&&(n="0"+n),e+=n}return e}function Iw(a){return Uint8Array.from(a.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function c5(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var pg={exports:{}},v_;function d5(){return v_||(v_=1,(function(a,e){(function(s){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,l=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,d={buildAbsoluteURL:function(h,u,f){if(f=f||{},h=h.trim(),u=u.trim(),!u){if(!f.alwaysNormalize)return h;var g=d.parseURL(h);if(!g)throw new Error("Error trying to parse base URL.");return g.path=d.normalizePath(g.path),d.buildURLFromParts(g)}var p=d.parseURL(u);if(!p)throw new Error("Error trying to parse relative URL.");if(p.scheme)return f.alwaysNormalize?(p.path=d.normalizePath(p.path),d.buildURLFromParts(p)):u;var b=d.parseURL(h);if(!b)throw new Error("Error trying to parse base URL.");if(!b.netLoc&&b.path&&b.path[0]!=="/"){var y=i.exec(b.path);b.netLoc=y[1],b.path=y[2]}b.netLoc&&!b.path&&(b.path="/");var v={scheme:b.scheme,netLoc:p.netLoc,path:null,params:p.params,query:p.query,fragment:p.fragment};if(!p.netLoc&&(v.netLoc=b.netLoc,p.path[0]!=="/"))if(!p.path)v.path=b.path,p.params||(v.params=b.params,p.query||(v.query=b.query));else{var _=b.path,N=_.substring(0,_.lastIndexOf("/")+1)+p.path;v.path=d.normalizePath(N)}return v.path===null&&(v.path=f.alwaysNormalize?d.normalizePath(p.path):p.path),d.buildURLFromParts(v)},parseURL:function(h){var u=n.exec(h);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(h){for(h=h.split("").reverse().join("").replace(l,"");h.length!==(h=h.replace(o,"")).length;);return h.split("").reverse().join("")},buildURLFromParts:function(h){return h.scheme+h.netLoc+h.path+h.params+h.query+h.fragment}};a.exports=d})()})(pg)),pg.exports}var _p=d5();class Np{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var fs={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class Pw{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,h5(this,"stats")}setByteRange(e,s){const n=e.split("@",2);let i;n.length===1?i=s?.byteRangeEndOffset||0:i=parseInt(n[1]),this._byteRange=[i,parseInt(n[0])+i]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[fs.AUDIO]:null,[fs.VIDEO]:null,[fs.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Np),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=_p.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[fs.AUDIO]=null,e[fs.VIDEO]=null,e[fs.AUDIOVIDEO]=null}}function Us(a){return a.sn!=="initSegment"}class xg extends Pw{constructor(e,s){super(s),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],s=this.byteRange[1];if(Ze(e)&&Ze(s))return s-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:s}=this;if(!s||s.NONE)return null;if(s.identity)this._decryptdata||(this._decryptdata=s.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const n=Object.keys(s);if(n.length===1){const i=this._decryptdata=s[n[0]]||null;i&&(this._decryptdata=i.getDecryptData(this.sn,s))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=Ze(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var s;const n=Object.keys(this.levelkeys),i=n.length;if(i>1||i===1&&(s=this.levelkeys[n[0]])!=null&&s.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Ze(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Us(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const s=this.levelkeys;if(s){var n;const i=s[e];i&&!((n=this._decryptdata)!=null&&n.keyId)&&(this._decryptdata=i.getDecryptData(this.sn,s))}}abortRequests(){var e,s;(e=this.loader)==null||e.abort(),(s=this.keyLoader)==null||s.abort()}setElementaryStreamInfo(e,s,n,i,l,o=!1){const{elementaryStreams:d}=this,h=d[e];if(!h){d[e]={startPTS:s,endPTS:n,startDTS:i,endDTS:l,partial:o};return}h.startPTS=Math.min(h.startPTS,s),h.endPTS=Math.max(h.endPTS,n),h.startDTS=Math.min(h.startDTS,i),h.endDTS=Math.max(h.endDTS,l)}}class u5 extends Pw{constructor(e,s,n,i,l){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=s,this.index=i;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,l),l&&(this.fragOffset=l.fragOffset+l.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function Ow(a,e){const s=Object.getPrototypeOf(a);if(s){const n=Object.getOwnPropertyDescriptor(s,e);return n||Ow(s,e)}}function h5(a,e){const s=Ow(a,e);s&&(s.enumerable=!0,Object.defineProperty(a,e,s))}const __=Math.pow(2,32)-1,f5=[].push,Fw={video:1,audio:2,id3:3,text:4};function Qs(a){return String.fromCharCode.apply(null,a)}function Bw(a,e){const s=a[e]<<8|a[e+1];return s<0?65536+s:s}function Nt(a,e){const s=Uw(a,e);return s<0?4294967296+s:s}function N_(a,e){let s=Nt(a,e);return s*=Math.pow(2,32),s+=Nt(a,e+4),s}function Uw(a,e){return a[e]<<24|a[e+1]<<16|a[e+2]<<8|a[e+3]}function m5(a){const e=a.byteLength;for(let s=0;s<e;){const n=Nt(a,s);if(n>8&&a[s+4]===109&&a[s+5]===111&&a[s+6]===111&&a[s+7]===102)return!0;s=n>1?s+n:e}return!1}function Mt(a,e){const s=[];if(!e.length)return s;const n=a.byteLength;for(let i=0;i<n;){const l=Nt(a,i),o=Qs(a.subarray(i+4,i+8)),d=l>1?i+l:n;if(o===e[0])if(e.length===1)s.push(a.subarray(i+8,d));else{const h=Mt(a.subarray(i+8,d),e.slice(1));h.length&&f5.apply(s,h)}i=d}return s}function g5(a){const e=[],s=a[0];let n=8;const i=Nt(a,n);n+=4;let l=0,o=0;s===0?(l=Nt(a,n),o=Nt(a,n+4),n+=8):(l=N_(a,n),o=N_(a,n+8),n+=16),n+=2;let d=a.length+o;const h=Bw(a,n);n+=2;for(let u=0;u<h;u++){let f=n;const g=Nt(a,f);f+=4;const p=g&2147483647;if((g&2147483648)>>>31===1)return rs.warn("SIDX has hierarchical references (not supported)"),null;const y=Nt(a,f);f+=4,e.push({referenceSize:p,subsegmentDuration:y,info:{duration:y/i,start:d,end:d+p-1}}),d+=p,f+=4,n=f}return{earliestPresentationTime:l,timescale:i,version:s,referencesCount:h,references:e}}function $w(a){const e=[],s=Mt(a,["moov","trak"]);for(let i=0;i<s.length;i++){const l=s[i],o=Mt(l,["tkhd"])[0];if(o){let d=o[0];const h=Nt(o,d===0?12:20),u=Mt(l,["mdia","mdhd"])[0];if(u){d=u[0];const f=Nt(u,d===0?12:20),g=Mt(l,["mdia","hdlr"])[0];if(g){const p=Qs(g.subarray(8,12)),b={soun:fs.AUDIO,vide:fs.VIDEO}[p],y=Mt(l,["mdia","minf","stbl","stsd"])[0],v=p5(y);b?(e[h]={timescale:f,type:b,stsd:v},e[b]=is({timescale:f,id:h},v)):e[h]={timescale:f,type:p,stsd:v}}}}}return Mt(a,["moov","mvex","trex"]).forEach(i=>{const l=Nt(i,4),o=e[l];o&&(o.default={duration:Nt(i,12),flags:Nt(i,20)})}),e}function p5(a){const e=a.subarray(8),s=e.subarray(86),n=Qs(e.subarray(4,8));let i=n,l;const o=n==="enca"||n==="encv";if(o){const u=Mt(e,[n])[0].subarray(n==="enca"?28:78);Mt(u,["sinf"]).forEach(g=>{const p=Mt(g,["schm"])[0];if(p){const b=Qs(p.subarray(4,8));if(b==="cbcs"||b==="cenc"){const y=Mt(g,["frma"])[0];y&&(i=Qs(y))}}})}const d=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const h=Mt(s,["avcC"])[0];h&&h.length>3&&(i+="."+Tu(h[1])+Tu(h[2])+Tu(h[3]),l=Eu(d==="avc1"?"dva1":"dvav",s));break}case"mp4a":{const h=Mt(e,[n])[0],u=Mt(h.subarray(28),["esds"])[0];if(u&&u.length>7){let f=4;if(u[f++]!==3)break;f=yg(u,f),f+=2;const g=u[f++];if(g&128&&(f+=2),g&64&&(f+=u[f++]),u[f++]!==4)break;f=yg(u,f);const p=u[f++];if(p===64)i+="."+Tu(p);else break;if(f+=12,u[f++]!==5)break;f=yg(u,f);const b=u[f++];let y=(b&248)>>3;y===31&&(y+=1+((b&7)<<3)+((u[f]&224)>>5)),i+="."+y}break}case"hvc1":case"hev1":{const h=Mt(s,["hvcC"])[0];if(h&&h.length>12){const u=h[1],f=["","A","B","C"][u>>6],g=u&31,p=Nt(h,2),b=(u&32)>>5?"H":"L",y=h[12],v=h.subarray(6,12);i+="."+f+g,i+="."+x5(p).toString(16).toUpperCase(),i+="."+b+y;let _="";for(let N=v.length;N--;){const C=v[N];(C||_)&&(_="."+C.toString(16).toUpperCase()+_)}i+=_}l=Eu(d=="hev1"?"dvhe":"dvh1",s);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{i=Eu(i,s)||i;break}case"vp09":{const h=Mt(s,["vpcC"])[0];if(h&&h.length>6){const u=h[4],f=h[5],g=h[6]>>4&15;i+="."+Qn(u)+"."+Qn(f)+"."+Qn(g)}break}case"av01":{const h=Mt(s,["av1C"])[0];if(h&&h.length>2){const u=h[1]>>>5,f=h[1]&31,g=h[2]>>>7?"H":"M",p=(h[2]&64)>>6,b=(h[2]&32)>>5,y=u===2&&p?b?12:10:p?10:8,v=(h[2]&16)>>4,_=(h[2]&8)>>3,N=(h[2]&4)>>2,C=h[2]&3;i+="."+u+"."+Qn(f)+g+"."+Qn(y)+"."+v+"."+_+N+C+"."+Qn(1)+"."+Qn(1)+"."+Qn(1)+"."+0,l=Eu("dav1",s)}break}}return{codec:i,encrypted:o,supplemental:l}}function Eu(a,e){const s=Mt(e,["dvvC"]),n=s.length?s[0]:Mt(e,["dvcC"])[0];if(n){const i=n[2]>>1&127,l=n[2]<<5&32|n[3]>>3&31;return a+"."+Qn(i)+"."+Qn(l)}}function x5(a){let e=0;for(let s=0;s<32;s++)e|=(a>>s&1)<<31-s;return e>>>0}function yg(a,e){const s=e+5;for(;a[e++]&128&&e<s;);return e}function Tu(a){return("0"+a.toString(16).toUpperCase()).slice(-2)}function Qn(a){return(a<10?"0":"")+a}function y5(a,e){if(!a||!e)return;const s=e.keyId;s&&e.isCommonEncryption&&Gw(a,(n,i)=>{const l=n.subarray(8,24);l.some(o=>o!==0)||(rs.log(`[eme] Patching keyId in 'enc${i?"a":"v"}>sinf>>tenc' box: ${ca(l)} -> ${ca(s)}`),n.set(s,8))})}function b5(a){const e=[];return Gw(a,s=>e.push(s.subarray(8,24))),e}function Gw(a,e){Mt(a,["moov","trak"]).forEach(n=>{const i=Mt(n,["mdia","minf","stbl","stsd"])[0];if(!i)return;const l=i.subarray(8);let o=Mt(l,["enca"]);const d=o.length>0;d||(o=Mt(l,["encv"])),o.forEach(h=>{const u=d?h.subarray(28):h.subarray(78);Mt(u,["sinf"]).forEach(g=>{const p=Vw(g);p&&e(p,d)})})})}function Vw(a){const e=Mt(a,["schm"])[0];if(e){const s=Qs(e.subarray(4,8));if(s==="cbcs"||s==="cenc"){const n=Mt(a,["schi","tenc"])[0];if(n)return n}}}function v5(a,e,s){const n={},i=Mt(a,["moof","traf"]);for(let l=0;l<i.length;l++){const o=i[l],d=Mt(o,["tfhd"])[0],h=Nt(d,4),u=e[h];if(!u)continue;n[h]||(n[h]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type});const f=n[h],g=Mt(o,["tfdt"])[0];if(g){const T=g[0];let L=Nt(g,4);T===1&&(L===__?s.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(L*=__+1,L+=Nt(g,8))),Ze(L)&&(!Ze(f.start)||L<f.start)&&(f.start=L)}const p=u.default,b=Nt(d,0)|p?.flags;let y=p?.duration||0;b&8&&(b&2?y=Nt(d,12):y=Nt(d,8));const v=Mt(o,["trun"]);let _=f.start||0,N=0,C=y;for(let T=0;T<v.length;T++){const L=v[T],F=Nt(L,4),H=f.sampleCount;f.sampleCount+=F;const B=L[3]&1,P=L[3]&4,I=L[2]&1,D=L[2]&2,O=L[2]&4,ee=L[2]&8;let ie=8,Z=F;for(B&&(ie+=4),P&&F&&(!(L[ie+1]&1)&&f.keyFrameIndex===void 0&&(f.keyFrameIndex=H),ie+=4,I?(C=Nt(L,ie),ie+=4):C=y,D&&(ie+=4),ee&&(ie+=4),_+=C,N+=C,Z--);Z--;)I?(C=Nt(L,ie),ie+=4):C=y,D&&(ie+=4),O&&(L[ie+1]&1||f.keyFrameIndex===void 0&&(f.keyFrameIndex=f.sampleCount-(Z+1),f.keyFrameStart=_),ie+=4),ee&&(ie+=4),_+=C,N+=C;!N&&y&&(N+=y*F)}f.duration+=N}if(!Object.keys(n).some(l=>n[l].duration)){let l=1/0,o=0;const d=Mt(a,["sidx"]);for(let h=0;h<d.length;h++){const u=g5(d[h]);if(u!=null&&u.references){l=Math.min(l,u.earliestPresentationTime/u.timescale);const f=u.references.reduce((g,p)=>g+p.info.duration||0,0);o=Math.max(o,f+u.earliestPresentationTime/u.timescale)}}o&&Ze(o)&&Object.keys(n).forEach(h=>{n[h].duration||(n[h].duration=o*n[h].timescale-n[h].start)})}return n}function _5(a){const e={valid:null,remainder:null},s=Mt(a,["moof"]);if(s.length<2)return e.remainder=a,e;const n=s[s.length-1];return e.valid=a.slice(0,n.byteOffset-8),e.remainder=a.slice(n.byteOffset-8),e}function wn(a,e){const s=new Uint8Array(a.length+e.length);return s.set(a),s.set(e,a.length),s}function w_(a,e){const s=[],n=e.samples,i=e.timescale,l=e.id;let o=!1;return Mt(n,["moof"]).map(h=>{const u=h.byteOffset-8;Mt(h,["traf"]).map(g=>{const p=Mt(g,["tfdt"]).map(b=>{const y=b[0];let v=Nt(b,4);return y===1&&(v*=Math.pow(2,32),v+=Nt(b,8)),v/i})[0];return p!==void 0&&(a=p),Mt(g,["tfhd"]).map(b=>{const y=Nt(b,4),v=Nt(b,0)&16777215,_=(v&1)!==0,N=(v&2)!==0,C=(v&8)!==0;let T=0;const L=(v&16)!==0;let F=0;const H=(v&32)!==0;let B=8;y===l&&(_&&(B+=8),N&&(B+=4),C&&(T=Nt(b,B),B+=4),L&&(F=Nt(b,B),B+=4),H&&(B+=4),e.type==="video"&&(o=Xh(e.codec)),Mt(g,["trun"]).map(P=>{const I=P[0],D=Nt(P,0)&16777215,O=(D&1)!==0;let ee=0;const ie=(D&4)!==0,Z=(D&256)!==0;let z=0;const X=(D&512)!==0;let ae=0;const te=(D&1024)!==0,W=(D&2048)!==0;let K=0;const q=Nt(P,4);let J=8;O&&(ee=Nt(P,J),J+=4),ie&&(J+=4);let oe=ee+u;for(let be=0;be<q;be++){if(Z?(z=Nt(P,J),J+=4):z=T,X?(ae=Nt(P,J),J+=4):ae=F,te&&(J+=4),W&&(I===0?K=Nt(P,J):K=Uw(P,J),J+=4),e.type===fs.VIDEO){let ye=0;for(;ye<ae;){const Ee=Nt(n,oe);if(oe+=4,N5(o,n[oe])){const re=n.subarray(oe,oe+Ee);wp(re,o?2:1,a+K/i,s)}oe+=Ee,ye+=Ee+4}}a+=z/i}}))})})}),s}function Xh(a){if(!a)return!1;const e=a.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function N5(a,e){if(a){const s=e>>1&63;return s===39||s===40}else return(e&31)===6}function wp(a,e,s,n){const i=qw(a);let l=0;l+=e;let o=0,d=0,h=0;for(;l<i.length;){o=0;do{if(l>=i.length)break;h=i[l++],o+=h}while(h===255);d=0;do{if(l>=i.length)break;h=i[l++],d+=h}while(h===255);const u=i.length-l;let f=l;if(d<u)l+=d;else if(d>u){rs.error(`Malformed SEI payload. ${d} is too small, only ${u} bytes left to parse.`);break}if(o===4){if(i[f++]===181){const p=Bw(i,f);if(f+=2,p===49){const b=Nt(i,f);if(f+=4,b===1195456820){const y=i[f++];if(y===3){const v=i[f++],_=31&v,N=64&v,C=N?2+_*3:0,T=new Uint8Array(C);if(N){T[0]=v;for(let L=1;L<C;L++)T[L]=i[f++]}n.push({type:y,payloadType:o,pts:s,bytes:T})}}}}}else if(o===5&&d>16){const g=[];for(let y=0;y<16;y++){const v=i[f++].toString(16);g.push(v.length==1?"0"+v:v),(y===3||y===5||y===7||y===9)&&g.push("-")}const p=d-16,b=new Uint8Array(p);for(let y=0;y<p;y++)b[y]=i[f++];n.push({payloadType:o,pts:s,uuid:g.join(""),userData:nn(b),userDataBytes:b})}}}function qw(a){const e=a.byteLength,s=[];let n=1;for(;n<e-2;)a[n]===0&&a[n+1]===0&&a[n+2]===3?(s.push(n+2),n+=2):n++;if(s.length===0)return a;const i=e-s.length,l=new Uint8Array(i);let o=0;for(n=0;n<i;o++,n++)o===s[0]&&(o++,s.shift()),l[n]=a[o];return l}function w5(a){const e=a[0];let s="",n="",i=0,l=0,o=0,d=0,h=0,u=0;if(e===0){for(;Qs(a.subarray(u,u+1))!=="\0";)s+=Qs(a.subarray(u,u+1)),u+=1;for(s+=Qs(a.subarray(u,u+1)),u+=1;Qs(a.subarray(u,u+1))!=="\0";)n+=Qs(a.subarray(u,u+1)),u+=1;n+=Qs(a.subarray(u,u+1)),u+=1,i=Nt(a,12),l=Nt(a,16),d=Nt(a,20),h=Nt(a,24),u=28}else if(e===1){u+=4,i=Nt(a,u),u+=4;const g=Nt(a,u);u+=4;const p=Nt(a,u);for(u+=4,o=2**32*g+p,ZD(o)||(o=Number.MAX_SAFE_INTEGER,rs.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),d=Nt(a,u),u+=4,h=Nt(a,u),u+=4;Qs(a.subarray(u,u+1))!=="\0";)s+=Qs(a.subarray(u,u+1)),u+=1;for(s+=Qs(a.subarray(u,u+1)),u+=1;Qs(a.subarray(u,u+1))!=="\0";)n+=Qs(a.subarray(u,u+1)),u+=1;n+=Qs(a.subarray(u,u+1)),u+=1}const f=a.subarray(u,a.byteLength);return{schemeIdUri:s,value:n,timeScale:i,presentationTime:o,presentationTimeDelta:l,eventDuration:d,id:h,payload:f}}function S5(a,...e){const s=e.length;let n=8,i=s;for(;i--;)n+=e[i].byteLength;const l=new Uint8Array(n);for(l[0]=n>>24&255,l[1]=n>>16&255,l[2]=n>>8&255,l[3]=n&255,l.set(a,4),i=0,n=8;i<s;i++)l.set(e[i],n),n+=e[i].byteLength;return l}function j5(a,e,s){if(a.byteLength!==16)throw new RangeError("Invalid system id");let n,i;n=0,i=new Uint8Array;let l;n>0?(l=new Uint8Array(4),e.length>0&&new DataView(l.buffer).setUint32(0,e.length,!1)):l=new Uint8Array;const o=new Uint8Array(4);return s.byteLength>0&&new DataView(o.buffer).setUint32(0,s.byteLength,!1),S5([112,115,115,104],new Uint8Array([n,0,0,0]),a,l,i,o,s)}function E5(a){const e=[];if(a instanceof ArrayBuffer){const s=a.byteLength;let n=0;for(;n+32<s;){const i=new DataView(a,n),l=T5(i);e.push(l),n+=l.size}}return e}function T5(a){const e=a.getUint32(0),s=a.byteOffset,n=a.byteLength;if(n<e)return{offset:s,size:n};if(a.getUint32(4)!==1886614376)return{offset:s,size:e};const l=a.getUint32(8)>>>24;if(l!==0&&l!==1)return{offset:s,size:e};const o=a.buffer,d=ca(new Uint8Array(o,s+12,16));let h=null,u=null,f=0;if(l===0)f=28;else{const p=a.getUint32(28);if(!p||n<32+p*16)return{offset:s,size:e};h=[];for(let b=0;b<p;b++)h.push(new Uint8Array(o,s+32+b*16,16));f=32+p*16}if(!f)return{offset:s,size:e};const g=a.getUint32(f);return e-32<g?{offset:s,size:e}:(u=new Uint8Array(o,s+f+4,g),{version:l,systemId:d,kids:h,data:u,offset:s,size:e})}const Kw=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),So={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Sp(a,e){const s=So[e];return!!s&&!!s[a.slice(0,4)]}function qc(a,e,s=!0){return!a.split(",").some(n=>!jp(n,e,s))}function jp(a,e,s=!0){var n;const i=Ar(s);return(n=i?.isTypeSupported(Kc(a,e)))!=null?n:!1}function Kc(a,e){return`${e}/mp4;codecs=${a}`}function S_(a){if(a){const e=a.substring(0,4);return So.video[e]}return 2}function Nh(a){const e=Kw();return a.split(",").reduce((s,n)=>{const l=e&&Xh(n)?9:So.video[n];return l?(l*2+s)/(s?3:2):(So.audio[n]+s)/(s?2:1)},0)}const bg={};function A5(a,e=!0){if(bg[a])return bg[a];const s={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[a];for(let i=0;i<s.length;i++){var n;if(jp(s[i],"audio",e))return bg[a]=s[i],s[i];if(s[i]==="mp3"&&(n=Ar(e))!=null&&n.isTypeSupported("audio/mpeg"))return""}return a}const C5=/flac|opus|mp4a\.40\.34/i;function wh(a,e=!0){return a.replace(C5,s=>A5(s.toLowerCase(),e))}function k5(a,e){const s=[];if(a){const n=a.split(",");for(let i=0;i<n.length;i++)Sp(n[i],"video")||s.push(n[i])}return e&&s.push(e),s.join(",")}function sh(a,e){if(a&&(a.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(a)!==-1)&&(j_(a,"audio")||j_(a,"video")))return a;if(e){const s=e.split(",");if(s.length>1){if(a){for(let n=s.length;n--;)if(s[n].substring(0,4)===a.substring(0,4))return s[n]}return s[0]}}return e||a}function j_(a,e){return Sp(a,e)&&jp(a,e)}function R5(a){const e=a.split(",");for(let s=0;s<e.length;s++){const n=e[s].split(".");n.length>2&&n[0]==="avc1"&&(e[s]=`avc1.${parseInt(n[1]).toString(16)}${("000"+parseInt(n[2]).toString(16)).slice(-4)}`)}return e.join(",")}function L5(a){if(a.startsWith("av01.")){const e=a.split("."),s=["0","111","01","01","01","0"];for(let n=e.length;n>4&&n<10;n++)e[n]=s[n-4];return e.join(".")}return a}function E_(a){const e=Ar(a)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function w0(a){return a.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const D5={supported:!0,powerEfficient:!0,smooth:!0},M5={supported:!1,smooth:!1,powerEfficient:!1},Hw={supported:!0,configurations:[],decodingInfoResults:[D5]};function zw(a,e){return{supported:!1,configurations:e,decodingInfoResults:[M5],error:a}}function I5(a,e,s,n,i,l){const o=a.videoCodec,d=a.audioCodec?a.audioGroups:null,h=l?.audioCodec,u=l?.channels,f=u?parseInt(u):h?1/0:2;let g=null;if(d!=null&&d.length)try{d.length===1&&d[0]?g=e.groups[d[0]].channels:g=d.reduce((p,b)=>{if(b){const y=e.groups[b];if(!y)throw new Error(`Audio track group ${b} not found`);Object.keys(y.channels).forEach(v=>{p[v]=(p[v]||0)+y.channels[v]})}return p},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(p=>Xh(p))||a.width>1920&&a.height>1088||a.height>1920&&a.width>1088||a.frameRate>Math.max(n,30)||a.videoRange!=="SDR"&&a.videoRange!==s||a.bitrate>Math.max(i,8e6))||!!g&&Ze(f)&&Object.keys(g).some(p=>parseInt(p)>f)}function Yw(a,e,s,n={}){const i=a.videoCodec;if(!i&&!a.audioCodec||!s)return Promise.resolve(Hw);const l=[],o=P5(a),d=o.length,h=O5(a,e,d>0),u=h.length;for(let f=d||1*u||1;f--;){const g={type:"media-source"};if(d&&(g.video=o[f%d]),u){g.audio=h[f%u];const p=g.audio.bitrate;g.video&&p&&(g.video.bitrate-=p)}l.push(g)}if(i){const f=navigator.userAgent;if(i.split(",").some(g=>Xh(g))&&Kw())return Promise.resolve(zw(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${f})`),l))}return Promise.all(l.map(f=>{const g=B5(f);return n[g]||(n[g]=s.decodingInfo(f))})).then(f=>({supported:!f.some(g=>!g.supported),configurations:l,decodingInfoResults:f})).catch(f=>({supported:!1,configurations:l,decodingInfoResults:[],error:f}))}function P5(a){var e;const s=(e=a.videoCodec)==null?void 0:e.split(","),n=Ww(a),i=a.width||640,l=a.height||480,o=a.frameRate||30,d=a.videoRange.toLowerCase();return s?s.map(h=>{const u={contentType:Kc(L5(h),"video"),width:i,height:l,bitrate:n,framerate:o};return d!=="sdr"&&(u.transferFunction=d),u}):[]}function O5(a,e,s){var n;const i=(n=a.audioCodec)==null?void 0:n.split(","),l=Ww(a);return i&&a.audioGroups?a.audioGroups.reduce((o,d)=>{var h;const u=d?(h=e.groups[d])==null?void 0:h.tracks:null;return u?u.reduce((f,g)=>{if(g.groupId===d){const p=parseFloat(g.channels||"");i.forEach(b=>{const y={contentType:Kc(b,"audio"),bitrate:s?F5(b,l):l};p&&(y.channels=""+p),f.push(y)})}return f},o):o},[]):[]}function F5(a,e){if(e<=1)return 1;let s=128e3;return a==="ec-3"?s=768e3:a==="ac-3"&&(s=64e4),Math.min(e/2,s)}function Ww(a){return Math.ceil(Math.max(a.bitrate*.9,a.averageBitrate)/1e3)*1e3||1}function B5(a){let e="";const{audio:s,video:n}=a;if(n){const i=w0(n.contentType);e+=`${i}_r${n.height}x${n.width}f${Math.ceil(n.framerate)}${n.transferFunction||"sd"}_${Math.ceil(n.bitrate/1e5)}`}if(s){const i=w0(s.contentType);e+=`${n?"_":""}${i}_c${s.channels}`}return e}const S0=["NONE","TYPE-0","TYPE-1",null];function U5(a){return S0.indexOf(a)>-1}const Sh=["SDR","PQ","HLG"];function $5(a){return!!a&&Sh.indexOf(a)>-1}var ah={No:"",Yes:"YES",v2:"v2"};function T_(a){const{canSkipUntil:e,canSkipDateRanges:s,age:n}=a,i=n<e/2;return e&&i?s?ah.v2:ah.Yes:ah.No}class A_{constructor(e,s,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=s,this.skip=n}addDirectives(e){const s=new self.URL(e);return this.msn!==void 0&&s.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&s.searchParams.set("_HLS_part",this.part.toString()),this.skip&&s.searchParams.set("_HLS_skip",this.skip),s.href}}class Hc{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(n=>!!n).map(n=>n.substring(0,4)).join(","),"supplemental"in e){var s;this.supplemental=e.supplemental;const n=(s=e.supplemental)==null?void 0:s.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=`,${n.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return C_(this._audioGroups,e)}hasSubtitleGroup(e){return C_(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,s){if(s){if(e==="audio"){let n=this._audioGroups;n||(n=this._audioGroups=[]),n.indexOf(s)===-1&&n.push(s)}else if(e==="text"){let n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(s)===-1&&n.push(s)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function C_(a,e){return!e||!a?!1:a.indexOf(e)!==-1}function G5(){if(typeof matchMedia=="function"){const a=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(a.media!==e.media)return a.matches===!0}return!1}function V5(a,e){let s=!1,n=[];if(a&&(s=a!=="SDR",n=[a]),e){n=e.allowedVideoRanges||Sh.slice(0);const i=n.join("")!=="SDR"&&!e.videoCodec;s=e.preferHDR!==void 0?e.preferHDR:i&&G5(),s||(n=["SDR"])}return{preferHDR:s,allowedVideoRanges:n}}const q5=a=>{const e=new WeakSet;return(s,n)=>{if(a&&(n=a(s,n)),typeof n=="object"&&n!==null){if(e.has(n))return;e.add(n)}return n}},ms=(a,e)=>JSON.stringify(a,q5(e));function K5(a,e,s,n,i){const l=Object.keys(a),o=n?.channels,d=n?.audioCodec,h=i?.videoCodec,u=o&&parseInt(o)===2;let f=!1,g=!1,p=1/0,b=1/0,y=1/0,v=1/0,_=0,N=[];const{preferHDR:C,allowedVideoRanges:T}=V5(e,i);for(let P=l.length;P--;){const I=a[l[P]];f||(f=I.channels[2]>0),p=Math.min(p,I.minHeight),b=Math.min(b,I.minFramerate),y=Math.min(y,I.minBitrate),T.filter(O=>I.videoRanges[O]>0).length>0&&(g=!0)}p=Ze(p)?p:0,b=Ze(b)?b:0;const L=Math.max(1080,p),F=Math.max(30,b);y=Ze(y)?y:s,s=Math.max(y,s),g||(e=void 0);const H=l.length>1;return{codecSet:l.reduce((P,I)=>{const D=a[I];if(I===P)return P;if(N=g?T.filter(O=>D.videoRanges[O]>0):[],H){if(D.minBitrate>s)return Yn(I,`min bitrate of ${D.minBitrate} > current estimate of ${s}`),P;if(!D.hasDefaultAudio)return Yn(I,"no renditions with default or auto-select sound found"),P;if(d&&I.indexOf(d.substring(0,4))%5!==0)return Yn(I,`audio codec preference "${d}" not found`),P;if(o&&!u){if(!D.channels[o])return Yn(I,`no renditions with ${o} channel sound found (channels options: ${Object.keys(D.channels)})`),P}else if((!d||u)&&f&&D.channels[2]===0)return Yn(I,"no renditions with stereo sound found"),P;if(D.minHeight>L)return Yn(I,`min resolution of ${D.minHeight} > maximum of ${L}`),P;if(D.minFramerate>F)return Yn(I,`min framerate of ${D.minFramerate} > maximum of ${F}`),P;if(!N.some(O=>D.videoRanges[O]>0))return Yn(I,`no variants with VIDEO-RANGE of ${ms(N)} found`),P;if(h&&I.indexOf(h.substring(0,4))%5!==0)return Yn(I,`video codec preference "${h}" not found`),P;if(D.maxScore<_)return Yn(I,`max score of ${D.maxScore} < selected max of ${_}`),P}return P&&(Nh(I)>=Nh(P)||D.fragmentError>a[P].fragmentError)?P:(v=D.minIndex,_=D.maxScore,I)},void 0),videoRanges:N,preferHDR:C,minFramerate:b,minBitrate:y,minIndex:v}}function Yn(a,e){rs.log(`[abr] start candidates with "${a}" ignored because ${e}`)}function Qw(a){return a.reduce((e,s)=>{let n=e.groups[s.groupId];n||(n=e.groups[s.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(s);const i=s.channels||"2";return n.channels[i]=(n.channels[i]||0)+1,n.hasDefault=n.hasDefault||s.default,n.hasAutoSelect=n.hasAutoSelect||s.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function H5(a,e,s,n){return a.slice(s,n+1).reduce((i,l,o)=>{if(!l.codecSet)return i;const d=l.audioGroups;let h=i[l.codecSet];h||(i[l.codecSet]=h={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!d,fragmentError:0}),h.minBitrate=Math.min(h.minBitrate,l.bitrate);const u=Math.min(l.height,l.width);return h.minHeight=Math.min(h.minHeight,u),h.minFramerate=Math.min(h.minFramerate,l.frameRate),h.minIndex=Math.min(h.minIndex,o),h.maxScore=Math.max(h.maxScore,l.score),h.fragmentError+=l.fragmentError,h.videoRanges[l.videoRange]=(h.videoRanges[l.videoRange]||0)+1,d&&d.forEach(f=>{if(!f)return;const g=e.groups[f];g&&(h.hasDefaultAudio=h.hasDefaultAudio||e.hasDefaultAudio?g.hasDefault:g.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(g.channels).forEach(p=>{h.channels[p]=(h.channels[p]||0)+g.channels[p]}))}),i},{})}function k_(a){if(!a)return a;const{lang:e,assocLang:s,characteristics:n,channels:i,audioCodec:l}=a;return{lang:e,assocLang:s,characteristics:n,channels:i,audioCodec:l}}function Jn(a,e,s){if("attrs"in a){const n=e.indexOf(a);if(n!==-1)return n}for(let n=0;n<e.length;n++){const i=e[n];if(gl(a,i,s))return n}return-1}function gl(a,e,s){const{groupId:n,name:i,lang:l,assocLang:o,default:d}=a,h=a.forced;return(n===void 0||e.groupId===n)&&(i===void 0||e.name===i)&&(l===void 0||z5(l,e.lang))&&(l===void 0||e.assocLang===o)&&(d===void 0||e.default===d)&&(h===void 0||e.forced===h)&&(!("characteristics"in a)||Y5(a.characteristics||"",e.characteristics))&&(s===void 0||s(a,e))}function z5(a,e="--"){return a.length===e.length?a===e:a.startsWith(e)||e.startsWith(a)}function Y5(a,e=""){const s=a.split(","),n=e.split(",");return s.length===n.length&&!s.some(i=>n.indexOf(i)===-1)}function cl(a,e){const{audioCodec:s,channels:n}=a;return(s===void 0||(e.audioCodec||"").substring(0,4)===s.substring(0,4))&&(n===void 0||n===(e.channels||"2"))}function W5(a,e,s,n,i){const l=e[n],d=e.reduce((p,b,y)=>{const v=b.uri;return(p[v]||(p[v]=[])).push(y),p},{})[l.uri];d.length>1&&(n=Math.max.apply(Math,d));const h=l.videoRange,u=l.frameRate,f=l.codecSet.substring(0,4),g=R_(e,n,p=>{if(p.videoRange!==h||p.frameRate!==u||p.codecSet.substring(0,4)!==f)return!1;const b=p.audioGroups,y=s.filter(v=>!b||b.indexOf(v.groupId)!==-1);return Jn(a,y,i)>-1});return g>-1?g:R_(e,n,p=>{const b=p.audioGroups,y=s.filter(v=>!b||b.indexOf(v.groupId)!==-1);return Jn(a,y,i)>-1})}function R_(a,e,s){for(let n=e;n>-1;n--)if(s(a[n]))return n;for(let n=e+1;n<a.length;n++)if(s(a[n]))return n;return-1}function jh(a,e){var s;return!!a&&a!==((s=e.loadLevelObj)==null?void 0:s.uri)}class Q5 extends En{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=s=>{var n;const{fragCurrent:i,partCurrent:l,hls:o}=this,{autoLevelEnabled:d,media:h}=o;if(!i||!h)return;const u=performance.now(),f=l?l.stats:i.stats,g=l?l.duration:i.duration,p=u-f.loading.start,b=o.minAutoLevel,y=i.level,v=this._nextAutoLevel;if(f.aborted||f.loaded&&f.loaded===f.total||y<=b){this.clearTimer(),this._nextAutoLevel=-1;return}if(!d)return;const _=v>-1&&v!==y,N=!!s||_;if(!N&&(h.paused||!h.playbackRate||!h.readyState))return;const C=o.mainForwardBufferInfo;if(!N&&C===null)return;const T=this.bwEstimator.getEstimateTTFB(),L=Math.abs(h.playbackRate);if(p<=Math.max(T,1e3*(g/(L*2))))return;const F=C?C.len/L:0,H=f.loading.first?f.loading.first-f.loading.start:-1,B=f.loaded&&H>-1,P=this.getBwEstimate(),I=o.levels,D=I[y],O=Math.max(f.loaded,Math.round(g*(i.bitrate||D.averageBitrate)/8));let ee=B?p-H:p;ee<1&&B&&(ee=Math.min(p,f.loaded*8/P));const ie=B?f.loaded*1e3/ee:0,Z=T/1e3,z=ie?(O-f.loaded)/ie:O*8/P+Z;if(z<=F)return;const X=ie?ie*8:P,ae=((n=s?.details||this.hls.latestLevelDetails)==null?void 0:n.live)===!0,te=this.hls.config.abrBandWidthUpFactor;let W=Number.POSITIVE_INFINITY,K;for(K=y-1;K>b;K--){const be=I[K].maxBitrate,ye=!I[K].details||ae;if(W=this.getTimeToLoadFrag(Z,X,g*be,ye),W<Math.min(F,g+Z))break}if(W>=z||W>g*10)return;B?this.bwEstimator.sample(p-Math.min(T,H),f.loaded):this.bwEstimator.sampleTTFB(p);const q=I[K].maxBitrate;this.getBwEstimate()*te>q&&this.resetEstimator(q);const J=this.findBestLevel(q,b,K,0,F,1,1);J>-1&&(K=J),this.warn(`Fragment ${i.sn}${l?" part "+l.index:""} of level ${y} is loading too slowly;
      Fragment duration: ${i.duration.toFixed(3)}
      Time to underbuffer: ${F.toFixed(3)} s
      Estimated load time for current fragment: ${z.toFixed(3)} s
      Estimated load time for down switch fragment: ${W.toFixed(3)} s
      TTFB estimate: ${H|0} ms
      Current BW estimate: ${Ze(P)?P|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${K} @ ${q|0} bps`),o.nextLoadLevel=o.nextAutoLevel=K,this.clearTimer();const oe=()=>{if(this.clearTimer(),this.fragCurrent===i&&this.hls.loadLevel===K&&K>0){const be=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${K>0?"and switching down":""}
      Fragment duration: ${i.duration.toFixed(3)} s
      Time to underbuffer: ${be.toFixed(3)} s`),i.abortRequests(),this.fragCurrent=this.partCurrent=null,K>b){let ye=this.findBestLevel(this.hls.levels[b].bitrate,b,K,0,be,1,1);ye===-1&&(ye=b),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ye,this.resetEstimator(this.hls.levels[ye].bitrate)}}};_||z>W*2?oe():this.timer=self.setInterval(oe,W*1e3),o.trigger($.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:l,stats:f})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new t5(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.FRAG_LOADING,this.onFragLoading,this),e.on($.FRAG_LOADED,this.onFragLoaded,this),e.on($.FRAG_BUFFERED,this.onFragBuffered,this),e.on($.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on($.LEVEL_LOADED,this.onLevelLoaded,this),e.on($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on($.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on($.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.FRAG_LOADING,this.onFragLoading,this),e.off($.FRAG_LOADED,this.onFragLoaded,this),e.off($.FRAG_BUFFERED,this.onFragBuffered,this),e.off($.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off($.LEVEL_LOADED,this.onLevelLoaded,this),e.off($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off($.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off($.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,s){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,s){const n=s.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var i;this.fragCurrent=n,this.partCurrent=(i=s.part)!=null?i:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,s){this.clearTimer()}onError(e,s){if(!s.fatal)switch(s.details){case Ne.BUFFER_ADD_CODEC_ERROR:case Ne.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Ne.FRAG_LOAD_TIMEOUT:{const n=s.frag,{fragCurrent:i,partCurrent:l}=this;if(n&&i&&n.sn===i.sn&&n.level===i.level){const o=performance.now(),d=l?l.stats:n.stats,h=o-d.loading.start,u=d.loading.first?d.loading.first-d.loading.start:-1;if(d.loaded&&u>-1){const g=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(h-Math.min(g,u),d.loaded)}else this.bwEstimator.sampleTTFB(h)}break}}}getTimeToLoadFrag(e,s,n,i){const l=e+n/s,o=i?e+this.lastLevelLoadSec:0;return l+o}onLevelLoaded(e,s){const n=this.hls.config,{loading:i}=s.stats,l=i.end-i.first;Ze(l)&&(this.lastLevelLoadSec=l/1e3),s.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(s.levelInfo)}onFragLoaded(e,{frag:s,part:n}){const i=n?n.stats:s.stats;if(s.type===et.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(s)){if(this.clearTimer(),s.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const l=n?n.duration:s.duration,o=this.hls.levels[s.level],d=(o.loaded?o.loaded.bytes:0)+i.loaded,h=(o.loaded?o.loaded.duration:0)+l;o.loaded={bytes:d,duration:h},o.realBitrate=Math.round(8*d/h)}if(s.bitrateTest){const l={stats:i,frag:s,part:n,id:s.type};this.onFragBuffered($.FRAG_BUFFERED,l),s.bitrateTest=!1}else this.lastLoadedFragLevel=s.level}}onFragBuffered(e,s){const{frag:n,part:i}=s,l=i!=null&&i.stats.loaded?i.stats:n.stats;if(l.aborted||this.ignoreFragment(n))return;const o=l.parsing.end-l.loading.start-Math.min(l.loading.first-l.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,l.loaded),l.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==et.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:s}=this.hls,n=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,l=this.findBestLevel(n,s,e,0,i,1,1);if(l>-1)return l;const o=this.hls.firstLevel,d=Math.min(Math.max(o,s),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${d}`),d}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,n=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(e!==-1&&(!n||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const l=n&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,l)&&o[e].loadError<=o[l].loadError)return e}return this._nextAutoLevel=l,this.nextAutoLevelKey=this.getAutoLevelKey(),l}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:s,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:i,config:l,minAutoLevel:o}=n,d=s?s.duration:e?e.duration:0,h=this.getBwEstimate(),u=this.getStarvationDelay();let f=l.abrBandWidthFactor,g=l.abrBandWidthUpFactor;if(u){const _=this.findBestLevel(h,o,i,u,0,f,g);if(_>=0)return this.rebufferNotice=-1,_}let p=d?Math.min(d,l.maxStarvationDelay):l.maxStarvationDelay;if(!u){const _=this.bitrateTestDelay;_&&(p=(d?Math.min(d,l.maxLoadingDelay):l.maxLoadingDelay)-_,this.info(`bitrate test took ${Math.round(1e3*_)}ms, set first fragment max fetchDuration to ${Math.round(1e3*p)} ms`),f=g=1)}const b=this.findBestLevel(h,o,i,u,p,f,g);if(this.rebufferNotice!==b&&(this.rebufferNotice=b,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${b}`)),b>-1)return b;const y=n.levels[o],v=n.loadLevelObj;return v&&y?.bitrate<v.bitrate?o:n.loadLevel}getStarvationDelay(){const e=this.hls,s=e.media;if(!s)return 1/0;const n=s&&s.playbackRate!==0?Math.abs(s.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,s,n,i,l,o,d){var h;const u=i+l,f=this.lastLoadedFragLevel,g=f===-1?this.hls.firstLevel:f,{fragCurrent:p,partCurrent:b}=this,{levels:y,allAudioTracks:v,loadLevel:_,config:N}=this.hls;if(y.length===1)return 0;const C=y[g],T=!!((h=this.hls.latestLevelDetails)!=null&&h.live),L=_===-1||f===-1;let F,H="SDR",B=C?.frameRate||0;const{audioPreference:P,videoPreference:I}=N,D=this.audioTracksByGroup||(this.audioTracksByGroup=Qw(v));let O=-1;if(L){if(this.firstSelection!==-1)return this.firstSelection;const X=this.codecTiers||(this.codecTiers=H5(y,D,s,n)),ae=K5(X,H,e,P,I),{codecSet:te,videoRanges:W,minFramerate:K,minBitrate:q,minIndex:J,preferHDR:oe}=ae;O=J,F=te,H=oe?W[W.length-1]:W[0],B=K,e=Math.max(e,q),this.log(`picked start tier ${ms(ae)}`)}else F=C?.codecSet,H=C?.videoRange;const ee=b?b.duration:p?p.duration:0,ie=this.bwEstimator.getEstimateTTFB()/1e3,Z=[];for(let X=n;X>=s;X--){var z;const ae=y[X],te=X>g;if(!ae)continue;if(N.useMediaCapabilities&&!ae.supportedResult&&!ae.supportedPromise){const ye=navigator.mediaCapabilities;typeof ye?.decodingInfo=="function"&&I5(ae,D,H,B,e,P)?(ae.supportedPromise=Yw(ae,D,ye,this.supportedCache),ae.supportedPromise.then(Ee=>{if(!this.hls)return;ae.supportedResult=Ee;const re=this.hls.levels,fe=re.indexOf(ae);Ee.error?this.warn(`MediaCapabilities decodingInfo error: "${Ee.error}" for level ${fe} ${ms(Ee)}`):Ee.supported?Ee.decodingInfoResults.some(Le=>Le.smooth===!1||Le.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${fe} not smooth or powerEfficient: ${ms(Ee)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${fe} ${ms(Ee)}`),fe>-1&&re.length>1&&(this.log(`Removing unsupported level ${fe}`),this.hls.removeLevel(fe),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(Ee=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${Ee}`)})):ae.supportedResult=Hw}if((F&&ae.codecSet!==F||H&&ae.videoRange!==H||te&&B>ae.frameRate||!te&&B>0&&B<ae.frameRate||(z=ae.supportedResult)!=null&&(z=z.decodingInfoResults)!=null&&z.some(ye=>ye.smooth===!1))&&(!L||X!==O)){Z.push(X);continue}const W=ae.details,K=(b?W?.partTarget:W?.averagetargetduration)||ee;let q;te?q=d*e:q=o*e;const J=ee&&i>=ee*2&&l===0?ae.averageBitrate:ae.maxBitrate,oe=this.getTimeToLoadFrag(ie,q,J*K,W===void 0);if(q>=J&&(X===f||ae.loadError===0&&ae.fragmentError===0)&&(oe<=ie||!Ze(oe)||T&&!this.bitrateTestDelay||oe<u)){const ye=this.forcedAutoLevel;return X!==_&&(ye===-1||ye!==_)&&(Z.length&&this.trace(`Skipped level(s) ${Z.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${y[Z[0]].codecs}" ${y[Z[0]].videoRange}; not compatible with "${F}" ${H}`),this.info(`switch candidate:${g}->${X} adjustedbw(${Math.round(q)})-bitrate=${Math.round(q-J)} ttfb:${ie.toFixed(1)} avgDuration:${K.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${oe.toFixed(1)} firstSelection:${L} codecSet:${ae.codecSet} videoRange:${ae.videoRange} hls.loadLevel:${_}`)),L&&(this.firstSelection=X),X}}return-1}set nextAutoLevel(e){const s=this.deriveNextAutoLevel(e);this._nextAutoLevel!==s&&(this.nextAutoLevelKey="",this._nextAutoLevel=s)}deriveNextAutoLevel(e){const{maxAutoLevel:s,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),s)}}const Xw={search:function(a,e){let s=0,n=a.length-1,i=null,l=null;for(;s<=n;){i=(s+n)/2|0,l=a[i];const o=e(l);if(o>0)s=i+1;else if(o<0)n=i-1;else return l}return null}};function X5(a,e,s){if(e===null||!Array.isArray(a)||!a.length||!Ze(e))return null;const n=a[0].programDateTime;if(e<(n||0))return null;const i=a[a.length-1].endProgramDateTime;if(e>=(i||0))return null;for(let l=0;l<a.length;++l){const o=a[l];if(Z5(e,s,o))return o}return null}function vl(a,e,s=0,n=0,i=.005){let l=null;if(a){l=e[1+a.sn-e[0].sn]||null;const d=a.endDTS-s;d>0&&d<15e-7&&(s+=15e-7),l&&a.level!==l.level&&l.end<=a.end&&(l=e[2+a.sn-e[0].sn]||null)}else s===0&&e[0].start===0&&(l=e[0]);if(l&&((!a||a.level===l.level)&&L_(s,n,l)===0||J5(l,a,Math.min(i,n))))return l;const o=Xw.search(e,L_.bind(null,s,n));return o&&(o!==a||!l)?o:l}function J5(a,e,s){if(e&&e.start===0&&e.level<a.level&&(e.endPTS||0)>0){const n=e.tagList.reduce((i,l)=>(l[0]==="INF"&&(i+=parseFloat(l[1])),i),s);return a.start<=n}return!1}function L_(a=0,e=0,s){if(s.start<=a&&s.start+s.duration>a)return 0;const n=Math.min(e,s.duration+(s.deltaPTS?s.deltaPTS:0));return s.start+s.duration-n<=a?1:s.start-n>a&&s.start?-1:0}function Z5(a,e,s){const n=Math.min(e,s.duration+(s.deltaPTS?s.deltaPTS:0))*1e3;return(s.endProgramDateTime||0)-n>a}function Jw(a,e,s){if(a&&a.startCC<=e&&a.endCC>=e){let n=a.fragments;const{fragmentHint:i}=a;i&&(n=n.concat(i));let l;return Xw.search(n,o=>o.cc<e?1:o.cc>e?-1:(l=o,o.end<=s?1:o.start>s?-1:0)),l||null}return null}function Eh(a){switch(a.details){case Ne.FRAG_LOAD_TIMEOUT:case Ne.KEY_LOAD_TIMEOUT:case Ne.LEVEL_LOAD_TIMEOUT:case Ne.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Zw(a){return a.details.startsWith("key")}function eS(a){return Zw(a)&&!!a.frag&&!a.frag.decryptdata}function D_(a,e){const s=Eh(e);return a.default[`${s?"timeout":"error"}Retry`]}function Ep(a,e){const s=a.backoff==="linear"?1:Math.pow(2,e);return Math.min(s*a.retryDelayMs,a.maxRetryDelayMs)}function M_(a){return is(is({},a),{errorRetry:null,timeoutRetry:null})}function Th(a,e,s,n){if(!a)return!1;const i=n?.code,l=e<a.maxNumRetry&&(eM(i)||!!s);return a.shouldRetry?a.shouldRetry(a,e,s,n,l):l}function eM(a){return j0(a)||!!a&&(a<400||a>499)}function j0(a){return a===0&&navigator.onLine===!1}var oa={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Ja={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class tM extends En{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on($.ERROR,this.onError,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off($.ERROR,this.onError,this),e.off($.ERROR,this.onErrorOut,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===et.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const s=this.hls,n=s.currentLevel;return(e=s.loadLevelObj)!=null&&e.details||n===-1?s.loadLevel:n}variantHasKey(e,s){if(e){var n;if((n=e.details)!=null&&n.hasKey(s))return!0;const i=e.audioGroups;if(i)return this.hls.allAudioTracks.filter(o=>i.indexOf(o.groupId)>=0).some(o=>{var d;return(d=o.details)==null?void 0:d.hasKey(s)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,s){var n;if(s.fatal)return;const i=this.hls,l=s.context;switch(s.details){case Ne.FRAG_LOAD_ERROR:case Ne.FRAG_LOAD_TIMEOUT:case Ne.KEY_LOAD_ERROR:case Ne.KEY_LOAD_TIMEOUT:s.errorAction=this.getFragRetryOrSwitchAction(s);return;case Ne.FRAG_PARSING_ERROR:if((n=s.frag)!=null&&n.gap){s.errorAction=go();return}case Ne.FRAG_GAP:case Ne.FRAG_DECRYPT_ERROR:{s.errorAction=this.getFragRetryOrSwitchAction(s),s.errorAction.action=oa.SendAlternateToPenaltyBox;return}case Ne.LEVEL_EMPTY_ERROR:case Ne.LEVEL_PARSING_ERROR:{var o;const h=s.parent===et.MAIN?s.level:i.loadLevel;s.details===Ne.LEVEL_EMPTY_ERROR&&((o=s.context)!=null&&(o=o.levelDetails)!=null&&o.live)?s.errorAction=this.getPlaylistRetryOrSwitchAction(s,h):(s.levelRetry=!1,s.errorAction=this.getLevelSwitchAction(s,h))}return;case Ne.LEVEL_LOAD_ERROR:case Ne.LEVEL_LOAD_TIMEOUT:typeof l?.level=="number"&&(s.errorAction=this.getPlaylistRetryOrSwitchAction(s,l.level));return;case Ne.AUDIO_TRACK_LOAD_ERROR:case Ne.AUDIO_TRACK_LOAD_TIMEOUT:case Ne.SUBTITLE_LOAD_ERROR:case Ne.SUBTITLE_TRACK_LOAD_TIMEOUT:if(l){const h=i.loadLevelObj;if(h&&(l.type===It.AUDIO_TRACK&&h.hasAudioGroup(l.groupId)||l.type===It.SUBTITLE_TRACK&&h.hasSubtitleGroup(l.groupId))){s.errorAction=this.getPlaylistRetryOrSwitchAction(s,i.loadLevel),s.errorAction.action=oa.SendAlternateToPenaltyBox,s.errorAction.flags=Ja.MoveAllAlternatesMatchingHost;return}}return;case Ne.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:s.errorAction={action:oa.SendAlternateToPenaltyBox,flags:Ja.MoveAllAlternatesMatchingHDCP};return;case Ne.KEY_SYSTEM_SESSION_UPDATE_FAILED:case Ne.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case Ne.KEY_SYSTEM_NO_SESSION:s.errorAction={action:oa.SendAlternateToPenaltyBox,flags:Ja.MoveAllAlternatesMatchingKey};return;case Ne.BUFFER_ADD_CODEC_ERROR:case Ne.REMUX_ALLOC_ERROR:case Ne.BUFFER_APPEND_ERROR:if(!s.errorAction){var d;s.errorAction=this.getLevelSwitchAction(s,(d=s.level)!=null?d:i.loadLevel)}return;case Ne.INTERNAL_EXCEPTION:case Ne.BUFFER_APPENDING_ERROR:case Ne.BUFFER_FULL_ERROR:case Ne.LEVEL_SWITCH_ERROR:case Ne.BUFFER_STALLED_ERROR:case Ne.BUFFER_SEEK_OVER_HOLE:case Ne.BUFFER_NUDGE_ON_STALL:s.errorAction=go();return}s.type===rt.KEY_SYSTEM_ERROR&&(s.levelRetry=!1,s.errorAction=go())}getPlaylistRetryOrSwitchAction(e,s){const n=this.hls,i=D_(n.config.playlistLoadPolicy,e),l=this.playlistError++;if(Th(i,l,Eh(e),e.response))return{action:oa.RetryRequest,flags:Ja.None,retryConfig:i,retryCount:l};const d=this.getLevelSwitchAction(e,s);return i&&(d.retryConfig=i,d.retryCount=l),d}getFragRetryOrSwitchAction(e){const s=this.hls,n=this.getVariantLevelIndex(e.frag),i=s.levels[n],{fragLoadPolicy:l,keyLoadPolicy:o}=s.config,d=D_(Zw(e)?o:l,e),h=s.levels.reduce((f,g)=>f+g.fragmentError,0);if(i&&(e.details!==Ne.FRAG_GAP&&i.fragmentError++,!eS(e)&&Th(d,h,Eh(e),e.response)))return{action:oa.RetryRequest,flags:Ja.None,retryConfig:d,retryCount:h};const u=this.getLevelSwitchAction(e,n);return d&&(u.retryConfig=d,u.retryCount=h),u}getLevelSwitchAction(e,s){const n=this.hls;s==null&&(s=n.loadLevel);const i=this.hls.levels[s];if(i){var l,o;const u=e.details;i.loadError++,u===Ne.BUFFER_APPEND_ERROR&&i.fragmentError++;let f=-1;const{levels:g,loadLevel:p,minAutoLevel:b,maxAutoLevel:y}=n;!n.autoLevelEnabled&&!n.config.preserveManualLevelOnError&&(n.loadLevel=-1);const v=(l=e.frag)==null?void 0:l.type,N=(v===et.AUDIO&&u===Ne.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===Ne.BUFFER_ADD_CODEC_ERROR||u===Ne.BUFFER_APPEND_ERROR))&&g.some(({audioCodec:H})=>i.audioCodec!==H),T=e.sourceBufferName==="video"&&(u===Ne.BUFFER_ADD_CODEC_ERROR||u===Ne.BUFFER_APPEND_ERROR)&&g.some(({codecSet:H,audioCodec:B})=>i.codecSet!==H&&i.audioCodec===B),{type:L,groupId:F}=(o=e.context)!=null?o:{};for(let H=g.length;H--;){const B=(H+p)%g.length;if(B!==p&&B>=b&&B<=y&&g[B].loadError===0){var d,h;const P=g[B];if(u===Ne.FRAG_GAP&&v===et.MAIN&&e.frag){const I=g[B].details;if(I){const D=vl(e.frag,I.fragments,e.frag.start);if(D!=null&&D.gap)continue}}else{if(L===It.AUDIO_TRACK&&P.hasAudioGroup(F)||L===It.SUBTITLE_TRACK&&P.hasSubtitleGroup(F))continue;if(v===et.AUDIO&&(d=i.audioGroups)!=null&&d.some(I=>P.hasAudioGroup(I))||v===et.SUBTITLE&&(h=i.subtitleGroups)!=null&&h.some(I=>P.hasSubtitleGroup(I))||N&&i.audioCodec===P.audioCodec||T&&i.codecSet===P.codecSet||!N&&i.codecSet!==P.codecSet)continue}f=B;break}}if(f>-1&&n.loadLevel!==f)return e.levelRetry=!0,this.playlistError=0,{action:oa.SendAlternateToPenaltyBox,flags:Ja.None,nextAutoLevel:f}}return{action:oa.SendAlternateToPenaltyBox,flags:Ja.MoveAllAlternatesMatchingHost}}onErrorOut(e,s){var n;switch((n=s.errorAction)==null?void 0:n.action){case oa.DoNothing:break;case oa.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(s),!s.errorAction.resolved&&s.details!==Ne.FRAG_GAP?s.fatal=!0:/MediaSource readyState: ended/.test(s.error.message)&&(this.warn(`MediaSource ended after "${s.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(s.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const s=this.hls,n=e.errorAction;if(!n)return;const{flags:i}=n,l=n.nextAutoLevel;switch(i){case Ja.None:this.switchLevel(e,l);break;case Ja.MoveAllAlternatesMatchingHDCP:{const h=this.getVariantLevelIndex(e.frag),u=s.levels[h],f=u?.attrs["HDCP-LEVEL"];if(n.hdcpLevel=f,f==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(f){s.maxHdcpLevel=S0[S0.indexOf(f)-1],n.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${s.maxHdcpLevel}" or lower`);break}}case Ja.MoveAllAlternatesMatchingKey:{const h=e.decryptdata;if(h){const u=this.hls.levels,f=u.length;for(let p=f;p--;)if(this.variantHasKey(u[p],h)){var o,d;this.log(`Banned key found in level ${p} (${u[p].bitrate}bps) or audio group "${(o=u[p].audioGroups)==null?void 0:o.join(",")}" (${(d=e.frag)==null?void 0:d.type} fragment) ${ca(h.keyId||[])}`),u[p].fragmentError++,u[p].loadError++,this.log(`Removing level ${p} with key error (${e.error})`),this.hls.removeLevel(p)}const g=e.frag;if(this.hls.levels.length<f)n.resolved=!0;else if(g&&g.type!==et.MAIN){const p=g.decryptdata;p&&!h.matches(p)&&(n.resolved=!0)}}break}}n.resolved||this.switchLevel(e,l)}switchLevel(e,s){if(s!==void 0&&e.errorAction&&(this.warn(`switching to level ${s} after ${e.details}`),this.hls.nextAutoLevel=s,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Ne.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const n=w0(e.mimeType),i=this.hls.levels;for(let l=i.length;l--;)i[l][`${e.sourceBufferName}Codec`]===n&&(this.log(`Removing level ${l} for ${e.details} ("${n}" not supported)`),this.hls.removeLevel(l))}}}function go(a){const e={action:oa.DoNothing,flags:Ja.None};return a&&(e.resolved=!0),e}var Xs={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class sM{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.BUFFER_APPENDED,this.onBufferAppended,this),e.on($.FRAG_BUFFERED,this.onFragBuffered,this),e.on($.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.BUFFER_APPENDED,this.onBufferAppended,this),e.off($.FRAG_BUFFERED,this.onFragBuffered,this),e.off($.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,s){const n=this.activePartLists[s];if(n)for(let i=n.length;i--;){const l=n[i];if(!l)break;if(l.start<=e&&e<=l.end&&l.loaded)return l}return this.getBufferedFrag(e,s)}getBufferedFrag(e,s){return this.getFragAtPos(e,s,!0)}getFragAtPos(e,s,n){const{fragments:i}=this,l=Object.keys(i);for(let o=l.length;o--;){const d=i[l[o]];if(d?.body.type===s&&(!n||d.buffered)){const h=d.body;if(h.start<=e&&e<=h.end)return h}}return null}detectEvictedFragments(e,s,n,i,l){this.timeRanges&&(this.timeRanges[e]=s);const o=i?.fragment.sn||-1;Object.keys(this.fragments).forEach(d=>{const h=this.fragments[d];if(!h||o>=h.body.sn)return;if(!h.buffered&&(!h.loaded||l)){h.body.type===n&&this.removeFragment(h.body);return}const u=h.range[e];if(u){if(u.time.length===0){this.removeFragment(h.body);return}u.time.some(f=>{const g=!this.isTimeBuffered(f.startPTS,f.endPTS,s);return g&&this.removeFragment(h.body),g})}})}detectPartialFragments(e){const s=this.timeRanges;if(!s||e.frag.sn==="initSegment")return;const n=e.frag,i=so(n),l=this.fragments[i];if(!l||l.buffered&&n.gap)return;const o=!n.relurl;Object.keys(s).forEach(d=>{const h=n.elementaryStreams[d];if(!h)return;const u=s[d],f=o||h.partial===!0;l.range[d]=this.getBufferedTimes(n,e.part,f,u)}),l.loaded=null,Object.keys(l.range).length?(this.bufferedEnd(l,n),Au(l)||this.removeParts(n.sn-1,n.type)):this.removeFragment(l.body)}bufferedEnd(e,s){e.buffered=!0,(e.body.endList=s.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,s){const n=this.activePartLists[s];n&&(this.activePartLists[s]=I_(n,i=>i.fragment.sn>=e))}fragBuffered(e,s){const n=so(e);let i=this.fragments[n];!i&&s&&(i=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,this.bufferedEnd(i,e))}getBufferedTimes(e,s,n,i){const l={time:[],partial:n},o=e.start,d=e.end,h=e.minEndPTS||d,u=e.maxStartPTS||o;for(let f=0;f<i.length;f++){const g=i.start(f)-this.bufferPadding,p=i.end(f)+this.bufferPadding;if(u>=g&&h<=p){l.time.push({startPTS:Math.max(o,i.start(f)),endPTS:Math.min(d,i.end(f))});break}else if(o<p&&d>g){const b=Math.max(o,i.start(f)),y=Math.min(d,i.end(f));y>b&&(l.partial=!0,l.time.push({startPTS:b,endPTS:y}))}else if(d<=g)break}return l}getPartialFragment(e){let s=null,n,i,l,o=0;const{bufferPadding:d,fragments:h}=this;return Object.keys(h).forEach(u=>{const f=h[u];f&&Au(f)&&(i=f.body.start-d,l=f.body.end+d,e>=i&&e<=l&&(n=Math.min(e-i,l-e),o<=n&&(s=f.body,o=n)))}),s}isEndListAppended(e){const s=this.endListFragments[e];return s!==void 0&&(s.buffered||Au(s))}getState(e){const s=so(e),n=this.fragments[s];return n?n.buffered?Au(n)?Xs.PARTIAL:Xs.OK:Xs.APPENDING:Xs.NOT_LOADED}isTimeBuffered(e,s,n){let i,l;for(let o=0;o<n.length;o++){if(i=n.start(o)-this.bufferPadding,l=n.end(o)+this.bufferPadding,e>=i&&s<=l)return!0;if(s<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,s){if(s.frag.sn==="initSegment"||s.frag.bitrateTest)return;const n=s.frag,i=s.part?null:s,l=so(n);this.fragments[l]={body:n,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,s){const{frag:n,part:i,timeRanges:l,type:o}=s;if(n.sn==="initSegment")return;const d=n.type;if(i){let u=this.activePartLists[d];u||(this.activePartLists[d]=u=[]),u.push(i)}this.timeRanges=l;const h=l[o];this.detectEvictedFragments(o,h,d,i)}onFragBuffered(e,s){this.detectPartialFragments(s)}hasFragment(e){const s=so(e);return!!this.fragments[s]}hasFragments(e){const{fragments:s}=this,n=Object.keys(s);if(!e)return n.length>0;for(let i=n.length;i--;){const l=s[n[i]];if(l?.body.type===e)return!0}return!1}hasParts(e){var s;return!!((s=this.activePartLists[e])!=null&&s.length)}removeFragmentsInRange(e,s,n,i,l){i&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const d=this.fragments[o];if(!d)return;const h=d.body;h.type!==n||i&&!h.gap||h.start<s&&h.end>e&&(d.buffered||l)&&this.removeFragment(h)})}removeFragment(e){const s=so(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const i=e.sn;this.activePartLists[e.type]=I_(n,l=>l.fragment.sn!==i)}delete this.fragments[s],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const s=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;s&&s.forEach(n=>n.clearElementaryStreamInfo())}}function Au(a){var e,s,n;return a.buffered&&!!(a.body.gap||(e=a.range.video)!=null&&e.partial||(s=a.range.audio)!=null&&s.partial||(n=a.range.audiovideo)!=null&&n.partial)}function so(a){return`${a.type}_${a.level}_${a.sn}`}function I_(a,e){return a.filter(s=>{const n=e(s);return n||s.clearElementaryStreamInfo(),n})}var Cr={cbc:0,ctr:1};class aM{constructor(e,s,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=s,this.aesMode=n}decrypt(e,s){switch(this.aesMode){case Cr.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},s,e);case Cr.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},s,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function nM(a){const e=a.byteLength,s=e&&new DataView(a.buffer).getUint8(e-1);return s?a.slice(0,e-s):a}class iM{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const s=new DataView(e),n=new Uint32Array(4);for(let i=0;i<4;i++)n[i]=s.getUint32(i*4);return n}initTable(){const e=this.sBox,s=this.invSBox,n=this.subMix,i=n[0],l=n[1],o=n[2],d=n[3],h=this.invSubMix,u=h[0],f=h[1],g=h[2],p=h[3],b=new Uint32Array(256);let y=0,v=0,_=0;for(_=0;_<256;_++)_<128?b[_]=_<<1:b[_]=_<<1^283;for(_=0;_<256;_++){let N=v^v<<1^v<<2^v<<3^v<<4;N=N>>>8^N&255^99,e[y]=N,s[N]=y;const C=b[y],T=b[C],L=b[T];let F=b[N]*257^N*16843008;i[y]=F<<24|F>>>8,l[y]=F<<16|F>>>16,o[y]=F<<8|F>>>24,d[y]=F,F=L*16843009^T*65537^C*257^y*16843008,u[N]=F<<24|F>>>8,f[N]=F<<16|F>>>16,g[N]=F<<8|F>>>24,p[N]=F,y?(y=C^b[b[b[L^C]]],v^=b[b[v]]):y=v=1}}expandKey(e){const s=this.uint8ArrayToUint32Array_(e);let n=!0,i=0;for(;i<s.length&&n;)n=s[i]===this.key[i],i++;if(n)return;this.key=s;const l=this.keySize=s.length;if(l!==4&&l!==6&&l!==8)throw new Error("Invalid aes key size="+l);const o=this.ksRows=(l+6+1)*4;let d,h;const u=this.keySchedule=new Uint32Array(o),f=this.invKeySchedule=new Uint32Array(o),g=this.sBox,p=this.rcon,b=this.invSubMix,y=b[0],v=b[1],_=b[2],N=b[3];let C,T;for(d=0;d<o;d++){if(d<l){C=u[d]=s[d];continue}T=C,d%l===0?(T=T<<8|T>>>24,T=g[T>>>24]<<24|g[T>>>16&255]<<16|g[T>>>8&255]<<8|g[T&255],T^=p[d/l|0]<<24):l>6&&d%l===4&&(T=g[T>>>24]<<24|g[T>>>16&255]<<16|g[T>>>8&255]<<8|g[T&255]),u[d]=C=(u[d-l]^T)>>>0}for(h=0;h<o;h++)d=o-h,h&3?T=u[d]:T=u[d-4],h<4||d<=4?f[h]=T:f[h]=y[g[T>>>24]]^v[g[T>>>16&255]]^_[g[T>>>8&255]]^N[g[T&255]],f[h]=f[h]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,s,n){const i=this.keySize+6,l=this.invKeySchedule,o=this.invSBox,d=this.invSubMix,h=d[0],u=d[1],f=d[2],g=d[3],p=this.uint8ArrayToUint32Array_(n);let b=p[0],y=p[1],v=p[2],_=p[3];const N=new Int32Array(e),C=new Int32Array(N.length);let T,L,F,H,B,P,I,D,O,ee,ie,Z,z,X;const ae=this.networkToHostOrderSwap;for(;s<N.length;){for(O=ae(N[s]),ee=ae(N[s+1]),ie=ae(N[s+2]),Z=ae(N[s+3]),B=O^l[0],P=Z^l[1],I=ie^l[2],D=ee^l[3],z=4,X=1;X<i;X++)T=h[B>>>24]^u[P>>16&255]^f[I>>8&255]^g[D&255]^l[z],L=h[P>>>24]^u[I>>16&255]^f[D>>8&255]^g[B&255]^l[z+1],F=h[I>>>24]^u[D>>16&255]^f[B>>8&255]^g[P&255]^l[z+2],H=h[D>>>24]^u[B>>16&255]^f[P>>8&255]^g[I&255]^l[z+3],B=T,P=L,I=F,D=H,z=z+4;T=o[B>>>24]<<24^o[P>>16&255]<<16^o[I>>8&255]<<8^o[D&255]^l[z],L=o[P>>>24]<<24^o[I>>16&255]<<16^o[D>>8&255]<<8^o[B&255]^l[z+1],F=o[I>>>24]<<24^o[D>>16&255]<<16^o[B>>8&255]<<8^o[P&255]^l[z+2],H=o[D>>>24]<<24^o[B>>16&255]<<16^o[P>>8&255]<<8^o[I&255]^l[z+3],C[s]=ae(T^b),C[s+1]=ae(H^y),C[s+2]=ae(F^v),C[s+3]=ae(L^_),b=O,y=ee,v=ie,_=Z,s=s+4}return C.buffer}}class rM{constructor(e,s,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=s,this.aesMode=n}expandKey(){const e=lM(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function lM(a){switch(a){case Cr.cbc:return"AES-CBC";case Cr.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${a}`)}}const oM=16;class Tp{constructor(e,{removePKCS7Padding:s=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=s,s)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:s}=this;if(!e||s)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?nM(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,s,n,i){return this.useSoftware?new Promise((l,o)=>{const d=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(d,s,n,i);const h=this.flush();h?l(h.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),s,n,i)}softwareDecrypt(e,s,n,i){const{currentIV:l,currentResult:o,remainderData:d}=this;if(i!==Cr.cbc||s.byteLength!==16)return rs.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),d&&(e=wn(d,e),this.remainderData=null);const h=this.getValidChunk(e);if(!h.length)return null;l&&(n=l);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new iM),u.expandKey(s);const f=o;return this.currentResult=u.decrypt(h.buffer,0,n),this.currentIV=h.slice(-16).buffer,f||null}webCryptoDecrypt(e,s,n,i){if(this.key!==s||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,s,n,i));this.key=s,this.fastAesKey=new rM(this.subtle,s,i)}return this.fastAesKey.expandKey().then(l=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new aM(this.subtle,new Uint8Array(n),i).decrypt(e.buffer,l)):Promise.reject(new Error("web crypto not initialized"))).catch(l=>(rs.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${l.name}: ${l.message}`),this.onWebCryptoError(e,s,n,i)))}onWebCryptoError(e,s,n,i){const l=this.enableSoftwareAES;if(l){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,s,n,i);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(l?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let s=e;const n=e.length-e.length%oM;return n!==e.length&&(s=e.slice(0,n),this.remainderData=e.slice(n)),s}logOnce(e){this.logEnabled&&(rs.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const P_=Math.pow(2,17);class cM{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,s){const n=e.url;if(!n)return Promise.reject(new Ai({type:rt.NETWORK_ERROR,details:Ne.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const i=this.config,l=i.fLoader,o=i.loader;return new Promise((d,h)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(y=>y[0]==="GAP")){h(F_(e));return}else e.gap=!1;const u=this.loader=l?new l(i):new o(i),f=O_(e);e.loader=u;const g=M_(i.fragLoadPolicy.default),p={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:P_};e.stats=u.stats;const b={onSuccess:(y,v,_,N)=>{this.resetLoader(e,u);let C=y.data;_.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(C.slice(0,16)),C=C.slice(16)),d({frag:e,part:null,payload:C,networkDetails:N})},onError:(y,v,_,N)=>{this.resetLoader(e,u),h(new Ai({type:rt.NETWORK_ERROR,details:Ne.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:is({url:n,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:_,stats:N}))},onAbort:(y,v,_)=>{this.resetLoader(e,u),h(new Ai({type:rt.NETWORK_ERROR,details:Ne.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:_,stats:y}))},onTimeout:(y,v,_)=>{this.resetLoader(e,u),h(new Ai({type:rt.NETWORK_ERROR,details:Ne.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:_,stats:y}))}};s&&(b.onProgress=(y,v,_,N)=>s({frag:e,part:null,payload:_,networkDetails:N})),u.load(f,p,b)})}loadPart(e,s,n){this.abort();const i=this.config,l=i.fLoader,o=i.loader;return new Promise((d,h)=>{if(this.loader&&this.loader.destroy(),e.gap||s.gap){h(F_(e,s));return}const u=this.loader=l?new l(i):new o(i),f=O_(e,s);e.loader=u;const g=M_(i.fragLoadPolicy.default),p={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:P_};s.stats=u.stats,u.load(f,p,{onSuccess:(b,y,v,_)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,s);const N={frag:e,part:s,payload:b.data,networkDetails:_};n(N),d(N)},onError:(b,y,v,_)=>{this.resetLoader(e,u),h(new Ai({type:rt.NETWORK_ERROR,details:Ne.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:s,response:is({url:f.url,data:void 0},b),error:new Error(`HTTP Error ${b.code} ${b.text}`),networkDetails:v,stats:_}))},onAbort:(b,y,v)=>{e.stats.aborted=s.stats.aborted,this.resetLoader(e,u),h(new Ai({type:rt.NETWORK_ERROR,details:Ne.INTERNAL_ABORTED,fatal:!1,frag:e,part:s,error:new Error("Aborted"),networkDetails:v,stats:b}))},onTimeout:(b,y,v)=>{this.resetLoader(e,u),h(new Ai({type:rt.NETWORK_ERROR,details:Ne.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:s,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:v,stats:b}))}})})}updateStatsFromPart(e,s){const n=e.stats,i=s.stats,l=i.total;if(n.loaded+=i.loaded,l){const h=Math.round(e.duration/s.duration),u=Math.min(Math.round(n.loaded/l),h),g=(h-u)*Math.round(n.loaded/u);n.total=n.loaded+g}else n.total=Math.max(n.loaded,n.total);const o=n.loading,d=i.loading;o.start?o.first+=d.first-d.start:(o.start=d.start,o.first=d.first),o.end=d.end}resetLoader(e,s){e.loader=null,this.loader===s&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),s.destroy()}}function O_(a,e=null){const s=e||a,n={frag:a,part:e,responseType:"arraybuffer",url:s.url,headers:{},rangeStart:0,rangeEnd:0},i=s.byteRangeStartOffset,l=s.byteRangeEndOffset;if(Ze(i)&&Ze(l)){var o;let d=i,h=l;if(a.sn==="initSegment"&&dM((o=a.decryptdata)==null?void 0:o.method)){const u=l-i;u%16&&(h=l+(16-u%16)),i!==0&&(n.resetIV=!0,d=i-16)}n.rangeStart=d,n.rangeEnd=h}return n}function F_(a,e){const s=new Error(`GAP ${a.gap?"tag":"attribute"} found`),n={type:rt.MEDIA_ERROR,details:Ne.FRAG_GAP,fatal:!1,frag:a,error:s,networkDetails:null};return e&&(n.part=e),(e||a).stats.aborted=!0,new Ai(n)}function dM(a){return a==="AES-128"||a==="AES-256"}class Ai extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class tS extends En{constructor(e,s){super(e,s),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Ap{constructor(e,s,n,i=0,l=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Cu(),this.buffering={audio:Cu(),video:Cu(),audiovideo:Cu()},this.level=e,this.sn=s,this.id=n,this.size=i,this.part=l,this.partial=o}}function Cu(){return{start:0,executeStart:0,executeEnd:0,end:0}}const B_={length:0,start:()=>0,end:()=>0};class St{static isBuffered(e,s){if(e){const n=St.getBuffered(e);for(let i=n.length;i--;)if(s>=n.start(i)&&s<=n.end(i))return!0}return!1}static bufferedRanges(e){if(e){const s=St.getBuffered(e);return St.timeRangesToArray(s)}return[]}static timeRangesToArray(e){const s=[];for(let n=0;n<e.length;n++)s.push({start:e.start(n),end:e.end(n)});return s}static bufferInfo(e,s,n){if(e){const i=St.bufferedRanges(e);if(i.length)return St.bufferedInfo(i,s,n)}return{len:0,start:s,end:s,bufferedIndex:-1}}static bufferedInfo(e,s,n){s=Math.max(0,s),e.length>1&&e.sort((f,g)=>f.start-g.start||g.end-f.end);let i=-1,l=[];if(n)for(let f=0;f<e.length;f++){s>=e[f].start&&s<=e[f].end&&(i=f);const g=l.length;if(g){const p=l[g-1].end;e[f].start-p<n?e[f].end>p&&(l[g-1].end=e[f].end):l.push(e[f])}else l.push(e[f])}else l=e;let o=0,d,h=s,u=s;for(let f=0;f<l.length;f++){const g=l[f].start,p=l[f].end;if(i===-1&&s>=g&&s<=p&&(i=f),s+n>=g&&s<p)h=g,u=p,o=u-s;else if(s+n<g){d=g;break}}return{len:o,start:h||0,end:u||0,nextStart:d,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||B_}catch(s){return rs.log("failed to get media.buffered",s),B_}}}const sS=/\{\$([a-zA-Z0-9-_]+)\}/g;function U_(a){return sS.test(a)}function E0(a,e){if(a.variableList!==null||a.hasVariableRefs){const s=a.variableList;return e.replace(sS,n=>{const i=n.substring(2,n.length-1),l=s?.[i];return l===void 0?(a.playlistParsingError||(a.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),n):l})}return e}function $_(a,e,s){let n=a.variableList;n||(a.variableList=n={});let i,l;if("QUERYPARAM"in e){i=e.QUERYPARAM;try{const o=new self.URL(s).searchParams;if(o.has(i))l=o.get(i);else throw new Error(`"${i}" does not match any query parameter in URI: "${s}"`)}catch(o){a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else i=e.NAME,l=e.VALUE;i in n?a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):n[i]=l||""}function uM(a,e,s){const n=e.IMPORT;if(s&&n in s){let i=a.variableList;i||(a.variableList=i={}),i[n]=s[n]}else a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const hM=/^(\d+)x(\d+)$/,G_=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Es{constructor(e,s){typeof e=="string"&&(e=Es.parseAttrList(e,s)),ds(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const s=parseInt(this[e],10);return s>Number.MAX_SAFE_INTEGER?1/0:s}hexadecimalInteger(e){if(this[e]){let s=(this[e]||"0x").slice(2);s=(s.length&1?"0":"")+s;const n=new Uint8Array(s.length/2);for(let i=0;i<s.length/2;i++)n[i]=parseInt(s.slice(i*2,i*2+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const s=parseInt(this[e],16);return s>Number.MAX_SAFE_INTEGER?1/0:s}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,s){const n=this[e];return n?parseFloat(n):s}enumeratedString(e){return this[e]}enumeratedStringList(e,s){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((i,l)=>(i[l.toLowerCase()]=!0,i),s)}bool(e){return this[e]==="YES"}decimalResolution(e){const s=hM.exec(this[e]);if(s!==null)return{width:parseInt(s[1],10),height:parseInt(s[2],10)}}static parseAttrList(e,s){let n;const i={};for(G_.lastIndex=0;(n=G_.exec(e))!==null;){const o=n[1].trim();let d=n[2];const h=d.indexOf('"')===0&&d.lastIndexOf('"')===d.length-1;let u=!1;if(h)d=d.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(s&&(h||u))d=E0(s,d);else if(!u&&!h)switch(o){case"CLOSED-CAPTIONS":if(d==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":rs.warn(`${e}: attribute ${o} is missing quotes`)}i[o]=d}return i}}const fM="com.apple.hls.interstitial";function mM(a){return a!=="ID"&&a!=="CLASS"&&a!=="CUE"&&a!=="START-DATE"&&a!=="DURATION"&&a!=="END-DATE"&&a!=="END-ON-NEXT"}function gM(a){return a==="SCTE35-OUT"||a==="SCTE35-IN"||a==="SCTE35-CMD"}class aS{constructor(e,s,n=0){var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=s?.tagAnchor||null,this.tagOrder=(i=s?.tagOrder)!=null?i:n,s){const l=s.attr;for(const o in l)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==l[o]){rs.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=ds(new Es({}),l,e)}if(this.attr=e,s?(this._startDate=s._startDate,this._cue=s._cue,this._endDate=s._endDate,this._dateAtEnd=s._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const l=s?.endDate||new Date(this.attr["END-DATE"]);Ze(l.getTime())&&(this._endDate=l)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(rs.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const s=this.duration;return s!==null?this._dateAtEnd=new Date(this._startDate.getTime()+s*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Ze(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===fM}get isValid(){return!!this.id&&!this._badValueForSameId&&Ze(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const pM=10;class xM{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const s=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!s||!this.live,this.advanced=this.endSN>e.endSN||s>0||s===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(s=>{let n=s.decryptdata;return n||(s.setKeyFormat(e.keyFormat),n=s.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return this.fragments.length?Ze(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||pM}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const s=this.lastPartIndex;if(s!==-1){for(let n=e.length;n--;)if(e[n].index>s)return e[n].index;return s}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Ah(a,e){return a.length===e.length?!a.some((s,n)=>s!==e[n]):!1}function V_(a,e){return!a&&!e?!0:!a||!e?!1:Ah(a,e)}function po(a){return a==="AES-128"||a==="AES-256"||a==="AES-256-CTR"}function Cp(a){switch(a){case"AES-128":case"AES-256":return Cr.cbc;case"AES-256-CTR":return Cr.ctr;default:throw new Error(`invalid full segment method ${a}`)}}function kp(a){return Uint8Array.from(atob(a),e=>e.charCodeAt(0))}function T0(a){return Uint8Array.from(unescape(encodeURIComponent(a)),e=>e.charCodeAt(0))}function yM(a){const e=T0(a).subarray(0,16),s=new Uint8Array(16);return s.set(e,16-e.length),s}function nS(a){const e=function(n,i,l){const o=n[i];n[i]=n[l],n[l]=o};e(a,0,3),e(a,1,2),e(a,4,5),e(a,6,7)}function iS(a){const e=a.split(":");let s=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),i=n[n.length-1].split(",");if(i.length===2){const l=i[0]==="base64",o=i[1];l?(n.splice(-1,1),s=kp(o)):s=yM(o)}}return s}const Ch=typeof self<"u"?self:void 0;var Ts={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},da={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function nh(a){switch(a){case da.FAIRPLAY:return Ts.FAIRPLAY;case da.PLAYREADY:return Ts.PLAYREADY;case da.WIDEVINE:return Ts.WIDEVINE;case da.CLEARKEY:return Ts.CLEARKEY}}function vg(a){switch(a){case Ts.FAIRPLAY:return da.FAIRPLAY;case Ts.PLAYREADY:return da.PLAYREADY;case Ts.WIDEVINE:return da.WIDEVINE;case Ts.CLEARKEY:return da.CLEARKEY}}function Dc(a){const{drmSystems:e,widevineLicenseUrl:s}=a,n=e?[Ts.FAIRPLAY,Ts.WIDEVINE,Ts.PLAYREADY,Ts.CLEARKEY].filter(i=>!!e[i]):[];return!n[Ts.WIDEVINE]&&s&&n.push(Ts.WIDEVINE),n}const rS=(function(a){return Ch!=null&&(a=Ch.navigator)!=null&&a.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function bM(a,e,s,n){let i;switch(a){case Ts.FAIRPLAY:i=["cenc","sinf"];break;case Ts.WIDEVINE:case Ts.PLAYREADY:i=["cenc"];break;case Ts.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${a}`)}return vM(i,e,s,n)}function vM(a,e,s,n){return[{initDataTypes:a,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(l=>({contentType:`audio/mp4; codecs=${l}`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:s.map(l=>({contentType:`video/mp4; codecs=${l}`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function _M(a){var e;return!!a&&(a.sessionType==="persistent-license"||!!((e=a.sessionTypes)!=null&&e.some(s=>s==="persistent-license")))}function lS(a){const e=new Uint16Array(a.buffer,a.byteOffset,a.byteLength/2),s=String.fromCharCode.apply(null,Array.from(e)),n=s.substring(s.indexOf("<"),s.length),o=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(o){const d=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(d){const h=kp(d).subarray(0,16);return nS(h),h}}return null}let ao={};class jr{static clearKeyUriToKeyIdMap(){ao={}}static setKeyIdForUri(e,s){ao[e]=s}static addKeyIdForUri(e){const s=Object.keys(ao).length%Number.MAX_SAFE_INTEGER,n=new Uint8Array(16);return new DataView(n.buffer,12,4).setUint32(0,s),ao[e]=n,n}constructor(e,s,n,i=[1],l=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=s,this.keyFormat=n,this.keyFormatVersions=i,this.iv=l,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!po(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(Iw(o)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Ah(e.keyFormatVersions,this.keyFormatVersions)&&V_(e.iv,this.iv)&&V_(e.keyId,this.keyId)}isSupported(){if(this.method){if(po(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case da.FAIRPLAY:case da.WIDEVINE:case da.PLAYREADY:case da.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,s){if(!this.encrypted||!this.uri)return null;if(po(this.method)){let l=this.iv;return l||(typeof e!="number"&&(rs.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),l=wM(e)),new jr(this.method,this.uri,"identity",this.keyFormatVersions,l)}if(this.keyId){const l=ao[this.uri];if(l&&!Ah(this.keyId,l)&&jr.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const n=iS(this.uri);if(n)switch(this.keyFormat){case da.WIDEVINE:if(this.pssh=n,!this.keyId){const l=E5(n.buffer);if(l.length){var i;const o=l[0];this.keyId=(i=o.kids)!=null&&i.length?o.kids[0]:null}}this.keyId||(this.keyId=q_(s));break;case da.PLAYREADY:{const l=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=j5(l,null,n),this.keyId=lS(n);break}default:{let l=n.subarray(0,16);if(l.length!==16){const o=new Uint8Array(16);o.set(l,16-l.length),l=o}this.keyId=l;break}}if(!this.keyId||this.keyId.byteLength!==16){let l;l=NM(s),l||(l=q_(s),l||(l=ao[this.uri])),l&&(this.keyId=l,jr.setKeyIdForUri(this.uri,l))}return this}}function NM(a){const e=a?.[da.WIDEVINE];return e?e.keyId:null}function q_(a){const e=a?.[da.PLAYREADY];if(e){const s=iS(e.uri);if(s)return lS(s)}return null}function wM(a){const e=new Uint8Array(16);for(let s=12;s<16;s++)e[s]=a>>8*(15-s)&255;return e}const K_=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,H_=/#EXT-X-MEDIA:(.*)/g,SM=/^#EXT(?:INF|-X-TARGETDURATION):/m,_g=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),jM=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Zn{static findGroup(e,s){for(let n=0;n<e.length;n++){const i=e[n];if(i.id===s)return i}}static resolve(e,s){return _p.buildAbsoluteURL(s,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return SM.test(e)}static parseMasterPlaylist(e,s){const n=U_(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},l=[];if(K_.lastIndex=0,!e.startsWith("#EXTM3U"))return i.playlistParsingError=new Error("no EXTM3U delimiter"),i;let o;for(;(o=K_.exec(e))!=null;)if(o[1]){var d;const u=new Es(o[1],i),f=E0(i,o[2]),g={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:Zn.resolve(f,s)},p=u.decimalResolution("RESOLUTION");p&&(g.width=p.width,g.height=p.height),W_(u.CODECS,g);const b=u["SUPPLEMENTAL-CODECS"];b&&(g.supplemental={},W_(b,g.supplemental)),(d=g.unknownCodecs)!=null&&d.length||l.push(g),i.levels.push(g)}else if(o[3]){const u=o[3],f=o[4];switch(u){case"SESSION-DATA":{const g=new Es(f,i),p=g["DATA-ID"];p&&(i.sessionData===null&&(i.sessionData={}),i.sessionData[p]=g);break}case"SESSION-KEY":{const g=z_(f,s,i);g.encrypted&&g.isSupported()?(i.sessionKeys===null&&(i.sessionKeys=[]),i.sessionKeys.push(g)):rs.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${f}"`);break}case"DEFINE":{{const g=new Es(f,i);$_(i,g,s)}break}case"CONTENT-STEERING":{const g=new Es(f,i);i.contentSteering={uri:Zn.resolve(g["SERVER-URI"],s),pathwayId:g["PATHWAY-ID"]||"."};break}case"START":{i.startTimeOffset=Y_(f);break}}}const h=l.length>0&&l.length<i.levels.length;return i.levels=h?l:i.levels,i.levels.length===0&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,s,n){let i;const l={},o=n.levels,d={AUDIO:o.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:o.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let h=0;for(H_.lastIndex=0;(i=H_.exec(e))!==null;){const u=new Es(i[1],n),f=u.TYPE;if(f){const g=d[f],p=l[f]||[];l[f]=p;const b=u.LANGUAGE,y=u["ASSOC-LANGUAGE"],v=u.CHANNELS,_=u.CHARACTERISTICS,N=u["INSTREAM-ID"],C={attrs:u,bitrate:0,id:h++,groupId:u["GROUP-ID"]||"",name:u.NAME||b||"",type:f,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:b,url:u.URI?Zn.resolve(u.URI,s):""};if(y&&(C.assocLang=y),v&&(C.channels=v),_&&(C.characteristics=_),N&&(C.instreamId=N),g!=null&&g.length){const T=Zn.findGroup(g,C.groupId)||g[0];Q_(C,T,"audioCodec"),Q_(C,T,"textCodec")}p.push(C)}}return l}static parseLevelPlaylist(e,s,n,i,l,o){var d;const h={url:s},u=new xM(s),f=u.fragments,g=[];let p=null,b=0,y=0,v=0,_=0,N=0,C=null,T=new xg(i,h),L,F,H,B=-1,P=!1,I=null,D;if(_g.lastIndex=0,u.m3u8=e,u.hasVariableRefs=U_(e),((d=_g.exec(e))==null?void 0:d[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(L=_g.exec(e))!==null;){P&&(P=!1,T=new xg(i,h),T.playlistOffset=v,T.setStart(v),T.sn=b,T.cc=_,N&&(T.bitrate=N),T.level=n,p&&(T.initSegment=p,p.rawProgramDateTime&&(T.rawProgramDateTime=p.rawProgramDateTime,p.rawProgramDateTime=null),I&&(T.setByteRange(I),I=null)));const Z=L[1];if(Z){T.duration=parseFloat(Z);const z=(" "+L[2]).slice(1);T.title=z||null,T.tagList.push(z?["INF",Z,z]:["INF",Z])}else if(L[3]){if(Ze(T.duration)){T.playlistOffset=v,T.setStart(v),H&&J_(T,H,u),T.sn=b,T.level=n,T.cc=_,f.push(T);const z=(" "+L[3]).slice(1);T.relurl=E0(u,z),A0(T,C,g),C=T,v+=T.duration,b++,y=0,P=!0}}else{if(L=L[0].match(jM),!L){rs.warn("No matches on slow regex match for level playlist!");continue}for(F=1;F<L.length&&L[F]===void 0;F++);const z=(" "+L[F]).slice(1),X=(" "+L[F+1]).slice(1),ae=L[F+2]?(" "+L[F+2]).slice(1):null;switch(z){case"BYTERANGE":C?T.setByteRange(X,C):T.setByteRange(X);break;case"PROGRAM-DATE-TIME":T.rawProgramDateTime=X,T.tagList.push(["PROGRAM-DATE-TIME",X]),B===-1&&(B=f.length);break;case"PLAYLIST-TYPE":u.type&&wi(u,z,L),u.type=X.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?wi(u,z,L):f.length>0&&Z_(u,z,L),b=u.startSN=parseInt(X);break;case"SKIP":{u.skippedSegments&&wi(u,z,L);const te=new Es(X,u),W=te.decimalInteger("SKIPPED-SEGMENTS");if(Ze(W)){u.skippedSegments+=W;for(let q=W;q--;)f.push(null);b+=W}const K=te.enumeratedString("RECENTLY-REMOVED-DATERANGES");K&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(K.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&wi(u,z,L),u.targetduration=Math.max(parseInt(X),1);break;case"VERSION":u.version!==null&&wi(u,z,L),u.version=parseInt(X);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||wi(u,z,L),u.live=!1;break;case"#":(X||ae)&&T.tagList.push(ae?[X,ae]:[X]);break;case"DISCONTINUITY":_++,T.tagList.push(["DIS"]);break;case"GAP":T.gap=!0,T.tagList.push([z]);break;case"BITRATE":T.tagList.push([z,X]),N=parseInt(X)*1e3,Ze(N)?T.bitrate=N:N=0;break;case"DATERANGE":{const te=new Es(X,u),W=new aS(te,u.dateRanges[te.ID],u.dateRangeTagCount);u.dateRangeTagCount++,W.isValid||u.skippedSegments?u.dateRanges[W.id]=W:rs.warn(`Ignoring invalid DATERANGE tag: "${X}"`),T.tagList.push(["EXT-X-DATERANGE",X]);break}case"DEFINE":{{const te=new Es(X,u);"IMPORT"in te?uM(u,te,o):$_(u,te,s)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?wi(u,z,L):f.length>0&&Z_(u,z,L),u.startCC=_=parseInt(X);break;case"KEY":{const te=z_(X,s,u);if(te.isSupported()){if(te.method==="NONE"){H=void 0;break}H||(H={});const W=H[te.keyFormat];W!=null&&W.matches(te)||(W&&(H=ds({},H)),H[te.keyFormat]=te)}else rs.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${X}"`);break}case"START":u.startTimeOffset=Y_(X);break;case"MAP":{const te=new Es(X,u);if(T.duration){const W=new xg(i,h);X_(W,te,n,H),p=W,T.initSegment=p,p.rawProgramDateTime&&!T.rawProgramDateTime&&(T.rawProgramDateTime=p.rawProgramDateTime)}else{const W=T.byteRangeEndOffset;if(W){const K=T.byteRangeStartOffset;I=`${W-K}@${K}`}else I=null;X_(T,te,n,H),p=T,P=!0}p.cc=_;break}case"SERVER-CONTROL":{D&&wi(u,z,L),D=new Es(X),u.canBlockReload=D.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=D.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&D.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=D.optionalFloat("PART-HOLD-BACK",0),u.holdBack=D.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&wi(u,z,L);const te=new Es(X);u.partTarget=te.decimalFloatingPoint("PART-TARGET");break}case"PART":{let te=u.partList;te||(te=u.partList=[]);const W=y>0?te[te.length-1]:void 0,K=y++,q=new Es(X,u),J=new u5(q,T,h,K,W);te.push(J),T.duration+=J.duration;break}case"PRELOAD-HINT":{const te=new Es(X,u);u.preloadHint=te;break}case"RENDITION-REPORT":{const te=new Es(X,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push(te);break}default:rs.warn(`line parsed but not handled: ${L}`);break}}}C&&!C.relurl?(f.pop(),v-=C.duration,u.partList&&(u.fragmentHint=C)):u.partList&&(A0(T,C,g),T.cc=_,u.fragmentHint=T,H&&J_(T,H,u)),u.targetduration||(u.playlistParsingError=new Error("Missing Target Duration"));const O=f.length,ee=f[0],ie=f[O-1];if(v+=u.skippedSegments*u.targetduration,v>0&&O&&ie){u.averagetargetduration=v/O;const Z=ie.sn;u.endSN=Z!=="initSegment"?Z:0,u.live||(ie.endList=!0),B>0&&(TM(f,B),ee&&g.unshift(ee))}return u.fragmentHint&&(v+=u.fragmentHint.duration),u.totalduration=v,g.length&&u.dateRangeTagCount&&ee&&oS(g,u),u.endCC=_,u}}function oS(a,e){let s=a.length;if(!s)if(e.hasProgramDateTime){const d=e.fragments[e.fragments.length-1];a.push(d),s++}else return;const n=a[s-1],i=e.live?1/0:e.totalduration,l=Object.keys(e.dateRanges);for(let d=l.length;d--;){const h=e.dateRanges[l[d]],u=h.startDate.getTime();h.tagAnchor=n.ref;for(let f=s;f--;){var o;if(((o=a[f])==null?void 0:o.sn)<e.startSN)break;const g=EM(e,u,a,f,i);if(g!==-1){h.tagAnchor=e.fragments[g].ref;break}}}}function EM(a,e,s,n,i){const l=s[n];if(l){const d=l.programDateTime;if(e>=d||n===0){var o;const h=(((o=s[n+1])==null?void 0:o.start)||i)-l.start;if(e<=d+h*1e3){const u=s[n].sn-a.startSN;if(u<0)return-1;const f=a.fragments;if(f.length>s.length){const p=(s[n+1]||f[f.length-1]).sn-a.startSN;for(let b=p;b>u;b--){const y=f[b].programDateTime;if(e>=y&&e<y+f[b].duration*1e3)return b}}return u}}}return-1}function z_(a,e,s){var n,i;const l=new Es(a,s),o=(n=l.METHOD)!=null?n:"",d=l.URI,h=l.hexadecimalInteger("IV"),u=l.KEYFORMATVERSIONS,f=(i=l.KEYFORMAT)!=null?i:"identity";d&&l.IV&&!h&&rs.error(`Invalid IV: ${l.IV}`);const g=d?Zn.resolve(d,e):"",p=(u||"1").split("/").map(Number).filter(Number.isFinite);return new jr(o,g,f,p,h,l.KEYID)}function Y_(a){const s=new Es(a).decimalFloatingPoint("TIME-OFFSET");return Ze(s)?s:null}function W_(a,e){let s=(a||"").split(/[ ,]+/).filter(n=>n);["video","audio","text"].forEach(n=>{const i=s.filter(l=>Sp(l,n));i.length&&(e[`${n}Codec`]=i.map(l=>l.split("/")[0]).join(","),s=s.filter(l=>i.indexOf(l)===-1))}),e.unknownCodecs=s}function Q_(a,e,s){const n=e[s];n&&(a[s]=n)}function TM(a,e){let s=a[e];for(let n=e;n--;){const i=a[n];if(!i)return;i.programDateTime=s.programDateTime-i.duration*1e3,s=i}}function A0(a,e,s){a.rawProgramDateTime?s.push(a):e!=null&&e.programDateTime&&(a.programDateTime=e.endProgramDateTime)}function X_(a,e,s,n){a.relurl=e.URI,e.BYTERANGE&&a.setByteRange(e.BYTERANGE),a.level=s,a.sn="initSegment",n&&(a.levelkeys=n),a.initSegment=null}function J_(a,e,s){a.levelkeys=e;const{encryptedFragments:n}=s;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&n.push(a)}function wi(a,e,s){a.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${s[0]})`)}function Z_(a,e,s){a.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${s[0]})`)}function Ng(a,e){const s=e.startPTS;if(Ze(s)){let n=0,i;e.sn>a.sn?(n=s-a.start,i=a):(n=a.start-s,i=e),i.duration!==n&&i.setDuration(n)}else e.sn>a.sn?a.cc===e.cc&&a.minEndPTS?e.setStart(a.start+(a.minEndPTS-a.start)):e.setStart(a.start+a.duration):e.setStart(Math.max(a.start-e.duration,0))}function cS(a,e,s,n,i,l,o){n-s<=0&&(o.warn("Fragment should have a positive duration",e),n=s+e.duration,l=i+e.duration);let h=s,u=n;const f=e.startPTS,g=e.endPTS;if(Ze(f)){const N=Math.abs(f-s);a&&N>a.totalduration?o.warn(`media timestamps and playlist times differ by ${N}s for level ${e.level} ${a.url}`):Ze(e.deltaPTS)?e.deltaPTS=Math.max(N,e.deltaPTS):e.deltaPTS=N,h=Math.max(s,f),s=Math.min(s,f),i=e.startDTS!==void 0?Math.min(i,e.startDTS):i,u=Math.min(n,g),n=Math.max(n,g),l=e.endDTS!==void 0?Math.max(l,e.endDTS):l}const p=s-e.start;e.start!==0&&e.setStart(s),e.setDuration(n-e.start),e.startPTS=s,e.maxStartPTS=h,e.startDTS=i,e.endPTS=n,e.minEndPTS=u,e.endDTS=l;const b=e.sn;if(!a||b<a.startSN||b>a.endSN)return 0;let y;const v=b-a.startSN,_=a.fragments;for(_[v]=e,y=v;y>0;y--)Ng(_[y],_[y-1]);for(y=v;y<_.length-1;y++)Ng(_[y],_[y+1]);return a.fragmentHint&&Ng(_[_.length-1],a.fragmentHint),a.PTSKnown=a.alignedSliding=!0,p}function AM(a,e,s){if(a===e)return;let n=null;const i=a.fragments;for(let f=i.length-1;f>=0;f--){const g=i[f].initSegment;if(g){n=g;break}}a.fragmentHint&&delete a.fragmentHint.endPTS;let l;RM(a,e,(f,g,p,b)=>{if((!e.startCC||e.skippedSegments)&&g.cc!==f.cc){const y=f.cc-g.cc;for(let v=p;v<b.length;v++)b[v].cc+=y;e.endCC=b[b.length-1].cc}Ze(f.startPTS)&&Ze(f.endPTS)&&(g.setStart(g.startPTS=f.startPTS),g.startDTS=f.startDTS,g.maxStartPTS=f.maxStartPTS,g.endPTS=f.endPTS,g.endDTS=f.endDTS,g.minEndPTS=f.minEndPTS,g.setDuration(f.endPTS-f.startPTS),g.duration&&(l=g),e.PTSKnown=e.alignedSliding=!0),f.hasStreams&&(g.elementaryStreams=f.elementaryStreams),g.loader=f.loader,f.hasStats&&(g.stats=f.stats),f.initSegment&&(g.initSegment=f.initSegment,n=f.initSegment)});const o=e.fragments,d=e.fragmentHint?o.concat(e.fragmentHint):o;if(n&&d.forEach(f=>{var g;f&&(!f.initSegment||f.initSegment.relurl===((g=n)==null?void 0:g.relurl))&&(f.initSegment=n)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(f=>!f),e.deltaUpdateFailed){s.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let f=e.skippedSegments;f--;)o.shift();e.startSN=o[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=CM(a.dateRanges,e,s));const f=a.fragments.filter(g=>g.rawProgramDateTime);if(a.hasProgramDateTime&&!e.hasProgramDateTime)for(let g=1;g<d.length;g++)d[g].programDateTime===null&&A0(d[g],d[g-1],f);oS(f,e)}e.endCC=o[o.length-1].cc}if(!e.startCC){var h;const f=hS(a,e.startSN-1);e.startCC=(h=f?.cc)!=null?h:o[0].cc}kM(a.partList,e.partList,(f,g)=>{g.elementaryStreams=f.elementaryStreams,g.stats=f.stats}),l?cS(e,l,l.startPTS,l.endPTS,l.startDTS,l.endDTS,s):dS(a,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=a.driftStartTime,e.driftStart=a.driftStart;const u=e.advancedDateTime;if(e.advanced&&u){const f=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=f),e.driftEndTime=u,e.driftEnd=f}else e.driftEndTime=a.driftEndTime,e.driftEnd=a.driftEnd,e.advancedDateTime=a.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=a.requestScheduled)}function CM(a,e,s){const{dateRanges:n,recentlyRemovedDateranges:i}=e,l=ds({},a);i&&i.forEach(h=>{delete l[h]});const d=Object.keys(l).length;return d?(Object.keys(n).forEach(h=>{const u=l[h],f=new aS(n[h].attr,u);f.isValid?(l[h]=f,u||(f.tagOrder+=d)):s.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${ms(n[h].attr)}"`)}),l):n}function kM(a,e,s){if(a&&e){let n=0;for(let i=0,l=a.length;i<=l;i++){const o=a[i],d=e[i+n];o&&d&&o.index===d.index&&o.fragment.sn===d.fragment.sn?s(o,d):n--}}}function RM(a,e,s){const n=e.skippedSegments,i=Math.max(a.startSN,e.startSN)-e.startSN,l=(a.fragmentHint?1:0)+(n?e.endSN:Math.min(a.endSN,e.endSN))-e.startSN,o=e.startSN-a.startSN,d=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,h=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments;for(let u=i;u<=l;u++){const f=h[o+u];let g=d[u];if(n&&!g&&f&&(g=e.fragments[u]=f),f&&g){s(f,g,u,d);const p=f.relurl,b=g.relurl;if(p&&LM(p,b)){e.playlistParsingError=eN(`media sequence mismatch ${g.sn}:`,a,e,f,g);return}else if(f.cc!==g.cc){e.playlistParsingError=eN(`discontinuity sequence mismatch (${f.cc}!=${g.cc})`,a,e,f,g);return}}}}function eN(a,e,s,n,i){return new Error(`${a} ${i.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${s.startSN}
${s.m3u8}`)}function dS(a,e,s=!0){const n=e.startSN+e.skippedSegments-a.startSN,i=a.fragments,l=n>=0;let o=0;if(l&&n<i.length)o=i[n].start;else if(l&&e.startSN===a.endSN+1)o=a.fragmentEnd;else if(l&&s)o=a.fragmentStart+n*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=a.fragmentStart;else return;C0(e,o)}function C0(a,e){if(e){const s=a.fragments;for(let n=a.skippedSegments;n<s.length;n++)s[n].addStart(e);a.fragmentHint&&a.fragmentHint.addStart(e)}}function uS(a,e=1/0){let s=1e3*a.targetduration;if(a.updated){const n=a.fragments;if(n.length&&s*4>e){const l=n[n.length-1].duration*1e3;l<s&&(s=l)}}else s/=2;return Math.round(s)}function hS(a,e,s){if(!a)return null;let n=a.fragments[e-a.startSN];return n||(n=a.fragmentHint,n&&n.sn===e)?n:e<a.startSN&&s&&s.sn===e?s:null}function tN(a,e,s){return a?fS(a.partList,e,s):null}function fS(a,e,s){if(a)for(let n=a.length;n--;){const i=a[n];if(i.index===s&&i.fragment.sn===e)return i}return null}function mS(a){a.forEach((e,s)=>{var n;(n=e.details)==null||n.fragments.forEach(i=>{i.level=s,i.initSegment&&(i.initSegment.level=s)})})}function LM(a,e){return a!==e&&e?sN(a)!==sN(e):!1}function sN(a){return a.replace(/\?[^?]*$/,"")}function Oc(a,e){for(let n=0,i=a.length;n<i;n++){var s;if(((s=a[n])==null?void 0:s.cc)===e)return a[n]}return null}function DM(a,e){return!!(a&&e.startCC<a.endCC&&e.endCC>a.startCC)}function aN(a,e){const s=a.start+e;a.startPTS=s,a.setStart(s),a.endPTS=s+a.duration}function gS(a,e){const s=e.fragments;for(let n=0,i=s.length;n<i;n++)aN(s[n],a);e.fragmentHint&&aN(e.fragmentHint,a),e.alignedSliding=!0}function MM(a,e){a&&(pS(e,a),e.alignedSliding||kh(e,a),!e.alignedSliding&&!e.skippedSegments&&dS(a,e,!1))}function pS(a,e){if(!DM(e,a))return;const s=Math.min(e.endCC,a.endCC),n=Oc(e.fragments,s),i=Oc(a.fragments,s);if(!n||!i)return;rs.log(`Aligning playlist at start of dicontinuity sequence ${s}`);const l=n.start-i.start;gS(l,a)}function kh(a,e){if(!a.hasProgramDateTime||!e.hasProgramDateTime)return;const s=a.fragments,n=e.fragments;if(!s.length||!n.length)return;let i,l;const o=Math.min(e.endCC,a.endCC);e.startCC<o&&a.startCC<o&&(i=Oc(n,o),l=Oc(s,o)),(!i||!l)&&(i=n[Math.floor(n.length/2)],l=Oc(s,i.cc)||s[Math.floor(s.length/2)]);const d=i.programDateTime,h=l.programDateTime;if(!d||!h)return;const u=(h-d)/1e3-(l.start-i.start);gS(u,a)}function Na(a,e,s){Pa(a,e,s),a.addEventListener(e,s)}function Pa(a,e,s){a.removeEventListener(e,s)}const IM={toString:function(a){let e="";const s=a.length;for(let n=0;n<s;n++)e+=`[${a.start(n).toFixed(3)}-${a.end(n).toFixed(3)}]`;return e}},Be={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Rp extends tS{constructor(e,s,n,i,l){super(i,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=Be.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:d,media:h,mediaBuffer:u,state:f}=this,g=h?h.currentTime:0,p=St.bufferInfo(u||h,g,o.maxBufferHole),b=!p.len;if(this.log(`Media seeking to ${Ze(g)?g.toFixed(3):g}, state: ${f}, ${b?"out of":"in"} buffer`),this.state===Be.ENDED)this.resetLoadingState();else if(d){const y=o.maxFragLookUpTolerance,v=d.start-y,_=d.start+d.duration+y;if(b||_<p.start||v>p.end){const N=g>_;(g<v||N)&&(N&&d.loader&&(this.log(`Cancelling fragment load for seek (sn: ${d.sn})`),d.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(h){this.fragmentTracker.removeFragmentsInRange(g,1/0,this.playlistType,!0);const y=this.lastCurrentTime;if(g>y&&(this.lastCurrentTime=g),!this.loadingParts){const v=Math.max(p.end,g),_=this.shouldLoadParts(this.getLevelDetails(),v);_&&(this.log(`LL-Part loading ON after seeking to ${g.toFixed(2)} with buffer @${v.toFixed(2)}`),this.loadingParts=_)}}this.hls.hasEnoughToStart||(this.log(`Setting ${b?"startPosition":"nextLoadPosition"} to ${g} for seek without enough to start`),this.nextLoadPosition=g,b&&(this.startPosition=g)),b&&this.state===Be.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=l,this.hls=e,this.fragmentLoader=new cM(e.config),this.keyLoader=n,this.fragmentTracker=s,this.config=e.config,this.decrypter=new Tp(e.config)}registerListeners(){const{hls:e}=this;e.on($.MEDIA_ATTACHED,this.onMediaAttached,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.MANIFEST_LOADED,this.onManifestLoaded,this),e.on($.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off($.MEDIA_ATTACHED,this.onMediaAttached,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.MANIFEST_LOADED,this.onManifestLoaded,this),e.off($.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===Be.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Be.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:s}=this;return s===-1&&e?e:s}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,s){if(s.live||!this.media)return!1;const n=e.end||0,i=this.config.timelineOffset||0;if(n<=i)return!1;const l=e.buffered;this.config.maxBufferHole&&l&&l.length>1&&(e=St.bufferedInfo(l,e.start,0));const o=e.nextStart;if(o&&o>i&&o<s.edge||this.media.currentTime<e.start)return!1;const h=s.partList;if(h!=null&&h.length){const f=h[h.length-1];return St.isBuffered(this.media,f.start+f.duration/2)}const u=s.fragments[s.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var s;return((s=this.getLevelDetails())==null?void 0:s.appliedTimelineOffset)||e}return 0}onMediaAttached(e,s){const n=this.media=this.mediaBuffer=s.media;Na(n,"seeking",this.onMediaSeeking),Na(n,"ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===Be.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(e,s){const n=!!s.transferMedia,i=this.media;if(i!==null){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Pa(i,"seeking",this.onMediaSeeking),Pa(i,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,s){}onManifestLoaded(e,s){this.startTimeOffset=s.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=Be.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,s,n){this.startFragRequested=!0,this._loadFragForPlayback(e,s,n)}_loadFragForPlayback(e,s,n){const i=l=>{const o=l.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${l.part?" part: "+l.part.index:""} of ${this.fragInfo(o,!1,l.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(l)};this._doFragLoad(e,s,n,i).then(l=>{if(!l)return;const o=this.state,d=l.frag;if(this.fragContextChanged(d)){(o===Be.FRAG_LOADING||!this.fragCurrent&&o===Be.PARSING)&&(this.fragmentTracker.removeFragment(d),this.state=Be.IDLE);return}"payload"in l&&(this.log(`Loaded ${d.type} sn: ${d.sn} of ${this.playlistLabel()} ${d.level}`),this.hls.trigger($.FRAG_LOADED,l)),this._handleFragmentLoadComplete(l)}).catch(l=>{this.state===Be.STOPPED||this.state===Be.ERROR||(this.warn(`Frag error: ${l?.message||l}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var s;const{fragmentTracker:n}=this;if(n.getState(e)===Xs.APPENDING){const l=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,l),d=Math.max(e.duration,o?o.len:this.config.maxBufferLength),h=this.backtrackFragment;((h?e.sn-h.sn:0)===1||this.reduceMaxBufferLength(d,e.duration))&&n.removeFragment(e)}else((s=this.mediaBuffer)==null?void 0:s.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===Xs.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const s=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:s,part:null,stats:s.stats,id:s.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const s=e.details;return s?.live&&s.type!=="EVENT"&&(this.levelLastLoaded!==e||s.expired)}flushMainBuffer(e,s,n=null){if(!(e-s))return;const i={startOffset:e,endOffset:s,type:n};this.hls.trigger($.BUFFER_FLUSHING,i)}_loadInitSegment(e,s){this._doFragLoad(e,s).then(n=>{const i=n?.frag;if(!i||this.fragContextChanged(i)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:i}=this,{frag:l,payload:o}=n,d=l.decryptdata;if(o&&o.byteLength>0&&d!=null&&d.key&&d.iv&&po(d.method)){const h=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),d.key.buffer,d.iv.buffer,Cp(d.method)).catch(u=>{throw i.trigger($.ERROR,{type:rt.MEDIA_ERROR,details:Ne.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:l}),u}).then(u=>{const f=self.performance.now();return i.trigger($.FRAG_DECRYPTED,{frag:l,payload:u,stats:{tstart:h,tdecrypt:f}}),n.payload=u,this.completeInitSegmentLoad(n)})}return this.completeInitSegmentLoad(n)}).catch(n=>{this.state===Be.STOPPED||this.state===Be.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:s}=this;if(!s)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==Be.STOPPED&&(this.state=Be.IDLE),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,s){var n,i;const l=e.tracks;if(l&&!s.encrypted&&((n=l.audio)!=null&&n.encrypted||(i=l.video)!=null&&i.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,d=new Error(`Encrypted track with no key in ${this.fragInfo(s)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(d.message),!o||o.mediaKeys?!1:(this.hls.trigger($.ERROR,{type:rt.KEY_SYSTEM_ERROR,details:Ne.KEY_SYSTEM_NO_KEYS,fatal:!1,error:d,frag:s}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:s}=this;return!e||!s||e.sn!==s.sn||e.level!==s.level}fragBufferedComplete(e,s){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${s?" part: "+s.index:""} of ${this.fragInfo(e,!1,s)} > buffer:${n?IM.toString(St.getBuffered(n)):"(detached)"})`),Us(e)){var i;if(e.type!==et.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(d=>!!o[d])){this.state=Be.IDLE;return}}const l=(i=this.levels)==null?void 0:i[e.level];l!=null&&l.fragmentError&&(this.log(`Resetting level fragment error count of ${l.fragmentError} on frag buffered`),l.fragmentError=0)}this.state=Be.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:s}=this;if(!s)return;const{frag:n,part:i,partsLoaded:l}=e,o=!l||l.length===0||l.some(h=>!h),d=new Ap(n.level,n.sn,n.stats.chunkCount+1,0,i?i.index:-1,!o);s.flush(d)}_handleFragmentLoadProgress(e){}_doFragLoad(e,s,n=null,i){var l;this.fragCurrent=e;const o=s.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let d=null;if(e.encrypted&&!((l=e.decryptdata)!=null&&l.key)){if(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=Be.KEY_LOADING,this.fragCurrent=e,d=this.keyLoader.load(e).then(p=>{if(!this.fragContextChanged(p.frag))return this.hls.trigger($.KEY_LOADED,p),this.state===Be.KEY_LOADING&&(this.state=Be.IDLE),p}),this.hls.trigger($.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(d=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),d&&this.log("[eme] blocking frag load until media-keys acquired"));const h=this.fragPrevious;if(Us(e)&&(!h||e.sn!==h.sn)){const p=this.shouldLoadParts(s.details,e.end);p!==this.loadingParts&&(this.log(`LL-Part loading ${p?"ON":"OFF"} loading sn ${h?.sn}->${e.sn}`),this.loadingParts=p)}if(n=Math.max(e.start,n||0),this.loadingParts&&Us(e)){const p=o.partList;if(p&&i){n>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);const b=this.getNextPart(p,e,n);if(b>-1){const y=p[b];e=this.fragCurrent=y.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${y.index} (${b}/${p.length-1}) of ${this.fragInfo(e,!1,y)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=y.start+y.duration,this.state=Be.FRAG_LOADING;let v;return d?v=d.then(_=>!_||this.fragContextChanged(_.frag)?null:this.doFragPartsLoad(e,y,s,i)).catch(_=>this.handleFragLoadError(_)):v=this.doFragPartsLoad(e,y,s,i).catch(_=>this.handleFragLoadError(_)),this.hls.trigger($.FRAG_LOADING,{frag:e,part:y,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):v}else if(!e.url||this.loadedEndOfParts(p,n))return Promise.resolve(null)}}if(Us(e)&&this.loadingParts){var u;this.log(`LL-Part loading OFF after next part miss @${n.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(u=o.partList)==null?void 0:u.filter(p=>p.loaded).map(p=>`[${p.start}-${p.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(n.toFixed(3))}`),Ze(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Be.FRAG_LOADING;const f=this.config.progressive&&e.type!==et.SUBTITLE;let g;return f&&d?g=d.then(p=>!p||this.fragContextChanged(p.frag)?null:this.fragmentLoader.load(e,i)).catch(p=>this.handleFragLoadError(p)):g=Promise.all([this.fragmentLoader.load(e,f?i:void 0),d]).then(([p])=>(!f&&i&&i(p),p)).catch(p=>this.handleFragLoadError(p)),this.hls.trigger($.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):g}doFragPartsLoad(e,s,n,i){return new Promise((l,o)=>{var d;const h=[],u=(d=n.details)==null?void 0:d.partList,f=g=>{this.fragmentLoader.loadPart(e,g,i).then(p=>{h[g.index]=p;const b=p.part;this.hls.trigger($.FRAG_LOADED,p);const y=tN(n.details,e.sn,g.index+1)||fS(u,e.sn,g.index+1);if(y)f(y);else return l({frag:e,part:b,partsLoaded:h})}).catch(o)};f(s)})}handleFragLoadError(e){if("data"in e){const s=e.data;s.frag&&s.details===Ne.INTERNAL_ABORTED?this.handleFragLoadAborted(s.frag,s.part):s.frag&&s.type===rt.KEY_SYSTEM_ERROR?(s.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(s.frag)):this.hls.trigger($.ERROR,s)}else this.hls.trigger($.ERROR,{type:rt.OTHER_ERROR,details:Ne.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const s=this.getCurrentContext(e);if(!s||this.state!==Be.PARSING){!this.fragCurrent&&this.state!==Be.STOPPED&&this.state!==Be.ERROR&&(this.state=Be.IDLE);return}const{frag:n,part:i,level:l}=s,o=self.performance.now();n.stats.parsing.end=o,i&&(i.stats.parsing.end=o);const d=this.getLevelDetails(),u=d&&n.sn>d.endSN||this.shouldLoadParts(d,n.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${n.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(n,i,l,e.partial)}shouldLoadParts(e,s){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const l=e.partList[0];if(l.fragment.type===et.SUBTITLE)return!1;const o=l.end+(((n=e.fragmentHint)==null?void 0:n.duration)||0);if(s>=o){var i;if((this.hls.hasEnoughToStart?((i=this.media)==null?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>l.start-l.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:s,fragCurrent:n}=this,{level:i,sn:l,part:o}=e;if(!(s!=null&&s[i]))return this.warn(`Levels object was unset while buffering fragment ${l} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;const d=s[i],h=d.details,u=o>-1?tN(h,l,o):null,f=u?u.fragment:hS(h,l,n);return f?(n&&n!==f&&(f.stats=n.stats),{frag:f,part:u,level:d}):null}bufferFragmentData(e,s,n,i,l){if(this.state!==Be.PARSING)return;const{data1:o,data2:d}=e;let h=o;if(d&&(h=wn(o,d)),!h.length)return;const u=this.initPTS[s.cc],f=u?-u.baseTime/u.timescale:void 0,g={type:e.type,frag:s,part:n,chunkMeta:i,offset:f,parent:s.type,data:h};if(this.hls.trigger($.BUFFER_APPENDING,g),e.dropped&&e.independent&&!n){if(l)return;this.flushBufferGap(s)}}flushBufferGap(e){const s=this.media;if(!s)return;if(!St.isBuffered(s,s.currentTime)){this.flushMainBuffer(0,e.start);return}const n=s.currentTime,i=St.bufferInfo(s,n,0),l=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,l*.25),d=Math.max(Math.min(e.start-o,i.end-o),n+o);e.start-d>o&&this.flushMainBuffer(d,e.start)}getFwdBufferInfo(e,s){var n;const i=this.getLoadPosition();if(!Ze(i))return null;const o=this.lastCurrentTime>i||(n=this.media)!=null&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,s,o)}getFwdBufferInfoAtPos(e,s,n,i){const l=St.bufferInfo(e,s,i);if(l.len===0&&l.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(s,n);if(o&&(l.nextStart<=o.end||o.gap)){const d=Math.max(Math.min(l.nextStart,o.end)-s,i);return St.bufferInfo(e,s,d)}}return l}getMaxBufferLength(e){const{config:s}=this;let n;return e?n=Math.max(8*s.maxBufferSize/e,s.maxBufferLength):n=s.maxBufferLength,Math.min(n,s.maxMaxBufferLength)}reduceMaxBufferLength(e,s){const n=this.config,i=Math.max(Math.min(e-s,n.maxBufferLength),s),l=Math.max(e-s*3,n.maxMaxBufferLength/2,i);return l>=i?(n.maxMaxBufferLength=l,this.warn(`Reduce max buffer length to ${l}s`),!0):!1}getAppendedFrag(e,s=et.MAIN){const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,s):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,s){const n=s.fragments,i=n.length;if(!i)return null;const{config:l}=this,o=n[0].start,d=l.lowLatencyMode&&!!s.partList;let h=null;if(s.live){const g=l.initialLiveManifestSize;if(i<g)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${g})`),null;if(!s.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var u;d&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),h=this.getInitialLiveFragment(s);const p=this.hls.startPosition,b=this.hls.liveSyncPosition,y=h?(p!==-1&&p>=o?p:b)||h.start:e;this.log(`Setting startPosition to ${y} to match start frag at live edge. mainStart: ${p} liveSyncPosition: ${b} frag.start: ${(u=h)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=y}}else e<=o&&(h=n[0]);if(!h){const g=this.loadingParts?s.partEnd:s.fragmentEnd;h=this.getFragmentAtPosition(e,g,s)}let f=this.filterReplacedPrimary(h,s);if(!f&&h){const g=h.sn-s.startSN;f=this.filterReplacedPrimary(n[g+1]||null,s)}return this.mapToInitFragWhenRequired(f)}isLoopLoading(e,s){const n=this.fragmentTracker.getState(e);return(n===Xs.OK||n===Xs.PARTIAL&&!!e.gap)&&this.nextLoadPosition>s}getNextFragmentLoopLoading(e,s,n,i,l){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,s),o&&!o.gap&&n.nextStart)){const d=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,i,0);if(d!==null&&n.len+d.len>=l){const h=o.sn;return this.loopSn!==h&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${h}`),this.loopSn=h),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(nN(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,s){if(!e)return e;if(nN(this.config)&&e.type!==et.SUBTITLE){const n=this.hls.interstitialsManager,i=n?.bufferingItem;if(i){const o=i.event;if(o){if(o.appendInPlace||Math.abs(e.start-i.start)>1||i.start===0)return null}else if(e.end<=i.start&&s?.live===!1||e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}const l=n?.playerQueue;if(l)for(let o=l.length;o--;){const d=l[o].interstitial;if(d.appendInPlace&&e.start>=d.startTime&&e.end<=d.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,s,n){let i=-1,l=!1,o=!0;for(let d=0,h=e.length;d<h;d++){const u=e[d];if(o=o&&!u.independent,i>-1&&n<u.start)break;const f=u.loaded;f?i=-1:(l||(u.independent||o)&&u.fragment===s)&&(u.fragment!==s&&this.warn(`Need buffer at ${n} but next unloaded part starts at ${u.start}`),i=d),l=f}return i}loadedEndOfParts(e,s){let n;for(let i=e.length;i--;){if(n=e[i],!n.loaded)return!1;if(s>n.start)return!0}return!1}getInitialLiveFragment(e){const s=e.fragments,n=this.fragPrevious;let i=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),i=X5(s,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const l=n.sn+1;if(l>=e.startSN&&l<=e.endSN){const o=s[l-e.startSN];n.cc===o.cc&&(i=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=Jw(e,n.cc,n.end),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const l=this.hls.liveSyncPosition;l!==null&&(i=this.getFragmentAtPosition(l,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,s,n){const{config:i}=this;let{fragPrevious:l}=this,{fragments:o,endSN:d}=n;const{fragmentHint:h}=n,{maxFragLookUpTolerance:u}=i,f=n.partList,g=!!(this.loadingParts&&f!=null&&f.length&&h);g&&!this.bitrateTest&&f[f.length-1].fragment.sn===h.sn&&(o=o.concat(h),d=h.sn);let p;if(e<s){var b;const v=e<this.lastCurrentTime||e>s-u||(b=this.media)!=null&&b.paused||!this.startFragRequested?0:u;p=vl(l,o,e,v)}else p=o[o.length-1];if(p){const y=p.sn-n.startSN,v=this.fragmentTracker.getState(p);if((v===Xs.OK||v===Xs.PARTIAL&&p.gap)&&(l=p),l&&p.sn===l.sn&&(!g||f[0].fragment.sn>p.sn||!n.live)&&p.level===l.level){const N=o[y+1];p.sn<d&&this.fragmentTracker.getState(N)!==Xs.OK?p=N:p=null}}return p}alignPlaylists(e,s,n){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const l=e.fragmentStart,o=!s,d=e.alignedSliding&&Ze(l);if(o||!d&&!l){MM(n,e);const h=e.fragmentStart;return this.log(`Live playlist sliding: ${h.toFixed(2)} start-sn: ${s?s.startSN:"na"}->${e.startSN} fragments: ${i}`),h}return l}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,s){let n=this.startPosition;n<s&&(n=-1);const i=this.timelineOffset;if(n===-1){const l=this.startTimeOffset!==null,o=l?this.startTimeOffset:e.startTimeOffset;o!==null&&Ze(o)?(n=s+o,o<0&&(n+=e.edge),n=Math.min(Math.max(s,n),s+e.totalduration),this.log(`Setting startPosition to ${n} for start time offset ${o} found in ${l?"multivariant":"media"} playlist`),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||s,this.log(`Setting startPosition to -1 to start at live edge ${n}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+i}this.nextLoadPosition=n+i}getLoadPosition(){var e;const{media:s}=this;let n=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&s?n=s.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,s){this.transmuxer&&e.type===this.playlistType&&Us(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${s?" part "+s.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==Be.FRAG_LOADING_WAITING_RETRY)&&(this.state=Be.IDLE)}onFragmentOrKeyLoadError(e,s){var n;if(s.chunkMeta&&!s.frag){const N=this.getCurrentContext(s.chunkMeta);N&&(s.frag=N.frag)}const i=s.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var l;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(l=this.fragCurrent)==null?void 0:l.url}`);return}const o=s.details===Ne.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(i,!0);const d=s.errorAction;if(!d){this.state=Be.ERROR;return}const{action:h,flags:u,retryCount:f=0,retryConfig:g}=d,p=!!g,b=p&&h===oa.RetryRequest,y=p&&!d.resolved&&u===Ja.MoveAllAlternatesMatchingHost,v=(n=this.hls.latestLevelDetails)==null?void 0:n.live;if(!b&&y&&Us(i)&&!i.endList&&v&&!eS(s))this.resetFragmentErrors(e),this.treatAsGap(i),d.resolved=!0;else if((b||y)&&f<g.maxNumRetry){var _;const N=j0((_=s.response)==null?void 0:_.code),C=Ep(g,f);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+C,this.state=Be.FRAG_LOADING_WAITING_RETRY,d.resolved=!0,N){this.log("Waiting for connection (offline)"),this.retryDate=1/0,s.reason="offline";return}this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${s.details}, retrying loading ${f+1}/${g.maxNumRetry} in ${C}ms`)}else if(g)if(this.resetFragmentErrors(e),f<g.maxNumRetry)!o&&h!==oa.RemoveAlternatePermanently&&(d.resolved=!0);else{this.warn(`${s.details} reached or exceeded max retry (${f})`);return}else h===oa.SendAlternateToPenaltyBox?this.state=Be.WAITING_LEVEL:this.state=Be.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),s=this.retryDate,n=s===1/0;(!s||e>=s||n&&!j0(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=Be.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===Be.PARSING||this.state===Be.PARSED){const s=e.frag,n=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,n),l=i&&i.len>.5;l&&this.reduceMaxBufferLength(i.len,s?.duration||10);const o=!l;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${n} buffer`),s&&(this.fragmentTracker.removeFragment(s),this.nextLoadPosition=s.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===et.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==Be.STOPPED&&(this.state=Be.IDLE)}afterBufferFlushed(e,s,n){if(!e)return;const i=St.getBuffered(e);this.fragmentTracker.detectEvictedFragments(s,i,n),this.state===Be.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==Be.STOPPED&&(this.state=Be.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,s=e?e.details:null;s!=null&&s.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(s,s.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,s,n,i){const l=n.details;if(!l){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((h,u)=>{const f=e.elementaryStreams[u];if(f){const g=f.endPTS-f.startPTS;if(g<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${g})`),h||!1;const p=i?0:cS(l,e,f.startPTS,f.endPTS,f.startDTS,f.endDTS,this);return this.hls.trigger($.LEVEL_PTS_UPDATED,{details:l,level:n,drift:p,type:u,frag:e,start:f.startPTS,end:f.endPTS}),!0}return h},!1)){var d;const h=((d=this.transmuxer)==null?void 0:d.error)===null;if((n.fragmentError===0||h&&(n.fragmentError<2||e.endList))&&this.treatAsGap(e,n),h){const u=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(u.message),this.hls.trigger($.ERROR,{type:rt.MEDIA_ERROR,details:Ne.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=Be.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${s?" part: "+s.index:""} of ${this.fragInfo(e,!1,s)})`),this.hls.trigger($.FRAG_PARSED,{frag:e,part:s})}playlistLabel(){return this.playlistType===et.MAIN?"level":"track"}fragInfo(e,s=!0,n){var i,l;return`${this.playlistLabel()} ${e.level} (${n?"part":"frag"}:[${((i=s&&!n?e.startPTS:(n||e).start)!=null?i:NaN).toFixed(3)}-${((l=s&&!n?e.endPTS:(n||e).end)!=null?l:NaN).toFixed(3)}]${n&&e.type==="main"?"INDEPENDENT="+(n.independent?"YES":"NO"):""}`}treatAsGap(e,s){s&&s.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const s=this._state;s!==e&&(this._state=e,this.log(`${s}->${e}`))}get state(){return this._state}}function nN(a){return!!a.interstitialsController&&a.enableInterstitialPlayback!==!1}class xS{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:s}=this;let n;if(e.length)e.length===1?n=e[0]:n=PM(e,s);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function PM(a,e){const s=new Uint8Array(e);let n=0;for(let i=0;i<a.length;i++){const l=a[i];s.set(l,n),n+=l.length}return s}var wg={exports:{}},iN;function OM(){return iN||(iN=1,(function(a){var e=Object.prototype.hasOwnProperty,s="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(s=!1));function i(h,u,f){this.fn=h,this.context=u,this.once=f||!1}function l(h,u,f,g,p){if(typeof f!="function")throw new TypeError("The listener must be a function");var b=new i(f,g||h,p),y=s?s+u:u;return h._events[y]?h._events[y].fn?h._events[y]=[h._events[y],b]:h._events[y].push(b):(h._events[y]=b,h._eventsCount++),h}function o(h,u){--h._eventsCount===0?h._events=new n:delete h._events[u]}function d(){this._events=new n,this._eventsCount=0}d.prototype.eventNames=function(){var u=[],f,g;if(this._eventsCount===0)return u;for(g in f=this._events)e.call(f,g)&&u.push(s?g.slice(1):g);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(f)):u},d.prototype.listeners=function(u){var f=s?s+u:u,g=this._events[f];if(!g)return[];if(g.fn)return[g.fn];for(var p=0,b=g.length,y=new Array(b);p<b;p++)y[p]=g[p].fn;return y},d.prototype.listenerCount=function(u){var f=s?s+u:u,g=this._events[f];return g?g.fn?1:g.length:0},d.prototype.emit=function(u,f,g,p,b,y){var v=s?s+u:u;if(!this._events[v])return!1;var _=this._events[v],N=arguments.length,C,T;if(_.fn){switch(_.once&&this.removeListener(u,_.fn,void 0,!0),N){case 1:return _.fn.call(_.context),!0;case 2:return _.fn.call(_.context,f),!0;case 3:return _.fn.call(_.context,f,g),!0;case 4:return _.fn.call(_.context,f,g,p),!0;case 5:return _.fn.call(_.context,f,g,p,b),!0;case 6:return _.fn.call(_.context,f,g,p,b,y),!0}for(T=1,C=new Array(N-1);T<N;T++)C[T-1]=arguments[T];_.fn.apply(_.context,C)}else{var L=_.length,F;for(T=0;T<L;T++)switch(_[T].once&&this.removeListener(u,_[T].fn,void 0,!0),N){case 1:_[T].fn.call(_[T].context);break;case 2:_[T].fn.call(_[T].context,f);break;case 3:_[T].fn.call(_[T].context,f,g);break;case 4:_[T].fn.call(_[T].context,f,g,p);break;default:if(!C)for(F=1,C=new Array(N-1);F<N;F++)C[F-1]=arguments[F];_[T].fn.apply(_[T].context,C)}}return!0},d.prototype.on=function(u,f,g){return l(this,u,f,g,!1)},d.prototype.once=function(u,f,g){return l(this,u,f,g,!0)},d.prototype.removeListener=function(u,f,g,p){var b=s?s+u:u;if(!this._events[b])return this;if(!f)return o(this,b),this;var y=this._events[b];if(y.fn)y.fn===f&&(!p||y.once)&&(!g||y.context===g)&&o(this,b);else{for(var v=0,_=[],N=y.length;v<N;v++)(y[v].fn!==f||p&&!y[v].once||g&&y[v].context!==g)&&_.push(y[v]);_.length?this._events[b]=_.length===1?_[0]:_:o(this,b)}return this},d.prototype.removeAllListeners=function(u){var f;return u?(f=s?s+u:u,this._events[f]&&o(this,f)):(this._events=new n,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=s,d.EventEmitter=d,a.exports=d})(wg)),wg.exports}var FM=OM(),Lp=c5(FM);const zc="1.6.15",jo={};function BM(){return typeof __HLS_WORKER_BUNDLE__=="function"}function UM(){const a=jo[zc];if(a)return a.clientCount++,a;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),s=self.URL.createObjectURL(e),i={worker:new self.Worker(s),objectURL:s,clientCount:1};return jo[zc]=i,i}function $M(a){const e=jo[a];if(e)return e.clientCount++,e;const s=new self.URL(a,self.location.href).href,i={worker:new self.Worker(s),scriptURL:s,clientCount:1};return jo[a]=i,i}function GM(a){const e=jo[a||zc];if(e&&e.clientCount--===1){const{worker:n,objectURL:i}=e;delete jo[a||zc],i&&self.URL.revokeObjectURL(i),n.terminate()}}function yS(a,e){return e+10<=a.length&&a[e]===51&&a[e+1]===68&&a[e+2]===73&&a[e+3]<255&&a[e+4]<255&&a[e+6]<128&&a[e+7]<128&&a[e+8]<128&&a[e+9]<128}function Dp(a,e){return e+10<=a.length&&a[e]===73&&a[e+1]===68&&a[e+2]===51&&a[e+3]<255&&a[e+4]<255&&a[e+6]<128&&a[e+7]<128&&a[e+8]<128&&a[e+9]<128}function Jh(a,e){let s=0;return s=(a[e]&127)<<21,s|=(a[e+1]&127)<<14,s|=(a[e+2]&127)<<7,s|=a[e+3]&127,s}function Yc(a,e){const s=e;let n=0;for(;Dp(a,e);){n+=10;const i=Jh(a,e+6);n+=i,yS(a,e+10)&&(n+=10),e+=n}if(n>0)return a.subarray(s,s+n)}function VM(a,e,s,n){const i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],l=e[s+2],o=l>>2&15;if(o>12){const b=new Error(`invalid ADTS sampling index:${o}`);a.emit($.ERROR,$.ERROR,{type:rt.MEDIA_ERROR,details:Ne.FRAG_PARSING_ERROR,fatal:!0,error:b,reason:b.message});return}const d=(l>>6&3)+1,h=e[s+3]>>6&3|(l&1)<<2,u="mp4a.40."+d,f=i[o];let g=o;(d===5||d===29)&&(g-=3);const p=[d<<3|(g&14)>>1,(g&1)<<7|h<<3];return rs.log(`manifest codec:${n}, parsed codec:${u}, channels:${h}, rate:${f} (ADTS object type:${d} sampling index:${o})`),{config:p,samplerate:f,channelCount:h,codec:u,parsedCodec:u,manifestCodec:n}}function bS(a,e){return a[e]===255&&(a[e+1]&246)===240}function vS(a,e){return a[e+1]&1?7:9}function Mp(a,e){return(a[e+3]&3)<<11|a[e+4]<<3|(a[e+5]&224)>>>5}function qM(a,e){return e+5<a.length}function Rh(a,e){return e+1<a.length&&bS(a,e)}function KM(a,e){return qM(a,e)&&bS(a,e)&&Mp(a,e)<=a.length-e}function HM(a,e){if(Rh(a,e)){const s=vS(a,e);if(e+s>=a.length)return!1;const n=Mp(a,e);if(n<=s)return!1;const i=e+n;return i===a.length||Rh(a,i)}return!1}function _S(a,e,s,n,i){if(!a.samplerate){const l=VM(e,s,n,i);if(!l)return;ds(a,l)}}function NS(a){return 1024*9e4/a}function zM(a,e){const s=vS(a,e);if(e+s<=a.length){const n=Mp(a,e)-s;if(n>0)return{headerLength:s,frameLength:n}}}function wS(a,e,s,n,i){const l=NS(a.samplerate),o=n+i*l,d=zM(e,s);let h;if(d){const{frameLength:g,headerLength:p}=d,b=p+g,y=Math.max(0,s+b-e.length);y?(h=new Uint8Array(b-p),h.set(e.subarray(s+p,e.length),0)):h=e.subarray(s+p,s+b);const v={unit:h,pts:o};return y||a.samples.push(v),{sample:v,length:b,missing:y}}const u=e.length-s;return h=new Uint8Array(u),h.set(e.subarray(s,e.length),0),{sample:{unit:h,pts:o},length:u,missing:-1}}function YM(a,e){return Dp(a,e)&&Jh(a,e+6)+10<=a.length-e}function WM(a){return a instanceof ArrayBuffer?a:a.byteOffset==0&&a.byteLength==a.buffer.byteLength?a.buffer:new Uint8Array(a).buffer}function Sg(a,e=0,s=1/0){return QM(a,e,s,Uint8Array)}function QM(a,e,s,n){const i=XM(a);let l=1;"BYTES_PER_ELEMENT"in n&&(l=n.BYTES_PER_ELEMENT);const o=JM(a)?a.byteOffset:0,d=(o+a.byteLength)/l,h=(o+e)/l,u=Math.floor(Math.max(0,Math.min(h,d))),f=Math.floor(Math.min(u+Math.max(s,0),d));return new n(i,u,f-u)}function XM(a){return a instanceof ArrayBuffer?a:a.buffer}function JM(a){return a&&a.buffer instanceof ArrayBuffer&&a.byteLength!==void 0&&a.byteOffset!==void 0}function ZM(a){const e={key:a.type,description:"",data:"",mimeType:null,pictureType:null},s=3;if(a.size<2)return;if(a.data[0]!==s){console.log("Ignore frame with unrecognized character encoding");return}const n=a.data.subarray(1).indexOf(0);if(n===-1)return;const i=nn(Sg(a.data,1,n)),l=a.data[2+n],o=a.data.subarray(3+n).indexOf(0);if(o===-1)return;const d=nn(Sg(a.data,3+n,o));let h;return i==="-->"?h=nn(Sg(a.data,4+n+o)):h=WM(a.data.subarray(4+n+o)),e.mimeType=i,e.pictureType=l,e.description=d,e.data=h,e}function eI(a){if(a.size<2)return;const e=nn(a.data,!0),s=new Uint8Array(a.data.subarray(e.length+1));return{key:a.type,info:e,data:s.buffer}}function tI(a){if(a.size<2)return;if(a.type==="TXXX"){let s=1;const n=nn(a.data.subarray(s),!0);s+=n.length+1;const i=nn(a.data.subarray(s));return{key:a.type,info:n,data:i}}const e=nn(a.data.subarray(1));return{key:a.type,info:"",data:e}}function sI(a){if(a.type==="WXXX"){if(a.size<2)return;let s=1;const n=nn(a.data.subarray(s),!0);s+=n.length+1;const i=nn(a.data.subarray(s));return{key:a.type,info:n,data:i}}const e=nn(a.data);return{key:a.type,info:"",data:e}}function aI(a){return a.type==="PRIV"?eI(a):a.type[0]==="W"?sI(a):a.type==="APIC"?ZM(a):tI(a)}function nI(a){const e=String.fromCharCode(a[0],a[1],a[2],a[3]),s=Jh(a,4),n=10;return{type:e,size:s,data:a.subarray(n,n+s)}}const ku=10,iI=10;function SS(a){let e=0;const s=[];for(;Dp(a,e);){const n=Jh(a,e+6);a[e+5]>>6&1&&(e+=ku),e+=ku;const i=e+n;for(;e+iI<i;){const l=nI(a.subarray(e)),o=aI(l);o&&s.push(o),e+=l.size+ku}yS(a,e)&&(e+=ku)}return s}function jS(a){return a&&a.key==="PRIV"&&a.info==="com.apple.streaming.transportStreamTimestamp"}function rI(a){if(a.data.byteLength===8){const e=new Uint8Array(a.data),s=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,s&&(n+=4772185884e-2),Math.round(n)}}function Ip(a){const e=SS(a);for(let s=0;s<e.length;s++){const n=e[s];if(jS(n))return rI(n)}}let en=(function(a){return a.audioId3="org.id3",a.dateRange="com.apple.quicktime.HLS",a.emsg="https://aomedia.org/emsg/ID3",a.misbklv="urn:misb:KLV:bin:1910.1",a})({});function Xn(a="",e=9e4){return{type:a,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Pp{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,s,n,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,s){return!1}appendFrame(e,s,n){}demux(e,s){this.cachedData&&(e=wn(this.cachedData,e),this.cachedData=null);let n=Yc(e,0),i=n?n.length:0,l;const o=this._audioTrack,d=this._id3Track,h=n?Ip(n):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&Ze(h))&&(this.basePTS=lI(h,s,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&d.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:en.audioId3,duration:Number.POSITIVE_INFINITY});i<u;){if(this.canParse(e,i)){const f=this.appendFrame(o,e,i);f?(this.frameIndex++,this.lastPTS=f.sample.pts,i+=f.length,l=i):i=u}else YM(e,i)?(n=Yc(e,i),d.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:en.audioId3,duration:Number.POSITIVE_INFINITY}),i+=n.length,l=i):i++;if(i===u&&l!==u){const f=e.slice(l);this.cachedData?this.cachedData=wn(this.cachedData,f):this.cachedData=f}}return{audioTrack:o,videoTrack:Xn(),id3Track:d,textTrack:Xn()}}demuxSampleAes(e,s,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const s=this.cachedData;return s&&(this.cachedData=null,this.demux(s,0)),{audioTrack:this._audioTrack,videoTrack:Xn(),id3Track:this._id3Track,textTrack:Xn()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const lI=(a,e,s)=>{if(Ze(a))return a*90;const n=s?s.baseTime*9e4/s.timescale:0;return e*9e4+n};let Ru=null;const oI=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],cI=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],dI=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],uI=[0,1,1,4];function ES(a,e,s,n,i){if(s+24>e.length)return;const l=TS(e,s);if(l&&s+l.frameLength<=e.length){const o=l.samplesPerFrame*9e4/l.sampleRate,d=n+i*o,h={unit:e.subarray(s,s+l.frameLength),pts:d,dts:d};return a.config=[],a.channelCount=l.channelCount,a.samplerate=l.sampleRate,a.samples.push(h),{sample:h,length:l.frameLength,missing:0}}}function TS(a,e){const s=a[e+1]>>3&3,n=a[e+1]>>1&3,i=a[e+2]>>4&15,l=a[e+2]>>2&3;if(s!==1&&i!==0&&i!==15&&l!==3){const o=a[e+2]>>1&1,d=a[e+3]>>6,h=s===3?3-n:n===3?3:4,u=oI[h*14+i-1]*1e3,g=cI[(s===3?0:s===2?1:2)*3+l],p=d===3?1:2,b=dI[s][n],y=uI[n],v=b*8*y,_=Math.floor(b*u/g+o)*y;if(Ru===null){const T=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ru=T?parseInt(T[1]):0}return!!Ru&&Ru<=87&&n===2&&u>=224e3&&d===0&&(a[e+3]=a[e+3]|128),{sampleRate:g,channelCount:p,frameLength:_,samplesPerFrame:v}}}function Op(a,e){return a[e]===255&&(a[e+1]&224)===224&&(a[e+1]&6)!==0}function AS(a,e){return e+1<a.length&&Op(a,e)}function hI(a,e){return Op(a,e)&&4<=a.length-e}function CS(a,e){if(e+1<a.length&&Op(a,e)){const n=TS(a,e);let i=4;n!=null&&n.frameLength&&(i=n.frameLength);const l=e+i;return l===a.length||AS(a,l)}return!1}class fI extends Pp{constructor(e,s){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=s}resetInitSegment(e,s,n,i){super.resetInitSegment(e,s,n,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:s,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,s){if(!e)return!1;const n=Yc(e,0);let i=n?.length||0;if(CS(e,i))return!1;for(let l=e.length;i<l;i++)if(HM(e,i))return s.log("ADTS sync word found !"),!0;return!1}canParse(e,s){return KM(e,s)}appendFrame(e,s,n){_S(e,this.observer,s,n,e.manifestCodec);const i=wS(e,s,n,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i}}const kS=(a,e)=>{let s=0,n=5;e+=n;const i=new Uint32Array(1),l=new Uint32Array(1),o=new Uint8Array(1);for(;n>0;){o[0]=a[e];const d=Math.min(n,8),h=8-d;l[0]=4278190080>>>24+h<<h,i[0]=(o[0]&l[0])>>h,s=s?s<<d|i[0]:i[0],e+=1,n-=d}return s};class mI extends Pp{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,s,n,i){super.resetInitSegment(e,s,n,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:s,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,s){return s+64<e.length}appendFrame(e,s,n){const i=RS(e,s,n,this.basePTS,this.frameIndex);if(i!==-1)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;const s=Yc(e,0);if(!s)return!1;const n=s.length;return e[n]===11&&e[n+1]===119&&Ip(s)!==void 0&&kS(e,n)<16}}function RS(a,e,s,n,i){if(s+8>e.length||e[s]!==11||e[s+1]!==119)return-1;const l=e[s+4]>>6;if(l>=3)return-1;const d=[48e3,44100,32e3][l],h=e[s+4]&63,f=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][h*3+l]*2;if(s+f>e.length)return-1;const g=e[s+6]>>5;let p=0;g===2?p+=2:(g&1&&g!==1&&(p+=2),g&4&&(p+=2));const b=(e[s+6]<<8|e[s+7])>>12-p&1,v=[2,1,2,3,3,4,4,5][g]+b,_=e[s+5]>>3,N=e[s+5]&7,C=new Uint8Array([l<<6|_<<1|N>>2,(N&3)<<6|g<<3|b<<2|h>>4,h<<4&224]),T=1536/d*9e4,L=n+i*T,F=e.subarray(s,s+f);return a.config=C,a.channelCount=v,a.samplerate=d,a.samples.push({unit:F,pts:L}),f}class gI extends Pp{resetInitSegment(e,s,n,i){super.resetInitSegment(e,s,n,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:s,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const s=Yc(e,0);let n=s?.length||0;if(s&&e[n]===11&&e[n+1]===119&&Ip(s)!==void 0&&kS(e,n)<=16)return!1;for(let i=e.length;n<i;n++)if(CS(e,n))return rs.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,s){return hI(e,s)}appendFrame(e,s,n){if(this.basePTS!==null)return ES(e,s,n,this.basePTS,this.frameIndex)}}const pI=/\/emsg[-/]ID3/i;class xI{constructor(e,s){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=s}resetTimeStamp(){}resetInitSegment(e,s,n,i){const l=this.videoTrack=Xn("video",1),o=this.audioTrack=Xn("audio",1),d=this.txtTrack=Xn("text",1);if(this.id3Track=Xn("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const h=$w(e);if(h.video){const{id:u,timescale:f,codec:g,supplemental:p}=h.video;l.id=u,l.timescale=d.timescale=f,l.codec=g,l.supplemental=p}if(h.audio){const{id:u,timescale:f,codec:g}=h.audio;o.id=u,o.timescale=f,o.codec=g}d.id=Fw.text,l.sampleDuration=0,l.duration=o.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return m5(e)}demux(e,s){this.timeOffset=s;let n=e;const i=this.videoTrack,l=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=wn(this.remainderData,e));const d=_5(n);this.remainderData=d.remainder,i.samples=d.valid||new Uint8Array}else i.samples=n;const o=this.extractID3Track(i,s);return l.samples=w_(s,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,s=this.videoTrack,n=this.txtTrack;s.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(s,this.timeOffset);return n.samples=w_(e,s),{videoTrack:s,audioTrack:Xn(),id3Track:i,textTrack:Xn()}}extractID3Track(e,s){const n=this.id3Track;if(e.samples.length){const i=Mt(e.samples,["emsg"]);i&&i.forEach(l=>{const o=w5(l);if(pI.test(o.schemeIdUri)){const d=rN(o,s);let h=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;h<=.001&&(h=Number.POSITIVE_INFINITY);const u=o.payload;n.samples.push({data:u,len:u.byteLength,dts:d,pts:d,type:en.emsg,duration:h})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const d=rN(o,s);n.samples.push({data:o.payload,len:o.payload.byteLength,dts:d,pts:d,type:en.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,s,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function rN(a,e){return Ze(a.presentationTime)?a.presentationTime/a.timeScale:e+a.presentationTimeDelta/a.timeScale}class yI{constructor(e,s,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new Tp(s,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Cr.cbc)}decryptAacSample(e,s,n){const i=e[s].unit;if(i.length<=16)return;const l=i.subarray(16,i.length-i.length%16),o=l.buffer.slice(l.byteOffset,l.byteOffset+l.length);this.decryptBuffer(o).then(d=>{const h=new Uint8Array(d);i.set(h,16),this.decrypter.isSync()||this.decryptAacSamples(e,s+1,n)}).catch(n)}decryptAacSamples(e,s,n){for(;;s++){if(s>=e.length){n();return}if(!(e[s].unit.length<32)&&(this.decryptAacSample(e,s,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const s=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(s);let i=0;for(let l=32;l<e.length-16;l+=160,i+=16)n.set(e.subarray(l,l+16),i);return n}getAvcDecryptedUnit(e,s){const n=new Uint8Array(s);let i=0;for(let l=32;l<e.length-16;l+=160,i+=16)e.set(n.subarray(i,i+16),l);return e}decryptAvcSample(e,s,n,i,l){const o=qw(l.data),d=this.getAvcEncryptedData(o);this.decryptBuffer(d.buffer).then(h=>{l.data=this.getAvcDecryptedUnit(o,h),this.decrypter.isSync()||this.decryptAvcSamples(e,s,n+1,i)}).catch(i)}decryptAvcSamples(e,s,n,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;s++,n=0){if(s>=e.length){i();return}const l=e[s].units;for(;!(n>=l.length);n++){const o=l[n];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,s,n,i,o),!this.decrypter.isSync()))return}}}}class LS{constructor(){this.VideoSample=null}createVideoSample(e,s,n){return{key:e,frame:!1,pts:s,dts:n,units:[],length:0}}getLastNalUnit(e){var s;let n=this.VideoSample,i;if((!n||n.units.length===0)&&(n=e[e.length-1]),(s=n)!=null&&s.units){const l=n.units;i=l[l.length-1]}return i}pushAccessUnit(e,s){if(e.units.length&&e.frame){if(e.pts===void 0){const n=s.samples,i=n.length;if(i){const l=n[i-1];e.pts=l.pts,e.dts=l.dts}else{s.dropped++;return}}s.samples.push(e)}}parseNALu(e,s,n){const i=s.byteLength;let l=e.naluState||0;const o=l,d=[];let h=0,u,f,g,p=-1,b=0;for(l===-1&&(p=0,b=this.getNALuType(s,0),l=0,h=1);h<i;){if(u=s[h++],!l){l=u?0:1;continue}if(l===1){l=u?0:2;continue}if(!u)l=3;else if(u===1){if(f=h-l-1,p>=0){const y={data:s.subarray(p,f),type:b};d.push(y)}else{const y=this.getLastNalUnit(e.samples);y&&(o&&h<=4-o&&y.state&&(y.data=y.data.subarray(0,y.data.byteLength-o)),f>0&&(y.data=wn(y.data,s.subarray(0,f)),y.state=0))}h<i?(g=this.getNALuType(s,h),p=h,b=g,l=0):l=-1}else l=0}if(p>=0&&l>=0){const y={data:s.subarray(p,i),type:b,state:l};d.push(y)}if(d.length===0){const y=this.getLastNalUnit(e.samples);y&&(y.data=wn(y.data,s))}return e.naluState=l,d}}class Fc{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,s=this.bytesAvailable,n=e.byteLength-s,i=new Uint8Array(4),l=Math.min(4,s);if(l===0)throw new Error("no bytes available");i.set(e.subarray(n,n+l)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=l*8,this.bytesAvailable-=l}skipBits(e){let s;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,s=e>>3,e-=s<<3,this.bytesAvailable-=s,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let s=Math.min(this.bitsAvailable,e);const n=this.word>>>32-s;if(e>32&&rs.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=s,this.bitsAvailable>0)this.word<<=s;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return s=e-s,s>0&&this.bitsAvailable?n<<s|this.readBits(s):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class bI extends LS{parsePES(e,s,n,i){const l=this.parseNALu(e,n.data,i);let o=this.VideoSample,d,h=!1;n.data=null,o&&l.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),l.forEach(u=>{var f,g;switch(u.type){case 1:{let v=!1;d=!0;const _=u.data;if(h&&_.length>4){const N=this.readSliceType(_);(N===2||N===4||N===7||N===9)&&(v=!0)}if(v){var p;(p=o)!=null&&p.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.frame=!0,o.key=v;break}case 5:d=!0,(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 6:{d=!0,wp(u.data,1,n.pts,s.samples);break}case 7:{var b,y;d=!0,h=!0;const v=u.data,_=this.readSPS(v);if(!e.sps||e.width!==_.width||e.height!==_.height||((b=e.pixelRatio)==null?void 0:b[0])!==_.pixelRatio[0]||((y=e.pixelRatio)==null?void 0:y[1])!==_.pixelRatio[1]){e.width=_.width,e.height=_.height,e.pixelRatio=_.pixelRatio,e.sps=[v];const N=v.subarray(1,4);let C="avc1.";for(let T=0;T<3;T++){let L=N[T].toString(16);L.length<2&&(L="0"+L),C+=L}e.codec=C}break}case 8:d=!0,e.pps=[u.data];break;case 9:d=!0,e.audFound=!0,(g=o)!=null&&g.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:d=!0;break;default:d=!1;break}o&&d&&o.units.push(u)}),i&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,s){return e[s]&31}readSliceType(e){const s=new Fc(e);return s.readUByte(),s.readUEG(),s.readUEG()}skipScalingList(e,s){let n=8,i=8,l;for(let o=0;o<e;o++)i!==0&&(l=s.readEG(),i=(n+l+256)%256),n=i===0?n:i}readSPS(e){const s=new Fc(e);let n=0,i=0,l=0,o=0,d,h,u;const f=s.readUByte.bind(s),g=s.readBits.bind(s),p=s.readUEG.bind(s),b=s.readBoolean.bind(s),y=s.skipBits.bind(s),v=s.skipEG.bind(s),_=s.skipUEG.bind(s),N=this.skipScalingList.bind(this);f();const C=f();if(g(5),y(3),f(),_(),C===100||C===110||C===122||C===244||C===44||C===83||C===86||C===118||C===128){const P=p();if(P===3&&y(1),_(),_(),y(1),b())for(h=P!==3?8:12,u=0;u<h;u++)b()&&(u<6?N(16,s):N(64,s))}_();const T=p();if(T===0)p();else if(T===1)for(y(1),v(),v(),d=p(),u=0;u<d;u++)v();_(),y(1);const L=p(),F=p(),H=g(1);H===0&&y(1),y(1),b()&&(n=p(),i=p(),l=p(),o=p());let B=[1,1];if(b()&&b())switch(f()){case 1:B=[1,1];break;case 2:B=[12,11];break;case 3:B=[10,11];break;case 4:B=[16,11];break;case 5:B=[40,33];break;case 6:B=[24,11];break;case 7:B=[20,11];break;case 8:B=[32,11];break;case 9:B=[80,33];break;case 10:B=[18,11];break;case 11:B=[15,11];break;case 12:B=[64,33];break;case 13:B=[160,99];break;case 14:B=[4,3];break;case 15:B=[3,2];break;case 16:B=[2,1];break;case 255:{B=[f()<<8|f(),f()<<8|f()];break}}return{width:Math.ceil((L+1)*16-n*2-i*2),height:(2-H)*(F+1)*16-(H?2:4)*(l+o),pixelRatio:B}}}class vI extends LS{constructor(...e){super(...e),this.initVPS=null}parsePES(e,s,n,i){const l=this.parseNALu(e,n.data,i);let o=this.VideoSample,d,h=!1;n.data=null,o&&l.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),l.forEach(u=>{var f,g;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),o.frame=!0,d=!0;break;case 16:case 17:case 18:case 21:if(d=!0,h){var p;(p=o)!=null&&p.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:d=!0,(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 39:d=!0,wp(u.data,2,n.pts,s.samples);break;case 32:d=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=ds(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(d=!0,h=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const b=this.readSPS(u.data);e.width=b.width,e.height=b.height,e.pixelRatio=b.pixelRatio,e.codec=b.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const y in b.params)e.params[y]=b.params[y]}this.pushParameterSet(e.sps,u.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0;break;case 34:if(d=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const b=this.readPPS(u.data);for(const y in b)e.params[y]=b[y]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:d=!0,e.audFound=!0,(g=o)!=null&&g.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:d=!1;break}o&&d&&o.units.push(u)}),i&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,s,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(s)}getNALuType(e,s){return(e[s]&126)>>>1}ebsp2rbsp(e){const s=new Uint8Array(e.byteLength);let n=0;for(let i=0;i<e.byteLength;i++)i>=2&&e[i]===3&&e[i-1]===0&&e[i-2]===0||(s[n]=e[i],n++);return new Uint8Array(s.buffer,0,n)}pushAccessUnit(e,s){super.pushAccessUnit(e,s),this.initVPS&&(this.initVPS=null)}readVPS(e){const s=new Fc(e);s.readUByte(),s.readUByte(),s.readBits(4),s.skipBits(2),s.readBits(6);const n=s.readBits(3),i=s.readBoolean();return{numTemporalLayers:n+1,temporalIdNested:i}}readSPS(e){const s=new Fc(this.ebsp2rbsp(e));s.readUByte(),s.readUByte(),s.readBits(4);const n=s.readBits(3);s.readBoolean();const i=s.readBits(2),l=s.readBoolean(),o=s.readBits(5),d=s.readUByte(),h=s.readUByte(),u=s.readUByte(),f=s.readUByte(),g=s.readUByte(),p=s.readUByte(),b=s.readUByte(),y=s.readUByte(),v=s.readUByte(),_=s.readUByte(),N=s.readUByte(),C=[],T=[];for(let We=0;We<n;We++)C.push(s.readBoolean()),T.push(s.readBoolean());if(n>0)for(let We=n;We<8;We++)s.readBits(2);for(let We=0;We<n;We++)C[We]&&(s.readUByte(),s.readUByte(),s.readUByte(),s.readUByte(),s.readUByte(),s.readUByte(),s.readUByte(),s.readUByte(),s.readUByte(),s.readUByte(),s.readUByte()),T[We]&&s.readUByte();s.readUEG();const L=s.readUEG();L==3&&s.skipBits(1);const F=s.readUEG(),H=s.readUEG(),B=s.readBoolean();let P=0,I=0,D=0,O=0;B&&(P+=s.readUEG(),I+=s.readUEG(),D+=s.readUEG(),O+=s.readUEG());const ee=s.readUEG(),ie=s.readUEG(),Z=s.readUEG(),z=s.readBoolean();for(let We=z?0:n;We<=n;We++)s.skipUEG(),s.skipUEG(),s.skipUEG();if(s.skipUEG(),s.skipUEG(),s.skipUEG(),s.skipUEG(),s.skipUEG(),s.skipUEG(),s.readBoolean()&&s.readBoolean())for(let ot=0;ot<4;ot++)for(let Ie=0;Ie<(ot===3?2:6);Ie++)if(!s.readBoolean())s.readUEG();else{const Ht=Math.min(64,1<<4+(ot<<1));ot>1&&s.readEG();for(let As=0;As<Ht;As++)s.readEG()}s.readBoolean(),s.readBoolean(),s.readBoolean()&&(s.readUByte(),s.skipUEG(),s.skipUEG(),s.readBoolean());const te=s.readUEG();let W=0;for(let We=0;We<te;We++){let ot=!1;if(We!==0&&(ot=s.readBoolean()),ot){We===te&&s.readUEG(),s.readBoolean(),s.readUEG();let Ie=0;for(let Lt=0;Lt<=W;Lt++){const Ht=s.readBoolean();let As=!1;Ht||(As=s.readBoolean()),(Ht||As)&&Ie++}W=Ie}else{const Ie=s.readUEG(),Lt=s.readUEG();W=Ie+Lt;for(let Ht=0;Ht<Ie;Ht++)s.readUEG(),s.readBoolean();for(let Ht=0;Ht<Lt;Ht++)s.readUEG(),s.readBoolean()}}if(s.readBoolean()){const We=s.readUEG();for(let ot=0;ot<We;ot++){for(let Ie=0;Ie<Z+4;Ie++)s.readBits(1);s.readBits(1)}}let q=0,J=1,oe=1,be=!0,ye=1,Ee=0;s.readBoolean(),s.readBoolean();let re=!1;if(s.readBoolean()){if(s.readBoolean()){const Cs=s.readUByte(),Tn=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],ts=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Cs>0&&Cs<16?(J=Tn[Cs-1],oe=ts[Cs-1]):Cs===255&&(J=s.readBits(16),oe=s.readBits(16))}if(s.readBoolean()&&s.readBoolean(),s.readBoolean()&&(s.readBits(3),s.readBoolean(),s.readBoolean()&&(s.readUByte(),s.readUByte(),s.readUByte())),s.readBoolean()&&(s.readUEG(),s.readUEG()),s.readBoolean(),s.readBoolean(),s.readBoolean(),re=s.readBoolean(),re&&(s.skipUEG(),s.skipUEG(),s.skipUEG(),s.skipUEG()),s.readBoolean()&&(ye=s.readBits(32),Ee=s.readBits(32),s.readBoolean()&&s.readUEG(),s.readBoolean())){const ts=s.readBoolean(),Bn=s.readBoolean();let ua=!1;(ts||Bn)&&(ua=s.readBoolean(),ua&&(s.readUByte(),s.readBits(5),s.readBoolean(),s.readBits(5)),s.readBits(4),s.readBits(4),ua&&s.readBits(4),s.readBits(5),s.readBits(5),s.readBits(5));for(let rn=0;rn<=n;rn++){be=s.readBoolean();const ya=be||s.readBoolean();let An=!1;ya?s.readEG():An=s.readBoolean();const ln=An?1:s.readUEG()+1;if(ts)for(let Sa=0;Sa<ln;Sa++)s.readUEG(),s.readUEG(),ua&&(s.readUEG(),s.readUEG()),s.skipBits(1);if(Bn)for(let Sa=0;Sa<ln;Sa++)s.readUEG(),s.readUEG(),ua&&(s.readUEG(),s.readUEG()),s.skipBits(1)}}s.readBoolean()&&(s.readBoolean(),s.readBoolean(),s.readBoolean(),q=s.readUEG())}let Le=F,ze=H;if(B){let We=1,ot=1;L===1?We=ot=2:L==2&&(We=2),Le=F-We*I-We*P,ze=H-ot*O-ot*D}const Xe=i?["A","B","C"][i]:"",ue=d<<24|h<<16|u<<8|f;let Ge=0;for(let We=0;We<32;We++)Ge=(Ge|(ue>>We&1)<<31-We)>>>0;let Ve=Ge.toString(16);return o===1&&Ve==="2"&&(Ve="6"),{codecString:`hvc1.${Xe}${o}.${Ve}.${l?"H":"L"}${N}.B0`,params:{general_tier_flag:l,general_profile_idc:o,general_profile_space:i,general_profile_compatibility_flags:[d,h,u,f],general_constraint_indicator_flags:[g,p,b,y,v,_],general_level_idc:N,bit_depth:ee+8,bit_depth_luma_minus8:ee,bit_depth_chroma_minus8:ie,min_spatial_segmentation_idc:q,chroma_format_idc:L,frame_rate:{fixed:be,fps:Ee/ye}},width:Le,height:ze,pixelRatio:[J,oe]}}readPPS(e){const s=new Fc(this.ebsp2rbsp(e));s.readUByte(),s.readUByte(),s.skipUEG(),s.skipUEG(),s.skipBits(2),s.skipBits(3),s.skipBits(2),s.skipUEG(),s.skipUEG(),s.skipEG(),s.skipBits(2),s.readBoolean()&&s.skipUEG(),s.skipEG(),s.skipEG(),s.skipBits(4);const i=s.readBoolean(),l=s.readBoolean();let o=1;return l&&i?o=0:l?o=3:i&&(o=2),{parallelismType:o}}matchSPS(e,s){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,s).substr(3)}}const ta=188;class vr{constructor(e,s,n,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=s,this.typeSupported=n,this.logger=i,this.videoParser=null}static probe(e,s){const n=vr.syncOffset(e);return n>0&&s.warn(`MPEG2-TS detected but first sync word found @ offset ${n}`),n!==-1}static syncOffset(e){const s=e.length;let n=Math.min(ta*5,s-ta)+1,i=0;for(;i<n;){let l=!1,o=-1,d=0;for(let h=i;h<s;h+=ta)if(e[h]===71&&(s-h===ta||e[h+ta]===71)){if(d++,o===-1&&(o=h,o!==0&&(n=Math.min(o+ta*99,e.length-ta)+1)),l||(l=k0(e,h)===0),l&&d>1&&(o===0&&d>2||h+ta>n))return o}else{if(d)return-1;break}i++}return-1}static createTrack(e,s){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Fw[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?s:void 0}}resetInitSegment(e,s,n,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=vr.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=vr.createTrack("audio",i),this._id3Track=vr.createTrack("id3"),this._txtTrack=vr.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=s,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:s,_id3Track:n}=this;e&&(e.pesData=null),s&&(s.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,s,n=!1,i=!1){n||(this.sampleAes=null);let l;const o=this._videoTrack,d=this._audioTrack,h=this._id3Track,u=this._txtTrack;let f=o.pid,g=o.pesData,p=d.pid,b=h.pid,y=d.pesData,v=h.pesData,_=null,N=this.pmtParsed,C=this._pmtId,T=e.length;if(this.remainderData&&(e=wn(this.remainderData,e),T=e.length,this.remainderData=null),T<ta&&!i)return this.remainderData=e,{audioTrack:d,videoTrack:o,id3Track:h,textTrack:u};const L=Math.max(0,vr.syncOffset(e));T-=(T-L)%ta,T<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,T,e.buffer.byteLength-T));let F=0;for(let B=L;B<T;B+=ta)if(e[B]===71){const P=!!(e[B+1]&64),I=k0(e,B),D=(e[B+3]&48)>>4;let O;if(D>1){if(O=B+5+e[B+4],O===B+ta)continue}else O=B+4;switch(I){case f:P&&(g&&(l=no(g,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,u,l,!1)),g={data:[],size:0}),g&&(g.data.push(e.subarray(O,B+ta)),g.size+=B+ta-O);break;case p:if(P){if(y&&(l=no(y,this.logger)))switch(d.segmentCodec){case"aac":this.parseAACPES(d,l);break;case"mp3":this.parseMPEGPES(d,l);break;case"ac3":this.parseAC3PES(d,l);break}y={data:[],size:0}}y&&(y.data.push(e.subarray(O,B+ta)),y.size+=B+ta-O);break;case b:P&&(v&&(l=no(v,this.logger))&&this.parseID3PES(h,l),v={data:[],size:0}),v&&(v.data.push(e.subarray(O,B+ta)),v.size+=B+ta-O);break;case 0:P&&(O+=e[O]+1),C=this._pmtId=_I(e,O);break;case C:{P&&(O+=e[O]+1);const ee=NI(e,O,this.typeSupported,n,this.observer,this.logger);f=ee.videoPid,f>0&&(o.pid=f,o.segmentCodec=ee.segmentVideoCodec),p=ee.audioPid,p>0&&(d.pid=p,d.segmentCodec=ee.segmentAudioCodec),b=ee.id3Pid,b>0&&(h.pid=b),_!==null&&!N&&(this.logger.warn(`MPEG-TS PMT found at ${B} after unknown PID '${_}'. Backtracking to sync byte @${L} to parse all TS packets.`),_=null,B=L-188),N=this.pmtParsed=!0;break}case 17:case 8191:break;default:_=I;break}}else F++;F>0&&R0(this.observer,new Error(`Found ${F} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=g,d.pesData=y,h.pesData=v;const H={audioTrack:d,videoTrack:o,id3Track:h,textTrack:u};return i&&this.extractRemainingSamples(H),H}flush(){const{remainderData:e}=this;this.remainderData=null;let s;return e?s=this.demux(e,-1,!1,!0):s={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(s),this.sampleAes?this.decrypt(s,this.sampleAes):s}extractRemainingSamples(e){const{audioTrack:s,videoTrack:n,id3Track:i,textTrack:l}=e,o=n.pesData,d=s.pesData,h=i.pesData;let u;if(o&&(u=no(o,this.logger))?(this.readyVideoParser(n.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(n,l,u,!0),n.pesData=null)):n.pesData=o,d&&(u=no(d,this.logger))){switch(s.segmentCodec){case"aac":this.parseAACPES(s,u);break;case"mp3":this.parseMPEGPES(s,u);break;case"ac3":this.parseAC3PES(s,u);break}s.pesData=null}else d!=null&&d.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),s.pesData=d;h&&(u=no(h,this.logger))?(this.parseID3PES(i,u),i.pesData=null):i.pesData=h}demuxSampleAes(e,s,n){const i=this.demux(e,n,!0,!this.config.progressive),l=this.sampleAes=new yI(this.observer,this.config,s);return this.decrypt(i,l)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new bI:e==="hevc"&&(this.videoParser=new vI))}decrypt(e,s){return new Promise(n=>{const{audioTrack:i,videoTrack:l}=e;i.samples&&i.segmentCodec==="aac"?s.decryptAacSamples(i.samples,0,()=>{l.samples?s.decryptAvcSamples(l.samples,0,0,()=>{n(e)}):n(e)}):l.samples&&s.decryptAvcSamples(l.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,s){let n=0;const i=this.aacOverFlow;let l=s.data;if(i){this.aacOverFlow=null;const g=i.missing,p=i.sample.unit.byteLength;if(g===-1)l=wn(i.sample.unit,l);else{const b=p-g;i.sample.unit.set(l.subarray(0,g),b),e.samples.push(i.sample),n=i.missing}}let o,d;for(o=n,d=l.length;o<d-1&&!Rh(l,o);o++);if(o!==n){let g;const p=o<d-1;if(p?g=`AAC PES did not start with ADTS header,offset:${o}`:g="No ADTS header found in AAC PES",R0(this.observer,new Error(g),p,this.logger),!p)return}_S(e,this.observer,l,o,this.audioCodec);let h;if(s.pts!==void 0)h=s.pts;else if(i){const g=NS(e.samplerate);h=i.sample.pts+g}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,f;for(;o<d;)if(f=wS(e,l,o,h,u),o+=f.length,f.missing){this.aacOverFlow=f;break}else for(u++;o<d-1&&!Rh(l,o);o++);}parseMPEGPES(e,s){const n=s.data,i=n.length;let l=0,o=0;const d=s.pts;if(d===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<i;)if(AS(n,o)){const h=ES(e,n,o,d,l);if(h)o+=h.length,l++;else break}else o++}parseAC3PES(e,s){{const n=s.data,i=s.pts;if(i===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const l=n.length;let o=0,d=0,h;for(;d<l&&(h=RS(e,n,d,i,o++))>0;)d+=h}}parseID3PES(e,s){if(s.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=ds({},s,{type:this._videoTrack?en.emsg:en.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function k0(a,e){return((a[e+1]&31)<<8)+a[e+2]}function _I(a,e){return(a[e+10]&31)<<8|a[e+11]}function NI(a,e,s,n,i,l){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},d=(a[e+1]&15)<<8|a[e+2],h=e+3+d-4,u=(a[e+10]&15)<<8|a[e+11];for(e+=12+u;e<h;){const f=k0(a,e),g=(a[e+3]&15)<<8|a[e+4];switch(a[e]){case 207:if(!n){jg("ADTS AAC",l);break}case 15:o.audioPid===-1&&(o.audioPid=f);break;case 21:o.id3Pid===-1&&(o.id3Pid=f);break;case 219:if(!n){jg("H.264",l);break}case 27:o.videoPid===-1&&(o.videoPid=f);break;case 3:case 4:!s.mpeg&&!s.mp3?l.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=f,o.segmentAudioCodec="mp3");break;case 193:if(!n){jg("AC-3",l);break}case 129:s.ac3?o.audioPid===-1&&(o.audioPid=f,o.segmentAudioCodec="ac3"):l.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&g>0){let p=e+5,b=g;for(;b>2;){switch(a[p]){case 106:s.ac3!==!0?l.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=f,o.segmentAudioCodec="ac3");break}const v=a[p+1]+2;p+=v,b-=v}}break;case 194:case 135:return R0(i,new Error("Unsupported EC-3 in M2TS found"),void 0,l),o;case 36:o.videoPid===-1&&(o.videoPid=f,o.segmentVideoCodec="hevc",l.log("HEVC in M2TS found"));break}e+=g+5}return o}function R0(a,e,s,n){n.warn(`parsing error: ${e.message}`),a.emit($.ERROR,$.ERROR,{type:rt.MEDIA_ERROR,details:Ne.FRAG_PARSING_ERROR,fatal:!1,levelRetry:s,error:e,reason:e.message})}function jg(a,e){e.log(`${a} with AES-128-CBC encryption found in unencrypted stream`)}function no(a,e){let s=0,n,i,l,o,d;const h=a.data;if(!a||a.size===0)return null;for(;h[0].length<19&&h.length>1;)h[0]=wn(h[0],h[1]),h.splice(1,1);if(n=h[0],(n[0]<<16)+(n[1]<<8)+n[2]===1){if(i=(n[4]<<8)+n[5],i&&i>a.size-6)return null;const f=n[7];f&192&&(o=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,f&64?(d=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,o-d>60*9e4&&(e.warn(`${Math.round((o-d)/9e4)}s delta between PTS and DTS, align them`),o=d)):d=o),l=n[8];let g=l+9;if(a.size<=g)return null;a.size-=g;const p=new Uint8Array(a.size);for(let b=0,y=h.length;b<y;b++){n=h[b];let v=n.byteLength;if(g)if(g>v){g-=v;continue}else n=n.subarray(g),v-=g,g=0;p.set(n,s),s+=v}return i&&(i-=l+3),{data:p,pts:o,dts:d,len:i}}return null}class wI{static getSilentFrame(e,s){switch(e){case"mp4a.40.2":if(s===1)return new Uint8Array([0,200,0,128,35,128]);if(s===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(s===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(s===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(s===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(s===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(s===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(s===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(s===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const mr=Math.pow(2,32)-1;class _e{static init(){_e.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in _e.types)_e.types.hasOwnProperty(e)&&(_e.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const s=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);_e.HDLR_TYPES={video:s,audio:n};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),l=new Uint8Array([0,0,0,0,0,0,0,0]);_e.STTS=_e.STSC=_e.STCO=l,_e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),_e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),_e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),_e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),d=new Uint8Array([97,118,99,49]),h=new Uint8Array([0,0,0,1]);_e.FTYP=_e.box(_e.types.ftyp,o,h,o,d),_e.DINF=_e.box(_e.types.dinf,_e.box(_e.types.dref,i))}static box(e,...s){let n=8,i=s.length;const l=i;for(;i--;)n+=s[i].byteLength;const o=new Uint8Array(n);for(o[0]=n>>24&255,o[1]=n>>16&255,o[2]=n>>8&255,o[3]=n&255,o.set(e,4),i=0,n=8;i<l;i++)o.set(s[i],n),n+=s[i].byteLength;return o}static hdlr(e){return _e.box(_e.types.hdlr,_e.HDLR_TYPES[e])}static mdat(e){return _e.box(_e.types.mdat,e)}static mdhd(e,s){s*=e;const n=Math.floor(s/(mr+1)),i=Math.floor(s%(mr+1));return _e.box(_e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))}static mdia(e){return _e.box(_e.types.mdia,_e.mdhd(e.timescale||0,e.duration||0),_e.hdlr(e.type),_e.minf(e))}static mfhd(e){return _e.box(_e.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?_e.box(_e.types.minf,_e.box(_e.types.smhd,_e.SMHD),_e.DINF,_e.stbl(e)):_e.box(_e.types.minf,_e.box(_e.types.vmhd,_e.VMHD),_e.DINF,_e.stbl(e))}static moof(e,s,n){return _e.box(_e.types.moof,_e.mfhd(e),_e.traf(n,s))}static moov(e){let s=e.length;const n=[];for(;s--;)n[s]=_e.trak(e[s]);return _e.box.apply(null,[_e.types.moov,_e.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(_e.mvex(e)))}static mvex(e){let s=e.length;const n=[];for(;s--;)n[s]=_e.trex(e[s]);return _e.box.apply(null,[_e.types.mvex,...n])}static mvhd(e,s){s*=e;const n=Math.floor(s/(mr+1)),i=Math.floor(s%(mr+1)),l=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return _e.box(_e.types.mvhd,l)}static sdtp(e){const s=e.samples||[],n=new Uint8Array(4+s.length);let i,l;for(i=0;i<s.length;i++)l=s[i].flags,n[i+4]=l.dependsOn<<4|l.isDependedOn<<2|l.hasRedundancy;return _e.box(_e.types.sdtp,n)}static stbl(e){return _e.box(_e.types.stbl,_e.stsd(e),_e.box(_e.types.stts,_e.STTS),_e.box(_e.types.stsc,_e.STSC),_e.box(_e.types.stsz,_e.STSZ),_e.box(_e.types.stco,_e.STCO))}static avc1(e){let s=[],n=[],i,l,o;for(i=0;i<e.sps.length;i++)l=e.sps[i],o=l.byteLength,s.push(o>>>8&255),s.push(o&255),s=s.concat(Array.prototype.slice.call(l));for(i=0;i<e.pps.length;i++)l=e.pps[i],o=l.byteLength,n.push(o>>>8&255),n.push(o&255),n=n.concat(Array.prototype.slice.call(l));const d=_e.box(_e.types.avcC,new Uint8Array([1,s[3],s[4],s[5],255,224|e.sps.length].concat(s).concat([e.pps.length]).concat(n))),h=e.width,u=e.height,f=e.pixelRatio[0],g=e.pixelRatio[1];return _e.box(_e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,_e.box(_e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),_e.box(_e.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,g>>24,g>>16&255,g>>8&255,g&255])))}static esds(e){const s=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...s,6,1,2])}static audioStsd(e){const s=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,s>>8&255,s&255,0,0])}static mp4a(e){return _e.box(_e.types.mp4a,_e.audioStsd(e),_e.box(_e.types.esds,_e.esds(e)))}static mp3(e){return _e.box(_e.types[".mp3"],_e.audioStsd(e))}static ac3(e){return _e.box(_e.types["ac-3"],_e.audioStsd(e),_e.box(_e.types.dac3,e.config))}static stsd(e){const{segmentCodec:s}=e;if(e.type==="audio"){if(s==="aac")return _e.box(_e.types.stsd,_e.STSD,_e.mp4a(e));if(s==="ac3"&&e.config)return _e.box(_e.types.stsd,_e.STSD,_e.ac3(e));if(s==="mp3"&&e.codec==="mp3")return _e.box(_e.types.stsd,_e.STSD,_e.mp3(e))}else if(e.pps&&e.sps){if(s==="avc")return _e.box(_e.types.stsd,_e.STSD,_e.avc1(e));if(s==="hevc"&&e.vps)return _e.box(_e.types.stsd,_e.STSD,_e.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${s}/${e.codec})`)}static tkhd(e){const s=e.id,n=(e.duration||0)*(e.timescale||0),i=e.width||0,l=e.height||0,o=Math.floor(n/(mr+1)),d=Math.floor(n%(mr+1));return _e.box(_e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,s>>24&255,s>>16&255,s>>8&255,s&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,d>>24,d>>16&255,d>>8&255,d&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,l>>8&255,l&255,0,0]))}static traf(e,s){const n=_e.sdtp(e),i=e.id,l=Math.floor(s/(mr+1)),o=Math.floor(s%(mr+1));return _e.box(_e.types.traf,_e.box(_e.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),_e.box(_e.types.tfdt,new Uint8Array([1,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,o>>24,o>>16&255,o>>8&255,o&255])),_e.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,_e.box(_e.types.trak,_e.tkhd(e),_e.mdia(e))}static trex(e){const s=e.id;return _e.box(_e.types.trex,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,s){const n=e.samples||[],i=n.length,l=12+16*i,o=new Uint8Array(l);let d,h,u,f,g,p;for(s+=8+l,o.set([e.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255],0),d=0;d<i;d++)h=n[d],u=h.duration,f=h.size,g=h.flags,p=h.cts,o.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,g.isLeading<<2|g.dependsOn,g.isDependedOn<<6|g.hasRedundancy<<4|g.paddingValue<<1|g.isNonSync,g.degradPrio&61440,g.degradPrio&15,p>>>24&255,p>>>16&255,p>>>8&255,p&255],12+16*d);return _e.box(_e.types.trun,o)}static initSegment(e){_e.types||_e.init();const s=_e.moov(e);return wn(_e.FTYP,s)}static hvc1(e){const s=e.params,n=[e.vps,e.sps,e.pps],i=4,l=new Uint8Array([1,s.general_profile_space<<6|(s.general_tier_flag?32:0)|s.general_profile_idc,s.general_profile_compatibility_flags[0],s.general_profile_compatibility_flags[1],s.general_profile_compatibility_flags[2],s.general_profile_compatibility_flags[3],s.general_constraint_indicator_flags[0],s.general_constraint_indicator_flags[1],s.general_constraint_indicator_flags[2],s.general_constraint_indicator_flags[3],s.general_constraint_indicator_flags[4],s.general_constraint_indicator_flags[5],s.general_level_idc,240|s.min_spatial_segmentation_idc>>8,255&s.min_spatial_segmentation_idc,252|s.parallelismType,252|s.chroma_format_idc,248|s.bit_depth_luma_minus8,248|s.bit_depth_chroma_minus8,0,parseInt(s.frame_rate.fps),i-1|s.temporal_id_nested<<2|s.num_temporal_layers<<3|(s.frame_rate.fixed?64:0),n.length]);let o=l.length;for(let y=0;y<n.length;y+=1){o+=3;for(let v=0;v<n[y].length;v+=1)o+=2+n[y][v].length}const d=new Uint8Array(o);d.set(l,0),o=l.length;const h=n.length-1;for(let y=0;y<n.length;y+=1){d.set(new Uint8Array([32+y|(y===h?128:0),0,n[y].length]),o),o+=3;for(let v=0;v<n[y].length;v+=1)d.set(new Uint8Array([n[y][v].length>>8,n[y][v].length&255]),o),o+=2,d.set(n[y][v],o),o+=n[y][v].length}const u=_e.box(_e.types.hvcC,d),f=e.width,g=e.height,p=e.pixelRatio[0],b=e.pixelRatio[1];return _e.box(_e.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,g>>8&255,g&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,_e.box(_e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),_e.box(_e.types.pasp,new Uint8Array([p>>24,p>>16&255,p>>8&255,p&255,b>>24,b>>16&255,b>>8&255,b&255])))}}_e.types=void 0;_e.HDLR_TYPES=void 0;_e.STTS=void 0;_e.STSC=void 0;_e.STCO=void 0;_e.STSZ=void 0;_e.VMHD=void 0;_e.SMHD=void 0;_e.STSD=void 0;_e.FTYP=void 0;_e.DINF=void 0;const DS=9e4;function Fp(a,e,s=1,n=!1){const i=a*e*s;return n?Math.round(i):i}function SI(a,e,s=1,n=!1){return Fp(a,e,1/s,n)}function Cc(a,e=!1){return Fp(a,1e3,1/DS,e)}function jI(a,e=1){return Fp(a,DS,1/e)}function lN(a){const{baseTime:e,timescale:s,trackId:n}=a;return`${e/s} (${e}/${s}) trackId: ${n}`}const EI=10*1e3,TI=1024,AI=1152,CI=1536;let io=null,Eg=null;function oN(a,e,s,n){return{duration:e,size:s,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:a?2:1,isNonSync:a?0:1}}}class ih extends En{constructor(e,s,n,i){if(super("mp4-remuxer",i),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=s,this.typeSupported=n,this.ISGenerated=!1,io===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);io=o?parseInt(o[1]):0}if(Eg===null){const l=navigator.userAgent.match(/Safari\/(\d+)/i);Eg=l?parseInt(l[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const s=this._initPTS;(!s||!e||e.trackId!==s.trackId||e.baseTime!==s.baseTime||e.timescale!==s.timescale)&&this.log(`Reset initPTS: ${s&&lN(s)} > ${e&&lN(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let s=!1;const n=e[0].pts,i=e.reduce((l,o)=>{let d=o.pts,h=d-l;return h<-4294967296&&(s=!0,d=Za(d,n),h=d-l),h>0?l:d},n);return s&&this.debug("PTS rollover detected"),i}remux(e,s,n,i,l,o,d,h){let u,f,g,p,b,y,v=l,_=l;const N=e.pid>-1,C=s.pid>-1,T=s.samples.length,L=e.samples.length>0,F=d&&T>0||T>1;if((!N||L)&&(!C||F)||this.ISGenerated||d){if(this.ISGenerated){var B,P,I,D;const Z=this.videoTrackConfig;(Z&&(s.width!==Z.width||s.height!==Z.height||((B=s.pixelRatio)==null?void 0:B[0])!==((P=Z.pixelRatio)==null?void 0:P[0])||((I=s.pixelRatio)==null?void 0:I[1])!==((D=Z.pixelRatio)==null?void 0:D[1]))||!Z&&F||this.nextAudioTs===null&&L)&&this.resetInitSegment()}this.ISGenerated||(g=this.generateIS(e,s,l,o));const O=this.isVideoContiguous;let ee=-1,ie;if(F&&(ee=kI(s.samples),!O&&this.config.forceKeyFrameOnDiscontinuity))if(y=!0,ee>0){this.warn(`Dropped ${ee} out of ${T} video samples due to a missing keyframe`);const Z=this.getVideoStartPts(s.samples);s.samples=s.samples.slice(ee),s.dropped+=ee,_+=(s.samples[0].pts-Z)/s.inputTimeScale,ie=_}else ee===-1&&(this.warn(`No keyframe found out of ${T} video samples`),y=!1);if(this.ISGenerated){if(L&&F){const Z=this.getVideoStartPts(s.samples),X=(Za(e.samples[0].pts,Z)-Z)/s.inputTimeScale;v+=Math.max(0,X),_+=Math.max(0,-X)}if(L){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),g=this.generateIS(e,s,l,o)),f=this.remuxAudio(e,v,this.isAudioContiguous,o,C||F||h===et.AUDIO?_:void 0),F){const Z=f?f.endPTS-f.startPTS:0;s.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),g=this.generateIS(e,s,l,o)),u=this.remuxVideo(s,_,O,Z)}}else F&&(u=this.remuxVideo(s,_,O,0));u&&(u.firstKeyFrame=ee,u.independent=ee!==-1,u.firstKeyFramePTS=ie)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(b=MS(n,l,this._initPTS,this._initDTS)),i.samples.length&&(p=IS(i,l,this._initPTS))),{audio:f,video:u,initSegment:g,independent:y,text:p,id3:b}}computeInitPts(e,s,n,i){const l=Math.round(n*s);let o=Za(e,l);if(o<l+s)for(this.log(`Adjusting PTS for rollover in timeline near ${(l-o)/s} ${i}`);o<l+s;)o+=8589934592;return o-l}generateIS(e,s,n,i){const l=e.samples,o=s.samples,d=this.typeSupported,h={},u=this._initPTS;let f=!u||i,g="audio/mp4",p,b,y,v=-1;if(f&&(p=b=1/0),e.config&&l.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":d.mpeg?(g="audio/mpeg",e.codec=""):d.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}h.audio={id:"audio",container:g,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&d.mpeg?new Uint8Array(0):_e.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(v=e.id,y=e.inputTimeScale,!u||y!==u.timescale?p=b=this.computeInitPts(l[0].pts,y,n,"audio"):f=!1)}if(s.sps&&s.pps&&o.length){if(s.timescale=s.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:s.codec,initSegment:_e.initSegment([s]),metadata:{width:s.width,height:s.height}},f)if(v=s.id,y=s.inputTimeScale,!u||y!==u.timescale){const _=this.getVideoStartPts(o),N=Za(o[0].dts,_),C=this.computeInitPts(N,y,n,"video"),T=this.computeInitPts(_,y,n,"video");b=Math.min(b,C),p=Math.min(p,T)}else f=!1;this.videoTrackConfig={width:s.width,height:s.height,pixelRatio:s.pixelRatio}}if(Object.keys(h).length)return this.ISGenerated=!0,f?(u&&this.warn(`Timestamps at playlist time: ${i?"":"~"}${n} ${p/y} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${p/y} (${p}/${y}) trackId: ${v}`),this._initPTS={baseTime:p,timescale:y,trackId:v},this._initDTS={baseTime:b,timescale:y,trackId:v}):p=y=void 0,{tracks:h,initPTS:p,timescale:y,trackId:v}}remuxVideo(e,s,n,i){const l=e.inputTimeScale,o=e.samples,d=[],h=o.length,u=this._initPTS,f=u.baseTime*l/u.timescale;let g=this.nextVideoTs,p=8,b=this.videoSampleDuration,y,v,_=Number.POSITIVE_INFINITY,N=Number.NEGATIVE_INFINITY,C=!1;if(!n||g===null){const q=f+s*l,J=o[0].pts-Za(o[0].dts,o[0].pts);io&&g!==null&&Math.abs(q-J-(g+f))<15e3?n=!0:g=q-J-f}const T=g+f;for(let q=0;q<h;q++){const J=o[q];J.pts=Za(J.pts,T),J.dts=Za(J.dts,T),J.dts<o[q>0?q-1:q].dts&&(C=!0)}C&&o.sort(function(q,J){const oe=q.dts-J.dts,be=q.pts-J.pts;return oe||be}),y=o[0].dts,v=o[o.length-1].dts;const L=v-y,F=L?Math.round(L/(h-1)):b||e.inputTimeScale/30;if(n){const q=y-T,J=q>F,oe=q<-1;if((J||oe)&&(J?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Cc(q,!0)} ms (${q}dts) hole between fragments detected at ${s.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Cc(-q,!0)} ms (${q}dts) overlapping between fragments detected at ${s.toFixed(3)}`),!oe||T>=o[0].pts||io)){y=T;const be=o[0].pts-q;if(J)o[0].dts=y,o[0].pts=be;else{let ye=!0;for(let Ee=0;Ee<o.length&&!(o[Ee].dts>be&&ye);Ee++){const re=o[Ee].pts;if(o[Ee].dts-=q,o[Ee].pts-=q,Ee<o.length-1){const fe=o[Ee+1].pts,Le=o[Ee].pts,ze=fe<=Le,Xe=fe<=re;ye=ze==Xe}}}this.log(`Video: Initial PTS/DTS adjusted: ${Cc(be,!0)}/${Cc(y,!0)}, delta: ${Cc(q,!0)} ms`)}}y=Math.max(0,y);let H=0,B=0,P=y;for(let q=0;q<h;q++){const J=o[q],oe=J.units,be=oe.length;let ye=0;for(let Ee=0;Ee<be;Ee++)ye+=oe[Ee].data.length;B+=ye,H+=be,J.length=ye,J.dts<P?(J.dts=P,P+=F/4|0||1):P=J.dts,_=Math.min(J.pts,_),N=Math.max(J.pts,N)}v=o[h-1].dts;const I=B+4*H+8;let D;try{D=new Uint8Array(I)}catch(q){this.observer.emit($.ERROR,$.ERROR,{type:rt.MUX_ERROR,details:Ne.REMUX_ALLOC_ERROR,fatal:!1,error:q,bytes:I,reason:`fail allocating video mdat ${I}`});return}const O=new DataView(D.buffer);O.setUint32(0,I),D.set(_e.types.mdat,4);let ee=!1,ie=Number.POSITIVE_INFINITY,Z=Number.POSITIVE_INFINITY,z=Number.NEGATIVE_INFINITY,X=Number.NEGATIVE_INFINITY;for(let q=0;q<h;q++){const J=o[q],oe=J.units;let be=0;for(let re=0,fe=oe.length;re<fe;re++){const Le=oe[re],ze=Le.data,Xe=Le.data.byteLength;O.setUint32(p,Xe),p+=4,D.set(ze,p),p+=Xe,be+=4+Xe}let ye;if(q<h-1)b=o[q+1].dts-J.dts,ye=o[q+1].pts-J.pts;else{const re=this.config,fe=q>0?J.dts-o[q-1].dts:F;if(ye=q>0?J.pts-o[q-1].pts:F,re.stretchShortVideoTrack&&this.nextAudioTs!==null){const Le=Math.floor(re.maxBufferHole*l),ze=(i?_+i*l:this.nextAudioTs+f)-J.pts;ze>Le?(b=ze-fe,b<0?b=fe:ee=!0,this.log(`It is approximately ${ze/90} ms to the next segment; using duration ${b/90} ms for the last video frame.`)):b=fe}else b=fe}const Ee=Math.round(J.pts-J.dts);ie=Math.min(ie,b),z=Math.max(z,b),Z=Math.min(Z,ye),X=Math.max(X,ye),d.push(oN(J.key,b,be,Ee))}if(d.length){if(io){if(io<70){const q=d[0].flags;q.dependsOn=2,q.isNonSync=0}}else if(Eg&&X-Z<z-ie&&F/z<.025&&d[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let q=y;for(let J=0,oe=d.length;J<oe;J++){const be=q+d[J].duration,ye=q+d[J].cts;if(J<oe-1){const Ee=be+d[J+1].cts;d[J].duration=Ee-ye}else d[J].duration=J?d[J-1].duration:F;d[J].cts=0,q=be}}}b=ee||!b?F:b;const ae=v+b;this.nextVideoTs=g=ae-f,this.videoSampleDuration=b,this.isVideoContiguous=!0;const K={data1:_e.moof(e.sequenceNumber++,y,ds(e,{samples:d})),data2:D,startPTS:(_-f)/l,endPTS:(N+b-f)/l,startDTS:(y-f)/l,endDTS:g/l,type:"video",hasAudio:!1,hasVideo:!0,nb:d.length,dropped:e.dropped};return e.samples=[],e.dropped=0,K}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return AI;case"ac3":return CI;default:return TI}}remuxAudio(e,s,n,i,l){const o=e.inputTimeScale,d=e.samplerate?e.samplerate:o,h=o/d,u=this.getSamplesPerFrame(e),f=u*h,g=this._initPTS,p=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,b=[],y=l!==void 0;let v=e.samples,_=p?0:8,N=this.nextAudioTs||-1;const C=g.baseTime*o/g.timescale,T=C+s*o;if(this.isAudioContiguous=n=n||v.length&&N>0&&(i&&Math.abs(T-(N+C))<9e3||Math.abs(Za(v[0].pts,T)-(N+C))<20*f),v.forEach(function(X){X.pts=Za(X.pts,T)}),!n||N<0){const X=v.length;if(v=v.filter(ae=>ae.pts>=0),X!==v.length&&this.warn(`Removed ${v.length-X} of ${X} samples (initPTS ${C} / ${o})`),!v.length)return;l===0?N=0:i&&!y?N=Math.max(0,T-C):N=v[0].pts-C}if(e.segmentCodec==="aac"){const X=this.config.maxAudioFramesDrift;for(let ae=0,te=N+C;ae<v.length;ae++){const W=v[ae],K=W.pts,q=K-te,J=Math.abs(1e3*q/o);if(q<=-X*f&&y)ae===0&&(this.warn(`Audio frame @ ${(K/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*q/o)} ms.`),this.nextAudioTs=N=K-C,te=K);else if(q>=X*f&&J<EI&&y){let oe=Math.round(q/f);for(te=K-oe*f;te<0&&oe&&f;)oe--,te+=f;ae===0&&(this.nextAudioTs=N=te-C),this.warn(`Injecting ${oe} audio frames @ ${((te-C)/o).toFixed(3)}s due to ${Math.round(1e3*q/o)} ms gap.`);for(let be=0;be<oe;be++){let ye=wI.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ye||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ye=W.unit.subarray()),v.splice(ae,0,{unit:ye,pts:te}),te+=f,ae++}}W.pts=te,te+=f}}let L=null,F=null,H,B=0,P=v.length;for(;P--;)B+=v[P].unit.byteLength;for(let X=0,ae=v.length;X<ae;X++){const te=v[X],W=te.unit;let K=te.pts;if(F!==null){const J=b[X-1];J.duration=Math.round((K-F)/h)}else if(n&&e.segmentCodec==="aac"&&(K=N+C),L=K,B>0){B+=_;try{H=new Uint8Array(B)}catch(J){this.observer.emit($.ERROR,$.ERROR,{type:rt.MUX_ERROR,details:Ne.REMUX_ALLOC_ERROR,fatal:!1,error:J,bytes:B,reason:`fail allocating audio mdat ${B}`});return}p||(new DataView(H.buffer).setUint32(0,B),H.set(_e.types.mdat,4))}else return;H.set(W,_);const q=W.byteLength;_+=q,b.push(oN(!0,u,q,0)),F=K}const I=b.length;if(!I)return;const D=b[b.length-1];N=F-C,this.nextAudioTs=N+h*D.duration;const O=p?new Uint8Array(0):_e.moof(e.sequenceNumber++,L/h,ds({},e,{samples:b}));e.samples=[];const ee=(L-C)/o,ie=this.nextAudioTs/o,z={data1:O,data2:H,startPTS:ee,endPTS:ie,startDTS:ee,endDTS:ie,type:"audio",hasAudio:!0,hasVideo:!1,nb:I};return this.isAudioContiguous=!0,z}}function Za(a,e){let s;if(e===null)return a;for(e<a?s=-8589934592:s=8589934592;Math.abs(a-e)>4294967296;)a+=s;return a}function kI(a){for(let e=0;e<a.length;e++)if(a[e].key)return e;return-1}function MS(a,e,s,n){const i=a.samples.length;if(!i)return;const l=a.inputTimeScale;for(let d=0;d<i;d++){const h=a.samples[d];h.pts=Za(h.pts-s.baseTime*l/s.timescale,e*l)/l,h.dts=Za(h.dts-n.baseTime*l/n.timescale,e*l)/l}const o=a.samples;return a.samples=[],{samples:o}}function IS(a,e,s){const n=a.samples.length;if(!n)return;const i=a.inputTimeScale;for(let o=0;o<n;o++){const d=a.samples[o];d.pts=Za(d.pts-s.baseTime*i/s.timescale,e*i)/i}a.samples.sort((o,d)=>o.pts-d.pts);const l=a.samples;return a.samples=[],{samples:l}}class RI extends En{constructor(e,s,n,i){super("passthrough-remuxer",i),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const s=this.initPTS;s&&e&&s.baseTime===e.baseTime&&s.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,s,n,i){this.audioCodec=s,this.videoCodec=n,this.generateInitSegment(e,i),this.emitInitSegment=!0}generateInitSegment(e,s){let{audioCodec:n,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:l,video:o}=this.initData=$w(e);if(s)y5(e,s);else{const h=l||o;h!=null&&h.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${h.codec}")!`)}l&&(n=cN(l,fs.AUDIO,this)),o&&(i=cN(o,fs.VIDEO,this));const d={};l&&o?d.audiovideo={container:"video/mp4",codec:n+","+i,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:l?d.audio={container:"audio/mp4",codec:n,encrypted:l.encrypted,initSegment:e,id:"audio"}:o?d.video={container:"video/mp4",codec:i,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=d}remux(e,s,n,i,l,o){var d,h;let{initPTS:u,lastEndTime:f}=this;const g={audio:void 0,video:void 0,text:i,id3:n,initSegment:void 0};Ze(f)||(f=this.lastEndTime=l||0);const p=s.samples;if(!p.length)return g;const b={initPTS:void 0,timescale:void 0,trackId:void 0};let y=this.initData;if((d=y)!=null&&d.length||(this.generateInitSegment(p),y=this.initData),!((h=y)!=null&&h.length))return this.warn("Failed to generate initSegment."),g;this.emitInitSegment&&(b.tracks=this.initTracks,this.emitInitSegment=!1);const v=v5(p,y,this),_=y.audio?v[y.audio.id]:null,N=y.video?v[y.video.id]:null,C=Lu(N,1/0),T=Lu(_,1/0),L=Lu(N,0,!0),F=Lu(_,0,!0);let H=l,B=0;const P=_&&(!N||!u&&T<C||u&&u.trackId===y.audio.id),I=P?_:N;if(I){const te=I.timescale,W=I.start-l*te,K=P?y.audio.id:y.video.id;H=I.start/te,B=P?F-T:L-C,(o||!u)&&(LI(u,H,l,B)||te!==u.timescale)&&(u&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${l} ${W/te} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${l} offset: ${H-l} (${W}/${te}) trackId: ${K}`),u=null,b.initPTS=W,b.timescale=te,b.trackId=K)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${l}`);u?(b.initPTS=u.baseTime,b.timescale=u.timescale,b.trackId=u.trackId):((!b.timescale||b.trackId===void 0||b.initPTS===void 0)&&(this.warn("Could not set initPTS"),b.initPTS=H,b.timescale=1,b.trackId=-1),this.initPTS=u={baseTime:b.initPTS,timescale:b.timescale,trackId:b.trackId});const D=H-u.baseTime/u.timescale,O=D+B;B>0?this.lastEndTime=O:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const ee=!!y.audio,ie=!!y.video;let Z="";ee&&(Z+="audio"),ie&&(Z+="video");const z=(y.audio?y.audio.encrypted:!1)||(y.video?y.video.encrypted:!1),X={data1:p,startPTS:D,startDTS:D,endPTS:O,endDTS:O,type:Z,hasAudio:ee,hasVideo:ie,nb:1,dropped:0,encrypted:z};g.audio=ee&&!ie?X:void 0,g.video=ie?X:void 0;const ae=N?.sampleCount;if(ae){const te=N.keyFrameIndex,W=te!==-1;X.nb=ae,X.dropped=te===0||this.isVideoContiguous?0:W?te:ae,X.independent=W,X.firstKeyFrame=te,W&&N.keyFrameStart&&(X.firstKeyFramePTS=(N.keyFrameStart-u.baseTime)/u.timescale),this.isVideoContiguous||(g.independent=W),this.isVideoContiguous||(this.isVideoContiguous=W),X.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${te}/${ae} dropped: ${X.dropped} start: ${X.firstKeyFramePTS||"NA"}`)}return g.initSegment=b,g.id3=MS(n,l,u,u),i.samples.length&&(g.text=IS(i,l,u)),g}}function Lu(a,e,s=!1){return a?.start!==void 0?(a.start+(s?a.duration:0))/a.timescale:e}function LI(a,e,s,n){if(a===null)return!0;const i=Math.max(n,1),l=e-a.baseTime/a.timescale;return Math.abs(l-s)>i}function cN(a,e,s){const n=a.codec;return n&&n.length>4?n:e===fs.AUDIO?n==="ec-3"||n==="ac-3"||n==="alac"?n:n==="fLaC"||n==="Opus"?wh(n,!1):(s.warn(`Unhandled audio codec "${n}" in mp4 MAP`),n||"mp4a"):(s.warn(`Unhandled video codec "${n}" in mp4 MAP`),n||"avc1")}let Ci;try{Ci=self.performance.now.bind(self.performance)}catch{Ci=Date.now}const rh=[{demux:xI,remux:RI},{demux:vr,remux:ih},{demux:fI,remux:ih},{demux:gI,remux:ih}];rh.splice(2,0,{demux:mI,remux:ih});class dN{constructor(e,s,n,i,l,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=s,this.config=n,this.id=l,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,s,n,i){const l=n.transmuxing;l.executeStart=Ci();let o=new Uint8Array(e);const{currentTransmuxState:d,transmuxConfig:h}=this;i&&(this.currentTransmuxState=i);const{contiguous:u,discontinuity:f,trackSwitch:g,accurateTimeOffset:p,timeOffset:b,initSegmentChange:y}=i||d,{audioCodec:v,videoCodec:_,defaultInitPts:N,duration:C,initSegmentData:T}=h,L=DI(o,s);if(L&&po(L.method)){const P=this.getDecrypter(),I=Cp(L.method);if(P.isSync()){let D=P.softwareDecrypt(o,L.key.buffer,L.iv.buffer,I);if(n.part>-1){const ee=P.flush();D=ee&&ee.buffer}if(!D)return l.executeEnd=Ci(),Tg(n);o=new Uint8Array(D)}else return this.asyncResult=!0,this.decryptionPromise=P.webCryptoDecrypt(o,L.key.buffer,L.iv.buffer,I).then(D=>{const O=this.push(D,null,n);return this.decryptionPromise=null,O}),this.decryptionPromise}const F=this.needsProbing(f,g);if(F){const P=this.configureTransmuxer(o);if(P)return this.logger.warn(`[transmuxer] ${P.message}`),this.observer.emit($.ERROR,$.ERROR,{type:rt.MEDIA_ERROR,details:Ne.FRAG_PARSING_ERROR,fatal:!1,error:P,reason:P.message}),l.executeEnd=Ci(),Tg(n)}(f||g||y||F)&&this.resetInitSegment(T,v,_,C,s),(f||y||F)&&this.resetInitialTimestamp(N),u||this.resetContiguity();const H=this.transmux(o,L,b,p,n);this.asyncResult=Wc(H);const B=this.currentTransmuxState;return B.contiguous=!0,B.discontinuity=!1,B.trackSwitch=!1,l.executeEnd=Ci(),H}flush(e){const s=e.transmuxing;s.executeStart=Ci();const{decrypter:n,currentTransmuxState:i,decryptionPromise:l}=this;if(l)return this.asyncResult=!0,l.then(()=>this.flush(e));const o=[],{timeOffset:d}=i;if(n){const g=n.flush();g&&o.push(this.push(g.buffer,null,e))}const{demuxer:h,remuxer:u}=this;if(!h||!u){s.executeEnd=Ci();const g=[Tg(e)];return this.asyncResult?Promise.resolve(g):g}const f=h.flush(d);return Wc(f)?(this.asyncResult=!0,f.then(g=>(this.flushRemux(o,g,e),o))):(this.flushRemux(o,f,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,s,n){const{audioTrack:i,videoTrack:l,id3Track:o,textTrack:d}=s,{accurateTimeOffset:h,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${n.sn}${n.part>-1?" part: "+n.part:""} of ${this.id===et.MAIN?"level":"track"} ${n.level}`);const f=this.remuxer.remux(i,l,o,d,u,h,!0,this.id);e.push({remuxResult:f,chunkMeta:n}),n.transmuxing.executeEnd=Ci()}resetInitialTimestamp(e){const{demuxer:s,remuxer:n}=this;!s||!n||(s.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:s}=this;!e||!s||(e.resetContiguity(),s.resetNextTimestamp())}resetInitSegment(e,s,n,i,l){const{demuxer:o,remuxer:d}=this;!o||!d||(o.resetInitSegment(e,s,n,i),d.resetInitSegment(e,s,n,l))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,s,n,i,l){let o;return s&&s.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,s,n,i,l):o=this.transmuxUnencrypted(e,n,i,l),o}transmuxUnencrypted(e,s,n,i){const{audioTrack:l,videoTrack:o,id3Track:d,textTrack:h}=this.demuxer.demux(e,s,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(l,o,d,h,s,n,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,s,n,i,l){return this.demuxer.demuxSampleAes(e,s,n).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,n,i,!1,this.id),chunkMeta:l}))}configureTransmuxer(e){const{config:s,observer:n,typeSupported:i}=this;let l;for(let g=0,p=rh.length;g<p;g++){var o;if((o=rh[g].demux)!=null&&o.probe(e,this.logger)){l=rh[g];break}}if(!l)return new Error("Failed to find demuxer by probing fragment data");const d=this.demuxer,h=this.remuxer,u=l.remux,f=l.demux;(!h||!(h instanceof u))&&(this.remuxer=new u(n,s,i,this.logger)),(!d||!(d instanceof f))&&(this.demuxer=new f(n,s,i,this.logger),this.probe=f.probe)}needsProbing(e,s){return!this.demuxer||!this.remuxer||e||s}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Tp(this.config)),e}}function DI(a,e){let s=null;return a.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(s=e),s}const Tg=a=>({remuxResult:{},chunkMeta:a});function Wc(a){return"then"in a&&a.then instanceof Function}class MI{constructor(e,s,n,i,l){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=s,this.initSegmentData=n,this.duration=i,this.defaultInitPts=l||null}}class II{constructor(e,s,n,i,l,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=s,this.accurateTimeOffset=n,this.trackSwitch=i,this.timeOffset=l,this.initSegmentChange=o}}let uN=0;class PS{constructor(e,s,n,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=uN++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=h=>{const u=h.data,f=this.hls;if(!(!f||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var g;const p=(g=this.workerContext)==null?void 0:g.objectURL;p&&self.URL.revokeObjectURL(p);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{f.logger[u.data.logType]&&f.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,f.trigger(u.event,u.data);break}}},this.onWorkerError=h=>{if(!this.hls)return;const u=new Error(`${h.message}  (${h.filename}:${h.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger($.ERROR,{type:rt.OTHER_ERROR,details:Ne.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};const l=e.config;this.hls=e,this.id=s,this.useWorker=!!l.enableWorker,this.onTransmuxComplete=n,this.onFlush=i;const o=(h,u)=>{u=u||{},u.frag=this.frag||void 0,h===$.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(h,u)};this.observer=new Lp,this.observer.on($.FRAG_DECRYPTED,o),this.observer.on($.ERROR,o);const d=E_(l.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const h=this.hls.logger;if(l.workerPath||BM()){try{l.workerPath?(h.log(`loading Web Worker ${l.workerPath} for "${s}"`),this.workerContext=$M(l.workerPath)):(h.log(`injecting Web Worker for "${s}"`),this.workerContext=UM());const{worker:f}=this.workerContext;f.addEventListener("message",this.onWorkerMessage),f.addEventListener("error",this.onWorkerError),f.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:d,id:s,config:ms(l)})}catch(f){h.warn(`Error setting up "${s}" Web Worker, fallback to inline`,f),this.terminateWorker(),this.error=null,this.transmuxer=new dN(this.observer,d,l,"",s,e.logger)}return}}this.transmuxer=new dN(this.observer,d,l,"",s,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=uN++;const s=this.hls.config,n=E_(s.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:ms(s)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),GM(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const s=this.transmuxer;s&&(s.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,s,n,i,l,o,d,h,u,f){var g,p;u.transmuxing.start=self.performance.now();const{instanceNo:b,transmuxer:y}=this,v=o?o.start:l.start,_=l.decryptdata,N=this.frag,C=!(N&&l.cc===N.cc),T=!(N&&u.level===N.level),L=N?u.sn-N.sn:-1,F=this.part?u.part-this.part.index:-1,H=L===0&&u.id>1&&u.id===N?.stats.chunkCount,B=!T&&(L===1||L===0&&(F===1||H&&F<=0)),P=self.performance.now();(T||L||l.stats.parsing.start===0)&&(l.stats.parsing.start=P),o&&(F||!B)&&(o.stats.parsing.start=P);const I=!(N&&((g=l.initSegment)==null?void 0:g.url)===((p=N.initSegment)==null?void 0:p.url)),D=new II(C,B,h,T,v,I);if(!B||C||I){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${l.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===et.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${C}
        trackSwitch: ${T}
        contiguous: ${B}
        accurateTimeOffset: ${h}
        timeOffset: ${v}
        initSegmentChange: ${I}`);const O=new MI(n,i,s,d,f);this.configureTransmuxer(O)}if(this.frag=l,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:b,cmd:"demux",data:e,decryptdata:_,chunkMeta:u,state:D},e instanceof ArrayBuffer?[e]:[]);else if(y){const O=y.push(e,_,u,D);Wc(O)?O.then(ee=>{this.handleTransmuxComplete(ee)}).catch(ee=>{this.transmuxerError(ee,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(O)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:s,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:s,cmd:"flush",chunkMeta:e});else if(n){const i=n.flush(e);Wc(i)?i.then(l=>{this.handleFlushResult(l,e)}).catch(l=>{this.transmuxerError(l,e,"transmuxer-interface flush error")}):this.handleFlushResult(i,e)}}transmuxerError(e,s,n){this.hls&&(this.error=e,this.hls.trigger($.ERROR,{type:rt.MEDIA_ERROR,details:Ne.FRAG_PARSING_ERROR,chunkMeta:s,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,s){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(s)}configureTransmuxer(e){const{instanceNo:s,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:s,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const hN=100;class PI extends Rp{constructor(e,s,n){super(e,s,n,"audio-stream-controller",et.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on($.LEVEL_LOADED,this.onLevelLoaded,this),e.on($.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on($.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on($.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on($.BUFFER_RESET,this.onBufferReset,this),e.on($.BUFFER_CREATED,this.onBufferCreated,this),e.on($.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on($.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on($.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on($.FRAG_LOADING,this.onFragLoading,this),e.on($.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off($.LEVEL_LOADED,this.onLevelLoaded,this),e.off($.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off($.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off($.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off($.BUFFER_RESET,this.onBufferReset,this),e.off($.BUFFER_CREATED,this.onBufferCreated,this),e.off($.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off($.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off($.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off($.FRAG_LOADING,this.onFragLoading,this),e.off($.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:s,id:n,initPTS:i,timescale:l,trackId:o}){if(n===et.MAIN){const d=s.cc,h=this.fragCurrent;if(this.initPTS[d]={baseTime:i,timescale:l,trackId:o},this.log(`InitPTS for cc: ${d} found from main: ${i/l} (${i}/${l}) trackId: ${o}`),this.mainAnchor=s,this.state===Be.WAITING_INIT_PTS){const u=this.waitingData;(!u&&!this.loadingParts||u&&u.frag.cc!==d)&&this.syncWithAnchor(s,u?.frag)}else!this.hls.hasEnoughToStart&&h&&h.cc!==d?(h.abortRequests(),this.syncWithAnchor(s,h)):this.state===Be.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,s){var n;const i=((n=this.mainFragLoading)==null?void 0:n.frag)||null;if(s&&i?.cc===s.cc)return;const l=(i||e).cc,o=this.getLevelDetails(),d=this.getLoadPosition(),h=Jw(o,l,d);h&&(this.log(`Syncing with main frag at ${h.start} cc ${h.cc}`),this.startFragRequested=!1,this.nextLoadPosition=h.start,this.resetLoadingState(),this.state===Be.IDLE&&this.doTickIdle())}startLoad(e,s){if(!this.levels){this.startPosition=e,this.state=Be.STOPPED;return}const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(hN),n>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n,this.state=Be.IDLE):this.state=Be.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=s?-1:e,this.tick()}doTick(){switch(this.state){case Be.IDLE:this.doTickIdle();break;case Be.WAITING_TRACK:{const{levels:e,trackId:s}=this,n=e?.[s],i=n?.details;if(i&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(i))break;this.state=Be.WAITING_INIT_PTS}break}case Be.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case Be.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:s,part:n,cache:i,complete:l}=e,o=this.mainAnchor;if(this.initPTS[s.cc]!==void 0){this.waitingData=null,this.state=Be.FRAG_LOADING;const d=i.flush().buffer,h={frag:s,part:n,payload:d,networkDetails:null};this._handleFragmentLoadProgress(h),l&&super._handleFragmentLoadComplete(h)}else o&&o.cc!==e.frag.cc&&this.syncWithAnchor(o,e.frag)}else this.state=Be.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:s,levels:n,media:i,trackId:l}=this,o=s.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(n!=null&&n[l]))return;const d=n[l],h=d.details;if(!h||this.waitForLive(d)||this.waitForCdnTuneIn(h)){this.state=Be.WAITING_TRACK,this.startFragRequested=!1;return}const u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,fs.AUDIO,et.AUDIO));const f=this.getFwdBufferInfo(u,et.AUDIO);if(f===null)return;if(!this.switchingTrack&&this._streamEnded(f,h)){s.trigger($.BUFFER_EOS,{type:"audio"}),this.state=Be.ENDED;return}const g=f.len,p=s.maxBufferLength,b=h.fragments,y=b[0].start,v=this.getLoadPosition(),_=this.flushing?v:f.end;if(this.switchingTrack&&i){const T=v;h.PTSKnown&&T<y&&(f.end>y||f.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=y+.05)}if(g>=p&&!this.switchingTrack&&_<b[b.length-1].start)return;let N=this.getNextFragment(_,h);if(N&&this.isLoopLoading(N,_)&&(N=this.getNextFragmentLoopLoading(N,h,f,et.MAIN,p)),!N){this.bufferFlushed=!0;return}let C=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&C&&Us(N)&&!N.endList&&(!h.live||!this.loadingParts&&_<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(C)===Xs.OK&&(this.mainFragLoading=C=null),C&&Us(C))){if(N.start>C.end){const L=this.fragmentTracker.getFragAtPos(_,et.MAIN);L&&L.end>C.end&&(C=L,this.mainFragLoading={frag:L,targetBufferTime:null})}if(N.start>C.end)return}this.loadFragment(N,d,_)}onMediaDetaching(e,s){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,s)}onAudioTracksUpdated(e,{audioTracks:s}){this.resetTransmuxer(),this.levels=s.map(n=>new Hc(n))}onAudioTrackSwitching(e,s){const n=!!s.url;this.trackId=s.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),n?(this.switchingTrack=s,this.flushAudioIfNeeded(s),this.state!==Be.STOPPED&&(this.setInterval(hN),this.state=Be.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=s,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,s){this.mainDetails=s.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded($.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,s){var n;const{levels:i}=this,{details:l,id:o,groupId:d,track:h}=s;if(!i){this.warn(`Audio tracks reset while loading track ${o} "${h.name}" of "${d}"`);return}const u=this.mainDetails;if(!u||l.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=s,this.state!==Be.STOPPED&&(this.state=Be.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${h.name}" of "${d}" loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""},duration:${l.totalduration}`);const f=i[o];let g=0;if(l.live||(n=f.details)!=null&&n.live){if(this.checkLiveUpdate(l),l.deltaUpdateFailed)return;if(f.details){var p;g=this.alignPlaylists(l,f.details,(p=this.levelLastLoaded)==null?void 0:p.details)}l.alignedSliding||(pS(l,u),l.alignedSliding||kh(l,u),g=l.fragmentStart)}f.details=l,this.levelLastLoaded=f,this.startFragRequested||this.setStartPosition(u,g),this.hls.trigger($.AUDIO_TRACK_UPDATED,{details:l,id:o,groupId:s.groupId}),this.state===Be.WAITING_TRACK&&!this.waitForCdnTuneIn(l)&&(this.state=Be.IDLE),this.tick()}_handleFragmentLoadProgress(e){var s;const n=e.frag,{part:i,payload:l}=e,{config:o,trackId:d,levels:h}=this;if(!h){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const u=h[d];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const f=u.details;if(!f){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const g=o.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let p=this.transmuxer;p||(p=this.transmuxer=new PS(this.hls,et.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const b=this.initPTS[n.cc],y=(s=n.initSegment)==null?void 0:s.data;if(b!==void 0){const _=i?i.index:-1,N=_!==-1,C=new Ap(n.level,n.sn,n.stats.chunkCount,l.byteLength,_,N);p.push(l,y,g,"",n,i,f.totalduration,!1,C,b)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${f.startSN} ,${f.endSN}],track ${d}`);const{cache:v}=this.waitingData=this.waitingData||{frag:n,part:i,cache:new xS,complete:!1};v.push(new Uint8Array(l)),this.state!==Be.STOPPED&&(this.state=Be.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,s){this.bufferFlushed=this.flushing=!1;const n=s.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,s){!this.audioOnly&&s.frag.type===et.MAIN&&Us(s.frag)&&(this.mainFragLoading=s,this.state===Be.IDLE&&this.tick())}onFragBuffered(e,s){const{frag:n,part:i}=s;if(n.type!==et.AUDIO){!this.audioOnly&&n.type===et.MAIN&&!n.elementaryStreams.video&&!n.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Us(n)){this.fragPrevious=n;const l=this.switchingTrack;l&&(this.bufferedTrack=l,this.switchingTrack=null,this.hls.trigger($.AUDIO_TRACK_SWITCHED,is({},l)))}this.fragBufferedComplete(n,i),this.media&&this.tick()}onError(e,s){var n;if(s.fatal){this.state=Be.ERROR;return}switch(s.details){case Ne.FRAG_GAP:case Ne.FRAG_PARSING_ERROR:case Ne.FRAG_DECRYPT_ERROR:case Ne.FRAG_LOAD_ERROR:case Ne.FRAG_LOAD_TIMEOUT:case Ne.KEY_LOAD_ERROR:case Ne.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(et.AUDIO,s);break;case Ne.AUDIO_TRACK_LOAD_ERROR:case Ne.AUDIO_TRACK_LOAD_TIMEOUT:case Ne.LEVEL_PARSING_ERROR:!s.levelRetry&&this.state===Be.WAITING_TRACK&&((n=s.context)==null?void 0:n.type)===It.AUDIO_TRACK&&(this.state=Be.IDLE);break;case Ne.BUFFER_ADD_CODEC_ERROR:case Ne.BUFFER_APPEND_ERROR:if(s.parent!=="audio")return;this.reduceLengthAndFlushBuffer(s)||this.resetLoadingState();break;case Ne.BUFFER_FULL_ERROR:if(s.parent!=="audio")return;this.reduceLengthAndFlushBuffer(s)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Ne.INTERNAL_EXCEPTION:this.recoverWorkerError(s);break}}onBufferFlushing(e,{type:s}){s!==fs.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:s}){if(s!==fs.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===Be.ENDED&&(this.state=Be.IDLE);const n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,s,et.AUDIO),this.tick())}}_handleTransmuxComplete(e){var s;const n="audio",{hls:i}=this,{remuxResult:l,chunkMeta:o}=e,d=this.getCurrentContext(o);if(!d){this.resetWhenMissingContext(o);return}const{frag:h,part:u,level:f}=d,{details:g}=f,{audio:p,text:b,id3:y,initSegment:v}=l;if(this.fragContextChanged(h)||!g){this.fragmentTracker.removeFragment(h);return}if(this.state=Be.PARSING,this.switchingTrack&&p&&this.completeAudioSwitch(this.switchingTrack),v!=null&&v.tracks){const _=h.initSegment||h;if(this.unhandledEncryptionError(v,h))return;this._bufferInitSegment(f,v.tracks,_,o),i.trigger($.FRAG_PARSING_INIT_SEGMENT,{frag:_,id:n,tracks:v.tracks})}if(p){const{startPTS:_,endPTS:N,startDTS:C,endDTS:T}=p;u&&(u.elementaryStreams[fs.AUDIO]={startPTS:_,endPTS:N,startDTS:C,endDTS:T}),h.setElementaryStreamInfo(fs.AUDIO,_,N,C,T),this.bufferFragmentData(p,h,u,o)}if(y!=null&&(s=y.samples)!=null&&s.length){const _=ds({id:n,frag:h,details:g},y);i.trigger($.FRAG_PARSING_METADATA,_)}if(b){const _=ds({id:n,frag:h,details:g},b);i.trigger($.FRAG_PARSING_USERDATA,_)}}_bufferInitSegment(e,s,n,i){if(this.state!==Be.PARSING||(s.video&&delete s.video,s.audiovideo&&delete s.audiovideo,!s.audio))return;const l=s.audio;l.id=et.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${l.container}, codecs[level/parsed]=[${o}/${l.codec}]`),o&&o.split(",").length===1&&(l.levelCodec=o),this.hls.trigger($.BUFFER_CODECS,s);const d=l.initSegment;if(d!=null&&d.byteLength){const h={type:"audio",frag:n,part:null,chunkMeta:i,parent:n.type,data:d};this.hls.trigger($.BUFFER_APPENDING,h)}this.tickImmediate()}loadFragment(e,s,n){const i=this.fragmentTracker.getState(e);if(this.switchingTrack||i===Xs.NOT_LOADED||i===Xs.PARTIAL){var l;if(!Us(e))this._loadInitSegment(e,s);else if((l=s.details)!=null&&l.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=Be.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==s.details.fragmentStart&&kh(s.details,o)}else super.loadFragment(e,s,n)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:s,lang:n,assocLang:i,characteristics:l,audioCodec:o,channels:d}=this.bufferedTrack;gl({name:s,lang:n,assocLang:i,characteristics:l,audioCodec:o,channels:d},e,cl)||(jh(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:s}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,s.trigger($.AUDIO_TRACK_SWITCHED,is({},e))}}class Bp extends En{constructor(e,s){super(s,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,s,n){const i=s?.renditionReports;if(i){let l=-1;for(let o=0;o<i.length;o++){const d=i[o];let h;try{h=new self.URL(d.URI,s.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),h=d.URI||""}if(h===e){l=o;break}else h===e.substring(0,h.length)&&(l=o)}if(l!==-1){const o=i[l],d=parseInt(o["LAST-MSN"])||s.lastPartSn;let h=parseInt(o["LAST-PART"])||s.lastPartIndex;if(this.hls.config.lowLatencyMode){const f=Math.min(s.age-s.partTarget,s.targetduration);h>=0&&f>s.partTarget&&(h+=1)}const u=n&&T_(n);return new A_(d,h>=0?h:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,s){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,s){if(s)try{return s.addDirectives(e)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}return e}playlistLoaded(e,s,n){const{details:i,stats:l}=s,o=self.performance.now(),d=l.loading.first?Math.max(0,o-l.loading.first):0;i.advancedDateTime=Date.now()-d;const h=this.hls.config.timelineOffset;if(h!==i.appliedTimelineOffset){const f=Math.max(h||0,0);i.appliedTimelineOffset=f,i.fragments.forEach(g=>{g.setStart(g.playlistOffset+f)})}if(i.live||n!=null&&n.live){const f="levelInfo"in s?s.levelInfo:s.track;if(i.reloaded(n),n&&i.fragments.length>0){AM(n,i,this);const C=i.playlistParsingError;if(C){this.warn(C);const T=this.hls;if(!T.config.ignorePlaylistParsingErrors){var u;const{networkDetails:L}=s;T.trigger($.ERROR,{type:rt.NETWORK_ERROR,details:Ne.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:C,reason:C.message,level:s.level||void 0,parent:(u=i.fragments[0])==null?void 0:u.type,networkDetails:L,stats:l});return}i.playlistParsingError=null}}i.requestScheduled===-1&&(i.requestScheduled=l.loading.start);const g=this.hls.mainForwardBufferInfo,p=g?g.end-g.len:0,b=(i.edge-p)*1e3,y=uS(i,b);if(i.requestScheduled+y<o?i.requestScheduled=o:i.requestScheduled+=y,this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),!this.canLoad||!i.live)return;let v,_,N;if(i.canBlockReload&&i.endSN&&i.advanced){const C=this.hls.config.lowLatencyMode,T=i.lastPartSn,L=i.endSN,F=i.lastPartIndex,H=F!==-1,B=T===L;H?B?(_=L+1,N=C?0:F):(_=T,N=C?F+1:i.maxPartIndex):_=L+1;const P=i.age,I=P+i.ageHeader;let D=Math.min(I-i.partTarget,i.targetduration*1.5);if(D>0){if(I>i.targetduration*3)this.log(`Playlist last advanced ${P.toFixed(2)}s ago. Omitting segment and part directives.`),_=void 0,N=void 0;else if(n!=null&&n.tuneInGoal&&I-i.partTarget>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${D} with playlist age: ${i.age}`),D=0;else{const O=Math.floor(D/i.targetduration);if(_+=O,N!==void 0){const ee=Math.round(D%i.targetduration/i.partTarget);N+=ee}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${P.toFixed(2)}s goal: ${D} skip sn ${O} to part ${N}`)}i.tuneInGoal=D}if(v=this.getDeliveryDirectives(i,s.deliveryDirectives,_,N),C||!B){i.requestScheduled=o,this.loadingPlaylist(f,v);return}}else(i.canBlockReload||i.canSkipUntil)&&(v=this.getDeliveryDirectives(i,s.deliveryDirectives,_,N));v&&_!==void 0&&i.canBlockReload&&(i.requestScheduled=l.loading.first+Math.max(y-d*2,y/2)),this.scheduleLoading(f,v,i)}else this.clearTimer()}scheduleLoading(e,s,n){const i=n||e.details;if(!i){this.loadingPlaylist(e,s);return}const l=self.performance.now(),o=i.requestScheduled;if(l>=o){this.loadingPlaylist(e,s);return}const d=o-l;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(d)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,s),d)}getDeliveryDirectives(e,s,n,i){let l=T_(e);return s!=null&&s.skip&&e.deltaUpdateFailed&&(n=s.msn,i=s.part,l=ah.No),new A_(n,i,l)}checkRetry(e){const s=e.details,n=Eh(e),i=e.errorAction,{action:l,retryCount:o=0,retryConfig:d}=i||{},h=!!i&&!!d&&(l===oa.RetryRequest||!i.resolved&&l===oa.SendAlternateToPenaltyBox);if(h){var u;if(o>=d.maxNumRetry)return!1;if(n&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${d.maxNumRetry} after "${s}" without delivery-directives`),this.loadPlaylist();else{const f=Ep(d,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),f),this.warn(`Retrying playlist loading ${o+1}/${d.maxNumRetry} after "${s}" in ${f}ms`)}e.levelRetry=!0,i.resolved=!0}return h}}function OS(a,e){if(a.length!==e.length)return!1;for(let s=0;s<a.length;s++)if(!Qc(a[s].attrs,e[s].attrs))return!1;return!0}function Qc(a,e,s){const n=a["STABLE-RENDITION-ID"];return n&&!s?n===e["STABLE-RENDITION-ID"]:!(s||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(i=>a[i]!==e[i])}function L0(a,e){return e.label.toLowerCase()===a.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(a.lang||"").toLowerCase())}class OI extends Bp{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.MANIFEST_PARSED,this.onManifestParsed,this),e.on($.LEVEL_LOADING,this.onLevelLoading,this),e.on($.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on($.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on($.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.MANIFEST_PARSED,this.onManifestParsed,this),e.off($.LEVEL_LOADING,this.onLevelLoading,this),e.off($.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off($.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off($.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,s){this.tracks=s.audioTracks||[]}onAudioTrackLoaded(e,s){const{id:n,groupId:i,details:l}=s,o=this.tracksInGroup[n];if(!o||o.groupId!==i){this.warn(`Audio track with id:${n} and group:${i} not found in active group ${o?.groupId}`);return}const d=o.details;o.details=s.details,this.log(`Audio track ${n} "${o.name}" lang:${o.lang} group:${i} loaded [${l.startSN}-${l.endSN}]`),n===this.trackId&&this.playlistLoaded(n,s,d)}onLevelLoading(e,s){this.switchLevel(s.level)}onLevelSwitching(e,s){this.switchLevel(s.level)}switchLevel(e){const s=this.hls.levels[e];if(!s)return;const n=s.audioGroups||null,i=this.groupIds;let l=this.currentTrack;if(!n||i?.length!==n?.length||n!=null&&n.some(d=>i?.indexOf(d)===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const d=this.tracks.filter(p=>!n||n.indexOf(p.groupId)!==-1);if(d.length)this.selectDefaultTrack&&!d.some(p=>p.default)&&(this.selectDefaultTrack=!1),d.forEach((p,b)=>{p.id=b});else if(!l&&!this.tracksInGroup.length)return;this.tracksInGroup=d;const h=this.hls.config.audioPreference;if(!l&&h){const p=Jn(h,d,cl);if(p>-1)l=d[p];else{const b=Jn(h,this.tracks);l=this.tracks[b]}}let u=this.findTrackId(l);u===-1&&l&&(u=this.findTrackId(null));const f={audioTracks:d};this.log(`Updating audio tracks, ${d.length} track(s) found in group(s): ${n?.join(",")}`),this.hls.trigger($.AUDIO_TRACKS_UPDATED,f);const g=this.trackId;if(u!==-1&&g===-1)this.setAudioTrack(u);else if(d.length&&g===-1){var o;const p=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${d.length}`);this.warn(p.message),this.hls.trigger($.ERROR,{type:rt.MEDIA_ERROR,details:Ne.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:p})}}}onError(e,s){s.fatal||!s.context||s.context.type===It.AUDIO_TRACK&&s.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(s.context.groupId)!==-1)&&this.checkRetry(s)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const s=this.hls;if(s.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const i=this.currentTrack;if(i&&gl(e,i,cl))return i;const l=Jn(e,this.tracksInGroup,cl);if(l>-1){const o=this.tracksInGroup[l];return this.setAudioTrack(l),o}else if(i){let o=s.loadLevel;o===-1&&(o=s.firstAutoLevel);const d=W5(e,s.levels,n,o,cl);if(d===-1)return null;s.nextLoadLevel=d}if(e.channels||e.audioCodec){const o=Jn(e,n);if(o>-1)return n[o]}}}return null}setAudioTrack(e){const s=this.tracksInGroup;if(e<0||e>=s.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,i=s[e],l=i.details&&!i.details.live;if(e===this.trackId&&i===n&&l||(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger($.AUDIO_TRACK_SWITCHING,is({},i)),l))return;const o=this.switchParams(i.url,n?.details,i.details);this.loadPlaylist(o)}findTrackId(e){const s=this.tracksInGroup;for(let n=0;n<s.length;n++){const i=s[n];if(!(this.selectDefaultTrack&&!i.default)&&(!e||gl(e,i,cl)))return n}if(e){const{name:n,lang:i,assocLang:l,characteristics:o,audioCodec:d,channels:h}=e;for(let u=0;u<s.length;u++){const f=s[u];if(gl({name:n,lang:i,assocLang:l,characteristics:o,audioCodec:d,channels:h},f,cl))return u}for(let u=0;u<s.length;u++){const f=s[u];if(Qc(e.attrs,f.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<s.length;u++){const f=s[u];if(Qc(e.attrs,f.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();const s=this.currentTrack;this.shouldLoadPlaylist(s)&&jh(s.url,this.hls)&&this.scheduleLoading(s,e)}loadingPlaylist(e,s){super.loadingPlaylist(e,s);const n=e.id,i=e.groupId,l=this.getUrlWithDirectives(e.url,s),o=e.details,d=o?.age;this.log(`Loading audio-track ${n} "${e.name}" lang:${e.lang} group:${i}${s?.msn!==void 0?" at sn "+s.msn+" part "+s.part:""}${d&&o.live?" age "+d.toFixed(1)+(o.type&&" "+o.type||""):""} ${l}`),this.hls.trigger($.AUDIO_TRACK_LOADING,{url:l,id:n,groupId:i,deliveryDirectives:s||null,track:e})}}class FI{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,s,n){if(this.queues===null||this.tracks===null)return;const i=this.queues[s];i.push(e),i.length===1&&!n&&this.executeNext(s)}appendBlocker(e){return new Promise(s=>{const n={label:"async-blocker",execute:s,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(s=>{if(this.queues){const n={label:"async-blocker-prepend",execute:s,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var s;const n=(s=e[0])==null?void 0:s.label;(n==="async-blocker"||n==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const s=this.queues[e];if(s.length){const i=s[0];try{i.execute()}catch(l){var n;if(i.onError(l),this.queues===null||this.tracks===null)return;const o=(n=this.tracks[e])==null?void 0:n.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var s;return((s=this.queues)==null?void 0:s[e][0])||null}toString(){const{queues:e,tracks:s}=this;return e===null||s===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var s,n;return(s=this.queues)!=null&&s[e]||(n=this.tracks)!=null&&n[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var s;const n=(s=this.tracks)==null?void 0:s[e],i=n?.buffer;return i?`SourceBuffer${i.updating?" updating":""}${n.ended?" ended":""}${n.ending?" ending":""}`:"none"}listOps(e){var s;return((s=this.queues)==null?void 0:s[e].map(n=>n.label).join(", "))||""}}const fN=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,FS="HlsJsTrackRemovedError";class BI extends Error{constructor(e){super(e),this.name=FS}}class UI extends En{constructor(e,s){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=n=>{var i;this.hls&&((i=this.mediaSource)==null?void 0:i.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=n=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=n=>{const{media:i,mediaSource:l}=this;n&&this.log("Media source opened"),!(!i||!l)&&(l.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger($.MEDIA_ATTACHED,{media:i,mediaSource:l}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:n,_objectUrl:i}=this;n!==i&&this.error(`Media element src was set while attaching MediaSource (${i} > ${n})`)},this.hls=e,this.fragmentTracker=s,this.appendSource=o5(Ar(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.MANIFEST_PARSED,this.onManifestParsed,this),e.on($.BUFFER_RESET,this.onBufferReset,this),e.on($.BUFFER_APPENDING,this.onBufferAppending,this),e.on($.BUFFER_CODECS,this.onBufferCodecs,this),e.on($.BUFFER_EOS,this.onBufferEos,this),e.on($.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on($.LEVEL_UPDATED,this.onLevelUpdated,this),e.on($.FRAG_PARSED,this.onFragParsed,this),e.on($.FRAG_CHANGED,this.onFragChanged,this),e.on($.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.MANIFEST_PARSED,this.onManifestParsed,this),e.off($.BUFFER_RESET,this.onBufferReset,this),e.off($.BUFFER_APPENDING,this.onBufferAppending,this),e.off($.BUFFER_CODECS,this.onBufferCodecs,this),e.off($.BUFFER_EOS,this.onBufferEos,this),e.off($.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off($.LEVEL_UPDATED,this.onLevelUpdated,this),e.off($.FRAG_PARSED,this.onFragParsed,this),e.off($.FRAG_CHANGED,this.onFragChanged,this),e.off($.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:s}=this;if(!e)return null;const n={};if(this.operationQueue){const l=this.isUpdating();l||this.operationQueue.removeBlockers();const o=this.isQueued();(l||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${l?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===s?ds(n,i.tracks):this.sourceBuffers.forEach(l=>{const[o]=l;o&&(n[o]=ds({},this.tracks[o]),this.removeBuffer(o)),l[0]=l[1]=null}),{media:e,mediaSource:s,tracks:n}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,s){var n;let i=2;(s.audio&&!s.video||!s.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),(n=this.transferData)!=null&&n.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,s){const n=this.media=s.media;this.transferData=this.overrides=void 0;const i=Ar(this.appendSource);if(i){const l=!!s.mediaSource;(l||s.overrides)&&(this.transferData=s,this.overrides=s.overrides);const o=this.mediaSource=s.mediaSource||new i;if(this.assignMediaSource(o),l)this._objectUrl=n.src,this.attachTransferred();else{const d=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{n.removeAttribute("src");const h=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||h&&o instanceof h,mN(n),$I(n,d),n.load()}catch{n.src=d}else n.src=d}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var s,n;this.log(`${((s=this.transferData)==null?void 0:s.mediaSource)===e?"transferred":"created"} media source: ${(n=e.constructor)==null?void 0:n.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,s=this.transferData;if(!s||!e)return;const n=this.tracks,i=s.tracks,l=i?Object.keys(i):null,o=l?l.length:0,d=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(i&&l&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${ms(n,(h,u)=>h==="initSegment"?void 0:u)};
transfer tracks: ${ms(i,(h,u)=>h==="initSegment"?void 0:u)}}`),!Mw(i,n)){s.mediaSource=null,s.tracks=void 0;const h=e.currentTime,u=this.details,f=Math.max(h,u?.fragments[0].start||0);if(f-h>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${h} -> ${f}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(n)}") start time: ${f} currentTime: ${h}`),this.onMediaDetaching($.MEDIA_DETACHING,{}),this.onMediaAttaching($.MEDIA_ATTACHING,s),e.currentTime=f;return}this.transferData=void 0,l.forEach(h=>{const u=h,f=i[u];if(f){const g=f.buffer;if(g){const p=this.fragmentTracker,b=f.id;if(p.hasFragments(b)||p.hasParts(b)){const _=St.getBuffered(g);p.detectEvictedFragments(u,_,b,null,!0)}const y=Ag(u),v=[u,g];this.sourceBuffers[y]=v,g.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,f)}}}),d(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),d()}get mediaSourceOpenOrEnded(){var e;const s=(e=this.mediaSource)==null?void 0:e.readyState;return s==="open"||s==="ended"}onMediaDetaching(e,s){const n=!!s.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:l,_objectUrl:o}=this;if(l){if(this.log(`media source ${n?"transferring":"detaching"}`),n)this.sourceBuffers.forEach(([d])=>{d&&this.removeBuffer(d)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const d=l.readyState==="open";try{const h=l.sourceBuffers;for(let u=h.length;u--;)d&&h[u].abort(),l.removeSourceBuffer(h[u]);d&&l.endOfStream()}catch(h){this.warn(`onMediaDetaching: ${h.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}l.removeEventListener("sourceopen",this._onMediaSourceOpen),l.removeEventListener("sourceended",this._onMediaSourceEnded),l.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(l.removeEventListener("startstreaming",this._onStartStreaming),l.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),n||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(i.removeAttribute("src"),this.appendSource&&mN(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger($.MEDIA_DETACHED,s)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var s;const n=(s=this.tracks[e])==null?void 0:s.buffer;if(this.removeBuffer(e),n)try{var i;(i=this.mediaSource)!=null&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(l){this.warn(`onBufferReset ${e}`,l)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Ag(e)]=[null,null];const s=this.tracks[e];s&&(s.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new FI(this.tracks)}onBufferCodecs(e,s){var n;const i=this.tracks,l=Object.keys(s);this.log(`BUFFER_CODECS: "${l}" (current SB count ${this.sourceBufferCount})`);const o="audiovideo"in s&&(i.audio||i.video)||i.audiovideo&&("audio"in s||"video"in s),d=!o&&this.sourceBufferCount&&this.media&&l.some(h=>!i[h]);if(o||d){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${l}" SourceBuffers`);return}l.forEach(h=>{var u,f;const g=s[h],{id:p,codec:b,levelCodec:y,container:v,metadata:_,supplemental:N}=g;let C=i[h];const T=(u=this.transferData)==null||(u=u.tracks)==null?void 0:u[h],L=T!=null&&T.buffer?T:C,F=L?.pendingCodec||L?.codec,H=L?.levelCodec;C||(C=i[h]={buffer:void 0,listeners:[],codec:b,supplemental:N,container:v,levelCodec:y,metadata:_,id:p});const B=sh(F,H),P=B?.replace(fN,"$1");let I=sh(b,y);const D=(f=I)==null?void 0:f.replace(fN,"$1");I&&B&&P!==D&&(h.slice(0,5)==="audio"&&(I=wh(I,this.appendSource)),this.log(`switching codec ${F} to ${I}`),I!==(C.pendingCodec||C.codec)&&(C.pendingCodec=I),C.container=v,this.appendChangeType(h,v,I))}),(this.tracksReady||this.sourceBufferCount)&&(s.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!s.video&&((n=s.audio)==null?void 0:n.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,s)=>{const n=this.tracks[s];return e[s]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,s,n){const i=`${s};codecs=${n}`,l={label:`change-type=${i}`,execute:()=>{const o=this.tracks[e];if(o){const d=o.buffer;d!=null&&d.changeType&&(this.log(`changing ${e} sourceBuffer type to ${i}`),d.changeType(i),o.codec=n,o.container=s)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(l,e,this.isPending(this.tracks[e]))}blockAudio(e){var s;const n=e.start,i=n+e.duration*.05;if(((s=this.fragmentTracker.getAppendedFrag(n,et.MAIN))==null?void 0:s.gap)===!0)return;const o={label:"block-audio",execute:()=>{var d;const h=this.tracks.video;(this.lastVideoAppendEnd>i||h!=null&&h.buffer&&St.isBuffered(h.buffer,i)||((d=this.fragmentTracker.getAppendedFrag(i,et.MAIN))==null?void 0:d.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:d=>{this.warn("Error executing block-audio operation",d)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:s}=this;e&&s&&(this.blockedAudioAppend=null,s.unblockAudio(e.op))}onBufferAppending(e,s){const{tracks:n}=this,{data:i,type:l,parent:o,frag:d,part:h,chunkMeta:u,offset:f}=s,g=u.buffering[l],{sn:p,cc:b}=d,y=self.performance.now();g.start=y;const v=d.stats.buffering,_=h?h.stats.buffering:null;v.start===0&&(v.start=y),_&&_.start===0&&(_.start=y);const N=n.audio;let C=!1;l==="audio"&&N?.container==="audio/mpeg"&&(C=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const T=n.video,L=T?.buffer;if(L&&p!=="initSegment"){const B=h||d,P=this.blockedAudioAppend;if(l==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(T.ending||T.ended)){const D=B.start+B.duration*.05,O=L.buffered,ee=this.currentOp("video");!O.length&&!ee?this.blockAudio(B):!ee&&!St.isBuffered(L,D)&&this.lastVideoAppendEnd<D&&this.blockAudio(B)}else if(l==="video"){const I=B.end;if(P){const D=P.frag.start;(I>D||I<this.lastVideoAppendEnd||St.isBuffered(L,D))&&this.unblockAudio()}this.lastVideoAppendEnd=I}}const F=(h||d).start,H={label:`append-${l}`,execute:()=>{var B;g.executeStart=self.performance.now();const P=(B=this.tracks[l])==null?void 0:B.buffer;P&&(C?this.updateTimestampOffset(P,F,.1,l,p,b):f!==void 0&&Ze(f)&&this.updateTimestampOffset(P,f,1e-6,l,p,b)),this.appendExecutor(i,l)},onStart:()=>{},onComplete:()=>{const B=self.performance.now();g.executeEnd=g.end=B,v.first===0&&(v.first=B),_&&_.first===0&&(_.first=B);const P={};this.sourceBuffers.forEach(([I,D])=>{I&&(P[I]=St.getBuffered(D))}),this.appendErrors[l]=0,l==="audio"||l==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger($.BUFFER_APPENDED,{type:l,frag:d,part:h,chunkMeta:u,parent:d.type,timeRanges:P})},onError:B=>{var P;const I={type:rt.MEDIA_ERROR,parent:d.type,details:Ne.BUFFER_APPEND_ERROR,sourceBufferName:l,frag:d,part:h,chunkMeta:u,error:B,err:B,fatal:!1},D=(P=this.media)==null?void 0:P.error;if(B.code===DOMException.QUOTA_EXCEEDED_ERR||B.name=="QuotaExceededError"||"quota"in B)I.details=Ne.BUFFER_FULL_ERROR;else if(B.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!D)I.errorAction=go(!0);else if(B.name===FS&&this.sourceBufferCount===0)I.errorAction=go(!0);else{const O=++this.appendErrors[l];this.warn(`Failed ${O}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${l}" sourceBuffer (${D||"no media error"})`),(O>=this.hls.config.appendErrorMaxRetry||D)&&(I.fatal=!0)}this.hls.trigger($.ERROR,I)}};this.log(`queuing "${l}" append sn: ${p}${h?" p: "+h.index:""} of ${d.type===et.MAIN?"level":"track"} ${d.level} cc: ${b}`),this.append(H,l,this.isPending(this.tracks[l]))}getFlushOp(e,s,n){return this.log(`queuing "${e}" remove ${s}-${n}`),{label:"remove",execute:()=>{this.removeExecutor(e,s,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger($.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn(`Failed to remove ${s}-${n} from "${e}" SourceBuffer`,i)}}}onBufferFlushing(e,s){const{type:n,startOffset:i,endOffset:l}=s;n?this.append(this.getFlushOp(n,i,l),n):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,i,l),o)})}onFragParsed(e,s){const{frag:n,part:i}=s,l=[],o=i?i.elementaryStreams:n.elementaryStreams;o[fs.AUDIOVIDEO]?l.push("audiovideo"):(o[fs.AUDIO]&&l.push("audio"),o[fs.VIDEO]&&l.push("video"));const d=()=>{const h=self.performance.now();n.stats.buffering.end=h,i&&(i.stats.buffering.end=h);const u=i?i.stats:n.stats;this.hls.trigger($.FRAG_BUFFERED,{frag:n,part:i,stats:u,id:n.type})};l.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(d,l).catch(h=>{this.warn(`Fragment buffered callback ${h}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,s){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const s=this.tracks[e];if(s)return!s.ended||s.ending}return!1})}onBufferEos(e,s){var n;this.sourceBuffers.forEach(([o])=>{if(o){const d=this.tracks[o];(!s.type||s.type===o)&&(d.ending=!0,d.ended||(d.ended=!0,this.log(`${o} buffer reached EOS`)))}});const i=((n=this.overrides)==null?void 0:n.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var d;return o&&!((d=this.tracks[o])!=null&&d.ended)})?i?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger($.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger($.BUFFERED_TO_END,void 0)):s.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const s=this.tracks[e];s&&(s.ending=!1)}})}onLevelUpdated(e,{details:s}){s.fragments.length&&(this.details=s,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,s){if(s.details===Ne.BUFFER_APPEND_ERROR&&s.frag){var n;const i=(n=s.errorAction)==null?void 0:n.nextAutoLevel;Ze(i)&&i!==s.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:s,media:n}=this;if(!n||s===null||!this.sourceBufferCount)return;const i=e.config,l=n.currentTime,o=s.levelTargetDuration,d=s.live&&i.liveBackBufferLength!==null?i.liveBackBufferLength:i.backBufferLength;if(Ze(d)&&d>=0){const u=Math.max(d,o),f=Math.floor(l/o)*o-u;this.flushBackBuffer(l,o,f)}const h=i.frontBufferFlushThreshold;if(Ze(h)&&h>0){const u=Math.max(i.maxBufferLength,h),f=Math.max(u,o),g=Math.floor(l/o)*o+f;this.flushFrontBuffer(l,o,g)}}flushBackBuffer(e,s,n){this.sourceBuffers.forEach(([i,l])=>{if(l){const d=St.getBuffered(l);if(d.length>0&&n>d.start(0)){var o;this.hls.trigger($.BACK_BUFFER_REACHED,{bufferEnd:n});const h=this.tracks[i];if((o=this.details)!=null&&o.live)this.hls.trigger($.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(h!=null&&h.ended){this.log(`Cannot flush ${i} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger($.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:i})}}})}flushFrontBuffer(e,s,n){this.sourceBuffers.forEach(([i,l])=>{if(l){const o=St.getBuffered(l),d=o.length;if(d<2)return;const h=o.start(d-1),u=o.end(d-1);if(n>h||e>=h&&e<=u)return;this.hls.trigger($.BUFFER_FLUSHING,{startOffset:h,endOffset:1/0,type:i})}})}getDurationAndRange(){var e;const{details:s,mediaSource:n}=this;if(!s||!this.media||n?.readyState!=="open")return null;const i=s.edge;if(s.live&&this.hls.config.liveDurationInfinity){if(s.fragments.length&&n.setLiveSeekableRange){const u=Math.max(0,s.fragmentStart),f=Math.max(u,i);return{duration:1/0,start:u,end:f}}return{duration:1/0}}const l=(e=this.overrides)==null?void 0:e.duration;if(l)return Ze(l)?{duration:l}:null;const o=this.media.duration,d=Ze(n.duration)?n.duration:0;return i>d&&i>o||!Ze(o)?{duration:i}:null}updateMediaSource({duration:e,start:s,end:n}){const i=this.mediaSource;!this.media||!i||i.readyState!=="open"||(i.duration!==e&&(Ze(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),i.duration=e),s!==void 0&&n!==void 0&&(this.log(`MediaSource duration is set to ${i.duration}. Setting seekable range to ${s}-${n}.`),i.setLiveSeekableRange(s,n)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:s,tracks:n}=this;if(this.log(`checkPendingTracks (pending: ${s} codec events expected: ${e}) ${ms(n)}`),this.tracksReady){var i;const l=(i=this.transferData)==null?void 0:i.tracks;l&&Object.keys(l).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([s,n])=>{if(s){const i=this.tracks[s];e[s]={buffer:n,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}}),this.hls.trigger($.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([s])=>{this.executeNext(s)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger($.ERROR,{type:rt.MEDIA_ERROR,details:Ne.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:s,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const l in e){const o=l,d=e[o];if(this.isPending(d)){const h=this.getTrackCodec(d,o),u=`${d.container};codecs=${h}`;d.codec=h,this.log(`creating sourceBuffer(${u})${this.currentOp(o)?" Queued":""} ${ms(d)}`);try{const f=n.addSourceBuffer(u),g=Ag(o),p=[o,f];s[g]=p,d.buffer=f}catch(f){var i;this.error(`error while trying to add sourceBuffer: ${f.message}`),this.shiftAndExecuteNext(o),(i=this.operationQueue)==null||i.removeBlockers(),delete this.tracks[o],this.hls.trigger($.ERROR,{type:rt.MEDIA_ERROR,details:Ne.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:f,sourceBufferName:o,mimeType:u,parent:d.id});return}this.trackSourceBuffer(o,d)}}this.bufferCreated()}getTrackCodec(e,s){const n=e.supplemental;let i=e.codec;n&&(s==="video"||s==="audiovideo")&&qc(n,"video")&&(i=k5(i,n));const l=sh(i,e.levelCodec);return l?s.slice(0,5)==="audio"?wh(l,this.appendSource):l:""}trackSourceBuffer(e,s){const n=s.buffer;if(!n)return;const i=this.getTrackCodec(s,e);this.tracks[e]={buffer:n,codec:i,container:s.container,levelCodec:s.levelCodec,supplemental:s.supplemental,metadata:s.metadata,id:s.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(l,o)=>{const d=o.removedRanges;d!=null&&d.length&&this.hls.trigger($.BUFFER_FLUSHED,{type:l})})}get mediaSrc(){var e,s;const n=((e=this.media)==null||(s=e.querySelector)==null?void 0:s.call(e,"source"))||this.media;return n?.src}onSBUpdateStart(e){const s=this.currentOp(e);s&&s.onStart()}onSBUpdateEnd(e){var s;if(((s=this.mediaSource)==null?void 0:s.readyState)==="closed"){this.resetBuffer(e);return}const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,s){var n;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(n=this.mediaSource)==null?void 0:n.readyState}`);this.error(`${i}`,s),this.hls.trigger($.ERROR,{type:rt.MEDIA_ERROR,details:Ne.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const l=this.currentOp(e);l&&l.onError(i)}updateTimestampOffset(e,s,n,i,l,o){const d=s-e.timestampOffset;Math.abs(d)>=n&&(this.log(`Updating ${i} SourceBuffer timestampOffset to ${s} (sn: ${l} cc: ${o})`),e.timestampOffset=s)}removeExecutor(e,s,n){const{media:i,mediaSource:l}=this,o=this.tracks[e],d=o?.buffer;if(!i||!l||!d){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const h=Ze(i.duration)?i.duration:1/0,u=Ze(l.duration)?l.duration:1/0,f=Math.max(0,s),g=Math.min(n,h,u);g>f&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${f},${g}] from the ${e} SourceBuffer`),d.remove(f,g)):this.shiftAndExecuteNext(e)}appendExecutor(e,s){const n=this.tracks[s],i=n?.buffer;if(!i)throw new BI(`Attempting to append to the ${s} SourceBuffer, but it does not exist`);n.ending=!1,n.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(s=>{this.warn(`SourceBuffer blocked callback ${s}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(s){this.warn(`Callback run without blocking ${this.operationQueue} ${s}`)}}isUpdating(){return this.sourceBuffers.some(([e,s])=>e&&s.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,s=this.sourceBufferTypes){if(!s.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,i=s.map(o=>this.appendBlocker(o));return s.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then(o=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(s=>{var n;const i=(n=this.tracks[s])==null?void 0:n.buffer;!i||i.updating||this.shiftAndExecuteNext(s)})}append(e,s,n){this.operationQueue&&this.operationQueue.append(e,s,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,s)=>e+(this.isPending(this.tracks[s])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[s])=>e+(s?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,s,n){const i=this.tracks[e];if(!i)return;const l=i.buffer;if(!l)return;const o=n.bind(this,e);i.listeners.push({event:s,listener:o}),l.addEventListener(s,o)}removeBufferListeners(e){const s=this.tracks[e];if(!s)return;const n=s.buffer;n&&(s.listeners.forEach(i=>{n.removeEventListener(i.event,i.listener)}),s.listeners.length=0)}}function mN(a){const e=a.querySelectorAll("source");[].slice.call(e).forEach(s=>{a.removeChild(s)})}function $I(a,e){const s=self.document.createElement("source");s.type="video/mp4",s.src=e,a.appendChild(s)}function Ag(a){return a==="audio"?1:0}class Up{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on($.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on($.MANIFEST_PARSED,this.onManifestParsed,this),e.on($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on($.BUFFER_CODECS,this.onBufferCodecs,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off($.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off($.MANIFEST_PARSED,this.onManifestParsed,this),e.off($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off($.BUFFER_CODECS,this.onBufferCodecs,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,s){const n=this.hls.levels[s.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,s){this.media=s.media instanceof HTMLVideoElement?s.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,s){const n=this.hls;this.restrictedLevels=[],this.firstLevel=s.firstLevel,n.config.capLevelToPlayerSize&&s.video&&this.startCapping()}onLevelsUpdated(e,s){this.timer&&Ze(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,s){this.hls.config.capLevelToPlayerSize&&s.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const s=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&s.logger.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),s.autoLevelCapping=n,s.autoLevelEnabled&&s.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=s.autoLevelCapping}}}getMaxLevel(e){const s=this.hls.levels;if(!s.length)return-1;const n=s.filter((i,l)=>this.isLevelAllowed(i)&&l<=e);return this.clientRect=null,Up.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,s={width:0,height:0};if(e){const n=e.getBoundingClientRect();s.width=n.width,s.height=n.height,!s.width&&!s.height&&(s.width=n.right-n.left||e.width||0,s.height=n.bottom-n.top||e.height||0)}return this.clientRect=s,s}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,s,n){if(!(e!=null&&e.length))return-1;const i=(d,h)=>h?d.width!==h.width||d.height!==h.height:!0;let l=e.length-1;const o=Math.max(s,n);for(let d=0;d<e.length;d+=1){const h=e[d];if((h.width>=o||h.height>=o)&&i(h,e[d+1])){l=d;break}}return l}}const GI={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Ia=GI,VI={HLS:"h"},qI=VI;class ai{constructor(e,s){Array.isArray(e)&&(e=e.map(n=>n instanceof ai?n:new ai(n))),this.value=e,this.params=s}}const KI="Dict";function HI(a){return Array.isArray(a)?JSON.stringify(a):a instanceof Map?"Map{}":a instanceof Set?"Set{}":typeof a=="object"?JSON.stringify(a):String(a)}function zI(a,e,s,n){return new Error(`failed to ${a} "${HI(e)}" as ${s}`,{cause:n})}function ni(a,e,s){return zI("serialize",a,e,s)}class BS{constructor(e){this.description=e}}const gN="Bare Item",YI="Boolean";function WI(a){if(typeof a!="boolean")throw ni(a,YI);return a?"?1":"?0"}function QI(a){return btoa(String.fromCharCode(...a))}const XI="Byte Sequence";function JI(a){if(ArrayBuffer.isView(a)===!1)throw ni(a,XI);return`:${QI(a)}:`}const ZI="Integer";function eP(a){return a<-999999999999999||999999999999999<a}function US(a){if(eP(a))throw ni(a,ZI);return a.toString()}function tP(a){return`@${US(a.getTime()/1e3)}`}function $S(a,e){if(a<0)return-$S(-a,e);const s=Math.pow(10,e);if(Math.abs(a*s%1-.5)<Number.EPSILON){const i=Math.floor(a*s);return(i%2===0?i:i+1)/s}else return Math.round(a*s)/s}const sP="Decimal";function aP(a){const e=$S(a,3);if(Math.floor(Math.abs(e)).toString().length>12)throw ni(a,sP);const s=e.toString();return s.includes(".")?s:`${s}.0`}const nP="String",iP=/[\x00-\x1f\x7f]+/;function rP(a){if(iP.test(a))throw ni(a,nP);return`"${a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function lP(a){return a.description||a.toString().slice(7,-1)}const oP="Token";function pN(a){const e=lP(a);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw ni(e,oP);return e}function D0(a){switch(typeof a){case"number":if(!Ze(a))throw ni(a,gN);return Number.isInteger(a)?US(a):aP(a);case"string":return rP(a);case"symbol":return pN(a);case"boolean":return WI(a);case"object":if(a instanceof Date)return tP(a);if(a instanceof Uint8Array)return JI(a);if(a instanceof BS)return pN(a);default:throw ni(a,gN)}}const cP="Key";function M0(a){if(/^[a-z*][a-z0-9\-_.*]*$/.test(a)===!1)throw ni(a,cP);return a}function $p(a){return a==null?"":Object.entries(a).map(([e,s])=>s===!0?`;${M0(e)}`:`;${M0(e)}=${D0(s)}`).join("")}function GS(a){return a instanceof ai?`${D0(a.value)}${$p(a.params)}`:D0(a)}function dP(a){return`(${a.value.map(GS).join(" ")})${$p(a.params)}`}function uP(a,e={whitespace:!0}){if(typeof a!="object"||a==null)throw ni(a,KI);const s=a instanceof Map?a.entries():Object.entries(a),n=e?.whitespace?" ":"";return Array.from(s).map(([i,l])=>{l instanceof ai||(l=new ai(l));let o=M0(i);return l.value===!0?o+=$p(l.params):(o+="=",Array.isArray(l.value)?o+=dP(l):o+=GS(l)),o}).join(`,${n}`)}function VS(a,e){return uP(a,e)}const Wn="CMCD-Object",Ms="CMCD-Request",el="CMCD-Session",gr="CMCD-Status",hP={br:Wn,ab:Wn,d:Wn,ot:Wn,tb:Wn,tpb:Wn,lb:Wn,tab:Wn,lab:Wn,url:Wn,pb:Ms,bl:Ms,tbl:Ms,dl:Ms,ltc:Ms,mtp:Ms,nor:Ms,nrr:Ms,rc:Ms,sn:Ms,sta:Ms,su:Ms,ttfb:Ms,ttfbb:Ms,ttlb:Ms,cmsdd:Ms,cmsds:Ms,smrt:Ms,df:Ms,cs:Ms,ts:Ms,cid:el,pr:el,sf:el,sid:el,st:el,v:el,msd:el,bs:gr,bsd:gr,cdn:gr,rtp:gr,bg:gr,pt:gr,ec:gr,e:gr},fP={REQUEST:Ms};function mP(a){return Object.keys(a).reduce((e,s)=>{var n;return(n=a[s])===null||n===void 0||n.forEach(i=>e[i]=s),e},{})}function gP(a,e){const s={};if(!a)return s;const n=Object.keys(a),i=e?mP(e):{};return n.reduce((l,o)=>{var d;const h=hP[o]||i[o]||fP.REQUEST,u=(d=l[h])!==null&&d!==void 0?d:l[h]={};return u[o]=a[o],l},s)}function pP(a){return["ot","sf","st","e","sta"].includes(a)}function xP(a){return typeof a=="number"?Ze(a):a!=null&&a!==""&&a!==!1}const qS="event";function yP(a,e){const s=new URL(a),n=new URL(e);if(s.origin!==n.origin)return a;const i=s.pathname.split("/").slice(1),l=n.pathname.split("/").slice(1,-1);for(;i[0]===l[0];)i.shift(),l.shift();for(;l.length;)l.shift(),i.unshift("..");return i.join("/")+s.search+s.hash}const lh=a=>Math.round(a),I0=(a,e)=>Array.isArray(a)?a.map(s=>I0(s,e)):a instanceof ai&&typeof a.value=="string"?new ai(I0(a.value,e),a.params):(e.baseUrl&&(a=yP(a,e.baseUrl)),e.version===1?encodeURIComponent(a):a),Du=a=>lh(a/100)*100,bP=(a,e)=>{let s=a;return e.version>=2&&(a instanceof ai&&typeof a.value=="string"?s=new ai([a]):typeof a=="string"&&(s=[a])),I0(s,e)},vP={br:lh,d:lh,bl:Du,dl:Du,mtp:Du,nor:bP,rtp:Du,tb:lh},KS="request",HS="response",Gp=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],_P=["e"],NP=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Zh(a){return NP.test(a)}function wP(a){return Gp.includes(a)||_P.includes(a)||Zh(a)}const zS=["d","dl","nor","ot","rtp","su"];function SP(a){return Gp.includes(a)||zS.includes(a)||Zh(a)}const jP=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function EP(a){return Gp.includes(a)||zS.includes(a)||jP.includes(a)||Zh(a)}const TP=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function AP(a){return TP.includes(a)||Zh(a)}const CP={[HS]:EP,[qS]:wP,[KS]:SP};function YS(a,e={}){const s={};if(a==null||typeof a!="object")return s;const n=e.version||a.v||1,i=e.reportingMode||KS,l=n===1?AP:CP[i];let o=Object.keys(a).filter(l);const d=e.filter;typeof d=="function"&&(o=o.filter(d));const h=i===HS||i===qS;h&&!o.includes("ts")&&o.push("ts"),n>1&&!o.includes("v")&&o.push("v");const u=ds({},vP,e.formatters),f={version:n,reportingMode:i,baseUrl:e.baseUrl};return o.sort().forEach(g=>{let p=a[g];const b=u[g];if(typeof b=="function"&&(p=b(p,f)),g==="v"){if(n===1)return;p=n}g=="pr"&&p===1||(h&&g==="ts"&&!Ze(p)&&(p=Date.now()),xP(p)&&(pP(g)&&typeof p=="string"&&(p=new BS(p)),s[g]=p))}),s}function kP(a,e={}){const s={};if(!a)return s;const n=YS(a,e),i=gP(n,e?.customHeaderMap);return Object.entries(i).reduce((l,[o,d])=>{const h=VS(d,{whitespace:!1});return h&&(l[o]=h),l},s)}function RP(a,e,s){return ds(a,kP(e,s))}const LP="CMCD";function DP(a,e={}){return a?VS(YS(a,e),{whitespace:!1}):""}function MP(a,e={}){if(!a)return"";const s=DP(a,e);return encodeURIComponent(s)}function IP(a,e={}){if(!a)return"";const s=MP(a,e);return`${LP}=${s}`}const xN=/CMCD=[^&#]+/;function PP(a,e,s){const n=IP(e,s);if(!n)return a;if(xN.test(a))return a.replace(xN,n);const i=a.includes("?")?"&":"?";return`${a}${i}${n}`}class OP{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:Ia.MANIFEST,su:!this.initialized})}catch(l){this.hls.logger.warn("Could not generate manifest CMCD data.",l)}},this.applyFragmentData=i=>{try{const{frag:l,part:o}=i,d=this.hls.levels[l.level],h=this.getObjectType(l),u={d:(o||l).duration*1e3,ot:h};(h===Ia.VIDEO||h===Ia.AUDIO||h==Ia.MUXED)&&(u.br=d.bitrate/1e3,u.tb=this.getTopBandwidth(h)/1e3,u.bl=this.getBufferLength(h));const f=o?this.getNextPart(o):this.getNextFrag(l);f!=null&&f.url&&f.url!==l.url&&(u.nor=f.url),this.apply(i,u)}catch(l){this.hls.logger.warn("Could not generate segment CMCD data.",l)}},this.hls=e;const s=this.config=e.config,{cmcd:n}=s;n!=null&&(s.pLoader=this.createPlaylistLoader(),s.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on($.MEDIA_ATTACHED,this.onMediaAttached,this),e.on($.MEDIA_DETACHED,this.onMediaDetached,this),e.on($.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off($.MEDIA_ATTACHED,this.onMediaAttached,this),e.off($.MEDIA_DETACHED,this.onMediaDetached,this),e.off($.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,s){this.media=s.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,s){var n,i;this.audioBuffer=(n=s.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(i=s.tracks.video)==null?void 0:i.buffer}createData(){var e;return{v:1,sf:qI.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,s={}){ds(s,this.createData());const n=s.ot===Ia.INIT||s.ot===Ia.VIDEO||s.ot===Ia.MUXED;this.starved&&n&&(s.bs=!0,s.su=!0,this.starved=!1),s.su==null&&(s.su=this.buffering);const{includeKeys:i}=this;i&&(s=Object.keys(s).reduce((o,d)=>(i.includes(d)&&(o[d]=s[d]),o),{}));const l={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),RP(e.headers,s,l)):e.url=PP(e.url,s,l)}getNextFrag(e){var s;const n=(s=this.hls.levels[e.level])==null?void 0:s.details;if(n){const i=e.sn-n.startSN;return n.fragments[i+1]}}getNextPart(e){var s;const{index:n,fragment:i}=e,l=(s=this.hls.levels[i.level])==null||(s=s.details)==null?void 0:s.partList;if(l){const{sn:o}=i;for(let d=l.length-1;d>=0;d--){const h=l[d];if(h.index===n&&h.fragment.sn===o)return l[d+1]}}}getObjectType(e){const{type:s}=e;if(s==="subtitle")return Ia.TIMED_TEXT;if(e.sn==="initSegment")return Ia.INIT;if(s==="audio")return Ia.AUDIO;if(s==="main")return this.hls.audioTracks.length?Ia.VIDEO:Ia.MUXED}getTopBandwidth(e){let s=0,n;const i=this.hls;if(e===Ia.AUDIO)n=i.audioTracks;else{const l=i.maxAutoLevel,o=l>-1?l+1:i.levels.length;n=i.levels.slice(0,o)}return n.forEach(l=>{l.bitrate>s&&(s=l.bitrate)}),s>0?s:NaN}getBufferLength(e){const s=this.media,n=e===Ia.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!s?NaN:St.bufferInfo(n,s.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,s=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(l){this.loader=void 0,this.loader=new n(l)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(l,o,d){s(l),this.loader.load(l,o,d)}}}createFragmentLoader(){const{fLoader:e}=this.config,s=this.applyFragmentData,n=e||this.config.loader;return class{constructor(l){this.loader=void 0,this.loader=new n(l)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(l,o,d){s(l),this.loader.load(l,o,d)}}}}const FP=3e5;class BP extends En{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.MANIFEST_LOADED,this.onManifestLoaded,this),e.on($.MANIFEST_PARSED,this.onManifestParsed,this),e.on($.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.MANIFEST_LOADED,this.onManifestLoaded,this),e.off($.MANIFEST_PARSED,this.onManifestParsed,this),e.off($.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,s)=>(e.indexOf(s.pathwayId)===-1&&e.push(s.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const s=this.levels;s&&(this.levels=s.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,s){const{contentSteering:n}=s;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,s){this.audioTracks=s.audioTracks,this.subtitleTracks=s.subtitleTracks}onError(e,s){const{errorAction:n}=s;if(n?.action===oa.SendAlternateToPenaltyBox&&n.flags===Ja.MoveAllAlternatesMatchingHost){const i=this.levels;let l=this._pathwayPriority,o=this.pathwayId;if(s.context){const{groupId:d,pathwayId:h,type:u}=s.context;d&&i?o=this.getPathwayForGroupId(d,u,o):h&&(o=h)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!l&&i&&(l=this.pathways()),l&&l.length>1&&(this.updatePathwayPriority(l),n.resolved=this.pathwayId!==o),s.details===Ne.BUFFER_APPEND_ERROR&&!s.fatal?n.resolved=!0:n.resolved||this.warn(`Could not resolve ${s.details} ("${s.error.message}") with content-steering for Pathway: ${o} levels: ${i&&i.length} priorities: ${ms(l)} penalized: ${ms(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let s=this.getLevelsForPathway(this.pathwayId);if(s.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),s=this.getLevelsForPathway(n),this.pathwayId=n}return s.length!==e.length&&this.log(`Found ${s.length}/${e.length} levels in Pathway "${this.pathwayId}"`),s}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(s=>e===s.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let s;const n=this.penalizedPathways,i=performance.now();Object.keys(n).forEach(l=>{i-n[l]>FP&&delete n[l]});for(let l=0;l<e.length;l++){const o=e[l];if(o in n)continue;if(o===this.pathwayId)return;const d=this.hls.nextLoadLevel,h=this.hls.levels[d];if(s=this.getLevelsForPathway(o),s.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,mS(s),this.hls.trigger($.LEVELS_UPDATED,{levels:s});const u=this.hls.levels[d];h&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==h.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==h.bitrate&&this.log(`Unstable Pathways change from bitrate ${h.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=d);break}}}getPathwayForGroupId(e,s,n){const i=this.getLevelsForPathway(n).concat(this.levels||[]);for(let l=0;l<i.length;l++)if(s===It.AUDIO_TRACK&&i[l].hasAudioGroup(e)||s===It.SUBTITLE_TRACK&&i[l].hasSubtitleGroup(e))return i[l].pathwayId;return n}clonePathways(e){const s=this.levels;if(!s)return;const n={},i={};e.forEach(l=>{const{ID:o,"BASE-ID":d,"URI-REPLACEMENT":h}=l;if(s.some(f=>f.pathwayId===o))return;const u=this.getLevelsForPathway(d).map(f=>{const g=new Es(f.attrs);g["PATHWAY-ID"]=o;const p=g.AUDIO&&`${g.AUDIO}_clone_${o}`,b=g.SUBTITLES&&`${g.SUBTITLES}_clone_${o}`;p&&(n[g.AUDIO]=p,g.AUDIO=p),b&&(i[g.SUBTITLES]=b,g.SUBTITLES=b);const y=WS(f.uri,g["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",h),v=new Hc({attrs:g,audioCodec:f.audioCodec,bitrate:f.bitrate,height:f.height,name:f.name,url:y,videoCodec:f.videoCodec,width:f.width});if(f.audioGroups)for(let _=1;_<f.audioGroups.length;_++)v.addGroupId("audio",`${f.audioGroups[_]}_clone_${o}`);if(f.subtitleGroups)for(let _=1;_<f.subtitleGroups.length;_++)v.addGroupId("text",`${f.subtitleGroups[_]}_clone_${o}`);return v});s.push(...u),yN(this.audioTracks,n,h,o),yN(this.subtitleTracks,i,h,o)})}loadSteeringManifest(e){const s=this.hls.config,n=s.loader;this.loader&&this.loader.destroy(),this.loader=new n(s);let i;try{i=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(i.protocol!=="data:"){const f=(this.hls.bandwidthEstimate||s.abrEwmaDefaultEstimate)|0;i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+f)}const l={responseType:"json",url:i.href},o=s.steeringManifestLoadPolicy.default,d=o.errorRetry||o.timeoutRetry||{},h={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:d.maxNumRetry||0,retryDelay:d.retryDelayMs||0,maxRetryDelay:d.maxRetryDelayMs||0},u={onSuccess:(f,g,p,b)=>{this.log(`Loaded steering manifest: "${i}"`);const y=f.data;if(y?.VERSION!==1){this.log(`Steering VERSION ${y.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=y.TTL;const{"RELOAD-URI":v,"PATHWAY-CLONES":_,"PATHWAY-PRIORITY":N}=y;if(v)try{this.uri=new self.URL(v,i).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${v}`);return}this.scheduleRefresh(this.uri||p.url),_&&this.clonePathways(_);const C={steeringManifest:y,url:i.toString()};this.hls.trigger($.STEERING_MANIFEST_LOADED,C),N&&this.updatePathwayPriority(N)},onError:(f,g,p,b)=>{if(this.log(`Error loading steering manifest: ${f.code} ${f.text} (${g.url})`),this.stopLoad(),f.code===410){this.enabled=!1,this.log(`Steering manifest ${g.url} no longer available`);return}let y=this.timeToLoad*1e3;if(f.code===429){const v=this.loader;if(typeof v?.getResponseHeader=="function"){const _=v.getResponseHeader("Retry-After");_&&(y=parseFloat(_)*1e3)}this.log(`Steering manifest ${g.url} rate limited`);return}this.scheduleRefresh(this.uri||g.url,y)},onTimeout:(f,g,p)=>{this.log(`Timeout loading steering manifest (${g.url})`),this.scheduleRefresh(this.uri||g.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(l,h,u)}scheduleRefresh(e,s=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var n;const i=(n=this.hls)==null?void 0:n.media;if(i&&!i.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},s)}}function yN(a,e,s,n){a&&Object.keys(e).forEach(i=>{const l=a.filter(o=>o.groupId===i).map(o=>{const d=ds({},o);return d.details=void 0,d.attrs=new Es(d.attrs),d.url=d.attrs.URI=WS(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",s),d.groupId=d.attrs["GROUP-ID"]=e[i],d.attrs["PATHWAY-ID"]=n,d});a.push(...l)})}function WS(a,e,s,n){const{HOST:i,PARAMS:l,[s]:o}=n;let d;e&&(d=o?.[e],d&&(a=d));const h=new self.URL(a);return i&&!d&&(h.host=i),l&&Object.keys(l).sort().forEach(u=>{u&&h.searchParams.set(u,l[u])}),h.href}class xo extends En{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=xo.CDMCleanupPromise?[xo.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=s=>{const{initDataType:n,initData:i}=s,l=`"${s.type}" event: init data type: "${n}"`;if(this.debug(l),i!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=Dc(this.config));const d=o.map(vg).filter(h=>!!h);this.keyFormatPromise=this.getKeyFormatPromise(d)}this.keyFormatPromise.then(o=>{const d=nh(o);if(n!=="sinf"||d!==Ts.FAIRPLAY){this.log(`Ignoring "${s.type}" event with init data type: "${n}" for selected key-system ${d}`);return}let h;try{const b=Qs(new Uint8Array(i)),y=kp(JSON.parse(b).sinf),v=Vw(y);if(!v)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");h=new Uint8Array(v.subarray(8,24))}catch(b){this.warn(`${l} Failed to parse sinf: ${b}`);return}const u=ca(h),{keyIdToKeySessionPromise:f,mediaKeySessions:g}=this;let p=f[u];for(let b=0;b<g.length;b++){const y=g[b],v=y.decryptdata;if(!v.keyId)continue;const _=ca(v.keyId);if(Ah(h,v.keyId)||v.uri.replace(/-/g,"").indexOf(u)!==-1){if(p=f[_],!p)continue;if(v.pssh)break;delete f[_],v.pssh=new Uint8Array(i),v.keyId=h,p=f[u]=p.then(()=>this.generateRequestWithPreferredKeySession(y,n,i,"encrypted-event-key-match")),p.catch(N=>this.handleError(N));break}}p||this.handleError(new Error(`Key ID ${u} not encountered in playlist. Key-system sessions ${g.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=s=>{this.log(`"${s.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on($.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on($.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on($.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on($.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on($.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off($.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off($.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off($.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off($.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off($.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:s,widevineLicenseUrl:n}=this.config,i=s?.[e];if(i)return i.licenseUrl;if(e===Ts.WIDEVINE&&n)return n}getLicenseServerUrlOrThrow(e){const s=this.getLicenseServerUrl(e);if(s===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return s}getServerCertificateUrl(e){const{drmSystems:s}=this.config,n=s?.[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const s=this.hls.levels,n=(o,d,h)=>!!o&&h.indexOf(o)===d,i=s.map(o=>o.audioCodec).filter(n),l=s.map(o=>o.videoCodec).filter(n);return i.length+l.length===0&&l.push("avc1.42e01e"),new Promise((o,d)=>{const h=u=>{const f=u.shift();this.getMediaKeysPromise(f,i,l).then(g=>o({keySystem:f,mediaKeys:g})).catch(g=>{u.length?h(u):g instanceof Xa?d(g):d(new Xa({type:rt.KEY_SYSTEM_ERROR,details:Ne.KEY_SYSTEM_NO_ACCESS,error:g,fatal:!0},g.message))})};h(e)})}requestMediaKeySystemAccess(e,s){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let i=`Configured requestMediaKeySystemAccess is not a function ${n}`;return rS===null&&self.location.protocol==="http:"&&(i=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(i))}return n(e,s)}getMediaKeysPromise(e,s,n){var i;const l=bM(e,s,n,this.config.drmSystemOptions||{});let o=this.keySystemAccessPromises[e],d=(i=o)==null?void 0:i.keySystemAccess;if(!d){this.log(`Requesting encrypted media "${e}" key-system access with config: ${ms(l)}`),d=this.requestMediaKeySystemAccess(e,l);const h=o=this.keySystemAccessPromises[e]={keySystemAccess:d};return d.catch(u=>{this.log(`Failed to obtain access to key-system "${e}": ${u}`)}),d.then(u=>{this.log(`Access for key-system "${u.keySystem}" obtained`);const f=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const g=h.mediaKeys=u.createMediaKeys().then(p=>(this.log(`Media-keys created for "${e}"`),h.hasMediaKeys=!0,f.then(b=>b?this.setMediaKeysServerCertificate(p,e,b):p)));return g.catch(p=>{this.error(`Failed to create media-keys for "${e}"}: ${p}`)}),g})}return d.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:s,mediaKeys:n}){this.log(`Creating key-system session "${s}" keyId: ${ca(e.keyId||[])} keyUri: ${e.uri}`);const i=n.createSession(),l={decryptdata:e,keySystem:s,mediaKeys:n,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(l),l}renewKeySession(e){const s=e.decryptdata;if(s.pssh){const n=this.createMediaKeySessionContext(e),i=Mu(s),l="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(n,l,s.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,s){const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyId ${ca(e.decryptdata.keyId||[])}
      } (data length: ${s.byteLength})`),n.update(s)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>vg(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:s,mediaKeys:n})=>this.attemptSetMediaKeys(s,n))}selectKeySystem(e){return new Promise((s,n)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:i})=>{const l=vg(i);l?s(l):n(new Error(`Unable to find format for key-system "${i}"`))}).catch(n)})}selectKeySystemFormat(e){const s=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)),this.keyFormatPromise}getKeyFormatPromise(e){const s=Dc(this.config),n=e.map(nh).filter(i=>!!i&&s.indexOf(i)!==-1);return this.selectKeySystem(n)}getKeyStatus(e){const{mediaKeySessions:s}=this;for(let n=0;n<s.length;n++){const i=UP(e,s[n]);if(i)return i}}loadKey(e){const s=e.keyInfo.decryptdata,n=Mu(s),i=this.bannedKeyIds[n];if(i||this.getKeyStatus(s)==="internal-error"){const d=bN(i||"internal-error",s);return this.handleError(d,e.frag),Promise.reject(d)}const l=`(keyId: ${n} format: "${s.keyFormat}" method: ${s.method} uri: ${s.uri})`;this.log(`Starting session for key ${l}`);const o=this.keyIdToKeySessionPromise[n];if(!o){const d=this.getKeySystemForKeyPromise(s).then(({keySystem:h,mediaKeys:u})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${l}`),this.attemptSetMediaKeys(h,u).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:h,mediaKeys:u,decryptdata:s}))))).then(h=>{const u="cenc",f=s.pssh?s.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(h,u,f,"playlist-key")});return d.catch(h=>this.handleError(h,e.frag)),this.keyIdToKeySessionPromise[n]=d,d}return o.catch(d=>{if(d instanceof Xa){const h=is({},d.data);this.getKeyStatus(s)==="internal-error"&&(h.decryptdata=s);const u=new Xa(h,d.message);this.handleError(u,e.frag)}}),o}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,s){if(this.hls)if(e instanceof Xa){s&&(e.data.frag=s);const n=e.data.decryptdata;this.error(`${e.message}${n?` (${ca(n.keyId||[])})`:""}`),this.hls.trigger($.ERROR,e.data)}else this.error(e.message),this.hls.trigger($.ERROR,{type:rt.KEY_SYSTEM_ERROR,details:Ne.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const s=Mu(e),n=this.keyIdToKeySessionPromise[s];if(!n){const i=nh(e.keyFormat),l=i?[i]:Dc(this.config);return this.attemptKeySystemAccess(l)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=Dc(this.config)),e.length===0)throw new Xa({type:rt.KEY_SYSTEM_ERROR,details:Ne.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${ms({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,s){if(this.mediaResolved=void 0,this.mediaKeys===s)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(n).then(()=>this.media?this.media.setMediaKeys(s):new Promise((l,o)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return o(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=s,this.media.setMediaKeys(s).then(l).catch(o)}}));return this.mediaKeys=s,this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(l=>n.indexOf(l)===-1)})}generateRequestWithPreferredKeySession(e,s,n,i){var l;const o=(l=this.config.drmSystems)==null||(l=l[e.keySystem])==null?void 0:l.generateRequest;if(o)try{const y=o.call(this.hls,s,n,e);if(!y)throw new Error("Invalid response from configured generateRequest filter");s=y.initDataType,n=y.initData?y.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(y){if(this.warn(y.message),this.hls&&this.hls.config.debug)throw y}if(n===null)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const d=Mu(e.decryptdata),h=e.decryptdata.uri;this.log(`Generating key-session request for "${i}" keyId: ${d} URI: ${h} (init data type: ${s} length: ${n.byteLength})`);const u=new Lp,f=e._onmessage=y=>{const v=e.mediaKeysSession;if(!v){u.emit("error",new Error("invalid state"));return}const{messageType:_,message:N}=y;this.log(`"${_}" message event for session "${v.sessionId}" message size: ${N.byteLength}`),_==="license-request"||_==="license-renewal"?this.renewLicense(e,N).catch(C=>{u.eventNames().length?u.emit("error",C):this.handleError(C)}):_==="license-release"?e.keySystem===Ts.FAIRPLAY&&this.updateKeySession(e,T0("acknowledged")).then(()=>this.removeSession(e)).catch(C=>this.handleError(C)):this.warn(`unhandled media key message type "${_}"`)},g=(y,v)=>{v.keyStatus=y;let _;y.startsWith("usable")?u.emit("resolved"):y==="internal-error"||y==="output-restricted"||y==="output-downscaled"?_=bN(y,v.decryptdata):y==="expired"?_=new Error(`key expired (keyId: ${d})`):y==="released"?_=new Error("key released"):y==="status-pending"||this.warn(`unhandled key status change "${y}" (keyId: ${d})`),_&&(u.eventNames().length?u.emit("error",_):this.handleError(_))},p=e._onkeystatuseschange=y=>{if(!e.mediaKeysSession){u.emit("error",new Error("invalid state"));return}const _=this.getKeyStatuses(e);if(!Object.keys(_).some(L=>_[L]!=="status-pending"))return;if(_[d]==="expired"){this.log(`Expired key ${ms(_)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let C=_[d];if(C)g(C,e);else{var T;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(T=e.keyStatusTimeouts)[d]||(T[d]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const F=this.getKeyStatus(e.decryptdata);if(F&&F!=="status-pending")return this.log(`No status for keyId ${d} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${F} from other session.`),g(F,e);this.log(`key status for ${d} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),C="internal-error",g(C,e)},1e3)),this.log(`No status for keyId ${d} (${ms(_)}).`)}};Na(e.mediaKeysSession,"message",f),Na(e.mediaKeysSession,"keystatuseschange",p);const b=new Promise((y,v)=>{u.on("error",v),u.on("resolved",y)});return e.mediaKeysSession.generateRequest(s,n).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${d} URI: ${h}`)}).catch(y=>{throw new Xa({type:rt.KEY_SYSTEM_ERROR,details:Ne.KEY_SYSTEM_NO_SESSION,error:y,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${y}`)}).then(()=>b).catch(y=>(u.removeAllListeners(),this.removeSession(e).then(()=>{throw y}))).then(()=>(u.removeAllListeners(),e))}getKeyStatuses(e){const s={};return e.mediaKeysSession.keyStatuses.forEach((n,i)=>{if(typeof i=="string"&&typeof n=="object"){const d=i;i=n,n=d}const l="buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i);if(e.keySystem===Ts.PLAYREADY&&l.length===16){const d=ca(l);s[d]=n,nS(l)}const o=ca(l);n==="internal-error"&&(this.bannedKeyIds[o]=n),this.log(`key status change "${n}" for keyStatuses keyId: ${o} key-session "${e.mediaKeysSession.sessionId}"`),s[o]=n}),s}fetchServerCertificate(e){const s=this.config,n=s.loader,i=new n(s),l=this.getServerCertificateUrl(e);return l?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,d)=>{const h={responseType:"arraybuffer",url:l},u=s.certLoadPolicy.default,f={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(p,b,y,v)=>{o(p.data)},onError:(p,b,y,v)=>{d(new Xa({type:rt.KEY_SYSTEM_ERROR,details:Ne.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:y,response:is({url:h.url,data:void 0},p)},`"${e}" certificate request failed (${l}). Status: ${p.code} (${p.text})`))},onTimeout:(p,b,y)=>{d(new Xa({type:rt.KEY_SYSTEM_ERROR,details:Ne.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:y,response:{url:h.url,data:void 0}},`"${e}" certificate request timed out (${l})`))},onAbort:(p,b,y)=>{d(new Error("aborted"))}};i.load(h,f,g)})):Promise.resolve()}setMediaKeysServerCertificate(e,s,n){return new Promise((i,l)=>{e.setServerCertificate(n).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${n.byteLength}) on "${s}"`),i(e)}).catch(o=>{l(new Xa({type:rt.KEY_SYSTEM_ERROR,details:Ne.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,s){return this.requestLicense(e,new Uint8Array(s)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(i=>{throw new Xa({type:rt.KEY_SYSTEM_ERROR,details:Ne.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:i,fatal:!1},i.message)}))}unpackPlayReadyKeyMessage(e,s){const n=String.fromCharCode.apply(null,new Uint16Array(s.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),s;const i=new DOMParser().parseFromString(n,"application/xml"),l=i.querySelectorAll("HttpHeader");if(l.length>0){let f;for(let g=0,p=l.length;g<p;g++){var o,d;f=l[g];const b=(o=f.querySelector("name"))==null?void 0:o.textContent,y=(d=f.querySelector("value"))==null?void 0:d.textContent;b&&y&&e.setRequestHeader(b,y)}}const h=i.querySelector("Challenge"),u=h?.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return T0(atob(u))}setupLicenseXHR(e,s,n,i){const l=this.config.licenseXhrSetup;return l?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return l.call(this.hls,e,s,n,i)}).catch(o=>{if(!n.decryptdata)throw o;return e.open("POST",s,!0),l.call(this.hls,e,s,n,i)}).then(o=>(e.readyState||e.open("POST",s,!0),{xhr:e,licenseChallenge:o||i})):(e.open("POST",s,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,s){const n=this.config.keyLoadPolicy.default;return new Promise((i,l)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const d=new XMLHttpRequest;d.responseType="arraybuffer",d.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return l(new Error("invalid state"));if(d.readyState===4)if(d.status===200){this._requestLicenseFailureCount=0;let h=d.response;this.log(`License received ${h instanceof ArrayBuffer?h.byteLength:h}`);const u=this.config.licenseResponseCallback;if(u)try{h=u.call(this.hls,d,o,e)}catch(f){this.error(f)}i(h)}else{const h=n.errorRetry,u=h?h.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||d.status>=400&&d.status<500)l(new Xa({type:rt.KEY_SYSTEM_ERROR,details:Ne.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:d,response:{url:o,data:void 0,code:d.status,text:d.statusText}},`License Request XHR failed (${o}). Status: ${d.status} (${d.statusText})`));else{const f=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${f} attempts left`),this.requestLicense(e,s).then(i,l)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=d,this.setupLicenseXHR(d,o,e,s).then(({xhr:h,licenseChallenge:u})=>{e.keySystem==Ts.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(h,u)),h.send(u)}).catch(l)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,s){if(!this.config.emeEnabled)return;const n=s.media;this.media=n,Na(n,"encrypted",this.onMediaEncrypted),Na(n,"waitingforkey",this.onWaitingForKey);const i=this.mediaResolved;i?i():this.mediaKeys=n.mediaKeys}onMediaDetached(){const e=this.media;e&&(Pa(e,"encrypted",this.onMediaEncrypted),Pa(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const s=this.mediaResolved;if(s&&s(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const n=this.media,i=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,jr.clearKeyUriToKeyIdMap();const l=i.length;xo.CDMCleanupPromise=Promise.all(i.map(o=>this.removeSession(o)).concat((n==null||(e=n.setMediaKeys(null))==null?void 0:e.catch(o=>{this.log(`Could not clear media keys: ${o}`),this.hls&&this.hls.trigger($.ERROR,{type:rt.OTHER_ERROR,details:Ne.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${o}`)})}))||Promise.resolve())).catch(o=>{this.log(`Could not close sessions and clear media keys: ${o}`),this.hls&&this.hls.trigger($.ERROR,{type:rt.OTHER_ERROR,details:Ne.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${o}`)})}).then(()=>{l&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:s}){if(!(!s||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=s.reduce((i,l)=>(i.indexOf(l.keyFormat)===-1&&i.push(l.keyFormat),i),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:s,licenseXhr:n,decryptdata:i}=e;if(s){this.log(`Remove licenses and keys and close session "${s.sessionId}" keyId: ${ca(i?.keyId||[])}`),e._onmessage&&(s.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(s.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const l=this.mediaKeySessions.indexOf(e);l>-1&&this.mediaKeySessions.splice(l,1);const{keyStatusTimeouts:o}=e;o&&Object.keys(o).forEach(u=>self.clearTimeout(o[u]));const{drmSystemOptions:d}=this.config;return(_M(d)?new Promise((u,f)=>{self.setTimeout(()=>f(new Error("MediaKeySession.remove() timeout")),8e3),s.remove().then(u).catch(f)}):Promise.resolve()).catch(u=>{this.log(`Could not remove session: ${u}`),this.hls&&this.hls.trigger($.ERROR,{type:rt.OTHER_ERROR,details:Ne.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${u}`)})}).then(()=>s.close()).catch(u=>{this.log(`Could not close session: ${u}`),this.hls&&this.hls.trigger($.ERROR,{type:rt.OTHER_ERROR,details:Ne.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${u}`)})})}return Promise.resolve()}}xo.CDMCleanupPromise=void 0;function Mu(a){if(!a)throw new Error("Could not read keyId of undefined decryptdata");if(a.keyId===null)throw new Error("keyId is null");return ca(a.keyId)}function UP(a,e){if(a.keyId&&e.mediaKeysSession.keyStatuses.has(a.keyId))return e.mediaKeysSession.keyStatuses.get(a.keyId);if(a.matches(e.decryptdata))return e.keyStatus}class Xa extends Error{constructor(e,s){super(s),this.data=void 0,e.error||(e.error=new Error(s)),this.data=e,e.err=e.error}}function bN(a,e){const s=a==="output-restricted",n=s?Ne.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:Ne.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Xa({type:rt.KEY_SYSTEM_ERROR,details:n,fatal:!1,decryptdata:e},s?"HDCP level output restricted":`key status changed to "${a}"`)}class $P{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on($.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on($.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off($.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off($.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,s){const n=this.hls.config;if(n.capLevelOnFPSDrop){const i=s.media instanceof self.HTMLVideoElement?s.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,s,n){const i=performance.now();if(s){if(this.lastTime){const l=i-this.lastTime,o=n-this.lastDroppedFrames,d=s-this.lastDecodedFrames,h=1e3*o/l,u=this.hls;if(u.trigger($.FPS_DROP,{currentDropped:o,currentDecoded:d,totalDroppedFrames:n}),h>0&&o>u.config.fpsDroppedMonitoringThreshold*d){let f=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=f)&&(f=f-1,u.trigger($.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:u.currentLevel}),u.autoLevelCapping=f,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=n,this.lastDecodedFrames=s}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const s=e.getVideoPlaybackQuality();this.checkFPS(e,s.totalVideoFrames,s.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function QS(a,e){let s;try{s=new Event("addtrack")}catch{s=document.createEvent("Event"),s.initEvent("addtrack",!1,!1)}s.track=a,e.dispatchEvent(s)}function XS(a,e){const s=a.mode;if(s==="disabled"&&(a.mode="hidden"),a.cues&&!a.cues.getCueById(e.id))try{if(a.addCue(e),!a.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){rs.debug(`[texttrack-utils]: ${n}`);try{const i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,a.addCue(i)}catch(i){rs.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}s==="disabled"&&(a.mode=s)}function uo(a,e){const s=a.mode;if(s==="disabled"&&(a.mode="hidden"),a.cues)for(let n=a.cues.length;n--;)e&&a.cues[n].removeEventListener("enter",e),a.removeCue(a.cues[n]);s==="disabled"&&(a.mode=s)}function P0(a,e,s,n){const i=a.mode;if(i==="disabled"&&(a.mode="hidden"),a.cues&&a.cues.length>0){const l=VP(a.cues,e,s);for(let o=0;o<l.length;o++)(!n||n(l[o]))&&a.removeCue(l[o])}i==="disabled"&&(a.mode=i)}function GP(a,e){if(e<=a[0].startTime)return 0;const s=a.length-1;if(e>a[s].endTime)return-1;let n=0,i=s,l;for(;n<=i;)if(l=Math.floor((i+n)/2),e<a[l].startTime)i=l-1;else if(e>a[l].startTime&&n<s)n=l+1;else return l;return a[n].startTime-e<e-a[i].startTime?n:i}function VP(a,e,s){const n=[],i=GP(a,e);if(i>-1)for(let l=i,o=a.length;l<o;l++){const d=a[l];if(d.startTime>=e&&d.endTime<=s)n.push(d);else if(d.startTime>s)return n}return n}function oh(a){const e=[];for(let s=0;s<a.length;s++){const n=a[s];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(a[s])}return e}class qP extends Bp{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let s=null;const n=oh(this.media.textTracks);for(let l=0;l<n.length;l++)if(n[l].mode==="hidden")s=n[l];else if(n[l].mode==="showing"){s=n[l];break}const i=this.findTrackForTextTrack(s);this.subtitleTrack!==i&&this.setSubtitleTrack(i)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on($.MEDIA_ATTACHED,this.onMediaAttached,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.MANIFEST_PARSED,this.onManifestParsed,this),e.on($.LEVEL_LOADING,this.onLevelLoading,this),e.on($.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on($.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on($.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off($.MEDIA_ATTACHED,this.onMediaAttached,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.MANIFEST_PARSED,this.onManifestParsed,this),e.off($.LEVEL_LOADING,this.onLevelLoading,this),e.off($.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off($.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off($.ERROR,this.onError,this)}onMediaAttached(e,s){this.media=s.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,s){const n=this.media;if(!n)return;const i=!!s.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i)return;oh(n.textTracks).forEach(o=>{uo(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,s){this.tracks=s.subtitleTracks}onSubtitleTrackLoaded(e,s){const{id:n,groupId:i,details:l}=s,o=this.tracksInGroup[n];if(!o||o.groupId!==i){this.warn(`Subtitle track with id:${n} and group:${i} not found in active group ${o?.groupId}`);return}const d=o.details;o.details=s.details,this.log(`Subtitle track ${n} "${o.name}" lang:${o.lang} group:${i} loaded [${l.startSN}-${l.endSN}]`),n===this.trackId&&this.playlistLoaded(n,s,d)}onLevelLoading(e,s){this.switchLevel(s.level)}onLevelSwitching(e,s){this.switchLevel(s.level)}switchLevel(e){const s=this.hls.levels[e];if(!s)return;const n=s.subtitleGroups||null,i=this.groupIds;let l=this.currentTrack;if(!n||i?.length!==n?.length||n!=null&&n.some(o=>i?.indexOf(o)===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(f=>!n||n.indexOf(f.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(f=>f.default)&&(this.selectDefaultTrack=!1),o.forEach((f,g)=>{f.id=g});else if(!l&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const d=this.hls.config.subtitlePreference;if(!l&&d){this.selectDefaultTrack=!1;const f=Jn(d,o);if(f>-1)l=o[f];else{const g=Jn(d,this.tracks);l=this.tracks[g]}}let h=this.findTrackId(l);h===-1&&l&&(h=this.findTrackId(null));const u={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${n?.join(",")}" group-id`),this.hls.trigger($.SUBTITLE_TRACKS_UPDATED,u),h!==-1&&this.trackId===-1&&this.setSubtitleTrack(h)}}findTrackId(e){const s=this.tracksInGroup,n=this.selectDefaultTrack;for(let i=0;i<s.length;i++){const l=s[i];if(!(n&&!l.default||!n&&!e)&&(!e||gl(l,e)))return i}if(e){for(let i=0;i<s.length;i++){const l=s[i];if(Qc(e.attrs,l.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<s.length;i++){const l=s[i];if(Qc(e.attrs,l.attrs,["LANGUAGE"]))return i}}return-1}findTrackForTextTrack(e){if(e){const s=this.tracksInGroup;for(let n=0;n<s.length;n++){const i=s[n];if(L0(i,e))return n}}return-1}onError(e,s){s.fatal||!s.context||s.context.type===It.SUBTITLE_TRACK&&s.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(s.context.groupId)!==-1)&&this.checkRetry(s)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const s=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,s.length){const n=this.currentTrack;if(n&&gl(e,n))return n;const i=Jn(e,this.tracksInGroup);if(i>-1){const l=this.tracksInGroup[i];return this.setSubtitleTrack(i),l}else{if(n)return null;{const l=Jn(e,s);if(l>-1)return s[l]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,s){super.loadingPlaylist(e,s);const n=e.id,i=e.groupId,l=this.getUrlWithDirectives(e.url,s),o=e.details,d=o?.age;this.log(`Loading subtitle ${n} "${e.name}" lang:${e.lang} group:${i}${s?.msn!==void 0?" at sn "+s.msn+" part "+s.part:""}${d&&o.live?" age "+d.toFixed(1)+(o.type&&" "+o.type||""):""} ${l}`),this.hls.trigger($.SUBTITLE_TRACK_LOADING,{url:l,id:n,groupId:i,deliveryDirectives:s||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const s=oh(e.textTracks),n=this.currentTrack;let i;if(n&&(i=s.filter(l=>L0(n,l))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(s).forEach(l=>{l.mode!=="disabled"&&l!==i&&(l.mode="disabled")}),i){const l=this.subtitleDisplay?"showing":"hidden";i.mode!==l&&(i.mode=l)}}setSubtitleTrack(e){const s=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=s.length||!Ze(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,i=s[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i){this.hls.trigger($.SUBTITLE_TRACK_SWITCH,{id:e});return}const l=!!i.details&&!i.details.live;if(e===this.trackId&&i===n&&l)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:o,groupId:d="",name:h,type:u,url:f}=i;this.hls.trigger($.SUBTITLE_TRACK_SWITCH,{id:o,groupId:d,name:h,type:u,url:f});const g=this.switchParams(i.url,n?.details,i.details);this.loadPlaylist(g)}}function KP(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),s=e.toString();return URL.revokeObjectURL(e),s.slice(s.lastIndexOf("/")+1)}catch{let s=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const l=(s+Math.random()*16)%16|0;return s=Math.floor(s/16),(i=="x"?l:l&3|8).toString(16)})}}}function Bc(a){let e=5381,s=a.length;for(;s;)e=e*33^a.charCodeAt(--s);return(e>>>0).toString()}const yo=.025;let Lh=(function(a){return a[a.Point=0]="Point",a[a.Range=1]="Range",a})({});function HP(a,e,s){return`${a.identifier}-${s+1}-${Bc(e)}`}class zP{constructor(e,s){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=s,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var s;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;return e<=0||isNaN(n)?!1:n===0?!0:(((s=this.assetList[e])==null?void 0:s.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const s=this.dateRange.tagAnchor;if(s)return Cg(e,s)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const s=this.dateRange.startTime,n=Cg(s,e);return s-n<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,s=Ze(e)?e:this.duration;return this.cumulativeDuration+s}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const s=this.resumeAnchor;if(s)return Cg(e,s)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<yo))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let s;return this._duration!==null?s=this._duration:this.dateRange.duration?s=this.dateRange.duration:s=this.dateRange.plannedDuration||0,!isNaN(e)&&e<s&&(s=e),s}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Lh.Range:Lh.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return YP(this)}}function Cg(a,e){return a-e.start<e.duration/2&&!(Math.abs(a-(e.start+e.duration))<yo)?e.start:e.start+e.duration}function JS(a,e,s){const n=new self.URL(a,s);return n.protocol!=="data:"&&n.searchParams.set("_HLS_primary_id",e),n}function kg(a,e){for(;(s=a.assetList[++e])!=null&&s.error;)var s;return e}function YP(a){return`["${a.identifier}" ${a.cue.pre?"<pre>":a.cue.post?"<post>":""}${a.timelineStart.toFixed(2)}-${a.resumeTime.toFixed(2)}]`}function oo(a){const e=a.timelineStart,s=a.duration||0;return`["${a.identifier}" ${e.toFixed(2)}-${(e+s).toFixed(2)}]`}class WP{constructor(e,s,n,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger($.PLAYOUT_LIMIT_REACHED,{})};const l=this.hls=new e(s);this.interstitial=n,this.assetItem=i;const o=()=>{this.hasDetails=!0};l.once($.LEVEL_LOADED,o),l.once($.AUDIO_TRACK_LOADED,o),l.once($.SUBTITLE_TRACK_LOADED,o),l.on($.MEDIA_ATTACHING,(d,{media:h})=>{this.removeMediaListeners(),this.mediaAttached=h,this.interstitial.playoutLimit&&(h.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&l.on($.BUFFER_APPENDED,()=>{const f=this.bufferedEnd;this.reachedPlayout(f)&&(this._bufferedEosTime=f,l.trigger($.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let s=this.assetItem.uri;try{s=JS(s,e.config.primarySessionId||"").href}catch{}e.loadSource(s)}}bufferedInPlaceToEnd(e){var s;if(!this.appendInPlace)return!1;if((s=this.hls)!=null&&s.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),i=this.timelineOffset,l=St.bufferInfo(e,i,0);return this.getAssetTime(l.end)>=n-.02}reachedPlayout(e){const n=this.interstitial.playoutLimit;return this.startOffset+e>=n}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const s=St.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(s.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const s=this.interstitial.playoutLimit;if(s){const n=s-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const s=this.timelineOffset;if(e!==s){const n=e-s;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const s=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-s),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var s;this.loadSource(),(s=this.hls)==null||s.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const s=n=>delete n.details;e.levels.forEach(s),e.allAudioTracks.forEach(s),e.allSubtitleTracks.forEach(s),this.hasDetails=!1}}on(e,s,n){var i;(i=this.hls)==null||i.on(e,s)}once(e,s,n){var i;(i=this.hls)==null||i.once(e,s)}off(e,s,n){var i;(i=this.hls)==null||i.off(e,s)}toString(){var e;return`HlsAssetPlayer: ${oo(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const vN=.033;class QP extends En{constructor(e,s){super("interstitials-sched",s),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,s){return this.events?this.events.reduce((n,i)=>e<=i.startOffset&&s>i.startOffset?(delete i.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,s){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[n]||(s===void 0&&(s=e.start),n=this.findItemIndexAtTime(s));n>=0&&(l=i[n])!=null&&l.event;){var l;n--}return n}findItemIndexAtTime(e,s){const n=this.items;if(n)for(let i=0;i<n.length;i++){let l=n[i];if(s&&s!=="primary"&&(l=l[s]),e===l.start||e>l.start&&e<l.end)return i}return-1}findJumpRestrictedIndex(e,s){const n=this.items;if(n)for(let i=e;i<=s&&n[i];i++){const l=n[i].event;if(l!=null&&l.restrictions.jump&&!l.appendInPlace)return i}return-1}findEventIndex(e){const s=this.items;if(s)for(let i=s.length;i--;){var n;if(((n=s[i].event)==null?void 0:n.identifier)===e)return i}return-1}findAssetIndex(e,s){const n=e.assetList,i=n.length;if(i>1)for(let l=0;l<i;l++){const o=n[l];if(!o.error){const d=o.timelineStart;if(s===d||s>d&&(s<d+(o.duration||0)||l===i-1))return l}}return 0}get assetIdAtEnd(){var e;const s=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(s){const n=s.assetList,i=n[n.length-1];if(i)return i.identifier}return null}parseInterstitialDateRanges(e,s){const n=e.main.details,{dateRanges:i}=n,l=this.events,o=this.parseDateRanges(i,{url:n.url},s),d=Object.keys(i),h=l?l.filter(u=>!d.includes(u.identifier)):[];o.length&&o.sort((u,f)=>{const g=u.cue.pre,p=u.cue.post,b=f.cue.pre,y=f.cue.post;if(g&&!b)return-1;if(b&&!g||p&&!y)return 1;if(y&&!p)return-1;if(!g&&!b&&!p&&!y){const v=u.startTime,_=f.startTime;if(v!==_)return v-_}return u.dateRange.tagOrder-f.dateRange.tagOrder}),this.events=o,h.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,h)}updateSchedule(e,s=[],n=!1){const i=this.events||[];if(i.length||s.length||this.length<2){const l=this.items,o=this.parseSchedule(i,e);(n||s.length||l?.length!==o.length||o.some((h,u)=>Math.abs(h.playout.start-l[u].playout.start)>.005||Math.abs(h.playout.end-l[u].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(s,l))}}parseDateRanges(e,s,n){const i=[],l=Object.keys(e);for(let o=0;o<l.length;o++){const d=l[o],h=e[d];if(h.isInterstitial){let u=this.eventMap[d];u?u.setDateRange(h):(u=new zP(h,s),this.eventMap[d]=u,n===!1&&(u.appendInPlace=n)),i.push(u)}}return i}parseSchedule(e,s){const n=[],i=s.main.details,l=i.live?1/0:i.edge;let o=0;if(e=e.filter(h=>!h.error&&!(h.cue.once&&h.hasPlayed)),e.length){this.resolveOffsets(e,s);let h=0,u=0;if(e.forEach((f,g)=>{const p=f.cue.pre,b=f.cue.post,y=e[g-1]||null,v=f.appendInPlace,_=b?l:f.startOffset,N=f.duration,C=f.timelineOccupancy===Lh.Range?N:0,T=f.resumptionOffset,L=y?.startTime===_,F=_+f.cumulativeDuration;let H=v?F+N:_+T;if(p||!b&&_<=0){const P=u;u+=C,f.timelineStart=F;const I=o;o+=N,n.push({event:f,start:F,end:H,playout:{start:I,end:o},integrated:{start:P,end:u}})}else if(_<=l){if(!L){const D=_-h;if(D>vN){const O=h,ee=u;u+=D;const ie=o;o+=D;const Z={previousEvent:e[g-1]||null,nextEvent:f,start:O,end:O+D,playout:{start:ie,end:o},integrated:{start:ee,end:u}};n.push(Z)}else D>0&&y&&(y.cumulativeDuration+=D,n[n.length-1].end=_)}b&&(H=F),f.timelineStart=F;const P=u;u+=C;const I=o;o+=N,n.push({event:f,start:F,end:H,playout:{start:I,end:o},integrated:{start:P,end:u}})}else return;const B=f.resumeTime;b||B>l?h=l:h=B}),h<l){var d;const f=h,g=u,p=l-h;u+=p;const b=o;o+=p,n.push({previousEvent:((d=n[n.length-1])==null?void 0:d.event)||null,nextEvent:null,start:h,end:f+p,playout:{start:b,end:o},integrated:{start:g,end:u}})}this.setDurations(l,o,u)}else n.push({previousEvent:null,nextEvent:null,start:0,end:l,playout:{start:0,end:l},integrated:{start:0,end:l}}),this.setDurations(l,l,l);return n}setDurations(e,s,n){this.durations={primary:e,playout:s,integrated:n}}resolveOffsets(e,s){const n=s.main.details,i=n.live?1/0:n.edge;let l=0,o=-1;e.forEach((d,h)=>{const u=d.cue.pre,f=d.cue.post,g=u?0:f?i:d.startTime;this.updateAssetDurations(d),o===g?d.cumulativeDuration=l:(l=0,o=g),!f&&d.snapOptions.in&&(d.resumeAnchor=vl(null,n.fragments,d.startOffset+d.resumptionOffset,0,0)||void 0),d.appendInPlace&&!d.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(d,s)||(d.appendInPlace=!1)),!d.appendInPlace&&h+1<e.length&&e[h+1].startTime-e[h].resumeTime<vN&&(e[h+1].appendInPlace=!1,e[h+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${d}`));const b=Ze(d.resumeOffset)?d.resumeOffset:d.duration;l+=b})}primaryCanResumeInPlaceAt(e,s){const n=e.resumeTime,i=e.startTime+e.resumptionOffset;return Math.abs(n-i)>yo?(this.log(`"${e.identifier}" resumption ${n} not aligned with estimated timeline end ${i}`),!1):!Object.keys(s).some(o=>{const d=s[o].details,h=d.edge;if(n>=h)return this.log(`"${e.identifier}" resumption ${n} past ${o} playlist end ${h}`),!1;const u=vl(null,d.fragments,n);if(!u)return this.log(`"${e.identifier}" resumption ${n} does not align with any fragments in ${o} playlist (${d.fragStart}-${d.fragmentEnd})`),!0;const f=o==="audio"?.175:0;return Math.abs(u.start-n)<yo+f||Math.abs(u.end-n)<yo+f?!1:(this.log(`"${e.identifier}" resumption ${n} not aligned with ${o} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const s=e.timelineStart;let n=0,i=!1,l=!1;for(let o=0;o<e.assetList.length;o++){const d=e.assetList[o],h=s+n;d.startOffset=n,d.timelineStart=h,i||(i=d.duration===null),l||(l=!!d.error);const u=d.error?0:d.duration||0;n+=u}i&&!l?e.duration=Math.max(n,e.duration):e.duration=n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Mn(a){return`[${a.event?'"'+a.event.identifier+'"':"primary"}: ${a.start.toFixed(2)}-${a.end.toFixed(2)}]`}class XP{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,s){const n=e.assetListUrl;let i;try{i=JS(n,this.hls.sessionId,e.baseUrl)}catch(p){const b=this.assignAssetListError(e,Ne.ASSET_LIST_LOAD_ERROR,p,n);this.hls.trigger($.ERROR,b);return}s&&i.protocol!=="data:"&&i.searchParams.set("_HLS_start_offset",""+s);const l=this.hls.config,o=l.loader,d=new o(l),h={responseType:"json",url:i.href},u=l.interstitialAssetListLoadPolicy.default,f={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(p,b,y,v)=>{const _=p.data,N=_?.ASSETS;if(!Array.isArray(N)){const C=this.assignAssetListError(e,Ne.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),y.url,b,v);this.hls.trigger($.ERROR,C);return}e.assetListResponse=_,this.hls.trigger($.ASSET_LIST_LOADED,{event:e,assetListResponse:_,networkDetails:v})},onError:(p,b,y,v)=>{const _=this.assignAssetListError(e,Ne.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${p.code} ${p.text} (${b.url})`),b.url,v,y);this.hls.trigger($.ERROR,_)},onTimeout:(p,b,y)=>{const v=this.assignAssetListError(e,Ne.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${b.url})`),b.url,p,y);this.hls.trigger($.ERROR,v)}};return d.load(h,f,g),this.hls.trigger($.ASSET_LIST_LOADING,{event:e}),d}assignAssetListError(e,s,n,i,l,o){return e.error=n,{type:rt.NETWORK_ERROR,details:s,fatal:!1,interstitial:e,url:i,error:n,networkDetails:o,stats:l}}}function _N(a){var e;a==null||(e=a.play())==null||e.catch(()=>{})}function Iu(a,e){return`[${a}] Advancing timeline position to ${e}`}class JP extends En{constructor(e,s){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled||!this.schedule)return;const i=n-this.timelinePos;if(Math.abs(i)<1/7056e5)return;const o=i<=-.01;this.timelinePos=n,this.bufferedPos=n;const d=this.playingItem;if(!d){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(n,n-i)&&this.updateSchedule(!0),this.checkBuffer(),o&&n<d.start||n>=d.end){var h;const b=this.findItemIndex(d);let y=this.schedule.findItemIndexAtTime(n);if(y===-1&&(y=b+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${n} (resolving from ${b} to ${y})`)),!this.isInterstitial(d)&&(h=this.media)!=null&&h.paused&&(this.shouldPlay=!1),!o&&y>b){const v=this.schedule.findJumpRestrictedIndex(b+1,y);if(v>b){this.setSchedulePosition(v);return}}this.setSchedulePosition(y);return}const u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(d)){const b=d.event.assetList[0];b&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(n,b))}return}const f=u.timelineStart,g=u.duration||0;if(o&&n<f||n>=f+g){var p;(p=d.event)!=null&&p.appendInPlace&&(this.clearAssetPlayers(d.event,d),this.flushFrontBuffer(n)),this.setScheduleToAssetAtTime(n,u)}},this.onTimeupdate=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;if(n>this.timelinePos)this.timelinePos=n,n>this.bufferedPos&&this.checkBuffer();else return;const i=this.playingItem;if(!i||this.playingLastItem)return;if(n>=i.end){this.timelinePos=i.end;const d=this.findItemIndex(i);this.setSchedulePosition(d+1)}const l=this.playingAsset;if(!l)return;const o=l.timelineStart+(l.duration||0);n>=o&&this.setScheduleToAssetAtTime(n,l)},this.onScheduleUpdate=(n,i)=>{const l=this.schedule;if(!l)return;const o=this.playingItem,d=l.events||[],h=l.items||[],u=l.durations,f=n.map(v=>v.identifier),g=!!(d.length||f.length);(g||i)&&this.log(`INTERSTITIALS_UPDATED (${d.length}): ${d}
Schedule: ${h.map(v=>Mn(v))} pos: ${this.timelinePos}`),f.length&&this.log(`Removed events ${f}`);let p=null,b=null;o&&(p=this.updateItem(o,this.timelinePos),this.itemsMatch(o,p)?this.playingItem=p:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const y=this.bufferingItem;if(y&&(b=this.updateItem(y,this.bufferedPos),this.itemsMatch(y,b)?this.bufferingItem=b:y.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(y.event,null))),n.forEach(v=>{v.assetList.forEach(_=>{this.clearAssetPlayer(_.identifier,null)})}),this.playerQueue.forEach(v=>{if(v.interstitial.appendInPlace){const _=v.assetItem.timelineStart,N=v.timelineOffset-_;if(N)try{v.timelineOffset=_}catch(C){Math.abs(N)>yo&&this.warn(`${C} ("${v.assetId}" ${v.timelineOffset}->${_})`)}}}),g||i){if(this.hls.trigger($.INTERSTITIALS_UPDATED,{events:d.slice(0),schedule:h.slice(0),durations:u,removedIds:f}),this.isInterstitial(o)&&f.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(p,o),y&&b!==p&&this.trimInPlace(b,y),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=s,this.assetListLoader=new XP(e),this.schedule=new QP(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on($.MEDIA_ATTACHED,this.onMediaAttached,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.LEVEL_UPDATED,this.onLevelUpdated,this),e.on($.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on($.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on($.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on($.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on($.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on($.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on($.BUFFER_APPENDED,this.onBufferAppended,this),e.on($.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on($.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on($.MEDIA_ENDED,this.onMediaEnded,this),e.on($.ERROR,this.onError,this),e.on($.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off($.MEDIA_ATTACHED,this.onMediaAttached,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.LEVEL_UPDATED,this.onLevelUpdated,this),e.off($.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off($.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off($.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off($.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off($.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off($.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off($.BUFFER_CODECS,this.onBufferCodecs,this),e.off($.BUFFER_APPENDED,this.onBufferAppended,this),e.off($.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off($.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off($.MEDIA_ENDED,this.onMediaEnded,this),e.off($.ERROR,this.onError,this),e.off($.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Pa(e,"play",this.onPlay),Pa(e,"pause",this.onPause),Pa(e,"seeking",this.onSeeking),Pa(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,s){const n=this.media=s.media;Na(n,"seeking",this.onSeeking),Na(n,"timeupdate",this.onTimeupdate),Na(n,"play",this.onPlay),Na(n,"pause",this.onPause)}onMediaAttached(e,s){const n=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,n===null)this.checkStart();else if(!i){this.clearScheduleState();const l=this.findItemIndex(n);this.setSchedulePosition(l)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,s){const n=!!s.transferMedia,i=this.media;if(this.media=null,!n&&(i&&this.removeMediaListeners(i),this.detachedData)){const l=this.getBufferingPlayer();l&&(this.log(`Removing schedule state for detachedData and ${l}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,l.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,s=()=>e.bufferingItem||e.waitingItem,n=g=>g&&e.getAssetPlayer(g.identifier),i=(g,p,b,y,v)=>{if(g){let _=g[p].start;const N=g.event;if(N){if(p==="playout"||N.timelineOccupancy!==Lh.Point){const C=n(b);C?.interstitial===N&&(_+=C.assetItem.startOffset+C[v])}}else{const C=y==="bufferedPos"?o():e[y];_+=C-g.start}return _}return 0},l=(g,p)=>{var b;if(g!==0&&p!=="primary"&&(b=e.schedule)!=null&&b.length){var y;const v=e.schedule.findItemIndexAtTime(g),_=(y=e.schedule.items)==null?void 0:y[v];if(_){const N=_[p].start-_.start;return g+N}}return g},o=()=>{const g=e.bufferedPos;return g===Number.MAX_VALUE?d("primary"):Math.max(g,0)},d=g=>{var p,b;return(p=e.primaryDetails)!=null&&p.live?e.primaryDetails.edge:((b=e.schedule)==null?void 0:b.durations[g])||0},h=(g,p)=>{var b,y;const v=e.effectivePlayingItem;if(v!=null&&(b=v.event)!=null&&b.restrictions.skip||!e.schedule)return;e.log(`seek to ${g} "${p}"`);const _=e.effectivePlayingItem,N=e.schedule.findItemIndexAtTime(g,p),C=(y=e.schedule.items)==null?void 0:y[N],T=e.getBufferingPlayer(),L=T?.interstitial,F=L?.appendInPlace,H=_&&e.itemsMatch(_,C);if(_&&(F||H)){const B=n(e.playingAsset),P=B?.media||e.primaryMedia;if(P){const I=p==="primary"?P.currentTime:i(_,p,e.playingAsset,"timelinePos","currentTime"),D=g-I,O=(F?I:P.currentTime)+D;if(O>=0&&(!B||F||O<=B.duration)){P.currentTime=O;return}}}if(C){let B=g;if(p!=="primary"){const I=C[p].start,D=g-I;B=C.start+D}const P=!e.isInterstitial(C);if((!e.isInterstitial(_)||_.event.appendInPlace)&&(P||C.event.appendInPlace)){const I=e.media||(F?T?.media:null);I&&(I.currentTime=B)}else if(_){const I=e.findItemIndex(_);if(N>I){const O=e.schedule.findJumpRestrictedIndex(I+1,N);if(O>I){e.setSchedulePosition(O);return}}let D=0;if(P)e.timelinePos=B,e.checkBuffer();else{const O=C.event.assetList,ee=g-(C[p]||C).start;for(let ie=O.length;ie--;){const Z=O[ie];if(Z.duration&&ee>=Z.startOffset&&ee<Z.startOffset+Z.duration){D=ie;break}}}e.setSchedulePosition(N,D)}}},u=()=>{const g=e.effectivePlayingItem;if(e.isInterstitial(g))return g;const p=s();return e.isInterstitial(p)?p:null},f={get bufferedEnd(){const g=s(),p=e.bufferingItem;if(p&&p===g){var b;return i(p,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-p.playout.start||((b=e.bufferingAsset)==null?void 0:b.startOffset)||0}return 0},get currentTime(){const g=u(),p=e.effectivePlayingItem;return p&&p===g?i(p,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-p.playout.start:0},set currentTime(g){const p=u(),b=e.effectivePlayingItem;b&&b===p&&h(g+b.playout.start,"playout")},get duration(){const g=u();return g?g.playout.end-g.playout.start:0},get assetPlayers(){var g;const p=(g=u())==null?void 0:g.event.assetList;return p?p.map(b=>e.getAssetPlayer(b.identifier)):[]},get playingIndex(){var g;const p=(g=u())==null?void 0:g.event;return p&&e.effectivePlayingAsset?p.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};return this.manager={get events(){var g;return((g=e.schedule)==null||(g=g.events)==null?void 0:g.slice(0))||[]},get schedule(){var g;return((g=e.schedule)==null||(g=g.items)==null?void 0:g.slice(0))||[]},get interstitialPlayer(){return u()?f:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return s()},get bufferingIndex(){const g=s();return e.findItemIndex(g)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const g=e.effectivePlayingItem;return e.findItemIndex(g)},primary:{get bufferedEnd(){return o()},get currentTime(){const g=e.timelinePos;return g>0?g:0},set currentTime(g){h(g,"primary")},get duration(){return d("primary")},get seekableStart(){var g;return((g=e.primaryDetails)==null?void 0:g.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(s(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(g){h(g,"integrated")},get duration(){return d("integrated")},get seekableStart(){var g;return l(((g=e.primaryDetails)==null?void 0:g.fragmentStart)||0,"integrated")}},skip:()=>{const g=e.effectivePlayingItem,p=g?.event;if(p&&!p.restrictions.skip){const b=e.findItemIndex(g);if(p.appendInPlace){const y=g.playout.start+g.event.duration;h(y+.001,"playout")}else e.advanceAfterAssetEnded(p,b,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const s=this.playingItem,n=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!s||!n?!1:this.findItemIndex(s)===n.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,s;if(this.mediaSelection===null)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let i=this.media;!i&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(i=this.primaryMedia);const l=(s=i)==null?void 0:s.currentTime;if(!(l===void 0||!Ze(l)))return l}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,s){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,s)}transferMediaFromPlayer(e,s){const n=e.interstitial.appendInPlace,i=e.media;if(n&&i===this.primaryMedia){if(this.bufferingAsset=null,(!s||this.isInterstitial(s)&&!s.event.appendInPlace)&&s&&i){this.detachedData={media:i};return}const l=e.transferMedia();this.log(`transfer MediaSource from ${e} ${ms(l)}`),this.detachedData=l}else s&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,s){var n,i;if(e.media===s)return;let l=null;const o=this.hls,d=e!==o,h=d&&e.interstitial.appendInPlace,u=(n=this.detachedData)==null?void 0:n.mediaSource;let f;if(o.media)h&&(l=o.transferMedia(),this.detachedData=l),f="Primary";else if(u){const y=this.getBufferingPlayer();y?(l=y.transferMedia(),f=`${y}`):f="detached MediaSource"}else f="detached media";if(!l){if(u)l=this.detachedData,this.log(`using detachedData: MediaSource ${ms(l)}`);else if(!this.detachedData||o.media===s){const y=this.playerQueue;y.length>1&&y.forEach(v=>{if(d&&v.interstitial.appendInPlace!==h){const _=v.interstitial;this.clearInterstitial(v.interstitial,null),_.appendInPlace=!1,_.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${_}`)}}),this.hls.detachMedia(),this.detachedData={media:s}}}const g=l&&"mediaSource"in l&&((i=l.mediaSource)==null?void 0:i.readyState)!=="closed",p=g&&l?l:s;this.log(`${g?"transfering MediaSource":"attaching media"} to ${d?e:"Primary"} from ${f} (media.currentTime: ${s.currentTime})`);const b=this.schedule;if(p===l&&b){const y=d&&e.assetId===b.assetIdAtEnd;p.overrides={duration:b.duration,endOfStream:!d||y,cueRemoval:!d}}e.attachMedia(p)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,s=e?.events;if(!s||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const n=this.timelinePos,i=this.effectivePlayingItem;if(n===-1){const l=this.hls.startPosition;if(this.log(Iu("checkStart",l)),this.timelinePos=l,s.length&&s[0].cue.pre){const o=e.findEventIndex(s[0].identifier);this.setSchedulePosition(o)}else if(l>=0||!this.primaryLive){const o=this.timelinePos=l>0?l:0,d=e.findItemIndexAtTime(o);this.setSchedulePosition(d)}}else if(i&&!this.playingItem){const l=e.findItemIndex(i);this.setSchedulePosition(l)}}advanceAssetBuffering(e,s){const n=e.event,i=n.findAssetIndex(s),l=kg(n,i);if(!n.isAssetPastPlayoutLimit(l))this.bufferedToEvent(e,l);else if(this.schedule){var o;const d=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];d&&this.bufferedToItem(d)}}advanceAfterAssetEnded(e,s,n){const i=kg(e,n);if(e.isAssetPastPlayoutLimit(i)){if(this.schedule){const l=this.schedule.items;if(l){const o=s+1,d=l.length;if(o>=d){this.setSchedulePosition(-1);return}const h=e.resumeTime;this.timelinePos<h&&(this.log(Iu("advanceAfterAssetEnded",h)),this.timelinePos=h,e.appendInPlace&&this.advanceInPlace(h),this.checkBuffer(this.bufferedPos<h)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){const l=e.assetList[i];l&&this.advanceInPlace(l.timelineStart)}this.setSchedulePosition(s,i)}}setScheduleToAssetAtTime(e,s){const n=this.schedule;if(!n)return;const i=s.parentIdentifier,l=n.getEvent(i);if(l){const o=n.findEventIndex(i),d=n.findAssetIndex(l,e);this.advanceAfterAssetEnded(l,o,d-1)}}setSchedulePosition(e,s){var n;const i=(n=this.schedule)==null?void 0:n.items;if(!i||this.playbackDisabled)return;const l=e>=0?i[e]:null;this.log(`setSchedulePosition ${e}, ${s} (${l&&Mn(l)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,d=this.playingLastItem;if(this.isInterstitial(o)){const f=o.event,g=this.playingAsset,p=g?.identifier,b=p?this.getAssetPlayer(p):null;if(b&&p&&(!this.eventItemsMatch(o,l)||s!==void 0&&p!==f.assetList[s].identifier)){var h;const y=f.findAssetIndex(g);if(this.log(`INTERSTITIAL_ASSET_ENDED ${y+1}/${f.assetList.length} ${oo(g)}`),this.endedAsset=g,this.playingAsset=null,this.hls.trigger($.INTERSTITIAL_ASSET_ENDED,{asset:g,assetListIndex:y,event:f,schedule:i.slice(0),scheduleIndex:e,player:b}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(f,this.findItemIndex(this.playingItem),y);return}this.retreiveMediaSource(p,l),b.media&&!((h=this.detachedData)!=null&&h.mediaSource)&&b.detachMedia()}if(!this.eventItemsMatch(o,l)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${f} ${Mn(o)}`),f.hasPlayed=!0,this.hls.trigger($.INTERSTITIAL_ENDED,{event:f,schedule:i.slice(0),scheduleIndex:e}),f.cue.once)){var u;this.updateSchedule();const y=(u=this.schedule)==null?void 0:u.items;if(l&&y){const v=this.findItemIndex(l);this.advanceSchedule(v,y,s,o,d)}return}}this.advanceSchedule(e,i,s,o,d)}advanceSchedule(e,s,n,i,l){const o=this.schedule;if(!o)return;const d=s[e]||null,h=this.primaryMedia,u=this.playerQueue;if(u.length&&u.forEach(f=>{const g=f.interstitial,p=o.findEventIndex(g.identifier);(p<e||p>e+1)&&this.clearInterstitial(g,d)}),this.isInterstitial(d)){this.timelinePos=Math.min(Math.max(this.timelinePos,d.start),d.end);const f=d.event;if(n===void 0){n=o.findAssetIndex(f,this.timelinePos);const y=kg(f,n-1);if(f.isAssetPastPlayoutLimit(y)||f.appendInPlace&&this.timelinePos===d.end){this.advanceAfterAssetEnded(f,e,n);return}n=y}const g=this.waitingItem;this.assetsBuffered(d,h)||this.setBufferingItem(d);let p=this.preloadAssets(f,n);if(this.eventItemsMatch(d,g||i)||(this.waitingItem=d,this.log(`INTERSTITIAL_STARTED ${Mn(d)} ${f.appendInPlace?"append in place":""}`),this.hls.trigger($.INTERSTITIAL_STARTED,{event:f,schedule:s.slice(0),scheduleIndex:e})),!f.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${f}`);return}if(f.assetListLoader&&(f.assetListLoader.destroy(),f.assetListLoader=void 0),!h){this.log(`Waiting for attachMedia to start Interstitial ${f}`);return}this.waitingItem=this.endedItem=null,this.playingItem=d;const b=f.assetList[n];if(!b){this.advanceAfterAssetEnded(f,e,n||0);return}if(p||(p=this.getAssetPlayer(b.identifier)),p===null||p.destroyed){const y=f.assetList.length;this.warn(`asset ${n+1}/${y} player destroyed ${f}`),p=this.createAssetPlayer(f,b,n),p.loadSource()}if(!this.eventItemsMatch(d,this.bufferingItem)&&f.appendInPlace&&this.isAssetBuffered(b))return;this.startAssetPlayer(p,n,s,e,h),this.shouldPlay&&_N(p.media)}else d?(this.resumePrimary(d,e,i),this.shouldPlay&&_N(this.hls.media)):l&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,s,n){var i,l;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Mn(e)}`),!((i=this.detachedData)!=null&&i.mediaSource)){let d=this.timelinePos;(d<e.start||d>=e.end)&&(d=this.getPrimaryResumption(e,s),this.log(Iu("resumePrimary",d)),this.timelinePos=d),this.attachPrimary(d,e)}if(!n)return;const o=(l=this.schedule)==null?void 0:l.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Mn(e)}`),this.hls.trigger($.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:s}),this.checkBuffer())}getPrimaryResumption(e,s){const n=e.start;if(this.primaryLive){const i=this.primaryDetails;if(s===0)return this.hls.startPosition;if(i&&(n<i.fragmentStart||n>i.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const s=this.getAssetPlayer(e.identifier);return s!=null&&s.hls?s.hls.bufferedToEnd:St.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,s,n){s?this.setBufferingItem(s):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const l=this.hls;l.media?this.checkBuffer():(this.transferMediaTo(l,i),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(Iu("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,s){var n;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs((((n=i.mainForwardBufferInfo)==null?void 0:n.start)||i.media.currentTime)-e)>.5?i.startLoad(e,s):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off($.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on($.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,s){if(s.level===-1||!this.schedule)return;const n=this.hls.levels[s.level];if(!n.details)return;const i=is(is({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,s){const n=this.hls.audioTracks[s.id],i=this.mediaSelection;if(!i){this.altSelection=is(is({},this.altSelection),{},{audio:n});return}const l=is(is({},i),{},{audio:n});this.mediaSelection=l}onSubtitleTrackUpdated(e,s){const n=this.hls.subtitleTracks[s.id],i=this.mediaSelection;if(!i){this.altSelection=is(is({},this.altSelection),{},{subtitles:n});return}const l=is(is({},i),{},{subtitles:n});this.mediaSelection=l}onAudioTrackSwitching(e,s){const n=k_(s);this.playerQueue.forEach(({hls:i})=>i&&(i.setAudioOption(s)||i.setAudioOption(n)))}onSubtitleTrackSwitch(e,s){const n=k_(s);this.playerQueue.forEach(({hls:i})=>i&&(i.setSubtitleOption(s)||s.id!==-1&&i.setSubtitleOption(n)))}onBufferCodecs(e,s){const n=s.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,s){this.checkBuffer()}onBufferFlushed(e,s){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const i=this.timelinePos;this.bufferedPos=i,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const s=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&s){for(let i=0;i<s.length;i++){const l=s[i];if(l.cue.post){var n;const o=this.schedule.findEventIndex(l.identifier),d=(n=this.schedule.items)==null?void 0:n[o];this.isInterstitial(d)&&this.eventItemsMatch(d,this.bufferingItem)&&this.bufferedToItem(d,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const s=this.playingItem;if(!this.playingLastItem&&s){const n=this.findItemIndex(s);this.setSchedulePosition(n+1)}else this.shouldPlay=!1}updateItem(e,s){var n;const i=(n=this.schedule)==null?void 0:n.items;if(e&&i){const l=this.findItemIndex(e,s);return i[l]||null}return null}trimInPlace(e,s){if(this.isInterstitial(e)&&e.event.appendInPlace&&s.end-e.end>.25){e.event.assetList.forEach((l,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(l.identifier,null)});const n=e.end+.25,i=St.bufferInfo(this.primaryMedia,n,0);(i.end>n||(i.nextStart||0)>n)&&(this.log(`trim buffered interstitial ${Mn(e)} (was ${Mn(s)})`),this.attachPrimary(n,null,!0),this.flushFrontBuffer(n))}}itemsMatch(e,s){return!!s&&(e===s||e.event&&s.event&&this.eventItemsMatch(e,s)||!e.event&&!s.event&&this.findItemIndex(e)===this.findItemIndex(s))}eventItemsMatch(e,s){var n;return!!s&&(e===s||e.event.identifier===((n=s.event)==null?void 0:n.identifier))}findItemIndex(e,s){return e&&this.schedule?this.schedule.findItemIndex(e,s):-1}updateSchedule(e=!1){var s;const n=this.mediaSelection;n&&((s=this.schedule)==null||s.updateSchedule(n,[],e))}checkBuffer(e){var s;const n=(s=this.schedule)==null?void 0:s.items;if(!n)return;const i=St.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,n,e)}updateBufferedPos(e,s,n){const i=this.schedule,l=this.bufferingItem;if(this.bufferedPos>e||!i)return;if(s.length===1&&this.itemsMatch(s[0],l)){this.bufferedPos=e;return}const o=this.playingItem,d=this.findItemIndex(o);let h=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var u;const f=this.findItemIndex(l),g=Math.min(f+1,s.length-1),p=s[g];if((h===-1&&l&&e>=l.end||(u=p.event)!=null&&u.appendInPlace&&e+.01>=p.start)&&(h=g),this.isInterstitial(l)){const b=l.event;if(g-d>1&&b.appendInPlace===!1||b.assetList.length===0&&b.assetListLoader)return}if(this.bufferedPos=e,h>f&&h>d)this.bufferedToItem(p);else{const b=this.primaryDetails;this.primaryLive&&b&&e>b.edge-b.targetduration&&p.start<b.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(p)&&this.preloadAssets(p.event,0)}}else n&&o&&!this.itemsMatch(o,l)&&(h===d?this.bufferedToItem(o):h===d+1&&this.bufferedToItem(s[h]))}assetsBuffered(e,s){return e.event.assetList.length===0?!1:!e.event.assetList.some(i=>{const l=this.getAssetPlayer(i.identifier);return!(l!=null&&l.bufferedInPlaceToEnd(s))})}setBufferingItem(e){const s=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,s)&&n){const{items:i,events:l}=n;if(!i||!l)return s;const o=this.isInterstitial(e),d=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const h=d?d.remaining:s?s.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Mn(e)}`+(s?` (${h.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const u=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((f,g)=>{const p=this.getAssetPlayer(f.identifier);p&&(g===u&&p.loadSource(),p.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering());this.hls.trigger($.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:l.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return s}bufferedToItem(e,s=0){const n=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,s);else if(n!==null){this.bufferingAsset=null;const i=this.detachedData;i?i.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const s=this.findItemIndex(e),n=this.getPrimaryResumption(e,s);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,s){const n=e.event,i=n.assetList.length===0&&!n.assetListLoader,l=n.cue.once;if(i||!l){const o=this.preloadAssets(n,s);if(o!=null&&o.interstitial.appendInPlace){const d=this.primaryMedia;d&&this.bufferAssetPlayer(o,d)}}}preloadAssets(e,s){const n=e.assetUrl,i=e.assetList.length,l=i===0&&!e.assetListLoader,o=e.cue.once;if(l){const h=e.timelineStart;if(e.appendInPlace){var d;const p=this.playingItem;!this.isInterstitial(p)&&(p==null||(d=p.nextEvent)==null?void 0:d.identifier)===e.identifier&&this.flushFrontBuffer(h+.25)}let u,f=0;if(!this.playingItem&&this.primaryLive&&(f=this.hls.startPosition,f===-1&&(f=this.hls.liveSyncPosition||0)),f&&!(e.cue.pre||e.cue.post)){const p=f-h;p>0&&(u=Math.round(p*1e3)/1e3)}if(this.log(`Load interstitial asset ${s+1}/${n?1:i} ${e}${u?` live-start: ${f} start-offset: ${u}`:""}`),n)return this.createAsset(e,0,0,h,e.duration,n);const g=this.assetListLoader.loadAssetList(e,u);g&&(e.assetListLoader=g)}else if(!o&&i){for(let u=s;u<i;u++){const f=e.assetList[u],g=this.getAssetPlayerQueueIndex(f.identifier);(g===-1||this.playerQueue[g].destroyed)&&!f.error&&this.createAssetPlayer(e,f,u)}const h=e.assetList[s];if(h){const u=this.getAssetPlayer(h.identifier);return u&&u.loadSource(),u}}return null}flushFrontBuffer(e){const s=this.requiredTracks;if(!s)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(s).forEach(i=>{this.hls.trigger($.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:i})})}getAssetPlayerQueueIndex(e){const s=this.playerQueue;for(let n=0;n<s.length;n++)if(e===s[n].assetId)return n;return-1}getAssetPlayer(e){const s=this.getAssetPlayerQueueIndex(e);return this.playerQueue[s]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:s}=this;if(s){for(let n=0;n<e.length;n++)if(e[n].media===s)return e[n]}return null}createAsset(e,s,n,i,l,o){const d={parentIdentifier:e.identifier,identifier:HP(e,o,s),duration:l,startOffset:n,timelineStart:i,uri:o};return this.createAssetPlayer(e,d,s)}createAssetPlayer(e,s,n){const i=this.hls,l=i.userConfig;let o=l.videoPreference;const d=i.loadLevelObj||i.levels[i.currentLevel];(o||d)&&(o=ds({},o),d.videoCodec&&(o.videoCodec=d.videoCodec),d.videoRange&&(o.allowedVideoRanges=[d.videoRange]));const h=i.audioTracks[i.audioTrack],u=i.subtitleTracks[i.subtitleTrack];let f=0;if(this.primaryLive||e.appendInPlace){const L=this.timelinePos-s.timelineStart;if(L>1){const F=s.duration;F&&L<F&&(f=L)}}const g=s.identifier,p=is(is({},l),{},{maxMaxBufferLength:Math.min(180,i.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:g,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:f,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:h||l.audioPreference,subtitlePreference:u||l.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,s.timelineStart&&(p.timelineOffset=s.timelineStart));const b=p.cmcd;b!=null&&b.sessionId&&b.contentId&&(p.cmcd=ds({},b,{contentId:Bc(s.uri)})),this.getAssetPlayer(g)&&this.warn(`Duplicate date range identifier ${e} and asset ${g}`);const y=new WP(this.HlsPlayerClass,p,e,s);this.playerQueue.push(y),e.assetList[n]=s;let v=!0;const _=L=>{if(L.live){var F;const P=new Error(`Interstitials MUST be VOD assets ${e}`),I={fatal:!0,type:rt.OTHER_ERROR,details:Ne.INTERSTITIAL_ASSET_ITEM_ERROR,error:P},D=((F=this.schedule)==null?void 0:F.findEventIndex(e.identifier))||-1;this.handleAssetItemError(I,e,D,n,P.message);return}const H=L.edge-L.fragmentStart,B=s.duration;(v||B===null||H>B)&&(v=!1,this.log(`Interstitial asset "${g}" duration change ${B} > ${H}`),s.duration=H,this.updateSchedule())};y.on($.LEVEL_UPDATED,(L,{details:F})=>_(F)),y.on($.LEVEL_PTS_UPDATED,(L,{details:F})=>_(F)),y.on($.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const N=(L,F)=>{const H=this.getAssetPlayer(g);if(H&&F.tracks){H.off($.BUFFER_CODECS,N),H.tracks=F.tracks;const B=this.primaryMedia;this.bufferingAsset===H.assetItem&&B&&!H.media&&this.bufferAssetPlayer(H,B)}};y.on($.BUFFER_CODECS,N);const C=()=>{var L;const F=this.getAssetPlayer(g);if(this.log(`buffered to end of asset ${F}`),!F||!this.schedule)return;const H=this.schedule.findEventIndex(e.identifier),B=(L=this.schedule.items)==null?void 0:L[H];this.isInterstitial(B)&&this.advanceAssetBuffering(B,s)};y.on($.BUFFERED_TO_END,C);const T=L=>()=>{if(!this.getAssetPlayer(g)||!this.schedule)return;this.shouldPlay=!0;const H=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,H,L)};return y.once($.MEDIA_ENDED,T(n)),y.once($.PLAYOUT_LIMIT_REACHED,T(1/0)),y.on($.ERROR,(L,F)=>{if(!this.schedule)return;const H=this.getAssetPlayer(g);if(F.details===Ne.BUFFER_STALLED_ERROR){if(H!=null&&H.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(F,e,this.schedule.findEventIndex(e.identifier),n,`Asset player error ${F.error} ${e}`)}),y.on($.DESTROYING,()=>{if(!this.getAssetPlayer(g)||!this.schedule)return;const F=new Error(`Asset player destroyed unexpectedly ${g}`),H={fatal:!0,type:rt.OTHER_ERROR,details:Ne.INTERSTITIAL_ASSET_ITEM_ERROR,error:F};this.handleAssetItemError(H,e,this.schedule.findEventIndex(e.identifier),n,F.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${oo(s)}`),this.hls.trigger($.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:s,assetListIndex:n,event:e,player:y}),y}clearInterstitial(e,s){this.clearAssetPlayers(e,s),e.reset()}clearAssetPlayers(e,s){e.assetList.forEach(n=>{this.clearAssetPlayer(n.identifier,s)})}resetAssetPlayer(e){const s=this.getAssetPlayerQueueIndex(e);if(s!==-1){this.log(`reset asset player "${e}" after error`);const n=this.playerQueue[s];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,s){const n=this.getAssetPlayerQueueIndex(e);if(n!==-1){const i=this.playerQueue[n];this.log(`clear ${i} toSegment: ${s&&Mn(s)}`),this.transferMediaFromPlayer(i,s),this.playerQueue.splice(n,1),i.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,s,n,i,l){const{interstitial:o,assetItem:d,assetId:h}=e,u=o.assetList.length,f=this.playingAsset;this.endedAsset=null,this.playingAsset=d,(!f||f.identifier!==h)&&(f&&(this.clearAssetPlayer(f.identifier,n[i]),delete f.error),this.log(`INTERSTITIAL_ASSET_STARTED ${s+1}/${u} ${oo(d)}`),this.hls.trigger($.INTERSTITIAL_ASSET_STARTED,{asset:d,assetListIndex:s,event:o,schedule:n.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,l)}bufferAssetPlayer(e,s){var n,i;if(!this.schedule)return;const{interstitial:l,assetItem:o}=e,d=this.schedule.findEventIndex(l.identifier),h=(n=this.schedule.items)==null?void 0:n[d];if(!h)return;e.loadSource(),this.setBufferingItem(h),this.bufferingAsset=o;const u=this.getBufferingPlayer();if(u===e)return;const f=l.appendInPlace;if(f&&u?.interstitial.appendInPlace===!1)return;const g=u?.tracks||((i=this.detachedData)==null?void 0:i.tracks)||this.requiredTracks;if(f&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(g&&!Mw(g,e.tracks)){const p=new Error(`Asset ${oo(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(g)}')`),b={fatal:!0,type:rt.OTHER_ERROR,details:Ne.INTERSTITIAL_ASSET_ITEM_ERROR,error:p},y=l.findAssetIndex(o);this.handleAssetItemError(b,l,d,y,p.message);return}}this.transferMediaTo(e,s)}handleInPlaceStall(e){const s=this.schedule,n=this.primaryMedia;if(!s||!n)return;const i=n.currentTime,l=s.findAssetIndex(e,i),o=e.assetList[l];if(o){const d=this.getAssetPlayer(o.identifier);if(d){const h=d.currentTime||i-o.timelineStart,u=d.duration-h;if(this.warn(`Stalled at ${h} of ${h+u} in ${d} ${e} (media.currentTime: ${i})`),h&&(u/n.playbackRate<.5||d.bufferedInPlaceToEnd(n))&&d.hls){const f=s.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,f,l)}}}}advanceInPlace(e){const s=this.primaryMedia;s&&s.currentTime<e&&(s.currentTime=e)}handleAssetItemError(e,s,n,i,l){if(e.details===Ne.BUFFER_STALLED_ERROR)return;const o=s.assetList[i]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&oo(o)} ${e.error}`),!this.schedule)return;const d=o?.identifier||"",h=this.getAssetPlayerQueueIndex(d),u=this.playerQueue[h]||null,f=this.schedule.items,g=ds({},e,{fatal:!1,errorAction:go(!0),asset:o,assetListIndex:i,event:s,schedule:f,scheduleIndex:n,player:u});if(this.hls.trigger($.INTERSTITIAL_ASSET_ERROR,g),!e.fatal)return;const p=this.playingAsset,b=this.bufferingAsset,y=new Error(l);if(o&&(this.clearAssetPlayer(d,null),o.error=y),!s.assetList.some(v=>!v.error))s.error=y;else for(let v=i;v<s.assetList.length;v++)this.resetAssetPlayer(s.assetList[v].identifier);this.updateSchedule(!0),s.error?this.primaryFallback(s):p&&p.identifier===d?this.advanceAfterAssetEnded(s,n,i):b&&b.identifier===d&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,b)}primaryFallback(e){const s=e.timelineStart,n=this.effectivePlayingItem;let i=this.timelinePos;if(n){this.log(`Fallback to primary from event "${e.identifier}" start: ${s} pos: ${i} playing: ${Mn(n)} error: ${e.error}`),i===-1&&(i=this.hls.startPosition);const o=this.updateItem(n,i);this.itemsMatch(n,o)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(s,null),this.flushFrontBuffer(s))}else if(i===-1){this.checkStart();return}if(!this.schedule)return;const l=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(l)}onAssetListLoaded(e,s){var n,i;const l=s.event,o=l.identifier,d=s.assetListResponse.ASSETS;if(!((n=this.schedule)!=null&&n.hasEvent(o)))return;const h=l.timelineStart,u=l.duration;let f=0;d.forEach((v,_)=>{const N=parseFloat(v.DURATION);this.createAsset(l,_,f,h+f,N,v.URI),f+=N}),l.duration=f,this.log(`Loaded asset-list with duration: ${f} (was: ${u}) ${l}`);const g=this.waitingItem,p=g?.event.identifier===o;this.updateSchedule();const b=(i=this.bufferingItem)==null?void 0:i.event;if(p){var y;const v=this.schedule.findEventIndex(o),_=(y=this.schedule.items)==null?void 0:y[v];if(_){if(!this.playingItem&&this.timelinePos>_.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==v){l.error=new Error(`Interstitial ${d.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${l}`),this.log(l.error.message),this.updateSchedule(!0),this.primaryFallback(l);return}this.setBufferingItem(_)}this.setSchedulePosition(v)}else if(b?.identifier===o){const v=l.assetList[0];if(v){const _=this.getAssetPlayer(v.identifier);if(b.appendInPlace){const N=this.primaryMedia;_&&N&&this.bufferAssetPlayer(_,N)}else _&&_.loadSource()}}}onError(e,s){if(this.schedule)switch(s.details){case Ne.ASSET_LIST_PARSING_ERROR:case Ne.ASSET_LIST_LOAD_ERROR:case Ne.ASSET_LIST_LOAD_TIMEOUT:{const n=s.interstitial;n&&(this.updateSchedule(!0),this.primaryFallback(n));break}case Ne.BUFFER_STALLED_ERROR:{const n=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&n.event.appendInPlace){this.handleInPlaceStall(n.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const NN=500;class ZP extends Rp{constructor(e,s,n){super(e,s,n,"subtitle-stream-controller",et.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on($.LEVEL_LOADED,this.onLevelLoaded,this),e.on($.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on($.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on($.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on($.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on($.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off($.LEVEL_LOADED,this.onLevelLoaded,this),e.off($.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off($.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off($.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off($.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off($.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,s){this.stopLoad(),this.state=Be.IDLE,this.setInterval(NN),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=s?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,s){this.tracksBuffered=[],super.onMediaDetaching(e,s)}onLevelLoaded(e,s){this.mainDetails=s.details}onSubtitleFragProcessed(e,s){const{frag:n,success:i}=s;if(this.fragContextChanged(n)||(Us(n)&&(this.fragPrevious=n),this.state=Be.IDLE),!i)return;const l=this.tracksBuffered[this.currentTrackId];if(!l)return;let o;const d=n.start;for(let u=0;u<l.length;u++)if(d>=l[u].start&&d<=l[u].end){o=l[u];break}const h=n.start+n.duration;o?o.end=h:(o={start:d,end:h},l.push(o)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,s){const{startOffset:n,endOffset:i}=s;if(n===0&&i!==Number.POSITIVE_INFINITY){const l=i-1;if(l<=0)return;s.endOffsetSubtitles=Math.max(0,l),this.tracksBuffered.forEach(o=>{for(let d=0;d<o.length;){if(o[d].end<=l){o.shift();continue}else if(o[d].start<l)o[d].start=l;else break;d++}}),this.fragmentTracker.removeFragmentsInRange(n,l,et.SUBTITLE)}}onError(e,s){const n=s.frag;n?.type===et.SUBTITLE&&(s.details===Ne.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Be.STOPPED&&(this.state=Be.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:s}){if(this.levels&&OS(this.levels,s)){this.levels=s.map(n=>new Hc(n));return}this.tracksBuffered=[],this.levels=s.map(n=>{const i=new Hc(n);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,et.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,s){var n;if(this.currentTrackId=s.id,!((n=this.levels)!=null&&n.length)||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==Be.STOPPED&&this.setInterval(NN)}onSubtitleTrackLoaded(e,s){var n;const{currentTrackId:i,levels:l}=this,{details:o,id:d}=s;if(!l){this.warn(`Subtitle tracks were reset while loading level ${d}`);return}const h=l[d];if(d>=l.length||!h)return;this.log(`Subtitle track ${d} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(o.live||(n=h.details)!=null&&n.live){if(o.deltaUpdateFailed)return;const g=this.mainDetails;if(!g){this.startFragRequested=!1;return}const p=g.fragments[0];if(!h.details)o.hasProgramDateTime&&g.hasProgramDateTime?(kh(o,g),u=o.fragmentStart):p&&(u=p.start,C0(o,u));else{var f;u=this.alignPlaylists(o,h.details,(f=this.levelLastLoaded)==null?void 0:f.details),u===0&&p&&(u=p.start,C0(o,u))}g&&!this.startFragRequested&&this.setStartPosition(g,u)}h.details=o,this.levelLastLoaded=h,d===i&&(this.hls.trigger($.SUBTITLE_TRACK_UPDATED,{details:o,id:d,groupId:s.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===Be.IDLE&&(vl(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),h.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:s,payload:n}=e,i=s.decryptdata,l=this.hls;if(!this.fragContextChanged(s)&&n&&n.byteLength>0&&i!=null&&i.key&&i.iv&&po(i.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer,Cp(i.method)).catch(d=>{throw l.trigger($.ERROR,{type:rt.MEDIA_ERROR,details:Ne.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:s}),d}).then(d=>{const h=performance.now();l.trigger($.FRAG_DECRYPTED,{frag:s,payload:d,stats:{tstart:o,tdecrypt:h}})}).catch(d=>{this.warn(`${d.name}: ${d.message}`),this.state=Be.IDLE})}}doTick(){if(!this.media){this.state=Be.IDLE;return}if(this.state===Be.IDLE){const{currentTrackId:e,levels:s}=this,n=s?.[e];if(!n||!s.length||!n.details||this.waitForLive(n))return;const{config:i}=this,l=this.getLoadPosition(),o=St.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],l,i.maxBufferHole),{end:d,len:h}=o,u=n.details,f=this.hls.maxBufferLength+u.levelTargetDuration;if(h>f)return;const g=u.fragments,p=g.length,b=u.edge;let y=null;const v=this.fragPrevious;if(d<b){const C=i.maxFragLookUpTolerance,T=d>b-C?0:C;y=vl(v,g,Math.max(g[0].start,d),T),!y&&v&&v.start<g[0].start&&(y=g[0])}else y=g[p-1];if(y=this.filterReplacedPrimary(y,n.details),!y)return;const _=y.sn-u.startSN,N=g[_-1];if(N&&N.cc===y.cc&&this.fragmentTracker.getState(N)===Xs.NOT_LOADED&&(y=N),this.fragmentTracker.getState(y)===Xs.NOT_LOADED){const C=this.mapToInitFragWhenRequired(y);C&&this.loadFragment(C,n,d)}}}loadFragment(e,s,n){Us(e)?super.loadFragment(e,s,n):this._loadInitSegment(e,s)}get mediaBufferTimeRanges(){return new eO(this.tracksBuffered[this.currentTrackId]||[])}}class eO{constructor(e){this.buffered=void 0;const s=(n,i,l)=>{if(i=i>>>0,i>l-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${l})`);return e[i][n]};this.buffered={get length(){return e.length},end(n){return s("end",n,e.length)},start(n){return s("start",n,e.length)}}}}const tO={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},ZS=a=>String.fromCharCode(tO[a]||a),In=15,Si=100,sO={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},aO={17:2,18:4,21:6,22:8,23:10,19:13,20:15},nO={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},iO={25:2,26:4,29:6,30:8,31:10,27:13,28:15},rO=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class lO{constructor(){this.time=null,this.verboseLevel=0}log(e,s){if(this.verboseLevel>=e){const n=typeof s=="function"?s():s;rs.log(`${this.time} [${e}] ${n}`)}}}const tl=function(e){const s=[];for(let n=0;n<e.length;n++)s.push(e[n].toString(16));return s};class ej{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const s=["foreground","underline","italics","background","flash"];for(let n=0;n<s.length;n++){const i=s[n];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class oO{constructor(){this.uchar=" ",this.penState=new ej}reset(){this.uchar=" ",this.penState.reset()}setChar(e,s){this.uchar=e,this.penState.copy(s)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class cO{constructor(e){this.chars=[],this.pos=0,this.currPenState=new ej,this.cueStartTime=null,this.logger=void 0;for(let s=0;s<Si;s++)this.chars.push(new oO);this.logger=e}equals(e){for(let s=0;s<Si;s++)if(!this.chars[s].equals(e.chars[s]))return!1;return!0}copy(e){for(let s=0;s<Si;s++)this.chars[s].copy(e.chars[s])}isEmpty(){let e=!0;for(let s=0;s<Si;s++)if(!this.chars[s].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Si&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Si)}moveCursor(e){const s=this.pos+e;if(e>1)for(let n=this.pos+1;n<s+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(s)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const s=ZS(e);if(this.pos>=Si){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+s+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(s,this.currPenState),this.moveCursor(1)}clearFromPos(e){let s;for(s=e;s<Si;s++)this.chars[s].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let s=!0;for(let n=0;n<Si;n++){const i=this.chars[n].uchar;i!==" "&&(s=!1),e.push(i)}return s?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Rg{constructor(e){this.rows=[],this.currRow=In-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let s=0;s<In;s++)this.rows.push(new cO(e));this.logger=e}reset(){for(let e=0;e<In;e++)this.rows[e].clear();this.currRow=In-1}equals(e){let s=!0;for(let n=0;n<In;n++)if(!this.rows[n].equals(e.rows[n])){s=!1;break}return s}copy(e){for(let s=0;s<In;s++)this.rows[s].copy(e.rows[s])}isEmpty(){let e=!0;for(let s=0;s<In;s++)if(!this.rows[s].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+ms(e));let s=e.row-1;if(this.nrRollUpRows&&s<this.nrRollUpRows-1&&(s=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==s){for(let d=0;d<In;d++)this.rows[d].clear();const l=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const d=o.rows[l].cueStartTime,h=this.logger.time;if(d!==null&&h!==null&&d<h)for(let u=0;u<this.nrRollUpRows;u++)this.rows[s-this.nrRollUpRows+u+1].copy(o.rows[l+u])}}this.currRow=s;const n=this.rows[this.currRow];if(e.indent!==null){const l=e.indent,o=Math.max(l-1,0);n.setCursor(e.indent),e.color=n.chars[o].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+ms(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,s=this.rows.splice(e,1)[0];s.clear(),this.rows.splice(this.currRow,0,s),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const s=[];let n="",i=-1;for(let l=0;l<In;l++){const o=this.rows[l].getTextString();o&&(i=l+1,e?s.push("Row "+i+": '"+o+"'"):s.push(o.trim()))}return s.length>0&&(e?n="["+s.join(" | ")+"]":n=s.join(`
`)),n}getTextAndFormat(){return this.rows}}class wN{constructor(e,s,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=s,this.mode=null,this.verbose=0,this.displayedMemory=new Rg(n),this.nonDisplayedMemory=new Rg(n),this.lastOutputScreen=new Rg(n),this.currRollUpRow=this.displayedMemory.rows[In-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[In-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const s=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>s+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const s={flash:!1};if(s.underline=e%2===1,s.italics=e>=46,s.italics)s.foreground="white";else{const n=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];s.foreground=i[n]}this.logger.log(2,"MIDROW: "+ms(s)),this.writeScreen.setPen(s)}outputDataUpdate(e=!1){const s=this.logger.time;s!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=s:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,s,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:s),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class SN{constructor(e,s,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=uO(),this.logger=void 0;const i=this.logger=new lO;this.channels=[null,new wN(e,s,i),new wN(e+1,n,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,s){this.channels[e].setHandler(s)}addData(e,s){this.logger.time=e;for(let n=0;n<s.length;n+=2){const i=s[n]&127,l=s[n+1]&127;let o=!1,d=null;if(i===0&&l===0)continue;this.logger.log(3,()=>"["+tl([s[n],s[n+1]])+"] -> ("+tl([i,l])+")");const h=this.cmdHistory;if(i>=16&&i<=31){if(dO(i,l,h)){Pu(null,null,h),this.logger.log(3,()=>"Repeated command ("+tl([i,l])+") is dropped");continue}Pu(i,l,this.cmdHistory),o=this.parseCmd(i,l),o||(o=this.parseMidrow(i,l)),o||(o=this.parsePAC(i,l)),o||(o=this.parseBackgroundAttributes(i,l))}else Pu(null,null,h);if(!o&&(d=this.parseChars(i,l),d)){const f=this.currentChannel;f&&f>0?this.channels[f].insertChars(d):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!d&&this.logger.log(2,()=>"Couldn't parse cleaned data "+tl([i,l])+" orig: "+tl([s[n],s[n+1]]))}}parseCmd(e,s){const n=(e===20||e===28||e===21||e===29)&&s>=32&&s<=47,i=(e===23||e===31)&&s>=33&&s<=35;if(!(n||i))return!1;const l=e===20||e===21||e===23?1:2,o=this.channels[l];return e===20||e===21||e===28||e===29?s===32?o.ccRCL():s===33?o.ccBS():s===34?o.ccAOF():s===35?o.ccAON():s===36?o.ccDER():s===37?o.ccRU(2):s===38?o.ccRU(3):s===39?o.ccRU(4):s===40?o.ccFON():s===41?o.ccRDC():s===42?o.ccTR():s===43?o.ccRTD():s===44?o.ccEDM():s===45?o.ccCR():s===46?o.ccENM():s===47&&o.ccEOC():o.ccTO(s-32),this.currentChannel=l,!0}parseMidrow(e,s){let n=0;if((e===17||e===25)&&s>=32&&s<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[n];return i?(i.ccMIDROW(s),this.logger.log(3,()=>"MIDROW ("+tl([e,s])+")"),!0):!1}return!1}parsePAC(e,s){let n;const i=(e>=17&&e<=23||e>=25&&e<=31)&&s>=64&&s<=127,l=(e===16||e===24)&&s>=64&&s<=95;if(!(i||l))return!1;const o=e<=23?1:2;s>=64&&s<=95?n=o===1?sO[e]:nO[e]:n=o===1?aO[e]:iO[e];const d=this.channels[o];return d?(d.setPAC(this.interpretPAC(n,s)),this.currentChannel=o,!0):!1}interpretPAC(e,s){let n;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return s>95?n=s-96:n=s-64,i.underline=(n&1)===1,n<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((n-16)/2)*4,i}parseChars(e,s){let n,i=null,l=null;if(e>=25?(n=2,l=e-8):(n=1,l=e),l>=17&&l<=19){let o;l===17?o=s+80:l===18?o=s+112:o=s+144,this.logger.log(2,()=>"Special char '"+ZS(o)+"' in channel "+n),i=[o]}else e>=32&&e<=127&&(i=s===0?[e]:[e,s]);return i&&this.logger.log(3,()=>"Char codes =  "+tl(i).join(",")),i}parseBackgroundAttributes(e,s){const n=(e===16||e===24)&&s>=32&&s<=47,i=(e===23||e===31)&&s>=45&&s<=47;if(!(n||i))return!1;let l;const o={};e===16||e===24?(l=Math.floor((s-32)/2),o.background=rO[l],s%2===1&&(o.background=o.background+"_semi")):s===45?o.background="transparent":(o.foreground="black",s===47&&(o.underline=!0));const d=e<=23?1:2;return this.channels[d].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const s=this.channels[e];s&&s.reset()}Pu(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let s=0;s<this.channels.length;s++){const n=this.channels[s];n&&n.cueSplitAtTime(e)}}}function Pu(a,e,s){s.a=a,s.b=e}function dO(a,e,s){return s.a===a&&s.b===e}function uO(){return{a:null,b:null}}var Vp=(function(){if(Ch!=null&&Ch.VTTCue)return self.VTTCue;const a=["","lr","rl"],e=["start","middle","end","left","right"];function s(d,h){if(typeof h!="string"||!Array.isArray(d))return!1;const u=h.toLowerCase();return~d.indexOf(u)?u:!1}function n(d){return s(a,d)}function i(d){return s(e,d)}function l(d,...h){let u=1;for(;u<arguments.length;u++){const f=arguments[u];for(const g in f)d[g]=f[g]}return d}function o(d,h,u){const f=this,g={enumerable:!0};f.hasBeenReset=!1;let p="",b=!1,y=d,v=h,_=u,N=null,C="",T=!0,L="auto",F="start",H=50,B="middle",P=50,I="middle";Object.defineProperty(f,"id",l({},g,{get:function(){return p},set:function(D){p=""+D}})),Object.defineProperty(f,"pauseOnExit",l({},g,{get:function(){return b},set:function(D){b=!!D}})),Object.defineProperty(f,"startTime",l({},g,{get:function(){return y},set:function(D){if(typeof D!="number")throw new TypeError("Start time must be set to a number.");y=D,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",l({},g,{get:function(){return v},set:function(D){if(typeof D!="number")throw new TypeError("End time must be set to a number.");v=D,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",l({},g,{get:function(){return _},set:function(D){_=""+D,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",l({},g,{get:function(){return N},set:function(D){N=D,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",l({},g,{get:function(){return C},set:function(D){const O=n(D);if(O===!1)throw new SyntaxError("An invalid or illegal string was specified.");C=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",l({},g,{get:function(){return T},set:function(D){T=!!D,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",l({},g,{get:function(){return L},set:function(D){if(typeof D!="number"&&D!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");L=D,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",l({},g,{get:function(){return F},set:function(D){const O=i(D);if(!O)throw new SyntaxError("An invalid or illegal string was specified.");F=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",l({},g,{get:function(){return H},set:function(D){if(D<0||D>100)throw new Error("Position must be between 0 and 100.");H=D,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",l({},g,{get:function(){return B},set:function(D){const O=i(D);if(!O)throw new SyntaxError("An invalid or illegal string was specified.");B=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",l({},g,{get:function(){return P},set:function(D){if(D<0||D>100)throw new Error("Size must be between 0 and 100.");P=D,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",l({},g,{get:function(){return I},set:function(D){const O=i(D);if(!O)throw new SyntaxError("An invalid or illegal string was specified.");I=O,this.hasBeenReset=!0}})),f.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o})();class hO{decode(e,s){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function tj(a){function e(n,i,l,o){return(n|0)*3600+(i|0)*60+(l|0)+parseFloat(o||0)}const s=a.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return s?parseFloat(s[2])>59?e(s[2],s[3],0,s[4]):e(s[1],s[2],s[3],s[4]):null}class fO{constructor(){this.values=Object.create(null)}set(e,s){!this.get(e)&&s!==""&&(this.values[e]=s)}get(e,s,n){return n?this.has(e)?this.values[e]:s[n]:this.has(e)?this.values[e]:s}has(e){return e in this.values}alt(e,s,n){for(let i=0;i<n.length;++i)if(s===n[i]){this.set(e,s);break}}integer(e,s){/^-?\d+$/.test(s)&&this.set(e,parseInt(s,10))}percent(e,s){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(s)){const n=parseFloat(s);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function sj(a,e,s,n){const i=n?a.split(n):[a];for(const l in i){if(typeof i[l]!="string")continue;const o=i[l].split(s);if(o.length!==2)continue;const d=o[0],h=o[1];e(d,h)}}const O0=new Vp(0,0,""),Ou=O0.align==="middle"?"middle":"center";function mO(a,e,s){const n=a;function i(){const d=tj(a);if(d===null)throw new Error("Malformed timestamp: "+n);return a=a.replace(/^[^\sa-zA-Z-]+/,""),d}function l(d,h){const u=new fO;sj(d,function(p,b){let y;switch(p){case"region":for(let v=s.length-1;v>=0;v--)if(s[v].id===b){u.set(p,s[v].region);break}break;case"vertical":u.alt(p,b,["rl","lr"]);break;case"line":y=b.split(","),u.integer(p,y[0]),u.percent(p,y[0])&&u.set("snapToLines",!1),u.alt(p,y[0],["auto"]),y.length===2&&u.alt("lineAlign",y[1],["start",Ou,"end"]);break;case"position":y=b.split(","),u.percent(p,y[0]),y.length===2&&u.alt("positionAlign",y[1],["start",Ou,"end","line-left","line-right","auto"]);break;case"size":u.percent(p,b);break;case"align":u.alt(p,b,["start",Ou,"end","left","right"]);break}},/:/,/\s/),h.region=u.get("region",null),h.vertical=u.get("vertical","");let f=u.get("line","auto");f==="auto"&&O0.line===-1&&(f=-1),h.line=f,h.lineAlign=u.get("lineAlign","start"),h.snapToLines=u.get("snapToLines",!0),h.size=u.get("size",100),h.align=u.get("align",Ou);let g=u.get("position","auto");g==="auto"&&O0.position===50&&(g=h.align==="start"||h.align==="left"?0:h.align==="end"||h.align==="right"?100:50),h.position=g}function o(){a=a.replace(/^\s+/,"")}if(o(),e.startTime=i(),o(),a.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);a=a.slice(3),o(),e.endTime=i(),o(),l(a,e)}function aj(a){return a.replace(/<br(?: \/)?>/gi,`
`)}class gO{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new hO,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const s=this;e&&(s.buffer+=s.decoder.decode(e,{stream:!0}));function n(){let l=s.buffer,o=0;for(l=aj(l);o<l.length&&l[o]!=="\r"&&l[o]!==`
`;)++o;const d=l.slice(0,o);return l[o]==="\r"&&++o,l[o]===`
`&&++o,s.buffer=l.slice(o),d}function i(l){sj(l,function(o,d){},/:/)}try{let l="";if(s.state==="INITIAL"){if(!/\r\n|\n/.test(s.buffer))return this;l=n();const d=l.match(/^()?WEBVTT([ \t].*)?$/);if(!(d!=null&&d[0]))throw new Error("Malformed WebVTT signature.");s.state="HEADER"}let o=!1;for(;s.buffer;){if(!/\r\n|\n/.test(s.buffer))return this;switch(o?o=!1:l=n(),s.state){case"HEADER":/:/.test(l)?i(l):l||(s.state="ID");continue;case"NOTE":l||(s.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(l)){s.state="NOTE";break}if(!l)continue;if(s.cue=new Vp(0,0,""),s.state="CUE",l.indexOf("-->")===-1){s.cue.id=l;continue}case"CUE":if(!s.cue){s.state="BADCUE";continue}try{mO(l,s.cue,s.regionList)}catch{s.cue=null,s.state="BADCUE";continue}s.state="CUETEXT";continue;case"CUETEXT":{const d=l.indexOf("-->")!==-1;if(!l||d&&(o=!0)){s.oncue&&s.cue&&s.oncue(s.cue),s.cue=null,s.state="ID";continue}if(s.cue===null)continue;s.cue.text&&(s.cue.text+=`
`),s.cue.text+=l}continue;case"BADCUE":l||(s.state="ID")}}}catch{s.state==="CUETEXT"&&s.cue&&s.oncue&&s.oncue(s.cue),s.cue=null,s.state=s.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(s){e.onparsingerror&&e.onparsingerror(s)}return e.onflush&&e.onflush(),this}}const pO=/\r\n|\n\r|\n|\r/g,Lg=function(e,s,n=0){return e.slice(n,n+s.length)===s},xO=function(e){let s=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),l=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Ze(s)||!Ze(n)||!Ze(i)||!Ze(l))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return s+=1e3*n,s+=60*1e3*i,s+=3600*1e3*l,s};function qp(a,e,s){return Bc(a.toString())+Bc(e.toString())+Bc(s)}const yO=function(e,s,n){let i=e[s],l=e[i.prevCC];if(!l||!l.new&&i.new){e.ccOffset=e.presentationOffset=i.start,i.new=!1;return}for(;(o=l)!=null&&o.new;){var o;e.ccOffset+=i.start-l.start,i.new=!1,i=l,l=e[i.prevCC]}e.presentationOffset=n};function bO(a,e,s,n,i,l,o){const d=new gO,h=nn(new Uint8Array(a)).trim().replace(pO,`
`).split(`
`),u=[],f=e?jI(e.baseTime,e.timescale):0;let g="00:00.000",p=0,b=0,y,v=!0;d.oncue=function(_){const N=s[n];let C=s.ccOffset;const T=(p-f)/9e4;if(N!=null&&N.new&&(b!==void 0?C=s.ccOffset=N.start:yO(s,n,T)),T){if(!e){y=new Error("Missing initPTS for VTT MPEGTS");return}C=T-s.presentationOffset}const L=_.endTime-_.startTime,F=Za((_.startTime+C-b)*9e4,i*9e4)/9e4;_.startTime=Math.max(F,0),_.endTime=Math.max(F+L,0);const H=_.text.trim();_.text=decodeURIComponent(encodeURIComponent(H)),_.id||(_.id=qp(_.startTime,_.endTime,H)),_.endTime>0&&u.push(_)},d.onparsingerror=function(_){y=_},d.onflush=function(){if(y){o(y);return}l(u)},h.forEach(_=>{if(v)if(Lg(_,"X-TIMESTAMP-MAP=")){v=!1,_.slice(16).split(",").forEach(N=>{Lg(N,"LOCAL:")?g=N.slice(6):Lg(N,"MPEGTS:")&&(p=parseInt(N.slice(7)))});try{b=xO(g)/1e3}catch(N){y=N}return}else _===""&&(v=!1);d.parse(_+`
`)}),d.flush()}const Dg="stpp.ttml.im1t",nj=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,ij=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,vO={left:"start",center:"center",right:"end",start:"start",end:"end"};function jN(a,e,s,n){const i=Mt(new Uint8Array(a),["mdat"]);if(i.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const l=i.map(d=>nn(d)),o=SI(e.baseTime,1,e.timescale);try{l.forEach(d=>s(_O(d,o)))}catch(d){n(d)}}function _O(a,e){const i=new DOMParser().parseFromString(a,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const l={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(l).reduce((g,p)=>(g[p]=i.getAttribute(`ttp:${p}`)||l[p],g),{}),d=i.getAttribute("xml:space")!=="preserve",h=EN(Mg(i,"styling","style")),u=EN(Mg(i,"layout","region")),f=Mg(i,"body","[begin]");return[].map.call(f,g=>{const p=rj(g,d);if(!p||!g.hasAttribute("begin"))return null;const b=Pg(g.getAttribute("begin"),o),y=Pg(g.getAttribute("dur"),o);let v=Pg(g.getAttribute("end"),o);if(b===null)throw TN(g);if(v===null){if(y===null)throw TN(g);v=b+y}const _=new Vp(b-e,v-e,p);_.id=qp(_.startTime,_.endTime,_.text);const N=u[g.getAttribute("region")],C=h[g.getAttribute("style")],T=NO(N,C,h),{textAlign:L}=T;if(L){const F=vO[L];F&&(_.lineAlign=F),_.align=L}return ds(_,T),_}).filter(g=>g!==null)}function Mg(a,e,s){const n=a.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(s)):[]}function EN(a){return a.reduce((e,s)=>{const n=s.getAttribute("xml:id");return n&&(e[n]=s),e},{})}function rj(a,e){return[].slice.call(a.childNodes).reduce((s,n,i)=>{var l;return n.nodeName==="br"&&i?s+`
`:(l=n.childNodes)!=null&&l.length?rj(n,e):e?s+n.textContent.trim().replace(/\s+/g," "):s+n.textContent},"")}function NO(a,e,s){const n="http://www.w3.org/ns/ttml#styling";let i=null;const l=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=a!=null&&a.hasAttribute("style")?a.getAttribute("style"):null;return o&&s.hasOwnProperty(o)&&(i=s[o]),l.reduce((d,h)=>{const u=Ig(e,n,h)||Ig(a,n,h)||Ig(i,n,h);return u&&(d[h]=u),d},{})}function Ig(a,e,s){return a&&a.hasAttributeNS(e,s)?a.getAttributeNS(e,s):null}function TN(a){return new Error(`Could not parse ttml timestamp ${a}`)}function Pg(a,e){if(!a)return null;let s=tj(a);return s===null&&(nj.test(a)?s=wO(a,e):ij.test(a)&&(s=SO(a,e))),s}function wO(a,e){const s=nj.exec(a),n=(s[4]|0)+(s[5]|0)/e.subFrameRate;return(s[1]|0)*3600+(s[2]|0)*60+(s[3]|0)+n/e.frameRate}function SO(a,e){const s=ij.exec(a),n=Number(s[1]);switch(s[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class Fu{constructor(e,s){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=s}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,s,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=s,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class jO{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=CN(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.MANIFEST_LOADED,this.onManifestLoaded,this),e.on($.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on($.FRAG_LOADING,this.onFragLoading,this),e.on($.FRAG_LOADED,this.onFragLoaded,this),e.on($.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on($.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on($.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on($.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on($.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.MANIFEST_LOADED,this.onManifestLoaded,this),e.off($.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off($.FRAG_LOADING,this.onFragLoading,this),e.off($.FRAG_LOADED,this.onFragLoaded,this),e.off($.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off($.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off($.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off($.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off($.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Fu(this,"textTrack1"),s=new Fu(this,"textTrack2"),n=new Fu(this,"textTrack3"),i=new Fu(this,"textTrack4");this.cea608Parser1=new SN(1,e,s),this.cea608Parser2=new SN(3,n,i)}addCues(e,s,n,i,l){let o=!1;for(let d=l.length;d--;){const h=l[d],u=EO(h[0],h[1],s,n);if(u>=0&&(h[0]=Math.min(h[0],s),h[1]=Math.max(h[1],n),o=!0,u/(n-s)>.5))return}if(o||l.push([s,n]),this.config.renderTextTracksNatively){const d=this.captionsTracks[e];this.Cues.newCue(d,s,n,i)}else{const d=this.Cues.newCue(null,s,n,i);this.hls.trigger($.CUES_PARSED,{type:"captions",cues:d,track:e})}}onInitPtsFound(e,{frag:s,id:n,initPTS:i,timescale:l,trackId:o}){const{unparsedVttFrags:d}=this;n===et.MAIN&&(this.initPTS[s.cc]={baseTime:i,timescale:l,trackId:o}),d.length&&(this.unparsedVttFrags=[],d.forEach(h=>{this.initPTS[h.frag.cc]?this.onFragLoaded($.FRAG_LOADED,h):this.hls.trigger($.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:h.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,s){const{media:n}=this;if(n)for(let i=0;i<n.textTracks.length;i++){const l=n.textTracks[i];if(AN(l,{name:e,lang:s,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return l}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:s,captionsTracks:n,media:i}=this,{label:l,languageCode:o}=s[e],d=this.getExistingTrack(l,o);if(d)n[e]=d,uo(n[e]),QS(n[e],i);else{const h=this.createTextTrack("captions",l,o);h&&(h[e]=!0,n[e]=h)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const s=this.captionsProperties[e];if(!s)return;const n=s.label,i={_id:e,label:n,kind:"captions",default:s.media?!!s.media.default:!1,closedCaptions:s.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger($.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,s,n){const i=this.media;if(i)return i.addTextTrack(e,s,n)}onMediaAttaching(e,s){this.media=s.media,s.mediaSource||this._cleanTracks()}onMediaDetaching(e,s){const n=!!s.transferMedia;if(this.media=null,n)return;const{captionsTracks:i}=this;Object.keys(i).forEach(l=>{uo(i[l]),delete i[l]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=CN(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const s=e.textTracks;if(s)for(let n=0;n<s.length;n++)uo(s[n])}onSubtitleTracksUpdated(e,s){const n=s.subtitleTracks||[],i=n.some(l=>l.textCodec===Dg);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(OS(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const o=this.media,d=o?oh(o.textTracks):null;if(this.tracks.forEach((h,u)=>{let f;if(d){let g=null;for(let p=0;p<d.length;p++)if(d[p]&&AN(d[p],h)){g=d[p],d[p]=null;break}g&&(f=g)}if(f)uo(f);else{const g=lj(h);f=this.createTextTrack(g,h.name,h.lang),f&&(f.mode="disabled")}f&&this.textTracks.push(f)}),d!=null&&d.length){const h=d.filter(u=>u!==null).map(u=>u.label);h.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${h.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(d=>({label:d.name,kind:d.type.toLowerCase(),default:d.default,subtitleTrack:d}));this.hls.trigger($.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,s){this.config.enableCEA708Captions&&s.captions&&s.captions.forEach(n=>{const i=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!i)return;const l=`textTrack${i[1]}`,o=this.captionsProperties[l];o&&(o.label=n.name,n.lang&&(o.languageCode=n.lang),o.media=n)})}closedCaptionsForLevel(e){const s=this.hls.levels[e.level];return s?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,s){if(this.enabled&&s.frag.type===et.MAIN){var n,i;const{cea608Parser1:l,cea608Parser2:o,lastSn:d}=this,{cc:h,sn:u}=s.frag,f=(n=(i=s.part)==null?void 0:i.index)!=null?n:-1;l&&o&&(u!==d+1||u===d&&f!==this.lastPartIndex+1||h!==this.lastCc)&&(l.reset(),o.reset()),this.lastCc=h,this.lastSn=u,this.lastPartIndex=f}}onFragLoaded(e,s){const{frag:n,payload:i}=s;if(n.type===et.SUBTITLE)if(i.byteLength){const l=n.decryptdata,o="stats"in s;if(l==null||!l.encrypted||o){const d=this.tracks[n.level],h=this.vttCCs;h[n.cc]||(h[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),d&&d.textCodec===Dg?this._parseIMSC1(n,i):this._parseVTTs(s)}}else this.hls.trigger($.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,s){const n=this.hls;jN(s,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),n.trigger($.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{n.logger.log(`Failed to parse IMSC1: ${i}`),n.trigger($.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e){var s;const{frag:n,payload:i}=e,{initPTS:l,unparsedVttFrags:o}=this,d=l.length-1;if(!l[n.cc]&&d===-1){o.push(e);return}const h=this.hls,u=(s=n.initSegment)!=null&&s.data?wn(n.initSegment.data,new Uint8Array(i)).buffer:i;bO(u,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,f=>{this._appendCues(f,n.level),h.trigger($.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},f=>{const g=f.message==="Missing initPTS for VTT MPEGTS";g?o.push(e):this._fallbackToIMSC1(n,i),h.logger.log(`Failed to parse VTT cue: ${f}`),!(g&&d>n.cc)&&h.trigger($.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:f})})}_fallbackToIMSC1(e,s){const n=this.tracks[e.level];n.textCodec||jN(s,this.initPTS[e.cc],()=>{n.textCodec=Dg,this._parseIMSC1(e,s)},()=>{n.textCodec="wvtt"})}_appendCues(e,s){const n=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[s];if(!i||i.mode==="disabled")return;e.forEach(l=>XS(i,l))}else{const i=this.tracks[s];if(!i)return;const l=i.default?"default":"subtitles"+s;n.trigger($.CUES_PARSED,{type:"subtitles",cues:e,track:l})}}onFragDecrypted(e,s){const{frag:n}=s;n.type===et.SUBTITLE&&this.onFragLoaded($.FRAG_LOADED,s)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,s){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:i}=s;if(!(n.type===et.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let l=0;l<i.length;l++){const o=i[l].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const d=this.extractCea608Data(o);this.cea608Parser1.addData(i[l].pts,d[0]),this.cea608Parser2.addData(i[l].pts,d[1])}}}onBufferFlushing(e,{startOffset:s,endOffset:n,endOffsetSubtitles:i,type:l}){const{media:o}=this;if(!(!o||o.currentTime<n)){if(!l||l==="video"){const{captionsTracks:d}=this;Object.keys(d).forEach(h=>P0(d[h],s,n))}if(this.config.renderTextTracksNatively&&s===0&&i!==void 0){const{textTracks:d}=this;Object.keys(d).forEach(h=>P0(d[h],s,i))}}}extractCea608Data(e){const s=[[],[]],n=e[0]&31;let i=2;for(let l=0;l<n;l++){const o=e[i++],d=127&e[i++],h=127&e[i++];if(d===0&&h===0)continue;if((4&o)!==0){const f=3&o;(f===0||f===1)&&(s[f].push(d),s[f].push(h))}}return s}}function lj(a){return a.characteristics&&/transcribes-spoken-dialog/gi.test(a.characteristics)&&/describes-music-and-sound/gi.test(a.characteristics)?"captions":"subtitles"}function AN(a,e){return!!a&&a.kind===lj(e)&&L0(e,a)}function EO(a,e,s,n){return Math.min(e,n)-Math.max(a,s)}function CN(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const TO=/\s/,AO={newCue(a,e,s,n){const i=[];let l,o,d,h,u;const f=self.VTTCue||self.TextTrackCue;for(let p=0;p<n.rows.length;p++)if(l=n.rows[p],d=!0,h=0,u="",!l.isEmpty()){var g;for(let v=0;v<l.chars.length;v++)TO.test(l.chars[v].uchar)&&d?h++:(u+=l.chars[v].uchar,d=!1);l.cueStartTime=e,e===s&&(s+=1e-4),h>=16?h--:h++;const b=aj(u.trim()),y=qp(e,s,b);a!=null&&(g=a.cues)!=null&&g.getCueById(y)||(o=new f(e,s,b),o.id=y,o.line=p+1,o.align="left",o.position=10+Math.min(80,Math.floor(h*8/32)*10),i.push(o))}return a&&i.length&&(i.sort((p,b)=>p.line==="auto"||b.line==="auto"?0:p.line>8&&b.line>8?b.line-p.line:p.line-b.line),i.forEach(p=>XS(a,p))),i}};function CO(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const kO=/(\d+)-(\d+)\/(\d+)/;class kN{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||MO,this.controller=new self.AbortController,this.stats=new Np}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,s,n){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const l=RO(e,this.controller.signal),o=e.responseType==="arraybuffer",d=o?"byteLength":"length",{maxTimeToFirstByteMs:h,maxLoadTimeMs:u}=s.loadPolicy;this.context=e,this.config=s,this.callbacks=n,this.request=this.fetchSetup(e,l),self.clearTimeout(this.requestTimeout),s.timeout=h&&Ze(h)?h:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},s.timeout),(Wc(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(g=>{var p;this.response=this.loader=g;const b=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),s.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},u-(b-i.loading.start)),!g.ok){const{status:v,statusText:_}=g;throw new IO(_||"fetch, bad network response",v,g)}i.loading.first=b,i.total=DO(g.headers)||i.total;const y=(p=this.callbacks)==null?void 0:p.onProgress;return y&&Ze(s.highWaterMark)?this.loadProgressively(g,i,e,s.highWaterMark,y):o?g.arrayBuffer():e.responseType==="json"?g.json():g.text()}).then(g=>{var p,b;const y=this.response;if(!y)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const v=g[d];v&&(i.loaded=i.total=v);const _={url:y.url,data:g,code:y.status},N=(p=this.callbacks)==null?void 0:p.onProgress;N&&!Ze(s.highWaterMark)&&N(i,e,g,y),(b=this.callbacks)==null||b.onSuccess(_,i,e,y)}).catch(g=>{var p;if(self.clearTimeout(this.requestTimeout),i.aborted)return;const b=g&&g.code||0,y=g?g.message:null;(p=this.callbacks)==null||p.onError({code:b,text:y},e,g?g.details:null,i)})}getCacheAge(){let e=null;if(this.response){const s=this.response.headers.get("age");e=s?parseFloat(s):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,s,n,i=0,l){const o=new xS,d=e.body.getReader(),h=()=>d.read().then(u=>{if(u.done)return o.dataLength&&l(s,n,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const f=u.value,g=f.length;return s.loaded+=g,g<i||o.dataLength?(o.push(f),o.dataLength>=i&&l(s,n,o.flush().buffer,e)):l(s,n,f.buffer,e),h()}).catch(()=>Promise.reject());return h()}}function RO(a,e){const s={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(ds({},a.headers))};return a.rangeEnd&&s.headers.set("Range","bytes="+a.rangeStart+"-"+String(a.rangeEnd-1)),s}function LO(a){const e=kO.exec(a);if(e)return parseInt(e[2])-parseInt(e[1])+1}function DO(a){const e=a.get("Content-Range");if(e){const n=LO(e);if(Ze(n))return n}const s=a.get("Content-Length");if(s)return parseInt(s)}function MO(a,e){return new self.Request(a.url,e)}class IO extends Error{constructor(e,s,n){super(e),this.code=void 0,this.details=void 0,this.code=s,this.details=n}}const PO=/^age:\s*[\d.]+\s*$/im;class oj{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Np,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,s,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=s,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:s}=this;if(!e||!s)return;const n=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const l=this.xhrSetup;l?Promise.resolve().then(()=>{if(!(this.loader!==n||this.stats.aborted))return l(n,s.url)}).catch(o=>{if(!(this.loader!==n||this.stats.aborted))return n.open("GET",s.url,!0),l(n,s.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,s,e)}).catch(o=>{var d;(d=this.callbacks)==null||d.onError({code:n.status,text:o.message},s,n,i)}):this.openAndSendXhr(n,s,e)}openAndSendXhr(e,s,n){e.readyState||e.open("GET",s.url,!0);const i=s.headers,{maxTimeToFirstByteMs:l,maxLoadTimeMs:o}=n.loadPolicy;if(i)for(const d in i)e.setRequestHeader(d,i[d]);s.rangeEnd&&e.setRequestHeader("Range","bytes="+s.rangeStart+"-"+(s.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=s.responseType,self.clearTimeout(this.requestTimeout),n.timeout=l&&Ze(l)?l:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:s,stats:n}=this;if(!e||!s)return;const i=s.readyState,l=this.config;if(!n.aborted&&i>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),l.timeout!==l.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),l.timeout=l.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),l.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),s.onreadystatechange=null,s.onprogress=null;const u=s.status,f=s.responseType==="text"?s.responseText:null;if(u>=200&&u<300){const y=f??s.response;if(y!=null){var o,d;n.loading.end=Math.max(self.performance.now(),n.loading.first);const v=s.responseType==="arraybuffer"?y.byteLength:y.length;n.loaded=n.total=v,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first);const _=(o=this.callbacks)==null?void 0:o.onProgress;_&&_(n,e,y,s);const N={url:s.responseURL,data:y,code:u};(d=this.callbacks)==null||d.onSuccess(N,n,e,s);return}}const g=l.loadPolicy.errorRetry,p=n.retry,b={url:e.url,data:void 0,code:u};if(Th(g,p,!1,b))this.retry(g);else{var h;rs.error(`${u} while loading ${e.url}`),(h=this.callbacks)==null||h.onError({code:u,text:s.statusText},e,s,n)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,s=this.stats.retry;if(Th(e,s,!0))this.retry(e);else{var n;rs.warn(`timeout while loading ${(n=this.context)==null?void 0:n.url}`);const i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:s,stats:n}=this;this.retryDelay=Ep(e,n.retry),n.retry++,rs.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${s?.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const s=this.stats;s.loaded=e.loaded,e.lengthComputable&&(s.total=e.total)}getCacheAge(){let e=null;if(this.loader&&PO.test(this.loader.getAllResponseHeaders())){const s=this.loader.getResponseHeader("age");e=s?parseFloat(s):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const OO={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},FO=is(is({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:oj,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Q5,bufferController:UI,capLevelController:Up,errorController:tM,fpsController:$P,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:rS,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:OO},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},BO()),{},{subtitleStreamController:ZP,subtitleTrackController:qP,timelineController:jO,audioStreamController:PI,audioTrackController:OI,emeController:xo,cmcdController:OP,contentSteeringController:BP,interstitialsController:JP});function BO(){return{cueHandler:AO,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function UO(a,e,s){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=F0(a),i=["manifest","level","frag"],l=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(o=>{const d=`${o==="level"?"playlist":o}LoadPolicy`,h=e[d]===void 0,u=[];l.forEach(f=>{const g=`${o}Loading${f}`,p=e[g];if(p!==void 0&&h){u.push(g);const b=n[d].default;switch(e[d]={default:b},f){case"TimeOut":b.maxLoadTimeMs=p,b.maxTimeToFirstByteMs=p;break;case"MaxRetry":b.errorRetry.maxNumRetry=p,b.timeoutRetry.maxNumRetry=p;break;case"RetryDelay":b.errorRetry.retryDelayMs=p,b.timeoutRetry.retryDelayMs=p;break;case"MaxRetryTimeout":b.errorRetry.maxRetryDelayMs=p,b.timeoutRetry.maxRetryDelayMs=p;break}}}),u.length&&s.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${d}": ${ms(e[d])}`)}),is(is({},n),e)}function F0(a){return a&&typeof a=="object"?Array.isArray(a)?a.map(F0):Object.keys(a).reduce((e,s)=>(e[s]=F0(a[s]),e),{}):a}function $O(a,e){const s=a.loader;s!==kN&&s!==oj?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),a.progressive=!1):CO()&&(a.loader=kN,a.progressive=!0,a.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const ch=2,GO=.1,VO=.05,qO=100;class KO extends tS{constructor(e,s){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var n;(n=this.media)!=null&&n.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var n;this.ended=((n=this.media)==null?void 0:n.currentTime)||1,this.hls.trigger($.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=s,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on($.MEDIA_ATTACHED,this.onMediaAttached,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off($.MEDIA_ATTACHED,this.onMediaAttached,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,s){this.setInterval(qO),this.mediaSource=s.mediaSource;const n=this.media=s.media;Na(n,"playing",this.onMediaPlaying),Na(n,"waiting",this.onMediaWaiting),Na(n,"ended",this.onMediaEnded)}onMediaDetaching(e,s){this.clearInterval();const{media:n}=this;n&&(Pa(n,"playing",this.onMediaPlaying),Pa(n,"waiting",this.onMediaWaiting),Pa(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,s){this.buffered=s.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const s=this.media.currentTime;this.poll(s,this.lastCurrentTime),this.lastCurrentTime=s}poll(e,s){var n,i;const l=(n=this.hls)==null?void 0:n.config;if(!l)return;const o=this.media;if(!o)return;const{seeking:d}=o,h=this.seeking&&!d,u=!this.seeking&&d,f=o.paused&&!d||o.ended||o.playbackRate===0;if(this.seeking=d,e!==s){s&&(this.ended=0),this.moved=!0,d||(this.nudgeRetry=0,l.nudgeOnVideoHole&&!f&&e>s&&this.nudgeOnVideoHole(e,s)),this.waiting===0&&this.stallResolved(e);return}if(u||h){h&&this.stallResolved(e);return}if(f){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger($.MEDIA_ENDED,{stalled:!1}));return}if(!St.getBuffered(o).length){this.nudgeRetry=0;return}const g=St.bufferInfo(o,e,0),p=g.nextStart||0,b=this.fragmentTracker;if(d&&b&&this.hls){const H=RN(this.hls.inFlightFragments,e),B=g.len>ch,P=!p||H||p-e>ch&&!b.getPartialFragment(e);if(B||P)return;this.moved=!1}const y=(i=this.hls)==null?void 0:i.latestLevelDetails;if(!this.moved&&this.stalled!==null&&b){if(!(g.len>0)&&!p)return;const B=Math.max(p,g.start||0)-e,I=!!(y!=null&&y.live)?y.targetduration*2:ch,D=Bu(e,b);if(B>0&&(B<=I||D)){o.paused||this._trySkipBufferHole(D);return}}const v=l.detectStallWithCurrentTimeMs,_=self.performance.now(),N=this.waiting;let C=this.stalled;if(C===null)if(N>0&&_-N<v)C=this.stalled=N;else{this.stalled=_;return}const T=_-C;if(!d&&(T>=v||N)&&this.hls){var L;if(((L=this.mediaSource)==null?void 0:L.readyState)==="ended"&&!(y!=null&&y.live)&&Math.abs(e-(y?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger($.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(g),!this.media||!this.hls)return}const F=St.bufferInfo(o,e,l.maxBufferHole);this._tryFixBufferStall(F,T,e)}stallResolved(e){const s=this.stalled;if(s&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-s;this.log(`playback not stuck anymore @${e}, after ${Math.round(n)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger($.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,s){var n;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(n=this.buffered.audio)!=null&&n.length&&i&&i.length>1&&e>i.end(0)){const l=St.bufferedInfo(St.timeRangesToArray(this.buffered.audio),e,0);if(l.len>1&&s>=l.start){const o=St.timeRangesToArray(i),d=St.bufferedInfo(o,s,0).bufferedIndex;if(d>-1&&d<o.length-1){const h=St.bufferedInfo(o,e,0).bufferedIndex,u=o[d].end,f=o[d+1].start;if((h===-1||h>d)&&f-u<1&&e-u<2){const g=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${f} buffered index: ${h}`);this.warn(g.message),this.media.currentTime+=1e-6;let p=Bu(e,this.fragmentTracker);p&&"fragment"in p?p=p.fragment:p||(p=void 0);const b=St.bufferInfo(this.media,e,0);this.hls.trigger($.ERROR,{type:rt.MEDIA_ERROR,details:Ne.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,frag:p,buffer:b.len,bufferInfo:b})}}}}}_tryFixBufferStall(e,s,n){var i,l;const{fragmentTracker:o,media:d}=this,h=(i=this.hls)==null?void 0:i.config;if(!d||!o||!h)return;const u=(l=this.hls)==null?void 0:l.latestLevelDetails,f=Bu(n,o);if((f||u!=null&&u.live&&n<u.fragmentStart)&&(this._trySkipBufferHole(f)||!this.media))return;const g=e.buffered,p=this.adjacentTraversal(e,n);(g&&g.length>1&&e.len>h.maxBufferHole||e.nextStart&&(e.nextStart-n<h.maxBufferHole||p))&&(s>h.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,s){const n=this.fragmentTracker,i=e.nextStart;if(n&&i){const l=n.getFragAtPos(s,et.MAIN),o=n.getFragAtPos(i,et.MAIN);if(l&&o)return o.sn-l.sn<2}return!1}_reportStall(e){const{hls:s,media:n,stallReported:i,stalled:l}=this;if(!i&&l!==null&&n&&s){this.stallReported=!0;const o=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${ms(e)})`);this.warn(o.message),s.trigger($.ERROR,{type:rt.MEDIA_ERROR,details:Ne.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:l}})}}_trySkipBufferHole(e){var s;const{fragmentTracker:n,media:i}=this,l=(s=this.hls)==null?void 0:s.config;if(!i||!n||!l)return 0;const o=i.currentTime,d=St.bufferInfo(i,o,0),h=o<d.start?d.start:d.nextStart;if(h&&this.hls){const f=d.len<=l.maxBufferHole,g=d.len>0&&d.len<1&&i.readyState<3,p=h-o;if(p>0&&(f||g)){if(p>l.maxBufferHole){let y=!1;if(o===0){const v=n.getAppendedFrag(0,et.MAIN);v&&h<v.end&&(y=!0)}if(!y&&e){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||RN(this.hls.inFlightFragments,h))return 0;let _=!1,N=e.end;for(;N<h;){const C=Bu(N,n);if(C)N+=C.duration;else{_=!0;break}}if(_)return 0}}const b=Math.max(h+VO,o+GO);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${b}`),this.moved=!0,i.currentTime=b,!(e!=null&&e.gap)){const y=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${b}`),v={type:rt.MEDIA_ERROR,details:Ne.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:y,reason:y.message,buffer:d.len,bufferInfo:d};e&&("fragment"in e?v.part=e:v.frag=e),this.hls.trigger($.ERROR,v)}return b}}return 0}_tryNudgeBuffer(e){const{hls:s,media:n,nudgeRetry:i}=this,l=s?.config;if(!n||!l)return 0;const o=n.currentTime;if(this.nudgeRetry++,i<l.nudgeMaxRetry){const d=o+(i+1)*l.nudgeOffset,h=new Error(`Nudging 'currentTime' from ${o} to ${d}`);this.warn(h.message),n.currentTime=d,s.trigger($.ERROR,{type:rt.MEDIA_ERROR,details:Ne.BUFFER_NUDGE_ON_STALL,error:h,fatal:!1,buffer:e.len,bufferInfo:e})}else{const d=new Error(`Playhead still not moving while enough data buffered @${o} after ${l.nudgeMaxRetry} nudges`);this.error(d.message),s.trigger($.ERROR,{type:rt.MEDIA_ERROR,details:Ne.BUFFER_STALLED_ERROR,error:d,fatal:!0,buffer:e.len,bufferInfo:e})}}}function RN(a,e){const s=LN(a.main);if(s&&s.start<=e)return s;const n=LN(a.audio);return n&&n.start<=e?n:null}function LN(a){if(!a)return null;switch(a.state){case Be.IDLE:case Be.STOPPED:case Be.ENDED:case Be.ERROR:return null}return a.frag}function Bu(a,e){return e.getAppendedFrag(a,et.MAIN)||e.getPartialFragment(a)}const HO=.25;function B0(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Og(a,e,s,n,i){let l=new a(e,s,"");try{l.value=n,i&&(l.type=i)}catch{l=new a(e,s,ms(i?is({type:i},n):n))}return l}const Uu=(()=>{const a=B0();try{a&&new a(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class zO{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger($.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on($.MEDIA_ATTACHED,this.onMediaAttached,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on($.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on($.LEVEL_UPDATED,this.onLevelUpdated,this),e.on($.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off($.MEDIA_ATTACHED,this.onMediaAttached,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off($.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off($.LEVEL_UPDATED,this.onLevelUpdated,this),e.off($.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,s){var n;this.media=s.media,((n=s.overrides)==null?void 0:n.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const s=(e=this.hls)==null?void 0:e.latestLevelDetails;s&&this.updateDateRangeCues(s)}onMediaDetaching(e,s){this.media=null,!s.transferMedia&&(this.id3Track&&(this.removeCues&&uo(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const s=this.getID3Track(e.textTracks);return s.mode="hidden",s}getID3Track(e){if(this.media){for(let s=0;s<e.length;s++){const n=e[s];if(n.kind==="metadata"&&n.label==="id3")return QS(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,s){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:i}=this.hls.config;if(!n&&!i)return;const{samples:l}=s;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=B0();if(o)for(let d=0;d<l.length;d++){const h=l[d].type;if(h===en.emsg&&!n||!i)continue;const u=SS(l[d].data),f=l[d].pts;let g=f+l[d].duration;g>Uu&&(g=Uu),g-f<=0&&(g=f+HO);for(let b=0;b<u.length;b++){const y=u[b];if(!jS(y)){this.updateId3CueEnds(f,h);const v=Og(o,f,g,y,h);v&&this.id3Track.addCue(v)}}}}updateId3CueEnds(e,s){var n;const i=(n=this.id3Track)==null?void 0:n.cues;if(i)for(let l=i.length;l--;){const o=i[l];o.type===s&&o.startTime<e&&o.endTime===Uu&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:s,endOffset:n,type:i}){const{id3Track:l,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:d,enableID3MetadataCues:h}}=o;if(l&&(d||h)){let u;i==="audio"?u=f=>f.type===en.audioId3&&h:i==="video"?u=f=>f.type===en.emsg&&d:u=f=>f.type===en.audioId3&&h||f.type===en.emsg&&d,P0(l,s,n,u)}}onLevelUpdated(e,{details:s}){this.updateDateRangeCues(s,!0)}onLevelPtsUpdated(e,s){Math.abs(s.drift)>.01&&this.updateDateRangeCues(s.details)}updateDateRangeCues(e,s){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:i,enableDateRangeMetadataCues:l,interstitialsController:o}=this.hls.config;if(!l)return;const d=B0();if(n&&i&&!o){const{fragmentStart:v,fragmentEnd:_}=e;let N=this.assetCue;N?(N.startTime=v,N.endTime=_):d&&(N=this.assetCue=Og(d,v,_,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),N&&(N.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(N),N.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:h}=this,{dateRanges:u}=e,f=Object.keys(u);let g=this.dateRangeCuesAppended;if(h&&s){var p;if((p=h.cues)!=null&&p.length){const v=Object.keys(g).filter(_=>!f.includes(_));for(let _=v.length;_--;){var b;const N=v[_],C=(b=g[N])==null?void 0:b.cues;delete g[N],C&&Object.keys(C).forEach(T=>{const L=C[T];if(L){L.removeEventListener("enter",this.onEventCueEnter);try{h.removeCue(L)}catch{}}})}}else g=this.dateRangeCuesAppended={}}const y=e.fragments[e.fragments.length-1];if(!(f.length===0||!Ze(y?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let v=0;v<f.length;v++){const _=f[v],N=u[_],C=N.startTime,T=g[_],L=T?.cues||{};let F=T?.durationKnown||!1,H=Uu;const{duration:B,endDate:P}=N;if(P&&B!==null)H=C+B,F=!0;else if(N.endOnNext&&!F){const D=f.reduce((O,ee)=>{if(ee!==N.id){const ie=u[ee];if(ie.class===N.class&&ie.startDate>N.startDate&&(!O||N.startDate<O.startDate))return ie}return O},null);D&&(H=D.startTime,F=!0)}const I=Object.keys(N.attr);for(let D=0;D<I.length;D++){const O=I[D];if(!mM(O))continue;const ee=L[O];if(ee)F&&!(T!=null&&T.durationKnown)?ee.endTime=H:Math.abs(ee.startTime-C)>.01&&(ee.startTime=C,ee.endTime=H);else if(d){let ie=N.attr[O];gM(O)&&(ie=Iw(ie));const z=Og(d,C,H,{key:O,data:ie},en.dateRange);z&&(z.id=_,this.id3Track.addCue(z),L[O]=z,o&&(O==="X-ASSET-LIST"||O==="X-ASSET-URL")&&z.addEventListener("enter",this.onEventCueEnter))}}g[_]={cues:L,dateRange:N,durationKnown:F}}}}}class YO{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:s}=this,n=this.levelDetails;if(!s||!n)return;this.currentTime=s.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:l,maxLiveSyncPlaybackRate:o}=this.config;if(!l||o===1||!n.live)return;const d=this.targetLatency;if(d===null)return;const h=i-d,u=Math.min(this.maxLatency,d+n.targetduration);if(h<u&&h>.05&&this.forwardBufferLength>1){const g=Math.min(2,Math.max(1,o)),p=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20,b=Math.min(g,Math.max(1,p));this.changeMediaPlaybackRate(s,b)}else s.playbackRate!==1&&s.playbackRate!==0&&this.changeMediaPlaybackRate(s,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const s=this.levelDetails;return s?e.liveMaxLatencyDurationCount*s.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:s,partHoldBack:n,targetduration:i}=e,{liveSyncDuration:l,liveSyncDurationCount:o,lowLatencyMode:d}=this.config,h=this.hls.userConfig;let u=d&&n||s;(this._targetLatencyUpdated||h.liveSyncDuration||h.liveSyncDurationCount||u===0)&&(u=l!==void 0?l:o*i);const f=i;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,f)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),s=this.targetLatency;if(e===null||s===null)return null;const n=this.levelDetails;if(n===null)return null;const i=n.edge,l=e-s-this.edgeStalled,o=i-n.totalduration,d=i-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(o,l),d)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const s=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-s,0)}get forwardBufferLength(){const{media:e}=this,s=this.levelDetails;if(!e||!s)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):s.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on($.MEDIA_ATTACHED,this.onMediaAttached,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.LEVEL_UPDATED,this.onLevelUpdated,this),e.on($.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off($.MEDIA_ATTACHED,this.onMediaAttached,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.LEVEL_UPDATED,this.onLevelUpdated,this),e.off($.ERROR,this.onError,this))}onMediaAttached(e,s){this.media=s.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:s}){s.advanced&&this.onTimeupdate(),!s.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,s){var n;s.details===Ne.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(n=this.levelDetails)!=null&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,s){var n,i;e.playbackRate!==s&&((n=this.hls)==null||n.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(i=this.targetLatency)==null?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${s}`),e.playbackRate=s)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class WO extends Bp{constructor(e,s){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=s,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.MANIFEST_LOADED,this.onManifestLoaded,this),e.on($.LEVEL_LOADED,this.onLevelLoaded,this),e.on($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on($.FRAG_BUFFERED,this.onFragBuffered,this),e.on($.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.MANIFEST_LOADED,this.onManifestLoaded,this),e.off($.LEVEL_LOADED,this.onLevelLoaded,this),e.off($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off($.FRAG_BUFFERED,this.onFragBuffered,this),e.off($.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(s=>{s.loadError=0,s.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,s){this.resetLevels()}onManifestLoaded(e,s){const n=this.hls.config.preferManagedMediaSource,i=[],l={},o={};let d=!1,h=!1,u=!1;s.levels.forEach(f=>{const g=f.attrs;let{audioCodec:p,videoCodec:b}=f;p&&(f.audioCodec=p=wh(p,n)||void 0),b&&(b=f.videoCodec=R5(b));const{width:y,height:v,unknownCodecs:_}=f,N=_?.length||0;if(d||(d=!!(y&&v)),h||(h=!!b),u||(u=!!p),N||p&&!this.isAudioSupported(p)||b&&!this.isVideoSupported(b)){this.log(`Some or all CODECS not supported "${g.CODECS}"`);return}const{CODECS:C,"FRAME-RATE":T,"HDCP-LEVEL":L,"PATHWAY-ID":F,RESOLUTION:H,"VIDEO-RANGE":B}=g,I=`${`${F||"."}-`}${f.bitrate}-${H}-${T}-${C}-${B}-${L}`;if(l[I])if(l[I].uri!==f.url&&!f.attrs["PATHWAY-ID"]){const D=o[I]+=1;f.attrs["PATHWAY-ID"]=new Array(D+1).join(".");const O=this.createLevel(f);l[I]=O,i.push(O)}else l[I].addGroupId("audio",g.AUDIO),l[I].addGroupId("text",g.SUBTITLES);else{const D=this.createLevel(f);l[I]=D,o[I]=1,i.push(D)}}),this.filterAndSortMediaOptions(i,s,d,h,u)}createLevel(e){const s=new Hc(e),n=e.supplemental;if(n!=null&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const i=new Error(`SUPPLEMENTAL-CODECS not supported "${n.videoCodec}"`);this.log(i.message),s.supportedResult=zw(i,[])}return s}isAudioSupported(e){return qc(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return qc(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,s,n,i,l){var o;let d=[],h=[],u=e;const f=((o=s.stats)==null?void 0:o.parsing)||{};if((n||i)&&l&&(u=u.filter(({videoCodec:C,videoRange:T,width:L,height:F})=>(!!C||!!(L&&F))&&$5(T))),u.length===0){Promise.resolve().then(()=>{if(this.hls){let C="no level with compatible codecs found in manifest",T=C;s.levels.length&&(T=`one or more CODECS in variant not supported: ${ms(s.levels.map(F=>F.attrs.CODECS).filter((F,H,B)=>B.indexOf(F)===H))}`,this.warn(T),C+=` (${T})`);const L=new Error(C);this.hls.trigger($.ERROR,{type:rt.MEDIA_ERROR,details:Ne.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:s.url,error:L,reason:T})}}),f.end=performance.now();return}s.audioTracks&&(d=s.audioTracks.filter(C=>!C.audioCodec||this.isAudioSupported(C.audioCodec)),DN(d)),s.subtitles&&(h=s.subtitles,DN(h));const g=u.slice(0);u.sort((C,T)=>{if(C.attrs["HDCP-LEVEL"]!==T.attrs["HDCP-LEVEL"])return(C.attrs["HDCP-LEVEL"]||"")>(T.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&C.height!==T.height)return C.height-T.height;if(C.frameRate!==T.frameRate)return C.frameRate-T.frameRate;if(C.videoRange!==T.videoRange)return Sh.indexOf(C.videoRange)-Sh.indexOf(T.videoRange);if(C.videoCodec!==T.videoCodec){const L=S_(C.videoCodec),F=S_(T.videoCodec);if(L!==F)return F-L}if(C.uri===T.uri&&C.codecSet!==T.codecSet){const L=Nh(C.codecSet),F=Nh(T.codecSet);if(L!==F)return F-L}return C.averageBitrate!==T.averageBitrate?C.averageBitrate-T.averageBitrate:0});let p=g[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==g.length)){for(let C=0;C<g.length;C++)if(g[C].pathwayId===u[0].pathwayId){p=g[C];break}}this._levels=u;for(let C=0;C<u.length;C++)if(u[C]===p){var b;this._firstLevel=C;const T=p.bitrate,L=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${u.length} level(s) found, first bitrate: ${T}`),((b=this.hls.userConfig)==null?void 0:b.abrEwmaDefaultEstimate)===void 0){const F=Math.min(T,this.hls.config.abrEwmaDefaultEstimateMax);F>L&&L===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=F)}break}const y=l&&!i,v=this.hls.config,_=!!(v.audioStreamController&&v.audioTrackController),N={levels:u,audioTracks:d,subtitleTracks:h,sessionData:s.sessionData,sessionKeys:s.sessionKeys,firstLevel:this._firstLevel,stats:s.stats,audio:l,video:i,altAudio:_&&!y&&d.some(C=>!!C.url)};f.end=performance.now(),this.hls.trigger($.MANIFEST_PARSED,N)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const s=this._levels;if(s.length===0)return;if(e<0||e>=s.length){const f=new Error("invalid level idx"),g=e<0;if(this.hls.trigger($.ERROR,{type:rt.OTHER_ERROR,details:Ne.LEVEL_SWITCH_ERROR,level:e,fatal:g,error:f,reason:f.message}),g)return;e=Math.min(e,s.length-1)}const n=this.currentLevelIndex,i=this.currentLevel,l=i?i.attrs["PATHWAY-ID"]:void 0,o=s[e],d=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,n===e&&i&&l===d)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${d?" with Pathway "+d:""} from level ${n}${l?" with Pathway "+l:""}`);const h={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger($.LEVEL_SWITCHING,h);const u=o.details;if(!u||u.live){const f=this.switchParams(o.uri,i?.details,u);this.loadPlaylist(f)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const s=this.steering.pathways(),n=e.filter(i=>s.indexOf(i)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${s}`);return}this.steering.pathwayPriority=n}}onError(e,s){s.fatal||!s.context||s.context.type===It.LEVEL&&s.context.level===this.level&&this.checkRetry(s)}onFragBuffered(e,{frag:s}){if(s!==void 0&&s.type===et.MAIN){const n=s.elementaryStreams;if(!Object.keys(n).some(l=>!!n[l]))return;const i=this._levels[s.level];i!=null&&i.loadError&&(this.log(`Resetting level error count of ${i.loadError} on frag buffered`),i.loadError=0)}}onLevelLoaded(e,s){var n;const{level:i,details:l}=s,o=s.levelInfo;if(!o){var d;this.warn(`Invalid level index ${i}`),(d=s.deliveryDirectives)!=null&&d.skip&&(l.deltaUpdateFailed=!0);return}if(o===this.currentLevel||s.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let h=o.details;h===s.details&&h.advanced&&(h=void 0),this.playlistLoaded(i,s,h)}else(n=s.deliveryDirectives)!=null&&n.skip&&(l.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,s){super.loadingPlaylist(e,s);const n=this.getUrlWithDirectives(e.uri,s),i=this.currentLevelIndex,l=e.attrs["PATHWAY-ID"],o=e.details,d=o?.age;this.log(`Loading level index ${i}${s?.msn!==void 0?" at sn "+s.msn+" part "+s.part:""}${l?" Pathway "+l:""}${d&&o.live?" age "+d.toFixed(1)+(o.type&&" "+o.type||""):""} ${n}`),this.hls.trigger($.LEVEL_LOADING,{url:n,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:s||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var s;if(this._levels.length===1)return;const n=this._levels.filter((l,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(l),l===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,l.details&&l.details.fragments.forEach(d=>d.level=-1)),!1));mS(n),this._levels=n,this.currentLevelIndex>-1&&(s=this.currentLevel)!=null&&s.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=n.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger($.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:s}){this._levels=s}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:s,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==s&&(this._maxAutoLevel=s,this.hls.trigger($.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:s,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function DN(a){const e={};a.forEach(s=>{const n=s.groupId||"";s.id=e[n]=e[n]||0,e[n]++})}function cj(){return self.SourceBuffer||self.WebKitSourceBuffer}function dj(){if(!Ar())return!1;const e=cj();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function QO(){if(!dj())return!1;const a=Ar();return typeof a?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>a.isTypeSupported(Kc(e,"video")))||["mp4a.40.2","fLaC"].some(e=>a.isTypeSupported(Kc(e,"audio"))))}function XO(){var a;const e=cj();return typeof(e==null||(a=e.prototype)==null?void 0:a.changeType)=="function"}const JO=100;class ZO extends Rp{constructor(e,s,n){super(e,s,n,"stream-controller",et.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const i=this.media,l=i?i.currentTime:null;if(l===null||!Ze(l)||(this.log(`Media seeked to ${l.toFixed(3)}`),!this.getBufferedFrag(l)))return;const o=this.getFwdBufferInfoAtPos(i,l,et.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${l} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on($.MANIFEST_PARSED,this.onManifestParsed,this),e.on($.LEVEL_LOADING,this.onLevelLoading,this),e.on($.LEVEL_LOADED,this.onLevelLoaded,this),e.on($.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on($.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on($.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on($.BUFFER_CREATED,this.onBufferCreated,this),e.on($.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on($.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off($.MANIFEST_PARSED,this.onManifestParsed,this),e.off($.LEVEL_LOADED,this.onLevelLoaded,this),e.off($.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off($.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off($.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off($.BUFFER_CREATED,this.onBufferCreated,this),e.off($.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off($.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,s){if(this.levels){const{lastCurrentTime:n,hls:i}=this;if(this.stopLoad(),this.setInterval(JO),this.level=-1,!this.startFragRequested){let l=i.startLevel;l===-1&&(i.config.testBandwidth&&this.levels.length>1?(l=0,this.bitrateTest=!0):l=i.firstAutoLevel),i.nextLoadLevel=l,this.level=i.loadLevel,this._hasEnoughToStart=!!s}n>0&&e===-1&&!s&&(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n),this.state=Be.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=s?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=Be.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case Be.WAITING_LEVEL:{const{levels:e,level:s}=this,n=e?.[s],i=n?.details;if(i&&(!i.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(i))break;this.state=Be.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=Be.IDLE;break}break}case Be.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===Be.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:s,levels:n,media:i}=this;if(s===null||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const l=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(n!=null&&n[l]))return;const o=n[l],d=this.getMainFwdBufferInfo();if(d===null)return;const h=this.getLevelDetails();if(h&&this._streamEnded(d,h)){const v={};this.altAudio===2&&(v.type="video"),this.hls.trigger($.BUFFER_EOS,v),this.state=Be.ENDED;return}if(!this.buffering)return;e.loadLevel!==l&&e.manualLevel===-1&&this.log(`Adapting to level ${l} from level ${this.level}`),this.level=e.nextLoadLevel=l;const u=o.details;if(!u||this.state===Be.WAITING_LEVEL||this.waitForLive(o)){this.level=l,this.state=Be.WAITING_LEVEL,this.startFragRequested=!1;return}const f=d.len,g=this.getMaxBufferLength(o.maxBitrate);if(f>=g)return;this.backtrackFragment&&this.backtrackFragment.start>d.end&&(this.backtrackFragment=null);const p=this.backtrackFragment?this.backtrackFragment.start:d.end;let b=this.getNextFragment(p,u);if(this.couldBacktrack&&!this.fragPrevious&&b&&Us(b)&&this.fragmentTracker.getState(b)!==Xs.OK){var y;const _=((y=this.backtrackFragment)!=null?y:b).sn-u.startSN,N=u.fragments[_-1];N&&b.cc===N.cc&&(b=N,this.fragmentTracker.removeFragment(N))}else this.backtrackFragment&&d.len&&(this.backtrackFragment=null);if(b&&this.isLoopLoading(b,p)){if(!b.gap){const _=this.audioOnly&&!this.altAudio?fs.AUDIO:fs.VIDEO,N=(_===fs.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;N&&this.afterBufferFlushed(N,_,et.MAIN)}b=this.getNextFragmentLoopLoading(b,u,d,et.MAIN,g)}b&&(b.initSegment&&!b.initSegment.data&&!this.bitrateTest&&(b=b.initSegment),this.loadFragment(b,o,p))}loadFragment(e,s,n){const i=this.fragmentTracker.getState(e);i===Xs.NOT_LOADED||i===Xs.PARTIAL?Us(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,s)):super.loadFragment(e,s,n):this._loadInitSegment(e,s):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,et.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:s}=this;if(s!=null&&s.readyState){let n;const i=this.getAppendedFrag(s.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const l=this.getLevelDetails();if(l!=null&&l.live){const d=this.getMainFwdBufferInfo();if(!d||d.len<l.targetduration*2)return}if(!s.paused&&e){const d=this.hls.nextLoadLevel,h=e[d],u=this.fragLastKbps;u&&this.fragCurrent?n=this.fragCurrent.duration*h.maxBitrate/(1e3*u)+1:n=0}else n=0;const o=this.getBufferedFrag(s.currentTime+n);if(o){const d=this.followingBufferedFrag(o);if(d){this.abortCurrentFrag();const h=d.maxStartPTS?d.maxStartPTS:d.start,u=d.duration,f=Math.max(o.end,h+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Be.KEY_LOADING:case Be.FRAG_LOADING:case Be.FRAG_LOADING_WAITING_RETRY:case Be.PARSING:case Be.PARSED:this.state=Be.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,s){super.flushMainBuffer(e,s,this.altAudio===2?"video":null)}onMediaAttached(e,s){super.onMediaAttached(e,s);const n=s.media;Na(n,"playing",this.onMediaPlaying),Na(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,s){const{media:n}=this;n&&(Pa(n,"playing",this.onMediaPlaying),Pa(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,s),!s.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger($.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,s){let n=!1,i=!1;for(let l=0;l<s.levels.length;l++){const o=s.levels[l].audioCodec;o&&(n=n||o.indexOf("mp4a.40.2")!==-1,i=i||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=n&&i&&!XO(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=s.levels,this.startFragRequested=!1}onLevelLoading(e,s){const{levels:n}=this;if(!n||this.state!==Be.IDLE)return;const i=s.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=Be.WAITING_LEVEL)}onLevelLoaded(e,s){var n;const{levels:i,startFragRequested:l}=this,o=s.level,d=s.details,h=d.totalduration;if(!i){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${d.startSN},${d.endSN}]${d.lastPartSn?`[part-${d.lastPartSn}-${d.lastPartIndex}]`:""}, cc [${d.startCC}, ${d.endCC}] duration:${h}`);const u=s.levelInfo,f=this.fragCurrent;f&&(this.state===Be.FRAG_LOADING||this.state===Be.FRAG_LOADING_WAITING_RETRY)&&f.level!==s.level&&f.loader&&this.abortCurrentFrag();let g=0;if(d.live||(n=u.details)!=null&&n.live){var p;if(this.checkLiveUpdate(d),d.deltaUpdateFailed)return;g=this.alignPlaylists(d,u.details,(p=this.levelLastLoaded)==null?void 0:p.details)}if(u.details=d,this.levelLastLoaded=u,l||this.setStartPosition(d,g),this.hls.trigger($.LEVEL_UPDATED,{details:d,level:o}),this.state===Be.WAITING_LEVEL){if(this.waitForCdnTuneIn(d))return;this.state=Be.IDLE}l&&d.live&&this.synchronizeToLiveEdge(d),this.tick()}synchronizeToLiveEdge(e){const{config:s,media:n}=this;if(!n)return;const i=this.hls.liveSyncPosition,l=this.getLoadPosition(),o=e.fragmentStart,d=e.edge,h=l>=o-s.maxFragLookUpTolerance&&l<=d;if(i!==null&&n.duration>i&&(l<i||!h)){const f=s.liveMaxLatencyDuration!==void 0?s.liveMaxLatencyDuration:s.liveMaxLatencyDurationCount*e.targetduration;if((!h&&n.readyState<4||l<d-f)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),n.readyState))if(this.warn(`Playback: ${l.toFixed(3)} is located too far from the end of live sliding playlist: ${d}, reset currentTime to : ${i.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var u;const g=St.bufferInfo(n,i,0);if(!((u=g.buffered)!=null&&u.length)){n.currentTime=i;return}if(g.start<=l){n.currentTime=i;return}const{nextStart:b}=St.bufferedInfo(g.buffered,l,0);b&&(n.currentTime=b)}else n.currentTime=i}}_handleFragmentLoadProgress(e){var s;const n=e.frag,{part:i,payload:l}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const d=o[n.level];if(!d){this.warn(`Level ${n.level} not found on progress`);return}const h=d.details;if(!h){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const u=d.videoCodec,f=h.PTSKnown||!h.live,g=(s=n.initSegment)==null?void 0:s.data,p=this._getAudioCodec(d),b=this.transmuxer=this.transmuxer||new PS(this.hls,et.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),y=i?i.index:-1,v=y!==-1,_=new Ap(n.level,n.sn,n.stats.chunkCount,l.byteLength,y,v),N=this.initPTS[n.cc];b.push(l,g,p,u,n,i,h.totalduration,f,_,N)}onAudioTrackSwitching(e,s){const n=this.hls,i=this.altAudio!==0;if(jh(s.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i){this.altAudio=0,this.fragmentTracker.removeAllFragments(),n.once($.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger($.AUDIO_TRACK_SWITCHED,s)}),n.trigger($.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}n.trigger($.AUDIO_TRACK_SWITCHED,s)}}onAudioTrackSwitched(e,s){const n=jh(s.url,this.hls);if(n){const i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,s){const n=s.tracks;let i,l,o=!1;for(const d in n){const h=n[d];if(h.id==="main"){if(l=d,i=h,d==="video"){const u=n[d];u&&(this.videoBuffer=u.buffer)}}else o=!0}o&&i?(this.log(`Alternate track found, use ${l}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,s){const{frag:n,part:i}=s,l=n.type===et.MAIN;if(l){if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===Be.PARSED&&(this.state=Be.IDLE);return}const d=i?i.stats:n.stats;this.fragLastKbps=Math.round(8*d.total/(d.buffering.end-d.loading.first)),Us(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,i)}const o=this.media;o&&(!this._hasEnoughToStart&&St.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),l&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,s){var n;if(s.fatal){this.state=Be.ERROR;return}switch(s.details){case Ne.FRAG_GAP:case Ne.FRAG_PARSING_ERROR:case Ne.FRAG_DECRYPT_ERROR:case Ne.FRAG_LOAD_ERROR:case Ne.FRAG_LOAD_TIMEOUT:case Ne.KEY_LOAD_ERROR:case Ne.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(et.MAIN,s);break;case Ne.LEVEL_LOAD_ERROR:case Ne.LEVEL_LOAD_TIMEOUT:case Ne.LEVEL_PARSING_ERROR:!s.levelRetry&&this.state===Be.WAITING_LEVEL&&((n=s.context)==null?void 0:n.type)===It.LEVEL&&(this.state=Be.IDLE);break;case Ne.BUFFER_ADD_CODEC_ERROR:case Ne.BUFFER_APPEND_ERROR:if(s.parent!=="main")return;this.reduceLengthAndFlushBuffer(s)&&this.resetLoadingState();break;case Ne.BUFFER_FULL_ERROR:if(s.parent!=="main")return;this.reduceLengthAndFlushBuffer(s)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case Ne.INTERNAL_EXCEPTION:this.recoverWorkerError(s);break}}onFragLoadEmergencyAborted(){this.state=Be.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:s}){if(s!==fs.AUDIO||!this.altAudio){const n=(s===fs.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;n&&(this.afterBufferFlushed(n,s,et.MAIN),this.tick())}}onLevelsUpdated(e,s){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=s.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const s=e.currentTime;let n=this.startPosition;if(n>=0&&s<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${s}`);return}const i=this.timelineOffset;i&&n&&(n+=i);const l=this.getLevelDetails(),o=St.getBuffered(e),d=o.length?o.start(0):0,h=d-n,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||h>0&&(h<u||this.loadingParts&&h<2*(l?.partTarget||0)))&&(this.log(`adjusting start position by ${h} to match buffer start`),n+=h,this.startPosition=n),s<n&&(this.log(`seek to target start position ${n} from current time ${s} buffer start ${d}`),e.currentTime=n)}}_getAudioCodec(e){let s=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&s&&(this.log("Swapping audio codec"),s.indexOf("mp4a.40.5")!==-1?s="mp4a.40.2":s="mp4a.40.5"),s}_loadBitrateTestFrag(e,s){e.bitrateTest=!0,this._doFragLoad(e,s).then(n=>{const{hls:i}=this,l=n?.frag;if(!l||this.fragContextChanged(l))return;s.fragmentError=0,this.state=Be.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=l.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),i.trigger($.FRAG_LOADED,n),l.bitrateTest=!1}).catch(n=>{this.state===Be.STOPPED||this.state===Be.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const s=this.playlistType,{hls:n}=this,{remuxResult:i,chunkMeta:l}=e,o=this.getCurrentContext(l);if(!o){this.resetWhenMissingContext(l);return}const{frag:d,part:h,level:u}=o,{video:f,text:g,id3:p,initSegment:b}=i,{details:y}=u,v=this.altAudio?void 0:i.audio;if(this.fragContextChanged(d)){this.fragmentTracker.removeFragment(d);return}if(this.state=Be.PARSING,b){const _=b.tracks;if(_){const L=d.initSegment||d;if(this.unhandledEncryptionError(b,d))return;this._bufferInitSegment(u,_,L,l),n.trigger($.FRAG_PARSING_INIT_SEGMENT,{frag:L,id:s,tracks:_})}const N=b.initPTS,C=b.timescale,T=this.initPTS[d.cc];if(Ze(N)&&(!T||T.baseTime!==N||T.timescale!==C)){const L=b.trackId;this.initPTS[d.cc]={baseTime:N,timescale:C,trackId:L},n.trigger($.INIT_PTS_FOUND,{frag:d,id:s,initPTS:N,timescale:C,trackId:L})}}if(f&&y){v&&f.type==="audiovideo"&&this.logMuxedErr(d);const _=y.fragments[d.sn-1-y.startSN],N=d.sn===y.startSN,C=!_||d.cc>_.cc;if(i.independent!==!1){const{startPTS:T,endPTS:L,startDTS:F,endDTS:H}=f;if(h)h.elementaryStreams[f.type]={startPTS:T,endPTS:L,startDTS:F,endDTS:H};else if(f.firstKeyFrame&&f.independent&&l.id===1&&!C&&(this.couldBacktrack=!0),f.dropped&&f.independent){const B=this.getMainFwdBufferInfo(),P=(B?B.end:this.getLoadPosition())+this.config.maxBufferHole,I=f.firstKeyFramePTS?f.firstKeyFramePTS:T;if(!N&&P<I-this.config.maxBufferHole&&!C){this.backtrack(d);return}else C&&(d.gap=!0);d.setElementaryStreamInfo(f.type,d.start,L,d.start,H,!0)}else N&&T-(y.appliedTimelineOffset||0)>ch&&(d.gap=!0);d.setElementaryStreamInfo(f.type,T,L,F,H),this.backtrackFragment&&(this.backtrackFragment=d),this.bufferFragmentData(f,d,h,l,N||C)}else if(N||C)d.gap=!0;else{this.backtrack(d);return}}if(v){const{startPTS:_,endPTS:N,startDTS:C,endDTS:T}=v;h&&(h.elementaryStreams[fs.AUDIO]={startPTS:_,endPTS:N,startDTS:C,endDTS:T}),d.setElementaryStreamInfo(fs.AUDIO,_,N,C,T),this.bufferFragmentData(v,d,h,l)}if(y&&p!=null&&p.samples.length){const _={id:s,frag:d,details:y,samples:p.samples};n.trigger($.FRAG_PARSING_METADATA,_)}if(y&&g){const _={id:s,frag:d,details:y,samples:g.samples};n.trigger($.FRAG_PARSING_USERDATA,_)}}logMuxedErr(e){this.warn(`${Us(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,s,n,i){if(this.state!==Be.PARSING)return;this.audioOnly=!!s.audio&&!s.video,this.altAudio&&!this.audioOnly&&(delete s.audio,s.audiovideo&&this.logMuxedErr(n));const{audio:l,video:o,audiovideo:d}=s;if(l){const u=e.audioCodec;let f=sh(l.codec,u);f==="mp4a"&&(f="mp4a.40.5");const g=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){f&&(f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5");const p=l.metadata;p&&"channelCount"in p&&(p.channelCount||1)!==1&&g.indexOf("firefox")===-1&&(f="mp4a.40.5")}f&&f.indexOf("mp4a.40.5")!==-1&&g.indexOf("android")!==-1&&l.container!=="audio/mpeg"&&(f="mp4a.40.2",this.log(`Android: force audio codec to ${f}`)),u&&u!==f&&this.log(`Swapping manifest audio codec "${u}" for "${f}"`),l.levelCodec=f,l.id=et.MAIN,this.log(`Init audio buffer, container:${l.container}, codecs[selected/level/parsed]=[${f||""}/${u||""}/${l.codec}]`),delete s.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=et.MAIN;const u=o.codec;if(u?.length===4)switch(u){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${o.codec!==u?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete s.audiovideo}d&&(this.log(`Init audiovideo buffer, container:${d.container}, codecs[level/parsed]=[${e.codecs}/${d.codec}]`),delete s.video,delete s.audio);const h=Object.keys(s);if(h.length){if(this.hls.trigger($.BUFFER_CODECS,s),!this.hls)return;h.forEach(u=>{const g=s[u].initSegment;g!=null&&g.byteLength&&this.hls.trigger($.BUFFER_APPENDING,{type:u,data:g,frag:n,part:null,chunkMeta:i,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,et.MAIN)}get maxBufferLength(){const{levels:e,level:s}=this,n=e?.[s];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Be.IDLE}checkFragmentChanged(){const e=this.media;let s=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(St.isBuffered(e,n)?s=this.getAppendedFrag(n):St.isBuffered(e,n+.1)&&(s=this.getAppendedFrag(n+.1)),s){this.backtrackFragment=null;const i=this.fragPlaying,l=s.level;(!i||s.sn!==i.sn||i.level!==l)&&(this.fragPlaying=s,this.hls.trigger($.FRAG_CHANGED,{frag:s}),(!i||i.level!==l)&&this.hls.trigger($.LEVEL_SWITCHED,{level:l}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const s=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Ze(s)?this.getAppendedFrag(s):null}get currentProgramDateTime(){var e;const s=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Ze(s)){const n=this.getLevelDetails(),i=this.currentFrag||(n?vl(null,n.fragments,s):null);if(i){const l=i.programDateTime;if(l!==null){const o=l+(s-i.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class e6 extends En{constructor(e,s){super("key-loader",s),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const i=this.keyIdToKeyInfo[n].loader;if(i){var s;if(e&&e!==((s=i.context)==null?void 0:s.frag.type))return;i.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const s=this.keyIdToKeyInfo[e];(s.mediaKeySessionContext||s.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const s=this.keyIdToKeyInfo[e].loader;s&&s.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,s=Ne.KEY_LOAD_ERROR,n,i,l){return new Ai({type:rt.NETWORK_ERROR,details:s,fatal:!1,frag:e,response:l,error:n,networkDetails:i})}loadClear(e,s,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(s.length)for(let i=0,l=s.length;i<l;i++){const o=s[i];if(e.cc<=o.cc&&(!Us(e)||!Us(o)||e.sn<o.sn)||!n&&i==l-1)return this.emeController.selectKeySystemFormat(o).then(d=>{if(!this.emeController)return;o.setKeyFormat(d);const h=nh(d);if(h)return this.emeController.getKeySystemAccess([h])})}if(this.config.requireKeySystemAccessOnStart){const i=Dc(this.config);if(i.length)return this.emeController.getKeySystemAccess(i)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(s=>this.loadInternal(e,s)):this.loadInternal(e)}loadInternal(e,s){var n,i;s&&e.setKeyFormat(s);const l=e.decryptdata;if(!l){const u=new Error(s?`Expected frag.decryptdata to be defined after setting format ${s}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,Ne.KEY_LOAD_ERROR,u))}const o=l.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,Ne.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const d=Fg(l);let h=this.keyIdToKeyInfo[d];if((n=h)!=null&&n.decryptdata.key)return l.key=h.decryptdata.key,Promise.resolve({frag:e,keyInfo:h});if(this.emeController&&(i=h)!=null&&i.keyLoadPromise)switch(this.emeController.getKeyStatus(h.decryptdata)){case"usable":case"usable-in-future":return h.keyLoadPromise.then(f=>{const{keyInfo:g}=f;return l.key=g.decryptdata.key,{frag:e,keyInfo:g}})}switch(this.log(`${this.keyIdToKeyInfo[d]?"Rel":"L"}oading${l.keyId?" keyId: "+ca(l.keyId):""} URI: ${l.uri} from ${e.type} ${e.level}`),h=this.keyIdToKeyInfo[d]={decryptdata:l,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},l.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return l.keyFormat==="identity"?this.loadKeyHTTP(h,e):this.loadKeyEME(h,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(h,e);default:return Promise.reject(this.createKeyLoadError(e,Ne.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${l.method}"`)))}}loadKeyEME(e,s){const n={frag:s,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var i;if(!e.decryptdata.keyId&&(i=s.initSegment)!=null&&i.data){const o=b5(s.initSegment.data);if(o.length){let d=o[0];d.some(h=>h!==0)?(this.log(`Using keyId found in init segment ${ca(d)}`),jr.setKeyIdForUri(e.decryptdata.uri,d)):(d=jr.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${ca(d)}`)),e.decryptdata.keyId=d}}if(!e.decryptdata.keyId&&!Us(s))return Promise.resolve(n);const l=this.emeController.loadKey(n);return(e.keyLoadPromise=l.then(o=>(e.mediaKeySessionContext=o,n))).catch(o=>{throw e.keyLoadPromise=null,"data"in o&&(o.data.frag=s),o})}return Promise.resolve(n)}loadKeyHTTP(e,s){const n=this.config,i=n.loader,l=new i(n);return s.keyLoader=e.loader=l,e.keyLoadPromise=new Promise((o,d)=>{const h={keyInfo:e,frag:s,responseType:"arraybuffer",url:e.decryptdata.uri},u=n.keyLoadPolicy.default,f={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(p,b,y,v)=>{const{frag:_,keyInfo:N}=y,C=Fg(N.decryptdata);if(!_.decryptdata||N!==this.keyIdToKeyInfo[C])return d(this.createKeyLoadError(_,Ne.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),v));N.decryptdata.key=_.decryptdata.key=new Uint8Array(p.data),_.keyLoader=null,N.loader=null,o({frag:_,keyInfo:N})},onError:(p,b,y,v)=>{this.resetLoader(b),d(this.createKeyLoadError(s,Ne.KEY_LOAD_ERROR,new Error(`HTTP Error ${p.code} loading key ${p.text}`),y,is({url:h.url,data:void 0},p)))},onTimeout:(p,b,y)=>{this.resetLoader(b),d(this.createKeyLoadError(s,Ne.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),y))},onAbort:(p,b,y)=>{this.resetLoader(b),d(this.createKeyLoadError(s,Ne.INTERNAL_ABORTED,new Error("key loading aborted"),y))}};l.load(h,f,g)})}resetLoader(e){const{frag:s,keyInfo:n,url:i}=e,l=n.loader;s.keyLoader===l&&(s.keyLoader=null,n.loader=null);const o=Fg(n.decryptdata)||i;delete this.keyIdToKeyInfo[o],l&&l.destroy()}}function Fg(a){if(a.keyFormat!==da.FAIRPLAY){const e=a.keyId;if(e)return ca(e)}return a.uri}function MN(a){const{type:e}=a;switch(e){case It.AUDIO_TRACK:return et.AUDIO;case It.SUBTITLE_TRACK:return et.SUBTITLE;default:return et.MAIN}}function Bg(a,e){let s=a.url;return(s===void 0||s.indexOf("data:")===0)&&(s=e.url),s}class t6{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.LEVEL_LOADING,this.onLevelLoading,this),e.on($.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on($.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on($.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.LEVEL_LOADING,this.onLevelLoading,this),e.off($.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off($.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off($.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const s=this.hls.config,n=s.pLoader,i=s.loader,l=n||i,o=new l(s);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const s=this.loaders[e];s&&s.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,s){const{url:n}=s;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:It.MANIFEST,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,s){const{id:n,level:i,pathwayId:l,url:o,deliveryDirectives:d,levelInfo:h}=s;this.load({id:n,level:i,pathwayId:l,responseType:"text",type:It.LEVEL,url:o,deliveryDirectives:d,levelOrTrack:h})}onAudioTrackLoading(e,s){const{id:n,groupId:i,url:l,deliveryDirectives:o,track:d}=s;this.load({id:n,groupId:i,level:null,responseType:"text",type:It.AUDIO_TRACK,url:l,deliveryDirectives:o,levelOrTrack:d})}onSubtitleTrackLoading(e,s){const{id:n,groupId:i,url:l,deliveryDirectives:o,track:d}=s;this.load({id:n,groupId:i,level:null,responseType:"text",type:It.SUBTITLE_TRACK,url:l,deliveryDirectives:o,levelOrTrack:d})}onLevelsUpdated(e,s){const n=this.loaders[It.LEVEL];if(n){const i=n.context;i&&!s.levels.some(l=>l===i.levelOrTrack)&&(n.abort(),delete this.loaders[It.LEVEL])}}load(e){var s;const n=this.hls.config;let i=this.getInternalLoader(e);if(i){const u=this.hls.logger,f=i.context;if(f&&f.levelOrTrack===e.levelOrTrack&&(f.url===e.url||f.deliveryDirectives&&!e.deliveryDirectives)){f.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${f.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}let l;if(e.type===It.MANIFEST?l=n.manifestLoadPolicy.default:l=ds({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),Ze((s=e.deliveryDirectives)==null?void 0:s.part)){let u;if(e.type===It.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===It.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===It.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const f=u.partTarget,g=u.targetduration;if(f&&g){const p=Math.max(f*3,g*.8)*1e3;l=ds({},l,{maxTimeToFirstByteMs:Math.min(p,l.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(p,l.maxTimeToFirstByteMs)})}}}const o=l.errorRetry||l.timeoutRetry||{},d={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},h={onSuccess:(u,f,g,p)=>{const b=this.getInternalLoader(g);this.resetInternalLoader(g.type);const y=u.data;f.parsing.start=performance.now(),Zn.isMediaPlaylist(y)||g.type!==It.MANIFEST?this.handleTrackOrLevelPlaylist(u,f,g,p||null,b):this.handleMasterPlaylist(u,f,g,p)},onError:(u,f,g,p)=>{this.handleNetworkError(f,g,!1,u,p)},onTimeout:(u,f,g)=>{this.handleNetworkError(f,g,!0,void 0,u)}};i.load(e,d,h)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:s},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${s}`),this.hls.startLoad(s))}handleMasterPlaylist(e,s,n,i){const l=this.hls,o=e.data,d=Bg(e,n),h=Zn.parseMasterPlaylist(o,d);if(h.playlistParsingError){s.parsing.end=performance.now(),this.handleManifestParsingError(e,n,h.playlistParsingError,i,s);return}const{contentSteering:u,levels:f,sessionData:g,sessionKeys:p,startTimeOffset:b,variableList:y}=h;this.variableList=y,f.forEach(C=>{const{unknownCodecs:T}=C;if(T){const{preferManagedMediaSource:L}=this.hls.config;let{audioCodec:F,videoCodec:H}=C;for(let B=T.length;B--;){const P=T[B];qc(P,"audio",L)?(C.audioCodec=F=F?`${F},${P}`:P,So.audio[F.substring(0,4)]=2,T.splice(B,1)):qc(P,"video",L)&&(C.videoCodec=H=H?`${H},${P}`:P,So.video[H.substring(0,4)]=2,T.splice(B,1))}}});const{AUDIO:v=[],SUBTITLES:_,"CLOSED-CAPTIONS":N}=Zn.parseMasterPlaylistMedia(o,d,h);v.length&&!v.some(T=>!T.url)&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),v.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Es({}),bitrate:0,url:""})),l.trigger($.MANIFEST_LOADED,{levels:f,audioTracks:v,subtitles:_,captions:N,contentSteering:u,url:d,stats:s,networkDetails:i,sessionData:g,sessionKeys:p,startTimeOffset:b,variableList:y})}handleTrackOrLevelPlaylist(e,s,n,i,l){const o=this.hls,{id:d,level:h,type:u}=n,f=Bg(e,n),g=Ze(h)?h:Ze(d)?d:0,p=MN(n),b=Zn.parseLevelPlaylist(e.data,f,g,p,0,this.variableList);if(u===It.MANIFEST){const y={attrs:new Es({}),bitrate:0,details:b,name:"",url:f};b.requestScheduled=s.loading.start+uS(b,0),o.trigger($.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:f,stats:s,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}s.parsing.end=performance.now(),n.levelDetails=b,this.handlePlaylistLoaded(b,e,s,n,i,l)}handleManifestParsingError(e,s,n,i,l){this.hls.trigger($.ERROR,{type:rt.NETWORK_ERROR,details:Ne.MANIFEST_PARSING_ERROR,fatal:s.type===It.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:s,networkDetails:i,stats:l})}handleNetworkError(e,s,n=!1,i,l){let o=`A network ${n?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===It.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===It.AUDIO_TRACK||e.type===It.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const d=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let h=Ne.UNKNOWN,u=!1;const f=this.getInternalLoader(e);switch(e.type){case It.MANIFEST:h=n?Ne.MANIFEST_LOAD_TIMEOUT:Ne.MANIFEST_LOAD_ERROR,u=!0;break;case It.LEVEL:h=n?Ne.LEVEL_LOAD_TIMEOUT:Ne.LEVEL_LOAD_ERROR,u=!1;break;case It.AUDIO_TRACK:h=n?Ne.AUDIO_TRACK_LOAD_TIMEOUT:Ne.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case It.SUBTITLE_TRACK:h=n?Ne.SUBTITLE_TRACK_LOAD_TIMEOUT:Ne.SUBTITLE_LOAD_ERROR,u=!1;break}f&&this.resetInternalLoader(e.type);const g={type:rt.NETWORK_ERROR,details:h,fatal:u,url:e.url,loader:f,context:e,error:d,networkDetails:s,stats:l};if(i){const p=s?.url||e.url;g.response=is({url:p,data:void 0},i)}this.hls.trigger($.ERROR,g)}handlePlaylistLoaded(e,s,n,i,l,o){const d=this.hls,{type:h,level:u,levelOrTrack:f,id:g,groupId:p,deliveryDirectives:b}=i,y=Bg(s,i),v=MN(i);let _=typeof i.level=="number"&&v===et.MAIN?u:void 0;const N=e.playlistParsingError;if(N){if(this.hls.logger.warn(`${N} ${e.url}`),!d.config.ignorePlaylistParsingErrors){d.trigger($.ERROR,{type:rt.NETWORK_ERROR,details:Ne.LEVEL_PARSING_ERROR,fatal:!1,url:y,error:N,reason:N.message,response:s,context:i,level:_,parent:v,networkDetails:l,stats:n});return}e.playlistParsingError=null}if(!e.fragments.length){const C=e.playlistParsingError=new Error("No Segments found in Playlist");d.trigger($.ERROR,{type:rt.NETWORK_ERROR,details:Ne.LEVEL_EMPTY_ERROR,fatal:!1,url:y,error:C,reason:C.message,response:s,context:i,level:_,parent:v,networkDetails:l,stats:n});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),h){case It.MANIFEST:case It.LEVEL:if(_){if(!f)_=0;else if(f!==d.levels[_]){const C=d.levels.indexOf(f);C>-1&&(_=C)}}d.trigger($.LEVEL_LOADED,{details:e,levelInfo:f||d.levels[0],level:_||0,id:g||0,stats:n,networkDetails:l,deliveryDirectives:b,withoutMultiVariant:h===It.MANIFEST});break;case It.AUDIO_TRACK:d.trigger($.AUDIO_TRACK_LOADED,{details:e,track:f,id:g||0,groupId:p||"",stats:n,networkDetails:l,deliveryDirectives:b});break;case It.SUBTITLE_TRACK:d.trigger($.SUBTITLE_TRACK_LOADED,{details:e,track:f,id:g||0,groupId:p||"",stats:n,networkDetails:l,deliveryDirectives:b});break}}}class Ns{static get version(){return zc}static isMSESupported(){return dj()}static isSupported(){return QO()}static getMediaSource(){return Ar()}static get Events(){return $}static get MetadataSchema(){return en}static get ErrorTypes(){return rt}static get ErrorDetails(){return Ne}static get DefaultConfig(){return Ns.defaultConfig?Ns.defaultConfig:FO}static set DefaultConfig(e){Ns.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Lp,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const s=this.logger=l5(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=UO(Ns.DefaultConfig,e,s);this.userConfig=e,n.progressive&&$O(n,s);const{abrController:i,bufferController:l,capLevelController:o,errorController:d,fpsController:h}=n,u=new d(this),f=this.abrController=new i(this),g=new sM(this),p=n.interstitialsController,b=p?this.interstitialsController=new p(this,Ns):null,y=this.bufferController=new l(this,g),v=this.capLevelController=new o(this),_=new h(this),N=new t6(this),C=n.contentSteeringController,T=C?new C(this):null,L=this.levelController=new WO(this,T),F=new zO(this),H=new e6(this.config,this.logger),B=this.streamController=new ZO(this,g,H),P=this.gapController=new KO(this,g);v.setStreamController(B),_.setStreamController(B);const I=[N,L,B];b&&I.splice(1,0,b),T&&I.splice(1,0,T),this.networkControllers=I;const D=[f,y,P,v,_,F,g];this.audioTrackController=this.createController(n.audioTrackController,I);const O=n.audioStreamController;O&&I.push(this.audioStreamController=new O(this,g,H)),this.subtitleTrackController=this.createController(n.subtitleTrackController,I);const ee=n.subtitleStreamController;ee&&I.push(this.subtititleStreamController=new ee(this,g,H)),this.createController(n.timelineController,D),H.emeController=this.emeController=this.createController(n.emeController,D),this.cmcdController=this.createController(n.cmcdController,D),this.latencyController=this.createController(YO,D),this.coreComponents=D,I.push(u);const ie=u.onErrorOut;typeof ie=="function"&&this.on($.ERROR,ie,u),this.on($.MANIFEST_LOADED,N.onManifestLoaded,N)}createController(e,s){if(e){const n=new e(this);return s&&s.push(n),n}return null}on(e,s,n=this){this._emitter.on(e,s,n)}once(e,s,n=this){this._emitter.once(e,s,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,s,n=this,i){this._emitter.off(e,s,n,i)}listeners(e){return this._emitter.listeners(e)}emit(e,s,n){return this._emitter.emit(e,s,n)}trigger(e,s){if(this.config.debug)return this.emit(e,e,s);try{return this.emit(e,e,s)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const i=e===$.ERROR;this.trigger($.ERROR,{type:rt.OTHER_ERROR,details:Ne.INTERNAL_EXCEPTION,fatal:i,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger($.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(s=>s.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(s=>s.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const l=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger($.ERROR,{type:rt.OTHER_ERROR,details:Ne.ATTACH_MEDIA_ERROR,fatal:!0,error:l});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const s="media"in e,n=s?e.media:e,i=s?e:{media:n};this._media=n,this.trigger($.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger($.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger($.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const s=this.media,n=this._url,i=this._url=_p.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),s&&n&&(n!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(s)),this.trigger($.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,s){this.logger.log(`startLoad(${e+(s?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,s),!(!this.started||!this.networkControllers));n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[et.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[et.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[et.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,s=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),s&&this.startLoad(s))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=KP()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const s=!!e;s!==this.config.capLevelToPlayerSize&&(s?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=s)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){U5(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:s}}=this;if(!e)return 0;const n=e.length;for(let i=0;i<n;i++)if(e[i].maxBitrate>=s)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:s,maxHdcpLevel:n}=this;let i;if(s===-1&&e!=null&&e.length?i=e.length-1:i=s,n)for(let l=i;l--;){const o=e[l].attrs["HDCP-LEVEL"];if(o&&o<=n)return l}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var s;return((s=this.audioTrackController)==null?void 0:s.setAudioOption(e))||null}setSubtitleOption(e){var s;return((s=this.subtitleTrackController)==null?void 0:s.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const s=this.audioTrackController;s&&(s.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const s=this.subtitleTrackController;s&&(s.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const s=this.subtitleTrackController;s&&(s.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,s=this.allAudioTracks){const n=Qw(s);return Yw(e,n,navigator.mediaCapabilities)}}Ns.defaultConfig=void 0;var Ug={exports:{}},IN;function s6(){return IN||(IN=1,(function(a,e){(function(s,n){a.exports=n()})(window,(function(){return(function(s){var n={};function i(l){if(n[l])return n[l].exports;var o=n[l]={i:l,l:!1,exports:{}};return s[l].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=s,i.c=n,i.d=function(l,o,d){i.o(l,o)||Object.defineProperty(l,o,{enumerable:!0,get:d})},i.r=function(l){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},i.t=function(l,o){if(1&o&&(l=i(l)),8&o||4&o&&typeof l=="object"&&l&&l.__esModule)return l;var d=Object.create(null);if(i.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:l}),2&o&&typeof l!="string")for(var h in l)i.d(d,h,(function(u){return l[u]}).bind(null,h));return d},i.n=function(l){var o=l&&l.__esModule?function(){return l.default}:function(){return l};return i.d(o,"a",o),o},i.o=function(l,o){return Object.prototype.hasOwnProperty.call(l,o)},i.p="",i(i.s=20)})([function(s,n,i){var l=i(9),o=i.n(l),d=(function(){function h(){}return h.e=function(u,f){u&&!h.FORCE_GLOBAL_TAG||(u=h.GLOBAL_TAG);var g="[".concat(u,"] > ").concat(f);h.ENABLE_CALLBACK&&h.emitter.emit("log","error",g),h.ENABLE_ERROR&&(console.error?console.error(g):console.warn?console.warn(g):console.log(g))},h.i=function(u,f){u&&!h.FORCE_GLOBAL_TAG||(u=h.GLOBAL_TAG);var g="[".concat(u,"] > ").concat(f);h.ENABLE_CALLBACK&&h.emitter.emit("log","info",g),h.ENABLE_INFO&&(console.info?console.info(g):console.log(g))},h.w=function(u,f){u&&!h.FORCE_GLOBAL_TAG||(u=h.GLOBAL_TAG);var g="[".concat(u,"] > ").concat(f);h.ENABLE_CALLBACK&&h.emitter.emit("log","warn",g),h.ENABLE_WARN&&(console.warn?console.warn(g):console.log(g))},h.d=function(u,f){u&&!h.FORCE_GLOBAL_TAG||(u=h.GLOBAL_TAG);var g="[".concat(u,"] > ").concat(f);h.ENABLE_CALLBACK&&h.emitter.emit("log","debug",g),h.ENABLE_DEBUG&&(console.debug?console.debug(g):console.log(g))},h.v=function(u,f){u&&!h.FORCE_GLOBAL_TAG||(u=h.GLOBAL_TAG);var g="[".concat(u,"] > ").concat(f);h.ENABLE_CALLBACK&&h.emitter.emit("log","verbose",g),h.ENABLE_VERBOSE&&console.log(g)},h})();d.GLOBAL_TAG="mpegts.js",d.FORCE_GLOBAL_TAG=!1,d.ENABLE_ERROR=!0,d.ENABLE_INFO=!0,d.ENABLE_WARN=!0,d.ENABLE_DEBUG=!0,d.ENABLE_VERBOSE=!0,d.ENABLE_CALLBACK=!1,d.emitter=new o.a,n.a=d},function(s,n,i){var l;(function(o){o.IO_ERROR="io_error",o.DEMUX_ERROR="demux_error",o.INIT_SEGMENT="init_segment",o.MEDIA_SEGMENT="media_segment",o.LOADING_COMPLETE="loading_complete",o.RECOVERED_EARLY_EOF="recovered_early_eof",o.MEDIA_INFO="media_info",o.METADATA_ARRIVED="metadata_arrived",o.SCRIPTDATA_ARRIVED="scriptdata_arrived",o.TIMED_ID3_METADATA_ARRIVED="timed_id3_metadata_arrived",o.SYNCHRONOUS_KLV_METADATA_ARRIVED="synchronous_klv_metadata_arrived",o.ASYNCHRONOUS_KLV_METADATA_ARRIVED="asynchronous_klv_metadata_arrived",o.SMPTE2038_METADATA_ARRIVED="smpte2038_metadata_arrived",o.SCTE35_METADATA_ARRIVED="scte35_metadata_arrived",o.PES_PRIVATE_DATA_DESCRIPTOR="pes_private_data_descriptor",o.PES_PRIVATE_DATA_ARRIVED="pes_private_data_arrived",o.STATISTICS_INFO="statistics_info",o.RECOMMEND_SEEKPOINT="recommend_seekpoint"})(l||(l={})),n.a=l},function(s,n,i){i.d(n,"c",(function(){return o})),i.d(n,"b",(function(){return d})),i.d(n,"a",(function(){return h}));var l=i(3),o={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},d={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},h=(function(){function u(f){this._type=f||"undefined",this._status=o.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return u.prototype.destroy=function(){this._status=o.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},u.prototype.isWorking=function(){return this._status===o.kConnecting||this._status===o.kBuffering},Object.defineProperty(u.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(f){this._onContentLengthKnown=f},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(f){this._onURLRedirect=f},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(f){this._onDataArrival=f},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"onError",{get:function(){return this._onError},set:function(f){this._onError=f},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"onComplete",{get:function(){return this._onComplete},set:function(f){this._onComplete=f},enumerable:!1,configurable:!0}),u.prototype.open=function(f,g){throw new l.c("Unimplemented abstract function!")},u.prototype.abort=function(){throw new l.c("Unimplemented abstract function!")},u})()},function(s,n,i){i.d(n,"d",(function(){return d})),i.d(n,"a",(function(){return h})),i.d(n,"b",(function(){return u})),i.d(n,"c",(function(){return f}));var l,o=(l=function(g,p){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,y){b.__proto__=y}||function(b,y){for(var v in y)Object.prototype.hasOwnProperty.call(y,v)&&(b[v]=y[v])})(g,p)},function(g,p){if(typeof p!="function"&&p!==null)throw new TypeError("Class extends value "+String(p)+" is not a constructor or null");function b(){this.constructor=g}l(g,p),g.prototype=p===null?Object.create(p):(b.prototype=p.prototype,new b)}),d=(function(){function g(p){this._message=p}return Object.defineProperty(g.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),g.prototype.toString=function(){return this.name+": "+this.message},g})(),h=(function(g){function p(b){return g.call(this,b)||this}return o(p,g),Object.defineProperty(p.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),p})(d),u=(function(g){function p(b){return g.call(this,b)||this}return o(p,g),Object.defineProperty(p.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),p})(d),f=(function(g){function p(b){return g.call(this,b)||this}return o(p,g),Object.defineProperty(p.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),p})(d)},function(s,n,i){var l;(function(o){o.ERROR="error",o.LOADING_COMPLETE="loading_complete",o.RECOVERED_EARLY_EOF="recovered_early_eof",o.MEDIA_INFO="media_info",o.METADATA_ARRIVED="metadata_arrived",o.SCRIPTDATA_ARRIVED="scriptdata_arrived",o.TIMED_ID3_METADATA_ARRIVED="timed_id3_metadata_arrived",o.SYNCHRONOUS_KLV_METADATA_ARRIVED="synchronous_klv_metadata_arrived",o.ASYNCHRONOUS_KLV_METADATA_ARRIVED="asynchronous_klv_metadata_arrived",o.SMPTE2038_METADATA_ARRIVED="smpte2038_metadata_arrived",o.SCTE35_METADATA_ARRIVED="scte35_metadata_arrived",o.PES_PRIVATE_DATA_DESCRIPTOR="pes_private_data_descriptor",o.PES_PRIVATE_DATA_ARRIVED="pes_private_data_arrived",o.STATISTICS_INFO="statistics_info",o.DESTROYING="destroying"})(l||(l={})),n.a=l},function(s,n,i){var l={};(function(){var o=self.navigator.userAgent.toLowerCase(),d=/(edge)\/([\w.]+)/.exec(o)||/(opr)[\/]([\w.]+)/.exec(o)||/(chrome)[ \/]([\w.]+)/.exec(o)||/(iemobile)[\/]([\w.]+)/.exec(o)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(o)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(o)||/(webkit)[ \/]([\w.]+)/.exec(o)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(o)||/(msie) ([\w.]+)/.exec(o)||o.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(o)||o.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(o)||[],h=/(ipad)/.exec(o)||/(ipod)/.exec(o)||/(windows phone)/.exec(o)||/(iphone)/.exec(o)||/(kindle)/.exec(o)||/(android)/.exec(o)||/(windows)/.exec(o)||/(mac)/.exec(o)||/(linux)/.exec(o)||/(cros)/.exec(o)||[],u={browser:d[5]||d[3]||d[1]||"",version:d[2]||d[4]||"0",majorVersion:d[4]||d[2]||"0",platform:h[0]||""},f={};if(u.browser){f[u.browser]=!0;var g=u.majorVersion.split(".");f.version={major:parseInt(u.majorVersion,10),string:u.version},g.length>1&&(f.version.minor=parseInt(g[1],10)),g.length>2&&(f.version.build=parseInt(g[2],10))}u.platform&&(f[u.platform]=!0),(f.chrome||f.opr||f.safari)&&(f.webkit=!0),(f.rv||f.iemobile)&&(f.rv&&delete f.rv,u.browser="msie",f.msie=!0),f.edge&&(delete f.edge,u.browser="msedge",f.msedge=!0),f.opr&&(u.browser="opera",f.opera=!0),f.safari&&f.android&&(u.browser="android",f.android=!0);for(var p in f.name=u.browser,f.platform=u.platform,l)l.hasOwnProperty(p)&&delete l[p];Object.assign(l,f)})(),n.a=l},function(s,n,i){n.a={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"}},function(s,n,i){var l;(function(o){o.ERROR="error",o.SOURCE_OPEN="source_open",o.UPDATE_END="update_end",o.BUFFER_FULL="buffer_full",o.START_STREAMING="start_streaming",o.END_STREAMING="end_streaming"})(l||(l={})),n.a=l},function(s,n,i){var l=i(9),o=i.n(l),d=i(0),h=(function(){function u(){}return Object.defineProperty(u,"forceGlobalTag",{get:function(){return d.a.FORCE_GLOBAL_TAG},set:function(f){d.a.FORCE_GLOBAL_TAG=f,u._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(u,"globalTag",{get:function(){return d.a.GLOBAL_TAG},set:function(f){d.a.GLOBAL_TAG=f,u._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(u,"enableAll",{get:function(){return d.a.ENABLE_VERBOSE&&d.a.ENABLE_DEBUG&&d.a.ENABLE_INFO&&d.a.ENABLE_WARN&&d.a.ENABLE_ERROR},set:function(f){d.a.ENABLE_VERBOSE=f,d.a.ENABLE_DEBUG=f,d.a.ENABLE_INFO=f,d.a.ENABLE_WARN=f,d.a.ENABLE_ERROR=f,u._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(u,"enableDebug",{get:function(){return d.a.ENABLE_DEBUG},set:function(f){d.a.ENABLE_DEBUG=f,u._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(u,"enableVerbose",{get:function(){return d.a.ENABLE_VERBOSE},set:function(f){d.a.ENABLE_VERBOSE=f,u._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(u,"enableInfo",{get:function(){return d.a.ENABLE_INFO},set:function(f){d.a.ENABLE_INFO=f,u._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(u,"enableWarn",{get:function(){return d.a.ENABLE_WARN},set:function(f){d.a.ENABLE_WARN=f,u._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(u,"enableError",{get:function(){return d.a.ENABLE_ERROR},set:function(f){d.a.ENABLE_ERROR=f,u._notifyChange()},enumerable:!1,configurable:!0}),u.getConfig=function(){return{globalTag:d.a.GLOBAL_TAG,forceGlobalTag:d.a.FORCE_GLOBAL_TAG,enableVerbose:d.a.ENABLE_VERBOSE,enableDebug:d.a.ENABLE_DEBUG,enableInfo:d.a.ENABLE_INFO,enableWarn:d.a.ENABLE_WARN,enableError:d.a.ENABLE_ERROR,enableCallback:d.a.ENABLE_CALLBACK}},u.applyConfig=function(f){d.a.GLOBAL_TAG=f.globalTag,d.a.FORCE_GLOBAL_TAG=f.forceGlobalTag,d.a.ENABLE_VERBOSE=f.enableVerbose,d.a.ENABLE_DEBUG=f.enableDebug,d.a.ENABLE_INFO=f.enableInfo,d.a.ENABLE_WARN=f.enableWarn,d.a.ENABLE_ERROR=f.enableError,d.a.ENABLE_CALLBACK=f.enableCallback},u._notifyChange=function(){var f=u.emitter;if(f.listenerCount("change")>0){var g=u.getConfig();f.emit("change",g)}},u.registerListener=function(f){u.emitter.addListener("change",f)},u.removeListener=function(f){u.emitter.removeListener("change",f)},u.addLogListener=function(f){d.a.emitter.addListener("log",f),d.a.emitter.listenerCount("log")>0&&(d.a.ENABLE_CALLBACK=!0,u._notifyChange())},u.removeLogListener=function(f){d.a.emitter.removeListener("log",f),d.a.emitter.listenerCount("log")===0&&(d.a.ENABLE_CALLBACK=!1,u._notifyChange())},u})();h.emitter=new o.a,n.a=h},function(s,n,i){var l,o=typeof Reflect=="object"?Reflect:null,d=o&&typeof o.apply=="function"?o.apply:function(L,F,H){return Function.prototype.apply.call(L,F,H)};l=o&&typeof o.ownKeys=="function"?o.ownKeys:Object.getOwnPropertySymbols?function(L){return Object.getOwnPropertyNames(L).concat(Object.getOwnPropertySymbols(L))}:function(L){return Object.getOwnPropertyNames(L)};var h=Number.isNaN||function(L){return L!=L};function u(){u.init.call(this)}s.exports=u,s.exports.once=function(L,F){return new Promise((function(H,B){function P(D){L.removeListener(F,I),B(D)}function I(){typeof L.removeListener=="function"&&L.removeListener("error",P),H([].slice.call(arguments))}T(L,F,I,{once:!0}),F!=="error"&&(function(D,O,ee){typeof D.on=="function"&&T(D,"error",O,ee)})(L,P,{once:!0})}))},u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var f=10;function g(L){if(typeof L!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof L)}function p(L){return L._maxListeners===void 0?u.defaultMaxListeners:L._maxListeners}function b(L,F,H,B){var P,I,D,O;if(g(H),(I=L._events)===void 0?(I=L._events=Object.create(null),L._eventsCount=0):(I.newListener!==void 0&&(L.emit("newListener",F,H.listener?H.listener:H),I=L._events),D=I[F]),D===void 0)D=I[F]=H,++L._eventsCount;else if(typeof D=="function"?D=I[F]=B?[H,D]:[D,H]:B?D.unshift(H):D.push(H),(P=p(L))>0&&D.length>P&&!D.warned){D.warned=!0;var ee=new Error("Possible EventEmitter memory leak detected. "+D.length+" "+String(F)+" listeners added. Use emitter.setMaxListeners() to increase limit");ee.name="MaxListenersExceededWarning",ee.emitter=L,ee.type=F,ee.count=D.length,O=ee,console&&console.warn&&console.warn(O)}return L}function y(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function v(L,F,H){var B={fired:!1,wrapFn:void 0,target:L,type:F,listener:H},P=y.bind(B);return P.listener=H,B.wrapFn=P,P}function _(L,F,H){var B=L._events;if(B===void 0)return[];var P=B[F];return P===void 0?[]:typeof P=="function"?H?[P.listener||P]:[P]:H?(function(I){for(var D=new Array(I.length),O=0;O<D.length;++O)D[O]=I[O].listener||I[O];return D})(P):C(P,P.length)}function N(L){var F=this._events;if(F!==void 0){var H=F[L];if(typeof H=="function")return 1;if(H!==void 0)return H.length}return 0}function C(L,F){for(var H=new Array(F),B=0;B<F;++B)H[B]=L[B];return H}function T(L,F,H,B){if(typeof L.on=="function")B.once?L.once(F,H):L.on(F,H);else{if(typeof L.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof L);L.addEventListener(F,(function P(I){B.once&&L.removeEventListener(F,P),H(I)}))}}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(L){if(typeof L!="number"||L<0||h(L))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+L+".");f=L}}),u.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(L){if(typeof L!="number"||L<0||h(L))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+L+".");return this._maxListeners=L,this},u.prototype.getMaxListeners=function(){return p(this)},u.prototype.emit=function(L){for(var F=[],H=1;H<arguments.length;H++)F.push(arguments[H]);var B=L==="error",P=this._events;if(P!==void 0)B=B&&P.error===void 0;else if(!B)return!1;if(B){var I;if(F.length>0&&(I=F[0]),I instanceof Error)throw I;var D=new Error("Unhandled error."+(I?" ("+I.message+")":""));throw D.context=I,D}var O=P[L];if(O===void 0)return!1;if(typeof O=="function")d(O,this,F);else{var ee=O.length,ie=C(O,ee);for(H=0;H<ee;++H)d(ie[H],this,F)}return!0},u.prototype.addListener=function(L,F){return b(this,L,F,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(L,F){return b(this,L,F,!0)},u.prototype.once=function(L,F){return g(F),this.on(L,v(this,L,F)),this},u.prototype.prependOnceListener=function(L,F){return g(F),this.prependListener(L,v(this,L,F)),this},u.prototype.removeListener=function(L,F){var H,B,P,I,D;if(g(F),(B=this._events)===void 0)return this;if((H=B[L])===void 0)return this;if(H===F||H.listener===F)--this._eventsCount==0?this._events=Object.create(null):(delete B[L],B.removeListener&&this.emit("removeListener",L,H.listener||F));else if(typeof H!="function"){for(P=-1,I=H.length-1;I>=0;I--)if(H[I]===F||H[I].listener===F){D=H[I].listener,P=I;break}if(P<0)return this;P===0?H.shift():(function(O,ee){for(;ee+1<O.length;ee++)O[ee]=O[ee+1];O.pop()})(H,P),H.length===1&&(B[L]=H[0]),B.removeListener!==void 0&&this.emit("removeListener",L,D||F)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(L){var F,H,B;if((H=this._events)===void 0)return this;if(H.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):H[L]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete H[L]),this;if(arguments.length===0){var P,I=Object.keys(H);for(B=0;B<I.length;++B)(P=I[B])!=="removeListener"&&this.removeAllListeners(P);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(F=H[L])=="function")this.removeListener(L,F);else if(F!==void 0)for(B=F.length-1;B>=0;B--)this.removeListener(L,F[B]);return this},u.prototype.listeners=function(L){return _(this,L,!0)},u.prototype.rawListeners=function(L){return _(this,L,!1)},u.listenerCount=function(L,F){return typeof L.listenerCount=="function"?L.listenerCount(F):N.call(L,F)},u.prototype.listenerCount=N,u.prototype.eventNames=function(){return this._eventsCount>0?l(this._events):[]}},function(s,n,i){i.d(n,"b",(function(){return d})),i.d(n,"a",(function(){return h}));var l=i(2),o=i(6),d={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},h={NETWORK_EXCEPTION:l.b.EXCEPTION,NETWORK_STATUS_CODE_INVALID:l.b.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:l.b.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:l.b.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:o.a.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:o.a.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:o.a.CODEC_UNSUPPORTED}},function(s,n,i){i.d(n,"d",(function(){return l})),i.d(n,"b",(function(){return o})),i.d(n,"a",(function(){return d})),i.d(n,"c",(function(){return h}));var l=function(u,f,g,p,b){this.dts=u,this.pts=f,this.duration=g,this.originalDts=p,this.isSyncPoint=b,this.fileposition=null},o=(function(){function u(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return u.prototype.appendSyncPoint=function(f){f.isSyncPoint=!0,this.syncPoints.push(f)},u})(),d=(function(){function u(){this._list=[]}return u.prototype.clear=function(){this._list=[]},u.prototype.appendArray=function(f){var g=this._list;f.length!==0&&(g.length>0&&f[0].originalDts<g[g.length-1].originalDts&&this.clear(),Array.prototype.push.apply(g,f))},u.prototype.getLastSyncPointBeforeDts=function(f){if(this._list.length==0)return null;var g=this._list,p=0,b=g.length-1,y=0,v=0,_=b;for(f<g[0].dts&&(p=0,v=_+1);v<=_;){if((y=v+Math.floor((_-v)/2))===b||f>=g[y].dts&&f<g[y+1].dts){p=y;break}g[y].dts<f?v=y+1:_=y-1}return this._list[p]},u})(),h=(function(){function u(f){this._type=f,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(u.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),u.prototype.isEmpty=function(){return this._list.length===0},u.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},u.prototype._searchNearestSegmentBefore=function(f){var g=this._list;if(g.length===0)return-2;var p=g.length-1,b=0,y=0,v=p,_=0;if(f<g[0].originalBeginDts)return _=-1;for(;y<=v;){if((b=y+Math.floor((v-y)/2))===p||f>g[b].lastSample.originalDts&&f<g[b+1].originalBeginDts){_=b;break}g[b].originalBeginDts<f?y=b+1:v=b-1}return _},u.prototype._searchNearestSegmentAfter=function(f){return this._searchNearestSegmentBefore(f)+1},u.prototype.append=function(f){var g=this._list,p=f,b=this._lastAppendLocation,y=0;b!==-1&&b<g.length&&p.originalBeginDts>=g[b].lastSample.originalDts&&(b===g.length-1||b<g.length-1&&p.originalBeginDts<g[b+1].originalBeginDts)?y=b+1:g.length>0&&(y=this._searchNearestSegmentBefore(p.originalBeginDts)+1),this._lastAppendLocation=y,this._list.splice(y,0,p)},u.prototype.getLastSegmentBefore=function(f){var g=this._searchNearestSegmentBefore(f);return g>=0?this._list[g]:null},u.prototype.getLastSampleBefore=function(f){var g=this.getLastSegmentBefore(f);return g!=null?g.lastSample:null},u.prototype.getLastSyncPointBefore=function(f){for(var g=this._searchNearestSegmentBefore(f),p=this._list[g].syncPoints;p.length===0&&g>0;)g--,p=this._list[g].syncPoints;return p.length>0?p[p.length-1]:null},u})()},function(s,n,i){var l=(function(){function o(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return o.prototype.isComplete=function(){var d=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,h=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&d&&h},o.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},o.prototype.getNearestKeyframe=function(d){if(this.keyframesIndex==null)return null;var h=this.keyframesIndex,u=this._search(h.times,d);return{index:u,milliseconds:h.times[u],fileposition:h.filepositions[u]}},o.prototype._search=function(d,h){var u=0,f=d.length-1,g=0,p=0,b=f;for(h<d[0]&&(u=0,p=b+1);p<=b;){if((g=p+Math.floor((b-p)/2))===f||h>=d[g]&&h<d[g+1]){u=g;break}d[g]<h?p=g+1:b=g-1}return u},o})();n.a=l},function(s,n,i){var l=i(9),o=i.n(l),d=i(0),h=i(5),u=i(12);function f(R,A,j){var w=R;if(A+j<w.length){for(;j--;)if((192&w[++A])!=128)return!1;return!0}return!1}var g,p=function(R){for(var A=[],j=R,w=0,M=R.length;w<M;)if(j[w]<128)A.push(String.fromCharCode(j[w])),++w;else{if(!(j[w]<192)){if(j[w]<224){if(f(j,w,1)&&(G=(31&j[w])<<6|63&j[w+1])>=128){A.push(String.fromCharCode(65535&G)),w+=2;continue}}else if(j[w]<240){if(f(j,w,2)&&(G=(15&j[w])<<12|(63&j[w+1])<<6|63&j[w+2])>=2048&&(63488&G)!=55296){A.push(String.fromCharCode(65535&G)),w+=3;continue}}else if(j[w]<248){var G;if(f(j,w,3)&&(G=(7&j[w])<<18|(63&j[w+1])<<12|(63&j[w+2])<<6|63&j[w+3])>65536&&G<1114112){G-=65536,A.push(String.fromCharCode(G>>>10|55296)),A.push(String.fromCharCode(1023&G|56320)),w+=4;continue}}}A.push(""),++w}return A.join("")},b=i(3),y=(g=new ArrayBuffer(2),new DataView(g).setInt16(0,256,!0),new Int16Array(g)[0]===256),v=(function(){function R(){}return R.parseScriptData=function(A,j,w){var M={};try{var G=R.parseValue(A,j,w),V=R.parseValue(A,j+G.size,w-G.size);M[G.data]=V.data}catch(Y){d.a.e("AMF",Y.toString())}return M},R.parseObject=function(A,j,w){if(w<3)throw new b.a("Data not enough when parse ScriptDataObject");var M=R.parseString(A,j,w),G=R.parseValue(A,j+M.size,w-M.size),V=G.objectEnd;return{data:{name:M.data,value:G.data},size:M.size+G.size,objectEnd:V}},R.parseVariable=function(A,j,w){return R.parseObject(A,j,w)},R.parseString=function(A,j,w){if(w<2)throw new b.a("Data not enough when parse String");var M=new DataView(A,j,w).getUint16(0,!y);return{data:M>0?p(new Uint8Array(A,j+2,M)):"",size:2+M}},R.parseLongString=function(A,j,w){if(w<4)throw new b.a("Data not enough when parse LongString");var M=new DataView(A,j,w).getUint32(0,!y);return{data:M>0?p(new Uint8Array(A,j+4,M)):"",size:4+M}},R.parseDate=function(A,j,w){if(w<10)throw new b.a("Data size invalid when parse Date");var M=new DataView(A,j,w),G=M.getFloat64(0,!y),V=M.getInt16(8,!y);return{data:new Date(G+=60*V*1e3),size:10}},R.parseValue=function(A,j,w){if(w<1)throw new b.a("Data not enough when parse Value");var M,G=new DataView(A,j,w),V=1,Y=G.getUint8(0),ne=!1;try{switch(Y){case 0:M=G.getFloat64(1,!y),V+=8;break;case 1:M=!!G.getUint8(1),V+=1;break;case 2:var se=R.parseString(A,j+1,w-1);M=se.data,V+=se.size;break;case 3:M={};var le=0;for((16777215&G.getUint32(w-4,!y))==9&&(le=3);V<w-4;){var he=R.parseObject(A,j+V,w-V-le);if(he.objectEnd)break;M[he.data.name]=he.data.value,V+=he.size}V<=w-3&&(16777215&G.getUint32(V-1,!y))===9&&(V+=3);break;case 8:for(M={},V+=4,le=0,(16777215&G.getUint32(w-4,!y))==9&&(le=3);V<w-8;){var ce=R.parseVariable(A,j+V,w-V-le);if(ce.objectEnd)break;M[ce.data.name]=ce.data.value,V+=ce.size}V<=w-3&&(16777215&G.getUint32(V-1,!y))===9&&(V+=3);break;case 9:M=void 0,V=1,ne=!0;break;case 10:M=[];var me=G.getUint32(1,!y);V+=4;for(var Te=0;Te<me;Te++){var Pe=R.parseValue(A,j+V,w-V);M.push(Pe.data),V+=Pe.size}break;case 11:var De=R.parseDate(A,j+1,w-1);M=De.data,V+=De.size;break;case 12:var Je=R.parseString(A,j+1,w-1);M=Je.data,V+=Je.size;break;default:V=w,d.a.w("AMF","Unsupported AMF value type "+Y)}}catch(Ye){d.a.e("AMF",Ye.toString())}return{data:M,size:V,objectEnd:ne}},R})(),_=(function(){function R(A){this.TAG="ExpGolomb",this._buffer=A,this._buffer_index=0,this._total_bytes=A.byteLength,this._total_bits=8*A.byteLength,this._current_word=0,this._current_word_bits_left=0}return R.prototype.destroy=function(){this._buffer=null},R.prototype._fillCurrentWord=function(){var A=this._total_bytes-this._buffer_index;if(A<=0)throw new b.a("ExpGolomb: _fillCurrentWord() but no bytes available");var j=Math.min(4,A),w=new Uint8Array(4);w.set(this._buffer.subarray(this._buffer_index,this._buffer_index+j)),this._current_word=new DataView(w.buffer).getUint32(0,!1),this._buffer_index+=j,this._current_word_bits_left=8*j},R.prototype.readBits=function(A){if(A>32)throw new b.b("ExpGolomb: readBits() bits exceeded max 32bits!");if(A<=this._current_word_bits_left){var j=this._current_word>>>32-A;return this._current_word<<=A,this._current_word_bits_left-=A,j}var w=this._current_word_bits_left?this._current_word:0;w>>>=32-this._current_word_bits_left;var M=A-this._current_word_bits_left;this._fillCurrentWord();var G=Math.min(M,this._current_word_bits_left),V=this._current_word>>>32-G;return this._current_word<<=G,this._current_word_bits_left-=G,w=w<<G|V},R.prototype.readBool=function(){return this.readBits(1)===1},R.prototype.readByte=function(){return this.readBits(8)},R.prototype._skipLeadingZero=function(){var A;for(A=0;A<this._current_word_bits_left;A++)if((this._current_word&2147483648>>>A)!=0)return this._current_word<<=A,this._current_word_bits_left-=A,A;return this._fillCurrentWord(),A+this._skipLeadingZero()},R.prototype.readUEG=function(){var A=this._skipLeadingZero();return this.readBits(A+1)-1},R.prototype.readSEG=function(){var A=this.readUEG();return 1&A?A+1>>>1:-1*(A>>>1)},R})(),N=(function(){function R(){}return R._ebsp2rbsp=function(A){for(var j=A,w=j.byteLength,M=new Uint8Array(w),G=0,V=0;V<w;V++)V>=2&&j[V]===3&&j[V-1]===0&&j[V-2]===0||(M[G]=j[V],G++);return new Uint8Array(M.buffer,0,G)},R.parseSPS=function(A){for(var j=A.subarray(1,4),w="avc1.",M=0;M<3;M++){var G=j[M].toString(16);G.length<2&&(G="0"+G),w+=G}var V=R._ebsp2rbsp(A),Y=new _(V);Y.readByte();var ne=Y.readByte();Y.readByte();var se=Y.readByte();Y.readUEG();var le=R.getProfileString(ne),he=R.getLevelString(se),ce=1,me=420,Te=8,Pe=8;if((ne===100||ne===110||ne===122||ne===244||ne===44||ne===83||ne===86||ne===118||ne===128||ne===138||ne===144)&&((ce=Y.readUEG())===3&&Y.readBits(1),ce<=3&&(me=[0,420,422,444][ce]),Te=Y.readUEG()+8,Pe=Y.readUEG()+8,Y.readBits(1),Y.readBool()))for(var De=ce!==3?8:12,Je=0;Je<De;Je++)Y.readBool()&&(Je<6?R._skipScalingList(Y,16):R._skipScalingList(Y,64));Y.readUEG();var Ye=Y.readUEG();if(Ye===0)Y.readUEG();else if(Ye===1){Y.readBits(1),Y.readSEG(),Y.readSEG();var qe=Y.readUEG();for(Je=0;Je<qe;Je++)Y.readSEG()}var ht=Y.readUEG();Y.readBits(1);var wt=Y.readUEG(),Qe=Y.readUEG(),lt=Y.readBits(1);lt===0&&Y.readBits(1),Y.readBits(1);var vt=0,dt=0,ct=0,_t=0;Y.readBool()&&(vt=Y.readUEG(),dt=Y.readUEG(),ct=Y.readUEG(),_t=Y.readUEG());var Yt=1,yt=1,Tt=0,Zt=!0,bs=0,Ga=0;if(Y.readBool()){if(Y.readBool()){var ss=Y.readByte();ss>0&&ss<16?(Yt=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][ss-1],yt=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][ss-1]):ss===255&&(Yt=Y.readByte()<<8|Y.readByte(),yt=Y.readByte()<<8|Y.readByte())}if(Y.readBool()&&Y.readBool(),Y.readBool()&&(Y.readBits(4),Y.readBool()&&Y.readBits(24)),Y.readBool()&&(Y.readUEG(),Y.readUEG()),Y.readBool()){var aa=Y.readBits(32),Zs=Y.readBits(32);Zt=Y.readBool(),Tt=(bs=Zs)/(Ga=2*aa)}}var Vs=1;Yt===1&&yt===1||(Vs=Yt/yt);var Rs=0,Vt=0;ce===0?(Rs=1,Vt=2-lt):(Rs=ce===3?1:2,Vt=(ce===1?2:1)*(2-lt));var cn=16*(wt+1),fa=16*(Qe+1)*(2-lt);cn-=(vt+dt)*Rs,fa-=(ct+_t)*Vt;var Nl=Math.ceil(cn*Vs);return Y.destroy(),Y=null,{codec_mimetype:w,profile_idc:ne,level_idc:se,profile_string:le,level_string:he,chroma_format_idc:ce,bit_depth:Te,bit_depth_luma:Te,bit_depth_chroma:Pe,ref_frames:ht,chroma_format:me,chroma_format_string:R.getChromaFormatString(me),frame_rate:{fixed:Zt,fps:Tt,fps_den:Ga,fps_num:bs},sar_ratio:{width:Yt,height:yt},codec_size:{width:cn,height:fa},present_size:{width:Nl,height:fa}}},R._skipScalingList=function(A,j){for(var w=8,M=8,G=0;G<j;G++)M!==0&&(M=(w+A.readSEG()+256)%256),w=M===0?w:M},R.getProfileString=function(A){switch(A){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},R.getLevelString=function(A){return(A/10).toFixed(1)},R.getChromaFormatString=function(A){switch(A){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},R})(),C=i(6),T=(function(){function R(){}return R._ebsp2rbsp=function(A){for(var j=A,w=j.byteLength,M=new Uint8Array(w),G=0,V=0;V<w;V++)V>=2&&j[V]===3&&j[V-1]===0&&j[V-2]===0||(M[G]=j[V],G++);return new Uint8Array(M.buffer,0,G)},R.parseVPS=function(A){var j=R._ebsp2rbsp(A),w=new _(j);return w.readByte(),w.readByte(),w.readBits(4),w.readBits(2),w.readBits(6),{num_temporal_layers:w.readBits(3)+1,temporal_id_nested:w.readBool()}},R.parseSPS=function(A){var j=R._ebsp2rbsp(A),w=new _(j);w.readByte(),w.readByte();for(var M=0,G=0,V=0,Y=0,ne=(w.readBits(4),w.readBits(3)),se=(w.readBool(),w.readBits(2)),le=w.readBool(),he=w.readBits(5),ce=w.readByte(),me=w.readByte(),Te=w.readByte(),Pe=w.readByte(),De=w.readByte(),Je=w.readByte(),Ye=w.readByte(),qe=w.readByte(),ht=w.readByte(),wt=w.readByte(),Qe=w.readByte(),lt=[],vt=[],dt=0;dt<ne;dt++)lt.push(w.readBool()),vt.push(w.readBool());if(ne>0)for(dt=ne;dt<8;dt++)w.readBits(2);for(dt=0;dt<ne;dt++)lt[dt]&&(w.readByte(),w.readByte(),w.readByte(),w.readByte(),w.readByte(),w.readByte(),w.readByte(),w.readByte(),w.readByte(),w.readByte(),w.readByte()),vt[dt]&&w.readByte();w.readUEG();var ct=w.readUEG();ct==3&&w.readBits(1);var _t=w.readUEG(),Yt=w.readUEG();w.readBool()&&(M+=w.readUEG(),G+=w.readUEG(),V+=w.readUEG(),Y+=w.readUEG());var yt=w.readUEG(),Tt=w.readUEG(),Zt=w.readUEG();for(dt=w.readBool()?0:ne;dt<=ne;dt++)w.readUEG(),w.readUEG(),w.readUEG();if(w.readUEG(),w.readUEG(),w.readUEG(),w.readUEG(),w.readUEG(),w.readUEG(),w.readBool()&&w.readBool())for(var bs=0;bs<4;bs++)for(var Ga=0;Ga<(bs===3?2:6);Ga++)if(w.readBool()){var ss=Math.min(64,1<<4+(bs<<1));for(bs>1&&w.readSEG(),dt=0;dt<ss;dt++)w.readSEG()}else w.readUEG();w.readBool(),w.readBool(),w.readBool()&&(w.readByte(),w.readUEG(),w.readUEG(),w.readBool());var aa=w.readUEG(),Zs=0;for(dt=0;dt<aa;dt++){var Vs=!1;if(dt!==0&&(Vs=w.readBool()),Vs){dt===aa&&w.readUEG(),w.readBool(),w.readUEG();for(var Rs=0,Vt=0;Vt<=Zs;Vt++){var cn=w.readBool(),fa=!1;cn||(fa=w.readBool()),(cn||fa)&&Rs++}Zs=Rs}else{var Nl=w.readUEG(),Io=w.readUEG();for(Zs=Nl+Io,Vt=0;Vt<Nl;Vt++)w.readUEG(),w.readBool();for(Vt=0;Vt<Io;Vt++)w.readUEG(),w.readBool()}}if(w.readBool()){var od=w.readUEG();for(dt=0;dt<od;dt++){for(Vt=0;Vt<Zt+4;Vt++)w.readBits(1);w.readBits(1)}}var wl=0,Dr=1,Mr=1,Ir=!1,Va=1,Pr=1;if(w.readBool(),w.readBool(),w.readBool()){if(w.readBool()){var ri=w.readByte();ri>0&&ri<=16?(Dr=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][ri-1],Mr=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][ri-1]):ri===255&&(Dr=w.readBits(16),Mr=w.readBits(16))}if(w.readBool()&&w.readBool(),w.readBool()&&(w.readBits(3),w.readBool(),w.readBool()&&(w.readByte(),w.readByte(),w.readByte())),w.readBool()&&(w.readUEG(),w.readUEG()),w.readBool(),w.readBool(),w.readBool(),w.readBool()&&(w.readUEG(),w.readUEG(),w.readUEG(),w.readUEG()),w.readBool()&&(Va=w.readBits(32),Pr=w.readBits(32),w.readBool()&&w.readUEG(),w.readBool())){var $n=!1,Gn=!1,Or=!1;for($n=w.readBool(),Gn=w.readBool(),($n||Gn)&&((Or=w.readBool())&&(w.readByte(),w.readBits(5),w.readBool(),w.readBits(5)),w.readBits(4),w.readBits(4),Or&&w.readBits(4),w.readBits(5),w.readBits(5),w.readBits(5)),dt=0;dt<=ne;dt++){var Sl=w.readBool();Ir=Sl;var Po=!0,li=1;Sl||(Po=w.readBool());var dn=!1;if(Po?w.readUEG():dn=w.readBool(),dn||(li=w.readUEG()+1),$n){for(Vt=0;Vt<li;Vt++)w.readUEG(),w.readUEG(),Or&&(w.readUEG(),w.readUEG());w.readBool()}if(Gn){for(Vt=0;Vt<li;Vt++)w.readUEG(),w.readUEG(),Or&&(w.readUEG(),w.readUEG());w.readBool()}}}w.readBool()&&(w.readBool(),w.readBool(),w.readBool(),wl=w.readUEG(),w.readUEG(),w.readUEG(),w.readUEG(),w.readUEG())}w.readBool();var Oo="hvc1.".concat(he,".1.L").concat(Qe,".B0"),Ki=_t-(M+G)*(ct===1||ct===2?2:1),kn=Yt-(V+Y)*(ct===1?2:1),jl=1;return Dr!==1&&Mr!==1&&(jl=Dr/Mr),w.destroy(),w=null,{codec_mimetype:Oo,profile_string:R.getProfileString(he),level_string:R.getLevelString(Qe),profile_idc:he,bit_depth:yt+8,ref_frames:1,chroma_format:ct,chroma_format_string:R.getChromaFormatString(ct),general_level_idc:Qe,general_profile_space:se,general_tier_flag:le,general_profile_idc:he,general_profile_compatibility_flags_1:ce,general_profile_compatibility_flags_2:me,general_profile_compatibility_flags_3:Te,general_profile_compatibility_flags_4:Pe,general_constraint_indicator_flags_1:De,general_constraint_indicator_flags_2:Je,general_constraint_indicator_flags_3:Ye,general_constraint_indicator_flags_4:qe,general_constraint_indicator_flags_5:ht,general_constraint_indicator_flags_6:wt,min_spatial_segmentation_idc:wl,constant_frame_rate:0,chroma_format_idc:ct,bit_depth_luma_minus8:yt,bit_depth_chroma_minus8:Tt,frame_rate:{fixed:Ir,fps:Pr/Va,fps_den:Va,fps_num:Pr},sar_ratio:{width:Dr,height:Mr},codec_size:{width:Ki,height:kn},present_size:{width:Ki*jl,height:kn}}},R.parsePPS=function(A){var j=R._ebsp2rbsp(A),w=new _(j);w.readByte(),w.readByte(),w.readUEG(),w.readUEG(),w.readBool(),w.readBool(),w.readBits(3),w.readBool(),w.readBool(),w.readUEG(),w.readUEG(),w.readSEG(),w.readBool(),w.readBool(),w.readBool()&&w.readUEG(),w.readSEG(),w.readSEG(),w.readBool(),w.readBool(),w.readBool(),w.readBool();var M=w.readBool(),G=w.readBool(),V=1;return G&&M?V=0:G?V=3:M&&(V=2),{parallelismType:V}},R.getChromaFormatString=function(A){switch(A){case 0:return"4:0:0";case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}},R.getProfileString=function(A){switch(A){case 1:return"Main";case 2:return"Main10";case 3:return"MainSP";case 4:return"Rext";case 9:return"SCC";default:return"Unknown"}},R.getLevelString=function(A){return(A/30).toFixed(1)},R})();function L(R){return R.byteOffset%2==0&&R.byteLength%2==0}function F(R){return R.byteOffset%4==0&&R.byteLength%4==0}function H(R,A){for(var j=0;j<R.length;j++)if(R[j]!==A[j])return!1;return!0}var B=function(R,A){return R.byteLength===A.byteLength&&(F(R)&&F(A)?(function(j,w){return H(new Uint32Array(j.buffer,j.byteOffset,j.byteLength/4),new Uint32Array(w.buffer,w.byteOffset,w.byteLength/4))})(R,A):L(R)&&L(A)?(function(j,w){return H(new Uint16Array(j.buffer,j.byteOffset,j.byteLength/2),new Uint16Array(w.buffer,w.byteOffset,w.byteLength/2))})(R,A):(function(j,w){return H(j,w)})(R,A))},P=function(){return(P=Object.assign||function(R){for(var A,j=1,w=arguments.length;j<w;j++)for(var M in A=arguments[j])Object.prototype.hasOwnProperty.call(A,M)&&(R[M]=A[M]);return R}).apply(this,arguments)},I=(function(){function R(){}return R.parseOBUs=function(A,j){for(var w=0;w<A.byteLength;){var M=w,G=(A[w],(120&A[w])>>3),V=(4&A[w])!=0,Y=(2&A[w])!=0;A[w],w+=1,V&&(w+=1);var ne=Number.POSITIVE_INFINITY;if(Y){ne=0;for(var se=0;;se++){var le=A[w++];if(ne|=(127&le)<<7*se,(128&le)==0)break}}console.log(G),G===1?j=P(P({},R.parseSeuqneceHeader(A.subarray(w,w+ne))),{sequence_header_data:A.subarray(M,w+ne)}):(G==3&&j||G==6&&j)&&(j=R.parseOBUFrameHeader(A.subarray(w,w+ne),0,0,j)),w+=ne}return j},R.parseSeuqneceHeader=function(A){var j=new _(A),w=j.readBits(3),M=(j.readBool(),j.readBool()),G=!0,V=0,Y=1,ne=void 0,se=[];if(M)se.push({operating_point_idc:0,level:j.readBits(5),tier:0});else{if(j.readBool()){var le=j.readBits(32),he=j.readBits(32),ce=j.readBool();if(ce){for(var me=0;j.readBits(1)===0;)me+=1;me>=32||(1<<me)-1+j.readBits(me)}(V=he)/(Y=le),G=ce,j.readBool()&&(j.readBits(5),j.readBits(32),ne=j.readBits(5),j.readBits(5))}for(var Te=j.readBool(),Pe=j.readBits(5),De=0;De<=Pe;De++){var Je=j.readBits(12),Ye=j.readBits(5),qe=Ye>7?j.readBits(1):0;se.push({operating_point_idc:Je,level:Ye,tier:qe}),Te&&j.readBool()&&j.readBits(4)}}var ht=se[0],wt=ht.level,Qe=ht.tier,lt=j.readBits(4),vt=j.readBits(4),dt=j.readBits(lt+1)+1,ct=j.readBits(vt+1)+1,_t=!1;M||(_t=j.readBool()),_t&&(j.readBits(4),j.readBits(4)),j.readBool(),j.readBool(),j.readBool();var Yt=!1,yt=2,Tt=2,Zt=0;M||(j.readBool(),j.readBool(),j.readBool(),j.readBool(),(Yt=j.readBool())&&(j.readBool(),j.readBool()),(yt=j.readBool()?2:j.readBits(1))?Tt=j.readBool()?2:j.readBits(1):Tt=2,Yt?Zt=j.readBits(3)+1:Zt=0);var bs=j.readBool(),Ga=(j.readBool(),j.readBool(),j.readBool()),ss=8;w===2&&Ga?ss=j.readBool()?12:10:ss=Ga?10:8;var aa=!1;w!==1&&(aa=j.readBool()),j.readBool()&&(j.readBits(8),j.readBits(8),j.readBits(8));var Zs=1,Vs=1;return aa?(j.readBits(1),Zs=1,Vs=1):(j.readBits(1),w==0?(Zs=1,Vs=1):w==1?(Zs=0,Vs=0):ss==12?j.readBits(1)&&j.readBits(1):(Zs=1,Vs=0),Zs&&Vs&&j.readBits(2),j.readBits(1)),j.readBool(),j.destroy(),j=null,{codec_mimetype:"av01.".concat(w,".").concat(R.getLevelString(wt,Qe),".").concat(ss.toString(10).padStart(2,"0")),level:wt,tier:Qe,level_string:R.getLevelString(wt,Qe),profile_idc:w,profile_string:"".concat(w),bit_depth:ss,ref_frames:1,chroma_format:R.getChromaFormat(aa,Zs,Vs),chroma_format_string:R.getChromaFormatString(aa,Zs,Vs),sequence_header:{frame_id_numbers_present_flag:_t,additional_frame_id_length_minus_1:void 0,delta_frame_id_length_minus_2:void 0,reduced_still_picture_header:M,decoder_model_info_present_flag:!1,operating_points:se,buffer_removal_time_length_minus_1:ne,equal_picture_interval:G,seq_force_screen_content_tools:yt,seq_force_integer_mv:Tt,enable_order_hint:Yt,order_hint_bits:Zt,enable_superres:bs,frame_width_bit:lt+1,frame_height_bit:vt+1,max_frame_width:dt,max_frame_height:ct},keyframe:void 0,frame_rate:{fixed:G,fps:V/Y,fps_den:Y,fps_num:V}}},R.parseOBUFrameHeader=function(A,j,w,M){var G=M.sequence_header,V=new _(A),Y=(G.max_frame_width,G.max_frame_height,0);G.frame_id_numbers_present_flag&&(Y=G.additional_frame_id_length_minus_1+G.delta_frame_id_length_minus_2+3);var ne=0,se=!0,le=!0,he=!1;if(!G.reduced_still_picture_header){if(V.readBool())return M;se=(ne=V.readBits(2))===2||ne===0,(le=V.readBool())&&G.decoder_model_info_present_flag&&G.equal_picture_interval,le&&V.readBool(),he=!!(ne===3||ne===0&&le)||V.readBool()}M.keyframe=se,V.readBool();var ce=G.seq_force_screen_content_tools;G.seq_force_screen_content_tools===2&&(ce=V.readBits(1)),ce&&(G.seq_force_integer_mv,G.seq_force_integer_mv==2&&V.readBits(1)),G.frame_id_numbers_present_flag&&V.readBits(Y);var me=!1;if(me=ne==3||!G.reduced_still_picture_header&&V.readBool(),V.readBits(G.order_hint_bits),se||he||V.readBits(3),G.decoder_model_info_present_flag&&V.readBool()){for(var Te=0;Te<=G.operating_points_cnt_minus_1;Te++)if(G.operating_points[Te].decoder_model_present_for_this_op[Te]){var Pe=G.operating_points[Te].operating_point_idc;(Pe===0||Pe>>j&1&&Pe>>w+8&1)&&V.readBits(G.buffer_removal_time_length_minus_1+1)}}var De=255;if(ne===3||ne==0&&le||(De=V.readBits(8)),(se||De!==255)&&he&&G.enable_order_hint)for(var Je=0;Je<8;Je++)V.readBits(G.order_hint_bits);if(se){var Ye=R.frameSizeAndRenderSize(V,me,G);M.codec_size={width:Ye.FrameWidth,height:Ye.FrameHeight},M.present_size={width:Ye.RenderWidth,height:Ye.RenderHeight},M.sar_ratio={width:Ye.RenderWidth/Ye.FrameWidth,height:Ye.RenderHeight/Ye.FrameHeight}}return V.destroy(),V=null,M},R.frameSizeAndRenderSize=function(A,j,w){var M=w.max_frame_width,G=w.max_frame_height;j&&(M=A.readBits(w.frame_width_bit)+1,G=A.readBits(w.frame_height_bit)+1);var V=!1;w.enable_superres&&(V=A.readBool());var Y=8;V&&(Y=A.readBits(3)+9);var ne=M;M=Math.floor((8*ne+Y/2)/Y);var se=ne,le=G;if(A.readBool()){var he=A.readBits(16)+1,ce=A.readBits(16)+1;se=A.readBits(he)+1,le=A.readBits(ce)+1}return{UpscaledWidth:ne,FrameWidth:M,FrameHeight:G,RenderWidth:se,RenderHeight:le}},R.getLevelString=function(A,j){return"".concat(A.toString(10).padStart(2,"0")).concat(j===0?"M":"H")},R.getChromaFormat=function(A,j,w){return A?0:j===0&&w===0?3:j===1&&w===0?2:j===1&&w===1?1:Number.NaN},R.getChromaFormatString=function(A,j,w){return A?"4:0:0":j===0&&w===0?"4:4:4":j===1&&w===0?"4:2:2":j===1&&w===1?"4:2:0":"Unknown"},R})(),D,O=(function(){function R(A,j){this.TAG="FLVDemuxer",this._config=j,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=A.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=A.hasAudioTrack,this._hasVideo=A.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new u.a,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=(function(){var w=new ArrayBuffer(2);return new DataView(w).setInt16(0,256,!0),new Int16Array(w)[0]===256})()}return R.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},R.probe=function(A){var j=new Uint8Array(A);if(j.byteLength<9)return{needMoreData:!0};var w={match:!1};if(j[0]!==70||j[1]!==76||j[2]!==86||j[3]!==1)return w;var M,G,V=(4&j[4])>>>2!=0,Y=(1&j[4])!=0,ne=(M=j)[G=5]<<24|M[G+1]<<16|M[G+2]<<8|M[G+3];return ne<9?w:{match:!0,consumed:ne,dataOffset:ne,hasAudioTrack:V,hasVideoTrack:Y}},R.prototype.bindDataSource=function(A){return A.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(R.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(A){this._onTrackMetadata=A},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(A){this._onMediaInfo=A},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(A){this._onMetaDataArrived=A},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(A){this._onScriptDataArrived=A},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"onError",{get:function(){return this._onError},set:function(A){this._onError=A},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(A){this._onDataAvailable=A},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(A){this._timestampBase=A},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"overridedDuration",{get:function(){return this._duration},set:function(A){this._durationOverrided=!0,this._duration=A,this._mediaInfo.duration=A},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"overridedHasAudio",{set:function(A){this._hasAudioFlagOverrided=!0,this._hasAudio=A,this._mediaInfo.hasAudio=A},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"overridedHasVideo",{set:function(A){this._hasVideoFlagOverrided=!0,this._hasVideo=A,this._mediaInfo.hasVideo=A},enumerable:!1,configurable:!0}),R.prototype.resetMediaInfo=function(){this._mediaInfo=new u.a},R.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched},R.prototype.parseChunks=function(A,j){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new b.a("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var w=0,M=this._littleEndian;if(j===0){if(!(A.byteLength>13))return 0;w=R.probe(A).dataOffset}for(this._firstParse&&(this._firstParse=!1,j+w!==this._dataOffset&&d.a.w(this.TAG,"First time parsing but chunk byteStart invalid!"),(G=new DataView(A,w)).getUint32(0,!M)!==0&&d.a.w(this.TAG,"PrevTagSize0 !== 0 !!!"),w+=4);w<A.byteLength;){this._dispatch=!0;var G=new DataView(A,w);if(w+11+4>A.byteLength)break;var V=G.getUint8(0),Y=16777215&G.getUint32(0,!M);if(w+11+Y+4>A.byteLength)break;if(V===8||V===9||V===18){var ne=G.getUint8(4),se=G.getUint8(5),le=G.getUint8(6)|se<<8|ne<<16|G.getUint8(7)<<24;(16777215&G.getUint32(7,!M))!==0&&d.a.w(this.TAG,"Meet tag which has StreamID != 0!");var he=w+11;switch(V){case 8:this._parseAudioData(A,he,Y,le);break;case 9:this._parseVideoData(A,he,Y,le,j+w);break;case 18:this._parseScriptData(A,he,Y)}var ce=G.getUint32(11+Y,!M);ce!==11+Y&&d.a.w(this.TAG,"Invalid PrevTagSize ".concat(ce)),w+=11+Y+4}else d.a.w(this.TAG,"Unsupported tag type ".concat(V,", skipped")),w+=11+Y+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),w},R.prototype._parseScriptData=function(A,j,w){var M=v.parseScriptData(A,j,w);if(M.hasOwnProperty("onMetaData")){if(M.onMetaData==null||typeof M.onMetaData!="object")return void d.a.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&d.a.w(this.TAG,"Found another onMetaData tag!"),this._metadata=M;var G=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},G)),typeof G.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=G.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof G.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=G.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof G.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=G.audiodatarate),typeof G.videodatarate=="number"&&(this._mediaInfo.videoDataRate=G.videodatarate),typeof G.width=="number"&&(this._mediaInfo.width=G.width),typeof G.height=="number"&&(this._mediaInfo.height=G.height),typeof G.duration=="number"){if(!this._durationOverrided){var V=Math.floor(G.duration*this._timescale);this._duration=V,this._mediaInfo.duration=V}}else this._mediaInfo.duration=0;if(typeof G.framerate=="number"){var Y=Math.floor(1e3*G.framerate);if(Y>0){var ne=Y/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=ne,this._referenceFrameRate.fps_num=Y,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=ne}}if(typeof G.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var se=G.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(se),G.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=G,d.a.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(M).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},M))},R.prototype._parseKeyframesIndex=function(A){for(var j=[],w=[],M=1;M<A.times.length;M++){var G=this._timestampBase+Math.floor(1e3*A.times[M]);j.push(G),w.push(A.filepositions[M])}return{times:j,filepositions:w}},R.prototype._parseAudioData=function(A,j,w,M){if(w<=1)d.a.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else if(this._hasAudioFlagOverrided!==!0||this._hasAudio!==!1){this._littleEndian;var G=new DataView(A,j,w).getUint8(0),V=G>>>4;if(V!==9)if(V===2||V===10){var Y=0,ne=(12&G)>>>2;if(ne>=0&&ne<=4){Y=this._flvSoundRateTable[ne];var se=1&G,le=this._audioMetadata,he=this._audioTrack;if(le||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(le=this._audioMetadata={}).type="audio",le.id=he.id,le.timescale=this._timescale,le.duration=this._duration,le.audioSampleRate=Y,le.channelCount=se===0?1:2),V===10){var ce=this._parseAACAudioData(A,j+1,w-1);if(ce==null)return;if(ce.packetType===0){if(le.config){if(B(ce.data.config,le.config))return;d.a.w(this.TAG,"AudioSpecificConfig has been changed, re-generate initialization segment")}var me=ce.data;le.audioSampleRate=me.samplingRate,le.channelCount=me.channelCount,le.codec=me.codec,le.originalCodec=me.originalCodec,le.config=me.config,le.refSampleDuration=1024/le.audioSampleRate*le.timescale,d.a.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",le),(De=this._mediaInfo).audioCodec=le.originalCodec,De.audioSampleRate=le.audioSampleRate,De.audioChannelCount=le.channelCount,De.hasVideo?De.videoCodec!=null&&(De.mimeType='video/x-flv; codecs="'+De.videoCodec+","+De.audioCodec+'"'):De.mimeType='video/x-flv; codecs="'+De.audioCodec+'"',De.isComplete()&&this._onMediaInfo(De)}else if(ce.packetType===1){var Te=this._timestampBase+M,Pe={unit:ce.data,length:ce.data.byteLength,dts:Te,pts:Te};he.samples.push(Pe),he.length+=ce.data.length}else d.a.e(this.TAG,"Flv: Unsupported AAC data type ".concat(ce.packetType))}else if(V===2){if(!le.codec){var De;if((me=this._parseMP3AudioData(A,j+1,w-1,!0))==null)return;le.audioSampleRate=me.samplingRate,le.channelCount=me.channelCount,le.codec=me.codec,le.originalCodec=me.originalCodec,le.refSampleDuration=1152/le.audioSampleRate*le.timescale,d.a.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",le),(De=this._mediaInfo).audioCodec=le.codec,De.audioSampleRate=le.audioSampleRate,De.audioChannelCount=le.channelCount,De.audioDataRate=me.bitRate,De.hasVideo?De.videoCodec!=null&&(De.mimeType='video/x-flv; codecs="'+De.videoCodec+","+De.audioCodec+'"'):De.mimeType='video/x-flv; codecs="'+De.audioCodec+'"',De.isComplete()&&this._onMediaInfo(De)}var Je=this._parseMP3AudioData(A,j+1,w-1,!1);if(Je==null)return;Te=this._timestampBase+M;var Ye={unit:Je,length:Je.byteLength,dts:Te,pts:Te};he.samples.push(Ye),he.length+=Je.length}}else this._onError(C.a.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+ne)}else this._onError(C.a.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+V);else{if(w<=5)return void d.a.w(this.TAG,"Flv: Invalid audio packet, missing AudioFourCC in Ehnanced FLV payload!");var qe=15&G,ht=String.fromCharCode.apply(String,new Uint8Array(A,j,w).slice(1,5));switch(ht){case"Opus":this._parseOpusAudioPacket(A,j+5,w-5,M,qe);break;case"fLaC":this._parseFlacAudioPacket(A,j+5,w-5,M,qe);break;default:this._onError(C.a.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec: "+ht)}}}},R.prototype._parseAACAudioData=function(A,j,w){if(!(w<=1)){var M={},G=new Uint8Array(A,j,w);return M.packetType=G[0],G[0]===0?M.data=this._parseAACAudioSpecificConfig(A,j+1,w-1):M.data=G.subarray(1),M}d.a.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")},R.prototype._parseAACAudioSpecificConfig=function(A,j,w){var M,G,V=new Uint8Array(A,j,w),Y=null,ne=0,se=null;if(ne=M=V[0]>>>3,(G=(7&V[0])<<1|V[1]>>>7)<0||G>=this._mpegSamplingRates.length)this._onError(C.a.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var le=this._mpegSamplingRates[G],he=(120&V[1])>>>3;if(!(he<0||he>=8)){ne===5&&(se=(7&V[1])<<1|V[2]>>>7,(124&V[2])>>>2);var ce=self.navigator.userAgent.toLowerCase();return ce.indexOf("firefox")!==-1?G>=6?(ne=5,Y=new Array(4),se=G-3):(ne=2,Y=new Array(2),se=G):ce.indexOf("android")!==-1?(ne=2,Y=new Array(2),se=G):(ne=5,se=G,Y=new Array(4),G>=6?se=G-3:he===1&&(ne=2,Y=new Array(2),se=G)),Y[0]=ne<<3,Y[0]|=(15&G)>>>1,Y[1]=(15&G)<<7,Y[1]|=(15&he)<<3,ne===5&&(Y[1]|=(15&se)>>>1,Y[2]=(1&se)<<7,Y[2]|=8,Y[3]=0),{config:Y,samplingRate:le,channelCount:he,codec:"mp4a.40."+ne,originalCodec:"mp4a.40."+M}}this._onError(C.a.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}},R.prototype._parseMP3AudioData=function(A,j,w,M){if(!(w<4)){this._littleEndian;var G=new Uint8Array(A,j,w),V=null;if(M){if(G[0]!==255)return;var Y=G[1]>>>3&3,ne=(6&G[1])>>1,se=(240&G[2])>>>4,le=(12&G[2])>>>2,he=(G[3]>>>6&3)!==3?2:1,ce=0,me=0;switch(Y){case 0:ce=this._mpegAudioV25SampleRateTable[le];break;case 2:ce=this._mpegAudioV20SampleRateTable[le];break;case 3:ce=this._mpegAudioV10SampleRateTable[le]}switch(ne){case 1:se<this._mpegAudioL3BitRateTable.length&&(me=this._mpegAudioL3BitRateTable[se]);break;case 2:se<this._mpegAudioL2BitRateTable.length&&(me=this._mpegAudioL2BitRateTable[se]);break;case 3:se<this._mpegAudioL1BitRateTable.length&&(me=this._mpegAudioL1BitRateTable[se])}V={bitRate:me,samplingRate:ce,channelCount:he,codec:"mp3",originalCodec:"mp3"}}else V=G;return V}d.a.w(this.TAG,"Flv: Invalid MP3 packet, header missing!")},R.prototype._parseOpusAudioPacket=function(A,j,w,M,G){if(G===0)this._parseOpusSequenceHeader(A,j,w);else if(G===1)this._parseOpusAudioData(A,j,w,M);else if(G!==2)return void this._onError(C.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(G))},R.prototype._parseOpusSequenceHeader=function(A,j,w){if(w<=16)d.a.w(this.TAG,"Flv: Invalid OpusSequenceHeader, lack of data!");else{var M=this._audioMetadata,G=this._audioTrack;M||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(M=this._audioMetadata={}).type="audio",M.id=G.id,M.timescale=this._timescale,M.duration=this._duration);var V=new DataView(A,j,w);V.setUint8(8,0);var Y=V.getUint8(9);V.setUint16(10,V.getUint16(10,!0),!1);var ne=V.getUint32(12,!0);V.setUint32(12,V.getUint32(12,!0),!1);var se={config:new Uint8Array(A,j+8,w-8),channelCount:Y,samplingFrequence:ne,codec:"opus",originalCodec:"opus"};if(M.config){if(B(se.config,M.config))return;d.a.w(this.TAG,"OpusSequenceHeader has been changed, re-generate initialization segment")}M.audioSampleRate=se.samplingFrequence,M.channelCount=se.channelCount,M.codec=se.codec,M.originalCodec=se.originalCodec,M.config=se.config,M.refSampleDuration=20,d.a.v(this.TAG,"Parsed OpusSequenceHeader"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",M);var le=this._mediaInfo;le.audioCodec=M.originalCodec,le.audioSampleRate=M.audioSampleRate,le.audioChannelCount=M.channelCount,le.hasVideo?le.videoCodec!=null&&(le.mimeType='video/x-flv; codecs="'+le.videoCodec+","+le.audioCodec+'"'):le.mimeType='video/x-flv; codecs="'+le.audioCodec+'"',le.isComplete()&&this._onMediaInfo(le)}},R.prototype._parseOpusAudioData=function(A,j,w,M){var G=this._audioTrack,V=new Uint8Array(A,j,w),Y=this._timestampBase+M,ne={unit:V,length:V.byteLength,dts:Y,pts:Y};G.samples.push(ne),G.length+=V.length},R.prototype._parseFlacAudioPacket=function(A,j,w,M,G){if(G===0)this._parseFlacSequenceHeader(A,j,w);else if(G===1)this._parseFlacAudioData(A,j,w,M);else if(G!==2)return void this._onError(C.a.FORMAT_ERROR,"Flv: Invalid Flac audio packet type ".concat(G))},R.prototype._parseFlacSequenceHeader=function(A,j,w){var M=this._audioMetadata,G=this._audioTrack;M||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(M=this._audioMetadata={}).type="audio",M.id=G.id,M.timescale=this._timescale,M.duration=this._duration);var V=new Uint8Array(A,j+4,w-4),Y=new _(V),ne=Y.readBits(16),se=Y.readBits(16),le=se===ne?se:null;Y.readBits(24),Y.readBits(24);var he=Y.readBits(20),ce=Y.readBits(3)+1,me=Y.readBits(5)+1;Y.destroy();var Te=new Uint8Array(V.byteLength+4);Te.set(V,4),Te[0]=128,Te[1]=V.byteLength>>>16&255,Te[2]=V.byteLength>>>8&255,Te[3]=V.byteLength>>>0&255;var Pe={config:Te,channelCount:ce,samplingFrequence:he,sampleSize:me,codec:"flac",originalCodec:"flac"};if(M.config){if(B(Pe.config,M.config))return;d.a.w(this.TAG,"FlacSequenceHeader has been changed, re-generate initialization segment")}M.audioSampleRate=Pe.samplingFrequence,M.channelCount=Pe.channelCount,M.sampleSize=Pe.sampleSize,M.codec=Pe.codec,M.originalCodec=Pe.originalCodec,M.config=Pe.config,M.refSampleDuration=le!=null?1e3*le/Pe.samplingFrequence:null,d.a.v(this.TAG,"Parsed FlacSequenceHeader"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",M);var De=this._mediaInfo;De.audioCodec=M.originalCodec,De.audioSampleRate=M.audioSampleRate,De.audioChannelCount=M.channelCount,De.hasVideo?De.videoCodec!=null&&(De.mimeType='video/x-flv; codecs="'+De.videoCodec+","+De.audioCodec+'"'):De.mimeType='video/x-flv; codecs="'+De.audioCodec+'"',De.isComplete()&&this._onMediaInfo(De)},R.prototype._parseFlacAudioData=function(A,j,w,M){var G=this._audioTrack,V=new Uint8Array(A,j,w),Y=this._timestampBase+M,ne={unit:V,length:V.byteLength,dts:Y,pts:Y};G.samples.push(ne),G.length+=V.length},R.prototype._parseVideoData=function(A,j,w,M,G){if(w<=1)d.a.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else if(this._hasVideoFlagOverrided!==!0||this._hasVideo!==!1){var V=new Uint8Array(A,j,w)[0],Y=(112&V)>>>4;if((128&V)!=0){var ne=15&V,se=String.fromCharCode.apply(String,new Uint8Array(A,j,w).slice(1,5));if(se==="hvc1")this._parseEnhancedHEVCVideoPacket(A,j+5,w-5,M,G,Y,ne);else{if(se!=="av01")return void this._onError(C.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: ".concat(se));this._parseEnhancedAV1VideoPacket(A,j+5,w-5,M,G,Y,ne)}}else{var le=15&V;if(le===7)this._parseAVCVideoPacket(A,j+1,w-1,M,G,Y);else{if(le!==12)return void this._onError(C.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: ".concat(le));this._parseHEVCVideoPacket(A,j+1,w-1,M,G,Y)}}}},R.prototype._parseAVCVideoPacket=function(A,j,w,M,G,V){if(w<4)d.a.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var Y=this._littleEndian,ne=new DataView(A,j,w),se=ne.getUint8(0),le=(16777215&ne.getUint32(0,!Y))<<8>>8;if(se===0)this._parseAVCDecoderConfigurationRecord(A,j+4,w-4);else if(se===1)this._parseAVCVideoData(A,j+4,w-4,M,G,V,le);else if(se!==2)return void this._onError(C.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(se))}},R.prototype._parseHEVCVideoPacket=function(A,j,w,M,G,V){if(w<4)d.a.w(this.TAG,"Flv: Invalid HEVC packet, missing HEVCPacketType or/and CompositionTime");else{var Y=this._littleEndian,ne=new DataView(A,j,w),se=ne.getUint8(0),le=(16777215&ne.getUint32(0,!Y))<<8>>8;if(se===0)this._parseHEVCDecoderConfigurationRecord(A,j+4,w-4);else if(se===1)this._parseHEVCVideoData(A,j+4,w-4,M,G,V,le);else if(se!==2)return void this._onError(C.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(se))}},R.prototype._parseEnhancedHEVCVideoPacket=function(A,j,w,M,G,V,Y){var ne=this._littleEndian,se=new DataView(A,j,w);if(Y===0)this._parseHEVCDecoderConfigurationRecord(A,j,w);else if(Y===1){var le=(4294967040&se.getUint32(0,!ne))>>8;this._parseHEVCVideoData(A,j+3,w-3,M,G,V,le)}else if(Y===3)this._parseHEVCVideoData(A,j,w,M,G,V,0);else if(Y!==2)return void this._onError(C.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(Y))},R.prototype._parseEnhancedAV1VideoPacket=function(A,j,w,M,G,V,Y){if(this._littleEndian,Y===0)this._parseAV1CodecConfigurationRecord(A,j,w);else if(Y===1)this._parseAV1VideoData(A,j,w,M,G,V,0);else{if(Y===5)return void this._onError(C.a.FORMAT_ERROR,"Flv: Not Supported MP2T AV1 video packet type ".concat(Y));if(Y!==2)return void this._onError(C.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(Y))}},R.prototype._parseAVCDecoderConfigurationRecord=function(A,j,w){if(w<7)d.a.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var M=this._videoMetadata,G=this._videoTrack,V=this._littleEndian,Y=new DataView(A,j,w);if(M){if(M.avcc!==void 0){var ne=new Uint8Array(A,j,w);if(B(ne,M.avcc))return;d.a.w(this.TAG,"AVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(M=this._videoMetadata={}).type="video",M.id=G.id,M.timescale=this._timescale,M.duration=this._duration;var se=Y.getUint8(0),le=Y.getUint8(1);if(Y.getUint8(2),Y.getUint8(3),se===1&&le!==0)if(this._naluLengthSize=1+(3&Y.getUint8(4)),this._naluLengthSize===3||this._naluLengthSize===4){var he=31&Y.getUint8(5);if(he!==0){he>1&&d.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = ".concat(he));for(var ce=6,me=0;me<he;me++){var Te=Y.getUint16(ce,!V);if(ce+=2,Te!==0){var Pe=new Uint8Array(A,j+ce,Te);ce+=Te;var De=N.parseSPS(Pe);if(me===0){M.codecWidth=De.codec_size.width,M.codecHeight=De.codec_size.height,M.presentWidth=De.present_size.width,M.presentHeight=De.present_size.height,M.profile=De.profile_string,M.level=De.level_string,M.bitDepth=De.bit_depth,M.chromaFormat=De.chroma_format,M.sarRatio=De.sar_ratio,M.frameRate=De.frame_rate,De.frame_rate.fixed!==!1&&De.frame_rate.fps_num!==0&&De.frame_rate.fps_den!==0||(M.frameRate=this._referenceFrameRate);var Je=M.frameRate.fps_den,Ye=M.frameRate.fps_num;M.refSampleDuration=M.timescale*(Je/Ye);for(var qe=Pe.subarray(1,4),ht="avc1.",wt=0;wt<3;wt++){var Qe=qe[wt].toString(16);Qe.length<2&&(Qe="0"+Qe),ht+=Qe}M.codec=ht;var lt=this._mediaInfo;lt.width=M.codecWidth,lt.height=M.codecHeight,lt.fps=M.frameRate.fps,lt.profile=M.profile,lt.level=M.level,lt.refFrames=De.ref_frames,lt.chromaFormat=De.chroma_format_string,lt.sarNum=M.sarRatio.width,lt.sarDen=M.sarRatio.height,lt.videoCodec=ht,lt.hasAudio?lt.audioCodec!=null&&(lt.mimeType='video/x-flv; codecs="'+lt.videoCodec+","+lt.audioCodec+'"'):lt.mimeType='video/x-flv; codecs="'+lt.videoCodec+'"',lt.isComplete()&&this._onMediaInfo(lt)}}}var vt=Y.getUint8(ce);if(vt!==0){for(vt>1&&d.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = ".concat(vt)),ce++,me=0;me<vt;me++)Te=Y.getUint16(ce,!V),ce+=2,Te!==0&&(ce+=Te);M.avcc=new Uint8Array(w),M.avcc.set(new Uint8Array(A,j,w),0),d.a.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",M)}else this._onError(C.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else this._onError(C.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else this._onError(C.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: ".concat(this._naluLengthSize-1));else this._onError(C.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}},R.prototype._parseHEVCDecoderConfigurationRecord=function(A,j,w){if(w<22)d.a.w(this.TAG,"Flv: Invalid HEVCDecoderConfigurationRecord, lack of data!");else{var M=this._videoMetadata,G=this._videoTrack,V=this._littleEndian,Y=new DataView(A,j,w);if(M){if(M.hvcc!==void 0){var ne=new Uint8Array(A,j,w);if(B(ne,M.hvcc))return;d.a.w(this.TAG,"HEVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(M=this._videoMetadata={}).type="video",M.id=G.id,M.timescale=this._timescale,M.duration=this._duration;var se=Y.getUint8(0),le=31&Y.getUint8(1);if(se!==0&&se!==1||le===0)this._onError(C.a.FORMAT_ERROR,"Flv: Invalid HEVCDecoderConfigurationRecord");else if(this._naluLengthSize=1+(3&Y.getUint8(21)),this._naluLengthSize===3||this._naluLengthSize===4){for(var he=Y.getUint8(22),ce=0,me=23;ce<he;ce++){var Te=63&Y.getUint8(me+0),Pe=Y.getUint16(me+1,!V);me+=3;for(var De=0;De<Pe;De++){var Je=Y.getUint16(me+0,!V);if(De===0)if(Te===33){me+=2;var Ye=new Uint8Array(A,j+me,Je),qe=T.parseSPS(Ye);M.codecWidth=qe.codec_size.width,M.codecHeight=qe.codec_size.height,M.presentWidth=qe.present_size.width,M.presentHeight=qe.present_size.height,M.profile=qe.profile_string,M.level=qe.level_string,M.bitDepth=qe.bit_depth,M.chromaFormat=qe.chroma_format,M.sarRatio=qe.sar_ratio,M.frameRate=qe.frame_rate,qe.frame_rate.fixed!==!1&&qe.frame_rate.fps_num!==0&&qe.frame_rate.fps_den!==0||(M.frameRate=this._referenceFrameRate);var ht=M.frameRate.fps_den,wt=M.frameRate.fps_num;M.refSampleDuration=M.timescale*(ht/wt),M.codec=qe.codec_mimetype;var Qe=this._mediaInfo;Qe.width=M.codecWidth,Qe.height=M.codecHeight,Qe.fps=M.frameRate.fps,Qe.profile=M.profile,Qe.level=M.level,Qe.refFrames=qe.ref_frames,Qe.chromaFormat=qe.chroma_format_string,Qe.sarNum=M.sarRatio.width,Qe.sarDen=M.sarRatio.height,Qe.videoCodec=qe.codec_mimetype,Qe.hasAudio?Qe.audioCodec!=null&&(Qe.mimeType='video/x-flv; codecs="'+Qe.videoCodec+","+Qe.audioCodec+'"'):Qe.mimeType='video/x-flv; codecs="'+Qe.videoCodec+'"',Qe.isComplete()&&this._onMediaInfo(Qe),me+=Je}else me+=2+Je;else me+=2+Je}}M.hvcc=new Uint8Array(w),M.hvcc.set(new Uint8Array(A,j,w),0),d.a.v(this.TAG,"Parsed HEVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",M)}else this._onError(C.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: ".concat(this._naluLengthSize-1))}},R.prototype._parseAV1CodecConfigurationRecord=function(A,j,w){if(w<4)d.a.w(this.TAG,"Flv: Invalid AV1CodecConfigurationRecord, lack of data!");else{var M=this._videoMetadata,G=this._videoTrack,V=(this._littleEndian,new DataView(A,j,w));M?M.av1c!==void 0&&d.a.w(this.TAG,"Found another AV1CodecConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(M=this._videoMetadata={}).type="video",M.id=G.id,M.timescale=this._timescale,M.duration=this._duration);var Y=127&V.getUint8(0);if(V.getUint8(1),V.getUint8(1),V.getUint8(2),Y===1){var ne=I.parseOBUs(new Uint8Array(A,j+4,w-4));if(ne!=null){M.profile=ne.profile_string,M.level=ne.level_string,M.bitDepth=ne.bit_depth,M.chromaFormat=ne.chroma_format,M.frameRate=ne.frame_rate,ne.frame_rate.fixed!==!1&&ne.frame_rate.fps_num!==0&&ne.frame_rate.fps_den!==0||(M.frameRate=this._referenceFrameRate);var se=M.frameRate.fps_den,le=M.frameRate.fps_num;M.refSampleDuration=M.timescale*(se/le),M.codec=ne.codec_mimetype,M.extra=ne;var he=this._mediaInfo;he.fps=M.frameRate.fps,he.profile=M.profile,he.level=M.level,he.refFrames=ne.ref_frames,he.chromaFormat=ne.chroma_format_string,he.videoCodec=ne.codec_mimetype,he.hasAudio?he.audioCodec!=null&&(he.mimeType='video/x-flv; codecs="'+he.videoCodec+","+he.audioCodec+'"'):he.mimeType='video/x-flv; codecs="'+he.videoCodec+'"',he.isComplete()&&this._onMediaInfo(he),M.av1c=new Uint8Array(w),M.av1c.set(new Uint8Array(A,j,w),0),d.a.v(this.TAG,"Preparing AV1CodecConfigurationRecord")}else this._onError(C.a.FORMAT_ERROR,"Flv: Invalid AV1CodecConfigurationRecord")}else this._onError(C.a.FORMAT_ERROR,"Flv: Invalid AV1CodecConfigurationRecord")}},R.prototype._parseAVCVideoData=function(A,j,w,M,G,V,Y){for(var ne=this._littleEndian,se=new DataView(A,j,w),le=[],he=0,ce=0,me=this._naluLengthSize,Te=this._timestampBase+M,Pe=V===1;ce<w;){if(ce+4>=w){d.a.w(this.TAG,"Malformed Nalu near timestamp ".concat(Te,", offset = ").concat(ce,", dataSize = ").concat(w));break}var De=se.getUint32(ce,!ne);if(me===3&&(De>>>=8),De>w-me)return void d.a.w(this.TAG,"Malformed Nalus near timestamp ".concat(Te,", NaluSize > DataSize!"));var Je=31&se.getUint8(ce+me);Je===5&&(Pe=!0);var Ye=new Uint8Array(A,j+ce,me+De),qe={type:Je,data:Ye};le.push(qe),he+=Ye.byteLength,ce+=me+De}if(le.length){var ht=this._videoTrack,wt={units:le,length:he,isKeyframe:Pe,dts:Te,cts:Y,pts:Te+Y};Pe&&(wt.fileposition=G),ht.samples.push(wt),ht.length+=he}},R.prototype._parseHEVCVideoData=function(A,j,w,M,G,V,Y){for(var ne=this._littleEndian,se=new DataView(A,j,w),le=[],he=0,ce=0,me=this._naluLengthSize,Te=this._timestampBase+M,Pe=V===1;ce<w;){if(ce+4>=w){d.a.w(this.TAG,"Malformed Nalu near timestamp ".concat(Te,", offset = ").concat(ce,", dataSize = ").concat(w));break}var De=se.getUint32(ce,!ne);if(me===3&&(De>>>=8),De>w-me)return void d.a.w(this.TAG,"Malformed Nalus near timestamp ".concat(Te,", NaluSize > DataSize!"));var Je=se.getUint8(ce+me)>>1&63;Je!==19&&Je!==20&&Je!==21||(Pe=!0);var Ye=new Uint8Array(A,j+ce,me+De),qe={type:Je,data:Ye};le.push(qe),he+=Ye.byteLength,ce+=me+De}if(le.length){var ht=this._videoTrack,wt={units:le,length:he,isKeyframe:Pe,dts:Te,cts:Y,pts:Te+Y};Pe&&(wt.fileposition=G),ht.samples.push(wt),ht.length+=he}},R.prototype._parseAV1VideoData=function(A,j,w,M,G,V,Y){this._littleEndian;var ne,se=[],le=this._timestampBase+M,he=V===1;if(he){var ce=this._videoMetadata,me=I.parseOBUs(new Uint8Array(A,j,w),ce.extra);if(me==null)return void this._onError(C.a.FORMAT_ERROR,"Flv: Invalid AV1 VideoData");console.log(me),ce.codecWidth=me.codec_size.width,ce.codecHeight=me.codec_size.height,ce.presentWidth=me.present_size.width,ce.presentHeight=me.present_size.height,ce.sarRatio=me.sar_ratio;var Te=this._mediaInfo;Te.width=ce.codecWidth,Te.height=ce.codecHeight,Te.sarNum=ce.sarRatio.width,Te.sarDen=ce.sarRatio.height,d.a.v(this.TAG,"Parsed AV1DecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",ce)}if(ne=w,se.push({unitType:0,data:new Uint8Array(A,j+0,w)}),se.length){var Pe=this._videoTrack,De={units:se,length:ne,isKeyframe:he,dts:le,cts:Y,pts:le+Y};he&&(De.fileposition=G),Pe.samples.push(De),Pe.length+=ne}},R})(),ee=(function(){function R(){}return R.prototype.destroy=function(){this.onError=null,this.onMediaInfo=null,this.onMetaDataArrived=null,this.onTrackMetadata=null,this.onDataAvailable=null,this.onTimedID3Metadata=null,this.onSynchronousKLVMetadata=null,this.onAsynchronousKLVMetadata=null,this.onSMPTE2038Metadata=null,this.onSCTE35Metadata=null,this.onPESPrivateData=null,this.onPESPrivateDataDescriptor=null},R})(),ie=function(){this.program_pmt_pid={}};(function(R){R[R.kMPEG1Audio=3]="kMPEG1Audio",R[R.kMPEG2Audio=4]="kMPEG2Audio",R[R.kPESPrivateData=6]="kPESPrivateData",R[R.kADTSAAC=15]="kADTSAAC",R[R.kLOASAAC=17]="kLOASAAC",R[R.kAC3=129]="kAC3",R[R.kEAC3=135]="kEAC3",R[R.kMetadata=21]="kMetadata",R[R.kSCTE35=134]="kSCTE35",R[R.kH264=27]="kH264",R[R.kH265=36]="kH265"})(D||(D={}));var Z,z=function(){this.pid_stream_type={},this.common_pids={h264:void 0,h265:void 0,av1:void 0,adts_aac:void 0,loas_aac:void 0,opus:void 0,ac3:void 0,eac3:void 0,mp3:void 0},this.pes_private_data_pids={},this.timed_id3_pids={},this.synchronous_klv_pids={},this.asynchronous_klv_pids={},this.scte_35_pids={},this.smpte2038_pids={}},X=function(){},ae=function(){},te=function(){this.slices=[],this.total_length=0,this.expected_length=0,this.file_position=0};(function(R){R[R.kUnspecified=0]="kUnspecified",R[R.kSliceNonIDR=1]="kSliceNonIDR",R[R.kSliceDPA=2]="kSliceDPA",R[R.kSliceDPB=3]="kSliceDPB",R[R.kSliceDPC=4]="kSliceDPC",R[R.kSliceIDR=5]="kSliceIDR",R[R.kSliceSEI=6]="kSliceSEI",R[R.kSliceSPS=7]="kSliceSPS",R[R.kSlicePPS=8]="kSlicePPS",R[R.kSliceAUD=9]="kSliceAUD",R[R.kEndOfSequence=10]="kEndOfSequence",R[R.kEndOfStream=11]="kEndOfStream",R[R.kFiller=12]="kFiller",R[R.kSPSExt=13]="kSPSExt",R[R.kReserved0=14]="kReserved0"})(Z||(Z={}));var W,K,q=function(){},J=function(R){var A=R.data.byteLength;this.type=R.type,this.data=new Uint8Array(4+A),new DataView(this.data.buffer).setUint32(0,A),this.data.set(R.data,4)},oe=(function(){function R(A){this.TAG="H264AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=A,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&d.a.e(this.TAG,"Could not find H264 startcode until payload end!")}return R.prototype.findNextStartCodeOffset=function(A){for(var j=A,w=this.data_;;){if(j+3>=w.byteLength)return this.eof_flag_=!0,w.byteLength;var M=w[j+0]<<24|w[j+1]<<16|w[j+2]<<8|w[j+3],G=w[j+0]<<16|w[j+1]<<8|w[j+2];if(M===1||G===1)return j;j++}},R.prototype.readNextNaluPayload=function(){for(var A=this.data_,j=null;j==null&&!this.eof_flag_;){var w=this.current_startcode_offset_,M=31&A[w+=(A[w]<<24|A[w+1]<<16|A[w+2]<<8|A[w+3])===1?4:3],G=(128&A[w])>>>7,V=this.findNextStartCodeOffset(w);if(this.current_startcode_offset_=V,!(M>=Z.kReserved0)&&G===0){var Y=A.subarray(w,V);(j=new q).type=M,j.data=Y}}return j},R})(),be=(function(){function R(A,j,w){var M=8+A.byteLength+1+2+j.byteLength,G=!1;A[3]!==66&&A[3]!==77&&A[3]!==88&&(G=!0,M+=4);var V=this.data=new Uint8Array(M);V[0]=1,V[1]=A[1],V[2]=A[2],V[3]=A[3],V[4]=255,V[5]=225;var Y=A.byteLength;V[6]=Y>>>8,V[7]=255&Y;var ne=8;V.set(A,8),V[ne+=Y]=1;var se=j.byteLength;V[ne+1]=se>>>8,V[ne+2]=255&se,V.set(j,ne+3),ne+=3+se,G&&(V[ne]=252|w.chroma_format_idc,V[ne+1]=248|w.bit_depth_luma-8,V[ne+2]=248|w.bit_depth_chroma-8,V[ne+3]=0,ne+=4)}return R.prototype.getData=function(){return this.data},R})();(function(R){R[R.kNull=0]="kNull",R[R.kAACMain=1]="kAACMain",R[R.kAAC_LC=2]="kAAC_LC",R[R.kAAC_SSR=3]="kAAC_SSR",R[R.kAAC_LTP=4]="kAAC_LTP",R[R.kAAC_SBR=5]="kAAC_SBR",R[R.kAAC_Scalable=6]="kAAC_Scalable",R[R.kLayer1=32]="kLayer1",R[R.kLayer2=33]="kLayer2",R[R.kLayer3=34]="kLayer3"})(W||(W={})),(function(R){R[R.k96000Hz=0]="k96000Hz",R[R.k88200Hz=1]="k88200Hz",R[R.k64000Hz=2]="k64000Hz",R[R.k48000Hz=3]="k48000Hz",R[R.k44100Hz=4]="k44100Hz",R[R.k32000Hz=5]="k32000Hz",R[R.k24000Hz=6]="k24000Hz",R[R.k22050Hz=7]="k22050Hz",R[R.k16000Hz=8]="k16000Hz",R[R.k12000Hz=9]="k12000Hz",R[R.k11025Hz=10]="k11025Hz",R[R.k8000Hz=11]="k8000Hz",R[R.k7350Hz=12]="k7350Hz"})(K||(K={}));var ye,Ee,re=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],fe=(ye=function(R,A){return(ye=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(j,w){j.__proto__=w}||function(j,w){for(var M in w)Object.prototype.hasOwnProperty.call(w,M)&&(j[M]=w[M])})(R,A)},function(R,A){if(typeof A!="function"&&A!==null)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function j(){this.constructor=R}ye(R,A),R.prototype=A===null?Object.create(A):(j.prototype=A.prototype,new j)}),Le=function(){},ze=(function(R){function A(){return R!==null&&R.apply(this,arguments)||this}return fe(A,R),A})(Le),Xe=(function(){function R(A){this.TAG="AACADTSParser",this.data_=A,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&d.a.e(this.TAG,"Could not found ADTS syncword until payload end")}return R.prototype.findNextSyncwordOffset=function(A){for(var j=A,w=this.data_;;){if(j+7>=w.byteLength)return this.eof_flag_=!0,w.byteLength;if((w[j+0]<<8|w[j+1])>>>4===4095)return j;j++}},R.prototype.readNextAACFrame=function(){for(var A=this.data_,j=null;j==null&&!this.eof_flag_;){var w=this.current_syncword_offset_,M=(8&A[w+1])>>>3,G=(6&A[w+1])>>>1,V=1&A[w+1],Y=(192&A[w+2])>>>6,ne=(60&A[w+2])>>>2,se=(1&A[w+2])<<2|(192&A[w+3])>>>6,le=(3&A[w+3])<<11|A[w+4]<<3|(224&A[w+5])>>>5;if(A[w+6],w+le>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var he=V===1?7:9,ce=le-he;w+=he;var me=this.findNextSyncwordOffset(w+ce);if(this.current_syncword_offset_=me,(M===0||M===1)&&G===0){var Te=A.subarray(w,w+ce);(j=new Le).audio_object_type=Y+1,j.sampling_freq_index=ne,j.sampling_frequency=re[ne],j.channel_config=se,j.data=Te}}return j},R.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},R.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},R})(),ue=(function(){function R(A){this.TAG="AACLOASParser",this.data_=A,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&d.a.e(this.TAG,"Could not found LOAS syncword until payload end")}return R.prototype.findNextSyncwordOffset=function(A){for(var j=A,w=this.data_;;){if(j+1>=w.byteLength)return this.eof_flag_=!0,w.byteLength;if((w[j+0]<<3|w[j+1]>>>5)===695)return j;j++}},R.prototype.getLATMValue=function(A){for(var j=A.readBits(2),w=0,M=0;M<=j;M++)w<<=8,w|=A.readByte();return w},R.prototype.readNextAACFrame=function(A){for(var j=this.data_,w=null;w==null&&!this.eof_flag_;){var M=this.current_syncword_offset_,G=(31&j[M+1])<<8|j[M+2];if(M+3+G>=this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var V=new _(j.subarray(M+3,M+3+G)),Y=null;if(V.readBool()){if(A==null){d.a.w(this.TAG,"StreamMuxConfig Missing"),this.current_syncword_offset_=this.findNextSyncwordOffset(M+3+G),V.destroy();continue}Y=A}else{var ne=V.readBool();if(ne&&V.readBool()){d.a.e(this.TAG,"audioMuxVersionA is Not Supported"),V.destroy();break}if(ne&&this.getLATMValue(V),!V.readBool()){d.a.e(this.TAG,"allStreamsSameTimeFraming zero is Not Supported"),V.destroy();break}if(V.readBits(6)!==0){d.a.e(this.TAG,"more than 2 numSubFrames Not Supported"),V.destroy();break}if(V.readBits(4)!==0){d.a.e(this.TAG,"more than 2 numProgram Not Supported"),V.destroy();break}if(V.readBits(3)!==0){d.a.e(this.TAG,"more than 2 numLayer Not Supported"),V.destroy();break}var se=ne?this.getLATMValue(V):0,le=V.readBits(5);se-=5;var he=V.readBits(4);se-=4;var ce=V.readBits(4);se-=4,V.readBits(3),(se-=3)>0&&V.readBits(se);var me=V.readBits(3);if(me!==0){d.a.e(this.TAG,"frameLengthType = ".concat(me,". Only frameLengthType = 0 Supported")),V.destroy();break}V.readByte();var Te=V.readBool();if(Te)if(ne)this.getLATMValue(V);else{for(var Pe=0;;){Pe<<=8;var De=V.readBool();if(Pe+=V.readByte(),!De)break}console.log(Pe)}V.readBool()&&V.readByte(),(Y=new ze).audio_object_type=le,Y.sampling_freq_index=he,Y.sampling_frequency=re[Y.sampling_freq_index],Y.channel_config=ce,Y.other_data_present=Te}for(var Je=0;;){var Ye=V.readByte();if(Je+=Ye,Ye!==255)break}for(var qe=new Uint8Array(Je),ht=0;ht<Je;ht++)qe[ht]=V.readByte();(w=new ze).audio_object_type=Y.audio_object_type,w.sampling_freq_index=Y.sampling_freq_index,w.sampling_frequency=re[Y.sampling_freq_index],w.channel_config=Y.channel_config,w.other_data_present=Y.other_data_present,w.data=qe,this.current_syncword_offset_=this.findNextSyncwordOffset(M+3+G)}return w},R.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},R.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},R})(),Ge=function(R){var A=null,j=R.audio_object_type,w=R.audio_object_type,M=R.sampling_freq_index,G=R.channel_config,V=0,Y=navigator.userAgent.toLowerCase();Y.indexOf("firefox")!==-1?M>=6?(w=5,A=new Array(4),V=M-3):(w=2,A=new Array(2),V=M):Y.indexOf("android")!==-1?(w=2,A=new Array(2),V=M):(w=5,V=M,A=new Array(4),M>=6?V=M-3:G===1&&(w=2,A=new Array(2),V=M)),A[0]=w<<3,A[0]|=(15&M)>>>1,A[1]=(15&M)<<7,A[1]|=(15&G)<<3,w===5&&(A[1]|=(15&V)>>>1,A[2]=(1&V)<<7,A[2]|=8,A[3]=0),this.config=A,this.sampling_rate=re[M],this.channel_count=G,this.codec_mimetype="mp4a.40."+w,this.original_codec_mimetype="mp4a.40."+j},Ve=function(){},bt=function(){};(function(R){R[R.kSpliceNull=0]="kSpliceNull",R[R.kSpliceSchedule=4]="kSpliceSchedule",R[R.kSpliceInsert=5]="kSpliceInsert",R[R.kTimeSignal=6]="kTimeSignal",R[R.kBandwidthReservation=7]="kBandwidthReservation",R[R.kPrivateCommand=255]="kPrivateCommand"})(Ee||(Ee={}));var We,ot=function(R){var A=R.readBool();return A?(R.readBits(6),{time_specified_flag:A,pts_time:4*R.readBits(31)+R.readBits(2)}):(R.readBits(7),{time_specified_flag:A})},Ie=function(R){var A=R.readBool();return R.readBits(6),{auto_return:A,duration:4*R.readBits(31)+R.readBits(2)}},Lt=function(R,A){var j=A.readBits(8);return R?{component_tag:j}:{component_tag:j,splice_time:ot(A)}},Ht=function(R){return{component_tag:R.readBits(8),utc_splice_time:R.readBits(32)}},As=function(R){var A=R.readBits(32),j=R.readBool();R.readBits(7);var w={splice_event_id:A,splice_event_cancel_indicator:j};if(j)return w;if(w.out_of_network_indicator=R.readBool(),w.program_splice_flag=R.readBool(),w.duration_flag=R.readBool(),R.readBits(5),w.program_splice_flag)w.utc_splice_time=R.readBits(32);else{w.component_count=R.readBits(8),w.components=[];for(var M=0;M<w.component_count;M++)w.components.push(Ht(R))}return w.duration_flag&&(w.break_duration=Ie(R)),w.unique_program_id=R.readBits(16),w.avail_num=R.readBits(8),w.avails_expected=R.readBits(8),w},Cs=function(R,A,j,w){return{descriptor_tag:R,descriptor_length:A,identifier:j,provider_avail_id:w.readBits(32)}},Tn=function(R,A,j,w){var M=w.readBits(8),G=w.readBits(3);w.readBits(5);for(var V="",Y=0;Y<G;Y++)V+=String.fromCharCode(w.readBits(8));return{descriptor_tag:R,descriptor_length:A,identifier:j,preroll:M,dtmf_count:G,DTMF_char:V}},ts=function(R){var A=R.readBits(8);return R.readBits(7),{component_tag:A,pts_offset:4*R.readBits(31)+R.readBits(2)}},Bn=function(R,A,j,w){var M=w.readBits(32),G=w.readBool();w.readBits(7);var V={descriptor_tag:R,descriptor_length:A,identifier:j,segmentation_event_id:M,segmentation_event_cancel_indicator:G};if(G)return V;if(V.program_segmentation_flag=w.readBool(),V.segmentation_duration_flag=w.readBool(),V.delivery_not_restricted_flag=w.readBool(),V.delivery_not_restricted_flag?w.readBits(5):(V.web_delivery_allowed_flag=w.readBool(),V.no_regional_blackout_flag=w.readBool(),V.archive_allowed_flag=w.readBool(),V.device_restrictions=w.readBits(2)),!V.program_segmentation_flag){V.component_count=w.readBits(8),V.components=[];for(var Y=0;Y<V.component_count;Y++)V.components.push(ts(w))}V.segmentation_duration_flag&&(V.segmentation_duration=w.readBits(40)),V.segmentation_upid_type=w.readBits(8),V.segmentation_upid_length=w.readBits(8);var ne=new Uint8Array(V.segmentation_upid_length);for(Y=0;Y<V.segmentation_upid_length;Y++)ne[Y]=w.readBits(8);return V.segmentation_upid=ne.buffer,V.segmentation_type_id=w.readBits(8),V.segment_num=w.readBits(8),V.segments_expected=w.readBits(8),V.segmentation_type_id!==52&&V.segmentation_type_id!==54&&V.segmentation_type_id!==56&&V.segmentation_type_id!==58||(V.sub_segment_num=w.readBits(8),V.sub_segments_expected=w.readBits(8)),V},ua=function(R,A,j,w){return{descriptor_tag:R,descriptor_length:A,identifier:j,TAI_seconds:w.readBits(48),TAI_ns:w.readBits(32),UTC_offset:w.readBits(16)}},rn=function(R){return{component_tag:R.readBits(8),ISO_code:String.fromCharCode(R.readBits(8),R.readBits(8),R.readBits(8)),Bit_Stream_Mode:R.readBits(3),Num_Channels:R.readBits(4),Full_Srvc_Audio:R.readBool()}},ya=function(R,A,j,w){for(var M=w.readBits(4),G=[],V=0;V<M;V++)G.push(rn(w));return{descriptor_tag:R,descriptor_length:A,identifier:j,audio_count:M,components:G}},An=function(R){var A=new _(R),j=A.readBits(8),w=A.readBool(),M=A.readBool();A.readBits(2);var G=A.readBits(12),V=A.readBits(8),Y=A.readBool(),ne=A.readBits(6),se=4*A.readBits(31)+A.readBits(2),le=A.readBits(8),he=A.readBits(12),ce=A.readBits(12),me=A.readBits(8),Te=null;me===Ee.kSpliceNull?Te={}:me===Ee.kSpliceSchedule?Te=(function(ct){for(var _t=ct.readBits(8),Yt=[],yt=0;yt<_t;yt++)Yt.push(As(ct));return{splice_count:_t,events:Yt}})(A):me===Ee.kSpliceInsert?Te=(function(ct){var _t=ct.readBits(32),Yt=ct.readBool();ct.readBits(7);var yt={splice_event_id:_t,splice_event_cancel_indicator:Yt};if(Yt)return yt;if(yt.out_of_network_indicator=ct.readBool(),yt.program_splice_flag=ct.readBool(),yt.duration_flag=ct.readBool(),yt.splice_immediate_flag=ct.readBool(),ct.readBits(4),yt.program_splice_flag&&!yt.splice_immediate_flag&&(yt.splice_time=ot(ct)),!yt.program_splice_flag){yt.component_count=ct.readBits(8),yt.components=[];for(var Tt=0;Tt<yt.component_count;Tt++)yt.components.push(Lt(yt.splice_immediate_flag,ct))}return yt.duration_flag&&(yt.break_duration=Ie(ct)),yt.unique_program_id=ct.readBits(16),yt.avail_num=ct.readBits(8),yt.avails_expected=ct.readBits(8),yt})(A):me===Ee.kTimeSignal?Te=(function(ct){return{splice_time:ot(ct)}})(A):me===Ee.kBandwidthReservation?Te={}:me===Ee.kPrivateCommand?Te=(function(ct,_t){for(var Yt=String.fromCharCode(_t.readBits(8),_t.readBits(8),_t.readBits(8),_t.readBits(8)),yt=new Uint8Array(ct-4),Tt=0;Tt<ct-4;Tt++)yt[Tt]=_t.readBits(8);return{identifier:Yt,private_data:yt.buffer}})(ce,A):A.readBits(8*ce);for(var Pe=[],De=A.readBits(16),Je=0;Je<De;){var Ye=A.readBits(8),qe=A.readBits(8),ht=String.fromCharCode(A.readBits(8),A.readBits(8),A.readBits(8),A.readBits(8));Ye===0?Pe.push(Cs(Ye,qe,ht,A)):Ye===1?Pe.push(Tn(Ye,qe,ht,A)):Ye===2?Pe.push(Bn(Ye,qe,ht,A)):Ye===3?Pe.push(ua(Ye,qe,ht,A)):Ye===4?Pe.push(ya(Ye,qe,ht,A)):A.readBits(8*(qe-4)),Je+=2+qe}var wt={table_id:j,section_syntax_indicator:w,private_indicator:M,section_length:G,protocol_version:V,encrypted_packet:Y,encryption_algorithm:ne,pts_adjustment:se,cw_index:le,tier:he,splice_command_length:ce,splice_command_type:me,splice_command:Te,descriptor_loop_length:De,splice_descriptors:Pe,E_CRC32:Y?A.readBits(32):void 0,CRC32:A.readBits(32)};if(me===Ee.kSpliceInsert){var Qe=Te;if(Qe.splice_event_cancel_indicator)return{splice_command_type:me,detail:wt,data:R};if(Qe.program_splice_flag&&!Qe.splice_immediate_flag){var lt=Qe.duration_flag?Qe.break_duration.auto_return:void 0,vt=Qe.duration_flag?Qe.break_duration.duration/90:void 0;return Qe.splice_time.time_specified_flag?{splice_command_type:me,pts:(se+Qe.splice_time.pts_time)%Math.pow(2,33),auto_return:lt,duraiton:vt,detail:wt,data:R}:{splice_command_type:me,auto_return:lt,duraiton:vt,detail:wt,data:R}}return{splice_command_type:me,auto_return:lt=Qe.duration_flag?Qe.break_duration.auto_return:void 0,duraiton:vt=Qe.duration_flag?Qe.break_duration.duration/90:void 0,detail:wt,data:R}}if(me===Ee.kTimeSignal){var dt=Te;return dt.splice_time.time_specified_flag?{splice_command_type:me,pts:(se+dt.splice_time.pts_time)%Math.pow(2,33),detail:wt,data:R}:{splice_command_type:me,detail:wt,data:R}}return{splice_command_type:me,detail:wt,data:R}};(function(R){R[R.kSliceIDR_W_RADL=19]="kSliceIDR_W_RADL",R[R.kSliceIDR_N_LP=20]="kSliceIDR_N_LP",R[R.kSliceCRA_NUT=21]="kSliceCRA_NUT",R[R.kSliceVPS=32]="kSliceVPS",R[R.kSliceSPS=33]="kSliceSPS",R[R.kSlicePPS=34]="kSlicePPS",R[R.kSliceAUD=35]="kSliceAUD"})(We||(We={}));var ln=function(){},Sa=function(R){var A=R.data.byteLength;this.type=R.type,this.data=new Uint8Array(4+A),new DataView(this.data.buffer).setUint32(0,A),this.data.set(R.data,4)},Un=(function(){function R(A){this.TAG="H265AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=A,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&d.a.e(this.TAG,"Could not find H265 startcode until payload end!")}return R.prototype.findNextStartCodeOffset=function(A){for(var j=A,w=this.data_;;){if(j+3>=w.byteLength)return this.eof_flag_=!0,w.byteLength;var M=w[j+0]<<24|w[j+1]<<16|w[j+2]<<8|w[j+3],G=w[j+0]<<16|w[j+1]<<8|w[j+2];if(M===1||G===1)return j;j++}},R.prototype.readNextNaluPayload=function(){for(var A=this.data_,j=null;j==null&&!this.eof_flag_;){var w=this.current_startcode_offset_,M=A[w+=(A[w]<<24|A[w+1]<<16|A[w+2]<<8|A[w+3])===1?4:3]>>1&63,G=(128&A[w])>>>7,V=this.findNextStartCodeOffset(w);if(this.current_startcode_offset_=V,G===0){var Y=A.subarray(w,V);(j=new ln).type=M,j.data=Y}}return j},R})(),on=(function(){function R(A,j,w,M){var G=23+(5+A.byteLength)+(5+j.byteLength)+(5+w.byteLength),V=this.data=new Uint8Array(G);V[0]=1,V[1]=(3&M.general_profile_space)<<6|(M.general_tier_flag?1:0)<<5|31&M.general_profile_idc,V[2]=M.general_profile_compatibility_flags_1,V[3]=M.general_profile_compatibility_flags_2,V[4]=M.general_profile_compatibility_flags_3,V[5]=M.general_profile_compatibility_flags_4,V[6]=M.general_constraint_indicator_flags_1,V[7]=M.general_constraint_indicator_flags_2,V[8]=M.general_constraint_indicator_flags_3,V[9]=M.general_constraint_indicator_flags_4,V[10]=M.general_constraint_indicator_flags_5,V[11]=M.general_constraint_indicator_flags_6,V[12]=M.general_level_idc,V[13]=240|(3840&M.min_spatial_segmentation_idc)>>8,V[14]=255&M.min_spatial_segmentation_idc,V[15]=252|3&M.parallelismType,V[16]=252|3&M.chroma_format_idc,V[17]=248|7&M.bit_depth_luma_minus8,V[18]=248|7&M.bit_depth_chroma_minus8,V[19]=0,V[20]=0,V[21]=(3&M.constant_frame_rate)<<6|(7&M.num_temporal_layers)<<3|(M.temporal_id_nested?1:0)<<2|3,V[22]=3,V[23]=128|We.kSliceVPS,V[24]=0,V[25]=1,V[26]=(65280&A.byteLength)>>8,V[27]=(255&A.byteLength)>>0,V.set(A,28),V[23+(5+A.byteLength)+0]=128|We.kSliceSPS,V[23+(5+A.byteLength)+1]=0,V[23+(5+A.byteLength)+2]=1,V[23+(5+A.byteLength)+3]=(65280&j.byteLength)>>8,V[23+(5+A.byteLength)+4]=(255&j.byteLength)>>0,V.set(j,23+(5+A.byteLength)+5),V[23+(5+A.byteLength+5+j.byteLength)+0]=128|We.kSlicePPS,V[23+(5+A.byteLength+5+j.byteLength)+1]=0,V[23+(5+A.byteLength+5+j.byteLength)+2]=1,V[23+(5+A.byteLength+5+j.byteLength)+3]=(65280&w.byteLength)>>8,V[23+(5+A.byteLength+5+j.byteLength)+4]=(255&w.byteLength)>>0,V.set(w,23+(5+A.byteLength+5+j.byteLength)+5)}return R.prototype.getData=function(){return this.data},R})(),Ps=function(){},we=function(){},gt=function(){},zt=[[64,64,80,80,96,96,112,112,128,128,160,160,192,192,224,224,256,256,320,320,384,384,448,448,512,512,640,640,768,768,896,896,1024,1024,1152,1152,1280,1280],[69,70,87,88,104,105,121,122,139,140,174,175,208,209,243,244,278,279,348,349,417,418,487,488,557,558,696,697,835,836,975,976,1114,1115,1253,1254,1393,1394],[96,96,120,120,144,144,168,168,192,192,240,240,288,288,336,336,384,384,480,480,576,576,672,672,768,768,960,960,1152,1152,1344,1344,1536,1536,1728,1728,1920,1920]],ja=(function(){function R(A){this.TAG="AC3Parser",this.data_=A,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&d.a.e(this.TAG,"Could not found AC3 syncword until payload end")}return R.prototype.findNextSyncwordOffset=function(A){for(var j=A,w=this.data_;;){if(j+7>=w.byteLength)return this.eof_flag_=!0,w.byteLength;if((w[j+0]<<8|w[j+1]<<0)===2935)return j;j++}},R.prototype.readNextAC3Frame=function(){for(var A=this.data_,j=null;j==null&&!this.eof_flag_;){var w=this.current_syncword_offset_,M=A[w+4]>>6,G=[48e3,44200,33e3][M],V=63&A[w+4],Y=2*zt[M][V];if(isNaN(Y)||w+Y>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var ne=this.findNextSyncwordOffset(w+Y);this.current_syncword_offset_=ne;var se=A[w+5]>>3,le=7&A[w+5],he=A[w+6]>>5,ce=0;(1&he)!=0&&he!==1&&(ce+=2),(4&he)!=0&&(ce+=2),he===2&&(ce+=2);var me=(A[w+6]<<8|A[w+7]<<0)>>12-ce&1,Te=[2,1,2,3,3,4,4,5][he]+me;(j=new gt).sampling_frequency=G,j.channel_count=Te,j.channel_mode=he,j.bit_stream_identification=se,j.low_frequency_effects_channel_on=me,j.bit_stream_mode=le,j.frame_size_code=V,j.data=A.subarray(w,w+Y)}return j},R.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},R.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},R})(),Mo=function(R){var A;A=[R.sampling_rate_code<<6|R.bit_stream_identification<<1|R.bit_stream_mode>>2,(3&R.bit_stream_mode)<<6|R.channel_mode<<3|R.low_frequency_effects_channel_on<<2|R.frame_size_code>>4,R.frame_size_code<<4&224],this.config=A,this.sampling_rate=R.sampling_frequency,this.bit_stream_identification=R.bit_stream_identification,this.bit_stream_mode=R.bit_stream_mode,this.low_frequency_effects_channel_on=R.low_frequency_effects_channel_on,this.channel_count=R.channel_count,this.channel_mode=R.channel_mode,this.codec_mimetype="ac-3",this.original_codec_mimetype="ac-3"},Vi=function(){},xe=(function(){function R(A){this.TAG="EAC3Parser",this.data_=A,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&d.a.e(this.TAG,"Could not found AC3 syncword until payload end")}return R.prototype.findNextSyncwordOffset=function(A){for(var j=A,w=this.data_;;){if(j+7>=w.byteLength)return this.eof_flag_=!0,w.byteLength;if((w[j+0]<<8|w[j+1]<<0)===2935)return j;j++}},R.prototype.readNextEAC3Frame=function(){for(var A=this.data_,j=null;j==null&&!this.eof_flag_;){var w=this.current_syncword_offset_,M=new _(A.subarray(w+2)),G=(M.readBits(2),M.readBits(3),M.readBits(11)+1<<1),V=M.readBits(2),Y=null,ne=null;V===3?(Y=[24e3,22060,16e3][V=M.readBits(2)],ne=3):(Y=[48e3,44100,32e3][V],ne=M.readBits(2));var se=M.readBits(3),le=M.readBits(1),he=M.readBits(5);if(w+G>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var ce=this.findNextSyncwordOffset(w+G);this.current_syncword_offset_=ce;var me=[2,1,2,3,3,4,4,5][se]+le;M.destroy(),(j=new Vi).sampling_frequency=Y,j.channel_count=me,j.channel_mode=se,j.bit_stream_identification=he,j.low_frequency_effects_channel_on=le,j.frame_size=G,j.num_blks=[1,2,3,6][ne],j.data=A.subarray(w,w+G)}return j},R.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},R.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},R})(),He=function(R){var A,j=Math.floor(R.frame_size*R.sampling_frequency/(16*R.num_blks));A=[255&j,248&j,R.sampling_rate_code<<6|R.bit_stream_identification<<1|0,0|R.channel_mode<<1|R.low_frequency_effects_channel_on<<0,0],this.config=A,this.sampling_rate=R.sampling_frequency,this.bit_stream_identification=R.bit_stream_identification,this.num_blks=R.num_blks,this.low_frequency_effects_channel_on=R.low_frequency_effects_channel_on,this.channel_count=R.channel_count,this.channel_mode=R.channel_mode,this.codec_mimetype="ec-3",this.original_codec_mimetype="ec-3"},tt=function(){},Jt=(function(){function R(A){this.TAG="AV1OBUInMpegTsParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=A,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&d.a.e(this.TAG,"Could not find AV1 startcode until payload end!")}return R._ebsp2rbsp=function(A){for(var j=A,w=j.byteLength,M=new Uint8Array(w),G=0,V=0;V<w;V++)V>=2&&j[V]===3&&j[V-1]===0&&j[V-2]===0||(M[G]=j[V],G++);return new Uint8Array(M.buffer,0,G)},R.prototype.findNextStartCodeOffset=function(A){for(var j=A,w=this.data_;;){if(j+2>=w.byteLength)return this.eof_flag_=!0,w.byteLength;if((w[j+0]<<16|w[j+1]<<8|w[j+2])===1)return j;j++}},R.prototype.readNextOBUPayload=function(){for(var A=this.data_,j=null;j==null&&!this.eof_flag_;){var w=this.current_startcode_offset_+3,M=this.findNextStartCodeOffset(w);this.current_startcode_offset_=M,j=R._ebsp2rbsp(A.subarray(w,M))}return j},R})(),ks=(function(){var R=function(A,j){return(R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,M){w.__proto__=M}||function(w,M){for(var G in M)Object.prototype.hasOwnProperty.call(M,G)&&(w[G]=M[G])})(A,j)};return function(A,j){if(typeof j!="function"&&j!==null)throw new TypeError("Class extends value "+String(j)+" is not a constructor or null");function w(){this.constructor=A}R(A,j),A.prototype=j===null?Object.create(j):(w.prototype=j.prototype,new w)}})(),Ea=function(){return(Ea=Object.assign||function(R){for(var A,j=1,w=arguments.length;j<w;j++)for(var M in A=arguments[j])Object.prototype.hasOwnProperty.call(A,M)&&(R[M]=A[M]);return R}).apply(this,arguments)},Cn=(function(R){function A(j,w){var M=R.call(this)||this;return M.TAG="TSDemuxer",M.first_parse_=!0,M.media_info_=new u.a,M.timescale_=90,M.duration_=0,M.current_pmt_pid_=-1,M.program_pmt_map_={},M.pes_slice_queues_={},M.section_slice_queues_={},M.video_metadata_={vps:void 0,sps:void 0,pps:void 0,av1c:void 0,details:void 0},M.audio_metadata_={codec:void 0,audio_object_type:void 0,sampling_freq_index:void 0,sampling_frequency:void 0,channel_config:void 0},M.last_pcr_base_=NaN,M.timestamp_offset_=0,M.audio_last_sample_pts_=void 0,M.aac_last_incomplete_data_=null,M.has_video_=!1,M.has_audio_=!1,M.video_init_segment_dispatched_=!1,M.audio_init_segment_dispatched_=!1,M.video_metadata_changed_=!1,M.audio_metadata_changed_=!1,M.loas_previous_frame=null,M.video_track_={type:"video",id:1,sequenceNumber:0,samples:[],length:0},M.audio_track_={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},M.ts_packet_size_=j.ts_packet_size,M.sync_offset_=j.sync_offset,M.config_=w,M}return ks(A,R),A.prototype.destroy=function(){this.media_info_=null,this.pes_slice_queues_=null,this.section_slice_queues_=null,this.video_metadata_=null,this.audio_metadata_=null,this.aac_last_incomplete_data_=null,this.video_track_=null,this.audio_track_=null,R.prototype.destroy.call(this)},A.probe=function(j){var w=new Uint8Array(j),M=-1,G=188;if(w.byteLength<=3*G)return{needMoreData:!0};for(;M===-1;){for(var V=Math.min(1e3,w.byteLength-3*G),Y=0;Y<V;){if(w[Y]===71&&w[Y+G]===71&&w[Y+2*G]===71){M=Y;break}Y++}if(M===-1)if(G===188)G=192;else{if(G!==192)break;G=204}}return M===-1?{match:!1}:(G===192&&M>=4?(d.a.v("TSDemuxer","ts_packet_size = 192, m2ts mode"),M-=4):G===204&&d.a.v("TSDemuxer","ts_packet_size = 204, RS encoded MPEG2-TS stream"),{match:!0,consumed:0,ts_packet_size:G,sync_offset:M})},A.prototype.bindDataSource=function(j){return j.onDataArrival=this.parseChunks.bind(this),this},A.prototype.resetMediaInfo=function(){this.media_info_=new u.a},A.prototype.parseChunks=function(j,w){if(!(this.onError&&this.onMediaInfo&&this.onTrackMetadata&&this.onDataAvailable))throw new b.a("onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var M=0;for(this.first_parse_&&(this.first_parse_=!1,M=this.sync_offset_);M+this.ts_packet_size_<=j.byteLength;){var G=w+M;this.ts_packet_size_===192&&(M+=4);var V=new Uint8Array(j,M,188),Y=V[0];if(Y!==71){d.a.e(this.TAG,"sync_byte = ".concat(Y,", not 0x47"));break}var ne=(64&V[1])>>>6,se=(V[1],(31&V[1])<<8|V[2]),le=(48&V[3])>>>4,he=15&V[3],ce=!(!this.pmt_||this.pmt_.pcr_pid!==se),me={},Te=4;if(le==2||le==3){var Pe=V[4];if(Pe>0&&(ce||le==3)&&(me.discontinuity_indicator=(128&V[5])>>>7,me.random_access_indicator=(64&V[5])>>>6,me.elementary_stream_priority_indicator=(32&V[5])>>>5,(16&V[5])>>>4)){var De=300*this.getPcrBase(V)+((1&V[10])<<8|V[11]);this.last_pcr_=De}if(le==2||5+Pe===188){M+=188,this.ts_packet_size_===204&&(M+=16);continue}Te=5+Pe}if(le==1||le==3){if(se===0||se===this.current_pmt_pid_||this.pmt_!=null&&this.pmt_.pid_stream_type[se]===D.kSCTE35){var Je=188-Te;this.handleSectionSlice(j,M+Te,Je,{pid:se,file_position:G,payload_unit_start_indicator:ne,continuity_conunter:he,random_access_indicator:me.random_access_indicator})}else if(this.pmt_!=null&&this.pmt_.pid_stream_type[se]!=null){Je=188-Te;var Ye=this.pmt_.pid_stream_type[se];se!==this.pmt_.common_pids.h264&&se!==this.pmt_.common_pids.h265&&se!==this.pmt_.common_pids.av1&&se!==this.pmt_.common_pids.adts_aac&&se!==this.pmt_.common_pids.loas_aac&&se!==this.pmt_.common_pids.ac3&&se!==this.pmt_.common_pids.eac3&&se!==this.pmt_.common_pids.opus&&se!==this.pmt_.common_pids.mp3&&this.pmt_.pes_private_data_pids[se]!==!0&&this.pmt_.timed_id3_pids[se]!==!0&&this.pmt_.synchronous_klv_pids[se]!==!0&&this.pmt_.asynchronous_klv_pids[se]!==!0||this.handlePESSlice(j,M+Te,Je,{pid:se,stream_type:Ye,file_position:G,payload_unit_start_indicator:ne,continuity_conunter:he,random_access_indicator:me.random_access_indicator})}}M+=188,this.ts_packet_size_===204&&(M+=16)}return this.dispatchAudioVideoMediaSegment(),M},A.prototype.handleSectionSlice=function(j,w,M,G){var V=new Uint8Array(j,w,M),Y=this.section_slice_queues_[G.pid];if(G.payload_unit_start_indicator){var ne=V[0];if(Y!=null&&Y.total_length!==0){var se=new Uint8Array(j,w+1,Math.min(M,ne));Y.slices.push(se),Y.total_length+=se.byteLength,Y.total_length===Y.expected_length?this.emitSectionSlices(Y,G):this.clearSlices(Y,G)}for(var le=1+ne;le<V.byteLength&&V[le+0]!==255;){var he=(15&V[le+1])<<8|V[le+2];this.section_slice_queues_[G.pid]=new te,(Y=this.section_slice_queues_[G.pid]).expected_length=he+3,Y.file_position=G.file_position,Y.random_access_indicator=G.random_access_indicator,se=new Uint8Array(j,w+le,Math.min(M-le,Y.expected_length-Y.total_length)),Y.slices.push(se),Y.total_length+=se.byteLength,Y.total_length===Y.expected_length?this.emitSectionSlices(Y,G):Y.total_length>=Y.expected_length&&this.clearSlices(Y,G),le+=se.byteLength}}else Y!=null&&Y.total_length!==0&&(se=new Uint8Array(j,w,Math.min(M,Y.expected_length-Y.total_length)),Y.slices.push(se),Y.total_length+=se.byteLength,Y.total_length===Y.expected_length?this.emitSectionSlices(Y,G):Y.total_length>=Y.expected_length&&this.clearSlices(Y,G))},A.prototype.handlePESSlice=function(j,w,M,G){var V=new Uint8Array(j,w,M),Y=V[0]<<16|V[1]<<8|V[2],ne=(V[3],V[4]<<8|V[5]);if(G.payload_unit_start_indicator){if(Y!==1)return void d.a.e(this.TAG,"handlePESSlice: packet_start_code_prefix should be 1 but with value ".concat(Y));var se=this.pes_slice_queues_[G.pid];se&&(se.expected_length===0||se.expected_length===se.total_length?this.emitPESSlices(se,G):this.clearSlices(se,G)),this.pes_slice_queues_[G.pid]=new te,this.pes_slice_queues_[G.pid].file_position=G.file_position,this.pes_slice_queues_[G.pid].random_access_indicator=G.random_access_indicator}if(this.pes_slice_queues_[G.pid]!=null){var le=this.pes_slice_queues_[G.pid];le.slices.push(V),G.payload_unit_start_indicator&&(le.expected_length=ne===0?0:ne+6),le.total_length+=V.byteLength,le.expected_length>0&&le.expected_length===le.total_length?this.emitPESSlices(le,G):le.expected_length>0&&le.expected_length<le.total_length&&this.clearSlices(le,G)}},A.prototype.emitSectionSlices=function(j,w){for(var M=new Uint8Array(j.total_length),G=0,V=0;G<j.slices.length;G++){var Y=j.slices[G];M.set(Y,V),V+=Y.byteLength}j.slices=[],j.expected_length=-1,j.total_length=0;var ne=new ae;ne.pid=w.pid,ne.data=M,ne.file_position=j.file_position,ne.random_access_indicator=j.random_access_indicator,this.parseSection(ne)},A.prototype.emitPESSlices=function(j,w){for(var M=new Uint8Array(j.total_length),G=0,V=0;G<j.slices.length;G++){var Y=j.slices[G];M.set(Y,V),V+=Y.byteLength}j.slices=[],j.expected_length=-1,j.total_length=0;var ne=new X;ne.pid=w.pid,ne.data=M,ne.stream_type=w.stream_type,ne.file_position=j.file_position,ne.random_access_indicator=j.random_access_indicator,this.parsePES(ne)},A.prototype.clearSlices=function(j,w){j.slices=[],j.expected_length=-1,j.total_length=0},A.prototype.parseSection=function(j){var w=j.data,M=j.pid;M===0?this.parsePAT(w):M===this.current_pmt_pid_?this.parsePMT(w):this.pmt_!=null&&this.pmt_.scte_35_pids[M]&&this.parseSCTE35(w)},A.prototype.parsePES=function(j){var w=j.data,M=w[0]<<16|w[1]<<8|w[2],G=w[3],V=w[4]<<8|w[5];if(M===1)if(G!==188&&G!==190&&G!==191&&G!==240&&G!==241&&G!==255&&G!==242&&G!==248){w[6];var Y=(192&w[7])>>>6,ne=w[8],se=void 0,le=void 0;Y!==2&&Y!==3||(se=this.getTimestamp(w,9),le=Y===3?this.getTimestamp(w,14):se);var he=9+ne,ce=void 0;if(V!==0){if(V<3+ne)return void d.a.v(this.TAG,"Malformed PES: PES_packet_length < 3 + PES_header_data_length");ce=V-3-ne}else ce=w.byteLength-he;var me=w.subarray(he,he+ce);switch(j.stream_type){case D.kMPEG1Audio:case D.kMPEG2Audio:this.parseMP3Payload(me,se);break;case D.kPESPrivateData:this.pmt_.common_pids.av1===j.pid?this.parseAV1Payload(me,se,le,j.file_position,j.random_access_indicator):this.pmt_.common_pids.opus===j.pid?this.parseOpusPayload(me,se):this.pmt_.common_pids.ac3===j.pid?this.parseAC3Payload(me,se):this.pmt_.common_pids.eac3===j.pid?this.parseEAC3Payload(me,se):this.pmt_.asynchronous_klv_pids[j.pid]?this.parseAsynchronousKLVMetadataPayload(me,j.pid,G):this.pmt_.smpte2038_pids[j.pid]?this.parseSMPTE2038MetadataPayload(me,se,le,j.pid,G):this.parsePESPrivateDataPayload(me,se,le,j.pid,G);break;case D.kADTSAAC:this.parseADTSAACPayload(me,se);break;case D.kLOASAAC:this.parseLOASAACPayload(me,se);break;case D.kAC3:this.parseAC3Payload(me,se);break;case D.kEAC3:this.parseEAC3Payload(me,se);break;case D.kMetadata:this.pmt_.timed_id3_pids[j.pid]?this.parseTimedID3MetadataPayload(me,se,le,j.pid,G):this.pmt_.synchronous_klv_pids[j.pid]&&this.parseSynchronousKLVMetadataPayload(me,se,le,j.pid,G);break;case D.kH264:this.parseH264Payload(me,se,le,j.file_position,j.random_access_indicator);break;case D.kH265:this.parseH265Payload(me,se,le,j.file_position,j.random_access_indicator)}}else(G===188||G===191||G===240||G===241||G===255||G===242||G===248)&&j.stream_type===D.kPESPrivateData&&(he=6,ce=void 0,ce=V!==0?V:w.byteLength-he,me=w.subarray(he,he+ce),this.parsePESPrivateDataPayload(me,void 0,void 0,j.pid,G));else d.a.e(this.TAG,"parsePES: packet_start_code_prefix should be 1 but with value ".concat(M))},A.prototype.parsePAT=function(j){var w=j[0];if(w===0){var M=(15&j[1])<<8|j[2],G=(j[3],j[4],(62&j[5])>>>1),V=1&j[5],Y=j[6],ne=(j[7],null);if(V===1&&Y===0)(ne=new ie).version_number=G;else if((ne=this.pat_)==null)return;for(var se=M-5-4,le=-1,he=-1,ce=8;ce<8+se;ce+=4){var me=j[ce]<<8|j[ce+1],Te=(31&j[ce+2])<<8|j[ce+3];me===0?ne.network_pid=Te:(ne.program_pmt_pid[me]=Te,le===-1&&(le=me),he===-1&&(he=Te))}V===1&&Y===0&&(this.pat_==null&&d.a.v(this.TAG,"Parsed first PAT: ".concat(JSON.stringify(ne))),this.pat_=ne,this.current_program_=le,this.current_pmt_pid_=he)}else d.a.e(this.TAG,"parsePAT: table_id ".concat(w," is not corresponded to PAT!"))},A.prototype.parsePMT=function(j){var w=j[0];if(w===2){var M=(15&j[1])<<8|j[2],G=j[3]<<8|j[4],V=(62&j[5])>>>1,Y=1&j[5],ne=j[6],se=(j[7],null);if(Y===1&&ne===0)(se=new z).program_number=G,se.version_number=V,this.program_pmt_map_[G]=se;else if((se=this.program_pmt_map_[G])==null)return;se.pcr_pid=(31&j[8])<<8|j[9];for(var le=(15&j[10])<<8|j[11],he=12+le,ce=M-9-le-4,me=he;me<he+ce;){var Te=j[me],Pe=(31&j[me+1])<<8|j[me+2],De=(15&j[me+3])<<8|j[me+4];se.pid_stream_type[Pe]=Te;var Je=se.common_pids.h264||se.common_pids.h265,Ye=se.common_pids.adts_aac||se.common_pids.loas_aac||se.common_pids.ac3||se.common_pids.eac3||se.common_pids.opus||se.common_pids.mp3;if(Te!==D.kH264||Je)if(Te!==D.kH265||Je)if(Te!==D.kADTSAAC||Ye)if(Te!==D.kLOASAAC||Ye)if(Te!==D.kAC3||Ye)if(Te!==D.kEAC3||Ye)if(Te!==D.kMPEG1Audio&&Te!==D.kMPEG2Audio||Ye)if(Te===D.kPESPrivateData){if(se.pes_private_data_pids[Pe]=!0,De>0){for(var qe=me+5;qe<me+5+De;){var ht=j[qe+0],wt=j[qe+1];if(ht===5){var Qe=String.fromCharCode.apply(String,Array.from(j.subarray(qe+2,qe+2+wt)));Qe==="VANC"?se.smpte2038_pids[Pe]=!0:Qe==="AV01"?se.common_pids.av1=Pe:Qe==="Opus"?se.common_pids.opus=Pe:Qe==="KLVA"&&(se.asynchronous_klv_pids[Pe]=!0)}else if(ht===127){if(Pe===se.common_pids.opus){var lt=null;if(j[qe+2]===128&&(lt=j[qe+3]),lt==null){d.a.e(this.TAG,"Not Supported Opus channel count.");continue}var vt={codec:"opus",channel_count:(15&lt)==0?2:15&lt,channel_config_code:lt,sample_rate:48e3},dt={codec:"opus",meta:vt};this.audio_init_segment_dispatched_==0?(this.audio_metadata_=vt,this.dispatchAudioInitSegment(dt)):this.detectAudioMetadataChange(dt)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(dt))}}else ht===128&&Pe===se.common_pids.av1&&(this.video_metadata_.av1c=j.subarray(qe+2,qe+2+wt));qe+=2+wt}var ct=j.subarray(me+5,me+5+De);this.dispatchPESPrivateDataDescriptor(Pe,Te,ct)}}else if(Te===D.kMetadata){if(De>0)for(qe=me+5;qe<me+5+De;){ht=j[qe+0];var _t=j[qe+1];if(ht===38){var Yt=j[qe+2]<<8|j[qe+3]<<0,yt=null;Yt===65535&&(yt=String.fromCharCode.apply(String,Array.from(j.subarray(qe+4,qe+4+4))));var Tt=null;if(j[qe+4+(Yt===65535?4:0)]===255){var Zt=4+(Yt===65535?4:0)+1;Tt=String.fromCharCode.apply(String,Array.from(j.subarray(qe+Zt,qe+Zt+4)))}yt==="ID3 "&&Tt==="ID3 "?se.timed_id3_pids[Pe]=!0:Tt==="KLVA"&&(se.synchronous_klv_pids[Pe]=!0)}qe+=2+_t}}else Te===D.kSCTE35&&(se.scte_35_pids[Pe]=!0);else se.common_pids.mp3=Pe;else se.common_pids.eac3=Pe;else se.common_pids.ac3=Pe;else se.common_pids.loas_aac=Pe;else se.common_pids.adts_aac=Pe;else se.common_pids.h265=Pe;else se.common_pids.h264=Pe;me+=5+De}G===this.current_program_&&(this.pmt_==null&&d.a.v(this.TAG,"Parsed first PMT: ".concat(JSON.stringify(se))),this.pmt_=se,(se.common_pids.h264||se.common_pids.h265||se.common_pids.av1)&&(this.has_video_=!0),(se.common_pids.adts_aac||se.common_pids.loas_aac||se.common_pids.ac3||se.common_pids.opus||se.common_pids.mp3)&&(this.has_audio_=!0))}else d.a.e(this.TAG,"parsePMT: table_id ".concat(w," is not corresponded to PMT!"))},A.prototype.parseSCTE35=function(j){var w=An(j);if(w.pts!=null){var M=Math.floor(w.pts/this.timescale_);w.pts=M}else w.nearest_pts=this.getNearestTimestampMilliseconds();this.onSCTE35Metadata&&this.onSCTE35Metadata(w)},A.prototype.parseAV1Payload=function(j,w,M,G,V){for(var Y=new Jt(j),ne=null,se=[],le=0,he=!1,ce=null;(ne=Y.readNextOBUPayload())!=null;){if((ce=I.parseOBUs(ne,this.video_metadata_.details))&&ce.keyframe===!0)if(this.video_init_segment_dispatched_){if(this.detectVideoMetadataChange(null,ce)===!0){var me;this.video_metadata_changed_=!0,this.dispatchVideoMediaSegment(),(me=new Uint8Array(new ArrayBuffer(this.video_metadata_.av1c.byteLength+ce.sequence_header_data.byteLength))).set(this.video_metadata_.av1c,0),me.set(ce.sequence_header_data,this.video_metadata_.av1c.byteLength),ce.av1c=me,this.dispatchVideoInitSegment()}}else(me=new Uint8Array(new ArrayBuffer(this.video_metadata_.av1c.byteLength+ce.sequence_header_data.byteLength))).set(this.video_metadata_.av1c,0),me.set(ce.sequence_header_data,this.video_metadata_.av1c.byteLength),ce.av1c=me,this.video_metadata_.details=ce,this.dispatchVideoInitSegment();this.video_metadata_.details=ce,he||(he=ce.keyframe),se.push({data:ne}),le+=ne.byteLength}var Te=Math.floor(w/this.timescale_),Pe=Math.floor(M/this.timescale_);if(se.length){var De=this.video_track_,Je={units:se,length:le,isKeyframe:he,dts:Pe,pts:Te,cts:Te-Pe,file_position:G};De.samples.push(Je),De.length+=le}},A.prototype.parseH264Payload=function(j,w,M,G,V){for(var Y=new oe(j),ne=null,se=[],le=0,he=!1;(ne=Y.readNextNaluPayload())!=null;){var ce=new J(ne);if(ce.type===Z.kSliceSPS){var me=N.parseSPS(ne.data);this.video_init_segment_dispatched_?this.detectVideoMetadataChange(ce,me)===!0&&(d.a.v(this.TAG,"H264: Critical h264 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:ce,pps:void 0,av1c:void 0,details:me}):(this.video_metadata_.sps=ce,this.video_metadata_.details=me)}else ce.type===Z.kSlicePPS?this.video_init_segment_dispatched_&&!this.video_metadata_changed_||(this.video_metadata_.pps=ce,this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):(ce.type===Z.kSliceIDR||ce.type===Z.kSliceNonIDR&&V===1)&&(he=!0);this.video_init_segment_dispatched_&&(se.push(ce),le+=ce.data.byteLength)}var Te=Math.floor(w/this.timescale_),Pe=Math.floor(M/this.timescale_);if(se.length){var De=this.video_track_,Je={units:se,length:le,isKeyframe:he,dts:Pe,pts:Te,cts:Te-Pe,file_position:G};De.samples.push(Je),De.length+=le}},A.prototype.parseH265Payload=function(j,w,M,G,V){for(var Y=new Un(j),ne=null,se=[],le=0,he=!1;(ne=Y.readNextNaluPayload())!=null;){var ce=new Sa(ne);if(ce.type===We.kSliceVPS){if(!this.video_init_segment_dispatched_){var me=T.parseVPS(ne.data);this.video_metadata_.vps=ce,this.video_metadata_.details=Ea(Ea({},this.video_metadata_.details),me)}}else ce.type===We.kSliceSPS?(me=T.parseSPS(ne.data),this.video_init_segment_dispatched_?this.detectVideoMetadataChange(ce,me)===!0&&(d.a.v(this.TAG,"H265: Critical h265 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:ce,pps:void 0,av1c:void 0,details:me}):(this.video_metadata_.sps=ce,this.video_metadata_.details=Ea(Ea({},this.video_metadata_.details),me))):ce.type===We.kSlicePPS?(!this.video_init_segment_dispatched_||this.video_metadata_changed_)&&(me=T.parsePPS(ne.data),this.video_metadata_.pps=ce,this.video_metadata_.details=Ea(Ea({},this.video_metadata_.details),me),this.video_metadata_.vps&&this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):ce.type!==We.kSliceIDR_W_RADL&&ce.type!==We.kSliceIDR_N_LP&&ce.type!==We.kSliceCRA_NUT||(he=!0);this.video_init_segment_dispatched_&&(se.push(ce),le+=ce.data.byteLength)}var Te=Math.floor(w/this.timescale_),Pe=Math.floor(M/this.timescale_);if(se.length){var De=this.video_track_,Je={units:se,length:le,isKeyframe:he,dts:Pe,pts:Te,cts:Te-Pe,file_position:G};De.samples.push(Je),De.length+=le}},A.prototype.detectVideoMetadataChange=function(j,w){if(w.codec_mimetype!==this.video_metadata_.details.codec_mimetype)return d.a.v(this.TAG,"Video: Codec mimeType changed from "+"".concat(this.video_metadata_.details.codec_mimetype," to ").concat(w.codec_mimetype)),!0;if(w.codec_size.width!==this.video_metadata_.details.codec_size.width||w.codec_size.height!==this.video_metadata_.details.codec_size.height){var M=this.video_metadata_.details.codec_size,G=w.codec_size;return d.a.v(this.TAG,"Video: Coded Resolution changed from "+"".concat(M.width,"x").concat(M.height," to ").concat(G.width,"x").concat(G.height)),!0}return w.present_size.width!==this.video_metadata_.details.present_size.width&&(d.a.v(this.TAG,"Video: Present resolution width changed from "+"".concat(this.video_metadata_.details.present_size.width," to ").concat(w.present_size.width)),!0)},A.prototype.isInitSegmentDispatched=function(){return this.has_video_&&this.has_audio_?this.video_init_segment_dispatched_&&this.audio_init_segment_dispatched_:this.has_video_&&!this.has_audio_?this.video_init_segment_dispatched_:!(this.has_video_||!this.has_audio_)&&this.audio_init_segment_dispatched_},A.prototype.dispatchVideoInitSegment=function(){var j=this.video_metadata_.details,w={type:"video"};w.id=this.video_track_.id,w.timescale=1e3,w.duration=this.duration_,w.codecWidth=j.codec_size.width,w.codecHeight=j.codec_size.height,w.presentWidth=j.present_size.width,w.presentHeight=j.present_size.height,w.profile=j.profile_string,w.level=j.level_string,w.bitDepth=j.bit_depth,w.chromaFormat=j.chroma_format,w.sarRatio=j.sar_ratio,w.frameRate=j.frame_rate;var M=w.frameRate.fps_den,G=w.frameRate.fps_num;if(w.refSampleDuration=M/G*1e3,w.codec=j.codec_mimetype,this.video_metadata_.av1c)w.av1c=this.video_metadata_.av1c,this.video_init_segment_dispatched_==0&&d.a.v(this.TAG,"Generated first AV1 for mimeType: ".concat(w.codec));else if(this.video_metadata_.vps){var V=this.video_metadata_.vps.data.subarray(4),Y=this.video_metadata_.sps.data.subarray(4),ne=this.video_metadata_.pps.data.subarray(4),se=new on(V,Y,ne,j);w.hvcc=se.getData(),this.video_init_segment_dispatched_==0&&d.a.v(this.TAG,"Generated first HEVCDecoderConfigurationRecord for mimeType: ".concat(w.codec))}else{Y=this.video_metadata_.sps.data.subarray(4),ne=this.video_metadata_.pps.data.subarray(4);var le=new be(Y,ne,j);w.avcc=le.getData(),this.video_init_segment_dispatched_==0&&d.a.v(this.TAG,"Generated first AVCDecoderConfigurationRecord for mimeType: ".concat(w.codec))}this.onTrackMetadata("video",w),this.video_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var he=this.media_info_;he.hasVideo=!0,he.width=w.codecWidth,he.height=w.codecHeight,he.fps=w.frameRate.fps,he.profile=w.profile,he.level=w.level,he.refFrames=j.ref_frames,he.chromaFormat=j.chroma_format_string,he.sarNum=w.sarRatio.width,he.sarDen=w.sarRatio.height,he.videoCodec=w.codec,he.hasAudio&&he.audioCodec?he.mimeType='video/mp2t; codecs="'.concat(he.videoCodec,",").concat(he.audioCodec,'"'):he.mimeType='video/mp2t; codecs="'.concat(he.videoCodec,'"'),he.isComplete()&&this.onMediaInfo(he)},A.prototype.dispatchVideoMediaSegment=function(){this.isInitSegmentDispatched()&&this.video_track_.length&&this.onDataAvailable(null,this.video_track_)},A.prototype.dispatchAudioMediaSegment=function(){this.isInitSegmentDispatched()&&this.audio_track_.length&&this.onDataAvailable(this.audio_track_,null)},A.prototype.dispatchAudioVideoMediaSegment=function(){this.isInitSegmentDispatched()&&(this.audio_track_.length||this.video_track_.length)&&this.onDataAvailable(this.audio_track_,this.video_track_)},A.prototype.parseADTSAACPayload=function(j,w){if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var M=new Uint8Array(j.byteLength+this.aac_last_incomplete_data_.byteLength);M.set(this.aac_last_incomplete_data_,0),M.set(j,this.aac_last_incomplete_data_.byteLength),j=M}var G,V;if(w!=null&&(V=w/this.timescale_),this.audio_metadata_.codec==="aac"){if(w==null&&this.audio_last_sample_pts_!=null)G=1024/this.audio_metadata_.sampling_frequency*1e3,V=this.audio_last_sample_pts_+G;else if(w==null)return void d.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.audio_last_sample_pts_){G=1024/this.audio_metadata_.sampling_frequency*1e3;var Y=this.audio_last_sample_pts_+G;Math.abs(Y-V)>1&&(d.a.w(this.TAG,"AAC: Detected pts overlapped, "+"expected: ".concat(Y,"ms, PES pts: ").concat(V,"ms")),V=Y)}}for(var ne,se=new Xe(j),le=null,he=V;(le=se.readNextAACFrame())!=null;){G=1024/le.sampling_frequency*1e3;var ce={codec:"aac",data:le};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"aac",audio_object_type:le.audio_object_type,sampling_freq_index:le.sampling_freq_index,sampling_frequency:le.sampling_frequency,channel_config:le.channel_config},this.dispatchAudioInitSegment(ce)):this.detectAudioMetadataChange(ce)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(ce)),ne=he;var me=Math.floor(he),Te={unit:le.data,length:le.data.byteLength,pts:me,dts:me};this.audio_track_.samples.push(Te),this.audio_track_.length+=le.data.byteLength,he+=G}se.hasIncompleteData()&&(this.aac_last_incomplete_data_=se.getIncompleteData()),ne&&(this.audio_last_sample_pts_=ne)}},A.prototype.parseLOASAACPayload=function(j,w){var M;if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var G=new Uint8Array(j.byteLength+this.aac_last_incomplete_data_.byteLength);G.set(this.aac_last_incomplete_data_,0),G.set(j,this.aac_last_incomplete_data_.byteLength),j=G}var V,Y;if(w!=null&&(Y=w/this.timescale_),this.audio_metadata_.codec==="aac"){if(w==null&&this.audio_last_sample_pts_!=null)V=1024/this.audio_metadata_.sampling_frequency*1e3,Y=this.audio_last_sample_pts_+V;else if(w==null)return void d.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.audio_last_sample_pts_){V=1024/this.audio_metadata_.sampling_frequency*1e3;var ne=this.audio_last_sample_pts_+V;Math.abs(ne-Y)>1&&(d.a.w(this.TAG,"AAC: Detected pts overlapped, "+"expected: ".concat(ne,"ms, PES pts: ").concat(Y,"ms")),Y=ne)}}for(var se,le=new ue(j),he=null,ce=Y;(he=le.readNextAACFrame((M=this.loas_previous_frame)!==null&&M!==void 0?M:void 0))!=null;){this.loas_previous_frame=he,V=1024/he.sampling_frequency*1e3;var me={codec:"aac",data:he};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"aac",audio_object_type:he.audio_object_type,sampling_freq_index:he.sampling_freq_index,sampling_frequency:he.sampling_frequency,channel_config:he.channel_config},this.dispatchAudioInitSegment(me)):this.detectAudioMetadataChange(me)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(me)),se=ce;var Te=Math.floor(ce),Pe={unit:he.data,length:he.data.byteLength,pts:Te,dts:Te};this.audio_track_.samples.push(Pe),this.audio_track_.length+=he.data.byteLength,ce+=V}le.hasIncompleteData()&&(this.aac_last_incomplete_data_=le.getIncompleteData()),se&&(this.audio_last_sample_pts_=se)}},A.prototype.parseAC3Payload=function(j,w){if(!this.has_video_||this.video_init_segment_dispatched_){var M,G;if(w!=null&&(G=w/this.timescale_),this.audio_metadata_.codec==="ac-3"){if(w==null&&this.audio_last_sample_pts_!=null)M=1536/this.audio_metadata_.sampling_frequency*1e3,G=this.audio_last_sample_pts_+M;else if(w==null)return void d.a.w(this.TAG,"AC3: Unknown pts")}for(var V,Y=new ja(j),ne=null,se=G;(ne=Y.readNextAC3Frame())!=null;){M=1536/ne.sampling_frequency*1e3;var le={codec:"ac-3",data:ne};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"ac-3",sampling_frequency:ne.sampling_frequency,bit_stream_identification:ne.bit_stream_identification,bit_stream_mode:ne.bit_stream_mode,low_frequency_effects_channel_on:ne.low_frequency_effects_channel_on,channel_mode:ne.channel_mode},this.dispatchAudioInitSegment(le)):this.detectAudioMetadataChange(le)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(le)),V=se;var he=Math.floor(se),ce={unit:ne.data,length:ne.data.byteLength,pts:he,dts:he};this.audio_track_.samples.push(ce),this.audio_track_.length+=ne.data.byteLength,se+=M}V&&(this.audio_last_sample_pts_=V)}},A.prototype.parseEAC3Payload=function(j,w){if(!this.has_video_||this.video_init_segment_dispatched_){var M,G;if(w!=null&&(G=w/this.timescale_),this.audio_metadata_.codec==="ec-3"){if(w==null&&this.audio_last_sample_pts_!=null)M=256*this.audio_metadata_.num_blks/this.audio_metadata_.sampling_frequency*1e3,G=this.audio_last_sample_pts_+M;else if(w==null)return void d.a.w(this.TAG,"EAC3: Unknown pts")}for(var V,Y=new xe(j),ne=null,se=G;(ne=Y.readNextEAC3Frame())!=null;){M=1536/ne.sampling_frequency*1e3;var le={codec:"ec-3",data:ne};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"ec-3",sampling_frequency:ne.sampling_frequency,bit_stream_identification:ne.bit_stream_identification,low_frequency_effects_channel_on:ne.low_frequency_effects_channel_on,num_blks:ne.num_blks,channel_mode:ne.channel_mode},this.dispatchAudioInitSegment(le)):this.detectAudioMetadataChange(le)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(le)),V=se;var he=Math.floor(se),ce={unit:ne.data,length:ne.data.byteLength,pts:he,dts:he};this.audio_track_.samples.push(ce),this.audio_track_.length+=ne.data.byteLength,se+=M}V&&(this.audio_last_sample_pts_=V)}},A.prototype.parseOpusPayload=function(j,w){if(!this.has_video_||this.video_init_segment_dispatched_){var M,G;if(w!=null&&(G=w/this.timescale_),this.audio_metadata_.codec==="opus"){if(w==null&&this.audio_last_sample_pts_!=null)M=20,G=this.audio_last_sample_pts_+M;else if(w==null)return void d.a.w(this.TAG,"Opus: Unknown pts")}for(var V,Y=G,ne=0;ne<j.length;){M=20;for(var se=(16&j[ne+1])!=0,le=(8&j[ne+1])!=0,he=ne+2,ce=0;j[he]===255;)ce+=255,he+=1;ce+=j[he],he+=1,he+=se?2:0,he+=le?2:0,V=Y;var me=Math.floor(Y),Te=j.slice(he,he+ce),Pe={unit:Te,length:Te.byteLength,pts:me,dts:me};this.audio_track_.samples.push(Pe),this.audio_track_.length+=Te.byteLength,Y+=M,ne=he+ce}V&&(this.audio_last_sample_pts_=V)}},A.prototype.parseMP3Payload=function(j,w){if(!this.has_video_||this.video_init_segment_dispatched_){var M=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],G=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],V=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],Y=j[1]>>>3&3,ne=(6&j[1])>>1,se=(240&j[2])>>>4,le=(12&j[2])>>>2,he=(j[3]>>>6&3)!==3?2:1,ce=0,me=34;switch(Y){case 0:ce=[11025,12e3,8e3,0][le];break;case 2:ce=[22050,24e3,16e3,0][le];break;case 3:ce=[44100,48e3,32e3,0][le]}switch(ne){case 1:me=34,se<V.length&&V[se];break;case 2:me=33,se<G.length&&G[se];break;case 3:me=32,se<M.length&&M[se]}var Te=new we;Te.object_type=me,Te.sample_rate=ce,Te.channel_count=he,Te.data=j;var Pe={codec:"mp3",data:Te};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"mp3",object_type:me,sample_rate:ce,channel_count:he},this.dispatchAudioInitSegment(Pe)):this.detectAudioMetadataChange(Pe)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(Pe));var De={unit:j,length:j.byteLength,pts:w/this.timescale_,dts:w/this.timescale_};this.audio_track_.samples.push(De),this.audio_track_.length+=j.byteLength}},A.prototype.detectAudioMetadataChange=function(j){if(j.codec!==this.audio_metadata_.codec)return d.a.v(this.TAG,"Audio: Audio Codecs changed from "+"".concat(this.audio_metadata_.codec," to ").concat(j.codec)),!0;if(j.codec==="aac"&&this.audio_metadata_.codec==="aac"){if((w=j.data).audio_object_type!==this.audio_metadata_.audio_object_type)return d.a.v(this.TAG,"AAC: AudioObjectType changed from "+"".concat(this.audio_metadata_.audio_object_type," to ").concat(w.audio_object_type)),!0;if(w.sampling_freq_index!==this.audio_metadata_.sampling_freq_index)return d.a.v(this.TAG,"AAC: SamplingFrequencyIndex changed from "+"".concat(this.audio_metadata_.sampling_freq_index," to ").concat(w.sampling_freq_index)),!0;if(w.channel_config!==this.audio_metadata_.channel_config)return d.a.v(this.TAG,"AAC: Channel configuration changed from "+"".concat(this.audio_metadata_.channel_config," to ").concat(w.channel_config)),!0}else if(j.codec==="ac-3"&&this.audio_metadata_.codec==="ac-3"){var w;if((w=j.data).sampling_frequency!==this.audio_metadata_.sampling_frequency)return d.a.v(this.TAG,"AC3: Sampling Frequency changed from "+"".concat(this.audio_metadata_.sampling_frequency," to ").concat(w.sampling_frequency)),!0;if(w.bit_stream_identification!==this.audio_metadata_.bit_stream_identification)return d.a.v(this.TAG,"AC3: Bit Stream Identification changed from "+"".concat(this.audio_metadata_.bit_stream_identification," to ").concat(w.bit_stream_identification)),!0;if(w.bit_stream_mode!==this.audio_metadata_.bit_stream_mode)return d.a.v(this.TAG,"AC3: BitStream Mode changed from "+"".concat(this.audio_metadata_.bit_stream_mode," to ").concat(w.bit_stream_mode)),!0;if(w.channel_mode!==this.audio_metadata_.channel_mode)return d.a.v(this.TAG,"AC3: Channel Mode changed from "+"".concat(this.audio_metadata_.channel_mode," to ").concat(w.channel_mode)),!0;if(w.low_frequency_effects_channel_on!==this.audio_metadata_.low_frequency_effects_channel_on)return d.a.v(this.TAG,"AC3: Low Frequency Effects Channel On changed from "+"".concat(this.audio_metadata_.low_frequency_effects_channel_on," to ").concat(w.low_frequency_effects_channel_on)),!0}else if(j.codec==="opus"&&this.audio_metadata_.codec==="opus"){if((M=j.meta).sample_rate!==this.audio_metadata_.sample_rate)return d.a.v(this.TAG,"Opus: SamplingFrequencyIndex changed from "+"".concat(this.audio_metadata_.sample_rate," to ").concat(M.sample_rate)),!0;if(M.channel_count!==this.audio_metadata_.channel_count)return d.a.v(this.TAG,"Opus: Channel count changed from "+"".concat(this.audio_metadata_.channel_count," to ").concat(M.channel_count)),!0}else if(j.codec==="mp3"&&this.audio_metadata_.codec==="mp3"){var M;if((M=j.data).object_type!==this.audio_metadata_.object_type)return d.a.v(this.TAG,"MP3: AudioObjectType changed from "+"".concat(this.audio_metadata_.object_type," to ").concat(M.object_type)),!0;if(M.sample_rate!==this.audio_metadata_.sample_rate)return d.a.v(this.TAG,"MP3: SamplingFrequencyIndex changed from "+"".concat(this.audio_metadata_.sample_rate," to ").concat(M.sample_rate)),!0;if(M.channel_count!==this.audio_metadata_.channel_count)return d.a.v(this.TAG,"MP3: Channel count changed from "+"".concat(this.audio_metadata_.channel_count," to ").concat(M.channel_count)),!0}return!1},A.prototype.dispatchAudioInitSegment=function(j){var w={type:"audio"};if(w.id=this.audio_track_.id,w.timescale=1e3,w.duration=this.duration_,this.audio_metadata_.codec==="aac"){var M=j.codec==="aac"?j.data:null,G=new Ge(M);w.audioSampleRate=G.sampling_rate,w.channelCount=G.channel_count,w.codec=G.codec_mimetype,w.originalCodec=G.original_codec_mimetype,w.config=G.config,w.refSampleDuration=1024/w.audioSampleRate*w.timescale}else if(this.audio_metadata_.codec==="ac-3"){var V=j.codec==="ac-3"?j.data:null,Y=new Mo(V);w.audioSampleRate=Y.sampling_rate,w.channelCount=Y.channel_count,w.codec=Y.codec_mimetype,w.originalCodec=Y.original_codec_mimetype,w.config=Y.config,w.refSampleDuration=1536/w.audioSampleRate*w.timescale}else if(this.audio_metadata_.codec==="ec-3"){var ne=j.codec==="ec-3"?j.data:null,se=new He(ne);w.audioSampleRate=se.sampling_rate,w.channelCount=se.channel_count,w.codec=se.codec_mimetype,w.originalCodec=se.original_codec_mimetype,w.config=se.config,w.refSampleDuration=256*se.num_blks/w.audioSampleRate*w.timescale}else this.audio_metadata_.codec==="opus"?(w.audioSampleRate=this.audio_metadata_.sample_rate,w.channelCount=this.audio_metadata_.channel_count,w.channelConfigCode=this.audio_metadata_.channel_config_code,w.codec="opus",w.originalCodec="opus",w.config=void 0,w.refSampleDuration=20):this.audio_metadata_.codec==="mp3"&&(w.audioSampleRate=this.audio_metadata_.sample_rate,w.channelCount=this.audio_metadata_.channel_count,w.codec="mp3",w.originalCodec="mp3",w.config=void 0);this.audio_init_segment_dispatched_==0&&d.a.v(this.TAG,"Generated first AudioSpecificConfig for mimeType: ".concat(w.codec)),this.onTrackMetadata("audio",w),this.audio_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var le=this.media_info_;le.hasAudio=!0,le.audioCodec=w.originalCodec,le.audioSampleRate=w.audioSampleRate,le.audioChannelCount=w.channelCount,le.hasVideo&&le.videoCodec?le.mimeType='video/mp2t; codecs="'.concat(le.videoCodec,",").concat(le.audioCodec,'"'):le.mimeType='video/mp2t; codecs="'.concat(le.audioCodec,'"'),le.isComplete()&&this.onMediaInfo(le)},A.prototype.dispatchPESPrivateDataDescriptor=function(j,w,M){var G=new bt;G.pid=j,G.stream_type=w,G.descriptor=M,this.onPESPrivateDataDescriptor&&this.onPESPrivateDataDescriptor(G)},A.prototype.parsePESPrivateDataPayload=function(j,w,M,G,V){var Y=new Ve;if(Y.pid=G,Y.stream_id=V,Y.len=j.byteLength,Y.data=j,w!=null){var ne=Math.floor(w/this.timescale_);Y.pts=ne}else Y.nearest_pts=this.getNearestTimestampMilliseconds();if(M!=null){var se=Math.floor(M/this.timescale_);Y.dts=se}this.onPESPrivateData&&this.onPESPrivateData(Y)},A.prototype.parseTimedID3MetadataPayload=function(j,w,M,G,V){var Y=new Ve;if(Y.pid=G,Y.stream_id=V,Y.len=j.byteLength,Y.data=j,w!=null){var ne=Math.floor(w/this.timescale_);Y.pts=ne}if(M!=null){var se=Math.floor(M/this.timescale_);Y.dts=se}this.onTimedID3Metadata&&this.onTimedID3Metadata(Y)},A.prototype.parseSynchronousKLVMetadataPayload=function(j,w,M,G,V){var Y=new tt;if(Y.pid=G,Y.stream_id=V,Y.len=j.byteLength,Y.data=j,w!=null){var ne=Math.floor(w/this.timescale_);Y.pts=ne}if(M!=null){var se=Math.floor(M/this.timescale_);Y.dts=se}Y.access_units=(function(le){for(var he=[],ce=0;ce+5<le.byteLength;){var me=le[ce+0],Te=le[ce+1],Pe=le[ce+2],De=le[ce+3]<<8|le[ce+4]<<0,Je=le.slice(ce+5,ce+5+De);he.push({service_id:me,sequence_number:Te,flags:Pe,data:Je}),ce+=5+De}return he})(j),this.onSynchronousKLVMetadata&&this.onSynchronousKLVMetadata(Y)},A.prototype.parseAsynchronousKLVMetadataPayload=function(j,w,M){var G=new Ve;G.pid=w,G.stream_id=M,G.len=j.byteLength,G.data=j,this.onAsynchronousKLVMetadata&&this.onAsynchronousKLVMetadata(G)},A.prototype.parseSMPTE2038MetadataPayload=function(j,w,M,G,V){var Y=new Ps;if(Y.pid=G,Y.stream_id=V,Y.len=j.byteLength,Y.data=j,w!=null){var ne=Math.floor(w/this.timescale_);Y.pts=ne}if(Y.nearest_pts=this.getNearestTimestampMilliseconds(),M!=null){var se=Math.floor(M/this.timescale_);Y.dts=se}Y.ancillaries=(function(le){for(var he=new _(le),ce=0,me=[];ce+=6,he.readBits(6)===0;){var Te=he.readBool();ce+=1;var Pe=he.readBits(11);ce+=11;var De=he.readBits(12);ce+=12;var Je=255&he.readBits(10);ce+=10;var Ye=255&he.readBits(10);ce+=10;var qe=255&he.readBits(10);ce+=10;for(var ht=new Uint8Array(qe),wt=0;wt<qe;wt++){var Qe=255&he.readBits(10);ce+=10,ht[wt]=Qe}he.readBits(10),ce+=10;var lt="User Defined";Je===65?Ye===7&&(lt="SCTE-104"):Je===95?Ye===220?lt="ARIB STD-B37 (1SEG)":Ye===221?lt="ARIB STD-B37 (ANALOG)":Ye===222?lt="ARIB STD-B37 (SD)":Ye===223&&(lt="ARIB STD-B37 (HD)"):Je===97&&(Ye===1?lt="EIA-708":Ye===2&&(lt="EIA-608")),me.push({yc_indicator:Te,line_number:Pe,horizontal_offset:De,did:Je,sdid:Ye,user_data:ht,description:lt,information:{}}),he.readBits(8-(ce-Math.floor(ce/8))%8),ce+=(8-(ce-Math.floor(ce/8)))%8}return he.destroy(),he=null,me})(j),this.onSMPTE2038Metadata&&this.onSMPTE2038Metadata(Y)},A.prototype.getNearestTimestampMilliseconds=function(){return this.audio_last_sample_pts_!=null?Math.floor(this.audio_last_sample_pts_):this.last_pcr_!=null?Math.floor(this.last_pcr_/300/this.timescale_):void 0},A.prototype.getPcrBase=function(j){var w=33554432*j[6]+131072*j[7]+512*j[8]+2*j[9]+(128&j[10])/128+this.timestamp_offset_;return w+4294967296<this.last_pcr_base_&&(w+=8589934592,this.timestamp_offset_+=8589934592),this.last_pcr_base_=w,w},A.prototype.getTimestamp=function(j,w){var M=536870912*(14&j[w])+4194304*(255&j[w+1])+16384*(254&j[w+2])+128*(255&j[w+3])+(254&j[w+4])/2+this.timestamp_offset_;return M+4294967296<this.last_pcr_base_&&(M+=8589934592),M},A})(ee),ha=function(R,A,j){for(var w,M=0,G=A.length;M<G;M++)!w&&M in A||(w||(w=Array.prototype.slice.call(A,0,M)),w[M]=A[M]);return R.concat(w||Array.prototype.slice.call(A))},ba=(function(){function R(){}return R.init=function(){for(var A in R.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],hvc1:[],hvcC:[],av01:[],av1C:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[],Opus:[],dOps:[],"ac-3":[],dac3:[],"ec-3":[],dec3:[],fLaC:[],dfLa:[]},R.types)R.types.hasOwnProperty(A)&&(R.types[A]=[A.charCodeAt(0),A.charCodeAt(1),A.charCodeAt(2),A.charCodeAt(3)]);var j=R.constants={};j.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),j.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),j.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),j.STSC=j.STCO=j.STTS,j.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),j.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),j.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),j.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),j.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),j.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},R.box=function(A){for(var j=8,w=null,M=Array.prototype.slice.call(arguments,1),G=M.length,V=0;V<G;V++)j+=M[V].byteLength;(w=new Uint8Array(j))[0]=j>>>24&255,w[1]=j>>>16&255,w[2]=j>>>8&255,w[3]=255&j,w.set(A,4);var Y=8;for(V=0;V<G;V++)w.set(M[V],Y),Y+=M[V].byteLength;return w},R.generateInitSegment=function(A){var j=R.box(R.types.ftyp,R.constants.FTYP),w=R.moov(A),M=new Uint8Array(j.byteLength+w.byteLength);return M.set(j,0),M.set(w,j.byteLength),M},R.moov=function(A){var j=R.mvhd(A.timescale,A.duration),w=R.trak(A),M=R.mvex(A);return R.box(R.types.moov,j,w,M)},R.mvhd=function(A,j){return R.box(R.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,A>>>24&255,A>>>16&255,A>>>8&255,255&A,j>>>24&255,j>>>16&255,j>>>8&255,255&j,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},R.trak=function(A){return R.box(R.types.trak,R.tkhd(A),R.mdia(A))},R.tkhd=function(A){var j=A.id,w=A.duration,M=A.presentWidth,G=A.presentHeight;return R.box(R.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,j>>>24&255,j>>>16&255,j>>>8&255,255&j,0,0,0,0,w>>>24&255,w>>>16&255,w>>>8&255,255&w,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,M>>>8&255,255&M,0,0,G>>>8&255,255&G,0,0]))},R.mdia=function(A){return R.box(R.types.mdia,R.mdhd(A),R.hdlr(A),R.minf(A))},R.mdhd=function(A){var j=A.timescale,w=A.duration;return R.box(R.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,j>>>24&255,j>>>16&255,j>>>8&255,255&j,w>>>24&255,w>>>16&255,w>>>8&255,255&w,85,196,0,0]))},R.hdlr=function(A){var j=null;return j=A.type==="audio"?R.constants.HDLR_AUDIO:R.constants.HDLR_VIDEO,R.box(R.types.hdlr,j)},R.minf=function(A){var j=null;return j=A.type==="audio"?R.box(R.types.smhd,R.constants.SMHD):R.box(R.types.vmhd,R.constants.VMHD),R.box(R.types.minf,j,R.dinf(),R.stbl(A))},R.dinf=function(){return R.box(R.types.dinf,R.box(R.types.dref,R.constants.DREF))},R.stbl=function(A){return R.box(R.types.stbl,R.stsd(A),R.box(R.types.stts,R.constants.STTS),R.box(R.types.stsc,R.constants.STSC),R.box(R.types.stsz,R.constants.STSZ),R.box(R.types.stco,R.constants.STCO))},R.stsd=function(A){return A.type==="audio"?A.codec==="mp3"?R.box(R.types.stsd,R.constants.STSD_PREFIX,R.mp3(A)):A.codec==="ac-3"?R.box(R.types.stsd,R.constants.STSD_PREFIX,R.ac3(A)):A.codec==="ec-3"?R.box(R.types.stsd,R.constants.STSD_PREFIX,R.ec3(A)):A.codec==="opus"?R.box(R.types.stsd,R.constants.STSD_PREFIX,R.Opus(A)):A.codec=="flac"?R.box(R.types.stsd,R.constants.STSD_PREFIX,R.fLaC(A)):R.box(R.types.stsd,R.constants.STSD_PREFIX,R.mp4a(A)):A.type==="video"&&A.codec.startsWith("hvc1")?R.box(R.types.stsd,R.constants.STSD_PREFIX,R.hvc1(A)):A.type==="video"&&A.codec.startsWith("av01")?R.box(R.types.stsd,R.constants.STSD_PREFIX,R.av01(A)):R.box(R.types.stsd,R.constants.STSD_PREFIX,R.avc1(A))},R.mp3=function(A){var j=A.channelCount,w=A.audioSampleRate,M=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,j,0,16,0,0,0,0,w>>>8&255,255&w,0,0]);return R.box(R.types[".mp3"],M)},R.mp4a=function(A){var j=A.channelCount,w=A.audioSampleRate,M=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,j,0,16,0,0,0,0,w>>>8&255,255&w,0,0]);return R.box(R.types.mp4a,M,R.esds(A))},R.ac3=function(A){var j=A.channelCount,w=A.audioSampleRate,M=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,j,0,16,0,0,0,0,w>>>8&255,255&w,0,0]);return R.box(R.types["ac-3"],M,R.box(R.types.dac3,new Uint8Array(A.config)))},R.ec3=function(A){var j=A.channelCount,w=A.audioSampleRate,M=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,j,0,16,0,0,0,0,w>>>8&255,255&w,0,0]);return R.box(R.types["ec-3"],M,R.box(R.types.dec3,new Uint8Array(A.config)))},R.esds=function(A){var j=A.config||[],w=j.length,M=new Uint8Array([0,0,0,0,3,23+w,0,1,0,4,15+w,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([w]).concat(j).concat([6,1,2]));return R.box(R.types.esds,M)},R.Opus=function(A){var j=A.channelCount,w=A.audioSampleRate,M=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,j,0,16,0,0,0,0,w>>>8&255,255&w,0,0]);return R.box(R.types.Opus,M,R.dOps(A))},R.dOps=function(A){var j=A.channelCount,w=A.channelConfigCode,M=A.audioSampleRate;if(A.config)return R.box(R.types.dOps,A.config);var G=[];switch(w){case 1:case 2:G=[0];break;case 0:G=[255,1,1,0,1];break;case 128:G=[255,2,0,0,1];break;case 3:G=[1,2,1,0,2,1];break;case 4:G=[1,2,2,0,1,2,3];break;case 5:G=[1,3,2,0,4,1,2,3];break;case 6:G=[1,4,2,0,4,1,2,3,5];break;case 7:G=[1,4,2,0,4,1,2,3,5,6];break;case 8:G=[1,5,3,0,6,1,2,3,4,5,7];break;case 130:G=[1,1,2,0,1];break;case 131:G=[1,1,3,0,1,2];break;case 132:G=[1,1,4,0,1,2,3];break;case 133:G=[1,1,5,0,1,2,3,4];break;case 134:G=[1,1,6,0,1,2,3,4,5];break;case 135:G=[1,1,7,0,1,2,3,4,5,6];break;case 136:G=[1,1,8,0,1,2,3,4,5,6,7]}var V=new Uint8Array(ha([0,j,0,0,M>>>24&255,M>>>17&255,M>>>8&255,M>>>0&255,0,0],G));return R.box(R.types.dOps,V)},R.fLaC=function(A){var j=A.channelCount,w=Math.min(A.audioSampleRate,65535),M=A.sampleSize,G=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,j,0,M,0,0,0,0,w>>>8&255,255&w,0,0]);return R.box(R.types.fLaC,G,R.dfLa(A))},R.dfLa=function(A){var j=new Uint8Array(ha([0,0,0,0],A.config));return R.box(R.types.dfLa,j)},R.avc1=function(A){var j=A.avcc,w=A.codecWidth,M=A.codecHeight,G=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,w>>>8&255,255&w,M>>>8&255,255&M,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return R.box(R.types.avc1,G,R.box(R.types.avcC,j))},R.hvc1=function(A){var j=A.hvcc,w=A.codecWidth,M=A.codecHeight,G=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,w>>>8&255,255&w,M>>>8&255,255&M,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return R.box(R.types.hvc1,G,R.box(R.types.hvcC,j))},R.av01=function(A){var j=A.av1c,w=A.codecWidth||192,M=A.codecHeight||108,G=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,w>>>8&255,255&w,M>>>8&255,255&M,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return R.box(R.types.av01,G,R.box(R.types.av1C,j))},R.mvex=function(A){return R.box(R.types.mvex,R.trex(A))},R.trex=function(A){var j=A.id,w=new Uint8Array([0,0,0,0,j>>>24&255,j>>>16&255,j>>>8&255,255&j,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return R.box(R.types.trex,w)},R.moof=function(A,j){return R.box(R.types.moof,R.mfhd(A.sequenceNumber),R.traf(A,j))},R.mfhd=function(A){var j=new Uint8Array([0,0,0,0,A>>>24&255,A>>>16&255,A>>>8&255,255&A]);return R.box(R.types.mfhd,j)},R.traf=function(A,j){var w=A.id,M=R.box(R.types.tfhd,new Uint8Array([0,0,0,0,w>>>24&255,w>>>16&255,w>>>8&255,255&w])),G=R.box(R.types.tfdt,new Uint8Array([0,0,0,0,j>>>24&255,j>>>16&255,j>>>8&255,255&j])),V=R.sdtp(A),Y=R.trun(A,V.byteLength+16+16+8+16+8+8);return R.box(R.types.traf,M,G,Y,V)},R.sdtp=function(A){for(var j=A.samples||[],w=j.length,M=new Uint8Array(4+w),G=0;G<w;G++){var V=j[G].flags;M[G+4]=V.isLeading<<6|V.dependsOn<<4|V.isDependedOn<<2|V.hasRedundancy}return R.box(R.types.sdtp,M)},R.trun=function(A,j){var w=A.samples||[],M=w.length,G=12+16*M,V=new Uint8Array(G);j+=8+G,V.set([0,0,15,1,M>>>24&255,M>>>16&255,M>>>8&255,255&M,j>>>24&255,j>>>16&255,j>>>8&255,255&j],0);for(var Y=0;Y<M;Y++){var ne=w[Y].duration,se=w[Y].size,le=w[Y].flags,he=w[Y].cts;V.set([ne>>>24&255,ne>>>16&255,ne>>>8&255,255&ne,se>>>24&255,se>>>16&255,se>>>8&255,255&se,le.isLeading<<2|le.dependsOn,le.isDependedOn<<6|le.hasRedundancy<<4|le.isNonSync,0,0,he>>>24&255,he>>>16&255,he>>>8&255,255&he],12+16*Y)}return R.box(R.types.trun,V)},R.mdat=function(A){return R.box(R.types.mdat,A)},R})();ba.init();var Ta=ba,qi=(function(){function R(){}return R.getSilentFrame=function(A,j){if(A==="mp4a.40.2"){if(j===1)return new Uint8Array([0,200,0,128,35,128]);if(j===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(j===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(j===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(j===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(j===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(j===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(j===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(j===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},R})(),Aa=i(11),kr=(function(){function R(A){this.TAG="MP4Remuxer",this._config=A,this._isLive=A.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new Aa.c("audio"),this._videoSegmentInfoList=new Aa.c("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!h.a.chrome||!(h.a.version.major<50||h.a.version.major===50&&h.a.version.build<2661)),this._fillSilentAfterSeek=h.a.msedge||h.a.msie,this._mp3UseMpegAudio=!h.a.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return R.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},R.prototype.bindDataSource=function(A){return A.onDataAvailable=this.remux.bind(this),A.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(R.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(A){this._onInitSegment=A},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(A){this._onMediaSegment=A},enumerable:!1,configurable:!0}),R.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},R.prototype.seek=function(A){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},R.prototype.remux=function(A,j){if(!this._onMediaSegment)throw new b.a("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(A,j),j&&this._remuxVideo(j),A&&this._remuxAudio(A)},R.prototype._onTrackMetadataReceived=function(A,j){var w=null,M="mp4",G=j.codec;if(A==="audio")this._audioMeta=j,j.codec==="mp3"&&this._mp3UseMpegAudio?(M="mpeg",G="",w=new Uint8Array):w=Ta.generateInitSegment(j);else{if(A!=="video")return;this._videoMeta=j,w=Ta.generateInitSegment(j)}if(!this._onInitSegment)throw new b.a("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(A,{type:A,data:w.buffer,codec:G,container:"".concat(A,"/").concat(M),mediaDuration:j.duration})},R.prototype._calculateDtsBase=function(A,j){this._dtsBaseInited||(A&&A.samples&&A.samples.length&&(this._audioDtsBase=A.samples[0].dts),j&&j.samples&&j.samples.length&&(this._videoDtsBase=j.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},R.prototype.getTimestampBase=function(){if(this._dtsBaseInited)return this._dtsBase},R.prototype.flushStashedSamples=function(){var A=this._videoStashedLastSample,j=this._audioStashedLastSample,w={type:"video",id:1,sequenceNumber:0,samples:[],length:0};A!=null&&(w.samples.push(A),w.length=A.length);var M={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};j!=null&&(M.samples.push(j),M.length=j.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(w,!0),this._remuxAudio(M,!0)},R.prototype._remuxAudio=function(A,j){if(this._audioMeta!=null){var w,M=A,G=M.samples,V=void 0,Y=-1,ne=this._audioMeta.refSampleDuration,se=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,le=this._dtsBaseInited&&this._audioNextDts===void 0,he=!1;if(G&&G.length!==0&&(G.length!==1||j)){var ce=0,me=null,Te=0;se?(ce=0,Te=M.length):(ce=8,Te=8+M.length);var Pe=null;if(G.length>1&&(Te-=(Pe=G.pop()).length),this._audioStashedLastSample!=null){var De=this._audioStashedLastSample;this._audioStashedLastSample=null,G.unshift(De),Te+=De.length}Pe!=null&&(this._audioStashedLastSample=Pe);var Je=G[0].dts-this._dtsBase;if(this._audioNextDts)V=Je-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())V=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(he=!0);else{var Ye=this._audioSegmentInfoList.getLastSampleBefore(Je);if(Ye!=null){var qe=Je-(Ye.originalDts+Ye.duration);qe<=3&&(qe=0),V=Je-(Ye.dts+Ye.duration+qe)}else V=0}if(he){var ht=Je-V,wt=this._videoSegmentInfoList.getLastSegmentBefore(Je);if(wt!=null&&wt.beginDts<ht){if(bs=qi.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount)){var Qe=wt.beginDts,lt=ht-wt.beginDts;d.a.v(this.TAG,"InsertPrefixSilentAudio: dts: ".concat(Qe,", duration: ").concat(lt)),G.unshift({unit:bs,dts:Qe,pts:Qe}),Te+=bs.byteLength}}else he=!1}for(var vt=[],dt=0;dt<G.length;dt++){var ct=(De=G[dt]).unit,_t=De.dts-this._dtsBase,Yt=(Qe=_t,!1),yt=null,Tt=0;if(!(_t<-.001)){if(this._audioMeta.codec!=="mp3"&&ne!=null){var Zt=_t;if(this._audioNextDts&&(Zt=this._audioNextDts),(V=_t-Zt)<=-3*ne){d.a.w(this.TAG,"Dropping 1 audio frame (originalDts: ".concat(_t," ms ,curRefDts: ").concat(Zt," ms)  due to dtsCorrection: ").concat(V," ms overlap."));continue}if(V>=3*ne&&this._fillAudioTimestampGap&&!h.a.safari){Yt=!0;var bs,Ga=Math.floor(V/ne);d.a.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+"originalDts: ".concat(_t," ms, curRefDts: ").concat(Zt," ms, ")+"dtsCorrection: ".concat(Math.round(V)," ms, generate: ").concat(Ga," frames")),Qe=Math.floor(Zt),Tt=Math.floor(Zt+ne)-Qe,(bs=qi.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount))==null&&(d.a.w(this.TAG,"Unable to generate silent frame for "+"".concat(this._audioMeta.originalCodec," with ").concat(this._audioMeta.channelCount," channels, repeat last frame")),bs=ct),yt=[];for(var ss=0;ss<Ga;ss++){Zt+=ne;var aa=Math.floor(Zt),Zs=Math.floor(Zt+ne)-aa,Vs={dts:aa,pts:aa,cts:0,unit:bs,size:bs.byteLength,duration:Zs,originalDts:_t,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};yt.push(Vs),Te+=Vs.size}this._audioNextDts=Zt+ne}else Qe=Math.floor(Zt),Tt=Math.floor(Zt+ne)-Qe,this._audioNextDts=Zt+ne}else Qe=_t-V,dt!==G.length-1?Tt=G[dt+1].dts-this._dtsBase-V-Qe:Pe!=null?Tt=Pe.dts-this._dtsBase-V-Qe:Tt=vt.length>=1?vt[vt.length-1].duration:Math.floor(ne),this._audioNextDts=Qe+Tt;Y===-1&&(Y=Qe),vt.push({dts:Qe,pts:Qe,cts:0,unit:De.unit,size:De.unit.byteLength,duration:Tt,originalDts:_t,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),Yt&&vt.push.apply(vt,yt)}}if(vt.length===0)return M.samples=[],void(M.length=0);for(se?me=new Uint8Array(Te):((me=new Uint8Array(Te))[0]=Te>>>24&255,me[1]=Te>>>16&255,me[2]=Te>>>8&255,me[3]=255&Te,me.set(Ta.types.mdat,4)),dt=0;dt<vt.length;dt++)ct=vt[dt].unit,me.set(ct,ce),ce+=ct.byteLength;var Rs=vt[vt.length-1];w=Rs.dts+Rs.duration;var Vt=new Aa.b;Vt.beginDts=Y,Vt.endDts=w,Vt.beginPts=Y,Vt.endPts=w,Vt.originalBeginDts=vt[0].originalDts,Vt.originalEndDts=Rs.originalDts+Rs.duration,Vt.firstSample=new Aa.d(vt[0].dts,vt[0].pts,vt[0].duration,vt[0].originalDts,!1),Vt.lastSample=new Aa.d(Rs.dts,Rs.pts,Rs.duration,Rs.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(Vt),M.samples=vt,M.sequenceNumber++;var cn=null;cn=se?new Uint8Array:Ta.moof(M,Y),M.samples=[],M.length=0;var fa={type:"audio",data:this._mergeBoxes(cn,me).buffer,sampleCount:vt.length,info:Vt};se&&le&&(fa.timestampOffset=Y),this._onMediaSegment("audio",fa)}}},R.prototype._remuxVideo=function(A,j){if(this._videoMeta!=null){var w,M,G=A,V=G.samples,Y=void 0,ne=-1,se=-1;if(V&&V.length!==0&&(V.length!==1||j)){var le=8,he=null,ce=8+A.length,me=null;if(V.length>1&&(ce-=(me=V.pop()).length),this._videoStashedLastSample!=null){var Te=this._videoStashedLastSample;this._videoStashedLastSample=null,V.unshift(Te),ce+=Te.length}me!=null&&(this._videoStashedLastSample=me);var Pe=V[0].dts-this._dtsBase;if(this._videoNextDts)Y=Pe-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())Y=0;else{var De=this._videoSegmentInfoList.getLastSampleBefore(Pe);if(De!=null){var Je=Pe-(De.originalDts+De.duration);Je<=3&&(Je=0),Y=Pe-(De.dts+De.duration+Je)}else Y=0}for(var Ye=new Aa.b,qe=[],ht=0;ht<V.length;ht++){var wt=(Te=V[ht]).dts-this._dtsBase,Qe=Te.isKeyframe,lt=wt-Y,vt=Te.cts,dt=lt+vt;ne===-1&&(ne=lt,se=dt);var ct=0;if(ht!==V.length-1?ct=V[ht+1].dts-this._dtsBase-Y-lt:me!=null?ct=me.dts-this._dtsBase-Y-lt:ct=qe.length>=1?qe[qe.length-1].duration:Math.floor(this._videoMeta.refSampleDuration),Qe){var _t=new Aa.d(lt,dt,ct,Te.dts,!0);_t.fileposition=Te.fileposition,Ye.appendSyncPoint(_t)}qe.push({dts:lt,pts:dt,cts:vt,units:Te.units,size:Te.length,isKeyframe:Qe,duration:ct,originalDts:wt,flags:{isLeading:0,dependsOn:Qe?2:1,isDependedOn:Qe?1:0,hasRedundancy:0,isNonSync:Qe?0:1}})}for((he=new Uint8Array(ce))[0]=ce>>>24&255,he[1]=ce>>>16&255,he[2]=ce>>>8&255,he[3]=255&ce,he.set(Ta.types.mdat,4),ht=0;ht<qe.length;ht++)for(var Yt=qe[ht].units;Yt.length;){var yt=Yt.shift().data;he.set(yt,le),le+=yt.byteLength}var Tt=qe[qe.length-1];if(w=Tt.dts+Tt.duration,M=Tt.pts+Tt.duration,this._videoNextDts=w,Ye.beginDts=ne,Ye.endDts=w,Ye.beginPts=se,Ye.endPts=M,Ye.originalBeginDts=qe[0].originalDts,Ye.originalEndDts=Tt.originalDts+Tt.duration,Ye.firstSample=new Aa.d(qe[0].dts,qe[0].pts,qe[0].duration,qe[0].originalDts,qe[0].isKeyframe),Ye.lastSample=new Aa.d(Tt.dts,Tt.pts,Tt.duration,Tt.originalDts,Tt.isKeyframe),this._isLive||this._videoSegmentInfoList.append(Ye),G.samples=qe,G.sequenceNumber++,this._forceFirstIDR){var Zt=qe[0].flags;Zt.dependsOn=2,Zt.isNonSync=0}var bs=Ta.moof(G,ne);G.samples=[],G.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(bs,he).buffer,sampleCount:qe.length,info:Ye})}}},R.prototype._mergeBoxes=function(A,j){var w=new Uint8Array(A.byteLength+j.byteLength);return w.set(A,0),w.set(j,A.byteLength),w},R})(),Rr=i(14),ys=i(1),Lr=(i(2),(function(){function R(A,j){this.TAG="TransmuxingController",this._emitter=new o.a,this._config=j,A.segments||(A.segments=[{duration:A.duration,filesize:A.filesize,url:A.url}]),typeof A.cors!="boolean"&&(A.cors=!0),typeof A.withCredentials!="boolean"&&(A.withCredentials=!1),this._mediaDataSource=A,this._currentSegmentIndex=0;var w=0;this._mediaDataSource.segments.forEach((function(M){M.timestampBase=w,w+=M.duration,M.cors=A.cors,M.withCredentials=A.withCredentials,j.referrerPolicy&&(M.referrerPolicy=j.referrerPolicy)})),isNaN(w)||this._mediaDataSource.duration===w||(this._mediaDataSource.duration=w),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return R.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},R.prototype.on=function(A,j){this._emitter.addListener(A,j)},R.prototype.off=function(A,j){this._emitter.removeListener(A,j)},R.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},R.prototype._loadSegment=function(A,j){this._currentSegmentIndex=A;var w=this._mediaDataSource.segments[A],M=this._ioctl=new Rr.a(w,this._config,A);M.onError=this._onIOException.bind(this),M.onSeeked=this._onIOSeeked.bind(this),M.onComplete=this._onIOComplete.bind(this),M.onRedirect=this._onIORedirect.bind(this),M.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),j?this._demuxer.bindDataSource(this._ioctl):M.onDataArrival=this._onInitChunkArrival.bind(this),M.open(j)},R.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},R.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},R.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},R.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},R.prototype.seek=function(A){if(this._mediaInfo!=null&&this._mediaInfo.isSeekable()){var j=this._searchSegmentIndexContains(A);if(j===this._currentSegmentIndex){var w=this._mediaInfo.segments[j];if(w==null)this._pendingSeekTime=A;else{var M=w.getNearestKeyframe(A);this._remuxer.seek(M.milliseconds),this._ioctl.seek(M.fileposition),this._pendingResolveSeekPoint=M.milliseconds}}else{var G=this._mediaInfo.segments[j];G==null?(this._pendingSeekTime=A,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(j)):(M=G.getNearestKeyframe(A),this._internalAbort(),this._remuxer.seek(A),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[j].timestampBase,this._loadSegment(j,M.fileposition),this._pendingResolveSeekPoint=M.milliseconds,this._reportSegmentMediaInfo(j))}this._enableStatisticsReporter()}},R.prototype._searchSegmentIndexContains=function(A){for(var j=this._mediaDataSource.segments,w=j.length-1,M=0;M<j.length;M++)if(A<j[M].timestampBase){w=M-1;break}return w},R.prototype._onInitChunkArrival=function(A,j){var w=this,M=0;if(j>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,M=this._demuxer.parseChunks(A,j);else{var G=null;(G=O.probe(A)).match&&(this._setupFLVDemuxerRemuxer(G),M=this._demuxer.parseChunks(A,j)),G.match||G.needMoreData||(G=Cn.probe(A)).match&&(this._setupTSDemuxerRemuxer(G),M=this._demuxer.parseChunks(A,j)),G.match||G.needMoreData||(G=null,d.a.e(this.TAG,"Non MPEG-TS/FLV, Unsupported media type!"),Promise.resolve().then((function(){w._internalAbort()})),this._emitter.emit(ys.a.DEMUX_ERROR,C.a.FORMAT_UNSUPPORTED,"Non MPEG-TS/FLV, Unsupported media type!"))}return M},R.prototype._setupFLVDemuxerRemuxer=function(A){this._demuxer=new O(A,this._config),this._remuxer||(this._remuxer=new kr(this._config));var j=this._mediaDataSource;j.duration==null||isNaN(j.duration)||(this._demuxer.overridedDuration=j.duration),typeof j.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=j.hasAudio),typeof j.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=j.hasVideo),this._demuxer.timestampBase=j.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},R.prototype._setupTSDemuxerRemuxer=function(A){var j=this._demuxer=new Cn(A,this._config);this._remuxer||(this._remuxer=new kr(this._config)),j.onError=this._onDemuxException.bind(this),j.onMediaInfo=this._onMediaInfo.bind(this),j.onMetaDataArrived=this._onMetaDataArrived.bind(this),j.onTimedID3Metadata=this._onTimedID3Metadata.bind(this),j.onSynchronousKLVMetadata=this._onSynchronousKLVMetadata.bind(this),j.onAsynchronousKLVMetadata=this._onAsynchronousKLVMetadata.bind(this),j.onSMPTE2038Metadata=this._onSMPTE2038Metadata.bind(this),j.onSCTE35Metadata=this._onSCTE35Metadata.bind(this),j.onPESPrivateDataDescriptor=this._onPESPrivateDataDescriptor.bind(this),j.onPESPrivateData=this._onPESPrivateData.bind(this),this._remuxer.bindDataSource(this._demuxer),this._demuxer.bindDataSource(this._ioctl),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},R.prototype._onMediaInfo=function(A){var j=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},A),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,u.a.prototype));var w=Object.assign({},A);Object.setPrototypeOf(w,u.a.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=w,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then((function(){var M=j._pendingSeekTime;j._pendingSeekTime=null,j.seek(M)}))},R.prototype._onMetaDataArrived=function(A){this._emitter.emit(ys.a.METADATA_ARRIVED,A)},R.prototype._onScriptDataArrived=function(A){this._emitter.emit(ys.a.SCRIPTDATA_ARRIVED,A)},R.prototype._onTimedID3Metadata=function(A){var j=this._remuxer.getTimestampBase();j!=null&&(A.pts!=null&&(A.pts-=j),A.dts!=null&&(A.dts-=j),this._emitter.emit(ys.a.TIMED_ID3_METADATA_ARRIVED,A))},R.prototype._onSynchronousKLVMetadata=function(A){var j=this._remuxer.getTimestampBase();j!=null&&(A.pts!=null&&(A.pts-=j),A.dts!=null&&(A.dts-=j),this._emitter.emit(ys.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,A))},R.prototype._onAsynchronousKLVMetadata=function(A){this._emitter.emit(ys.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,A)},R.prototype._onSMPTE2038Metadata=function(A){var j=this._remuxer.getTimestampBase();j!=null&&(A.pts!=null&&(A.pts-=j),A.dts!=null&&(A.dts-=j),A.nearest_pts!=null&&(A.nearest_pts-=j),this._emitter.emit(ys.a.SMPTE2038_METADATA_ARRIVED,A))},R.prototype._onSCTE35Metadata=function(A){var j=this._remuxer.getTimestampBase();j!=null&&(A.pts!=null&&(A.pts-=j),A.nearest_pts!=null&&(A.nearest_pts-=j),this._emitter.emit(ys.a.SCTE35_METADATA_ARRIVED,A))},R.prototype._onPESPrivateDataDescriptor=function(A){this._emitter.emit(ys.a.PES_PRIVATE_DATA_DESCRIPTOR,A)},R.prototype._onPESPrivateData=function(A){var j=this._remuxer.getTimestampBase();j!=null&&(A.pts!=null&&(A.pts-=j),A.nearest_pts!=null&&(A.nearest_pts-=j),A.dts!=null&&(A.dts-=j),this._emitter.emit(ys.a.PES_PRIVATE_DATA_ARRIVED,A))},R.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},R.prototype._onIOComplete=function(A){var j=A+1;j<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer&&this._remuxer.flushStashedSamples(),this._loadSegment(j)):(this._remuxer&&this._remuxer.flushStashedSamples(),this._emitter.emit(ys.a.LOADING_COMPLETE),this._disableStatisticsReporter())},R.prototype._onIORedirect=function(A){var j=this._ioctl.extraData;this._mediaDataSource.segments[j].redirectedURL=A},R.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(ys.a.RECOVERED_EARLY_EOF)},R.prototype._onIOException=function(A,j){d.a.e(this.TAG,"IOException: type = ".concat(A,", code = ").concat(j.code,", msg = ").concat(j.msg)),this._emitter.emit(ys.a.IO_ERROR,A,j),this._disableStatisticsReporter()},R.prototype._onDemuxException=function(A,j){d.a.e(this.TAG,"DemuxException: type = ".concat(A,", info = ").concat(j)),this._emitter.emit(ys.a.DEMUX_ERROR,A,j)},R.prototype._onRemuxerInitSegmentArrival=function(A,j){this._emitter.emit(ys.a.INIT_SEGMENT,A,j)},R.prototype._onRemuxerMediaSegmentArrival=function(A,j){if(this._pendingSeekTime==null&&(this._emitter.emit(ys.a.MEDIA_SEGMENT,A,j),this._pendingResolveSeekPoint!=null&&A==="video")){var w=j.info.syncPoints,M=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,h.a.safari&&w.length>0&&w[0].originalDts===M&&(M=w[0].pts),this._emitter.emit(ys.a.RECOMMEND_SEEKPOINT,M)}},R.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},R.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},R.prototype._reportSegmentMediaInfo=function(A){var j=this._mediaInfo.segments[A],w=Object.assign({},j);w.duration=this._mediaInfo.duration,w.segmentCount=this._mediaInfo.segmentCount,delete w.segments,delete w.keyframesIndex,this._emitter.emit(ys.a.MEDIA_INFO,w)},R.prototype._reportStatisticsInfo=function(){var A={};A.url=this._ioctl.currentURL,A.hasRedirect=this._ioctl.hasRedirect,A.hasRedirect&&(A.redirectedURL=this._ioctl.currentRedirectedURL),A.speed=this._ioctl.currentSpeed,A.loaderType=this._ioctl.loaderType,A.currentSegmentIndex=this._currentSegmentIndex,A.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(ys.a.STATISTICS_INFO,A)},R})());n.a=Lr},function(s,n,i){var l,o=i(0),d=(function(){function B(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return B.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},B.prototype.addBytes=function(P){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=P,this._totalBytes+=P):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=P,this._totalBytes+=P):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=P,this._totalBytes+=P,this._lastCheckpoint=this._now())},Object.defineProperty(B.prototype,"currentKBps",{get:function(){this.addBytes(0);var P=(this._now()-this._lastCheckpoint)/1e3;return P==0&&(P=1),this._intervalBytes/P/1024},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"averageKBps",{get:function(){var P=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/P/1024},enumerable:!1,configurable:!0}),B})(),h=i(2),u=i(5),f=i(3),g=(l=function(B,P){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,D){I.__proto__=D}||function(I,D){for(var O in D)Object.prototype.hasOwnProperty.call(D,O)&&(I[O]=D[O])})(B,P)},function(B,P){if(typeof P!="function"&&P!==null)throw new TypeError("Class extends value "+String(P)+" is not a constructor or null");function I(){this.constructor=B}l(B,P),B.prototype=P===null?Object.create(P):(I.prototype=P.prototype,new I)}),p=(function(B){function P(I,D){var O=B.call(this,"fetch-stream-loader")||this;return O.TAG="FetchStreamLoader",O._seekHandler=I,O._config=D,O._needStash=!0,O._requestAbort=!1,O._abortController=null,O._contentLength=null,O._receivedLength=0,O}return g(P,B),P.isSupported=function(){try{var I=u.a.msedge&&u.a.version.minor>=15048,D=!u.a.msedge||I;return self.fetch&&self.ReadableStream&&D}catch{return!1}},P.prototype.destroy=function(){this.isWorking()&&this.abort(),B.prototype.destroy.call(this)},P.prototype.open=function(I,D){var O=this;this._dataSource=I,this._range=D;var ee=I.url;this._config.reuseRedirectedURL&&I.redirectedURL!=null&&(ee=I.redirectedURL);var ie=this._seekHandler.getConfig(ee,D),Z=new self.Headers;if(typeof ie.headers=="object"){var z=ie.headers;for(var X in z)z.hasOwnProperty(X)&&Z.append(X,z[X])}var ae={method:"GET",headers:Z,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var X in this._config.headers)Z.append(X,this._config.headers[X]);I.cors===!1&&(ae.mode="same-origin"),I.withCredentials&&(ae.credentials="include"),I.referrerPolicy&&(ae.referrerPolicy=I.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,ae.signal=this._abortController.signal),this._status=h.c.kConnecting,self.fetch(ie.url,ae).then((function(te){if(O._requestAbort)return O._status=h.c.kIdle,void te.body.cancel();if(te.ok&&te.status>=200&&te.status<=299){if(te.url!==ie.url&&O._onURLRedirect){var W=O._seekHandler.removeURLParameters(te.url);O._onURLRedirect(W)}var K=te.headers.get("Content-Length");return K!=null&&(O._contentLength=parseInt(K),O._contentLength!==0&&O._onContentLengthKnown&&O._onContentLengthKnown(O._contentLength)),O._pump.call(O,te.body.getReader())}if(O._status=h.c.kError,!O._onError)throw new f.d("FetchStreamLoader: Http code invalid, "+te.status+" "+te.statusText);O._onError(h.b.HTTP_STATUS_CODE_INVALID,{code:te.status,msg:te.statusText})})).catch((function(te){if(!O._abortController||!O._abortController.signal.aborted){if(O._status=h.c.kError,!O._onError)throw te;O._onError(h.b.EXCEPTION,{code:-1,msg:te.message})}}))},P.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==h.c.kBuffering||!u.a.chrome)&&this._abortController)try{this._abortController.abort()}catch{}},P.prototype._pump=function(I){var D=this;return I.read().then((function(O){if(O.done)if(D._contentLength!==null&&D._receivedLength<D._contentLength){D._status=h.c.kError;var ee=h.b.EARLY_EOF,ie={code:-1,msg:"Fetch stream meet Early-EOF"};if(!D._onError)throw new f.d(ie.msg);D._onError(ee,ie)}else D._status=h.c.kComplete,D._onComplete&&D._onComplete(D._range.from,D._range.from+D._receivedLength-1);else{if(D._abortController&&D._abortController.signal.aborted)return void(D._status=h.c.kComplete);if(D._requestAbort===!0)return D._status=h.c.kComplete,I.cancel();D._status=h.c.kBuffering;var Z=O.value.buffer,z=D._range.from+D._receivedLength;D._receivedLength+=Z.byteLength,D._onDataArrival&&D._onDataArrival(Z,z,D._receivedLength),D._pump(I)}})).catch((function(O){if(D._abortController&&D._abortController.signal.aborted)D._status=h.c.kComplete;else if(O.code!==11||!u.a.msedge){D._status=h.c.kError;var ee=0,ie=null;if(O.code!==19&&O.message!=="network error"||!(D._contentLength===null||D._contentLength!==null&&D._receivedLength<D._contentLength)?(ee=h.b.EXCEPTION,ie={code:O.code,msg:O.message}):(ee=h.b.EARLY_EOF,ie={code:O.code,msg:"Fetch stream meet Early-EOF"}),!D._onError)throw new f.d(ie.msg);D._onError(ee,ie)}}))},P})(h.a),b=(function(){var B=function(P,I){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,O){D.__proto__=O}||function(D,O){for(var ee in O)Object.prototype.hasOwnProperty.call(O,ee)&&(D[ee]=O[ee])})(P,I)};return function(P,I){if(typeof I!="function"&&I!==null)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");function D(){this.constructor=P}B(P,I),P.prototype=I===null?Object.create(I):(D.prototype=I.prototype,new D)}})(),y=(function(B){function P(I,D){var O=B.call(this,"xhr-moz-chunked-loader")||this;return O.TAG="MozChunkedLoader",O._seekHandler=I,O._config=D,O._needStash=!0,O._xhr=null,O._requestAbort=!1,O._contentLength=null,O._receivedLength=0,O}return b(P,B),P.isSupported=function(){try{var I=new XMLHttpRequest;return I.open("GET","https://example.com",!0),I.responseType="moz-chunked-arraybuffer",I.responseType==="moz-chunked-arraybuffer"}catch(D){return o.a.w("MozChunkedLoader",D.message),!1}},P.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),B.prototype.destroy.call(this)},P.prototype.open=function(I,D){this._dataSource=I,this._range=D;var O=I.url;this._config.reuseRedirectedURL&&I.redirectedURL!=null&&(O=I.redirectedURL);var ee=this._seekHandler.getConfig(O,D);this._requestURL=ee.url;var ie=this._xhr=new XMLHttpRequest;if(ie.open("GET",ee.url,!0),ie.responseType="moz-chunked-arraybuffer",ie.onreadystatechange=this._onReadyStateChange.bind(this),ie.onprogress=this._onProgress.bind(this),ie.onloadend=this._onLoadEnd.bind(this),ie.onerror=this._onXhrError.bind(this),I.withCredentials&&(ie.withCredentials=!0),typeof ee.headers=="object"){var Z=ee.headers;for(var z in Z)Z.hasOwnProperty(z)&&ie.setRequestHeader(z,Z[z])}if(typeof this._config.headers=="object"){Z=this._config.headers;for(var z in Z)Z.hasOwnProperty(z)&&ie.setRequestHeader(z,Z[z])}this._status=h.c.kConnecting,ie.send()},P.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=h.c.kComplete},P.prototype._onReadyStateChange=function(I){var D=I.target;if(D.readyState===2){if(D.responseURL!=null&&D.responseURL!==this._requestURL&&this._onURLRedirect){var O=this._seekHandler.removeURLParameters(D.responseURL);this._onURLRedirect(O)}if(D.status!==0&&(D.status<200||D.status>299)){if(this._status=h.c.kError,!this._onError)throw new f.d("MozChunkedLoader: Http code invalid, "+D.status+" "+D.statusText);this._onError(h.b.HTTP_STATUS_CODE_INVALID,{code:D.status,msg:D.statusText})}else this._status=h.c.kBuffering}},P.prototype._onProgress=function(I){if(this._status!==h.c.kError){this._contentLength===null&&I.total!==null&&I.total!==0&&(this._contentLength=I.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var D=I.target.response,O=this._range.from+this._receivedLength;this._receivedLength+=D.byteLength,this._onDataArrival&&this._onDataArrival(D,O,this._receivedLength)}},P.prototype._onLoadEnd=function(I){this._requestAbort!==!0?this._status!==h.c.kError&&(this._status=h.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1},P.prototype._onXhrError=function(I){this._status=h.c.kError;var D=0,O=null;if(this._contentLength&&I.loaded<this._contentLength?(D=h.b.EARLY_EOF,O={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(D=h.b.EXCEPTION,O={code:-1,msg:I.constructor.name+" "+I.type}),!this._onError)throw new f.d(O.msg);this._onError(D,O)},P})(h.a),v=(function(){var B=function(P,I){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,O){D.__proto__=O}||function(D,O){for(var ee in O)Object.prototype.hasOwnProperty.call(O,ee)&&(D[ee]=O[ee])})(P,I)};return function(P,I){if(typeof I!="function"&&I!==null)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");function D(){this.constructor=P}B(P,I),P.prototype=I===null?Object.create(I):(D.prototype=I.prototype,new D)}})(),_=((function(B){function P(I,D){var O=B.call(this,"xhr-msstream-loader")||this;return O.TAG="MSStreamLoader",O._seekHandler=I,O._config=D,O._needStash=!0,O._xhr=null,O._reader=null,O._totalRange=null,O._currentRange=null,O._currentRequestURL=null,O._currentRedirectedURL=null,O._contentLength=null,O._receivedLength=0,O._bufferLimit=16777216,O._lastTimeBufferSize=0,O._isReconnecting=!1,O}v(P,B),P.isSupported=function(){try{if(self.MSStream===void 0||self.MSStreamReader===void 0)return!1;var I=new XMLHttpRequest;return I.open("GET","https://example.com",!0),I.responseType="ms-stream",I.responseType==="ms-stream"}catch(D){return o.a.w("MSStreamLoader",D.message),!1}},P.prototype.destroy=function(){this.isWorking()&&this.abort(),this._reader&&(this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr=null),B.prototype.destroy.call(this)},P.prototype.open=function(I,D){this._internalOpen(I,D,!1)},P.prototype._internalOpen=function(I,D,O){this._dataSource=I,O?this._currentRange=D:this._totalRange=D;var ee=I.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?ee=this._currentRedirectedURL:I.redirectedURL!=null&&(ee=I.redirectedURL));var ie=this._seekHandler.getConfig(ee,D);this._currentRequestURL=ie.url;var Z=this._reader=new self.MSStreamReader;Z.onprogress=this._msrOnProgress.bind(this),Z.onload=this._msrOnLoad.bind(this),Z.onerror=this._msrOnError.bind(this);var z=this._xhr=new XMLHttpRequest;if(z.open("GET",ie.url,!0),z.responseType="ms-stream",z.onreadystatechange=this._xhrOnReadyStateChange.bind(this),z.onerror=this._xhrOnError.bind(this),I.withCredentials&&(z.withCredentials=!0),typeof ie.headers=="object"){var X=ie.headers;for(var ae in X)X.hasOwnProperty(ae)&&z.setRequestHeader(ae,X[ae])}if(typeof this._config.headers=="object"){X=this._config.headers;for(var ae in X)X.hasOwnProperty(ae)&&z.setRequestHeader(ae,X[ae])}this._isReconnecting?this._isReconnecting=!1:this._status=h.c.kConnecting,z.send()},P.prototype.abort=function(){this._internalAbort(),this._status=h.c.kComplete},P.prototype._internalAbort=function(){this._reader&&(this._reader.readyState===1&&this._reader.abort(),this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.abort(),this._xhr.onreadystatechange=null,this._xhr=null)},P.prototype._xhrOnReadyStateChange=function(I){var D=I.target;if(D.readyState===2)if(D.status>=200&&D.status<=299){if(this._status=h.c.kBuffering,D.responseURL!=null){var O=this._seekHandler.removeURLParameters(D.responseURL);D.responseURL!==this._currentRequestURL&&O!==this._currentRedirectedURL&&(this._currentRedirectedURL=O,this._onURLRedirect&&this._onURLRedirect(O))}var ee=D.getResponseHeader("Content-Length");if(ee!=null&&this._contentLength==null){var ie=parseInt(ee);ie>0&&(this._contentLength=ie,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength))}}else{if(this._status=h.c.kError,!this._onError)throw new f.d("MSStreamLoader: Http code invalid, "+D.status+" "+D.statusText);this._onError(h.b.HTTP_STATUS_CODE_INVALID,{code:D.status,msg:D.statusText})}else if(D.readyState===3&&D.status>=200&&D.status<=299){this._status=h.c.kBuffering;var Z=D.response;this._reader.readAsArrayBuffer(Z)}},P.prototype._xhrOnError=function(I){this._status=h.c.kError;var D=h.b.EXCEPTION,O={code:-1,msg:I.constructor.name+" "+I.type};if(!this._onError)throw new f.d(O.msg);this._onError(D,O)},P.prototype._msrOnProgress=function(I){var D=I.target.result;if(D!=null){var O=D.slice(this._lastTimeBufferSize);this._lastTimeBufferSize=D.byteLength;var ee=this._totalRange.from+this._receivedLength;this._receivedLength+=O.byteLength,this._onDataArrival&&this._onDataArrival(O,ee,this._receivedLength),D.byteLength>=this._bufferLimit&&(o.a.v(this.TAG,"MSStream buffer exceeded max size near ".concat(ee+O.byteLength,", reconnecting...")),this._doReconnectIfNeeded())}else this._doReconnectIfNeeded()},P.prototype._doReconnectIfNeeded=function(){if(this._contentLength==null||this._receivedLength<this._contentLength){this._isReconnecting=!0,this._lastTimeBufferSize=0,this._internalAbort();var I={from:this._totalRange.from+this._receivedLength,to:-1};this._internalOpen(this._dataSource,I,!0)}},P.prototype._msrOnLoad=function(I){this._status=h.c.kComplete,this._onComplete&&this._onComplete(this._totalRange.from,this._totalRange.from+this._receivedLength-1)},P.prototype._msrOnError=function(I){this._status=h.c.kError;var D=0,O=null;if(this._contentLength&&this._receivedLength<this._contentLength?(D=h.b.EARLY_EOF,O={code:-1,msg:"MSStream meet Early-Eof"}):(D=h.b.EARLY_EOF,O={code:-1,msg:I.constructor.name+" "+I.type}),!this._onError)throw new f.d(O.msg);this._onError(D,O)}})(h.a),(function(){var B=function(P,I){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,O){D.__proto__=O}||function(D,O){for(var ee in O)Object.prototype.hasOwnProperty.call(O,ee)&&(D[ee]=O[ee])})(P,I)};return function(P,I){if(typeof I!="function"&&I!==null)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");function D(){this.constructor=P}B(P,I),P.prototype=I===null?Object.create(I):(D.prototype=I.prototype,new D)}})()),N=(function(B){function P(I,D){var O=B.call(this,"xhr-range-loader")||this;return O.TAG="RangeLoader",O._seekHandler=I,O._config=D,O._needStash=!1,O._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],O._currentChunkSizeKB=384,O._currentSpeedNormalized=0,O._zeroSpeedChunkCount=0,O._xhr=null,O._speedSampler=new d,O._requestAbort=!1,O._waitForTotalLength=!1,O._totalLengthReceived=!1,O._currentRequestURL=null,O._currentRedirectedURL=null,O._currentRequestRange=null,O._totalLength=null,O._contentLength=null,O._receivedLength=0,O._lastTimeLoaded=0,O}return _(P,B),P.isSupported=function(){try{var I=new XMLHttpRequest;return I.open("GET","https://example.com",!0),I.responseType="arraybuffer",I.responseType==="arraybuffer"}catch(D){return o.a.w("RangeLoader",D.message),!1}},P.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),B.prototype.destroy.call(this)},Object.defineProperty(P.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),P.prototype.open=function(I,D){this._dataSource=I,this._range=D,this._status=h.c.kConnecting;var O=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(O=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||O?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))},P.prototype._openSubRange=function(){var I=1024*this._currentChunkSizeKB,D=this._range.from+this._receivedLength,O=D+I;this._contentLength!=null&&O-this._range.from>=this._contentLength&&(O=this._range.from+this._contentLength-1),this._currentRequestRange={from:D,to:O},this._internalOpen(this._dataSource,this._currentRequestRange)},P.prototype._internalOpen=function(I,D){this._lastTimeLoaded=0;var O=I.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?O=this._currentRedirectedURL:I.redirectedURL!=null&&(O=I.redirectedURL));var ee=this._seekHandler.getConfig(O,D);this._currentRequestURL=ee.url;var ie=this._xhr=new XMLHttpRequest;if(ie.open("GET",ee.url,!0),ie.responseType="arraybuffer",ie.onreadystatechange=this._onReadyStateChange.bind(this),ie.onprogress=this._onProgress.bind(this),ie.onload=this._onLoad.bind(this),ie.onerror=this._onXhrError.bind(this),I.withCredentials&&(ie.withCredentials=!0),typeof ee.headers=="object"){var Z=ee.headers;for(var z in Z)Z.hasOwnProperty(z)&&ie.setRequestHeader(z,Z[z])}if(typeof this._config.headers=="object"){Z=this._config.headers;for(var z in Z)Z.hasOwnProperty(z)&&ie.setRequestHeader(z,Z[z])}ie.send()},P.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=h.c.kComplete},P.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},P.prototype._onReadyStateChange=function(I){var D=I.target;if(D.readyState===2){if(D.responseURL!=null){var O=this._seekHandler.removeURLParameters(D.responseURL);D.responseURL!==this._currentRequestURL&&O!==this._currentRedirectedURL&&(this._currentRedirectedURL=O,this._onURLRedirect&&this._onURLRedirect(O))}if(D.status>=200&&D.status<=299){if(this._waitForTotalLength)return;this._status=h.c.kBuffering}else{if(this._status=h.c.kError,!this._onError)throw new f.d("RangeLoader: Http code invalid, "+D.status+" "+D.statusText);this._onError(h.b.HTTP_STATUS_CODE_INVALID,{code:D.status,msg:D.statusText})}}},P.prototype._onProgress=function(I){if(this._status!==h.c.kError){if(this._contentLength===null){var D=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,D=!0;var O=I.total;this._internalAbort(),O!=null&O!==0&&(this._totalLength=O)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,D)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var ee=I.loaded-this._lastTimeLoaded;this._lastTimeLoaded=I.loaded,this._speedSampler.addBytes(ee)}},P.prototype._normalizeSpeed=function(I){var D=this._chunkSizeKBList,O=D.length-1,ee=0,ie=0,Z=O;if(I<D[0])return D[0];for(;ie<=Z;){if((ee=ie+Math.floor((Z-ie)/2))===O||I>=D[ee]&&I<D[ee+1])return D[ee];D[ee]<I?ie=ee+1:Z=ee-1}},P.prototype._onLoad=function(I){if(this._status!==h.c.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var D=this._speedSampler.lastSecondKBps;if(D===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(D=this._speedSampler.currentKBps)),D!==0){var O=this._normalizeSpeed(D);this._currentSpeedNormalized!==O&&(this._currentSpeedNormalized=O,this._currentChunkSizeKB=O)}var ee=I.target.response,ie=this._range.from+this._receivedLength;this._receivedLength+=ee.byteLength;var Z=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():Z=!0,this._onDataArrival&&this._onDataArrival(ee,ie,this._receivedLength),Z&&(this._status=h.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},P.prototype._onXhrError=function(I){this._status=h.c.kError;var D=0,O=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(D=h.b.EARLY_EOF,O={code:-1,msg:"RangeLoader meet Early-Eof"}):(D=h.b.EXCEPTION,O={code:-1,msg:I.constructor.name+" "+I.type}),!this._onError)throw new f.d(O.msg);this._onError(D,O)},P})(h.a),C=(function(){var B=function(P,I){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,O){D.__proto__=O}||function(D,O){for(var ee in O)Object.prototype.hasOwnProperty.call(O,ee)&&(D[ee]=O[ee])})(P,I)};return function(P,I){if(typeof I!="function"&&I!==null)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");function D(){this.constructor=P}B(P,I),P.prototype=I===null?Object.create(I):(D.prototype=I.prototype,new D)}})(),T=(function(B){function P(){var I=B.call(this,"websocket-loader")||this;return I.TAG="WebSocketLoader",I._needStash=!0,I._ws=null,I._requestAbort=!1,I._receivedLength=0,I}return C(P,B),P.isSupported=function(){try{return self.WebSocket!==void 0}catch{return!1}},P.prototype.destroy=function(){this._ws&&this.abort(),B.prototype.destroy.call(this)},P.prototype.open=function(I){try{var D=this._ws=new self.WebSocket(I.url);D.binaryType="arraybuffer",D.onopen=this._onWebSocketOpen.bind(this),D.onclose=this._onWebSocketClose.bind(this),D.onmessage=this._onWebSocketMessage.bind(this),D.onerror=this._onWebSocketError.bind(this),this._status=h.c.kConnecting}catch(ee){this._status=h.c.kError;var O={code:ee.code,msg:ee.message};if(!this._onError)throw new f.d(O.msg);this._onError(h.b.EXCEPTION,O)}},P.prototype.abort=function(){var I=this._ws;!I||I.readyState!==0&&I.readyState!==1||(this._requestAbort=!0,I.close()),this._ws=null,this._status=h.c.kComplete},P.prototype._onWebSocketOpen=function(I){this._status=h.c.kBuffering},P.prototype._onWebSocketClose=function(I){this._requestAbort!==!0?(this._status=h.c.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1},P.prototype._onWebSocketMessage=function(I){var D=this;if(I.data instanceof ArrayBuffer)this._dispatchArrayBuffer(I.data);else if(I.data instanceof Blob){var O=new FileReader;O.onload=function(){D._dispatchArrayBuffer(O.result)},O.readAsArrayBuffer(I.data)}else{this._status=h.c.kError;var ee={code:-1,msg:"Unsupported WebSocket message type: "+I.data.constructor.name};if(!this._onError)throw new f.d(ee.msg);this._onError(h.b.EXCEPTION,ee)}},P.prototype._dispatchArrayBuffer=function(I){var D=I,O=this._receivedLength;this._receivedLength+=D.byteLength,this._onDataArrival&&this._onDataArrival(D,O,this._receivedLength)},P.prototype._onWebSocketError=function(I){this._status=h.c.kError;var D={code:I.code,msg:I.message};if(!this._onError)throw new f.d(D.msg);this._onError(h.b.EXCEPTION,D)},P})(h.a),L=(function(){function B(P){this._zeroStart=P||!1}return B.prototype.getConfig=function(P,I){var D={};if(I.from!==0||I.to!==-1){var O=void 0;O=I.to!==-1?"bytes=".concat(I.from.toString(),"-").concat(I.to.toString()):"bytes=".concat(I.from.toString(),"-"),D.Range=O}else this._zeroStart&&(D.Range="bytes=0-");return{url:P,headers:D}},B.prototype.removeURLParameters=function(P){return P},B})(),F=(function(){function B(P,I){this._startName=P,this._endName=I}return B.prototype.getConfig=function(P,I){var D=P;if(I.from!==0||I.to!==-1){var O=!0;D.indexOf("?")===-1&&(D+="?",O=!1),O&&(D+="&"),D+="".concat(this._startName,"=").concat(I.from.toString()),I.to!==-1&&(D+="&".concat(this._endName,"=").concat(I.to.toString()))}return{url:D,headers:{}}},B.prototype.removeURLParameters=function(P){var I=P.split("?")[0],D=void 0,O=P.indexOf("?");O!==-1&&(D=P.substring(O+1));var ee="";if(D!=null&&D.length>0)for(var ie=D.split("&"),Z=0;Z<ie.length;Z++){var z=ie[Z].split("="),X=Z>0;z[0]!==this._startName&&z[0]!==this._endName&&(X&&(ee+="&"),ee+=ie[Z])}return ee.length===0?I:I+"?"+ee},B})(),H=(function(){function B(P,I,D){this.TAG="IOController",this._config=I,this._extraData=D,this._stashInitialSize=65536,I.stashInitialSize!=null&&I.stashInitialSize>0&&(this._stashInitialSize=I.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=Math.max(this._stashSize,3145728),this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,I.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=P,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(P.url),this._refTotalLength=P.filesize?P.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new d,this._speedNormalizeList=[32,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return B.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},B.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},B.prototype.isPaused=function(){return this._paused},Object.defineProperty(B.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"extraData",{get:function(){return this._extraData},set:function(P){this._extraData=P},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(P){this._onDataArrival=P},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(P){this._onSeeked=P},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onError",{get:function(){return this._onError},set:function(P){this._onError=P},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onComplete",{get:function(){return this._onComplete},set:function(P){this._onComplete=P},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(P){this._onRedirect=P},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(P){this._onRecoveredEarlyEof=P},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"currentSpeed",{get:function(){return this._loaderClass===N?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),B.prototype._selectSeekHandler=function(){var P=this._config;if(P.seekType==="range")this._seekHandler=new L(this._config.rangeLoadZeroStart);else if(P.seekType==="param"){var I=P.seekParamStart||"bstart",D=P.seekParamEnd||"bend";this._seekHandler=new F(I,D)}else{if(P.seekType!=="custom")throw new f.b("Invalid seekType in config: ".concat(P.seekType));if(typeof P.customSeekHandler!="function")throw new f.b("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new P.customSeekHandler}},B.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=T;else if(p.isSupported())this._loaderClass=p;else if(y.isSupported())this._loaderClass=y;else{if(!N.isSupported())throw new f.d("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=N}},B.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},B.prototype.open=function(P){this._currentRange={from:0,to:-1},P&&(this._currentRange.from=P),this._speedSampler.reset(),P||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},B.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},B.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},B.prototype.resume=function(){if(this._paused){this._paused=!1;var P=this._resumeFrom;this._resumeFrom=0,this._internalSeek(P,!0)}},B.prototype.seek=function(P){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(P,!0)},B.prototype._internalSeek=function(P,I){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(I),this._loader.destroy(),this._loader=null;var D={from:P,to:-1};this._currentRange={from:D.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,D),this._onSeeked&&this._onSeeked()},B.prototype.updateUrl=function(P){if(!P||typeof P!="string"||P.length===0)throw new f.b("Url must be a non-empty string!");this._dataSource.url=P},B.prototype._expandBuffer=function(P){for(var I=this._stashSize;I+1048576<P;)I*=2;if((I+=1048576)!==this._bufferSize){var D=new ArrayBuffer(I);if(this._stashUsed>0){var O=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(D,0,I).set(O,0)}this._stashBuffer=D,this._bufferSize=I}},B.prototype._normalizeSpeed=function(P){var I=this._speedNormalizeList,D=I.length-1,O=0,ee=0,ie=D;if(P<I[0])return I[0];for(;ee<=ie;){if((O=ee+Math.floor((ie-ee)/2))===D||P>=I[O]&&P<I[O+1])return I[O];I[O]<P?ee=O+1:ie=O-1}},B.prototype._adjustStashSize=function(P){var I=0;(I=this._config.isLive?P/8:P<512?P:P>=512&&P<=1024?Math.floor(1.5*P):2*P)>8192&&(I=8192);var D=1024*I+1048576;this._bufferSize<D&&this._expandBuffer(D),this._stashSize=1024*I},B.prototype._dispatchChunks=function(P,I){return this._currentRange.to=I+P.byteLength-1,this._onDataArrival(P,I)},B.prototype._onURLRedirect=function(P){this._redirectedURL=P,this._onRedirect&&this._onRedirect(P)},B.prototype._onContentLengthKnown=function(P){P&&this._fullRequestFlag&&(this._totalLength=P,this._fullRequestFlag=!1)},B.prototype._onLoaderChunkArrival=function(P,I,D){if(!this._onDataArrival)throw new f.a("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(P.byteLength);var O=this._speedSampler.lastSecondKBps;if(O!==0){var ee=this._normalizeSpeed(O);this._speedNormalized!==ee&&(this._speedNormalized=ee,this._adjustStashSize(ee))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=I),this._stashUsed+P.byteLength<=this._stashSize)(z=new Uint8Array(this._stashBuffer,0,this._stashSize)).set(new Uint8Array(P),this._stashUsed),this._stashUsed+=P.byteLength;else if(z=new Uint8Array(this._stashBuffer,0,this._bufferSize),this._stashUsed>0){var ie=this._stashBuffer.slice(0,this._stashUsed);(X=this._dispatchChunks(ie,this._stashByteStart))<ie.byteLength?X>0&&(ae=new Uint8Array(ie,X),z.set(ae,0),this._stashUsed=ae.byteLength,this._stashByteStart+=X):(this._stashUsed=0,this._stashByteStart+=X),this._stashUsed+P.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+P.byteLength),z=new Uint8Array(this._stashBuffer,0,this._bufferSize)),z.set(new Uint8Array(P),this._stashUsed),this._stashUsed+=P.byteLength}else(X=this._dispatchChunks(P,I))<P.byteLength&&((Z=P.byteLength-X)>this._bufferSize&&(this._expandBuffer(Z),z=new Uint8Array(this._stashBuffer,0,this._bufferSize)),z.set(new Uint8Array(P,X),0),this._stashUsed+=Z,this._stashByteStart=I+X);else if(this._stashUsed===0){var Z;(X=this._dispatchChunks(P,I))<P.byteLength&&((Z=P.byteLength-X)>this._bufferSize&&this._expandBuffer(Z),(z=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(P,X),0),this._stashUsed+=Z,this._stashByteStart=I+X)}else{var z,X;if(this._stashUsed+P.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+P.byteLength),(z=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(P),this._stashUsed),this._stashUsed+=P.byteLength,(X=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart))<this._stashUsed&&X>0){var ae=new Uint8Array(this._stashBuffer,X);z.set(ae,0)}this._stashUsed-=X,this._stashByteStart+=X}}},B.prototype._flushStashBuffer=function(P){if(this._stashUsed>0){var I=this._stashBuffer.slice(0,this._stashUsed),D=this._dispatchChunks(I,this._stashByteStart),O=I.byteLength-D;if(D<I.byteLength){if(!P){if(D>0){var ee=new Uint8Array(this._stashBuffer,0,this._bufferSize),ie=new Uint8Array(I,D);ee.set(ie,0),this._stashUsed=ie.byteLength,this._stashByteStart+=D}return 0}o.a.w(this.TAG,"".concat(O," bytes unconsumed data remain when flush buffer, dropped"))}return this._stashUsed=0,this._stashByteStart=0,O}return 0},B.prototype._onLoaderComplete=function(P,I){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},B.prototype._onLoaderError=function(P,I){switch(o.a.e(this.TAG,"Loader error, code = ".concat(I.code,", msg = ").concat(I.msg)),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,P=h.b.UNRECOVERABLE_EARLY_EOF),P){case h.b.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var D=this._currentRange.to+1;return void(D<this._totalLength&&(o.a.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(D,!1)))}P=h.b.UNRECOVERABLE_EARLY_EOF;break;case h.b.UNRECOVERABLE_EARLY_EOF:case h.b.CONNECTING_TIMEOUT:case h.b.HTTP_STATUS_CODE_INVALID:case h.b.EXCEPTION:}if(!this._onError)throw new f.d("IOException: "+I.msg);this._onError(P,I)},B})();n.a=H},function(s,n,i){var l=(function(){function o(){}return o.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(d,h){return d.__proto__=h,d},Object.assign=Object.assign||function(d){if(d==null)throw new TypeError("Cannot convert undefined or null to object");for(var h=Object(d),u=1;u<arguments.length;u++){var f=arguments[u];if(f!=null)for(var g in f)f.hasOwnProperty(g)&&(h[g]=f[g])}return h},String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(d,h){var u=h>0?0|h:0;return this.substring(u,u+d.length)===d}}),typeof self.Promise!="function"&&i(21).polyfill()},o})();l.install(),n.a=l},function(s,n,i){var l=i(9),o=i.n(l),d=i(0),h=i(5),u=i(7),f=i(3),g=(function(){function p(b){this.TAG="MSEController",this._config=b,this._emitter=new o.a,this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onStartStreaming:this._onStartStreaming.bind(this),onEndStreaming:this._onEndStreaming.bind(this),onQualityChange:this._onQualityChange.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._useManagedMediaSource="ManagedMediaSource"in self&&!("MediaSource"in self),this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElementProxy=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]}}return p.prototype.destroy=function(){this._mediaSource&&this.shutdown(),this._mediaSourceObjectURL&&this.revokeObjectURL(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},p.prototype.on=function(b,y){this._emitter.addListener(b,y)},p.prototype.off=function(b,y){this._emitter.removeListener(b,y)},p.prototype.initialize=function(b){if(this._mediaSource)throw new f.a("MediaSource has been attached to an HTMLMediaElement!");this._useManagedMediaSource&&d.a.v(this.TAG,"Using ManagedMediaSource");var y=this._mediaSource=this._useManagedMediaSource?new self.ManagedMediaSource:new self.MediaSource;y.addEventListener("sourceopen",this.e.onSourceOpen),y.addEventListener("sourceended",this.e.onSourceEnded),y.addEventListener("sourceclose",this.e.onSourceClose),this._useManagedMediaSource&&(y.addEventListener("startstreaming",this.e.onStartStreaming),y.addEventListener("endstreaming",this.e.onEndStreaming),y.addEventListener("qualitychange",this.e.onQualityChange)),this._mediaElementProxy=b},p.prototype.shutdown=function(){if(this._mediaSource){var b=this._mediaSource;for(var y in this._sourceBuffers){var v=this._pendingSegments[y];v.splice(0,v.length),this._pendingSegments[y]=null,this._pendingRemoveRanges[y]=null,this._lastInitSegments[y]=null;var _=this._sourceBuffers[y];if(_){if(b.readyState!=="closed"){try{b.removeSourceBuffer(_)}catch(N){d.a.e(this.TAG,N.message)}_.removeEventListener("error",this.e.onSourceBufferError),_.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[y]=null,this._sourceBuffers[y]=null}}if(b.readyState==="open")try{b.endOfStream()}catch(N){d.a.e(this.TAG,N.message)}this._mediaElementProxy=null,b.removeEventListener("sourceopen",this.e.onSourceOpen),b.removeEventListener("sourceended",this.e.onSourceEnded),b.removeEventListener("sourceclose",this.e.onSourceClose),this._useManagedMediaSource&&(b.removeEventListener("startstreaming",this.e.onStartStreaming),b.removeEventListener("endstreaming",this.e.onEndStreaming),b.removeEventListener("qualitychange",this.e.onQualityChange)),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._mediaSource=null}},p.prototype.isManagedMediaSource=function(){return this._useManagedMediaSource},p.prototype.getObject=function(){if(!this._mediaSource)throw new f.a("MediaSource has not been initialized yet!");return this._mediaSource},p.prototype.getHandle=function(){if(!this._mediaSource)throw new f.a("MediaSource has not been initialized yet!");return this._mediaSource.handle},p.prototype.getObjectURL=function(){if(!this._mediaSource)throw new f.a("MediaSource has not been initialized yet!");return this._mediaSourceObjectURL==null&&(this._mediaSourceObjectURL=URL.createObjectURL(this._mediaSource)),this._mediaSourceObjectURL},p.prototype.revokeObjectURL=function(){this._mediaSourceObjectURL&&(URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},p.prototype.appendInitSegment=function(b,y){if(y===void 0&&(y=void 0),!this._mediaSource||this._mediaSource.readyState!=="open"||this._mediaSource.streaming===!1)return this._pendingSourceBufferInit.push(b),void this._pendingSegments[b.type].push(b);var v=b,_="".concat(v.container);v.codec&&v.codec.length>0&&(v.codec==="opus"&&h.a.safari&&(v.codec="Opus"),_+=";codecs=".concat(v.codec));var N=!1;if(d.a.v(this.TAG,"Received Initialization Segment, mimeType: "+_),this._lastInitSegments[v.type]=v,_!==this._mimeTypes[v.type]){if(this._mimeTypes[v.type])d.a.v(this.TAG,"Notice: ".concat(v.type," mimeType changed, origin: ").concat(this._mimeTypes[v.type],", target: ").concat(_));else{N=!0;try{var C=this._sourceBuffers[v.type]=this._mediaSource.addSourceBuffer(_);C.addEventListener("error",this.e.onSourceBufferError),C.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(T){return d.a.e(this.TAG,T.message),void this._emitter.emit(u.a.ERROR,{code:T.code,msg:T.message})}}this._mimeTypes[v.type]=_}y||this._pendingSegments[v.type].push(v),N||this._sourceBuffers[v.type]&&!this._sourceBuffers[v.type].updating&&this._doAppendSegments(),h.a.safari&&v.container==="audio/mpeg"&&v.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=v.mediaDuration/1e3,this._updateMediaSourceDuration())},p.prototype.appendMediaSegment=function(b){var y=b;this._pendingSegments[y.type].push(y),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var v=this._sourceBuffers[y.type];!v||v.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()},p.prototype.flush=function(){for(var b in this._sourceBuffers)if(this._sourceBuffers[b]){var y=this._sourceBuffers[b];if(this._mediaSource.readyState==="open")try{y.abort()}catch(L){d.a.e(this.TAG,L.message)}var v=this._pendingSegments[b];if(v.splice(0,v.length),this._mediaSource.readyState!=="closed"){for(var _=0;_<y.buffered.length;_++){var N=y.buffered.start(_),C=y.buffered.end(_);this._pendingRemoveRanges[b].push({start:N,end:C})}if(y.updating||this._doRemoveRanges(),h.a.safari){var T=this._lastInitSegments[b];T&&(this._pendingSegments[b].push(T),y.updating||this._doAppendSegments())}}}},p.prototype.endOfStream=function(){var b=this._mediaSource,y=this._sourceBuffers;b&&b.readyState==="open"?y.video&&y.video.updating||y.audio&&y.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,b.endOfStream()):b&&b.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0)},p.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var b=this._mediaElementProxy.getCurrentTime();for(var y in this._sourceBuffers){var v=this._sourceBuffers[y];if(v){var _=v.buffered;if(_.length>=1&&b-_.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},p.prototype._doCleanupSourceBuffer=function(){var b=this._mediaElementProxy.getCurrentTime();for(var y in this._sourceBuffers){var v=this._sourceBuffers[y];if(v){for(var _=v.buffered,N=!1,C=0;C<_.length;C++){var T=_.start(C),L=_.end(C);if(T<=b&&b<L+3){if(b-T>=this._config.autoCleanupMaxBackwardDuration){N=!0;var F=b-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[y].push({start:T,end:F})}}else L<b&&(N=!0,this._pendingRemoveRanges[y].push({start:T,end:L}))}N&&!v.updating&&this._doRemoveRanges()}}},p.prototype._updateMediaSourceDuration=function(){var b=this._sourceBuffers;if(this._mediaElementProxy.getReadyState()!==0&&this._mediaSource.readyState==="open"&&!(b.video&&b.video.updating||b.audio&&b.audio.updating)){var y=this._mediaSource.duration,v=this._pendingMediaDuration;v>0&&(isNaN(y)||v>y)&&(d.a.v(this.TAG,"Update MediaSource duration from ".concat(y," to ").concat(v)),this._mediaSource.duration=v),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},p.prototype._doRemoveRanges=function(){for(var b in this._pendingRemoveRanges)if(this._sourceBuffers[b]&&!this._sourceBuffers[b].updating)for(var y=this._sourceBuffers[b],v=this._pendingRemoveRanges[b];v.length&&!y.updating;){var _=v.shift();y.remove(_.start,_.end)}},p.prototype._doAppendSegments=function(){var b=this._pendingSegments;for(var y in b)if(this._sourceBuffers[y]&&!this._sourceBuffers[y].updating&&this._mediaSource.streaming!==!1&&b[y].length>0){var v=b[y].shift();if(typeof v.timestampOffset=="number"&&isFinite(v.timestampOffset)){var _=this._sourceBuffers[y].timestampOffset,N=v.timestampOffset/1e3;Math.abs(_-N)>.1&&(d.a.v(this.TAG,"Update MPEG audio timestampOffset from ".concat(_," to ").concat(N)),this._sourceBuffers[y].timestampOffset=N),delete v.timestampOffset}if(!v.data||v.data.byteLength===0)continue;try{this._sourceBuffers[y].appendBuffer(v.data),this._isBufferFull=!1}catch(C){this._pendingSegments[y].unshift(v),C.code===22?(this._isBufferFull||this._emitter.emit(u.a.BUFFER_FULL),this._isBufferFull=!0):(d.a.e(this.TAG,C.message),this._emitter.emit(u.a.ERROR,{code:C.code,msg:C.message}))}}},p.prototype._onSourceOpen=function(){if(d.a.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var b=this._pendingSourceBufferInit;b.length;){var y=b.shift();this.appendInitSegment(y,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(u.a.SOURCE_OPEN)},p.prototype._onStartStreaming=function(){d.a.v(this.TAG,"ManagedMediaSource onStartStreaming"),this._emitter.emit(u.a.START_STREAMING)},p.prototype._onEndStreaming=function(){d.a.v(this.TAG,"ManagedMediaSource onEndStreaming"),this._emitter.emit(u.a.END_STREAMING)},p.prototype._onQualityChange=function(){d.a.v(this.TAG,"ManagedMediaSource onQualityChange")},p.prototype._onSourceEnded=function(){d.a.v(this.TAG,"MediaSource onSourceEnded")},p.prototype._onSourceClose=function(){d.a.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose),this._useManagedMediaSource&&(this._mediaSource.removeEventListener("startstreaming",this.e.onStartStreaming),this._mediaSource.removeEventListener("endstreaming",this.e.onEndStreaming),this._mediaSource.removeEventListener("qualitychange",this.e.onQualityChange)))},p.prototype._hasPendingSegments=function(){var b=this._pendingSegments;return b.video.length>0||b.audio.length>0},p.prototype._hasPendingRemoveRanges=function(){var b=this._pendingRemoveRanges;return b.video.length>0||b.audio.length>0},p.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(u.a.UPDATE_END)},p.prototype._onSourceBufferError=function(b){d.a.e(this.TAG,"SourceBuffer Error: ".concat(b))},p})();n.a=g},function(s,n,i){var l=i(9),o=i.n(l),d=i(18),h=i.n(d),u=i(0),f=i(8),g=i(13),p=i(1),b=(i(19),i(12)),y=(function(){function v(_,N){if(this.TAG="Transmuxer",this._emitter=new o.a,N.enableWorker&&typeof Worker<"u")try{this._worker=h()(19),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[_,N]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},f.a.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:f.a.getConfig()})}catch{u.a.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new g.a(_,N)}else this._controller=new g.a(_,N);if(this._controller){var C=this._controller;C.on(p.a.IO_ERROR,this._onIOError.bind(this)),C.on(p.a.DEMUX_ERROR,this._onDemuxError.bind(this)),C.on(p.a.INIT_SEGMENT,this._onInitSegment.bind(this)),C.on(p.a.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),C.on(p.a.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),C.on(p.a.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),C.on(p.a.MEDIA_INFO,this._onMediaInfo.bind(this)),C.on(p.a.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),C.on(p.a.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),C.on(p.a.TIMED_ID3_METADATA_ARRIVED,this._onTimedID3MetadataArrived.bind(this)),C.on(p.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,this._onSynchronousKLVMetadataArrived.bind(this)),C.on(p.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,this._onAsynchronousKLVMetadataArrived.bind(this)),C.on(p.a.SMPTE2038_METADATA_ARRIVED,this._onSMPTE2038MetadataArrived.bind(this)),C.on(p.a.SCTE35_METADATA_ARRIVED,this._onSCTE35MetadataArrived.bind(this)),C.on(p.a.PES_PRIVATE_DATA_DESCRIPTOR,this._onPESPrivateDataDescriptor.bind(this)),C.on(p.a.PES_PRIVATE_DATA_ARRIVED,this._onPESPrivateDataArrived.bind(this)),C.on(p.a.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),C.on(p.a.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return v.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),f.a.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},v.prototype.on=function(_,N){this._emitter.addListener(_,N)},v.prototype.off=function(_,N){this._emitter.removeListener(_,N)},v.prototype.hasWorker=function(){return this._worker!=null},v.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},v.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},v.prototype.seek=function(_){this._worker?this._worker.postMessage({cmd:"seek",param:_}):this._controller.seek(_)},v.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},v.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},v.prototype._onInitSegment=function(_,N){var C=this;Promise.resolve().then((function(){C._emitter.emit(p.a.INIT_SEGMENT,_,N)}))},v.prototype._onMediaSegment=function(_,N){var C=this;Promise.resolve().then((function(){C._emitter.emit(p.a.MEDIA_SEGMENT,_,N)}))},v.prototype._onLoadingComplete=function(){var _=this;Promise.resolve().then((function(){_._emitter.emit(p.a.LOADING_COMPLETE)}))},v.prototype._onRecoveredEarlyEof=function(){var _=this;Promise.resolve().then((function(){_._emitter.emit(p.a.RECOVERED_EARLY_EOF)}))},v.prototype._onMediaInfo=function(_){var N=this;Promise.resolve().then((function(){N._emitter.emit(p.a.MEDIA_INFO,_)}))},v.prototype._onMetaDataArrived=function(_){var N=this;Promise.resolve().then((function(){N._emitter.emit(p.a.METADATA_ARRIVED,_)}))},v.prototype._onScriptDataArrived=function(_){var N=this;Promise.resolve().then((function(){N._emitter.emit(p.a.SCRIPTDATA_ARRIVED,_)}))},v.prototype._onTimedID3MetadataArrived=function(_){var N=this;Promise.resolve().then((function(){N._emitter.emit(p.a.TIMED_ID3_METADATA_ARRIVED,_)}))},v.prototype._onSynchronousKLVMetadataArrived=function(_){var N=this;Promise.resolve().then((function(){N._emitter.emit(p.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,_)}))},v.prototype._onAsynchronousKLVMetadataArrived=function(_){var N=this;Promise.resolve().then((function(){N._emitter.emit(p.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,_)}))},v.prototype._onSMPTE2038MetadataArrived=function(_){var N=this;Promise.resolve().then((function(){N._emitter.emit(p.a.SMPTE2038_METADATA_ARRIVED,_)}))},v.prototype._onSCTE35MetadataArrived=function(_){var N=this;Promise.resolve().then((function(){N._emitter.emit(p.a.SCTE35_METADATA_ARRIVED,_)}))},v.prototype._onPESPrivateDataDescriptor=function(_){var N=this;Promise.resolve().then((function(){N._emitter.emit(p.a.PES_PRIVATE_DATA_DESCRIPTOR,_)}))},v.prototype._onPESPrivateDataArrived=function(_){var N=this;Promise.resolve().then((function(){N._emitter.emit(p.a.PES_PRIVATE_DATA_ARRIVED,_)}))},v.prototype._onStatisticsInfo=function(_){var N=this;Promise.resolve().then((function(){N._emitter.emit(p.a.STATISTICS_INFO,_)}))},v.prototype._onIOError=function(_,N){var C=this;Promise.resolve().then((function(){C._emitter.emit(p.a.IO_ERROR,_,N)}))},v.prototype._onDemuxError=function(_,N){var C=this;Promise.resolve().then((function(){C._emitter.emit(p.a.DEMUX_ERROR,_,N)}))},v.prototype._onRecommendSeekpoint=function(_){var N=this;Promise.resolve().then((function(){N._emitter.emit(p.a.RECOMMEND_SEEKPOINT,_)}))},v.prototype._onLoggingConfigChanged=function(_){this._worker&&this._worker.postMessage({cmd:"logging_config",param:_})},v.prototype._onWorkerMessage=function(_){var N=_.data,C=N.data;if(N.msg==="destroyed"||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(N.msg){case p.a.INIT_SEGMENT:case p.a.MEDIA_SEGMENT:this._emitter.emit(N.msg,C.type,C.data);break;case p.a.LOADING_COMPLETE:case p.a.RECOVERED_EARLY_EOF:this._emitter.emit(N.msg);break;case p.a.MEDIA_INFO:Object.setPrototypeOf(C,b.a.prototype),this._emitter.emit(N.msg,C);break;case p.a.METADATA_ARRIVED:case p.a.SCRIPTDATA_ARRIVED:case p.a.TIMED_ID3_METADATA_ARRIVED:case p.a.SYNCHRONOUS_KLV_METADATA_ARRIVED:case p.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED:case p.a.SMPTE2038_METADATA_ARRIVED:case p.a.SCTE35_METADATA_ARRIVED:case p.a.PES_PRIVATE_DATA_DESCRIPTOR:case p.a.PES_PRIVATE_DATA_ARRIVED:case p.a.STATISTICS_INFO:this._emitter.emit(N.msg,C);break;case p.a.IO_ERROR:case p.a.DEMUX_ERROR:this._emitter.emit(N.msg,C.type,C.info);break;case p.a.RECOMMEND_SEEKPOINT:this._emitter.emit(N.msg,C);break;case"logcat_callback":u.a.emitter.emit("log",C.type,C.logcat)}},v})();n.a=y},function(s,n,i){function l(u){var f={};function g(b){if(f[b])return f[b].exports;var y=f[b]={i:b,l:!1,exports:{}};return u[b].call(y.exports,y,y.exports,g),y.l=!0,y.exports}g.m=u,g.c=f,g.i=function(b){return b},g.d=function(b,y,v){g.o(b,y)||Object.defineProperty(b,y,{configurable:!1,enumerable:!0,get:v})},g.r=function(b){Object.defineProperty(b,"__esModule",{value:!0})},g.n=function(b){var y=b&&b.__esModule?function(){return b.default}:function(){return b};return g.d(y,"a",y),y},g.o=function(b,y){return Object.prototype.hasOwnProperty.call(b,y)},g.p="/",g.oe=function(b){throw console.error(b),b};var p=g(g.s=ENTRY_MODULE);return p.default||p}function o(u){return(u+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function d(u,f,g){var p={};p[g]=[];var b=f.toString(),y=b.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!y)return p;for(var v,_=y[1],N=new RegExp("(\\\\n|\\W)"+o(_)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");v=N.exec(b);)v[3]!=="dll-reference"&&p[g].push(v[3]);for(N=new RegExp("\\("+o(_)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");v=N.exec(b);)u[v[2]]||(p[g].push(v[1]),u[v[2]]=i(v[1]).m),p[v[2]]=p[v[2]]||[],p[v[2]].push(v[4]);for(var C,T=Object.keys(p),L=0;L<T.length;L++)for(var F=0;F<p[T[L]].length;F++)C=p[T[L]][F],isNaN(1*C)||(p[T[L]][F]=1*p[T[L]][F]);return p}function h(u){return Object.keys(u).reduce((function(f,g){return f||u[g].length>0}),!1)}s.exports=function(u,f){f=f||{};var g={main:i.m},p=f.all?{main:Object.keys(g.main)}:(function(N,C){for(var T={main:[C]},L={main:[]},F={main:{}};h(T);)for(var H=Object.keys(T),B=0;B<H.length;B++){var P=H[B],I=T[P].pop();if(F[P]=F[P]||{},!F[P][I]&&N[P][I]){F[P][I]=!0,L[P]=L[P]||[],L[P].push(I);for(var D=d(N,N[P][I],P),O=Object.keys(D),ee=0;ee<O.length;ee++)T[O[ee]]=T[O[ee]]||[],T[O[ee]]=T[O[ee]].concat(D[O[ee]])}}return L})(g,u),b="";Object.keys(p).filter((function(N){return N!=="main"})).forEach((function(N){for(var C=0;p[N][C];)C++;p[N].push(C),g[N][C]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",b=b+"var "+N+" = ("+l.toString().replace("ENTRY_MODULE",JSON.stringify(C))+")({"+p[N].map((function(T){return JSON.stringify(T)+": "+g[N][T].toString()})).join(",")+`});
`})),b=b+"new (("+l.toString().replace("ENTRY_MODULE",JSON.stringify(u))+")({"+p.main.map((function(N){return JSON.stringify(N)+": "+g.main[N].toString()})).join(",")+"}))(self);";var y=new self.Blob([b],{type:"text/javascript"});if(f.bare)return y;var v=(self.URL||self.webkitURL||self.mozURL||self.msURL).createObjectURL(y),_=new self.Worker(v);return _.objectURL=v,_}},function(s,n,i){i.r(n),i(0);var l=i(8),o=i(15),d=i(13),h=i(1);n.default=function(u){var f=null,g=(function(Z,z){u.postMessage({msg:"logcat_callback",data:{type:Z,logcat:z}})}).bind(this);function p(Z,z){var X={msg:h.a.INIT_SEGMENT,data:{type:Z,data:z}};u.postMessage(X,[z.data])}function b(Z,z){var X={msg:h.a.MEDIA_SEGMENT,data:{type:Z,data:z}};u.postMessage(X,[z.data])}function y(){var Z={msg:h.a.LOADING_COMPLETE};u.postMessage(Z)}function v(){var Z={msg:h.a.RECOVERED_EARLY_EOF};u.postMessage(Z)}function _(Z){var z={msg:h.a.MEDIA_INFO,data:Z};u.postMessage(z)}function N(Z){var z={msg:h.a.METADATA_ARRIVED,data:Z};u.postMessage(z)}function C(Z){var z={msg:h.a.SCRIPTDATA_ARRIVED,data:Z};u.postMessage(z)}function T(Z){var z={msg:h.a.TIMED_ID3_METADATA_ARRIVED,data:Z};u.postMessage(z)}function L(Z){var z={msg:h.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,data:Z};u.postMessage(z)}function F(Z){var z={msg:h.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,data:Z};u.postMessage(z)}function H(Z){var z={msg:h.a.SMPTE2038_METADATA_ARRIVED,data:Z};u.postMessage(z)}function B(Z){var z={msg:h.a.SCTE35_METADATA_ARRIVED,data:Z};u.postMessage(z)}function P(Z){var z={msg:h.a.PES_PRIVATE_DATA_DESCRIPTOR,data:Z};u.postMessage(z)}function I(Z){var z={msg:h.a.PES_PRIVATE_DATA_ARRIVED,data:Z};u.postMessage(z)}function D(Z){var z={msg:h.a.STATISTICS_INFO,data:Z};u.postMessage(z)}function O(Z,z){u.postMessage({msg:h.a.IO_ERROR,data:{type:Z,info:z}})}function ee(Z,z){u.postMessage({msg:h.a.DEMUX_ERROR,data:{type:Z,info:z}})}function ie(Z){u.postMessage({msg:h.a.RECOMMEND_SEEKPOINT,data:Z})}o.a.install(),u.addEventListener("message",(function(Z){switch(Z.data.cmd){case"init":(f=new d.a(Z.data.param[0],Z.data.param[1])).on(h.a.IO_ERROR,O.bind(this)),f.on(h.a.DEMUX_ERROR,ee.bind(this)),f.on(h.a.INIT_SEGMENT,p.bind(this)),f.on(h.a.MEDIA_SEGMENT,b.bind(this)),f.on(h.a.LOADING_COMPLETE,y.bind(this)),f.on(h.a.RECOVERED_EARLY_EOF,v.bind(this)),f.on(h.a.MEDIA_INFO,_.bind(this)),f.on(h.a.METADATA_ARRIVED,N.bind(this)),f.on(h.a.SCRIPTDATA_ARRIVED,C.bind(this)),f.on(h.a.TIMED_ID3_METADATA_ARRIVED,T.bind(this)),f.on(h.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,L.bind(this)),f.on(h.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,F.bind(this)),f.on(h.a.SMPTE2038_METADATA_ARRIVED,H.bind(this)),f.on(h.a.SCTE35_METADATA_ARRIVED,B.bind(this)),f.on(h.a.PES_PRIVATE_DATA_DESCRIPTOR,P.bind(this)),f.on(h.a.PES_PRIVATE_DATA_ARRIVED,I.bind(this)),f.on(h.a.STATISTICS_INFO,D.bind(this)),f.on(h.a.RECOMMEND_SEEKPOINT,ie.bind(this));break;case"destroy":f&&(f.destroy(),f=null),u.postMessage({msg:"destroyed"});break;case"start":f.start();break;case"stop":f.stop();break;case"seek":f.seek(Z.data.param);break;case"pause":f.pause();break;case"resume":f.resume();break;case"logging_config":var z=Z.data.param;l.a.applyConfig(z),z.enableCallback===!0?l.a.addLogListener(g):l.a.removeLogListener(g)}}))}},function(s,n,i){s.exports=i(25).default},function(s,n,i){(function(l,o){var d;d=function(){function h(re){return typeof re=="function"}var u=Array.isArray?Array.isArray:function(re){return Object.prototype.toString.call(re)==="[object Array]"},f=0,g=void 0,p=void 0,b=function(re,fe){L[f]=re,L[f+1]=fe,(f+=2)===2&&(p?p(F):D())},y=typeof window<"u"?window:void 0,v=y||{},_=v.MutationObserver||v.WebKitMutationObserver,N=typeof self>"u"&&l!==void 0&&{}.toString.call(l)==="[object process]",C=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function T(){var re=setTimeout;return function(){return re(F,1)}}var L=new Array(1e3);function F(){for(var re=0;re<f;re+=2)(0,L[re])(L[re+1]),L[re]=void 0,L[re+1]=void 0;f=0}var H,B,P,I,D=void 0;function O(re,fe){var Le=this,ze=new this.constructor(Z);ze[ie]===void 0&&be(ze);var Xe=Le._state;if(Xe){var ue=arguments[Xe-1];b((function(){return J(Xe,ze,ue,Le._result)}))}else K(Le,ze,re,fe);return ze}function ee(re){if(re&&typeof re=="object"&&re.constructor===this)return re;var fe=new this(Z);return X(fe,re),fe}N?D=function(){return l.nextTick(F)}:_?(B=0,P=new _(F),I=document.createTextNode(""),P.observe(I,{characterData:!0}),D=function(){I.data=B=++B%2}):C?((H=new MessageChannel).port1.onmessage=F,D=function(){return H.port2.postMessage(0)}):D=y===void 0?(function(){try{var re=Function("return this")().require("vertx");return(g=re.runOnLoop||re.runOnContext)!==void 0?function(){g(F)}:T()}catch{return T()}})():T();var ie=Math.random().toString(36).substring(2);function Z(){}function z(re,fe,Le){fe.constructor===re.constructor&&Le===O&&fe.constructor.resolve===ee?(function(ze,Xe){Xe._state===1?te(ze,Xe._result):Xe._state===2?W(ze,Xe._result):K(Xe,void 0,(function(ue){return X(ze,ue)}),(function(ue){return W(ze,ue)}))})(re,fe):Le===void 0?te(re,fe):h(Le)?(function(ze,Xe,ue){b((function(Ge){var Ve=!1,bt=(function(We,ot,Ie,Lt){try{We.call(ot,Ie,Lt)}catch(Ht){return Ht}})(ue,Xe,(function(We){Ve||(Ve=!0,Xe!==We?X(Ge,We):te(Ge,We))}),(function(We){Ve||(Ve=!0,W(Ge,We))}),Ge._label);!Ve&&bt&&(Ve=!0,W(Ge,bt))}),ze)})(re,fe,Le):te(re,fe)}function X(re,fe){if(re===fe)W(re,new TypeError("You cannot resolve a promise with itself"));else if(Xe=typeof(ze=fe),ze===null||Xe!=="object"&&Xe!=="function")te(re,fe);else{var Le=void 0;try{Le=fe.then}catch(ue){return void W(re,ue)}z(re,fe,Le)}var ze,Xe}function ae(re){re._onerror&&re._onerror(re._result),q(re)}function te(re,fe){re._state===void 0&&(re._result=fe,re._state=1,re._subscribers.length!==0&&b(q,re))}function W(re,fe){re._state===void 0&&(re._state=2,re._result=fe,b(ae,re))}function K(re,fe,Le,ze){var Xe=re._subscribers,ue=Xe.length;re._onerror=null,Xe[ue]=fe,Xe[ue+1]=Le,Xe[ue+2]=ze,ue===0&&re._state&&b(q,re)}function q(re){var fe=re._subscribers,Le=re._state;if(fe.length!==0){for(var ze=void 0,Xe=void 0,ue=re._result,Ge=0;Ge<fe.length;Ge+=3)ze=fe[Ge],Xe=fe[Ge+Le],ze?J(Le,ze,Xe,ue):Xe(ue);re._subscribers.length=0}}function J(re,fe,Le,ze){var Xe=h(Le),ue=void 0,Ge=void 0,Ve=!0;if(Xe){try{ue=Le(ze)}catch(bt){Ve=!1,Ge=bt}if(fe===ue)return void W(fe,new TypeError("A promises callback cannot return that same promise."))}else ue=ze;fe._state!==void 0||(Xe&&Ve?X(fe,ue):Ve===!1?W(fe,Ge):re===1?te(fe,ue):re===2&&W(fe,ue))}var oe=0;function be(re){re[ie]=oe++,re._state=void 0,re._result=void 0,re._subscribers=[]}var ye=(function(){function re(fe,Le){this._instanceConstructor=fe,this.promise=new fe(Z),this.promise[ie]||be(this.promise),u(Le)?(this.length=Le.length,this._remaining=Le.length,this._result=new Array(this.length),this.length===0?te(this.promise,this._result):(this.length=this.length||0,this._enumerate(Le),this._remaining===0&&te(this.promise,this._result))):W(this.promise,new Error("Array Methods must be provided an Array"))}return re.prototype._enumerate=function(fe){for(var Le=0;this._state===void 0&&Le<fe.length;Le++)this._eachEntry(fe[Le],Le)},re.prototype._eachEntry=function(fe,Le){var ze=this._instanceConstructor,Xe=ze.resolve;if(Xe===ee){var ue=void 0,Ge=void 0,Ve=!1;try{ue=fe.then}catch(We){Ve=!0,Ge=We}if(ue===O&&fe._state!==void 0)this._settledAt(fe._state,Le,fe._result);else if(typeof ue!="function")this._remaining--,this._result[Le]=fe;else if(ze===Ee){var bt=new ze(Z);Ve?W(bt,Ge):z(bt,fe,ue),this._willSettleAt(bt,Le)}else this._willSettleAt(new ze((function(We){return We(fe)})),Le)}else this._willSettleAt(Xe(fe),Le)},re.prototype._settledAt=function(fe,Le,ze){var Xe=this.promise;Xe._state===void 0&&(this._remaining--,fe===2?W(Xe,ze):this._result[Le]=ze),this._remaining===0&&te(Xe,this._result)},re.prototype._willSettleAt=function(fe,Le){var ze=this;K(fe,void 0,(function(Xe){return ze._settledAt(1,Le,Xe)}),(function(Xe){return ze._settledAt(2,Le,Xe)}))},re})(),Ee=(function(){function re(fe){this[ie]=oe++,this._result=this._state=void 0,this._subscribers=[],Z!==fe&&(typeof fe!="function"&&(function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")})(),this instanceof re?(function(Le,ze){try{ze((function(Xe){X(Le,Xe)}),(function(Xe){W(Le,Xe)}))}catch(Xe){W(Le,Xe)}})(this,fe):(function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")})())}return re.prototype.catch=function(fe){return this.then(null,fe)},re.prototype.finally=function(fe){var Le=this.constructor;return h(fe)?this.then((function(ze){return Le.resolve(fe()).then((function(){return ze}))}),(function(ze){return Le.resolve(fe()).then((function(){throw ze}))})):this.then(fe,fe)},re})();return Ee.prototype.then=O,Ee.all=function(re){return new ye(this,re).promise},Ee.race=function(re){var fe=this;return u(re)?new fe((function(Le,ze){for(var Xe=re.length,ue=0;ue<Xe;ue++)fe.resolve(re[ue]).then(Le,ze)})):new fe((function(Le,ze){return ze(new TypeError("You must pass an array to race."))}))},Ee.resolve=ee,Ee.reject=function(re){var fe=new this(Z);return W(fe,re),fe},Ee._setScheduler=function(re){p=re},Ee._setAsap=function(re){b=re},Ee._asap=b,Ee.polyfill=function(){var re=void 0;if(o!==void 0)re=o;else if(typeof self<"u")re=self;else try{re=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var fe=re.Promise;if(fe){var Le=null;try{Le=Object.prototype.toString.call(fe.resolve())}catch{}if(Le==="[object Promise]"&&!fe.cast)return}re.Promise=Ee},Ee.Promise=Ee,Ee},s.exports=d()}).call(this,i(22),i(23))},function(s,n){var i,l,o=s.exports={};function d(){throw new Error("setTimeout has not been defined")}function h(){throw new Error("clearTimeout has not been defined")}function u(C){if(i===setTimeout)return setTimeout(C,0);if((i===d||!i)&&setTimeout)return i=setTimeout,setTimeout(C,0);try{return i(C,0)}catch{try{return i.call(null,C,0)}catch{return i.call(this,C,0)}}}(function(){try{i=typeof setTimeout=="function"?setTimeout:d}catch{i=d}try{l=typeof clearTimeout=="function"?clearTimeout:h}catch{l=h}})();var f,g=[],p=!1,b=-1;function y(){p&&f&&(p=!1,f.length?g=f.concat(g):b=-1,g.length&&v())}function v(){if(!p){var C=u(y);p=!0;for(var T=g.length;T;){for(f=g,g=[];++b<T;)f&&f[b].run();b=-1,T=g.length}f=null,p=!1,(function(L){if(l===clearTimeout)return clearTimeout(L);if((l===h||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(L);try{l(L)}catch{try{return l.call(null,L)}catch{return l.call(this,L)}}})(C)}}function _(C,T){this.fun=C,this.array=T}function N(){}o.nextTick=function(C){var T=new Array(arguments.length-1);if(arguments.length>1)for(var L=1;L<arguments.length;L++)T[L-1]=arguments[L];g.push(new _(C,T)),g.length!==1||p||u(v)},_.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=N,o.addListener=N,o.once=N,o.off=N,o.removeListener=N,o.removeAllListeners=N,o.emit=N,o.prependListener=N,o.prependOnceListener=N,o.listeners=function(C){return[]},o.binding=function(C){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(C){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(s,n){var i;i=(function(){return this})();try{i=i||new Function("return this")()}catch{typeof window=="object"&&(i=window)}s.exports=i},function(s,n,i){i.r(n);var l=i(0),o=i(8),d=i(3),h=i(7),u=i(16),f=i(17),g=i(1),p=i(4),b=i(10);n.default=function(y){var v="PlayerEngineWorker",_=(function(W,K){y.postMessage({msg:"logcat_callback",type:W,logcat:K})}).bind(void 0),N=null,C=null,T=null,L=null,F=!1,H=!1,B=0,P=0,I=!1;function D(){T&&(T.shutdown(),T.destroy(),T=null)}function O(){if(N==null||C==null)throw new d.a("Worker not initialized");if(L)throw new d.a("Transmuxer has been initialized");H||(!C.deferLoadAfterSourceOpen||F?((L=new f.a(N,C)).on(g.a.INIT_SEGMENT,(function(W,K){T.appendInitSegment(K)})),L.on(g.a.MEDIA_SEGMENT,(function(W,K){T.appendMediaSegment(K),y.postMessage({msg:"buffered_position_changed",buffered_position_milliseconds:K.info.endDts})})),L.on(g.a.LOADING_COMPLETE,(function(){T.endOfStream(),y.postMessage({msg:"player_event",event:p.a.LOADING_COMPLETE})})),L.on(g.a.RECOVERED_EARLY_EOF,(function(){y.postMessage({msg:"player_event",event:p.a.RECOVERED_EARLY_EOF})})),L.on(g.a.IO_ERROR,(function(W,K){y.postMessage({msg:"player_event",event:p.a.ERROR,error_type:b.b.NETWORK_ERROR,error_detail:W,info:K})})),L.on(g.a.DEMUX_ERROR,(function(W,K){y.postMessage({msg:"player_event",event:p.a.ERROR,error_type:b.b.MEDIA_ERROR,error_detail:W,info:K})})),L.on(g.a.MEDIA_INFO,(function(W){ae(g.a.MEDIA_INFO,W)})),L.on(g.a.STATISTICS_INFO,(function(W){ae(g.a.STATISTICS_INFO,W)})),L.on(g.a.RECOMMEND_SEEKPOINT,(function(W){(function(K){y.postMessage({msg:"transmuxing_event",event:g.a.RECOMMEND_SEEKPOINT,milliseconds:K})})(W)})),L.on(g.a.METADATA_ARRIVED,(function(W){te(p.a.METADATA_ARRIVED,W)})),L.on(g.a.SCRIPTDATA_ARRIVED,(function(W){te(p.a.SCRIPTDATA_ARRIVED,W)})),L.on(g.a.TIMED_ID3_METADATA_ARRIVED,(function(W){te(p.a.TIMED_ID3_METADATA_ARRIVED,W)})),L.on(g.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,(function(W){te(p.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,W)})),L.on(g.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,(function(W){te(p.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,W)})),L.on(g.a.SMPTE2038_METADATA_ARRIVED,(function(W){te(p.a.SMPTE2038_METADATA_ARRIVED,W)})),L.on(g.a.SCTE35_METADATA_ARRIVED,(function(W){te(p.a.SCTE35_METADATA_ARRIVED,W)})),L.on(g.a.PES_PRIVATE_DATA_DESCRIPTOR,(function(W){te(p.a.PES_PRIVATE_DATA_DESCRIPTOR,W)})),L.on(g.a.PES_PRIVATE_DATA_ARRIVED,(function(W){te(p.a.PES_PRIVATE_DATA_ARRIVED,W)})),L.open()):H=!0)}function ee(){T&&T.flush(),L&&(L.close(),L.destroy(),L=null)}function ie(){F=!0,H&&(H=!1,O())}function Z(){y.postMessage({msg:"mse_event",event:h.a.UPDATE_END})}function z(){l.a.v(v,"MSE SourceBuffer is full, report to main thread"),y.postMessage({msg:"mse_event",event:h.a.BUFFER_FULL})}function X(W){y.postMessage({msg:"player_event",event:p.a.ERROR,error_type:b.b.MEDIA_ERROR,error_detail:b.b.MEDIA_MSE_ERROR,info:W})}function ae(W,K){y.postMessage({msg:"transmuxing_event",event:W,info:K})}function te(W,K){y.postMessage({msg:"player_event",event:W,extraData:K})}y.addEventListener("message",(function(W){if(!I){var K=W.data;switch(K.cmd){case"logging_config":var q=K;o.a.applyConfig(q.logging_config),q.logging_config.enableCallback===!0?o.a.addLogListener(_):o.a.removeLogListener(_);break;case"init":N=(q=K).media_data_source,C=q.config;break;case"destroy":(function(){L&&ee(),T&&D(),I=!0,y.postMessage({msg:"destroyed"})})();break;case"initialize_mse":(function(){l.a.v(v,"Initializing MediaSource in DedicatedWorker"),(T=new u.a(C)).on(h.a.SOURCE_OPEN,ie.bind(this)),T.on(h.a.UPDATE_END,Z.bind(this)),T.on(h.a.BUFFER_FULL,z.bind(this)),T.on(h.a.ERROR,X.bind(this)),T.initialize({getCurrentTime:function(){return B},getReadyState:function(){return P}});var J=T.getHandle();y.postMessage({msg:"mse_init",handle:J},[J])})();break;case"shutdown_mse":D();break;case"load":O();break;case"unload":ee();break;case"unbuffered_seek":q=K,T.flush(),L.seek(q.milliseconds);break;case"timeupdate":B=(q=K).current_time;break;case"readystatechange":P=(q=K).ready_state;break;case"pause_transmuxer":L.pause();break;case"resume_transmuxer":L.resume()}}}))}},function(s,n,i){i.r(n);var l=i(15),o=i(14),d={enableWorker:!1,enableWorkerForMSE:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,liveBufferLatencyChasing:!1,liveBufferLatencyChasingOnPaused:!1,liveBufferLatencyMaxLatency:1.5,liveBufferLatencyMinRemain:.5,liveSync:!1,liveSyncMaxLatency:1.2,liveSyncTargetLatency:.8,liveSyncPlaybackRate:1.2,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function h(){return Object.assign({},d)}var u=(function(){function W(){}return W.supportMSEH264Playback=function(){var K=self.MediaSource&&self.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),q=self.ManagedMediaSource&&self.ManagedMediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');return K||q},W.supportMSEH265Playback=function(){var K=self.MediaSource&&self.MediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"'),q=self.ManagedMediaSource&&self.ManagedMediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"');return K||q},W.supportNetworkStreamIO=function(){var K=new o.a({},h()),q=K.loaderType;return K.destroy(),q=="fetch-stream-loader"||q=="xhr-moz-chunked-loader"},W.getNetworkLoaderTypeName=function(){var K=new o.a({},h()),q=K.loaderType;return K.destroy(),q},W.supportNativeMediaPlayback=function(K){W.videoElement==null&&(W.videoElement=window.document.createElement("video"));var q=W.videoElement.canPlayType(K);return q==="probably"||q=="maybe"},W.getFeatureList=function(){var K={msePlayback:!1,mseLivePlayback:!1,mseH265Playback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeMP4H265Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return K.msePlayback=W.supportMSEH264Playback(),K.networkStreamIO=W.supportNetworkStreamIO(),K.networkLoaderName=W.getNetworkLoaderTypeName(),K.mseLivePlayback=K.msePlayback&&K.networkStreamIO,K.mseH265Playback=W.supportMSEH265Playback(),K.nativeMP4H264Playback=W.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),K.nativeMP4H265Playback=W.supportNativeMediaPlayback('video/mp4; codecs="hvc1.1.6.L93.B0"'),K.nativeWebmVP8Playback=W.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),K.nativeWebmVP9Playback=W.supportNativeMediaPlayback('video/webm; codecs="vp9"'),K},W})(),f=i(2),g=i(0),p=i(9),b=i.n(p),y=i(16),v=i(4),_=i(17),N=i(7),C=i(10),T=i(3),L=i(1),F=i(5),H=i(11),B=(function(){function W(K,q,J){this.TAG="SeekingHandler",this._config=null,this._media_element=null,this._always_seek_keyframe=!1,this._on_unbuffered_seek=null,this._request_set_current_time=!1,this._seek_request_record_clocktime=null,this._idr_sample_list=new H.a,this.e=null,this._config=K,this._media_element=q,this._on_unbuffered_seek=J,this.e={onMediaSeeking:this._onMediaSeeking.bind(this)};var oe=F.a.chrome&&(F.a.version.major<50||F.a.version.major===50&&F.a.version.build<2661);this._always_seek_keyframe=!!(oe||F.a.msedge||F.a.msie),this._always_seek_keyframe&&(this._config.accurateSeek=!1),this._media_element.addEventListener("seeking",this.e.onMediaSeeking)}return W.prototype.destroy=function(){this._idr_sample_list.clear(),this._idr_sample_list=null,this._media_element.removeEventListener("seeking",this.e.onMediaSeeking),this._media_element=null,this._on_unbuffered_seek=null},W.prototype.seek=function(K){var q=this._isPositionBuffered(K),J=!1;if(K<1&&this._media_element.buffered.length>0){var oe=this._media_element.buffered.start(0);(oe<1&&K<oe||F.a.safari)&&(J=!0,K=F.a.safari?.1:oe)}if(J)this.directSeek(K);else if(q)if(this._always_seek_keyframe){var be=this._getNearestKeyframe(Math.floor(1e3*K));be!=null&&(K=be.dts/1e3),this.directSeek(K)}else this.directSeek(K);else this._idr_sample_list.clear(),this._on_unbuffered_seek(Math.floor(1e3*K)),this._config.accurateSeek&&this.directSeek(K)},W.prototype.directSeek=function(K){this._request_set_current_time=!0,this._media_element.currentTime=K},W.prototype.appendSyncPoints=function(K){this._idr_sample_list.appendArray(K)},W.prototype._onMediaSeeking=function(K){if(this._request_set_current_time)this._request_set_current_time=!1;else{var q=this._media_element.currentTime,J=this._media_element.buffered;if(q<1&&J.length>0){var oe=J.start(0);if(oe<1&&q<oe||F.a.safari){var be=F.a.safari?.1:oe;return void this.directSeek(be)}}if(this._isPositionBuffered(q)){if(this._always_seek_keyframe){var ye=this._getNearestKeyframe(Math.floor(1e3*q));ye!=null&&(q=ye.dts/1e3,this.directSeek(q))}}else this._seek_request_record_clocktime=W._getClockTime(),window.setTimeout(this._pollAndApplyUnbufferedSeek.bind(this),50)}},W.prototype._pollAndApplyUnbufferedSeek=function(){if(this._seek_request_record_clocktime!=null)if(this._seek_request_record_clocktime<=W._getClockTime()-100){var K=this._media_element.currentTime;this._seek_request_record_clocktime=null,this._isPositionBuffered(K)||(this._idr_sample_list.clear(),this._on_unbuffered_seek(Math.floor(1e3*K)),this._config.accurateSeek&&this.directSeek(K))}else window.setTimeout(this._pollAndApplyUnbufferedSeek.bind(this),50)},W.prototype._isPositionBuffered=function(K){for(var q=this._media_element.buffered,J=0;J<q.length;J++){var oe=q.start(J),be=q.end(J);if(K>=oe&&K<be)return!0}return!1},W.prototype._getNearestKeyframe=function(K){return this._idr_sample_list.getLastSyncPointBeforeDts(K)},W._getClockTime=function(){return self.performance&&self.performance.now?self.performance.now():Date.now()},W})(),P=(function(){function W(K,q,J,oe){this.TAG="LoadingController",this._config=null,this._media_element=null,this._on_pause_transmuxer=null,this._on_resume_transmuxer=null,this._paused=!1,this.e=null,this._config=K,this._media_element=q,this._on_pause_transmuxer=J,this._on_resume_transmuxer=oe,this.e={onMediaTimeUpdate:this._onMediaTimeUpdate.bind(this)}}return W.prototype.destroy=function(){this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate),this.e=null,this._media_element=null,this._config=null,this._on_pause_transmuxer=null,this._on_resume_transmuxer=null},W.prototype.notifyBufferedPositionChanged=function(K){!this._config.isLive&&this._config.lazyLoad&&(K==null?this._suspendTransmuxerIfNeeded():this._suspendTransmuxerIfBufferedPositionExceeded(K))},W.prototype._onMediaTimeUpdate=function(K){this._paused&&this._resumeTransmuxerIfNeeded()},W.prototype._suspendTransmuxerIfNeeded=function(){for(var K=this._media_element.buffered,q=this._media_element.currentTime,J=0,oe=0;oe<K.length;oe++){var be=K.start(oe),ye=K.end(oe);if(be<=q&&q<ye){J=ye;break}}J>0&&this._suspendTransmuxerIfBufferedPositionExceeded(J)},W.prototype._suspendTransmuxerIfBufferedPositionExceeded=function(K){K>=this._media_element.currentTime+this._config.lazyLoadMaxDuration&&!this._paused&&(g.a.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this.suspendTransmuxer(),this._media_element.addEventListener("timeupdate",this.e.onMediaTimeUpdate))},W.prototype.suspendTransmuxer=function(){this._paused=!0,this._on_pause_transmuxer()},W.prototype._resumeTransmuxerIfNeeded=function(){for(var K=this._media_element.buffered,q=this._media_element.currentTime,J=this._config.lazyLoadRecoverDuration,oe=!1,be=0;be<K.length;be++){var ye=K.start(be),Ee=K.end(be);if(q>=ye&&q<Ee){q>=Ee-J&&(oe=!0);break}}oe&&(g.a.v(this.TAG,"Continue loading from paused position"),this.resumeTransmuxer(),this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate))},W.prototype.resumeTransmuxer=function(){this._paused=!1,this._on_resume_transmuxer()},W})(),I=(function(){function W(K,q){this.TAG="StartupStallJumper",this._media_element=null,this._on_direct_seek=null,this._canplay_received=!1,this.e=null,this._media_element=K,this._on_direct_seek=q,this.e={onMediaCanPlay:this._onMediaCanPlay.bind(this),onMediaStalled:this._onMediaStalled.bind(this),onMediaProgress:this._onMediaProgress.bind(this)},this._media_element.addEventListener("canplay",this.e.onMediaCanPlay),this._media_element.addEventListener("stalled",this.e.onMediaStalled),this._media_element.addEventListener("progress",this.e.onMediaProgress)}return W.prototype.destroy=function(){this._media_element.removeEventListener("canplay",this.e.onMediaCanPlay),this._media_element.removeEventListener("stalled",this.e.onMediaStalled),this._media_element.removeEventListener("progress",this.e.onMediaProgress),this._media_element=null,this._on_direct_seek=null},W.prototype._onMediaCanPlay=function(K){this._canplay_received=!0,this._media_element.removeEventListener("canplay",this.e.onMediaCanPlay)},W.prototype._onMediaStalled=function(K){this._detectAndFixStuckPlayback(!0)},W.prototype._onMediaProgress=function(K){this._detectAndFixStuckPlayback()},W.prototype._detectAndFixStuckPlayback=function(K){var q=this._media_element,J=q.buffered;K||!this._canplay_received||q.readyState<2?J.length>0&&q.currentTime<J.start(0)&&(g.a.w(this.TAG,"Playback seems stuck at ".concat(q.currentTime,", seek to ").concat(J.start(0))),this._on_direct_seek(J.start(0)),this._media_element.removeEventListener("progress",this.e.onMediaProgress)):this._media_element.removeEventListener("progress",this.e.onMediaProgress)},W})(),D=(function(){function W(K,q,J){this._config=null,this._media_element=null,this._on_direct_seek=null,this._config=K,this._media_element=q,this._on_direct_seek=J}return W.prototype.destroy=function(){this._on_direct_seek=null,this._media_element=null,this._config=null},W.prototype.notifyBufferedRangeUpdate=function(){this._chaseLiveLatency()},W.prototype._chaseLiveLatency=function(){var K=this._media_element.buffered,q=this._media_element.currentTime,J=this._media_element.paused;if(this._config.isLive&&this._config.liveBufferLatencyChasing&&K.length!=0&&(this._config.liveBufferLatencyChasingOnPaused||!J)){var oe=K.end(K.length-1);if(oe>this._config.liveBufferLatencyMaxLatency&&oe-q>this._config.liveBufferLatencyMaxLatency){var be=oe-this._config.liveBufferLatencyMinRemain;this._on_direct_seek(be)}}},W})(),O=(function(){function W(K,q){this._config=null,this._media_element=null,this.e=null,this._config=K,this._media_element=q,this.e={onMediaTimeUpdate:this._onMediaTimeUpdate.bind(this)},this._media_element.addEventListener("timeupdate",this.e.onMediaTimeUpdate)}return W.prototype.destroy=function(){this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate),this._media_element=null,this._config=null},W.prototype._onMediaTimeUpdate=function(K){if(this._config.isLive&&this._config.liveSync){var q=this._getCurrentLatency();if(q>this._config.liveSyncMaxLatency){var J=Math.min(2,Math.max(1,this._config.liveSyncPlaybackRate));this._media_element.playbackRate=J}else q>this._config.liveSyncTargetLatency||this._media_element.playbackRate!==1&&this._media_element.playbackRate!==0&&(this._media_element.playbackRate=1)}},W.prototype._getCurrentLatency=function(){if(!this._media_element)return 0;var K=this._media_element.buffered,q=this._media_element.currentTime;return K.length==0?0:K.end(K.length-1)-q},W})(),ee=(function(){function W(K,q){this.TAG="PlayerEngineMainThread",this._emitter=new p,this._media_element=null,this._mse_controller=null,this._transmuxer=null,this._pending_seek_time=null,this._seeking_handler=null,this._loading_controller=null,this._startup_stall_jumper=null,this._live_latency_chaser=null,this._live_latency_synchronizer=null,this._mse_source_opened=!1,this._has_pending_load=!1,this._loaded_metadata_received=!1,this._media_info=null,this._statistics_info=null,this.e=null,this._media_data_source=K,this._config=h(),typeof q=="object"&&Object.assign(this._config,q),K.isLive===!0&&(this._config.isLive=!0),this.e={onMediaLoadedMetadata:this._onMediaLoadedMetadata.bind(this)}}return W.prototype.destroy=function(){this._emitter.emit(v.a.DESTROYING),this._transmuxer&&this.unload(),this._media_element&&this.detachMediaElement(),this.e=null,this._media_data_source=null,this._emitter.removeAllListeners(),this._emitter=null},W.prototype.on=function(K,q){var J=this;this._emitter.addListener(K,q),K===v.a.MEDIA_INFO&&this._media_info?Promise.resolve().then((function(){return J._emitter.emit(v.a.MEDIA_INFO,J.mediaInfo)})):K==v.a.STATISTICS_INFO&&this._statistics_info&&Promise.resolve().then((function(){return J._emitter.emit(v.a.STATISTICS_INFO,J.statisticsInfo)}))},W.prototype.off=function(K,q){this._emitter.removeListener(K,q)},W.prototype.attachMediaElement=function(K){var q=this;this._media_element=K,K.src="",K.removeAttribute("src"),K.srcObject=null,K.load(),K.addEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._mse_controller=new y.a(this._config),this._mse_controller.on(N.a.UPDATE_END,this._onMSEUpdateEnd.bind(this)),this._mse_controller.on(N.a.BUFFER_FULL,this._onMSEBufferFull.bind(this)),this._mse_controller.on(N.a.SOURCE_OPEN,this._onMSESourceOpen.bind(this)),this._mse_controller.on(N.a.ERROR,this._onMSEError.bind(this)),this._mse_controller.on(N.a.START_STREAMING,this._onMSEStartStreaming.bind(this)),this._mse_controller.on(N.a.END_STREAMING,this._onMSEEndStreaming.bind(this)),this._mse_controller.initialize({getCurrentTime:function(){return q._media_element.currentTime},getReadyState:function(){return q._media_element.readyState}}),this._mse_controller.isManagedMediaSource()?(K.disableRemotePlayback=!0,K.srcObject=this._mse_controller.getObject()):K.src=this._mse_controller.getObjectURL()},W.prototype.detachMediaElement=function(){this._media_element&&(this._mse_controller.shutdown(),this._media_element.removeEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._media_element.src="",this._media_element.removeAttribute("src"),this._media_element.srcObject=null,this._media_element.load(),this._media_element=null,this._mse_controller.revokeObjectURL()),this._mse_controller&&(this._mse_controller.destroy(),this._mse_controller=null)},W.prototype.load=function(){var K=this;if(!this._media_element)throw new T.a("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new T.a("load() has been called, please call unload() first!");this._has_pending_load||(!this._config.deferLoadAfterSourceOpen||this._mse_source_opened?(this._transmuxer=new _.a(this._media_data_source,this._config),this._transmuxer.on(L.a.INIT_SEGMENT,(function(q,J){K._mse_controller.appendInitSegment(J)})),this._transmuxer.on(L.a.MEDIA_SEGMENT,(function(q,J){K._mse_controller.appendMediaSegment(J),!K._config.isLive&&q==="video"&&J.data&&J.data.byteLength>0&&"info"in J&&K._seeking_handler.appendSyncPoints(J.info.syncPoints),K._loading_controller.notifyBufferedPositionChanged(J.info.endDts/1e3)})),this._transmuxer.on(L.a.LOADING_COMPLETE,(function(){K._mse_controller.endOfStream(),K._emitter.emit(v.a.LOADING_COMPLETE)})),this._transmuxer.on(L.a.RECOVERED_EARLY_EOF,(function(){K._emitter.emit(v.a.RECOVERED_EARLY_EOF)})),this._transmuxer.on(L.a.IO_ERROR,(function(q,J){K._emitter.emit(v.a.ERROR,C.b.NETWORK_ERROR,q,J)})),this._transmuxer.on(L.a.DEMUX_ERROR,(function(q,J){K._emitter.emit(v.a.ERROR,C.b.MEDIA_ERROR,q,J)})),this._transmuxer.on(L.a.MEDIA_INFO,(function(q){K._media_info=q,K._emitter.emit(v.a.MEDIA_INFO,Object.assign({},q))})),this._transmuxer.on(L.a.STATISTICS_INFO,(function(q){K._statistics_info=K._fillStatisticsInfo(q),K._emitter.emit(v.a.STATISTICS_INFO,Object.assign({},q))})),this._transmuxer.on(L.a.RECOMMEND_SEEKPOINT,(function(q){K._media_element&&!K._config.accurateSeek&&K._seeking_handler.directSeek(q/1e3)})),this._transmuxer.on(L.a.METADATA_ARRIVED,(function(q){K._emitter.emit(v.a.METADATA_ARRIVED,q)})),this._transmuxer.on(L.a.SCRIPTDATA_ARRIVED,(function(q){K._emitter.emit(v.a.SCRIPTDATA_ARRIVED,q)})),this._transmuxer.on(L.a.TIMED_ID3_METADATA_ARRIVED,(function(q){K._emitter.emit(v.a.TIMED_ID3_METADATA_ARRIVED,q)})),this._transmuxer.on(L.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,(function(q){K._emitter.emit(v.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,q)})),this._transmuxer.on(L.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,(function(q){K._emitter.emit(v.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,q)})),this._transmuxer.on(L.a.SMPTE2038_METADATA_ARRIVED,(function(q){K._emitter.emit(v.a.SMPTE2038_METADATA_ARRIVED,q)})),this._transmuxer.on(L.a.SCTE35_METADATA_ARRIVED,(function(q){K._emitter.emit(v.a.SCTE35_METADATA_ARRIVED,q)})),this._transmuxer.on(L.a.PES_PRIVATE_DATA_DESCRIPTOR,(function(q){K._emitter.emit(v.a.PES_PRIVATE_DATA_DESCRIPTOR,q)})),this._transmuxer.on(L.a.PES_PRIVATE_DATA_ARRIVED,(function(q){K._emitter.emit(v.a.PES_PRIVATE_DATA_ARRIVED,q)})),this._seeking_handler=new B(this._config,this._media_element,this._onRequiredUnbufferedSeek.bind(this)),this._loading_controller=new P(this._config,this._media_element,this._onRequestPauseTransmuxer.bind(this),this._onRequestResumeTransmuxer.bind(this)),this._startup_stall_jumper=new I(this._media_element,this._onRequestDirectSeek.bind(this)),this._config.isLive&&this._config.liveBufferLatencyChasing&&(this._live_latency_chaser=new D(this._config,this._media_element,this._onRequestDirectSeek.bind(this))),this._config.isLive&&this._config.liveSync&&(this._live_latency_synchronizer=new O(this._config,this._media_element)),this._media_element.readyState>0&&this._seeking_handler.directSeek(0),this._transmuxer.open()):this._has_pending_load=!0)},W.prototype.unload=function(){var K,q,J,oe,be,ye,Ee,re,fe;(K=this._media_element)===null||K===void 0||K.pause(),(q=this._live_latency_synchronizer)===null||q===void 0||q.destroy(),this._live_latency_synchronizer=null,(J=this._live_latency_chaser)===null||J===void 0||J.destroy(),this._live_latency_chaser=null,(oe=this._startup_stall_jumper)===null||oe===void 0||oe.destroy(),this._startup_stall_jumper=null,(be=this._loading_controller)===null||be===void 0||be.destroy(),this._loading_controller=null,(ye=this._seeking_handler)===null||ye===void 0||ye.destroy(),this._seeking_handler=null,(Ee=this._mse_controller)===null||Ee===void 0||Ee.flush(),(re=this._transmuxer)===null||re===void 0||re.close(),(fe=this._transmuxer)===null||fe===void 0||fe.destroy(),this._transmuxer=null},W.prototype.play=function(){return this._media_element.play()},W.prototype.pause=function(){this._media_element.pause()},W.prototype.seek=function(K){this._media_element&&this._seeking_handler?this._seeking_handler.seek(K):this._pending_seek_time=K},Object.defineProperty(W.prototype,"mediaInfo",{get:function(){return Object.assign({},this._media_info)},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"statisticsInfo",{get:function(){return Object.assign({},this._statistics_info)},enumerable:!1,configurable:!0}),W.prototype._onMSESourceOpen=function(){this._mse_source_opened=!0,this._has_pending_load&&(this._has_pending_load=!1,this.load())},W.prototype._onMSEUpdateEnd=function(){this._config.isLive&&this._config.liveBufferLatencyChasing&&this._live_latency_chaser&&this._live_latency_chaser.notifyBufferedRangeUpdate(),this._loading_controller.notifyBufferedPositionChanged()},W.prototype._onMSEBufferFull=function(){g.a.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._loading_controller.suspendTransmuxer()},W.prototype._onMSEError=function(K){this._emitter.emit(v.a.ERROR,C.b.MEDIA_ERROR,C.a.MEDIA_MSE_ERROR,K)},W.prototype._onMSEStartStreaming=function(){this._loaded_metadata_received&&(this._config.isLive||(g.a.v(this.TAG,"Resume transmuxing task due to ManagedMediaSource onStartStreaming"),this._loading_controller.resumeTransmuxer()))},W.prototype._onMSEEndStreaming=function(){this._config.isLive||(g.a.v(this.TAG,"Suspend transmuxing task due to ManagedMediaSource onEndStreaming"),this._loading_controller.suspendTransmuxer())},W.prototype._onMediaLoadedMetadata=function(K){this._loaded_metadata_received=!0,this._pending_seek_time!=null&&(this._seeking_handler.seek(this._pending_seek_time),this._pending_seek_time=null)},W.prototype._onRequestDirectSeek=function(K){this._seeking_handler.directSeek(K)},W.prototype._onRequiredUnbufferedSeek=function(K){this._mse_controller.flush(),this._transmuxer.seek(K)},W.prototype._onRequestPauseTransmuxer=function(){this._transmuxer.pause()},W.prototype._onRequestResumeTransmuxer=function(){this._transmuxer.resume()},W.prototype._fillStatisticsInfo=function(K){if(K.playerType="MSEPlayer",!(this._media_element instanceof HTMLVideoElement))return K;var q=!0,J=0,oe=0;if(this._media_element.getVideoPlaybackQuality){var be=this._media_element.getVideoPlaybackQuality();J=be.totalVideoFrames,oe=be.droppedVideoFrames}else this._media_element.webkitDecodedFrameCount!=null?(J=this._media_element.webkitDecodedFrameCount,oe=this._media_element.webkitDroppedFrameCount):q=!1;return q&&(K.decodedFrames=J,K.droppedFrames=oe),K},W})(),ie=i(18),Z=i(8),z=(function(){function W(K,q){this.TAG="PlayerEngineDedicatedThread",this._emitter=new p,this._media_element=null,this._worker_destroying=!1,this._seeking_handler=null,this._loading_controller=null,this._startup_stall_jumper=null,this._live_latency_chaser=null,this._live_latency_synchronizer=null,this._pending_seek_time=null,this._media_info=null,this._statistics_info=null,this.e=null,this._media_data_source=K,this._config=h(),typeof q=="object"&&Object.assign(this._config,q),K.isLive===!0&&(this._config.isLive=!0),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this),onMediaLoadedMetadata:this._onMediaLoadedMetadata.bind(this),onMediaTimeUpdate:this._onMediaTimeUpdate.bind(this),onMediaReadyStateChanged:this._onMediaReadyStateChange.bind(this)},Z.a.registerListener(this.e.onLoggingConfigChanged),this._worker=ie(24,{all:!0}),this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",media_data_source:this._media_data_source,config:this._config}),this._worker.postMessage({cmd:"logging_config",logging_config:Z.a.getConfig()})}return W.isSupported=function(){return!!self.Worker&&(!(!self.MediaSource||!("canConstructInDedicatedWorker"in self.MediaSource)||self.MediaSource.canConstructInDedicatedWorker!==!0)||!(!self.ManagedMediaSource||!("canConstructInDedicatedWorker"in self.ManagedMediaSource)||self.ManagedMediaSource.canConstructInDedicatedWorker!==!0))},W.prototype.destroy=function(){this._emitter.emit(v.a.DESTROYING),this.unload(),this.detachMediaElement(),this._worker_destroying=!0,this._worker.postMessage({cmd:"destroy"}),Z.a.removeListener(this.e.onLoggingConfigChanged),this.e=null,this._media_data_source=null,this._emitter.removeAllListeners(),this._emitter=null},W.prototype.on=function(K,q){var J=this;this._emitter.addListener(K,q),K===v.a.MEDIA_INFO&&this._media_info?Promise.resolve().then((function(){return J._emitter.emit(v.a.MEDIA_INFO,J.mediaInfo)})):K==v.a.STATISTICS_INFO&&this._statistics_info&&Promise.resolve().then((function(){return J._emitter.emit(v.a.STATISTICS_INFO,J.statisticsInfo)}))},W.prototype.off=function(K,q){this._emitter.removeListener(K,q)},W.prototype.attachMediaElement=function(K){this._media_element=K,this._media_element.src="",this._media_element.removeAttribute("src"),this._media_element.srcObject=null,this._media_element.load(),this._media_element.addEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._media_element.addEventListener("timeupdate",this.e.onMediaTimeUpdate),this._media_element.addEventListener("readystatechange",this.e.onMediaReadyStateChanged),this._worker.postMessage({cmd:"initialize_mse"})},W.prototype.detachMediaElement=function(){this._worker.postMessage({cmd:"shutdown_mse"}),this._media_element&&(this._media_element.removeEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate),this._media_element.removeEventListener("readystatechange",this.e.onMediaReadyStateChanged),this._media_element.src="",this._media_element.removeAttribute("src"),this._media_element.srcObject=null,this._media_element.load(),this._media_element=null)},W.prototype.load=function(){this._worker.postMessage({cmd:"load"}),this._seeking_handler=new B(this._config,this._media_element,this._onRequiredUnbufferedSeek.bind(this)),this._loading_controller=new P(this._config,this._media_element,this._onRequestPauseTransmuxer.bind(this),this._onRequestResumeTransmuxer.bind(this)),this._startup_stall_jumper=new I(this._media_element,this._onRequestDirectSeek.bind(this)),this._config.isLive&&this._config.liveBufferLatencyChasing&&(this._live_latency_chaser=new D(this._config,this._media_element,this._onRequestDirectSeek.bind(this))),this._config.isLive&&this._config.liveSync&&(this._live_latency_synchronizer=new O(this._config,this._media_element)),this._media_element.readyState>0&&this._seeking_handler.directSeek(0)},W.prototype.unload=function(){var K,q,J,oe,be,ye;(K=this._media_element)===null||K===void 0||K.pause(),this._worker.postMessage({cmd:"unload"}),(q=this._live_latency_synchronizer)===null||q===void 0||q.destroy(),this._live_latency_synchronizer=null,(J=this._live_latency_chaser)===null||J===void 0||J.destroy(),this._live_latency_chaser=null,(oe=this._startup_stall_jumper)===null||oe===void 0||oe.destroy(),this._startup_stall_jumper=null,(be=this._loading_controller)===null||be===void 0||be.destroy(),this._loading_controller=null,(ye=this._seeking_handler)===null||ye===void 0||ye.destroy(),this._seeking_handler=null},W.prototype.play=function(){return this._media_element.play()},W.prototype.pause=function(){this._media_element.pause()},W.prototype.seek=function(K){this._media_element&&this._seeking_handler?this._seeking_handler.seek(K):this._pending_seek_time=K},Object.defineProperty(W.prototype,"mediaInfo",{get:function(){return Object.assign({},this._media_info)},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"statisticsInfo",{get:function(){return Object.assign({},this._statistics_info)},enumerable:!1,configurable:!0}),W.prototype._onLoggingConfigChanged=function(K){var q;(q=this._worker)===null||q===void 0||q.postMessage({cmd:"logging_config",logging_config:K})},W.prototype._onMSEUpdateEnd=function(){this._config.isLive&&this._config.liveBufferLatencyChasing&&this._live_latency_chaser&&this._live_latency_chaser.notifyBufferedRangeUpdate(),this._loading_controller.notifyBufferedPositionChanged()},W.prototype._onMSEBufferFull=function(){g.a.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._loading_controller.suspendTransmuxer()},W.prototype._onMediaLoadedMetadata=function(K){this._pending_seek_time!=null&&(this._seeking_handler.seek(this._pending_seek_time),this._pending_seek_time=null)},W.prototype._onRequestDirectSeek=function(K){this._seeking_handler.directSeek(K)},W.prototype._onRequiredUnbufferedSeek=function(K){this._worker.postMessage({cmd:"unbuffered_seek",milliseconds:K})},W.prototype._onRequestPauseTransmuxer=function(){this._worker.postMessage({cmd:"pause_transmuxer"})},W.prototype._onRequestResumeTransmuxer=function(){this._worker.postMessage({cmd:"resume_transmuxer"})},W.prototype._onMediaTimeUpdate=function(K){this._worker.postMessage({cmd:"timeupdate",current_time:K.target.currentTime})},W.prototype._onMediaReadyStateChange=function(K){this._worker.postMessage({cmd:"readystatechange",ready_state:K.target.readyState})},W.prototype._onWorkerMessage=function(K){var q,J=K.data,oe=J.msg;if(oe=="destroyed"||this._worker_destroying)return this._worker_destroying=!1,(q=this._worker)===null||q===void 0||q.terminate(),void(this._worker=null);switch(oe){case"mse_init":var be=J;"ManagedMediaSource"in self&&!("MediaSource"in self)&&(this._media_element.disableRemotePlayback=!0),this._media_element.srcObject=be.handle;break;case"mse_event":(be=J).event==N.a.UPDATE_END?this._onMSEUpdateEnd():be.event==N.a.BUFFER_FULL&&this._onMSEBufferFull();break;case"transmuxing_event":if((be=J).event==L.a.MEDIA_INFO){var ye=J;this._media_info=ye.info,this._emitter.emit(v.a.MEDIA_INFO,Object.assign({},ye.info))}else if(be.event==L.a.STATISTICS_INFO){var Ee=J;this._statistics_info=this._fillStatisticsInfo(Ee.info),this._emitter.emit(v.a.STATISTICS_INFO,Object.assign({},Ee.info))}else if(be.event==L.a.RECOMMEND_SEEKPOINT){var re=J;this._media_element&&!this._config.accurateSeek&&this._seeking_handler.directSeek(re.milliseconds/1e3)}break;case"player_event":if((be=J).event==v.a.ERROR){var fe=J;this._emitter.emit(v.a.ERROR,fe.error_type,fe.error_detail,fe.info)}else if("extraData"in be){var Le=J;this._emitter.emit(Le.event,Le.extraData)}break;case"logcat_callback":be=J,g.a.emitter.emit("log",be.type,be.logcat);break;case"buffered_position_changed":be=J,this._loading_controller.notifyBufferedPositionChanged(be.buffered_position_milliseconds/1e3)}},W.prototype._fillStatisticsInfo=function(K){if(K.playerType="MSEPlayer",!(this._media_element instanceof HTMLVideoElement))return K;var q=!0,J=0,oe=0;if(this._media_element.getVideoPlaybackQuality){var be=this._media_element.getVideoPlaybackQuality();J=be.totalVideoFrames,oe=be.droppedVideoFrames}else this._media_element.webkitDecodedFrameCount!=null?(J=this._media_element.webkitDecodedFrameCount,oe=this._media_element.webkitDroppedFrameCount):q=!1;return q&&(K.decodedFrames=J,K.droppedFrames=oe),K},W})(),X=(function(){function W(K,q){this.TAG="MSEPlayer",this._type="MSEPlayer",this._media_element=null,this._player_engine=null;var J=K.type.toLowerCase();if(J!=="mse"&&J!=="mpegts"&&J!=="m2ts"&&J!=="flv")throw new T.b("MSEPlayer requires an mpegts/m2ts/flv MediaDataSource input!");if(q&&q.enableWorkerForMSE&&z.isSupported())try{this._player_engine=new z(K,q)}catch{g.a.e(this.TAG,"Error while initializing PlayerEngineDedicatedThread, fallback to PlayerEngineMainThread"),this._player_engine=new ee(K,q)}else this._player_engine=new ee(K,q)}return W.prototype.destroy=function(){this._player_engine.destroy(),this._player_engine=null,this._media_element=null},W.prototype.on=function(K,q){this._player_engine.on(K,q)},W.prototype.off=function(K,q){this._player_engine.off(K,q)},W.prototype.attachMediaElement=function(K){this._media_element=K,this._player_engine.attachMediaElement(K)},W.prototype.detachMediaElement=function(){this._media_element=null,this._player_engine.detachMediaElement()},W.prototype.load=function(){this._player_engine.load()},W.prototype.unload=function(){this._player_engine.unload()},W.prototype.play=function(){return this._player_engine.play()},W.prototype.pause=function(){this._player_engine.pause()},Object.defineProperty(W.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"buffered",{get:function(){return this._media_element.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"duration",{get:function(){return this._media_element.duration},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"volume",{get:function(){return this._media_element.volume},set:function(K){this._media_element.volume=K},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"muted",{get:function(){return this._media_element.muted},set:function(K){this._media_element.muted=K},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"currentTime",{get:function(){return this._media_element?this._media_element.currentTime:0},set:function(K){this._player_engine.seek(K)},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"mediaInfo",{get:function(){return this._player_engine.mediaInfo},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"statisticsInfo",{get:function(){return this._player_engine.statisticsInfo},enumerable:!1,configurable:!0}),W})(),ae=(function(){function W(K,q){this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new b.a,this._config=h(),typeof q=="object"&&Object.assign(this._config,q);var J=K.type.toLowerCase();if(J==="mse"||J==="mpegts"||J==="m2ts"||J==="flv")throw new T.b("NativePlayer does't support mse/mpegts/m2ts/flv MediaDataSource input!");if(K.hasOwnProperty("segments"))throw new T.b("NativePlayer(".concat(K.type,") doesn't support multipart playback!"));this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=K,this._mediaElement=null}return W.prototype.destroy=function(){this._emitter.emit(v.a.DESTROYING),this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},W.prototype.on=function(K,q){var J=this;K===v.a.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then((function(){J._emitter.emit(v.a.MEDIA_INFO,J.mediaInfo)})):K===v.a.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then((function(){J._emitter.emit(v.a.STATISTICS_INFO,J.statisticsInfo)})),this._emitter.addListener(K,q)},W.prototype.off=function(K,q){this._emitter.removeListener(K,q)},W.prototype.attachMediaElement=function(K){if(this._mediaElement=K,K.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{K.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},W.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},W.prototype.load=function(){if(!this._mediaElement)throw new T.a("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},W.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},W.prototype.play=function(){return this._mediaElement.play()},W.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(W.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(K){this._mediaElement.volume=K},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(K){this._mediaElement.muted=K},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(K){this._mediaElement?this._mediaElement.currentTime=K:this._pendingSeekTime=K},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"mediaInfo",{get:function(){var K={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&(K.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(K.width=this._mediaElement.videoWidth,K.height=this._mediaElement.videoHeight)),K},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"statisticsInfo",{get:function(){var K={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return K;var q=!0,J=0,oe=0;if(this._mediaElement.getVideoPlaybackQuality){var be=this._mediaElement.getVideoPlaybackQuality();J=be.totalVideoFrames,oe=be.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(J=this._mediaElement.webkitDecodedFrameCount,oe=this._mediaElement.webkitDroppedFrameCount):q=!1;return q&&(K.decodedFrames=J,K.droppedFrames=oe),K},enumerable:!1,configurable:!0}),W.prototype._onvLoadedMetadata=function(K){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(v.a.MEDIA_INFO,this.mediaInfo)},W.prototype._reportStatisticsInfo=function(){this._emitter.emit(v.a.STATISTICS_INFO,this.statisticsInfo)},W})();l.a.install();var te={createPlayer:function(W,K){var q=W;if(q==null||typeof q!="object")throw new T.b("MediaDataSource must be an javascript object!");if(!q.hasOwnProperty("type"))throw new T.b("MediaDataSource must has type field to indicate video file type!");switch(q.type){case"mse":case"mpegts":case"m2ts":case"flv":return new X(q,K);default:return new ae(q,K)}},isSupported:function(){return u.supportMSEH264Playback()},getFeatureList:function(){return u.getFeatureList()}};te.BaseLoader=f.a,te.LoaderStatus=f.c,te.LoaderErrors=f.b,te.Events=v.a,te.ErrorTypes=C.b,te.ErrorDetails=C.a,te.MSEPlayer=X,te.NativePlayer=ae,te.LoggingControl=Z.a,Object.defineProperty(te,"version",{enumerable:!0,get:function(){return"1.8.0"}}),n.default=te}])}))})(Ug)),Ug.exports}var a6=s6();const $u=m1(a6),PN=a=>a?/^https?:\/\//i.test(a):!1,ON=200,sl=64,FN=44,pr=4,Dh={Movies:"bg-purple-700/90",TVShow:"bg-blue-700/90",Sports:"bg-green-700/90",News:"bg-red-700/90",Kids:"bg-orange-600/90",Documentary:"bg-teal-700/90"},n6={Movies:"border-l-purple-400",TVShow:"border-l-blue-400",Sports:"border-l-green-400",News:"border-l-red-400",Kids:"border-l-orange-400",Documentary:"border-l-teal-400"};function Ri(a){return a.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function BN(a){const e=new Date;e.setHours(0,0,0,0);const s=new Date(a);s.setHours(0,0,0,0);const n=Math.round((s.getTime()-e.getTime())/(1440*60*1e3));return n===0?"Today":n===1?"Tomorrow":n===-1?"Yesterday":a.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"})}function i6({program:a,startOffset:e,width:s,onClick:n,isNow:i,isScheduled:l,isRecording:o}){const d=Dh[a.category||""]||"bg-gray-700/90",h=n6[a.category||""]||"border-l-gray-500",u=50;return s<16?null:t.jsxs("div",{onClick:n,className:`absolute top-[3px] bottom-[3px] rounded cursor-pointer overflow-hidden transition-all hover:z-20 hover:ring-2 hover:ring-white/60 hover:brightness-110 border-l-[3px] ${h} ${d} ${i?"ring-1 ring-yellow-400/50":""}`,style:{left:`${e}px`,width:`${Math.max(s-2,u)}px`},title:`${a.title}
${Ri(new Date(a.start))} - ${Ri(new Date(a.end))}${l?`
 Scheduled to record`:""}`,children:[(l||o)&&t.jsx("div",{className:"absolute top-1 right-1 z-10",children:t.jsx("div",{className:`w-3 h-3 rounded-full flex items-center justify-center ${o?"bg-red-600 animate-pulse":"bg-red-500"}`,children:t.jsx(fl,{className:"w-2 h-2 text-white fill-current"})})}),(()=>{const f=a.isSports&&!a.isLive,g=a.isNew&&!f,p=a.isPremiere&&!f,b=a.isLive,y=a.isFinale;return!g&&!p&&!y&&!b?null:t.jsxs("div",{className:"absolute top-1 left-1 z-10 flex gap-0.5",children:[b&&t.jsx("span",{className:"px-1 py-0.5 bg-red-500 text-white text-[8px] font-bold rounded uppercase animate-pulse leading-none",children:"Live"}),p&&t.jsx("span",{className:"px-1 py-0.5 bg-yellow-500 text-black text-[8px] font-bold rounded uppercase leading-none",children:"Premiere"}),g&&!p&&t.jsx("span",{className:"px-1 py-0.5 bg-green-500 text-white text-[8px] font-bold rounded uppercase leading-none",children:"New"}),y&&t.jsx("span",{className:"px-1 py-0.5 bg-purple-500 text-white text-[8px] font-bold rounded uppercase leading-none",children:"Finale"})]})})(),t.jsxs("div",{className:"px-2 py-1 h-full flex flex-col justify-center",children:[t.jsx("div",{className:"font-semibold text-white text-xs leading-tight truncate",children:a.title}),s>100&&t.jsxs("div",{className:"text-[10px] text-white/70 mt-0.5 truncate",children:[Ri(new Date(a.start))," - ",Ri(new Date(a.end))]}),s>200&&a.description&&t.jsx("div",{className:"text-[10px] text-white/50 mt-0.5 line-clamp-1",children:a.description})]})]})}function r6({program:a,channel:e,onClose:s,onRecord:n,onWatchNow:i,isRecording:l,scheduledStatus:o,onCancelRecording:d}){const h=new Date(a.start),u=new Date(a.end),f=Math.round((u.getTime()-h.getTime())/6e4),g=new Date>=h&&new Date<u,p=new Date<h,b=Dh[a.category||""]||"bg-gray-600",y=o==="scheduled"||o==="recording";return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4",onClick:s,children:t.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-lg overflow-hidden shadow-2xl",onClick:v=>v.stopPropagation(),children:[t.jsxs("div",{className:`relative h-28 ${b} flex items-end p-4`,children:[t.jsx("button",{onClick:s,className:"absolute top-3 right-3 p-1.5 bg-black/30 hover:bg-black/50 rounded-full transition-colors",children:t.jsx(nt,{className:"h-5 w-5 text-white"})}),o==="recording"?t.jsxs("span",{className:"absolute top-3 left-3 flex items-center gap-1.5 px-2.5 py-1 bg-red-600 text-white text-xs font-bold rounded-full",children:[t.jsx(fl,{className:"h-2 w-2 fill-current animate-pulse"}),"RECORDING"]}):o==="scheduled"?t.jsxs("span",{className:"absolute top-3 left-3 flex items-center gap-1.5 px-2.5 py-1 bg-red-500 text-white text-xs font-bold rounded-full",children:[t.jsx(fl,{className:"h-2 w-2 fill-current"}),"SCHEDULED"]}):g&&t.jsxs("span",{className:"absolute top-3 left-3 flex items-center gap-1.5 px-2.5 py-1 bg-red-600 text-white text-xs font-bold rounded-full",children:[t.jsx(fl,{className:"h-2 w-2 fill-current animate-pulse"}),"LIVE NOW"]}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold text-white drop-shadow-lg",children:a.title}),e&&t.jsxs("p",{className:"text-white/90 text-sm mt-1",children:["Ch ",e.number," - ",e.name]})]})]}),t.jsxs("div",{className:"p-5",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-gray-400 mb-4",children:[t.jsxs("div",{className:"flex items-center gap-1.5 bg-gray-700/50 px-2.5 py-1 rounded",children:[t.jsx(sn,{className:"h-4 w-4"}),h.toLocaleDateString()]}),t.jsxs("div",{className:"flex items-center gap-1.5 bg-gray-700/50 px-2.5 py-1 rounded",children:[t.jsx(Kt,{className:"h-4 w-4"}),Ri(h)," - ",Ri(u)," (",f," min)"]}),a.category&&t.jsx("span",{className:`px-2.5 py-1 rounded text-xs font-semibold text-white ${b}`,children:a.category}),(()=>{const v=a.isSports&&!a.isLive;return t.jsxs(t.Fragment,{children:[a.isPremiere&&!v&&t.jsx("span",{className:"px-2.5 py-1 bg-yellow-500 text-black text-xs font-bold rounded uppercase",children:"Premiere"}),a.isNew&&!a.isPremiere&&!v&&t.jsx("span",{className:"px-2.5 py-1 bg-green-500 text-white text-xs font-bold rounded uppercase",children:"New Episode"}),a.isFinale&&t.jsx("span",{className:"px-2.5 py-1 bg-purple-500 text-white text-xs font-bold rounded uppercase",children:"Finale"}),a.isLive&&t.jsx("span",{className:"px-2.5 py-1 bg-red-500 text-white text-xs font-bold rounded uppercase animate-pulse",children:"Live"})]})})()]}),a.description&&t.jsx("p",{className:"text-gray-300 text-sm leading-relaxed mb-4",children:a.description}),a.episodeNum&&t.jsx("p",{className:"text-gray-500 text-xs mb-4",children:a.episodeNum}),t.jsxs("div",{className:"flex gap-3 mt-6 pt-4 border-t border-gray-700",children:[g&&e?.streamUrl&&t.jsxs("button",{onClick:i,className:"flex-1 flex items-center justify-center gap-2 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold transition-colors",children:[t.jsx(Nn,{className:"h-5 w-5"}),"Watch Now"]}),(g||p)&&!y&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>n(!1),disabled:l,className:"flex-1 py-3 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 text-white rounded-lg font-semibold transition-colors",children:l?"Recording...":"Record"}),t.jsx("button",{onClick:()=>n(!0),disabled:l,className:"flex-1 py-3 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 text-white rounded-lg font-semibold transition-colors",children:"Record Series"})]}),y&&d&&t.jsx("button",{onClick:d,className:"flex-1 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold transition-colors",children:o==="recording"?"Stop Recording":"Cancel Recording"})]})]})]})})}function l6({channel:a,program:e,onClose:s}){const n=k.useRef(null),i=k.useRef(null),l=k.useRef(null),[o,d]=k.useState(!0),[h,u]=k.useState(null),[f,g]=k.useState(!1),[p,b]=k.useState(!0),[y,v]=k.useState(!0),[_,N]=k.useState(0),C=k.useRef(null),T=k.useRef(null),L=()=>{const I=n.current;I&&(I.paused?(I.play().catch(()=>{}),b(!0)):(I.pause(),b(!1)))},F=()=>{const I=n.current;I&&(I.currentTime=Math.max(0,I.currentTime-10))},H=()=>{const I=n.current;I&&(I.currentTime=I.currentTime+10)};k.useEffect(()=>{const I=n.current;if(!I)return;if(!a.streamUrl){u("No stream URL available for this channel"),d(!1);return}d(!0),u(null);const D=`${window.location.origin}/livetv/channels/${a.id}/stream`;if(console.log("[LiveTVPlayer] Loading stream:",D,"Original URL:",a.streamUrl),$u.isSupported()){console.log("[LiveTVPlayer] Trying mpegts.js first (most live TV is MPEG-TS)");let O=!1;const ee=$u.createPlayer({type:"mpegts",isLive:!0,url:D},{enableWorker:!1,lazyLoad:!1,autoCleanupSourceBuffer:!0,autoCleanupMaxBackwardDuration:60,autoCleanupMinBackwardDuration:30,stashInitialSize:512*1024,enableStashBuffer:!0,liveBufferLatencyChasing:!1,liveBufferLatencyMaxLatency:10,liveBufferLatencyMinRemain:3});l.current=ee,ee.attachMediaElement(I),ee.load(),ee.on($u.Events.MEDIA_INFO,()=>{console.log("[LiveTVPlayer] mpegts media info received - stream is MPEG-TS"),O=!0,T.current&&(clearTimeout(T.current),T.current=null),d(!1),I.play().catch(ie=>console.error("[LiveTVPlayer] Play error:",ie))}),ee.on($u.Events.ERROR,(ie,Z)=>{if(console.error("[LiveTVPlayer] mpegts error:",ie,Z),O)u(`Stream error: ${ie} - ${Z}`),d(!1);else if(console.log("[LiveTVPlayer] mpegts failed, trying HLS.js..."),ee.destroy(),l.current=null,Ns.isSupported()){const z=new Ns({enableWorker:!0,lowLatencyMode:!0});i.current=z,z.on(Ns.Events.MANIFEST_PARSED,()=>{console.log("[LiveTVPlayer] HLS manifest parsed successfully"),T.current&&(clearTimeout(T.current),T.current=null),d(!1),I.play().catch(X=>console.error("[LiveTVPlayer] Play error:",X))}),z.on(Ns.Events.ERROR,(X,ae)=>{console.error("[LiveTVPlayer] HLS error:",ae.type,ae.details),ae.fatal&&(u(`Stream error: ${ae.details}`),d(!1))}),z.loadSource(D),z.attachMedia(I)}else u(`Stream error: ${ie} - ${Z}`),d(!1)})}else if(Ns.isSupported()){console.log("[LiveTVPlayer] Using HLS.js (mpegts not supported)");const O=new Ns({enableWorker:!0,lowLatencyMode:!0});i.current=O,O.on(Ns.Events.MANIFEST_PARSED,()=>{console.log("[LiveTVPlayer] HLS manifest parsed successfully"),T.current&&(clearTimeout(T.current),T.current=null),d(!1),I.play().catch(ee=>console.error("[LiveTVPlayer] Play error:",ee))}),O.on(Ns.Events.ERROR,(ee,ie)=>{console.error("[LiveTVPlayer] HLS error:",ie.type,ie.details),ie.fatal&&(u(`Stream error: ${ie.details}`),d(!1))}),O.loadSource(D),O.attachMedia(I)}else I.canPlayType("application/vnd.apple.mpegurl")?(console.log("[LiveTVPlayer] Using native HLS (Safari)"),I.src=D,I.addEventListener("loadedmetadata",()=>{console.log("[LiveTVPlayer] Native HLS loaded"),T.current&&(clearTimeout(T.current),T.current=null),d(!1),I.play().catch(O=>console.error("[LiveTVPlayer] Play error:",O))}),I.addEventListener("error",()=>{console.error("[LiveTVPlayer] Native HLS error:",I.error),u(`Video error: ${I.error?.message||"Unknown error"}`),d(!1)})):(u("Your browser does not support video playback"),d(!1));return T.current=window.setTimeout(()=>{console.error("[LiveTVPlayer] Loading timeout - stream failed to load within 30 seconds"),u("Stream failed to load. Please check if the channel is available."),d(!1),T.current=null},3e4),()=>{T.current&&(clearTimeout(T.current),T.current=null),i.current&&(i.current.destroy(),i.current=null),l.current&&(l.current.destroy(),l.current=null)}},[a.id,a.streamUrl,_]),k.useEffect(()=>(y&&(C.current&&clearTimeout(C.current),C.current=window.setTimeout(()=>{v(!1)},3e3)),()=>{C.current&&clearTimeout(C.current)}),[y]);const B=()=>v(!0),P=()=>{const I=document.getElementById("livetv-player-container");I&&(document.fullscreenElement?document.exitFullscreen():I.requestFullscreen())};return t.jsx("div",{className:"fixed inset-0 z-50 bg-black",children:t.jsxs("div",{id:"livetv-player-container",className:"relative w-full h-full",onMouseMove:B,onClick:B,children:[o&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx(Ke,{className:"w-12 h-12 text-white animate-spin"})}),h?t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsxs("div",{className:"text-center max-w-md px-4",children:[t.jsx("p",{className:"text-red-400 text-lg mb-4",children:h}),t.jsxs("div",{className:"flex gap-3 justify-center",children:[t.jsxs("button",{onClick:()=>{u(null),d(!0),N(I=>I+1)},className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg flex items-center gap-2",children:[t.jsx(ut,{className:"w-4 h-4"}),"Retry"]}),t.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Close"})]})]})}):t.jsx("video",{ref:n,className:"w-full h-full object-contain",muted:f,playsInline:!0}),t.jsxs("div",{className:`absolute inset-0 transition-opacity duration-300 ${y?"opacity-100":"opacity-0 pointer-events-none"}`,children:[t.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/80 to-transparent",children:t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("button",{onClick:s,className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",children:t.jsx(nt,{className:"w-6 h-6"})}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("h2",{className:"text-xl font-semibold text-white",children:["Ch ",a.number," - ",a.name]}),t.jsxs("span",{className:"flex items-center gap-1.5 px-2.5 py-1 bg-red-600 text-white text-xs font-bold rounded-full",children:[t.jsx(fl,{className:"h-2 w-2 fill-current animate-pulse"}),"LIVE"]})]}),e&&t.jsx("p",{className:"text-gray-300 mt-1",children:e.title})]})]})})}),t.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("button",{onClick:()=>g(!f),className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",title:f?"Unmute":"Mute",children:f?t.jsx(mp,{className:"w-6 h-6"}):t.jsx(fp,{className:"w-6 h-6"})})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:F,className:"p-3 text-white hover:bg-white/20 rounded-full transition-colors",title:"Rewind 10s",children:t.jsx(sw,{className:"w-6 h-6"})}),t.jsx("button",{onClick:L,className:"p-4 text-white bg-white/20 hover:bg-white/30 rounded-full transition-colors",title:p?"Pause":"Play",children:p?t.jsx(Bi,{className:"w-8 h-8"}):t.jsx(xs,{className:"w-8 h-8"})}),t.jsx("button",{onClick:H,className:"p-3 text-white hover:bg-white/20 rounded-full transition-colors",title:"Forward 10s",children:t.jsx(Vh,{className:"w-6 h-6"})})]}),t.jsx("button",{onClick:P,className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",title:"Fullscreen",children:t.jsx(up,{className:"w-6 h-6"})})]})})]})]})})}function o6({selectedDate:a,onSelectDate:e}){const[s,n]=k.useState(!1),i=k.useRef(null);k.useEffect(()=>{const o=d=>{i.current&&!i.current.contains(d.target)&&n(!1)};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[]);const l=k.useMemo(()=>{const o=[],d=new Date;d.setHours(0,0,0,0);for(let h=-1;h<=6;h++){const u=new Date(d);u.setDate(u.getDate()+h),o.push(u)}return o},[]);return t.jsxs("div",{className:"relative",ref:i,children:[t.jsxs("button",{onClick:()=>n(!s),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded-lg transition-colors border border-gray-600",children:[t.jsx(sn,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{children:BN(a)}),t.jsx(Pn,{className:`h-4 w-4 text-gray-400 transition-transform ${s?"rotate-180":""}`})]}),s&&t.jsx("div",{className:"absolute top-full mt-1 left-0 bg-gray-800 border border-gray-600 rounded-lg shadow-xl z-30 py-1 min-w-[180px]",children:l.map((o,d)=>{const h=o.toDateString()===a.toDateString();return t.jsxs("button",{onClick:()=>{e(o),n(!1)},className:`w-full text-left px-4 py-2 text-sm transition-colors ${h?"bg-indigo-600 text-white":"text-gray-300 hover:bg-gray-700"}`,children:[t.jsx("span",{className:"font-medium",children:BN(o)}),t.jsx("span",{className:"text-gray-400 ml-2 text-xs",children:o.toLocaleDateString([],{month:"short",day:"numeric"})})]},d)})})]})}function c6(){const a=at(),e=k.useRef(null),s=k.useRef(null),n=k.useRef(null),[i,l]=k.useState(null),[o,d]=k.useState(null),[h,u]=k.useState("all"),[f,g]=k.useState("all"),[p,b]=k.useState(!1),[y,v]=k.useState(""),[_,N]=k.useState("grid"),[C,T]=k.useState(()=>{const xe=new Date;return xe.setHours(0,0,0,0),xe}),[L]=k.useState(24),[F,H]=k.useState(null),[B,P]=k.useState(null),[I,D]=k.useState(""),{startTime:O,endTime:ee}=k.useMemo(()=>{const xe=new Date(C);xe.setHours(0,0,0,0);const He=new Date(xe);return He.setHours(He.getHours()+L),{startTime:xe,endTime:He}},[C,L]),ie=k.useMemo(()=>new Date,[]),Z=k.useMemo(()=>{const xe=[],He=new Date(O);for(;He<ee;)xe.push(new Date(He)),He.setMinutes(He.getMinutes()+30);return xe},[O,ee]),{data:z,isLoading:X}=Fe({queryKey:["channels"],queryFn:async()=>(await(await fetch("/livetv/channels",{headers:{"X-Plex-Token":pe.getToken()||""}})).json()).channels.filter(tt=>tt.enabled!==!1).sort((tt,Jt)=>tt.number-Jt.number)}),{data:ae,isLoading:te}=Fe({queryKey:["guide",O.toISOString(),ee.toISOString()],queryFn:async()=>{const xe=new URLSearchParams({start:O.toISOString(),end:ee.toISOString()});return(await fetch(`/livetv/guide?${xe}`,{headers:{"X-Plex-Token":pe.getToken()||""}})).json()},staleTime:300*1e3}),{data:W}=Fe({queryKey:["scheduled-recordings"],queryFn:()=>pe.getRecordings(),staleTime:30*1e3}),K=k.useMemo(()=>{const xe=new Map;return W&&W.filter(He=>He.status==="scheduled"||He.status==="recording").forEach(He=>{const tt=`${He.channelId}-${He.startTime}`;xe.set(tt,{status:He.status,recordingId:He.id})}),xe},[W]),q=k.useCallback((xe,He)=>{const tt=`${xe}-${He}`;return K.get(tt)?.status||null},[K]),J=k.useCallback((xe,He)=>{const tt=`${xe}-${He}`;return K.get(tt)?.recordingId||null},[K]),oe=k.useMemo(()=>ae?.programs?ae.programs:{},[ae]),be=k.useMemo(()=>{if(!z)return[];const xe=new Set;return z.forEach(He=>{He.group&&xe.add(He.group)}),Array.from(xe).sort()},[z]),ye=k.useMemo(()=>{if(!z)return[];const xe=new Map;return z.forEach(He=>{He.sourceName&&xe.set(He.sourceName,(xe.get(He.sourceName)||0)+1)}),Array.from(xe.entries()).sort((He,tt)=>He[0].localeCompare(tt[0]))},[z]),Ee=k.useCallback(xe=>(oe[xe.channelId]||[]).length>0,[oe]),re=k.useCallback(xe=>{const He=oe[xe.channelId]||[],tt=new Date;return He.find(Jt=>new Date(Jt.start)<=tt&&new Date(Jt.end)>tt)},[oe]),fe=k.useMemo(()=>z?z.filter(xe=>{if(h!=="all"&&xe.group!==h||f!=="all"&&xe.sourceName!==f||p&&Ee(xe))return!1;if(y.trim()){const He=y.toLowerCase(),tt=xe.name.toLowerCase().includes(He),Jt=String(xe.number).includes(He),ks=xe.group?.toLowerCase().includes(He);if(!tt&&!Jt&&!ks)return!1}return!0}):[],[z,h,f,p,Ee,y]),Le=k.useMemo(()=>{if(!z)return{};const xe={all:0};return z.forEach(He=>{Ee(He)||(xe.all++,He.group&&(xe[He.group]=(xe[He.group]||0)+1))}),xe},[z,Ee]),ze=Me({mutationFn:async({channelId:xe,programId:He,seriesRecord:tt})=>{const Jt=await fetch("/dvr/recordings/from-program",{method:"POST",headers:{"Content-Type":"application/json","X-Plex-Token":pe.getToken()||""},body:JSON.stringify({channelId:xe,programId:He,seriesRecord:tt})});if(!Jt.ok)throw new Error("Failed to create recording");return Jt.json()},onSuccess:()=>{a.invalidateQueries({queryKey:["recordings"]}),a.invalidateQueries({queryKey:["scheduled-recordings"]}),l(null)}}),Xe=Me({mutationFn:async xe=>{await pe.deleteRecording(xe)},onSuccess:()=>{a.invalidateQueries({queryKey:["recordings"]}),a.invalidateQueries({queryKey:["scheduled-recordings"]}),l(null)}}),{data:ue}=Fe({queryKey:["epgSources"],queryFn:async()=>await pe.getEPGSources()}),{data:Ge}=Fe({queryKey:["epgChannels",B],queryFn:async()=>(await(await fetch(`/livetv/epg/channels?epgSourceId=${B}`,{headers:{"X-Plex-Token":pe.getToken()||""}})).json()).channels,enabled:!!B&&!!F}),Ve=k.useMemo(()=>{if(!Ge)return[];if(!I.trim())return Ge;const xe=I.toLowerCase();return Ge.filter(He=>He.callSign?.toLowerCase().includes(xe)||He.channelNo?.toLowerCase().includes(xe)||He.channelId.toLowerCase().includes(xe)||He.sampleTitle?.toLowerCase().includes(xe))},[Ge,I]),bt=Me({mutationFn:async({channelId:xe,epgSourceId:He,epgChannelId:tt})=>{const Jt=await fetch(`/livetv/channels/${xe}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Plex-Token":pe.getToken()||""},body:JSON.stringify({epgSourceId:He,channelId:tt})});if(!Jt.ok)throw new Error("Failed to map channel");return Jt.json()},onSuccess:async()=>{await a.refetchQueries({queryKey:["channels"]}),await a.refetchQueries({queryKey:["guide"]}),H(null),D("")}}),We=Me({mutationFn:async xe=>{const He=await fetch(`/livetv/channels/${xe}/epg-mapping`,{method:"DELETE",headers:{"X-Plex-Token":pe.getToken()||""}});if(!He.ok)throw new Error("Failed to unmap channel");return He.json()},onSuccess:async()=>{await a.refetchQueries({queryKey:["channels"]}),await a.refetchQueries({queryKey:["guide"]}),H(null)}}),[ot,Ie]=k.useState(null),Lt=Me({mutationFn:async()=>{const xe=await fetch("/livetv/channels/auto-detect?apply=true&unmappedOnly=true",{method:"POST",headers:{"X-Plex-Token":pe.getToken()||""}});if(!xe.ok)throw new Error("Failed to auto-detect EPG mappings");return xe.json()},onSuccess:async xe=>{await a.refetchQueries({queryKey:["channels"]}),await a.refetchQueries({queryKey:["guide"]}),Ie(xe)}});k.useEffect(()=>{F&&ue&&ue.length>0&&!B&&P(ue[0].id)},[F,ue,B]);const Ht=k.useCallback(()=>{const xe=e.current;if(!xe)return;const tt=(Date.now()-O.getTime())/6e4;if(tt>=0&&tt<=L*60){const Jt=tt*pr-xe.clientWidth/3;xe.scrollLeft=Math.max(0,Jt),s.current&&(s.current.scrollLeft=xe.scrollLeft)}else xe.scrollLeft=0,s.current&&(s.current.scrollLeft=0)},[O,L]);k.useEffect(()=>{const xe=setTimeout(Ht,100);return()=>clearTimeout(xe)},[Ht,ae]);const As=(ee.getTime()-O.getTime())/6e4*pr,Cs=(ie.getTime()-O.getTime())/6e4*pr,Tn=Cs>0&&Cs<As,ts=fe,Bn=X||te,ua=z?.length||0,rn=xe=>{i&&ze.mutate({channelId:i.channel?.id||0,programId:i.program.id,seriesRecord:xe})},ya=()=>{const xe=new Date(C);xe.setDate(xe.getDate()-1),T(xe)},An=()=>{const xe=new Date(C);xe.setDate(xe.getDate()+1),T(xe)},ln=()=>{const xe=new Date;xe.setHours(0,0,0,0),T(xe)},Sa=()=>t.jsx("div",{className:"flex-1 bg-gray-800 rounded-xl overflow-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"sticky top-0 bg-gray-900 z-10",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-left text-xs text-gray-400 font-medium px-4 py-3 w-12",children:"#"}),t.jsx("th",{className:"text-left text-xs text-gray-400 font-medium px-4 py-3 w-16",children:"Logo"}),t.jsx("th",{className:"text-left text-xs text-gray-400 font-medium px-4 py-3",children:"Channel"}),t.jsx("th",{className:"text-left text-xs text-gray-400 font-medium px-4 py-3",children:"Now Playing"}),t.jsx("th",{className:"text-left text-xs text-gray-400 font-medium px-4 py-3 w-32",children:"Time"}),t.jsx("th",{className:"text-left text-xs text-gray-400 font-medium px-4 py-3 w-24",children:"Category"}),t.jsx("th",{className:"text-left text-xs text-gray-400 font-medium px-4 py-3 w-20",children:"EPG"}),t.jsx("th",{className:"text-left text-xs text-gray-400 font-medium px-4 py-3 w-20"})]})}),t.jsx("tbody",{children:ts.map(xe=>{const He=re(xe),tt=Ee(xe),Jt=He?Dh[He.category||""]||"bg-gray-600":"";return t.jsxs("tr",{className:`border-b border-gray-700/30 hover:bg-gray-700/30 transition-colors ${tt?"":"bg-red-900/10"}`,children:[t.jsx("td",{className:"px-4 py-3 text-gray-500 text-sm",children:xe.number}),t.jsx("td",{className:"px-4 py-3",children:PN(xe.logo)?t.jsx("img",{src:xe.logo,alt:xe.name,className:"w-10 h-7 object-contain bg-gray-700 rounded",onError:ks=>{ks.target.style.display="none"}}):t.jsx("div",{className:"w-10 h-7 bg-gray-700 rounded flex items-center justify-center text-xs text-gray-400",children:"TV"})}),t.jsxs("td",{className:"px-4 py-3",children:[t.jsx("div",{className:"text-sm font-medium text-white",children:xe.name}),xe.sourceName&&t.jsx("div",{className:"text-xs text-gray-500",children:xe.sourceName})]}),t.jsx("td",{className:"px-4 py-3",children:He?t.jsxs("button",{onClick:()=>l({program:He,channel:xe}),className:"text-left hover:text-indigo-400 transition-colors",children:[t.jsx("div",{className:"text-sm font-medium text-white",children:He.title}),He.description&&t.jsx("div",{className:"text-xs text-gray-500 line-clamp-1 max-w-md",children:He.description})]}):t.jsx("span",{className:"text-xs text-gray-600",children:"No program info"})}),t.jsx("td",{className:"px-4 py-3 text-xs text-gray-400",children:He&&t.jsxs(t.Fragment,{children:[Ri(new Date(He.start))," - ",Ri(new Date(He.end))]})}),t.jsx("td",{className:"px-4 py-3",children:He?.category&&t.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-semibold text-white ${Jt}`,children:He.category})}),t.jsx("td",{className:"px-4 py-3",children:tt?t.jsx("span",{className:"text-green-400 text-xs",children:"Mapped"}):t.jsxs("button",{onClick:()=>H(xe),className:"flex items-center gap-1 px-2 py-1 bg-indigo-600 hover:bg-indigo-700 text-white text-xs rounded transition-colors",children:[t.jsx(bu,{className:"h-3 w-3"}),"Map"]})}),t.jsx("td",{className:"px-4 py-3",children:xe.streamUrl&&t.jsx("button",{onClick:()=>d({channel:xe,program:He}),className:"p-1.5 bg-green-600 hover:bg-green-500 text-white rounded-full transition-colors",title:"Watch",children:t.jsx(xs,{className:"h-3 w-3"})})})]},xe.id)})})]})}),[Un,on]=k.useState({start:0,end:50}),Ps=10,we=k.useCallback(()=>{const xe=e.current;if(!xe)return;const He=xe.scrollTop,tt=xe.clientHeight,Jt=Math.floor(He/sl),ks=Math.ceil((He+tt)/sl);on({start:Math.max(0,Jt-Ps),end:Math.min(ts.length,ks+Ps)})},[ts.length]),gt=k.useCallback(()=>{const xe=e.current;xe&&(s.current&&(s.current.scrollLeft=xe.scrollLeft),n.current&&(n.current.scrollTop=xe.scrollTop),we())},[we]);k.useEffect(()=>{we()},[ts.length,we]);const zt=60*pr,ja=30*pr,Mo=k.useMemo(()=>({backgroundImage:`
      repeating-linear-gradient(to right, rgba(75,85,99,0.4) 0px, rgba(75,85,99,0.4) 1px, transparent 1px, transparent ${zt}px),
      repeating-linear-gradient(to right, rgba(55,65,81,0.25) 0px, rgba(55,65,81,0.25) 1px, transparent 1px, transparent ${ja}px)
    `,backgroundSize:`${zt}px 100%, ${ja}px 100%`}),[zt,ja]),Vi=()=>{const xe=ts.length*sl,He=ts.slice(Un.start,Un.end);return t.jsxs("div",{className:"flex-1 bg-gray-900 rounded-xl overflow-hidden flex flex-col min-h-0",children:[t.jsxs("div",{className:"flex flex-shrink-0 border-b border-gray-700/50",children:[t.jsx("div",{className:"flex-shrink-0 bg-gray-900 border-r border-gray-700/50 flex items-center justify-center",style:{width:ON,height:FN},children:t.jsxs("span",{className:"text-xs font-medium text-gray-500",children:[ts.length," / ",ua]})}),t.jsx("div",{ref:s,className:"flex-1 overflow-hidden",style:{scrollbarWidth:"none"},children:t.jsxs("div",{className:"relative bg-gray-900",style:{width:As,height:FN},children:[Z.map((tt,Jt)=>{const ks=tt.getMinutes()===0,Ea=(tt.getTime()-O.getTime())/6e4*pr;return t.jsx("div",{className:`absolute top-0 bottom-0 flex items-center px-2 ${ks?"border-l border-gray-600":"border-l border-gray-700/40"}`,style:{left:Ea},children:t.jsx("span",{className:`text-xs whitespace-nowrap ${ks?"font-semibold text-gray-200":"font-normal text-gray-500"}`,children:Ri(tt)})},Jt)}),Tn&&t.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-red-500 z-20",style:{left:Cs},children:t.jsx("div",{className:"absolute -bottom-0.5 left-1/2 -translate-x-1/2 w-0 h-0 border-l-[5px] border-r-[5px] border-t-[6px] border-l-transparent border-r-transparent border-t-red-500"})})]})})]}),t.jsxs("div",{className:"flex flex-1 min-h-0",children:[t.jsx("div",{ref:n,className:"flex-shrink-0 overflow-hidden border-r border-gray-700/50 bg-gray-900/80",style:{width:ON,scrollbarWidth:"none"},children:t.jsx("div",{style:{height:xe,position:"relative"},children:He.map((tt,Jt)=>{const ks=Ee(tt),Ea=Un.start+Jt;return t.jsxs("div",{className:`absolute left-0 right-0 flex items-center gap-2 px-2 border-b border-gray-800/80 hover:bg-gray-800 cursor-pointer group ${ks?"":"bg-red-950/20"}`,style:{height:sl,top:Ea*sl},onClick:()=>{tt.streamUrl&&d({channel:tt,program:re(tt)})},children:[PN(tt.logo)?t.jsx("img",{src:tt.logo,alt:tt.name,className:"w-9 h-6 object-contain bg-gray-800 rounded flex-shrink-0",onError:Cn=>{Cn.target.style.display="none"}}):t.jsx("div",{className:"w-9 h-6 bg-gray-800 rounded flex items-center justify-center text-[10px] text-gray-500 flex-shrink-0",children:tt.number}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("div",{className:"text-xs font-medium text-gray-200 truncate leading-tight",children:tt.name}),t.jsxs("div",{className:"text-[10px] text-gray-500 flex items-center gap-1 flex-wrap leading-tight",children:[t.jsx("span",{children:tt.number}),!ks&&t.jsxs("button",{onClick:Cn=>{Cn.stopPropagation(),H(tt)},className:"ml-0.5 px-1 py-0 bg-indigo-600 hover:bg-indigo-700 text-white text-[9px] rounded transition-colors flex items-center gap-0.5",title:"Map to EPG channel",children:[t.jsx(bu,{className:"h-2.5 w-2.5"}),"Map"]})]})]}),tt.streamUrl&&t.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",children:t.jsx(xs,{className:"h-3.5 w-3.5 text-green-400"})})]},tt.id)})})}),t.jsx("div",{ref:e,className:"flex-1 overflow-auto",onScroll:gt,children:t.jsxs("div",{className:"relative",style:{width:As,height:xe,minWidth:"100%",...Mo},children:[Tn&&t.jsx("div",{className:"absolute w-0.5 bg-red-500/80 z-10 pointer-events-none",style:{left:Cs,top:0,height:xe}}),He.map((tt,Jt)=>{const ks=oe[tt.channelId]||[],Cn=(Un.start+Jt)*sl;return t.jsxs("div",{className:"absolute left-0 right-0 border-b border-gray-800/60",style:{height:sl,top:Cn},children:[ks.map(ha=>{const ba=new Date(ha.start),Ta=new Date(ha.end);if(Ta<=O||ba>=ee)return null;const qi=ba<O?O:ba,Aa=Ta>ee?ee:Ta,kr=(qi.getTime()-O.getTime())/6e4*pr,Rr=(Aa.getTime()-qi.getTime())/6e4*pr,ys=ie>=ba&&ie<Ta,Lr=q(tt.id,ha.start);return t.jsx(i6,{program:ha,startOffset:kr,width:Rr,isNow:ys,isScheduled:Lr==="scheduled",isRecording:Lr==="recording",onClick:()=>l({program:ha,channel:tt})},ha.id)}),ks.filter(ha=>{const ba=new Date(ha.start);return!(new Date(ha.end)<=O||ba>=ee)}).length===0&&t.jsx("div",{className:"absolute inset-1 flex items-center justify-center",children:t.jsx("span",{className:"text-[10px] text-gray-700",children:"No program data"})})]},tt.id)})]})})]})]})};return t.jsxs("div",{className:"h-full flex flex-col",children:[t.jsxs("div",{className:"mb-3 flex items-center justify-between flex-wrap gap-2",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"TV Guide"}),t.jsxs("div",{className:"flex items-center bg-gray-800 rounded-lg p-0.5",children:[t.jsx("button",{onClick:()=>N("grid"),className:`p-1.5 rounded transition-colors ${_==="grid"?"bg-indigo-600 text-white":"text-gray-400 hover:text-white"}`,title:"Grid View",children:t.jsx(z1,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>N("list"),className:`p-1.5 rounded transition-colors ${_==="list"?"bg-indigo-600 text-white":"text-gray-400 hover:text-white"}`,title:"List View",children:t.jsx(yh,{className:"h-4 w-4"})})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>{a.refetchQueries({queryKey:["channels"]}),a.refetchQueries({queryKey:["guide"]})},className:"p-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors",title:"Refresh EPG data",children:t.jsx(ut,{className:`h-4 w-4 ${X||te?"animate-spin":""}`})}),t.jsx("div",{className:"h-5 w-px bg-gray-600"}),t.jsx("button",{onClick:ya,className:"p-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors",title:"Previous day",children:t.jsx(ko,{className:"h-4 w-4"})}),t.jsx(o6,{selectedDate:C,onSelectDate:T}),t.jsx("button",{onClick:An,className:"p-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors",title:"Next day",children:t.jsx(Ba,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>{ln(),setTimeout(Ht,200)},className:"px-3 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-medium transition-colors",children:"Now"})]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-3",children:[ye.length>1&&t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(H1,{className:"h-3.5 w-3.5 text-gray-500"}),t.jsxs("select",{value:f,onChange:xe=>g(xe.target.value),className:"px-2 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm min-w-[140px]",children:[t.jsx("option",{value:"all",children:"All Sources"}),ye.map(([xe,He])=>t.jsxs("option",{value:xe,children:[xe," (",He,")"]},xe))]})]}),be.length>0&&t.jsxs("select",{value:h,onChange:xe=>u(xe.target.value),className:"px-2 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm min-w-[140px]",children:[t.jsxs("option",{value:"all",children:["All Groups (",ua,")"]}),be.map(xe=>t.jsxs("option",{value:xe,children:[xe," (",z?.filter(He=>He.group===xe).length||0,")"]},xe))]}),t.jsxs("div",{className:"relative",children:[t.jsx(xt,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-gray-500"}),t.jsx("input",{type:"text",placeholder:"Search channels...",value:y,onChange:xe=>v(xe.target.value),className:"pl-8 pr-3 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 text-sm w-48"}),y&&t.jsx("button",{onClick:()=>v(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-300",children:t.jsx(nt,{className:"h-3.5 w-3.5"})})]}),t.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:p,onChange:xe=>b(xe.target.checked),className:"w-3.5 h-3.5 rounded border-gray-500 bg-gray-600 text-red-600 focus:ring-red-500"}),t.jsxs("span",{className:"text-xs text-gray-400",children:["No EPG only",Le.all>0&&t.jsxs("span",{className:"ml-1 text-red-400",children:["(",Le.all,")"]})]})]}),Le.all>0&&t.jsxs("button",{onClick:()=>Lt.mutate(),disabled:Lt.isPending,className:"flex items-center gap-1.5 px-2.5 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 text-white text-xs font-medium rounded-lg transition-colors",children:[t.jsx(Sr,{className:`h-3.5 w-3.5 ${Lt.isPending?"animate-spin":""}`}),Lt.isPending?"Detecting...":"Auto-Detect"]}),t.jsx("div",{className:"flex-1"}),t.jsx("div",{className:"flex items-center gap-2",children:Object.entries(Dh).map(([xe,He])=>t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:`w-2.5 h-2.5 rounded-sm ${He}`}),t.jsx("span",{className:"text-[10px] text-gray-500",children:xe})]},xe))})]}),Bn?t.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-800 rounded-xl",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-500 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-400",children:"Loading TV Guide..."})]})}):_==="grid"?Vi():Sa(),i&&t.jsx(r6,{program:i.program,channel:i.channel,onClose:()=>l(null),onRecord:rn,onWatchNow:()=>{i.channel?.streamUrl&&d({channel:i.channel,program:i.program}),l(null)},isRecording:ze.isPending,scheduledStatus:i.channel?q(i.channel.id,i.program.start):null,onCancelRecording:()=>{if(i.channel){const xe=J(i.channel.id,i.program.start);xe&&Xe.mutate(xe)}}}),o&&t.jsx(l6,{channel:o.channel,program:o.program,onClose:()=>d(null)}),F&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4",onClick:()=>H(null),children:t.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl flex flex-col",onClick:xe=>xe.stopPropagation(),children:[t.jsxs("div",{className:"p-4 border-b border-gray-700 flex-shrink-0",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[t.jsx(bu,{className:"h-5 w-5"}),"Map EPG Channel"]}),t.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["Map ",t.jsxs("span",{className:"text-indigo-400 font-medium",children:["Ch ",F.number," - ",F.name]})," to an EPG channel"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[Ee(F)&&t.jsxs("button",{onClick:()=>We.mutate(F.id),disabled:We.isPending,className:"px-3 py-1.5 bg-red-600 hover:bg-red-700 disabled:opacity-50 text-white text-sm rounded-lg transition-colors flex items-center gap-1.5",children:[t.jsx(nt,{className:"h-4 w-4"}),We.isPending?"Removing...":"Remove Mapping"]}),t.jsx("button",{onClick:()=>H(null),className:"p-1.5 bg-gray-700 hover:bg-gray-600 rounded-full transition-colors",children:t.jsx(nt,{className:"h-5 w-5 text-white"})})]})]}),ue&&ue.length>0&&t.jsxs("div",{className:"mt-3",children:[t.jsx("label",{className:"text-sm text-gray-400 mb-1 block",children:"EPG Source:"}),t.jsx("select",{value:B||"",onChange:xe=>{P(parseInt(xe.target.value)),D("")},className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white text-sm",children:ue.map(xe=>t.jsxs("option",{value:xe.id,children:[xe.name," (",xe.channelCount," channels)"]},xe.id))})]}),t.jsxs("div",{className:"relative mt-3",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by call sign, channel number, or title...",value:I,onChange:xe=>D(xe.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 text-sm",autoFocus:!0})]}),t.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:[Ve.length," channel",Ve.length!==1?"s":""," found",I&&` for "${I}"`]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:Ge?Ve.length===0?t.jsx("div",{className:"text-center py-8 text-gray-400",children:t.jsx("p",{children:"No channels match your search"})}):t.jsxs("div",{className:"space-y-2",children:[Ve.slice(0,100).map(xe=>t.jsx("button",{onClick:()=>{B&&bt.mutate({channelId:F.id,epgSourceId:B,epgChannelId:xe.channelId})},disabled:bt.isPending,className:"w-full p-3 bg-gray-700 hover:bg-gray-600 rounded-lg text-left transition-colors disabled:opacity-50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsxs("div",{className:"text-white font-medium",children:[xe.callSign||xe.channelId,xe.channelNo&&t.jsxs("span",{className:"text-gray-400 font-normal ml-2",children:["Ch ",xe.channelNo]})]}),t.jsx("div",{className:"text-sm text-gray-400 truncate",children:xe.sampleTitle})]}),t.jsx(bu,{className:"h-4 w-4 text-gray-500 flex-shrink-0 ml-2"})]})},xe.channelId)),Ve.length>100&&t.jsx("p",{className:"text-center text-sm text-gray-500 py-2",children:"Showing first 100 results. Use search to narrow down."})]}):t.jsxs("div",{className:"text-center py-8 text-gray-400",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto mb-3"}),t.jsx("p",{children:"Loading EPG channels..."})]})})]})}),ot&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4",onClick:()=>Ie(null),children:t.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl flex flex-col",onClick:xe=>xe.stopPropagation(),children:[t.jsxs("div",{className:"p-4 border-b border-gray-700 flex-shrink-0",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[t.jsx(Sr,{className:"h-5 w-5 text-indigo-400"}),"Auto-Detect Results"]}),t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"EPG channel mapping completed"})]}),t.jsx("button",{onClick:()=>Ie(null),className:"p-1.5 bg-gray-700 hover:bg-gray-600 rounded-full transition-colors",children:t.jsx(nt,{className:"h-5 w-5 text-white"})})]}),t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mt-4",children:[t.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-3 text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-white",children:ot.summary.totalChannels}),t.jsx("div",{className:"text-xs text-gray-400",children:"Scanned"})]}),t.jsxs("div",{className:"bg-green-600/20 rounded-lg p-3 text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-green-400",children:ot.summary.newMappings}),t.jsx("div",{className:"text-xs text-gray-400",children:"New Mappings"})]}),t.jsxs("div",{className:"bg-blue-600/20 rounded-lg p-3 text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-blue-400",children:ot.summary.alreadyMapped}),t.jsx("div",{className:"text-xs text-gray-400",children:"Already Mapped"})]}),t.jsxs("div",{className:"bg-yellow-600/20 rounded-lg p-3 text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:ot.summary.noMatchFound}),t.jsx("div",{className:"text-xs text-gray-400",children:"No Match"})]})]})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[ot.results.filter(xe=>xe.autoMapped).length>0&&t.jsxs(t.Fragment,{children:[t.jsx("h3",{className:"text-sm font-semibold text-green-400 mb-2",children:"Successfully Mapped"}),t.jsx("div",{className:"space-y-2 mb-4",children:ot.results.filter(xe=>xe.autoMapped).map(xe=>t.jsxs("div",{className:"p-3 bg-green-600/10 border border-green-600/30 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-white font-medium",children:xe.channelName}),xe.bestMatch&&t.jsx("span",{className:"text-green-400 ml-2",children:xe.bestMatch.epgCallSign||xe.bestMatch.epgName})]}),xe.bestMatch&&t.jsxs("span",{className:"text-xs bg-green-600/30 text-green-300 px-2 py-1 rounded",children:[Math.round(xe.bestMatch.confidence*100),"%"]})]}),xe.bestMatch?.matchReason&&t.jsx("div",{className:"text-xs text-gray-400 mt-1",children:xe.bestMatch.matchReason})]},xe.channelId))})]}),ot.results.filter(xe=>!xe.autoMapped&&!xe.currentMapping).length>0&&t.jsxs(t.Fragment,{children:[t.jsx("h3",{className:"text-sm font-semibold text-yellow-400 mb-2",children:"No Match Found"}),t.jsx("div",{className:"space-y-2",children:ot.results.filter(xe=>!xe.autoMapped&&!xe.currentMapping).map(xe=>t.jsx("div",{className:"p-3 bg-yellow-600/10 border border-yellow-600/30 rounded-lg",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-white",children:xe.channelName}),t.jsx("button",{onClick:()=>{const He=z?.find(tt=>tt.id===xe.channelId);He&&(Ie(null),H(He))},className:"text-xs bg-gray-600 hover:bg-gray-500 text-white px-2 py-1 rounded transition-colors",children:"Map Manually"})]})},xe.channelId))})]})]}),t.jsx("div",{className:"p-4 border-t border-gray-700 flex-shrink-0",children:t.jsx("button",{onClick:()=>Ie(null),className:"w-full py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition-colors",children:"Done"})})]})})]})}const d6=[{id:"all",name:"All",icon:z1,color:"bg-indigo-600",activeText:"text-white"},{id:"tvshows",name:"TV Shows",icon:jt,color:"bg-blue-600",activeText:"text-white"},{id:"movies",name:"Movies",icon:Gt,color:"bg-purple-600",activeText:"text-white"},{id:"sports",name:"Sports",icon:ti,color:"bg-green-600",activeText:"text-white"},{id:"kids",name:"Kids",icon:Gc,color:"bg-orange-500",activeText:"text-white"},{id:"news",name:"News",icon:X1,color:"bg-red-600",activeText:"text-white"}];function u6(a){const e=new Date(a),s=new Date,n=(e.getTime()-s.getTime())/6e4;if(n>=0&&n<=30)return"coming_up";const i=new Date(s);i.setHours(0,0,0,0);const l=new Date(e);if(l.setHours(0,0,0,0),i.getTime()===l.getTime()){const h=e.getHours();return h>=20&&h<23?"prime_time":"tonight"}const d=new Date(i);return d.setDate(d.getDate()+1),l.getTime()===d.getTime()?"tomorrow":"this_week"}function h6(a){const e={coming_up:[],prime_time:[],tonight:[],tomorrow:[],this_week:[]};for(const n of a){const i=u6(n.program.start);e[i].push(n)}return[{slot:"coming_up",label:"Coming Up Next",icon:Kt},{slot:"prime_time",label:"Prime Time",icon:Di},{slot:"tonight",label:"Tonight",icon:sk},{slot:"tomorrow",label:"Tomorrow",icon:aR},{slot:"this_week",label:"This Week",icon:o0}].filter(n=>e[n.slot].length>0).map(n=>({...n,items:e[n.slot]}))}function f6(a){return new Date(a).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function m6(a){const e=new Date(a),s=new Date,n=new Date(s);return n.setDate(n.getDate()+1),e.toDateString()===s.toDateString()?"Today":e.toDateString()===n.toDateString()?"Tomorrow":e.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"})}function g6(a,e){const s=new Date(a),n=new Date(e),i=Math.round((n.getTime()-s.getTime())/6e4),l=Math.floor(i/60),o=i%60;return l>0?o>0?`${l}h ${o}m`:`${l}h`:`${o}m`}function p6(a){return a.isSports?{label:a.league||"Sports",className:"bg-green-600/80 text-green-100"}:a.isMovie?{label:"Movie",className:"bg-purple-600/80 text-purple-100"}:a.isKids?{label:"Kids",className:"bg-orange-500/80 text-orange-100"}:a.isNews?{label:"News",className:"bg-red-600/80 text-red-100"}:a.category?{label:a.category,className:"bg-gray-600/80 text-gray-200"}:null}function x6({item:a,onRecord:e,isRecording:s}){const{program:n,channel:i,hasRecording:l}=a,o=h=>{h.stopPropagation(),!l&&i&&e()},d=p6(n);return t.jsxs("div",{className:"group bg-gray-800/70 rounded-xl overflow-hidden border border-gray-700/50 hover:border-indigo-500/60 hover:bg-gray-800 transition-all duration-200",children:[t.jsxs("div",{className:"relative aspect-video bg-gray-900/60",children:[n.icon||n.art?t.jsx("img",{src:n.icon||n.art,alt:n.title,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-800 to-gray-900",children:t.jsx(jt,{className:"w-10 h-10 text-gray-700"})}),t.jsxs("div",{className:"absolute top-2 left-2 flex gap-1.5",children:[n.isLive&&t.jsxs("span",{className:"px-2 py-0.5 bg-red-600 text-white text-xs font-semibold rounded-md flex items-center gap-1 shadow",children:[t.jsx(fl,{className:"w-2 h-2 fill-current"}),"LIVE"]}),n.isNew&&t.jsx("span",{className:"px-2 py-0.5 bg-emerald-600 text-white text-xs font-semibold rounded-md shadow",children:"NEW"}),n.isPremiere&&t.jsx("span",{className:"px-2 py-0.5 bg-yellow-500 text-gray-900 text-xs font-semibold rounded-md shadow",children:"PREMIERE"})]}),l&&t.jsx("div",{className:"absolute top-2 right-2",children:t.jsxs("span",{className:"px-2 py-0.5 bg-red-600 text-white text-xs font-semibold rounded-md flex items-center gap-1 shadow",children:[t.jsx(yl,{className:"w-3 h-3"}),"REC"]})}),t.jsx("div",{className:"absolute bottom-2 right-2",children:t.jsx("span",{className:"px-2 py-0.5 bg-black/70 backdrop-blur-sm text-white text-xs rounded-md font-medium",children:g6(n.start,n.end)})}),d&&t.jsx("div",{className:"absolute bottom-2 left-2",children:t.jsx("span",{className:`px-2 py-0.5 backdrop-blur-sm text-xs rounded-md font-medium ${d.className}`,children:d.label})})]}),t.jsxs("div",{className:"p-3 space-y-2",children:[t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("h3",{className:"font-semibold text-white text-sm leading-tight truncate",children:n.title}),n.subtitle&&t.jsx("p",{className:"text-xs text-gray-400 truncate mt-0.5",children:n.subtitle})]}),i&&t.jsx("button",{onClick:o,disabled:l||s,className:`flex-shrink-0 p-1.5 rounded-full transition-colors ${l?"bg-red-600/20 text-red-400 cursor-default":s?"bg-gray-700 text-gray-500":"bg-gray-700/60 text-gray-400 hover:bg-red-600 hover:text-white"}`,title:l?"Recording scheduled":"Record this program",children:s?t.jsx(tn,{className:"w-3.5 h-3.5 animate-spin"}):l?t.jsx(Bs,{className:"w-3.5 h-3.5"}):t.jsx(yl,{className:"w-3.5 h-3.5"})})]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[t.jsxs("span",{className:"font-medium text-indigo-400 whitespace-nowrap",children:[m6(n.start)," ",f6(n.start)]}),i&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-gray-600",children:"|"}),t.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[i.logo&&t.jsx("img",{src:i.logo,alt:i.name,className:"w-4 h-4 rounded-sm object-contain bg-white/10 flex-shrink-0"}),t.jsx("span",{className:"text-gray-400 truncate",children:i.name})]})]})]}),t.jsxs("div",{className:"flex flex-wrap gap-1",children:[n.league&&t.jsx("span",{className:"px-1.5 py-0.5 bg-green-900/50 text-green-400 text-[10px] rounded font-medium",children:n.league}),n.rating&&t.jsx("span",{className:"px-1.5 py-0.5 bg-gray-700/60 text-gray-400 text-[10px] rounded font-medium",children:n.rating}),n.teams&&t.jsx("span",{className:"px-1.5 py-0.5 bg-gray-700/60 text-gray-400 text-[10px] rounded font-medium truncate max-w-[160px]",children:n.teams})]})]})]})}function y6({group:a,onRecordClick:e,recordingProgramId:s}){const[n,i]=k.useState(!1),l=a.icon;return t.jsxs("section",{className:"mb-8",children:[t.jsxs("button",{onClick:()=>i(!n),className:"flex items-center gap-3 mb-4 group/header cursor-pointer w-full text-left",children:[t.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.jsx(l,{className:"w-5 h-5 text-indigo-400 flex-shrink-0"}),t.jsx("h2",{className:"text-lg font-bold text-white",children:a.label}),t.jsxs("span",{className:"text-sm text-gray-500 font-medium",children:["(",a.items.length,")"]})]}),t.jsx("div",{className:"flex-1 h-px bg-gray-700/50"}),t.jsx(Ba,{className:`w-4 h-4 text-gray-500 transition-transform ${n?"":"rotate-90"}`})]}),!n&&t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3",children:a.items.map(o=>t.jsx(x6,{item:o,onRecord:()=>e(o),isRecording:s===o.program.id},`${o.program.id}-${o.program.start}`))})]})}function b6(){const a=at(),[e,s]=k.useState("all"),[n,i]=k.useState(""),[l,o]=k.useState(""),[d,h]=k.useState(null),[u,f]=k.useState(null),g=Me({mutationFn:async()=>(await fetch("/api/onlater/enrich?limit=200",{method:"POST",headers:{"X-Plex-Token":pe.getToken()||""}})).json(),onSuccess:()=>{setTimeout(()=>{a.invalidateQueries({queryKey:["onlater"]})},5e3)}}),p=Me({mutationFn:async({programId:I,channelId:D,seriesRecord:O})=>{h(I);const ee=await fetch("/api/dvr/recordings/from-program",{method:"POST",headers:{"Content-Type":"application/json","X-Plex-Token":pe.getToken()||""},body:JSON.stringify({programId:I,channelId:D,seriesRecord:O||!1})});if(!ee.ok)throw new Error("Failed to schedule recording");return ee.json()},onSuccess:()=>{a.invalidateQueries({queryKey:["onlater"]}),a.invalidateQueries({queryKey:["onlater-search"]}),h(null),f(null)},onError:()=>{h(null)}}),b=(I,D,O)=>{p.mutate({programId:I,channelId:D,seriesRecord:O})},y=I=>{f(I)},{data:v}=Fe({queryKey:["onlater-stats"],queryFn:async()=>(await fetch("/api/onlater/stats",{headers:{"X-Plex-Token":pe.getToken()||""}})).json()}),_=e==="all"?"all":e==="tvshows"?"tvshows":e,{data:N,isLoading:C}=Fe({queryKey:["onlater",e,l],queryFn:async()=>{let I=`/api/onlater/${_}`;const D=new URLSearchParams;D.set("hours","168"),e==="sports"&&l&&D.set("league",l);const O=`${I}?${D}`;return(await fetch(O,{headers:{"X-Plex-Token":pe.getToken()||""}})).json()}}),{data:T,isLoading:L}=Fe({queryKey:["onlater-search",n],queryFn:async()=>(await fetch(`/api/onlater/search?q=${encodeURIComponent(n)}&hours=168`,{headers:{"X-Plex-Token":pe.getToken()||""}})).json(),enabled:n.length>2}),{data:F}=Fe({queryKey:["onlater-leagues"],queryFn:async()=>(await fetch("/api/onlater/leagues",{headers:{"X-Plex-Token":pe.getToken()||""}})).json()}),H=n.length>2?T?.items:N?.items,B=k.useMemo(()=>!H||H.length===0?[]:h6(H),[H]),P=I=>{if(v)return v[I]};return t.jsxs("div",{className:"max-w-[1600px] mx-auto",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"On Later"}),t.jsx("p",{className:"text-gray-400 text-sm mt-0.5",children:"Browse upcoming programs across your channels"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("button",{onClick:()=>g.mutate(),disabled:g.isPending,className:"flex items-center gap-2 px-3.5 py-2 bg-purple-600/90 text-white text-sm rounded-lg hover:bg-purple-500 transition-colors disabled:opacity-50",title:"Fetch artwork from TMDB for programs missing images",children:[g.isPending?t.jsx(tn,{className:"w-4 h-4 animate-spin"}):t.jsx(aw,{className:"w-4 h-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Enrich Artwork"})]}),t.jsxs("div",{className:"relative",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),t.jsx("input",{type:"text",placeholder:"Search upcoming...",value:n,onChange:I=>i(I.target.value),className:"pl-9 pr-4 py-2 bg-gray-800/80 border border-gray-700/60 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500/60 focus:border-indigo-500/60 w-56"}),n&&t.jsx("button",{onClick:()=>i(""),className:"absolute right-2.5 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-300",children:t.jsx(nt,{className:"w-3.5 h-3.5"})})]})]})]}),t.jsx("div",{className:"flex gap-1.5 mb-6 overflow-x-auto pb-1 -mx-1 px-1 scrollbar-thin scrollbar-track-transparent scrollbar-thumb-gray-700",children:d6.map(I=>{const D=P(I.id),O=e===I.id;return t.jsxs("button",{onClick:()=>{s(I.id),i(""),o("")},className:`flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium transition-all whitespace-nowrap text-sm ${O?`${I.color} ${I.activeText} shadow-lg shadow-${I.color}/20`:"bg-gray-800/60 text-gray-400 hover:bg-gray-700/80 hover:text-gray-200"}`,children:[t.jsx(I.icon,{className:"w-4 h-4"}),I.name,D!==void 0&&D>0&&t.jsx("span",{className:`text-xs font-normal px-1.5 py-0.5 rounded-full ${O?"bg-white/20":"bg-gray-700/60 text-gray-500"}`,children:D>999?`${Math.floor(D/1e3)}k+`:D})]},I.id)})}),e==="sports"&&F?.leagues&&F.leagues.length>0&&t.jsxs("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-1",children:[t.jsx("button",{onClick:()=>o(""),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-colors ${l?"bg-gray-800/60 text-gray-400 hover:bg-gray-700":"bg-green-600 text-white"}`,children:"All Leagues"}),F.leagues.map(I=>t.jsx("button",{onClick:()=>o(I),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-colors ${l===I?"bg-green-600 text-white":"bg-gray-800/60 text-gray-400 hover:bg-gray-700"}`,children:I},I))]}),C||L?t.jsxs("div",{className:"flex flex-col items-center justify-center py-24 gap-3",children:[t.jsx(tn,{className:"w-8 h-8 text-indigo-500 animate-spin"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Loading programs..."})]}):B.length>0?t.jsxs(t.Fragment,{children:[B.map(I=>t.jsx(y6,{group:I,onRecordClick:y,recordingProgramId:d},I.slot)),t.jsxs("div",{className:"mt-4 pb-4 text-center text-xs text-gray-600",children:["Showing ",H?.length??0," programs across ",B.length," time slots"]})]}):t.jsxs("div",{className:"flex flex-col items-center justify-center py-24 gap-3",children:[t.jsx(jt,{className:"w-14 h-14 text-gray-700"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-300",children:"No upcoming content"}),t.jsx("p",{className:"text-sm text-gray-500 max-w-xs text-center",children:n?`No results found for "${n}"`:"Check back later or try a different category"})]}),u&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:()=>f(null),children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md mx-4 shadow-2xl border border-gray-700/50",onClick:I=>I.stopPropagation(),children:[t.jsxs("div",{className:"flex items-start justify-between mb-4",children:[t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Record Program"}),t.jsx("p",{className:"text-gray-400 text-sm mt-1 truncate",children:u.program.title}),u.program.subtitle&&t.jsx("p",{className:"text-gray-500 text-xs mt-0.5 truncate",children:u.program.subtitle})]}),t.jsx("button",{onClick:()=>f(null),className:"p-1 text-gray-400 hover:text-white hover:bg-gray-700 rounded ml-2",children:t.jsx(nt,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("button",{onClick:()=>{u.channel&&b(u.program.id,u.channel.id,!1)},disabled:p.isPending,className:"w-full flex items-center gap-4 p-4 bg-gray-700/60 hover:bg-gray-700 rounded-lg transition-colors text-left border border-gray-600/30",children:[t.jsx("div",{className:"flex-shrink-0 p-2 bg-indigo-600 rounded-lg",children:t.jsx(yl,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"font-medium text-white text-sm",children:"Record This Episode"}),t.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Record only this airing"})]}),p.isPending&&t.jsx(tn,{className:"w-5 h-5 text-indigo-400 animate-spin flex-shrink-0"})]}),t.jsxs("button",{onClick:()=>{u.channel&&b(u.program.id,u.channel.id,!0)},disabled:p.isPending,className:"w-full flex items-center gap-4 p-4 bg-gray-700/60 hover:bg-gray-700 rounded-lg transition-colors text-left border border-gray-600/30",children:[t.jsx("div",{className:"flex-shrink-0 p-2 bg-purple-600 rounded-lg",children:t.jsx(hp,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"font-medium text-white text-sm",children:"Record Series"}),t.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Record all future episodes with this title"})]}),p.isPending&&t.jsx(tn,{className:"w-5 h-5 text-purple-400 animate-spin flex-shrink-0"})]})]}),t.jsx("button",{onClick:()=>f(null),className:"w-full mt-4 py-2 text-sm text-gray-400 hover:text-white transition-colors",children:"Cancel"})]})})]})}const UN=a=>a?/^https?:\/\//i.test(a):!1,v6=[{id:"all",name:"All",icon:jt},{id:"favorites",name:"Favorites",icon:Di},{id:"news",name:"News",icon:X1},{id:"sports",name:"Sports",icon:ti},{id:"movies",name:"Movies",icon:Gt},{id:"entertainment",name:"Entertainment",icon:_o},{id:"kids",name:"Kids",icon:Gc}];function _6(a,e){const s=Date.now(),n=new Date(a).getTime(),i=new Date(e).getTime();if(i<=n)return 0;const l=s-n,o=i-n;return Math.max(0,Math.min(100,l/o*100))}function $N(a){return new Date(a).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function N6(a){const e=Date.now(),s=new Date(a).getTime(),n=Math.max(0,Math.round((s-e)/6e4));if(n<1)return"Ending";if(n===1)return"1 min left";if(n>=60){const i=Math.floor(n/60),l=n%60;return l===0?`${i}h left`:`${i}h ${l}m left`}return`${n} min left`}function ro(a,e){if(e==="all")return!0;if(e==="favorites")return a.isFavorite;const s=a.nowPlaying;if(!s)return!1;const n=(a.group||"").toLowerCase();switch(e){case"news":return!!s.isNews||n.includes("news");case"sports":return!!s.isSports||n.includes("sport");case"movies":return!!s.isMovie||n.includes("movie")||n.includes("film");case"entertainment":return!s.isNews&&!s.isSports&&!s.isMovie&&!s.isKids&&!!s.title;case"kids":return!!s.isKids||n.includes("kid")||n.includes("child");default:return!0}}function w6({channel:a}){const e=a.nowPlaying,s=e?_6(e.start,e.end):0;return t.jsx("a",{href:a.streamUrl||"#",target:"_blank",rel:"noopener noreferrer",className:"block bg-gray-800 rounded-xl border border-gray-700 hover:border-indigo-500 hover:bg-gray-750 transition-all duration-200 overflow-hidden group",children:t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[UN(a.logo)?t.jsx("img",{src:a.logo,alt:a.name,className:"h-10 w-10 rounded-lg object-contain bg-gray-900 p-1 flex-shrink-0",onError:n=>{const i=n.target;i.style.display="none";const l=i.nextElementSibling;l&&(l.style.display="flex")}}):null,t.jsx("div",{className:`h-10 w-10 rounded-lg bg-gray-700 flex items-center justify-center flex-shrink-0 ${UN(a.logo)?"hidden":""}`,children:t.jsx(jt,{className:"h-5 w-5 text-gray-400"})}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xs font-mono text-gray-400",children:a.number}),a.isFavorite&&t.jsx(Di,{className:"h-3 w-3 text-yellow-400 fill-yellow-400"})]}),t.jsx("p",{className:"text-sm font-medium text-white truncate",children:a.name})]})]}),e?t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.isLive&&t.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-bold uppercase bg-red-600 text-white",children:[t.jsx(fl,{className:"h-1.5 w-1.5 fill-current"}),"Live"]}),e.isNew&&t.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-bold uppercase bg-emerald-600 text-white",children:[t.jsx(aw,{className:"h-2.5 w-2.5"}),"New"]}),e.isPremiere&&t.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-bold uppercase bg-amber-600 text-white",children:"Premiere"}),e.isMovie&&t.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-bold uppercase bg-purple-600/60 text-purple-200",children:"Movie"}),e.isSports&&t.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-bold uppercase bg-green-600/60 text-green-200",children:"Sports"})]}),t.jsx("p",{className:"text-sm font-semibold text-white truncate leading-tight",children:e.title}),e.episodeNum&&t.jsx("p",{className:"text-xs text-gray-400 truncate mt-0.5",children:e.episodeNum}),t.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-400",children:[t.jsxs("span",{children:[$N(e.start)," - ",$N(e.end)]}),t.jsx("span",{children:N6(e.end)})]}),t.jsx("div",{className:"mt-2 h-1 bg-gray-700 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-indigo-600 rounded-full transition-all duration-1000",style:{width:`${s}%`}})})]}):t.jsx("div",{className:"py-2",children:t.jsx("p",{className:"text-sm text-gray-500 italic",children:"No program info"})})]})})}function S6(){const[a,e]=k.useState("all"),[s,n]=k.useState(""),[,i]=k.useState(0);k.useEffect(()=>{const f=setInterval(()=>i(g=>g+1),3e4);return()=>clearInterval(f)},[]);const{data:l,isLoading:o,error:d}=Fe({queryKey:["onNow"],queryFn:()=>pe.getOnNow(),refetchInterval:6e4}),h=k.useMemo(()=>{if(!l)return[];let f=l;if(f=f.filter(g=>ro(g,a)),s.trim()){const g=s.toLowerCase();f=f.filter(p=>{const b=p.name.toLowerCase().includes(g),y=String(p.number).includes(g),v=p.nowPlaying?.title?.toLowerCase().includes(g)??!1,_=p.group?.toLowerCase().includes(g)??!1;return b||y||v||_})}return f},[l,a,s]),u=k.useMemo(()=>{if(!l)return{};const f={all:l.length,favorites:0,news:0,sports:0,movies:0,entertainment:0,kids:0};for(const g of l)g.isFavorite&&f.favorites++,ro(g,"news")&&f.news++,ro(g,"sports")&&f.sports++,ro(g,"movies")&&f.movies++,ro(g,"kids")&&f.kids++,ro(g,"entertainment")&&f.entertainment++;return f},[l]);return o?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx(tn,{className:"h-8 w-8 animate-spin text-indigo-500"})}):d?t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-red-400 gap-3",children:[t.jsx(kt,{className:"h-10 w-10"}),t.jsx("p",{children:"Failed to load channel data"})]}):t.jsxs("div",{children:[t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[t.jsx($s,{className:"h-6 w-6 text-indigo-400"}),t.jsx("h1",{className:"text-2xl font-bold text-white",children:"On Now"})]}),t.jsx("p",{className:"text-gray-400 text-sm",children:"See what's currently airing across all your channels"})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[t.jsx("div",{className:"flex gap-2 flex-wrap flex-1",children:v6.map(f=>{const g=a===f.id,p=u[f.id]??0;return t.jsxs("button",{onClick:()=>e(f.id),className:`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${g?"bg-indigo-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700 hover:text-white"}`,children:[t.jsx(f.icon,{className:"h-4 w-4"}),f.name,t.jsx("span",{className:`ml-1 text-xs ${g?"text-indigo-200":"text-gray-500"}`,children:p})]},f.id)})}),t.jsxs("div",{className:"relative",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search channels or programs...",value:s,onChange:f=>n(f.target.value),className:"w-full sm:w-72 pl-9 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]})]}),t.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:[h.length," channel",h.length!==1?"s":"",s&&` matching "${s}"`]}),h.length===0?t.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-500 gap-2",children:[t.jsx(jt,{className:"h-8 w-8"}),t.jsx("p",{children:"No channels match your filters"})]}):t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4",children:h.map(f=>t.jsx(w6,{channel:f},f.id))})]})}const U0=a=>a?/^https?:\/\//i.test(a):!1,j6=["NFL","NBA","MLB","NHL","MLS"];function E6(){const a=at(),[e,s]=k.useState(!1),[n,i]=k.useState(null),[l,o]=k.useState(null),[d,h]=k.useState(""),[u,f]=k.useState("NFL"),{data:g,isLoading:p}=Fe({queryKey:["teamPasses"],queryFn:async()=>(await fetch("/api/teampass",{headers:{"X-Plex-Token":pe.getToken()||""}})).json()}),{data:b}=Fe({queryKey:["teamPassStats"],queryFn:async()=>(await fetch("/api/teampass/stats",{headers:{"X-Plex-Token":pe.getToken()||""}})).json()}),{data:y}=Fe({queryKey:["leagueTeams",u],queryFn:async()=>(await fetch(`/api/teampass/leagues/${u}/teams`,{headers:{"X-Plex-Token":pe.getToken()||""}})).json(),enabled:e||n!==null}),{data:v}=Fe({queryKey:["teamSearch",d],queryFn:async()=>(await fetch(`/api/teampass/teams/search?q=${encodeURIComponent(d)}`,{headers:{"X-Plex-Token":pe.getToken()||""}})).json(),enabled:d.length>=2}),{data:_}=Fe({queryKey:["teamPassUpcoming",l?.id],queryFn:async()=>(await fetch(`/api/teampass/${l.id}/upcoming`,{headers:{"X-Plex-Token":pe.getToken()||""}})).json(),enabled:l!==null}),N=Me({mutationFn:async P=>(await fetch("/api/teampass",{method:"POST",headers:{"Content-Type":"application/json","X-Plex-Token":pe.getToken()||""},body:JSON.stringify(P)})).json(),onSuccess:()=>{a.invalidateQueries({queryKey:["teamPasses"]}),a.invalidateQueries({queryKey:["teamPassStats"]}),s(!1)}}),C=Me({mutationFn:async({id:P,data:I})=>(await fetch(`/api/teampass/${P}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Plex-Token":pe.getToken()||""},body:JSON.stringify(I)})).json(),onSuccess:()=>{a.invalidateQueries({queryKey:["teamPasses"]}),i(null)}}),T=Me({mutationFn:async P=>{await fetch(`/api/teampass/${P}`,{method:"DELETE",headers:{"X-Plex-Token":pe.getToken()||""}})},onSuccess:()=>{a.invalidateQueries({queryKey:["teamPasses"]}),a.invalidateQueries({queryKey:["teamPassStats"]})}}),L=Me({mutationFn:async P=>(await fetch(`/api/teampass/${P}/toggle`,{method:"PUT",headers:{"X-Plex-Token":pe.getToken()||""}})).json(),onSuccess:()=>{a.invalidateQueries({queryKey:["teamPasses"]})}}),F=Me({mutationFn:async()=>(await fetch("/api/teampass/process",{method:"POST",headers:{"X-Plex-Token":pe.getToken()||""}})).json(),onSuccess:()=>{a.invalidateQueries({queryKey:["teamPassStats"]})}}),H=g?.teamPasses||[],B=d.length>=2?v?.teams||[]:y?.teams||[];return t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Team Pass"}),t.jsx("p",{className:"text-gray-400",children:"Auto-record games for your favorite sports teams"})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("button",{onClick:()=>F.mutate(),disabled:F.isPending,className:"flex items-center gap-2 px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors",children:[F.isPending?t.jsx(tn,{className:"w-4 h-4 animate-spin"}):t.jsx(sn,{className:"w-4 h-4"}),"Process Now"]}),t.jsxs("button",{onClick:()=>s(!0),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500 transition-colors",children:[t.jsx(Pt,{className:"w-4 h-4"}),"Add Team"]})]})]}),b&&t.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[t.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 text-orange-400",children:[t.jsx(ti,{className:"w-5 h-5"}),t.jsx("span",{className:"text-2xl font-bold",children:b.totalPasses})]}),t.jsx("p",{className:"text-sm text-gray-400",children:"Team Passes"})]}),t.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 text-green-400",children:[t.jsx(m0,{className:"w-5 h-5"}),t.jsx("span",{className:"text-2xl font-bold",children:b.activePasses})]}),t.jsx("p",{className:"text-sm text-gray-400",children:"Active"})]}),t.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 text-blue-400",children:[t.jsx(sn,{className:"w-5 h-5"}),t.jsx("span",{className:"text-2xl font-bold",children:b.upcomingGames})]}),t.jsx("p",{className:"text-sm text-gray-400",children:"Upcoming Games"})]}),t.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 text-red-400",children:[t.jsx(Kt,{className:"w-5 h-5"}),t.jsx("span",{className:"text-2xl font-bold",children:b.scheduledRecordings})]}),t.jsx("p",{className:"text-sm text-gray-400",children:"Scheduled"})]})]}),p?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx(tn,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):H.length===0?t.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-lg",children:[t.jsx(ti,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No Team Passes"}),t.jsx("p",{className:"text-gray-400 mb-4",children:"Add your favorite teams to automatically record their games"}),t.jsx("button",{onClick:()=>s(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500",children:"Add Your First Team"})]}):t.jsx("div",{className:"grid gap-4",children:H.map(P=>t.jsxs("div",{className:`bg-gray-800 rounded-lg p-4 border-l-4 ${P.enabled?"border-green-500":"border-gray-600"}`,children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:`w-12 h-12 rounded-lg ${bo(P.league)} flex items-center justify-center overflow-hidden`,children:U0(P.logoUrl)?t.jsx("img",{src:P.logoUrl,alt:P.teamName,className:"w-10 h-10 object-contain"}):t.jsx(ti,{className:"w-6 h-6 text-white"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-white",children:P.teamName}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[t.jsx("span",{className:`px-2 py-0.5 rounded ${bo(P.league)} text-white text-xs`,children:P.league}),P.upcomingCount!==void 0&&P.upcomingCount>0&&t.jsxs("span",{className:"text-blue-400",children:[P.upcomingCount," upcoming game",P.upcomingCount!==1?"s":""]})]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>o(P),className:"p-2 text-gray-400 hover:text-blue-400 transition-colors",title:"View upcoming games",children:t.jsx(sn,{className:"w-5 h-5"})}),t.jsx("button",{onClick:()=>L.mutate(P.id),className:`p-2 transition-colors ${P.enabled?"text-green-400 hover:text-green-300":"text-gray-500 hover:text-gray-400"}`,title:P.enabled?"Disable":"Enable",children:t.jsx(m0,{className:"w-5 h-5"})}),t.jsx("button",{onClick:()=>i(P),className:"p-2 text-gray-400 hover:text-white transition-colors",title:"Edit",children:t.jsx(an,{className:"w-5 h-5"})}),t.jsx("button",{onClick:()=>{confirm(`Delete team pass for ${P.teamName}?`)&&T.mutate(P.id)},className:"p-2 text-gray-400 hover:text-red-400 transition-colors",title:"Delete",children:t.jsx(Dt,{className:"w-5 h-5"})})]})]}),t.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-700 flex gap-6 text-sm text-gray-400",children:[t.jsxs("span",{children:["Pre-padding: ",P.prePadding,"m"]}),t.jsxs("span",{children:["Post-padding: ",P.postPadding,"m"]}),P.keepCount>0&&t.jsxs("span",{children:["Keep: ",P.keepCount," recordings"]})]})]},P.id))}),(e||n)&&t.jsx(T6,{pass:n,teams:B,selectedLeague:u,onLeagueChange:f,teamSearch:d,onTeamSearchChange:h,onClose:()=>{s(!1),i(null),h("")},onSave:P=>{n?C.mutate({id:n.id,data:P}):N.mutate(P)},isLoading:N.isPending||C.isPending}),l&&_&&t.jsx(A6,{teamPass:l,games:_.games||[],onClose:()=>o(null)})]})}function T6({pass:a,teams:e,selectedLeague:s,onLeagueChange:n,teamSearch:i,onTeamSearchChange:l,onClose:o,onSave:d,isLoading:h}){const[u,f]=k.useState({teamName:a?.teamName||"",league:a?.league||s,logoUrl:a?.logoUrl||"",prePadding:a?.prePadding??5,postPadding:a?.postPadding??60,keepCount:a?.keepCount??0,priority:a?.priority??0,enabled:a?.enabled??!0}),g=b=>{b.preventDefault(),d(u)},p=b=>{f({...u,teamName:b.name,league:b.league,logoUrl:b.logoUrl||""}),l("")};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",children:t.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-lg p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h2",{className:"text-xl font-bold text-white",children:a?"Edit Team Pass":"Add Team Pass"}),t.jsx("button",{onClick:o,className:"text-gray-400 hover:text-white",children:t.jsx(nt,{className:"w-6 h-6"})})]}),t.jsxs("form",{onSubmit:g,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Team"}),u.teamName?t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-700 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`w-10 h-10 rounded ${bo(u.league)} flex items-center justify-center overflow-hidden`,children:U0(u.logoUrl)?t.jsx("img",{src:u.logoUrl,alt:u.teamName,className:"w-8 h-8 object-contain"}):t.jsx(ti,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-white font-medium",children:u.teamName}),t.jsx("p",{className:"text-sm text-gray-400",children:u.league})]})]}),t.jsx("button",{type:"button",onClick:()=>f({...u,teamName:"",league:s,logoUrl:""}),className:"text-gray-400 hover:text-white",children:t.jsx(nt,{className:"w-5 h-5"})})]}):t.jsxs("div",{children:[t.jsx("div",{className:"flex gap-2 mb-3",children:j6.map(b=>t.jsx("button",{type:"button",onClick:()=>{n(b),f({...u,league:b})},className:`px-3 py-1.5 rounded text-sm font-medium transition-colors ${s===b?bo(b)+" text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:b},b))}),t.jsxs("div",{className:"relative mb-3",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),t.jsx("input",{type:"text",value:i,onChange:b=>l(b.target.value),placeholder:"Search teams...",className:"w-full pl-9 pr-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500"})]}),t.jsx("div",{className:"max-h-48 overflow-y-auto grid grid-cols-2 gap-2",children:e.map(b=>t.jsxs("button",{type:"button",onClick:()=>p(b),className:"p-2 bg-gray-700 rounded hover:bg-gray-600 text-left transition-colors flex items-center gap-2",children:[t.jsx("div",{className:`w-8 h-8 rounded ${bo(b.league)} flex items-center justify-center overflow-hidden flex-shrink-0`,children:U0(b.logoUrl)?t.jsx("img",{src:b.logoUrl,alt:b.name,className:"w-6 h-6 object-contain"}):t.jsx(ti,{className:"w-4 h-4 text-white"})}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("p",{className:"text-white text-sm font-medium truncate",children:b.name}),t.jsx("p",{className:"text-xs text-gray-400 truncate",children:b.city})]})]},b.name))})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Start Early (minutes)"}),t.jsx("input",{type:"number",value:u.prePadding,onChange:b=>f({...u,prePadding:parseInt(b.target.value)||0}),min:0,max:60,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Extend (minutes)"}),t.jsx("input",{type:"number",value:u.postPadding,onChange:b=>f({...u,postPadding:parseInt(b.target.value)||0}),min:0,max:120,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Extra time for overtime"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Keep Last N Recordings (0 = unlimited)"}),t.jsx("input",{type:"number",value:u.keepCount,onChange:b=>f({...u,keepCount:parseInt(b.target.value)||0}),min:0,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500"})]}),t.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[t.jsx("button",{type:"button",onClick:o,className:"px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600",children:"Cancel"}),t.jsxs("button",{type:"submit",disabled:!u.teamName||h,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[h&&t.jsx(tn,{className:"w-4 h-4 animate-spin"}),a?"Save Changes":"Add Team Pass"]})]})]})]})})}function A6({teamPass:a,games:e,onClose:s}){return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",children:t.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-2xl max-h-[80vh] flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-700",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold text-white",children:a.teamName}),t.jsx("p",{className:"text-sm text-gray-400",children:"Upcoming Games"})]}),t.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white",children:t.jsx(nt,{className:"w-6 h-6"})})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(sn,{className:"w-12 h-12 text-gray-600 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-400",children:"No upcoming games found"})]}):t.jsx("div",{className:"space-y-3",children:e.map((n,i)=>t.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-white",children:n.program.title}),n.program.teams&&t.jsx("p",{className:"text-sm text-gray-300",children:n.program.teams})]}),n.program.league&&t.jsx("span",{className:`px-2 py-0.5 rounded text-xs text-white ${bo(n.program.league)}`,children:n.program.league})]}),t.jsxs("div",{className:"mt-2 flex items-center gap-4 text-sm text-gray-400",children:[t.jsx("span",{className:"text-blue-400",children:C6(n.program.start)}),n.channel&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(jt,{className:"w-3 h-3"}),n.channel.name]})]})]},i))})})]})})}function bo(a){switch(a?.toUpperCase()){case"NFL":return"bg-blue-600";case"NBA":return"bg-orange-600";case"MLB":return"bg-red-600";case"NHL":return"bg-gray-600";case"MLS":return"bg-green-600";default:return"bg-purple-600"}}function C6(a){const e=new Date(a),s=new Date,n=new Date(s);n.setDate(n.getDate()+1);const i=e.toDateString()===s.toDateString(),l=e.toDateString()===n.toDateString(),o=e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return i?`Today ${o}`:l?`Tomorrow ${o}`:e.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"})+` ${o}`}function k6(a){if(!a)return"";const e=Math.floor(a/60),s=a%60;return e>0?s>0?`${e}h ${s}m`:`${e}h`:`${s}m`}function R6(a){return new Date(a).toLocaleDateString([],{month:"short",day:"numeric",year:"numeric"})}function L6(a){if(!a)return null;const e=a.toLowerCase();return e.includes("2160")||e.includes("4k")||e.includes("uhd")?"4K":e.includes("1080")||e.includes("720")?"HD":e.includes("480")?"SD":null}function D6(a){if(!a)return null;const e=a.toLowerCase();return e.includes("eac3")||e.includes("e-ac-3")?"Dolby Digital+":e.includes("ac3")||e.includes("ac-3")?"Dolby Digital":e.includes("atmos")?"Atmos":e.includes("dts")?"DTS":e.includes("aac")?"AAC":null}function M6({recording:a,onClose:e,onSelect:s}){return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(yl,{className:"w-5 h-5 text-red-400 animate-pulse"}),t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Now Recording"})]}),t.jsx("button",{onClick:e,className:"p-1 text-gray-400 hover:text-white",children:t.jsx(nt,{className:"w-5 h-5"})})]}),t.jsx("p",{className:"text-gray-300 mb-2",children:a.title}),t.jsx("p",{className:"text-gray-500 text-sm mb-6",children:"This recording is currently in progress. How would you like to watch it?"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("button",{onClick:()=>s("start"),className:"w-full p-4 rounded-lg border border-gray-600 bg-gray-700 hover:border-indigo-500 hover:bg-gray-600 transition-colors text-left",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-indigo-500/20 rounded-lg",children:t.jsx(J1,{className:"w-5 h-5 text-indigo-400"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-white",children:"Watch from Start"}),t.jsx("p",{className:"text-sm text-gray-400",children:"Begin playback from the beginning"})]})]})}),t.jsx("button",{onClick:()=>s("live"),className:"w-full p-4 rounded-lg border border-gray-600 bg-gray-700 hover:border-red-500 hover:bg-gray-600 transition-colors text-left",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-red-500/20 rounded-lg",children:t.jsx($s,{className:"w-5 h-5 text-red-400"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-white",children:"Watch Live"}),t.jsx("p",{className:"text-sm text-gray-400",children:"Jump to the current live position"})]})]})})]}),t.jsx("button",{onClick:e,className:"w-full mt-4 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg",children:"Cancel"})]})})}function I6({recording:a,onResume:e,onStartOver:s}){const n=i=>{const l=Math.floor(i/1e3),o=Math.floor(l/3600),d=Math.floor(l%3600/60),h=l%60;return o>0?`${o}:${d.toString().padStart(2,"0")}:${h.toString().padStart(2,"0")}`:`${d}:${h.toString().padStart(2,"0")}`};return t.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/70",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx(xs,{className:"w-6 h-6 text-indigo-400"}),t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Resume Playback?"})]}),t.jsx("p",{className:"text-gray-300 mb-2",children:a.title}),t.jsxs("p",{className:"text-gray-500 text-sm mb-6",children:["You were watching at ",n(a.viewOffset||0),". Would you like to continue?"]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("button",{onClick:e,className:"w-full p-4 rounded-lg border border-indigo-500 bg-indigo-500/20 hover:bg-indigo-500/30 transition-colors text-left",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-indigo-500/30 rounded-lg",children:t.jsx(xs,{className:"w-5 h-5 text-indigo-400"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-white",children:"Resume"}),t.jsxs("p",{className:"text-sm text-gray-400",children:["Continue from ",n(a.viewOffset||0)]})]})]})}),t.jsx("button",{onClick:s,className:"w-full p-4 rounded-lg border border-gray-600 bg-gray-700 hover:border-gray-500 hover:bg-gray-600 transition-colors text-left",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-gray-600 rounded-lg",children:t.jsx(J1,{className:"w-5 h-5 text-gray-400"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-white",children:"Start Over"}),t.jsx("p",{className:"text-sm text-gray-400",children:"Watch from the beginning"})]})]})})]})]})})}function P6({recording:a,onClose:e,startLive:s=!1}){const n=k.useRef(null),i=k.useRef(null),[l,o]=k.useState(!1),[d,h]=k.useState(0),[u,f]=k.useState(0),[g,p]=k.useState(!1),[b,y]=k.useState(!0),[v,_]=k.useState(null),[N,C]=k.useState(new Set),[T,L]=k.useState(!0),F=k.useRef(null),[H,B]=k.useState(!1),[P,I]=k.useState(null),D=k.useRef(null),O=k.useRef(0),{data:ee,isLoading:ie}=Fe({queryKey:["recording-stream",a.id],queryFn:()=>pe.getRecordingStreamUrl(a.id)}),{data:Z}=Fe({queryKey:["recording-commercials",a.id],queryFn:()=>pe.getRecordingCommercials(a.id)}),z=Z?.segments||[];k.useEffect(()=>{a.viewOffset&&a.viewOffset>1e4&&!s&&a.status==="completed"&&B(!0)},[a.viewOffset,s,a.status]),k.useEffect(()=>{const ye=()=>{const Ee=n.current;if(!Ee||a.status!=="completed")return;const re=Math.floor(Ee.currentTime*1e3);Math.abs(re-O.current)>5e3&&(O.current=re,pe.updateRecordingProgress(a.id,re).catch(()=>{}))};return D.current=window.setInterval(ye,15e3),()=>{const Ee=n.current;if(Ee&&a.status==="completed"){const re=Math.floor(Ee.currentTime*1e3);pe.updateRecordingProgress(a.id,re).catch(()=>{})}D.current&&clearInterval(D.current)}},[a.id,a.status]),k.useEffect(()=>{const ye=n.current;ye&&P!==null&&u>0&&(ye.currentTime=P,I(null))},[P,u]),k.useEffect(()=>{const ye=n.current;if(!ye||!ee)return;const Ee=localStorage.getItem("token");if(ee.includes(".m3u8"))if(Ns.isSupported()){const re=new Ns({enableWorker:!0,lowLatencyMode:!1,xhrSetup:fe=>{Ee&&fe.setRequestHeader("Authorization",`Bearer ${Ee}`)}});i.current=re,re.loadSource(ee),re.attachMedia(ye),re.on(Ns.Events.MANIFEST_PARSED,()=>{ye.play().catch(()=>{})}),re.on(Ns.Events.ERROR,(fe,Le)=>{Le.fatal&&(Le.type===Ns.ErrorTypes.NETWORK_ERROR?re.startLoad():Le.type===Ns.ErrorTypes.MEDIA_ERROR&&re.recoverMediaError())})}else ye.canPlayType("application/vnd.apple.mpegurl")&&(ye.src=ee,ye.play().catch(()=>{}));else ye.src=ee,ye.play().catch(()=>{});return()=>{i.current&&(i.current.destroy(),i.current=null)}},[ee]);const X=k.useCallback(ye=>z.find(Ee=>ye>=Ee.startTime&&ye<Ee.endTime)||null,[z]);k.useEffect(()=>{const ye=n.current;if(!ye)return;const Ee=()=>{const ze=ye.currentTime;h(ze);const Xe=X(ze);_(Xe),Xe&&b&&!N.has(Xe.id)&&(C(ue=>new Set(ue).add(Xe.id)),ye.currentTime=Xe.endTime)},re=()=>f(ye.duration),fe=()=>o(!0),Le=()=>o(!1);return ye.addEventListener("timeupdate",Ee),ye.addEventListener("durationchange",re),ye.addEventListener("play",fe),ye.addEventListener("pause",Le),()=>{ye.removeEventListener("timeupdate",Ee),ye.removeEventListener("durationchange",re),ye.removeEventListener("play",fe),ye.removeEventListener("pause",Le)}},[b,N,X]),k.useEffect(()=>(T&&l&&(F.current&&clearTimeout(F.current),F.current=window.setTimeout(()=>L(!1),3e3)),()=>{F.current&&clearTimeout(F.current)}),[T,l]),k.useEffect(()=>{s&&u>0&&n.current&&(n.current.currentTime=Math.max(0,u-10))},[s,u]);const ae=a.status==="recording",te=()=>{n.current&&u>0&&(n.current.currentTime=Math.max(0,u-5))},W=()=>L(!0),K=()=>{const ye=n.current;ye&&(l?ye.pause():ye.play())},q=()=>{v&&n.current&&(C(ye=>new Set(ye).add(v.id)),n.current.currentTime=v.endTime)},J=ye=>{n.current&&(n.current.currentTime=ye,C(new Set))},oe=ye=>{const Ee=Math.floor(ye/3600),re=Math.floor(ye%3600/60),fe=Math.floor(ye%60);return Ee>0?`${Ee}:${re.toString().padStart(2,"0")}:${fe.toString().padStart(2,"0")}`:`${re}:${fe.toString().padStart(2,"0")}`},be=()=>{const ye=document.getElementById("dvr-player-container");ye&&(document.fullscreenElement?document.exitFullscreen():ye.requestFullscreen())};return t.jsxs("div",{className:"fixed inset-0 z-50 bg-black",children:[t.jsxs("div",{id:"dvr-player-container",className:"relative w-full h-full",onMouseMove:W,onClick:W,children:[ie?t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsx(Ke,{className:"w-12 h-12 text-white animate-spin"})}):ee?t.jsx("video",{ref:n,className:"w-full h-full object-contain",muted:g}):t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsx("p",{className:"text-red-400",children:"Failed to load video"})}),v&&!b&&t.jsxs("button",{onClick:q,className:"absolute bottom-32 right-8 px-6 py-3 bg-yellow-500 hover:bg-yellow-400 text-black font-semibold rounded-lg flex items-center gap-2 transition-colors",children:[t.jsx(Vh,{className:"w-5 h-5"}),t.jsxs("div",{children:[t.jsx("div",{children:"Skip Ad"}),t.jsxs("div",{className:"text-xs opacity-75",children:[Math.ceil(v.endTime-d),"s remaining"]})]})]}),v&&b&&t.jsx("div",{className:"absolute bottom-32 right-8 px-4 py-2 bg-indigo-600 text-white rounded-lg",children:"Skipping commercial..."}),t.jsxs("div",{className:`absolute inset-0 transition-opacity duration-300 ${T?"opacity-100":"opacity-0 pointer-events-none"}`,children:[t.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/80 to-transparent",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("button",{onClick:e,className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",children:t.jsx(nt,{className:"w-6 h-6"})}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("h2",{className:"text-xl font-semibold text-white",children:a.title}),ae&&t.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 bg-red-500 text-white text-xs font-bold rounded animate-pulse",children:[t.jsx(yl,{className:"w-3 h-3"}),"LIVE"]})]}),a.episodeNum&&t.jsx("p",{className:"text-sm text-gray-300",children:a.episodeNum})]})]}),z.length>0&&t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("span",{className:"text-sm text-yellow-400",children:[z.length," commercial break",z.length>1?"s":""," detected"]}),t.jsxs("button",{onClick:()=>y(!b),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${b?"bg-green-500/20 text-green-400 hover:bg-green-500/30":"bg-gray-500/20 text-gray-400 hover:bg-gray-500/30"}`,children:[b?t.jsx(Pc,{className:"w-4 h-4"}):t.jsx(Ic,{className:"w-4 h-4"}),"Auto-Skip ",b?"ON":"OFF"]})]})]})}),t.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent",children:[t.jsx("div",{className:"relative mb-4",children:t.jsxs("div",{className:"relative h-2 bg-white/30 rounded-full cursor-pointer group",onClick:ye=>{const Ee=ye.currentTarget.getBoundingClientRect();J((ye.clientX-Ee.left)/Ee.width*u)},children:[z.map(ye=>{const Ee=ye.startTime/u*100,re=(ye.endTime-ye.startTime)/u*100;return t.jsx("div",{className:"absolute top-0 h-full bg-yellow-500/80",style:{left:`${Ee}%`,width:`${Math.max(re,.5)}%`}},ye.id)}),t.jsx("div",{className:"absolute top-0 left-0 h-full bg-indigo-500 rounded-full",style:{width:`${d/u*100}%`}}),t.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 w-4 h-4 bg-white rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",style:{left:`calc(${d/u*100}% - 8px)`}})]})}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("button",{onClick:K,className:"p-3 bg-white/20 hover:bg-white/30 rounded-full transition-colors",children:l?t.jsx(Bi,{className:"w-6 h-6 text-white"}):t.jsx(xs,{className:"w-6 h-6 text-white"})}),t.jsx("button",{onClick:()=>p(!g),className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",children:g?t.jsx(mp,{className:"w-5 h-5"}):t.jsx(fp,{className:"w-5 h-5"})}),t.jsxs("span",{className:"text-sm text-white",children:[oe(d)," / ",oe(u)]}),ae&&t.jsxs("button",{onClick:te,className:"flex items-center gap-1.5 px-3 py-1.5 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-lg text-sm font-medium transition-colors",children:[t.jsx($s,{className:"w-4 h-4"}),"LIVE"]})]}),t.jsx("button",{onClick:be,className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",children:t.jsx(up,{className:"w-5 h-5"})})]})]})]})]}),H&&t.jsx(I6,{recording:a,onResume:()=>{B(!1),a.viewOffset&&I(a.viewOffset/1e3)},onStartOver:()=>{B(!1),pe.updateRecordingProgress(a.id,0).catch(()=>{})}})]})}const $g={show:{label:"Shows",icon:jt},movie:{label:"Movies",icon:Gt},video:{label:"Videos",icon:Nn},image:{label:"Images",icon:Oi},unmatched:{label:"Unmatched",icon:e4}};function O6({recording:a,isSelected:e,onToggleSelect:s,onPlay:n,onToggleWatched:i,onToggleFavorite:l,onToggleKeep:o,onTrash:d,onFixMatch:h}){const[u,f]=k.useState(!1),g=a.isWatched,p=a.thumb||a.art||a.channelLogo,b=L6(a.videoResolution),y=D6(a.audioCodec),v=k.useMemo(()=>{if(!a.viewOffset||!a.duration)return 0;const _=a.duration*6e4;return Math.min(100,a.viewOffset/_*100)},[a.viewOffset,a.duration]);return t.jsx("div",{className:`relative group border rounded-lg transition-all duration-200 ${e?"border-indigo-500 bg-indigo-500/5":g?"border-gray-700/50 bg-gray-800/50":"border-gray-700 bg-gray-800"} ${g?"opacity-60 hover:opacity-100":""}`,children:t.jsxs("div",{className:"flex gap-0",children:[t.jsxs("div",{className:"relative flex-shrink-0 w-44 h-28 sm:w-52 sm:h-32 bg-gray-900 rounded-l-lg overflow-hidden cursor-pointer",onClick:n,children:[p?t.jsx("img",{src:p,alt:a.title,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx(Nn,{className:"w-10 h-10 text-gray-700"})}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/0 group-hover:bg-black/40 transition-colors",children:t.jsx("div",{className:"w-10 h-10 flex items-center justify-center rounded-full bg-white/90 opacity-0 group-hover:opacity-100 transition-opacity shadow-lg",children:t.jsx(xs,{className:"w-5 h-5 text-gray-900 ml-0.5"})})}),v>0&&v<90&&t.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-black/60",children:t.jsx("div",{className:"h-full bg-indigo-500",style:{width:`${v}%`}})}),t.jsx("button",{onClick:_=>{_.stopPropagation(),s()},className:"absolute top-2 left-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e?t.jsx(nw,{className:"w-5 h-5 text-indigo-400 drop-shadow-lg"}):t.jsx(iw,{className:"w-5 h-5 text-white/80 drop-shadow-lg hover:text-white"})}),a.keepForever&&t.jsx("div",{className:"absolute top-2 right-2",children:t.jsx(Xu,{className:"w-4 h-4 text-yellow-400 drop-shadow-lg"})})]}),t.jsxs("div",{className:"flex-1 min-w-0 p-3 flex flex-col justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("h4",{className:`font-semibold truncate ${g?"text-gray-400":"text-white"}`,children:a.title}),a.subtitle&&t.jsx("p",{className:"text-sm text-gray-400 truncate",children:a.subtitle})]}),t.jsxs("div",{className:"flex-shrink-0 text-right text-xs text-gray-500 hidden sm:block",children:[t.jsx("div",{children:R6(a.createdAt)}),a.duration&&t.jsx("div",{children:k6(a.duration)}),a.channelName&&t.jsxs("div",{className:"text-gray-600",children:["Ch ",a.channelName]})]})]}),a.episodeNum&&t.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:a.episodeNum}),t.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 mt-1.5",children:[b&&t.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-bold bg-gray-700 text-gray-300 rounded",children:b}),y&&t.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-medium bg-gray-700 text-gray-300 rounded",children:y}),a.hasCC&&t.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-medium bg-gray-700 text-gray-300 rounded",children:"CC"}),a.hasDVS&&t.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-medium bg-gray-700 text-gray-300 rounded",children:"DVS"}),a.contentRating&&t.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-medium border border-gray-600 text-gray-400 rounded",children:a.contentRating}),a.isFavorite&&t.jsx(Di,{className:"w-3.5 h-3.5 text-yellow-400 fill-yellow-400"}),a.isWatched&&t.jsxs("span",{className:"px-1.5 py-0.5 text-[10px] font-medium bg-green-500/20 text-green-400 rounded flex items-center gap-0.5",children:[t.jsx(Xt,{className:"w-3 h-3"})," Watched"]})]}),(a.summary||a.description)&&t.jsx("p",{className:"text-xs text-gray-500 line-clamp-2 mt-1.5 leading-relaxed hidden md:block",children:a.summary||a.description})]}),t.jsxs("div",{className:"flex items-center gap-1 mt-2 -mb-1",children:[h&&t.jsxs("button",{onClick:h,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium bg-yellow-500/10 text-yellow-400 hover:bg-yellow-500/20 rounded-md transition-colors",title:"Fix metadata match",children:[t.jsx(xt,{className:"w-3.5 h-3.5"}),"Fix Match"]}),t.jsx("button",{onClick:i,className:`p-1.5 rounded-md transition-colors ${a.isWatched?"text-green-400 hover:bg-green-500/10":"text-gray-500 hover:text-gray-300 hover:bg-gray-700"}`,title:a.isWatched?"Mark as Unwatched":"Mark as Watched",children:a.isWatched?t.jsx(Pi,{className:"w-4 h-4"}):t.jsx(fo,{className:"w-4 h-4"})}),t.jsx("button",{onClick:l,className:`p-1.5 rounded-md transition-colors ${a.isFavorite?"text-yellow-400 hover:bg-yellow-500/10":"text-gray-500 hover:text-gray-300 hover:bg-gray-700"}`,title:a.isFavorite?"Remove from Favorites":"Add to Favorites",children:t.jsx(Di,{className:`w-4 h-4 ${a.isFavorite?"fill-yellow-400":""}`})}),t.jsx("button",{onClick:o,className:`p-1.5 rounded-md transition-colors ${a.keepForever?"text-blue-400 hover:bg-blue-500/10":"text-gray-500 hover:text-gray-300 hover:bg-gray-700"}`,title:a.keepForever?"Remove Keep Forever":"Keep Forever",children:t.jsx(Xu,{className:"w-4 h-4"})}),t.jsx("button",{onClick:d,className:"p-1.5 text-gray-500 hover:text-red-400 hover:bg-red-500/10 rounded-md transition-colors",title:"Move to Trash",children:t.jsx(Dt,{className:"w-4 h-4"})}),t.jsxs("div",{className:"relative ml-auto",children:[t.jsx("button",{onClick:()=>f(!u),className:"p-1.5 text-gray-500 hover:text-gray-300 hover:bg-gray-700 rounded-md transition-colors",children:t.jsx(KC,{className:"w-4 h-4"})}),u&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>f(!1)}),t.jsxs("div",{className:"absolute right-0 bottom-full mb-1 w-48 bg-gray-700 rounded-lg shadow-xl border border-gray-600 py-1 z-20",children:[t.jsxs("button",{onClick:()=>{n(),f(!1)},className:"w-full px-3 py-2 text-left text-sm text-gray-200 hover:bg-gray-600 flex items-center gap-2",children:[t.jsx(xs,{className:"w-4 h-4"})," Play"]}),t.jsxs("button",{onClick:()=>{i(),f(!1)},className:"w-full px-3 py-2 text-left text-sm text-gray-200 hover:bg-gray-600 flex items-center gap-2",children:[a.isWatched?t.jsx(fo,{className:"w-4 h-4"}):t.jsx(Pi,{className:"w-4 h-4"}),a.isWatched?"Mark Unwatched":"Mark Watched"]}),t.jsxs("button",{onClick:()=>{l(),f(!1)},className:"w-full px-3 py-2 text-left text-sm text-gray-200 hover:bg-gray-600 flex items-center gap-2",children:[t.jsx(Di,{className:"w-4 h-4"}),a.isFavorite?"Remove Favorite":"Add Favorite"]}),t.jsxs("button",{onClick:()=>{o(),f(!1)},className:"w-full px-3 py-2 text-left text-sm text-gray-200 hover:bg-gray-600 flex items-center gap-2",children:[t.jsx(Xu,{className:"w-4 h-4"}),a.keepForever?"Remove Keep Forever":"Keep Forever"]}),t.jsx("div",{className:"border-t border-gray-600 my-1"}),t.jsxs("button",{onClick:()=>{const _=pe.getRecordingEDLUrl(a.id);window.open(_,"_blank"),f(!1)},className:"w-full px-3 py-2 text-left text-sm text-gray-200 hover:bg-gray-600 flex items-center gap-2",title:"Download EDL file for use with Kodi, MPC-HC, and other players",children:[t.jsx(gs,{className:"w-4 h-4"})," Export EDL"]}),t.jsxs("button",{onClick:()=>{const _=pe.getRecordingEDLUrl(a.id,"mplayer");window.open(_,"_blank"),f(!1)},className:"w-full px-3 py-2 text-left text-sm text-gray-200 hover:bg-gray-600 flex items-center gap-2",title:"Download MPlayer-format EDL file",children:[t.jsx(gs,{className:"w-4 h-4"})," Export EDL (MPlayer)"]}),t.jsx("div",{className:"border-t border-gray-600 my-1"}),t.jsxs("button",{onClick:()=>{d(),f(!1)},className:"w-full px-3 py-2 text-left text-sm text-red-400 hover:bg-gray-600 flex items-center gap-2",children:[t.jsx(Dt,{className:"w-4 h-4"})," Move to Trash"]})]})]})]})]})]})]})})}function Gu({value:a,options:e,onChange:s}){return t.jsxs("div",{className:"relative",children:[t.jsx("select",{value:a,onChange:n=>s(n.target.value),className:"appearance-none bg-gray-700 border border-gray-600 text-gray-200 text-sm rounded-lg pl-3 pr-8 py-2 cursor-pointer hover:border-gray-500 focus:outline-none focus:border-indigo-500",children:e.map(n=>t.jsx("option",{value:n.value,children:n.label},n.value))}),t.jsx(Pn,{className:"absolute right-2 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"})]})}function F6(){const a=at(),[e,s]=k.useState("show"),[n,i]=k.useState(""),[l,o]=k.useState("date_added"),[d,h]=k.useState("desc"),[u,f]=k.useState(""),[g,p]=k.useState(""),[b,y]=k.useState(""),[v,_]=k.useState(new Set),[N,C]=k.useState(null),[T,L]=k.useState(!1),[F,H]=k.useState(null),[B,P]=k.useState(!1),[I,D]=k.useState(null),[O,ee]=k.useState(""),{data:ie,isLoading:Z}=Fe({queryKey:["recordings-manager",e,l,d,n,u,g,b],queryFn:()=>pe.getRecordingsManager({contentType:e,sortBy:l,sortDir:d,search:n||void 0,showTitle:u||void 0,contentRating:g||void 0,watched:b||void 0}),staleTime:15e3}),z=ie?.recordings||[],X=ie?.showTitles||[],ae=ie?.contentRatings||[],te=Me({mutationFn:Ie=>pe.toggleRecordingWatched(Ie),onSuccess:()=>a.invalidateQueries({queryKey:["recordings-manager"]})}),W=Me({mutationFn:Ie=>pe.toggleRecordingFavorite(Ie),onSuccess:()=>a.invalidateQueries({queryKey:["recordings-manager"]})}),K=Me({mutationFn:Ie=>pe.toggleRecordingKeep(Ie),onSuccess:()=>a.invalidateQueries({queryKey:["recordings-manager"]})}),q=Me({mutationFn:Ie=>pe.trashRecording(Ie),onSuccess:()=>{a.invalidateQueries({queryKey:["recordings-manager"]}),a.invalidateQueries({queryKey:["recordings"]})}}),J=Me({mutationFn:({ids:Ie,action:Lt})=>pe.bulkRecordingAction(Ie,Lt),onSuccess:()=>{a.invalidateQueries({queryKey:["recordings-manager"]}),a.invalidateQueries({queryKey:["recordings"]}),_(new Set)}}),{data:oe,isLoading:be}=Fe({queryKey:["tmdb-fix-match",I?.id,O],queryFn:()=>pe.searchTMDB(O,I?.isMovie?"movie":"tv"),enabled:!!I&&O.length>2}),ye=Me({mutationFn:Ie=>pe.applyRecordingMatch(Ie.id,Ie.result.id,Ie.result.media_type,Ie.result.title,Ie.result.poster_path,Ie.result.backdrop_path),onSuccess:()=>{a.invalidateQueries({queryKey:["recordings-manager"]}),D(null),ee("")}}),Ee=z.length>0&&v.size===z.length,re=v.size>0,fe=()=>{_(Ee?new Set:new Set(z.map(Ie=>Ie.id)))},Le=Ie=>{_(Lt=>{const Ht=new Set(Lt);return Ht.has(Ie)?Ht.delete(Ie):Ht.add(Ie),Ht})},ze=Ie=>{const Lt=Array.from(v);Lt.length!==0&&(Ie==="delete"&&!confirm(`Move ${Lt.length} recording${Lt.length>1?"s":""} to trash?`)||(J.mutate({ids:Lt,action:Ie}),P(!1)))},Xe=Ie=>{Ie.status==="recording"?H(Ie):(L(!1),C(Ie))},{data:ue}=Fe({queryKey:["rec-count-show"],queryFn:()=>pe.getRecordingsManager({contentType:"show"}),select:Ie=>Ie.totalCount,staleTime:3e4}),{data:Ge}=Fe({queryKey:["rec-count-movie"],queryFn:()=>pe.getRecordingsManager({contentType:"movie"}),select:Ie=>Ie.totalCount,staleTime:3e4}),{data:Ve}=Fe({queryKey:["rec-count-video"],queryFn:()=>pe.getRecordingsManager({contentType:"video"}),select:Ie=>Ie.totalCount,staleTime:3e4}),{data:bt}=Fe({queryKey:["rec-count-image"],queryFn:()=>pe.getRecordingsManager({contentType:"image"}),select:Ie=>Ie.totalCount,staleTime:3e4}),{data:We}=Fe({queryKey:["rec-count-unmatched"],queryFn:()=>pe.getRecordingsManager({contentType:"unmatched"}),select:Ie=>Ie.totalCount,staleTime:3e4}),ot={show:ue,movie:Ge,video:Ve,image:bt,unmatched:We};return t.jsxs("div",{className:"flex gap-0 -m-6 min-h-[calc(100vh-4rem)]",children:[t.jsxs("div",{className:"w-56 flex-shrink-0 bg-gray-900/50 border-r border-gray-700/50 p-4",children:[t.jsx("h2",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3 px-2",children:"Manage"}),t.jsx("nav",{className:"space-y-0.5",children:Object.keys($g).map(Ie=>{const Lt=$g[Ie],Ht=Lt.icon,As=e===Ie,Cs=ot[Ie];return t.jsxs("button",{onClick:()=>{s(Ie),_(new Set),f(""),p("")},className:`w-full flex items-center justify-between px-3 py-2 rounded-lg text-sm transition-colors ${As?"bg-indigo-600 text-white":"text-gray-400 hover:text-white hover:bg-gray-800"}`,children:[t.jsxs("div",{className:"flex items-center gap-2.5",children:[t.jsx(Ht,{className:"w-4 h-4"}),t.jsx("span",{children:Lt.label})]}),Cs!==void 0&&Cs>0&&t.jsx("span",{className:`text-xs ${As?"text-indigo-200":"text-gray-600"}`,children:Cs})]},Ie)})})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"sticky top-0 z-10 bg-gray-900/95 backdrop-blur-sm border-b border-gray-700/50 px-4 py-3",children:t.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[t.jsx("button",{onClick:fe,className:"flex items-center gap-2 text-sm text-gray-400 hover:text-white transition-colors",title:"Select All",children:Ee?t.jsx(nw,{className:"w-4 h-4 text-indigo-400"}):re?t.jsx("div",{className:"w-4 h-4 border-2 border-indigo-400 rounded bg-indigo-400/30"}):t.jsx(iw,{className:"w-4 h-4"})}),re&&t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>P(!B),className:"flex items-center gap-1.5 px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-gray-200 text-sm rounded-lg transition-colors",children:["Actions (",v.size,")",t.jsx(Pn,{className:"w-3.5 h-3.5"})]}),B&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>P(!1)}),t.jsxs("div",{className:"absolute left-0 top-full mt-1 w-48 bg-gray-700 rounded-lg shadow-xl border border-gray-600 py-1 z-20",children:[t.jsxs("button",{onClick:()=>ze("watched"),className:"w-full px-3 py-2 text-left text-sm text-gray-200 hover:bg-gray-600 flex items-center gap-2",children:[t.jsx(Pi,{className:"w-4 h-4"})," Mark Watched"]}),t.jsxs("button",{onClick:()=>ze("unwatched"),className:"w-full px-3 py-2 text-left text-sm text-gray-200 hover:bg-gray-600 flex items-center gap-2",children:[t.jsx(fo,{className:"w-4 h-4"})," Mark Unwatched"]}),t.jsxs("button",{onClick:()=>ze("keep_forever"),className:"w-full px-3 py-2 text-left text-sm text-gray-200 hover:bg-gray-600 flex items-center gap-2",children:[t.jsx(Xu,{className:"w-4 h-4"})," Keep Forever"]}),t.jsx("div",{className:"border-t border-gray-600 my-1"}),t.jsxs("button",{onClick:()=>ze("delete"),className:"w-full px-3 py-2 text-left text-sm text-red-400 hover:bg-gray-600 flex items-center gap-2",children:[t.jsx(Dt,{className:"w-4 h-4"})," Delete"]})]})]})]}),re&&t.jsx("div",{className:"w-px h-6 bg-gray-700"}),e==="show"&&X.length>0&&t.jsx(Gu,{label:"Shows",value:u,options:[{value:"",label:"All Shows"},...X.map(Ie=>({value:Ie,label:Ie}))],onChange:f}),ae.length>0&&t.jsx(Gu,{label:"Content Rating",value:g,options:[{value:"",label:"All Ratings"},...ae.map(Ie=>({value:Ie,label:Ie}))],onChange:p}),t.jsx(Gu,{label:"Filter",value:b,options:[{value:"",label:"All"},{value:"false",label:"Unwatched"},{value:"true",label:"Watched"}],onChange:y}),t.jsx("div",{className:"flex-1"}),t.jsxs("div",{className:"relative",children:[t.jsx(xt,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),t.jsx("input",{type:"text",placeholder:"Search...",value:n,onChange:Ie=>i(Ie.target.value),className:"w-48 pl-8 pr-3 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"}),n&&t.jsx("button",{onClick:()=>i(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white",children:t.jsx(nt,{className:"w-3.5 h-3.5"})})]}),t.jsx(Gu,{label:"Sort",value:l,options:[{value:"date_added",label:"Date Added"},{value:"name",label:"Name"},{value:"duration",label:"Duration"},{value:"size",label:"Size"}],onChange:o}),t.jsx("button",{onClick:()=>h(d==="asc"?"desc":"asc"),className:"p-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-400 hover:text-white hover:border-gray-500 transition-colors",title:d==="asc"?"Ascending":"Descending",children:d==="asc"?t.jsx(Uh,{className:"w-4 h-4"}):t.jsx(ed,{className:"w-4 h-4"})})]})}),t.jsxs("div",{className:"px-4 py-2 flex items-center justify-between text-sm border-b border-gray-800",children:[t.jsx("span",{className:"text-gray-500",children:Z?"Loading...":`${z.length} recording${z.length!==1?"s":""}`}),re&&!Ee&&t.jsx("button",{onClick:()=>_(new Set),className:"text-xs text-indigo-400 hover:text-indigo-300",children:"Clear selection"})]}),t.jsx("div",{className:"p-4",children:Z?t.jsx("div",{className:"flex items-center justify-center py-24",children:t.jsx(Ke,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):z.length===0?t.jsx("div",{className:"flex flex-col items-center justify-center py-24 text-center",children:(()=>{const Ie=$g[e],Lt=Ie.icon;return t.jsxs(t.Fragment,{children:[t.jsx(Lt,{className:"w-16 h-16 text-gray-700 mb-4"}),t.jsxs("h3",{className:"text-lg font-medium text-gray-300 mb-2",children:["No ",Ie.label.toLowerCase()," found"]}),t.jsx("p",{className:"text-gray-500 max-w-md",children:n?`No recordings match "${n}"`:`Completed recordings will appear here once you schedule and record ${Ie.label.toLowerCase()}.`}),n&&t.jsx("button",{onClick:()=>i(""),className:"mt-4 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:"Clear search"})]})})()}):t.jsx("div",{className:"space-y-2",children:z.map(Ie=>t.jsx(O6,{recording:Ie,isSelected:v.has(Ie.id),onToggleSelect:()=>Le(Ie.id),onPlay:()=>Xe(Ie),onToggleWatched:()=>te.mutate(Ie.id),onToggleFavorite:()=>W.mutate(Ie.id),onToggleKeep:()=>K.mutate(Ie.id),onTrash:()=>{confirm(`Move "${Ie.title}" to trash?`)&&q.mutate(Ie.id)},onFixMatch:e==="unmatched"?()=>{D(Ie),ee(Ie.title)}:void 0},Ie.id))})})]}),F&&t.jsx(M6,{recording:F,onClose:()=>H(null),onSelect:Ie=>{L(Ie==="live"),C(F),H(null)}}),N&&t.jsx(P6,{recording:N,onClose:()=>{C(null),L(!1)},startLive:T}),I&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:t.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-2xl max-h-[80vh] overflow-hidden flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"text-xl font-bold text-white",children:["Fix Match: ",I.title]}),t.jsx("button",{onClick:()=>{D(null),ee("")},className:"text-gray-400 hover:text-white",children:t.jsx(nt,{className:"h-5 w-5"})})]}),t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"relative",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search TMDB...",value:O,onChange:Ie=>ee(Ie.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded text-white"})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto",children:be?t.jsx("div",{className:"p-8 text-center text-gray-400",children:"Searching..."}):oe?.length?t.jsx("div",{className:"space-y-2",children:oe.map(Ie=>t.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-700 rounded hover:bg-gray-600 cursor-pointer",onClick:()=>ye.mutate({id:I.id,result:Ie}),children:[t.jsx("div",{className:"w-12 h-18 bg-gray-600 rounded overflow-hidden flex-shrink-0",children:Ie.poster_path?t.jsx("img",{src:`https://image.tmdb.org/t/p/w92${Ie.poster_path}`,alt:Ie.title,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx(Gt,{className:"h-4 w-4 text-gray-400"})})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h4",{className:"text-white font-medium truncate",children:Ie.title}),t.jsxs("span",{className:"text-gray-400 text-sm",children:["(",(Ie.release_date||Ie.first_air_date||"").substring(0,4),")"]})]}),t.jsx("p",{className:"text-sm text-gray-400 line-clamp-2",children:Ie.overview}),t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["TMDB ID: ",Ie.id,"  ",Ie.media_type==="movie"?"Movie":"TV Show",Ie.vote_average?`  Rating: ${Ie.vote_average.toFixed(1)}`:""]})]}),t.jsx(Bs,{className:"h-5 w-5 text-green-500 flex-shrink-0"})]},Ie.id))}):t.jsx("div",{className:"p-8 text-center text-gray-400",children:O.length>2?"No results found":"Type to search"})}),ye.isPending&&t.jsxs("div",{className:"mt-4 text-center text-gray-400 flex items-center justify-center gap-2",children:[t.jsx(Ke,{className:"h-4 w-4 animate-spin"}),"Applying match..."]})]})})]})}function B6(){const a=at(),[e,s]=k.useState(""),[n,i]=k.useState("name"),[l,o]=k.useState(!0),{data:d,isLoading:h}=Fe({queryKey:["dvrPasses"],queryFn:()=>pe.getDVRPasses()}),u=Me({mutationFn:({id:N,type:C})=>pe.pauseDVRPass(N,C),onSuccess:()=>a.invalidateQueries({queryKey:["dvrPasses"]})}),f=Me({mutationFn:({id:N,type:C})=>pe.resumeDVRPass(N,C),onSuccess:()=>a.invalidateQueries({queryKey:["dvrPasses"]})}),g=Me({mutationFn:N=>pe.deleteSeriesRule(N),onSuccess:()=>a.invalidateQueries({queryKey:["dvrPasses"]})}),p=k.useMemo(()=>{if(!d)return[];let N=d;if(e.trim()){const C=e.toLowerCase();N=N.filter(T=>T.name.toLowerCase().includes(C)||T.teamName&&T.teamName.toLowerCase().includes(C)||T.league&&T.league.toLowerCase().includes(C)||T.keywords&&T.keywords.toLowerCase().includes(C))}return N=[...N].sort((C,T)=>{let L=0;switch(n){case"name":L=C.name.localeCompare(T.name);break;case"jobs":L=C.jobCount-T.jobCount;break;case"date":L=new Date(C.createdAt).getTime()-new Date(T.createdAt).getTime();break;case"priority":L=C.priority-T.priority;break}return l?L:-L}),N},[d,e,n,l]),b=N=>{n===N?o(!l):(i(N),o(!0))},y=N=>{N.enabled?u.mutate({id:N.id,type:N.type}):f.mutate({id:N.id,type:N.type})},v=N=>{confirm(`Delete pass "${N.name}"? This will not remove existing recordings.`)&&N.type==="series"&&g.mutate(N.id)},_=N=>new Date(N).toLocaleDateString([],{month:"short",day:"numeric",year:"numeric"});return t.jsxs("div",{children:[t.jsxs("div",{className:"mb-8",children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"DVR Passes"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Manage your recording rules and team passes"})]}),t.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row gap-4",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search passes...",value:e,onChange:N=>s(N.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"}),e&&t.jsx("button",{onClick:()=>s(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-white",children:t.jsx(nt,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"flex items-center gap-1 bg-gray-800 rounded-lg p-1",children:[t.jsx(Y1,{className:"w-4 h-4 text-gray-400 ml-2"}),["name","jobs","date","priority"].map(N=>t.jsxs("button",{onClick:()=>b(N),className:`px-3 py-1.5 text-sm rounded-md font-medium transition-colors flex items-center gap-1 ${n===N?"bg-indigo-600 text-white":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:[N.charAt(0).toUpperCase()+N.slice(1),n===N&&t.jsx(V1,{className:"w-3 h-3"})]},N))]})]}),h?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx(Ke,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):p.length>0?t.jsx("div",{className:"space-y-3",children:p.map(N=>t.jsx(U6,{pass:N,onToggle:()=>y(N),onDelete:()=>v(N),formatDate:_,isToggling:u.isPending||f.isPending},`${N.type}-${N.id}`))}):e?t.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[t.jsx(xt,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No matches found"}),t.jsxs("p",{className:"text-gray-400",children:['No passes match "',e,'"']}),t.jsx("button",{onClick:()=>s(""),className:"mt-4 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Clear search"})]}):t.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[t.jsx(Nn,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No recording passes"}),t.jsx("p",{className:"text-gray-400",children:"Create series rules from DVR or team passes from Team Pass"})]})]})}function U6({pass:a,onToggle:e,onDelete:s,formatDate:n,isToggling:i}){const l=a.type==="team"?"bg-amber-500/20 text-amber-400":"bg-indigo-500/20 text-indigo-400",o=a.type==="team"?ti:jt;return t.jsx("div",{className:`bg-gray-800 rounded-xl border transition-colors ${a.enabled?"border-gray-700 hover:border-gray-600":"border-gray-700/50 opacity-60"}`,children:t.jsxs("div",{className:"p-4 flex items-start gap-4",children:[t.jsx("div",{className:"flex-shrink-0 w-16 h-24 rounded-lg overflow-hidden bg-gray-700 flex items-center justify-center",children:a.thumb?t.jsx("img",{src:a.thumb,alt:a.name,className:"w-full h-full object-cover"}):t.jsx(o,{className:"w-8 h-8 text-gray-500"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"flex items-start justify-between gap-2",children:t.jsxs("div",{className:"min-w-0",children:[t.jsx("h3",{className:"font-semibold text-white text-lg truncate",children:a.name}),t.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2",children:[t.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${l}`,children:a.type==="team"?"Team Pass":"Series Rule"}),!a.enabled&&t.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded bg-gray-600 text-gray-300",children:"Paused"}),a.league&&t.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded bg-green-500/20 text-green-400",children:a.league})]})]})}),t.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-gray-400",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Nn,{className:"w-3.5 h-3.5"}),a.jobCount," recording",a.jobCount!==1?"s":""]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(sn,{className:"w-3.5 h-3.5"}),"Created ",n(a.createdAt)]}),a.keepCount>0&&t.jsxs("span",{children:["Keep last ",a.keepCount]}),a.keepCount===0&&t.jsx("span",{children:"Keep all"}),a.keywords&&t.jsxs("span",{children:["Keywords: ",a.keywords]})]})]}),t.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1",children:[t.jsx("button",{onClick:e,disabled:i,className:`p-2 rounded-lg transition-colors ${a.enabled?"text-gray-400 hover:text-amber-400 hover:bg-gray-700":"text-amber-400 hover:text-green-400 hover:bg-gray-700"}`,title:a.enabled?"Pause":"Resume",children:a.enabled?t.jsx(Bi,{className:"w-4 h-4"}):t.jsx(xs,{className:"w-4 h-4"})}),t.jsx("button",{className:"p-2 text-gray-400 hover:text-indigo-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Edit",children:t.jsx(an,{className:"w-4 h-4"})}),t.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Delete",children:t.jsx(Dt,{className:"w-4 h-4"})})]})]})})}function $6(a,e){const s=new Date(a),n=new Date(e),i={hour:"numeric",minute:"2-digit"};return`${s.toLocaleTimeString([],i)} - ${n.toLocaleTimeString([],i)}`}function G6(a){const e=new Date(a+"T00:00:00"),s=new Date,n=new Date(s);return n.setDate(n.getDate()+1),e.toDateString()===s.toDateString()?"Today":e.toDateString()===n.toDateString()?"Tomorrow":e.toLocaleDateString([],{weekday:"long",month:"long",day:"numeric"})}function V6(a,e){const s=new Date(e).getTime()-new Date(a).getTime(),n=Math.round(s/6e4);if(n>=60){const i=Math.floor(n/60),l=n%60;return l>0?`${i}h ${l}m`:`${i}h`}return`${n}m`}const GN={scheduled:{icon:Kt,color:"text-blue-400",bgColor:"bg-blue-500/10",borderColor:"border-blue-500/30",label:"Scheduled"},recording:{icon:yl,color:"text-red-400 animate-pulse",bgColor:"bg-red-500/10",borderColor:"border-red-500/30",label:"Recording"},conflict:{icon:ps,color:"text-amber-400",bgColor:"bg-amber-500/10",borderColor:"border-amber-500/30",label:"Conflict"}};function q6(){const a=at(),{data:e,isLoading:s}=Fe({queryKey:["dvrSchedule"],queryFn:()=>pe.getDVRSchedule(),refetchInterval:3e4}),n=Me({mutationFn:o=>pe.deleteRecording(o),onSuccess:()=>{a.invalidateQueries({queryKey:["dvrSchedule"]}),a.invalidateQueries({queryKey:["recordings"]})}}),i=k.useMemo(()=>{if(!e?.schedule)return new Map;const o=new Map;for(const d of e.schedule){const h=o.get(d.day)||[];h.push(d),o.set(d.day,h)}return o},[e]),l=(o,d)=>{confirm(`Cancel scheduled recording "${d}"?`)&&n.mutate(o)};return t.jsxs("div",{children:[t.jsxs("div",{className:"mb-8",children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"DVR Schedule"}),t.jsxs("p",{className:"text-gray-400 mt-1",children:["Upcoming scheduled recordings",e?.totalCount?` (${e.totalCount})`:""]})]}),s?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx(Ke,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):e?.schedule&&e.schedule.length>0?t.jsx("div",{className:"space-y-8",children:Array.from(i.entries()).map(([o,d])=>t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx(sn,{className:"w-5 h-5 text-indigo-400"}),t.jsx("h2",{className:"text-lg font-semibold text-white",children:G6(o)}),t.jsxs("span",{className:"text-sm text-gray-500",children:[d.length," recording",d.length!==1?"s":""]})]}),t.jsx("div",{className:"space-y-2",children:d.map(h=>{const u=GN[h.status]||GN.scheduled,f=u.icon;return t.jsx("div",{className:`bg-gray-800 rounded-xl border ${u.borderColor} hover:border-gray-600 transition-colors`,children:t.jsxs("div",{className:"p-4 flex items-center gap-4",children:[t.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-lg overflow-hidden bg-gray-700 flex items-center justify-center",children:h.thumb?t.jsx("img",{src:h.thumb,alt:h.title,className:"w-full h-full object-cover"}):h.channelLogo?t.jsx("img",{src:h.channelLogo,alt:h.channelName||"",className:"w-full h-full object-contain p-1"}):t.jsx(Nn,{className:"w-5 h-5 text-gray-500"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h3",{className:"font-medium text-white truncate",children:h.title}),h.episodeNum&&t.jsx("span",{className:"text-sm text-gray-400 flex-shrink-0",children:h.episodeNum})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1 mt-1 text-sm text-gray-400",children:[h.channelName&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(jt,{className:"w-3.5 h-3.5"}),h.channelName]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Kt,{className:"w-3.5 h-3.5"}),$6(h.startTime,h.endTime)]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(rw,{className:"w-3.5 h-3.5"}),V6(h.startTime,h.endTime)]})]})]}),t.jsxs("div",{className:"flex-shrink-0 flex items-center gap-3",children:[t.jsxs("span",{className:`flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded-full ${u.bgColor} ${u.color}`,children:[t.jsx(f,{className:"w-3.5 h-3.5"}),u.label]}),h.priority>0&&t.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-500",title:`Priority: ${h.priority}`,children:[t.jsx(V1,{className:"w-3 h-3"}),h.priority]}),h.status==="scheduled"&&t.jsx("button",{onClick:()=>l(h.id,h.title),disabled:n.isPending,className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Cancel recording",children:t.jsx(Dt,{className:"w-4 h-4"})})]})]})},h.id)})})]},o))}):t.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[t.jsx(sn,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No upcoming recordings"}),t.jsx("p",{className:"text-gray-400",children:"Schedule recordings from On Later or the TV Guide"})]})]})}const K6=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function H6(a){const e=new Date(a),s=e.getDay();return e.setDate(e.getDate()-s),e.setHours(0,0,0,0),e}function z6(a,e){const s=new Date(a+"T00:00:00"),n=new Date(e+"T00:00:00");n.setDate(n.getDate()-1);const i={month:"short",day:"numeric"};return s.getFullYear()!==n.getFullYear()?`${s.toLocaleDateString([],{...i,year:"numeric"})} - ${n.toLocaleDateString([],{...i,year:"numeric"})}`:s.getMonth()===n.getMonth()?`${s.toLocaleDateString([],{month:"short",day:"numeric"})} - ${n.getDate()}, ${s.getFullYear()}`:`${s.toLocaleDateString([],i)} - ${n.toLocaleDateString([],i)}, ${s.getFullYear()}`}function Gg(a){return new Date(a).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function Y6(a){const e=new Date(a+"T00:00:00"),s=new Date;return e.toDateString()===s.toDateString()}const VN={scheduled:{bg:"bg-blue-500/10",border:"border-blue-500/30",text:"text-blue-300",dot:"bg-blue-400"},recording:{bg:"bg-red-500/10",border:"border-red-500/30",text:"text-red-300",dot:"bg-red-400"},completed:{bg:"bg-green-500/10",border:"border-green-500/30",text:"text-green-300",dot:"bg-green-400"}},W6={scheduled:Kt,recording:yl,completed:Xt};function Q6(){const[a,e]=k.useState(0),s=k.useMemo(()=>{const g=H6(new Date);return g.setDate(g.getDate()+a*7),g.toISOString().split("T")[0]},[a]),{data:n,isLoading:i}=Fe({queryKey:["dvrCalendar",s],queryFn:()=>pe.getDVRCalendar(s),refetchInterval:6e4}),l=k.useMemo(()=>{if(!n)return[];const f=new Date(n.weekStart+"T00:00:00"),g=[];for(let p=0;p<7;p++){const b=new Date(f);b.setDate(f.getDate()+p);const y=b.toISOString().split("T")[0];g.push({date:y,dayName:K6[b.getDay()],dateLabel:b.toLocaleDateString([],{month:"short",day:"numeric"})})}return g},[n]),o=k.useMemo(()=>{if(!n?.items)return new Map;const f=new Map;for(const g of n.items){const p=f.get(g.day)||[];p.push(g),f.set(g.day,p)}return f},[n]),d=()=>e(f=>f-1),h=()=>e(f=>f+1),u=()=>e(0);return t.jsxs("div",{children:[t.jsxs("div",{className:"mb-8",children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"DVR Calendar"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Week view of scheduled recordings"})]}),t.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:d,className:"p-2 bg-gray-800 hover:bg-gray-700 text-gray-300 rounded-lg transition-colors",title:"Previous week",children:t.jsx(ko,{className:"w-5 h-5"})}),t.jsx("button",{onClick:h,className:"p-2 bg-gray-800 hover:bg-gray-700 text-gray-300 rounded-lg transition-colors",title:"Next week",children:t.jsx(Ba,{className:"w-5 h-5"})}),a!==0&&t.jsx("button",{onClick:u,className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium rounded-lg transition-colors",children:"This Week"})]}),n&&t.jsx("div",{className:"text-lg font-semibold text-white",children:z6(n.weekStart,n.weekEnd)}),t.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[t.jsxs("span",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-blue-400"}),t.jsx("span",{className:"text-gray-400",children:"Scheduled"})]}),t.jsxs("span",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-red-400"}),t.jsx("span",{className:"text-gray-400",children:"Recording"})]}),t.jsxs("span",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-green-400"}),t.jsx("span",{className:"text-gray-400",children:"Completed"})]})]})]}),i?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx(Ke,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):l.length>0?t.jsx("div",{className:"grid grid-cols-7 gap-2",children:l.map(f=>{const g=o.get(f.date)||[],p=Y6(f.date);return t.jsxs("div",{className:`bg-gray-800 rounded-xl min-h-[240px] flex flex-col ${p?"ring-2 ring-indigo-500/60":""}`,children:[t.jsxs("div",{className:`text-center px-3 py-2.5 border-b border-gray-700 rounded-t-xl ${p?"bg-indigo-600/20":"bg-gray-800"}`,children:[t.jsx("div",{className:`text-sm font-semibold ${p?"text-indigo-400":"text-gray-300"}`,children:p?"Today":f.dayName}),t.jsx("div",{className:"text-xs text-gray-500",children:f.dateLabel})]}),t.jsx("div",{className:"flex-1 p-2 space-y-1.5 overflow-y-auto",children:g.length>0?g.map(b=>{const y=VN[b.status]||VN.scheduled,v=W6[b.status]||Kt;return t.jsxs("div",{className:`p-2 rounded-lg border ${y.bg} ${y.border} cursor-default`,title:`${b.title}${b.channelName?" - "+b.channelName:""}
${Gg(b.startTime)} - ${Gg(b.endTime)}`,children:[t.jsx("div",{className:`text-xs font-medium truncate ${y.text}`,children:b.title}),t.jsxs("div",{className:"flex items-center gap-1 mt-0.5 text-gray-400",children:[t.jsx(v,{className:`w-3 h-3 ${b.status==="recording"?"animate-pulse text-red-400":""}`}),t.jsx("span",{className:"text-[11px]",children:Gg(b.startTime)})]}),b.channelName&&t.jsx("div",{className:"text-[11px] text-gray-500 truncate mt-0.5",children:b.channelName})]},b.id)}):t.jsx("div",{className:"flex items-center justify-center h-full text-gray-600 text-xs py-8",children:"No recordings"})}),g.length>0&&t.jsx("div",{className:"px-2 pb-2",children:t.jsxs("div",{className:"text-[11px] text-gray-500 text-center",children:[g.length," rec",g.length!==1?"s":""]})})]},f.date)})}):t.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[t.jsx(sn,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No data"}),t.jsx("p",{className:"text-gray-400",children:"Calendar data is not available"})]})]})}function X6({title:a,streamUrl:e,onClose:s}){const n=k.useRef(null),i=k.useRef(null),[l,o]=k.useState(!0),[d,h]=k.useState(null),[u,f]=k.useState(!1),[g,p]=k.useState(!0),[b,y]=k.useState(!0),[v,_]=k.useState(0),[N,C]=k.useState(0),T=k.useRef(null),L=()=>{const O=n.current;O&&(O.paused?(O.play().catch(()=>{}),p(!0)):(O.pause(),p(!1)))},F=()=>{const O=n.current;O&&(O.currentTime=Math.max(0,O.currentTime-10))},H=()=>{const O=n.current;O&&(O.currentTime=O.currentTime+10)},B=O=>{const ee=n.current;ee&&(ee.currentTime=parseFloat(O.target.value))},P=O=>{const ee=Math.floor(O/3600),ie=Math.floor(O%3600/60),Z=Math.floor(O%60);return ee>0?`${ee}:${ie.toString().padStart(2,"0")}:${Z.toString().padStart(2,"0")}`:`${ie}:${Z.toString().padStart(2,"0")}`};k.useEffect(()=>{const O=n.current;if(!O||!e)return;o(!0),h(null);const ee=()=>{_(O.currentTime)},ie=()=>{C(O.duration)},Z=()=>{p(!1)};if(O.addEventListener("timeupdate",ee),O.addEventListener("loadedmetadata",ie),O.addEventListener("ended",Z),Ns.isSupported()){const z=new Ns({enableWorker:!0,lowLatencyMode:!1});i.current=z,z.on(Ns.Events.MANIFEST_PARSED,()=>{o(!1),O.play().catch(()=>{})}),z.on(Ns.Events.ERROR,(X,ae)=>{ae.fatal&&(console.error("HLS error:",ae),z.destroy(),i.current=null,O.src=e,O.play().catch(te=>{h(`Playback error: ${te.message}`),o(!1)}))}),z.loadSource(e),z.attachMedia(O)}else O.canPlayType("application/vnd.apple.mpegurl")?(O.src=e,O.addEventListener("loadedmetadata",()=>{o(!1),O.play().catch(()=>{})})):(O.src=e,O.addEventListener("canplay",()=>{o(!1),O.play().catch(()=>{})}),O.addEventListener("error",()=>{h("Unable to play this video format"),o(!1)}));return()=>{O.removeEventListener("timeupdate",ee),O.removeEventListener("loadedmetadata",ie),O.removeEventListener("ended",Z),i.current&&(i.current.destroy(),i.current=null)}},[e]),k.useEffect(()=>(b&&(T.current&&clearTimeout(T.current),T.current=window.setTimeout(()=>{y(!1)},3e3)),()=>{T.current&&clearTimeout(T.current)}),[b]);const I=()=>y(!0),D=()=>{const O=document.getElementById("vod-player-container");O&&(document.fullscreenElement?document.exitFullscreen():O.requestFullscreen())};return t.jsx("div",{className:"fixed inset-0 z-50 bg-black",children:t.jsxs("div",{id:"vod-player-container",className:"relative w-full h-full",onMouseMove:I,onClick:I,children:[l&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx(Ke,{className:"w-12 h-12 text-white animate-spin"})}),d?t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-red-400 text-lg mb-4",children:d}),t.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Close"})]})}):t.jsx("video",{ref:n,className:"w-full h-full object-contain",muted:u,playsInline:!0}),t.jsxs("div",{className:`absolute inset-0 transition-opacity duration-300 ${b?"opacity-100":"opacity-0 pointer-events-none"}`,children:[t.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/80 to-transparent",children:t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("button",{onClick:s,className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",children:t.jsx(nt,{className:"w-6 h-6"})}),t.jsx("div",{children:t.jsx("h2",{className:"text-xl font-semibold text-white",children:a})})]})})}),t.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent",children:[N>0&&t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx("span",{className:"text-white text-sm",children:P(v)}),t.jsx("input",{type:"range",min:"0",max:N,value:v,onChange:B,className:"flex-1 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-white"}),t.jsx("span",{className:"text-white text-sm",children:P(N)})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("button",{onClick:()=>f(!u),className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",title:u?"Unmute":"Mute",children:u?t.jsx(mp,{className:"w-6 h-6"}):t.jsx(fp,{className:"w-6 h-6"})})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:F,className:"p-3 text-white hover:bg-white/20 rounded-full transition-colors",title:"Rewind 10s",children:t.jsx(sw,{className:"w-6 h-6"})}),t.jsx("button",{onClick:L,className:"p-4 text-white bg-white/20 hover:bg-white/30 rounded-full transition-colors",title:g?"Pause":"Play",children:g?t.jsx(Bi,{className:"w-8 h-8"}):t.jsx(xs,{className:"w-8 h-8"})}),t.jsx("button",{onClick:H,className:"p-3 text-white hover:bg-white/20 rounded-full transition-colors",title:"Forward 10s",children:t.jsx(Vh,{className:"w-6 h-6"})})]}),t.jsx("button",{onClick:D,className:"p-2 text-white hover:bg-white/20 rounded-lg transition-colors",title:"Fullscreen",children:t.jsx(up,{className:"w-6 h-6"})})]})]})]})]})})}function J6({movie:a,onClose:e,onDownload:s,onPlay:n,isDownloading:i}){return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"relative",children:[a.poster&&t.jsx("div",{className:"h-48 bg-gradient-to-b from-gray-700 to-gray-800 overflow-hidden",children:t.jsx("img",{src:a.poster,alt:a.title,className:"w-full h-full object-cover opacity-30"})}),t.jsx("button",{onClick:e,className:"absolute top-4 right-4 p-2 bg-black/50 hover:bg-black/70 rounded-full text-white",children:t.jsx(nt,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex gap-6",children:[a.poster&&t.jsx("div",{className:"flex-shrink-0 w-32",children:t.jsx("img",{src:a.poster,alt:a.title,className:"w-full rounded-lg shadow-lg"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:a.title}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-2 text-sm text-gray-400",children:[a.year&&t.jsx("span",{children:a.year}),a.runtime&&t.jsx("span",{children:a.runtime}),a.rating&&t.jsx("span",{className:"px-2 py-0.5 border border-gray-600 rounded",children:a.rating})]}),a.genres&&a.genres.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:a.genres.map(l=>t.jsx("span",{className:"px-2 py-1 text-xs bg-gray-700 text-gray-300 rounded",children:l},l))})]})]}),a.description&&t.jsx("p",{className:"mt-4 text-gray-300 text-sm leading-relaxed",children:a.description}),t.jsxs("div",{className:"mt-6 flex gap-3",children:[a.downloadUrl&&t.jsxs("button",{onClick:n,className:"flex items-center gap-2 px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium",children:[t.jsx(xs,{className:"w-5 h-5"}),"Play"]}),t.jsxs("button",{onClick:s,disabled:i,className:"flex items-center gap-2 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg font-medium",children:[i?t.jsx(Ke,{className:"w-5 h-5 animate-spin"}):t.jsx(gs,{className:"w-5 h-5"}),i?"Starting Download...":"Download"]}),t.jsx("button",{onClick:e,className:"px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Close"})]})]})]})})}function Z6({showId:a,provider:e,onClose:s,onDownload:n,onPlay:i,isDownloading:l}){const[o,d]=k.useState([1]),{data:h,isLoading:u}=Fe({queryKey:["vod-show",e,a],queryFn:()=>pe.vod.getShow(e,a)}),f=g=>{d(p=>p.includes(g)?p.filter(b=>b!==g):[...p,g])};return u?t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",children:t.jsx(Ke,{className:"w-12 h-12 text-white animate-spin"})}):h?t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"relative",children:[h.poster&&t.jsx("div",{className:"h-48 bg-gradient-to-b from-gray-700 to-gray-800 overflow-hidden",children:t.jsx("img",{src:h.poster,alt:h.title,className:"w-full h-full object-cover opacity-30"})}),t.jsx("button",{onClick:s,className:"absolute top-4 right-4 p-2 bg-black/50 hover:bg-black/70 rounded-full text-white",children:t.jsx(nt,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex gap-6",children:[h.poster&&t.jsx("div",{className:"flex-shrink-0 w-32",children:t.jsx("img",{src:h.poster,alt:h.title,className:"w-full rounded-lg shadow-lg"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:h.title}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-2 text-sm text-gray-400",children:[h.year&&t.jsx("span",{children:h.year}),h.seasonCount&&t.jsxs("span",{children:[h.seasonCount," Season",h.seasonCount>1?"s":""]}),h.rating&&t.jsx("span",{className:"px-2 py-0.5 border border-gray-600 rounded",children:h.rating})]}),h.genres&&h.genres.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:h.genres.map(g=>t.jsx("span",{className:"px-2 py-1 text-xs bg-gray-700 text-gray-300 rounded",children:g},g))})]})]}),h.description&&t.jsx("p",{className:"mt-4 text-gray-300 text-sm leading-relaxed",children:h.description}),h.seasons&&h.seasons.length>0&&t.jsxs("div",{className:"mt-6 space-y-2",children:[t.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Episodes"}),h.seasons.map(g=>t.jsxs("div",{className:"border border-gray-700 rounded-lg overflow-hidden",children:[t.jsxs("button",{onClick:()=>f(g.seasonNumber),className:"w-full flex items-center justify-between p-4 bg-gray-700/50 hover:bg-gray-700 text-white",children:[t.jsxs("span",{className:"font-medium",children:["Season ",g.seasonNumber]}),o.includes(g.seasonNumber)?t.jsx(Pn,{className:"w-5 h-5"}):t.jsx(Ba,{className:"w-5 h-5"})]}),o.includes(g.seasonNumber)&&g.episodes&&t.jsx("div",{className:"divide-y divide-gray-700",children:g.episodes.map(p=>t.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-gray-700/30",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-gray-500 text-sm",children:["E",p.episodeNumber]}),t.jsx("span",{className:"text-white font-medium truncate",children:p.title})]}),p.runtime&&t.jsxs("span",{className:"text-xs text-gray-500",children:[p.runtime," min"]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[p.downloadUrl&&t.jsx("button",{onClick:()=>i({id:p.id,title:p.title,downloadUrl:p.downloadUrl}),className:"flex-shrink-0 p-2 text-gray-400 hover:text-green-400 hover:bg-gray-700 rounded-lg",title:"Play",children:t.jsx(xs,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>n(p.id),disabled:l===p.id,className:"flex-shrink-0 p-2 text-gray-400 hover:text-indigo-400 hover:bg-gray-700 rounded-lg disabled:opacity-50",title:"Download",children:l===p.id?t.jsx(Ke,{className:"w-4 h-4 animate-spin"}):t.jsx(gs,{className:"w-4 h-4"})})]})]},p.id))})]},g.seasonNumber))]}),t.jsx("div",{className:"mt-6 flex justify-end",children:t.jsx("button",{onClick:s,className:"px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Close"})})]})]})}):null}function qN({title:a,year:e,poster:s,rating:n,onClick:i}){return t.jsxs("button",{onClick:i,className:"group relative bg-gray-800 rounded-lg overflow-hidden hover:ring-2 hover:ring-indigo-500 transition-all",children:[t.jsx("div",{className:"aspect-[2/3] bg-gray-700",children:s?t.jsx("img",{src:s,alt:a,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx(Gt,{className:"w-12 h-12 text-gray-600"})})}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),t.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-3",children:[t.jsx("h4",{className:"font-medium text-white text-sm truncate",children:a}),t.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-400",children:[e&&t.jsx("span",{children:e}),n&&t.jsx("span",{className:"px-1 border border-gray-600 rounded",children:n})]})]}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx("div",{className:"p-3 bg-indigo-600 rounded-full",children:t.jsx(xs,{className:"w-6 h-6 text-white"})})})]})}function e8({queue:a,onCancel:e,onRefresh:s,isRefreshing:n}){return a.length?t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("span",{className:"text-sm text-gray-400",children:[a.length," download",a.length>1?"s":""]}),t.jsx("button",{onClick:s,disabled:n,className:"p-1 text-gray-400 hover:text-white",children:t.jsx(ut,{className:`w-4 h-4 ${n?"animate-spin":""}`})})]}),a.map(i=>t.jsxs("div",{className:"bg-gray-700 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h4",{className:"font-medium text-white text-sm truncate",children:i.title}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[i.status==="queued"&&t.jsxs("span",{className:"flex items-center gap-1 text-xs text-blue-400",children:[t.jsx(Kt,{className:"w-3 h-3"}),"Queued"]}),i.status==="downloading"&&t.jsxs("span",{className:"flex items-center gap-1 text-xs text-indigo-400",children:[t.jsx(Ke,{className:"w-3 h-3 animate-spin"}),i.progress.toFixed(0),"%"]}),i.status==="completed"&&t.jsxs("span",{className:"flex items-center gap-1 text-xs text-green-400",children:[t.jsx(Xt,{className:"w-3 h-3"}),"Completed"]}),i.status==="failed"&&t.jsxs("span",{className:"flex items-center gap-1 text-xs text-red-400",children:[t.jsx(kt,{className:"w-3 h-3"}),"Failed"]})]})]}),(i.status==="queued"||i.status==="downloading")&&t.jsx("button",{onClick:()=>e(i.id),className:"p-1 text-gray-400 hover:text-red-400",children:t.jsx(Dt,{className:"w-4 h-4"})})]}),i.status==="downloading"&&t.jsx("div",{className:"mt-2 h-1.5 bg-gray-600 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300",style:{width:`${i.progress}%`}})}),i.error&&t.jsx("p",{className:"mt-2 text-xs text-red-400",children:i.error})]},i.id))]}):t.jsxs("div",{className:"text-center py-8 text-gray-500",children:[t.jsx(gs,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),t.jsx("p",{children:"No active downloads"})]})}function t8(){const a=at(),[e,s]=k.useState(null),[n,i]=k.useState("movies"),[l,o]=k.useState(""),[d,h]=k.useState(null),[u,f]=k.useState(null),[g,p]=k.useState(null),[b,y]=k.useState(null),[v,_]=k.useState(!1),[N,C]=k.useState(null),{data:T}=Fe({queryKey:["serverConfig"],queryFn:()=>pe.getServerConfig(),retry:!1}),L=T?.vod_api_url||"",{data:F}=Fe({queryKey:["vod-connection"],queryFn:()=>pe.vod.testConnection(),refetchInterval:3e4}),{data:H,isLoading:B}=Fe({queryKey:["vod-providers"],queryFn:()=>pe.vod.getProviders(),enabled:F?.connected===!0});k.useEffect(()=>{H?.length&&!e&&s(H[0].id)},[H,e]);const{data:P,isLoading:I}=Fe({queryKey:["vod-movies",e],queryFn:()=>pe.vod.getMovies(e),enabled:!!e&&n==="movies"}),{data:D,isLoading:O}=Fe({queryKey:["vod-shows",e],queryFn:()=>pe.vod.getShows(e),enabled:!!e&&n==="shows"}),{data:ee}=Fe({queryKey:["vod-genres",e],queryFn:()=>pe.vod.getGenres(e),enabled:!!e}),{data:ie,refetch:Z,isRefetching:z}=Fe({queryKey:["vod-queue"],queryFn:()=>pe.vod.getQueue(),refetchInterval:5e3,enabled:F?.connected===!0}),X=Me({mutationFn:({contentId:re,type:fe})=>pe.vod.startDownload(e,re,fe),onSuccess:()=>{a.invalidateQueries({queryKey:["vod-queue"]})}}),ae=Me({mutationFn:re=>pe.vod.cancelDownload(re),onSuccess:()=>{a.invalidateQueries({queryKey:["vod-queue"]})}}),te=()=>{u&&e&&X.mutate({contentId:u.id,type:"movie"},{onSuccess:()=>{f(null)}})},W=re=>{e&&(y(re),X.mutate({contentId:re,type:"episode"},{onSettled:()=>{y(null)}}))},K=()=>{if(u?.downloadUrl&&L){const re=`${L}${u.downloadUrl}`;C({title:u.title,streamUrl:re}),f(null)}},q=re=>{if(re.downloadUrl&&L){const fe=`${L}${re.downloadUrl}`;C({title:re.title||"Episode",streamUrl:fe}),p(null)}},J=P?.filter(re=>{const fe=!l||re.title.toLowerCase().includes(l.toLowerCase()),Le=!d||re.genres?.includes(d);return fe&&Le}),oe=D?.filter(re=>{const fe=!l||re.title.toLowerCase().includes(l.toLowerCase()),Le=!d||re.genres?.includes(d);return fe&&Le}),be=B||(n==="movies"?I:O),ye=ie?.items||[],Ee=ye.filter(re=>re.status==="queued"||re.status==="downloading").length;return F?.connected===!1?t.jsxs("div",{children:[t.jsxs("div",{className:"mb-8",children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"VOD Downloads"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Browse and download Disney+ content"})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-8 text-center",children:[t.jsx(NR,{className:"w-16 h-16 text-red-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"VOD Service Not Available"}),t.jsx("p",{className:"text-gray-400 mb-4",children:F?.error||"Could not connect to VOD API"}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Configure the VOD API URL in ",t.jsx("a",{href:"/ui/settings",className:"text-indigo-400 hover:underline",children:"Settings"})]})]})]}):t.jsxs("div",{children:[t.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"VOD Downloads"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Browse and download Disney+ content"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[F?.connected&&t.jsxs("span",{className:"flex items-center gap-1.5 text-sm text-green-400",children:[t.jsx(No,{className:"w-4 h-4"}),"Connected"]}),t.jsxs("button",{onClick:()=>_(!v),className:`relative flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${v?"bg-indigo-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"}`,children:[t.jsx(gs,{className:"w-4 h-4"}),"Queue",Ee>0&&t.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 flex items-center justify-center text-xs bg-red-500 text-white rounded-full",children:Ee})]})]})]}),t.jsxs("div",{className:"flex gap-6",children:[t.jsxs("div",{className:"flex-1",children:[H&&H.length>0&&t.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[t.jsx("label",{className:"text-sm text-gray-400",children:"Provider:"}),t.jsx("select",{value:e||"",onChange:re=>s(re.target.value),className:"px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-indigo-500 min-w-[200px]",children:H.map(re=>t.jsx("option",{value:re.id,children:re.name},re.id))})]}),t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsxs("div",{className:"flex bg-gray-800 rounded-lg p-1",children:[t.jsxs("button",{onClick:()=>i("movies"),className:`flex items-center gap-2 px-4 py-2 rounded-md font-medium transition-colors ${n==="movies"?"bg-gray-700 text-white":"text-gray-400 hover:text-white"}`,children:[t.jsx(Gt,{className:"w-4 h-4"}),"Movies"]}),t.jsxs("button",{onClick:()=>i("shows"),className:`flex items-center gap-2 px-4 py-2 rounded-md font-medium transition-colors ${n==="shows"?"bg-gray-700 text-white":"text-gray-400 hover:text-white"}`,children:[t.jsx(p0,{className:"w-4 h-4"}),"TV Shows"]})]}),t.jsxs("div",{className:"flex-1 relative",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),t.jsx("input",{type:"text",value:l,onChange:re=>o(re.target.value),placeholder:"Search...",className:"w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),ee&&ee.length>0&&t.jsxs("select",{value:d||"",onChange:re=>h(re.target.value||null),className:"px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-indigo-500",children:[t.jsx("option",{value:"",children:"All Genres"}),ee.map(re=>t.jsx("option",{value:re,children:re},re))]})]}),be?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx(Ke,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):n==="movies"?J?.length?t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:J.map(re=>t.jsx(qN,{title:re.title,year:re.year,poster:re.poster,rating:re.rating,onClick:()=>f(re)},re.id))}):t.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[t.jsx(Gt,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No movies found"}),t.jsx("p",{className:"text-gray-400",children:"Try adjusting your search or filters"})]}):oe?.length?t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:oe.map(re=>t.jsx(qN,{title:re.title,year:re.year,poster:re.poster,rating:re.rating,onClick:()=>p(re.id)},re.id))}):t.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[t.jsx(p0,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No TV shows found"}),t.jsx("p",{className:"text-gray-400",children:"Try adjusting your search or filters"})]})]}),v&&t.jsx("div",{className:"w-80 flex-shrink-0",children:t.jsxs("div",{className:"sticky top-6 bg-gray-800 rounded-xl p-4",children:[t.jsx("h3",{className:"font-semibold text-white mb-4",children:"Download Queue"}),t.jsx(e8,{queue:ye,onCancel:re=>ae.mutate(re),onRefresh:()=>Z(),isRefreshing:z})]})})]}),u&&e&&t.jsx(J6,{movie:u,onClose:()=>f(null),onDownload:te,onPlay:K,isDownloading:X.isPending}),g&&e&&t.jsx(Z6,{showId:g,provider:e,onClose:()=>p(null),onDownload:W,onPlay:q,isDownloading:b}),N&&t.jsx(X6,{title:N.title,streamUrl:N.streamUrl,onClose:()=>C(null)})]})}function s8(){return Fe({queryKey:["transcodeInfo"],queryFn:async()=>{const a=await fetch("/api/transcode",{headers:{"X-Plex-Token":localStorage.getItem("openflix_token")||""}});if(!a.ok)throw new Error("Failed to fetch transcode info");return a.json()},refetchInterval:1e4})}function a8({hardware:a}){const e=a.detectedGpus&&a.detectedGpus.length>0,s=()=>{if(!a.available&&e)return t.jsx(kt,{className:"h-8 w-8 text-yellow-400"});if(!a.available)return t.jsx(Nr,{className:"h-8 w-8 text-gray-400"});switch(a.type){case"nvenc":return t.jsx(xa,{className:"h-8 w-8 text-green-400"});case"qsv":return t.jsx(Nr,{className:"h-8 w-8 text-blue-400"});case"videotoolbox":return t.jsx(_o,{className:"h-8 w-8 text-purple-400"});case"vaapi":return t.jsx($a,{className:"h-8 w-8 text-orange-400"});default:return t.jsx(Nr,{className:"h-8 w-8 text-gray-400"})}};return t.jsx("div",{className:"bg-gray-800 rounded-xl p-6",children:t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:"p-3 bg-gray-700 rounded-lg",children:s()}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("h3",{className:"text-lg font-semibold text-white",children:a.name}),a.available?t.jsxs("span",{className:"flex items-center gap-1 text-xs bg-green-500/20 text-green-400 px-2 py-0.5 rounded-full",children:[t.jsx(vn,{className:"h-3 w-3"})," Available"]}):e?t.jsxs("span",{className:"flex items-center gap-1 text-xs bg-yellow-500/20 text-yellow-400 px-2 py-0.5 rounded-full",children:[t.jsx(kt,{className:"h-3 w-3"})," GPU Detected - Not Usable"]}):t.jsxs("span",{className:"flex items-center gap-1 text-xs bg-gray-500/20 text-gray-400 px-2 py-0.5 rounded-full",children:[t.jsx(kt,{className:"h-3 w-3"})," Software Only"]})]}),a.gpuInfo&&t.jsx("p",{className:"text-sm text-gray-400 mb-3",children:a.gpuInfo}),!a.available&&e&&t.jsxs("div",{className:"mb-3",children:[t.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase mb-1",children:"Detected GPUs"}),t.jsx("div",{className:"space-y-1",children:a.detectedGpus.map((n,i)=>t.jsx("p",{className:"text-sm text-yellow-400",children:n},i))})]}),a.missingSupport&&t.jsx("div",{className:"mb-3 p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg",children:t.jsx("p",{className:"text-sm text-yellow-300",children:a.missingSupport})}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase mb-2",children:"Encoders"}),t.jsx("div",{className:"flex flex-wrap gap-1",children:a.encoders.map(n=>t.jsx("span",{className:"text-xs bg-gray-700 text-gray-300 px-2 py-1 rounded",children:n},n))})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase mb-2",children:"Decoders"}),t.jsx("div",{className:"flex flex-wrap gap-1",children:a.decoders.map(n=>t.jsx("span",{className:"text-xs bg-gray-700 text-gray-300 px-2 py-1 rounded",children:n},n))})]})]}),t.jsxs("div",{className:"flex gap-4 mt-4 pt-4 border-t border-gray-700",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xs text-gray-500",children:"HEVC"}),a.supportsHevc?t.jsx(vn,{className:"h-4 w-4 text-green-400"}):t.jsx(kt,{className:"h-4 w-4 text-gray-500"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xs text-gray-500",children:"AV1"}),a.supportsAv1?t.jsx(vn,{className:"h-4 w-4 text-green-400"}):t.jsx(kt,{className:"h-4 w-4 text-gray-500"})]}),a.maxResolution&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xs text-gray-500",children:"Max Resolution"}),t.jsx("span",{className:"text-xs text-white font-medium",children:a.maxResolution})]})]})]})]})})}function n8({modes:a,recommended:e}){return t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[t.jsx(kC,{className:"h-5 w-5"}),"Playback Modes"]}),t.jsx("div",{className:"space-y-3",children:a.map(s=>t.jsxs("div",{className:`p-4 rounded-lg border ${s.id===e?"border-indigo-500 bg-indigo-500/10":"border-gray-700 bg-gray-700/50"}`,children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:"font-medium text-white",children:s.name}),s.id===e&&t.jsx("span",{className:"text-xs bg-indigo-500 text-white px-2 py-0.5 rounded",children:"Recommended"})]}),t.jsx("p",{className:"text-sm text-gray-400",children:s.description})]},s.id))})]})}function i8({config:a}){return t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[t.jsx(Pk,{className:"h-5 w-5"}),"Configuration"]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-700",children:[t.jsx("span",{className:"text-gray-400",children:"Transcoding Enabled"}),t.jsx("span",{className:a.enabled?"text-green-400":"text-red-400",children:a.enabled?"Yes":"No"})]}),t.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-700",children:[t.jsx("span",{className:"text-gray-400",children:"FFmpeg Path"}),t.jsx("span",{className:"text-white font-mono text-sm",children:a.ffmpegPath})]}),t.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-700",children:[t.jsx("span",{className:"text-gray-400",children:"Hardware Acceleration"}),t.jsx("span",{className:"text-white capitalize",children:a.hwAccel})]}),t.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-700",children:[t.jsx("span",{className:"text-gray-400",children:"Temp Directory"}),t.jsx("span",{className:"text-white font-mono text-sm truncate max-w-xs",children:a.tempDir})]}),t.jsxs("div",{className:"flex justify-between items-center py-2",children:[t.jsx("span",{className:"text-gray-400",children:"Max Sessions"}),t.jsx("span",{className:"text-white",children:a.maxSessions})]})]})]})}function r8({sessions:a}){return t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[t.jsx(_o,{className:"h-5 w-5"}),"Active Sessions"]}),t.jsxs("span",{className:"text-sm text-gray-400",children:[a.active," / ",a.max]})]}),t.jsx("div",{className:"h-2 bg-gray-700 rounded-full mb-4",children:t.jsx("div",{className:`h-full rounded-full transition-all ${a.active>=a.max?"bg-red-500":"bg-indigo-500"}`,style:{width:`${Math.min(a.active/a.max*100,100)}%`}})}),a.details.length===0?t.jsxs("div",{className:"text-center py-8 text-gray-500",children:[t.jsx(_o,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),t.jsx("p",{children:"No active transcoding sessions"})]}):t.jsx("div",{className:"space-y-2",children:a.details.map(e=>t.jsx("div",{className:"p-3 bg-gray-700 rounded-lg",children:t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{children:[t.jsxs("p",{className:"text-white font-mono text-sm truncate",children:[e.id.slice(0,8),"..."]}),t.jsxs("p",{className:"text-xs text-gray-400",children:["Quality: ",e.quality]})]}),t.jsx("span",{className:"text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded",children:"Active"})]})},e.id))})]})}function l8(){const{data:a,isLoading:e,refetch:s}=s8();return e?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx(ut,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):a?t.jsxs("div",{children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Transcoding"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Hardware acceleration and transcoding settings"})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsx(a8,{hardware:a.hardware}),t.jsx(i8,{config:a.config}),t.jsx(n8,{modes:a.playbackModes,recommended:a.hardware.recommendedMode}),t.jsx(r8,{sessions:a.sessions})]}),t.jsxs("div",{className:"mt-6 bg-gray-800 rounded-xl p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Playback Strategy"}),t.jsxs("div",{className:"prose prose-invert prose-sm max-w-none",children:[t.jsx("p",{className:"text-gray-300",children:"OpenFlix supports multiple playback strategies to optimize quality and performance:"}),t.jsxs("ul",{className:"text-gray-300 mt-3 space-y-2",children:[t.jsxs("li",{children:[t.jsx("strong",{className:"text-white",children:"Direct Play:"})," The client device decodes the original file directly. This provides the best quality and requires no server resources. Most modern devices (Android, iOS, Smart TVs) support hardware decoding for H.264 and often HEVC."]}),t.jsxs("li",{children:[t.jsx("strong",{className:"text-white",children:"Direct Stream:"})," The server remuxes the file (changes container format) without re-encoding. Useful when the client supports the codec but not the container format."]}),t.jsxs("li",{children:[t.jsx("strong",{className:"text-white",children:"Server Transcode:"})," The server re-encodes the video to a compatible format. Uses server CPU or GPU resources. Enable hardware acceleration (NVENC, QSV, VideoToolbox) for better performance."]})]}),t.jsx("p",{className:"text-gray-400 mt-4 text-sm",children:a.hardware.available?`Your server has hardware acceleration available (${a.hardware.name}). Server transcoding will use the GPU for efficient encoding.`:"Your server will use software (CPU) transcoding. Consider using Direct Play when possible to reduce server load."})]})]}),t.jsx("div",{className:"mt-6 bg-gradient-to-br from-indigo-900/50 to-purple-900/50 rounded-xl p-6 border border-indigo-500/30",children:t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:"p-3 bg-indigo-500/20 rounded-lg",children:t.jsx(xa,{className:"h-6 w-6 text-indigo-400"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Smart Playback Selection"}),t.jsx("p",{className:"text-gray-300 text-sm mb-3",children:"OpenFlix automatically analyzes each media file and your device's capabilities to choose the optimal playback mode:"}),t.jsxs("ul",{className:"text-gray-400 text-sm space-y-1",children:[t.jsxs("li",{className:"flex items-center gap-2",children:[t.jsx(vn,{className:"h-4 w-4 text-green-400"}),t.jsx("span",{children:"Analyzes video codec, audio codec, container format, and resolution"})]}),t.jsxs("li",{className:"flex items-center gap-2",children:[t.jsx(vn,{className:"h-4 w-4 text-green-400"}),t.jsx("span",{children:"Detects HDR, Dolby Vision, and Atmos compatibility"})]}),t.jsxs("li",{className:"flex items-center gap-2",children:[t.jsx(vn,{className:"h-4 w-4 text-green-400"}),t.jsx("span",{children:"Considers network bandwidth and client device capabilities"})]}),t.jsxs("li",{className:"flex items-center gap-2",children:[t.jsx(vn,{className:"h-4 w-4 text-green-400"}),t.jsx("span",{children:"Prioritizes Direct Play for best quality, falls back to transcoding when needed"})]})]}),t.jsx("p",{className:"text-indigo-300 text-xs mt-3",children:"API: GET /api/playback/decide/:fileId  Returns recommended playback mode for any media file"})]})]})})]}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx(kt,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white",children:"Failed to load transcoding info"}),t.jsx("button",{onClick:()=>s(),className:"mt-4 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:"Retry"})]})}function o8(a){return Fe({queryKey:["serverLogs"],queryFn:async()=>{const e=await fetch("/api/logs?lines=1000",{headers:{"X-Plex-Token":localStorage.getItem("openflix_token")||""}});if(!e.ok)throw new Error("Failed to fetch logs");return e.json()},refetchInterval:a?5e3:!1})}function c8(){const a=at();return Me({mutationFn:async()=>{const e=await fetch("/api/logs",{method:"DELETE",headers:{"X-Plex-Token":localStorage.getItem("openflix_token")||""}});if(!e.ok)throw new Error("Failed to clear logs");return e.json()},onSuccess:()=>{a.invalidateQueries({queryKey:["serverLogs"]})}})}function KN(a){return a.includes("level=debug")||a.includes('"level":"debug"')?"debug":a.includes("level=info")||a.includes('"level":"info"')?"info":a.includes("level=warning")||a.includes('"level":"warning"')?"warn":a.includes("level=error")||a.includes('"level":"error"')?"error":null}const d8={debug:"text-gray-400",info:"text-blue-400",warn:"text-yellow-400",error:"text-red-400"};function u8(){const[a,e]=k.useState(!0),[s,n]=k.useState("all"),[i,l]=k.useState(""),{data:o,isLoading:d,refetch:h}=o8(a),u=c8(),f=k.useRef(null),[g,p]=k.useState(!0);k.useEffect(()=>{g&&f.current&&f.current.scrollIntoView({behavior:"smooth"})},[o?.lines,g]);const b=o?.lines.filter(v=>!(s!=="all"&&KN(v)!==s||i&&!v.toLowerCase().includes(i.toLowerCase())))||[],y=()=>{if(!o?.lines)return;const v=o.lines.join(`
`),_=new Blob([v],{type:"text/plain"}),N=URL.createObjectURL(_),C=document.createElement("a");C.href=N,C.download=`openflix-logs-${new Date().toISOString().split("T")[0]}.log`,C.click(),URL.revokeObjectURL(N)};return t.jsxs("div",{className:"h-full flex flex-col",children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Server Logs"}),t.jsx("p",{className:"text-gray-400 mt-1",children:o?.path?`Log file: ${o.path}`:"View server logs in real-time"})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[t.jsx("input",{type:"text",placeholder:"Search logs...",value:i,onChange:v=>l(v.target.value),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm w-64"}),t.jsxs("select",{value:s,onChange:v=>n(v.target.value),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",children:[t.jsx("option",{value:"all",children:"All Levels"}),t.jsx("option",{value:"debug",children:"Debug"}),t.jsx("option",{value:"info",children:"Info"}),t.jsx("option",{value:"warn",children:"Warning"}),t.jsx("option",{value:"error",children:"Error"})]}),t.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:a,onChange:v=>e(v.target.checked),className:"rounded bg-gray-700 border-gray-600"}),"Auto-refresh"]}),t.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:g,onChange:v=>p(v.target.checked),className:"rounded bg-gray-700 border-gray-600"}),"Auto-scroll"]}),t.jsx("div",{className:"flex-1"}),t.jsxs("button",{onClick:()=>h(),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:[t.jsx(ut,{className:"h-4 w-4"}),"Refresh"]}),t.jsxs("button",{onClick:y,disabled:!o?.lines.length,className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 text-white rounded-lg text-sm",children:[t.jsx(gs,{className:"h-4 w-4"}),"Download"]}),t.jsxs("button",{onClick:()=>{confirm("Are you sure you want to clear all logs?")&&u.mutate()},disabled:u.isPending,className:"flex items-center gap-2 px-3 py-2 bg-red-600 hover:bg-red-700 disabled:opacity-50 text-white rounded-lg text-sm",children:[t.jsx(Dt,{className:"h-4 w-4"}),"Clear"]})]}),t.jsxs("div",{className:"text-sm text-gray-400 mb-2",children:["Showing ",b.length," of ",o?.count||0," log entries",o?.level&&t.jsxs("span",{className:"ml-2",children:["(Log level: ",o.level,")"]})]}),t.jsx("div",{className:"flex-1 bg-gray-900 rounded-xl overflow-hidden",children:d?t.jsx("div",{className:"p-4 text-gray-400",children:"Loading logs..."}):b.length===0?t.jsxs("div",{className:"p-8 text-center",children:[t.jsx(wa,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No logs found"}),t.jsx("p",{className:"text-gray-400",children:i||s!=="all"?"Try adjusting your filters":"Logs will appear here as they are generated"})]}):t.jsxs("div",{className:"h-full overflow-auto p-4 font-mono text-xs leading-relaxed",children:[b.map((v,_)=>{const N=KN(v);return t.jsx("div",{className:`${N?d8[N]:"text-gray-300"} hover:bg-gray-800 px-1 -mx-1 rounded`,children:v},_)}),t.jsx("div",{ref:f})]})}),!g&&t.jsx("button",{onClick:()=>f.current?.scrollIntoView({behavior:"smooth"}),className:"fixed bottom-8 right-8 p-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full shadow-lg",children:t.jsx(ed,{className:"h-5 w-5"})})]})}function h8(){return Fe({queryKey:["serverConfig"],queryFn:()=>pe.getServerConfig(),retry:!1})}function lo({title:a,icon:e,children:s}){return t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e,a]}),t.jsx("div",{className:"space-y-4",children:s})]})}function hs({label:a,description:e,children:s}){return t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:a}),e&&t.jsx("p",{className:"text-xs text-gray-500 mb-2",children:e}),s]})}function Vg({checked:a,onChange:e,label:s}){return t.jsxs("button",{type:"button",role:"switch","aria-checked":a,onClick:()=>e(!a),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${a?"bg-indigo-600":"bg-gray-600"}`,children:[t.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${a?"translate-x-6":"translate-x-1"}`}),s&&t.jsx("span",{className:"sr-only",children:s})]})}function f8(){const a=at(),[e,s]=k.useState(!1),{data:n,isLoading:i,error:l}=Fe({queryKey:["dvrSettings"],queryFn:()=>pe.getDVRSettings(),retry:1}),{data:o}=Fe({queryKey:["commercialDetectionStatus"],queryFn:()=>pe.getCommercialDetectionStatus(),retry:1}),[d,h]=k.useState(0);k.useEffect(()=>{n&&h(n.maxConcurrentRecordings)},[n]);const u=Me({mutationFn:g=>pe.updateDVRSettings(g),onSuccess:()=>{a.invalidateQueries({queryKey:["dvrSettings"]}),s(!0),setTimeout(()=>s(!1),3e3)}}),f=()=>{u.mutate({maxConcurrentRecordings:d})};return i?t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"DVR Settings"}),t.jsx("div",{className:"text-gray-400",children:"Loading..."})]}):l?t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"DVR Settings"}),t.jsx("div",{className:"text-red-400 text-sm",children:"Failed to load DVR settings"})]}):t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-lg font-semibold text-white",children:"DVR Settings"}),t.jsxs("button",{onClick:f,disabled:u.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white text-sm rounded-lg",children:[t.jsx(ii,{className:"h-3.5 w-3.5"}),u.isPending?"Saving...":e?"Saved!":"Save"]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(hs,{label:"Max Concurrent Recordings",description:"Maximum number of recordings that can run at the same time. Set to 0 for unlimited.",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"number",min:"0",value:d,onChange:g=>h(Number(g.target.value)),className:"w-32 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"}),t.jsx("span",{className:"text-gray-400 text-sm",children:d===0?"(Unlimited)":`(Max ${d} at once)`})]})}),t.jsx("p",{className:"text-xs text-gray-500",children:"If you have limited tuners or bandwidth, you may want to set a limit. When conflicts occur, higher priority recordings will be preferred."}),t.jsxs("div",{className:"pt-4 border-t border-gray-700",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"Commercial Detection"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Automatically detect and skip commercials in recordings using Comskip"})]}),t.jsx("div",{className:"flex items-center gap-2",children:o?.enabled?t.jsxs(t.Fragment,{children:[t.jsx(Xt,{className:"h-4 w-4 text-green-400"}),t.jsx("span",{className:"text-sm text-green-400",children:"Enabled"})]}):t.jsxs(t.Fragment,{children:[t.jsx(Ua,{className:"h-4 w-4 text-gray-500"}),t.jsx("span",{className:"text-sm text-gray-500",children:"Not Available"})]})})]}),!o?.enabled&&t.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Comskip is not installed. Commercial detection will be enabled automatically when Comskip is available."})]})]})]})}function m8({vodApiUrl:a,onUrlChange:e}){const[s,n]=k.useState(null),[i,l]=k.useState(!1),o=async()=>{if(!a){n({connected:!1,error:"Please enter a VOD API URL"});return}l(!0),n(null);try{const d=await pe.vod.testConnection(a);n(d)}catch(d){n({connected:!1,error:d.message||"Connection failed"})}finally{l(!1)}};return t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"VOD Downloads"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(hs,{label:"VOD API URL",description:"URL of the external VOD download service (e.g., http://192.168.1.82:7070)",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:a,onChange:d=>{e(d.target.value),n(null)},className:"flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://192.168.1.82:7070"}),t.jsx("button",{onClick:o,disabled:i,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 text-white rounded-lg whitespace-nowrap",children:i?t.jsx(Ke,{className:"w-4 h-4 animate-spin"}):"Test Connection"})]})}),s&&t.jsx("div",{className:`flex items-center gap-2 p-3 rounded-lg ${s.connected?"bg-green-500/10 border border-green-500/30":"bg-red-500/10 border border-red-500/30"}`,children:s.connected?t.jsxs(t.Fragment,{children:[t.jsx(Xt,{className:"w-4 h-4 text-green-400"}),t.jsx("span",{className:"text-green-400 text-sm",children:"Connection successful"})]}):t.jsxs(t.Fragment,{children:[t.jsx(Ua,{className:"w-4 h-4 text-red-400"}),t.jsx("span",{className:"text-red-400 text-sm",children:s.error||"Connection failed"})]})}),t.jsx("p",{className:"text-xs text-gray-500",children:"The VOD service provides access to Disney+ and other streaming content for download. Downloads will be saved to your configured movie and TV show library paths."})]})]})}function g8(){const a=k.useRef(null),[e,s]=k.useState(!1),[n,i]=k.useState(!1),[l,o]=k.useState(null),[d,h]=k.useState(null),[u,f]=k.useState(null),{data:g,isLoading:p}=Fe({queryKey:["configStats"],queryFn:()=>pe.getConfigStats(),retry:1}),b=async()=>{s(!0),f(null);try{const N=await pe.exportConfig(),C=window.URL.createObjectURL(N),T=document.createElement("a");T.href=C,T.download=`openflix-config-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(T),T.click(),window.URL.revokeObjectURL(C),document.body.removeChild(T)}catch(N){f(N.message||"Failed to export configuration")}finally{s(!1)}},y=async N=>{const C=N.target.files?.[0];if(C){f(null),o(null),i(!0);try{const T=await C.text(),L=JSON.parse(T),F=await pe.importConfig(L,!0);o(F),h(L)}catch(T){f(T.message||"Failed to parse configuration file")}finally{i(!1),a.current&&(a.current.value="")}}},v=async()=>{if(d){i(!0),f(null);try{const N=await pe.importConfig(d,!1);o(N),h(null)}catch(N){f(N.message||"Failed to import configuration")}finally{i(!1)}}},_=()=>{h(null),o(null)};return t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Configuration Backup"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-sm text-gray-400",children:"Export your entire OpenFlix configuration including channels, sources, EPG, libraries, users, playlists, and more."}),!p&&g&&t.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-5 gap-3 p-4 bg-gray-900 rounded-lg",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xl font-semibold text-white",children:g.channels}),t.jsx("div",{className:"text-xs text-gray-500",children:"Channels"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xl font-semibold text-white",children:g.m3uSources+g.xtreamSources}),t.jsx("div",{className:"text-xs text-gray-500",children:"Sources"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xl font-semibold text-white",children:g.epgSources}),t.jsx("div",{className:"text-xs text-gray-500",children:"EPG"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xl font-semibold text-white",children:g.libraries}),t.jsx("div",{className:"text-xs text-gray-500",children:"Libraries"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xl font-semibold text-white",children:g.recordings}),t.jsx("div",{className:"text-xs text-gray-500",children:"Recordings"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xl font-semibold text-white",children:g.users}),t.jsx("div",{className:"text-xs text-gray-500",children:"Users"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xl font-semibold text-white",children:g.playlists}),t.jsx("div",{className:"text-xs text-gray-500",children:"Playlists"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xl font-semibold text-white",children:g.seriesRules+g.teamPasses}),t.jsx("div",{className:"text-xs text-gray-500",children:"DVR Rules"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xl font-semibold text-white",children:g.watchHistory}),t.jsx("div",{className:"text-xs text-gray-500",children:"Watch History"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xl font-semibold text-white",children:g.settings}),t.jsx("div",{className:"text-xs text-gray-500",children:"Settings"})]})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("button",{onClick:b,disabled:e,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg",children:[e?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):t.jsx(gs,{className:"h-4 w-4"}),e?"Exporting...":"Export Configuration"]}),t.jsx("input",{ref:a,type:"file",accept:".json",onChange:y,className:"hidden"}),t.jsxs("button",{onClick:()=>a.current?.click(),disabled:n,className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 text-white rounded-lg",children:[n?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):t.jsx(Mi,{className:"h-4 w-4"}),n?"Processing...":"Import Configuration"]})]}),u&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:[t.jsx(Ua,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),t.jsx("span",{className:"text-red-400 text-sm",children:u})]}),l&&d!==null&&t.jsxs("div",{className:"p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg",children:[t.jsxs("div",{className:"flex items-start gap-2 mb-3",children:[t.jsx(kt,{className:"h-5 w-5 text-yellow-400 flex-shrink-0 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-yellow-400",children:"Import Preview"}),t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"This will import the following items. Existing items with the same ID will be updated."})]})]}),l.version&&t.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:["Export version: ",l.version," | Exported: ",l.exportedAt?new Date(l.exportedAt).toLocaleString():"Unknown"]}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 mb-4",children:l.counts&&Object.entries(l.counts).map(([N,C])=>C>0?t.jsxs("div",{className:"text-center p-2 bg-gray-800 rounded",children:[t.jsx("div",{className:"text-lg font-semibold text-white",children:C}),t.jsx("div",{className:"text-xs text-gray-500 capitalize",children:N.replace(/([A-Z])/g," $1").trim()})]},N):null)}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:v,disabled:n,className:"flex items-center gap-2 px-4 py-2 bg-yellow-600 hover:bg-yellow-700 disabled:bg-yellow-800 text-white rounded-lg",children:[n?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):t.jsx(Xt,{className:"h-4 w-4"}),n?"Importing...":"Confirm Import"]}),t.jsx("button",{onClick:_,disabled:n,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"})]})]}),l&&l.success&&d===null&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-500/10 border border-green-500/30 rounded-lg",children:[t.jsx(Xt,{className:"h-4 w-4 text-green-400 flex-shrink-0"}),t.jsxs("span",{className:"text-green-400 text-sm",children:["Configuration imported successfully!",l.imported&&t.jsxs("span",{className:"text-gray-400 ml-2",children:["(",Object.entries(l.imported).filter(([,N])=>N>0).map(([N,C])=>`${C} ${N}`).join(", "),")"]})]})]}),t.jsx("p",{className:"text-xs text-gray-500",children:"Note: Passwords and sensitive credentials are not included in exports for security."})]})]})}const kc="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",al="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",ji="w-32 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",p8="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-gray-400 cursor-not-allowed";function x8(){const{data:a,isLoading:e,error:s}=h8(),n=at(),[i,l]=k.useState({}),[o,d]=k.useState(!1);k.useEffect(()=>{a&&l(a)},[a]);const h=Me({mutationFn:g=>pe.updateServerConfig(g),onSuccess:()=>{n.invalidateQueries({queryKey:["serverConfig"]}),d(!0),setTimeout(()=>d(!1),3e3)}}),u=()=>{h.mutate(i)},f=(g,p)=>{l(b=>({...b,[g]:p}))};return e?t.jsx("div",{className:"text-gray-400",children:"Loading settings..."}):s?t.jsxs("div",{children:[t.jsxs("div",{className:"mb-8",children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Settings"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Server configuration"})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsx("p",{className:"text-yellow-400 mb-4",children:"Settings API not available. Configure via config.yaml file."}),t.jsx("pre",{className:"text-sm text-gray-300 bg-gray-900 p-4 rounded-lg overflow-x-auto",children:`# ~/.openflix/config.yaml or ./config.yaml

server:
  host: "0.0.0.0"
  port: 32400

auth:
  jwt_secret: "change-me-in-production"
  token_expiry: 720
  allow_signup: true

library:
  scan_interval: 60
  metadata_lang: "en"
  tmdb_api_key: ""

livetv:
  enabled: true
  epg_interval: 12

dvr:
  enabled: true
  recording_dir: "~/.openflix/recordings"
  pre_padding: 2
  post_padding: 5

transcode:
  enabled: true
  ffmpeg_path: "ffmpeg"
  hardware_accel: "auto"
  max_sessions: 3`})]})]}):t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Settings"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Configure your OpenFlix server"})]}),t.jsxs("button",{onClick:u,disabled:h.isPending,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg",children:[t.jsx(ii,{className:"h-4 w-4"}),h.isPending?"Saving...":o?"Saved!":"Save Changes"]})]}),t.jsxs("div",{className:"flex gap-1 mb-8 bg-gray-800 rounded-lg p-1 w-fit",children:[t.jsx(Ss,{to:"/ui/settings",className:"px-4 py-2 rounded-md text-sm font-medium bg-indigo-600 text-white",children:"General"}),t.jsx(Ss,{to:"/ui/settings/sources",className:"px-4 py-2 rounded-md text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700 transition-colors",children:"Sources"}),t.jsx(Ss,{to:"/ui/settings/livetv-dvr",className:"px-4 py-2 rounded-md text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700 transition-colors",children:"Live TV & DVR"}),t.jsx(Ss,{to:"/ui/settings/advanced",className:"px-4 py-2 rounded-md text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700 transition-colors",children:"Advanced"}),t.jsx(Ss,{to:"/ui/settings/status",className:"px-4 py-2 rounded-md text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700 transition-colors",children:"Status"})]}),t.jsxs(lo,{title:"Server Settings",icon:t.jsx(td,{className:"h-5 w-5 text-indigo-400"}),children:[t.jsx(hs,{label:"Server Name",description:"Friendly name shown to clients on your network",children:t.jsx("input",{type:"text",value:i.server_name||"",onChange:g=>f("server_name",g.target.value),className:kc,placeholder:"OpenFlix Server"})}),t.jsx(hs,{label:"Server Port",description:"Port the server listens on. Requires restart to take effect.",children:t.jsx("input",{type:"number",min:"1",max:"65535",value:i.server_port||32400,onChange:g=>f("server_port",Number(g.target.value)),className:ji})}),t.jsx(hs,{label:"Log Level",description:"Controls the verbosity of server logs",children:t.jsxs("select",{value:i.log_level||"info",onChange:g=>f("log_level",g.target.value),className:al,children:[t.jsx("option",{value:"debug",children:"Debug"}),t.jsx("option",{value:"info",children:"Info"}),t.jsx("option",{value:"warn",children:"Warning"}),t.jsx("option",{value:"error",children:"Error"})]})}),t.jsx(hs,{label:"Data Directory",description:"Where OpenFlix stores its database, cache, and media files",children:t.jsx("input",{type:"text",value:i.data_dir||"",readOnly:!0,className:p8})})]}),t.jsxs(lo,{title:"Metadata",children:[t.jsx(hs,{label:"TMDB API Key",description:"For movie and TV show metadata (get yours at themoviedb.org)",children:t.jsx("input",{type:"password",value:i.tmdb_api_key||"",onChange:g=>f("tmdb_api_key",g.target.value),className:kc,placeholder:"Enter your TMDB API key"})}),t.jsx(hs,{label:"TVDB API Key",description:"For additional TV show metadata (optional)",children:t.jsx("input",{type:"password",value:i.tvdb_api_key||"",onChange:g=>f("tvdb_api_key",g.target.value),className:kc,placeholder:"Enter your TVDB API key"})}),t.jsx(hs,{label:"Metadata Language",description:"Preferred language for metadata",children:t.jsxs("select",{value:i.metadata_lang||"en",onChange:g=>f("metadata_lang",g.target.value),className:al,children:[t.jsx("option",{value:"en",children:"English"}),t.jsx("option",{value:"es",children:"Spanish"}),t.jsx("option",{value:"fr",children:"French"}),t.jsx("option",{value:"de",children:"German"}),t.jsx("option",{value:"it",children:"Italian"}),t.jsx("option",{value:"pt",children:"Portuguese"}),t.jsx("option",{value:"ja",children:"Japanese"}),t.jsx("option",{value:"ko",children:"Korean"}),t.jsx("option",{value:"zh",children:"Chinese"})]})}),t.jsx(hs,{label:"Scan Interval",description:"Minutes between automatic library scans",children:t.jsx("input",{type:"number",value:i.scan_interval||60,onChange:g=>f("scan_interval",Number(g.target.value)),className:ji})})]}),t.jsxs(lo,{title:"Live TV",icon:t.jsx(jt,{className:"h-5 w-5 text-blue-400"}),children:[t.jsx(hs,{label:"Max Concurrent Streams",description:"Maximum number of simultaneous live TV streams. 0 = unlimited.",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"number",min:"0",value:i.livetv_max_streams??0,onChange:g=>f("livetv_max_streams",Number(g.target.value)),className:ji}),t.jsx("span",{className:"text-gray-400 text-sm",children:(i.livetv_max_streams??0)===0?"(Unlimited)":"streams"})]})}),t.jsx(hs,{label:"Timeshift Buffer Duration",description:"Hours of live TV kept for pause/rewind. Higher values use more disk space.",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"number",min:"1",max:"72",value:i.timeshift_buffer_hrs||4,onChange:g=>f("timeshift_buffer_hrs",Number(g.target.value)),className:ji}),t.jsx("span",{className:"text-gray-400 text-sm",children:"hours"})]})}),t.jsx(hs,{label:"EPG Refresh Interval",description:"How often to fetch updated program guide data",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"number",min:"1",max:"48",value:i.epg_refresh_interval||4,onChange:g=>f("epg_refresh_interval",Number(g.target.value)),className:ji}),t.jsx("span",{className:"text-gray-400 text-sm",children:"hours"})]})}),t.jsx(hs,{label:"Channel Switch Buffer Size",description:"Seconds of buffer to maintain for faster channel switching",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"number",min:"1",max:"30",value:i.channel_switch_buffer||3,onChange:g=>f("channel_switch_buffer",Number(g.target.value)),className:ji}),t.jsx("span",{className:"text-gray-400 text-sm",children:"seconds"})]})}),t.jsxs("div",{className:"flex items-center justify-between pt-2",children:[t.jsx(hs,{label:"Tuner Sharing",description:"Allow multiple clients to share the same tuner when watching the same channel",children:t.jsx("span",{})}),t.jsx(Vg,{checked:i.tuner_sharing??!0,onChange:g=>f("tuner_sharing",g),label:"Tuner Sharing"})]})]}),t.jsxs(lo,{title:"DVR",icon:t.jsx($a,{className:"h-5 w-5 text-red-400"}),children:[t.jsx(hs,{label:"Recording Directory",description:"Where DVR recordings are saved",children:t.jsx("input",{type:"text",value:i.recording_dir||"",onChange:g=>f("recording_dir",g.target.value),className:kc,placeholder:"~/.openflix/recordings"})}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsx(hs,{label:"Pre-Padding Default",description:"Minutes to start recording before scheduled time",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"number",min:"0",max:"60",value:i.pre_padding??2,onChange:g=>f("pre_padding",Number(g.target.value)),className:ji}),t.jsx("span",{className:"text-gray-400 text-sm",children:"minutes"})]})}),t.jsx(hs,{label:"Post-Padding Default",description:"Minutes to continue recording after scheduled end",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"number",min:"0",max:"120",value:i.post_padding??5,onChange:g=>f("post_padding",Number(g.target.value)),className:ji}),t.jsx("span",{className:"text-gray-400 text-sm",children:"minutes"})]})})]}),t.jsxs("div",{className:"flex items-center justify-between pt-2",children:[t.jsx(hs,{label:"Auto Commercial Detection",description:"Run commercial detection on completed recordings using Comskip",children:t.jsx("span",{})}),t.jsx(Vg,{checked:i.commercial_detect??!0,onChange:g=>f("commercial_detect",g),label:"Auto Commercial Detection"})]}),t.jsx(hs,{label:"Auto-Delete After",description:"Automatically delete recordings after this many days. 0 = never auto-delete.",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"number",min:"0",value:i.auto_delete_days??0,onChange:g=>f("auto_delete_days",Number(g.target.value)),className:ji}),t.jsx("span",{className:"text-gray-400 text-sm",children:(i.auto_delete_days??0)===0?"days (never)":"days"})]})}),t.jsx(hs,{label:"Max Recording Quality",description:"Maximum quality for new recordings",children:t.jsxs("select",{value:i.max_record_quality||"original",onChange:g=>f("max_record_quality",g.target.value),className:al,children:[t.jsx("option",{value:"original",children:"Original (no re-encode)"}),t.jsx("option",{value:"high",children:"High (1080p)"}),t.jsx("option",{value:"medium",children:"Medium (720p)"}),t.jsx("option",{value:"low",children:"Low (480p)"})]})})]}),t.jsx(f8,{}),t.jsxs(lo,{title:"Remote Access",icon:t.jsx(vo,{className:"h-5 w-5 text-green-400"}),children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"Tailscale Status"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Tailscale provides secure remote access to your server via WireGuard VPN"})]}),t.jsx("div",{className:"flex items-center gap-2",children:i.tailscale_status==="connected"?t.jsxs(t.Fragment,{children:[t.jsx(Xt,{className:"h-4 w-4 text-green-400"}),t.jsx("span",{className:"text-sm text-green-400",children:"Connected"})]}):t.jsxs(t.Fragment,{children:[t.jsx(Ua,{className:"h-4 w-4 text-gray-500"}),t.jsx("span",{className:"text-sm text-gray-500 capitalize",children:i.tailscale_status||"Disconnected"})]})})]}),t.jsxs("div",{className:"flex items-center justify-between pt-2",children:[t.jsx(hs,{label:"Remote Access",description:"Enable access to your server from outside your local network",children:t.jsx("span",{})}),t.jsx(Vg,{checked:i.remote_access_enabled??!1,onChange:g=>f("remote_access_enabled",g),label:"Remote Access"})]}),t.jsx(hs,{label:"External URL",description:"The external URL clients use to reach your server (optional, auto-detected via Tailscale)",children:t.jsx("input",{type:"text",value:i.external_url||"",onChange:g=>f("external_url",g.target.value),className:kc,placeholder:"https://openflix.your-tailnet.ts.net"})})]}),t.jsxs(lo,{title:"Playback Defaults",icon:t.jsx(xs,{className:"h-5 w-5 text-purple-400"}),children:[t.jsx(hs,{label:"Default Playback Speed",description:"Default speed for video playback",children:t.jsxs("select",{value:i.default_playback_speed||"1.0",onChange:g=>f("default_playback_speed",g.target.value),className:al,children:[t.jsx("option",{value:"0.5",children:"0.5x"}),t.jsx("option",{value:"0.75",children:"0.75x"}),t.jsx("option",{value:"1.0",children:"1.0x (Normal)"}),t.jsx("option",{value:"1.25",children:"1.25x"}),t.jsx("option",{value:"1.5",children:"1.5x"}),t.jsx("option",{value:"1.75",children:"1.75x"}),t.jsx("option",{value:"2.0",children:"2.0x"})]})}),t.jsx(hs,{label:"Frame Rate Matching",description:"Match display refresh rate to content frame rate",children:t.jsxs("select",{value:i.frame_rate_match_mode||"auto",onChange:g=>f("frame_rate_match_mode",g.target.value),className:al,children:[t.jsx("option",{value:"auto",children:"Auto"}),t.jsx("option",{value:"always",children:"Always"}),t.jsx("option",{value:"never",children:"Never"})]})}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsx(hs,{label:"Default Subtitle Language",description:"Preferred language for subtitles",children:t.jsxs("select",{value:i.default_subtitle_language||"",onChange:g=>f("default_subtitle_language",g.target.value),className:al,children:[t.jsx("option",{value:"",children:"None (Off)"}),t.jsx("option",{value:"en",children:"English"}),t.jsx("option",{value:"es",children:"Spanish"}),t.jsx("option",{value:"fr",children:"French"}),t.jsx("option",{value:"de",children:"German"}),t.jsx("option",{value:"it",children:"Italian"}),t.jsx("option",{value:"pt",children:"Portuguese"}),t.jsx("option",{value:"ja",children:"Japanese"}),t.jsx("option",{value:"ko",children:"Korean"}),t.jsx("option",{value:"zh",children:"Chinese"}),t.jsx("option",{value:"ar",children:"Arabic"}),t.jsx("option",{value:"ru",children:"Russian"}),t.jsx("option",{value:"hi",children:"Hindi"})]})}),t.jsx(hs,{label:"Default Audio Language",description:"Preferred language for audio tracks",children:t.jsxs("select",{value:i.default_audio_language||"en",onChange:g=>f("default_audio_language",g.target.value),className:al,children:[t.jsx("option",{value:"en",children:"English"}),t.jsx("option",{value:"es",children:"Spanish"}),t.jsx("option",{value:"fr",children:"French"}),t.jsx("option",{value:"de",children:"German"}),t.jsx("option",{value:"it",children:"Italian"}),t.jsx("option",{value:"pt",children:"Portuguese"}),t.jsx("option",{value:"ja",children:"Japanese"}),t.jsx("option",{value:"ko",children:"Korean"}),t.jsx("option",{value:"zh",children:"Chinese"}),t.jsx("option",{value:"ar",children:"Arabic"}),t.jsx("option",{value:"ru",children:"Russian"}),t.jsx("option",{value:"hi",children:"Hindi"})]})})]})]}),t.jsx(m8,{vodApiUrl:i.vod_api_url||"",onUrlChange:g=>f("vod_api_url",g)}),t.jsx(g8,{})]})}function y8({active:a}){const e=[{id:"general",label:"General",path:"/ui/settings"},{id:"sources",label:"Sources",path:"/ui/settings/sources"},{id:"livetv-dvr",label:"Live TV & DVR",path:"/ui/settings/livetv-dvr"},{id:"advanced",label:"Advanced",path:"/ui/settings/advanced"},{id:"status",label:"Status",path:"/ui/settings/status"}];return t.jsx("div",{className:"flex gap-1 mb-8 bg-gray-800 rounded-lg p-1 w-fit",children:e.map(s=>t.jsx(Ss,{to:s.path,className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${a===s.id?"bg-indigo-600 text-white":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:s.label},s.id))})}function b8(){const a=at(),{data:e,isLoading:s}=Fe({queryKey:["libraries"],queryFn:()=>pe.getLibraries()}),n=Me({mutationFn:h=>pe.scanLibrary(h),onSuccess:()=>{a.invalidateQueries({queryKey:["libraries"]})}}),i=(e||[]).filter(h=>h.type==="movie"),l=(e||[]).filter(h=>h.type==="show"),o=(e||[]).filter(h=>h.type!=="movie"&&h.type!=="show"),d=[{title:"Movies",icon:t.jsx(Gt,{className:"h-4 w-4 text-yellow-400"}),libraries:i},{title:"TV Shows",icon:t.jsx($h,{className:"h-4 w-4 text-blue-400"}),libraries:l},{title:"Other",icon:t.jsx($a,{className:"h-4 w-4 text-gray-400"}),libraries:o}].filter(h=>h.libraries.length>0);return t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[t.jsx(sa,{className:"h-5 w-5 text-green-400"}),"Personal Media"]}),t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Library folders for movies, TV shows, and other personal media"})]}),t.jsxs(Ss,{to:"/ui/libraries",className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm",children:[t.jsx(si,{className:"h-4 w-4"}),"Manage Libraries"]})]}),s?t.jsxs("div",{className:"flex items-center gap-2 text-gray-400 py-8 justify-center",children:[t.jsx(Ke,{className:"h-5 w-5 animate-spin"}),"Loading libraries..."]}):(e||[]).length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(sa,{className:"h-8 w-8 text-gray-600 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-400",children:"No libraries configured"}),t.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Add movie and TV show folders to get started"}),t.jsxs(Ss,{to:"/ui/libraries",className:"inline-flex items-center gap-2 mt-4 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm",children:[t.jsx(Pt,{className:"h-4 w-4"}),"Add Library"]})]}):t.jsx("div",{className:"space-y-6",children:d.map(h=>t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-medium text-gray-300 flex items-center gap-2 mb-3",children:[h.icon,h.title]}),t.jsx("div",{className:"space-y-2",children:h.libraries.map(u=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-900 rounded-lg border border-gray-700",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(sa,{className:"h-4 w-4 text-gray-500"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-white",children:u.title}),t.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:u.paths&&u.paths.length>0?u.paths.map(f=>f.path).join(", "):"No paths configured"}),u.scannedAt&&t.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["Last scanned: ",new Date(u.scannedAt).toLocaleDateString()]})]})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("button",{onClick:()=>n.mutate(u.id),disabled:n.isPending,className:"flex items-center gap-1.5 px-3 py-1.5 text-sm bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 text-white rounded-lg",title:"Scan library",children:[n.isPending?t.jsx(Ke,{className:"h-3.5 w-3.5 animate-spin"}):t.jsx(xt,{className:"h-3.5 w-3.5"}),"Scan"]})})]},u.id))})]},h.title))})]})}function v8(){return t.jsxs("div",{children:[t.jsxs("div",{className:"mb-2",children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Settings"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Manage your content sources"})]}),t.jsx(y8,{active:"sources"}),t.jsx(b8,{})]})}function qg({active:a}){const e=[{id:"general",label:"General",path:"/ui/settings"},{id:"sources",label:"Sources",path:"/ui/settings/sources"},{id:"livetv-dvr",label:"Live TV & DVR",path:"/ui/settings/livetv-dvr"},{id:"advanced",label:"Advanced",path:"/ui/settings/advanced"},{id:"status",label:"Status",path:"/ui/settings/status"}];return t.jsx("div",{className:"flex gap-1 mb-8 bg-gray-800 rounded-lg p-1 w-fit",children:e.map(s=>t.jsx(Ss,{to:s.path,className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${a===s.id?"bg-indigo-600 text-white":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:s.label},s.id))})}function Vu({title:a,description:e,icon:s,children:n}){return t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[t.jsxs("div",{className:"mb-4",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[s,a]}),e&&t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:e})]}),t.jsx("div",{className:"space-y-4",children:n})]})}function Ei({label:a,description:e,children:s}){return t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:a}),e&&t.jsx("p",{className:"text-xs text-gray-500 mb-2",children:e}),s]})}function _8({checked:a,onChange:e,label:s}){return t.jsxs("button",{type:"button",role:"switch","aria-checked":a,onClick:()=>e(!a),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${a?"bg-indigo-600":"bg-gray-600"}`,children:[t.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${a?"translate-x-6":"translate-x-1"}`}),s&&t.jsx("span",{className:"sr-only",children:s})]})}function nl({label:a,description:e,checked:s,onChange:n}){return t.jsxs("div",{className:"flex items-center justify-between py-2",children:[t.jsxs("div",{className:"flex-1 mr-4",children:[t.jsx("div",{className:"text-sm font-medium text-gray-300",children:a}),e&&t.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:e})]}),t.jsx(_8,{checked:s,onChange:n,label:a})]})}const N8="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",Rc="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",Kg="w-32 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white";function w8(){const a=at(),[e,s]=k.useState({}),[n,i]=k.useState(!1),{data:l,isLoading:o,error:d}=Fe({queryKey:["serverConfig"],queryFn:()=>pe.getServerConfig(),retry:!1});k.useEffect(()=>{l&&s(l)},[l]);const h=Me({mutationFn:g=>pe.updateServerConfig(g),onSuccess:()=>{a.invalidateQueries({queryKey:["serverConfig"]}),i(!0),setTimeout(()=>i(!1),3e3)}}),u=()=>{h.mutate(e)},f=(g,p)=>{s(b=>({...b,[g]:p}))};return o?t.jsxs("div",{children:[t.jsxs("div",{className:"mb-2",children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Settings"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Advanced configuration"})]}),t.jsx(qg,{active:"advanced"}),t.jsxs("div",{className:"flex items-center gap-2 text-gray-400 py-12 justify-center",children:[t.jsx(Ke,{className:"h-5 w-5 animate-spin"}),"Loading settings..."]})]}):d?t.jsxs("div",{children:[t.jsxs("div",{className:"mb-2",children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Settings"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Advanced configuration"})]}),t.jsx(qg,{active:"advanced"}),t.jsx("div",{className:"bg-gray-800 rounded-xl p-6",children:t.jsx("p",{className:"text-yellow-400",children:"Settings API not available. Configure via config.yaml file."})})]}):t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Settings"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Advanced configuration"})]}),t.jsxs("button",{onClick:u,disabled:h.isPending,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg",children:[t.jsx(ii,{className:"h-4 w-4"}),h.isPending?"Saving...":n?"Saved!":"Save Changes"]})]}),t.jsx(qg,{active:"advanced"}),t.jsxs(Vu,{title:"Transcoder",description:"Configure how live TV and recordings are transcoded",icon:t.jsx(Nr,{className:"h-5 w-5 text-orange-400"}),children:[t.jsx(Ei,{label:"Transcoder Type",description:"Hardware acceleration method for transcoding. Software is most compatible but slowest.",children:t.jsxs("select",{value:e.transcoder_type||"software",onChange:g=>f("transcoder_type",g.target.value),className:Rc,children:[t.jsx("option",{value:"software",children:"Software (CPU)"}),t.jsx("option",{value:"nvenc",children:"NVIDIA NVENC"}),t.jsx("option",{value:"qsv",children:"Intel Quick Sync (QSV)"}),t.jsx("option",{value:"vaapi",children:"VAAPI (Linux)"}),t.jsx("option",{value:"videotoolbox",children:"VideoToolbox (macOS)"})]})}),t.jsx(Ei,{label:"Deinterlacer Mode",description:"Method used to deinterlace interlaced video content (common in live TV)",children:t.jsxs("select",{value:e.deinterlacer_mode||"blend",onChange:g=>f("deinterlacer_mode",g.target.value),className:Rc,children:[t.jsx("option",{value:"blend",children:"Blend (faster, good quality)"}),t.jsx("option",{value:"linear",children:"Linear (slower, better quality)"})]})}),t.jsx(Ei,{label:"Live TV Buffer Duration",description:"Seconds of video to buffer before playback starts. Higher values reduce stuttering but increase startup time.",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"number",min:"2",max:"30",value:e.livetv_buffer_secs||8,onChange:g=>f("livetv_buffer_secs",Number(g.target.value)),className:Kg}),t.jsx("span",{className:"text-gray-400 text-sm",children:"seconds"})]})}),t.jsx(Ei,{label:"Max Concurrent Transcode Sessions",description:"Limit simultaneous transcodes to prevent CPU/GPU overload",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"number",min:"1",max:"20",value:e.max_transcode_sessions||3,onChange:g=>f("max_transcode_sessions",Number(g.target.value)),className:Kg}),t.jsx("span",{className:"text-gray-400 text-sm",children:"sessions"})]})}),t.jsx(Ei,{label:"Transcode Temp Directory",description:"Temporary directory for transcode output files",children:t.jsx("input",{type:"text",value:e.transcode_temp_dir||"",onChange:g=>f("transcode_temp_dir",g.target.value),className:N8,placeholder:"~/.openflix/transcode"})}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsx(Ei,{label:"Default Video Codec",description:"Preferred output video codec for transcoding",children:t.jsxs("select",{value:e.default_video_codec||"h264",onChange:g=>f("default_video_codec",g.target.value),className:Rc,children:[t.jsx("option",{value:"h264",children:"H.264 (AVC)"}),t.jsx("option",{value:"hevc",children:"H.265 (HEVC)"}),t.jsx("option",{value:"copy",children:"Copy (no re-encode)"})]})}),t.jsx(Ei,{label:"Default Audio Codec",description:"Preferred output audio codec for transcoding",children:t.jsxs("select",{value:e.default_audio_codec||"aac",onChange:g=>f("default_audio_codec",g.target.value),className:Rc,children:[t.jsx("option",{value:"aac",children:"AAC"}),t.jsx("option",{value:"ac3",children:"AC3 (Dolby Digital)"}),t.jsx("option",{value:"copy",children:"Copy (no re-encode)"})]})})]})]}),t.jsxs(Vu,{title:"Web Player",description:"Configure the built-in web player for browser-based playback",icon:t.jsx(_o,{className:"h-5 w-5 text-blue-400"}),children:[t.jsx(Ei,{label:"Playback Quality",description:"Default streaming quality for the web player. Lower quality uses less bandwidth.",children:t.jsxs("select",{value:e.playback_quality||"original",onChange:g=>f("playback_quality",g.target.value),className:Rc,children:[t.jsx("option",{value:"original",children:"Original Quality"}),t.jsx("option",{value:"1080p",children:"1080p (8 Mbps)"}),t.jsx("option",{value:"720p",children:"720p (4 Mbps)"}),t.jsx("option",{value:"480p",children:"480p (2 Mbps)"}),t.jsx("option",{value:"360p",children:"360p (1 Mbps)"})]})}),t.jsx(Ei,{label:"Client Buffer Duration",description:"Seconds of video the player will buffer ahead. Higher values prevent buffering on slow connections.",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"number",min:"1",max:"30",value:e.client_buffer_secs||5,onChange:g=>f("client_buffer_secs",Number(g.target.value)),className:Kg}),t.jsx("span",{className:"text-gray-400 text-sm",children:"seconds"})]})})]}),t.jsxs(Vu,{title:"Integrations",description:"External tool integration and data export options",icon:t.jsx(vk,{className:"h-5 w-5 text-green-400"}),children:[t.jsx(nl,{label:"EDL Export",description:"Export Edit Decision List files alongside recordings for use in external editors (Kodi, etc.)",checked:e.edl_export??!1,onChange:g=>f("edl_export",g)}),t.jsx("div",{className:"border-t border-gray-700"}),t.jsx(nl,{label:"M3U Channel IDs",description:"Include tvc-guide-stationid tags in exported M3U playlists for EPG mapping in other apps",checked:e.m3u_channel_ids??!1,onChange:g=>f("m3u_channel_ids",g)}),t.jsx("div",{className:"border-t border-gray-700"}),t.jsx(nl,{label:"VLC Links",description:"Generate VLC-compatible stream links for direct playback in VLC media player",checked:e.vlc_links??!1,onChange:g=>f("vlc_links",g)}),t.jsx("div",{className:"border-t border-gray-700"}),t.jsx(nl,{label:"HTTP Logging",description:"Log all HTTP requests and responses for debugging. May impact performance and generate large log files.",checked:e.http_logging??!1,onChange:g=>f("http_logging",g)})]}),t.jsxs(Vu,{title:"Experimental",description:"Features under development. These may be unstable or change without notice.",icon:t.jsx(i4,{className:"h-5 w-5 text-purple-400"}),children:[t.jsx("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg mb-4",children:t.jsx("p",{className:"text-xs text-yellow-400",children:"These features are experimental and may not work correctly. Enable at your own risk."})}),t.jsx(nl,{label:"HDR Tone Mapping",description:"Enable HDR to SDR tone mapping for clients that do not support HDR. Requires hardware transcoding support.",checked:e.experimental_hdr??!1,onChange:g=>f("experimental_hdr",g)}),t.jsx("div",{className:"border-t border-gray-700"}),t.jsx(nl,{label:"Low Latency Mode",description:"Reduce live TV latency by using smaller buffer segments. May cause more frequent buffering on slow connections.",checked:e.experimental_low_latency??!1,onChange:g=>f("experimental_low_latency",g)}),t.jsx("div",{className:"border-t border-gray-700"}),t.jsx(nl,{label:"AI Metadata Enhancement",description:"Use AI models to improve metadata quality, generate better descriptions, and auto-tag content categories.",checked:e.experimental_ai_metadata??!1,onChange:g=>f("experimental_ai_metadata",g)})]})]})}function HN({active:a}){const e=[{id:"general",label:"General",path:"/ui/settings"},{id:"sources",label:"Sources",path:"/ui/settings/sources"},{id:"livetv-dvr",label:"Live TV & DVR",path:"/ui/settings/livetv-dvr"},{id:"advanced",label:"Advanced",path:"/ui/settings/advanced"},{id:"status",label:"Status",path:"/ui/settings/status"}];return t.jsx("div",{className:"flex gap-1 mb-8 bg-gray-800 rounded-lg p-1 w-fit",children:e.map(s=>t.jsx(Ss,{to:s.path,className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${a===s.id?"bg-indigo-600 text-white":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:s.label},s.id))})}function Lc({title:a,description:e,icon:s,children:n}){return t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[t.jsxs("div",{className:"mb-4",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[s,a]}),e&&t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:e})]}),t.jsx("div",{className:"space-y-4",children:n})]})}function Ti({label:a,description:e,children:s}){return t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:a}),e&&t.jsx("p",{className:"text-xs text-gray-500 mb-2",children:e}),s]})}function qu({checked:a,onChange:e,label:s}){return t.jsxs("button",{type:"button",role:"switch","aria-checked":a,onClick:()=>e(!a),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${a?"bg-indigo-600":"bg-gray-600"}`,children:[t.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${a?"translate-x-6":"translate-x-1"}`}),s&&t.jsx("span",{className:"sr-only",children:s})]})}const xr="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",S8="w-32 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",j8=[0,1,2,3,5,10,15],E8=[0,1,2,3,5,10,15,30],T8=[{value:"original",label:"Original (Pass-through)"},{value:"high",label:"High Quality (1080p)"},{value:"medium",label:"Medium Quality (720p)"},{value:"low",label:"Low Quality (480p)"}],A8=[{value:"all",label:"Keep All"},{value:"3",label:"Keep 3"},{value:"5",label:"Keep 5"},{value:"10",label:"Keep 10"},{value:"latest",label:"Keep Latest Only"}],C8=[{value:"off",label:"Off"},{value:"comskip",label:"Comskip"},{value:"chapters",label:"Chapter Markers"}],k8=[{value:6,label:"Every 6 hours"},{value:12,label:"Every 12 hours"},{value:24,label:"Every 24 hours"}],R8=[{value:"off",label:"Off"},{value:"blend",label:"Blend"},{value:"linear",label:"Linear"}],L8=[{value:"30s",label:"30 seconds"},{value:"1min",label:"1 minute"},{value:"5min",label:"5 minutes"},{value:"15min",label:"15 minutes"},{value:"30min",label:"30 minutes"},{value:"1hr",label:"1 hour"}];function D8(){const a=at(),[e,s]=k.useState({}),[n,i]=k.useState(!1),[l,o]=k.useState(!1),[d,h]=k.useState(!1),{data:u,isLoading:f,error:g}=Fe({queryKey:["serverConfig"],queryFn:()=>pe.getServerConfig(),retry:!1});k.useEffect(()=>{u&&s(u)},[u]);const p=Me({mutationFn:N=>pe.updateServerConfig(N),onSuccess:()=>{a.invalidateQueries({queryKey:["serverConfig"]}),i(!0),setTimeout(()=>i(!1),3e3)}}),b=()=>{p.mutate(e)},y=(N,C)=>{s(T=>({...T,[N]:C}))},v=async()=>{o(!0);try{await pe.refreshGuideData(),setTimeout(()=>o(!1),3e3)}catch{o(!1)}},_=async()=>{h(!0);try{await pe.rebuildGuideData(),setTimeout(()=>h(!1),5e3)}catch{h(!1)}};return f?t.jsx("div",{className:"text-gray-400",children:"Loading settings..."}):g?t.jsxs("div",{children:[t.jsxs("div",{className:"mb-8",children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Settings"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Live TV & DVR configuration"})]}),t.jsx(HN,{active:"livetv-dvr"}),t.jsx("div",{className:"bg-gray-800 rounded-xl p-6",children:t.jsx("p",{className:"text-yellow-400",children:"Settings API not available."})})]}):t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Settings"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Live TV & DVR configuration"})]}),t.jsxs("button",{onClick:b,disabled:p.isPending,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg",children:[t.jsx(ii,{className:"h-4 w-4"}),p.isPending?"Saving...":n?"Saved!":"Save Changes"]})]}),t.jsx(HN,{active:"livetv-dvr"}),t.jsxs(Lc,{title:"Recording Defaults",description:"Default settings applied to new DVR recordings",icon:t.jsx(Gt,{className:"h-5 w-5 text-red-400"}),children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(Ti,{label:"Pre-Padding",description:"Minutes to start recording before the scheduled start time",children:t.jsx("select",{value:e.recording_pre_padding??2,onChange:N=>y("recording_pre_padding",Number(N.target.value)),className:xr,children:j8.map(N=>t.jsx("option",{value:N,children:N===0?"None":`${N} minute${N!==1?"s":""}`},N))})}),t.jsx(Ti,{label:"Post-Padding",description:"Minutes to continue recording after the scheduled end time",children:t.jsx("select",{value:e.recording_post_padding??5,onChange:N=>y("recording_post_padding",Number(N.target.value)),className:xr,children:E8.map(N=>t.jsx("option",{value:N,children:N===0?"None":`${N} minute${N!==1?"s":""}`},N))})})]}),t.jsx(Ti,{label:"Default Quality Preset",description:"Recording quality when no specific quality is set per-pass",children:t.jsx("select",{value:e.recording_quality||"original",onChange:N=>y("recording_quality",N.target.value),className:xr,children:T8.map(N=>t.jsx("option",{value:N.value,children:N.label},N.value))})})]}),t.jsxs(Lc,{title:"Keep Rules",description:"How recordings are managed over time",icon:t.jsx(sn,{className:"h-5 w-5 text-blue-400"}),children:[t.jsx(Ti,{label:"Default Keep Rule",description:"How many episodes to keep by default for series recordings",children:t.jsx("select",{value:e.keep_rule||"all",onChange:N=>y("keep_rule",N.target.value),className:xr,children:A8.map(N=>t.jsx("option",{value:N.value,children:N.label},N.value))})}),t.jsxs("div",{className:"flex items-center justify-between py-2",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-300",children:"Auto-Delete Watched Recordings"}),t.jsx("p",{className:"text-xs text-gray-500",children:"Automatically remove recordings after they have been watched"})]}),t.jsx(qu,{checked:e.auto_delete_watched??!1,onChange:N=>y("auto_delete_watched",N),label:"Auto-delete watched recordings"})]}),t.jsxs(Ti,{label:"Auto-Delete After (days)",description:"Automatically delete recordings after this many days. Set to 0 to disable.",children:[t.jsx("input",{type:"number",min:"0",max:"365",value:e.auto_delete_days??0,onChange:N=>y("auto_delete_days",Number(N.target.value)),className:S8}),t.jsx("span",{className:"text-xs text-gray-500 ml-2",children:(e.auto_delete_days??0)===0?"(Disabled)":`(${e.auto_delete_days} days)`})]})]}),t.jsxs(Lc,{title:"Commercial Detection",description:"Detect and manage commercial breaks in recordings",icon:t.jsx(Vh,{className:"h-5 w-5 text-yellow-400"}),children:[t.jsxs("div",{className:"flex items-center justify-between py-2",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-300",children:"Enable Commercial Detection"}),t.jsx("p",{className:"text-xs text-gray-500",children:"Process recordings with Comskip to detect commercial break markers"})]}),t.jsx(qu,{checked:e.commercial_detection_enabled??!1,onChange:N=>y("commercial_detection_enabled",N),label:"Enable commercial detection"})]}),t.jsx(Ti,{label:"Comskip Mode",description:"How commercial markers are stored",children:t.jsx("select",{value:e.commercial_detection_mode||"comskip",onChange:N=>y("commercial_detection_mode",N.target.value),className:xr,disabled:!(e.commercial_detection_enabled??!1),children:C8.map(N=>t.jsx("option",{value:N.value,children:N.label},N.value))})}),t.jsxs("div",{className:"flex items-center justify-between py-2",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-300",children:"Auto-Skip Commercials on Playback"}),t.jsx("p",{className:"text-xs text-gray-500",children:"Automatically skip detected commercial segments during playback on all clients"})]}),t.jsx(qu,{checked:e.auto_skip_commercials??!1,onChange:N=>y("auto_skip_commercials",N),label:"Auto-skip commercials"})]})]}),t.jsxs(Lc,{title:"Guide Data",description:"EPG / program guide data management",icon:t.jsx(gh,{className:"h-5 w-5 text-green-400"}),children:[t.jsx(Ti,{label:"Guide Data Refresh Interval",description:"How often to automatically refresh EPG data from all configured sources",children:t.jsx("select",{value:e.guide_refresh_interval??12,onChange:N=>y("guide_refresh_interval",Number(N.target.value)),className:xr,children:k8.map(N=>t.jsx("option",{value:N.value,children:N.label},N.value))})}),t.jsxs("div",{className:"py-2",children:[t.jsx("p",{className:"text-sm font-medium text-gray-300 mb-1",children:"Guide Data Source"}),t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-900 rounded-lg",children:[t.jsx($s,{className:"h-4 w-4 text-green-400"}),t.jsx("span",{className:"text-sm text-gray-300",children:e.guide_data_source==="gracenote"?"Gracenote (OTA)":"XMLTV"}),t.jsx("span",{className:"text-xs text-gray-500 ml-auto",children:"Configured via Sources tab"})]})]}),t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsxs("button",{onClick:v,disabled:l,className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-green-800 disabled:cursor-not-allowed text-white text-sm rounded-lg transition-colors",children:[l?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):t.jsx(ut,{className:"h-4 w-4"}),l?"Refreshing...":"Refresh Guide Data Now"]}),t.jsxs("button",{onClick:_,disabled:d,className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:cursor-not-allowed text-white text-sm rounded-lg transition-colors",children:[d?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):t.jsx(Dt,{className:"h-4 w-4"}),d?"Rebuilding...":"Rebuild Guide Data"]})]}),l&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-500/10 border border-green-500/30 rounded-lg",children:[t.jsx(Xt,{className:"h-4 w-4 text-green-400"}),t.jsx("span",{className:"text-sm text-green-400",children:"Guide data refresh triggered successfully. This may take a few minutes."})]}),d&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg",children:[t.jsx(Ke,{className:"h-4 w-4 text-yellow-400 animate-spin"}),t.jsx("span",{className:"text-sm text-yellow-400",children:"Rebuilding guide data from scratch. All cached data has been cleared."})]})]}),t.jsxs(Lc,{title:"Live TV Streaming",description:"Settings for live TV stream processing",icon:t.jsx(jt,{className:"h-5 w-5 text-purple-400"}),children:[t.jsxs("div",{className:"flex items-center justify-between py-2",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-300",children:"Tuner Sharing"}),t.jsx("p",{className:"text-xs text-gray-500",children:"Allow multiple clients to share a single tuner when watching the same channel"})]}),t.jsx(qu,{checked:e.tuner_sharing??!0,onChange:N=>y("tuner_sharing",N),label:"Tuner sharing"})]}),t.jsx(Ti,{label:"Deinterlacing",description:"Deinterlacing method for interlaced content (e.g., 1080i broadcasts)",children:t.jsx("select",{value:e.deinterlacing_mode||"blend",onChange:N=>y("deinterlacing_mode",N.target.value),className:xr,children:R8.map(N=>t.jsx("option",{value:N.value,children:N.label},N.value))})}),t.jsx(Ti,{label:"Live TV Buffer Size",description:"Amount of live TV content to buffer for pause/rewind. Larger values use more memory.",children:t.jsx("select",{value:e.livetv_buffer_size||"1min",onChange:N=>y("livetv_buffer_size",N.target.value),className:xr,children:L8.map(N=>t.jsx("option",{value:N.value,children:N.label},N.value))})})]})]})}function M8({active:a}){const e=[{id:"general",label:"General",path:"/ui/settings"},{id:"sources",label:"Sources",path:"/ui/settings/sources"},{id:"advanced",label:"Advanced",path:"/ui/settings/advanced"},{id:"status",label:"Status",path:"/ui/settings/status"}];return t.jsx("div",{className:"flex gap-1 mb-8 bg-gray-800 rounded-lg p-1 w-fit",children:e.map(s=>t.jsx(Ss,{to:s.path,className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${a===s.id?"bg-indigo-600 text-white":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:s.label},s.id))})}function Hg(a){if(a===0)return"0 B";const e=["B","KB","MB","GB","TB"],s=Math.floor(Math.log(a)/Math.log(1024));return`${(a/Math.pow(1024,s)).toFixed(1)} ${e[s]}`}function uj({value:a,max:e,label:s,sublabel:n,color:i="bg-indigo-600"}){const l=e>0?Math.min(100,Math.round(a/e*100)):0;return t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between text-sm mb-1.5",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-300",children:s}),n&&t.jsx("span",{className:"text-gray-500 ml-2 text-xs",children:n})]}),t.jsxs("span",{className:"text-gray-400",children:[l,"%"]})]}),t.jsx("div",{className:"h-3 bg-gray-700 rounded-full overflow-hidden",children:t.jsx("div",{className:`h-full ${i} rounded-full transition-all duration-500`,style:{width:`${l}%`}})})]})}function I8({disk:a}){const e=a.percent>90?"bg-red-600":a.percent>75?"bg-yellow-600":"bg-indigo-600";return t.jsx(uj,{value:a.used,max:a.total,label:a.label,sublabel:a.path,color:e})}function yr({label:a,value:e,icon:s}){return t.jsxs("div",{className:"flex items-center justify-between py-2.5 border-b border-gray-700/50 last:border-0",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[s,a]}),t.jsx("span",{className:"text-sm text-white font-medium",children:e})]})}function il({label:a,value:e,icon:s,color:n}){return t.jsxs("div",{className:"bg-gray-900 rounded-lg p-4 flex items-center gap-3",children:[t.jsx("div",{className:`p-2 rounded-lg ${n}`,children:t.jsx(s,{className:"h-4 w-4 text-white"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-lg font-bold text-white",children:e.toLocaleString()}),t.jsx("p",{className:"text-xs text-gray-400",children:a})]})]})}function Ku({name:a,value:e,available:s}){return t.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-gray-700/50 last:border-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[s?t.jsx(Xt,{className:"h-4 w-4 text-green-400"}):t.jsx(Ua,{className:"h-4 w-4 text-gray-500"}),t.jsx("span",{className:"text-sm text-white font-medium",children:a})]}),t.jsx("span",{className:`text-sm ${s?"text-gray-300":"text-gray-500"}`,children:e})]})}function P8({status:a}){return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[t.jsx(td,{className:"h-5 w-5 text-indigo-400"}),"Server Info"]}),t.jsxs("div",{className:"divide-y divide-gray-700/50",children:[t.jsx(yr,{label:"Version",value:`v${a.server.version}`}),t.jsx(yr,{label:"Uptime",value:a.server.uptime,icon:t.jsx(Kt,{className:"h-3.5 w-3.5"})}),t.jsx(yr,{label:"Started At",value:new Date(a.server.startedAt).toLocaleString()}),t.jsx(yr,{label:"Operating System",value:a.server.os}),t.jsx(yr,{label:"Architecture",value:a.server.arch}),t.jsx(yr,{label:"Go Version",value:a.server.goVersion}),t.jsx(yr,{label:"Hostname",value:a.server.hostname})]})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[t.jsx(Nr,{className:"h-5 w-5 text-orange-400"}),"Resource Usage"]}),t.jsxs("div",{className:"space-y-5",children:[t.jsxs("div",{className:"flex items-center justify-between py-2",children:[t.jsx("span",{className:"text-sm text-gray-400",children:"CPU Cores"}),t.jsx("span",{className:"text-sm text-white font-medium",children:a.resources.cpuCores})]}),t.jsx("div",{children:t.jsx(uj,{value:a.resources.memUsedMB,max:a.resources.memTotalMB,label:"Memory",sublabel:`${a.resources.memUsedMB} MB / ${a.resources.memTotalMB} MB`,color:a.resources.memPercent>90?"bg-red-600":a.resources.memPercent>75?"bg-yellow-600":"bg-indigo-600"})}),t.jsxs("div",{className:"flex items-center justify-between py-2",children:[t.jsx("span",{className:"text-sm text-gray-400",children:"Goroutines"}),t.jsx("span",{className:"text-sm text-white font-medium",children:a.resources.goroutines})]}),a.resources.diskUsage&&a.resources.diskUsage.length>0&&t.jsxs("div",{className:"pt-2",children:[t.jsxs("h3",{className:"text-sm font-medium text-gray-300 mb-3 flex items-center gap-2",children:[t.jsx($a,{className:"h-4 w-4"}),"Disk Usage"]}),t.jsx("div",{className:"space-y-4",children:a.resources.diskUsage.map((e,s)=>t.jsxs("div",{children:[t.jsx(I8,{disk:e}),t.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[t.jsxs("span",{children:[Hg(e.used)," used"]}),t.jsxs("span",{children:[Hg(e.free)," free of ",Hg(e.total)]})]})]},s))})]})]})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[t.jsx(gh,{className:"h-5 w-5 text-green-400"}),"Database"]}),t.jsx("div",{className:"mb-4",children:t.jsx(yr,{label:"Database Size",value:`${a.database.sizeMB.toFixed(1)} MB`,icon:t.jsx($a,{className:"h-3.5 w-3.5"})})}),t.jsx("h3",{className:"text-sm font-medium text-gray-300 mb-3",children:"Record Counts"}),t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[t.jsx(il,{label:"Libraries",value:a.database.libraries,icon:sa,color:"bg-blue-600"}),t.jsx(il,{label:"Channels",value:a.database.channels,icon:jt,color:"bg-purple-600"}),t.jsx(il,{label:"Recordings",value:a.database.recordings,icon:Nn,color:"bg-red-600"}),t.jsx(il,{label:"Passes",value:a.database.passes,icon:wa,color:"bg-orange-600"}),t.jsx(il,{label:"Users",value:a.database.users,icon:qh,color:"bg-green-600"}),t.jsx(il,{label:"Media Items",value:a.database.mediaItems,icon:$h,color:"bg-indigo-600"}),t.jsx(il,{label:"Programs",value:a.database.programs,icon:W1,color:"bg-yellow-600"})]})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[t.jsx(lk,{className:"h-5 w-5 text-purple-400"}),"Components"]}),t.jsxs("div",{children:[t.jsx(Ku,{name:"FFmpeg",value:a.components.ffmpegVersion,available:a.components.ffmpegVersion!=="not found"}),t.jsx(Ku,{name:"Chrome / Chromium",value:a.components.chromeVersion,available:a.components.chromeVersion!=="not found"}),t.jsx(Ku,{name:"Comskip",value:a.components.comskipAvailable?"Installed":"Not found",available:a.components.comskipAvailable}),t.jsx(Ku,{name:"Hardware Transcode",value:a.components.transcodeHW==="none"?"Software (CPU)":a.components.transcodeHW,available:a.components.transcodeHW!=="none"})]})]})]})}function O8(){const{data:a,isLoading:e,error:s,refetch:n}=Fe({queryKey:["systemStatus"],queryFn:()=>pe.getSystemStatus(),refetchInterval:15e3,retry:1});return t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Settings"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Server status and system information"})]}),t.jsxs("button",{onClick:()=>n(),disabled:e,className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 text-white rounded-lg text-sm",children:[e?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):t.jsx(ut,{className:"h-4 w-4"}),"Refresh"]})]}),t.jsx(M8,{active:"status"}),e&&t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx(Ke,{className:"h-8 w-8 text-indigo-500 animate-spin"})}),s&&!e&&t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[t.jsx(ps,{className:"h-12 w-12 text-red-400"}),t.jsx("h3",{className:"text-lg font-medium text-white",children:"Failed to load system status"}),t.jsx("p",{className:"text-gray-400 text-sm",children:s.message}),t.jsxs("button",{onClick:()=>n(),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[t.jsx(ut,{className:"h-4 w-4"}),"Retry"]})]}),a&&t.jsx(P8,{status:a})]})}var F8=Object.defineProperty,Mh=Object.getOwnPropertySymbols,hj=Object.prototype.hasOwnProperty,fj=Object.prototype.propertyIsEnumerable,zN=(a,e,s)=>e in a?F8(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s,$0=(a,e)=>{for(var s in e||(e={}))hj.call(e,s)&&zN(a,s,e[s]);if(Mh)for(var s of Mh(e))fj.call(e,s)&&zN(a,s,e[s]);return a},G0=(a,e)=>{var s={};for(var n in a)hj.call(a,n)&&e.indexOf(n)<0&&(s[n]=a[n]);if(a!=null&&Mh)for(var n of Mh(a))e.indexOf(n)<0&&fj.call(a,n)&&(s[n]=a[n]);return s};var _l;(a=>{const e=class Bt{constructor(h,u,f,g){if(this.version=h,this.errorCorrectionLevel=u,this.modules=[],this.isFunction=[],h<Bt.MIN_VERSION||h>Bt.MAX_VERSION)throw new RangeError("Version value out of range");if(g<-1||g>7)throw new RangeError("Mask value out of range");this.size=h*4+17;let p=[];for(let y=0;y<this.size;y++)p.push(!1);for(let y=0;y<this.size;y++)this.modules.push(p.slice()),this.isFunction.push(p.slice());this.drawFunctionPatterns();const b=this.addEccAndInterleave(f);if(this.drawCodewords(b),g==-1){let y=1e9;for(let v=0;v<8;v++){this.applyMask(v),this.drawFormatBits(v);const _=this.getPenaltyScore();_<y&&(g=v,y=_),this.applyMask(v)}}i(0<=g&&g<=7),this.mask=g,this.applyMask(g),this.drawFormatBits(g),this.isFunction=[]}static encodeText(h,u){const f=a.QrSegment.makeSegments(h);return Bt.encodeSegments(f,u)}static encodeBinary(h,u){const f=a.QrSegment.makeBytes(h);return Bt.encodeSegments([f],u)}static encodeSegments(h,u,f=1,g=40,p=-1,b=!0){if(!(Bt.MIN_VERSION<=f&&f<=g&&g<=Bt.MAX_VERSION)||p<-1||p>7)throw new RangeError("Invalid value");let y,v;for(y=f;;y++){const T=Bt.getNumDataCodewords(y,u)*8,L=o.getTotalBits(h,y);if(L<=T){v=L;break}if(y>=g)throw new RangeError("Data too long")}for(const T of[Bt.Ecc.MEDIUM,Bt.Ecc.QUARTILE,Bt.Ecc.HIGH])b&&v<=Bt.getNumDataCodewords(y,T)*8&&(u=T);let _=[];for(const T of h){s(T.mode.modeBits,4,_),s(T.numChars,T.mode.numCharCountBits(y),_);for(const L of T.getData())_.push(L)}i(_.length==v);const N=Bt.getNumDataCodewords(y,u)*8;i(_.length<=N),s(0,Math.min(4,N-_.length),_),s(0,(8-_.length%8)%8,_),i(_.length%8==0);for(let T=236;_.length<N;T^=253)s(T,8,_);let C=[];for(;C.length*8<_.length;)C.push(0);return _.forEach((T,L)=>C[L>>>3]|=T<<7-(L&7)),new Bt(y,u,C,p)}getModule(h,u){return 0<=h&&h<this.size&&0<=u&&u<this.size&&this.modules[u][h]}getModules(){return this.modules}drawFunctionPatterns(){for(let f=0;f<this.size;f++)this.setFunctionModule(6,f,f%2==0),this.setFunctionModule(f,6,f%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const h=this.getAlignmentPatternPositions(),u=h.length;for(let f=0;f<u;f++)for(let g=0;g<u;g++)f==0&&g==0||f==0&&g==u-1||f==u-1&&g==0||this.drawAlignmentPattern(h[f],h[g]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(h){const u=this.errorCorrectionLevel.formatBits<<3|h;let f=u;for(let p=0;p<10;p++)f=f<<1^(f>>>9)*1335;const g=(u<<10|f)^21522;i(g>>>15==0);for(let p=0;p<=5;p++)this.setFunctionModule(8,p,n(g,p));this.setFunctionModule(8,7,n(g,6)),this.setFunctionModule(8,8,n(g,7)),this.setFunctionModule(7,8,n(g,8));for(let p=9;p<15;p++)this.setFunctionModule(14-p,8,n(g,p));for(let p=0;p<8;p++)this.setFunctionModule(this.size-1-p,8,n(g,p));for(let p=8;p<15;p++)this.setFunctionModule(8,this.size-15+p,n(g,p));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let h=this.version;for(let f=0;f<12;f++)h=h<<1^(h>>>11)*7973;const u=this.version<<12|h;i(u>>>18==0);for(let f=0;f<18;f++){const g=n(u,f),p=this.size-11+f%3,b=Math.floor(f/3);this.setFunctionModule(p,b,g),this.setFunctionModule(b,p,g)}}drawFinderPattern(h,u){for(let f=-4;f<=4;f++)for(let g=-4;g<=4;g++){const p=Math.max(Math.abs(g),Math.abs(f)),b=h+g,y=u+f;0<=b&&b<this.size&&0<=y&&y<this.size&&this.setFunctionModule(b,y,p!=2&&p!=4)}}drawAlignmentPattern(h,u){for(let f=-2;f<=2;f++)for(let g=-2;g<=2;g++)this.setFunctionModule(h+g,u+f,Math.max(Math.abs(g),Math.abs(f))!=1)}setFunctionModule(h,u,f){this.modules[u][h]=f,this.isFunction[u][h]=!0}addEccAndInterleave(h){const u=this.version,f=this.errorCorrectionLevel;if(h.length!=Bt.getNumDataCodewords(u,f))throw new RangeError("Invalid argument");const g=Bt.NUM_ERROR_CORRECTION_BLOCKS[f.ordinal][u],p=Bt.ECC_CODEWORDS_PER_BLOCK[f.ordinal][u],b=Math.floor(Bt.getNumRawDataModules(u)/8),y=g-b%g,v=Math.floor(b/g);let _=[];const N=Bt.reedSolomonComputeDivisor(p);for(let T=0,L=0;T<g;T++){let F=h.slice(L,L+v-p+(T<y?0:1));L+=F.length;const H=Bt.reedSolomonComputeRemainder(F,N);T<y&&F.push(0),_.push(F.concat(H))}let C=[];for(let T=0;T<_[0].length;T++)_.forEach((L,F)=>{(T!=v-p||F>=y)&&C.push(L[T])});return i(C.length==b),C}drawCodewords(h){if(h.length!=Math.floor(Bt.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let u=0;for(let f=this.size-1;f>=1;f-=2){f==6&&(f=5);for(let g=0;g<this.size;g++)for(let p=0;p<2;p++){const b=f-p,v=(f+1&2)==0?this.size-1-g:g;!this.isFunction[v][b]&&u<h.length*8&&(this.modules[v][b]=n(h[u>>>3],7-(u&7)),u++)}}i(u==h.length*8)}applyMask(h){if(h<0||h>7)throw new RangeError("Mask value out of range");for(let u=0;u<this.size;u++)for(let f=0;f<this.size;f++){let g;switch(h){case 0:g=(f+u)%2==0;break;case 1:g=u%2==0;break;case 2:g=f%3==0;break;case 3:g=(f+u)%3==0;break;case 4:g=(Math.floor(f/3)+Math.floor(u/2))%2==0;break;case 5:g=f*u%2+f*u%3==0;break;case 6:g=(f*u%2+f*u%3)%2==0;break;case 7:g=((f+u)%2+f*u%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[u][f]&&g&&(this.modules[u][f]=!this.modules[u][f])}}getPenaltyScore(){let h=0;for(let p=0;p<this.size;p++){let b=!1,y=0,v=[0,0,0,0,0,0,0];for(let _=0;_<this.size;_++)this.modules[p][_]==b?(y++,y==5?h+=Bt.PENALTY_N1:y>5&&h++):(this.finderPenaltyAddHistory(y,v),b||(h+=this.finderPenaltyCountPatterns(v)*Bt.PENALTY_N3),b=this.modules[p][_],y=1);h+=this.finderPenaltyTerminateAndCount(b,y,v)*Bt.PENALTY_N3}for(let p=0;p<this.size;p++){let b=!1,y=0,v=[0,0,0,0,0,0,0];for(let _=0;_<this.size;_++)this.modules[_][p]==b?(y++,y==5?h+=Bt.PENALTY_N1:y>5&&h++):(this.finderPenaltyAddHistory(y,v),b||(h+=this.finderPenaltyCountPatterns(v)*Bt.PENALTY_N3),b=this.modules[_][p],y=1);h+=this.finderPenaltyTerminateAndCount(b,y,v)*Bt.PENALTY_N3}for(let p=0;p<this.size-1;p++)for(let b=0;b<this.size-1;b++){const y=this.modules[p][b];y==this.modules[p][b+1]&&y==this.modules[p+1][b]&&y==this.modules[p+1][b+1]&&(h+=Bt.PENALTY_N2)}let u=0;for(const p of this.modules)u=p.reduce((b,y)=>b+(y?1:0),u);const f=this.size*this.size,g=Math.ceil(Math.abs(u*20-f*10)/f)-1;return i(0<=g&&g<=9),h+=g*Bt.PENALTY_N4,i(0<=h&&h<=2568888),h}getAlignmentPatternPositions(){if(this.version==1)return[];{const h=Math.floor(this.version/7)+2,u=this.version==32?26:Math.ceil((this.version*4+4)/(h*2-2))*2;let f=[6];for(let g=this.size-7;f.length<h;g-=u)f.splice(1,0,g);return f}}static getNumRawDataModules(h){if(h<Bt.MIN_VERSION||h>Bt.MAX_VERSION)throw new RangeError("Version number out of range");let u=(16*h+128)*h+64;if(h>=2){const f=Math.floor(h/7)+2;u-=(25*f-10)*f-55,h>=7&&(u-=36)}return i(208<=u&&u<=29648),u}static getNumDataCodewords(h,u){return Math.floor(Bt.getNumRawDataModules(h)/8)-Bt.ECC_CODEWORDS_PER_BLOCK[u.ordinal][h]*Bt.NUM_ERROR_CORRECTION_BLOCKS[u.ordinal][h]}static reedSolomonComputeDivisor(h){if(h<1||h>255)throw new RangeError("Degree out of range");let u=[];for(let g=0;g<h-1;g++)u.push(0);u.push(1);let f=1;for(let g=0;g<h;g++){for(let p=0;p<u.length;p++)u[p]=Bt.reedSolomonMultiply(u[p],f),p+1<u.length&&(u[p]^=u[p+1]);f=Bt.reedSolomonMultiply(f,2)}return u}static reedSolomonComputeRemainder(h,u){let f=u.map(g=>0);for(const g of h){const p=g^f.shift();f.push(0),u.forEach((b,y)=>f[y]^=Bt.reedSolomonMultiply(b,p))}return f}static reedSolomonMultiply(h,u){if(h>>>8||u>>>8)throw new RangeError("Byte out of range");let f=0;for(let g=7;g>=0;g--)f=f<<1^(f>>>7)*285,f^=(u>>>g&1)*h;return i(f>>>8==0),f}finderPenaltyCountPatterns(h){const u=h[1];i(u<=this.size*3);const f=u>0&&h[2]==u&&h[3]==u*3&&h[4]==u&&h[5]==u;return(f&&h[0]>=u*4&&h[6]>=u?1:0)+(f&&h[6]>=u*4&&h[0]>=u?1:0)}finderPenaltyTerminateAndCount(h,u,f){return h&&(this.finderPenaltyAddHistory(u,f),u=0),u+=this.size,this.finderPenaltyAddHistory(u,f),this.finderPenaltyCountPatterns(f)}finderPenaltyAddHistory(h,u){u[0]==0&&(h+=this.size),u.pop(),u.unshift(h)}};e.MIN_VERSION=1,e.MAX_VERSION=40,e.PENALTY_N1=3,e.PENALTY_N2=3,e.PENALTY_N3=40,e.PENALTY_N4=10,e.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],e.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],a.QrCode=e;function s(d,h,u){if(h<0||h>31||d>>>h)throw new RangeError("Value out of range");for(let f=h-1;f>=0;f--)u.push(d>>>f&1)}function n(d,h){return(d>>>h&1)!=0}function i(d){if(!d)throw new Error("Assertion error")}const l=class Is{constructor(h,u,f){if(this.mode=h,this.numChars=u,this.bitData=f,u<0)throw new RangeError("Invalid argument");this.bitData=f.slice()}static makeBytes(h){let u=[];for(const f of h)s(f,8,u);return new Is(Is.Mode.BYTE,h.length,u)}static makeNumeric(h){if(!Is.isNumeric(h))throw new RangeError("String contains non-numeric characters");let u=[];for(let f=0;f<h.length;){const g=Math.min(h.length-f,3);s(parseInt(h.substring(f,f+g),10),g*3+1,u),f+=g}return new Is(Is.Mode.NUMERIC,h.length,u)}static makeAlphanumeric(h){if(!Is.isAlphanumeric(h))throw new RangeError("String contains unencodable characters in alphanumeric mode");let u=[],f;for(f=0;f+2<=h.length;f+=2){let g=Is.ALPHANUMERIC_CHARSET.indexOf(h.charAt(f))*45;g+=Is.ALPHANUMERIC_CHARSET.indexOf(h.charAt(f+1)),s(g,11,u)}return f<h.length&&s(Is.ALPHANUMERIC_CHARSET.indexOf(h.charAt(f)),6,u),new Is(Is.Mode.ALPHANUMERIC,h.length,u)}static makeSegments(h){return h==""?[]:Is.isNumeric(h)?[Is.makeNumeric(h)]:Is.isAlphanumeric(h)?[Is.makeAlphanumeric(h)]:[Is.makeBytes(Is.toUtf8ByteArray(h))]}static makeEci(h){let u=[];if(h<0)throw new RangeError("ECI assignment value out of range");if(h<128)s(h,8,u);else if(h<16384)s(2,2,u),s(h,14,u);else if(h<1e6)s(6,3,u),s(h,21,u);else throw new RangeError("ECI assignment value out of range");return new Is(Is.Mode.ECI,0,u)}static isNumeric(h){return Is.NUMERIC_REGEX.test(h)}static isAlphanumeric(h){return Is.ALPHANUMERIC_REGEX.test(h)}getData(){return this.bitData.slice()}static getTotalBits(h,u){let f=0;for(const g of h){const p=g.mode.numCharCountBits(u);if(g.numChars>=1<<p)return 1/0;f+=4+p+g.bitData.length}return f}static toUtf8ByteArray(h){h=encodeURI(h);let u=[];for(let f=0;f<h.length;f++)h.charAt(f)!="%"?u.push(h.charCodeAt(f)):(u.push(parseInt(h.substring(f+1,f+3),16)),f+=2);return u}};l.NUMERIC_REGEX=/^[0-9]*$/,l.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,l.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let o=l;a.QrSegment=l})(_l||(_l={}));(a=>{(e=>{const s=class{constructor(i,l){this.ordinal=i,this.formatBits=l}};s.LOW=new s(0,1),s.MEDIUM=new s(1,0),s.QUARTILE=new s(2,3),s.HIGH=new s(3,2),e.Ecc=s})(a.QrCode||(a.QrCode={}))})(_l||(_l={}));(a=>{(e=>{const s=class{constructor(i,l){this.modeBits=i,this.numBitsCharCount=l}numCharCountBits(i){return this.numBitsCharCount[Math.floor((i+7)/17)]}};s.NUMERIC=new s(1,[10,12,14]),s.ALPHANUMERIC=new s(2,[9,11,13]),s.BYTE=new s(4,[8,16,16]),s.KANJI=new s(8,[8,10,12]),s.ECI=new s(7,[0,0,0]),e.Mode=s})(a.QrSegment||(a.QrSegment={}))})(_l||(_l={}));var ho=_l;var B8={L:ho.QrCode.Ecc.LOW,M:ho.QrCode.Ecc.MEDIUM,Q:ho.QrCode.Ecc.QUARTILE,H:ho.QrCode.Ecc.HIGH},mj=128,gj="L",pj="#FFFFFF",xj="#000000",yj=!1,bj=1,U8=4,$8=0,G8=.1;function vj(a,e=0){const s=[];return a.forEach(function(n,i){let l=null;n.forEach(function(o,d){if(!o&&l!==null){s.push(`M${l+e} ${i+e}h${d-l}v1H${l+e}z`),l=null;return}if(d===n.length-1){if(!o)return;l===null?s.push(`M${d+e},${i+e} h1v1H${d+e}z`):s.push(`M${l+e},${i+e} h${d+1-l}v1H${l+e}z`);return}o&&l===null&&(l=d)})}),s.join("")}function _j(a,e){return a.slice().map((s,n)=>n<e.y||n>=e.y+e.h?s:s.map((i,l)=>l<e.x||l>=e.x+e.w?i:!1))}function V8(a,e,s,n){if(n==null)return null;const i=a.length+s*2,l=Math.floor(e*G8),o=i/e,d=(n.width||l)*o,h=(n.height||l)*o,u=n.x==null?a.length/2-d/2:n.x*o,f=n.y==null?a.length/2-h/2:n.y*o,g=n.opacity==null?1:n.opacity;let p=null;if(n.excavate){let y=Math.floor(u),v=Math.floor(f),_=Math.ceil(d+u-y),N=Math.ceil(h+f-v);p={x:y,y:v,w:_,h:N}}const b=n.crossOrigin;return{x:u,y:f,h,w:d,excavation:p,opacity:g,crossOrigin:b}}function q8(a,e){return e!=null?Math.max(Math.floor(e),0):a?U8:$8}function Nj({value:a,level:e,minVersion:s,includeMargin:n,marginSize:i,imageSettings:l,size:o,boostLevel:d}){let h=Ys.useMemo(()=>{const y=(Array.isArray(a)?a:[a]).reduce((v,_)=>(v.push(...ho.QrSegment.makeSegments(_)),v),[]);return ho.QrCode.encodeSegments(y,B8[e],s,void 0,void 0,d)},[a,e,s,d]);const{cells:u,margin:f,numCells:g,calculatedImageSettings:p}=Ys.useMemo(()=>{let b=h.getModules();const y=q8(n,i),v=b.length+y*2,_=V8(b,o,y,l);return{cells:b,margin:y,numCells:v,calculatedImageSettings:_}},[h,o,l,n,i]);return{qrcode:h,margin:f,cells:u,numCells:g,calculatedImageSettings:p}}var K8=(function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0})(),H8=Ys.forwardRef(function(e,s){const n=e,{value:i,size:l=mj,level:o=gj,bgColor:d=pj,fgColor:h=xj,includeMargin:u=yj,minVersion:f=bj,boostLevel:g,marginSize:p,imageSettings:b}=n,v=G0(n,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:_}=v,N=G0(v,["style"]),C=b?.src,T=Ys.useRef(null),L=Ys.useRef(null),F=Ys.useCallback(Z=>{T.current=Z,typeof s=="function"?s(Z):s&&(s.current=Z)},[s]),[H,B]=Ys.useState(!1),{margin:P,cells:I,numCells:D,calculatedImageSettings:O}=Nj({value:i,level:o,minVersion:f,boostLevel:g,includeMargin:u,marginSize:p,imageSettings:b,size:l});Ys.useEffect(()=>{if(T.current!=null){const Z=T.current,z=Z.getContext("2d");if(!z)return;let X=I;const ae=L.current,te=O!=null&&ae!==null&&ae.complete&&ae.naturalHeight!==0&&ae.naturalWidth!==0;te&&O.excavation!=null&&(X=_j(I,O.excavation));const W=window.devicePixelRatio||1;Z.height=Z.width=l*W;const K=l/D*W;z.scale(K,K),z.fillStyle=d,z.fillRect(0,0,D,D),z.fillStyle=h,K8?z.fill(new Path2D(vj(X,P))):I.forEach(function(q,J){q.forEach(function(oe,be){oe&&z.fillRect(be+P,J+P,1,1)})}),O&&(z.globalAlpha=O.opacity),te&&z.drawImage(ae,O.x+P,O.y+P,O.w,O.h)}}),Ys.useEffect(()=>{B(!1)},[C]);const ee=$0({height:l,width:l},_);let ie=null;return C!=null&&(ie=Ys.createElement("img",{src:C,key:C,style:{display:"none"},onLoad:()=>{B(!0)},ref:L,crossOrigin:O?.crossOrigin})),Ys.createElement(Ys.Fragment,null,Ys.createElement("canvas",$0({style:ee,height:l,width:l,ref:F,role:"img"},N)),ie)});H8.displayName="QRCodeCanvas";var wj=Ys.forwardRef(function(e,s){const n=e,{value:i,size:l=mj,level:o=gj,bgColor:d=pj,fgColor:h=xj,includeMargin:u=yj,minVersion:f=bj,boostLevel:g,title:p,marginSize:b,imageSettings:y}=n,v=G0(n,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:_,cells:N,numCells:C,calculatedImageSettings:T}=Nj({value:i,level:o,minVersion:f,boostLevel:g,includeMargin:u,marginSize:b,imageSettings:y,size:l});let L=N,F=null;y!=null&&T!=null&&(T.excavation!=null&&(L=_j(N,T.excavation)),F=Ys.createElement("image",{href:y.src,height:T.h,width:T.w,x:T.x+_,y:T.y+_,preserveAspectRatio:"none",opacity:T.opacity,crossOrigin:T.crossOrigin}));const H=vj(L,_);return Ys.createElement("svg",$0({height:l,width:l,viewBox:`0 0 ${C} ${C}`,ref:s,role:"img"},v),!!p&&Ys.createElement("title",null,p),Ys.createElement("path",{fill:d,d:`M0,0 h${C}v${C}H0z`,shapeRendering:"crispEdges"}),Ys.createElement("path",{fill:h,d:H,shapeRendering:"crispEdges"}),F)});wj.displayName="QRCodeSVG";function z8(a){if(a===0)return"0 Bytes";const e=1024,s=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(a)/Math.log(e));return parseFloat((a/Math.pow(e,n)).toFixed(2))+" "+s[n]}function Y8(a){switch(a){case"android":return t.jsx(ei,{className:"h-8 w-8"});case"android-tv":return t.jsx(jt,{className:"h-8 w-8"});case"ios":return t.jsx(r0,{className:"h-8 w-8"});case"macos":return t.jsx(r0,{className:"h-8 w-8"});case"windows":return t.jsx(wr,{className:"h-8 w-8"});case"linux":return t.jsx(Q1,{className:"h-8 w-8"});default:return t.jsx(gs,{className:"h-8 w-8"})}}function YN(a){switch(a){case"android":case"android-tv":return"bg-green-500/20 text-green-400 border-green-500/30";case"ios":case"macos":return"bg-gray-500/20 text-gray-300 border-gray-500/30";case"windows":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"linux":return"bg-orange-500/20 text-orange-400 border-orange-500/30";default:return"bg-purple-500/20 text-purple-400 border-purple-500/30"}}function W8(){const[a,e]=k.useState(!1),[s,n]=k.useState(null),{data:i,isLoading:l,error:o}=Fe({queryKey:["downloads"],queryFn:async()=>{const u=await fetch("/downloads");if(!u.ok)throw new Error("Failed to fetch downloads");return u.json()}}),d=typeof window<"u"?window.location.origin:"",h=u=>{n(u),e(!0)};return t.jsxs("div",{children:[t.jsxs("div",{className:"mb-8",children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Download Apps"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Download OpenFlix apps for your devices to stream your media library"})]}),l&&t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"})}),o&&t.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-4 text-red-400",children:"Failed to load downloads. Please try again later."}),i&&i.downloads.length===0&&t.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[t.jsx(gs,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No Apps Available"}),t.jsx("p",{className:"text-gray-400",children:"No app downloads are currently available. Check back later."})]}),i&&i.downloads.length>0&&t.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:i.downloads.map(u=>t.jsxs("div",{className:`bg-gray-800 rounded-xl p-6 border ${YN(u.platform)} hover:border-opacity-60 transition-colors`,children:[t.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[t.jsx("div",{className:`p-3 rounded-lg ${YN(u.platform)}`,children:Y8(u.platform)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"text-lg font-semibold text-white truncate",children:u.name}),t.jsxs("p",{className:"text-sm text-gray-400",children:["Version ",u.version]})]})]}),t.jsx("p",{className:"text-sm text-gray-300 mb-4",children:u.description}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-gray-500",children:z8(u.size)}),t.jsxs("div",{className:"flex gap-2",children:[(u.platform==="android"||u.platform==="android-tv")&&t.jsxs("button",{onClick:()=>h(u),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white text-sm font-medium rounded-lg transition-colors",title:"Send to TV",children:[t.jsx(Nk,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Send to TV"})]}),t.jsxs("a",{href:u.downloadUrl,download:!0,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium rounded-lg transition-colors",children:[t.jsx(gs,{className:"h-4 w-4"}),"Download"]})]})]})]},u.filename))}),t.jsxs("div",{className:"mt-12",children:[t.jsx("h2",{className:"text-xl font-semibold text-white mb-6",children:"Installation Instructions"}),t.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx(jt,{className:"h-6 w-6 text-green-400"}),t.jsx("h3",{className:"text-lg font-medium text-white",children:"Android TV / Fire TV"})]}),t.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-sm text-gray-300",children:[t.jsx("li",{children:"Download the APK file to a USB drive or use a file manager app"}),t.jsxs("li",{children:['Enable "Install from unknown sources" in Settings ',">"," Security"]}),t.jsx("li",{children:"Use a file manager to locate and install the APK"}),t.jsx("li",{children:"Launch OpenFlix from your apps"})]})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx(ei,{className:"h-6 w-6 text-green-400"}),t.jsx("h3",{className:"text-lg font-medium text-white",children:"Android Phone / Tablet"})]}),t.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-sm text-gray-300",children:[t.jsx("li",{children:"Download the APK file directly on your device"}),t.jsx("li",{children:"Open the downloaded file from your notifications or Downloads app"}),t.jsx("li",{children:"Allow installation from this source if prompted"}),t.jsx("li",{children:"Tap Install and wait for completion"})]})]})]})]}),t.jsxs("div",{className:"mt-8 bg-gray-800 rounded-xl p-6",children:[t.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"Quick Setup"}),t.jsx("p",{className:"text-sm text-gray-300 mb-4",children:"After installing the app, open it and enter your server address to connect:"}),t.jsx("div",{className:"bg-gray-900 rounded-lg p-4 font-mono text-indigo-400",children:d||"http://your-server:32400"})]}),a&&s&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",onClick:()=>e(!1),children:t.jsxs("div",{className:"bg-gray-800 rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto",onClick:u=>u.stopPropagation(),children:[t.jsxs("div",{className:"p-6 border-b border-gray-700",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-xl font-bold text-white",children:"Send App to Your TV"}),t.jsx("button",{onClick:()=>e(!1),className:"text-gray-400 hover:text-white p-1",children:t.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("p",{className:"text-gray-400 text-sm mt-1",children:["Follow these easy steps to install ",s.name]})]}),t.jsxs("div",{className:"p-6 flex flex-col items-center border-b border-gray-700",children:[t.jsx("div",{className:"bg-white p-4 rounded-xl",children:t.jsx(wj,{value:s.downloadUrl,size:180,level:"M"})}),t.jsx("p",{className:"text-gray-400 text-sm mt-3 text-center",children:"Scan with your phone to download the app"})]}),t.jsxs("div",{className:"p-6",children:[t.jsxs("h3",{className:"text-white font-semibold mb-4 flex items-center gap-2",children:[t.jsx(ei,{className:"h-5 w-5 text-indigo-400"}),"Easy 3-Step Setup"]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex gap-4",children:[t.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center text-white font-bold text-sm",children:"1"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"text-white font-medium",children:"Scan QR Code with your phone"}),t.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Use your phone's camera app to scan the QR code above. The APK will download to your phone."})]})]}),t.jsxs("div",{className:"flex gap-4",children:[t.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center text-white font-bold text-sm",children:"2"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"text-white font-medium",children:'Install "Send Files to TV" app'}),t.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Get this free app on both your phone AND your TV from their app stores."}),t.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[t.jsxs("a",{href:"https://play.google.com/store/apps/details?id=com.yablio.sendfilestotv",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xs bg-green-700 hover:bg-green-600 text-white px-3 py-1.5 rounded-lg transition-colors",children:[t.jsx(ei,{className:"h-3 w-3"}),"Android Phone"]}),t.jsxs("a",{href:"https://apps.apple.com/app/send-files-to-android-tv/id6723898949",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xs bg-gray-600 hover:bg-gray-500 text-white px-3 py-1.5 rounded-lg transition-colors",children:[t.jsx(r0,{className:"h-3 w-3"}),"iPhone"]}),t.jsxs("a",{href:"https://play.google.com/store/apps/details?id=com.yablio.sendfilestotv",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xs bg-indigo-700 hover:bg-indigo-600 text-white px-3 py-1.5 rounded-lg transition-colors",children:[t.jsx(jt,{className:"h-3 w-3"}),"Android TV"]})]})]})]}),t.jsxs("div",{className:"flex gap-4",children:[t.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center text-white font-bold text-sm",children:"3"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"text-white font-medium",children:"Send the APK to your TV"}),t.jsx("p",{className:"text-gray-400 text-sm mt-1",children:'Open "Send Files to TV" on your phone, select the downloaded APK, and send it to your TV. Then install it on your TV!'})]})]})]}),t.jsx("div",{className:"mt-6 p-4 bg-green-500/10 border border-green-500/30 rounded-lg",children:t.jsxs("div",{className:"flex gap-3",children:[t.jsx(vn,{className:"h-5 w-5 text-green-400 flex-shrink-0 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-green-400 font-medium text-sm",children:"After Installation"}),t.jsx("p",{className:"text-gray-300 text-sm mt-1",children:"Open OpenFlix on your TV and enter this server address:"}),t.jsx("code",{className:"block mt-2 text-indigo-400 bg-gray-900 px-3 py-2 rounded text-sm",children:d})]})]})})]}),t.jsxs("div",{className:"p-4 border-t border-gray-700 flex justify-between items-center",children:[t.jsxs("a",{href:s.downloadUrl,download:!0,className:"text-sm text-gray-400 hover:text-white flex items-center gap-1",children:[t.jsx(gs,{className:"h-4 w-4"}),"Direct download instead"]}),t.jsx("button",{onClick:()=>e(!1),className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium rounded-lg transition-colors",children:"Done"})]})]})})]})}const dl=async(a,e)=>{const s=localStorage.getItem("openflix_token")||"",n=await fetch(a,{...e,headers:{"X-Plex-Token":s,"Content-Type":"application/json",...e?.headers}});if(!n.ok)throw new Error(`API error: ${n.status}`);return n.json()};function Q8({strength:a}){const s=Math.round(a/100*5),n=i=>i>s?"bg-gray-600":a>=80?"bg-green-500":a>=50?"bg-yellow-500":"bg-red-500";return t.jsx("div",{className:"flex items-end gap-0.5 h-4",title:`${a}%`,children:Array.from({length:5}).map((i,l)=>t.jsx("div",{className:`w-1.5 rounded-sm transition-all ${n(l+1)}`,style:{height:`${(l+1)/5*100}%`}},l))})}function X8({onClose:a,onAdd:e,isAdding:s}){const[n,i]=k.useState(""),l=o=>{o.preventDefault(),n.trim()&&e(n.trim())};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Add Tuner Manually"}),t.jsx("button",{onClick:a,className:"p-1 text-gray-400 hover:text-white",children:t.jsx(nt,{className:"h-5 w-5"})})]}),t.jsxs("form",{onSubmit:l,children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Tuner URL"}),t.jsx("input",{type:"text",value:n,onChange:o=>i(o.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"http://192.168.1.100:5004",required:!0}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter the base URL of your HDHomeRun device."})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{type:"button",onClick:a,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:s||!n.trim(),className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg",children:s?"Adding...":"Add Tuner"})]})]})]})})}function J8({tuner:a,onRemove:e,onImportChannels:s,isImporting:n}){const[i,l]=k.useState(!1),{data:o,isLoading:d}=Fe({queryKey:["tunerStatus",a.id],queryFn:()=>dl(`/api/tuners/${a.id}/status`),refetchInterval:5e3}),{data:h,isLoading:u}=Fe({queryKey:["tunerLineup",a.id],queryFn:()=>dl(`/api/tuners/${a.id}/lineup`),enabled:i}),f=o?.tuners||[],g=f.filter(p=>p.active).length;return t.jsx("div",{className:"bg-gray-800 rounded-xl overflow-hidden",children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:"p-3 bg-gray-700 rounded-lg",children:t.jsx($s,{className:"h-6 w-6 text-indigo-400"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-white",children:a.name||a.model}),t.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 mt-1 text-sm text-gray-400",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(No,{className:"h-3.5 w-3.5"}),a.ip]}),a.model&&t.jsxs("span",{children:["Model: ",a.model]}),a.firmware&&t.jsxs("span",{children:["Firmware: ",a.firmware]}),t.jsxs("span",{children:[a.tunerCount," tuner",a.tunerCount!==1?"s":""]})]})]})]}),t.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[t.jsxs("button",{onClick:s,disabled:n,className:"flex items-center gap-1.5 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white text-sm rounded-lg transition-colors",children:[n?t.jsx(Ke,{className:"h-3.5 w-3.5 animate-spin"}):t.jsx(gs,{className:"h-3.5 w-3.5"}),"Import Channels"]}),t.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Remove tuner",children:t.jsx(Dt,{className:"h-4 w-4"})})]})]}),t.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("h4",{className:"text-sm font-medium text-gray-400",children:["Tuner Status",g>0&&t.jsxs("span",{className:"ml-2 text-green-400",children:["(",g," active)"]})]}),d&&t.jsx(Ke,{className:"h-4 w-4 text-gray-500 animate-spin"})]}),f.length>0?t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:f.map((p,b)=>t.jsxs("div",{className:`p-3 rounded-lg ${p.active?"bg-green-500/10 border border-green-500/30":"bg-gray-700/50 border border-gray-700"}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("span",{className:"text-xs font-medium text-gray-400",children:["Tuner ",b+1]}),t.jsx(Q8,{strength:p.signalStrength})]}),p.active?t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-white font-medium",children:p.channel||"Active"}),t.jsxs("div",{className:"flex gap-2 mt-1 text-xs text-gray-400",children:[t.jsxs("span",{children:["Sig: ",p.signalStrength,"%"]}),t.jsxs("span",{children:["Qual: ",p.signalQuality,"%"]})]})]}):t.jsx("p",{className:"text-sm text-gray-500",children:"Idle"})]},p.id||b))}):d?null:t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:Array.from({length:a.tunerCount||2}).map((p,b)=>t.jsxs("div",{className:"p-3 rounded-lg bg-gray-700/50 border border-gray-700",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("span",{className:"text-xs font-medium text-gray-400",children:["Tuner ",b+1]}),t.jsx(Vk,{className:"h-4 w-4 text-gray-600"})]}),t.jsx("p",{className:"text-sm text-gray-500",children:"Idle"})]},b))})]}),t.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[t.jsx("button",{onClick:()=>l(!i),className:"text-sm text-indigo-400 hover:text-indigo-300 transition-colors",children:i?"Hide Channel Lineup":"Show Channel Lineup"}),i&&t.jsx("div",{className:"mt-3",children:u?t.jsx("div",{className:"flex items-center justify-center py-6",children:t.jsx(Ke,{className:"h-6 w-6 text-indigo-500 animate-spin"})}):h&&h.channels.length>0?t.jsx("div",{className:"overflow-x-auto max-h-96 overflow-y-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"sticky top-0 bg-gray-800",children:t.jsxs("tr",{className:"border-b border-gray-700",children:[t.jsx("th",{className:"text-left py-2 px-3 text-xs font-medium text-gray-400",children:"Ch"}),t.jsx("th",{className:"text-left py-2 px-3 text-xs font-medium text-gray-400",children:"Name"}),t.jsx("th",{className:"text-left py-2 px-3 text-xs font-medium text-gray-400",children:"HD"}),t.jsx("th",{className:"text-left py-2 px-3 text-xs font-medium text-gray-400",children:"Status"})]})}),t.jsx("tbody",{children:h.channels.map(p=>t.jsxs("tr",{className:"border-b border-gray-700/50 hover:bg-gray-700/30",children:[t.jsx("td",{className:"py-2 px-3 text-sm text-white font-mono",children:p.number}),t.jsx("td",{className:"py-2 px-3 text-sm text-gray-300",children:p.name}),t.jsx("td",{className:"py-2 px-3",children:p.hd&&t.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-indigo-500/20 text-indigo-400 rounded",children:"HD"})}),t.jsx("td",{className:"py-2 px-3",children:p.enabled?t.jsxs("span",{className:"flex items-center gap-1 text-xs text-green-400",children:[t.jsx(Xt,{className:"h-3 w-3"}),"Enabled"]}):t.jsx("span",{className:"text-xs text-gray-500",children:"Disabled"})})]},p.number))})]})}):t.jsx("div",{className:"text-center py-6",children:t.jsx("p",{className:"text-gray-500 text-sm",children:"No channels in lineup"})})})]})]})})}function Z8(){const a=at(),[e,s]=k.useState(!1),[n,i]=k.useState(null),{data:l,isLoading:o,error:d}=Fe({queryKey:["tuners"],queryFn:()=>dl("/api/tuners")}),h=Me({mutationFn:()=>dl("/api/tuners/discover",{method:"POST"}),onSuccess:()=>{a.invalidateQueries({queryKey:["tuners"]})}}),u=Me({mutationFn:b=>dl("/api/tuners",{method:"POST",body:JSON.stringify({url:b})}),onSuccess:()=>{a.invalidateQueries({queryKey:["tuners"]}),s(!1)}}),f=Me({mutationFn:b=>dl(`/api/tuners/${b}`,{method:"DELETE"}),onSuccess:()=>{a.invalidateQueries({queryKey:["tuners"]})}}),g=async b=>{i(b);try{await dl(`/api/tuners/${b}/import`,{method:"POST"}),a.invalidateQueries({queryKey:["tunerLineup",b]})}catch(y){console.error("Channel import failed:",y)}finally{i(null)}},p=l?.tuners||[];return t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx($s,{className:"h-6 w-6 text-indigo-400"}),t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Tuners"})]}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Manage HDHomeRun and network tuner devices"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>h.mutate(),disabled:h.isPending,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg",children:[h.isPending?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):t.jsx(ut,{className:"h-4 w-4"}),"Discover Tuners"]}),t.jsxs("button",{onClick:()=>s(!0),className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:[t.jsx(Pt,{className:"h-4 w-4"}),"Add Manually"]})]})]}),h.isSuccess&&t.jsxs("div",{className:"mb-6 flex items-center gap-2 p-3 bg-green-500/10 border border-green-500/30 rounded-lg",children:[t.jsx(Xt,{className:"h-4 w-4 text-green-400"}),t.jsx("span",{className:"text-green-400 text-sm",children:"Network discovery complete. Found tuners have been added."})]}),h.isError&&t.jsxs("div",{className:"mb-6 flex items-center gap-2 p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:[t.jsx(kt,{className:"h-4 w-4 text-red-400"}),t.jsx("span",{className:"text-red-400 text-sm",children:"Discovery failed. Check that your network allows broadcast traffic."})]}),o?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx(Ke,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):d?t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 text-center",children:[t.jsx(kt,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Failed to Load Tuners"}),t.jsx("p",{className:"text-gray-400",children:"Could not retrieve tuner information from the server."})]}):p.length===0?t.jsxs("div",{className:"bg-gray-800 rounded-xl p-12 text-center",children:[t.jsx($s,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No Tuners Found"}),t.jsx("p",{className:"text-gray-400 mb-6",children:'Connect an HDHomeRun device to your network and click "Discover Tuners" to find it.'}),t.jsxs("div",{className:"flex justify-center gap-3",children:[t.jsxs("button",{onClick:()=>h.mutate(),disabled:h.isPending,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[h.isPending?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):t.jsx(ut,{className:"h-4 w-4"}),"Discover Tuners"]}),t.jsxs("button",{onClick:()=>s(!0),className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:[t.jsx(Pt,{className:"h-4 w-4"}),"Add Manually"]})]})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-gray-800 rounded-xl p-4",children:[t.jsx("p",{className:"text-2xl font-bold text-white",children:p.length}),t.jsxs("p",{className:"text-sm text-gray-400",children:["Tuner Device",p.length!==1?"s":""]})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-4",children:[t.jsx("p",{className:"text-2xl font-bold text-white",children:p.reduce((b,y)=>b+(y.tunerCount||0),0)}),t.jsx("p",{className:"text-sm text-gray-400",children:"Total Tuners"})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-4",children:[t.jsx("p",{className:"text-2xl font-bold text-green-400",children:p.filter(b=>b.firmware).length}),t.jsx("p",{className:"text-sm text-gray-400",children:"Online"})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-4",children:[t.jsx("p",{className:"text-2xl font-bold text-gray-400",children:p.filter(b=>!b.firmware).length}),t.jsx("p",{className:"text-sm text-gray-400",children:"Offline"})]})]}),t.jsx("div",{className:"space-y-4",children:p.map(b=>t.jsx(J8,{tuner:b,onRemove:()=>{confirm(`Remove tuner ${b.name||b.model}?`)&&f.mutate(b.id)},onImportChannels:()=>g(b.id),isImporting:n===b.id},b.id))})]}),e&&t.jsx(X8,{onClose:()=>s(!1),onAdd:b=>u.mutate(b),isAdding:u.isPending})]})}const V0=a=>a?/^https?:\/\//i.test(a):!1,Sj=[{value:"group",label:"Group"},{value:"name",label:"Channel Name"},{value:"number",label:"Channel Number"},{value:"sourceName",label:"Source Name"},{value:"sourceType",label:"Source Type"},{value:"hd",label:"HD"},{value:"favorite",label:"Favorite"}],WN={group:[{value:"eq",label:"equals"},{value:"neq",label:"not equals"},{value:"contains",label:"contains"},{value:"starts_with",label:"starts with"}],name:[{value:"eq",label:"equals"},{value:"neq",label:"not equals"},{value:"contains",label:"contains"},{value:"not_contains",label:"does not contain"},{value:"starts_with",label:"starts with"},{value:"ends_with",label:"ends with"}],number:[{value:"eq",label:"equals"},{value:"gt",label:"greater than"},{value:"lt",label:"less than"},{value:"gte",label:"at least"},{value:"lte",label:"at most"}],sourceName:[{value:"eq",label:"equals"},{value:"neq",label:"not equals"},{value:"contains",label:"contains"}],sourceType:[{value:"eq",label:"equals"},{value:"neq",label:"not equals"}],hd:[{value:"eq",label:"is"}],favorite:[{value:"eq",label:"is"}]};function QN(a){return WN[a]||WN.name}const $i={"X-Plex-Token":localStorage.getItem("openflix_token")||"","Content-Type":"application/json"};async function eF(){const a=await fetch("/dvr/v2/channel-collections",{headers:$i});if(!a.ok)throw new Error("Failed to fetch channel collections");return(await a.json()).collections||[]}async function tF(a){const e=await fetch("/dvr/v2/channel-collections",{method:"POST",headers:$i,body:JSON.stringify(a)});if(!e.ok)throw new Error("Failed to create channel collection");return e.json()}async function sF(a,e){const s=await fetch(`/dvr/v2/channel-collections/${a}`,{method:"PUT",headers:$i,body:JSON.stringify(e)});if(!s.ok)throw new Error("Failed to update channel collection");return s.json()}async function aF(a){if(!(await fetch(`/dvr/v2/channel-collections/${a}`,{method:"DELETE",headers:$i})).ok)throw new Error("Failed to delete channel collection")}async function nF(){const a=await fetch("/livetv/channels",{headers:$i});if(!a.ok)throw new Error("Failed to fetch channels");return(await a.json()).channels||[]}async function iF(){const a=await fetch("/dvr/v2/virtual-stations",{headers:$i});if(!a.ok)throw new Error("Failed to fetch virtual stations");return(await a.json()).stations||[]}async function rF(a){const e=await fetch("/dvr/v2/channel-collection-rules/preview",{method:"POST",headers:$i,body:JSON.stringify({smartRules:a})});if(!e.ok)throw new Error("Failed to preview rules");return e.json()}async function lF(){const a=await fetch("/dvr/v2/channel-collection-meta/groups",{headers:$i});return a.ok?(await a.json()).groups||[]:[]}async function oF(){const a=await fetch("/dvr/v2/channel-collection-meta/sources",{headers:$i});return a.ok?(await a.json()).sources||[]:[]}function Ih(a){return a?a.split(",").map(e=>parseInt(e.trim(),10)).filter(e=>!isNaN(e)):[]}function XN(a){return a.join(",")}function JN(a){const e=localStorage.getItem("openflix_token")||"";return`/dvr/v2/channel-collections/${a}/export.m3u?X-Plex-Token=${e}`}function cF(a){if(!a)return{enabled:!0,conditions:[],match:"any"};try{return JSON.parse(a)}catch{return{enabled:!0,conditions:[],match:"any"}}}function dF(){return{field:"group",op:"eq",value:""}}function uF({config:a,onChange:e}){const{data:s}=Fe({queryKey:["channel-collection-groups"],queryFn:lF}),{data:n}=Fe({queryKey:["channel-collection-sources"],queryFn:oF}),[i,l]=k.useState(null),[o,d]=k.useState(!1),h=()=>{e({...a,conditions:[...a.conditions,dF()]})},u=b=>{e({...a,conditions:a.conditions.filter((y,v)=>v!==b)})},f=(b,y)=>{const v=a.conditions.map((_,N)=>N===b?{..._,...y}:_);if(y.field!==void 0){const _=QN(y.field);v[b].op=_[0]?.value||"eq",y.field==="hd"||y.field==="favorite"?v[b].value="true":v[b].value=""}e({...a,conditions:v}),l(null)},g=k.useCallback(async()=>{if(a.conditions.length!==0){d(!0),l(null);try{const b=JSON.stringify(a),y=await rF(b);l(y)}catch{}finally{d(!1)}}},[a]),p=(b,y)=>b.field==="hd"||b.field==="favorite"?t.jsxs("select",{value:b.value,onChange:v=>f(y,{value:v.target.value}),className:"flex-1 min-w-0 px-2 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-white text-xs focus:outline-none focus:border-indigo-500",children:[t.jsx("option",{value:"true",children:"Yes"}),t.jsx("option",{value:"false",children:"No"})]}):b.field==="group"&&s&&s.length>0?t.jsxs(t.Fragment,{children:[t.jsx("input",{list:`group-options-${y}`,type:"text",value:b.value,onChange:v=>f(y,{value:v.target.value}),placeholder:"e.g. Sports",className:"flex-1 min-w-0 px-2 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-white text-xs placeholder-gray-500 focus:outline-none focus:border-indigo-500"}),t.jsx("datalist",{id:`group-options-${y}`,children:s.map(v=>t.jsx("option",{value:v},v))})]}):b.field==="sourceName"&&n&&n.length>0?t.jsxs(t.Fragment,{children:[t.jsx("input",{list:`source-options-${y}`,type:"text",value:b.value,onChange:v=>f(y,{value:v.target.value}),placeholder:"e.g. My IPTV",className:"flex-1 min-w-0 px-2 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-white text-xs placeholder-gray-500 focus:outline-none focus:border-indigo-500"}),t.jsx("datalist",{id:`source-options-${y}`,children:n.map(v=>t.jsx("option",{value:v},v))})]}):b.field==="sourceType"?t.jsxs("select",{value:b.value,onChange:v=>f(y,{value:v.target.value}),className:"flex-1 min-w-0 px-2 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-white text-xs focus:outline-none focus:border-indigo-500",children:[t.jsx("option",{value:"",children:"Select..."}),t.jsx("option",{value:"m3u",children:"M3U"}),t.jsx("option",{value:"xtream",children:"Xtream"})]}):t.jsx("input",{type:b.field==="number"?"number":"text",value:b.value,onChange:v=>f(y,{value:v.target.value}),placeholder:b.field==="number"?"e.g. 100":"e.g. ESPN",className:"flex-1 min-w-0 px-2 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-white text-xs placeholder-gray-500 focus:outline-none focus:border-indigo-500"});return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("span",{className:"text-xs text-gray-400",children:"Match channels where:"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[t.jsx("input",{type:"radio",name:"matchMode",checked:a.match==="any",onChange:()=>{e({...a,match:"any"}),l(null)},className:"text-indigo-500 focus:ring-indigo-500 bg-gray-700 border-gray-600"}),t.jsx("span",{className:"text-xs text-gray-300",children:"Any condition"})]}),t.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[t.jsx("input",{type:"radio",name:"matchMode",checked:a.match==="all",onChange:()=>{e({...a,match:"all"}),l(null)},className:"text-indigo-500 focus:ring-indigo-500 bg-gray-700 border-gray-600"}),t.jsx("span",{className:"text-xs text-gray-300",children:"All conditions"})]})]})]}),t.jsx("div",{className:"space-y-2",children:a.conditions.map((b,y)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("select",{value:b.field,onChange:v=>f(y,{field:v.target.value}),className:"w-36 flex-shrink-0 px-2 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-white text-xs focus:outline-none focus:border-indigo-500",children:Sj.map(v=>t.jsx("option",{value:v.value,children:v.label},v.value))}),t.jsx("select",{value:b.op,onChange:v=>f(y,{op:v.target.value}),className:"w-32 flex-shrink-0 px-2 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-white text-xs focus:outline-none focus:border-indigo-500",children:QN(b.field).map(v=>t.jsx("option",{value:v.value,children:v.label},v.value))}),p(b,y),t.jsx("button",{type:"button",onClick:()=>u(y),className:"p-1.5 text-gray-500 hover:text-red-400 rounded-lg hover:bg-gray-700 transition-colors flex-shrink-0",title:"Remove condition",children:t.jsx(nt,{className:"w-3.5 h-3.5"})})]},y))}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("button",{type:"button",onClick:h,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs text-indigo-400 hover:text-indigo-300 border border-indigo-500/30 hover:border-indigo-500/50 rounded-lg transition-colors",children:[t.jsx(Pt,{className:"w-3.5 h-3.5"}),"Add Condition"]}),a.conditions.length>0&&t.jsxs("button",{type:"button",onClick:g,disabled:o,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs text-emerald-400 hover:text-emerald-300 border border-emerald-500/30 hover:border-emerald-500/50 rounded-lg transition-colors disabled:opacity-50",children:[o?t.jsx(Ke,{className:"w-3.5 h-3.5 animate-spin"}):t.jsx(Pi,{className:"w-3.5 h-3.5"}),"Preview"]}),i!==null&&t.jsx("span",{className:"text-xs text-gray-400",children:i.count===0?t.jsx("span",{className:"text-amber-400",children:"No channels match"}):t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-emerald-400 font-medium",children:i.count})," ","channel",i.count!==1?"s":""," matched"]})})]}),i&&i.channels.length>0&&t.jsx("div",{className:"bg-gray-700/30 border border-gray-600 rounded-lg max-h-48 overflow-y-auto",children:i.channels.map(b=>t.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 border-b border-gray-700/50 last:border-0",children:[V0(b.logo)?t.jsx("img",{src:b.logo,alt:"",className:"w-5 h-5 rounded object-contain flex-shrink-0 bg-gray-800"}):t.jsx("div",{className:"w-5 h-5 rounded bg-gray-800 flex items-center justify-center flex-shrink-0",children:t.jsx(jt,{className:"w-2.5 h-2.5 text-gray-600"})}),t.jsx("span",{className:"text-xs text-gray-500 font-mono w-8 text-right flex-shrink-0",children:b.number}),t.jsx("span",{className:"text-sm text-gray-300 truncate flex-1",children:b.name}),b.group&&t.jsx("span",{className:"text-xs text-gray-500 truncate max-w-24",children:b.group})]},b.id))}),a.conditions.length===0&&t.jsx("p",{className:"text-xs text-gray-500",children:"Add conditions to automatically populate this lineup based on channel properties like group, name, or source."})]})}function hF({allChannels:a,selectedIds:e,onChange:s}){const[n,i]=k.useState(""),[l,o]=k.useState(""),d=k.useMemo(()=>new Set(e),[e]),h=k.useMemo(()=>a.filter(N=>{if(d.has(N.id))return!1;if(!n.trim())return!0;const C=n.toLowerCase();return N.name.toLowerCase().includes(C)||String(N.number).includes(C)||N.group?.toLowerCase().includes(C)}),[a,d,n]),u=k.useMemo(()=>e.map(N=>a.find(C=>C.id===N)).filter(Boolean),[e,a]),f=k.useMemo(()=>u.filter(N=>{if(!l.trim())return!0;const C=l.toLowerCase();return N.name.toLowerCase().includes(C)||String(N.number).includes(C)}),[u,l]),g=N=>{s([...e,N])},p=N=>{s(e.filter(C=>C!==N))},b=N=>{if(N<=0)return;const C=[...e];[C[N-1],C[N]]=[C[N],C[N-1]],s(C)},y=N=>{if(N>=e.length-1)return;const C=[...e];[C[N],C[N+1]]=[C[N+1],C[N]],s(C)},v=()=>{const N=h.map(C=>C.id);s([...e,...N])},_=()=>{s([])};return t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("label",{className:"text-sm font-medium text-gray-300",children:["Available (",h.length,")"]}),t.jsx("button",{type:"button",onClick:v,className:"text-xs text-indigo-400 hover:text-indigo-300 transition-colors",children:"Add All"})]}),t.jsxs("div",{className:"relative mb-2",children:[t.jsx(xt,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),t.jsx("input",{type:"text",value:n,onChange:N=>i(N.target.value),placeholder:"Search...",className:"w-full pl-8 pr-3 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-white text-xs placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),t.jsx("div",{className:"bg-gray-700/40 border border-gray-600 rounded-lg max-h-64 overflow-y-auto",children:h.length===0?t.jsx("div",{className:"p-4 text-center text-xs text-gray-500",children:n?"No matches":"All channels selected"}):h.map(N=>t.jsxs("button",{type:"button",onClick:()=>g(N.id),className:"w-full flex items-center gap-2 px-3 py-2 text-left hover:bg-gray-700 transition-colors border-b border-gray-700/50 last:border-0",children:[V0(N.logo)?t.jsx("img",{src:N.logo,alt:"",className:"w-6 h-6 rounded object-contain flex-shrink-0 bg-gray-800"}):t.jsx("div",{className:"w-6 h-6 rounded bg-gray-800 flex items-center justify-center flex-shrink-0",children:t.jsx(jt,{className:"w-3 h-3 text-gray-600"})}),t.jsx("span",{className:"text-xs text-gray-400 font-mono w-8 text-right flex-shrink-0",children:N.number}),t.jsx("span",{className:"text-sm text-gray-300 truncate flex-1",children:N.name}),t.jsx(Ba,{className:"w-3.5 h-3.5 text-gray-600 flex-shrink-0"})]},N.id))})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("label",{className:"text-sm font-medium text-gray-300",children:["Selected (",e.length,")"]}),e.length>0&&t.jsx("button",{type:"button",onClick:_,className:"text-xs text-red-400 hover:text-red-300 transition-colors",children:"Remove All"})]}),t.jsxs("div",{className:"relative mb-2",children:[t.jsx(xt,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),t.jsx("input",{type:"text",value:l,onChange:N=>o(N.target.value),placeholder:"Search...",className:"w-full pl-8 pr-3 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-white text-xs placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),t.jsx("div",{className:"bg-gray-700/40 border border-gray-600 rounded-lg max-h-64 overflow-y-auto",children:f.length===0?t.jsx("div",{className:"p-4 text-center text-xs text-gray-500",children:l?"No matches":"No channels selected"}):f.map(N=>{const C=e.indexOf(N.id);return t.jsxs("div",{className:"flex items-center gap-1 px-2 py-1.5 border-b border-gray-700/50 last:border-0 group",children:[t.jsx(cp,{className:"w-3.5 h-3.5 text-gray-600 flex-shrink-0"}),t.jsx("span",{className:"text-xs text-gray-500 font-mono w-5 text-right flex-shrink-0",children:C+1}),V0(N.logo)?t.jsx("img",{src:N.logo,alt:"",className:"w-5 h-5 rounded object-contain flex-shrink-0 bg-gray-800"}):t.jsx("div",{className:"w-5 h-5 rounded bg-gray-800 flex items-center justify-center flex-shrink-0",children:t.jsx(jt,{className:"w-2.5 h-2.5 text-gray-600"})}),t.jsx("span",{className:"text-sm text-gray-300 truncate flex-1",children:N.name}),t.jsxs("div",{className:"flex items-center gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",children:[t.jsx("button",{type:"button",onClick:()=>b(C),disabled:C===0,className:"p-0.5 text-gray-500 hover:text-white disabled:opacity-30 transition-colors",title:"Move up",children:t.jsx(ko,{className:"w-3.5 h-3.5 rotate-90"})}),t.jsx("button",{type:"button",onClick:()=>y(C),disabled:C===e.length-1,className:"p-0.5 text-gray-500 hover:text-white disabled:opacity-30 transition-colors",title:"Move down",children:t.jsx(Ba,{className:"w-3.5 h-3.5 rotate-90"})}),t.jsx("button",{type:"button",onClick:()=>p(N.id),className:"p-0.5 text-gray-500 hover:text-red-400 transition-colors",title:"Remove",children:t.jsx(nt,{className:"w-3.5 h-3.5"})})]})]},N.id)})})]})]})}function fF({collection:a,onClose:e}){const s=at(),n=!!a,[i,l]=k.useState(a?.name||""),[o,d]=k.useState(a?.description||""),[h,u]=k.useState(a?.smart||!1),[f,g]=k.useState(cF(a?.smartRules)),[p,b]=k.useState(Ih(a?.channelIds)),[y,v]=k.useState(Ih(a?.virtualStationIds)),{data:_,isLoading:N}=Fe({queryKey:["live-channels"],queryFn:nF}),{data:C}=Fe({queryKey:["virtual-stations"],queryFn:iF}),T=Me({mutationFn:tF,onSuccess:()=>{s.invalidateQueries({queryKey:["channel-collections"]}),e()}}),L=Me({mutationFn:P=>sF(a.id,P),onSuccess:()=>{s.invalidateQueries({queryKey:["channel-collections"]}),e()}}),F=T.isPending||L.isPending,H=P=>{v(I=>I.includes(P)?I.filter(D=>D!==P):[...I,P])},B=P=>{P.preventDefault();const I={name:i,description:o||void 0,smart:h,smartRules:h?JSON.stringify(f):void 0,channelIds:h?"":XN(p),virtualStationIds:XN(y)||void 0};n?L.mutate(I):T.mutate(I)};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"sticky top-0 bg-gray-800 px-6 pt-6 pb-4 border-b border-gray-700 flex items-center justify-between z-10",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(xh,{className:"w-5 h-5 text-indigo-400"}),t.jsx("h2",{className:"text-lg font-semibold text-white",children:n?"Edit Channel Lineup":"Create Channel Lineup"})]}),t.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-white rounded-lg hover:bg-gray-700 transition-colors",children:t.jsx(nt,{className:"w-5 h-5"})})]}),t.jsxs("form",{onSubmit:B,className:"p-6 space-y-5",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Lineup Name"}),t.jsx("input",{type:"text",value:i,onChange:P=>l(P.target.value),required:!0,placeholder:"My Custom Lineup",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Description"}),t.jsx("input",{type:"text",value:o,onChange:P=>d(P.target.value),placeholder:"Optional description",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Lineup Type"}),t.jsxs("div",{className:"flex rounded-lg border border-gray-600 overflow-hidden",children:[t.jsxs("button",{type:"button",onClick:()=>u(!1),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors ${h?"bg-gray-700 text-gray-400 hover:text-gray-300":"bg-indigo-600 text-white"}`,children:[t.jsx(xh,{className:"w-4 h-4"}),"Manual"]}),t.jsxs("button",{type:"button",onClick:()=>u(!0),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors ${h?"bg-indigo-600 text-white":"bg-gray-700 text-gray-400 hover:text-gray-300"}`,children:[t.jsx(xa,{className:"w-4 h-4"}),"Smart (Auto-populate)"]})]})]}),h?t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-300 mb-3",children:"Auto-populate Rules"}),t.jsx(uF,{config:f,onChange:g})]}):t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-300 mb-3",children:"Channels"}),N?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx(Ke,{className:"w-6 h-6 text-indigo-500 animate-spin"})}):_?t.jsx(hF,{allChannels:_,selectedIds:p,onChange:b}):t.jsx("p",{className:"text-gray-500 text-sm",children:"No channels available"})]}),C&&C.length>0&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-300 mb-3",children:"Include Virtual Stations"}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:C.filter(P=>P.enabled).map(P=>{const I=y.includes(P.id);return t.jsxs("button",{type:"button",onClick:()=>H(P.id),className:`flex items-center gap-2 px-3 py-2 rounded-lg border text-sm text-left transition-colors ${I?"border-indigo-500 bg-indigo-500/10 text-white":"border-gray-600 bg-gray-700/40 text-gray-400 hover:border-gray-500"}`,children:[t.jsx($s,{className:`w-4 h-4 flex-shrink-0 ${I?"text-indigo-400":"text-gray-500"}`}),t.jsx("span",{className:"truncate",children:P.name}),t.jsxs("span",{className:"text-xs text-gray-500 font-mono flex-shrink-0",children:["#",P.number]})]},P.id)})})]}),(T.isError||L.isError)&&t.jsxs("p",{className:"text-red-400 text-sm flex items-center gap-1",children:[t.jsx(kt,{className:"w-4 h-4"}),(T.error||L.error)?.message||"Operation failed"]}),t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2.5 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:F||!i.trim(),className:"flex-1 py-2.5 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-40 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors",children:F?t.jsx(Ke,{className:"w-4 h-4 animate-spin mx-auto"}):n?"Save Changes":"Create Lineup"})]})]})]})})}function mF({lineup:a,onEdit:e,onDelete:s}){const[n,i]=k.useState(!1),l=Ih(a.channelIds).length,o=Ih(a.virtualStationIds).length,d=l+o,h=()=>{const g=JN(a.id);window.open(g,"_blank")},u=async()=>{const g=`${window.location.origin}${JN(a.id)}`;try{await navigator.clipboard.writeText(g),i(!0),setTimeout(()=>i(!1),2e3)}catch{const p=document.createElement("textarea");p.value=g,document.body.appendChild(p),p.select(),document.execCommand("copy"),document.body.removeChild(p),i(!0),setTimeout(()=>i(!1),2e3)}},f=k.useMemo(()=>{if(!a.smart||!a.smartRules)return null;try{const g=JSON.parse(a.smartRules);if(!g.conditions||g.conditions.length===0)return"No rules defined";const p=g.conditions.map(y=>`${Sj.find(_=>_.value===y.field)?.label||y.field} ${y.op} "${y.value}"`),b=g.match==="all"?" AND ":" OR ";return p.join(b)}catch{return"Smart rules"}},[a.smart,a.smartRules]);return t.jsx("div",{className:"bg-gray-800 rounded-xl p-5 border border-gray-700 hover:border-gray-600 transition-colors",children:t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsxs("div",{className:"flex items-start gap-4 flex-1 min-w-0",children:[t.jsx("div",{className:`flex-shrink-0 w-12 h-12 rounded-xl flex items-center justify-center ${a.smart?"bg-amber-600/20":"bg-indigo-600/20"}`,children:a.smart?t.jsx(xa,{className:"w-6 h-6 text-amber-400"}):t.jsx(xh,{className:"w-6 h-6 text-indigo-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h3",{className:"text-white font-semibold truncate",children:a.name}),a.smart&&t.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 text-[10px] font-medium bg-amber-500/20 text-amber-400 rounded",children:[t.jsx(xa,{className:"w-2.5 h-2.5"}),"SMART"]})]}),a.description&&t.jsx("p",{className:"text-sm text-gray-400 line-clamp-1 mt-0.5",children:a.description}),f&&t.jsx("p",{className:"text-xs text-amber-400/70 line-clamp-1 mt-0.5 font-mono",children:f}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-2 text-xs text-gray-500",children:[!a.smart&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(jt,{className:"w-3 h-3"}),l," channels"]}),a.smart&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(xa,{className:"w-3 h-3"}),"Auto-populated"]}),o>0&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx($s,{className:"w-3 h-3"}),o," virtual"]}),!a.smart&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(dp,{className:"w-3 h-3"}),d," total"]})]})]})]}),t.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[t.jsx("button",{onClick:h,className:"p-2 text-gray-400 hover:text-green-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Export M3U",children:t.jsx(gs,{className:"w-4 h-4"})}),t.jsx("button",{onClick:u,className:"p-2 text-gray-400 hover:text-blue-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Copy M3U URL",children:n?t.jsx(Bs,{className:"w-4 h-4 text-green-400"}):t.jsx(d0,{className:"w-4 h-4"})}),t.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-indigo-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Edit",children:t.jsx(an,{className:"w-4 h-4"})}),t.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Delete",children:t.jsx(Dt,{className:"w-4 h-4"})})]})]})})}function gF(){const a=at(),{data:e,isLoading:s,error:n}=Fe({queryKey:["channel-collections"],queryFn:eF}),i=Me({mutationFn:aF,onSuccess:()=>a.invalidateQueries({queryKey:["channel-collections"]})}),[l,o]=k.useState(null),[d,h]=k.useState(""),u=(e||[]).filter(g=>{if(!d.trim())return!0;const p=d.toLowerCase();return g.name.toLowerCase().includes(p)||g.description?.toLowerCase().includes(p)}),f=g=>{confirm("Delete this channel lineup? This cannot be undone.")&&i.mutate(g)};return t.jsxs("div",{children:[t.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Channel Lineups"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Build custom channel lineups and export them as M3U playlists"})]}),t.jsxs("button",{onClick:()=>o("new"),className:"flex items-center gap-2 px-4 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors",children:[t.jsx(Pt,{className:"w-4 h-4"}),"New Lineup"]})]}),(e?.length||0)>3&&t.jsxs("div",{className:"relative mb-6",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),t.jsx("input",{type:"text",value:d,onChange:g=>h(g.target.value),placeholder:"Search lineups...",className:"w-full pl-10 pr-4 py-2.5 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),s?t.jsx("div",{className:"flex items-center justify-center py-16",children:t.jsx(Ke,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):n?t.jsxs("div",{className:"text-center py-16 bg-gray-800 rounded-xl",children:[t.jsx(kt,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Failed to load channel lineups"}),t.jsx("p",{className:"text-gray-400 text-sm",children:n instanceof Error?n.message:"Unknown error"})]}):u.length===0?t.jsxs("div",{className:"text-center py-16 bg-gray-800 rounded-xl",children:[t.jsx(xh,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:d?"No matching lineups":"No channel lineups yet"}),t.jsx("p",{className:"text-gray-400 mb-6",children:d?`No lineups match "${d}"`:"Create custom channel lineups for external players via M3U."}),!d&&t.jsxs("button",{onClick:()=>o("new"),className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors",children:[t.jsx(Pt,{className:"w-4 h-4"}),"New Lineup"]})]}):t.jsx("div",{className:"space-y-3",children:u.map(g=>t.jsx(mF,{lineup:g,onEdit:()=>o(g),onDelete:()=>f(g.id)},g.id))}),l!==null&&t.jsx(fF,{collection:l==="new"?null:l,onClose:()=>o(null)})]})}const q0=async(a,e)=>{const s=localStorage.getItem("openflix_token")||"",n=await fetch(a,{...e,headers:{"X-Plex-Token":s,"Content-Type":"application/json",...e?.headers}});if(!n.ok)throw new Error(`API error: ${n.status}`);return n.json()};function pF(a,e){return Fe({queryKey:["mediaSearch",a,e],queryFn:()=>q0(`/admin/media?search=${encodeURIComponent(a)}&page=${e}`),enabled:a.length>=2,placeholderData:s=>s})}function dh(a){if(!a)return"";const e=localStorage.getItem("openflix_token")||"";return`/api/images/proxy?url=${encodeURIComponent(a)}&X-Plex-Token=${e}`}function xF({items:a,onSelect:e}){return t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:a.map(s=>t.jsxs("button",{onClick:()=>e(s),className:"group bg-gray-700/50 rounded-lg overflow-hidden text-left hover:ring-2 hover:ring-indigo-500 transition-all",children:[t.jsxs("div",{className:"aspect-[2/3] bg-gray-700 relative",children:[s.posterUrl?t.jsx("img",{src:dh(s.posterUrl),alt:s.title,className:"w-full h-full object-cover",loading:"lazy"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx(Oi,{className:"h-8 w-8 text-gray-600"})}),t.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-colors flex items-center justify-center",children:t.jsx(bh,{className:"h-6 w-6 text-white opacity-0 group-hover:opacity-100 transition-opacity"})})]}),t.jsxs("div",{className:"p-2",children:[t.jsx("p",{className:"text-sm text-white truncate",children:s.title}),t.jsxs("p",{className:"text-xs text-gray-400",children:[s.year&&`${s.year} - `,t.jsx("span",{className:"capitalize",children:s.type})]})]})]},s.id))})}function yF({item:a,onClose:e}){const[s,n]=k.useState("poster"),[i,l]=k.useState(""),[o,d]=k.useState(null),[h,u]=k.useState(!1),[f,g]=k.useState(null),{data:p,isLoading:b}=Fe({queryKey:["tmdbArtwork",a.id,a.tmdbId,s],queryFn:async()=>a.tmdbId?(await q0(`/admin/media/${a.id}/artwork?type=${s}&tmdbId=${a.tmdbId}`)).results||[]:[],enabled:!!a.tmdbId}),y=s==="poster"?a.posterUrl:a.backdropUrl,v=o||i||null,_=k.useCallback(async()=>{const N=o||i;if(N){u(!0),g(null);try{await q0(`/admin/media/${a.id}/artwork`,{method:"PUT",body:JSON.stringify({type:s,url:N})}),g({success:!0,message:"Artwork updated successfully"})}catch(C){g({success:!1,message:C instanceof Error?C.message:"Failed to update artwork"})}finally{u(!1)}}},[o,i,s,a.id]);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg transition-colors",children:t.jsx(Er,{className:"h-5 w-5"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-white",children:a.title}),t.jsxs("p",{className:"text-sm text-gray-400",children:[a.year&&`${a.year} - `,t.jsx("span",{className:"capitalize",children:a.type}),a.tmdbId&&` - TMDB: ${a.tmdbId}`]})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>{n("poster"),d(null),l(""),g(null)},className:`px-4 py-2 rounded-lg font-medium ${s==="poster"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-400 hover:text-white"}`,children:"Poster"}),t.jsx("button",{onClick:()=>{n("backdrop"),d(null),l(""),g(null)},className:`px-4 py-2 rounded-lg font-medium ${s==="backdrop"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-400 hover:text-white"}`,children:"Backdrop"})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-400 uppercase tracking-wider mb-4",children:"Preview"}),t.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Current"}),t.jsx("div",{className:`bg-gray-700 rounded-lg overflow-hidden ${s==="poster"?"aspect-[2/3]":"aspect-video"}`,children:y?t.jsx("img",{src:dh(y),alt:"Current artwork",className:"w-full h-full object-cover"}):t.jsxs("div",{className:"w-full h-full flex items-center justify-center",children:[t.jsx(Oi,{className:"h-12 w-12 text-gray-600"}),t.jsx("span",{className:"text-gray-500 ml-2",children:"No artwork"})]})})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"New"}),t.jsx("div",{className:`bg-gray-700 rounded-lg overflow-hidden border-2 ${v?"border-indigo-500":"border-gray-600 border-dashed"} ${s==="poster"?"aspect-[2/3]":"aspect-video"}`,children:v?t.jsx("img",{src:dh(v),alt:"New artwork",className:"w-full h-full object-cover"}):t.jsxs("div",{className:"w-full h-full flex items-center justify-center",children:[t.jsx(bh,{className:"h-12 w-12 text-gray-600"}),t.jsx("span",{className:"text-gray-500 ml-2",children:"Select artwork below"})]})})]})]}),v&&t.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[t.jsxs("button",{onClick:_,disabled:h,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg",children:[h?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):t.jsx(bh,{className:"h-4 w-4"}),h?"Saving...":"Apply Artwork"]}),t.jsx("button",{onClick:()=>{d(null),l(""),g(null)},className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg",children:"Cancel"})]}),f&&t.jsx("div",{className:`mt-3 flex items-center gap-2 p-3 rounded-lg ${f.success?"bg-green-500/10 border border-green-500/30":"bg-red-500/10 border border-red-500/30"}`,children:t.jsx("span",{className:f.success?"text-green-400 text-sm":"text-red-400 text-sm",children:f.message})})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(I4,{className:"h-4 w-4 text-gray-400"}),t.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"Custom URL"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:i,onChange:N=>{l(N.target.value),d(null)},className:"flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",placeholder:"https://example.com/artwork.jpg"}),i&&t.jsx("button",{onClick:()=>l(""),className:"p-2 text-gray-400 hover:text-white",children:t.jsx(nt,{className:"h-4 w-4"})})]})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(Mi,{className:"h-4 w-4 text-gray-400"}),t.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"Upload Custom Artwork"})]}),t.jsxs("label",{className:"block border-2 border-dashed border-gray-600 hover:border-gray-500 rounded-lg p-6 text-center cursor-pointer transition-colors",children:[t.jsx(Mi,{className:"h-8 w-8 mx-auto text-gray-500 mb-2"}),t.jsx("p",{className:"text-gray-400 text-sm",children:"Click to upload an image"}),t.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"PNG, JPG, or WebP"}),t.jsx("input",{type:"file",className:"hidden",accept:"image/png,image/jpeg,image/webp",onChange:async N=>{const C=N.target.files?.[0];if(!C)return;const T=localStorage.getItem("openflix_token")||"",L=new FormData;L.append("file",C),L.append("type",s);try{const F=await fetch(`/admin/media/${a.id}/artwork/upload`,{method:"POST",headers:{"X-Plex-Token":T},body:L});if(!F.ok)throw new Error("Upload failed");const H=await F.json();H.url&&(d(H.url),l(""))}catch{g({success:!1,message:"Failed to upload artwork"})}}})]})]}),a.tmdbId&&t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("h3",{className:"text-sm font-medium text-gray-300 mb-4",children:["TMDB ",s==="poster"?"Posters":"Backdrops"]}),b?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx(Ke,{className:"h-6 w-6 text-indigo-500 animate-spin"})}):p&&p.length>0?t.jsx("div",{className:`grid gap-3 ${s==="poster"?"grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6":"grid-cols-2 sm:grid-cols-3 md:grid-cols-4"}`,children:p.map((N,C)=>t.jsxs("button",{onClick:()=>{d(N.url),l("")},className:`rounded-lg overflow-hidden border-2 transition-all ${o===N.url?"border-indigo-500 ring-2 ring-indigo-500/50":"border-transparent hover:border-gray-500"}`,children:[t.jsx("div",{className:s==="poster"?"aspect-[2/3]":"aspect-video",children:t.jsx("img",{src:dh(N.url),alt:`TMDB artwork ${C+1}`,className:"w-full h-full object-cover",loading:"lazy"})}),t.jsx("div",{className:"p-1 bg-gray-700 text-center",children:t.jsxs("span",{className:"text-xs text-gray-400",children:[N.width,"x",N.height]})})]},C))}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx(Oi,{className:"h-8 w-8 text-gray-600 mx-auto mb-2"}),t.jsx("p",{className:"text-gray-500 text-sm",children:"No TMDB artwork found"})]})]})]})}function bF(){const[a,e]=k.useState(""),[s,n]=k.useState(1),[i,l]=k.useState(null),{data:o,isLoading:d,error:h}=pF(a,s);return i?t.jsx("div",{children:t.jsx(yF,{item:i,onClose:()=>l(null)})}):t.jsxs("div",{children:[t.jsxs("div",{className:"mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(bh,{className:"h-6 w-6 text-indigo-400"}),t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Artwork Manager"})]}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Search and update artwork for movies, TV shows, and other media"})]}),t.jsx("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:t.jsxs("div",{className:"relative",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),t.jsx("input",{type:"text",value:a,onChange:u=>{e(u.target.value),n(1)},className:"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500",placeholder:"Search for a movie or TV show..."}),a&&t.jsx("button",{onClick:()=>e(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-white",children:t.jsx(nt,{className:"h-4 w-4"})})]})}),!a||a.length<2?t.jsxs("div",{className:"bg-gray-800 rounded-xl p-12 text-center",children:[t.jsx(Oi,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Search for Media"}),t.jsx("p",{className:"text-gray-400",children:"Enter at least 2 characters to search your media library."})]}):d?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx(Ke,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):h?t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 text-center",children:[t.jsx(kt,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Search Failed"}),t.jsx("p",{className:"text-gray-400",children:"Could not search media library. Please try again."})]}):o&&o.items.length>0?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("p",{className:"text-sm text-gray-400",children:[o.total," result",o.total!==1?"s":""," found"]})}),t.jsx(xF,{items:o.items,onSelect:l}),o.total>24&&t.jsxs("div",{className:"flex justify-center gap-2 pt-4",children:[t.jsx("button",{onClick:()=>n(u=>Math.max(1,u-1)),disabled:s===1,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:text-gray-600 text-white rounded-lg",children:"Previous"}),t.jsxs("span",{className:"px-4 py-2 text-gray-400",children:["Page ",s]}),t.jsx("button",{onClick:()=>n(u=>u+1),disabled:o.items.length<24,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:text-gray-600 text-white rounded-lg",children:"Next"})]})]}):t.jsxs("div",{className:"bg-gray-800 rounded-xl p-12 text-center",children:[t.jsx(xt,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No Results"}),t.jsxs("p",{className:"text-gray-400",children:['No media found matching "',a,'"']})]})]})}const Do={"X-Plex-Token":localStorage.getItem("openflix_token")||"","Content-Type":"application/json"};async function vF(){const a=await fetch("/dvr/v2/collections",{headers:Do});if(!a.ok)throw new Error("Failed to fetch collections");return(await a.json()).collections||[]}async function _F(a){const e=await fetch("/dvr/v2/collections",{method:"POST",headers:Do,body:JSON.stringify(a)});if(!e.ok)throw new Error("Failed to create collection");return e.json()}async function NF(a,e){const s=await fetch(`/dvr/v2/collections/${a}`,{method:"PUT",headers:Do,body:JSON.stringify(e)});if(!s.ok)throw new Error("Failed to update collection");return s.json()}async function wF(a){if(!(await fetch(`/dvr/v2/collections/${a}`,{method:"DELETE",headers:Do})).ok)throw new Error("Failed to delete collection")}async function SF(a){const e=await fetch(`/dvr/v2/collections/${a}/items`,{headers:Do});if(!e.ok)throw new Error("Failed to fetch items");return(await e.json()).items||[]}async function jF(a){const e=await fetch("/dvr/v2/collections/preview",{method:"POST",headers:Do,body:JSON.stringify({smartRule:a})});if(!e.ok)throw new Error("Failed to preview");const s=await e.json();return s.files||s.items||[]}const EF=[{value:"title",label:"Title"},{value:"genre",label:"Genre"},{value:"year",label:"Year"},{value:"rating",label:"Rating"},{value:"duration",label:"Duration"},{value:"type",label:"Type"},{value:"studio",label:"Studio"},{value:"resolution",label:"Resolution"},{value:"addedAt",label:"Date Added"}],TF=[{value:"is",label:"is"},{value:"is_not",label:"is not"},{value:"contains",label:"contains"},{value:"starts_with",label:"starts with"},{value:"ends_with",label:"ends with"},{value:"gt",label:"greater than"},{value:"lt",label:"less than"}],AF=[{value:"title",label:"Title"},{value:"year",label:"Year"},{value:"addedAt",label:"Date Added"},{value:"duration",label:"Duration"},{value:"rating",label:"Rating"}];function CF(a){if(!a)return[{field:"title",operator:"contains",value:""}];try{const e=JSON.parse(a);if(Array.isArray(e)&&e.length>0)return e}catch{}return[{field:"title",operator:"contains",value:""}]}function ZN(a){return JSON.stringify(a.filter(e=>e.value.trim()!==""))}function kF(a){return a?a.split(",").filter(Boolean).length:0}function RF({conditions:a,onChange:e}){const s=(l,o)=>{e(a.map((d,h)=>h===l?{...d,...o}:d))},n=()=>e([...a,{field:"title",operator:"contains",value:""}]),i=l=>{a.length<=1||e(a.filter((o,d)=>d!==l))};return t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Smart Rules"}),a.map((l,o)=>t.jsxs("div",{className:"flex items-center gap-2",children:[o>0&&t.jsx("span",{className:"text-xs text-indigo-400 font-medium w-8",children:"AND"}),o===0&&t.jsx("span",{className:"w-8"}),t.jsx("select",{value:l.field,onChange:d=>s(o,{field:d.target.value}),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",children:EF.map(d=>t.jsx("option",{value:d.value,children:d.label},d.value))}),t.jsx("select",{value:l.operator,onChange:d=>s(o,{operator:d.target.value}),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",children:TF.map(d=>t.jsx("option",{value:d.value,children:d.label},d.value))}),t.jsx("input",{type:"text",value:l.value,onChange:d=>s(o,{value:d.target.value}),placeholder:"Value",className:"flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500"}),t.jsx("button",{onClick:()=>i(o),disabled:a.length<=1,className:"p-2 text-gray-400 hover:text-red-400 disabled:opacity-30 rounded-lg hover:bg-gray-700 transition-colors",children:t.jsx(Dt,{className:"w-4 h-4"})})]},o)),t.jsxs("button",{onClick:n,className:"flex items-center gap-1 text-sm text-indigo-400 hover:text-indigo-300 transition-colors",children:[t.jsx(Pt,{className:"w-3.5 h-3.5"}),"Add Condition"]})]})}function LF({collection:a,onClose:e}){const s=at(),n=!!a,[i,l]=k.useState(a?.title||""),[o,d]=k.useState(a?.description||""),[h,u]=k.useState(a?.thumb||""),[f,g]=k.useState(a?.smart??!0),[p,b]=k.useState(CF(a?.smartRule)),[y,v]=k.useState(a?.fileIds||""),[_,N]=k.useState(a?.sort||"title"),[C,T]=k.useState(a?.order||"asc"),[L,F]=k.useState([]),[H,B]=k.useState(!1),[P,I]=k.useState(""),D=Me({mutationFn:_F,onSuccess:()=>{s.invalidateQueries({queryKey:["collections"]}),e()}}),O=Me({mutationFn:z=>NF(a.id,z),onSuccess:()=>{s.invalidateQueries({queryKey:["collections"]}),e()}}),ee=D.isPending||O.isPending,ie=async()=>{B(!0),I("");try{const z=await jF(ZN(p));F(z)}catch(z){I(z instanceof Error?z.message:"Preview failed")}finally{B(!1)}},Z=z=>{z.preventDefault();const X={title:i,description:o||void 0,thumb:h||void 0,smart:f,sort:_,order:C};f?(X.smartRule=ZN(p),X.fileIds=void 0):(X.fileIds=y,X.smartRule=void 0),n?O.mutate(X):D.mutate(X)};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"sticky top-0 bg-gray-800 px-6 pt-6 pb-4 border-b border-gray-700 flex items-center justify-between z-10",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(L4,{className:"w-5 h-5 text-indigo-400"}),t.jsx("h2",{className:"text-lg font-semibold text-white",children:n?"Edit Collection":"Create Collection"})]}),t.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-white rounded-lg hover:bg-gray-700 transition-colors",children:t.jsx(nt,{className:"w-5 h-5"})})]}),t.jsxs("form",{onSubmit:Z,className:"p-6 space-y-5",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Title"}),t.jsx("input",{type:"text",value:i,onChange:z=>l(z.target.value),required:!0,placeholder:"My Collection",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Description"}),t.jsx("textarea",{value:o,onChange:z=>d(z.target.value),rows:2,placeholder:"Optional description...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 resize-none focus:outline-none focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Thumbnail URL"}),t.jsx("input",{type:"url",value:h,onChange:z=>u(z.target.value),placeholder:"https://...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Content Source"}),t.jsxs("div",{className:"flex gap-2 mb-4",children:[t.jsx("button",{type:"button",onClick:()=>g(!0),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${f?"bg-indigo-600 text-white":"bg-gray-700 text-gray-400 hover:text-white"}`,children:"Smart"}),t.jsx("button",{type:"button",onClick:()=>g(!1),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${f?"bg-gray-700 text-gray-400 hover:text-white":"bg-indigo-600 text-white"}`,children:"Manual"})]}),f?t.jsxs("div",{className:"space-y-4",children:[t.jsx(RF,{conditions:p,onChange:b}),t.jsxs("button",{type:"button",onClick:ie,disabled:H,className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm font-medium transition-colors",children:[H?t.jsx(Ke,{className:"w-4 h-4 animate-spin"}):t.jsx(Pi,{className:"w-4 h-4"}),"Preview Matches"]}),P&&t.jsxs("p",{className:"text-red-400 text-sm flex items-center gap-1",children:[t.jsx(kt,{className:"w-4 h-4"}),P]}),L.length>0&&t.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-3 max-h-48 overflow-y-auto",children:[t.jsxs("p",{className:"text-xs text-gray-400 mb-2",children:[L.length," matched items"]}),L.map(z=>t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-300 py-1.5 border-b border-gray-700 last:border-0",children:[t.jsx("span",{className:"flex-1 truncate",children:z.title}),z.year&&t.jsx("span",{className:"text-xs text-gray-500",children:z.year}),z.type&&t.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-gray-600 text-gray-400 rounded",children:z.type})]},z.id))]})]}):t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"File IDs (comma-separated)"}),t.jsx("textarea",{value:y,onChange:z=>v(z.target.value),rows:3,placeholder:"1, 2, 3, ...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm font-mono placeholder-gray-500 resize-none focus:outline-none focus:border-indigo-500"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Sort By"}),t.jsx("select",{value:_,onChange:z=>N(z.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",children:AF.map(z=>t.jsx("option",{value:z.value,children:z.label},z.value))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Order"}),t.jsxs("select",{value:C,onChange:z=>T(z.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",children:[t.jsx("option",{value:"asc",children:"Ascending"}),t.jsx("option",{value:"desc",children:"Descending"})]})]})]}),(D.isError||O.isError)&&t.jsxs("p",{className:"text-red-400 text-sm flex items-center gap-1",children:[t.jsx(kt,{className:"w-4 h-4"}),(D.error||O.error)?.message||"Operation failed"]}),t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2.5 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:ee||!i.trim(),className:"flex-1 py-2.5 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-40 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors",children:ee?t.jsx(Ke,{className:"w-4 h-4 animate-spin mx-auto"}):n?"Save Changes":"Create Collection"})]})]})]})})}function DF({collection:a,onBack:e}){const{data:s,isLoading:n,error:i}=Fe({queryKey:["collection-items",a.id],queryFn:()=>SF(a.id)});return t.jsxs("div",{children:[t.jsxs("button",{onClick:e,className:"flex items-center gap-2 text-gray-400 hover:text-white mb-6 transition-colors",children:[t.jsx(Er,{className:"w-4 h-4"}),"Back to Collections"]}),t.jsx("div",{className:"mb-6",children:t.jsxs("div",{className:"flex items-center gap-4",children:[a.thumb?t.jsx("img",{src:a.thumb,alt:a.title,className:"w-20 h-20 rounded-xl object-cover"}):t.jsx("div",{className:"w-20 h-20 bg-gray-800 rounded-xl flex items-center justify-center",children:t.jsx(sa,{className:"w-8 h-8 text-gray-600"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold text-white",children:a.title}),a.description&&t.jsx("p",{className:"text-gray-400 mt-1",children:a.description}),t.jsxs("div",{className:"flex items-center gap-3 mt-2 text-sm text-gray-500",children:[t.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${a.smart?"bg-purple-500/10 text-purple-400":"bg-gray-700 text-gray-400"}`,children:a.smart?"Smart":"Manual"}),s&&t.jsxs("span",{children:[s.length," items"]})]})]})]})}),n?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx(Ke,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):i?t.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[t.jsx(kt,{className:"w-10 h-10 text-red-400 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-400",children:"Failed to load items"})]}):s&&s.length>0?t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:s.map(l=>t.jsxs("div",{className:"bg-gray-800 rounded-xl overflow-hidden border border-gray-700 hover:border-gray-600 transition-colors",children:[t.jsxs("div",{className:"aspect-[2/3] bg-gray-700 relative",children:[l.thumb?t.jsx("img",{src:l.thumb,alt:l.title,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx(Oi,{className:"w-8 h-8 text-gray-600"})}),l.type&&t.jsx("span",{className:"absolute top-2 right-2 px-1.5 py-0.5 bg-black/70 text-gray-300 text-xs rounded",children:l.type})]}),t.jsxs("div",{className:"p-3",children:[t.jsx("h4",{className:"text-sm font-medium text-white truncate",children:l.title}),l.year&&t.jsx("p",{className:"text-xs text-gray-500",children:l.year})]})]},l.id))}):t.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-xl",children:[t.jsx(sa,{className:"w-10 h-10 text-gray-600 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-400",children:"This collection is empty"})]})]})}function MF({collection:a,onEdit:e,onDelete:s,onView:n}){const i=a.smart?null:kF(a.fileIds);return t.jsxs("div",{className:"bg-gray-800 rounded-xl overflow-hidden border border-gray-700 hover:border-gray-600 transition-colors group cursor-pointer",onClick:n,children:[t.jsxs("div",{className:"aspect-video bg-gray-700 relative overflow-hidden",children:[a.thumb?t.jsx("img",{src:a.thumb,alt:a.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx(sa,{className:"w-12 h-12 text-gray-600"})}),t.jsx("div",{className:"absolute top-2 left-2",children:t.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${a.smart?"bg-purple-500/80 text-white":"bg-gray-800/80 text-gray-300"}`,children:a.smart?"Smart":"Manual"})}),t.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[t.jsx("button",{onClick:l=>{l.stopPropagation(),e()},className:"p-1.5 bg-gray-800/80 hover:bg-indigo-600 text-white rounded-lg transition-colors",title:"Edit",children:t.jsx(an,{className:"w-3.5 h-3.5"})}),t.jsx("button",{onClick:l=>{l.stopPropagation(),s()},className:"p-1.5 bg-gray-800/80 hover:bg-red-600 text-white rounded-lg transition-colors",title:"Delete",children:t.jsx(Dt,{className:"w-3.5 h-3.5"})})]})]}),t.jsxs("div",{className:"p-4",children:[t.jsx("h3",{className:"text-white font-semibold truncate",children:a.title}),a.description&&t.jsx("p",{className:"text-sm text-gray-400 line-clamp-1 mt-0.5",children:a.description}),t.jsxs("div",{className:"flex items-center justify-between mt-2",children:[t.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[i!==null&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(dp,{className:"w-3 h-3"}),i," items"]}),a.tmdbCollectionId&&t.jsx("span",{className:"px-1.5 py-0.5 bg-blue-500/10 text-blue-400 rounded",children:"TMDB"})]}),t.jsx(Ba,{className:"w-4 h-4 text-gray-600 group-hover:text-gray-400 transition-colors"})]})]})]})}function IF(){const a=at(),{data:e,isLoading:s,error:n}=Fe({queryKey:["collections"],queryFn:vF}),i=Me({mutationFn:wF,onSuccess:()=>a.invalidateQueries({queryKey:["collections"]})}),[l,o]=k.useState(null),[d,h]=k.useState(null),[u,f]=k.useState(""),g=(e||[]).filter(b=>{if(!u.trim())return!0;const y=u.toLowerCase();return b.title.toLowerCase().includes(y)||b.description?.toLowerCase().includes(y)}),p=b=>{confirm("Delete this collection? This cannot be undone.")&&i.mutate(b)};return d?t.jsx(DF,{collection:d,onBack:()=>h(null)}):t.jsxs("div",{children:[t.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Collections"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Organize your media into smart playlists and curated collections"})]}),t.jsxs("button",{onClick:()=>o("new"),className:"flex items-center gap-2 px-4 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors",children:[t.jsx(Pt,{className:"w-4 h-4"}),"New Collection"]})]}),(e?.length||0)>3&&t.jsxs("div",{className:"relative mb-6",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),t.jsx("input",{type:"text",value:u,onChange:b=>f(b.target.value),placeholder:"Search collections...",className:"w-full pl-10 pr-4 py-2.5 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),s?t.jsx("div",{className:"flex items-center justify-center py-16",children:t.jsx(Ke,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):n?t.jsxs("div",{className:"text-center py-16 bg-gray-800 rounded-xl",children:[t.jsx(kt,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Failed to load collections"}),t.jsx("p",{className:"text-gray-400 text-sm",children:n instanceof Error?n.message:"Unknown error"})]}):g.length===0?t.jsxs("div",{className:"text-center py-16 bg-gray-800 rounded-xl",children:[t.jsx(sa,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:u?"No matching collections":"No collections yet"}),t.jsx("p",{className:"text-gray-400 mb-6",children:u?`No collections match "${u}"`:"Create smart playlists or curate collections from your library."}),!u&&t.jsxs("button",{onClick:()=>o("new"),className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors",children:[t.jsx(Pt,{className:"w-4 h-4"}),"New Collection"]})]}):t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5",children:g.map(b=>t.jsx(MF,{collection:b,onEdit:()=>o(b),onDelete:()=>p(b.id),onView:()=>h(b)},b.id))}),l!==null&&t.jsx(LF,{collection:l==="new"?null:l,onClose:()=>o(null)})]})}function PF({onFiles:a}){const[e,s]=k.useState(!1),n=k.useRef(null);return t.jsxs("div",{className:`border-2 border-dashed rounded-xl p-12 text-center transition-colors cursor-pointer ${e?"border-indigo-500 bg-indigo-500/10":"border-gray-600 hover:border-gray-500"}`,onDragOver:i=>{i.preventDefault(),s(!0)},onDragLeave:()=>s(!1),onDrop:i=>{i.preventDefault(),s(!1),a(i.dataTransfer.files)},onClick:()=>n.current?.click(),children:[t.jsx(Mi,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),t.jsx("p",{className:"text-gray-300 text-lg",children:"Drag and drop video files here"}),t.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"or click to browse"}),t.jsx("p",{className:"text-gray-600 text-xs mt-3",children:"Supports MP4, MKV, AVI, TS, M2TS, MOV"}),t.jsx("input",{ref:n,type:"file",className:"hidden",accept:"video/*,.mkv,.avi,.ts,.m2ts,.mov",multiple:!0,onChange:i=>i.target.files&&a(i.target.files)})]})}function OF({item:a,onRemove:e,onUpdateMeta:s}){const n=i=>i>=1073741824?`${(i/1073741824).toFixed(1)} GB`:i>=1048576?`${(i/1048576).toFixed(0)} MB`:`${(i/1024).toFixed(0)} KB`;return t.jsx("div",{className:"bg-gray-700/50 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:"p-2 bg-gray-600 rounded-lg flex-shrink-0",children:t.jsx(K1,{className:"h-5 w-5 text-gray-300"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-white font-medium truncate",children:a.file.name}),t.jsx("p",{className:"text-xs text-gray-500",children:n(a.file.size)})]}),t.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[a.status==="uploading"&&t.jsx(Ke,{className:"h-4 w-4 text-indigo-400 animate-spin"}),a.status==="complete"&&t.jsx(Xt,{className:"h-4 w-4 text-green-400"}),a.status==="error"&&t.jsx(kt,{className:"h-4 w-4 text-red-400"}),(a.status==="pending"||a.status==="error")&&t.jsx("button",{onClick:e,className:"p-1 text-gray-400 hover:text-red-400 transition-colors",children:t.jsx(nt,{className:"h-4 w-4"})})]})]}),a.status==="uploading"&&t.jsx("div",{className:"h-1.5 bg-gray-600 rounded-full overflow-hidden mb-3",children:t.jsx("div",{className:"h-full bg-indigo-500 rounded-full transition-all duration-300",style:{width:`${a.progress}%`}})}),a.status==="error"&&t.jsx("p",{className:"text-sm text-red-400 mb-2",children:a.error||"Upload failed"}),a.status==="pending"&&t.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-2",children:[t.jsx("input",{type:"text",value:a.title,onChange:i=>s("title",i.target.value),className:"px-3 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",placeholder:"Title"}),t.jsx("input",{type:"text",value:a.group,onChange:i=>s("group",i.target.value),className:"px-3 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",placeholder:"Group (optional)"}),t.jsxs("select",{value:a.category,onChange:i=>s("category",i.target.value),className:"px-3 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",children:[t.jsx("option",{value:"",children:"Category"}),t.jsx("option",{value:"movie",children:"Movie"}),t.jsx("option",{value:"tv",children:"TV Show"}),t.jsx("option",{value:"sports",children:"Sports"}),t.jsx("option",{value:"other",children:"Other"})]})]})]})]})})}function FF(){const[a,e]=k.useState(""),[s,n]=k.useState(!1),[i,l]=k.useState(null),o=async()=>{if(a.trim()){n(!0),l(null);try{const d=localStorage.getItem("openflix_token")||"",h=await fetch("/dvr/v2/files/import",{method:"POST",headers:{"X-Plex-Token":d,"Content-Type":"application/json"},body:JSON.stringify({path:a.trim()})});if(!h.ok)throw new Error(`Import failed: ${h.status}`);const u=await h.json();l({success:!0,message:u.message||"File imported successfully",imported:u.imported})}catch(d){l({success:!1,message:d instanceof Error?d.message:"Import failed"})}finally{n(!1)}}};return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Server File Path"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:a,onChange:d=>{e(d.target.value),l(null)},className:"flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white font-mono text-sm",placeholder:"/path/to/video/file.mp4"}),t.jsxs("button",{onClick:o,disabled:!a.trim()||s,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 disabled:cursor-not-allowed text-white rounded-lg whitespace-nowrap",children:[s?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):t.jsx(co,{className:"h-4 w-4"}),"Import"]})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter the full path to a video file on the server."})]}),i&&t.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-lg ${i.success?"bg-green-500/10 border border-green-500/30":"bg-red-500/10 border border-red-500/30"}`,children:[i.success?t.jsx(Xt,{className:"h-4 w-4 text-green-400 flex-shrink-0"}):t.jsx(kt,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),t.jsx("span",{className:i.success?"text-green-400 text-sm":"text-red-400 text-sm",children:i.message})]})]})}function BF(){const[a,e]=k.useState(""),[s,n]=k.useState(!0),[i,l]=k.useState(""),[o,d]=k.useState(!1),[h,u]=k.useState(null),f=async()=>{if(a.trim()){d(!0),u(null);try{const g=localStorage.getItem("openflix_token")||"",p=await fetch("/dvr/v2/files/import/bulk",{method:"POST",headers:{"X-Plex-Token":g,"Content-Type":"application/json"},body:JSON.stringify({path:a.trim(),recursive:s,groupName:i.trim()||void 0})});if(!p.ok)throw new Error(`Bulk import failed: ${p.status}`);const b=await p.json();u({success:!0,message:b.message||"Bulk import completed",imported:b.imported})}catch(g){u({success:!1,message:g instanceof Error?g.message:"Bulk import failed"})}finally{d(!1)}}};return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Directory Path"}),t.jsx("input",{type:"text",value:a,onChange:g=>{e(g.target.value),u(null)},className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white font-mono text-sm",placeholder:"/path/to/video/directory"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Group Name (optional)"}),t.jsx("input",{type:"text",value:i,onChange:g=>l(g.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",placeholder:"e.g., Season 1"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Recursive Scan"}),t.jsx("button",{onClick:()=>n(!s),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${s?"bg-green-500/20 text-green-400 hover:bg-green-500/30":"bg-gray-700 text-gray-400 hover:bg-gray-600"}`,children:s?t.jsxs(t.Fragment,{children:[t.jsx(Pc,{className:"h-5 w-5"}),"Include Subdirectories"]}):t.jsxs(t.Fragment,{children:[t.jsx(Ic,{className:"h-5 w-5"}),"Top-Level Only"]})})]})]}),t.jsxs("button",{onClick:f,disabled:!a.trim()||o,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 disabled:cursor-not-allowed text-white rounded-lg",children:[o?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):t.jsx(co,{className:"h-4 w-4"}),o?"Importing...":"Start Bulk Import"]}),h&&t.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-lg ${h.success?"bg-green-500/10 border border-green-500/30":"bg-red-500/10 border border-red-500/30"}`,children:[h.success?t.jsx(Xt,{className:"h-4 w-4 text-green-400 flex-shrink-0"}):t.jsx(kt,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),t.jsxs("span",{className:h.success?"text-green-400 text-sm":"text-red-400 text-sm",children:[h.message,h.imported!==void 0&&` (${h.imported} files imported)`]})]})]})}function UF(){const[a,e]=k.useState("upload"),[s,n]=k.useState([]),i=g=>{const p=Array.from(g).map(b=>({id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,file:b,progress:0,status:"pending",title:b.name.replace(/\.[^.]+$/,"").replace(/[._-]/g," "),group:"",category:""}));n(b=>[...b,...p])},l=g=>{n(p=>p.filter(b=>b.id!==g))},o=(g,p,b)=>{n(y=>y.map(v=>v.id===g?{...v,[p]:b}:v))},d=async g=>{n(p=>p.map(b=>b.id===g.id?{...b,status:"uploading",progress:0}:b));try{const p=localStorage.getItem("openflix_token")||"",b=new FormData;b.append("file",g.file),g.title&&b.append("title",g.title),g.group&&b.append("group",g.group),g.category&&b.append("category",g.category);const y=new XMLHttpRequest;y.open("POST","/dvr/v2/files/upload"),y.setRequestHeader("X-Plex-Token",p),y.upload.onprogress=v=>{if(v.lengthComputable){const _=Math.round(v.loaded/v.total*100);n(N=>N.map(C=>C.id===g.id?{...C,progress:_}:C))}},await new Promise((v,_)=>{y.onload=()=>{y.status>=200&&y.status<300?(n(N=>N.map(C=>C.id===g.id?{...C,status:"complete",progress:100}:C)),v()):_(new Error(`Upload failed: ${y.status}`))},y.onerror=()=>_(new Error("Upload failed")),y.send(b)})}catch(p){n(b=>b.map(y=>y.id===g.id?{...y,status:"error",error:p instanceof Error?p.message:"Upload failed"}:y))}},h=async()=>{const g=s.filter(p=>p.status==="pending");for(const p of g)await d(p)},u=s.filter(g=>g.status==="pending").length,f=s.filter(g=>g.status==="complete").length;return t.jsxs("div",{children:[t.jsxs("div",{className:"mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Mi,{className:"h-6 w-6 text-indigo-400"}),t.jsx("h1",{className:"text-2xl font-bold text-white",children:"File Upload"})]}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Upload video files or import from the server filesystem"})]}),t.jsx("div",{className:"flex gap-2 mb-6",children:[{key:"upload",label:"Upload Files",icon:Mi},{key:"import",label:"Import from Server",icon:co},{key:"bulk",label:"Bulk Import",icon:co}].map(({key:g,label:p,icon:b})=>t.jsxs("button",{onClick:()=>e(g),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${a===g?"bg-indigo-600 text-white":"bg-gray-800 text-gray-400 hover:text-white"}`,children:[t.jsx(b,{className:"h-4 w-4"}),p]},g))}),a==="upload"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"bg-gray-800 rounded-xl p-6",children:t.jsx(PF,{onFiles:i})}),s.length>0&&t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white",children:["Upload Queue",t.jsxs("span",{className:"text-sm text-gray-400 font-normal ml-2",children:[f,"/",s.length," complete"]})]}),t.jsxs("div",{className:"flex gap-2",children:[u>0&&t.jsxs("button",{onClick:h,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm",children:[t.jsx(Mi,{className:"h-4 w-4"}),"Upload All (",u,")"]}),t.jsx("button",{onClick:()=>n([]),className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg text-sm",children:"Clear"})]})]}),t.jsx("div",{className:"space-y-3",children:s.map(g=>t.jsx(OF,{item:g,onRemove:()=>l(g.id),onUpdateMeta:(p,b)=>o(g.id,p,b)},g.id))})]})]}),a==="import"&&t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[t.jsx(co,{className:"h-5 w-5 text-indigo-400"}),t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Import from Server"})]}),t.jsx(FF,{})]}),a==="bulk"&&t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[t.jsx(co,{className:"h-5 w-5 text-indigo-400"}),t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Bulk Import Directory"})]}),t.jsx(BF,{})]})]})}const $F="openflix_token";function GF(){return localStorage.getItem($F)||""}function e1(a){const e=Math.floor(a/1e3),s=Math.floor(e/3600),n=Math.floor(e%3600/60),i=e%60;return s>0?`${s}:${String(n).padStart(2,"0")}:${String(i).padStart(2,"0")}`:`${n}:${String(i).padStart(2,"0")}`}function VF(a){const e=Date.now()-new Date(a).getTime(),s=Math.floor(e/6e4);if(s<1)return"just now";if(s<60)return`${s}m ago`;const n=Math.floor(s/60);return n<24?`${n}h ago`:`${Math.floor(n/24)}d ago`}async function qF(){const a=await fetch("/status/sessions",{headers:{"X-Plex-Token":GF()}});if(!a.ok)throw new Error("Failed to fetch sessions");return a.json()}function KF({state:a}){return a==="playing"?t.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-500/10 text-green-400 border border-green-500/30 rounded-full text-xs font-medium",children:[t.jsx(xs,{className:"h-3 w-3",fill:"currentColor"}),"Playing"]}):a==="paused"?t.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-yellow-500/10 text-yellow-400 border border-yellow-500/30 rounded-full text-xs font-medium",children:[t.jsx(Bi,{className:"h-3 w-3"}),"Paused"]}):a==="buffering"?t.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-blue-500/10 text-blue-400 border border-blue-500/30 rounded-full text-xs font-medium",children:[t.jsx(Ke,{className:"h-3 w-3 animate-spin"}),"Buffering"]}):t.jsx("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-gray-500/10 text-gray-400 border border-gray-500/30 rounded-full text-xs font-medium",children:a})}function HF({progress:a,viewOffset:e,duration:s}){const n=Math.min(100,Math.max(0,a));return t.jsxs("div",{children:[t.jsx("div",{className:"h-2 bg-gray-700 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-indigo-600 rounded-full transition-all duration-1000",style:{width:`${n}%`}})}),t.jsxs("div",{className:"flex justify-between mt-1 text-xs text-gray-500",children:[t.jsx("span",{children:e1(e)}),t.jsx("span",{children:e1(s)})]})]})}function zF({session:a}){return t.jsx("div",{className:"bg-gray-800 rounded-xl p-5 hover:bg-gray-750 transition-colors",children:t.jsxs("div",{className:"flex items-start gap-4",children:[a.mediaThumb?t.jsx("img",{src:a.mediaThumb,alt:"",className:"w-16 h-24 rounded-lg object-cover flex-shrink-0 bg-gray-700"}):t.jsx("div",{className:"w-16 h-24 rounded-lg bg-gray-700 flex items-center justify-center flex-shrink-0",children:t.jsx(jt,{className:"h-8 w-8 text-gray-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3 mb-2",children:[t.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.jsx(KF,{state:a.state}),a.transcoding&&t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-orange-500/10 text-orange-400 rounded text-xs",children:[t.jsx(xa,{className:"h-3 w-3"}),"Transcoding"]})]}),t.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1 flex-shrink-0",children:[t.jsx(Kt,{className:"h-3 w-3"}),VF(a.startedAt)]})]}),t.jsx("h3",{className:"text-white font-medium truncate mb-1",children:a.mediaTitle||`Media #${a.mediaItemId}`}),t.jsx("div",{className:"mb-3",children:t.jsx(HF,{progress:a.progress,viewOffset:a.viewOffset,duration:a.duration})}),t.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 text-xs text-gray-400",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(gR,{className:"h-3 w-3"}),a.username||`User #${a.userId}`]}),a.player&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(wr,{className:"h-3 w-3"}),a.player]}),a.platform&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(jt,{className:"h-3 w-3"}),a.platform]}),a.quality&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(No,{className:"h-3 w-3"}),a.quality]}),a.address&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(vo,{className:"h-3 w-3"}),a.address]})]})]})]})})}function YF(){const{data:a,isLoading:e,error:s,refetch:n}=Fe({queryKey:["sessions"],queryFn:qF,refetchInterval:5e3}),i=a?.sessions||[],l=i.filter(h=>h.state==="playing").length,o=i.filter(h=>h.state==="paused").length,d=i.filter(h=>h.transcoding).length;return e?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx(Ke,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):s?t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[t.jsx(ps,{className:"h-12 w-12 text-red-400"}),t.jsx("h3",{className:"text-lg font-medium text-white",children:"Failed to load sessions"}),t.jsx("p",{className:"text-gray-400 text-sm",children:s.message}),t.jsxs("button",{onClick:()=>n(),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[t.jsx(ut,{className:"h-4 w-4"}),"Retry"]})]}):t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[t.jsx(wr,{className:"h-7 w-7 text-indigo-400"}),"Client Connections"]}),t.jsxs("p",{className:"text-gray-400 mt-1",children:[i.length," active session",i.length!==1?"s":""]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500",children:[t.jsx(ut,{className:"h-3 w-3 animate-spin"}),"Auto-refresh: 5s"]}),t.jsxs("button",{onClick:()=>n(),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:[t.jsx(ut,{className:"h-4 w-4"}),"Refresh"]})]})]}),i.length>0&&t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[t.jsx("div",{className:"bg-gray-800 rounded-xl p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 rounded-lg bg-indigo-600/20",children:t.jsx(wr,{className:"h-5 w-5 text-indigo-400"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-2xl font-bold text-white",children:i.length}),t.jsx("p",{className:"text-xs text-gray-400",children:"Total"})]})]})}),t.jsx("div",{className:"bg-gray-800 rounded-xl p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 rounded-lg bg-green-500/20",children:t.jsx(xs,{className:"h-5 w-5 text-green-400"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-2xl font-bold text-white",children:l}),t.jsx("p",{className:"text-xs text-gray-400",children:"Playing"})]})]})}),t.jsx("div",{className:"bg-gray-800 rounded-xl p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 rounded-lg bg-yellow-500/20",children:t.jsx(Bi,{className:"h-5 w-5 text-yellow-400"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-2xl font-bold text-white",children:o}),t.jsx("p",{className:"text-xs text-gray-400",children:"Paused"})]})]})}),t.jsx("div",{className:"bg-gray-800 rounded-xl p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 rounded-lg bg-orange-500/20",children:t.jsx(xa,{className:"h-5 w-5 text-orange-400"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-2xl font-bold text-white",children:d}),t.jsx("p",{className:"text-xs text-gray-400",children:"Transcoding"})]})]})})]}),i.length===0?t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 bg-gray-800 rounded-xl",children:[t.jsx(wr,{className:"h-16 w-16 text-gray-600 mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No active sessions"}),t.jsx("p",{className:"text-gray-400 text-sm",children:"Active playback sessions will appear here in real-time"})]}):t.jsx("div",{className:"space-y-3",children:i.map(h=>t.jsx(zF,{session:h},h.sessionKey))})]})}const WF="openflix_token";function QF(){return localStorage.getItem(WF)||""}async function XF(){const a=await fetch("/health",{headers:{"X-Plex-Token":QF()}});if(!a.ok)throw new Error("Health check failed");return a.json()}function ga({title:a,value:e,icon:s,color:n,subtitle:i}){return t.jsx("div",{className:"bg-gray-800 rounded-xl p-5",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`p-2.5 rounded-lg ${n}`,children:t.jsx(s,{className:"h-5 w-5 text-white"})}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("p",{className:"text-xs text-gray-400",children:a}),t.jsx("p",{className:"text-xl font-bold text-white truncate",children:e}),i&&t.jsx("p",{className:"text-xs text-gray-500 truncate",children:i})]})]})})}function JF({value:a,max:e,label:s,color:n="bg-indigo-600"}){const i=e>0?Math.min(100,Math.round(a/e*100)):0;return t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between text-sm mb-1.5",children:[t.jsx("span",{className:"text-gray-300",children:s}),t.jsxs("span",{className:"text-gray-400",children:[i,"%"]})]}),t.jsx("div",{className:"h-3 bg-gray-700 rounded-full overflow-hidden",children:t.jsx("div",{className:`h-full ${n} rounded-full transition-all duration-500`,style:{width:`${i}%`}})})]})}function ZF({health:a}){if(!a)return t.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-gray-700 rounded-lg",children:[t.jsx(Ke,{className:"h-4 w-4 text-gray-400 animate-spin"}),t.jsx("span",{className:"text-sm text-gray-400",children:"Checking..."})]});const e=a.status==="ok";return t.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-lg ${e?"bg-green-500/10 border border-green-500/30":"bg-red-500/10 border border-red-500/30"}`,children:[e?t.jsx(Xt,{className:"h-4 w-4 text-green-400"}):t.jsx(Ua,{className:"h-4 w-4 text-red-400"}),t.jsx("span",{className:`text-sm ${e?"text-green-400":"text-red-400"}`,children:e?"Healthy":"Unhealthy"})]})}function eB({status:a}){return a==="ok"?t.jsx(Xt,{className:"h-5 w-5 text-green-400 flex-shrink-0"}):a==="warning"?t.jsx(ps,{className:"h-5 w-5 text-yellow-400 flex-shrink-0"}):t.jsx(Ua,{className:"h-5 w-5 text-red-400 flex-shrink-0"})}function tB({check:a}){const[e,s]=k.useState(!1),n=!!a.details;return t.jsxs("div",{className:`border rounded-lg p-4 transition-colors ${a.status==="ok"?"border-green-500/20 bg-green-500/5":a.status==="warning"?"border-yellow-500/20 bg-yellow-500/5":"border-red-500/20 bg-red-500/5"}`,children:[t.jsxs("div",{className:`flex items-start gap-3 ${n?"cursor-pointer":""}`,onClick:()=>n&&s(!e),children:[t.jsx(eB,{status:a.status}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-semibold text-white",children:a.name}),t.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded uppercase font-medium ${a.status==="ok"?"bg-green-500/20 text-green-400":a.status==="warning"?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400"}`,children:a.status})]}),t.jsx("p",{className:"text-sm text-gray-400 mt-0.5",children:a.message})]}),n&&t.jsx("div",{className:"text-gray-500",children:e?t.jsx(Pn,{className:"h-4 w-4"}):t.jsx(Ba,{className:"h-4 w-4"})})]}),e&&a.details&&t.jsx("div",{className:"mt-3 ml-8 p-3 bg-gray-900/50 rounded-lg",children:t.jsx("p",{className:"text-xs text-gray-400 font-mono whitespace-pre-wrap break-all",children:a.details})})]})}function sB(){const{data:a,isLoading:e,isFetching:s,error:n,refetch:i}=Fe({queryKey:["diagnosticsHealthCheck"],queryFn:()=>pe.runHealthChecks(),retry:1,staleTime:6e4});return t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[t.jsx(tR,{className:"h-5 w-5 text-indigo-400"}),"General Troubleshooting"]}),t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Ensure common systems are operating properly"})]}),t.jsxs("button",{onClick:()=>i(),disabled:s,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg text-sm font-medium transition-colors",children:[s?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):t.jsx(ut,{className:"h-4 w-4"}),s?"Running...":"Re-Run Tests"]})]}),a&&!e&&t.jsxs("div",{className:`flex items-center gap-3 px-4 py-2.5 rounded-lg mb-4 mt-4 ${a.summary.includes("error")?"bg-red-500/10 border border-red-500/30":a.summary.includes("warning")?"bg-yellow-500/10 border border-yellow-500/30":"bg-green-500/10 border border-green-500/30"}`,children:[a.summary.includes("error")?t.jsx(Ua,{className:"h-5 w-5 text-red-400"}):a.summary.includes("warning")?t.jsx(ps,{className:"h-5 w-5 text-yellow-400"}):t.jsx(Xt,{className:"h-5 w-5 text-green-400"}),t.jsx("span",{className:`text-sm font-medium ${a.summary.includes("error")?"text-red-400":a.summary.includes("warning")?"text-yellow-400":"text-green-400"}`,children:a.summary}),t.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:["Completed in ",a.duration]})]}),e&&t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Ke,{className:"h-6 w-6 text-indigo-400 animate-spin"}),t.jsx("span",{className:"text-gray-400",children:"Running health checks..."})]})}),n&&!e&&t.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-500/10 border border-red-500/30 rounded-lg mt-4",children:[t.jsx(Ua,{className:"h-5 w-5 text-red-400"}),t.jsxs("span",{className:"text-sm text-red-400",children:["Failed to run health checks: ",n.message]})]}),a&&!e&&t.jsx("div",{className:"space-y-3",children:a.checks.map((l,o)=>t.jsx(tB,{check:l},o))})]})}function aB(){const{data:a,isLoading:e,error:s,refetch:n}=Fe({queryKey:["serverStatus"],queryFn:()=>pe.getServerStatus(),refetchInterval:1e4}),{data:i,isLoading:l,error:o}=Fe({queryKey:["healthCheck"],queryFn:XF,refetchInterval:1e4});return e?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx(Ke,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):s?t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[t.jsx(ps,{className:"h-12 w-12 text-red-400"}),t.jsx("h3",{className:"text-lg font-medium text-white",children:"Failed to load diagnostics"}),t.jsx("p",{className:"text-gray-400 text-sm",children:s.message}),t.jsxs("button",{onClick:()=>n(),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[t.jsx(ut,{className:"h-4 w-4"}),"Retry"]})]}):t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[t.jsx(Wu,{className:"h-7 w-7 text-indigo-400"}),"Diagnostics"]}),t.jsx("p",{className:"text-gray-400 mt-1",children:"System health and performance overview"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500",children:[t.jsx(ut,{className:"h-3 w-3 animate-spin"}),"Auto-refresh: 10s"]}),t.jsx(ZF,{health:i,isLoading:l,error:o}),t.jsxs("button",{onClick:()=>n(),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:[t.jsx(ut,{className:"h-4 w-4"}),"Refresh"]})]})]}),t.jsx(sB,{}),a&&t.jsx("div",{className:"bg-gray-800 rounded-xl p-5 mb-6",children:t.jsxs("div",{className:"flex flex-wrap items-center gap-6 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(td,{className:"h-4 w-4 text-indigo-400"}),t.jsx("span",{className:"text-white font-medium",children:a.server.name}),t.jsxs("span",{className:"text-gray-500",children:["v",a.server.version]})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("span",{className:"text-gray-400",children:[a.server.platform,"/",a.server.arch]})}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("span",{className:"text-gray-400",children:["Go ",a.server.goVersion]})}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("span",{className:"text-gray-400",children:a.server.hostname})}),t.jsx("div",{className:"flex items-center gap-2 text-gray-500 font-mono text-xs",children:a.server.machineIdentifier})]})}),a&&t.jsxs(t.Fragment,{children:[t.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[t.jsx(Nr,{className:"h-5 w-5"}),"System Resources"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[t.jsx(ga,{title:"CPUs",value:a.system.numCPU,icon:Nr,color:"bg-blue-600"}),t.jsx(ga,{title:"Memory Used",value:`${a.system.memAllocMB} MB`,icon:W1,color:"bg-purple-600",subtitle:`${a.system.memTotalMB} MB total allocated`}),t.jsx(ga,{title:"Goroutines",value:a.system.goroutines,icon:Fi,color:"bg-orange-600"}),t.jsx(ga,{title:"Uptime",value:a.server.uptime,icon:Kt,color:"bg-green-600"})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-8",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[t.jsx($a,{className:"h-5 w-5"}),"Memory Usage"]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(JF,{value:a.system.memAllocMB,max:a.system.memTotalMB,label:"Heap Allocation",color:a.system.memAllocMB/a.system.memTotalMB>.9?"bg-red-600":a.system.memAllocMB/a.system.memTotalMB>.7?"bg-yellow-600":"bg-indigo-600"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[t.jsxs("div",{className:"bg-gray-900 rounded-lg p-3",children:[t.jsx("p",{className:"text-gray-400 text-xs",children:"Allocated"}),t.jsxs("p",{className:"text-white font-medium",children:[a.system.memAllocMB," MB"]})]}),t.jsxs("div",{className:"bg-gray-900 rounded-lg p-3",children:[t.jsx("p",{className:"text-gray-400 text-xs",children:"Total System"}),t.jsxs("p",{className:"text-white font-medium",children:[a.system.memTotalMB," MB"]})]})]})]})]}),t.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[t.jsx(sa,{className:"h-5 w-5"}),"Library Statistics"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[t.jsx(ga,{title:"Libraries",value:a.libraries.count,icon:sa,color:"bg-blue-600"}),t.jsx(ga,{title:"Movies",value:a.libraries.movies,icon:Nn,color:"bg-purple-600"}),t.jsx(ga,{title:"TV Shows",value:a.libraries.shows,icon:jt,color:"bg-green-600"}),t.jsx(ga,{title:"Episodes",value:a.libraries.episodes,icon:Fi,color:"bg-orange-600"})]}),t.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[t.jsx(Nn,{className:"h-5 w-5"}),"DVR Statistics"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[t.jsx(ga,{title:"Scheduled",value:a.dvr.scheduled,icon:Kt,color:"bg-blue-600"}),t.jsx(ga,{title:"Recording Now",value:a.dvr.recording,icon:xa,color:"bg-red-600",subtitle:a.dvr.recording>0?"Active recording":void 0}),t.jsx(ga,{title:"Completed",value:a.dvr.completed,icon:Xt,color:"bg-green-600"}),t.jsx(ga,{title:"Commercial Detect",value:a.dvr.commercialDetect?"Enabled":"Disabled",icon:xa,color:a.dvr.commercialDetect?"bg-green-600":"bg-gray-600"})]}),t.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[t.jsx(jt,{className:"h-5 w-5"}),"Live TV Statistics"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[t.jsx(ga,{title:"Total Channels",value:a.livetv.channels,icon:jt,color:"bg-blue-600"}),t.jsx(ga,{title:"Timeshift Channels",value:a.livetv.timeshiftChannels,icon:Kt,color:"bg-purple-600"}),t.jsx(ga,{title:"Timeshift",value:a.livetv.timeshiftEnabled?"Enabled":"Disabled",icon:xa,color:a.livetv.timeshiftEnabled?"bg-green-600":"bg-gray-600"}),t.jsx(ga,{title:"Active Sessions",value:a.sessions.active,icon:Wu,color:"bg-orange-600"})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[t.jsx(Wu,{className:"h-5 w-5"}),"Logging"]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[t.jsxs("div",{className:"bg-gray-900 rounded-lg p-3",children:[t.jsx("p",{className:"text-gray-400 text-xs",children:"Log Level"}),t.jsx("p",{className:"text-white font-medium capitalize",children:a.logging.level})]}),t.jsxs("div",{className:"bg-gray-900 rounded-lg p-3",children:[t.jsx("p",{className:"text-gray-400 text-xs",children:"JSON Format"}),t.jsx("p",{className:"text-white font-medium",children:a.logging.json?"Yes":"No"})]})]})]})]})]})}const nB=async(a,e)=>{const s=localStorage.getItem("openflix_token")||"",n=await fetch(a,{...e,headers:{"X-Plex-Token":s,"Content-Type":"application/json",...e?.headers}});if(!n.ok)throw new Error(`API error: ${n.status}`);return n},Kp="openflix_speedtest_history";function iB(){try{const a=localStorage.getItem(Kp);return a?JSON.parse(a):[]}catch{return[]}}function rB(a){localStorage.setItem(Kp,JSON.stringify(a.slice(0,20)))}function lB({speed:a,max:e=1e3}){const s=Math.min(a/e*100,100),n=283,i=n-s/100*n,l=377-n;return t.jsxs("div",{className:"relative w-64 h-64 mx-auto",children:[t.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 200 200",children:[t.jsx("circle",{cx:"100",cy:"100",r:"80",fill:"none",stroke:"#374151",strokeWidth:"12",strokeDasharray:"377",strokeDashoffset:l,strokeLinecap:"round",transform:"rotate(135 100 100)"}),t.jsx("circle",{cx:"100",cy:"100",r:"80",fill:"none",stroke:"#6366f1",strokeWidth:"12",strokeDasharray:`${n} 377`,strokeDashoffset:i,strokeLinecap:"round",transform:"rotate(135 100 100)",className:"transition-all duration-500"})]}),t.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[t.jsx("span",{className:"text-4xl font-bold text-white",children:a.toFixed(1)}),t.jsx("span",{className:"text-gray-400 text-sm",children:"Mbps"})]})]})}function zg({phase:a,currentPhase:e}){const s=["latency","download","upload"],n=s.indexOf(e),i=s.indexOf(a),l=e===a,o=e==="complete"||n>i,d={latency:"Latency",download:"Download",upload:"Upload"},h={latency:t.jsx(Kt,{className:"h-4 w-4"}),download:t.jsx(ed,{className:"h-4 w-4"}),upload:t.jsx(Uh,{className:"h-4 w-4"})};return t.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${l?"bg-indigo-600 text-white":o?"bg-green-500/20 text-green-400":"bg-gray-700 text-gray-500"}`,children:[l&&t.jsx(Ke,{className:"h-4 w-4 animate-spin"}),!l&&h[a],d[a]]})}function oB(){const[a,e]=k.useState("idle"),[s,n]=k.useState(0),[i,l]=k.useState(0),[o,d]=k.useState(0),[h,u]=k.useState(0),[f,g]=k.useState(iB),[p,b]=k.useState(null),y=k.useCallback(async()=>{const L=[];for(let H=0;H<5;H++){const B=performance.now();await nB("/api/speedtest/ping");const P=performance.now();L.push(P-B)}L.sort((H,B)=>H-B);const F=L.slice(1,-1);return F.reduce((H,B)=>H+B,0)/F.length},[]),v=k.useCallback(async()=>{const F=localStorage.getItem("openflix_token")||"",H=performance.now(),B=await fetch("/api/speedtest/download?size=100000000",{headers:{"X-Plex-Token":F}});if(!B.ok)throw new Error("Download test failed");const P=B.body?.getReader();let I=0;if(P)for(;;){const{done:O,value:ee}=await P.read();if(O)break;I+=ee.length;const ie=(performance.now()-H)/1e3;if(ie>0){const Z=I*8/(ie*1e6);n(Z)}}const D=(performance.now()-H)/1e3;return I*8/(D*1e6)},[]),_=k.useCallback(async()=>{const F=new Uint8Array(5e7);for(let D=0;D<5e7;D++)F[D]=D*7+13&255;const H=localStorage.getItem("openflix_token")||"",B=performance.now();if(!(await fetch("/api/speedtest/upload",{method:"POST",headers:{"X-Plex-Token":H},body:F})).ok)throw new Error("Upload test failed");const I=(performance.now()-B)/1e3;return 5e7*8/(I*1e6)},[]),N=k.useCallback(async()=>{b(null),n(0),l(0),d(0),u(0);try{e("latency");const L=await y();l(L),e("download"),n(0);const F=await v();d(F),n(F),e("upload"),n(0);const H=await _();u(H),n(H),e("complete"),n(Math.max(F,H));const P=[{id:Date.now().toString(),timestamp:new Date().toISOString(),latency:Math.round(L*10)/10,download:Math.round(F*10)/10,upload:Math.round(H*10)/10},...f].slice(0,20);g(P),rB(P)}catch(L){b(L instanceof Error?L.message:"Speed test failed"),e("idle")}},[y,v,_,f]),C=()=>{g([]),localStorage.removeItem(Kp)},T=a==="complete"?o:a==="upload"?s||h:s||o;return t.jsxs("div",{children:[t.jsxs("div",{className:"mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(u0,{className:"h-6 w-6 text-indigo-400"}),t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Speed Test"})]}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Test network speed between your browser and the server"})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-8 mb-6",children:[t.jsx(lB,{speed:T}),t.jsxs("div",{className:"flex justify-center gap-3 mt-6",children:[t.jsx(zg,{phase:"latency",currentPhase:a}),t.jsx(zg,{phase:"download",currentPhase:a}),t.jsx(zg,{phase:"upload",currentPhase:a})]}),t.jsx("div",{className:"text-center mt-8",children:a==="idle"||a==="complete"?t.jsxs("button",{onClick:N,className:"inline-flex items-center gap-2 px-8 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-xl text-lg transition-colors",children:[t.jsx(xa,{className:"h-5 w-5"}),a==="complete"?"Test Again":"Start Test"]}):t.jsxs("div",{className:"text-gray-400",children:[t.jsx(Ke,{className:"h-6 w-6 animate-spin mx-auto mb-2"}),"Testing..."]})}),p&&t.jsx("div",{className:"mt-4 p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-center",children:t.jsx("span",{className:"text-red-400 text-sm",children:p})}),a==="complete"&&t.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-8",children:[t.jsxs("div",{className:"bg-gray-700/50 rounded-xl p-4 text-center",children:[t.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[t.jsx(Kt,{className:"h-4 w-4 text-yellow-400"}),t.jsx("span",{className:"text-sm text-gray-400",children:"Latency"})]}),t.jsx("p",{className:"text-2xl font-bold text-white",children:i.toFixed(1)}),t.jsx("p",{className:"text-xs text-gray-500",children:"ms"})]}),t.jsxs("div",{className:"bg-gray-700/50 rounded-xl p-4 text-center",children:[t.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[t.jsx(ed,{className:"h-4 w-4 text-green-400"}),t.jsx("span",{className:"text-sm text-gray-400",children:"Download"})]}),t.jsx("p",{className:"text-2xl font-bold text-white",children:o.toFixed(1)}),t.jsx("p",{className:"text-xs text-gray-500",children:"Mbps"})]}),t.jsxs("div",{className:"bg-gray-700/50 rounded-xl p-4 text-center",children:[t.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[t.jsx(Uh,{className:"h-4 w-4 text-blue-400"}),t.jsx("span",{className:"text-sm text-gray-400",children:"Upload"})]}),t.jsx("p",{className:"text-2xl font-bold text-white",children:h.toFixed(1)}),t.jsx("p",{className:"text-xs text-gray-500",children:"Mbps"})]})]})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(No,{className:"h-5 w-5 text-indigo-400"}),t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Test History"})]}),f.length>0&&t.jsxs("button",{onClick:C,className:"flex items-center gap-1 px-3 py-1.5 text-sm text-gray-400 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors",children:[t.jsx(Dt,{className:"h-3.5 w-3.5"}),"Clear"]})]}),f.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(u0,{className:"h-12 w-12 text-gray-600 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-400",children:"No test history yet"}),t.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Run a speed test to see results here."})]}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-gray-700",children:[t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-400",children:"Date"}),t.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-400",children:"Latency"}),t.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-400",children:"Download"}),t.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-400",children:"Upload"})]})}),t.jsx("tbody",{children:f.map(L=>t.jsxs("tr",{className:"border-b border-gray-700/50 hover:bg-gray-700/30",children:[t.jsx("td",{className:"py-3 px-4 text-sm text-gray-300",children:new Date(L.timestamp).toLocaleString()}),t.jsx("td",{className:"py-3 px-4 text-sm text-right",children:t.jsxs("span",{className:"text-yellow-400",children:[L.latency," ms"]})}),t.jsx("td",{className:"py-3 px-4 text-sm text-right",children:t.jsxs("span",{className:"text-green-400",children:[L.download," Mbps"]})}),t.jsx("td",{className:"py-3 px-4 text-sm text-right",children:t.jsxs("span",{className:"text-blue-400",children:[L.upload," Mbps"]})})]},L.id))})]})})]})]})}const cB=a=>a?/^https?:\/\//i.test(a):!1,dB="openflix_token";function K0(){return localStorage.getItem(dB)||""}function uB(a){return new Date(a).toLocaleString()}function hB(a,e){const s=new Date(a),n=new Date(e),i=s.toLocaleDateString(void 0,{month:"short",day:"numeric"}),l=s.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"}),o=n.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"});return`${i}, ${l} - ${o}`}function fB(a,e){const s=new Date(e).getTime()-new Date(a).getTime(),n=Math.round(s/6e4);if(n<60)return`${n}m`;const i=Math.floor(n/60),l=n%60;return l>0?`${i}h ${l}m`:`${i}h`}const H0={scheduled:{icon:Kt,color:"text-yellow-400",bgColor:"bg-yellow-500/10",borderColor:"border-yellow-500/30",label:"Scheduled"},pending:{icon:Kt,color:"text-yellow-400",bgColor:"bg-yellow-500/10",borderColor:"border-yellow-500/30",label:"Pending"},recording:{icon:xs,color:"text-red-400",bgColor:"bg-red-500/10",borderColor:"border-red-500/30",label:"Recording"},running:{icon:xs,color:"text-blue-400",bgColor:"bg-blue-500/10",borderColor:"border-blue-500/30",label:"Running"},completed:{icon:Xt,color:"text-green-400",bgColor:"bg-green-500/10",borderColor:"border-green-500/30",label:"Completed"},failed:{icon:Ua,color:"text-red-400",bgColor:"bg-red-500/10",borderColor:"border-red-500/30",label:"Failed"},cancelled:{icon:Bi,color:"text-gray-400",bgColor:"bg-gray-500/10",borderColor:"border-gray-500/30",label:"Cancelled"}};function mB({status:a}){const e=H0[a]||H0.pending,s=e.icon;return t.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 ${e.bgColor} ${e.color} border ${e.borderColor} rounded-full text-xs font-medium`,children:[t.jsx(s,{className:"h-3 w-3"}),e.label]})}function t1({job:a}){return a.isSports?t.jsx(ti,{className:"h-4 w-4 text-orange-400"}):a.isMovie?t.jsx(Gt,{className:"h-4 w-4 text-purple-400"}):a.category==="TVShow"?t.jsx(jt,{className:"h-4 w-4 text-blue-400"}):t.jsx($s,{className:"h-4 w-4 text-gray-400"})}async function gB(){const a=await fetch("/dvr/v2/jobs",{headers:{"X-Plex-Token":K0()}});if(!a.ok)throw new Error("Failed to fetch jobs");return a.json()}const pB=["all","scheduled","recording","completed","failed","cancelled"];function xB(){const a=at(),[e,s]=k.useState("all"),[n,i]=k.useState(null),{data:l,isLoading:o,error:d,refetch:h}=Fe({queryKey:["jobs"],queryFn:gB,refetchInterval:5e3}),u=Me({mutationFn:async y=>{if(!(await fetch(`/dvr/v2/jobs/${y}/cancel`,{method:"POST",headers:{"X-Plex-Token":K0()}})).ok)throw new Error("Failed to cancel job")},onSuccess:()=>a.invalidateQueries({queryKey:["jobs"]})}),f=Me({mutationFn:async y=>{if(!(await fetch(`/dvr/v2/jobs/${y}`,{method:"DELETE",headers:{"X-Plex-Token":K0()}})).ok)throw new Error("Failed to delete job")},onSuccess:()=>a.invalidateQueries({queryKey:["jobs"]})}),g=l?.jobs||[],p=e==="all"?g:g.filter(y=>y.status===e),b=g.reduce((y,v)=>(y[v.status]=(y[v.status]||0)+1,y),{});return o?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx(Ke,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):d?t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[t.jsx(ps,{className:"h-12 w-12 text-red-400"}),t.jsx("h3",{className:"text-lg font-medium text-white",children:"Failed to load jobs"}),t.jsx("p",{className:"text-gray-400 text-sm",children:d.message}),t.jsxs("button",{onClick:()=>h(),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[t.jsx(ut,{className:"h-4 w-4"}),"Retry"]})]}):t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[t.jsx(f0,{className:"h-7 w-7 text-indigo-400"}),"DVR Jobs"]}),t.jsxs("p",{className:"text-gray-400 mt-1",children:[g.length," job",g.length!==1?"s":""," total",b.recording?` / ${b.recording} recording`:""]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500",children:[t.jsx(ut,{className:"h-3 w-3 animate-spin"}),"Auto-refresh: 5s"]}),t.jsxs("button",{onClick:()=>h(),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:[t.jsx(ut,{className:"h-4 w-4"}),"Refresh"]})]})]}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:["scheduled","recording","completed","failed"].map(y=>{const v=H0[y],_=v.icon;return t.jsx("button",{onClick:()=>s(e===y?"all":y),className:`bg-gray-800 rounded-xl p-4 text-left transition-colors ${e===y?"ring-2 ring-indigo-500":"hover:bg-gray-750"}`,children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`p-2 rounded-lg ${v.bgColor}`,children:t.jsx(_,{className:`h-5 w-5 ${v.color}`})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-2xl font-bold text-white",children:b[y]||0}),t.jsx("p",{className:"text-xs text-gray-400",children:v.label})]})]})},y)})}),t.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[t.jsx(H1,{className:"h-4 w-4 text-gray-500"}),t.jsx("div",{className:"flex gap-1",children:pB.map(y=>t.jsxs("button",{onClick:()=>s(y),className:`px-3 py-1.5 rounded-lg text-xs capitalize transition-colors ${e===y?"bg-indigo-600 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"}`,children:[y," ",y!=="all"&&b[y]?`(${b[y]})`:""]},y))})]}),p.length===0?t.jsxs("div",{className:"flex flex-col items-center justify-center h-48 bg-gray-800 rounded-xl",children:[t.jsx(f0,{className:"h-12 w-12 text-gray-600 mb-3"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-1",children:"No jobs"}),t.jsx("p",{className:"text-gray-400 text-sm",children:e!=="all"?`No ${e} jobs found`:"The DVR job queue is empty"})]}):t.jsx("div",{className:"space-y-2",children:p.map(y=>t.jsxs("div",{className:"bg-gray-800 rounded-xl overflow-hidden",children:[t.jsxs("div",{onClick:()=>i(n===y.id?null:y.id),className:"flex items-center gap-4 p-4 hover:bg-gray-700/30 transition-colors cursor-pointer",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg bg-gray-700 flex items-center justify-center flex-shrink-0 overflow-hidden",children:cB(y.channelLogo)?t.jsx("img",{src:y.channelLogo,alt:"",className:"w-full h-full object-contain"}):t.jsx(t1,{job:y})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-white font-medium truncate",children:y.title}),y.subtitle&&t.jsxs("span",{className:"text-gray-400 text-sm truncate",children:["- ",y.subtitle]})]}),t.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500 mt-0.5",children:[t.jsx("span",{children:y.channelName}),t.jsx("span",{children:hB(y.startTime,y.endTime)}),t.jsx("span",{children:fB(y.startTime,y.endTime)})]})]}),t.jsx(mB,{status:y.status}),t.jsxs("div",{className:"flex items-center gap-1",children:[(y.status==="scheduled"||y.status==="recording")&&t.jsx("button",{onClick:v=>{v.stopPropagation(),u.mutate(y.id)},className:"p-1.5 text-gray-400 hover:text-red-400 rounded-lg hover:bg-gray-700 transition-colors",title:"Cancel",children:t.jsx(LC,{className:"h-4 w-4"})}),(y.status==="completed"||y.status==="failed"||y.status==="cancelled")&&t.jsx("button",{onClick:v=>{v.stopPropagation(),f.mutate(y.id)},className:"p-1.5 text-gray-400 hover:text-red-400 rounded-lg hover:bg-gray-700 transition-colors",title:"Delete",children:t.jsx(Dt,{className:"h-4 w-4"})})]})]}),n===y.id&&t.jsxs("div",{className:"px-4 pb-4 border-t border-gray-700/50",children:[t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-3 text-xs",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500 mb-0.5",children:"Category"}),t.jsxs("p",{className:"text-gray-300 flex items-center gap-1.5",children:[t.jsx(t1,{job:y}),y.isMovie?"Movie":y.isSports?"Sports":y.category||"TV Show"]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500 mb-0.5",children:"Quality"}),t.jsx("p",{className:"text-gray-300",children:y.qualityPreset||"Original"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500 mb-0.5",children:"Priority"}),t.jsx("p",{className:"text-gray-300",children:y.priority})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500 mb-0.5",children:"Padding"}),t.jsxs("p",{className:"text-gray-300",children:[y.paddingStart>0?`${y.paddingStart}m before`:"None",y.paddingEnd>0?` / ${y.paddingEnd}m after`:""]})]}),y.episodeNum&&t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500 mb-0.5",children:"Episode"}),t.jsx("p",{className:"text-gray-300",children:y.episodeNum})]}),y.retryCount>0&&t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500 mb-0.5",children:"Retries"}),t.jsxs("p",{className:"text-gray-300",children:[y.retryCount," / ",y.maxRetries]})]}),y.fileId&&t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500 mb-0.5",children:"File ID"}),t.jsxs("p",{className:"text-gray-300",children:["#",y.fileId]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500 mb-0.5",children:"Created"}),t.jsx("p",{className:"text-gray-300",children:uB(y.createdAt)})]})]}),y.description&&t.jsxs("div",{className:"mt-3",children:[t.jsx("p",{className:"text-gray-500 text-xs mb-0.5",children:"Description"}),t.jsx("p",{className:"text-gray-400 text-xs",children:y.description})]}),y.lastError&&t.jsx("div",{className:"mt-3 p-2 bg-red-900/30 border border-red-500/30 rounded-lg",children:t.jsx("p",{className:"text-red-400 text-xs",children:y.lastError})})]})]},y.id))})]})}const yB=a=>a?/^https?:\/\//i.test(a):!1,rd={"X-Plex-Token":localStorage.getItem("openflix_token")||"","Content-Type":"application/json"};async function bB(){const a=await fetch("/dvr/v2/virtual-stations",{headers:rd});if(!a.ok)throw new Error("Failed to fetch virtual stations");return(await a.json()).stations||[]}async function vB(a){const e=await fetch("/dvr/v2/virtual-stations",{method:"POST",headers:rd,body:JSON.stringify(a)});if(!e.ok)throw new Error("Failed to create station");return e.json()}async function jj(a,e){const s=await fetch(`/dvr/v2/virtual-stations/${a}`,{method:"PUT",headers:rd,body:JSON.stringify(e)});if(!s.ok)throw new Error("Failed to update station");return s.json()}async function _B(a){if(!(await fetch(`/dvr/v2/virtual-stations/${a}`,{method:"DELETE",headers:rd})).ok)throw new Error("Failed to delete station")}async function NB(a){const e=await fetch("/dvr/v2/virtual-stations/preview",{method:"POST",headers:rd,body:JSON.stringify({smartRule:a})});if(!e.ok)throw new Error("Failed to preview");return(await e.json()).files||[]}const wB=[{value:"title",label:"Title"},{value:"genre",label:"Genre"},{value:"year",label:"Year"},{value:"rating",label:"Rating"},{value:"duration",label:"Duration"},{value:"type",label:"Type"},{value:"studio",label:"Studio"},{value:"resolution",label:"Resolution"},{value:"addedAt",label:"Date Added"}],SB=[{value:"is",label:"is"},{value:"is_not",label:"is not"},{value:"contains",label:"contains"},{value:"starts_with",label:"starts with"},{value:"ends_with",label:"ends with"},{value:"gt",label:"greater than"},{value:"lt",label:"less than"}],jB=[{value:"title",label:"Title"},{value:"year",label:"Year"},{value:"addedAt",label:"Date Added"},{value:"duration",label:"Duration"},{value:"rating",label:"Rating"},{value:"random",label:"Random"}];function EB(a){if(!a)return[{field:"title",operator:"contains",value:""}];try{const e=JSON.parse(a);if(Array.isArray(e)&&e.length>0)return e}catch{}return[{field:"title",operator:"contains",value:""}]}function s1(a){return JSON.stringify(a.filter(e=>e.value.trim()!==""))}function TB({conditions:a,onChange:e}){const s=(l,o)=>{const d=a.map((h,u)=>u===l?{...h,...o}:h);e(d)},n=()=>{e([...a,{field:"title",operator:"contains",value:""}])},i=l=>{a.length<=1||e(a.filter((o,d)=>d!==l))};return t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Smart Rules"}),a.map((l,o)=>t.jsxs("div",{className:"flex items-center gap-2",children:[o>0&&t.jsx("span",{className:"text-xs text-indigo-400 font-medium w-8",children:"AND"}),o===0&&t.jsx("span",{className:"w-8"}),t.jsx("select",{value:l.field,onChange:d=>s(o,{field:d.target.value}),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",children:wB.map(d=>t.jsx("option",{value:d.value,children:d.label},d.value))}),t.jsx("select",{value:l.operator,onChange:d=>s(o,{operator:d.target.value}),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",children:SB.map(d=>t.jsx("option",{value:d.value,children:d.label},d.value))}),t.jsx("input",{type:"text",value:l.value,onChange:d=>s(o,{value:d.target.value}),placeholder:"Value",className:"flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500"}),t.jsx("button",{onClick:()=>i(o),disabled:a.length<=1,className:"p-2 text-gray-400 hover:text-red-400 disabled:opacity-30 rounded-lg hover:bg-gray-700 transition-colors",children:t.jsx(Dt,{className:"w-4 h-4"})})]},o)),t.jsxs("button",{onClick:n,className:"flex items-center gap-1 text-sm text-indigo-400 hover:text-indigo-300 transition-colors",children:[t.jsx(Pt,{className:"w-3.5 h-3.5"}),"Add Condition"]})]})}function AB({station:a,onClose:e}){const s=at(),n=!!a,[i,l]=k.useState(a?.name||""),[o,d]=k.useState(a?.number||1),[h,u]=k.useState(a?.logo||""),[f,g]=k.useState(a?.description||""),[p,b]=k.useState(a?.smartRule?"smart":"manual"),[y,v]=k.useState(EB(a?.smartRule)),[_,N]=k.useState(a?.fileIds||""),[C,T]=k.useState(a?.shuffle??!1),[L,F]=k.useState(a?.loop??!0),[H,B]=k.useState(a?.sort||"title"),[P,I]=k.useState(a?.order||"asc"),[D,O]=k.useState(a?.limit||0),[ee,ie]=k.useState([]),[Z,z]=k.useState(!1),[X,ae]=k.useState(""),te=Me({mutationFn:vB,onSuccess:()=>{s.invalidateQueries({queryKey:["virtual-stations"]}),e()}}),W=Me({mutationFn:oe=>jj(a.id,oe),onSuccess:()=>{s.invalidateQueries({queryKey:["virtual-stations"]}),e()}}),K=te.isPending||W.isPending,q=async()=>{if(p==="smart"){z(!0),ae("");try{const oe=await NB(s1(y));ie(oe)}catch(oe){ae(oe instanceof Error?oe.message:"Preview failed")}finally{z(!1)}}},J=oe=>{oe.preventDefault();const be={name:i,number:o,logo:h||void 0,description:f||void 0,shuffle:C,loop:L,sort:H,order:P,limit:D,enabled:a?.enabled??!0};p==="smart"?(be.smartRule=s1(y),be.fileIds=void 0):(be.fileIds=_,be.smartRule=void 0),n?W.mutate(be):te.mutate(be)};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"sticky top-0 bg-gray-800 px-6 pt-6 pb-4 border-b border-gray-700 flex items-center justify-between z-10",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx($s,{className:"w-5 h-5 text-indigo-400"}),t.jsx("h2",{className:"text-lg font-semibold text-white",children:n?"Edit Virtual Channel":"Create Virtual Channel"})]}),t.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-white rounded-lg hover:bg-gray-700 transition-colors",children:t.jsx(nt,{className:"w-5 h-5"})})]}),t.jsxs("form",{onSubmit:J,className:"p-6 space-y-5",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Channel Name"}),t.jsx("input",{type:"text",value:i,onChange:oe=>l(oe.target.value),required:!0,placeholder:"24/7 Action Movies",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Channel Number"}),t.jsx("input",{type:"number",value:o,onChange:oe=>d(parseInt(oe.target.value)||1),min:1,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Logo URL"}),t.jsx("input",{type:"url",value:h,onChange:oe=>u(oe.target.value),placeholder:"https://...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Description"}),t.jsx("textarea",{value:f,onChange:oe=>g(oe.target.value),rows:2,placeholder:"Optional description...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 resize-none focus:outline-none focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Content Source"}),t.jsxs("div",{className:"flex gap-2 mb-4",children:[t.jsx("button",{type:"button",onClick:()=>b("smart"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${p==="smart"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-400 hover:text-white"}`,children:"Smart Rule"}),t.jsx("button",{type:"button",onClick:()=>b("manual"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${p==="manual"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-400 hover:text-white"}`,children:"Manual"})]}),p==="smart"?t.jsxs("div",{className:"space-y-4",children:[t.jsx(TB,{conditions:y,onChange:v}),t.jsxs("button",{type:"button",onClick:q,disabled:Z,className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm font-medium transition-colors",children:[Z?t.jsx(Ke,{className:"w-4 h-4 animate-spin"}):t.jsx(Pi,{className:"w-4 h-4"}),"Preview Matches"]}),X&&t.jsxs("p",{className:"text-red-400 text-sm flex items-center gap-1",children:[t.jsx(kt,{className:"w-4 h-4"}),X]}),ee.length>0&&t.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-3 max-h-40 overflow-y-auto",children:[t.jsxs("p",{className:"text-xs text-gray-400 mb-2",children:[ee.length," matched files"]}),ee.map(oe=>t.jsxs("div",{className:"text-sm text-gray-300 py-1 border-b border-gray-700 last:border-0",children:[oe.title,oe.type&&t.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",oe.type,")"]})]},oe.id))]})]}):t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"File IDs (comma-separated)"}),t.jsx("textarea",{value:_,onChange:oe=>N(oe.target.value),rows:3,placeholder:"1, 2, 3, ...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm font-mono placeholder-gray-500 resize-none focus:outline-none focus:border-indigo-500"})]})]}),t.jsxs("div",{className:"border-t border-gray-700 pt-5 space-y-4",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"Playback Options"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[t.jsx("div",{className:`relative w-10 h-5 rounded-full transition-colors ${C?"bg-indigo-600":"bg-gray-600"}`,onClick:()=>T(!C),children:t.jsx("div",{className:`absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full shadow transition-transform ${C?"translate-x-5":""}`})}),t.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-gray-300",children:[t.jsx(tw,{className:"w-4 h-4"}),"Shuffle"]})]}),t.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[t.jsx("div",{className:`relative w-10 h-5 rounded-full transition-colors ${L?"bg-indigo-600":"bg-gray-600"}`,onClick:()=>F(!L),children:t.jsx("div",{className:`absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full shadow transition-transform ${L?"translate-x-5":""}`})}),t.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-gray-300",children:[t.jsx(hp,{className:"w-4 h-4"}),"Loop"]})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Sort"}),t.jsx("select",{value:H,onChange:oe=>B(oe.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",children:jB.map(oe=>t.jsx("option",{value:oe.value,children:oe.label},oe.value))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Order"}),t.jsxs("select",{value:P,onChange:oe=>I(oe.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",children:[t.jsx("option",{value:"asc",children:"Ascending"}),t.jsx("option",{value:"desc",children:"Descending"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Limit (0 = all)"}),t.jsx("input",{type:"number",value:D,onChange:oe=>O(parseInt(oe.target.value)||0),min:0,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500"})]})]})]}),(te.isError||W.isError)&&t.jsxs("p",{className:"text-red-400 text-sm flex items-center gap-1",children:[t.jsx(kt,{className:"w-4 h-4"}),(te.error||W.error)?.message||"Operation failed"]}),t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsx("button",{type:"button",onClick:e,className:"flex-1 py-2.5 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:K||!i.trim(),className:"flex-1 py-2.5 px-4 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-40 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors",children:K?t.jsx(Ke,{className:"w-4 h-4 animate-spin mx-auto"}):n?"Save Changes":"Create Channel"})]})]})]})})}function CB({station:a,onEdit:e,onDelete:s,onToggle:n}){const i=a.fileIds?a.fileIds.split(",").filter(Boolean).length:0;return t.jsx("div",{className:`bg-gray-800 rounded-xl p-5 border transition-colors ${a.enabled?"border-gray-700 hover:border-gray-600":"border-gray-700/50 opacity-60"}`,children:t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:"flex-shrink-0 w-16 h-16 rounded-lg bg-gray-700 flex items-center justify-center overflow-hidden",children:yB(a.logo)?t.jsx("img",{src:a.logo,alt:a.name,className:"w-full h-full object-cover"}):t.jsx(jt,{className:"w-8 h-8 text-gray-500"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsxs("span",{className:"px-2 py-0.5 bg-indigo-600/20 text-indigo-400 text-xs font-mono rounded",children:["#",a.number]}),t.jsx("h3",{className:"text-white font-semibold truncate",children:a.name})]}),a.description&&t.jsx("p",{className:"text-sm text-gray-400 line-clamp-1 mb-2",children:a.description}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-gray-500",children:[a.smartRule&&t.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 bg-purple-500/10 text-purple-400 rounded",children:[t.jsx(xt,{className:"w-3 h-3"}),"Smart Rule"]}),i>0&&!a.smartRule&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(dp,{className:"w-3 h-3"}),i," files"]}),a.shuffle&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(tw,{className:"w-3 h-3"}),"Shuffle"]}),a.loop&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(hp,{className:"w-3 h-3"}),"Loop"]}),a.limit>0&&t.jsxs("span",{children:["Limit: ",a.limit]})]})]}),t.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[t.jsx("button",{onClick:n,className:`p-2 rounded-lg transition-colors ${a.enabled?"text-green-400 hover:bg-gray-700":"text-gray-500 hover:bg-gray-700"}`,title:a.enabled?"Disable":"Enable",children:t.jsx(m0,{className:"w-4 h-4"})}),t.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-indigo-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Edit",children:t.jsx(an,{className:"w-4 h-4"})}),t.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Delete",children:t.jsx(Dt,{className:"w-4 h-4"})})]})]})})}function kB(){const a=at(),{data:e,isLoading:s,error:n}=Fe({queryKey:["virtual-stations"],queryFn:bB}),i=Me({mutationFn:_B,onSuccess:()=>a.invalidateQueries({queryKey:["virtual-stations"]})}),l=Me({mutationFn:({id:p,enabled:b})=>jj(p,{enabled:b}),onSuccess:()=>a.invalidateQueries({queryKey:["virtual-stations"]})}),[o,d]=k.useState(null),[h,u]=k.useState(""),f=(e||[]).filter(p=>{if(!h.trim())return!0;const b=h.toLowerCase();return p.name.toLowerCase().includes(b)||p.description?.toLowerCase().includes(b)||String(p.number).includes(b)}),g=p=>{confirm("Delete this virtual channel? This cannot be undone.")&&i.mutate(p)};return t.jsxs("div",{children:[t.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Virtual Channels"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Create custom 24/7 channels from your DVR library"})]}),t.jsxs("button",{onClick:()=>d("new"),className:"flex items-center gap-2 px-4 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors",children:[t.jsx(Pt,{className:"w-4 h-4"}),"New Channel"]})]}),(e?.length||0)>3&&t.jsxs("div",{className:"relative mb-6",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),t.jsx("input",{type:"text",value:h,onChange:p=>u(p.target.value),placeholder:"Search channels...",className:"w-full pl-10 pr-4 py-2.5 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),s?t.jsx("div",{className:"flex items-center justify-center py-16",children:t.jsx(Ke,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):n?t.jsxs("div",{className:"text-center py-16 bg-gray-800 rounded-xl",children:[t.jsx(kt,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Failed to load virtual channels"}),t.jsx("p",{className:"text-gray-400 text-sm",children:n instanceof Error?n.message:"Unknown error"})]}):f.length===0?t.jsxs("div",{className:"text-center py-16 bg-gray-800 rounded-xl",children:[t.jsx($s,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:h?"No matching channels":"No virtual channels yet"}),t.jsx("p",{className:"text-gray-400 mb-6",children:h?`No channels match "${h}"`:"Create your first custom 24/7 channel."}),!h&&t.jsxs("button",{onClick:()=>d("new"),className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors",children:[t.jsx(Pt,{className:"w-4 h-4"}),"New Channel"]})]}):t.jsx("div",{className:"space-y-3",children:f.sort((p,b)=>p.number-b.number).map(p=>t.jsx(CB,{station:p,onEdit:()=>d(p),onDelete:()=>g(p.id),onToggle:()=>l.mutate({id:p.id,enabled:!p.enabled})},p.id))}),o!==null&&t.jsx(AB,{station:o==="new"?null:o,onClose:()=>d(null)})]})}const rl=async(a,e)=>{const s=localStorage.getItem("openflix_token")||"",n=await fetch(a,{...e,headers:{"X-Plex-Token":s,"Content-Type":"application/json",...e?.headers}});if(!n.ok)throw new Error(`API error: ${n.status}`);return n.json()};function ki(a){const e=Math.floor(a/3600),s=Math.floor(a%3600/60),n=Math.floor(a%60);return e>0?`${e}:${s.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`:`${s}:${n.toString().padStart(2,"0")}`}function RB(a,e){const s=e-a;return s<60?`${s.toFixed(1)}s`:ki(s)}const z0={intro:"bg-blue-500",outro:"bg-orange-500",credits:"bg-purple-500",commercial:"bg-red-500"},LB={intro:"text-blue-400",outro:"text-orange-400",credits:"text-purple-400",commercial:"text-red-400"},DB={intro:"bg-blue-500/20",outro:"bg-orange-500/20",credits:"bg-purple-500/20",commercial:"bg-red-500/20"};function a1({segments:a,duration:e}){return e<=0?null:t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"relative h-12 bg-gray-700 rounded-lg overflow-hidden",children:a.map(s=>{const n=s.startTime/e*100,i=(s.endTime-s.startTime)/e*100;return t.jsx("div",{className:`absolute top-0 bottom-0 ${z0[s.type]||"bg-gray-500"} opacity-70 hover:opacity-90 transition-opacity cursor-pointer`,style:{left:`${n}%`,width:`${Math.max(i,.5)}%`},title:`${s.type}: ${ki(s.startTime)} - ${ki(s.endTime)}`},s.id)})}),t.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[t.jsx("span",{children:"0:00"}),t.jsx("span",{children:ki(e/4)}),t.jsx("span",{children:ki(e/2)}),t.jsx("span",{children:ki(e*3/4)}),t.jsx("span",{children:ki(e)})]}),t.jsx("div",{className:"flex gap-4 flex-wrap",children:Object.entries(z0).map(([s,n])=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:`w-3 h-3 rounded ${n}`}),t.jsx("span",{className:"text-xs text-gray-400 capitalize",children:s})]},s))})]})}function MB({onAdd:a,isAdding:e}){const[s,n]=k.useState("intro"),[i,l]=k.useState(0),[o,d]=k.useState(0),[h,u]=k.useState(0),[f,g]=k.useState(30),p=b=>{b.preventDefault();const y=i*60+o,v=h*60+f;v<=y||a({type:s,startTime:y,endTime:v})};return t.jsxs("form",{onSubmit:p,className:"bg-gray-700/50 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-3",children:"Add Segment Manually"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Type"}),t.jsxs("select",{value:s,onChange:b=>n(b.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",children:[t.jsx("option",{value:"intro",children:"Intro"}),t.jsx("option",{value:"outro",children:"Outro"}),t.jsx("option",{value:"credits",children:"Credits"}),t.jsx("option",{value:"commercial",children:"Commercial"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Start Time"}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx("input",{type:"number",min:"0",value:i,onChange:b=>l(Number(b.target.value)),className:"w-16 px-2 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm text-center",placeholder:"min"}),t.jsx("span",{className:"text-gray-500 self-center",children:":"}),t.jsx("input",{type:"number",min:"0",max:"59",value:o,onChange:b=>d(Number(b.target.value)),className:"w-16 px-2 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm text-center",placeholder:"sec"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"End Time"}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx("input",{type:"number",min:"0",value:h,onChange:b=>u(Number(b.target.value)),className:"w-16 px-2 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm text-center",placeholder:"min"}),t.jsx("span",{className:"text-gray-500 self-center",children:":"}),t.jsx("input",{type:"number",min:"0",max:"59",value:f,onChange:b=>g(Number(b.target.value)),className:"w-16 px-2 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm text-center",placeholder:"sec"})]})]}),t.jsx("div",{className:"flex items-end",children:t.jsxs("button",{type:"submit",disabled:e,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg text-sm",children:[e?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):t.jsx(Pt,{className:"h-4 w-4"}),"Add"]})})]})]})}function IB({segment:a,onSave:e,onClose:s}){const[n,i]=k.useState(a.type),[l,o]=k.useState(Math.floor(a.startTime/60)),[d,h]=k.useState(Math.floor(a.startTime%60)),[u,f]=k.useState(Math.floor(a.endTime/60)),[g,p]=k.useState(Math.floor(a.endTime%60)),b=y=>{y.preventDefault();const v=l*60+d,_=u*60+g;_<=v||(e(a.id,{type:n,startTime:v,endTime:_}),s())};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[t.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Edit Segment"}),t.jsxs("form",{onSubmit:b,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Type"}),t.jsxs("select",{value:n,onChange:y=>i(y.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:[t.jsx("option",{value:"intro",children:"Intro"}),t.jsx("option",{value:"outro",children:"Outro"}),t.jsx("option",{value:"credits",children:"Credits"}),t.jsx("option",{value:"commercial",children:"Commercial"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Start Time"}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx("input",{type:"number",min:"0",value:l,onChange:y=>o(Number(y.target.value)),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",placeholder:"min"}),t.jsx("span",{className:"text-gray-500 self-center",children:":"}),t.jsx("input",{type:"number",min:"0",max:"59",value:d,onChange:y=>h(Number(y.target.value)),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",placeholder:"sec"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"End Time"}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx("input",{type:"number",min:"0",value:u,onChange:y=>f(Number(y.target.value)),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",placeholder:"min"}),t.jsx("span",{className:"text-gray-500 self-center",children:":"}),t.jsx("input",{type:"number",min:"0",max:"59",value:g,onChange:y=>p(Number(y.target.value)),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",placeholder:"sec"})]})]})]}),t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsx("button",{type:"button",onClick:s,className:"flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),t.jsx("button",{type:"submit",className:"flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:"Save"})]})]})]})})}function PB(){const a=at(),[e,s]=k.useState(""),[n,i]=k.useState(""),[l,o]=k.useState(null),d=e.trim(),{data:h,isLoading:u,error:f}=Fe({queryKey:["segments",d],queryFn:()=>rl(`/dvr/v2/files/${d}/segments`),enabled:!!d}),g=Me({mutationFn:T=>rl(`/dvr/v2/files/${T}/detect-segments`,{method:"POST"}),onSuccess:()=>{a.invalidateQueries({queryKey:["segments",d]})}}),p=Me({mutationFn:T=>rl(`/dvr/v2/groups/${T}/detect-segments`,{method:"POST"}),onSuccess:()=>{a.invalidateQueries({queryKey:["segments",d]})}}),b=Me({mutationFn:T=>rl(`/dvr/v2/files/${T}/segments`,{method:"DELETE"}),onSuccess:()=>{a.invalidateQueries({queryKey:["segments",d]})}}),y=h?.segments||[],v=h?.duration||0,_=T=>{rl(`/dvr/v2/files/${d}/segments`,{method:"POST",body:JSON.stringify(T)}).then(()=>{a.invalidateQueries({queryKey:["segments",d]})})},N=(T,L)=>{rl(`/dvr/v2/files/${d}/segments/${T}`,{method:"PUT",body:JSON.stringify(L)}).then(()=>{a.invalidateQueries({queryKey:["segments",d]})})},C=T=>{rl(`/dvr/v2/files/${d}/segments/${T}`,{method:"DELETE"}).then(()=>{a.invalidateQueries({queryKey:["segments",d]})})};return t.jsxs("div",{children:[t.jsxs("div",{className:"mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(vu,{className:"h-6 w-6 text-indigo-400"}),t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Segment Detection"})]}),t.jsx("p",{className:"text-gray-400 mt-1",children:"View and edit intro, outro, credits, and commercial segments"})]}),t.jsx("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"File ID"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:e,onChange:T=>s(T.target.value),className:"flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"Enter file ID..."}),t.jsxs("button",{onClick:()=>g.mutate(d),disabled:!d||g.isPending,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 disabled:cursor-not-allowed text-white rounded-lg whitespace-nowrap",children:[g.isPending?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):t.jsx(xs,{className:"h-4 w-4"}),"Detect Segments"]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Group ID (cross-episode)"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:n,onChange:T=>i(T.target.value),className:"flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"Enter group ID..."}),t.jsxs("button",{onClick:()=>p.mutate(n.trim()),disabled:!n.trim()||p.isPending,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 disabled:cursor-not-allowed text-white rounded-lg whitespace-nowrap",children:[p.isPending?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):t.jsx(Fi,{className:"h-4 w-4"}),"Detect Group"]})]})]})]})}),d?u?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx(Ke,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):f?t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 text-center",children:[t.jsx(kt,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Failed to load segments"}),t.jsxs("p",{className:"text-gray-400",children:["Could not fetch segments for file ID: ",d]})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white",children:["Timeline",h?.fileName&&t.jsxs("span",{className:"text-sm text-gray-400 font-normal ml-2",children:["- ",h.fileName]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-sm text-gray-400",children:[y.length," segment",y.length!==1?"s":""," detected"]}),y.length>0&&t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>{const T=localStorage.getItem("openflix_token")||"",L=`/dvr/v2/files/${d}/export.edl?types=commercial,intro,outro,credits&X-Plex-Token=${T}`;window.open(L,"_blank")},className:"flex items-center gap-1 px-3 py-1 text-sm text-indigo-400 hover:text-indigo-300 hover:bg-indigo-500/10 rounded-lg transition-colors",title:"Download EDL file for use with Kodi, MPC-HC, and other players",children:[t.jsx(gs,{className:"h-3.5 w-3.5"}),"Export EDL"]}),t.jsxs("button",{onClick:()=>{const T=localStorage.getItem("openflix_token")||"",L=`/dvr/v2/files/${d}/export.edl?format=mplayer&types=commercial,intro,outro,credits&X-Plex-Token=${T}`;window.open(L,"_blank")},className:"flex items-center gap-1 px-3 py-1 text-sm text-indigo-400 hover:text-indigo-300 hover:bg-indigo-500/10 rounded-lg transition-colors",title:"Download MPlayer-format EDL file",children:[t.jsx(gs,{className:"h-3.5 w-3.5"}),"EDL (MPlayer)"]}),t.jsxs("button",{onClick:()=>{confirm("Delete all segments for this file?")&&b.mutate(d)},disabled:b.isPending,className:"flex items-center gap-1 px-3 py-1 text-sm text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-lg transition-colors",children:[t.jsx(Dt,{className:"h-3.5 w-3.5"}),"Clear All"]})]})]})]}),v>0?t.jsx(a1,{segments:y,duration:v}):y.length>0?t.jsx(a1,{segments:y,duration:Math.max(...y.map(T=>T.endTime),1)}):t.jsx("div",{className:"h-12 bg-gray-700 rounded-lg flex items-center justify-center",children:t.jsx("span",{className:"text-sm text-gray-500",children:"No segments detected"})})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Segments"}),y.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(vu,{className:"h-10 w-10 text-gray-600 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-400 mb-2",children:"No segments found"}),t.jsx("p",{className:"text-gray-500 text-sm",children:"Run detection or add segments manually below."})]}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-gray-700",children:[t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-400",children:"Type"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-400",children:"Start"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-400",children:"End"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-400",children:"Duration"}),t.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-400",children:"Actions"})]})}),t.jsx("tbody",{children:y.map(T=>t.jsxs("tr",{className:"border-b border-gray-700/50 hover:bg-gray-700/30",children:[t.jsx("td",{className:"py-3 px-4",children:t.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded text-xs font-medium capitalize ${DB[T.type]||"bg-gray-700"} ${LB[T.type]||"text-gray-300"}`,children:[t.jsx("span",{className:`w-2 h-2 rounded-full ${z0[T.type]||"bg-gray-500"}`}),T.type]})}),t.jsx("td",{className:"py-3 px-4 text-sm text-gray-300 font-mono",children:ki(T.startTime)}),t.jsx("td",{className:"py-3 px-4 text-sm text-gray-300 font-mono",children:ki(T.endTime)}),t.jsx("td",{className:"py-3 px-4 text-sm text-gray-400",children:RB(T.startTime,T.endTime)}),t.jsx("td",{className:"py-3 px-4 text-right",children:t.jsxs("div",{className:"flex items-center justify-end gap-1",children:[t.jsx("button",{onClick:()=>o(T),className:"p-1.5 text-gray-400 hover:text-indigo-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Edit",children:t.jsx(gk,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>C(T.id),className:"p-1.5 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Delete",children:t.jsx(Dt,{className:"h-4 w-4"})})]})})]},T.id))})]})}),t.jsx("div",{className:"mt-4 pt-4 border-t border-gray-700",children:t.jsx(MB,{onAdd:_,isAdding:!1})})]}),g.isSuccess&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-500/10 border border-green-500/30 rounded-lg",children:[t.jsx(vu,{className:"h-4 w-4 text-green-400"}),t.jsx("span",{className:"text-green-400 text-sm",children:"Segment detection completed successfully."})]}),g.isError&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:[t.jsx(kt,{className:"h-4 w-4 text-red-400"}),t.jsx("span",{className:"text-red-400 text-sm",children:"Segment detection failed. Please try again."})]}),p.isSuccess&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-500/10 border border-green-500/30 rounded-lg",children:[t.jsx(Fi,{className:"h-4 w-4 text-green-400"}),t.jsx("span",{className:"text-green-400 text-sm",children:"Group segment detection completed."})]})]}):t.jsxs("div",{className:"bg-gray-800 rounded-xl p-12 text-center",children:[t.jsx(vu,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Enter a File ID"}),t.jsx("p",{className:"text-gray-400",children:"Enter a DVR file ID above to view and manage its detected segments."})]}),l&&t.jsx(IB,{segment:l,onSave:N,onClose:()=>o(null)})]})}const OB="openflix_token";function FB(){return localStorage.getItem(OB)||""}const n1=[{value:"",label:"All",icon:xt},{value:"media",label:"Media",icon:Gt},{value:"channel",label:"Channels",icon:jt},{value:"program",label:"Programs",icon:$s},{value:"file",label:"Files",icon:wa},{value:"group",label:"Groups",icon:qh}],BB={media:{color:"text-purple-400",bg:"bg-purple-500/20",label:"Media"},movie:{color:"text-purple-400",bg:"bg-purple-500/20",label:"Movie"},show:{color:"text-blue-400",bg:"bg-blue-500/20",label:"TV Show"},episode:{color:"text-blue-300",bg:"bg-blue-500/15",label:"Episode"},channel:{color:"text-green-400",bg:"bg-green-500/20",label:"Channel"},program:{color:"text-orange-400",bg:"bg-orange-500/20",label:"Program"},file:{color:"text-gray-400",bg:"bg-gray-500/20",label:"File"},group:{color:"text-yellow-400",bg:"bg-yellow-500/20",label:"Group"}},ll=25;async function UB(a,e,s,n){const i=new URLSearchParams;i.set("q",a),e&&i.set("type",e),i.set("limit",String(s)),i.set("offset",String(n));const l=await fetch(`/api/search?${i.toString()}`,{headers:{"X-Plex-Token":FB()}});if(!l.ok)throw new Error("Search failed");return l.json()}function $B({type:a}){const e=BB[a]||{color:"text-gray-400",bg:"bg-gray-500/20",label:a};return t.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 ${e.bg} ${e.color} rounded text-xs font-medium`,children:[t.jsx(Vc,{className:"h-3 w-3"}),e.label]})}function GB(){const[a,e]=k.useState(""),[s,n]=k.useState(""),[i,l]=k.useState(""),[o,d]=k.useState(0),{data:h,isLoading:u,error:f,refetch:g}=Fe({queryKey:["search",s,i,o],queryFn:()=>UB(s,i,ll,o),enabled:s.length>0}),p=k.useCallback(()=>{a.trim()&&(n(a.trim()),d(0))},[a]),b=T=>{T.key==="Enter"&&p()},y=T=>{l(T),d(0)},v=h?.results||[],_=h?.total||0,N=Math.floor(o/ll)+1,C=Math.ceil(_/ll);return t.jsxs("div",{children:[t.jsxs("div",{className:"mb-8",children:[t.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[t.jsx(xt,{className:"h-7 w-7 text-indigo-400"}),"Search"]}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Search across channels, media, programs, and more"})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),t.jsx("input",{type:"text",value:a,onChange:T=>e(T.target.value),onKeyDown:b,placeholder:"Search for anything...",className:"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base placeholder-gray-500 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500",autoFocus:!0})]}),t.jsxs("button",{onClick:p,disabled:!a.trim()||u,className:"flex items-center gap-2 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 disabled:cursor-not-allowed text-white rounded-lg font-medium",children:[u?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):t.jsx(xt,{className:"h-4 w-4"}),"Search"]})]}),t.jsx("div",{className:"flex flex-wrap gap-2 mt-4",children:n1.map(({value:T,label:L,icon:F})=>t.jsxs("button",{onClick:()=>y(T),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm transition-colors ${i===T?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:[t.jsx(F,{className:"h-3.5 w-3.5"}),L]},T))})]}),f&&t.jsxs("div",{className:"mb-6 flex flex-col items-center justify-center h-48 gap-4",children:[t.jsx(ps,{className:"h-10 w-10 text-red-400"}),t.jsx("p",{className:"text-red-400 text-sm",children:f.message}),t.jsxs("button",{onClick:()=>g(),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm",children:[t.jsx(ut,{className:"h-4 w-4"}),"Retry"]})]}),!s&&!f&&t.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-500",children:[t.jsx(xt,{className:"h-16 w-16 mb-4 text-gray-600"}),t.jsx("p",{className:"text-lg",children:"Enter a search term to get started"})]}),u&&t.jsx("div",{className:"flex items-center justify-center h-48",children:t.jsx(Ke,{className:"h-8 w-8 text-indigo-500 animate-spin"})}),s&&!u&&!f&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex items-center justify-between mb-4",children:t.jsx("p",{className:"text-sm text-gray-400",children:_===0?"No results found":t.jsxs(t.Fragment,{children:["Showing ",o+1,"-",Math.min(o+ll,_)," of ",_," result",_!==1?"s":"",i&&t.jsxs("span",{className:"ml-1",children:["in ",n1.find(T=>T.value===i)?.label||i]})]})})}),v.length===0?t.jsxs("div",{className:"flex flex-col items-center justify-center h-48 bg-gray-800 rounded-xl",children:[t.jsx(xt,{className:"h-12 w-12 text-gray-600 mb-3"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-1",children:"No results found"}),t.jsx("p",{className:"text-gray-400 text-sm",children:"Try a different search term or filter"})]}):t.jsx("div",{className:"space-y-2",children:v.map((T,L)=>t.jsxs("div",{className:"bg-gray-800 rounded-xl p-4 hover:bg-gray-750 transition-colors cursor-pointer flex items-center gap-4",children:[T.thumb?t.jsx("img",{src:T.thumb,alt:"",className:"w-12 h-12 rounded-lg object-cover flex-shrink-0 bg-gray-700"}):t.jsx("div",{className:"w-12 h-12 rounded-lg bg-gray-700 flex items-center justify-center flex-shrink-0",children:T.type==="channel"?t.jsx(jt,{className:"h-5 w-5 text-gray-500"}):T.type==="program"?t.jsx($s,{className:"h-5 w-5 text-gray-500"}):t.jsx(Gt,{className:"h-5 w-5 text-gray-500"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx($B,{type:T.type}),T.channelNumber&&t.jsxs("span",{className:"text-xs text-gray-500",children:["Ch. ",T.channelNumber]}),T.year&&t.jsx("span",{className:"text-xs text-gray-500",children:T.year})]}),t.jsx("p",{className:"text-white font-medium truncate",children:T.title}),T.description&&t.jsx("p",{className:"text-gray-400 text-sm mt-0.5 line-clamp-1",children:T.description}),T.groupName&&t.jsxs("p",{className:"text-gray-500 text-xs mt-0.5",children:["Group: ",T.groupName]})]})]},`${T.type}-${T.id}-${L}`))}),C>1&&t.jsxs("div",{className:"flex items-center justify-center gap-3 mt-6",children:[t.jsxs("button",{onClick:()=>d(Math.max(0,o-ll)),disabled:o===0,className:"flex items-center gap-1.5 px-3 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:text-gray-600 text-white rounded-lg text-sm",children:[t.jsx(ko,{className:"h-4 w-4"}),"Previous"]}),t.jsxs("span",{className:"text-sm text-gray-400",children:["Page ",N," of ",C]}),t.jsxs("button",{onClick:()=>d(o+ll),disabled:o+ll>=_,className:"flex items-center gap-1.5 px-3 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:text-gray-600 text-white rounded-lg text-sm",children:["Next",t.jsx(Ba,{className:"h-4 w-4"})]})]})]})]})}const VB="openflix_token";function Hp(){return localStorage.getItem(VB)||""}function i1(a){return new Date(a).toLocaleString()}function r1(a){const e=Date.now()-new Date(a).getTime(),s=Math.floor(e/6e4);if(s<1)return"just now";if(s<60)return`${s}m ago`;const n=Math.floor(s/60);return n<24?`${n}h ago`:`${Math.floor(n/24)}d ago`}async function qB(){const a=await fetch("/admin/updater/status",{headers:{"X-Plex-Token":Hp()}});if(!a.ok)throw new Error("Failed to fetch updater status");return a.json()}async function KB(){const a=await fetch("/admin/updater/check",{method:"POST",headers:{"X-Plex-Token":Hp()}});if(!a.ok)throw new Error("Failed to check for updates");return a.json()}async function HB(){if(!(await fetch("/admin/updater/apply",{method:"POST",headers:{"X-Plex-Token":Hp()}})).ok)throw new Error("Failed to apply update")}function zB(){const a=at(),[e,s]=k.useState(!1),[n,i]=k.useState(!1),{data:l,isLoading:o,error:d,refetch:h}=Fe({queryKey:["updaterStatus"],queryFn:qB}),u=Me({mutationFn:KB,onSuccess:g=>{a.setQueryData(["updaterStatus"],g)}}),f=Me({mutationFn:HB,onSuccess:()=>{s(!1),i(!0)}});return o?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx(Ke,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):d?t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[t.jsx(ps,{className:"h-12 w-12 text-red-400"}),t.jsx("h3",{className:"text-lg font-medium text-white",children:"Failed to load updater status"}),t.jsx("p",{className:"text-gray-400 text-sm",children:d.message}),t.jsxs("button",{onClick:()=>h(),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[t.jsx(ut,{className:"h-4 w-4"}),"Retry"]})]}):t.jsxs("div",{children:[t.jsxs("div",{className:"mb-8",children:[t.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[t.jsx(ut,{className:"h-7 w-7 text-indigo-400"}),"Server Updates"]}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Manage OpenFlix server updates"})]}),n&&t.jsx("div",{className:"mb-6 p-4 bg-green-500/10 border border-green-500/30 rounded-xl",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(Xt,{className:"h-5 w-5 text-green-400 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-green-400",children:"Update applied successfully"}),t.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"The server is restarting with the new version. This page will reload automatically once the server is back online. If it does not reload, try refreshing the page manually."})]})]})}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"p-3 bg-indigo-600/20 rounded-lg",children:t.jsx(td,{className:"h-8 w-8 text-indigo-400"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-400",children:"Current Version"}),t.jsx("p",{className:"text-3xl font-bold text-white",children:l?.currentVersion||"Unknown"})]})]}),t.jsxs("button",{onClick:()=>u.mutate(),disabled:u.isPending,className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 text-white rounded-lg",children:[u.isPending?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):t.jsx(ut,{className:"h-4 w-4"}),u.isPending?"Checking...":"Check for Updates"]})]}),l?.lastChecked&&t.jsxs("p",{className:"text-xs text-gray-500 mt-3 flex items-center gap-1.5",children:[t.jsx(Kt,{className:"h-3 w-3"}),"Last checked: ",i1(l.lastChecked)," (",r1(l.lastChecked),")"]})]}),u.error&&t.jsxs("div",{className:"mb-6 p-3 bg-red-500/10 border border-red-500/30 rounded-lg flex items-center gap-2",children:[t.jsx(ps,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),t.jsx("span",{className:"text-red-400 text-sm",children:u.error.message})]}),f.error&&t.jsxs("div",{className:"mb-6 p-3 bg-red-500/10 border border-red-500/30 rounded-lg flex items-center gap-2",children:[t.jsx(ps,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),t.jsx("span",{className:"text-red-400 text-sm",children:f.error.message})]}),l?.updateAvailable&&l.latestVersion?t.jsxs("div",{className:"bg-gray-800 rounded-xl overflow-hidden mb-6",children:[t.jsx("div",{className:"p-6 border-b border-gray-700",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"flex items-center gap-3 mb-2",children:t.jsx("span",{className:"px-2.5 py-1 bg-green-600/20 text-green-400 border border-green-500/30 rounded-full text-xs font-medium",children:"Update Available"})}),t.jsxs("div",{className:"flex items-center gap-3 text-lg",children:[t.jsx("span",{className:"text-gray-400 font-mono",children:l.currentVersion}),t.jsx(l0,{className:"h-5 w-5 text-gray-500"}),t.jsx("span",{className:"text-green-400 font-bold font-mono",children:l.latestVersion})]}),l.releaseDate&&t.jsxs("p",{className:"text-xs text-gray-500 mt-2 flex items-center gap-1.5",children:[t.jsx(Vc,{className:"h-3 w-3"}),"Released: ",i1(l.releaseDate)]})]}),e?t.jsxs("div",{className:"flex flex-col items-end gap-2",children:[t.jsx("p",{className:"text-xs text-yellow-400",children:"The server will restart during the update."}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>f.mutate(),disabled:f.isPending,className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-green-800 text-white rounded-lg text-sm",children:[f.isPending?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):t.jsx(gs,{className:"h-4 w-4"}),f.isPending?"Applying...":"Confirm Update"]}),t.jsx("button",{onClick:()=>s(!1),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:"Cancel"})]})]}):t.jsxs("button",{onClick:()=>s(!0),className:"flex items-center gap-2 px-5 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium",children:[t.jsx(gs,{className:"h-4 w-4"}),"Update Now"]})]})}),(l.releaseNotes||l.changelog&&l.changelog.length>0)&&t.jsxs("div",{className:"p-6",children:[t.jsxs("h3",{className:"text-sm font-medium text-gray-300 mb-3 flex items-center gap-2",children:[t.jsx(wa,{className:"h-4 w-4"}),"Release Notes"]}),l.releaseNotes?t.jsx("div",{className:"bg-gray-900 rounded-lg p-4 text-sm text-gray-300 leading-relaxed whitespace-pre-wrap font-mono",children:l.releaseNotes}):l.changelog?t.jsx("ul",{className:"space-y-1.5",children:l.changelog.map((g,p)=>t.jsxs("li",{className:"text-sm text-gray-300 flex items-start gap-2",children:[t.jsx("span",{className:"text-indigo-400 mt-1",children:"-"}),g]},p))}):null]})]}):l&&!l.updateAvailable?t.jsxs("div",{className:"bg-gray-800 rounded-xl p-8 text-center",children:[t.jsx(Xt,{className:"h-16 w-16 text-green-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"You're up to date!"}),t.jsxs("p",{className:"text-gray-400",children:["OpenFlix ",l.currentVersion," is the latest version."]}),l.lastChecked&&t.jsxs("p",{className:"text-xs text-gray-500 mt-3",children:["Last checked ",r1(l.lastChecked)]})]}):null]})}const Ph=async(a,e)=>{const s=localStorage.getItem("openflix_token")||"",n=await fetch(a,{...e,headers:{"X-Plex-Token":s,"Content-Type":"application/json",...e?.headers}});if(!n.ok)throw new Error(`API error: ${n.status}`);return n.json()};function YB(){return Fe({queryKey:["comskipStatus"],queryFn:()=>Ph("/dvr/commercials/status")})}function WB(){return Fe({queryKey:["comskipSettings"],queryFn:()=>Ph("/dvr/settings")})}function QB(){const a=at(),{data:e,isLoading:s,error:n}=YB(),{data:i,isLoading:l}=WB(),[o,d]=k.useState(!1),[h,u]=k.useState("comskip"),[f,g]=k.useState("/usr/bin/comskip"),[p,b]=k.useState(50),[y,v]=k.useState("show_prompt"),[_,N]=k.useState(5),[C,T]=k.useState(!1),[L,F]=k.useState(2),[H,B]=k.useState(!1),[P,I]=k.useState(!1);k.useEffect(()=>{if(i?.settings){const Z=i.settings;u(Z.detection_method||"comskip"),g(Z.comskip_path||"/usr/bin/comskip"),b(Z.sensitivity??50),v(Z.auto_skip_behavior||"show_prompt"),N(Z.skip_prompt_duration??5),F(Z.detection_workers??2),B(Z.generate_thumbnails??!1),I(Z.share_edits??!1)}},[i]),k.useEffect(()=>{e&&T(e.enabled)},[e]);const D=Me({mutationFn:Z=>Ph("/dvr/settings",{method:"PUT",body:JSON.stringify(Z)}),onSuccess:()=>{a.invalidateQueries({queryKey:["comskipSettings"]}),a.invalidateQueries({queryKey:["comskipStatus"]}),d(!0),setTimeout(()=>d(!1),3e3)}}),O=()=>{D.mutate({enabled:C,detection_method:h,comskip_path:f,sensitivity:p,auto_skip_behavior:y,skip_prompt_duration:_,detection_workers:L,generate_thumbnails:H,share_edits:P})},{data:ee}=Fe({queryKey:["comskipResults"],queryFn:()=>Ph("/api/commercial/get")}),ie=ee?.results||[];return s||l?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx(Ke,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):n?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(kt,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white",children:"Failed to load commercial detection settings"}),t.jsx("p",{className:"text-gray-400 mt-2",children:"Check that the DVR service is running."})]}):t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(si,{className:"h-6 w-6 text-indigo-400"}),t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Commercial Skip Settings"})]}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Configure automatic commercial detection and skipping"})]}),t.jsxs("button",{onClick:O,disabled:D.isPending,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg",children:[t.jsx(ii,{className:"h-4 w-4"}),D.isPending?"Saving...":o?"Saved!":"Save Changes"]})]}),t.jsx("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Commercial Detection"}),t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Automatically detect commercial breaks in DVR recordings"})]}),t.jsx("button",{onClick:()=>T(!C),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${C?"bg-green-500/20 text-green-400 hover:bg-green-500/30":"bg-gray-700 text-gray-400 hover:bg-gray-600"}`,children:C?t.jsxs(t.Fragment,{children:[t.jsx(Pc,{className:"h-5 w-5"}),"Enabled"]}):t.jsxs(t.Fragment,{children:[t.jsx(Ic,{className:"h-5 w-5"}),"Disabled"]})})]})}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[t.jsx(vh,{className:"h-5 w-5 text-indigo-400"}),t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Detection Configuration"})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Detection Method"}),t.jsxs("select",{value:h,onChange:Z=>u(Z.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:[t.jsx("option",{value:"comskip",children:"Comskip (External)"}),t.jsx("option",{value:"black_frames",children:"Black Frame Detection"}),t.jsx("option",{value:"hybrid",children:"Hybrid (Comskip + Black Frames)"})]}),t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[h==="comskip"&&"Uses the external Comskip binary for accurate commercial detection.",h==="black_frames"&&"Detects black frames as commercial boundaries. Less accurate but no external dependency.",h==="hybrid"&&"Combines Comskip output with black frame detection for best results."]})]}),(h==="comskip"||h==="hybrid")&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Comskip Path"}),t.jsx("input",{type:"text",value:f,onChange:Z=>g(Z.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white font-mono text-sm",placeholder:"/usr/bin/comskip"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Full path to the Comskip binary on the server."})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Detection Sensitivity: ",p,"%"]}),t.jsx("input",{type:"range",min:"0",max:"100",value:p,onChange:Z=>b(Number(Z.target.value)),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-indigo-600"}),t.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[t.jsx("span",{children:"Less Aggressive (fewer cuts)"}),t.jsx("span",{children:"More Aggressive (more cuts)"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Auto-Skip Behavior"}),t.jsx("div",{className:"space-y-2",children:[{value:"disabled",label:"Disabled",desc:"Show commercial markers but do not skip automatically"},{value:"show_prompt",label:"Show Skip Prompt",desc:'Display a "Skip" button when a commercial is detected'},{value:"skip_immediately",label:"Skip Immediately",desc:"Automatically skip past detected commercials"}].map(Z=>t.jsxs("label",{className:`flex items-start gap-3 p-4 rounded-lg border cursor-pointer transition-colors ${y===Z.value?"border-indigo-500 bg-indigo-500/10":"border-gray-700 bg-gray-700/50 hover:border-gray-600"}`,children:[t.jsx("input",{type:"radio",name:"autoSkipBehavior",value:Z.value,checked:y===Z.value,onChange:z=>v(z.target.value),className:"mt-1 accent-indigo-600"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-white",children:Z.label}),t.jsx("div",{className:"text-sm text-gray-400",children:Z.desc})]})]},Z.value))})]}),y==="show_prompt"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Skip Prompt Duration (seconds)"}),t.jsx("input",{type:"number",min:"1",max:"30",value:_,onChange:Z=>N(Number(Z.target.value)),className:"w-32 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"How long the skip button is displayed before auto-dismissing."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Detection Workers"}),t.jsx("input",{type:"number",min:"1",max:"8",value:L,onChange:Z=>F(Math.min(8,Math.max(1,Number(Z.target.value)))),className:"w-32 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Number of parallel commercial detection jobs (1-8). Higher values process recordings faster but use more CPU."})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Generate Thumbnails"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Generate preview thumbnails at chapter points during commercial detection."})]}),t.jsx("button",{onClick:()=>B(!H),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${H?"bg-green-500/20 text-green-400 hover:bg-green-500/30":"bg-gray-700 text-gray-400 hover:bg-gray-600"}`,children:H?t.jsxs(t.Fragment,{children:[t.jsx(Pc,{className:"h-5 w-5"}),"On"]}):t.jsxs(t.Fragment,{children:[t.jsx(Ic,{className:"h-5 w-5"}),"Off"]})})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Share Commercial Edits"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Share your commercial detection results to help improve accuracy for everyone."})]}),t.jsx("button",{onClick:()=>I(!P),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${P?"bg-green-500/20 text-green-400 hover:bg-green-500/30":"bg-gray-700 text-gray-400 hover:bg-gray-600"}`,children:P?t.jsxs(t.Fragment,{children:[t.jsx(Pc,{className:"h-5 w-5"}),"On"]}):t.jsxs(t.Fragment,{children:[t.jsx(Ic,{className:"h-5 w-5"}),"Off"]})})]})]})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Recent Detection Results"}),ie.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(vh,{className:"h-12 w-12 text-gray-600 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-400",children:"No recent detection results"})]}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-gray-700",children:[t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-400",children:"File"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-400",children:"Segments Found"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-400",children:"Processing Time"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-400",children:"Status"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-400",children:"Timestamp"})]})}),t.jsx("tbody",{children:ie.map((Z,z)=>t.jsxs("tr",{className:"border-b border-gray-700/50 hover:bg-gray-700/30",children:[t.jsx("td",{className:"py-3 px-4 text-sm text-white font-mono",children:Z.file}),t.jsx("td",{className:"py-3 px-4 text-sm text-gray-300",children:t.jsx("span",{className:`px-2 py-0.5 rounded ${Z.segmentsFound>0?"bg-indigo-500/20 text-indigo-400":"bg-gray-700 text-gray-400"}`,children:Z.segmentsFound})}),t.jsxs("td",{className:"py-3 px-4 text-sm text-gray-300",children:[Z.processingTime.toFixed(1),"s"]}),t.jsx("td",{className:"py-3 px-4 text-sm",children:t.jsxs("span",{className:"flex items-center gap-1 text-green-400",children:[t.jsx(Xt,{className:"h-3.5 w-3.5"}),Z.status]})}),t.jsx("td",{className:"py-3 px-4 text-sm text-gray-400",children:new Date(Z.timestamp).toLocaleString()})]},z))})]})})]})]})}const ol={"X-Plex-Token":localStorage.getItem("openflix_token")||"","Content-Type":"application/json"},Hu=5,l1=[{label:"Welcome",icon:td},{label:"Libraries",icon:sa},{label:"Live TV",icon:jt},{label:"DVR",icon:Nn},{label:"Done",icon:Z1}];function XB({current:a,total:e}){return t.jsx("div",{className:"flex items-center justify-center gap-2 mb-8",children:Array.from({length:e}).map((s,n)=>{const i=n+1,l=i<a,o=i===a,d=l1[n].icon;return t.jsxs("div",{className:"flex items-center gap-2",children:[n>0&&t.jsx("div",{className:`h-0.5 w-8 ${l?"bg-green-500":"bg-gray-600"}`}),t.jsxs("div",{className:"flex flex-col items-center gap-1",children:[t.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full border-2 text-sm font-bold transition-colors ${l?"bg-green-500 border-green-500 text-white":o?"bg-indigo-600 border-indigo-600 text-white":"bg-gray-800 border-gray-600 text-gray-400"}`,children:l?t.jsx(Xt,{className:"w-5 h-5"}):t.jsx(d,{className:"w-5 h-5"})}),t.jsx("span",{className:`text-xs ${o?"text-indigo-400 font-medium":"text-gray-500"}`,children:l1[n].label})]})]},n)})})}function JB({state:a,onChange:e,needsAdmin:s}){return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:"Welcome to OpenFlix"}),t.jsx("p",{className:"text-gray-400 mt-2",children:"Let's configure your new media server in a few quick steps."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Server Name"}),t.jsx("input",{type:"text",value:a.serverName,onChange:n=>e({serverName:n.target.value}),placeholder:"My OpenFlix Server",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),s&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"border-t border-gray-700 pt-4",children:t.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Create Admin Account"})}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Username"}),t.jsx("input",{type:"text",value:a.adminUsername,onChange:n=>e({adminUsername:n.target.value}),placeholder:"admin",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email"}),t.jsx("input",{type:"email",value:a.adminEmail,onChange:n=>e({adminEmail:n.target.value}),placeholder:"admin@example.com",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Password"}),t.jsx("input",{type:"password",value:a.adminPassword,onChange:n=>e({adminPassword:n.target.value}),placeholder:"Choose a strong password",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]})]})]})}function ZB({state:a,onChange:e}){const[s,n]=k.useState(""),[i,l]=k.useState("movie"),[o,d]=k.useState(""),h=()=>{!s.trim()||!o.trim()||(e({libraries:[...a.libraries,{title:s.trim(),type:i,paths:[o.trim()]}]}),n(""),d(""))},u=f=>{e({libraries:a.libraries.filter((g,p)=>p!==f)})};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:"Media Libraries"}),t.jsx("p",{className:"text-gray-400 mt-2",children:"Add folders containing your movies and TV shows."})]}),a.libraries.length>0&&t.jsx("div",{className:"space-y-3",children:a.libraries.map((f,g)=>t.jsxs("div",{className:"flex items-center justify-between bg-gray-700/50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(sa,{className:"w-5 h-5 text-indigo-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-white font-medium",children:f.title}),t.jsxs("p",{className:"text-sm text-gray-400",children:[f.type==="movie"?"Movies":"TV Shows"," "," ",f.paths.join(", ")]})]})]}),t.jsx("button",{onClick:()=>u(g),className:"p-2 text-gray-400 hover:text-red-400 rounded-lg hover:bg-gray-700 transition-colors",children:t.jsx(Dt,{className:"w-4 h-4"})})]},g))}),t.jsxs("div",{className:"bg-gray-700/30 rounded-xl p-4 space-y-4 border border-gray-700",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"Add Library"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Title"}),t.jsx("input",{type:"text",value:s,onChange:f=>n(f.target.value),placeholder:"e.g. Movies",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Type"}),t.jsxs("select",{value:i,onChange:f=>l(f.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",children:[t.jsx("option",{value:"movie",children:"Movies"}),t.jsx("option",{value:"show",children:"TV Shows"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Folder Path"}),t.jsx("input",{type:"text",value:o,onChange:f=>d(f.target.value),placeholder:"/media/movies",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),t.jsxs("button",{onClick:h,disabled:!s.trim()||!o.trim(),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-40 disabled:cursor-not-allowed text-white rounded-lg text-sm font-medium transition-colors",children:[t.jsx(Pt,{className:"w-4 h-4"}),"Add Library"]})]})]})}function eU({state:a,onChange:e}){const[s,n]=k.useState(a.m3uSource?.name||""),[i,l]=k.useState(a.m3uSource?.url||""),o=()=>{s.trim()&&i.trim()&&e({m3uSource:{name:s.trim(),url:i.trim()}})},d=()=>{e({m3uSource:void 0}),n(""),l("")};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:"Live TV"}),t.jsx("p",{className:"text-gray-400 mt-2",children:"Optionally add an M3U source for live TV channels. You can skip this and add sources later."})]}),a.m3uSource?t.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-lg p-4 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Xt,{className:"w-5 h-5 text-green-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-white font-medium",children:a.m3uSource.name}),t.jsx("p",{className:"text-sm text-gray-400 truncate max-w-md",children:a.m3uSource.url})]})]}),t.jsx("button",{onClick:d,className:"p-2 text-gray-400 hover:text-red-400 rounded-lg hover:bg-gray-700 transition-colors",children:t.jsx(Dt,{className:"w-4 h-4"})})]}):t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Source Name"}),t.jsx("input",{type:"text",value:s,onChange:h=>n(h.target.value),placeholder:"My IPTV",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"M3U URL"}),t.jsx("input",{type:"url",value:i,onChange:h=>l(h.target.value),placeholder:"http://example.com/playlist.m3u",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),t.jsxs("button",{onClick:o,disabled:!s.trim()||!i.trim(),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-40 disabled:cursor-not-allowed text-white rounded-lg text-sm font-medium transition-colors",children:[t.jsx(Pt,{className:"w-4 h-4"}),"Add M3U Source"]})]}),t.jsx("p",{className:"text-xs text-gray-500 text-center",children:"This step is optional. You can always add or edit Live TV sources from Settings later."})]})}function tU({state:a,onChange:e}){return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:"DVR Settings"}),t.jsx("p",{className:"text-gray-400 mt-2",children:"Configure recording options for your Live TV channels."})]}),t.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[t.jsx("div",{className:`relative w-11 h-6 rounded-full transition-colors ${a.dvrEnabled?"bg-indigo-600":"bg-gray-600"}`,onClick:()=>e({dvrEnabled:!a.dvrEnabled}),children:t.jsx("div",{className:`absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow transition-transform ${a.dvrEnabled?"translate-x-5":""}`})}),t.jsx("span",{className:"text-white font-medium",children:"Enable DVR Recording"})]}),a.dvrEnabled&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Recording Directory"}),t.jsx("input",{type:"text",value:a.recordingDir,onChange:s=>e({recordingDir:s.target.value}),placeholder:"/recordings",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Path where recorded programmes will be saved on disk."})]})]})}function sU({state:a}){return t.jsxs("div",{className:"space-y-6 text-center",children:[t.jsx("div",{className:"flex justify-center",children:t.jsx("div",{className:"w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center",children:t.jsx(Z1,{className:"w-8 h-8 text-green-400"})})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:"All Set!"}),t.jsx("p",{className:"text-gray-400 mt-2",children:"Your OpenFlix server is ready. Here is a summary of what was configured:"})]}),t.jsxs("div",{className:"bg-gray-700/30 rounded-xl p-5 text-left space-y-3 max-w-md mx-auto",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-400",children:"Server Name"}),t.jsx("span",{className:"text-white font-medium",children:a.serverName||"OpenFlix"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-400",children:"Libraries"}),t.jsxs("span",{className:"text-white font-medium",children:[a.libraries.length," added"]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-400",children:"Live TV Source"}),t.jsx("span",{className:"text-white font-medium",children:a.m3uSource?a.m3uSource.name:"Skipped"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-400",children:"DVR"}),t.jsx("span",{className:"text-white font-medium",children:a.dvrEnabled?"Enabled":"Disabled"})]})]})]})}function aU(){const[a,e]=k.useState({step:1,serverName:"",adminUsername:"",adminEmail:"",adminPassword:"",libraries:[],m3uSource:void 0,dvrEnabled:!1,recordingDir:"/recordings"}),[s,n]=k.useState(!1),[i,l]=k.useState(!0),[o,d]=k.useState(!1),[h,u]=k.useState(null);k.useEffect(()=>{(async()=>{try{const N=await fetch("/api/status",{headers:ol});if(!N.ok)throw new Error("Failed to fetch status");const C=await N.json();e(T=>({...T,serverName:C.server?.name||""})),C.libraries?.count===0&&n(!0)}catch{n(!0)}finally{l(!1)}})()},[]);const f=_=>{e(N=>({...N,..._}))},g=()=>{switch(a.step){case 1:return s?!!a.serverName.trim()&&!!a.adminUsername.trim()&&!!a.adminEmail.trim()&&!!a.adminPassword.trim():!!a.serverName.trim();case 2:return!0;case 3:return!0;case 4:return!a.dvrEnabled||!!a.recordingDir.trim();case 5:return!0;default:return!1}},p=async _=>{u(null),d(!0);try{switch(_){case 1:{if(s){const N=await fetch("/auth/register",{method:"POST",headers:ol,body:JSON.stringify({username:a.adminUsername,email:a.adminEmail,password:a.adminPassword})});if(!N.ok){const T=await N.json().catch(()=>({}));throw new Error(T.error||"Failed to create admin account")}const C=await fetch("/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:a.adminUsername,password:a.adminPassword})});if(C.ok){const T=await C.json();T.authToken&&(localStorage.setItem("openflix_token",T.authToken),ol["X-Plex-Token"]=T.authToken)}}await fetch("/admin/settings",{method:"PUT",headers:ol,body:JSON.stringify({server_name:a.serverName})});break}case 2:{for(const N of a.libraries)await fetch("/admin/libraries",{method:"POST",headers:ol,body:JSON.stringify({title:N.title,type:N.type,paths:N.paths})});break}case 3:{a.m3uSource&&await fetch("/livetv/sources",{method:"POST",headers:ol,body:JSON.stringify({name:a.m3uSource.name,url:a.m3uSource.url})});break}case 4:{a.dvrEnabled&&await fetch("/admin/settings",{method:"PUT",headers:ol,body:JSON.stringify({dvr_enabled:!0,recording_dir:a.recordingDir})});break}}}catch(N){return u(N instanceof Error?N.message:"An error occurred"),d(!1),!1}return d(!1),!0},b=async()=>{a.step<Hu&&await p(a.step)&&f({step:a.step+1})},y=()=>{a.step>1&&(f({step:a.step-1}),u(null))},v=()=>{window.location.href="/ui"};return i?t.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:t.jsx(Ke,{className:"w-8 h-8 text-indigo-500 animate-spin"})}):t.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-6",children:t.jsxs("div",{className:"w-full max-w-2xl",children:[t.jsx(XB,{current:a.step,total:Hu}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-8 shadow-2xl",children:[a.step===1&&t.jsx(JB,{state:a,onChange:f,needsAdmin:s}),a.step===2&&t.jsx(ZB,{state:a,onChange:f}),a.step===3&&t.jsx(eU,{state:a,onChange:f}),a.step===4&&t.jsx(tU,{state:a,onChange:f}),a.step===5&&t.jsx(sU,{state:a}),h&&t.jsxs("div",{className:"mt-4 flex items-center gap-2 text-red-400 bg-red-500/10 border border-red-500/30 rounded-lg p-3 text-sm",children:[t.jsx(kt,{className:"w-4 h-4 flex-shrink-0"}),h]}),t.jsxs("div",{className:"flex items-center justify-between mt-8 pt-6 border-t border-gray-700",children:[a.step>1&&a.step<Hu?t.jsxs("button",{onClick:y,className:"flex items-center gap-2 px-5 py-2.5 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors",children:[t.jsx(Er,{className:"w-4 h-4"}),"Back"]}):t.jsx("div",{}),a.step<Hu?t.jsx("button",{onClick:b,disabled:!g()||o,className:"flex items-center gap-2 px-5 py-2.5 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-40 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors",children:o?t.jsx(Ke,{className:"w-4 h-4 animate-spin"}):t.jsxs(t.Fragment,{children:[a.step===2&&a.libraries.length===0||a.step===3&&!a.m3uSource?"Skip":"Next",t.jsx(l0,{className:"w-4 h-4"})]})}):t.jsxs("button",{onClick:v,className:"flex items-center gap-2 px-6 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors",children:["Go to Dashboard",t.jsx(l0,{className:"w-4 h-4"})]})]})]})]})})}const nU="openflix_token";function ld(){return localStorage.getItem(nU)||""}function iU(a){if(a===0)return"0 B";const e=1024,s=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(a)/Math.log(e));return`${parseFloat((a/Math.pow(e,n)).toFixed(1))} ${s[n]}`}function rU(a){return new Date(a).toLocaleString()}function lU(a){const e=Date.now()-new Date(a).getTime(),s=Math.floor(e/6e4);if(s<1)return"just now";if(s<60)return`${s}m ago`;const n=Math.floor(s/60);return n<24?`${n}h ago`:`${Math.floor(n/24)}d ago`}async function oU(){const a=await fetch("/admin/backups",{headers:{"X-Plex-Token":ld()}});if(!a.ok)throw new Error("Failed to fetch backups");return a.json()}async function cU(){if(!(await fetch("/admin/backups",{method:"POST",headers:{"X-Plex-Token":ld()}})).ok)throw new Error("Failed to create backup")}async function dU(a){if(!(await fetch(`/admin/backups/${encodeURIComponent(a)}`,{method:"DELETE",headers:{"X-Plex-Token":ld()}})).ok)throw new Error("Failed to delete backup")}async function uU(a){if(!(await fetch(`/admin/backups/${encodeURIComponent(a)}/restore`,{method:"POST",headers:{"X-Plex-Token":ld()}})).ok)throw new Error("Failed to restore backup")}function hU(a){const e=ld(),s=`/admin/backups/${encodeURIComponent(a)}/download?X-Plex-Token=${encodeURIComponent(e)}`,n=document.createElement("a");n.href=s,n.download=a,document.body.appendChild(n),n.click(),document.body.removeChild(n)}function fU(){const a=at(),[e,s]=k.useState(null),[n,i]=k.useState(null),[l,o]=k.useState(null),{data:d,isLoading:h,error:u,refetch:f}=Fe({queryKey:["backups"],queryFn:oU}),g=Me({mutationFn:cU,onSuccess:()=>{a.invalidateQueries({queryKey:["backups"]}),o("Backup created successfully"),setTimeout(()=>o(null),4e3)}}),p=Me({mutationFn:dU,onSuccess:()=>{a.invalidateQueries({queryKey:["backups"]}),i(null),o("Backup deleted"),setTimeout(()=>o(null),4e3)}}),b=Me({mutationFn:uU,onSuccess:()=>{a.invalidateQueries({queryKey:["backups"]}),s(null),o("Backup restored successfully. You may need to restart the server."),setTimeout(()=>o(null),8e3)}}),y=d?.backups||[];return h?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx(Ke,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):u?t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[t.jsx(ps,{className:"h-12 w-12 text-red-400"}),t.jsx("h3",{className:"text-lg font-medium text-white",children:"Failed to load backups"}),t.jsx("p",{className:"text-gray-400 text-sm",children:u.message}),t.jsxs("button",{onClick:()=>f(),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[t.jsx(ut,{className:"h-4 w-4"}),"Retry"]})]}):t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[t.jsx(gh,{className:"h-7 w-7 text-indigo-400"}),"Backups"]}),t.jsxs("p",{className:"text-gray-400 mt-1",children:[y.length," backup",y.length!==1?"s":""," available"]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("button",{onClick:()=>f(),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:[t.jsx(ut,{className:"h-4 w-4"}),"Refresh"]}),t.jsxs("button",{onClick:()=>g.mutate(),disabled:g.isPending,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg text-sm",children:[g.isPending?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):t.jsx(Pt,{className:"h-4 w-4"}),g.isPending?"Creating...":"Create Backup"]})]})]}),l&&t.jsxs("div",{className:"mb-6 p-3 bg-green-500/10 border border-green-500/30 rounded-lg flex items-center gap-2",children:[t.jsx(Xt,{className:"h-4 w-4 text-green-400 flex-shrink-0"}),t.jsx("span",{className:"text-green-400 text-sm",children:l})]}),(g.error||p.error||b.error)&&t.jsxs("div",{className:"mb-6 p-3 bg-red-500/10 border border-red-500/30 rounded-lg flex items-center gap-2",children:[t.jsx(ps,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),t.jsx("span",{className:"text-red-400 text-sm",children:g.error?.message||p.error?.message||b.error?.message})]}),e&&t.jsx("div",{className:"mb-6 p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-xl",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(ps,{className:"h-5 w-5 text-yellow-400 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"text-sm font-medium text-yellow-400",children:"Restore backup?"}),t.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["This will restore the database from ",t.jsx("span",{className:"font-mono text-gray-300",children:e}),". The current database will be overwritten. The server may restart after restore."]}),t.jsxs("div",{className:"flex gap-2 mt-3",children:[t.jsxs("button",{onClick:()=>b.mutate(e),disabled:b.isPending,className:"flex items-center gap-1.5 px-3 py-1.5 bg-yellow-600 hover:bg-yellow-700 disabled:bg-yellow-800 text-white text-sm rounded-lg",children:[b.isPending?t.jsx(Ke,{className:"h-3.5 w-3.5 animate-spin"}):t.jsx(g0,{className:"h-3.5 w-3.5"}),b.isPending?"Restoring...":"Yes, Restore"]}),t.jsx("button",{onClick:()=>s(null),className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded-lg",children:"Cancel"})]})]})]})}),y.length===0?t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 bg-gray-800 rounded-xl",children:[t.jsx(gh,{className:"h-16 w-16 text-gray-600 mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No backups yet"}),t.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Create your first backup to protect your configuration"}),t.jsxs("button",{onClick:()=>g.mutate(),disabled:g.isPending,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[t.jsx(Pt,{className:"h-4 w-4"}),"Create Backup"]})]}):t.jsx("div",{className:"space-y-3",children:y.map(v=>t.jsxs("div",{className:"bg-gray-800 rounded-xl p-5 flex items-center gap-4 hover:bg-gray-750 transition-colors",children:[t.jsx("div",{className:"p-3 bg-indigo-600/20 rounded-lg flex-shrink-0",children:t.jsx(wa,{className:"h-6 w-6 text-indigo-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-white font-medium truncate",children:v.filename}),t.jsxs("div",{className:"flex items-center gap-4 mt-1 text-xs text-gray-400",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Kt,{className:"h-3 w-3"}),rU(v.createdAt),t.jsxs("span",{className:"text-gray-500",children:["(",lU(v.createdAt),")"]})]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx($a,{className:"h-3 w-3"}),iU(v.size)]}),v.version&&t.jsxs("span",{className:"text-gray-500",children:["v",v.version]})]})]}),t.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[t.jsxs("button",{onClick:()=>hU(v.filename),className:"flex items-center gap-1.5 px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-xs",title:"Download",children:[t.jsx(gs,{className:"h-3.5 w-3.5"}),"Download"]}),t.jsxs("button",{onClick:()=>s(v.filename),className:"flex items-center gap-1.5 px-3 py-1.5 bg-yellow-600/20 hover:bg-yellow-600/30 text-yellow-400 border border-yellow-500/30 rounded-lg text-xs",title:"Restore",children:[t.jsx(g0,{className:"h-3.5 w-3.5"}),"Restore"]}),n===v.filename?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>p.mutate(v.filename),disabled:p.isPending,className:"px-2 py-1.5 bg-red-600 hover:bg-red-700 text-white rounded-lg text-xs",children:p.isPending?"...":"Confirm"}),t.jsx("button",{onClick:()=>i(null),className:"px-2 py-1.5 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-xs",children:"Cancel"})]}):t.jsxs("button",{onClick:()=>i(v.filename),className:"flex items-center gap-1.5 px-3 py-1.5 bg-red-600/20 hover:bg-red-600/30 text-red-400 border border-red-500/30 rounded-lg text-xs",title:"Delete",children:[t.jsx(Dt,{className:"h-3.5 w-3.5"}),"Delete"]})]})]},v.filename))})]})}const mU="openflix_token";function ef(){return localStorage.getItem(mU)||""}function Yg(a){if(a===0)return"0 B";const e=1024,s=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(a)/Math.log(e));return`${parseFloat((a/Math.pow(e,n)).toFixed(1))} ${s[n]}`}function gU(a){return new Date(a).toLocaleString()}function pU(a){if(!a)return"--";const e=Math.floor(a/60),s=a%60;return e>0?`${e}h ${s}m`:`${s}m`}async function xU(){const a=await fetch("/dvr/v2/trash",{headers:{"X-Plex-Token":ef()}});if(!a.ok)throw new Error("Failed to fetch trash");return a.json()}async function yU(a){if(!(await fetch(`/dvr/v2/trash/${a}/restore`,{method:"POST",headers:{"X-Plex-Token":ef()}})).ok)throw new Error("Failed to restore item")}async function bU(a){if(!(await fetch(`/dvr/v2/trash/${a}`,{method:"DELETE",headers:{"X-Plex-Token":ef()}})).ok)throw new Error("Failed to delete item")}async function vU(){if(!(await fetch("/dvr/v2/trash",{method:"DELETE",headers:{"X-Plex-Token":ef()}})).ok)throw new Error("Failed to empty trash")}function _U(){const a=at(),[e,s]=k.useState(!1),[n,i]=k.useState(null),{data:l,isLoading:o,error:d,refetch:h}=Fe({queryKey:["trash"],queryFn:xU}),u=Me({mutationFn:yU,onSuccess:()=>{a.invalidateQueries({queryKey:["trash"]})}}),f=Me({mutationFn:bU,onSuccess:()=>{a.invalidateQueries({queryKey:["trash"]}),i(null)}}),g=Me({mutationFn:vU,onSuccess:()=>{a.invalidateQueries({queryKey:["trash"]}),s(!1)}}),p=l?.items||[],b=p.reduce((y,v)=>y+(v.fileSize||0),0);return o?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx(Ke,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):d?t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[t.jsx(ps,{className:"h-12 w-12 text-red-400"}),t.jsx("h3",{className:"text-lg font-medium text-white",children:"Failed to load trash"}),t.jsx("p",{className:"text-gray-400 text-sm",children:d.message}),t.jsxs("button",{onClick:()=>h(),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[t.jsx(ut,{className:"h-4 w-4"}),"Retry"]})]}):t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[t.jsx(Dt,{className:"h-7 w-7 text-red-400"}),"Trash"]}),t.jsxs("p",{className:"text-gray-400 mt-1",children:[p.length," item",p.length!==1?"s":""," in trash",b>0&&` (${Yg(b)} total)`]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("button",{onClick:()=>h(),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:[t.jsx(ut,{className:"h-4 w-4"}),"Refresh"]}),p.length>0&&t.jsxs("button",{onClick:()=>s(!0),disabled:g.isPending,className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 disabled:bg-red-800 text-white rounded-lg text-sm",children:[t.jsx(Dt,{className:"h-4 w-4"}),g.isPending?"Emptying...":"Empty Trash"]})]})]}),e&&t.jsx("div",{className:"mb-6 p-4 bg-red-500/10 border border-red-500/30 rounded-xl",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(ps,{className:"h-5 w-5 text-red-400 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"text-sm font-medium text-red-400",children:"Permanently delete all items?"}),t.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["This will permanently delete ",p.length," item",p.length!==1?"s":""," (",Yg(b),"). This action cannot be undone."]}),t.jsxs("div",{className:"flex gap-2 mt-3",children:[t.jsx("button",{onClick:()=>g.mutate(),disabled:g.isPending,className:"px-3 py-1.5 bg-red-600 hover:bg-red-700 disabled:bg-red-800 text-white text-sm rounded-lg",children:g.isPending?"Deleting...":"Yes, Delete All"}),t.jsx("button",{onClick:()=>s(!1),className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded-lg",children:"Cancel"})]})]})]})}),p.length===0?t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 bg-gray-800 rounded-xl",children:[t.jsx(Dt,{className:"h-16 w-16 text-gray-600 mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Trash is empty"}),t.jsx("p",{className:"text-gray-400 text-sm",children:"Deleted DVR recordings will appear here"})]}):t.jsx("div",{className:"bg-gray-800 rounded-xl overflow-hidden",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"text-left text-sm text-gray-400 border-b border-gray-700",children:[t.jsx("th",{className:"px-6 py-4 font-medium",children:"Title"}),t.jsx("th",{className:"px-6 py-4 font-medium",children:"Channel"}),t.jsx("th",{className:"px-6 py-4 font-medium",children:"Duration"}),t.jsx("th",{className:"px-6 py-4 font-medium",children:"Size"}),t.jsx("th",{className:"px-6 py-4 font-medium",children:"Deleted"}),t.jsx("th",{className:"px-6 py-4 font-medium text-right",children:"Actions"})]})}),t.jsx("tbody",{className:"text-sm",children:p.map(y=>t.jsxs("tr",{className:"border-b border-gray-700/50 hover:bg-gray-700/30 transition-colors",children:[t.jsx("td",{className:"px-6 py-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(wa,{className:"h-5 w-5 text-gray-500 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-white font-medium",children:y.title}),y.description&&t.jsx("p",{className:"text-gray-500 text-xs mt-0.5 line-clamp-1 max-w-xs",children:y.description})]})]})}),t.jsx("td",{className:"px-6 py-4 text-gray-300",children:y.channelName||"--"}),t.jsx("td",{className:"px-6 py-4 text-gray-300",children:pU(y.duration)}),t.jsx("td",{className:"px-6 py-4 text-gray-300",children:t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx($a,{className:"h-3.5 w-3.5 text-gray-500"}),y.fileSize?Yg(y.fileSize):"--"]})}),t.jsx("td",{className:"px-6 py-4 text-gray-400 text-xs",children:gU(y.deletedAt)}),t.jsx("td",{className:"px-6 py-4",children:t.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.jsxs("button",{onClick:()=>u.mutate(y.id),disabled:u.isPending,className:"flex items-center gap-1.5 px-3 py-1.5 bg-green-600/20 hover:bg-green-600/30 text-green-400 border border-green-500/30 rounded-lg text-xs",title:"Restore",children:[t.jsx(g0,{className:"h-3.5 w-3.5"}),"Restore"]}),n===y.id?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>f.mutate(y.id),disabled:f.isPending,className:"px-2 py-1.5 bg-red-600 hover:bg-red-700 text-white rounded-lg text-xs",children:f.isPending?"Deleting...":"Confirm"}),t.jsx("button",{onClick:()=>i(null),className:"px-2 py-1.5 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-xs",children:"Cancel"})]}):t.jsxs("button",{onClick:()=>i(y.id),className:"flex items-center gap-1.5 px-3 py-1.5 bg-red-600/20 hover:bg-red-600/30 text-red-400 border border-red-500/30 rounded-lg text-xs",title:"Delete Permanently",children:[t.jsx(Dt,{className:"h-3.5 w-3.5"}),"Delete"]})]})})]},y.id))})]})})}),u.error&&t.jsxs("div",{className:"mt-4 p-3 bg-red-500/10 border border-red-500/30 rounded-lg flex items-center gap-2",children:[t.jsx(ps,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),t.jsxs("span",{className:"text-red-400 text-sm",children:["Failed to restore: ",u.error.message]})]}),f.error&&t.jsxs("div",{className:"mt-4 p-3 bg-red-500/10 border border-red-500/30 rounded-lg flex items-center gap-2",children:[t.jsx(ps,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),t.jsxs("span",{className:"text-red-400 text-sm",children:["Failed to delete: ",f.error.message]})]}),g.error&&t.jsxs("div",{className:"mt-4 p-3 bg-red-500/10 border border-red-500/30 rounded-lg flex items-center gap-2",children:[t.jsx(ps,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),t.jsxs("span",{className:"text-red-400 text-sm",children:["Failed to empty trash: ",g.error.message]})]})]})}const NU=[{id:"recording_started",label:"Recording Started",description:"When a DVR recording begins"},{id:"recording_completed",label:"Recording Completed",description:"When a DVR recording finishes successfully"},{id:"recording_failed",label:"Recording Failed",description:"When a recording fails or is cancelled"},{id:"library_scan_complete",label:"Library Scan Complete",description:"When a library scan finishes"},{id:"update_available",label:"Update Available",description:"When a new server version is available"},{id:"stream_health_alert",label:"Stream Health Alert",description:"When a stream quality drops below threshold"}];function wU(){const a=at(),[e,s]=k.useState(!1),[n,i]=k.useState(null),[l,o]=k.useState("config"),[d,h]=k.useState({enabled:!1,discord:{enabled:!1,webhookUrl:""},slack:{enabled:!1,webhookUrl:""},email:{enabled:!1,smtpHost:"",smtpPort:587,username:"",password:"",from:"",to:"",useTLS:!0},webhooks:[],events:["recording_completed","recording_failed"]}),{data:u,isLoading:f}=Fe({queryKey:["notificationConfig"],queryFn:async()=>(await pe.client.get("/api/notifications/config")).data}),{data:g}=Fe({queryKey:["notificationHistory"],queryFn:async()=>(await pe.client.get("/api/notifications/history")).data?.history||[],enabled:l==="history"});k.useEffect(()=>{u?.config&&h(N=>({...N,...u.config}))},[u]);const p=Me({mutationFn:async N=>(await pe.client.put("/api/notifications/config",N)).data,onSuccess:()=>{a.invalidateQueries({queryKey:["notificationConfig"]}),s(!0),setTimeout(()=>s(!1),3e3)}}),b=Me({mutationFn:async N=>(await pe.client.post("/api/notifications/test",{type:N})).data,onSuccess:()=>i({success:!0,message:"Test notification sent!"}),onError:N=>i({success:!1,message:N.response?.data?.error||"Failed to send"})}),y=N=>{h(C=>({...C,events:C.events.includes(N)?C.events.filter(T=>T!==N):[...C.events,N]}))},v=()=>{h(N=>({...N,webhooks:[...N.webhooks||[],{url:"",method:"POST"}]}))},_=N=>{h(C=>({...C,webhooks:(C.webhooks||[]).filter((T,L)=>L!==N)}))};return f?t.jsx("div",{className:"text-gray-400",children:"Loading..."}):t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Notifications"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Configure webhook notifications for server events"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[n&&t.jsx("span",{className:`text-sm ${n.success?"text-green-400":"text-red-400"}`,children:n.message}),t.jsxs("button",{onClick:()=>p.mutate(d),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors",children:[t.jsx(ii,{className:"h-4 w-4"}),p.isPending?"Saving...":e?"Saved!":"Save Changes"]})]})]}),t.jsxs("div",{className:"flex gap-1 mb-6 bg-gray-800 rounded-lg p-1 w-fit",children:[t.jsxs("button",{onClick:()=>o("config"),className:`flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-colors ${l==="config"?"bg-indigo-600 text-white":"text-gray-400 hover:text-white"}`,children:[t.jsx(q1,{className:"h-4 w-4"})," Configuration"]}),t.jsxs("button",{onClick:()=>o("history"),className:`flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-colors ${l==="history"?"bg-indigo-600 text-white":"text-gray-400 hover:text-white"}`,children:[t.jsx(v4,{className:"h-4 w-4"})," History"]})]}),l==="config"?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"bg-gray-800 rounded-xl p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Enable Notifications"}),t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Send notifications when server events occur"})]}),t.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:d.enabled,onChange:N=>h(C=>({...C,enabled:N.target.checked})),className:"sr-only peer"}),t.jsx("div",{className:"w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"})]})]})}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 bg-[#5865F2] rounded-lg flex items-center justify-center text-white text-sm font-bold",children:"D"}),t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Discord"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("button",{onClick:()=>b.mutate("discord"),disabled:!d.discord?.enabled||!d.discord?.webhookUrl,className:"flex items-center gap-1 px-3 py-1.5 text-sm bg-gray-700 hover:bg-gray-600 disabled:opacity-50 text-white rounded-lg transition-colors",children:[t.jsx(dg,{className:"h-3 w-3"})," Test"]}),t.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:d.discord?.enabled||!1,onChange:N=>h(C=>({...C,discord:{...C.discord,enabled:N.target.checked}})),className:"sr-only peer"}),t.jsx("div",{className:"w-11 h-6 bg-gray-600 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Webhook URL"}),t.jsx("input",{type:"url",placeholder:"https://discord.com/api/webhooks/...",value:d.discord?.webhookUrl||"",onChange:N=>h(C=>({...C,discord:{...C.discord,webhookUrl:N.target.value}})),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 bg-[#4A154B] rounded-lg flex items-center justify-center text-white text-sm font-bold",children:"S"}),t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Slack"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("button",{onClick:()=>b.mutate("slack"),disabled:!d.slack?.enabled||!d.slack?.webhookUrl,className:"flex items-center gap-1 px-3 py-1.5 text-sm bg-gray-700 hover:bg-gray-600 disabled:opacity-50 text-white rounded-lg transition-colors",children:[t.jsx(dg,{className:"h-3 w-3"})," Test"]}),t.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:d.slack?.enabled||!1,onChange:N=>h(C=>({...C,slack:{...C.slack,enabled:N.target.checked}})),className:"sr-only peer"}),t.jsx("div",{className:"w-11 h-6 bg-gray-600 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Webhook URL"}),t.jsx("input",{type:"url",placeholder:"https://hooks.slack.com/services/...",value:d.slack?.webhookUrl||"",onChange:N=>h(C=>({...C,slack:{...C.slack,webhookUrl:N.target.value}})),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 bg-emerald-600 rounded-lg flex items-center justify-center text-white text-sm font-bold",children:"@"}),t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Email (SMTP)"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("button",{onClick:()=>b.mutate("email"),disabled:!d.email?.enabled||!d.email?.smtpHost,className:"flex items-center gap-1 px-3 py-1.5 text-sm bg-gray-700 hover:bg-gray-600 disabled:opacity-50 text-white rounded-lg transition-colors",children:[t.jsx(dg,{className:"h-3 w-3"})," Test"]}),t.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:d.email?.enabled||!1,onChange:N=>h(C=>({...C,email:{...C.email,enabled:N.target.checked}})),className:"sr-only peer"}),t.jsx("div",{className:"w-11 h-6 bg-gray-600 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"SMTP Host"}),t.jsx("input",{type:"text",placeholder:"smtp.gmail.com",value:d.email?.smtpHost||"",onChange:N=>h(C=>({...C,email:{...C.email,smtpHost:N.target.value}})),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"SMTP Port"}),t.jsx("input",{type:"number",value:d.email?.smtpPort||587,onChange:N=>h(C=>({...C,email:{...C.email,smtpPort:parseInt(N.target.value)||587}})),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Username"}),t.jsx("input",{type:"text",value:d.email?.username||"",onChange:N=>h(C=>({...C,email:{...C.email,username:N.target.value}})),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Password"}),t.jsx("input",{type:"password",value:d.email?.password||"",onChange:N=>h(C=>({...C,email:{...C.email,password:N.target.value}})),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"From Address"}),t.jsx("input",{type:"email",placeholder:"openflix@example.com",value:d.email?.from||"",onChange:N=>h(C=>({...C,email:{...C.email,from:N.target.value}})),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"To Address"}),t.jsx("input",{type:"email",placeholder:"you@example.com",value:d.email?.to||"",onChange:N=>h(C=>({...C,email:{...C.email,to:N.target.value}})),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Custom Webhooks"}),t.jsxs("button",{onClick:v,className:"flex items-center gap-1 px-3 py-1.5 text-sm bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors",children:[t.jsx(Pt,{className:"h-3 w-3"})," Add Webhook"]})]}),(d.webhooks||[]).length===0?t.jsx("p",{className:"text-gray-500 text-sm",children:"No custom webhooks configured"}):t.jsx("div",{className:"space-y-3",children:(d.webhooks||[]).map((N,C)=>t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("select",{value:N.method,onChange:T=>{const L=[...d.webhooks||[]];L[C]={...L[C],method:T.target.value},h(F=>({...F,webhooks:L}))},className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm",children:[t.jsx("option",{value:"POST",children:"POST"}),t.jsx("option",{value:"GET",children:"GET"}),t.jsx("option",{value:"PUT",children:"PUT"})]}),t.jsx("input",{type:"url",placeholder:"https://example.com/webhook",value:N.url,onChange:T=>{const L=[...d.webhooks||[]];L[C]={...L[C],url:T.target.value},h(F=>({...F,webhooks:L}))},className:"flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"}),t.jsx("button",{onClick:()=>_(C),className:"p-2 text-red-400 hover:text-red-300",children:t.jsx(Dt,{className:"h-4 w-4"})})]},C))})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Events to Monitor"}),t.jsx("div",{className:"space-y-3",children:NU.map(N=>t.jsxs("label",{className:"flex items-center justify-between p-3 bg-gray-700/50 rounded-lg cursor-pointer hover:bg-gray-700 transition-colors",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-white font-medium",children:N.label}),t.jsx("p",{className:"text-sm text-gray-400",children:N.description})]}),t.jsx("input",{type:"checkbox",checked:d.events.includes(N.id),onChange:()=>y(N.id),className:"h-5 w-5 rounded border-gray-500 text-indigo-600 focus:ring-indigo-500 bg-gray-600"})]},N.id))})]})]}):t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Notification History"}),!g||g.length===0?t.jsx("p",{className:"text-gray-500",children:"No notifications sent yet"}):t.jsx("div",{className:"space-y-2",children:g.map((N,C)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-700/50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[N.status==="sent"?t.jsx(Xt,{className:"h-5 w-5 text-green-400 flex-shrink-0"}):t.jsx(Ua,{className:"h-5 w-5 text-red-400 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("span",{className:"text-white text-sm font-medium",children:N.event}),t.jsxs("span",{className:"text-gray-400 text-sm ml-2",children:["via ",N.type]}),N.error&&t.jsx("p",{className:"text-red-400 text-xs mt-0.5",children:N.error})]})]}),t.jsx("span",{className:"text-gray-500 text-xs",children:new Date(N.timestamp).toLocaleString()})]},C))})]})]})}const o1=[{code:"en",name:"English"},{code:"es",name:"Spanish"},{code:"fr",name:"French"},{code:"de",name:"German"},{code:"it",name:"Italian"},{code:"pt",name:"Portuguese"},{code:"nl",name:"Dutch"},{code:"pl",name:"Polish"},{code:"ru",name:"Russian"},{code:"ja",name:"Japanese"},{code:"ko",name:"Korean"},{code:"zh",name:"Chinese"},{code:"ar",name:"Arabic"},{code:"hi",name:"Hindi"},{code:"sv",name:"Swedish"},{code:"da",name:"Danish"},{code:"no",name:"Norwegian"},{code:"fi",name:"Finnish"},{code:"tr",name:"Turkish"},{code:"he",name:"Hebrew"}];function SU(){const a=at(),[e,s]=k.useState("search"),[n,i]=k.useState(""),[l,o]=k.useState("en"),[d,h]=k.useState(!1),[u,f]=k.useState({apiKey:"",autoSearch:!1,preferredLanguages:["en"]}),{data:g}=Fe({queryKey:["subtitleConfig"],queryFn:async()=>(await pe.client.get("/api/subtitles/config")).data});k.useEffect(()=>{g?.config&&f(T=>({...T,...g.config}))},[g]);const p=Me({mutationFn:async({query:T,language:L})=>(await pe.client.get("/api/subtitles/search",{params:{query:T,language:L}})).data?.results||[]}),{data:b}=Fe({queryKey:["downloadedSubtitles"],queryFn:async()=>(await pe.client.get("/api/subtitles/downloaded")).data?.subtitles||[],enabled:e==="downloaded"}),y=Me({mutationFn:async T=>{await pe.client.post("/api/subtitles/download",{fileId:T.id,language:T.language})},onSuccess:()=>{a.invalidateQueries({queryKey:["downloadedSubtitles"]})}}),v=Me({mutationFn:async T=>{await pe.client.delete(`/api/subtitles/${T}`)},onSuccess:()=>{a.invalidateQueries({queryKey:["downloadedSubtitles"]})}}),_=Me({mutationFn:async T=>{await pe.client.put("/api/subtitles/config",T)},onSuccess:()=>{a.invalidateQueries({queryKey:["subtitleConfig"]}),h(!0),setTimeout(()=>h(!1),3e3)}}),N=()=>{n.trim()&&p.mutate({query:n,language:l})},C=T=>{f(L=>({...L,preferredLanguages:L.preferredLanguages.includes(T)?L.preferredLanguages.filter(F=>F!==T):[...L.preferredLanguages,T]}))};return t.jsxs("div",{children:[t.jsx("div",{className:"flex items-center justify-between mb-8",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Subtitles"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Search and manage subtitles via OpenSubtitles"})]})}),t.jsx("div",{className:"flex gap-1 mb-6 bg-gray-800 rounded-lg p-1 w-fit",children:[{id:"search",label:"Search",icon:xt},{id:"downloaded",label:"Downloaded",icon:gs},{id:"config",label:"Settings",icon:vo}].map(T=>t.jsxs("button",{onClick:()=>s(T.id),className:`flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-colors ${e===T.id?"bg-indigo-600 text-white":"text-gray-400 hover:text-white"}`,children:[t.jsx(T.icon,{className:"h-4 w-4"})," ",T.label]},T.id))}),e==="search"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Search OpenSubtitles"}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("input",{type:"text",placeholder:"Movie or TV show title...",value:n,onChange:T=>i(T.target.value),onKeyDown:T=>T.key==="Enter"&&N(),className:"flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"}),t.jsx("select",{value:l,onChange:T=>o(T.target.value),className:"px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:o1.map(T=>t.jsx("option",{value:T.code,children:T.name},T.code))}),t.jsxs("button",{onClick:N,disabled:p.isPending||!n.trim(),className:"flex items-center gap-2 px-6 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 text-white rounded-lg transition-colors",children:[t.jsx(xt,{className:"h-4 w-4"}),p.isPending?"Searching...":"Search"]})]})]}),p.data&&t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white mb-4",children:["Results (",p.data.length,")"]}),p.data.length===0?t.jsx("p",{className:"text-gray-500",children:"No subtitles found. Try a different search."}):t.jsx("div",{className:"space-y-2",children:p.data.map(T=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-700/50 rounded-lg hover:bg-gray-700 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[t.jsx(c0,{className:"h-5 w-5 text-indigo-400 flex-shrink-0"}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("p",{className:"text-white text-sm font-medium truncate",children:T.fileName}),t.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-400 mt-0.5",children:[t.jsx("span",{children:T.languageName}),t.jsx("span",{children:T.format.toUpperCase()}),t.jsxs("span",{children:[T.downloads.toLocaleString()," downloads"]}),T.hearingImpaired&&t.jsx("span",{className:"text-yellow-400",children:"HI"})]})]})]}),t.jsxs("button",{onClick:()=>y.mutate(T),disabled:y.isPending,className:"flex items-center gap-1 px-3 py-1.5 text-sm bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors flex-shrink-0",children:[t.jsx(gs,{className:"h-3 w-3"})," Download"]})]},T.id))})]})]}),e==="downloaded"&&t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Downloaded Subtitles"}),!b||b.length===0?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(c0,{className:"h-12 w-12 text-gray-600 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-500",children:"No subtitles downloaded yet"}),t.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Use the Search tab to find and download subtitles"})]}):t.jsx("div",{className:"space-y-2",children:b.map(T=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-700/50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Gt,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-white text-sm font-medium",children:T.mediaTitle}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400 mt-0.5",children:[t.jsx("span",{children:T.language}),t.jsx("span",{children:T.fileName}),t.jsx("span",{children:new Date(T.downloadedAt).toLocaleDateString()})]})]})]}),t.jsx("button",{onClick:()=>v.mutate(T.id),className:"p-2 text-red-400 hover:text-red-300 transition-colors",children:t.jsx(Dt,{className:"h-4 w-4"})})]},T.id))})]}),e==="config"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"OpenSubtitles API"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"API Key"}),t.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Get a free API key at opensubtitles.com"}),t.jsx("input",{type:"password",placeholder:"Your OpenSubtitles API key",value:u.apiKey,onChange:T=>f(L=>({...L,apiKey:T.target.value})),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-white font-medium",children:"Auto-search subtitles"}),t.jsx("p",{className:"text-sm text-gray-400",children:"Automatically search for subtitles when new media is added"})]}),t.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:u.autoSearch,onChange:T=>f(L=>({...L,autoSearch:T.target.checked})),className:"sr-only peer"}),t.jsx("div",{className:"w-11 h-6 bg-gray-600 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"})]})]})]})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Preferred Languages"}),t.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Select languages to prioritize when auto-searching"}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2",children:o1.map(T=>t.jsxs("label",{className:`flex items-center gap-2 p-2.5 rounded-lg cursor-pointer transition-colors ${u.preferredLanguages.includes(T.code)?"bg-indigo-600/20 border border-indigo-500":"bg-gray-700/50 border border-transparent hover:bg-gray-700"}`,children:[t.jsx("input",{type:"checkbox",checked:u.preferredLanguages.includes(T.code),onChange:()=>C(T.code),className:"sr-only"}),t.jsx("span",{className:`text-sm ${u.preferredLanguages.includes(T.code)?"text-indigo-300 font-medium":"text-gray-300"}`,children:T.name})]},T.code))})]}),t.jsx("div",{className:"flex justify-end",children:t.jsxs("button",{onClick:()=>_.mutate(u),className:"flex items-center gap-2 px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors",children:[t.jsx(ii,{className:"h-4 w-4"}),_.isPending?"Saving...":d?"Saved!":"Save Settings"]})})]})]})}function jU(){const a=at(),[e,s]=k.useState(null),[n,i]=k.useState(""),[l,o]=k.useState("tasks"),{data:d,isLoading:h}=Fe({queryKey:["schedulerTasks"],queryFn:async()=>(await pe.client.get("/api/scheduler/tasks")).data?.tasks||[],refetchInterval:5e3}),{data:u}=Fe({queryKey:["schedulerHistory"],queryFn:async()=>(await pe.client.get("/api/scheduler/history",{params:{limit:50}})).data?.history||[],enabled:l==="history",refetchInterval:1e4}),f=Me({mutationFn:async v=>{await pe.client.post(`/api/scheduler/tasks/${v}/run`)},onSuccess:()=>{a.invalidateQueries({queryKey:["schedulerTasks"]})}}),g=Me({mutationFn:async({id:v,..._})=>{await pe.client.put(`/api/scheduler/tasks/${v}`,_)},onSuccess:()=>{a.invalidateQueries({queryKey:["schedulerTasks"]}),s(null)}}),p=v=>v<1e3?`${v}ms`:v<6e4?`${(v/1e3).toFixed(1)}s`:`${(v/6e4).toFixed(1)}m`,b=v=>{if(!v)return"N/A";const _=new Date(v),N=new Date,C=_.getTime()-N.getTime();return C<0?"overdue":C<6e4?"in < 1m":C<36e5?`in ${Math.round(C/6e4)}m`:C<864e5?`in ${Math.round(C/36e5)}h`:_.toLocaleDateString()},y=v=>v.running?t.jsxs("span",{className:"flex items-center gap-1 text-xs px-2 py-0.5 bg-blue-500/20 text-blue-400 rounded-full",children:[t.jsx(ut,{className:"h-3 w-3 animate-spin"}),"Running"]}):v.enabled?v.lastError?t.jsxs("span",{className:"flex items-center gap-1 text-xs px-2 py-0.5 bg-red-500/20 text-red-400 rounded-full",children:[t.jsx(Ua,{className:"h-3 w-3"}),"Error"]}):t.jsxs("span",{className:"flex items-center gap-1 text-xs px-2 py-0.5 bg-green-500/20 text-green-400 rounded-full",children:[t.jsx(Xt,{className:"h-3 w-3"}),"OK"]}):t.jsxs("span",{className:"flex items-center gap-1 text-xs px-2 py-0.5 bg-gray-500/20 text-gray-400 rounded-full",children:[t.jsx(Bi,{className:"h-3 w-3"}),"Disabled"]});return h?t.jsx("div",{className:"text-gray-400",children:"Loading..."}):t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Scheduled Tasks"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Manage background tasks and view execution history"})]}),t.jsxs("button",{onClick:()=>a.invalidateQueries({queryKey:["schedulerTasks"]}),className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors",children:[t.jsx(ut,{className:"h-4 w-4"})," Refresh"]})]}),t.jsxs("div",{className:"flex gap-1 mb-6 bg-gray-800 rounded-lg p-1 w-fit",children:[t.jsxs("button",{onClick:()=>o("tasks"),className:`flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-colors ${l==="tasks"?"bg-indigo-600 text-white":"text-gray-400 hover:text-white"}`,children:[t.jsx(Kt,{className:"h-4 w-4"})," Tasks"]}),t.jsxs("button",{onClick:()=>o("history"),className:`flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-colors ${l==="history"?"bg-indigo-600 text-white":"text-gray-400 hover:text-white"}`,children:[t.jsx(Xt,{className:"h-4 w-4"})," History"]})]}),l==="tasks"?t.jsx("div",{className:"space-y-3",children:!d||d.length===0?t.jsxs("div",{className:"bg-gray-800 rounded-xl p-12 text-center",children:[t.jsx(Kt,{className:"h-12 w-12 text-gray-600 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-500",children:"No scheduled tasks configured"})]}):d.map(v=>t.jsx("div",{className:"bg-gray-800 rounded-xl p-5",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[t.jsx("h3",{className:"text-white font-semibold",children:v.name}),y(v)]}),t.jsx("p",{className:"text-gray-400 text-sm",children:v.description}),t.jsxs("div",{className:"flex items-center gap-4 mt-3 text-xs text-gray-500",children:[t.jsx("span",{className:"font-mono bg-gray-700/50 px-2 py-0.5 rounded",children:v.schedule}),t.jsxs("span",{children:["Next: ",b(v.nextRun)]}),v.lastRun&&t.jsxs("span",{children:["Last: ",new Date(v.lastRun).toLocaleString()]}),v.lastDuration!==void 0&&v.lastDuration>0&&t.jsxs("span",{children:["Duration: ",p(v.lastDuration)]}),t.jsxs("span",{children:["Runs: ",v.runCount," (",v.failCount," failed)"]})]}),v.lastError&&t.jsxs("div",{className:"mt-2 flex items-start gap-2 text-xs text-red-400 bg-red-500/10 rounded p-2",children:[t.jsx(ps,{className:"h-3 w-3 flex-shrink-0 mt-0.5"}),t.jsx("span",{children:v.lastError})]}),e===v.id&&t.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[t.jsx("input",{type:"text",value:n,onChange:_=>i(_.target.value),placeholder:"*/5 * * * * (cron)",className:"px-3 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm font-mono focus:outline-none focus:ring-2 focus:ring-indigo-500"}),t.jsx("button",{onClick:()=>g.mutate({id:v.id,schedule:n}),className:"px-3 py-1.5 text-sm bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:"Save"}),t.jsx("button",{onClick:()=>s(null),className:"px-3 py-1.5 text-sm bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"})]})]}),t.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[t.jsx("button",{onClick:()=>{i(v.schedule),s(e===v.id?null:v.id)},className:"p-2 text-gray-400 hover:text-white transition-colors",title:"Edit schedule",children:t.jsx(si,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>g.mutate({id:v.id,enabled:!v.enabled}),className:`p-2 transition-colors ${v.enabled?"text-green-400 hover:text-green-300":"text-gray-500 hover:text-gray-400"}`,title:v.enabled?"Disable":"Enable",children:v.enabled?t.jsx(Xt,{className:"h-4 w-4"}):t.jsx(Bi,{className:"h-4 w-4"})}),t.jsxs("button",{onClick:()=>f.mutate(v.id),disabled:v.running,className:"flex items-center gap-1 px-3 py-1.5 text-sm bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 text-white rounded-lg transition-colors",children:[t.jsx(xs,{className:"h-3 w-3"})," Run Now"]})]})]})},v.id))}):t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Execution History"}),!u||u.length===0?t.jsx("p",{className:"text-gray-500",children:"No task executions yet"}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"text-left text-xs text-gray-500 uppercase tracking-wider",children:[t.jsx("th",{className:"pb-3 pr-4",children:"Status"}),t.jsx("th",{className:"pb-3 pr-4",children:"Task"}),t.jsx("th",{className:"pb-3 pr-4",children:"Started"}),t.jsx("th",{className:"pb-3 pr-4",children:"Duration"}),t.jsx("th",{className:"pb-3",children:"Error"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-700/50",children:u.map((v,_)=>t.jsxs("tr",{className:"text-sm",children:[t.jsx("td",{className:"py-3 pr-4",children:v.success?t.jsx(Xt,{className:"h-4 w-4 text-green-400"}):t.jsx(Ua,{className:"h-4 w-4 text-red-400"})}),t.jsx("td",{className:"py-3 pr-4 text-white font-medium",children:v.taskName}),t.jsx("td",{className:"py-3 pr-4 text-gray-400",children:new Date(v.startTime).toLocaleString()}),t.jsx("td",{className:"py-3 pr-4 text-gray-400",children:p(v.duration)}),t.jsx("td",{className:"py-3 text-red-400 text-xs max-w-xs truncate",children:v.error||"-"})]},_))})]})})]})]})}const c1={apple_tv:"Apple TV",android_tv:"Android TV",fire_tv:"Fire TV",ios:"iOS",android:"Android",web:"Web"},EU=["","G","PG","PG-13","R","NC-17"],TU=["original","high","medium","low"],AU=["home","livetv","dvr","kids","sports"],CU=["dark","light","auto"],Wg=[{id:"home",label:"Home"},{id:"livetv",label:"Live TV"},{id:"dvr",label:"DVR"},{id:"movies",label:"Movies"},{id:"shows",label:"TV Shows"},{id:"kids",label:"Kids"},{id:"sports",label:"Sports"},{id:"search",label:"Search"}],Qg=[{category:"General",settings:[{key:"startup_section",label:"Default Startup Section",options:["home","livetv","dvr","movies","shows"]},{key:"theme",label:"Theme",options:["dark","light","auto"]}]},{category:"Library",settings:[{key:"library_display",label:"Library Display Mode",options:["grid","list","poster"]},{key:"show_unaired",label:"Show Unaired Episodes",options:["true","false"]}]},{category:"Playback",settings:[{key:"playback_quality",label:"Default Quality",options:["original","high","medium","low"]},{key:"playback_buffer",label:"Buffer Size",options:["small","medium","large"]},{key:"tuner_sharing",label:"Tuner Sharing",options:["true","false"]}]},{category:"Downloads",settings:[{key:"downloads_enabled",label:"Allow Downloads",options:["true","false"]},{key:"downloads_quality",label:"Download Quality",options:["original","high","medium","low"]}]}];function kU(a){switch(a){case"apple_tv":case"android_tv":case"fire_tv":return jt;case"ios":case"android":return ei;case"web":return vo;default:return wr}}function RU(a){switch(a){case"apple_tv":return"bg-gray-600 text-gray-200";case"android_tv":return"bg-green-600/20 text-green-400";case"fire_tv":return"bg-orange-600/20 text-orange-400";case"ios":return"bg-blue-600/20 text-blue-400";case"android":return"bg-green-600/20 text-green-400";case"web":return"bg-purple-600/20 text-purple-400";default:return"bg-gray-600/20 text-gray-400"}}function LU(a){const e=new Date(a),n=new Date().getTime()-e.getTime();return n<6e4?"Just now":n<36e5?`${Math.round(n/6e4)}m ago`:n<864e5?`${Math.round(n/36e5)}h ago`:n<6048e5?`${Math.round(n/864e5)}d ago`:e.toLocaleDateString()}function DU(a){return new Date().getTime()-new Date(a).getTime()<3e5}function MU(){const a=at(),[e,s]=k.useState(""),[n,i]=k.useState(null),{data:l={}}=Fe({queryKey:["globalClientSettings"],queryFn:()=>pe.getGlobalClientSettings()}),o=Me({mutationFn:({key:f,value:g})=>pe.updateGlobalClientSetting(f,g),onSuccess:()=>{a.invalidateQueries({queryKey:["globalClientSettings"]})}}),d=Me({mutationFn:f=>pe.deleteGlobalClientSetting(f),onSuccess:()=>{a.invalidateQueries({queryKey:["globalClientSettings"]})}}),h=Object.entries(l),u=Qg.filter(f=>n&&f.category!==n?!1:e?f.category.toLowerCase().includes(e.toLowerCase())||f.settings.some(g=>g.label.toLowerCase().includes(e.toLowerCase())):!0);return t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[t.jsx(si,{className:"h-5 w-5 text-indigo-400"}),"Global Client Settings"]}),t.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Override default settings for all connected client devices. Per-device settings take priority."}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-300 mb-3",children:"Choose a Setting to Override"}),t.jsxs("div",{className:"relative mb-3",children:[t.jsx(xt,{className:"h-4 w-4 text-gray-500 absolute left-3 top-1/2 -translate-y-1/2"}),t.jsx("input",{type:"text",value:e,onChange:f=>s(f.target.value),className:"w-full pl-9 pr-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Search settings..."})]}),t.jsxs("div",{className:"flex gap-2 mb-3 flex-wrap",children:[t.jsx("button",{onClick:()=>i(null),className:`px-2.5 py-1 text-xs rounded-full transition-colors ${n===null?"bg-indigo-600 text-white":"bg-gray-700 text-gray-400 hover:text-white"}`,children:"All"}),Qg.map(f=>t.jsx("button",{onClick:()=>i(f.category===n?null:f.category),className:`px-2.5 py-1 text-xs rounded-full transition-colors ${n===f.category?"bg-indigo-600 text-white":"bg-gray-700 text-gray-400 hover:text-white"}`,children:f.category},f.category))]}),t.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:u.map(f=>f.settings.filter(g=>!e||g.label.toLowerCase().includes(e.toLowerCase())).map(g=>{const p=g.key in l;return t.jsxs("div",{className:"flex items-center justify-between p-2.5 bg-gray-900 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-300",children:g.label}),t.jsx("p",{className:"text-xs text-gray-500",children:f.category})]}),p?t.jsx("select",{value:l[g.key]||"",onChange:b=>o.mutate({key:g.key,value:b.target.value}),className:"px-2 py-1 bg-gray-700 border border-gray-600 rounded text-white text-xs",children:g.options.map(b=>t.jsx("option",{value:b,children:b},b))}):t.jsxs("button",{onClick:()=>o.mutate({key:g.key,value:g.options[0]}),className:"flex items-center gap-1 px-2 py-1 text-xs text-indigo-400 hover:text-indigo-300 hover:bg-indigo-500/10 rounded transition-colors",children:[t.jsx(Pt,{className:"h-3 w-3"})," Add"]})]},g.key)}))})]}),t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-medium text-gray-300 mb-3",children:["Active Overrides (",h.length,")"]}),h.length===0?t.jsxs("div",{className:"p-8 bg-gray-900 rounded-lg text-center",children:[t.jsx(si,{className:"h-8 w-8 text-gray-600 mx-auto mb-2"}),t.jsx("p",{className:"text-gray-500 text-sm",children:"No global overrides set"}),t.jsx("p",{className:"text-gray-600 text-xs mt-1",children:"Add settings from the left panel to override defaults for all clients"})]}):t.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:h.map(([f,g])=>{let p=f,b="";for(const y of Qg){const v=y.settings.find(_=>_.key===f);if(v){p=v.label,b=y.category;break}}return t.jsxs("div",{className:"flex items-center justify-between p-2.5 bg-gray-900 border border-gray-700 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-white",children:p}),t.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[b&&t.jsx("span",{className:"text-xs text-gray-500",children:b}),t.jsx("span",{className:"text-xs text-indigo-400 font-mono",children:g})]})]}),t.jsx("button",{onClick:()=>d.mutate(f),disabled:d.isPending,className:"p-1 text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded transition-colors",title:"Remove override",children:t.jsx(nt,{className:"h-4 w-4"})})]},f)})})]})]})]})}function IU(){const a=at(),[e,s]=k.useState(null),[n,i]=k.useState({}),[l,o]=k.useState(null),[d,h]=k.useState("devices"),{data:u,isLoading:f}=Fe({queryKey:["devices"],queryFn:async()=>(await pe.client.get("/api/devices")).data?.devices||[],refetchInterval:1e4}),g=Me({mutationFn:async({id:_,sidebarList:N,...C})=>{const T={...C};return N&&(T.sidebarSections=N.join(",")),(await pe.client.put(`/api/devices/${_}`,T)).data},onSuccess:_=>{a.invalidateQueries({queryKey:["devices"]}),s(_),i({})}}),p=Me({mutationFn:async _=>{await pe.client.delete(`/api/devices/${_}`)},onSuccess:()=>{a.invalidateQueries({queryKey:["devices"]}),s(null),o(null)}}),b=_=>{s(_),i({displayName:_.displayName,kioskMode:_.kioskMode,kidsOnlyMode:_.kidsOnlyMode,maxRating:_.maxRating,defaultQuality:_.defaultQuality,maxBitrate:_.maxBitrate,startupSection:_.startupSection,theme:_.theme,enableDVR:_.enableDVR,enableLiveTV:_.enableLiveTV,enableDownloads:_.enableDownloads,channelCollectionId:_.channelCollectionId,sidebarList:_.sidebarSections?_.sidebarSections.split(",").filter(Boolean):Wg.map(N=>N.id)})},y=()=>{e&&g.mutate({id:e.id,...n})},v=_=>{const N=n.sidebarList||Wg.map(C=>C.id);N.includes(_)?i({...n,sidebarList:N.filter(C=>C!==_)}):i({...n,sidebarList:[...N,_]})};return f?t.jsx("div",{className:"text-gray-400",children:"Loading devices..."}):t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Device Manager"}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Manage client devices, per-device settings, and global client overrides"})]}),t.jsxs("button",{onClick:()=>a.invalidateQueries({queryKey:["devices"]}),className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors",children:[t.jsx(ut,{className:"h-4 w-4"})," Refresh"]})]}),t.jsxs("div",{className:"flex gap-1 mb-6 bg-gray-800 rounded-lg p-1 w-fit",children:[t.jsx("button",{onClick:()=>h("devices"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${d==="devices"?"bg-indigo-600 text-white":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:"Client Devices"}),t.jsx("button",{onClick:()=>h("global-settings"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${d==="global-settings"?"bg-indigo-600 text-white":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:"Global Client Settings"})]}),d==="global-settings"?t.jsx(MU,{}):t.jsxs("div",{className:"flex gap-6",children:[t.jsx("div",{className:`${e?"w-1/2":"w-full"} space-y-3 transition-all`,children:!u||u.length===0?t.jsxs("div",{className:"bg-gray-800 rounded-xl p-12 text-center",children:[t.jsx(ei,{className:"h-12 w-12 text-gray-600 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-400 font-medium",children:"No devices registered yet"}),t.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Devices appear here when a client app connects and registers with the server."})]}):u.map(_=>{const N=kU(_.platform),C=DU(_.lastSeen),T=e?.id===_.id;return t.jsx("button",{onClick:()=>b(_),className:`w-full text-left bg-gray-800 rounded-xl p-4 hover:bg-gray-750 transition-colors border-2 ${T?"border-indigo-500":"border-transparent"}`,children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:`p-3 rounded-lg ${C?"bg-green-500/10":"bg-gray-700"}`,children:t.jsx(N,{className:`h-6 w-6 ${C?"text-green-400":"text-gray-500"}`})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h3",{className:"text-white font-semibold truncate",children:_.displayName||"Unnamed Device"}),_.kioskMode&&t.jsxs("span",{className:"flex items-center gap-1 text-xs px-1.5 py-0.5 bg-yellow-500/20 text-yellow-400 rounded-full",children:[t.jsx(fo,{className:"h-3 w-3"}),"Kiosk"]}),_.kidsOnlyMode&&t.jsxs("span",{className:"flex items-center gap-1 text-xs px-1.5 py-0.5 bg-pink-500/20 text-pink-400 rounded-full",children:[t.jsx(Gc,{className:"h-3 w-3"}),"Kids"]})]}),t.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-gray-500",children:[t.jsx("span",{className:`px-1.5 py-0.5 rounded ${RU(_.platform)}`,children:c1[_.platform]||_.platform||"Unknown"}),_.deviceModel&&t.jsx("span",{className:"text-gray-400",children:_.deviceModel}),_.osVersion&&t.jsx("span",{children:_.osVersion})]}),t.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-gray-500",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[_.connectionType==="remote"?t.jsx(vo,{className:"h-3 w-3 text-blue-400"}):t.jsx(No,{className:"h-3 w-3 text-green-400"}),_.connectionType==="remote"?"Remote":"Local"]}),t.jsx("span",{children:_.ipAddress}),t.jsx("span",{children:LU(_.lastSeen)}),_.appVersion&&t.jsxs("span",{children:["v",_.appVersion]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:`h-2.5 w-2.5 rounded-full ${C?"bg-green-400":"bg-gray-600"}`}),t.jsx(Ba,{className:"h-4 w-4 text-gray-600"})]})]})},_.id)})}),e&&t.jsxs("div",{className:"w-1/2 bg-gray-800 rounded-xl p-6 h-fit sticky top-6 max-h-[calc(100vh-120px)] overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Device Settings"}),t.jsx("button",{onClick:()=>{s(null),i({})},className:"p-1 text-gray-400 hover:text-white transition-colors",children:t.jsx(nt,{className:"h-5 w-5"})})]}),t.jsxs("div",{className:"space-y-5",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Display Name"}),t.jsx("input",{type:"text",value:n.displayName||"",onChange:_=>i({...n,displayName:_.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"e.g., Living Room Apple TV"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Device ID"}),t.jsx("p",{className:"text-gray-300 font-mono text-xs truncate",children:e.deviceId})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Platform"}),t.jsx("p",{className:"text-gray-300",children:c1[e.platform]||e.platform})]}),e.deviceModel&&t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Device Model"}),t.jsx("p",{className:"text-gray-300",children:e.deviceModel})]}),e.osVersion&&t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"OS Version"}),t.jsx("p",{className:"text-gray-300",children:e.osVersion})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"IP Address"}),t.jsx("p",{className:"text-gray-300",children:e.ipAddress})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Connection"}),t.jsx("p",{className:"text-gray-300 flex items-center gap-1",children:e.connectionType==="remote"?t.jsxs(t.Fragment,{children:[t.jsx(vo,{className:"h-3 w-3 text-blue-400"})," Remote"]}):t.jsxs(t.Fragment,{children:[t.jsx(No,{className:"h-3 w-3 text-green-400"})," Local"]})})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Last Seen"}),t.jsx("p",{className:"text-gray-300",children:new Date(e.lastSeen).toLocaleString()})]}),e.appVersion&&t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"App Version"}),t.jsxs("p",{className:"text-gray-300",children:["v",e.appVersion]})]})]}),t.jsx("hr",{className:"border-gray-700"}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-yellow-500/10 rounded-lg",children:t.jsx(fo,{className:"h-4 w-4 text-yellow-400"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-white text-sm font-medium",children:"Kiosk Mode"}),t.jsx("p",{className:"text-gray-500 text-xs",children:"Hides settings and admin features on this device"})]})]}),t.jsx("button",{onClick:()=>i({...n,kioskMode:!n.kioskMode}),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${n.kioskMode?"bg-yellow-500":"bg-gray-600"}`,children:t.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${n.kioskMode?"translate-x-6":"translate-x-1"}`})})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-pink-500/10 rounded-lg",children:t.jsx(Gc,{className:"h-4 w-4 text-pink-400"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-white text-sm font-medium",children:"Kids Only Mode"}),t.jsx("p",{className:"text-gray-500 text-xs",children:"Restricts content to kids-rated only (full UI lockdown)"})]})]}),t.jsx("button",{onClick:()=>i({...n,kidsOnlyMode:!n.kidsOnlyMode}),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${n.kidsOnlyMode?"bg-pink-500":"bg-gray-600"}`,children:t.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${n.kidsOnlyMode?"translate-x-6":"translate-x-1"}`})})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-300 mb-1",children:[t.jsx(ew,{className:"h-4 w-4 text-indigo-400"}),"Max Content Rating"]}),t.jsxs("select",{value:n.maxRating||"",onChange:_=>i({...n,maxRating:_.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[t.jsx("option",{value:"",children:"No Limit"}),EU.filter(_=>_!=="").map(_=>t.jsx("option",{value:_,children:_},_))]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Overrides user profile rating. Leave empty for no restriction."})]}),t.jsx("hr",{className:"border-gray-700"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Default Quality"}),t.jsx("select",{value:n.defaultQuality||"original",onChange:_=>i({...n,defaultQuality:_.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",children:TU.map(_=>t.jsx("option",{value:_,children:_.charAt(0).toUpperCase()+_.slice(1)},_))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Startup Section"}),t.jsx("select",{value:n.startupSection||"home",onChange:_=>i({...n,startupSection:_.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",children:AU.map(_=>t.jsx("option",{value:_,children:_.charAt(0).toUpperCase()+_.slice(1)},_))})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Theme"}),t.jsx("select",{value:n.theme||"dark",onChange:_=>i({...n,theme:_.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",children:CU.map(_=>t.jsx("option",{value:_,children:_.charAt(0).toUpperCase()+_.slice(1)},_))})]}),t.jsx("hr",{className:"border-gray-700"}),t.jsxs("div",{children:[t.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-300 mb-1",children:[t.jsx(Fi,{className:"h-4 w-4 text-purple-400"}),"Channel Collection"]}),t.jsx("select",{value:n.channelCollectionId??0,onChange:_=>i({...n,channelCollectionId:Number(_.target.value)}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",children:t.jsx("option",{value:0,children:"All Channels"})}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Restrict this device to a specific channel collection. Create collections in the Channel Collections page."})]}),t.jsx("hr",{className:"border-gray-700"}),t.jsxs("div",{children:[t.jsxs("h4",{className:"text-sm font-medium text-gray-300 mb-3 flex items-center gap-2",children:[t.jsx(dk,{className:"h-4 w-4 text-teal-400"}),"Sidebar Navigation"]}),t.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Choose which sections appear in the sidebar on this device"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:Wg.map(_=>{const N=(n.sidebarList||[]).includes(_.id);return t.jsxs("button",{onClick:()=>v(_.id),className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${N?"bg-indigo-600/20 text-indigo-400 border border-indigo-500/30":"bg-gray-900 text-gray-500 border border-gray-700 hover:border-gray-600"}`,children:[N?t.jsx(Pi,{className:"h-3.5 w-3.5"}):t.jsx(fo,{className:"h-3.5 w-3.5"}),_.label]},_.id)})})]}),t.jsx("hr",{className:"border-gray-700"}),t.jsxs("div",{children:[t.jsxs("h4",{className:"text-sm font-medium text-gray-300 mb-3 flex items-center gap-2",children:[t.jsx(Pi,{className:"h-4 w-4 text-indigo-400"}),"Feature Toggles"]}),t.jsx("div",{className:"space-y-3",children:[{key:"enableDVR",label:"DVR Recording",desc:"Allow DVR recording features"},{key:"enableLiveTV",label:"Live TV",desc:"Allow live TV streaming"},{key:"enableDownloads",label:"Downloads",desc:"Allow content downloads"}].map(({key:_,label:N,desc:C})=>t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-white text-sm",children:N}),t.jsx("p",{className:"text-gray-500 text-xs",children:C})]}),t.jsx("button",{onClick:()=>i({...n,[_]:!n[_]}),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${n[_]?"bg-indigo-500":"bg-gray-600"}`,children:t.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${n[_]?"translate-x-6":"translate-x-1"}`})})]},_))})]}),t.jsx("hr",{className:"border-gray-700"}),t.jsxs("div",{className:"flex items-center justify-between pt-2",children:[t.jsxs("button",{onClick:()=>o(e.id),className:"flex items-center gap-2 px-3 py-2 text-sm text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-lg transition-colors",children:[t.jsx(Dt,{className:"h-4 w-4"})," Delete Device"]}),t.jsxs("button",{onClick:y,disabled:g.isPending,className:"flex items-center gap-2 px-4 py-2 text-sm bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 text-white rounded-lg transition-colors",children:[t.jsx(ii,{className:"h-4 w-4"}),g.isPending?"Saving...":"Save Changes"]})]})]}),l!==null&&t.jsxs("div",{className:"mt-4 p-4 bg-red-500/10 border border-red-500/30 rounded-lg",children:[t.jsx("p",{className:"text-red-400 text-sm mb-3",children:"Are you sure you want to remove this device? The device can re-register on its next connection."}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{onClick:()=>o(null),className:"px-3 py-1.5 text-sm bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),t.jsx("button",{onClick:()=>p.mutate(l),disabled:p.isPending,className:"px-3 py-1.5 text-sm bg-red-600 hover:bg-red-700 disabled:opacity-50 text-white rounded-lg",children:p.isPending?"Deleting...":"Delete"})]})]})]})]})]})}const PU="openflix_token";function tf(){return localStorage.getItem(PU)||""}function d1(a){if(a===0)return"0 B";const e=1024,s=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(a)/Math.log(e));return`${parseFloat((a/Math.pow(e,n)).toFixed(1))} ${s[n]}`}function OU(a){return new Date(a).toLocaleString()}function FU(a){const e=new Date(a),s=new Date,n=e.getTime()-s.getTime(),i=Math.ceil(n/(1e3*60*60*24));return i<0?"Expired":i===0?"Today":i===1?"Tomorrow":`${i} days`}function BU(a){switch(a){case"pending":return t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-yellow-500/20 text-yellow-400 border border-yellow-500/30",children:[t.jsx(Kt,{className:"h-3 w-3"}),"Pending"]});case"downloading":return t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-blue-500/20 text-blue-400 border border-blue-500/30",children:[t.jsx(Mc,{className:"h-3 w-3"}),"Downloading"]});case"completed":return t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-green-500/20 text-green-400 border border-green-500/30",children:[t.jsx(vn,{className:"h-3 w-3"}),"Completed"]});case"expired":return t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-gray-500/20 text-gray-400 border border-gray-500/30",children:[t.jsx(Ua,{className:"h-3 w-3"}),"Expired"]});case"deleted":return t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-red-500/20 text-red-400 border border-red-500/30",children:[t.jsx(Dt,{className:"h-3 w-3"}),"Deleted"]});default:return t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-gray-500/20 text-gray-400 border border-gray-500/30",children:[t.jsx(AC,{className:"h-3 w-3"}),a]})}}function UU(a){const e={original:"bg-purple-500/20 text-purple-400 border-purple-500/30",high:"bg-blue-500/20 text-blue-400 border-blue-500/30",medium:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",low:"bg-gray-500/20 text-gray-400 border-gray-500/30"},s=e[a]||e.low;return t.jsx("span",{className:`inline-flex px-2 py-0.5 rounded-full text-xs font-medium border ${s}`,children:a})}async function $U(){const a=await fetch("/api/offline/downloads",{headers:{"X-Plex-Token":tf()}});if(!a.ok)throw new Error("Failed to fetch offline downloads");return a.json()}async function GU(){const a=await fetch("/api/offline/settings",{headers:{"X-Plex-Token":tf()}});if(!a.ok)throw new Error("Failed to fetch settings");return a.json()}async function VU(a){if(!(await fetch(`/api/offline/${a}`,{method:"DELETE",headers:{"X-Plex-Token":tf()}})).ok)throw new Error("Failed to delete download")}async function qU(a){const e=await fetch("/api/offline/settings",{method:"PUT",headers:{"Content-Type":"application/json","X-Plex-Token":tf()},body:JSON.stringify(a)});if(!e.ok)throw new Error("Failed to update settings");return e.json()}function KU(){const a=at(),[e,s]=k.useState("all"),[n,i]=k.useState(null),[l,o]=k.useState(!1),[d,h]=k.useState(25),[u,f]=k.useState(30),{data:g,isLoading:p,error:b,refetch:y}=Fe({queryKey:["offline-downloads"],queryFn:$U}),{data:v}=Fe({queryKey:["offline-settings"],queryFn:GU});k.useEffect(()=>{v&&(h(v.maxDownloads),f(v.expiryDays))},[v]);const _=Me({mutationFn:VU,onSuccess:()=>{a.invalidateQueries({queryKey:["offline-downloads"]}),i(null)}}),N=Me({mutationFn:qU,onSuccess:()=>{a.invalidateQueries({queryKey:["offline-settings"]})}}),C=g?.downloads||[],T=e==="all"?C:C.filter(H=>H.status===e),L=g?.totalSize||0,F=g?.activeCount||0;return p?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx(Ke,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):b?t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[t.jsx(ps,{className:"h-12 w-12 text-red-400"}),t.jsx("h3",{className:"text-lg font-medium text-white",children:"Failed to load offline downloads"}),t.jsx("p",{className:"text-gray-400 text-sm",children:b.message}),t.jsxs("button",{onClick:()=>y(),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[t.jsx(ut,{className:"h-4 w-4"}),"Retry"]})]}):t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[t.jsx(Mc,{className:"h-7 w-7 text-indigo-400"}),"Offline Downloads"]}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Manage media downloaded to client devices for offline viewing"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("button",{onClick:()=>o(!l),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:[t.jsx(si,{className:"h-4 w-4"}),"Settings"]}),t.jsxs("button",{onClick:()=>y(),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:[t.jsx(ut,{className:"h-4 w-4"}),"Refresh"]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[t.jsxs("div",{className:"bg-gray-800 rounded-xl p-5 border border-gray-700",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-2 bg-indigo-500/20 rounded-lg",children:t.jsx(Mc,{className:"h-5 w-5 text-indigo-400"})}),t.jsx("span",{className:"text-sm text-gray-400",children:"Total Downloads"})]}),t.jsx("p",{className:"text-2xl font-bold text-white",children:C.length})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-5 border border-gray-700",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-2 bg-green-500/20 rounded-lg",children:t.jsx($a,{className:"h-5 w-5 text-green-400"})}),t.jsx("span",{className:"text-sm text-gray-400",children:"Total Storage Used"})]}),t.jsx("p",{className:"text-2xl font-bold text-white",children:d1(L)})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-5 border border-gray-700",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-2 bg-blue-500/20 rounded-lg",children:t.jsx(ei,{className:"h-5 w-5 text-blue-400"})}),t.jsx("span",{className:"text-sm text-gray-400",children:"Active Downloads"})]}),t.jsx("p",{className:"text-2xl font-bold text-white",children:F})]})]}),l&&v&&t.jsxs("div",{className:"mb-6 bg-gray-800 rounded-xl p-6 border border-gray-700",children:[t.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[t.jsx(si,{className:"h-5 w-5 text-gray-400"}),"Offline Download Settings"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Max Downloads per Device"}),t.jsx("input",{type:"number",min:1,value:d,onChange:H=>h(parseInt(H.target.value)||1),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Expiry (days)"}),t.jsx("input",{type:"number",min:1,value:u,onChange:H=>f(parseInt(H.target.value)||1),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Allowed Qualities"}),t.jsx("p",{className:"text-sm text-gray-300",children:v.allowedQualities?.join(", ")||"original, high, medium, low"})]})]}),t.jsx("div",{className:"mt-4 flex justify-end",children:t.jsxs("button",{onClick:()=>N.mutate({maxDownloads:d,expiryDays:u}),disabled:N.isPending,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg text-sm",children:[t.jsx(ii,{className:"h-4 w-4"}),N.isPending?"Saving...":"Save Settings"]})}),N.error&&t.jsx("div",{className:"mt-3 p-2 bg-red-500/10 border border-red-500/30 rounded-lg",children:t.jsx("span",{className:"text-red-400 text-sm",children:N.error.message})})]}),t.jsx("div",{className:"flex items-center gap-2 mb-4",children:["all","pending","downloading","completed","expired"].map(H=>t.jsx("button",{onClick:()=>s(H),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${e===H?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:H.charAt(0).toUpperCase()+H.slice(1)},H))}),T.length===0?t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 bg-gray-800 rounded-xl",children:[t.jsx(Mc,{className:"h-16 w-16 text-gray-600 mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No offline downloads"}),t.jsx("p",{className:"text-gray-400 text-sm",children:e==="all"?"No media has been downloaded for offline viewing yet":`No downloads with status "${e}"`})]}):t.jsx("div",{className:"bg-gray-800 rounded-xl overflow-hidden",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"text-left text-sm text-gray-400 border-b border-gray-700",children:[t.jsx("th",{className:"px-6 py-4 font-medium",children:"Title"}),t.jsx("th",{className:"px-6 py-4 font-medium",children:"Device"}),t.jsx("th",{className:"px-6 py-4 font-medium",children:"Quality"}),t.jsx("th",{className:"px-6 py-4 font-medium",children:"Size"}),t.jsx("th",{className:"px-6 py-4 font-medium",children:"Status"}),t.jsx("th",{className:"px-6 py-4 font-medium",children:"Progress"}),t.jsx("th",{className:"px-6 py-4 font-medium",children:"Expires"}),t.jsx("th",{className:"px-6 py-4 font-medium",children:"Watch State"}),t.jsx("th",{className:"px-6 py-4 font-medium text-right",children:"Actions"})]})}),t.jsx("tbody",{className:"text-sm",children:T.map(H=>t.jsxs("tr",{className:"border-b border-gray-700/50 hover:bg-gray-700/30 transition-colors",children:[t.jsxs("td",{className:"px-6 py-4",children:[t.jsx("p",{className:"text-white font-medium",children:H.title}),t.jsxs("p",{className:"text-gray-500 text-xs mt-0.5",children:["ID: ",H.mediaItemId]})]}),t.jsx("td",{className:"px-6 py-4",children:t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(ei,{className:"h-3.5 w-3.5 text-gray-500"}),t.jsx("span",{className:"text-gray-300 text-xs",children:H.deviceId})]})}),t.jsx("td",{className:"px-6 py-4",children:UU(H.quality)}),t.jsx("td",{className:"px-6 py-4 text-gray-300",children:t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx($a,{className:"h-3.5 w-3.5 text-gray-500"}),d1(H.fileSize)]})}),t.jsx("td",{className:"px-6 py-4",children:BU(H.status)}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("div",{className:"w-24",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"flex-1 bg-gray-700 rounded-full h-1.5",children:t.jsx("div",{className:"bg-indigo-500 h-1.5 rounded-full transition-all",style:{width:`${Math.round(H.progress*100)}%`}})}),t.jsxs("span",{className:"text-gray-400 text-xs",children:[Math.round(H.progress*100),"%"]})]})})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:`text-xs ${new Date(H.expiresAt)<new Date?"text-red-400":"text-gray-400"}`,title:OU(H.expiresAt),children:FU(H.expiresAt)})}),t.jsx("td",{className:"px-6 py-4",children:H.watched?t.jsxs("span",{className:"inline-flex items-center gap-1 text-green-400 text-xs",children:[t.jsx(vn,{className:"h-3.5 w-3.5"}),"Watched"]}):H.watchedPosition>0?t.jsxs("span",{className:"text-yellow-400 text-xs",children:[Math.floor(H.watchedPosition/6e4),"m"]}):t.jsx("span",{className:"text-gray-500 text-xs",children:"--"})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("div",{className:"flex items-center justify-end gap-2",children:n===H.id?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>_.mutate(H.id),disabled:_.isPending,className:"px-2 py-1.5 bg-red-600 hover:bg-red-700 text-white rounded-lg text-xs",children:_.isPending?"...":"Confirm"}),t.jsx("button",{onClick:()=>i(null),className:"px-2 py-1.5 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-xs",children:"Cancel"})]}):t.jsxs("button",{onClick:()=>i(H.id),className:"flex items-center gap-1.5 px-3 py-1.5 bg-red-600/20 hover:bg-red-600/30 text-red-400 border border-red-500/30 rounded-lg text-xs",title:"Delete",children:[t.jsx(Dt,{className:"h-3.5 w-3.5"}),"Delete"]})})})]},H.id))})]})})}),_.error&&t.jsxs("div",{className:"mt-4 p-3 bg-red-500/10 border border-red-500/30 rounded-lg flex items-center gap-2",children:[t.jsx(ps,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),t.jsxs("span",{className:"text-red-400 text-sm",children:["Failed to delete: ",_.error.message]})]})]})}function HU(a){const e=Math.round(a/6e4);if(e<60)return`${e}m`;const s=Math.floor(e/60),n=e%60;return n>0?`${s}h ${n}m`:`${s}h`}function zU(a){return a?(typeof a=="number"?new Date(a*1e3):new Date(a)).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}function YU(a){if(a)return a.startsWith("http")||a.startsWith("/library/")?a:`https://image.tmdb.org/t/p/original${a}`}function Xg(a){if(a)return a.startsWith("http")||a.startsWith("/library/")?a:`https://image.tmdb.org/t/p/w500${a}`}function WU(){const{id:a}=N1(),[e,s]=k.useState(null),{data:n,isLoading:i}=Fe({queryKey:["show-detail",a],queryFn:async()=>(await pe.client.get(`/library/metadata/${a}`)).data,enabled:!!a}),l=n?.MediaContainer?.Metadata?.[0],{data:o,isLoading:d}=Fe({queryKey:["show-seasons",a],queryFn:async()=>(await pe.client.get(`/library/metadata/${a}/children`)).data,enabled:!!a}),h=o?.MediaContainer?.Metadata??[],u=e!==null?h[e]?.ratingKey:h.length>0?h[0]?.ratingKey:null,f=e??(h.length>0?0:null),{data:g,isLoading:p}=Fe({queryKey:["season-episodes",u],queryFn:async()=>(await pe.client.get(`/library/metadata/${u}/children`)).data,enabled:!!u}),b=g?.MediaContainer?.Metadata??[],y=l?.leafCount??0,v=l?.viewedLeafCount??0,_=y-v;if(i)return t.jsx("div",{className:"flex items-center justify-center h-96",children:t.jsx(tn,{className:"h-8 w-8 text-indigo-500 animate-spin"})});if(!l)return t.jsxs("div",{className:"flex flex-col items-center justify-center h-96 gap-4",children:[t.jsx(jt,{className:"h-12 w-12 text-gray-500"}),t.jsx("p",{className:"text-gray-400 text-lg",children:"Show not found"}),t.jsxs(Ss,{to:"/ui/media",className:"text-indigo-400 hover:text-indigo-300 flex items-center gap-2",children:[t.jsx(Er,{className:"h-4 w-4"}),"Back to Media"]})]});const N=YU(l.art||l.grandparentArt),C=Xg(l.thumb),T=l.Genre?.map(L=>L.tag)??[];return t.jsxs("div",{className:"space-y-6 -mt-6 -mx-6",children:[t.jsxs("div",{className:"relative h-[420px] overflow-hidden",children:[N?t.jsx("img",{src:N,alt:"",className:"absolute inset-0 w-full h-full object-cover"}):t.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-800 to-gray-900"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-gray-900 via-gray-900/60 to-transparent"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-gray-900/80 via-transparent to-transparent"}),t.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 flex gap-6",children:[t.jsx("div",{className:"flex-shrink-0 w-48 h-72 rounded-lg overflow-hidden shadow-2xl bg-gray-800 hidden sm:block",children:C?t.jsx("img",{src:C,alt:l.title,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx(jt,{className:"h-16 w-16 text-gray-600"})})}),t.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-end",children:[t.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-white mb-2 drop-shadow-lg",children:l.title}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-gray-300 mb-3",children:[l.year&&t.jsx("span",{children:l.year}),l.contentRating&&t.jsx("span",{className:"px-2 py-0.5 border border-gray-500 rounded text-xs",children:l.contentRating}),l.childCount!==void 0&&l.childCount>0&&t.jsxs("span",{children:[l.childCount," Season",l.childCount!==1?"s":""]}),y>0&&t.jsxs("span",{children:[y," Episode",y!==1?"s":""]}),l.studio&&t.jsx("span",{className:"text-gray-400",children:l.studio}),l.rating&&l.rating>0&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Di,{className:"h-3.5 w-3.5 text-yellow-400 fill-yellow-400"}),l.rating.toFixed(1)]})]}),T.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:T.map(L=>t.jsx("span",{className:"px-2.5 py-1 bg-gray-700/70 text-gray-200 rounded-full text-xs",children:L},L))}),l.summary&&t.jsx("p",{className:"text-gray-300 text-sm leading-relaxed line-clamp-3 max-w-3xl",children:l.summary})]})]})]}),t.jsxs("div",{className:"px-6 flex flex-wrap items-center gap-4",children:[t.jsxs(Ss,{to:"/ui/media",className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg flex items-center gap-2 text-sm transition-colors",children:[t.jsx(Er,{className:"h-4 w-4"}),"Back"]}),b.length>0&&t.jsxs("button",{className:"px-5 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg flex items-center gap-2 text-sm font-medium transition-colors",children:[t.jsx(xs,{className:"h-4 w-4"}),"Play Next Episode"]}),t.jsx("div",{className:"ml-auto flex items-center gap-4 text-sm text-gray-400",children:y>0&&t.jsxs(t.Fragment,{children:[t.jsxs("span",{className:"flex items-center gap-1.5",children:[t.jsx(Gt,{className:"h-4 w-4"}),y," total"]}),_>0&&t.jsxs("span",{className:"flex items-center gap-1.5 text-indigo-400",children:[t.jsx(Kt,{className:"h-4 w-4"}),_," unwatched"]}),v>0&&t.jsxs("span",{className:"flex items-center gap-1.5 text-green-400",children:[t.jsx(vn,{className:"h-4 w-4"}),v," watched"]})]})})]}),h.length>0&&t.jsx("div",{className:"px-6",children:t.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:h.map((L,F)=>t.jsxs("button",{onClick:()=>s(F),className:`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${f===F?"bg-indigo-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"}`,children:[L.title||`Season ${L.index??F+1}`,L.leafCount!==void 0&&L.leafCount>0&&t.jsxs("span",{className:"ml-1.5 text-xs opacity-70",children:["(",L.leafCount,")"]})]},L.ratingKey))})}),t.jsx("div",{className:"px-6 pb-6",children:d||p?t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsx(tn,{className:"h-6 w-6 text-indigo-500 animate-spin"})}):b.length===0?t.jsx("div",{className:"text-center py-12 text-gray-500",children:"No episodes found for this season."}):t.jsx("div",{className:"bg-gray-800 rounded-lg overflow-hidden divide-y divide-gray-700/50",children:b.map((L,F)=>{const H=Xg(L.thumb)||Xg(L.parentThumb);return t.jsxs("div",{className:`flex gap-4 p-4 hover:bg-gray-750 transition-colors ${F%2===0?"bg-gray-800":"bg-gray-800/70"}`,children:[t.jsxs("div",{className:"flex-shrink-0 w-40 h-24 rounded-md overflow-hidden bg-gray-700 relative hidden md:block",children:[H?t.jsx("img",{src:H,alt:L.title,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx(Gt,{className:"h-8 w-8 text-gray-600"})}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity bg-black/40",children:t.jsx(xs,{className:"h-8 w-8 text-white"})})]}),t.jsx("div",{className:"flex-1 min-w-0",children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsxs("span",{className:"text-indigo-400 font-mono text-sm mt-0.5 flex-shrink-0",children:["E",String(L.index??F+1).padStart(2,"0")]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h3",{className:"text-white font-medium truncate",children:L.title}),!1]}),t.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-400 mt-1",children:[L.originallyAvailableAt&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(sn,{className:"h-3 w-3"}),zU(L.originallyAvailableAt)]}),L.duration&&L.duration>0&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Kt,{className:"h-3 w-3"}),HU(L.duration)]})]}),L.summary&&t.jsx("p",{className:"text-gray-400 text-sm mt-2 line-clamp-2 leading-relaxed",children:L.summary})]})]})})]},L.ratingKey)})})})]})}function QU(a){const e=Math.round(a/6e4);if(e<60)return`${e}m`;const s=Math.floor(e/60),n=e%60;return n>0?`${s}h ${n}m`:`${s}h`}function XU(a){if(a===0)return"0 B";const e=["B","KB","MB","GB","TB"],s=Math.floor(Math.log(a)/Math.log(1024));return`${(a/Math.pow(1024,s)).toFixed(1)} ${e[s]}`}function JU(a){return a>=1e3?`${(a/1e3).toFixed(1)} Mbps`:`${a} kbps`}function ZU(a,e){return e>=2160?"4K UHD":e>=1440?"1440p QHD":e>=1080?"1080p FHD":e>=720?"720p HD":e>=480?"480p SD":`${a}x${e}`}function e7(a){return a?(typeof a=="number"?new Date(a*1e3):new Date(a)).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):""}function t7(a){if(a)return a.startsWith("http")||a.startsWith("/library/")?a:`https://image.tmdb.org/t/p/original${a}`}function u1(a){if(a)return a.startsWith("http")||a.startsWith("/library/")?a:`https://image.tmdb.org/t/p/w500${a}`}function s7(a){if(a)return a.startsWith("http")?a:`https://image.tmdb.org/t/p/w185${a}`}function a7(){const{id:a}=N1(),{data:e,isLoading:s}=Fe({queryKey:["movie-detail",a],queryFn:async()=>(await pe.client.get(`/library/metadata/${a}`)).data,enabled:!!a}),n=e?.MediaContainer?.Metadata?.[0],{data:i}=Fe({queryKey:["related-movies",n?.ratingKey],queryFn:async()=>(await pe.client.get(`/library/sections/${n.librarySectionID}/all`,{params:{type:1,"X-Plex-Container-Start":0,"X-Plex-Container-Size":12,sort:"addedAt:desc"}})).data,enabled:!!n&&!!n.librarySectionID}),l=(i?.MediaContainer?.Metadata??[]).filter(y=>y.ratingKey!==n?.ratingKey).slice(0,8);if(s)return t.jsx("div",{className:"flex items-center justify-center h-96",children:t.jsx(tn,{className:"h-8 w-8 text-indigo-500 animate-spin"})});if(!n)return t.jsxs("div",{className:"flex flex-col items-center justify-center h-96 gap-4",children:[t.jsx(Gt,{className:"h-12 w-12 text-gray-500"}),t.jsx("p",{className:"text-gray-400 text-lg",children:"Movie not found"}),t.jsxs(Ss,{to:"/ui/media",className:"text-indigo-400 hover:text-indigo-300 flex items-center gap-2",children:[t.jsx(Er,{className:"h-4 w-4"}),"Back to Media"]})]});const o=t7(n.art),d=u1(n.thumb),h=n.Genre?.map(y=>y.tag)??[],u=n.Role??[],f=n.Director??[],g=n.Writer??[],p=n.Media?.[0],b=p?.Part?.[0];return t.jsxs("div",{className:"space-y-6 -mt-6 -mx-6",children:[t.jsxs("div",{className:"relative h-[460px] overflow-hidden",children:[o?t.jsx("img",{src:o,alt:"",className:"absolute inset-0 w-full h-full object-cover"}):t.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-800 to-gray-900"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-gray-900 via-gray-900/60 to-transparent"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-gray-900/80 via-transparent to-transparent"}),t.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 flex gap-6",children:[t.jsx("div",{className:"flex-shrink-0 w-52 h-78 rounded-lg overflow-hidden shadow-2xl bg-gray-800 hidden sm:block",children:d?t.jsx("img",{src:d,alt:n.title,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{height:"312px"},children:t.jsx(Gt,{className:"h-16 w-16 text-gray-600"})})}),t.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-end",children:[t.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-white mb-2 drop-shadow-lg",children:n.title}),n.tagline&&t.jsx("p",{className:"text-gray-300 italic text-sm mb-3",children:n.tagline}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-gray-300 mb-3",children:[n.year&&t.jsx("span",{children:n.year}),n.contentRating&&t.jsx("span",{className:"px-2 py-0.5 border border-gray-500 rounded text-xs",children:n.contentRating}),n.duration&&n.duration>0&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Kt,{className:"h-3.5 w-3.5"}),QU(n.duration)]}),n.rating&&n.rating>0&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Di,{className:"h-3.5 w-3.5 text-yellow-400 fill-yellow-400"}),n.rating.toFixed(1)]}),n.audienceRating&&n.audienceRating>0&&t.jsxs("span",{className:"flex items-center gap-1 text-gray-400",children:["Audience: ",n.audienceRating.toFixed(1)]}),n.studio&&t.jsx("span",{className:"text-gray-400",children:n.studio})]}),h.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:h.map(y=>t.jsx("span",{className:"px-2.5 py-1 bg-gray-700/70 text-gray-200 rounded-full text-xs",children:y},y))}),n.summary&&t.jsx("p",{className:"text-gray-300 text-sm leading-relaxed line-clamp-4 max-w-3xl",children:n.summary}),(f.length>0||g.length>0)&&t.jsxs("div",{className:"flex flex-wrap gap-x-6 gap-y-1 mt-3 text-sm",children:[f.length>0&&t.jsxs("p",{className:"text-gray-400",children:[t.jsx("span",{className:"text-gray-500",children:"Directed by "}),f.map(y=>y.tag).join(", ")]}),g.length>0&&t.jsxs("p",{className:"text-gray-400",children:[t.jsx("span",{className:"text-gray-500",children:"Written by "}),g.map(y=>y.tag).join(", ")]})]})]})]})]}),t.jsxs("div",{className:"px-6 flex flex-wrap items-center gap-3",children:[t.jsxs(Ss,{to:"/ui/media",className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg flex items-center gap-2 text-sm transition-colors",children:[t.jsx(Er,{className:"h-4 w-4"}),"Back"]}),p&&t.jsxs("button",{className:"px-5 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg flex items-center gap-2 text-sm font-medium transition-colors",children:[t.jsx(xs,{className:"h-4 w-4"}),"Play"]}),t.jsxs("button",{className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg flex items-center gap-2 text-sm transition-colors",children:[t.jsx(hC,{className:"h-4 w-4"}),"Watchlist"]}),n.addedAt&&t.jsxs("span",{className:"ml-auto text-xs text-gray-500 flex items-center gap-1",children:[t.jsx(sn,{className:"h-3 w-3"}),"Added ",e7(n.addedAt)]})]}),u.length>0&&t.jsxs("div",{className:"px-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-3",children:"Cast"}),t.jsx("div",{className:"flex gap-4 overflow-x-auto pb-3",children:u.slice(0,20).map((y,v)=>{const _=s7(y.thumb);return t.jsxs("div",{className:"flex-shrink-0 w-28 text-center",children:[t.jsx("div",{className:"w-20 h-20 mx-auto rounded-full overflow-hidden bg-gray-700 mb-2",children:_?t.jsx("img",{src:_,alt:y.tag,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500 text-xl font-bold",children:y.tag.charAt(0)})}),t.jsx("p",{className:"text-white text-xs font-medium truncate",children:y.tag}),y.role&&t.jsx("p",{className:"text-gray-500 text-xs truncate",children:y.role})]},`${y.tag}-${v}`)})})]}),p&&t.jsxs("div",{className:"px-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-3",children:"Technical Details"}),t.jsx("div",{className:"bg-gray-800 rounded-lg p-4",children:t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[p.width>0&&p.height>0&&t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(wr,{className:"h-5 w-5 text-gray-400 mt-0.5 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500",children:"Resolution"}),t.jsx("p",{className:"text-sm text-white",children:ZU(p.width,p.height)}),t.jsxs("p",{className:"text-xs text-gray-500",children:[p.width,"x",p.height]})]})]}),p.videoCodec&&t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(Gt,{className:"h-5 w-5 text-gray-400 mt-0.5 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500",children:"Video"}),t.jsx("p",{className:"text-sm text-white uppercase",children:p.videoCodec}),p.container&&t.jsx("p",{className:"text-xs text-gray-500 uppercase",children:p.container})]})]}),p.audioCodec&&t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(Gt,{className:"h-5 w-5 text-gray-400 mt-0.5 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500",children:"Audio"}),t.jsx("p",{className:"text-sm text-white uppercase",children:p.audioCodec})]})]}),b&&b.size>0&&t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx($a,{className:"h-5 w-5 text-gray-400 mt-0.5 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500",children:"File Size"}),t.jsx("p",{className:"text-sm text-white",children:XU(b.size)}),p.bitrate>0&&t.jsx("p",{className:"text-xs text-gray-500",children:JU(p.bitrate)})]})]})]})})]}),l.length>0&&t.jsxs("div",{className:"px-6 pb-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-3",children:"More in Library"}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-4",children:l.map(y=>{const v=u1(y.thumb);return t.jsxs(Ss,{to:y.type==="show"?`/ui/shows/${y.ratingKey}`:`/ui/movies/${y.ratingKey}`,className:"group",children:[t.jsxs("div",{className:"aspect-[2/3] rounded-lg overflow-hidden bg-gray-800 mb-2 relative",children:[v?t.jsx("img",{src:v,alt:y.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx(Gt,{className:"h-8 w-8 text-gray-600"})}),t.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-colors flex items-center justify-center",children:t.jsx(xs,{className:"h-8 w-8 text-white opacity-0 group-hover:opacity-100 transition-opacity"})})]}),t.jsx("p",{className:"text-white text-xs font-medium truncate",children:y.title}),y.year&&t.jsx("p",{className:"text-gray-500 text-xs",children:y.year})]},y.ratingKey)})})]})]})}const Gi=()=>({"X-Plex-Token":localStorage.getItem("openflix_token")||"","Content-Type":"application/json"});async function n7(){const a=await fetch("/api/playlists",{headers:Gi()});if(!a.ok)throw new Error("Failed to fetch playlists");return(await a.json()).playlists||[]}async function i7(a){const e=await fetch(`/api/playlists/${a}`,{headers:Gi()});if(!e.ok)throw new Error("Failed to fetch playlist");return e.json()}async function r7(a){const e=await fetch("/api/playlists",{method:"POST",headers:Gi(),body:JSON.stringify(a)});if(!e.ok)throw new Error("Failed to create playlist");return e.json()}async function l7(a,e){const s=await fetch(`/api/playlists/${a}`,{method:"PUT",headers:Gi(),body:JSON.stringify(e)});if(!s.ok)throw new Error("Failed to update playlist");return s.json()}async function o7(a){if(!(await fetch(`/api/playlists/${a}`,{method:"DELETE",headers:Gi()})).ok)throw new Error("Failed to delete playlist")}async function c7(a,e){if(!(await fetch(`/api/playlists/${a}/items/${e}`,{method:"DELETE",headers:Gi()})).ok)throw new Error("Failed to remove item")}async function d7(a,e){if(!(await fetch(`/api/playlists/${a}/items/reorder`,{method:"PUT",headers:Gi(),body:JSON.stringify({itemIds:e})})).ok)throw new Error("Failed to reorder items")}async function u7(a,e){if(!(await fetch(`/api/playlists/${a}/items`,{method:"POST",headers:Gi(),body:JSON.stringify({mediaIds:e})})).ok)throw new Error("Failed to add items")}async function h7(a){const e=await fetch(`/api/search?query=${encodeURIComponent(a)}&limit=20`,{headers:Gi()});if(!e.ok)return[];const s=await e.json();return(s.results||s.items||[]).map(i=>({id:0,playlistId:0,mediaId:i.ratingKey||i.id||i.mediaId,position:0,title:i.title||"",type:i.type||"",year:i.year||0,thumb:i.thumb||"",duration:i.duration||0}))}function f7(a){if(!a)return"";const e=Math.floor(a/6e4),s=Math.floor(e/60),n=e%60;return s>0?`${s}h ${n}m`:`${n}m`}function Y0(a){switch(a){case"movie":return t.jsx(Gt,{className:"h-4 w-4 text-blue-400"});case"show":case"episode":return t.jsx(jt,{className:"h-4 w-4 text-green-400"});default:return t.jsx(Gt,{className:"h-4 w-4 text-gray-400"})}}function m7(){const a=at(),[e,s]=k.useState(null),[n,i]=k.useState(""),[l,o]=k.useState(!1),[d,h]=k.useState(null),[u,f]=k.useState(!1),[g,p]=k.useState(""),[b,y]=k.useState(null),{data:v=[],isLoading:_}=Fe({queryKey:["admin-playlists"],queryFn:n7}),{data:N,isLoading:C}=Fe({queryKey:["admin-playlist",e],queryFn:()=>i7(e),enabled:!!e}),{data:T=[]}=Fe({queryKey:["media-search",g],queryFn:()=>h7(g),enabled:u&&g.length>=2}),L=Me({mutationFn:r7,onSuccess:()=>{a.invalidateQueries({queryKey:["admin-playlists"]}),o(!1)}}),F=Me({mutationFn:({id:Z,body:z})=>l7(Z,z),onSuccess:()=>{a.invalidateQueries({queryKey:["admin-playlists"]}),a.invalidateQueries({queryKey:["admin-playlist",e]}),h(null)}}),H=Me({mutationFn:o7,onSuccess:()=>{a.invalidateQueries({queryKey:["admin-playlists"]}),s(null)}}),B=Me({mutationFn:({playlistId:Z,itemId:z})=>c7(Z,z),onSuccess:()=>{a.invalidateQueries({queryKey:["admin-playlist",e]}),a.invalidateQueries({queryKey:["admin-playlists"]})}}),P=Me({mutationFn:({playlistId:Z,itemIds:z})=>d7(Z,z),onSuccess:()=>{a.invalidateQueries({queryKey:["admin-playlist",e]})}}),I=Me({mutationFn:({playlistId:Z,mediaIds:z})=>u7(Z,z),onSuccess:()=>{a.invalidateQueries({queryKey:["admin-playlist",e]}),a.invalidateQueries({queryKey:["admin-playlists"]}),f(!1),p("")}}),D=k.useCallback(Z=>{y(Z)},[]),O=k.useCallback((Z,z)=>{Z.preventDefault()},[b]),ee=k.useCallback(Z=>{if(b===null||!N?.items)return;const z=[...N.items],[X]=z.splice(b,1);z.splice(Z,0,X);const ae=z.map(te=>te.id);P.mutate({playlistId:e,itemIds:ae}),y(null)},[b,N,e,P]),ie=v.filter(Z=>Z.title.toLowerCase().includes(n.toLowerCase()));return _?t.jsx("div",{className:"flex items-center justify-center h-96",children:t.jsx(Ke,{className:"h-8 w-8 animate-spin text-indigo-500"})}):v.length===0&&!l?t.jsxs("div",{className:"flex flex-col items-center justify-center h-96 text-center",children:[t.jsx(h0,{className:"h-16 w-16 text-gray-600 mb-4"}),t.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Create a Playlist"}),t.jsx("p",{className:"text-gray-400 max-w-md mb-6",children:"Playlists let you create a list of movies, episodes, and videos from your library."}),t.jsx("button",{onClick:()=>o(!0),className:"px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors",children:"Create Playlist"})]}):t.jsxs("div",{children:[t.jsx("div",{className:"flex items-center justify-between mb-6",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Playlists"}),t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Create and manage playlists of movies, episodes, and videos from your library."})]})}),t.jsxs("div",{className:"flex gap-6 h-[calc(100vh-200px)]",children:[t.jsxs("div",{className:"w-80 flex-shrink-0 bg-gray-800 rounded-lg border border-gray-700 flex flex-col",children:[t.jsx("div",{className:"p-3 border-b border-gray-700 space-y-2",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search playlists...",value:n,onChange:Z=>i(Z.target.value),className:"w-full pl-9 pr-3 py-2 bg-gray-700 text-white text-sm rounded-lg border border-gray-600 focus:border-indigo-500 focus:outline-none"})]}),t.jsx("button",{onClick:()=>o(!0),className:"p-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors",title:"Create playlist",children:t.jsx(Pt,{className:"h-4 w-4"})})]})}),t.jsxs("div",{className:"flex-1 overflow-y-auto",children:[ie.map(Z=>t.jsxs("button",{onClick:()=>s(Z.ID),className:`w-full text-left px-4 py-3 border-b border-gray-700/50 transition-colors ${e===Z.ID?"bg-indigo-600/20 border-l-2 border-l-indigo-500":"hover:bg-gray-700/50"}`,children:[t.jsx("div",{className:"font-medium text-white text-sm truncate",children:Z.title}),t.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[Z.leafCount," ",Z.leafCount===1?"item":"items"]})]},Z.ID)),ie.length===0&&t.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:n?"No playlists match your search":"No playlists yet"})]})]}),t.jsx("div",{className:"flex-1 bg-gray-800 rounded-lg border border-gray-700 flex flex-col overflow-hidden",children:e?C?t.jsx("div",{className:"flex-1 flex items-center justify-center",children:t.jsx(Ke,{className:"h-6 w-6 animate-spin text-indigo-500"})}):N?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"p-4 border-b border-gray-700 flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h2",{className:"text-lg font-semibold text-white truncate",children:N.playlist.title}),N.playlist.summary&&t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:N.playlist.summary}),t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[N.items.length," ",N.items.length===1?"item":"items"]})]}),t.jsxs("div",{className:"flex gap-2 ml-4",children:[t.jsxs("button",{onClick:()=>f(!0),className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-sm rounded-lg transition-colors flex items-center gap-1",children:[t.jsx(Pt,{className:"h-3.5 w-3.5"}),"Add Items"]}),t.jsx("button",{onClick:()=>h(N.playlist),className:"p-1.5 text-gray-400 hover:text-white transition-colors",title:"Edit playlist",children:t.jsx(an,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>{confirm("Delete this playlist?")&&H.mutate(e)},className:"p-1.5 text-gray-400 hover:text-red-400 transition-colors",title:"Delete playlist",children:t.jsx(Dt,{className:"h-4 w-4"})})]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto",children:N.items.length===0?t.jsxs("div",{className:"p-8 text-center text-gray-500",children:[t.jsx("p",{className:"text-sm",children:"This playlist is empty."}),t.jsx("button",{onClick:()=>f(!0),className:"mt-3 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm rounded-lg transition-colors",children:"Add Items"})]}):t.jsx("div",{children:N.items.map((Z,z)=>t.jsxs("div",{draggable:!0,onDragStart:()=>D(z),onDragOver:X=>O(X,z),onDrop:()=>ee(z),className:"flex items-center gap-3 px-4 py-3 border-b border-gray-700/30 hover:bg-gray-700/30 transition-colors group cursor-grab active:cursor-grabbing",children:[t.jsx(cp,{className:"h-4 w-4 text-gray-600 group-hover:text-gray-400 flex-shrink-0"}),t.jsx("span",{className:"text-xs text-gray-500 w-6 text-right flex-shrink-0",children:z+1}),Z.thumb?t.jsx("img",{src:Z.thumb,alt:"",className:"h-10 w-16 object-cover rounded flex-shrink-0 bg-gray-700"}):t.jsx("div",{className:"h-10 w-16 bg-gray-700 rounded flex items-center justify-center flex-shrink-0",children:Y0(Z.type)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[Y0(Z.type),t.jsx("span",{className:"text-sm text-white truncate",children:Z.title})]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mt-0.5",children:[Z.year&&t.jsx("span",{children:Z.year}),Z.duration&&t.jsxs(t.Fragment,{children:[t.jsx(Kt,{className:"h-3 w-3"}),t.jsx("span",{children:f7(Z.duration)})]})]})]}),t.jsx("button",{onClick:()=>B.mutate({playlistId:e,itemId:Z.id}),className:"p-1 text-gray-600 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-all",title:"Remove from playlist",children:t.jsx(nt,{className:"h-4 w-4"})})]},Z.id))})})]}):null:t.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:t.jsxs("div",{className:"text-center",children:[t.jsx(h0,{className:"h-12 w-12 mx-auto mb-3 text-gray-600"}),t.jsx("p",{className:"text-sm",children:"Select a playlist to view its contents"})]})})})]}),l&&t.jsx(h1,{title:"Create Playlist",initialName:"",initialDescription:"",onSave:(Z,z)=>L.mutate({name:Z,description:z}),onClose:()=>o(!1),saving:L.isPending}),d&&t.jsx(h1,{title:"Edit Playlist",initialName:d.title,initialDescription:d.summary||"",onSave:(Z,z)=>F.mutate({id:d.ID,body:{name:Z,description:z}}),onClose:()=>h(null),saving:F.isPending}),u&&e&&t.jsx(g7,{playlistId:e,searchQuery:g,onSearchChange:p,searchResults:T,onAdd:Z=>I.mutate({playlistId:e,mediaIds:Z}),onClose:()=>{f(!1),p("")},adding:I.isPending})]})}function h1({title:a,initialName:e,initialDescription:s,onSave:n,onClose:i,saving:l}){const[o,d]=k.useState(e),[h,u]=k.useState(s);return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl border border-gray-700 w-full max-w-md p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-white",children:a}),t.jsx("button",{onClick:i,className:"text-gray-400 hover:text-white",children:t.jsx(nt,{className:"h-5 w-5"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Name"}),t.jsx("input",{type:"text",value:o,onChange:f=>d(f.target.value),placeholder:"My Playlist",className:"w-full px-3 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:border-indigo-500 focus:outline-none",autoFocus:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Description"}),t.jsx("textarea",{value:h,onChange:f=>u(f.target.value),placeholder:"Optional description...",rows:3,className:"w-full px-3 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:border-indigo-500 focus:outline-none resize-none"})]})]}),t.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[t.jsx("button",{onClick:i,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",children:"Cancel"}),t.jsxs("button",{onClick:()=>n(o,h),disabled:!o.trim()||l,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[l&&t.jsx(Ke,{className:"h-4 w-4 animate-spin"}),"Save"]})]})]})})}function g7({playlistId:a,searchQuery:e,onSearchChange:s,searchResults:n,onAdd:i,onClose:l,adding:o}){const[d,h]=k.useState(new Set),u=f=>{const g=new Set(d);g.has(f)?g.delete(f):g.add(f),h(g)};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl border border-gray-700 w-full max-w-lg p-6 max-h-[80vh] flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-white",children:"Add Items to Playlist"}),t.jsx("button",{onClick:l,className:"text-gray-400 hover:text-white",children:t.jsx(nt,{className:"h-5 w-5"})})]}),t.jsxs("div",{className:"relative mb-4",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:e,onChange:f=>s(f.target.value),placeholder:"Search your library...",className:"w-full pl-9 pr-3 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:border-indigo-500 focus:outline-none",autoFocus:!0})]}),t.jsx("div",{className:"flex-1 overflow-y-auto min-h-0 border border-gray-700 rounded-lg",children:e.length<2?t.jsx("div",{className:"p-8 text-center text-gray-500 text-sm",children:"Type at least 2 characters to search"}):n.length===0?t.jsx("div",{className:"p-8 text-center text-gray-500 text-sm",children:"No results found"}):n.map(f=>t.jsxs("button",{onClick:()=>u(f.mediaId),className:`w-full flex items-center gap-3 px-4 py-3 border-b border-gray-700/30 transition-colors text-left ${d.has(f.mediaId)?"bg-indigo-600/20":"hover:bg-gray-700/50"}`,children:[t.jsx("div",{className:`h-5 w-5 rounded border flex items-center justify-center flex-shrink-0 ${d.has(f.mediaId)?"bg-indigo-600 border-indigo-600":"border-gray-500"}`,children:d.has(f.mediaId)&&t.jsx("svg",{className:"h-3 w-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),f.thumb?t.jsx("img",{src:f.thumb,alt:"",className:"h-8 w-12 object-cover rounded bg-gray-700 flex-shrink-0"}):t.jsx("div",{className:"h-8 w-12 bg-gray-700 rounded flex items-center justify-center flex-shrink-0",children:Y0(f.type)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm text-white truncate",children:f.title}),t.jsxs("div",{className:"text-xs text-gray-500",children:[f.type," ",f.year?`(${f.year})`:""]})]})]},f.mediaId))}),t.jsxs("div",{className:"flex items-center justify-between mt-4",children:[t.jsxs("span",{className:"text-sm text-gray-400",children:[d.size," ",d.size===1?"item":"items"," selected"]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:l,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",children:"Cancel"}),t.jsxs("button",{onClick:()=>i(Array.from(d)),disabled:d.size===0||o,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[o&&t.jsx(Ke,{className:"h-4 w-4 animate-spin"}),"Add Selected"]})]})]})]})})}const Fn=()=>({"X-Plex-Token":localStorage.getItem("openflix_token")||"","Content-Type":"application/json"});async function p7(){const a=await fetch("/api/sections",{headers:Fn()});if(!a.ok)throw new Error("Failed to fetch sections");return(await a.json()).sections||[]}async function x7(a){const e=await fetch(`/api/sections/${a}`,{headers:Fn()});if(!e.ok)throw new Error("Failed to fetch section");return e.json()}async function y7(a){const e=await fetch("/api/sections",{method:"POST",headers:Fn(),body:JSON.stringify(a)});if(!e.ok)throw new Error("Failed to create section");return e.json()}async function b7(a,e){const s=await fetch(`/api/sections/${a}`,{method:"PUT",headers:Fn(),body:JSON.stringify(e)});if(!s.ok)throw new Error("Failed to update section");return s.json()}async function v7(a){if(!(await fetch(`/api/sections/${a}`,{method:"DELETE",headers:Fn()})).ok)throw new Error("Failed to delete section")}async function _7(a,e){if(!(await fetch(`/api/sections/${a}/items/${e}`,{method:"DELETE",headers:Fn()})).ok)throw new Error("Failed to remove item")}async function N7(a,e){if(!(await fetch(`/api/sections/${a}/reorder`,{method:"PUT",headers:Fn(),body:JSON.stringify({itemIds:e})})).ok)throw new Error("Failed to reorder items")}async function w7(a,e){if(!(await fetch(`/api/sections/${a}/items`,{method:"POST",headers:Fn(),body:JSON.stringify({mediaIds:e})})).ok)throw new Error("Failed to add items")}async function S7(a){const e=await fetch("/api/sections/preview",{method:"POST",headers:Fn(),body:JSON.stringify({smartFilter:a,limit:50})});return e.ok?((await e.json()).items||[]).map(n=>({id:n.id||0,mediaId:n.id||0,position:0,title:n.title||"",type:n.type||"",year:n.year||0,thumb:n.thumb||"",duration:n.duration||0})):[]}async function j7(){const a=await fetch("/api/sections/genres",{headers:Fn()});return a.ok?(await a.json()).genres||[]:[]}async function E7(a){const e=await fetch(`/api/search?query=${encodeURIComponent(a)}&limit=20`,{headers:Fn()});if(!e.ok)return[];const s=await e.json();return(s.results||s.items||[]).map(i=>({id:0,mediaId:i.ratingKey||i.id||i.mediaId,position:0,title:i.title||"",type:i.type||"",year:i.year||0,thumb:i.thumb||"",duration:i.duration||0}))}function T7(a){if(!a)return"";const e=Math.floor(a/6e4),s=Math.floor(e/60),n=e%60;return s>0?`${s}h ${n}m`:`${n}m`}function Oh(a){switch(a){case"movie":return t.jsx(Gt,{className:"h-4 w-4 text-blue-400"});case"show":case"episode":return t.jsx(jt,{className:"h-4 w-4 text-green-400"});default:return t.jsx(Gt,{className:"h-4 w-4 text-gray-400"})}}function W0(){return{contentType:"movie",genre:"",yearFrom:0,yearTo:0,minRating:0,maxRating:0,watchedState:"any",sortBy:"title",sortDir:"asc"}}function A7(){const a=at(),[e,s]=k.useState(null),[n,i]=k.useState(""),[l,o]=k.useState(!1),[d,h]=k.useState(null),[u,f]=k.useState(null),[g,p]=k.useState(!1),[b,y]=k.useState(""),[v,_]=k.useState(null),{data:N=[],isLoading:C}=Fe({queryKey:["personal-sections"],queryFn:p7}),{data:T,isLoading:L}=Fe({queryKey:["personal-section",e],queryFn:()=>x7(e),enabled:!!e}),{data:F=[]}=Fe({queryKey:["available-genres"],queryFn:j7}),{data:H=[]}=Fe({queryKey:["section-media-search",b],queryFn:()=>E7(b),enabled:g&&b.length>=2}),B=Me({mutationFn:y7,onSuccess:ae=>{a.invalidateQueries({queryKey:["personal-sections"]}),h(null),s(ae.id)}}),P=Me({mutationFn:({id:ae,body:te})=>b7(ae,te),onSuccess:()=>{a.invalidateQueries({queryKey:["personal-sections"]}),a.invalidateQueries({queryKey:["personal-section",e]}),f(null)}}),I=Me({mutationFn:v7,onSuccess:()=>{a.invalidateQueries({queryKey:["personal-sections"]}),s(null)}}),D=Me({mutationFn:({sectionId:ae,itemId:te})=>_7(ae,te),onSuccess:()=>{a.invalidateQueries({queryKey:["personal-section",e]}),a.invalidateQueries({queryKey:["personal-sections"]})}}),O=Me({mutationFn:({sectionId:ae,itemIds:te})=>N7(ae,te),onSuccess:()=>{a.invalidateQueries({queryKey:["personal-section",e]})}}),ee=Me({mutationFn:({sectionId:ae,mediaIds:te})=>w7(ae,te),onSuccess:()=>{a.invalidateQueries({queryKey:["personal-section",e]}),a.invalidateQueries({queryKey:["personal-sections"]}),p(!1),y("")}}),ie=k.useCallback(ae=>{_(ae)},[]),Z=k.useCallback((ae,te)=>{ae.preventDefault()},[]),z=k.useCallback(ae=>{if(v===null||!T?.items)return;const te=[...T.items],[W]=te.splice(v,1);te.splice(ae,0,W);const K=te.map(q=>q.id);O.mutate({sectionId:e,itemIds:K}),_(null)},[v,T,e,O]),X=N.filter(ae=>ae.name.toLowerCase().includes(n.toLowerCase()));return C?t.jsx("div",{className:"flex items-center justify-center h-96",children:t.jsx(Ke,{className:"h-8 w-8 animate-spin text-indigo-500"})}):t.jsxs("div",{children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Personal Sections"}),t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Curate your own personal sections for OpenFlix."})]}),t.jsxs("div",{className:"mb-6 flex items-start gap-3 p-4 bg-blue-900/20 border border-blue-800/50 rounded-lg",children:[t.jsx(j4,{className:"h-5 w-5 text-blue-400 flex-shrink-0 mt-0.5"}),t.jsx("p",{className:"text-sm text-blue-300",children:"Apply your Personal Sections to your client's sidebar navigation in the Client Settings section."})]}),t.jsxs("div",{className:"flex gap-6 h-[calc(100vh-260px)]",children:[t.jsxs("div",{className:"w-80 flex-shrink-0 bg-gray-800 rounded-lg border border-gray-700 flex flex-col",children:[t.jsx("div",{className:"p-3 border-b border-gray-700 space-y-2",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search sections...",value:n,onChange:ae=>i(ae.target.value),className:"w-full pl-9 pr-3 py-2 bg-gray-700 text-white text-sm rounded-lg border border-gray-600 focus:border-indigo-500 focus:outline-none"})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>o(!l),className:"p-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors flex items-center gap-1",title:"Create section",children:[t.jsx(Pt,{className:"h-4 w-4"}),t.jsx(Pn,{className:"h-3 w-3"})]}),l&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>o(!1)}),t.jsxs("div",{className:"absolute right-0 top-full mt-1 z-20 w-52 bg-gray-700 rounded-lg shadow-xl border border-gray-600 py-1",children:[t.jsxs("button",{onClick:()=>{o(!1),h("smart")},className:"w-full flex items-center gap-2 px-4 py-2 text-sm text-white hover:bg-gray-600 transition-colors",children:[t.jsx(Sr,{className:"h-4 w-4 text-purple-400"}),"Add Smart Section"]}),t.jsxs("button",{onClick:()=>{o(!1),h("manual")},className:"w-full flex items-center gap-2 px-4 py-2 text-sm text-white hover:bg-gray-600 transition-colors",children:[t.jsx(Gh,{className:"h-4 w-4 text-blue-400"}),"Add Manual Section"]})]})]})]})]})}),t.jsxs("div",{className:"flex-1 overflow-y-auto",children:[X.map(ae=>t.jsxs("button",{onClick:()=>s(ae.id),className:`w-full text-left px-4 py-3 border-b border-gray-700/50 transition-colors ${e===ae.id?"bg-indigo-600/20 border-l-2 border-l-indigo-500":"hover:bg-gray-700/50"}`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[ae.sectionType==="smart"?t.jsx(Sr,{className:"h-3.5 w-3.5 text-purple-400 flex-shrink-0"}):t.jsx(Qu,{className:"h-3.5 w-3.5 text-blue-400 flex-shrink-0"}),t.jsx("span",{className:"font-medium text-white text-sm truncate",children:ae.name})]}),t.jsxs("div",{className:"text-xs text-gray-400 mt-1 ml-5.5",children:[ae.sectionType==="smart"?"Smart":"Manual"," - ",ae.itemCount," ",ae.itemCount===1?"item":"items"]})]},ae.id)),X.length===0&&t.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:n?"No sections match your search":"No personal sections yet. Click + to create one."})]})]}),t.jsx("div",{className:"flex-1 bg-gray-800 rounded-lg border border-gray-700 flex flex-col overflow-hidden",children:e?L?t.jsx("div",{className:"flex-1 flex items-center justify-center",children:t.jsx(Ke,{className:"h-6 w-6 animate-spin text-indigo-500"})}):T?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"p-4 border-b border-gray-700 flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[T.section.sectionType==="smart"?t.jsx(Sr,{className:"h-4 w-4 text-purple-400"}):t.jsx(Qu,{className:"h-4 w-4 text-blue-400"}),t.jsx("h2",{className:"text-lg font-semibold text-white truncate",children:T.section.name}),t.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-gray-700 text-gray-300",children:T.section.sectionType})]}),T.section.description&&t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:T.section.description}),t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[T.items.length," ",T.items.length===1?"item":"items"]})]}),t.jsxs("div",{className:"flex gap-2 ml-4",children:[T.section.sectionType==="manual"&&t.jsxs("button",{onClick:()=>p(!0),className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-sm rounded-lg transition-colors flex items-center gap-1",children:[t.jsx(Pt,{className:"h-3.5 w-3.5"}),"Add Items"]}),t.jsx("button",{onClick:()=>f(T.section),className:"p-1.5 text-gray-400 hover:text-white transition-colors",title:"Edit section",children:t.jsx(an,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>{confirm("Delete this section?")&&I.mutate(e)},className:"p-1.5 text-gray-400 hover:text-red-400 transition-colors",title:"Delete section",children:t.jsx(Dt,{className:"h-4 w-4"})})]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto",children:T.items.length===0?t.jsxs("div",{className:"p-8 text-center text-gray-500",children:[t.jsx("p",{className:"text-sm",children:T.section.sectionType==="smart"?"No items match the current filter criteria.":"This section is empty."}),T.section.sectionType==="manual"&&t.jsx("button",{onClick:()=>p(!0),className:"mt-3 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm rounded-lg transition-colors",children:"Add Items"})]}):t.jsx("div",{children:T.items.map((ae,te)=>t.jsxs("div",{draggable:T.section.sectionType==="manual",onDragStart:()=>ie(te),onDragOver:W=>Z(W,te),onDrop:()=>z(te),className:`flex items-center gap-3 px-4 py-3 border-b border-gray-700/30 hover:bg-gray-700/30 transition-colors group ${T.section.sectionType==="manual"?"cursor-grab active:cursor-grabbing":""}`,children:[T.section.sectionType==="manual"&&t.jsx(cp,{className:"h-4 w-4 text-gray-600 group-hover:text-gray-400 flex-shrink-0"}),t.jsx("span",{className:"text-xs text-gray-500 w-6 text-right flex-shrink-0",children:te+1}),ae.thumb?t.jsx("img",{src:ae.thumb,alt:"",className:"h-10 w-16 object-cover rounded flex-shrink-0 bg-gray-700"}):t.jsx("div",{className:"h-10 w-16 bg-gray-700 rounded flex items-center justify-center flex-shrink-0",children:Oh(ae.type)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[Oh(ae.type),t.jsx("span",{className:"text-sm text-white truncate",children:ae.title})]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mt-0.5",children:[(ae.year??0)>0&&t.jsx("span",{children:ae.year}),(ae.duration??0)>0&&t.jsxs(t.Fragment,{children:[t.jsx(Kt,{className:"h-3 w-3"}),t.jsx("span",{children:T7(ae.duration??0)})]})]})]}),T.section.sectionType==="manual"&&t.jsx("button",{onClick:()=>D.mutate({sectionId:e,itemId:ae.id}),className:"p-1 text-gray-600 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-all",title:"Remove from section",children:t.jsx(nt,{className:"h-4 w-4"})})]},`${ae.id}-${ae.mediaId}`))})})]}):null:t.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:t.jsxs("div",{className:"text-center",children:[t.jsx(Qu,{className:"h-12 w-12 mx-auto mb-3 text-gray-600"}),t.jsx("p",{className:"text-sm",children:"Select a section to view its contents"})]})})})]}),d&&t.jsx(C7,{type:d,genres:F,onSave:ae=>B.mutate(ae),onClose:()=>h(null),saving:B.isPending}),u&&t.jsx(k7,{section:u,genres:F,onSave:ae=>P.mutate({id:u.id,body:ae}),onClose:()=>f(null),saving:P.isPending}),g&&e&&t.jsx(R7,{searchQuery:b,onSearchChange:y,searchResults:H,onAdd:ae=>ee.mutate({sectionId:e,mediaIds:ae}),onClose:()=>{p(!1),y("")},adding:ee.isPending})]})}function C7({type:a,genres:e,onSave:s,onClose:n,saving:i}){const[l,o]=k.useState(""),[d,h]=k.useState(""),[u,f]=k.useState(W0()),[g,p]=k.useState([]),[b,y]=k.useState(!1),v=async()=>{y(!0);try{const _=await S7(JSON.stringify(u));p(_)}finally{y(!1)}};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl border border-gray-700 w-full max-w-2xl p-6 max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[a==="smart"?t.jsx(Sr,{className:"h-5 w-5 text-purple-400"}):t.jsx(Gh,{className:"h-5 w-5 text-blue-400"}),t.jsx("h3",{className:"text-lg font-semibold text-white",children:a==="smart"?"Create Smart Section":"Create Manual Section"})]}),t.jsx("button",{onClick:n,className:"text-gray-400 hover:text-white",children:t.jsx(nt,{className:"h-5 w-5"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Name"}),t.jsx("input",{type:"text",value:l,onChange:_=>o(_.target.value),placeholder:"My Section",className:"w-full px-3 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:border-indigo-500 focus:outline-none",autoFocus:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Description"}),t.jsx("textarea",{value:d,onChange:_=>h(_.target.value),placeholder:"Optional description...",rows:2,className:"w-full px-3 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:border-indigo-500 focus:outline-none resize-none"})]}),a==="smart"&&t.jsx(Ej,{filter:u,onChange:f,genres:e}),a==="smart"&&t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Preview"}),t.jsxs("button",{onClick:v,disabled:b,className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white text-xs rounded-lg transition-colors flex items-center gap-1",children:[b?t.jsx(Ke,{className:"h-3 w-3 animate-spin"}):t.jsx(Pi,{className:"h-3 w-3"}),"Preview Results"]})]}),g.length>0&&t.jsx("div",{className:"border border-gray-700 rounded-lg max-h-48 overflow-y-auto",children:g.map(_=>t.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border-b border-gray-700/30 text-sm",children:[Oh(_.type),t.jsx("span",{className:"text-white truncate",children:_.title}),(_.year??0)>0&&t.jsxs("span",{className:"text-gray-500 text-xs",children:["(",_.year,")"]})]},_.mediaId))})]})]}),t.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[t.jsx("button",{onClick:n,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",children:"Cancel"}),t.jsxs("button",{onClick:()=>s({name:l,description:d,sectionType:a,smartFilter:a==="smart"?JSON.stringify(u):void 0}),disabled:!l.trim()||i,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[i&&t.jsx(Ke,{className:"h-4 w-4 animate-spin"}),"Create Section"]})]})]})})}function k7({section:a,genres:e,onSave:s,onClose:n,saving:i}){const[l,o]=k.useState(a.name),[d,h]=k.useState(a.description||""),[u,f]=k.useState(()=>{if(a.sectionType==="smart"&&a.smartFilter)try{return JSON.parse(a.smartFilter)}catch{return W0()}return W0()});return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl border border-gray-700 w-full max-w-2xl p-6 max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-white",children:"Edit Section"}),t.jsx("button",{onClick:n,className:"text-gray-400 hover:text-white",children:t.jsx(nt,{className:"h-5 w-5"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Name"}),t.jsx("input",{type:"text",value:l,onChange:g=>o(g.target.value),className:"w-full px-3 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:border-indigo-500 focus:outline-none",autoFocus:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Description"}),t.jsx("textarea",{value:d,onChange:g=>h(g.target.value),rows:2,className:"w-full px-3 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:border-indigo-500 focus:outline-none resize-none"})]}),a.sectionType==="smart"&&t.jsx(Ej,{filter:u,onChange:f,genres:e})]}),t.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[t.jsx("button",{onClick:n,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",children:"Cancel"}),t.jsxs("button",{onClick:()=>s({name:l,description:d,smartFilter:a.sectionType==="smart"?JSON.stringify(u):void 0}),disabled:!l.trim()||i,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[i&&t.jsx(Ke,{className:"h-4 w-4 animate-spin"}),"Save"]})]})]})})}function Ej({filter:a,onChange:e,genres:s}){const n=(i,l)=>{e({...a,[i]:l})};return t.jsxs("div",{className:"space-y-3 p-4 bg-gray-900/50 rounded-lg border border-gray-700",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"Filter Criteria"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Content Type"}),t.jsxs("select",{value:a.contentType,onChange:i=>n("contentType",i.target.value),className:"w-full px-3 py-2 bg-gray-700 text-white text-sm rounded-lg border border-gray-600 focus:border-indigo-500 focus:outline-none",children:[t.jsx("option",{value:"movie",children:"Movies"}),t.jsx("option",{value:"show",children:"Shows"}),t.jsx("option",{value:"movie,show",children:"Movies & Shows"}),t.jsx("option",{value:"episode",children:"Episodes"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Genre"}),t.jsxs("select",{value:a.genre,onChange:i=>n("genre",i.target.value),className:"w-full px-3 py-2 bg-gray-700 text-white text-sm rounded-lg border border-gray-600 focus:border-indigo-500 focus:outline-none",children:[t.jsx("option",{value:"",children:"Any Genre"}),s.map(i=>t.jsx("option",{value:i,children:i},i))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Year From"}),t.jsx("input",{type:"number",value:a.yearFrom||"",onChange:i=>n("yearFrom",parseInt(i.target.value)||0),placeholder:"Any",className:"w-full px-3 py-2 bg-gray-700 text-white text-sm rounded-lg border border-gray-600 focus:border-indigo-500 focus:outline-none"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Year To"}),t.jsx("input",{type:"number",value:a.yearTo||"",onChange:i=>n("yearTo",parseInt(i.target.value)||0),placeholder:"Any",className:"w-full px-3 py-2 bg-gray-700 text-white text-sm rounded-lg border border-gray-600 focus:border-indigo-500 focus:outline-none"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Min Rating"}),t.jsx("input",{type:"number",step:"0.1",min:"0",max:"10",value:a.minRating||"",onChange:i=>n("minRating",parseFloat(i.target.value)||0),placeholder:"Any",className:"w-full px-3 py-2 bg-gray-700 text-white text-sm rounded-lg border border-gray-600 focus:border-indigo-500 focus:outline-none"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Max Rating"}),t.jsx("input",{type:"number",step:"0.1",min:"0",max:"10",value:a.maxRating||"",onChange:i=>n("maxRating",parseFloat(i.target.value)||0),placeholder:"Any",className:"w-full px-3 py-2 bg-gray-700 text-white text-sm rounded-lg border border-gray-600 focus:border-indigo-500 focus:outline-none"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Sort By"}),t.jsxs("select",{value:a.sortBy,onChange:i=>n("sortBy",i.target.value),className:"w-full px-3 py-2 bg-gray-700 text-white text-sm rounded-lg border border-gray-600 focus:border-indigo-500 focus:outline-none",children:[t.jsx("option",{value:"title",children:"Title"}),t.jsx("option",{value:"year",children:"Year"}),t.jsx("option",{value:"rating",children:"Rating"}),t.jsx("option",{value:"addedAt",children:"Date Added"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Sort Direction"}),t.jsxs("select",{value:a.sortDir,onChange:i=>n("sortDir",i.target.value),className:"w-full px-3 py-2 bg-gray-700 text-white text-sm rounded-lg border border-gray-600 focus:border-indigo-500 focus:outline-none",children:[t.jsx("option",{value:"asc",children:"Ascending"}),t.jsx("option",{value:"desc",children:"Descending"})]})]})]})]})}function R7({searchQuery:a,onSearchChange:e,searchResults:s,onAdd:n,onClose:i,adding:l}){const[o,d]=k.useState(new Set),h=u=>{const f=new Set(o);f.has(u)?f.delete(u):f.add(u),d(f)};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl border border-gray-700 w-full max-w-lg p-6 max-h-[80vh] flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-white",children:"Add Items to Section"}),t.jsx("button",{onClick:i,className:"text-gray-400 hover:text-white",children:t.jsx(nt,{className:"h-5 w-5"})})]}),t.jsxs("div",{className:"relative mb-4",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:a,onChange:u=>e(u.target.value),placeholder:"Search your library...",className:"w-full pl-9 pr-3 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:border-indigo-500 focus:outline-none",autoFocus:!0})]}),t.jsx("div",{className:"flex-1 overflow-y-auto min-h-0 border border-gray-700 rounded-lg",children:a.length<2?t.jsx("div",{className:"p-8 text-center text-gray-500 text-sm",children:"Type at least 2 characters to search"}):s.length===0?t.jsx("div",{className:"p-8 text-center text-gray-500 text-sm",children:"No results found"}):s.map(u=>t.jsxs("button",{onClick:()=>h(u.mediaId),className:`w-full flex items-center gap-3 px-4 py-3 border-b border-gray-700/30 transition-colors text-left ${o.has(u.mediaId)?"bg-indigo-600/20":"hover:bg-gray-700/50"}`,children:[t.jsx("div",{className:`h-5 w-5 rounded border flex items-center justify-center flex-shrink-0 ${o.has(u.mediaId)?"bg-indigo-600 border-indigo-600":"border-gray-500"}`,children:o.has(u.mediaId)&&t.jsx("svg",{className:"h-3 w-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),u.thumb?t.jsx("img",{src:u.thumb,alt:"",className:"h-8 w-12 object-cover rounded bg-gray-700 flex-shrink-0"}):t.jsx("div",{className:"h-8 w-12 bg-gray-700 rounded flex items-center justify-center flex-shrink-0",children:Oh(u.type)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm text-white truncate",children:u.title}),t.jsxs("div",{className:"text-xs text-gray-500",children:[u.type," ",u.year?`(${u.year})`:""]})]})]},u.mediaId))}),t.jsxs("div",{className:"flex items-center justify-between mt-4",children:[t.jsxs("span",{className:"text-sm text-gray-400",children:[o.size," ",o.size===1?"item":"items"," selected"]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:i,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",children:"Cancel"}),t.jsxs("button",{onClick:()=>n(Array.from(o)),disabled:o.size===0||l,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[l&&t.jsx(Ke,{className:"h-4 w-4 animate-spin"}),"Add Selected"]})]})]})]})})}function Tj(a){if(!a)return"";const e=localStorage.getItem("openflix_token")||"";return a.startsWith("http")?`/api/images/proxy?url=${encodeURIComponent(a)}&X-Plex-Token=${e}`:`${a}${a.includes("?")?"&":"?"}X-Plex-Token=${e}`}function L7(a){return a?`https://image.tmdb.org/t/p/w342${a}`:""}const D7=["TV-Y","TV-G","TV-PG","TV-14","TV-MA","G","PG","PG-13","R","NR"];function M7(a,e,s){return Fe({queryKey:["metadataSearch",a,e,s],queryFn:()=>pe.getAdminMedia({search:a,page:e,type:s||void 0}),enabled:a.length>=2,placeholderData:n=>n})}function I7({items:a,onSelect:e}){return t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:a.map(s=>t.jsxs("button",{onClick:()=>e(s),className:"group bg-gray-700/50 rounded-lg overflow-hidden text-left hover:ring-2 hover:ring-indigo-500 transition-all",children:[t.jsxs("div",{className:"aspect-[2/3] bg-gray-700 relative",children:[s.thumb?t.jsx("img",{src:Tj(s.thumb),alt:s.title,className:"w-full h-full object-cover",loading:"lazy"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx(Oi,{className:"h-8 w-8 text-gray-600"})}),t.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-colors flex items-center justify-center",children:t.jsx(ph,{className:"h-6 w-6 text-white opacity-0 group-hover:opacity-100 transition-opacity"})})]}),t.jsxs("div",{className:"p-2",children:[t.jsx("p",{className:"text-sm text-white truncate",children:s.title}),t.jsxs("p",{className:"text-xs text-gray-400",children:[s.year?`${s.year}  `:"",t.jsx("span",{className:"capitalize",children:s.type})]})]})]},s.id))})}function P7({item:a,onClose:e,onApply:s}){const[n,i]=k.useState(a.title),[l,o]=k.useState(a.type==="show"?"tv":"movie"),[d,h]=k.useState([]),[u,f]=k.useState(!1),[g,p]=k.useState(null),[b,y]=k.useState(null),v=k.useCallback(async()=>{if(n.trim()){f(!0),p(null);try{const N=await pe.searchTMDB(n,l);h(N)}catch(N){p(N instanceof Error?N.message:"Search failed")}finally{f(!1)}}},[n,l]);k.useEffect(()=>{v()},[]);const _=async N=>{y(N.id);try{await pe.applyMediaMatch(a.id,N.id,N.media_type),s(N)}catch(C){p(C instanceof Error?C.message:"Failed to apply match")}finally{y(null)}};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl w-full max-w-3xl max-h-[85vh] flex flex-col shadow-2xl border border-gray-700",children:[t.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-700",children:[t.jsx("h3",{className:"text-lg font-semibold text-white",children:"Search TMDB"}),t.jsx("button",{onClick:e,className:"p-1 text-gray-400 hover:text-white",children:t.jsx(nt,{className:"h-5 w-5"})})]}),t.jsx("div",{className:"px-6 py-4 border-b border-gray-700 space-y-3",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:n,onChange:N=>i(N.target.value),onKeyDown:N=>N.key==="Enter"&&v(),className:"w-full pl-9 pr-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500",placeholder:"Search TMDB..."})]}),t.jsxs("select",{value:l,onChange:N=>o(N.target.value),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",children:[t.jsx("option",{value:"movie",children:"Movie"}),t.jsx("option",{value:"tv",children:"TV Show"})]}),t.jsx("button",{onClick:v,disabled:u,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white text-sm rounded-lg font-medium",children:u?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):"Search"})]})}),t.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-3",children:[g&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:[t.jsx(kt,{className:"h-4 w-4 text-red-400 shrink-0"}),t.jsx("span",{className:"text-red-400 text-sm",children:g})]}),u?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx(Ke,{className:"h-6 w-6 text-indigo-500 animate-spin"})}):d.length===0?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(xt,{className:"h-8 w-8 text-gray-600 mx-auto mb-2"}),t.jsx("p",{className:"text-gray-500 text-sm",children:"No results found"})]}):d.map(N=>{const C=N.release_date?.slice(0,4)||N.first_air_date?.slice(0,4);return t.jsxs("button",{onClick:()=>_(N),disabled:b!==null,className:"w-full flex gap-4 p-3 bg-gray-700/50 hover:bg-gray-700 rounded-lg text-left transition-colors disabled:opacity-50",children:[t.jsx("div",{className:"w-16 h-24 shrink-0 bg-gray-700 rounded overflow-hidden",children:N.poster_path?t.jsx("img",{src:L7(N.poster_path),alt:N.title,className:"w-full h-full object-cover",loading:"lazy"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx(Gt,{className:"h-6 w-6 text-gray-600"})})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("p",{className:"text-white font-medium truncate",children:N.title}),C&&t.jsxs("span",{className:"text-gray-400 text-sm shrink-0",children:["(",C,")"]})]}),N.original_title&&N.original_title!==N.title&&t.jsx("p",{className:"text-gray-500 text-xs mt-0.5",children:N.original_title}),t.jsx("p",{className:"text-gray-400 text-sm mt-1 line-clamp-2",children:N.overview||"No overview available"}),t.jsxs("div",{className:"flex items-center gap-3 mt-1.5",children:[t.jsx("span",{className:"text-xs text-gray-500 uppercase",children:N.media_type==="tv"?"TV Show":"Movie"}),N.vote_average!=null&&N.vote_average>0&&t.jsxs("span",{className:"text-xs text-yellow-500",children:[N.vote_average.toFixed(1)," / 10"]})]})]}),t.jsx("div",{className:"shrink-0 self-center",children:b===N.id?t.jsx(Ke,{className:"h-5 w-5 text-indigo-400 animate-spin"}):t.jsx(zC,{className:"h-5 w-5 text-gray-500"})})]},N.id)})]})]})})}function O7({item:a,onClose:e}){const[s,n]=k.useState(a.title),[i,l]=k.useState(a.sort_title||""),[o,d]=k.useState(a.year||""),[h,u]=k.useState(a.content_rating||""),[f,g]=k.useState(a.studio||""),[p,b]=k.useState(a.summary||""),[y,v]=k.useState(!1),[_,N]=k.useState(null),[C,T]=k.useState(!1),[L,F]=k.useState(!1);k.useEffect(()=>{n(a.title),l(a.sort_title||""),d(a.year||""),u(a.content_rating||""),g(a.studio||""),b(a.summary||""),N(null)},[a]);const H=k.useCallback(async()=>{v(!0),N(null);try{await pe.updateMediaMetadata(a.id,{title:s,sort_title:i,year:o===""?0:o,content_rating:h,studio:f,summary:p}),N({success:!0,message:"Metadata saved successfully"})}catch(O){N({success:!1,message:O instanceof Error?O.message:"Failed to save metadata"})}finally{v(!1)}},[a.id,s,i,o,h,f,p]),B=k.useCallback(async()=>{T(!0),N(null);try{await pe.refreshMediaMetadata(a.id),N({success:!0,message:"Metadata refresh started. Changes may take a moment to appear."})}catch(O){N({success:!1,message:O instanceof Error?O.message:"Failed to refresh metadata"})}finally{T(!1)}},[a.id]),P=k.useCallback(async()=>{N(null);try{const O=localStorage.getItem("openflix_token")||"",ee=await fetch(`/dvr/recordings/${a.id}/reprocess`,{method:"POST",headers:{"X-Plex-Token":O,"Content-Type":"application/json"}});if(!ee.ok){const ie=await ee.json().catch(()=>({}));throw new Error(ie.error||`HTTP ${ee.status}`)}N({success:!0,message:"Reprocessing started"})}catch(O){N({success:!1,message:O instanceof Error?O.message:"Failed to start reprocessing"})}},[a.id]),I=k.useCallback(async()=>{N(null);try{await pe.runCommercialDetection(a.id),N({success:!0,message:"Commercial detection started"})}catch(O){N({success:!1,message:O instanceof Error?O.message:"Failed to start commercial detection"})}},[a.id]),D=O=>{F(!1),N({success:!0,message:"TMDB match applied. Metadata will refresh automatically."})};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg transition-colors",children:t.jsx(Er,{className:"h-5 w-5"})}),t.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[a.thumb&&t.jsx("img",{src:Tj(a.thumb),alt:a.title,className:"w-12 h-18 rounded object-cover shrink-0"}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("h2",{className:"text-xl font-semibold text-white truncate",children:a.title}),t.jsxs("p",{className:"text-sm text-gray-400",children:[a.year?`${a.year}  `:"",t.jsx("span",{className:"capitalize",children:a.type}),a.library_name&&`  ${a.library_name}`,a.tmdb_id&&`  ID: ${a.tmdb_id}`]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"lg:col-span-2 space-y-6",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-400 uppercase tracking-wider mb-4",children:"Edit Metadata"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Title"}),t.jsx("input",{type:"text",value:s,onChange:O=>n(O.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Sort Title"}),t.jsx("input",{type:"text",value:i,onChange:O=>l(O.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",placeholder:"Leave blank to sort by title"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Year"}),t.jsx("input",{type:"number",value:o,onChange:O=>d(O.target.value===""?"":parseInt(O.target.value,10)),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",placeholder:"e.g. 2024",min:1900,max:2100})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Content Rating"}),t.jsxs("select",{value:h,onChange:O=>u(O.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",children:[t.jsx("option",{value:"",children:"-- None --"}),D7.map(O=>t.jsx("option",{value:O,children:O},O))]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Studio"}),t.jsx("input",{type:"text",value:f,onChange:O=>g(O.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",placeholder:"e.g. Warner Bros."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Summary / Description"}),t.jsx("textarea",{value:p,onChange:O=>b(O.target.value),rows:5,className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500 resize-vertical",placeholder:"Enter a description..."})]}),t.jsx("div",{className:"flex items-center gap-3 pt-2",children:t.jsxs("button",{onClick:H,disabled:y,className:"flex items-center gap-2 px-5 py-2.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 text-white rounded-lg font-medium transition-colors",children:[y?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):t.jsx(ii,{className:"h-4 w-4"}),y?"Saving...":"Save Changes"]})})]})]})}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-400 uppercase tracking-wider mb-4",children:"Fix Incorrect Match"}),t.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"If this item matched the wrong TMDB entry, search for the correct one and apply it."}),t.jsxs("button",{onClick:()=>F(!0),className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors",children:[t.jsx(xt,{className:"h-4 w-4"}),"Search TMDB"]})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-400 uppercase tracking-wider mb-4",children:"Actions"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("button",{onClick:B,disabled:C,className:"w-full flex items-center gap-2 px-4 py-2.5 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-750 text-white rounded-lg text-sm font-medium transition-colors",children:[C?t.jsx(Ke,{className:"h-4 w-4 animate-spin"}):t.jsx(ut,{className:"h-4 w-4"}),"Refresh Metadata"]}),t.jsxs("button",{onClick:P,className:"w-full flex items-center gap-2 px-4 py-2.5 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm font-medium transition-colors",children:[t.jsx($h,{className:"h-4 w-4"}),"Reprocess Video"]}),t.jsxs("button",{onClick:I,className:"w-full flex items-center gap-2 px-4 py-2.5 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm font-medium transition-colors",children:[t.jsx(vh,{className:"h-4 w-4"}),"Redetect Commercials"]})]})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-400 uppercase tracking-wider mb-4",children:"Item Info"}),t.jsxs("dl",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("dt",{className:"text-gray-500",children:"ID"}),t.jsx("dd",{className:"text-gray-300",children:a.id})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("dt",{className:"text-gray-500",children:"Type"}),t.jsx("dd",{className:"text-gray-300 capitalize",children:a.type})]}),a.library_name&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("dt",{className:"text-gray-500",children:"Library"}),t.jsx("dd",{className:"text-gray-300",children:a.library_name})]}),a.duration!=null&&a.duration>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("dt",{className:"text-gray-500",children:"Duration"}),t.jsxs("dd",{className:"text-gray-300",children:[Math.round(a.duration/6e4),"m"]})]}),a.child_count!=null&&a.child_count>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("dt",{className:"text-gray-500",children:a.type==="show"?"Seasons":"Children"}),t.jsx("dd",{className:"text-gray-300",children:a.child_count})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("dt",{className:"text-gray-500",children:"Added"}),t.jsx("dd",{className:"text-gray-300",children:new Date(a.added_at).toLocaleDateString()})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("dt",{className:"text-gray-500",children:"Updated"}),t.jsx("dd",{className:"text-gray-300",children:new Date(a.updated_at).toLocaleDateString()})]})]})]})]})]}),_&&t.jsxs("div",{className:`flex items-center gap-2 p-4 rounded-lg ${_.success?"bg-green-500/10 border border-green-500/30":"bg-red-500/10 border border-red-500/30"}`,children:[_.success?t.jsx(vn,{className:"h-5 w-5 text-green-400 shrink-0"}):t.jsx(kt,{className:"h-5 w-5 text-red-400 shrink-0"}),t.jsx("span",{className:_.success?"text-green-400 text-sm":"text-red-400 text-sm",children:_.message})]}),L&&t.jsx(P7,{item:a,onClose:()=>F(!1),onApply:D})]})}function F7(){const[a,e]=k.useState(""),[s,n]=k.useState(1),[i,l]=k.useState(""),[o,d]=k.useState(null),{data:h,isLoading:u,error:f}=M7(a,s,i);return o?t.jsx("div",{children:t.jsx(O7,{item:o,onClose:()=>d(null)})}):t.jsxs("div",{children:[t.jsxs("div",{className:"mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(ph,{className:"h-6 w-6 text-indigo-400"}),t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Metadata Editor"})]}),t.jsx("p",{className:"text-gray-400 mt-1",children:"Search and edit metadata for movies and TV shows. Fix incorrect matches, update titles, and refresh from TMDB."})]}),t.jsx("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),t.jsx("input",{type:"text",value:a,onChange:g=>{e(g.target.value),n(1)},className:"w-full pl-10 pr-10 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500",placeholder:"Search for a movie or TV show..."}),a&&t.jsx("button",{onClick:()=>e(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-white",children:t.jsx(nt,{className:"h-4 w-4"})})]}),t.jsxs("div",{className:"flex gap-1 bg-gray-700 rounded-lg p-1",children:[t.jsx("button",{onClick:()=>{l(""),n(1)},className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${i===""?"bg-indigo-600 text-white":"text-gray-400 hover:text-white"}`,children:"All"}),t.jsxs("button",{onClick:()=>{l("movie"),n(1)},className:`flex items-center gap-1.5 px-3 py-2 rounded-md text-sm font-medium transition-colors ${i==="movie"?"bg-indigo-600 text-white":"text-gray-400 hover:text-white"}`,children:[t.jsx(Gt,{className:"h-3.5 w-3.5"}),"Movies"]}),t.jsxs("button",{onClick:()=>{l("show"),n(1)},className:`flex items-center gap-1.5 px-3 py-2 rounded-md text-sm font-medium transition-colors ${i==="show"?"bg-indigo-600 text-white":"text-gray-400 hover:text-white"}`,children:[t.jsx(jt,{className:"h-3.5 w-3.5"}),"Shows"]})]})]})}),!a||a.length<2?t.jsxs("div",{className:"bg-gray-800 rounded-xl p-12 text-center",children:[t.jsx(ph,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Search for Media"}),t.jsx("p",{className:"text-gray-400",children:"Enter at least 2 characters to search your media library."})]}):u?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx(Ke,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):f?t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 text-center",children:[t.jsx(kt,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Search Failed"}),t.jsx("p",{className:"text-gray-400",children:"Could not search media library. Please try again."})]}):h&&h.items.length>0?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("p",{className:"text-sm text-gray-400",children:[h.total," result",h.total!==1?"s":""," found"]})}),t.jsx(I7,{items:h.items,onSelect:d}),h.total>h.page_size&&t.jsxs("div",{className:"flex justify-center gap-2 pt-4",children:[t.jsx("button",{onClick:()=>n(g=>Math.max(1,g-1)),disabled:s===1,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:text-gray-600 text-white rounded-lg",children:"Previous"}),t.jsxs("span",{className:"px-4 py-2 text-gray-400",children:["Page ",s," of"," ",Math.ceil(h.total/h.page_size)]}),t.jsx("button",{onClick:()=>n(g=>g+1),disabled:s>=Math.ceil(h.total/h.page_size),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:text-gray-600 text-white rounded-lg",children:"Next"})]})]}):t.jsxs("div",{className:"bg-gray-800 rounded-xl p-12 text-center",children:[t.jsx(xt,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No Results"}),t.jsxs("p",{className:"text-gray-400",children:["No media found matching ",a,""]})]})]})}const B7="openflix_token",f1=[{bg:"bg-indigo-500/20",text:"text-indigo-300",border:"border-indigo-500/30",dot:"bg-indigo-400"},{bg:"bg-green-500/20",text:"text-green-300",border:"border-green-500/30",dot:"bg-green-400"},{bg:"bg-amber-500/20",text:"text-amber-300",border:"border-amber-500/30",dot:"bg-amber-400"},{bg:"bg-red-500/20",text:"text-red-300",border:"border-red-500/30",dot:"bg-red-400"},{bg:"bg-purple-500/20",text:"text-purple-300",border:"border-purple-500/30",dot:"bg-purple-400"},{bg:"bg-blue-500/20",text:"text-blue-300",border:"border-blue-500/30",dot:"bg-blue-400"},{bg:"bg-pink-500/20",text:"text-pink-300",border:"border-pink-500/30",dot:"bg-pink-400"},{bg:"bg-teal-500/20",text:"text-teal-300",border:"border-teal-500/30",dot:"bg-teal-400"}];function sf(){return localStorage.getItem(B7)||""}function U7(a){let e=0;for(let s=0;s<a.length;s++){const n=a.charCodeAt(s);e=(e<<5)-e+n,e=e&e}return Math.abs(e)}function Aj(a){const e=U7(a)%f1.length;return f1[e]}function $7(a){return new Date(a).toLocaleDateString()}function G7(a){if(!a)return"--";const e=Math.floor(a/3600),s=Math.floor(a%3600/60);return e>0?`${e}h ${s}m`:`${s}m`}function V7(a){return a.isMovie?"Movie":a.seasonNumber!=null&&a.episodeNumber!=null?`S${String(a.seasonNumber).padStart(2,"0")}E${String(a.episodeNumber).padStart(2,"0")}`:a.episodeNum?a.episodeNum:""}async function q7(){const a=await fetch("/dvr/labels",{headers:{"X-Plex-Token":sf()}});if(!a.ok)throw new Error("Failed to fetch labels");return a.json()}async function K7(a){const e=await fetch(`/dvr/labels/${encodeURIComponent(a)}/files`,{headers:{"X-Plex-Token":sf()}});if(!e.ok)throw new Error("Failed to fetch files");return e.json()}async function H7(a,e){if(!(await fetch(`/dvr/v2/files/${a}/labels`,{method:"PUT",headers:{"X-Plex-Token":sf(),"Content-Type":"application/json"},body:JSON.stringify({labels:e})})).ok)throw new Error("Failed to update labels")}async function z7(a,e,s){if(!(await fetch("/dvr/labels/bulk",{method:"POST",headers:{"X-Plex-Token":sf(),"Content-Type":"application/json"},body:JSON.stringify({action:a,label:e,fileIds:s})})).ok)throw new Error("Failed to perform bulk action")}function uh({label:a,count:e,selected:s,onClick:n}){const i=Aj(a);return t.jsxs("button",{onClick:n,className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium border transition-all ${s?`${i.bg} ${i.text} ${i.border} ring-2 ring-offset-1 ring-offset-gray-900 ring-${i.dot.replace("bg-","")}`:`${i.bg} ${i.text} ${i.border} hover:brightness-125`}`,children:[t.jsx("span",{className:`w-2 h-2 rounded-full ${i.dot}`}),a,e!=null&&t.jsxs("span",{className:"text-xs opacity-70",children:["(",e,")"]})]})}function Y7({onClose:a,onSubmit:e,existingLabels:s}){const[n,i]=k.useState(""),l=o=>{o.preventDefault();const d=n.trim();d&&(e(d),a())};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",children:t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md border border-gray-700 shadow-xl",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-white",children:"Add Label"}),t.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white transition-colors",children:t.jsx(nt,{className:"h-5 w-5"})})]}),t.jsxs("form",{onSubmit:l,children:[t.jsx("input",{type:"text",value:n,onChange:o=>i(o.target.value),placeholder:"Enter label name...",className:"w-full px-4 py-2.5 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent mb-4",autoFocus:!0}),s.length>0&&t.jsxs("div",{className:"mb-4",children:[t.jsx("p",{className:"text-xs text-gray-400 mb-2",children:"Or pick an existing label:"}),t.jsx("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto",children:s.map(o=>t.jsx(uh,{label:o,onClick:()=>{e(o),a()}},o))})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:"Cancel"}),t.jsxs("button",{type:"submit",disabled:!n.trim(),className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-800 disabled:text-gray-400 text-white rounded-lg text-sm flex items-center gap-2",children:[t.jsx(Pt,{className:"h-4 w-4"}),"Add Label"]})]})]})]})})}function W7({fileId:a,currentLabels:e,allLabels:s,onUpdate:n,onClose:i}){const[l,o]=k.useState(""),d=u=>{const f=e.includes(u)?e.filter(g=>g!==u):[...e,u];n(a,f)},h=()=>{const u=l.trim();u&&!e.includes(u)&&(n(a,[...e,u]),o(""))};return t.jsxs("div",{className:"absolute right-0 top-full mt-1 z-30 w-64 bg-gray-800 border border-gray-700 rounded-xl shadow-xl p-3",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Labels"}),t.jsx("button",{onClick:i,className:"text-gray-500 hover:text-white",children:t.jsx(nt,{className:"h-3.5 w-3.5"})})]}),t.jsxs("div",{className:"max-h-40 overflow-y-auto space-y-1 mb-2",children:[s.map(u=>{const f=e.includes(u),g=Aj(u);return t.jsxs("button",{onClick:()=>d(u),className:`flex items-center gap-2 w-full px-2.5 py-1.5 rounded-lg text-sm transition-colors ${f?`${g.bg} ${g.text}`:"text-gray-300 hover:bg-gray-700"}`,children:[t.jsx("span",{className:`w-2 h-2 rounded-full ${g.dot}`}),t.jsx("span",{className:"flex-1 text-left",children:u}),f&&t.jsx(Bs,{className:"h-3.5 w-3.5"})]},u)}),s.length===0&&t.jsx("p",{className:"text-xs text-gray-500 py-2 text-center",children:"No labels yet"})]}),t.jsx("div",{className:"border-t border-gray-700 pt-2",children:t.jsxs("div",{className:"flex gap-1.5",children:[t.jsx("input",{type:"text",value:l,onChange:u=>o(u.target.value),onKeyDown:u=>u.key==="Enter"&&h(),placeholder:"New label...",className:"flex-1 px-2.5 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-indigo-500"}),t.jsx("button",{onClick:h,disabled:!l.trim(),className:"px-2.5 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-700 disabled:text-gray-500 text-white rounded-lg text-sm",children:t.jsx(Pt,{className:"h-3.5 w-3.5"})})]})})]})}function Q7(){const a=at(),[e,s]=k.useState(null),[n,i]=k.useState(new Set),[l,o]=k.useState(!1),[d,h]=k.useState(""),[u,f]=k.useState(!1),[g,p]=k.useState(null),[b,y]=k.useState(""),{data:v,isLoading:_,error:N,refetch:C}=Fe({queryKey:["dvr-labels"],queryFn:q7}),{data:T,isLoading:L,error:F}=Fe({queryKey:["dvr-label-files",e],queryFn:()=>K7(e),enabled:!!e}),H=Me({mutationFn:({fileId:te,labels:W})=>H7(te,W),onSuccess:()=>{a.invalidateQueries({queryKey:["dvr-labels"]}),a.invalidateQueries({queryKey:["dvr-label-files"]})}}),B=Me({mutationFn:({action:te,label:W,fileIds:K})=>z7(te,W,K),onSuccess:()=>{a.invalidateQueries({queryKey:["dvr-labels"]}),a.invalidateQueries({queryKey:["dvr-label-files"]}),i(new Set),f(!1),h("")}}),P=v?.labels||[],I=T?.files||[],D=k.useMemo(()=>P.map(te=>te.label).sort(),[P]),O=k.useMemo(()=>{if(!b)return I;const te=b.toLowerCase();return I.filter(W=>W.title.toLowerCase().includes(te)||W.subtitle&&W.subtitle.toLowerCase().includes(te)||W.channelName&&W.channelName.toLowerCase().includes(te))},[I,b]),ee=te=>{i(W=>{const K=new Set(W);return K.has(te)?K.delete(te):K.add(te),K})},ie=()=>{n.size===O.length?i(new Set):i(new Set(O.map(te=>te.id)))},Z=te=>{if(!e)return;const W=I.find(J=>J.id===te);if(!W)return;const q=(W.labels?W.labels.split(",").map(J=>J.trim()).filter(Boolean):[]).filter(J=>J!==e);H.mutate({fileId:te,labels:q})},z=(te,W)=>{H.mutate({fileId:te,labels:W})},X=()=>{const te=d.trim();!te||n.size===0||B.mutate({action:"add",label:te,fileIds:Array.from(n)})},ae=()=>{!e||n.size===0||B.mutate({action:"remove",label:e,fileIds:Array.from(n)})};return _?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx(Ke,{className:"h-8 w-8 text-indigo-500 animate-spin"})}):N?t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[t.jsx(ps,{className:"h-12 w-12 text-red-400"}),t.jsx("h3",{className:"text-lg font-medium text-white",children:"Failed to load labels"}),t.jsx("p",{className:"text-gray-400 text-sm",children:N.message}),t.jsxs("button",{onClick:()=>C(),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:[t.jsx(ut,{className:"h-4 w-4"}),"Retry"]})]}):t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[t.jsx(Vc,{className:"h-7 w-7 text-indigo-400"}),"Labels"]}),t.jsxs("p",{className:"text-gray-400 mt-1",children:[P.length," label",P.length!==1?"s":""," across your DVR library"]})]}),t.jsx("div",{className:"flex items-center gap-3",children:t.jsxs("button",{onClick:()=>C(),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:[t.jsx(ut,{className:"h-4 w-4"}),"Refresh"]})})]}),t.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 mb-6",children:[t.jsx("h2",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4",children:"All Labels"}),P.length===0?t.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[t.jsx(Vc,{className:"h-12 w-12 text-gray-600 mb-3"}),t.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"No labels found"}),t.jsx("p",{className:"text-gray-500 text-xs",children:"Add labels to your DVR recordings to organize them"})]}):t.jsx("div",{className:"flex flex-wrap gap-2",children:P.sort((te,W)=>W.count-te.count).map(te=>t.jsx(uh,{label:te.label,count:te.count,selected:e===te.label,onClick:()=>s(e===te.label?null:te.label)},te.label))})]}),e&&t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("button",{onClick:()=>{s(null),i(new Set),y("")},className:"flex items-center gap-1.5 text-gray-400 hover:text-white transition-colors text-sm",children:[t.jsx(ko,{className:"h-4 w-4"}),"Back"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(uh,{label:e}),t.jsxs("span",{className:"text-gray-400 text-sm",children:[T?.totalCount||0," file",(T?.totalCount||0)!==1?"s":""]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"relative",children:[t.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:b,onChange:te=>y(te.target.value),placeholder:"Filter...",className:"pl-9 pr-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-indigo-500 w-48"})]}),n.size>0&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-xs text-gray-400",children:[n.size," selected"]}),u?t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("input",{type:"text",value:d,onChange:te=>h(te.target.value),onKeyDown:te=>te.key==="Enter"&&X(),placeholder:"Label name...",className:"px-3 py-1.5 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-indigo-500 w-36",autoFocus:!0}),t.jsx("button",{onClick:X,disabled:!d.trim()||B.isPending,className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-700 text-white text-xs rounded-lg",children:B.isPending?"Adding...":"Add"}),t.jsx("button",{onClick:()=>{f(!1),h("")},className:"px-2 py-1.5 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-xs",children:t.jsx(nt,{className:"h-3.5 w-3.5"})})]}):t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-1.5 px-3 py-1.5 bg-indigo-600/20 hover:bg-indigo-600/30 text-indigo-300 border border-indigo-500/30 rounded-lg text-xs",children:[t.jsx(Pt,{className:"h-3.5 w-3.5"}),"Add Label"]}),t.jsxs("button",{onClick:ae,disabled:B.isPending,className:"flex items-center gap-1.5 px-3 py-1.5 bg-red-600/20 hover:bg-red-600/30 text-red-300 border border-red-500/30 rounded-lg text-xs",children:[t.jsx(nt,{className:"h-3.5 w-3.5"}),B.isPending?"Removing...":`Remove "${e}"`]})]})]})]})]}),L?t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsx(Ke,{className:"h-6 w-6 text-indigo-500 animate-spin"})}):F?t.jsxs("div",{className:"flex flex-col items-center justify-center h-32 gap-3 bg-gray-800 rounded-xl",children:[t.jsx(ps,{className:"h-8 w-8 text-red-400"}),t.jsx("p",{className:"text-sm text-gray-400",children:F.message})]}):O.length===0?t.jsxs("div",{className:"flex flex-col items-center justify-center h-32 bg-gray-800 rounded-xl",children:[t.jsx(wa,{className:"h-10 w-10 text-gray-600 mb-2"}),t.jsx("p",{className:"text-gray-400 text-sm",children:b?"No files match your search":"No files with this label"})]}):t.jsx("div",{className:"bg-gray-800 rounded-xl overflow-hidden",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"text-left text-sm text-gray-400 border-b border-gray-700",children:[t.jsx("th",{className:"px-4 py-3 font-medium w-10",children:t.jsx("input",{type:"checkbox",checked:n.size===O.length&&O.length>0,onChange:ie,className:"rounded border-gray-600 bg-gray-700 text-indigo-600 focus:ring-indigo-500"})}),t.jsx("th",{className:"px-4 py-3 font-medium",children:"Title"}),t.jsx("th",{className:"px-4 py-3 font-medium",children:"Episode"}),t.jsx("th",{className:"px-4 py-3 font-medium",children:"Channel"}),t.jsx("th",{className:"px-4 py-3 font-medium",children:"Duration"}),t.jsx("th",{className:"px-4 py-3 font-medium",children:"Date"}),t.jsx("th",{className:"px-4 py-3 font-medium",children:"Labels"}),t.jsx("th",{className:"px-4 py-3 font-medium text-right",children:"Actions"})]})}),t.jsx("tbody",{className:"text-sm",children:O.map(te=>{const W=te.labels?te.labels.split(",").map(K=>K.trim()).filter(Boolean):[];return t.jsxs("tr",{className:"border-b border-gray-700/50 hover:bg-gray-700/30 transition-colors",children:[t.jsx("td",{className:"px-4 py-3",children:t.jsx("input",{type:"checkbox",checked:n.has(te.id),onChange:()=>ee(te.id),className:"rounded border-gray-600 bg-gray-700 text-indigo-600 focus:ring-indigo-500"})}),t.jsx("td",{className:"px-4 py-3",children:t.jsxs("div",{className:"flex items-center gap-3",children:[te.thumb?t.jsx("img",{src:te.thumb,alt:"",className:"w-10 h-14 object-cover rounded bg-gray-700 flex-shrink-0",onError:K=>{K.target.style.display="none"}}):t.jsx("div",{className:"w-10 h-14 bg-gray-700 rounded flex items-center justify-center flex-shrink-0",children:t.jsx(wa,{className:"h-4 w-4 text-gray-500"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-white font-medium",children:te.title}),te.subtitle&&t.jsx("p",{className:"text-gray-500 text-xs mt-0.5 line-clamp-1 max-w-xs",children:te.subtitle})]})]})}),t.jsx("td",{className:"px-4 py-3 text-gray-300",children:V7(te)||"--"}),t.jsx("td",{className:"px-4 py-3",children:te.channelName?t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(jt,{className:"h-3.5 w-3.5 text-gray-500"}),t.jsx("span",{className:"text-gray-300",children:te.channelName})]}):t.jsx("span",{className:"text-gray-500",children:"--"})}),t.jsx("td",{className:"px-4 py-3",children:t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(Kt,{className:"h-3.5 w-3.5 text-gray-500"}),t.jsx("span",{className:"text-gray-300",children:G7(te.duration)})]})}),t.jsx("td",{className:"px-4 py-3 text-gray-400 text-xs",children:$7(te.createdAt)}),t.jsx("td",{className:"px-4 py-3",children:t.jsx("div",{className:"flex flex-wrap gap-1",children:W.map(K=>t.jsx(uh,{label:K},K))})}),t.jsx("td",{className:"px-4 py-3",children:t.jsxs("div",{className:"flex items-center justify-end gap-1.5 relative",children:[t.jsx("button",{onClick:()=>p(g===te.id?null:te.id),className:"p-1.5 text-gray-400 hover:text-indigo-400 hover:bg-gray-700 rounded-lg transition-colors",title:"Manage labels",children:t.jsx(Pt,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>Z(te.id),disabled:H.isPending,className:"p-1.5 text-gray-400 hover:text-red-400 hover:bg-gray-700 rounded-lg transition-colors",title:`Remove "${e}" label`,children:t.jsx(nt,{className:"h-4 w-4"})}),g===te.id&&t.jsx(W7,{fileId:te.id,currentLabels:W,allLabels:D,onUpdate:z,onClose:()=>p(null)})]})})]},te.id)})})]})})})]}),l&&t.jsx(Y7,{onClose:()=>o(!1),onSubmit:te=>{n.size>0&&B.mutate({action:"add",label:te,fileIds:Array.from(n)})},existingLabels:D}),H.error&&t.jsxs("div",{className:"mt-4 p-3 bg-red-500/10 border border-red-500/30 rounded-lg flex items-center gap-2",children:[t.jsx(ps,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),t.jsxs("span",{className:"text-red-400 text-sm",children:["Failed to update labels: ",H.error.message]})]}),B.error&&t.jsxs("div",{className:"mt-4 p-3 bg-red-500/10 border border-red-500/30 rounded-lg flex items-center gap-2",children:[t.jsx(ps,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),t.jsxs("span",{className:"text-red-400 text-sm",children:["Bulk operation failed: ",B.error.message]})]})]})}const X7=new PA({defaultOptions:{queries:{staleTime:3e4,retry:1}}});function J7({children:a}){return pe.isAuthenticated()?t.jsx(t.Fragment,{children:a}):t.jsx(j1,{to:"/ui/login",replace:!0})}function Z7(){return t.jsx(OA,{client:X7,children:t.jsx(nA,{children:t.jsxs(IT,{children:[t.jsx(mt,{path:"/ui/login",element:t.jsx(c3,{})}),t.jsxs(mt,{path:"/ui",element:t.jsx(J7,{children:t.jsx(o3,{})}),children:[t.jsx(mt,{index:!0,element:t.jsx(R3,{})}),t.jsx(mt,{path:"users",element:t.jsx(O3,{})}),t.jsx(mt,{path:"libraries",element:t.jsx(K3,{})}),t.jsx(mt,{path:"media",element:t.jsx(H3,{})}),t.jsx(mt,{path:"livetv",element:t.jsx(XD,{})}),t.jsx(mt,{path:"livetv/epg-editor",element:t.jsx(JD,{})}),t.jsx(mt,{path:"tvguide",element:t.jsx(c6,{})}),t.jsx(mt,{path:"onnow",element:t.jsx(S6,{})}),t.jsx(mt,{path:"onlater",element:t.jsx(b6,{})}),t.jsx(mt,{path:"teampass",element:t.jsx(E6,{})}),t.jsx(mt,{path:"dvr",element:t.jsx(F6,{})}),t.jsx(mt,{path:"dvr/passes",element:t.jsx(B6,{})}),t.jsx(mt,{path:"dvr/schedule",element:t.jsx(q6,{})}),t.jsx(mt,{path:"dvr/calendar",element:t.jsx(Q6,{})}),t.jsx(mt,{path:"vod",element:t.jsx(t8,{})}),t.jsx(mt,{path:"transcode",element:t.jsx(l8,{})}),t.jsx(mt,{path:"logs",element:t.jsx(u8,{})}),t.jsx(mt,{path:"settings",element:t.jsx(x8,{})}),t.jsx(mt,{path:"settings/sources",element:t.jsx(v8,{})}),t.jsx(mt,{path:"settings/livetv-dvr",element:t.jsx(D8,{})}),t.jsx(mt,{path:"settings/advanced",element:t.jsx(w8,{})}),t.jsx(mt,{path:"settings/status",element:t.jsx(O8,{})}),t.jsx(mt,{path:"downloads",element:t.jsx(W8,{})}),t.jsx(mt,{path:"tuners",element:t.jsx(Z8,{})}),t.jsx(mt,{path:"channel-collections",element:t.jsx(gF,{})}),t.jsx(mt,{path:"artwork",element:t.jsx(bF,{})}),t.jsx(mt,{path:"metadata",element:t.jsx(F7,{})}),t.jsx(mt,{path:"collections",element:t.jsx(IF,{})}),t.jsx(mt,{path:"upload",element:t.jsx(UF,{})}),t.jsx(mt,{path:"connections",element:t.jsx(YF,{})}),t.jsx(mt,{path:"diagnostics",element:t.jsx(aB,{})}),t.jsx(mt,{path:"speedtest",element:t.jsx(oB,{})}),t.jsx(mt,{path:"jobs",element:t.jsx(xB,{})}),t.jsx(mt,{path:"virtual-channels",element:t.jsx(kB,{})}),t.jsx(mt,{path:"segments",element:t.jsx(PB,{})}),t.jsx(mt,{path:"search",element:t.jsx(GB,{})}),t.jsx(mt,{path:"updater",element:t.jsx(zB,{})}),t.jsx(mt,{path:"comskip",element:t.jsx(QB,{})}),t.jsx(mt,{path:"setup",element:t.jsx(aU,{})}),t.jsx(mt,{path:"backups",element:t.jsx(fU,{})}),t.jsx(mt,{path:"trash",element:t.jsx(_U,{})}),t.jsx(mt,{path:"notifications",element:t.jsx(wU,{})}),t.jsx(mt,{path:"subtitles",element:t.jsx(SU,{})}),t.jsx(mt,{path:"scheduler",element:t.jsx(jU,{})}),t.jsx(mt,{path:"devices",element:t.jsx(IU,{})}),t.jsx(mt,{path:"offline",element:t.jsx(KU,{})}),t.jsx(mt,{path:"playlists",element:t.jsx(m7,{})}),t.jsx(mt,{path:"sections",element:t.jsx(A7,{})}),t.jsx(mt,{path:"shows/:id",element:t.jsx(WU,{})}),t.jsx(mt,{path:"movies/:id",element:t.jsx(a7,{})}),t.jsx(mt,{path:"labels",element:t.jsx(Q7,{})})]}),t.jsx(mt,{path:"*",element:t.jsx(j1,{to:"/ui",replace:!0})})]})})})}U2.createRoot(document.getElementById("root")).render(t.jsx(k.StrictMode,{children:t.jsx(Z7,{})}));
